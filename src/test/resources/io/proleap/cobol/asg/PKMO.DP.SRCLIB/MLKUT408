       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    MLKUT408.                                         00020000
       AUTHOR.        BARBARA HULL.                                     00030000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
       DATE-WRITTEN.  06-12-98.                                         00050000
       DATE-COMPILED.                                                   00060000
      ******************************************************************00070000
      *                                                                *00080000
      * MLKUT408 -  THIS PROGRAM PROCESSES THE SORTED EXTRACT FILE.    *00090000
      *                                                                *00100000
      * THE FILE IS IN THE FOLLOWING ASCENDING ORDER: DEPARTMENT,      *00110000
      * MAJOR CLASS AND INVENTORY DOLLAR AMOUNT.  AS STORE RECORDS ARE *00120000
      * ENCOUNTERED THEY ARE GIVEN A RANK BASED ON THEIR INVENTORY     *00130000
      * DOLLAR AMOUNT WITHIN DEPARTMENT AND MAJOR CLASS.               *00140000
      *                                                                *00150000
      * DURING NORMAL MONTHLY PROCESSING ONLY DEPARTMENT AND STORE     *00160000
      * TOTAL RECORDS ARE PROCESSED.  MAJOR CLASS AND STORE DETAIL     *00170000
      * RECORDS ARE INCLUDED FOR THE QUARTERLY PROCESS (EXCLUSION OF   *00180000
      * MAJOR CLASS AND STORE DETAIL IS HANDLED BY THE SORT PRECEEDING *00190000
      * THIS PROGRAM).                                                 *00200000
      *                                                                *00210000
      * THE UNSORTED EXTRACT FILE IS CREATED IN PROGRAM MLKUT407.      *00220000
      *                                                                *00230000
      * THE OUTPUT EXTRACT FILE WILL BE USED AS INPUT BY MLKRP203      *00240000
      * WHICH CREATES THE RANKING REPORT.                              *00250000
      *                                                                *00260000
W26603******************************************************************00270000
W26603* CHG ID   DATE        DESCRIPTION                               *00280000
W26603* ------   ----------  ----------------------------------------- *00290000
W26603* W26603   03-23-2004  STORE EXPANSION.  EXPANDED LRECL OF       *00300000
W26603*                      INP02, AND OUT01 BECAUSE OF MLRD108.      *00310000
W26603*                      - RONNA MCDONALD                          *00320000
      ******************************************************************00330000
      *                                                                 00340000
       ENVIRONMENT DIVISION.                                            00350000
       CONFIGURATION SECTION.                                           00360000
       SOURCE-COMPUTER.        IBM-3090.                                00370000
       OBJECT-COMPUTER.        IBM-3090.                                00380000
       INPUT-OUTPUT SECTION.                                            00390000
       FILE-CONTROL.                                                    00400000
      *                                                                 00410000
           SELECT CONTROL-FILE                                          00420000
               ASSIGN TO INP01.                                         00430000
      *                                                                 00440000
           SELECT RANK-EXTRACT-IN-FILE                                  00450000
               ASSIGN TO INP02.                                         00460000
      *                                                                 00470000
           SELECT RANK-EXTRACT-OUT-FILE                                 00480000
               ASSIGN TO OUT01.                                         00490000
      *                                                                 00500000
      ******************************************************************00510000
       DATA DIVISION.                                                   00520000
      ******************************************************************00530000
       FILE SECTION.                                                    00540000
                                                                        00550000
       FD  CONTROL-FILE                                                 00560000
           RECORDING MODE IS F                                          00570000
           LABEL RECORDS ARE STANDARD                                   00580000
           BLOCK CONTAINS 0 CHARACTERS.                                 00590000
                                                                        00600000
       01  CONTROL-RECORD              PIC X(80).                       00610000
                                                                        00620000
       FD  RANK-EXTRACT-IN-FILE                                         00630000
           RECORDING MODE IS F                                          00640000
           LABEL RECORDS ARE STANDARD                                   00650000
           BLOCK CONTAINS 0 CHARACTERS.                                 00660000
                                                                        00670000
W26603*01  RANK-EXTRACT-IN-RECORD      PIC X(70).                       00680000
W26603 01  RANK-EXTRACT-IN-RECORD      PIC X(90).                       00690000
                                                                        00700000
       FD  RANK-EXTRACT-OUT-FILE                                        00710000
           RECORDING MODE IS F                                          00720000
           LABEL RECORDS ARE STANDARD                                   00730000
           BLOCK CONTAINS 0 CHARACTERS.                                 00740000
                                                                        00750000
W26603*01  RANK-EXTRACT-OUT-RECORD     PIC X(70).                       00760000
W26603 01  RANK-EXTRACT-OUT-RECORD     PIC X(90).                       00770000
                                                                        00780000
      ******************************************************************00790000
       WORKING-STORAGE SECTION.                                         00800000
      ******************************************************************00810000
                                                                        00820000
      *** INPUT CONTROL CARD                                            00830000
       01  CC-CONTROL-CARD.                                             00840000
           05  CC-VALUE                PIC  X(02)      VALUE SPACE.     00850000
               88  CC-INVENTORY                        VALUE '00'.      00860000
               88  CC-MONTH-SALES                      VALUE '01'.      00870000
               88  CC-LY-YTD-SALES                     VALUE '02'.      00880000
           05  FILLER                  PIC  X(78)      VALUE SPACE.     00890000
      *                                                                 00900000
      *** INPUT/OUTPUT STORE RANKING RECORD                             00910000
           COPY MLRD108.                                                00920000
                                                                        00930000
       EJECT                                                            00940000
                                                                        00950000
      *                                                                 00960000
       01 ABEND-AREAS.                                                  00970000
           05 ABEND-CODE               PIC S9(04)  VALUE ZERO           00980000
                                                   COMP SYNC.           00990000
               88  AC-BAD-DATA                     VALUE +4003.         01000000
               88  AC-DB2-ERROR                    VALUE +4013.         01010000
           05  AA-ABEND-LIT            PIC  X(40)  VALUE                01020000
                 '*****       ABEND'.                                   01030000
           05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                01040000
                   '*****   PROGRAM: MLKUT408'.                         01050000
           05  AA-PARAGRAPH-LIT.                                        01060000
               10  FILLER              PIC  X(17)  VALUE                01070000
                   '***** PARAGRAPH: '.                                 01080000
               10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        01090000
           05  AA-MESSAGE-LINE.                                         01100000
               10  FILLER              PIC  X(06)  VALUE '*****'.       01110000
               10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        01120000
           05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                01130000
                   '*****    DB2 ERROR'.                                01140000
           05  AA-DB2-OPERATION-LIT.                                    01150000
               10  FILLER              PIC  X(17)  VALUE                01160000
                   '***** OPERATION: '.                                 01170000
               10  AA-DB2-OPERATION.                                    01180000
                   15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        01190000
                   15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        01200000
           05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        01210000
           05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        01220000
           05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        01230000
           05  AA-DB2-TABLE-4          PIC  X(08)  VALUE SPACES.        01240000
      *                                                                 01250000
       01  PC-PROGRAM-COUNTERS                         COMP-3.          01260000
           05  PC-DEPT-RECS-READ       PIC S9(07)      VALUE ZEROS.     01270000
           05  PC-EXTRACTS-READ        PIC S9(09)      VALUE ZEROS.     01280000
           05  PC-EXTRACT-RECS-WRITTEN PIC S9(09)      VALUE ZEROS.     01290000
           05  PC-MAJ-CLASS-RECS-READ  PIC S9(07)      VALUE ZEROS.     01300000
                                                                        01310000
W26603*    05  PC-DETAIL-STORE-RANK    PIC S9(03)      VALUE ZEROS.     01320000
W26603     05  PC-DETAIL-STORE-RANK    PIC S9(05)      VALUE ZEROS.     01330000
           05  PC-DETAIL-STORE-RECS-READ                                01340000
                                       PIC S9(07)      VALUE ZEROS.     01350000
W26603*    05  PC-TOTAL-STORE-RANK     PIC S9(03)      VALUE ZEROS.     01360000
W26603     05  PC-TOTAL-STORE-RANK     PIC S9(05)      VALUE ZEROS.     01370000
           05  PC-TOTAL-STORE-RECS-READ                                 01380000
                                       PIC S9(07)      VALUE ZEROS.     01390000
      *                                                                 01400000
       01  SA-SAVE-AREAS.                                               01410000
W26603*    05  SA-HOLD-COUNT           PIC S9(03)      VALUE ZEROS.     01420000
W26603     05  SA-HOLD-COUNT           PIC S9(05)      VALUE ZEROS.     01430000
           05  SA-OLD-DEPT             PIC X(03)       VALUE ZEROS.     01440000
           05  SA-OLD-MAJ-CLASS        PIC X(02)       VALUE ZEROS.     01450000
      *                                                                 01460000
       01  PS-PROGRAM-SWITCHES.                                         01470000
           05  PS-RANK-EXTRACT-EOF-SWITCH                               01480000
                                       PIC  X(01)      VALUE 'N'.       01490000
               88 PS-END-OF-RANK-EXTRACT-FILE          VALUE 'Y'.       01500000
      *                                                                 01510000
       01  CD-COUNTER-DISPLAY.                                          01520000
           05  CD-COUNT-HOLD1          PIC ZZZ,ZZZ,ZZ9.                 01530000
                                                                        01540000
       EJECT                                                            01550000
                                                                        01560000
      ******************************************************************01570000
       PROCEDURE DIVISION.                                              01580000
      ******************************************************************01590000
                                                                        01600000
      ******************************************************************01610000
       0000-MAINLINE-MLKUT408.                                          01620000
      ******************************************************************01630000
      *                                                                 01640000
           PERFORM 1000-INITIALIZATION.                                 01650000
                                                                        01660000
           PERFORM                                                      01670000
               UNTIL PS-END-OF-RANK-EXTRACT-FILE                        01680000
                   PERFORM 2000-CREATE-RANKING                          01690000
                   PERFORM 5000-WRITE-RANK-EXTRACT-RECORD               01700000
                   PERFORM 4100-READ-RANK-EXTRACT-IN-FILE               01710000
           END-PERFORM.                                                 01720000
                                                                        01730000
           PERFORM 8000-EOJ.                                            01740000
                                                                        01750000
           STOP RUN.                                                    01760000
                                                                        01770000
       EJECT                                                            01780000
                                                                        01790000
      ******************************************************************01800000
       1000-INITIALIZATION.                                             01810000
      ******************************************************************01820000
      *                                                                 01830000
           OPEN INPUT  CONTROL-FILE                                     01840000
                       RANK-EXTRACT-IN-FILE                             01850000
                OUTPUT RANK-EXTRACT-OUT-FILE.                           01860000
                                                                        01870000
           PERFORM 4000-READ-CONTROL-FILE.                              01880000
                                                                        01890000
           EVALUATE TRUE                                                01900000
               WHEN CC-INVENTORY                                        01910000
                   CONTINUE                                             01920000
               WHEN CC-MONTH-SALES                                      01930000
                   CONTINUE                                             01940000
               WHEN CC-LY-YTD-SALES                                     01950000
                   CONTINUE                                             01960000
               WHEN OTHER                                               01970000
                   MOVE 'B100-INITIALIZE'                               01980000
                                       TO AA-PARAGRAPH-NAME             01990000
           MOVE 'MLKUT408 - VALID CONTROL CARD VALUES ARE 00, 01 OR 02' 02000000
                                       TO AA-MESSAGE                    02010000
                   MOVE +4003          TO ABEND-CODE                    02020000
                   PERFORM 9900-COMMON-ABEND-ROUTINE                    02030000
           END-EVALUATE.                                                02040000
                                                                        02050000
           DISPLAY 'CONTROL RECORD = ' CC-CONTROL-CARD.                 02060000
                                                                        02070000
           PERFORM 4100-READ-RANK-EXTRACT-IN-FILE.                      02080000
                                                                        02090000
           IF PS-END-OF-RANK-EXTRACT-FILE                               02100000
               MOVE 'B100-INITIALIZE'  TO AA-PARAGRAPH-NAME             02110000
               MOVE 'MLKUT408 - EXTRACT FILE IS EMPTY'                  02120000
                                       TO AA-MESSAGE                    02130000
               MOVE +4002              TO ABEND-CODE                    02140000
               PERFORM 9900-COMMON-ABEND-ROUTINE                        02150000
           END-IF.                                                      02160000
                                                                        02170000
           MOVE ML108-DEPT-NUMBER      TO SA-OLD-DEPT.                  02180000
           MOVE ML108-CLASS-NUMBER     TO SA-OLD-MAJ-CLASS.             02190000
                                                                        02200000
       EJECT                                                            02210000
                                                                        02220000
      ******************************************************************02230000
       2000-CREATE-RANKING.                                             02240000
      ******************************************************************02250000
      *                                                                 02260000
           ADD 1                       TO PC-EXTRACTS-READ.             02270000
                                                                        02280000
           IF ML108-DEPT-NUMBER > SA-OLD-DEPT                           02290000
               MOVE ZERO               TO PC-TOTAL-STORE-RANK           02300000
                                          PC-DETAIL-STORE-RANK          02310000
               MOVE ML108-DEPT-NUMBER  TO SA-OLD-DEPT                   02320000
               MOVE ML108-CLASS-NUMBER TO SA-OLD-MAJ-CLASS              02330000
           ELSE                                                         02340000
               IF ML108-CLASS-NUMBER > SA-OLD-MAJ-CLASS                 02350000
                   MOVE ZERO           TO PC-TOTAL-STORE-RANK           02360000
                                          PC-DETAIL-STORE-RANK          02370000
                   MOVE ML108-CLASS-NUMBER                              02380000
                                       TO SA-OLD-MAJ-CLASS              02390000
               END-IF                                                   02400000
           END-IF.                                                      02410000
                                                                        02420000
           IF ML108-CLASS-NUMBER = ZERO                                 02430000
               IF ML108-STORE-NUMBER = ZERO                             02440000
                   ADD 1               TO PC-DEPT-RECS-READ             02450000
                   MOVE LOW-VALUES     TO ML108-TOTAL-INDICATOR         02460000
                   MOVE ZERO           TO SA-HOLD-COUNT                 02470000
               ELSE                                                     02480000
                   ADD 1               TO PC-TOTAL-STORE-RECS-READ      02490000
                   ADD 1               TO PC-TOTAL-STORE-RANK           02500000
                   MOVE SPACES         TO ML108-TOTAL-INDICATOR         02510000
                   MOVE PC-TOTAL-STORE-RANK                             02520000
                                       TO SA-HOLD-COUNT                 02530000
           ELSE                                                         02540000
               IF ML108-STORE-NUMBER = ZERO                             02550000
                   ADD 1               TO PC-MAJ-CLASS-RECS-READ        02560000
                   MOVE ZERO           TO SA-HOLD-COUNT                 02570000
                   MOVE LOW-VALUES     TO ML108-TOTAL-INDICATOR         02580000
               ELSE                                                     02590000
                   ADD 1               TO PC-DETAIL-STORE-RECS-READ     02600000
                   ADD 1               TO PC-DETAIL-STORE-RANK          02610000
                   MOVE SPACES         TO ML108-TOTAL-INDICATOR         02620000
                   MOVE PC-DETAIL-STORE-RANK                            02630000
                                       TO SA-HOLD-COUNT                 02640000
               END-IF                                                   02650000
           END-IF.                                                      02660000
                                                                        02670000
           EVALUATE TRUE                                                02680000
               WHEN CC-INVENTORY                                        02690000
                   MOVE SA-HOLD-COUNT  TO ML108-INVENTORY-RANKING       02700000
               WHEN CC-MONTH-SALES                                      02710000
                   MOVE SA-HOLD-COUNT  TO ML108-MONTH-SALES-RANKING     02720000
               WHEN CC-LY-YTD-SALES                                     02730000
                   MOVE SA-HOLD-COUNT  TO ML108-LY-SALES-RANKING        02740000
           END-EVALUATE.                                                02750000
                                                                        02760000
       EJECT                                                            02770000
                                                                        02780000
      ******************************************************************02790000
       4000-READ-CONTROL-FILE.                                          02800000
      ******************************************************************02810000
      *                                                                 02820000
           READ CONTROL-FILE                                            02830000
             INTO CC-CONTROL-CARD                                       02840000
                 AT END                                                 02850000
                   MOVE '4000-READ-CONTROL-FILE'                        02860000
                                       TO AA-PARAGRAPH-NAME             02870000
                   MOVE 'MLKUT408 - CONTROL CARD IS MISSING'            02880000
                                       TO AA-MESSAGE                    02890000
                   MOVE +4001          TO ABEND-CODE                    02900000
                   PERFORM 9900-COMMON-ABEND-ROUTINE                    02910000
           END-READ.                                                    02920000
                                                                        02930000
       EJECT                                                            02940000
                                                                        02950000
      ******************************************************************02960000
       4100-READ-RANK-EXTRACT-IN-FILE.                                  02970000
      ******************************************************************02980000
      *                                                                 02990000
           READ RANK-EXTRACT-IN-FILE                                    03000000
               INTO ML108-STORE-RANKING-RECORD                          03010000
                   AT END                                               03020000
                       SET PS-END-OF-RANK-EXTRACT-FILE                  03030000
                                       TO TRUE.                         03040000
                                                                        03050000
       EJECT                                                            03060000
                                                                        03070000
      ******************************************************************03080000
       5000-WRITE-RANK-EXTRACT-RECORD.                                  03090000
      ******************************************************************03100000
      *                                                                 03110000
           WRITE RANK-EXTRACT-OUT-RECORD                                03120000
               FROM  ML108-STORE-RANKING-RECORD.                        03130000
                                                                        03140000
           ADD 1                       TO PC-EXTRACT-RECS-WRITTEN.      03150000
                                                                        03160000
       EJECT                                                            03170000
                                                                        03180000
      ******************************************************************03190000
       8000-EOJ.                                                        03200000
      ******************************************************************03210000
      *                                                                 03220000
           DISPLAY ' '.                                                 03230000
           DISPLAY '*** RECORD COUNT SUMMARY'.                          03240000
           MOVE PC-DETAIL-STORE-RECS-READ                               03250000
                                       TO CD-COUNT-HOLD1.               03260000
           DISPLAY 'DETAIL STORE RECORDS READ = ' CD-COUNT-HOLD1.       03270000
           MOVE PC-TOTAL-STORE-RECS-READ                                03280000
                                       TO CD-COUNT-HOLD1.               03290000
           DISPLAY 'TOTAL STORE RECORDS READ  = ' CD-COUNT-HOLD1.       03300000
           MOVE PC-MAJ-CLASS-RECS-READ TO CD-COUNT-HOLD1.               03310000
           DISPLAY 'MAJOR CLASS RECORDS READ  = ' CD-COUNT-HOLD1.       03320000
           MOVE PC-DEPT-RECS-READ      TO CD-COUNT-HOLD1.               03330000
           DISPLAY 'DEPARTMENT RECORDS READ   = ' CD-COUNT-HOLD1.       03340000
           MOVE PC-EXTRACTS-READ       TO CD-COUNT-HOLD1.               03350000
           DISPLAY 'TOTAL RECORDS READ        = ' CD-COUNT-HOLD1.       03360000
           DISPLAY ' '.                                                 03370000
           MOVE PC-EXTRACT-RECS-WRITTEN                                 03380000
                                       TO CD-COUNT-HOLD1.               03390000
           DISPLAY 'TOTAL RECORDS WRITTEN = ' CD-COUNT-HOLD1.           03400000
                                                                        03410000
           CLOSE CONTROL-FILE                                           03420000
                 RANK-EXTRACT-IN-FILE                                   03430000
                 RANK-EXTRACT-OUT-FILE.                                 03440000
                                                                        03450000
       EJECT                                                            03460000
                                                                        03470000
      ******************************************************************03480000
       9900-COMMON-ABEND-ROUTINE.                                       03490000
      ******************************************************************03500000
                                                                        03510000
           DISPLAY AA-ABEND-LIT.                                        03520000
           DISPLAY AA-PROGRAM-LIT.                                      03530000
           DISPLAY AA-PARAGRAPH-LIT.                                    03540000
           DISPLAY AA-MESSAGE-LINE.                                     03550000
           DISPLAY ABEND-CODE.                                          03560000
                                                                        03570000
           CALL 'ILBOABN0' USING ABEND-CODE.                            03580000
                                                                        03590000
       EJECT                                                            03600000
                                                                        03610000
