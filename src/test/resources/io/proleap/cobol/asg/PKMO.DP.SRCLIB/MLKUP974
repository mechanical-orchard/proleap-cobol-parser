       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    MLKUP974.                                         00020000
       AUTHOR.        B. GRAHAM - STRATAGEM.                            00030000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
       DATE-WRITTEN.  02/04/08.                                         00050000
       DATE-COMPILED.                                                   00060000
                                                                        00070000
      ******************************************************************00080000
      * THE PURPOSE OF THIS PROGRAM IS TO MOVE ROWS FROM ONE DKEY       00090000
      * IN A DEPT TO ANOTHER DKEY AS INDICATED BY INPUT CONTROL         00091000
      * INFORMATION                                                     00092000
      * 1.READ FROM/TO DEPT AND DKEY FROM CONTROL FILE                  00100000
      * 2.RETRIEVE ROWS FROM MLT_MNLY_SUM WITH FROM DEPT AND DKEY       00101000
      * 3.LOOK UP THE DKEY OF THE 'TO' DEPT AND DKEY TO SEE THAT IT IS  00110000
      *   VALID                                                         00120000
      * 4.INSERT THE ROW WITH THE NEW DKEY                              00130000
      * 5.DELETE THE ROW WITH THE OLD DKEY                              00140000
      * 6.IF THE ROW WITH THE NEW DKEY ALREADY EXISTS, RETRIEVE THAT    00150000
      *   ROW AND COMBINE THE MONEYS FROM THE 'FROM' DKEY ROW WITH      00160000
      *   'TO' DKEY AND REPLACE IT IN THE TABLE, THEN DELETE            00170000
      *   ORIGINAL 'FROM'  DKEY ROW.                                    00180000
      *                                                                 00190000
      * THE PROCESS NOTED ABOVE WILL BE DONE BASED UPON AN INPUT        00200000
      * MONTH END CONTROL CARD DATE.                                    00210000
      *                                                                 00220000
      ******************************************************************00230000
                                                                        00240000
      ******************** HISTORY OF CHANGES **************************00241006
      * CHG ID/                                                        *00242006
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES                    *00243006
      * -------  ----------  ----------------------------------------  *00244006
      * W32898   02-14-2008  B.GRAHAM - STRATAGEM                       00245011
      *                      INITIAL IMPLEMENTATION                     00246006
      * 238672   03-10-2008  B.GRAHAM - STRATAGEM                       00246111
      *                      QUALIFY MNLY-SUM CURSOR BY DEPT            00246211
      *                      CHG DKEY VALIDATION TO USE DEPT            00246311
      ******************************************************************00247006
      ******************************************************************00250000
       ENVIRONMENT DIVISION.                                            00260000
      ******************************************************************00270000
                                                                        00280000
       CONFIGURATION SECTION.                                           00290000
                                                                        00300000
       SOURCE-COMPUTER.        IBM-3090.                                00310000
       OBJECT-COMPUTER.        IMB-3090.                                00320000
                                                                        00330000
       INPUT-OUTPUT SECTION.                                            00340000
                                                                        00350000
       FILE-CONTROL.                                                    00360000
                                                                        00361000
           SELECT CNTL-DATE-FILE                                        00370000
               ASSIGN TO INP01.                                         00380000
                                                                        00380100
           SELECT FROM-TO-DKEY-FILE                                     00380200
               ASSIGN TO INP02.                                         00380302
                                                                        00380400
           SELECT AUDIT-FILE                                            00381000
               ASSIGN TO OUT01.                                         00382000
                                                                        00382100
      ******************************************************************00383000
       DATA DIVISION.                                                   00384000
      ******************************************************************00385000
                                                                        00386000
       FILE SECTION.                                                    00387000
                                                                        00388000
       FD  CNTL-DATE-FILE                                               00389000
           RECORDING  MODE IS F.                                        00390000
       01  CNTL-DATE-REC                    PIC X(80).                  00400000
                                                                        00401000
       FD  FROM-TO-DKEY-FILE                                            00402000
           RECORDING  MODE IS F.                                        00403000
       01  FROM-TO-DKEY-REC                 PIC X(80).                  00404000
                                                                        00410000
       FD  AUDIT-FILE                                                   00420000
           RECORDING  MODE IS F.                                        00430000
       01  AUDIT-REC                        PIC X(80).                  00440000
                                                                        00450000
                                                                        00460000
       WORKING-STORAGE SECTION.                                         00470000
                                                                        00480000
                                                                        00530000
       01  PS-PROGRAM-SWITCHES.                                         00540000
           05  PS-FROM-DKEY-CSR-AT-END-SW    PIC X     VALUE 'N'.       00580000
               88  PS-FROM-DKEY-CSR-AT-END-NO          VALUE 'N'.       00590000
               88  PS-FROM-DKEY-CSR-AT-END-YES         VALUE 'Y'.       00600000
           05  PS-FROM-TO-FILE-AT-END-SW     PIC X     VALUE 'N'.       00610000
               88  PS-FROM-TO-FILE-AT-END-NO           VALUE 'N'.       00620000
               88  PS-FROM-TO-FILE-AT-END-YES          VALUE 'Y'.       00630000
                                                                        00660000
       01  PC-PROGRAM-CONSTANTS.                                        00670000
           05 PC-PGM-NAME                  PIC X(8)  VALUE 'MLKUP974'.  00680000
           05 PC-MAX-RETRIES               PIC S9(03) VALUE 3 COMP-3.   00690000
           05 PC-M                         PIC X(01)  VALUE 'M'.        00691000
           05 PC-4001                      PIC S9(04) VALUE +4001 COMP. 00692001
           05 PC-4002                      PIC S9(04) VALUE +4002 COMP. 00693001
           05 PC-4003                      PIC S9(04) VALUE +4003 COMP. 00693101
           05 PC-4004                      PIC S9(04) VALUE +4004 COMP. 00693201
           05 PC-4005                      PIC S9(04) VALUE +4005 COMP. 00693301
           05 PC-INSERT                    PIC X(10) VALUE              00694000
                                                         'INSERT    '.  00695000
           05 PC-UPDATE                    PIC X(10) VALUE              00696000
                                                         'UPDATE    '.  00697000
           05 PC-DELETE                    PIC X(10) VALUE              00698000
                                                         'DELETE    '.  00699000
           05 PC-ERROR                     PIC X(10) VALUE              00700000
                                                         'ERROR     '.  00701000
                                                                        00702000
       01  PV-PROGRAM-VARIABLES.                                        00703000
           05 PV-PROCESS-DATE              PIC   X(10) VALUE SPACES.    00705000
                                                                        00706000
           05 PV-RETRY-COUNTER             PIC S9(04) COMP.             00708000
           05 PV-PARAGRAPH-NAME            PIC X(30)  VALUE SPACES.     00709000
           05 PV-DB2-DATE-EXISTS           PIC X(01).                   00710000
                                                                        00710100
           05  PV-FROM-DKEY-NBR-COMP       PIC S9(09) VALUE +0 COMP.    00710201
           05  PV-SAVE-FROM-DKEY-NBR       PIC S9(09) VALUE +0 COMP.    00710301
           05  PV-SAVE-TO-DKEY-NBR         PIC S9(09) VALUE +0 COMP.    00710401
           05  PV-TO-DKEY-NBR-COMP         PIC S9(09) VALUE +0 COMP.    00710501
           05  PV-FROM-TO-DEPT-NBR-COMP3   PIC S9(4)V VALUE +0 COMP-3.  00710600
                                                                        00711000
       01  PA-PROGRAM-ACCUMULATORS.                                     00720000
           05  PA-INPUT-COUNT              PIC  9(11) VALUE ZEROS.      00730000
           05  PA-INSERT-COUNT             PIC  9(11) VALUE ZEROS.      00731000
           05  PA-UPDATE-COUNT             PIC  9(11) VALUE ZEROS.      00740000
           05  PA-DELETE-COUNT             PIC  9(11) VALUE ZEROS.      00750000
           05  PA-FROM-DKEY-ROW-COUNT      PIC  9(11) VALUE ZEROS.      00760001
                                                                        00800000
       01  ABEND-CODE                        PIC S9(4) VALUE ZEROS      00801000
                                                       COMP SYNC.       00802000
                                                                        00803001
       01  ABEND-CODE-SQL              PIC S9(04)  VALUE ZERO COMP SYNC.00804001
                                                                        00805001
      ***************************************************************** 00810000
      *  CONTROL CARD WITH DATE                                         00820000
      ***************************************************************** 00830000
       01  CC-CONTROL-CARD.                                             00840000
           05  CC-PROC-DATE-ISO                PIC X(10).               00850000
           05  CC-PROC-DATE-RDF  REDEFINES                              00860000
               CC-PROC-DATE-ISO.                                        00870000
               10  CC-PROC-CC                  PIC X(02).               00880000
               10  CC-PROC-YY                  PIC X(02).               00890000
               10  FILLER                      PIC X(01).               00900000
               10  CC-PROC-MM                  PIC X(02).               00910000
               10  FILLER                      PIC X(01).               00920000
               10  CC-PROC-DD                  PIC X(02).               00930000
           05  FILLER                          PIC X(70).               00940000
                                                                        00950000
      ***************************************************************** 00950200
      *  FROM/TO DEPT AND DKEY                                          00950300
      ***************************************************************** 00950400
       01  PV-FROM-TO-DKEY-REC.                                         00950500
           05  PV-FROM-TO-DEPT-NBR             PIC 9(04).               00950600
           05  FILLER                          PIC X(01).               00950700
           05  PV-FROM-DKEY-NBR                PIC 9(09).               00950800
           05  FILLER                          PIC X(01).               00950900
           05  PV-TO-DKEY-NBR                  PIC 9(09).               00951000
           05  FILLER                          PIC X(56).               00951100
                                                                        00951200
      ***************************************************************** 00952000
      *  AUDIT FILE OF ACTION TAKEN                                     00953000
      ***************************************************************** 00954000
       01  PV-AUDIT-REC.                                                00960000
           05  PV-AUDIT-ACTION                 PIC X(10).               00970000
           05  PV-AUDIT-PARTN-NBR              PIC 9(04).               00980000
           05  PV-AUDIT-DEPT-NBR               PIC 9(04).               00990000
           05  PV-AUDIT-MAJ-CL-NBR             PIC 9(04).               01000000
           05  PV-AUDIT-SUB-CL-NBR             PIC 9(04).               01010000
           05  PV-AUDIT-LOC-NBR                PIC 9(04).               01020000
           05  PV-AUDIT-ML-LO-MDSE-LVL-ID      PIC 9(09).               01030000
           05  PV-AUDIT-FSCL-MN-END-DTE        PIC X(10).               01040000
           05  FILLER                          PIC X(31).               01050000
                                                                        01060000
      ******************************************************************01070000
      *  DB2 SQL ERROR MESSAGE FORMAT AREA                              01080000
      ******************************************************************01090000
           COPY DPWS004.                                                01100000
                                                                        01110000
      ******************************************************************01120000
      * DATE ATTRIBUTE TABLE                                            01130000
      ******************************************************************01140000
           EXEC SQL                                                     01150000
             INCLUDE TDTATTR                                            01160000
           END-EXEC.                                                    01170000
      ******************************************************************01180000
      *  MLV00000  MLV_BRND_VND VIEW                                    01190000
      ******************************************************************01200000
           EXEC SQL                                                     01210000
                INCLUDE MLV00000                                        01220000
           END-EXEC.                                                    01230000
      ******************************************************************01240000
      * PARTITION NUMBER TABLE                                          01250000
      ******************************************************************01260000
           EXEC SQL                                                     01270000
             INCLUDE MLT00003                                           01280000
           END-EXEC.                                                    01290000
      ******************************************************************01300000
      * PARTITION BAL TABLE                                             01310000
      ******************************************************************01320000
           EXEC SQL                                                     01330000
             INCLUDE MLT00002                                           01340000
           END-EXEC.                                                    01350000
      ******************************************************************01360000
      * MLT_MNLY_SUM TABLE                                              01370000
      ******************************************************************01380000
           EXEC SQL                                                     01390000
             INCLUDE MLT00004                                           01400000
           END-EXEC.                                                    01410000
      ***************************************************************** 01420000
      *    DB2 AREA FOR COMMUNICATIONS                                * 01430000
      ***************************************************************** 01440000
           EXEC SQL                                                     01450000
                INCLUDE SQLCA                                           01460000
           END-EXEC.                                                    01470000
                                                                        01480000
                                                                        01580000
           EXEC SQL                                                     01590000
              DECLARE FROM_DKEY_CSR CURSOR FOR                          01600000
                SELECT                                                  01610000
                       PARTN_NBR                                        01620000
                     , DEPT_NBR                                         01630000
                     , MAJ_CL_NBR                                       01640000
                     , SUB_CL_NBR                                       01650000
                     , LOC_NBR                                          01660000
                     , ML_LO_MDSE_LVL_ID                                01670000
                     , FSCL_MN_END_DTE                                  01680000
                     , SLS_REG_RTL_AMT                                  01690000
                     , SLS_PROMO_RTL_AMT                                01700000
                     , SLS_PROCLR_RTL_AMT                               01710000
                     , SLS_CLR_RTL_AMT                                  01720000
                     , SLS_OTH_RTL_AMT                                  01730000
                     , MKDN_PLU_RTL_AMT                                 01740000
                     , MKDN_PROMO_RTL_AMT                               01750000
                     , MKDN_RGST_RTL_AMT                                01760000
                     , MKDN_GLDST_RTL_AMT                               01770000
                     , MKDN_UMTCH_RTL_AMT                               01780000
                     , MKDN_BYR_RTL_AMT                                 01790000
                     , MKDN_STR_RTL_AMT                                 01800000
                     , MKDN_PRPT_RTL_AMT                                01810000
                     , MKDN_OTH_RTL_AMT                                 01820000
                     , MKDN_RTL_AMT                                     01830000
                     , MKUP_RTL_AMT                                     01840000
                     , XFER_IN_RTL_AMT                                  01850000
                     , XFER_OUT_RTL_AMT                                 01860000
                     , RCPT_RTL_AMT                                     01870000
                     , RCPT_NET_COST_AMT                                01880000
                     , RCPT_GRO_COST_AMT                                01890000
                     , PADJ_RTL_AMT                                     01900000
                     , PADJ_FRGT_COST_AMT                               01910000
                     , PADJ_DISC_COST_AMT                               01920000
                     , PADJ_RTV_COST_AMT                                01930000
                     , PADJ_RTV_RTL_AMT                                 01940000
                     , PADJ_DA_COST_AMT                                 01950000
                     , PADJ_DA_RTL_AMT                                  01960000
                     , PADJ_NET_COST_AMT                                01970000
                     , PADJ_OTH_COST_AMT                                01980000
                     , PADJ_OTH_RTL_AMT                                 01990000
                     , DR_ALW_RTL_AMT                                   02000000
                     , RTV_RTL_AMT                                      02010000
                     , MKUP_INIT_AMT                                    02020000
                     , MKUP_NET_AMT                                     02030000
                     , INV_ADJ_RTL_AMT                                  02040000
                     , ONORD_RTL_AMT                                    02050000
                     , ONORD_COST_AMT                                   02060000
                     , SHNK_RTL_AMT                                     02070000
                     , END_INV_RTL_AMT                                  02080000
                     , END_INV_COST_AMT                                 02090000
                     , KNW_THFT_RTL_AMT                                 02100000
                     , INV_COST_ADJ1_AMT                                02110000
                     , INV_COST_ADJ2_AMT                                02120000
                     , END_INV_COST1_AMT                                02130000
                     , END_INV_COST2_AMT                                02140000
                     , ADJ_GRO_MRGN_AMT                                 02150000
                    FROM  MLT_MNLY_SUM                                  02160000
                WHERE PARTN_NBR         = :MLT00003-PARTN-NBR           02170000
238672            AND DEPT_NBR          = :PV-FROM-TO-DEPT-NBR-COMP3    02180011
                  AND ML_LO_MDSE_LVL_ID = :PV-FROM-DKEY-NBR-COMP        02181009
                  AND FSCL_MN_END_DTE   = :PV-PROCESS-DATE              02190000
                   ORDER BY PARTN_NBR                                   02200000
                           ,DEPT_NBR                                    02210000
                           ,MAJ_CL_NBR                                  02220000
                           ,SUB_CL_NBR                                  02230000
                           ,LOC_NBR                                     02231000
                           ,ML_LO_MDSE_LVL_ID                           02232000
                                                                        02233000
           END-EXEC.                                                    02234000
      ******************************************************************02235000
       PROCEDURE DIVISION.                                              02236000
      ******************************************************************02237000
                                                                        02238000
       0000-MAINLINE.                                                   02239000
                                                                        02240000
           PERFORM 1000-INITIALIZE.                                     02250000
                                                                        02260000
           PERFORM 1100-PROCESS-FROM-TO-FILE                            02261001
               UNTIL PS-FROM-TO-FILE-AT-END-YES.                        02262000
                                                                        02262400
           DISPLAY 'PA-INPUT-COUNT     ' PA-INPUT-COUNT.                02262501
           DISPLAY 'PA-FROM-DKEY-COUNT ' PA-FROM-DKEY-ROW-COUNT         02262601
           DISPLAY 'PA-INSERT-COUNT    ' PA-INSERT-COUNT.               02262701
           DISPLAY 'PA-UPDATE-COUNT    ' PA-UPDATE-COUNT.               02262801
           DISPLAY 'PA-DELETE-COUNT    ' PA-DELETE-COUNT.               02262901
                                                                        02263001
           CLOSE CNTL-DATE-FILE                                         02263101
                 FROM-TO-DKEY-FILE                                      02263201
                 AUDIT-FILE.                                            02263301
                                                                        02263401
           STOP RUN.                                                    02263501
                                                                        02263601
                                                                        02430000
      ******************************************************************02440000
      *  PERFORM THE NECESSARY INITIALIZATION STEPS                     02450000
      ******************************************************************02460000
       1000-INITIALIZE.                                                 02470000
                                                                        02480000
           OPEN INPUT  CNTL-DATE-FILE                                   02490000
                       FROM-TO-DKEY-FILE                                02491000
                OUTPUT AUDIT-FILE.                                      02500000
                                                                        02510000
           INITIALIZE PV-AUDIT-REC.                                     02520000
                                                                        02530000
           PERFORM 8000-READ-CNTL-DTE.                                  02540000
                                                                        02550000
           PERFORM 8100-GET-PROCESS-DATE-INFO.                          02560001
                                                                        02570000
                                                                        02571000
       1100-PROCESS-FROM-TO-FILE.                                       02571100
                                                                        02572000
           PERFORM 8200-READ-FROM-TO-FILE.                              02573001
                                                                        02574000
           IF PS-FROM-TO-FILE-AT-END-NO                                 02575000
               PERFORM 1200-EDIT-FROM-TO-DATA                           02576000
               PERFORM 1500-GET-PARTN-NBR                               02578000
               PERFORM 1600-PROCESS-DKEYS                               02579000
           END-IF.                                                      02579200
                                                                        02579300
                                                                        02579400
       1200-EDIT-FROM-TO-DATA.                                          02579500
                                                                        02579600
           IF PV-FROM-TO-DEPT-NBR NOT NUMERIC                           02579700
               MOVE PC-4001 TO ABEND-CODE                               02579800
               DISPLAY '** PROGRAM ABEND **'                            02579900
               DISPLAY 'INPUT DEPT NOT NUMERIC FOR REC # '              02580000
                                                 PA-INPUT-COUNT         02580100
               CALL 'ILBOABN0' USING ABEND-CODE.                        02580500
                                                                        02580700
           IF PV-FROM-DKEY-NBR NOT NUMERIC                              02581001
               MOVE PC-4002 TO ABEND-CODE                               02581100
               DISPLAY '** PROGRAM ABEND **'                            02581200
               DISPLAY 'INPUT FROM DKEY NOT NUMERIC FOR REC # '         02581300
                                                 PA-INPUT-COUNT         02581400
               CALL 'ILBOABN0' USING ABEND-CODE.                        02581500
                                                                        02581700
           IF PV-TO-DKEY-NBR NOT NUMERIC                                02581801
               MOVE PC-4003 TO ABEND-CODE                               02581900
               DISPLAY '** PROGRAM ABEND **'                            02582000
               DISPLAY 'INPUT TO DKEY NOT NUMERIC FOR REC # '           02582100
                                                 PA-INPUT-COUNT         02582200
               CALL 'ILBOABN0' USING ABEND-CODE.                        02582300
                                                                        02582500
                                                                        02582610
238672     DISPLAY 'INPUT CONTROL RECORD ' PA-INPUT-COUNT.              02582711
238672     DISPLAY 'PV-FROM-TO-DEPT-NBR ' PV-FROM-TO-DEPT-NBR.          02582811
238672     DISPLAY 'PV-FROM-DKEY-NBR    ' PV-FROM-DKEY-NBR.             02582911
238672     DISPLAY 'PV-TO-DKEY-NBR      ' PV-TO-DKEY-NBR.               02583011
                                                                        02583110
238672     MOVE PV-FROM-TO-DEPT-NBR  TO PV-FROM-TO-DEPT-NBR-COMP3.      02583211
                                                                        02583310
           MOVE PV-FROM-DKEY-NBR TO  PV-FROM-DKEY-NBR-COMP.             02583408
                                                                        02583508
      **   IF PV-FROM-DKEY-NBR > ZEROS                                  02583607
      **       PERFORM 1205-CHECK-VALID-FROM-DKEY                       02583707
      **   END-IF.                                                      02583807
                                                                        02583903
           MOVE PV-TO-DKEY-NBR   TO PV-TO-DKEY-NBR-COMP.                02584003
                                                                        02584103
           EXEC SQL                                                     02584203
               SELECT ML_LO_MDSE_LVL_ID                                 02584303
                 INTO :PV-SAVE-TO-DKEY-NBR                              02584403
                 FROM MLV_BRND_VND                                      02584503
                 WHERE  ML_LO_MDSE_LVL_ID = :PV-TO-DKEY-NBR-COMP        02584603
238672             AND  DEPT_NBR          = :PV-FROM-TO-DEPT-NBR-COMP3  02584711
                   AND  EFF_BEG_DTE <= :PV-PROCESS-DATE                 02584809
                   AND (EFF_END_DTE >= :PV-PROCESS-DATE                 02584909
                    OR  EFF_END_DTE IS NULL)                            02585009
               WITH UR                                                  02585109
           END-EXEC.                                                    02585209
                                                                        02585309
           EVALUATE TRUE                                                02585409
               WHEN SQLCODE = ZERO                                      02585509
                   CONTINUE                                             02585609
               WHEN SQLCODE = +100                                      02585709
                   MOVE PC-4004 TO ABEND-CODE                           02585809
                   DISPLAY '** PROGRAM ABEND **'                        02585909
                   DISPLAY 'INPUT TO DKEY NOT FOUND FOR REC # '         02586009
                                                 PA-INPUT-COUNT         02586109
                   CALL 'ILBOABN0' USING ABEND-CODE                     02586209
               WHEN OTHER                                               02586309
                   MOVE '1200-EDIT-FROM-TO-DATA     '                   02586409
                                       TO PV-PARAGRAPH-NAME             02586509
                   PERFORM 9999-SQL-ABEND                               02586609
           END-EVALUATE.                                                02586709
                                                                        02586809
                                                                        02586909
      *1205-CHECK-VALID-FROM-DKEY.                                      02587009
      **                                                                02587109
      **   MOVE PV-FROM-DKEY-NBR TO  PV-FROM-DKEY-NBR-COMP.             02587209
      **                                                                02587309
      **   EXEC SQL                                                     02587409
      **       SELECT ML_LO_MDSE_LVL_ID                                 02587509
      **         INTO :PV-SAVE-FROM-DKEY-NBR                            02587609
      **         FROM MLV_BRND_VND                                      02587709
      **         WHERE  ML_LO_MDSE_LVL_ID = :PV-FROM-DKEY-NBR-COMP      02587809
      **           AND  EFF_BEG_DTE <= :PV-PROCESS-DATE                 02587909
      **           AND (EFF_END_DTE >= :PV-PROCESS-DATE                 02588009
      **            OR  EFF_END_DTE IS NULL)                            02588109
      **       WITH UR                                                  02588209
      **   END-EXEC.                                                    02588309
      **                                                                02588409
      **   EVALUATE TRUE                                                02588509
      **       WHEN SQLCODE = ZERO                                      02588609
      **           CONTINUE                                             02588709
      **       WHEN SQLCODE = +100                                      02588809
      **           MOVE PC-4004 TO ABEND-CODE                           02588909
      **           DISPLAY '** PROGRAM ABEND **'                        02589009
      **           DISPLAY 'INPUT FROM DKEY NOT FOUND FOR REC # '       02589109
      **                                         PA-INPUT-COUNT         02589209
      **           CALL 'ILBOABN0' USING ABEND-CODE                     02589309
      **       WHEN OTHER                                               02589409
      **           MOVE '1205-CHECK-VALID-FROM-DKEY '                   02589509
      **                               TO PV-PARAGRAPH-NAME             02589609
      **           PERFORM 9999-SQL-ABEND                               02589709
      **   END-EVALUATE.                                                02589809
      **                                                                02589907
                                                                        02590000
      ******************************************************************02591000
      *  1500-GET-PARTN-NBR                                             02600000
      ******************************************************************02610000
                                                                        02620000
       1500-GET-PARTN-NBR.                                              02630000
                                                                        02641100
           EXEC SQL                                                     02642000
                SELECT PARTN_NBR                                        02643000
                    INTO   :MLT00003-PARTN-NBR                          02644001
                FROM MLT_PARTN_CNTL A                                   02645000
                    ,MLT_PARTN_BAL  B                                   02646000
                WHERE B.DEPT_NBR = :PV-FROM-TO-DEPT-NBR-COMP3           02647000
                  AND A.TBL_TM_LVL_CDE = B.TBL_TM_LVL_CDE               02648000
                  AND A.TBL_TM_LVL_CDE = :PC-M                          02649000
                  AND A.DEPT_GP_CDE = B.DEPT_GP_CDE                     02649100
                  AND A.FSCL_DTE = :PV-PROCESS-DATE                     02649200
                  AND B.EFF_BEG_DTE <= :PV-PROCESS-DATE                 02649300
                  AND B.EFF_END_DTE >= :PV-PROCESS-DATE                 02649400
                                                                        02649500
           END-EXEC.                                                    02649600
                                                                        02649700
           EVALUATE TRUE                                                02649800
               WHEN SQLCODE = 0                                         02649900
                    CONTINUE                                            02650000
               WHEN SQLWARN0 NOT = SPACES                               02650100
               WHEN SQLCODE < +0                                        02650200
               WHEN SQLCODE > +0                                        02650300
                    MOVE '1500-GET-PARTN-NBR        '                   02650400
                          TO PV-PARAGRAPH-NAME                          02650500
                    PERFORM 9999-SQL-ABEND                              02650600
           END-EVALUATE.                                                02650700
                                                                        02920000
                                                                        02920100
       1600-PROCESS-DKEYS.                                              02921000
                                                                        02922000
           PERFORM 2200-OPEN-FROM-DKEY-CSR.                             02923100
                                                                        02923200
           SET PS-FROM-DKEY-CSR-AT-END-NO TO TRUE.                      02923300
                                                                        02923400
           PERFORM 2400-PROCESS-FROM-DKEY-CSR                           02923500
              UNTIL PS-FROM-DKEY-CSR-AT-END-YES.                        02923600
                                                                        02923700
           PERFORM 2300-CLOSE-FROM-DKEY-CSR.                            02923800
                                                                        02924000
                                                                        03280000
       2200-OPEN-FROM-DKEY-CSR.                                         03290000
                                                                        03300000
           EXEC SQL                                                     03310000
               OPEN FROM_DKEY_CSR                                       03320000
           END-EXEC.                                                    03330000
                                                                        03340000
           IF SQLCODE NOT = ZERO                                        03350000
               MOVE '2200-OPEN-FROM-DKEY-CSR '                          03360000
                                       TO PV-PARAGRAPH-NAME             03370000
               PERFORM 9999-SQL-ABEND                                   03380000
           END-IF.                                                      03390000
                                                                        03400000
       2300-CLOSE-FROM-DKEY-CSR.                                        03410000
                                                                        03420000
           EXEC SQL                                                     03430000
               CLOSE FROM_DKEY_CSR                                      03440000
           END-EXEC.                                                    03450000
                                                                        03460000
           IF SQLCODE NOT = ZERO                                        03470000
               MOVE '2300-CLOSE-FROM-DKEY-CSR '                         03480000
                                       TO PV-PARAGRAPH-NAME             03490000
               PERFORM 9999-SQL-ABEND                                   03500000
           END-IF.                                                      03510000
                                                                        03520000
                                                                        03530000
       2400-PROCESS-FROM-DKEY-CSR.                                      03540000
                                                                        03550000
           PERFORM 2500-FETCH-FROM-DKEY.                                03560000
                                                                        03570000
           IF PS-FROM-DKEY-CSR-AT-END-NO                                03580000
               ADD 1               TO PA-FROM-DKEY-ROW-COUNT            03590001
               MOVE MLT00004-PARTN-NBR                                  03590100
                                   TO PV-AUDIT-PARTN-NBR                03590200
               MOVE MLT00004-DEPT-NBR                                   03590300
                                   TO PV-AUDIT-DEPT-NBR                 03590400
               MOVE MLT00004-MAJ-CL-NBR                                 03590500
                                   TO PV-AUDIT-MAJ-CL-NBR               03590600
               MOVE MLT00004-SUB-CL-NBR                                 03590700
                                   TO PV-AUDIT-SUB-CL-NBR               03590800
               MOVE MLT00004-LOC-NBR                                    03590900
                                   TO PV-AUDIT-LOC-NBR                  03591000
               MOVE MLT00004-ML-LO-MDSE-LVL-ID                          03591100
                                   TO PV-AUDIT-ML-LO-MDSE-LVL-ID        03591200
               MOVE MLT00004-FSCL-MN-END-DTE                            03591300
                                   TO PV-AUDIT-FSCL-MN-END-DTE          03591400
                                                                        03591500
               PERFORM 2700-INSERT-NEW-DKEY-ROW                         03591801
                                                                        03591900
               PERFORM 2900-DELETE-OLD-FROM-DKEY-ROW                    03592000
           END-IF.                                                      03620000
                                                                        03630000
                                                                        03640000
       2500-FETCH-FROM-DKEY.                                            03650000
                                                                        03660000
           EXEC SQL                                                     03670000
               FETCH FROM_DKEY_CSR                                      03680000
               INTO    :MLT00004-PARTN-NBR                              03690000
                      ,:MLT00004-DEPT-NBR                               03700000
                      ,:MLT00004-MAJ-CL-NBR                             03710000
                      ,:MLT00004-SUB-CL-NBR                             03720000
                      ,:MLT00004-LOC-NBR                                03730000
                      ,:MLT00004-ML-LO-MDSE-LVL-ID                      03740000
                      ,:MLT00004-FSCL-MN-END-DTE                        03750000
                      ,:MLT00004-SLS-REG-RTL-AMT                        03760000
                      ,:MLT00004-SLS-PROMO-RTL-AMT                      03770000
                      ,:MLT00004-SLS-PROCLR-RTL-AMT                     03780000
                      ,:MLT00004-SLS-CLR-RTL-AMT                        03790000
                      ,:MLT00004-SLS-OTH-RTL-AMT                        03800000
                      ,:MLT00004-MKDN-PLU-RTL-AMT                       03810000
                      ,:MLT00004-MKDN-PROMO-RTL-AMT                     03820000
                      ,:MLT00004-MKDN-RGST-RTL-AMT                      03830000
                      ,:MLT00004-MKDN-GLDST-RTL-AMT                     03840000
                      ,:MLT00004-MKDN-UMTCH-RTL-AMT                     03850000
                      ,:MLT00004-MKDN-BYR-RTL-AMT                       03860000
                      ,:MLT00004-MKDN-STR-RTL-AMT                       03870000
                      ,:MLT00004-MKDN-PRPT-RTL-AMT                      03880000
                      ,:MLT00004-MKDN-OTH-RTL-AMT                       03890000
                      ,:MLT00004-MKDN-RTL-AMT                           03900000
                      ,:MLT00004-MKUP-RTL-AMT                           03910000
                      ,:MLT00004-XFER-IN-RTL-AMT                        03920000
                      ,:MLT00004-XFER-OUT-RTL-AMT                       03930000
                      ,:MLT00004-RCPT-RTL-AMT                           03940000
                      ,:MLT00004-RCPT-NET-COST-AMT                      03950000
                      ,:MLT00004-RCPT-GRO-COST-AMT                      03960000
                      ,:MLT00004-PADJ-RTL-AMT                           03970000
                      ,:MLT00004-PADJ-FRGT-COST-AMT                     03980000
                      ,:MLT00004-PADJ-DISC-COST-AMT                     03990000
                      ,:MLT00004-PADJ-RTV-COST-AMT                      04000000
                      ,:MLT00004-PADJ-RTV-RTL-AMT                       04010000
                      ,:MLT00004-PADJ-DA-COST-AMT                       04020000
                      ,:MLT00004-PADJ-DA-RTL-AMT                        04030000
                      ,:MLT00004-PADJ-NET-COST-AMT                      04040000
                      ,:MLT00004-PADJ-OTH-COST-AMT                      04050000
                      ,:MLT00004-PADJ-OTH-RTL-AMT                       04060000
                      ,:MLT00004-DR-ALW-RTL-AMT                         04070000
                      ,:MLT00004-RTV-RTL-AMT                            04080000
                      ,:MLT00004-MKUP-INIT-AMT                          04090000
                      ,:MLT00004-MKUP-NET-AMT                           04100000
                      ,:MLT00004-INV-ADJ-RTL-AMT                        04110000
                      ,:MLT00004-ONORD-RTL-AMT                          04120000
                      ,:MLT00004-ONORD-COST-AMT                         04130000
                      ,:MLT00004-SHNK-RTL-AMT                           04140000
                      ,:MLT00004-END-INV-RTL-AMT                        04150000
                      ,:MLT00004-END-INV-COST-AMT                       04160000
                      ,:MLT00004-KNW-THFT-RTL-AMT                       04170000
                      ,:MLT00004-INV-COST-ADJ1-AMT                      04180000
                      ,:MLT00004-INV-COST-ADJ2-AMT                      04190000
                      ,:MLT00004-END-INV-COST1-AMT                      04200000
                      ,:MLT00004-END-INV-COST2-AMT                      04210000
                      ,:MLT00004-ADJ-GRO-MRGN-AMT                       04220000
           END-EXEC.                                                    04230000
                                                                        04240000
           EVALUATE TRUE                                                04250000
               WHEN SQLCODE = ZERO                                      04260000
                   SET PS-FROM-DKEY-CSR-AT-END-NO TO TRUE               04270000
               WHEN SQLCODE = +100                                      04280000
                   SET PS-FROM-DKEY-CSR-AT-END-YES TO TRUE              04290000
               WHEN OTHER                                               04300000
                   MOVE '2500-FETCH-FROM-DKEY       '                   04310005
                                       TO PV-PARAGRAPH-NAME             04320000
                   PERFORM 9999-SQL-ABEND                               04330000
           END-EVALUATE.                                                04340000
                                                                        04350000
                                                                        04360000
                                                                        04451000
                                                                        04650000
       2700-INSERT-NEW-DKEY-ROW.                                        04660001
                                                                        04670000
           EXEC SQL                                                     04680000
               INSERT INTO MLT_MNLY_SUM                                 04690000
                    (  PARTN_NBR                                        04700000
                     , DEPT_NBR                                         04710000
                     , MAJ_CL_NBR                                       04720000
                     , SUB_CL_NBR                                       04730000
                     , LOC_NBR                                          04740000
                     , ML_LO_MDSE_LVL_ID                                04750000
                     , FSCL_MN_END_DTE                                  04760000
                     , SLS_REG_RTL_AMT                                  04770000
                     , SLS_PROMO_RTL_AMT                                04780000
                     , SLS_PROCLR_RTL_AMT                               04790000
                     , SLS_CLR_RTL_AMT                                  04800000
                     , SLS_OTH_RTL_AMT                                  04810000
                     , MKDN_PLU_RTL_AMT                                 04820000
                     , MKDN_PROMO_RTL_AMT                               04830000
                     , MKDN_RGST_RTL_AMT                                04840000
                     , MKDN_GLDST_RTL_AMT                               04850000
                     , MKDN_UMTCH_RTL_AMT                               04860000
                     , MKDN_BYR_RTL_AMT                                 04870000
                     , MKDN_STR_RTL_AMT                                 04880000
                     , MKDN_PRPT_RTL_AMT                                04890000
                     , MKDN_OTH_RTL_AMT                                 04900000
                     , MKDN_RTL_AMT                                     04910000
                     , MKUP_RTL_AMT                                     04920000
                     , XFER_IN_RTL_AMT                                  04930000
                     , XFER_OUT_RTL_AMT                                 04940000
                     , RCPT_RTL_AMT                                     04950000
                     , RCPT_NET_COST_AMT                                04960000
                     , RCPT_GRO_COST_AMT                                04970000
                     , PADJ_RTL_AMT                                     04980000
                     , PADJ_FRGT_COST_AMT                               04990000
                     , PADJ_DISC_COST_AMT                               05000000
                     , PADJ_RTV_COST_AMT                                05010000
                     , PADJ_RTV_RTL_AMT                                 05020000
                     , PADJ_DA_COST_AMT                                 05030000
                     , PADJ_DA_RTL_AMT                                  05040000
                     , PADJ_NET_COST_AMT                                05050000
                     , PADJ_OTH_COST_AMT                                05060000
                     , PADJ_OTH_RTL_AMT                                 05070000
                     , DR_ALW_RTL_AMT                                   05080000
                     , RTV_RTL_AMT                                      05090000
                     , MKUP_INIT_AMT                                    05100000
                     , MKUP_NET_AMT                                     05110000
                     , INV_ADJ_RTL_AMT                                  05120000
                     , ONORD_RTL_AMT                                    05130000
                     , ONORD_COST_AMT                                   05140000
                     , SHNK_RTL_AMT                                     05150000
                     , END_INV_RTL_AMT                                  05160000
                     , END_INV_COST_AMT                                 05170000
                     , KNW_THFT_RTL_AMT                                 05180000
                     , INV_COST_ADJ1_AMT                                05190000
                     , INV_COST_ADJ2_AMT                                05200000
                     , END_INV_COST1_AMT                                05210000
                     , END_INV_COST2_AMT                                05220000
                     , ADJ_GRO_MRGN_AMT )                               05230000
               VALUES (:MLT00004-PARTN-NBR                              05240001
                      ,:MLT00004-DEPT-NBR                               05250000
                      ,:MLT00004-MAJ-CL-NBR                             05260000
                      ,:MLT00004-SUB-CL-NBR                             05270000
                      ,:MLT00004-LOC-NBR                                05280000
                      ,:PV-SAVE-TO-DKEY-NBR                             05290001
                      ,:MLT00004-FSCL-MN-END-DTE                        05300000
                      ,:MLT00004-SLS-REG-RTL-AMT                        05310000
                      ,:MLT00004-SLS-PROMO-RTL-AMT                      05320000
                      ,:MLT00004-SLS-PROCLR-RTL-AMT                     05330000
                      ,:MLT00004-SLS-CLR-RTL-AMT                        05340000
                      ,:MLT00004-SLS-OTH-RTL-AMT                        05350000
                      ,:MLT00004-MKDN-PLU-RTL-AMT                       05360000
                      ,:MLT00004-MKDN-PROMO-RTL-AMT                     05370000
                      ,:MLT00004-MKDN-RGST-RTL-AMT                      05380000
                      ,:MLT00004-MKDN-GLDST-RTL-AMT                     05390000
                      ,:MLT00004-MKDN-UMTCH-RTL-AMT                     05400000
                      ,:MLT00004-MKDN-BYR-RTL-AMT                       05410000
                      ,:MLT00004-MKDN-STR-RTL-AMT                       05420000
                      ,:MLT00004-MKDN-PRPT-RTL-AMT                      05430000
                      ,:MLT00004-MKDN-OTH-RTL-AMT                       05440000
                      ,:MLT00004-MKDN-RTL-AMT                           05450000
                      ,:MLT00004-MKUP-RTL-AMT                           05460000
                      ,:MLT00004-XFER-IN-RTL-AMT                        05470000
                      ,:MLT00004-XFER-OUT-RTL-AMT                       05480000
                      ,:MLT00004-RCPT-RTL-AMT                           05490000
                      ,:MLT00004-RCPT-NET-COST-AMT                      05500000
                      ,:MLT00004-RCPT-GRO-COST-AMT                      05510000
                      ,:MLT00004-PADJ-RTL-AMT                           05520000
                      ,:MLT00004-PADJ-FRGT-COST-AMT                     05530000
                      ,:MLT00004-PADJ-DISC-COST-AMT                     05540000
                      ,:MLT00004-PADJ-RTV-COST-AMT                      05550000
                      ,:MLT00004-PADJ-RTV-RTL-AMT                       05560000
                      ,:MLT00004-PADJ-DA-COST-AMT                       05570000
                      ,:MLT00004-PADJ-DA-RTL-AMT                        05580000
                      ,:MLT00004-PADJ-NET-COST-AMT                      05590000
                      ,:MLT00004-PADJ-OTH-COST-AMT                      05600000
                      ,:MLT00004-PADJ-OTH-RTL-AMT                       05610000
                      ,:MLT00004-DR-ALW-RTL-AMT                         05620000
                      ,:MLT00004-RTV-RTL-AMT                            05630000
                      ,:MLT00004-MKUP-INIT-AMT                          05640000
                      ,:MLT00004-MKUP-NET-AMT                           05650000
                      ,:MLT00004-INV-ADJ-RTL-AMT                        05660000
                      ,:MLT00004-ONORD-RTL-AMT                          05670000
                      ,:MLT00004-ONORD-COST-AMT                         05680000
                      ,:MLT00004-SHNK-RTL-AMT                           05690000
                      ,:MLT00004-END-INV-RTL-AMT                        05700000
                      ,:MLT00004-END-INV-COST-AMT                       05710000
                      ,:MLT00004-KNW-THFT-RTL-AMT                       05720000
                      ,:MLT00004-INV-COST-ADJ1-AMT                      05730000
                      ,:MLT00004-INV-COST-ADJ2-AMT                      05740000
                      ,:MLT00004-END-INV-COST1-AMT                      05750000
                      ,:MLT00004-END-INV-COST2-AMT                      05760000
                      ,:MLT00004-ADJ-GRO-MRGN-AMT )                     05770000
           END-EXEC.                                                    05780000
                                                                        05790000
           EVALUATE TRUE                                                05800000
               WHEN SQLCODE = ZERO                                      05810000
                   ADD 1                      TO PA-INSERT-COUNT        05820000
                   MOVE PV-SAVE-TO-DKEY-NBR   TO                        05830001
                                           PV-AUDIT-ML-LO-MDSE-LVL-ID   05840000
                   MOVE PC-INSERT             TO PV-AUDIT-ACTION        05850000
                   PERFORM 8300-WRITE-AUDIT-REC                         05860001
               WHEN SQLCODE = -803                                      05870000
                   PERFORM 2800-UPDATE-EXISTING-UNK-ROW                 05880000
               WHEN OTHER                                               05890000
                   DISPLAY                                              05900000
                        ' PARTN: ' MLT00004-PARTN-NBR,                  05910001
                        ' DEPT:  ' MLT00004-DEPT-NBR,                   05920000
                        ' MAJCL: ' MLT00004-MAJ-CL-NBR,                 05930000
                        ' SUBCL: ' MLT00004-SUB-CL-NBR,                 05940000
                        ' LOC:   ' MLT00004-LOC-NBR,                    05950000
                        ' ML-LWST-ID: ' PV-SAVE-TO-DKEY-NBR             05960001
                   MOVE '2700-INSERT-NEW-DKEY ROW '                     05970001
                                         TO PV-PARAGRAPH-NAME           05980000
                   PERFORM 9999-SQL-ABEND                               05990000
           END-EVALUATE.                                                06000000
                                                                        06010000
                                                                        06020000
       2800-UPDATE-EXISTING-UNK-ROW.                                    06030000
                                                                        06040000
           EXEC SQL                                                     06050000
             UPDATE MLT_MNLY_SUM                                        06060000
               SET SLS_REG_RTL_AMT    = SLS_REG_RTL_AMT                 06070000
                            + :MLT00004-SLS-REG-RTL-AMT                 06080000
                  ,SLS_PROMO_RTL_AMT  = SLS_PROMO_RTL_AMT               06090000
                            + :MLT00004-SLS-PROMO-RTL-AMT               06100000
                  ,SLS_PROCLR_RTL_AMT = SLS_PROCLR_RTL_AMT              06110000
                            + :MLT00004-SLS-PROCLR-RTL-AMT              06120000
                  ,SLS_CLR_RTL_AMT    = SLS_CLR_RTL_AMT                 06130000
                            + :MLT00004-SLS-CLR-RTL-AMT                 06140000
                  ,SLS_OTH_RTL_AMT    = SLS_OTH_RTL_AMT                 06150000
                            + :MLT00004-SLS-OTH-RTL-AMT                 06160000
                  ,MKDN_PLU_RTL_AMT   = MKDN_PLU_RTL_AMT                06170000
                            + :MLT00004-MKDN-PLU-RTL-AMT                06180000
                  ,MKDN_PROMO_RTL_AMT = MKDN_PROMO_RTL_AMT              06190000
                            + :MLT00004-MKDN-PROMO-RTL-AMT              06200000
                  ,MKDN_RGST_RTL_AMT  = MKDN_RGST_RTL_AMT               06210000
                            + :MLT00004-MKDN-RGST-RTL-AMT               06220000
                  ,MKDN_GLDST_RTL_AMT = MKDN_GLDST_RTL_AMT              06230000
                            + :MLT00004-MKDN-GLDST-RTL-AMT              06240000
                  ,MKDN_UMTCH_RTL_AMT = MKDN_UMTCH_RTL_AMT              06250000
                            + :MLT00004-MKDN-UMTCH-RTL-AMT              06260000
                  ,MKDN_BYR_RTL_AMT   = MKDN_BYR_RTL_AMT                06270000
                            + :MLT00004-MKDN-BYR-RTL-AMT                06280000
                  ,MKDN_STR_RTL_AMT   = MKDN_STR_RTL_AMT                06290000
                            + :MLT00004-MKDN-STR-RTL-AMT                06300000
                  ,MKDN_PRPT_RTL_AMT  = MKDN_PRPT_RTL_AMT               06310000
                            + :MLT00004-MKDN-PRPT-RTL-AMT               06320000
                  ,MKDN_OTH_RTL_AMT   = MKDN_OTH_RTL_AMT                06330000
                            + :MLT00004-MKDN-OTH-RTL-AMT                06340000
                  ,MKDN_RTL_AMT       = MKDN_RTL_AMT                    06350000
                            + :MLT00004-MKDN-RTL-AMT                    06360000
                  ,MKUP_RTL_AMT       = MKUP_RTL_AMT                    06370000
                            + :MLT00004-MKUP-RTL-AMT                    06380000
                  ,XFER_IN_RTL_AMT    = XFER_IN_RTL_AMT                 06390000
                            + :MLT00004-XFER-IN-RTL-AMT                 06400000
                  ,XFER_OUT_RTL_AMT   = XFER_OUT_RTL_AMT                06410000
                            + :MLT00004-XFER-OUT-RTL-AMT                06420000
                  ,RCPT_RTL_AMT       = RCPT_RTL_AMT                    06430000
                            + :MLT00004-RCPT-RTL-AMT                    06440000
                  ,RCPT_NET_COST_AMT  = RCPT_NET_COST_AMT               06450000
                            + :MLT00004-RCPT-NET-COST-AMT               06460000
                  ,RCPT_GRO_COST_AMT  = RCPT_GRO_COST_AMT               06470000
                            + :MLT00004-RCPT-GRO-COST-AMT               06480000
                  ,PADJ_RTL_AMT       = PADJ_RTL_AMT                    06490000
                            + :MLT00004-PADJ-RTL-AMT                    06500000
                  ,PADJ_FRGT_COST_AMT = PADJ_FRGT_COST_AMT              06510000
                            + :MLT00004-PADJ-FRGT-COST-AMT              06520000
                  ,PADJ_DISC_COST_AMT = PADJ_DISC_COST_AMT              06530000
                            + :MLT00004-PADJ-DISC-COST-AMT              06540000
                  ,PADJ_RTV_COST_AMT  = PADJ_RTV_COST_AMT               06550000
                            + :MLT00004-PADJ-RTV-COST-AMT               06560000
                  ,PADJ_RTV_RTL_AMT   = PADJ_RTV_RTL_AMT                06570000
                            + :MLT00004-PADJ-RTV-RTL-AMT                06580000
                  ,PADJ_DA_COST_AMT   = PADJ_DA_COST_AMT                06590000
                            + :MLT00004-PADJ-DA-COST-AMT                06600000
                  ,PADJ_DA_RTL_AMT    = PADJ_DA_RTL_AMT                 06610000
                            + :MLT00004-PADJ-DA-RTL-AMT                 06620000
                  ,PADJ_NET_COST_AMT  = PADJ_NET_COST_AMT               06630000
                            + :MLT00004-PADJ-NET-COST-AMT               06640000
                  ,PADJ_OTH_COST_AMT  = PADJ_OTH_COST_AMT               06650000
                            + :MLT00004-PADJ-OTH-COST-AMT               06660000
                  ,PADJ_OTH_RTL_AMT   = PADJ_OTH_RTL_AMT                06670000
                            + :MLT00004-PADJ-OTH-RTL-AMT                06680000
                  ,DR_ALW_RTL_AMT     = DR_ALW_RTL_AMT                  06690000
                            + :MLT00004-DR-ALW-RTL-AMT                  06700000
                  ,RTV_RTL_AMT        = RTV_RTL_AMT                     06710000
                            + :MLT00004-RTV-RTL-AMT                     06720000
                  ,MKUP_INIT_AMT      = MKUP_INIT_AMT                   06730000
                            + :MLT00004-MKUP-INIT-AMT                   06740000
                  ,MKUP_NET_AMT       = MKUP_NET_AMT                    06750000
                            + :MLT00004-MKUP-NET-AMT                    06760000
                  ,INV_ADJ_RTL_AMT    = INV_ADJ_RTL_AMT                 06770000
                            + :MLT00004-INV-ADJ-RTL-AMT                 06780000
                  ,ONORD_RTL_AMT      = ONORD_RTL_AMT                   06790000
                            + :MLT00004-ONORD-RTL-AMT                   06800000
                  ,ONORD_COST_AMT     = ONORD_COST_AMT                  06810000
                            + :MLT00004-ONORD-COST-AMT                  06820000
                  ,SHNK_RTL_AMT       = SHNK_RTL_AMT                    06830000
                            + :MLT00004-SHNK-RTL-AMT                    06840000
                  ,END_INV_RTL_AMT    = END_INV_RTL_AMT                 06850000
                            + :MLT00004-END-INV-RTL-AMT                 06860000
                  ,END_INV_COST_AMT   = END_INV_COST_AMT                06870000
                            + :MLT00004-END-INV-COST-AMT                06880000
                  ,KNW_THFT_RTL_AMT   = KNW_THFT_RTL_AMT                06881000
                            + :MLT00004-KNW-THFT-RTL-AMT                06882000
                  ,INV_COST_ADJ1_AMT  = INV_COST_ADJ1_AMT               06883000
                            + :MLT00004-INV-COST-ADJ1-AMT               06884000
                  ,INV_COST_ADJ2_AMT  = INV_COST_ADJ2_AMT               06885000
                            + :MLT00004-INV-COST-ADJ2-AMT               06886000
                  ,END_INV_COST1_AMT  = END_INV_COST1_AMT               06887000
                            + :MLT00004-END-INV-COST1-AMT               06888000
                  ,END_INV_COST2_AMT  = END_INV_COST2_AMT               06889000
                            + :MLT00004-END-INV-COST2-AMT               06890000
                  ,ADJ_GRO_MRGN_AMT   = ADJ_GRO_MRGN_AMT                06900000
                            + :MLT00004-ADJ-GRO-MRGN-AMT                06910000
                 WHERE PARTN_NBR       = :MLT00004-PARTN-NBR            06920001
                   AND DEPT_NBR        = :MLT00004-DEPT-NBR             06930000
                   AND MAJ_CL_NBR      = :MLT00004-MAJ-CL-NBR           06940000
                   AND SUB_CL_NBR      = :MLT00004-SUB-CL-NBR           06950000
                   AND LOC_NBR         = :MLT00004-LOC-NBR              06960000
                   AND ML_LO_MDSE_LVL_ID = :PV-SAVE-TO-DKEY-NBR         06970001
           END-EXEC.                                                    06980000
                                                                        06990000
           EVALUATE SQLCODE                                             07000000
               WHEN ZERO                                                07010000
                   ADD 1                      TO PA-UPDATE-COUNT        07020000
                   MOVE PV-SAVE-TO-DKEY-NBR   TO                        07030001
                                           PV-AUDIT-ML-LO-MDSE-LVL-ID   07040000
                   MOVE PC-UPDATE             TO PV-AUDIT-ACTION        07050000
                   PERFORM 8300-WRITE-AUDIT-REC                         07060001
               WHEN OTHER                                               07070000
                    DISPLAY '*************************************'     07080000
                    DISPLAY 'ROW IN PROCESS : '                         07090000
                         ' PARTN: ' MLT00004-PARTN-NBR,                 07100001
                         ' DEPT:  ' MLT00004-DEPT-NBR,                  07110000
                         ' MAJCL: ' MLT00004-MAJ-CL-NBR,                07120000
                         ' SUBCL: ' MLT00004-SUB-CL-NBR,                07130000
                         ' LOC:   ' MLT00004-LOC-NBR,                   07140000
                         ' ML-LWST-ID: ' PV-SAVE-TO-DKEY-NBR            07150001
                    DISPLAY '*************************************'     07160000
                    MOVE '2800-UPDATE-EXISTING-UNK-ROW '                07170000
                                          TO PV-PARAGRAPH-NAME          07180000
                    PERFORM 9999-SQL-ABEND                              07190000
           END-EVALUATE.                                                07200000
                                                                        07210000
                                                                        07220000
      ****************************************************************  07230000
      * 2900-DELETE-OLD-FROM-DKEY-ROW.                                  07240000
      ****************************************************************  07250000
                                                                        07250100
       2900-DELETE-OLD-FROM-DKEY-ROW.                                   07250200
                                                                        07250300
           EXEC SQL                                                     07250400
             DELETE FROM MLT_MNLY_SUM                                   07250500
                 WHERE PARTN_NBR       = :MLT00004-PARTN-NBR            07250600
                   AND DEPT_NBR        = :MLT00004-DEPT-NBR             07250700
                   AND MAJ_CL_NBR      = :MLT00004-MAJ-CL-NBR           07250800
                   AND SUB_CL_NBR      = :MLT00004-SUB-CL-NBR           07250900
                   AND LOC_NBR         = :MLT00004-LOC-NBR              07251000
                   AND ML_LO_MDSE_LVL_ID                                07252000
                                       = :MLT00004-ML-LO-MDSE-LVL-ID    07252100
           END-EXEC.                                                    07252200
                                                                        07252300
           EVALUATE SQLCODE                                             07252400
               WHEN ZERO                                                07252500
                   ADD 1                      TO PA-DELETE-COUNT        07252600
                   MOVE MLT00004-ML-LO-MDSE-LVL-ID  TO                  07252700
                                           PV-AUDIT-ML-LO-MDSE-LVL-ID   07252800
                   MOVE PC-DELETE             TO PV-AUDIT-ACTION        07252900
                   PERFORM 8300-WRITE-AUDIT-REC                         07253001
               WHEN OTHER                                               07253100
                    DISPLAY '*************************************'     07253200
                    DISPLAY 'ROW IN PROCESS : '                         07253300
                         ' PARTN: ' MLT00004-PARTN-NBR,                 07253400
                         ' DEPT:  ' MLT00004-DEPT-NBR,                  07253500
                         ' MAJCL: ' MLT00004-MAJ-CL-NBR,                07253600
                         ' SUBCL: ' MLT00004-SUB-CL-NBR,                07253700
                         ' LOC:   ' MLT00004-LOC-NBR,                   07253800
                         ' ML-LWST-ID: '                                07253900
                                    MLT00004-ML-LO-MDSE-LVL-ID          07254000
                    DISPLAY '*************************************'     07254100
                    MOVE '2900-DELETE-OLD-FROM-DKEY-ROW'                07254200
                                          TO PV-PARAGRAPH-NAME          07254300
                    PERFORM 9999-SQL-ABEND                              07254400
           END-EVALUATE.                                                07254500
                                                                        07254600
                                                                        07254801
      ******************************************************************07254901
      * 8000-READ-CNTL-DTE.                                             07255001
      ******************************************************************07255101
                                                                        07255201
       8000-READ-CNTL-DTE.                                              07255301
           READ CNTL-DATE-FILE INTO CC-CONTROL-CARD                     07255401
               AT END                                                   07255501
                   DISPLAY '** PROGRAM ABEND **'                        07255601
                   DISPLAY 'MLKUP974  - CONTROL DATE EMPTY'             07255701
                   MOVE PC-4005 TO ABEND-CODE                           07255801
                   CALL 'ILBOABN0' USING ABEND-CODE.                    07255901
                                                                        07256001
           DISPLAY '** MLKUP974 CONTROL CARD:' CNTL-DATE-REC.           07256101
                                                                        07256201
           MOVE CC-PROC-DATE-ISO TO PV-PROCESS-DATE.                    07256301
                                                                        07256401
      ****************************************************************  07256500
      * VALIDATE THE PROCESS DATE.                                      07256600
      ****************************************************************  07256700
                                                                        07256800
       8100-GET-PROCESS-DATE-INFO.                                      07256901
                                                                        07257000
           PERFORM                                                      07258000
               WITH TEST AFTER                                          07259000
               VARYING PV-RETRY-COUNTER                                 07260000
               FROM 1 BY 1                                              07270000
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07280000
                         OR (SQLCODE = ZERO)                            07290000
                         OR (SQLCODE = 100))                            07300000
                  EXEC SQL                                              07310000
                      SELECT 'Y'                                        07320000
                        INTO :PV-DB2-DATE-EXISTS                        07330000
                        FROM TDTATTR                                    07340000
                       WHERE KY_DTE          = :PV-PROCESS-DATE         07350004
                       AND   FSCL_MN_END_DTE = :PV-PROCESS-DATE         07360004
                  END-EXEC                                              07370000
                                                                        07380000
                  EVALUATE TRUE                                         07390000
                      WHEN SQLCODE = ZERO                               07400000
                           DISPLAY 'DATE SELECT: '                      07410000
                                  PV-PROCESS-DATE                       07420000
                                  ' SUCCESSFUL'                         07430000
                           CONTINUE                                     07440000
                      WHEN SQLCODE = -904                               07450000
                      WHEN SQLCODE = -913                               07460000
                           CONTINUE                                     07470000
                      WHEN SQLWARN0 NOT = SPACES                        07480000
                      WHEN SQLCODE < ZERO                               07490000
                      WHEN SQLCODE > ZERO                               07500000
                           MOVE '3000-GET-PROCESS-DATE-INFO'            07510000
                                 TO PV-PARAGRAPH-NAME                   07520000
                           PERFORM 9999-SQL-ABEND                       07530000
                  END-EVALUATE                                          07540000
           END-PERFORM.                                                 07550000
                                                                        07560000
           IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         07570000
              DISPLAY 'RETRIES EXCEEDED FOR PROCESS DATE '              07580000
           END-IF.                                                      07590000
                                                                        07600001
      ******************************************************************07610001
      * 8200-READ-FROM-TO-FILE                                          07620001
      ******************************************************************07630001
                                                                        07640001
       8200-READ-FROM-TO-FILE.                                          07650001
                                                                        07651001
           READ FROM-TO-DKEY-FILE INTO PV-FROM-TO-DKEY-REC              07660001
               AT END                                                   07670001
                   SET PS-FROM-TO-FILE-AT-END-YES TO TRUE.              07680001
                                                                        07720001
           IF PS-FROM-TO-FILE-AT-END-NO                                 07730001
               ADD 1 TO PA-INPUT-COUNT                                  07740001
           END-IF.                                                      07750001
                                                                        07780000
      ******************************************************************07790000
      * 8300-WRITE-AUDIT-REC.                                           07800001
      ******************************************************************07810000
                                                                        07820000
       8300-WRITE-AUDIT-REC.                                            07830001
                                                                        07840000
           WRITE AUDIT-REC FROM PV-AUDIT-REC.                           07850000
                                                                        07860000
                                                                        07861000
                                                                        07862000
      ******************************************************************07863000
      *  STANDARD DB2 ERROR ABEND ROUTINE                               07864000
      *  THIS ROUTINE FORCES AN ABEND DUE TO A DB2 PROBLEM.             07865000
      ******************************************************************07866000
       9999-SQL-ABEND.                                                  07867000
                                                                        07868000
           DISPLAY '**  ABEND     **'.                                  07870000
           DISPLAY '**  PROGRAM   **  = ' PC-PGM-NAME.                  07880000
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            07890000
                                                                        07900000
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         07910000
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        07920000
                                                                        07930000
           COPY DPPD004.                                                07940000
                                                                        07950000
           CALL 'ILBOABN0'  USING ABEND-CODE.                           07960000
                                                                        07970000
