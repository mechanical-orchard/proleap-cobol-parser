000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.      EPKUT155.                                       00020000
000300 AUTHOR.          SANDY POTTER.                                   00030000
000400 DATE-WRITTEN.    MARCH 31, 2005.                                 00040000
000500                                                                  00050000
000600*-----------------------------------------------------------      00060000
000700*          EXTRACT PLU GLOBAL PRICE AND STATUS CHANGES            00070000
000800*-----------------------------------------------------------      00080000
000900*  THIS PROGRAM EXTRACTS CHANGE FILE OF PLU DATA FOR THINGS       00090006
001000*  THAT HAVE CHANGED SINCE THE LAST BATCH CYCLE. IT ENCOMPASSES   00100000
001100*  THE PORTION OF EPKUT107 THAT PERTAINED TO GLOBAL PRICE CHANGES 00110000
001200*  ONLY, AS THAT PROGRAM HAS BEEN BROKEN INTO SMALLER PIECES      00120000
001300*  THAT CAN EXECUTE SIMULTANEOUSLY, THUS REDUCING THE CRITAL PATH 00130000
001400*  ON YELLOW AND RED TICKET EVENT DAYS.                           00140000
001500*                                                                 00150000
001600*  PROGRAM READS TWO CONTROL CARDS. ONE CONTROL HAS THE BATCH     00160000
001700*  PROCESSING DATE (GENERALLY TOMORROW'S DATE) AND THE OTHER      00170000
001800*  CONTROL CARD HAS THE LAST BATCH CYCLE TIMESTAMP.               00180000
001900*                                                                 00190000
002000*  THIS PROGRAM WILL USE A CURSOR TO FETCH ALL THE CHANGED        00200000
002100*  SKU INFO AND CREATE A GLOBAL PLU RECORD WITH APPROPRIATE       00210000
002200*  INFORMATION.                                                   00220000
002300*  IT ALSO CREATES A GLOBAL SKU PRICING RECORD FOR SQL SERVER.    00230000
002400*  IT ALSO WRITES OUT A RCP DRIVER RECORD IF APPROPRIATE.         00240000
002500*-----------------------------------------------------------      00250000
002600*    THE FILES AND THEIR ASSOCIATED COPYBOOK/PURPOSE.             00260000
002700*    INP01- CC-TOMORROW                EPWS112                    00270000
002800*    INP02- CC-PREV-TMST               EPWS105                    00280000
002900*    OUT01- RCP-DRIVER-FILE            EPRD122                    00290000
003000*    OUT02- CHG-SKU-PRICG-GLOBAL-FILE  EPRD220                    00300007
003100*                                                                 00310004
003200*--------------------------------------------------------------*  00320004
003300* DATE:  07 JUNE 2011                                             00330006
003400* WR/IR#: PKE#8048                                                00340006
003500* PROGRAMMER: COGNIZANT                                           00350005
003600* DESCRIPTION: CHANGED THE CURSORS (WHICH IDENTIFIES THE          00360005
003700*              CHANGES) TO ALSO CHECK THE LAST UPDATED            00370005
003800*              TIMESTAMP WITH CURRENT EXTRACT RUN TIMESTAMP.      00380005
003900*                                                                 00390004
004000*--------------------------------------------------------------*  00400004
004100*----------------------------------------------------------       00410004
004200 ENVIRONMENT DIVISION.                                            00420000
004300*----------------------------------------------------------       00430000
004400 CONFIGURATION SECTION.                                           00440000
004500 SOURCE-COMPUTER.        IBM-3090.                                00450000
004600 OBJECT-COMPUTER.        IBM-3090.                                00460000
004700                                                                  00470000
004800 INPUT-OUTPUT SECTION.                                            00480000
004900                                                                  00490000
005000 FILE-CONTROL.                                                    00500000
005100                                                                  00510000
005200     SELECT CC-TOMORROW                                           00520000
005300            ASSIGN TO INP01.                                      00530000
005400     SELECT CC-PREV-TMST                                          00540000
005500            ASSIGN TO INP02.                                      00550000
005600     SELECT RCP-DRIVER-FILE                                       00560000
005700            ASSIGN TO OUT01.                                      00570000
005800     SELECT CHG-SKU-PRICG-GLOBAL-FILE                             00580000
005900            ASSIGN TO OUT02.                                      00590007
006000                                                                  00600000
006100 DATA DIVISION.                                                   00610000
006200 FILE SECTION.                                                    00620000
006300                                                                  00630000
006400 FD  CC-TOMORROW                                                  00640000
006500     RECORDING MODE F                                             00650000
006600     BLOCK CONTAINS 0 RECORDS                                     00660000
006700     LABEL RECORDS ARE OMITTED                                    00670000
006800     DATA RECORD IS CC-TOMORROW-RECORD.                           00680000
006900 01  CC-TOMORROW-RECORD              PIC X(80).                   00690000
007000                                                                  00700000
007100 FD  CC-PREV-TMST                                                 00710000
007200     RECORDING MODE F                                             00720000
007300     BLOCK CONTAINS 0 RECORDS                                     00730000
007400     LABEL RECORDS ARE OMITTED                                    00740000
007500     DATA RECORD IS CC-PREV-TMST-RECORD.                          00750000
007600 01  CC-PREV-TMST-RECORD             PIC X(80).                   00760000
007700                                                                  00770000
007800 FD  RCP-DRIVER-FILE                                              00780000
007900     RECORDING MODE F                                             00790000
008000     BLOCK CONTAINS 0 RECORDS                                     00800000
008100     LABEL RECORDS ARE OMITTED                                    00810000
008200     DATA RECORD IS RCP-DRIVER-RECORD.                            00820000
008300 01  RCP-DRIVER-RECORD               PIC X(50).                   00830000
008400                                                                  00840000
008500 FD  CHG-SKU-PRICG-GLOBAL-FILE                                    00850000
008600     RECORDING MODE F                                             00860000
008700     BLOCK CONTAINS 0 RECORDS                                     00870000
008800     LABEL RECORDS ARE OMITTED                                    00880000
008900     DATA RECORD IS CHG-SKU-PRICG-GLOBAL-RCD.                     00890000
009000 01  CHG-SKU-PRICG-GLOBAL-RCD        PIC X(260).                  00900000
009100                                                                  00910000
009200 WORKING-STORAGE SECTION.                                         00920000
009300*-----------------------------------------------------------      00930000
009400* PS- PROGRAM SWITCHES                                            00940000
009500*-----------------------------------------------------------      00950000
009600 01  PS-PROGRAM-SWITCHES.                                         00960000
009700     05  PS-END-OF-INPUT-FILE-SW        PIC X(01) VALUE 'Y'.      00970000
009800         88  PS-END-OF-INPUT-FILE                 VALUE 'N'.      00980000
009900         88  PS-MORE-INPUT-FILE                   VALUE 'Y'.      00990000
010000     05  PS-END-OF-SKUS-CSR-SW          PIC X(01) VALUE 'N'.      01000000
010100         88  PS-END-OF-SKUS-CSR                   VALUE 'Y'.      01010000
010200         88  PS-MORE-SKUS-CSR                     VALUE 'N'.      01020000
010300     05  PS-SKU-LOC-UPDTE-SW            PIC X(01) VALUE 'N'.      01030000
010400         88  PS-NOT-SKU-LOC-UPDTE                 VALUE 'N'.      01040000
010500         88  PS-SKU-LOC-UPDTE                     VALUE 'Y'.      01050000
010600     05  PS-SKU-LOC-ATTR-UPDTE-SW       PIC X(01) VALUE 'N'.      01060000
010700         88  PS-NOT-SKU-LOC-ATTR-UPDTE            VALUE 'N'.      01070000
010800         88  PS-SKU-LOC-ATTR-UPDTE                VALUE 'Y'.      01080000
010900                                                                  01090000
011000*-----------------------------------------------------------      01100000
011100* PC- PROGRAM CONSTANTS                                           01110000
011200*-----------------------------------------------------------      01120000
011300 01  PC-PROGRAM-CONSTANTS.                                        01130000
011400     05  PC-CURRENT-PROGRAM-NAME   PIC X(08)  VALUE 'EPKUT155'.   01140000
011500     05  PC-MAX-RETRIES            PIC S9(04) VALUE +5 COMP.      01150000
011600     05  PC-ACTIVE-STATUS          PIC X(02)  VALUE '20'.         01160000
011700     05  PC-MIXED-STATUS           PIC X(02)  VALUE '25'.         01170000
011800                                                                  01180000
011900     05  PC-STR-GRP-TYP-CDE-CORP   PIC 9(05)  VALUE 1000.         01190000
012000     05  PC-STR-GRP-ID-CORP        PIC 9(10)  VALUE 0000000001.   01200000
012100     05  PC-SQLS-START-TIME        PIC X(08)  VALUE '03:00:00'.   01210000
012200     05  PC-PRIC-EFF-TIME-STD      PIC X(08)  VALUE '03:00:00'.   01220000
012300     05  PC-MDSE-HIER-SKU          PIC X(03)  VALUE 'SKU'.        01230000
012400     05  PC-NULL-CHAR              PIC X(01)  VALUE '~'.          01240000
012500                                                                  01250000
012600*-----------------------------------------------------------      01260000
012700* PV- PROGRAM VARIABLES                                           01270000
012800*-----------------------------------------------------------      01280000
012900 01  PV-PROGRAM-VARAIBLES.                                        01290000
013000     05  PV-START-DATE             PIC X(10)  VALUE SPACES.       01300000
013100     05  PV-SQL-SUB                PIC S9(4)  VALUE +0 COMP.      01310000
013200     05  PV-CONVERT-PLU-KEY        PIC S9(11) VALUE +0 COMP.      01320000
013300     05  PV-CONVERT-PRICE          PIC S9(07)V9(02) VALUE +0.     01330000
013400     05  PV-GP-PRIC-ID             PIC 9(11)  VALUE 0.            01340000
013500     05  PV-GP-PRIC-ID-IND         PIC S9(4)  VALUE +0 COMP.      01350000
013600         88  PV-GP-PRIC-ID-NULL               VALUE -1.           01360000
013700     05  PV-GP-RTL-QTY-IND         PIC S9(4)  VALUE +0 COMP.      01370000
013800         88  PV-GP-RTL-QTY-NULL               VALUE -1.           01380000
013900     05  PV-GP-RTL-AMT-IND         PIC S9(4)  VALUE +0 COMP.      01390000
014000         88  PV-GP-RTL-AMT-NULL               VALUE -1.           01400000
014100                                                                  01410000
014200     05  PV-PRIC-EFF-TMST.                                        01420000
014300         10  PV-PRIC-EFF-DTE               PIC X(10).             01430000
014400         10  FILLER                        PIC X(01) VALUE SPACE. 01440000
014500         10  PV-PRIC-EFF-TIME              PIC X(08).             01450000
014600                                                                  01460000
014700     05  PV-LAST-PRCHG-TMST.                                      01470000
014800         10  PV-LAST-PRCHG-DTE             PIC X(10).             01480000
014900         10  FILLER                        PIC X(01) VALUE SPACE. 01490000
015000         10  PV-LAST-PRCHG-TIME            PIC X(08).             01500000
015100                                                                  01510000
015200*----------------------------------------------------------       01520000
015300*    RCP DRIVER FILE LAYOUT - OUTPUT                              01530000
015400*----------------------------------------------------------       01540000
015500     COPY EPRD122.                                                01550000
015600                                                                  01560000
015700*----------------------------------------------------------       01570000
015800* SKU PRICING STORE FILE LAYOUT - OUTPUT                          01580000
015900*----------------------------------------------------------       01590000
016000     COPY EPRD220.                                                01600000
016100                                                                  01610000
016200*----------------------------------------------------------       01620000
016300* CONTROL CARD LAYOUT FOR TIMESTAMP                               01630000
016400*----------------------------------------------------------       01640000
016500     COPY EPWS105.                                                01650000
016600                                                                  01660000
016700*----------------------------------------------------------       01670000
016800* CONTROL CARD LAYOUT FOR TOMORROW'S DATE                         01680000
016900*----------------------------------------------------------       01690000
017000     COPY EPWS112.                                                01700000
017100                                                                  01710000
017200*-----------------------------------------------------------      01720000
017300* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         01730000
017400*-----------------------------------------------------------      01740000
017500     COPY DPWS004.                                                01750000
017600                                                                  01760000
017700*--------------------------------------------------------------*  01770000
017800* DATE ROUTINE COPY MEMBERS                                       01780000
017900*--------------------------------------------------------------*  01790000
018000     COPY DPWS500.                                                01800000
018100                                                                  01810000
018200*-----------------------------------------------------------      01820000
018300* DB2 ABEND COPYBOOK                                              01830000
018400*-----------------------------------------------------------      01840000
018500     COPY DPWS900.                                                01850000
018600                                                                  01860000
018700*-----------------------------------------------------------      01870000
018800* DB2 MESSAGE AREA                                                01880000
018900*-----------------------------------------------------------      01890000
019000     COPY SQLCA2.                                                 01900000
019100                                                                  01910000
019200*-----------------------------------------------------------      01920000
019300* PROGRAM COUNTERS                                                01930000
019400*-----------------------------------------------------------      01940000
019500 01  PV-PROGRAM-COUNTERS.                                         01950000
019600     05  PV-CNT-SKUS-CSR              PIC 9(09) VALUE 0.          01960000
019700     05  PV-CNT-SKUS-ADDS             PIC 9(09) VALUE 0.          01970000
019800     05  PV-CNT-RCP-RECS              PIC 9(09) VALUE 0.          01980000
019900     05  PV-CNT-SINCE-DISPLAY         PIC 9(09) VALUE 0.          01990000
020000     05  PV-CNT-SKU-PRICG-STR-RECS    PIC 9(09) VALUE 0.          02000000
020100     05  PV-CNT-ALL-RECS              PIC 9(09) VALUE 0.          02010000
020200                                                                  02020000
020300*-----------------------------------------------------------      02030000
020400* ERROR HANDLING                                                  02040000
020500*-----------------------------------------------------------      02050000
020600 01  PV-MISC-ABEND-FIELDS.                                        02060000
020700     05  PV-PARAGRAPH-NAME           PIC X(30) VALUE SPACE.       02070000
020800     05  PV-OPERATION-MSG-1          PIC X(40) VALUE SPACE.       02080000
020900     05  PV-OPERATION-MSG-2          PIC X(40) VALUE SPACE.       02090000
021000     05  PV-DB2-OPERATION            PIC X(30) VALUE SPACE.       02100000
021100 01  ABEND-CODE                      PIC S9(4) VALUE +0 COMP SYNC.02110000
021200     88  ABEND-4003-CTRL-CARD-ERROR            VALUE +4003.       02120000
021300     88  ABEND-4013-DB2-ERROR                  VALUE +4013.       02130000
021400     88  ABEND-4019-CAL-SUB-ERROR              VALUE +4019.       02140000
021500     88  ABEND-4444-FORCED-ABEND               VALUE +4444.       02150000
021600                                                                  02160000
021700*-----------------------------------------------------------      02170000
021800* DB2 COMMUNICATIONS AREA                                         02180000
021900*-----------------------------------------------------------      02190000
022000     EXEC SQL                                                     02200000
022100          INCLUDE SQLCA                                           02210000
022200     END-EXEC.                                                    02220000
022300                                                                  02230000
022400*-----------------------------------------------------------      02240000
022500* DB2 TABLE XST00010(XST_SKU) - SKU TABLE                         02250000
022600*-----------------------------------------------------------      02260000
022700     EXEC SQL                                                     02270000
022800          INCLUDE XST00010                                        02280000
022900     END-EXEC.                                                    02290000
023000                                                                  02300000
023100*-----------------------------------------------------------      02310000
023200* DB2 TABLE XST00011(XST_SKU_ATTR) - SKU ATTRIBUTE TABLE          02320000
023300*-----------------------------------------------------------      02330000
023400     EXEC SQL                                                     02340000
023500          INCLUDE XST00011                                        02350000
023600     END-EXEC.                                                    02360000
023700                                                                  02370000
023800*-----------------------------------------------------------      02380000
023900* DB2 TABLE XST00008(XST_SKU_LOC) - SKU LOCATION TABLE            02390000
024000*-----------------------------------------------------------      02400000
024100     EXEC SQL                                                     02410000
024200          INCLUDE XST00008                                        02420000
024300     END-EXEC.                                                    02430000
024400                                                                  02440000
024500*-----------------------------------------------------------      02450000
024600* DB2 TABLE XST00041(XST_SKU_LOC_ATTR) - SKU LOCATION ATTRIBUTE   02460000
024700*                                               TABLE             02470000
024800*-----------------------------------------------------------      02480000
024900     EXEC SQL                                                     02490000
025000          INCLUDE XST00041                                        02500000
025100     END-EXEC.                                                    02510000
025200                                                                  02520000
025300*-----------------------------------------------------------      02530000
025400*  SKUS-CSR WILL FIND RECORDS RELATED TO A INTR_UPC_ID            02540000
025500*       WHEN EITHER THE SKU_LOC OR SKU_LOC_ATTR HAS BEEN          02550000
025600*       CHANGED SINCE THE TIMESTAMP ON CC105.                     02560000
025700*       FINDS CHANGES TO CORPORATE PRICING ONLY.                  02570000
025800*-----------------------------------------------------------      02580000
025900     EXEC SQL                                                     02590000
026000       DECLARE SKUS-CSR CURSOR FOR                                02600000
026100            SELECT                                                02610000
026200                    A.INTR_UPC_ID                                 02620000
026300                   ,A.SKU_NBR                                     02630000
026400                   ,A.REGN_PRIC_IND                               02640000
026500                   ,A.CRE_TMST                                    02650000
026600                   ,B.UNT_RTL_AMT                                 02660000
026700                   ,B.LOC_SKU_STAT_CDE                            02670000
026800                   ,B.UPC_STAT_CHG_DTE                            02680000
026900                   ,B.GP_PRIC_ID                                  02690000
027000                   ,B.UNT_RTL_CHG_DTE                             02700000
027100                   ,B.GP_RTL_QTY                                  02710000
027200                   ,B.GP_RTL_AMT                                  02720000
027300                   ,B.LAST_UPD_TMST                               02730000
027400                   ,D.LAST_UPD_TMST                               02740000
027500                   ,D.PRMPT_FOR_PRIC_IND                          02750000
027600              FROM  XST_SKU  A                                    02760000
027700                   ,XST_SKU_LOC  B                                02770000
027800                   ,XST_SKU_ATTR  C                               02780000
027900                   ,XST_SKU_LOC_ATTR  D                           02790000
028000             WHERE  A.INTR_UPC_ID     = B.INTR_UPC_ID             02800000
028100               AND  A.INTR_UPC_ID     = C.INTR_UPC_ID             02810000
028200               AND  B.INTR_UPC_ID     = D.INTR_UPC_ID             02820000
028300               AND  B.LOC_NBR         = D.LOC_NBR                 02830000
028400               AND  B.LOC_NBR         = 0                         02840000
028500               AND  B.END_TMST        IS NULL                     02850000
028600               AND  C.PLU_DWNLD_EXCL_IND = 'N'                    02860000
028700               AND  B.LAST_UPD_TMST   >                           02870000
028800                    :CC-EPCC105-PREV-TIMESTAMP                    02880000
028900               AND  B.LAST_UPD_TMST   <=                          02890005
029000                    :CC-EPCC105-CRNT-TIMESTAMP                    02900005
029100         UNION                                                    02910000
029200            SELECT                                                02920000
029300                    A.INTR_UPC_ID                                 02930000
029400                   ,A.SKU_NBR                                     02940000
029500                   ,A.REGN_PRIC_IND                               02950000
029600                   ,A.CRE_TMST                                    02960000
029700                   ,B.UNT_RTL_AMT                                 02970000
029800                   ,B.LOC_SKU_STAT_CDE                            02980000
029900                   ,B.UPC_STAT_CHG_DTE                            02990000
030000                   ,B.GP_PRIC_ID                                  03000000
030100                   ,B.UNT_RTL_CHG_DTE                             03010000
030200                   ,B.GP_RTL_QTY                                  03020000
030300                   ,B.GP_RTL_AMT                                  03030000
030400                   ,B.LAST_UPD_TMST                               03040000
030500                   ,D.LAST_UPD_TMST                               03050000
030600                   ,D.PRMPT_FOR_PRIC_IND                          03060000
030700              FROM  XST_SKU  A                                    03070000
030800                   ,XST_SKU_LOC  B                                03080000
030900                   ,XST_SKU_ATTR  C                               03090000
031000                   ,XST_SKU_LOC_ATTR  D                           03100000
031100             WHERE  A.INTR_UPC_ID     = B.INTR_UPC_ID             03110000
031200               AND  A.INTR_UPC_ID     = C.INTR_UPC_ID             03120000
031300               AND  B.INTR_UPC_ID     = D.INTR_UPC_ID             03130000
031400               AND  B.LOC_NBR         = D.LOC_NBR                 03140000
031500               AND  B.LOC_NBR         = 0                         03150000
031600               AND  B.END_TMST        IS NULL                     03160000
031700               AND  C.PLU_DWNLD_EXCL_IND = 'N'                    03170000
031800               AND  D.LAST_UPD_TMST   >                           03180000
031900                    :CC-EPCC105-PREV-TIMESTAMP                    03190000
032000               AND  D.LAST_UPD_TMST   <=                          03200005
032100                    :CC-EPCC105-CRNT-TIMESTAMP                    03210005
032200           WITH UR                                                03220000
032300     END-EXEC.                                                    03230000
032400                                                                  03240000
032500 LINKAGE SECTION.                                                 03250000
032600                                                                  03260000
032700*----------------------------------------------------------       03270000
032800 PROCEDURE DIVISION.                                              03280000
032900*----------------------------------------------------------       03290000
033000 0000-MAINLINE.                                                   03300000
033100                                                                  03310000
033200     PERFORM 1000-INITIALIZATION.                                 03320000
033300                                                                  03330000
033400     PERFORM 2000-PROCESS-CSR.                                    03340000
033500                                                                  03350000
033600     PERFORM 9999-WRAPUP.                                         03360000
033700                                                                  03370000
033800     GOBACK.                                                      03380000
033900                                                                  03390000
034000*0000-EXIT.                                                       03400000
034100                                                                  03410000
034200*----------------------------------------------------------       03420000
034300* 1000-INITIALIZATION.                                            03430000
034400*     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS      03440000
034500*     FILES AND READS CONTROL RECORDS                             03450000
034600*----------------------------------------------------------       03460000
034700 1000-INITIALIZATION.                                             03470000
034800                                                                  03480000
034900     DISPLAY '***EPKUT155 * 1000-INITIALIZATION'.                 03490000
035000     DISPLAY ' '.                                                 03500000
035100                                                                  03510000
035200     INITIALIZE EP122-RCP-DRIVE-RECORD.                           03520008
035300     INITIALIZE CC-EPCC112-CONTROL-CARD,                          03530000
035400                CC-EPCC105-CONTROL-CARD,                          03540000
035500     SET PS-MORE-INPUT-FILE TO TRUE.                              03550000
035600                                                                  03560000
035700     OPEN INPUT  CC-TOMORROW                                      03570000
035800                 CC-PREV-TMST                                     03580000
035900          OUTPUT RCP-DRIVER-FILE                                  03590000
036000                 CHG-SKU-PRICG-GLOBAL-FILE.                       03600000
036100                                                                  03610000
036200     PERFORM 1200-READ-CC-TOMORROW.                               03620000
036300                                                                  03630000
036400     MOVE CC-EPCC112-TOMORROW-DATE  TO PV-PRIC-EFF-DTE.           03640000
036500     MOVE PC-PRIC-EFF-TIME-STD      TO PV-PRIC-EFF-TIME.          03650000
036600     DISPLAY 'PRIC EFF TMST TO SQLS: ' PV-PRIC-EFF-TMST.          03660000
036700                                                                  03670000
036800     PERFORM 1300-READ-CC-PREV-TMST.                              03680000
036900                                                                  03690000
037000     CLOSE CC-TOMORROW                                            03700000
037100           CC-PREV-TMST.                                          03710000
037200                                                                  03720000
037300*1000-EXIT.                                                       03730000
037400                                                                  03740000
037500*----------------------------------------------------------       03750000
037600* 1200-READ-CC-TOMORROW.                                          03760000
037700*     READ CONTROL CARD 1.  THIS GETS THE FUTURE DATE THAT        03770000
037800*     NEEDS TO BE PROCESSED.                                      03780000
037900*----------------------------------------------------------       03790000
038000 1200-READ-CC-TOMORROW.                                           03800000
038100                                                                  03810000
038200     READ CC-TOMORROW INTO CC-EPCC112-CONTROL-CARD                03820000
038300       AT END                                                     03830000
038400          SET PS-END-OF-INPUT-FILE TO TRUE.                       03840000
038500                                                                  03850000
038600     IF PS-END-OF-INPUT-FILE                                      03860000
038700        DISPLAY 'CONTROL CARD MISSING FOR EPCC112 '               03870000
038800        MOVE '1200-READ-CC-TOMORROW'     TO PV-PARAGRAPH-NAME     03880000
038900        MOVE 'CONTROL CARD 1 IS MISSING' TO PV-OPERATION-MSG-1    03890000
039000        SET ABEND-4003-CTRL-CARD-ERROR   TO TRUE                  03900000
039100        PERFORM 9800-ABEND                                        03910000
039200     END-IF.                                                      03920000
039300                                                                  03930000
039400     IF CC-EPCC112-TOMORROW-DATE =  SPACES                        03940000
039500        DISPLAY 'INVALID CONTROL CARD'                            03950000
039600        DISPLAY '  TOMMORROWS DATE: ' CC-EPCC112-TOMORROW-DATE    03960000
039700        MOVE '1200-READ-CC-TOMORROW'     TO PV-PARAGRAPH-NAME     03970000
039800        MOVE 'CONTROL CARD IS INVALID'   TO PV-OPERATION-MSG-1    03980000
039900        SET ABEND-4003-CTRL-CARD-ERROR   TO TRUE                  03990000
040000        PERFORM 9800-ABEND                                        04000000
040100     END-IF.                                                      04010000
040200                                                                  04020000
040300     DISPLAY '** TOMORROW DATE BASED ON CONTROL CARD **'.         04030000
040400     DISPLAY '   EPCC112 CONTROL CARD: ' CC-EPCC112-CONTROL-CARD. 04040000
040500     DISPLAY ' '.                                                 04050000
040600     MOVE CC-EPCC112-TOMORROW-DATE  TO PV-START-DATE.             04060000
040700                                                                  04070000
040800*1200-EXIT.                                                       04080000
040900                                                                  04090000
041000*----------------------------------------------------------       04100000
041100* 1300-READ-CC-PREV-TMST.                                         04110000
041200*     READ CONTROL CARD 2.  THIS GETS ALL TIMESTAMP WHEN THE      04120000
041300*     EXTRACT PROCESS STARTED THE PREVIOUS DAY.  ALL CHANGES      04130000
041400*     SINCE THAT TIME ARE TO BE EXTRACTED DURING THIS RUN.        04140000
041500*----------------------------------------------------------       04150000
041600 1300-READ-CC-PREV-TMST.                                          04160000
041700                                                                  04170000
041800     READ CC-PREV-TMST INTO CC-EPCC105-CONTROL-CARD               04180000
041900       AT END                                                     04190000
042000          SET PS-END-OF-INPUT-FILE TO TRUE                        04200000
042100     END-READ.                                                    04210000
042200                                                                  04220000
042300     IF PS-END-OF-INPUT-FILE                                      04230000
042400        DISPLAY 'CONTROL CARD MISSING FOR EPCC105 '               04240000
042500        MOVE '1300-READ-CC-PREV-TMST'    TO PV-PARAGRAPH-NAME     04250000
042600        MOVE 'CONTROL CARD 2 IS MISSING' TO PV-OPERATION-MSG-1    04260000
042700        SET ABEND-4003-CTRL-CARD-ERROR   TO TRUE                  04270000
042800        PERFORM 9800-ABEND                                        04280000
042900     END-IF.                                                      04290000
043000                                                                  04300000
043100     DISPLAY '** PREVIOUS RUN TIMESTAMP CONTROL CARD **'.         04310000
043200     DISPLAY '   EPCC105 CONTROL CARD: ' CC-EPCC105-CONTROL-CARD. 04320000
043300     DISPLAY ' '.                                                 04330000
043400                                                                  04340000
043500*1300-EXIT.                                                       04350000
043600                                                                  04360000
043700*----------------------------------------------------------       04370000
043800* 2000-PROCESS-CSR.                                               04380000
043900*     FETCHES THE SKUS CURSOR AND THEN WRITES APPROPRIATE         04390000
044000*     CORPORATE RECORDS.                                          04400000
044100*     FOR REGIONAL PRICED SKUS, AN RCP DRIVER RECORD IS WRITTEN.  04410000
044200*----------------------------------------------------------       04420000
044300 2000-PROCESS-CSR.                                                04430000
044400                                                                  04440000
044500     PERFORM 2100-OPEN-SKUS-CSR.                                  04450000
044600     PERFORM 2350-FETCH-SKUS-CSR.                                 04460000
044700                                                                  04470000
044800     PERFORM 2300-PROCESS-SKUS-CSR                                04480000
044900       UNTIL PS-END-OF-SKUS-CSR.                                  04490000
045000                                                                  04500000
045100     PERFORM 2200-CLOSE-SKUS-CSR.                                 04510000
045200                                                                  04520000
045300*2000-EXIT.                                                       04530000
045400                                                                  04540000
045500*----------------------------------------------------------       04550000
045600* 2100-OPEN-SKUS-CSR.                                             04560000
045700*     OPEN CURSOR OF SKUS WITH A GLOBAL PRICE/STATUS CHANGE.      04570000
045800*----------------------------------------------------------       04580000
045900 2100-OPEN-SKUS-CSR.                                              04590000
046000                                                                  04600000
046100     DISPLAY '** OPENING SKUS CURSOR **'.                         04610000
046200     MOVE 0 TO PV-CNT-SINCE-DISPLAY.                              04620000
046300                                                                  04630000
046400     PERFORM                                                      04640000
046500         WITH TEST AFTER                                          04650000
046600         VARYING PV-SQL-SUB                                       04660000
046700         FROM 1 BY 1                                              04670000
046800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 04680000
046900                   OR  SQLCODE = 0)                               04690000
047000                                                                  04700000
047100           EXEC SQL                                               04710000
047200              OPEN SKUS-CSR                                       04720000
047300           END-EXEC                                               04730000
047400                                                                  04740000
047500         EVALUATE TRUE                                            04750000
047600             WHEN SQLCODE = -904                                  04760000
047700             WHEN SQLCODE = -911                                  04770000
047800             WHEN SQLCODE = -913                                  04780000
047900                  CONTINUE                                        04790000
048000             WHEN SQLCODE = 0                                     04800000
048100                  SET PS-MORE-SKUS-CSR TO TRUE                    04810000
048200             WHEN OTHER                                           04820000
048300                  MOVE '2100-OPEN-SKUS-CSR'                       04830000
048400                                     TO PV-PARAGRAPH-NAME         04840000
048500                  MOVE 'ERROR ON OPEN OF SKU CURSOR'              04850000
048600                                     TO PV-DB2-OPERATION          04860000
048700                  PERFORM 9900-SQL-ABEND-ROUTINE                  04870000
048800         END-EVALUATE                                             04880000
048900     END-PERFORM.                                                 04890000
049000                                                                  04900000
049100     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         04910000
049200        MOVE '2100-OPEN-SKUS-CSR'                                 04920000
049300                             TO  PV-PARAGRAPH-NAME                04930000
049400        MOVE 'OPEN RETRIES EXCEEDED'                              04940000
049500                              TO  PV-DB2-OPERATION                04950000
049600        PERFORM 9900-SQL-ABEND-ROUTINE                            04960000
049700     END-IF.                                                      04970000
049800                                                                  04980000
049900*2100-EXIT.                                                       04990000
050000                                                                  05000000
050100*-----------------------------------------------------------      05010000
050200* 2200-CLOSE-SKUS-CSR.                                            05020000
050300*     CLOSE THE SKUS CURSOR.                                      05030000
050400*-----------------------------------------------------------      05040000
050500 2200-CLOSE-SKUS-CSR.                                             05050000
050600                                                                  05060000
050700     IF PV-CNT-SINCE-DISPLAY > 0                                  05070000
050800        DISPLAY '  >> INTERIM COUNT: ' PV-CNT-SINCE-DISPLAY       05080000
050900        MOVE 0 TO PV-CNT-SINCE-DISPLAY                            05090000
051000     END-IF.                                                      05100000
051100                                                                  05110000
051200     PERFORM                                                      05120000
051300         WITH TEST AFTER                                          05130000
051400         VARYING PV-SQL-SUB                                       05140000
051500         FROM 1 BY 1                                              05150000
051600         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 05160000
051700                   OR  SQLCODE = 0)                               05170000
051800                                                                  05180000
051900           EXEC SQL                                               05190000
052000              CLOSE SKUS-CSR                                      05200000
052100           END-EXEC                                               05210000
052200                                                                  05220000
052300          EVALUATE TRUE                                           05230000
052400             WHEN SQLCODE = -904                                  05240000
052500             WHEN SQLCODE = -911                                  05250000
052600             WHEN SQLCODE = -913                                  05260000
052700                  CONTINUE                                        05270000
052800             WHEN SQLCODE = 0                                     05280000
052900                  CONTINUE                                        05290000
053000             WHEN OTHER                                           05300000
053100                  MOVE '2200-CLOSE-SKUS-CSR'                      05310000
053200                                      TO PV-PARAGRAPH-NAME        05320000
053300                  MOVE 'ERROR ON CLOSE OF SKU CURSOR'             05330000
053400                                      TO PV-DB2-OPERATION         05340000
053500                  PERFORM 9900-SQL-ABEND-ROUTINE                  05350000
053600          END-EVALUATE                                            05360000
053700     END-PERFORM.                                                 05370000
053800                                                                  05380000
053900     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         05390000
054000        MOVE '2200-CLOSE-SKUS-CSR'                                05400000
054100                               TO  PV-PARAGRAPH-NAME              05410000
054200        MOVE 'CLOSE RETRIES EXCEEDED'                             05420000
054300                               TO  PV-DB2-OPERATION               05430000
054400        PERFORM 9900-SQL-ABEND-ROUTINE                            05440000
054500     END-IF.                                                      05450000
054600                                                                  05460000
054700*2200-EXIT.                                                       05470000
054800                                                                  05480000
054900*----------------------------------------------------------       05490000
055000* 2300-PROCESS-SKUS-CSR.                                          05500000
055100*     FETCHES ANY SKUS THAT HAVE HAD CHANGES SINCE THE            05510000
055200*     TIMESTAMP.  WRITES GLOBAL PLU RECORDS AND ANY RCP DRIVER    05520000
055300*     RECORDS.                                                    05530000
055400*     IF SKU WAS CREATED SINCE LAST RUN, BYPASS IT BECAUSE        05540000
055500*     THE SKU EXTRACT PROGRAM WILL GET IT IN NEW SKU LOGIC.       05550000
055600*----------------------------------------------------------       05560000
055700 2300-PROCESS-SKUS-CSR.                                           05570000
055800                                                                  05580000
055900     IF XST00010-CRE-TMST > CC-EPCC105-PREV-TIMESTAMP             05590000
056000        ADD 1 TO PV-CNT-SKUS-ADDS                                 05600000
056100     ELSE                                                         05610000
056200        MOVE XST00010-INTR-UPC-ID TO PV-CONVERT-PLU-KEY           05620000
056300                                                                  05630000
056400        IF XST00010-REGN-PRIC-IND = 'Y'                           05640000
056500           INITIALIZE EP122-RCP-DRIVE-RECORD                      05650000
056600           MOVE PV-CONVERT-PLU-KEY TO EP122-INTERNAL-UPC-ID       05660000
056700           IF XST00041-LAST-UPD-TMST >                            05670000
056800                           CC-EPCC105-PREV-TIMESTAMP              05680000
056900              IF XST00008-LAST-UPD-TMST >                         05690000
057000                           CC-EPCC105-PREV-TIMESTAMP              05700000
057100                 SET EP122-BOTH-OVERRIDE  TO TRUE                 05710000
057200              ELSE                                                05720000
057300                 SET EP122-ATTR-OVERRIDE  TO TRUE                 05730000
057400              END-IF                                              05740000
057500           ELSE                                                   05750000
057600              SET EP122-SKU-LOC-OVERRIDE  TO TRUE                 05760000
057700           END-IF                                                 05770000
057800                                                                  05780000
057900           PERFORM 8000-WRITE-RCP-DRIVER-REC                      05790000
058000        END-IF                                                    05800000
058100                                                                  05810000
058200        IF XST00008-LAST-UPD-TMST > CC-EPCC105-PREV-TIMESTAMP     05820000
058300           SET PS-SKU-LOC-UPDTE TO TRUE                           05830000
058400                                                                  05840000
058500        END-IF                                                    05850000
058600                                                                  05860000
058700        IF XST00041-LAST-UPD-TMST > CC-EPCC105-PREV-TIMESTAMP     05870000
058800           SET PS-SKU-LOC-ATTR-UPDTE TO TRUE                      05880000
058900                                                                  05890000
059000        END-IF                                                    05900000
059100        IF PS-SKU-LOC-ATTR-UPDTE                                  05910000
059200          OR PS-SKU-LOC-UPDTE                                     05920000
059300            PERFORM 4000-BUILD-SQLS-UPDT-RCD                      05930000
059400        END-IF                                                    05940000
059500     END-IF.                                                      05950000
059600                                                                  05960000
059700     PERFORM 2350-FETCH-SKUS-CSR.                                 05970000
059800                                                                  05980000
059900     IF PV-CNT-SINCE-DISPLAY > 999                                05990000
060000        DISPLAY '  >> INTERIM COUNT: ' PV-CNT-SINCE-DISPLAY       06000000
060100        MOVE 0 TO PV-CNT-SINCE-DISPLAY                            06010000
060200     END-IF.                                                      06020000
060300                                                                  06030000
060400*2300-EXIT.                                                       06040000
060500                                                                  06050000
060600*----------------------------------------------------------       06060000
060700* 2350-FETCH-SKUS-CSR.                                            06070000
060800*     FETCH THE SKUS CURSOR.                                      06080000
060900*----------------------------------------------------------       06090000
061000 2350-FETCH-SKUS-CSR.                                             06100000
061100                                                                  06110000
061200     PERFORM                                                      06120000
061300         WITH TEST AFTER                                          06130000
061400         VARYING PV-SQL-SUB                                       06140000
061500         FROM 1 BY 1                                              06150000
061600         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 06160000
061700                   OR  SQLCODE = 0                                06170000
061800                   OR  SQLCODE = +100)                            06180000
061900                                                                  06190000
062000           EXEC SQL                                               06200000
062100              FETCH SKUS-CSR                                      06210000
062200              INTO                                                06220000
062300                    :XST00010-INTR-UPC-ID                         06230000
062400                   ,:XST00010-SKU-NBR                             06240000
062500                   ,:XST00010-REGN-PRIC-IND                       06250000
062600                   ,:XST00010-CRE-TMST                            06260000
062700                   ,:XST00008-UNT-RTL-AMT                         06270000
062800                   ,:XST00008-LOC-SKU-STAT-CDE                    06280000
062900                   ,:XST00008-UPC-STAT-CHG-DTE                    06290000
063000                   ,:XST00008-GP-PRIC-ID  :PV-GP-PRIC-ID-IND      06300000
063100                   ,:XST00008-UNT-RTL-CHG-DTE                     06310000
063200                   ,:XST00008-GP-RTL-QTY  :PV-GP-RTL-QTY-IND      06320000
063300                   ,:XST00008-GP-RTL-AMT  :PV-GP-RTL-AMT-IND      06330000
063400                   ,:XST00008-LAST-UPD-TMST                       06340000
063500                   ,:XST00041-LAST-UPD-TMST                       06350000
063600                   ,:XST00041-PRMPT-FOR-PRIC-IND                  06360000
063700           END-EXEC                                               06370000
063800                                                                  06380000
063900          EVALUATE TRUE                                           06390000
064000             WHEN SQLCODE = -904                                  06400000
064100             WHEN SQLCODE = -911                                  06410000
064200             WHEN SQLCODE = -913                                  06420000
064300                  CONTINUE                                        06430000
064400             WHEN SQLCODE = ZERO                                  06440000
064500                  ADD 1 TO PV-CNT-SKUS-CSR                        06450000
064600                  ADD 1 TO PV-CNT-SINCE-DISPLAY                   06460000
064700             WHEN SQLCODE = +100                                  06470000
064800                  SET PS-END-OF-SKUS-CSR    TO TRUE               06480000
064900             WHEN OTHER                                           06490000
065000                  MOVE '2350-FETCH-SKUS-CSR'                      06500000
065100                                     TO PV-PARAGRAPH-NAME         06510000
065200                  MOVE 'ERROR ON FETCHING SKU CURSOR'             06520000
065300                                     TO PV-DB2-OPERATION          06530000
065400                  DISPLAY 'SQLCODE= ' SQLCODE                     06540000
065500                  PERFORM 9900-SQL-ABEND-ROUTINE                  06550000
065600          END-EVALUATE                                            06560000
065700     END-PERFORM.                                                 06570000
065800                                                                  06580000
065900     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        06590000
066000         MOVE '2350-FETCH-SKUS-CSR'                               06600000
066100                               TO  PV-PARAGRAPH-NAME              06610000
066200         MOVE 'FETCH RETRIES EXCEEDED'                            06620000
066300                               TO  PV-DB2-OPERATION               06630000
066400         PERFORM 9900-SQL-ABEND-ROUTINE                           06640000
066500     END-IF.                                                      06650000
066600                                                                  06660000
066700*2350-EXIT.                                                       06670000
066800                                                                  06680000
066900*--------------------------------------------------------------*  06690000
067000* 4000-BUILD-SQLS-UPDT-RCD.                                       06700000
067100*   POPULATES AND WRITES THE SKU PRICING RECORD FOR SQL SERVER.   06710000
067200*--------------------------------------------------------------*  06720000
067300 4000-BUILD-SQLS-UPDT-RCD.                                        06730000
067400                                                                  06740000
067500     INITIALIZE EP220-XST-SKU-PRICG-RECORD.                       06750000
067600     PERFORM 5000-FORMAT-SKU-PRICG-COMMON.                        06760000
067700                                                                  06770000
067800     IF PS-SKU-LOC-UPDTE                                          06780000
067900        PERFORM 5100-POP-SKU-PRICG-SKULOC-UPDT                    06790000
068000     END-IF.                                                      06800000
068100                                                                  06810000
068200     IF PS-SKU-LOC-ATTR-UPDTE                                     06820000
068300        PERFORM 5200-POP-SKU-PRICG-ATTR-UPDT                      06830000
068400     END-IF.                                                      06840000
068500                                                                  06850000
068600     PERFORM 8200-WRITE-SKU-PRICG-GLBL-REC.                       06860000
068700                                                                  06870000
068800*4000-EXIT.                                                       06880000
068900                                                                  06890000
069000*----------------------------------------------------------       06900000
069100* 5000-FORMAT-SKU-PRICG-COMMON.                                   06910000
069200*     POPULATES SKU PRICING GLOBAL PRICING RECORD HEADER          06920000
069300*     SETS DATA ITEM INCLUSION FLAGS, AND POPULATES COMMON        06930000
069400*----------------------------------------------------------       06940000
069500 5000-FORMAT-SKU-PRICG-COMMON.                                    06950000
069600                                                                  06960000
069700     MOVE CC-EPCC112-TOMORROW-DATE TO EP220-PRICG-EFFECT-DTE.     06970000
069800     MOVE PC-STR-GRP-TYP-CDE-CORP  TO EP220-STR-GRP-TYP-CDE.      06980000
069900     MOVE PC-STR-GRP-ID-CORP       TO EP220-STR-GRP-ID.           06990000
070000                                                                  07000000
070100     SET EP220-FILE-CHANGE         TO TRUE.                       07010000
070200     SET EP220-APPLY-NIGHTLY       TO TRUE.                       07020000
070300     SET EP220-RECORD-UPDATE       TO TRUE.                       07030000
070400                                                                  07040000
070500*   SET DATA ITEM INCLUSION FLAGS AND POPULATE COMMON:            07050000
070600*    SKU-PRICG-ID IS NEVER SENT - POPULATED AT STORE SERVER       07060000
070700*    SET MDSE-HIER-CDE TO 'SKU' FOR ALL CURRENT PRICING RECORDS   07070000
070800*    SEND SKU FOR ALL RECORDS                                     07080000
070900     SET EP220-SKU-PRICG-ID-NO         TO TRUE.                   07090000
071000                                                                  07100000
071100     SET EP220-PRIC-EFF-TMST-YES       TO TRUE.                   07110000
071200     MOVE PV-PRIC-EFF-TMST         TO EP220-PRIC-EFF-TMST.        07120000
071300                                                                  07130000
071400     SET EP220-MDSE-HIER-CDE-YES       TO TRUE.                   07140000
071500     MOVE PC-MDSE-HIER-SKU         TO EP220-MDSE-HIER-CDE.        07150000
071600                                                                  07160000
071700     SET EP220-SKU-NBR-YES             TO TRUE.                   07170000
071800     MOVE XST00010-SKU-NBR         TO EP220-SKU-NBR.              07180000
071900                                                                  07190000
072000*   SET REST OF DATA ITEM INCLUSION FLAGS TO "NO":                07200000
072100     SET EP220-DEPT-NBR-NO             TO TRUE.                   07210000
072200     SET EP220-MAJ-CL-NBR-NO           TO TRUE.                   07220000
072300     SET EP220-SUB-CL-NBR-NO           TO TRUE.                   07230000
072400     SET EP220-STYL-ID-NO              TO TRUE.                   07240000
072500     SET EP220-EXCL-MDSE-IND-NO        TO TRUE.                   07250000
072600     SET EP220-UNT-RTL-AMT-NO          TO TRUE.                   07260000
072700     SET EP220-LAST-NCLR-RTL-AMT-NO    TO TRUE.                   07270000
072800     SET EP220-N-RCPT-RT-RTL-AMT-N     TO TRUE.                   07280000
072900     SET EP220-GP-RTL-AMT-NO           TO TRUE.                   07290000
073000     SET EP220-LO-UNT-RTL-AMT-NO       TO TRUE.                   07300000
073100     SET EP220-HGH-UNT-RTL-AMT-NO      TO TRUE.                   07310000
073200     SET EP220-GP-RTL-QTY-NO           TO TRUE.                   07320000
073300     SET EP220-GP-PRIC-ID-NO           TO TRUE.                   07330000
073400     SET EP220-LOC-SKU-STAT-CDE-NO     TO TRUE.                   07340000
073500     SET EP220-TKT-CLOR-CDE-NO         TO TRUE.                   07350000
073600     SET EP220-LAST-PRCHG-TMST-NO      TO TRUE.                   07360000
073700     SET EP220-PRMPT-FOR-PRIC-IND-NO   TO TRUE.                   07370000
073800     SET EP220-PERM-PRCHG-DIRN-CDE-NO  TO TRUE.                   07380000
073900     SET EP220-MLT-PRPT-IND-NO         TO TRUE.                   07390000
074000     SET EP220-PRCHG-APL-TKT-CLR-CD-N  TO TRUE.                   07400000
074100                                                                  07410000
074200*5000-EXIT.                                                       07420000
074300*----------------------------------------------------------       07430000
074400* 5100-POP-SKU-PRICG-SKULOC-UPDT.                                 07440000
074500*     POPULATES SKU PRICING PRICING DATA ITEMS FOR SKUS           07450000
074600*     UPDATED IN XST_SKU_LOC.                                     07460000
074700*----------------------------------------------------------       07470000
074800 5100-POP-SKU-PRICG-SKULOC-UPDT.                                  07480000
074900                                                                  07490000
075000     SET EP220-UNT-RTL-AMT-YES         TO TRUE.                   07500000
075100     MOVE XST00008-UNT-RTL-AMT     TO PV-CONVERT-PRICE.           07510000
075200     MOVE PV-CONVERT-PRICE         TO EP220-UNT-RTL-AMT.          07520000
075300                                                                  07530000
075400     SET EP220-GP-RTL-AMT-YES          TO TRUE.                   07540000
075500     SET EP220-GP-RTL-QTY-YES          TO TRUE.                   07550000
075600     SET EP220-GP-PRIC-ID-YES          TO TRUE.                   07560000
075700     IF PV-GP-PRIC-ID-NULL                                        07570000
075800        MOVE PC-NULL-CHAR          TO EP220-GP-RTL-AMT-NUL        07580000
075900                                      EP220-GP-RTL-QTY-NUL        07590000
076000                                      EP220-GP-PRIC-ID-NUL        07600000
076100     ELSE                                                         07610000
076200        MOVE XST00008-GP-RTL-AMT   TO PV-CONVERT-PRICE            07620000
076300        MOVE PV-CONVERT-PRICE      TO EP220-GP-RTL-AMT            07630000
076400        MOVE XST00008-GP-RTL-QTY   TO EP220-GP-RTL-QTY            07640000
076500        MOVE XST00008-GP-PRIC-ID   TO PV-GP-PRIC-ID               07650000
076600        MOVE PV-GP-PRIC-ID         TO EP220-GP-PRIC-ID            07660000
076700     END-IF.                                                      07670000
076800                                                                  07680000
076900     SET EP220-LOC-SKU-STAT-CDE-YES    TO TRUE.                   07690000
077000     IF XST00008-LOC-SKU-STAT-CDE = PC-MIXED-STATUS               07700000
077100        MOVE PC-ACTIVE-STATUS      TO EP220-LOC-SKU-STAT-CDE      07710000
077200     ELSE                                                         07720000
077300        MOVE XST00008-LOC-SKU-STAT-CDE TO EP220-LOC-SKU-STAT-CDE  07730000
077400     END-IF.                                                      07740000
077500                                                                  07750000
077600     SET EP220-TKT-CLOR-CDE-YES        TO TRUE.                   07760000
077700     IF XST00008-LOC-SKU-STAT-CDE = '30'                          07770000
077800        MOVE 'Y'                   TO EP220-TKT-CLOR-CDE          07780000
077900     ELSE                                                         07790000
078000        MOVE 'W'                   TO EP220-TKT-CLOR-CDE          07800000
078100     END-IF.                                                      07810000
078200                                                                  07820000
078300     SET EP220-LAST-PRCHG-TMST-YES     TO TRUE.                   07830000
078400     IF XST00008-LOC-SKU-STAT-CDE = '20'                          07840003
078500        IF XST00008-UNT-RTL-CHG-DTE > XST00008-UPC-STAT-CHG-DTE   07850003
078600           MOVE XST00008-UNT-RTL-CHG-DTE  TO PV-LAST-PRCHG-DTE    07860003
078700        ELSE                                                      07870003
078800           MOVE XST00008-UPC-STAT-CHG-DTE TO PV-LAST-PRCHG-DTE    07880003
078900     ELSE                                                         07890003
079000        MOVE XST00008-UNT-RTL-CHG-DTE     TO PV-LAST-PRCHG-DTE    07900003
079100     END-IF.                                                      07910003
079200     MOVE PC-SQLS-START-TIME       TO PV-LAST-PRCHG-TIME.         07920000
079300     MOVE PV-LAST-PRCHG-TMST       TO EP220-LAST-PRCHG-TMST.      07930000
079400                                                                  07940000
079500*5100-EXIT.                                                       07950000
079600*----------------------------------------------------------       07960000
079700* 5200-POP-SKU-PRICG-ATTR-UPDT.                                   07970000
079800*     POPULATES SKU PRICING ATTRIBUTE DATA ITEMS FOR SKUS         07980000
079900*     UPDATED IN XST_SKU_LOC_ATTR.                                07990000
080000*----------------------------------------------------------       08000000
080100 5200-POP-SKU-PRICG-ATTR-UPDT.                                    08010000
080200                                                                  08020000
080300     SET EP220-PRMPT-FOR-PRIC-IND-YES  TO TRUE.                   08030000
080400     MOVE XST00041-PRMPT-FOR-PRIC-IND                             08040000
080500                                   TO EP220-PRMPT-FOR-PRIC-IND.   08050000
080600                                                                  08060000
080700*5200-EXIT.                                                       08070000
080800*----------------------------------------------------------       08080000
080900* 8000-WRITE-RCP-DRIVER-REC.                                      08090000
081000*     WRITES THE RCP DRIVER RECORD OUT                            08100000
081100*----------------------------------------------------------       08110000
081200 8000-WRITE-RCP-DRIVER-REC.                                       08120000
081300                                                                  08130000
081400     WRITE RCP-DRIVER-RECORD                                      08140000
081500      FROM EP122-RCP-DRIVE-RECORD.                                08150000
081600                                                                  08160000
081700     ADD 1 TO PV-CNT-RCP-RECS.                                    08170000
081800                                                                  08180000
081900*8000-EXIT.                                                       08190000
082000                                                                  08200000
082100*----------------------------------------------------------       08210000
082200* 8200-WRITE-SKU-PRICG-GLBL-REC.                                  08220000
082300*     WRITES THE SKU PRICING GLOBAL RECORD OUT TO THE             08230000
082400*     SKU PRICING GLOBAL CHANGE FILE.                             08240000
082500*----------------------------------------------------------       08250000
082600 8200-WRITE-SKU-PRICG-GLBL-REC.                                   08260000
082700                                                                  08270000
082800     WRITE CHG-SKU-PRICG-GLOBAL-RCD                               08280000
082900         FROM EP220-XST-SKU-PRICG-RECORD.                         08290000
083000                                                                  08300000
083100     ADD 1 TO PV-CNT-SKU-PRICG-STR-RECS                           08310000
083200              PV-CNT-ALL-RECS.                                    08320000
083300                                                                  08330000
083400*8200-EXIT.                                                       08340000
083500*----------------------------------------------------------       08350000
083600* 9800-ABEND.                                                     08360000
083700*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  08370000
083800*----------------------------------------------------------       08380000
083900 9800-ABEND.                                                      08390000
084000                                                                  08400000
084100     DISPLAY '** ABEND           **'.                             08410000
084200     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  08420000
084300     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        08430000
084400     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       08440000
084500     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       08450000
084600     CALL 'ILBOABN0' USING ABEND-CODE.                            08460000
084700                                                                  08470000
084800*9800-EXIT.                                                       08480000
084900                                                                  08490000
085000*----------------------------------------------------------       08500000
085100* 9900-SQL-ABEND-ROUTINE.                                         08510000
085200*     SQL ABEND ROUTINE.                                          08520000
085300*----------------------------------------------------------       08530000
085400 9900-SQL-ABEND-ROUTINE.                                          08540000
085500                                                                  08550000
085600     SET ABEND-4013-DB2-ERROR TO TRUE.                            08560000
085700     DISPLAY '** ABEND     **'.                                   08570000
085800     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        08580000
085900     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              08590000
086000     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               08600000
086100                                                                  08610000
086200     COPY DPPD004.                                                08620000
086300     CALL 'ILBOABN0' USING ABEND-CODE.                            08630000
086400                                                                  08640000
086500*9900-EXIT.                                                       08650000
086600                                                                  08660000
086700*----------------------------------------------------------       08670000
086800* 9999-WRAPUP.                                                    08680000
086900*     END OF PROGRAM ROUTINE.  CLOSES ALL FILES AND DISPLAYS      08690000
087000*     ANY DATA FROM THE PROGRAM.                                  08700000
087100*----------------------------------------------------------       08710000
087200 9999-WRAPUP.                                                     08720000
087300                                                                  08730000
087400     CLOSE RCP-DRIVER-FILE                                        08740000
087500           CHG-SKU-PRICG-GLOBAL-FILE.                             08750000
087600                                                                  08760000
087700     DISPLAY ' '.                                                 08770000
087800     DISPLAY '*********************************************'.     08780000
087900     DISPLAY 'PROGRAM NAME: ' PC-CURRENT-PROGRAM-NAME.            08790000
088000     DISPLAY '*********************************************'.     08800000
088100     DISPLAY '        # SKUS CSR ROWS: ' PV-CNT-SKUS-CSR.         08810000
088200     DISPLAY '    # NEW SKUS (BYPASS): ' PV-CNT-SKUS-ADDS.        08820000
088300     DISPLAY '# RCP DRIVER RECS WRITE: ' PV-CNT-RCP-RECS.         08830000
088400     DISPLAY '# GLOBAL SKU PRICG RCDS: '                          08840000
088500                                      PV-CNT-SKU-PRICG-STR-RECS.  08850000
088600     DISPLAY '       # ALL RECS WRITE: ' PV-CNT-ALL-RECS.         08860000
088700     DISPLAY '*********************************************'.     08870000
088800                                                                  08880000
088900*9999-EXIT.                                                       08890000
