000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400                                                                  00040001
000500 PROGRAM-ID.             SUKUT070.                                00050001
000600 AUTHOR.                 LYNN MCADAMS.                            00060001
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070001
000800 DATE-WRITTEN            JUNE, 2002.                              00080001
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100*----------------------------------------------------------------*00110001
001200* THE PROGRAM WILL FIRST FIND THE TIMEZONE, BASED ON THE CONTROL *00120099
001300* CARD THAT IS READ IN. IT WILL THEN FIND WHICH DC'S ARE IN THAT *00130099
001400* TIMEZONE.                                                      *00140099
001500*                                                                *00150099
001600* FROM THERE, IT WILL CREATE 2 OUTPUT EXTRACT FILES AT THE PO,   *00160099
001700* RECEIVER, LINE LEVEL FROM THE PCT_RCVR_LNE_DTL TABLE.  THEN    *00170099
001800* THE DC IS CHECKED TO SEE IF IT IS A MANIFESTING DC.            *00180099
001900*                                                                *00190099
002000* ONE FILE WILL CONTAIN PO, RCVR, LINES WITH A VERIFIED/COMPLETE *00200099
002100* STATUS.  THE SECOND FILE WILL CONTAIN PO, RCVR, LINES NOT      *00210001
002200* VERIFIED/NOT COMPLETE. THE LAYOUT FOR THE OUTPUT FILES IS      *00220046
002300* SURD036.                                                       *00230046
002400*----------------------------------------------------------------*00240001
002500                                                                  00250001
002600***************************************************************** 00260001
002700 ENVIRONMENT DIVISION.                                            00270001
002800***************************************************************** 00280001
002900 INPUT-OUTPUT SECTION.                                            00290001
003000                                                                  00300001
003100 FILE-CONTROL.                                                    00310001
003200                                                                  00320001
003300     SELECT EXTRACT-FILE1 ASSIGN TO OUT01.                        00330007
003400     SELECT EXTRACT-FILE2 ASSIGN TO OUT02.                        00340007
003500                                                                  00350001
003600***************************************************************** 00360001
003700 DATA DIVISION.                                                   00370001
003800***************************************************************** 00380001
003900 FILE SECTION.                                                    00390001
004000*                                                                 00400001
004100*                                                                 00410001
004200 FD  EXTRACT-FILE1                                                00420007
004300     RECORDING MODE IS F                                          00430001
004400     LABEL RECORDS ARE STANDARD                                   00440001
004500     BLOCK CONTAINS 0 RECORDS.                                    00450001
004600 01  EXTRACT-RECORD1             PIC X(300).                      00460056
004700*                                                                 00470001
004800 FD  EXTRACT-FILE2                                                00480007
004900     RECORDING MODE IS F                                          00490003
005000     LABEL RECORDS ARE STANDARD                                   00500003
005100     BLOCK CONTAINS 0 RECORDS.                                    00510003
005200 01  EXTRACT-RECORD2             PIC X(300).                      00520056
005300*                                                                 00530003
005400***************************************************************** 00540001
005500 WORKING-STORAGE SECTION.                                         00550001
005600                                                                  00560001
005700 01  PS-PROGRAM-SWITCHES.                                         00570001
005800     05  PS-EOF-EXTRACT-SW            PIC X(01)  VALUE 'N'.       00580001
005900         88  PS-EOF-EXTRACT-CSR                  VALUE 'Y'.       00590001
006000         88  PS-NOT-EOF-EXTRACT-CSR              VALUE 'N'.       00600001
006100     05  PS-EOF-TKRPRPM-SW            PIC X(01)  VALUE 'N'.       00610099
006200         88  PS-EOF-TKRPRPM-CSR                  VALUE 'Y'.       00620099
006300         88  PS-NOT-EOF-TKRPRPM-CSR              VALUE 'N'.       00630099
006400     05  PS-MANIFEST-DC-SW            PIC X(01)  VALUE 'N'.       00640041
006500         88  PS-MANIFEST-DC-FOUND                VALUE 'Y'.       00650041
006600         88  PS-MANIFEST-DC-NOT-FND              VALUE 'N'.       00660041
006700                                                                  00670099
006800 01  PV-PROGRAM-VARIABLES.                                        00680001
006900     05 PV-EXTRACT-DTE                PIC X(10).                  00690001
007000                                                                  00700099
007100     05 PV-CRE-DATE-TMST              PIC X(10).                  00710001
007200     05 PV-CRE-TIME-TMST              PIC X(8).                   00720001
007300                                                                  00730099
007400     05  PV-SQLCODE                   PIC 9(9)   VALUE ZERO.      00740001
007500                                                                  00750099
007600     05  PV-FETCH-COUNT               PIC S9(09) VALUE ZERO       00760087
007700                                                  COMP SYNC.      00770001
007800     05  PV-WRITE-EXTR1-COUNT         PIC S9(09) VALUE ZERO       00780086
007900                                                  COMP SYNC.      00790001
008000     05  PV-WRITE-EXTR2-COUNT         PIC S9(09) VALUE ZERO       00800086
008100                                                  COMP SYNC.      00810082
008200     05  PV-DISPLAY-FETCH-CNT         PIC ZZZ,ZZZ,ZZ9.            00820086
008300     05  PV-DISPLAY-WRITE-CNT1        PIC ZZZ,ZZZ,ZZ9.            00830086
008400     05  PV-DISPLAY-WRITE-CNT2        PIC ZZZ,ZZZ,ZZ9.            00840086
008500     05  PV-DISPLAY-PO-NBR               PIC 999999999-.          00850099
008600     05  PV-DISPLAY-PO-LINE-NBR          PIC 999999999-.          00860099
008700     05  PV-DISPLAY-RCVR-SEQ-NBR         PIC 999999999-.          00870099
008800                                                                  00880099
008900     05  PV-DB2-CURRENT-TIMESTAMP     PIC X(26)  VALUE SPACE.     00890082
009000     05  PV-DB2-FUNCTION             PIC X(30) VALUE SPACE.       00900099
009100     05  PV-DB2-TABLE-NAME            PIC  X(08) VALUE SPACES.    00910099
009200     05  PV-DB2-TABLE-NAME1           PIC  X(08) VALUE SPACES.    00920099
009300                                                                  00930099
009400     05  PV-BEGIN-TMST.                                           00940099
009500         10   PV-BEGIN-DATE             PIC X(10).                00950099
009600         10   FILLER                    PIC X(01) VALUE '-'.      00960099
009700         10   PV-BEGIN-TIME             PIC X(15).                00970099
009800                                                                  00980099
009900     05  PV-END-TMST.                                             00990099
010000         10   PV-END-DATE               PIC X(10).                01000099
010100         10   FILLER                    PIC X(01) VALUE '-'.      01010099
010200         10   PV-END-TIME               PIC X(15).                01020099
010300                                                                  01030099
010400 01  PV-BEGIN-TIMESTAMP             PIC X(26).                    01040099
010500 01  PV-END-TIMESTAMP               PIC X(26).                    01050099
010600                                                                  01060082
010700 01  DK-DB-KEYS.                                                  01070082
010800     05  DK-OPER-UNT-ID              PIC S9(04) COMP.             01080082
010900     05  DK-PO-NBR                   PIC S9(09) COMP.             01090082
011000     05  DK-REC-SEQ-NBR              PIC S9(09) COMP.             01100082
011100     05  DK-LINE-NBR                 PIC S9(09) COMP.             01110082
011200                                                                  01120082
011300 01 PC-PROGRAM-CONSTANTS.                                         01130099
011400     05 PC-PROGRAM-NAME              PIC X(08)  VALUE 'SUKUT070'. 01140082
011500     05 PC-DEFAULT-TMST              PIC X(26)                    01150082
011600             VALUE '9999-09-09-09.09.09.999999'.                  01160082
011700     05 PC-C                         PIC X(01)  VALUE 'C'.        01170099
011800     05 PC-P                         PIC X(01)  VALUE 'P'.        01180099
011900     05 PC-V                         PIC X(01)  VALUE 'V'.        01190099
012000     05 PC-BEGIN-DATE                PIC X(10).                   01200099
012100     05 PC-BEGIN-TIME                PIC X(15)                    01210099
012200             VALUE '00.00.00.000000'.                             01220099
012300     05 PC-END-DATE                  PIC X(10).                   01230099
012400     05 PC-END-TIME                  PIC X(15)                    01240099
012500             VALUE '23.59.59.999999'.                             01250099
012600                                                                  01260099
012700 01  PV-ABEND-FIELDS.                                             01270099
012800     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         01280099
012900                                                 COMP SYNC.       01290099
013000     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'SUKUT070'.01300099
013100     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01310099
013200     05  PV-ABEND-OPERATION           PIC  X(51) VALUE SPACES.    01320099
013300     05  PV-ABEND-OPERATION1          PIC  X(51) VALUE SPACES.    01330099
013400     05  PV-ABEND-OPERATION2          PIC  X(51) VALUE SPACES.    01340099
013500     05  PV-ABEND-OPERATION3          PIC  X(51) VALUE SPACES.    01350099
013600     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACES.    01360099
013700     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(30) VALUE SPACES.    01370099
013800     05  PV-DISPLAY-SQLCODE           PIC -9(05) VALUE ZEROES.    01380099
013900     05  PV-SQL-RETURN-CD             PIC  999-.                  01390099
014000     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01400099
014100     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01410099
014200     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01420099
014300     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01430099
014400                                                                  01440099
014500 01  CC-CONTROL-CARD.                                             01450099
014600     05  CC-CONSTANT                 PIC  X(07)      VALUE SPACE. 01460099
014700     05  FILLER                      PIC  X(01)      VALUE SPACE. 01470099
014800*    05  CC-DAYS                     PIC  9(03)      VALUE ZERO.  01480099
014900     05  CC-TIME-ZONE                PIC  X(25)      VALUE SPACE. 01490099
015000     05  FILLER                      PIC  X(44)      VALUE SPACE. 01500099
015100                                                                  01510099
015200******************************************************************01520099
015300*  USED FOR DB2 ERROR MESSAGE BUILDING                            01530099
015400******************************************************************01540099
015500     COPY DPWS004.                                                01550099
015600                                                                  01560099
015700*----------------------------------------------------------------*01570099
015800*    ABEND PROCESSING COPYBOOK.                                  *01580099
015900*----------------------------------------------------------------*01590099
016000                                                                  01600099
016100     COPY DPWS013.                                                01610099
016200******************************************************************01620099
016300*   DB2 SQL COMMUNICATION AREA                                    01630099
016400******************************************************************01640099
016500     EXEC SQL                                                     01650099
016600          INCLUDE SQLCA                                           01660099
016700     END-EXEC.                                                    01670099
016800                                                                  01680099
016900*DB2 AREA FOR COMMUNICATIONS AREA2                                01690099
017000     COPY SQLCA2.                                                 01700099
017100******************************************************************01710099
017200*   DB2 DCLGEN FOR PC - RECEIVER LINE DETAIL TABLE                01720099
017300*   PCT_RCVR_LNE_DTL                                              01730099
017400******************************************************************01740099
017500     EXEC SQL                                                     01750099
017600          INCLUDE PCT00007                                        01760099
017700     END-EXEC.                                                    01770099
017800                                                                  01780099
017900******************************************************************01790099
018000*   DB2 DCLGEN FOR PO-PURCHASE TABLE                              01800099
018100******************************************************************01810099
018200     EXEC SQL                                                     01820099
018300          INCLUDE TPURCHS                                         01830099
018400     END-EXEC.                                                    01840099
018500                                                                  01850099
018600******************************************************************01860099
018700*   DB2 DCLGEN FOR RC-RECEIPT ITEM TABLE                          01870099
018800******************************************************************01880099
018900     EXEC SQL                                                     01890099
019000          INCLUDE TRECITM                                         01900099
019100     END-EXEC.                                                    01910099
019200                                                                  01920099
019300******************************************************************01930099
019400*   DB2 DCLGEN FOR RC-RECEIVER TABLE                              01940099
019500******************************************************************01950099
019600     EXEC SQL                                                     01960099
019700          INCLUDE TRECEIV                                         01970099
019800     END-EXEC.                                                    01980099
019900                                                                  01990099
020000******************************************************************02000099
020100*   DB2 DCLGEN FOR DC-DISTRIBUTION TRANSACTION HEADER TABLE       02010099
020200******************************************************************02020099
020300     EXEC SQL                                                     02030099
020400          INCLUDE TDISTHD                                         02040099
020500     END-EXEC.                                                    02050099
020600                                                                  02060099
020700******************************************************************02070099
020800*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE PARM TABLE TO     02080099
020900*   CHECK IF DC IS MANIFESTING                                    02090099
021000******************************************************************02100099
021100     EXEC SQL                                                     02110099
021200          INCLUDE TKRPRPM                                         02120099
021300     END-EXEC.                                                    02130099
021400                                                                  02140099
021500******************************************************************02150099
021600*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE LOGISTICS          02160099
021700*  LOCATION TABLE                                                 02170099
021800******************************************************************02180099
021900* XLT_LOC                                                         02190099
022000     EXEC SQL                                                     02200099
022100          INCLUDE XLT00010                                        02210099
022200     END-EXEC.                                                    02220099
022300                                                                  02230099
022400******************************************************************02240099
022500*   DB2 DCLGEN FOR COMPANY CONTROL TABLE                          02250099
022600******************************************************************02260099
022700     EXEC SQL                                                     02270099
022800          INCLUDE TCOCNTL                                         02280099
022900     END-EXEC.                                                    02290099
023000                                                                  02300099
023100                                                                  02310099
023200******************************************************************02320099
023300*   DB2 DCLGEN FOR PC-WORK ORDER INSTRUCTION TABLE                02330099
023400******************************************************************02340099
023500     EXEC SQL                                                     02350099
023600          INCLUDE TWKORIN                                         02360099
023700     END-EXEC.                                                    02370099
023800                                                                  02380099
023900                                                                  02390099
024000******************************************************************02400099
024100* EXTRACT CURSOR                                                 *02410099
024200******************************************************************02420099
024300     EXEC SQL                                                     02430099
024400          DECLARE EXTRACT-CSR CURSOR FOR                          02440099
024500          SELECT A.PO_NBR                                         02450099
024600               , A.RCVR_SEQ_NBR                                   02460099
024700               , A.PO_LNE_NBR                                     02470099
024800               , A.ACTN_CDE                                       02480099
024900               , CURRENT TIMESTAMP                                02490099
025000               , B.REC_TYP_CDE                                    02500099
025100            FROM PCT_RCVR_LNE_DTL A                               02510099
025200               , TRECEIV          B                               02520099
025300           WHERE A.OPER_UNT_ID     = :DK-OPER-UNT-ID              02530099
025400             AND A.PO_NBR          = B.ORD_NBR                    02540099
025500             AND A.RCVR_SEQ_NBR    = B.REC_SEQ_NBR                02550099
025600             AND A.WRKD_UNT_TMST  >= :PV-BEGIN-TIMESTAMP          02560099
025700             AND A.WRKD_UNT_TMST  <= :PV-END-TIMESTAMP            02570099
025800             AND A.ACTN_CDE IN ('C','P','V')                      02580099
025900             AND NOT B.REC_TYP_CDE IN ('AP', 'CD')                02590099
026000             WITH UR                                              02600099
026100     END-EXEC.                                                    02610099
026200                                                                  02620099
026300******************************************************************02630099
026400*  TKRPRPM CURSOR - GET DC'S IN TIMEZONE                         *02640099
026500******************************************************************02650099
026600     EXEC SQL                                                     02660099
026700          DECLARE TKRPRPM_CSR CURSOR FOR                          02670099
026800            SELECT A.LOC_NBR,                                     02680099
026900                   A.OPN_DTE,                                     02690099
027000                   A.CLO_DTE                                      02700099
027100            FROM   XLT_LOC A,                                     02710099
027200                   TKRPRPM B                                      02720099
027300            WHERE  A.LOC_TYP_CDE      = 'DC'                      02730099
027400              AND  A.LOC_NBR          = B.LOC_ID                  02740099
027500              AND  B.SYS_PRC_FUNC_CDE = 'STATZN'                  02750099
027600              AND  B.INTFC_SYS_CDE    = 'KHL'                     02760099
027700              AND  B.FUNC_TXT         = :CC-TIME-ZONE             02770099
027800            ORDER BY 1                                            02780099
027900            WITH UR                                               02790099
028000     END-EXEC.                                                    02800099
028100***********************************************************       02810099
028200*  RECORD LAYOUT FOR THE CARTON EXCEPTION EXTRACT FILE            02820099
028300***********************************************************       02830099
028400     COPY SURD036.                                                02840099
028500                                                                  02850099
028600 EJECT                                                            02860099
028700***********************************************************       02870099
028800 PROCEDURE DIVISION.                                              02880099
028900***********************************************************       02890099
029000*    DISPLAY '***BEGINNING SUKUT070***'.                          02900099
029100                                                                  02910099
029200     PERFORM 1000-INITIALIZE.                                     02920099
029300                                                                  02930099
029400     PERFORM 2000-PROCESS-EXTRACTS                                02940099
029500*        UNTIL PS-EOF-EXTRACT-CSR.                                02950099
029600         UNTIL PS-EOF-TKRPRPM-CSR.                                02960099
029700                                                                  02970099
029800     PERFORM 3530-CLOSE-TKRPRPM-CSR.                              02980099
029900                                                                  02990099
030000     PERFORM 9000-CLOSE-FILES                                     03000099
030100                                                                  03010099
030200                                                                  03020099
030300     GOBACK.                                                      03030099
030400                                                                  03040099
030500                                                                  03050099
030600******************************************************************03060099
030700*  DO FIRST TIME PROGRAM INITIALIZE TASKS.                        03070099
030800 1000-INITIALIZE.                                                 03080099
030900******************************************************************03090099
031000     OPEN OUTPUT EXTRACT-FILE1                                    03100099
031100          OUTPUT EXTRACT-FILE2.                                   03110099
031200                                                                  03120099
031300     INITIALIZE SU036-RECORD.                                     03130099
031400                                                                  03140099
031500     ACCEPT CC-CONTROL-CARD FROM SYSIN                            03150099
031600         DISPLAY '** TIMEZONE = ' CC-TIME-ZONE                    03160099
031700                                                                  03170099
031800*FIRST FETCH                                                      03180099
031900     SET PS-NOT-EOF-TKRPRPM-CSR TO TRUE                           03190099
032000     PERFORM 3510-OPEN-TKRPRPM-CSR                                03200099
032100     PERFORM 3520-FETCH-TKRPRPM-CSR                               03210099
032200                                                                  03220099
032300     IF SQLCODE = +0                                              03230099
032400        PERFORM 2150-CHECK-IF-MFST-DC                             03240099
032500     ELSE                                                         03250099
032600        SET PS-MANIFEST-DC-NOT-FND TO TRUE                        03260099
032700     END-IF                                                       03270099
032800                                                                  03280099
032900     IF PS-MANIFEST-DC-FOUND                                      03290099
033000        PERFORM 1800-GET-BEG-END-DATES                            03300099
033100                                                                  03310099
033200        PERFORM 1850-GET-2-DAY-TMST                               03320099
033300                                                                  03330099
033400*FIRST FETCH                                                      03340099
033500        SET PS-NOT-EOF-EXTRACT-CSR TO TRUE                        03350099
033600        PERFORM 1910-OPEN-EXTRACT-CURSOR                          03360099
033700        PERFORM 1920-FETCH-EXTRACT-CSR                            03370099
033800           UNTIL PS-EOF-EXTRACT-CSR                               03380099
033900        PERFORM 1930-CLOSE-EXTRACT-CSR                            03390099
034000     ELSE                                                         03400099
034100        CONTINUE                                                  03410099
034200     END-IF.                                                      03420099
034300                                                                  03430099
034400                                                                  03440099
034500******************************************************************03450099
034600 1800-GET-BEG-END-DATES.                                          03460099
034700******************************************************************03470099
034800     EXEC SQL                                                     03480099
034900          SELECT BTCH_PRC_DTE                                     03490099
035000               , DATE(BTCH_PRC_DTE + 1 DAYS)                      03500099
035100          INTO  :PC-BEGIN-DATE                                    03510099
035200               ,:PC-END-DATE                                      03520099
035300          FROM   TCOCNTL                                          03530099
035400          WHERE  OPER_UNT_ID = 90                                 03540099
035500     END-EXEC.                                                    03550099
035600                                                                  03560099
035700     EVALUATE TRUE                                                03570099
035800         WHEN SQLCODE = ZERO                                      03580099
035900             CONTINUE                                             03590099
036000         WHEN SQLCODE = +100                                      03600099
036100             CONTINUE                                             03610099
036200         WHEN SQLWARN0 NOT = SPACES                               03620099
036300         WHEN SQLCODE < ZERO                                      03630099
036400         WHEN SQLCODE > ZERO                                      03640099
036500             MOVE '1800-GET-BEG-END-DATES'                        03650099
036600                 TO PV-PARAGRAPH-NAME                             03660099
036700             MOVE 'SELECT OF TCOCNTL TABLE'                       03670099
036800                 TO PV-DB2-OPERATION-ATTEMPTED                    03680099
036900             PERFORM Z999-SQL-ABEND                               03690099
037000     END-EVALUATE.                                                03700099
037100                                                                  03710099
037200***************************************************************** 03720099
037300 1850-GET-2-DAY-TMST.                                             03730099
037400***************************************************************** 03740099
037500     MOVE PC-BEGIN-DATE TO PV-BEGIN-DATE                          03750099
037600     MOVE PC-BEGIN-TIME TO PV-BEGIN-TIME                          03760099
037700     MOVE PV-BEGIN-TMST TO PV-BEGIN-TIMESTAMP.                    03770099
037800                                                                  03780099
037900     MOVE PC-END-DATE   TO PV-END-DATE                            03790099
038000     MOVE PC-END-TIME   TO PV-END-TIME.                           03800099
038100     MOVE PV-END-TMST   TO PV-END-TIMESTAMP.                      03810099
038200                                                                  03820099
038300                                                                  03830099
038400***************************************************************** 03840099
038500 1910-OPEN-EXTRACT-CURSOR.                                        03850099
038600***************************************************************** 03860099
038700                                                                  03870099
038800     EXEC SQL                                                     03880099
038900         OPEN EXTRACT-CSR                                         03890099
039000     END-EXEC.                                                    03900099
039100                                                                  03910099
039200     EVALUATE TRUE                                                03920099
039300         WHEN SQLCODE = +0                                        03930099
039400             CONTINUE                                             03940099
039500         WHEN SQLWARN0 NOT = SPACE                                03950099
039600         WHEN SQLCODE  NOT = +0                                   03960099
039700             MOVE '1910-OPEN-EXTRACT-CURSOR'                      03970099
039800                                 TO PV-ABEND-PARAGRAPH            03980099
039900             PERFORM Z999-SQL-ABEND                               03990099
040000     END-EVALUATE.                                                04000099
040100                                                                  04010099
040200                                                                  04020099
040300***************************************************************** 04030099
040400* GET ROWS WHERE DATE IS > CURRENT DATE MINUS 1 DAY               04040099
040500* AND ACTION CODE = 'C','P'OR'V'                                  04050099
040600 1920-FETCH-EXTRACT-CSR.                                          04060099
040700***************************************************************** 04070099
040800     MOVE '1920-FETCH-EXTRACT-CSR  ' TO PV-ABEND-PARAGRAPH.       04080099
040900                                                                  04090099
041000     EXEC SQL                                                     04100099
041100          FETCH EXTRACT-CSR                                       04110099
041200           INTO  :PCT00007-PO-NBR                                 04120099
041300               , :PCT00007-RCVR-SEQ-NBR                           04130099
041400               , :PCT00007-PO-LNE-NBR                             04140099
041500               , :PCT00007-ACTN-CDE                               04150099
041600               , :PV-DB2-CURRENT-TIMESTAMP                        04160099
041700               , :RECEIV-REC-TYP-CDE                              04170099
041800     END-EXEC.                                                    04180099
041900                                                                  04190099
042000     EVALUATE TRUE                                                04200099
042100         WHEN SQLCODE = +0                                        04210099
042200              ADD +1 TO PV-FETCH-COUNT                            04220099
042300              PERFORM 2300-SELECT-TRECITM                         04230099
042400         WHEN SQLCODE = +100                                      04240099
042500              SET PS-EOF-EXTRACT-CSR TO TRUE                      04250099
042600         WHEN SQLWARN0 NOT = SPACE                                04260099
042700         WHEN SQLCODE  NOT = +0                                   04270099
042800              MOVE '1920-FETCH-EXTRACT-CSR'                       04280099
042900                                   TO PV-ABEND-PARAGRAPH          04290099
043000              MOVE 'ATTEMPTING TO FETCH EXTRACT CURSOR'           04300099
043100                                   TO PV-ABEND-OPERATION          04310099
043200              MOVE PCT00007-PO-NBR     TO PV-DISPLAY-PO-NBR       04320099
043300              STRING 'PO NBR: '         DELIMITED BY SIZE         04330099
043400                  PV-DISPLAY-PO-NBR     DELIMITED BY SIZE         04340099
043500                            INTO PV-ABEND-OPERATION1              04350099
043600              MOVE PCT00007-RCVR-SEQ-NBR                          04360099
043700                              TO PV-DISPLAY-RCVR-SEQ-NBR          04370099
043800              STRING 'RECV SEQ: '       DELIMITED BY SIZE         04380099
043900                  PV-DISPLAY-RCVR-SEQ-NBR                         04390099
044000                                        DELIMITED BY SIZE         04400099
044100                            INTO PV-ABEND-OPERATION2              04410099
044200              MOVE PCT00007-PO-LNE-NBR TO PV-DISPLAY-PO-LINE-NBR  04420099
044300              STRING 'PO LINE NBR: '    DELIMITED BY SIZE         04430099
044400                 PV-DISPLAY-PO-LINE-NBR DELIMITED BY SIZE         04440099
044500                            INTO PV-ABEND-OPERATION3              04450099
044600              PERFORM Z999-SQL-ABEND                              04460099
044700     END-EVALUATE.                                                04470099
044800                                                                  04480099
044900                                                                  04490099
045000***************************************************************** 04500099
045100 1930-CLOSE-EXTRACT-CSR.                                          04510099
045200***************************************************************** 04520099
045300                                                                  04530099
045400     EXEC SQL                                                     04540099
045500         CLOSE EXTRACT-CSR                                        04550099
045600     END-EXEC                                                     04560099
045700                                                                  04570099
045800                                                                  04580099
045900     EVALUATE TRUE                                                04590099
046000         WHEN SQLCODE = ZERO                                      04600099
046100             CONTINUE                                             04610099
046200         WHEN OTHER                                               04620099
046300             PERFORM Z999-SQL-ABEND                               04630099
046400     END-EVALUATE.                                                04640099
046500                                                                  04650099
046600                                                                  04660099
046700***************************************************************** 04670099
046800 2000-PROCESS-EXTRACTS.                                           04680099
046900***************************************************************** 04690099
047000     MOVE '2000-PROCESS-EXTRACTS   ' TO PV-ABEND-PARAGRAPH.       04700099
047100*NEXT FETCH                                                       04710099
047200     PERFORM 3520-FETCH-TKRPRPM-CSR                               04720099
047300     IF SQLCODE = +0                                              04730099
047400        PERFORM 2150-CHECK-IF-MFST-DC                             04740099
047500     ELSE                                                         04750099
047600        SET PS-MANIFEST-DC-NOT-FND TO TRUE                        04760099
047700     END-IF                                                       04770099
047800                                                                  04780099
047900     IF PS-MANIFEST-DC-FOUND                                      04790099
048000        PERFORM 1800-GET-BEG-END-DATES                            04800099
048100                                                                  04810099
048200        PERFORM 1850-GET-2-DAY-TMST                               04820099
048300                                                                  04830099
048400        SET PS-NOT-EOF-EXTRACT-CSR TO TRUE                        04840099
048500                                                                  04850099
048600        PERFORM 1910-OPEN-EXTRACT-CURSOR                          04860099
048700        PERFORM 1920-FETCH-EXTRACT-CSR                            04870099
048800           UNTIL PS-EOF-EXTRACT-CSR                               04880099
048900        PERFORM 1930-CLOSE-EXTRACT-CSR                            04890099
049000     ELSE                                                         04900099
049100        CONTINUE                                                  04910099
049200     END-IF.                                                      04920099
049300                                                                  04930099
049400                                                                  04940099
049500***************************************************************** 04950099
049600*CHECK TO SEE IF CARTON WAS CREATED AT MANIFESTING DC             04960099
049700 2150-CHECK-IF-MFST-DC.                                           04970099
049800***************************************************************** 04980099
049900                                                                  04990099
050000     MOVE XLT00010-LOC-NBR TO DK-OPER-UNT-ID                      05000099
050100                                                                  05010099
050200     EXEC SQL                                                     05020099
050300          SELECT FUNC_END_TMST                                    05030099
050400               , FUNC_TXT                                         05040099
050500          INTO  :KRPRPM-FUNC-END-TMST                             05050099
050600               ,:KRPRPM-FUNC-TXT                                  05060099
050700          FROM   TKRPRPM                                          05070099
050800          WHERE  SYS_PRC_FUNC_CDE  = 'DCMFST'                     05080099
050900            AND  LOC_ID            = :DK-OPER-UNT-ID              05090099
051000            AND  INTFC_SYS_CDE     = 'KHL'                        05100099
051100            AND  FUNC_PRC_STAT_CDE = 'AC'                         05110099
051200            AND  FUNC_TXT          = 'Y'                          05120099
051300            WITH UR                                               05130099
051400     END-EXEC.                                                    05140099
051500                                                                  05150099
051600     EVALUATE TRUE                                                05160099
051700         WHEN SQLCODE = ZERO                                      05170099
051800             SET PS-MANIFEST-DC-FOUND  TO TRUE                    05180099
051900         WHEN SQLCODE = +100                                      05190099
052000             SET PS-MANIFEST-DC-NOT-FND TO TRUE                   05200099
052100         WHEN SQLWARN0 NOT = SPACES                               05210099
052200         WHEN SQLCODE < ZERO                                      05220099
052300         WHEN SQLCODE > ZERO                                      05230099
052400             MOVE '2150-CHECK-IF-MFST-DC'                         05240099
052500                 TO PV-PARAGRAPH-NAME                             05250099
052600             MOVE 'SELECT OF TKRPRPM TABLE'                       05260099
052700                 TO PV-DB2-OPERATION-ATTEMPTED                    05270099
052800             PERFORM Z999-SQL-ABEND                               05280099
052900     END-EVALUATE.                                                05290099
053000                                                                  05300099
053100***************************************************************** 05310099
053200 2200-LOAD-EXTRACT-RECORD.                                        05320099
053300***************************************************************** 05330099
053400     MOVE '2200-LOAD-EXTRACT-RCD   ' TO PV-ABEND-PARAGRAPH.       05340099
053500                                                                  05350099
053600     MOVE XLT00010-LOC-NBR         TO SU036-OPER-UNT-ID.          05360099
053700     MOVE PCT00007-PO-NBR          TO SU036-PO-NUMBER.            05370099
053800     MOVE PCT00007-RCVR-SEQ-NBR    TO SU036-REC-SEQ-NBR.          05380099
053900     MOVE PCT00007-PO-LNE-NBR      TO SU036-LINE-NBR.             05390099
054000     MOVE RECITM-STATUS-CDE        TO SU036-LINE-STATUS.          05400099
054100     MOVE PURCHS-SEASET-SHRT-NM    TO SU036-SEASONAL-NAME.        05410099
054200                                                                  05420099
054300     IF RECITM-STATUS-CDE = 'VE'                                  05430099
054400       MOVE RECITM-VERFYD-TMST                                    05440099
054500            TO SU036-TMST-LINE-VERIFIED                           05450099
054600     ELSE                                                         05460099
054700       MOVE WKORIN-STOP-TMST                                      05470099
054800            TO SU036-TMST-LINE-VERIFIED                           05480099
054900     END-IF.                                                      05490099
055000                                                                  05500099
055100     MOVE DISTHD-FCSE-CNFRMN-TMST  TO SU036-TMST-LINE-CONFIRMED.  05510099
055200     MOVE DISTHD-RSLTS-RCVD-TMST   TO SU036-TMST-LINE-P2L-UPLD.   05520099
055300     MOVE PV-DB2-CURRENT-TIMESTAMP TO SU036-TMST-CREATED.         05530099
055400                                                                  05540099
055500                                                                  05550099
055600***************************************************************** 05560099
055700*GET STATUS CODE FOR PO LINES                                     05570099
055800 2300-SELECT-TRECITM.                                             05580099
055900***************************************************************** 05590099
056000     MOVE XLT00010-LOC-NBR      TO DK-OPER-UNT-ID                 05600099
056100     MOVE PCT00007-PO-NBR       TO DK-PO-NBR                      05610099
056200     MOVE PCT00007-RCVR-SEQ-NBR TO DK-REC-SEQ-NBR                 05620099
056300     MOVE PCT00007-PO-LNE-NBR   TO DK-LINE-NBR                    05630099
056400                                                                  05640099
056500     EXEC SQL                                                     05650099
056600          SELECT ORD_NBR                                          05660099
056700               , ORD_LNE_NBR                                      05670099
056800               , REC_SEQ_NBR                                      05680099
056900               , STATUS_CDE                                       05690099
057000               , VERFYD_TMST                                      05700099
057100            INTO  :RECITM-ORD-NBR                                 05710099
057200                 ,:RECITM-ORD-LNE-NBR                             05720099
057300                 ,:RECITM-REC-SEQ-NBR                             05730099
057400                 ,:RECITM-STATUS-CDE                              05740099
057500                 ,:RECITM-VERFYD-TMST                             05750099
057600            FROM TRECITM                                          05760099
057700           WHERE OPER_UNT_ID    = :DK-OPER-UNT-ID                 05770099
057800             AND ORD_NBR        = :DK-PO-NBR                      05780099
057900             AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                 05790099
058000             AND ORD_LNE_NBR    = :DK-LINE-NBR                    05800099
058100             AND VER_STATUS_CDE = 'A'                             05810099
058200             WITH UR                                              05820099
058300     END-EXEC.                                                    05830099
058400                                                                  05840099
058500     EVALUATE TRUE                                                05850099
058600         WHEN SQLCODE = +0                                        05860099
058700              IF RECITM-STATUS-CDE = 'IP'                         05870099
058800                 PERFORM 2350-SELECT-TRECEIV                      05880099
058900              ELSE                                                05890099
059000                 PERFORM 2360-SELECT-TPURCHS                      05900099
059100                 PERFORM 2370-SELECT-TDISTHD                      05910099
059200                 PERFORM 2200-LOAD-EXTRACT-RECORD                 05920099
059300                 ADD +1 TO PV-WRITE-EXTR1-COUNT                   05930099
059400                 PERFORM 8000-WRITE-EXTRACT1                      05940099
059500              END-IF                                              05950099
059600         WHEN SQLCODE = +100                                      05960099
059700              CONTINUE                                            05970099
059800         WHEN SQLWARN0 NOT = SPACE                                05980099
059900         WHEN SQLCODE  NOT = +0                                   05990099
060000              MOVE '2300-SELECT-TRECITM'                          06000099
060100                                   TO PV-ABEND-PARAGRAPH          06010099
060200              MOVE 'ATTEMPTING TO SELECT TRECITM'                 06020099
060300                                   TO PV-ABEND-OPERATION          06030099
060400              MOVE RECITM-ORD-NBR      TO PV-DISPLAY-PO-NBR       06040099
060500              STRING 'PO NBR: '         DELIMITED BY SIZE         06050099
060600                  PV-DISPLAY-PO-NBR     DELIMITED BY SIZE         06060099
060700                            INTO PV-ABEND-OPERATION1              06070099
060800              MOVE RECITM-REC-SEQ-NBR                             06080099
060900                              TO PV-DISPLAY-RCVR-SEQ-NBR          06090099
061000              STRING 'RECV SEQ: '       DELIMITED BY SIZE         06100099
061100                  PV-DISPLAY-RCVR-SEQ-NBR                         06110099
061200                                        DELIMITED BY SIZE         06120099
061300                            INTO PV-ABEND-OPERATION2              06130099
061400              MOVE RECITM-ORD-LNE-NBR  TO PV-DISPLAY-PO-LINE-NBR  06140099
061500              STRING 'PO LINE NBR: '    DELIMITED BY SIZE         06150099
061600                 PV-DISPLAY-PO-LINE-NBR DELIMITED BY SIZE         06160099
061700                            INTO PV-ABEND-OPERATION3              06170099
061800              PERFORM Z999-SQL-ABEND                              06180099
061900     END-EVALUATE.                                                06190099
062000                                                                  06200099
062100                                                                  06210099
062200***************************************************************** 06220099
062300*IF TRECITM-STATUS-CDE = 'IP' GET TRECEIV-STATUS-CODE             06230099
062400 2350-SELECT-TRECEIV.                                             06240099
062500***************************************************************** 06250099
062600     EXEC SQL                                                     06260099
062700          SELECT STATUS_CDE                                       06270099
062800               , VERFYD_TMST                                      06280099
062900            INTO  :RECEIV-STATUS-CDE                              06290099
063000               ,  :RECEIV-VERFYD-TMST                             06300099
063100            FROM TRECEIV                                          06310099
063200           WHERE ORD_NBR     = :DK-PO-NBR                         06320099
063300             AND REC_SEQ_NBR = :DK-REC-SEQ-NBR                    06330099
063400             WITH UR                                              06340099
063500     END-EXEC.                                                    06350099
063600                                                                  06360099
063700     EVALUATE TRUE                                                06370099
063800         WHEN SQLCODE = +0                                        06380099
063900              IF RECEIV-STATUS-CDE NOT = 'CM'                     06390099
064000                 IF PS-NOT-EOF-EXTRACT-CSR AND                    06400099
064100                    PS-MANIFEST-DC-FOUND                          06410099
064200                    PERFORM 2200-LOAD-EXTRACT-RECORD              06420099
064300                    ADD +1 TO PV-WRITE-EXTR2-COUNT                06430099
064400                    PERFORM 8100-WRITE-EXTRACT2                   06440099
064500                 END-IF                                           06450099
064600              ELSE                                                06460099
064700                 PERFORM 2355-SELECT-TWKORIN                      06470099
064800                 PERFORM 2360-SELECT-TPURCHS                      06480099
064900                 PERFORM 2370-SELECT-TDISTHD                      06490099
065000                 PERFORM 2200-LOAD-EXTRACT-RECORD                 06500099
065100                 ADD +1 TO PV-WRITE-EXTR1-COUNT                   06510099
065200                 PERFORM 8000-WRITE-EXTRACT1                      06520099
065300              END-IF                                              06530099
065400         WHEN SQLCODE = +100                                      06540099
065500              CONTINUE                                            06550099
065600         WHEN SQLWARN0 NOT = SPACE                                06560099
065700         WHEN SQLCODE  NOT = +0                                   06570099
065800              MOVE '2350-SELECT-TRECEIV'                          06580099
065900                                   TO PV-ABEND-PARAGRAPH          06590099
066000              MOVE 'ATTEMPTING TO SELECT TRECEIV'                 06600099
066100                                   TO PV-ABEND-OPERATION          06610099
066200              MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR       06620099
066300              STRING 'PO NBR: '         DELIMITED BY SIZE         06630099
066400                  PV-DISPLAY-PO-NBR     DELIMITED BY SIZE         06640099
066500                            INTO PV-ABEND-OPERATION1              06650099
066600              MOVE DK-REC-SEQ-NBR                                 06660099
066700                              TO PV-DISPLAY-RCVR-SEQ-NBR          06670099
066800              STRING 'RECV SEQ: '       DELIMITED BY SIZE         06680099
066900                  PV-DISPLAY-RCVR-SEQ-NBR                         06690099
067000                                        DELIMITED BY SIZE         06700099
067100                            INTO PV-ABEND-OPERATION2              06710099
067200              PERFORM Z999-SQL-ABEND                              06720099
067300     END-EVALUATE.                                                06730099
067400                                                                  06740099
067500***************************************************************** 06750099
067600 2355-SELECT-TWKORIN.                                             06760099
067700***************************************************************** 06770099
067800     EXEC SQL                                                     06780099
067900        SELECT A.STOP_TMST                                        06790099
068000        INTO  :WKORIN-STOP-TMST                                   06800099
068100        FROM   TWKORIN A                                          06810099
068200        WHERE  A.ORD_NBR          = :DK-PO-NBR                    06820099
068300          AND  A.RCVR_SEQ_NBR     = :DK-REC-SEQ-NBR               06830099
068400          AND  A.ORD_LNE_NBR      = 0                             06840099
068500          AND  A.VER_STATUS_CDE   = 'A'                           06850099
068600          AND  A.STOP_TMST IN                                     06860099
068700            (SELECT MAX(C.STOP_TMST)                              06870099
068800              FROM TWKORIN C                                      06880099
068900            WHERE C.ORD_NBR      = :DK-PO-NBR                     06890099
069000              AND C.RCVR_SEQ_NBR = :DK-REC-SEQ-NBR                06900099
069100              AND C.ORD_LNE_NBR  = 0                              06910099
069200              AND C.VER_STATUS_CDE   = 'A'                        06920099
069300              AND STOP_TMST NOT IN ('9999-09-09-09.09.09.000000') 06930099
069400              AND STOP_TMST NOT IN ('9999-09-09-09.09.09.999999'))06940099
069500              WITH UR                                             06950099
069600     END-EXEC.                                                    06960099
069700                                                                  06970099
069800     EVALUATE TRUE                                                06980099
069900         WHEN SQLCODE = +0                                        06990099
070000         WHEN SQLCODE = +100                                      07000099
070100              CONTINUE                                            07010099
070200         WHEN SQLWARN0 NOT = SPACE                                07020099
070300         WHEN SQLCODE  NOT = +0                                   07030099
070400              MOVE '2355-SELECT-TWKORIN'                          07040099
070500                                   TO PV-ABEND-PARAGRAPH          07050099
070600              MOVE 'ATTEMPTING TO SELECT TWKORIN'                 07060099
070700                                   TO PV-ABEND-OPERATION          07070099
070800              MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR       07080099
070900              STRING 'PO NBR: '         DELIMITED BY SIZE         07090099
071000                  PV-DISPLAY-PO-NBR     DELIMITED BY SIZE         07100099
071100                            INTO PV-ABEND-OPERATION1              07110099
071200              MOVE DK-REC-SEQ-NBR                                 07120099
071300                              TO PV-DISPLAY-RCVR-SEQ-NBR          07130099
071400              STRING 'RECV SEQ: '       DELIMITED BY SIZE         07140099
071500                  PV-DISPLAY-RCVR-SEQ-NBR                         07150099
071600                                        DELIMITED BY SIZE         07160099
071700                            INTO PV-ABEND-OPERATION2              07170099
071800              PERFORM Z999-SQL-ABEND                              07180099
071900     END-EVALUATE.                                                07190099
072000                                                                  07200099
072100***************************************************************** 07210099
072200*GET SEASONAL SHORT NAME                                          07220099
072300 2360-SELECT-TPURCHS.                                             07230099
072400***************************************************************** 07240099
072500     EXEC SQL                                                     07250099
072600          SELECT SEASET_SHRT_NM                                   07260099
072700            INTO  :PURCHS-SEASET-SHRT-NM                          07270099
072800            FROM TPURCHS                                          07280099
072900           WHERE PO_NBR          = :DK-PO-NBR                     07290099
073000             AND VER_STATUS_CDE  = 'A'                            07300099
073100             WITH UR                                              07310099
073200     END-EXEC.                                                    07320099
073300                                                                  07330099
073400     EVALUATE TRUE                                                07340099
073500         WHEN SQLCODE = +0                                        07350099
073600              CONTINUE                                            07360099
073700         WHEN SQLCODE = +100                                      07370099
073800              CONTINUE                                            07380099
073900         WHEN SQLWARN0 NOT = SPACE                                07390099
074000         WHEN SQLCODE  NOT = +0                                   07400099
074100              MOVE '2360-SELECT-TPURCHS'                          07410099
074200                                   TO PV-ABEND-PARAGRAPH          07420099
074300              MOVE 'ATTEMPTING TO SELECT TPURCHS'                 07430099
074400                                   TO PV-ABEND-OPERATION          07440099
074500              MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR       07450099
074600              STRING 'PO NBR: '         DELIMITED BY SIZE         07460099
074700                  PV-DISPLAY-PO-NBR     DELIMITED BY SIZE         07470099
074800                            INTO PV-ABEND-OPERATION1              07480099
074900              PERFORM Z999-SQL-ABEND                              07490099
075000     END-EVALUATE.                                                07500099
075100                                                                  07510099
075200***************************************************************** 07520099
075300*GET DATES                                                        07530099
075400 2370-SELECT-TDISTHD.                                             07540099
075500***************************************************************** 07550099
075600     EXEC SQL                                                     07560099
075700          SELECT P2L_CART_CNT                                     07570099
075800               , RSLTS_RCVD_TMST                                  07580099
075900               , FCSE_CNFRMN_TMST                                 07590099
076000            INTO  :DISTHD-P2L-CART-CNT                            07600099
076100               ,  :DISTHD-RSLTS-RCVD-TMST                         07610099
076200               ,  :DISTHD-FCSE-CNFRMN-TMST                        07620099
076300            FROM TDISTHD                                          07630099
076400           WHERE ORD_NBR      = :DK-PO-NBR                        07640099
076500             AND RCVR_SEQ_NBR = :DK-REC-SEQ-NBR                   07650099
076600             AND ORD_LNE_NBR  = :DK-LINE-NBR                      07660099
076700             WITH UR                                              07670099
076800     END-EXEC.                                                    07680099
076900                                                                  07690099
077000     EVALUATE TRUE                                                07700099
077100         WHEN SQLCODE = +0                                        07710099
077200              IF DISTHD-P2L-CART-CNT > 0                          07720099
077300                 CONTINUE                                         07730099
077400              END-IF                                              07740099
077500                                                                  07750099
077600              IF DISTHD-P2L-CART-CNT = 0                          07760099
077700                 MOVE PC-DEFAULT-TMST TO DISTHD-RSLTS-RCVD-TMST   07770099
077800              END-IF                                              07780099
077900         WHEN SQLCODE = +100                                      07790099
078000              CONTINUE                                            07800099
078100         WHEN SQLWARN0 NOT = SPACE                                07810099
078200         WHEN SQLCODE  NOT = +0                                   07820099
078300              MOVE '2370-SELECT-TDISTHD'                          07830099
078400                                   TO PV-ABEND-PARAGRAPH          07840099
078500              MOVE 'ATTEMPTING TO SELECT TDISTHD'                 07850099
078600                                   TO PV-ABEND-OPERATION          07860099
078700              MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR       07870099
078800              STRING 'PO NBR: '         DELIMITED BY SIZE         07880099
078900                  PV-DISPLAY-PO-NBR     DELIMITED BY SIZE         07890099
079000                            INTO PV-ABEND-OPERATION1              07900099
079100              MOVE DK-REC-SEQ-NBR                                 07910099
079200                              TO PV-DISPLAY-RCVR-SEQ-NBR          07920099
079300              STRING 'RECV SEQ: '       DELIMITED BY SIZE         07930099
079400                  PV-DISPLAY-RCVR-SEQ-NBR                         07940099
079500                                        DELIMITED BY SIZE         07950099
079600                            INTO PV-ABEND-OPERATION2              07960099
079700              MOVE DK-LINE-NBR         TO PV-DISPLAY-PO-LINE-NBR  07970099
079800              STRING 'PO LINE NBR: '    DELIMITED BY SIZE         07980099
079900                 PV-DISPLAY-PO-LINE-NBR DELIMITED BY SIZE         07990099
080000                            INTO PV-ABEND-OPERATION3              08000099
080100              PERFORM Z999-SQL-ABEND                              08010099
080200     END-EVALUATE.                                                08020099
080300                                                                  08030099
080400                                                                  08040099
080500***************************************************************** 08050099
080600 3510-OPEN-TKRPRPM-CSR.                                           08060099
080700***************************************************************** 08070099
080800     MOVE '3510-OPEN-TKRPRPM-CSR'                                 08080099
080900         TO PV-ABEND-PARAGRAPH.                                   08090099
081000     MOVE 'OPEN THE TKRPRPM_CSR'                                  08100099
081100         TO PV-DB2-OPERATION-ATTEMPTED.                           08110099
081200                                                                  08120099
081300     EXEC SQL                                                     08130099
081400         OPEN TKRPRPM_CSR                                         08140099
081500     END-EXEC.                                                    08150099
081600                                                                  08160099
081700     EVALUATE TRUE                                                08170099
081800         WHEN SQLWARN0 NOT = SPACE                                08180099
081900         WHEN SQLCODE < ZERO                                      08190099
082000         WHEN SQLCODE > ZERO                                      08200099
082100             PERFORM Z999-SQL-ABEND                               08210099
082200         WHEN SQLCODE = ZEROS                                     08220099
082300              CONTINUE                                            08230099
082400     END-EVALUATE.                                                08240099
082500                                                                  08250099
082600***************************************************************** 08260099
082700 3520-FETCH-TKRPRPM-CSR.                                          08270099
082800***************************************************************** 08280099
082900                                                                  08290099
083000     MOVE '3520-FETCH-TKRPRPM'                                    08300099
083100         TO PV-ABEND-PARAGRAPH.                                   08310099
083200     MOVE 'FETCH THE TKRPRPM_CSR'                                 08320099
083300         TO PV-DB2-OPERATION-ATTEMPTED.                           08330099
083400                                                                  08340099
083500     EXEC SQL                                                     08350099
083600          FETCH TKRPRPM_CSR                                       08360099
083700             INTO  :XLT00010-LOC-NBR,                             08370099
083800                   :XLT00010-OPN-DTE,                             08380099
083900                   :XLT00010-CLO-DTE                              08390099
084000     END-EXEC.                                                    08400099
084100                                                                  08410099
084200     EVALUATE TRUE                                                08420099
084300         WHEN SQLCODE = +0                                        08430099
084400              CONTINUE                                            08440099
084500         WHEN SQLCODE = +100                                      08450099
084600              SET PS-EOF-TKRPRPM-CSR TO TRUE                      08460099
084700         WHEN SQLWARN0 NOT = SPACE                                08470099
084800         WHEN SQLCODE < ZERO                                      08480099
084900         WHEN SQLCODE > ZERO                                      08490099
085000             PERFORM Z999-SQL-ABEND                               08500099
085100     END-EVALUATE.                                                08510099
085200                                                                  08520099
085300                                                                  08530099
085400***************************************************************** 08540099
085500 3530-CLOSE-TKRPRPM-CSR.                                          08550099
085600***************************************************************** 08560099
085700                                                                  08570099
085800     MOVE '3530-CLOSE-TKRPRPM-CSR.'                               08580099
085900         TO PV-ABEND-PARAGRAPH.                                   08590099
086000     MOVE 'CLOSE THE TKRPRPM_CSR'                                 08600099
086100         TO PV-DB2-OPERATION-ATTEMPTED.                           08610099
086200                                                                  08620099
086300     EXEC SQL                                                     08630099
086400         CLOSE TKRPRPM_CSR                                        08640099
086500     END-EXEC.                                                    08650099
086600                                                                  08660099
086700     EVALUATE TRUE                                                08670099
086800         WHEN SQLWARN0 NOT = SPACE                                08680099
086900         WHEN SQLCODE < ZERO                                      08690099
087000         WHEN SQLCODE > ZERO                                      08700099
087100             PERFORM Z999-SQL-ABEND                               08710099
087200         WHEN SQLCODE = ZEROS                                     08720099
087300             CONTINUE                                             08730099
087400     END-EVALUATE.                                                08740099
087500                                                                  08750099
087600***************************************************************** 08760099
087700 8000-WRITE-EXTRACT1.                                             08770099
087800***************************************************************** 08780099
087900     WRITE EXTRACT-RECORD1                                        08790099
088000       FROM SU036-RECORD.                                         08800099
088100     INITIALIZE SU036-RECORD.                                     08810099
088200                                                                  08820099
088300***************************************************************** 08830099
088400 8100-WRITE-EXTRACT2.                                             08840099
088500***************************************************************** 08850099
088600     WRITE EXTRACT-RECORD2                                        08860099
088700       FROM SU036-RECORD.                                         08870099
088800     INITIALIZE SU036-RECORD.                                     08880099
088900                                                                  08890099
089000***************************************************************** 08900099
089100 9000-CLOSE-FILES.                                                08910099
089200     DISPLAY 'BEGIN TIMESTAMP = ' PV-BEGIN-TIMESTAMP.             08920099
089300     DISPLAY 'END TIMESTAMP   = ' PV-END-TIMESTAMP.               08930099
089400                                                                  08940099
089500     MOVE PV-FETCH-COUNT          TO PV-DISPLAY-FETCH-CNT.        08950099
089600     DISPLAY 'TOTAL RECORDS FETCHED  '   PV-DISPLAY-FETCH-CNT.    08960099
089700                                                                  08970099
089800     MOVE PV-WRITE-EXTR1-COUNT    TO PV-DISPLAY-WRITE-CNT1.       08980099
089900     DISPLAY 'TOTAL VERIFIED RECS WRITTEN ' PV-DISPLAY-WRITE-CNT1.08990099
090000                                                                  09000099
090100     MOVE PV-WRITE-EXTR2-COUNT    TO PV-DISPLAY-WRITE-CNT2.       09010099
090200     DISPLAY 'TOTAL NOT VE RECS WRITTEN   ' PV-DISPLAY-WRITE-CNT2.09020099
090300                                                                  09030099
090400*DISPLAY FETCH TOTAL SHOULD EQUAL WRITE TOTAL                     09040099
090500     CLOSE EXTRACT-FILE1                                          09050099
090600           EXTRACT-FILE2.                                         09060099
090700                                                                  09070099
090800***************************************************************** 09080099
090900 Z999-SQL-ABEND.                                                  09090099
091000***************************************************************** 09100099
091100     MOVE SQLCODE                     TO SQLCODE2.                09110099
091200     MOVE SQLERRD(3)                  TO SQLERRD3.                09120099
091300                                                                  09130099
091400     DISPLAY '** ABEND **         ** = SQLERROR'.                 09140099
091500     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                09150099
091600     DISPLAY '** PO NUMBER ** = ' PV-DISPLAY-PO-NBR.              09160099
091700     DISPLAY '** RECEIVER  ** = ' PV-DISPLAY-RCVR-SEQ-NBR.        09170099
091800     DISPLAY '** PO LNE NBR** = ' PV-DISPLAY-PO-LINE-NBR.         09180099
091900                                                                  09190099
092000                                                                  09200099
092100     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             09210099
092200     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                09220099
092300     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME.              09230099
092400     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME1.             09240099
092500     DISPLAY '** SQLCODE          ** = ' SQLCODE2.                09250099
092600     DISPLAY '** ROWS PROCESSED   ** = ' SQLERRD3.                09260099
092700     DISPLAY '** SQLERRM          ** = ' SQLERRM.                 09270099
092800     DISPLAY '** SQLERRMC         ** = ' SQLERRMC.                09280099
092900                                                                  09290099
093000     MOVE +4013                  TO PV-ABEND-CODE.                09300099
093100     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         09310099
