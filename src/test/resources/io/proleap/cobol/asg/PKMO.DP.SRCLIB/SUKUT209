000100******************************************************************00010007
000200 IDENTIFICATION DIVISION.                                         00020007
000300******************************************************************00030007
000400 PROGRAM-ID.    SUKUT209.                                         00040007
000500 AUTHOR.        GERMAN BANDA.                                     00050007
000600 INSTALLATION.  KOHLS.                                            00060007
000700 DATE-WRITTEN   JULY, 2023.                                       00070007
000800 DATE-COMPILED.                                                   00080007
000900******************************************************************00090007
001000*   USING CONFIGURABLE PARAMETERS, THIS PROGRAM WILL WRITE AN     00100024
001100*   OUTPUT FILE OF OUTBOUND TRIP ID THAT HAVE BEEN IN THE STATUS  00110007
001200*   OF 'SO' - STORE OPEN OR 'DS' DC SHIPPED FOR GREATER THAN 'X'  00120007
001300*   PARM DAYS                                                     00130007
002000*                                                                *00200060
002100* FOUR NEW PARAMTERS ARE USED TO SELECT A DAYS BACK DATE TO       00210060
002110* COMPARE AGAINST DATE(A.OTBND_STAT_TMST) IN TSUOBTS-CSR          00211060
002200* SYS_PRC_FUNC_CDE  = 'SUSOST' -                                  00220060
002300* DAYS BACK A TRAILER HAS BEEN IN STORE OPEN (SO) STATUS          00230060
002310* SYS_PRC_FUNC_CDE  = 'SUDSST'                                    00231060
002320* DAYS BACK A TRAILER HAS BEEN IN DC SHIPPED (DS) STATUS          00232060
002330* SYS_PRC_FUNC_CDE  = -SUDSPR'                                    00233060
002340* CHECK OF PRIOR DC SHIPPED TRAILER                               00234060
002350* SYS_PRC_FUNC_CDE  = 'SUSOPR'                                    00235060
002360* CHECK OF PRIOR STORE OPEN TRAILER                               00236060
002370*                                                                 00237060
002380* 'A' CURSOR - RETURN AGING TRIP WITH MAX TRIP STATUS OF 'DS'     00238060
002390*              DC SHIPPED                                         00239060
002391* 'B' CURSOR - RETURN AGING TRIP WITH MAX TRIP STATUS OF 'SO'     00239160
002392*              STORE OPEN                                         00239260
002393* 'C' CURSOR - RETURN AGING TRIP WITH MAX TRIP STATUS OF 'DS'     00239360
002394*              WHERE A SECOND TRIP HAS BEEN PROCESSED AND IS IN   00239460
002395*              'SU' STATUS                                        00239560
002396* 'D' CURSOR - RETURN AGING TRIP WITH MAX TRIP STATUS OF 'SO'     00239660
002397*              WHERE A SECOND TRIP HAS BEEN PROCESSED AND IS IN   00239760
002398*              'SU' STATUS                                        00239860
002399*                                                                 00239960
002400* EXAMPLE OF 'C' CURSOR - TRIP 356627548 WITH DATE OF 9/12 AND    00240060
002401* SUBSEQUENT TRIP ALREADY PROCESSED                               00240160
002402* SCAC  TRAILER ID    SERIAL #     TRIP    STATUS    DATE     SLOT00240260
002403* KOHL H05059        523676405   674209006   SU   09/19/2023  D12800240360
002404* KOHL X99013        520139105   356627548   SO   09/12/2023  D12800240460
002405*                                                                 00240560
002410******************************************************************00241060
002500 ENVIRONMENT DIVISION.                                            00250007
002600 CONFIGURATION SECTION.                                           00260007
002700                                                                  00270007
002800 SOURCE-COMPUTER.        IBM-3090.                                00280007
002900 OBJECT-COMPUTER.        IBM-3090.                                00290007
003000                                                                  00300007
003100 INPUT-OUTPUT SECTION.                                            00310007
003200 FILE-CONTROL.                                                    00320007
003300                                                                  00330007
003700     SELECT OTBND-TRIP-FILE-OUT                                   00370007
003800         ASSIGN TO OUT01.                                         00380007
003900                                                                  00390007
004000******************************************************************00400007
004100 DATA DIVISION.                                                   00410007
004200 FILE SECTION.                                                    00420007
004300                                                                  00430007
005000                                                                  00500007
005100 FD  OTBND-TRIP-FILE-OUT                                          00510007
005200     RECORDING MODE IS F                                          00520007
005300     LABEL RECORDS ARE STANDARD                                   00530007
005400     BLOCK CONTAINS 0 RECORDS.                                    00540007
005500                                                                  00550007
005600 01  OTBND-TRIP-RECORD-OUT              PIC  X(100).              00560011
005700*                                                                 00570007
005800******************************************************************00580007
005900 WORKING-STORAGE SECTION.                                         00590007
006000******************************************************************00600007
006100******************************************************************00610007
006200*  AGING TRIP RECORD                                              00620017
006300******************************************************************00630007
006400     COPY SURD175.                                                00640011
006500                                                                  00650007
006900                                                                  00690007
007000 01  PS-PROGRAM-SWITCHES.                                         00700007
007100     05  PS-END-OF-TSUOBTS-CSR-SW    PIC  X(01)    VALUE 'N'.     00710007
007200         88  PS-END-OF-TSUOBTS-CSR                 VALUE 'Y'.     00720007
007300         88  PS-NOT-END-OF-TSUOBTS-CSR             VALUE 'N'.     00730007
007400                                                                  00740007
007500     05  PS-DIVERTED-TRAILER-SW      PIC  X(01)    VALUE 'N'.     00750079
007600         88  PS-DIVERTED-TRAILER-YES               VALUE 'Y'.     00760079
007700         88  PS-DIVERTED-TRAILER-NO                VALUE 'N'.     00770079
007800                                                                  00780007
007900     05  PS-END-OF-CONTROL-SW        PIC  X(01)    VALUE 'N'.     00790007
008000         88  PS-END-OF-CONTROL                     VALUE 'Y'.     00800007
008100         88  PS-NOT-END-OF-CONTROL                 VALUE 'N'.     00810007
008200                                                                  00820007
008300 01  PC-PROGRAM-CONSTANTS.                                        00830007
008400     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08) VALUE 'SUKUT209'. 00840007
008410     05  PC-DS                       PIC  X(02)    VALUE 'DS'.    00841052
008500                                                                  00850007
008600 01  PV-PROGRAM-VARIABLES.                                        00860007
008700     05  PV-PARAGRAPH-NAME           PIC  X(30)     VALUE SPACES. 00870007
008800     05  PV-TRIP-IDS-FETCHED         PIC  9(9) COMP VALUE ZEROS.  00880007
008900     05  PV-DC-SHIPPED-COUNT         PIC  9(9) COMP VALUE ZEROS.  00890031
008910     05  PV-STORE-OPEN-COUNT         PIC  9(9) COMP VALUE ZEROS.  00891031
008920     05  PV-STORE-OPN-PRE-CNT        PIC  9(9) COMP VALUE ZEROS.  00892048
008930     05  PV-DC-SHIPPED-PRE-CNT       PIC  9(9) COMP VALUE ZEROS.  00893048
009000     05  PV-TOTAL-WRITE-COUNT        PIC  9(9) COMP VALUE ZEROS.  00900007
009100     05  PV-DISPLAY-COUNT            PIC  ZZZ,ZZZ,ZZ9.            00910007
009200     05  PV-DISPLAY-SQLCODE          PIC  +999  VALUE ZEROES.     00920007
009300     05  PV-DISPLAY-STORE            PIC  9999  VALUE ZEROES.     00930007
009400     05  PV-DISPLAY-TRIP-ID          PIC  Z(8)9.                  00940007
009500     05  PV-PREV-STORE               PIC S9(4)  COMP VALUE ZEROS. 00950007
009600     05  PV-PREV-TRIP-ID             PIC S9(9)  COMP VALUE ZEROS. 00960007
009700     05  PV-FUNC-TXT                 PIC  X(25) VALUE SPACES.     00970007
009800     05  PV-ASSMPT-QTY               PIC S9(4)  COMP VALUE +0.    00980007
009900     05  PV-ASSMPT-DATE              PIC  X(10) VALUE SPACES.     00990007
010000     05  PV-STORE-OPEN-DATE          PIC  X(10) VALUE SPACES.     01000022
010101     05  PV-DC-SHIPPED-DATE          PIC  X(10) VALUE SPACES.     01010145
010102     05  PV-STORE-OPEN-PREV          PIC  X(10) VALUE SPACES.     01010245
010103     05  PV-DC-SHIPPED-PREV          PIC  X(10) VALUE SPACES.     01010345
010104     05  PV-DS-SU-TRIP-DTE           PIC  X(10) VALUE SPACES.     01010464
010105     05  PV-SO-SU-TRIP-DTE           PIC  X(10) VALUE SPACES.     01010564
010110     05  PV-SCHED-INV-QTY            PIC S9(4)  COMP VALUE +0.    01011007
010120     05  PV-SCHED-INV-DATE           PIC  X(10) VALUE SPACES.     01012007
010130     05  PV-RANGE-INV-QTY            PIC S9(4)  COMP VALUE +0.    01013007
010140     05  PV-RANGE-INV-DATE           PIC  X(10) VALUE SPACES.     01014007
010150     05  PV-ASSMPT-RFID-QTY          PIC S9(4)  COMP VALUE +0.    01015007
010160     05  PV-ASSMPT-RFID-DATE         PIC  X(10) VALUE SPACES.     01016007
010170     05  PV-ASSMPT-VIRT-RFID-QTY     PIC S9(4)  COMP VALUE +0.    01017007
010180     05  PV-ASSMPT-VIRT-RFID-DATE    PIC  X(10) VALUE SPACES.     01018007
010190     05  PV-DISPLAY-QTY              PIC  +9999.                  01019007
010200     05  PV-ELEM-STORE               PIC S9(10)V9(5) COMP-3.      01020007
010300     05  PV-UNION-TYPE               PIC  X(1)  VALUE SPACE.      01030010
010310     05  PV-HOLD-TRIP-ID             PIC  S9(9) COMP.             01031007
010320     05  PV-DISP-TRIP                PIC   9(9).                  01032007
010330     05  PV-BYPASS-COUNT             PIC  9(9) COMP VALUE ZEROS.  01033007
010340                                                                  01034007
010350 01  PV-ABEND-CODE                    PIC S9(04)   VALUE ZERO     01035007
010360                                                   COMP SYNC.     01036007
010370 01  PV-ABEND-FIELDS.                                             01037007
010380     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'SUKUT209'.01038007
010390     05  PV-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    01039007
010400     05  PV-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    01040007
010500     05  PV-ABEND-STRUCTURE-1         PIC X(8)   VALUE SPACES.    01050007
010600     05  PV-ABEND-STRUCTURE-2         PIC X(20)  VALUE SPACES.    01060007
010700     05  PV-ABEND-STRUCTURE-3         PIC X(20)  VALUE SPACES.    01070007
010800     05  PV-ABEND-STATUS              PIC XX     VALUE SPACES.    01080007
010900     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01090007
011000     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01100007
011100     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01110007
011200     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01120007
011300*  USED FOR DB2 ERROR MESSAGE BUILDING                            01130007
011400     COPY DPWS004.                                                01140007
011500                                                                  01150007
011600******************************************************************01160007
011700*  COMMUNICATIONS AREA FOR DB2                                    01170007
011800******************************************************************01180007
011900     EXEC SQL                                                     01190007
012000          INCLUDE SQLCA                                           01200007
012100     END-EXEC.                                                    01210007
012200                                                                  01220007
013000******************************************************************01300007
013100*  OUTBOUND TRAILER TRIP TABLE                                    01310007
013200******************************************************************01320007
013300     EXEC SQL                                                     01330007
013400          INCLUDE TSUOBTR                                         01340007
013500     END-EXEC.                                                    01350007
013600                                                                  01360007
013700******************************************************************01370007
013800*  OUTBOUND TRAILER TRIP STATUS TABLE                             01380007
013900******************************************************************01390007
014000     EXEC SQL                                                     01400007
014100          INCLUDE TSUOBTS                                         01410007
014200     END-EXEC.                                                    01420007
014300                                                                  01430007
014400******************************************************************01440007
014500*  PARAMATER TABLE                                                01450007
014600******************************************************************01460007
014700     EXEC SQL                                                     01470007
014800          INCLUDE TKRPRPM                                         01480007
014900     END-EXEC.                                                    01490007
015000                                                                  01500007
017200******************************************************************01720007
017300*    TCNTRID - TRAILIER ID TABLE                                  01730007
017400******************************************************************01740007
017500     EXEC SQL                                                     01750007
017600          INCLUDE TCNTRID                                         01760007
017700     END-EXEC.                                                    01770007
017800                                                                  01780007
017900******************************************************************01790032
018000*    XLT_LOC - LOCATION TABLE                                     01800032
018100******************************************************************01810032
018200     EXEC SQL                                                     01820032
018300          INCLUDE XLT00010                                        01830032
018400     END-EXEC.                                                    01840032
018500                                                                  01850032
018510***************************************************************** 01851050
018520*    WST_INTGRTN_TYP TABLE                                        01852050
018530***************************************************************** 01853050
018540     EXEC SQL                                                     01854050
018550          INCLUDE WST00008                                        01855050
018560     END-EXEC.                                                    01856050
018570                                                                  01857050
018580***************************************************************** 01858050
018590*    WST_ATTR_ELEM TABLE                                          01859050
018591***************************************************************** 01859150
018592     EXEC SQL                                                     01859250
018593          INCLUDE WST00009                                        01859350
018594     END-EXEC.                                                    01859450
018595                                                                  01859550
018596***************************************************************** 01859650
018597*    WST_ATTR_DEFN TABLE                                          01859750
018598***************************************************************** 01859850
018599     EXEC SQL                                                     01859950
018600          INCLUDE WST00010                                        01860050
018610     END-EXEC.                                                    01861050
018620                                                                  01862050
018700******************************************************************01870007
019130*---------------------------------------------------------------* 01913007
019140*    TSUOBTS UNION CURSOR TO DETERMINE AGING TRIPS BASED ON       01914028
019150*    TKRPRPM PARAMTERS FOR STATUS OF SO - STORE OPEN OR 'DS'      01915028
019160*    DC SHIPPED. COMPARING TO OTBND_STAT_TMST                     01916028
019529*---------------------------------------------------------------* 01952907
019530     EXEC SQL                                                     01953007
019540       DECLARE TSUOBTS-CSR CURSOR FOR                             01954007
019560        SELECT 'A'                                                01956023
019580              ,A.OTBND_TRIP_ID                                    01958023
019590              ,A.TRIP_STAT_CDE                                    01959023
019600              ,B.DEST_OPER_UNT_ID                                 01960023
019800              ,A.DOOR_ID                                          01980023
019900              ,A.TRLR_SEAL_ID                                     01990023
019910              ,A.SHIP_SCAC_CDE                                    01991023
019920              ,A.OTBND_STAT_TMST                                  01992032
019930              ,A.STAT_OPER_UNT_ID                                 01993049
020100        FROM  TSUOBTS A                                           02010023
020200             ,TSUOBTR B                                           02020023
020300             ,TCNTRID C                                           02030023
020400             ,XLT_LOC E                                           02040030
020500        WHERE A.TRIP_STAT_CDE   IN ('DS')                         02050023
020600               AND B.OTBND_TRIP_ID   = A.OTBND_TRIP_ID            02060023
020700               AND B.DOOR_TYP_CDE    = 'SH'                       02070023
020810               AND C.TRLR_SRL_NBR  = B.TRLR_SRL_NBR               02081023
020820               AND DATE(A.OTBND_STAT_TMST) < :PV-DC-SHIPPED-DATE  02082030
020830               AND B.DEST_OPER_UNT_ID = E.LOC_NBR                 02083030
020840               AND E.LOC_TYP_CDE      = 'DS'                      02084030
020850               AND E.E_BUS_IND        = 'N'                       02085030
020900               AND A.OTBND_STAT_TMST =                            02090023
021000                     (SELECT MAX(D.OTBND_STAT_TMST)               02100023
021100                      FROM TSUOBTS D                              02110023
021200                      WHERE D.OTBND_TRIP_ID = A.OTBND_TRIP_ID)    02120023
021400     UNION                                                        02140023
021500        SELECT 'B'                                                02150023
021600              ,A.OTBND_TRIP_ID                                    02160023
021700              ,A.TRIP_STAT_CDE                                    02170023
021800              ,B.DEST_OPER_UNT_ID                                 02180023
022000              ,A.DOOR_ID                                          02200023
022100              ,A.TRLR_SEAL_ID                                     02210023
022200              ,A.SHIP_SCAC_CDE                                    02220023
022300              ,A.OTBND_STAT_TMST                                  02230032
022310              ,A.STAT_OPER_UNT_ID                                 02231049
022400        FROM  TSUOBTS A                                           02240023
022500             ,TSUOBTR B                                           02250023
022600             ,TCNTRID C                                           02260023
022700             ,XLT_LOC E                                           02270030
022800        WHERE A.TRIP_STAT_CDE   IN ('SO')                         02280023
022900               AND B.OTBND_TRIP_ID   = A.OTBND_TRIP_ID            02290023
023000               AND B.DOOR_TYP_CDE    = 'SH'                       02300023
023110               AND C.TRLR_SRL_NBR  = B.TRLR_SRL_NBR               02311023
023130               AND DATE(A.OTBND_STAT_TMST) < :PV-STORE-OPEN-DATE  02313030
023140               AND B.DEST_OPER_UNT_ID = E.LOC_NBR                 02314030
023150               AND E.LOC_TYP_CDE      = 'DS'                      02315030
023160               AND E.E_BUS_IND        = 'N'                       02316030
023200               AND A.OTBND_STAT_TMST =                            02320023
023300                     (SELECT MAX(D.OTBND_STAT_TMST)               02330023
023400                      FROM TSUOBTS D                              02340036
023500                      WHERE D.OTBND_TRIP_ID = A.OTBND_TRIP_ID)    02350023
023600     UNION                                                        02360035
023610         SELECT 'C'                                               02361059
023620               ,A.OTBND_TRIP_ID                                   02362059
023630               ,A.TRIP_STAT_CDE                                   02363059
023640               ,B.DEST_OPER_UNT_ID                                02364059
023650               ,A.DOOR_ID                                         02365059
023660               ,A.TRLR_SEAL_ID                                    02366059
023670               ,A.SHIP_SCAC_CDE                                   02367059
023680               ,A.OTBND_STAT_TMST                                 02368059
023690               ,A.STAT_OPER_UNT_ID                                02369059
023691         FROM   TSUOBTS A                                         02369159
023692              , TSUOBTR B                                         02369259
023693              , TCNTRID C                                         02369359
023694              , XLT_LOC E                                         02369459
023695         WHERE A.TRIP_STAT_CDE   IN ('DS')                        02369561
023697                AND B.OTBND_TRIP_ID   = A.OTBND_TRIP_ID           02369759
023699                AND B.DOOR_TYP_CDE    = 'SH'                      02369959
023700                AND C.TRLR_SRL_NBR    = B.TRLR_SRL_NBR            02370059
023701                AND DATE(A.OTBND_STAT_TMST) < :PV-DC-SHIPPED-PREV 02370159
023702                AND B.DEST_OPER_UNT_ID = E.LOC_NBR                02370259
023703                AND E.LOC_TYP_CDE      = 'DS'                     02370359
023704                AND E.E_BUS_IND        = 'N'                      02370459
023705                AND A.OTBND_STAT_TMST =                           02370559
023706                    (SELECT MAX(D.OTBND_STAT_TMST)                02370659
023707                     FROM TSUOBTS D                               02370759
023708                     WHERE D.OTBND_TRIP_ID = A.OTBND_TRIP_ID)     02370859
023709              AND EXISTS                                          02370959
023710              (SELECT *                                           02371059
023711               FROM TSUOBTS AA                                    02371159
023712                  , TSUOBTS BB                                    02371259
023713                  , TSUOBTR CC                                    02371359
023714                  , TSUOBTS DD                                    02371459
023715               WHERE CC.DEST_OPER_UNT_ID = B.DEST_OPER_UNT_ID     02371559
023716                 AND AA.TRIP_STAT_CDE   = 'SO'                    02371659
023717                 AND AA.OTBND_STAT_TMST > A.OTBND_STAT_TMST       02371759
023718                 AND AA.OTBND_TRIP_ID   = CC.OTBND_TRIP_ID        02371859
023719                 AND BB.TRIP_STAT_CDE   = 'SU'                    02371959
023720                 AND BB.OTBND_STAT_TMST > A.OTBND_STAT_TMST       02372059
023721                 AND BB.OTBND_TRIP_ID   = CC.OTBND_TRIP_ID        02372159
023722                 AND DATE(BB.OTBND_STAT_TMST) < :PV-DS-SU-TRIP-DTE02372264
023723                 AND DD.TRIP_STAT_CDE   = 'DS'                    02372362
023724                 AND DD.OTBND_STAT_TMST > A.OTBND_STAT_TMST       02372462
023725                 AND DD.OTBND_TRIP_ID   = CC.OTBND_TRIP_ID)       02372562
023726      UNION                                                       02372659
023727       SELECT 'D'                                                 02372759
023728              ,A.OTBND_TRIP_ID                                    02372836
023729              ,A.TRIP_STAT_CDE                                    02372936
023730              ,B.DEST_OPER_UNT_ID                                 02373036
023731              ,A.DOOR_ID                                          02373136
023732              ,A.TRLR_SEAL_ID                                     02373236
023733              ,A.SHIP_SCAC_CDE                                    02373336
023734              ,A.OTBND_STAT_TMST                                  02373436
023735              ,A.STAT_OPER_UNT_ID                                 02373549
023736        FROM   TSUOBTS A                                          02373636
023737             , TSUOBTR B                                          02373736
023738             , TCNTRID C                                          02373836
023739             , XLT_LOC E                                          02373936
023740        WHERE A.TRIP_STAT_CDE   IN ('SO')                         02374036
023741               AND B.OTBND_TRIP_ID   = A.OTBND_TRIP_ID            02374136
023742               AND B.DOOR_TYP_CDE    = 'SH'                       02374236
023743               AND C.TRLR_SRL_NBR    = B.TRLR_SRL_NBR             02374336
023744               AND DATE(A.OTBND_STAT_TMST) < :PV-STORE-OPEN-PREV  02374445
023745               AND B.DEST_OPER_UNT_ID = E.LOC_NBR                 02374536
023746               AND E.LOC_TYP_CDE      = 'DS'                      02374636
023747               AND E.E_BUS_IND        = 'N'                       02374736
023748               AND A.OTBND_STAT_TMST =                            02374836
023749                   (SELECT MAX(D.OTBND_STAT_TMST)                 02374936
023750                    FROM TSUOBTS D                                02375036
023751                    WHERE D.OTBND_TRIP_ID = A.OTBND_TRIP_ID)      02375136
023752               AND EXISTS                                         02375236
023753                   (SELECT *                                      02375336
023754                   FROM TSUOBTS AA                                02375436
023755                      , TSUOBTS BB                                02375536
023756                      , TSUOBTR CC                                02375636
023757                   WHERE CC.DEST_OPER_UNT_ID = B.DEST_OPER_UNT_ID 02375736
023758                     AND AA.TRIP_STAT_CDE = 'SO'                  02375836
023759                     AND AA.OTBND_STAT_TMST > A.OTBND_STAT_TMST   02375936
023760                     AND AA.OTBND_TRIP_ID = CC.OTBND_TRIP_ID      02376036
023761                     AND BB.TRIP_STAT_CDE = 'SU'                  02376136
023762                     AND BB.OTBND_STAT_TMST > A.OTBND_STAT_TMST   02376236
023763                 AND DATE(BB.OTBND_STAT_TMST) < :PV-SO-SU-TRIP-DTE02376364
023770                     AND BB.OTBND_TRIP_ID = CC.OTBND_TRIP_ID)     02377036
023900        ORDER BY 1,2                                              02390037
023910        WITH UR                                                   02391041
024076     END-EXEC.                                                    02407607
024077                                                                  02407707
024078                                                                  02407807
024079******************************************************************02407907
024080 PROCEDURE DIVISION.                                              02408007
024090******************************************************************02409007
024100******************************************************************02410007
024200* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     02420007
024300*      PROGRAM.                                                   02430007
024400******************************************************************02440007
024500 0000-PROGRAM-MAINLINE.                                           02450007
024600                                                                  02460007
024700     DISPLAY ' '.                                                 02470007
024800     DISPLAY '***** SUKUT209 STARTED *****'.                      02480007
024900                                                                  02490007
025000     PERFORM 1000-INITIALIZE.                                     02500007
025100     PERFORM 2000-PROCESS-TSUOBTS-TRIP-IDS.                       02510008
025200     PERFORM 9000-EOJ-ROUTINE.                                    02520018
025300     STOP RUN.                                                    02530021
026000******************************************************************02600007
026100*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    02610007
026200*  -- OPEN INPUT/OUTPUT FILES                                     02620007
026900******************************************************************02690007
027000 1000-INITIALIZE.                                                 02700007
027100                                                                  02710007
027300     OPEN OUTPUT OTBND-TRIP-FILE-OUT.                             02730007
027400                                                                  02740023
043273     PERFORM 1100-TKRPRPM-STR-OPEN-DTE.                           04327323
043274     PERFORM 1200-TKRPRPM-DC-SHIPPED-DTE.                         04327423
043275     PERFORM 1300-TKRPRPM-SO-PRIOR-DTE.                           04327545
043276     PERFORM 1400-TKRPRPM-DS-PRIOR-DTE.                           04327645
043277     PERFORM 1500-TKRPRPM-SU-CURR-TRIP-DS.                        04327765
043278     PERFORM 1600-TKRPRPM-SU-CURR-TRIP-SO.                        04327865
043279******************************************************************04327965
043280*  READ PARM TABLE TO USE TO DETERMINE THE NUMBER OF DAYS BACK    04328065
043281*  A TRAILER HAS BEEN IN STORE OPEN (SO) STATUS                   04328165
043282******************************************************************04328265
043283 1100-TKRPRPM-STR-OPEN-DTE.                                       04328365
043284                                                                  04328465
043285     EXEC SQL                                                     04328565
043286         SELECT  (CURRENT DATE - FUNC_QTY DAYS)                   04328665
043287           INTO  :PV-STORE-OPEN-DATE                              04328765
043288           FROM  TKRPRPM                                          04328865
043289          WHERE  LOC_ID            = 90                           04328965
043290            AND  INTFC_SYS_CDE     = 'KHL'                        04329065
043291            AND  SYS_PRC_FUNC_CDE  = 'SUSOST'                     04329165
043292            AND  FUNC_PRC_STAT_CDE = 'AC'                         04329265
043293     END-EXEC.                                                    04329365
043294                                                                  04329465
043295     EVALUATE TRUE                                                04329565
043296         WHEN SQLCODE = ZERO                                      04329665
043297              DISPLAY 'STORE OPEN DATE (SUSOST): '                04329777
043298                       PV-STORE-OPEN-DATE                         04329877
043302         WHEN SQLCODE = +100                                      04330222
043303              MOVE '0001-01-01' TO PV-STORE-OPEN-DATE             04330323
043308         WHEN OTHER                                               04330822
043309             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          04330922
043310             MOVE  '1100-TKRPRPM-STR-OPEN-DTE '                   04331023
043311                                   TO PV-ABEND-PARAGRAPH          04331122
043312             MOVE 'SYS_PRC_FUNC_CDE  = SUSOST'                    04331223
043313                                   TO PV-ABEND-OPERATION          04331322
043314             MOVE 'CHECKING STORE OPEN PARM '                     04331423
043315                                   TO PV-DB2-OPERATION-MESSAGE-1  04331522
043316             MOVE 'TKRPRPM'        TO PV-ABEND-STRUCTURE-1        04331622
043317             PERFORM 9900-DB2-ABEND                               04331722
043318     END-EVALUATE.                                                04331822
043319                                                                  04331922
043320******************************************************************04332023
043321*  READ PARM TABLE TO USE TO DETERMINE THE NUMBER OF DAYS BACK    04332123
043322*  A TRAILER HAS BEEN IN DC SHIPPED (DS) STATUS                   04332223
043323******************************************************************04332323
043324 1200-TKRPRPM-DC-SHIPPED-DTE.                                     04332423
043325                                                                  04332523
043326     EXEC SQL                                                     04332623
043327         SELECT  (CURRENT DATE - FUNC_QTY DAYS)                   04332723
043328           INTO  :PV-DC-SHIPPED-DATE                              04332823
043329           FROM  TKRPRPM                                          04332923
043330          WHERE  LOC_ID            = 90                           04333023
043331            AND  INTFC_SYS_CDE     = 'KHL'                        04333123
043332            AND  SYS_PRC_FUNC_CDE  = 'SUDSST'                     04333223
043333            AND  FUNC_PRC_STAT_CDE = 'AC'                         04333323
043334     END-EXEC.                                                    04333423
043335                                                                  04333523
043336     EVALUATE TRUE                                                04333623
043337         WHEN SQLCODE = ZERO                                      04333723
043338              DISPLAY 'DC SHIPPED DATE (SUDSST): '                04333877
043339                                  PV-DC-SHIPPED-DATE              04333977
043340             CONTINUE                                             04334023
043341         WHEN SQLCODE = +100                                      04334123
043342              DISPLAY 'PARA 1200-TKRPRPM-DC-SHIPPED-DTE'          04334225
043343                       'PARM NOT FOUND'                           04334323
043344              DISPLAY 'SYS_PRC_FUNC_CDE =  SUDSST'                04334425
043345              MOVE '0001-01-01' TO PV-DC-SHIPPED-DATE             04334523
043346         WHEN OTHER                                               04334623
043347             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          04334723
043348             MOVE  '1200-TKRPRPM-DC-SHIPPED-DTE'                  04334825
043349                                   TO PV-ABEND-PARAGRAPH          04334923
043350             MOVE 'SYS_PRC_FUNC_CDE  = SUDSST'                    04335025
043351                                   TO PV-ABEND-OPERATION          04335123
043352             MOVE 'CHECKING STORE DC SHPD PARM'                   04335225
043353                                   TO PV-DB2-OPERATION-MESSAGE-1  04335323
043354             MOVE 'TKRPRPM'        TO PV-ABEND-STRUCTURE-1        04335423
043355             PERFORM 9900-DB2-ABEND                               04335523
043356     END-EVALUATE.                                                04335623
043357                                                                  04335723
043358******************************************************************04335845
043359*  READ PARM TABLE TO USE TO DETERMINE THE NUMBER OF DAYS BACK    04335945
043360*  A PREVIOUS TRAILER HAS BEEN IN STORE OPEN STATUS               04336045
043362******************************************************************04336245
043363 1300-TKRPRPM-SO-PRIOR-DTE.                                       04336373
043364                                                                  04336445
043365     EXEC SQL                                                     04336545
043366         SELECT  (CURRENT DATE - FUNC_QTY DAYS)                   04336645
043367           INTO  :PV-STORE-OPEN-PREV                              04336745
043368           FROM  TKRPRPM                                          04336845
043369          WHERE  LOC_ID            = 90                           04336945
043370            AND  INTFC_SYS_CDE     = 'KHL'                        04337045
043371            AND  SYS_PRC_FUNC_CDE  = 'SUSOPR'                     04337145
043372            AND  FUNC_PRC_STAT_CDE = 'AC'                         04337245
043373     END-EXEC.                                                    04337345
043374                                                                  04337445
043375     EVALUATE TRUE                                                04337545
043376         WHEN SQLCODE = ZERO                                      04337645
043377              DISPLAY 'STORE OPEND PRE (SUSOPR): '                04337777
043378                                  PV-STORE-OPEN-PREV              04337877
043379         WHEN SQLCODE = +100                                      04337945
043380              DISPLAY 'PARA 1300-TKRPRPM-SO-PRIOR-DTE '           04338045
043381                       'PARM NOT FOUND'                           04338145
043382              DISPLAY 'SYS_PRC_FUNC_CDE =  SUSOPR'                04338245
043383              MOVE '0001-01-01' TO PV-STORE-OPEN-PREV             04338345
043384         WHEN OTHER                                               04338445
043385             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          04338545
043386             MOVE  '1300-TKRPRPM-SO-PRIOR-DTE '                   04338645
043387                                   TO PV-ABEND-PARAGRAPH          04338745
043388             MOVE 'SYS_PRC_FUNC_CDE  = SUSOPR'                    04338845
043389                                   TO PV-ABEND-OPERATION          04338945
043390             MOVE 'CHECKING STORE OPEN PREV PARM'                 04339045
043391                                   TO PV-DB2-OPERATION-MESSAGE-1  04339145
043392             MOVE 'TKRPRPM'        TO PV-ABEND-STRUCTURE-1        04339245
043393             PERFORM 9900-DB2-ABEND                               04339345
043394     END-EVALUATE.                                                04339445
043395                                                                  04339545
043396******************************************************************04339645
043397*  READ PARM TABLE TO USE TO DETERMINE THE NUMBER OF DAYS BACK    04339745
043398*  A PREVIOUS TRAILER HAS BEEN IN DC SHIPPED STATUS               04339845
043399******************************************************************04339945
043400 1400-TKRPRPM-DS-PRIOR-DTE.                                       04340045
043401                                                                  04340145
043402     EXEC SQL                                                     04340245
043403         SELECT  (CURRENT DATE - FUNC_QTY DAYS)                   04340345
043404           INTO  :PV-DC-SHIPPED-PREV                              04340445
043405           FROM  TKRPRPM                                          04340545
043406          WHERE  LOC_ID            = 90                           04340645
043407            AND  INTFC_SYS_CDE     = 'KHL'                        04340745
043408            AND  SYS_PRC_FUNC_CDE  = 'SUDSPR'                     04340845
043409            AND  FUNC_PRC_STAT_CDE = 'AC'                         04340945
043410     END-EXEC.                                                    04341045
043411                                                                  04341145
043412     EVALUATE TRUE                                                04341245
043413         WHEN SQLCODE = ZERO                                      04341345
043414              DISPLAY 'DC SHIPPED PREV (SUDSPR): '                04341477
043415                              PV-DC-SHIPPED-PREV                  04341577
043416         WHEN SQLCODE = +100                                      04341645
043417              DISPLAY 'PARA 1400-TKRPRPM-DS-PRIOR-DTE '           04341745
043418                       'PARM NOT FOUND'                           04341845
043419              DISPLAY 'SYS_PRC_FUNC_CDE =  SUSOPR'                04341945
043420              MOVE '0001-01-01' TO PV-DC-SHIPPED-PREV             04342046
043421         WHEN OTHER                                               04342145
043422             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          04342245
043423             MOVE  '1400-TKRPRPM-DS-PRIOR-DTE '                   04342345
043424                                   TO PV-ABEND-PARAGRAPH          04342445
043425             MOVE 'SYS_PRC_FUNC_CDE  = SUDSST'                    04342545
043426                                   TO PV-ABEND-OPERATION          04342645
043427             MOVE 'CHECKING STORE OPEN PREV PARM'                 04342745
043428                                   TO PV-DB2-OPERATION-MESSAGE-1  04342845
043429             MOVE 'TKRPRPM'        TO PV-ABEND-STRUCTURE-1        04342945
043430             PERFORM 9900-DB2-ABEND                               04343045
043431     END-EVALUATE.                                                04343145
043432                                                                  04343245
043433******************************************************************04343364
043434*  READ PARM TABLE TO USE TO DETERMINE THE NUMBER OF DAYS BACK    04343464
043435*  SINCE THE LATEST SU STATUS AS IT RELATES TO A PRIOR TRAILER IN 04343564
043436*  DS - DC SHIPPED STATUS                                         04343664
043437*  DAYS BACK TRIP 235779559 HAS BEEN IN SU STATUS                 04343764
043438*  SCAC  TRAILER ID    SERIAL #     TRIP    STATUS    DATE     SLO04343864
043439*  KOHL RPK202309201  380443034   235779559   SU   09/19/2023  D0604343964
043440*  KOHL RPK202309202  532523254   235779560   DS   09/16/2023  D0604344064
043441******************************************************************04344164
043442 1500-TKRPRPM-SU-CURR-TRIP-DS.                                    04344264
043443                                                                  04344364
043444     EXEC SQL                                                     04344464
043445         SELECT  (CURRENT DATE - FUNC_QTY DAYS)                   04344564
043446           INTO  :PV-DS-SU-TRIP-DTE                               04344664
043447           FROM  TKRPRPM                                          04344764
043448          WHERE  LOC_ID            = 90                           04344864
043449            AND  INTFC_SYS_CDE     = 'KHL'                        04344964
043450            AND  SYS_PRC_FUNC_CDE  = 'SUSUDS'                     04345064
043451            AND  FUNC_PRC_STAT_CDE = 'AC'                         04345164
043452     END-EXEC.                                                    04345264
043453                                                                  04345364
043454     EVALUATE TRUE                                                04345464
043455         WHEN SQLCODE = ZERO                                      04345564
043456              DISPLAY 'DS/SU SHIP PREV (SUSUDS): '                04345677
043457                       PV-DS-SU-TRIP-DTE                          04345777
043458         WHEN SQLCODE = +100                                      04345864
043459              DISPLAY 'PARA 1500-TKRPRPM-SU-CURRENT-TRIP'         04345964
043460                       'PARM NOT FOUND'                           04346064
043461              DISPLAY 'SYS_PRC_FUNC_CDE =  SUSUDS'                04346164
043462              MOVE '0001-01-01' TO PV-DC-SHIPPED-PREV             04346264
043463         WHEN OTHER                                               04346364
043464             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          04346464
043465             MOVE  '1500-TKRPRPM-SU-CURRENT-TRIP'                 04346564
043466                                   TO PV-ABEND-PARAGRAPH          04346664
043467             MOVE 'SYS_PRC_FUNC_CDE  = SUSUDS'                    04346764
043468                                   TO PV-ABEND-OPERATION          04346864
043469             MOVE 'CHECKING STORE UNLD PREV PARM'                 04346964
043470                                   TO PV-DB2-OPERATION-MESSAGE-1  04347064
043471             MOVE 'TKRPRPM'        TO PV-ABEND-STRUCTURE-1        04347164
043472             PERFORM 9900-DB2-ABEND                               04347264
043473     END-EVALUATE.                                                04347364
043474                                                                  04347464
043475******************************************************************04347564
043476*  READ PARM TABLE TO USE TO DETERMINE THE NUMBER OF DAYS BACK    04347664
043477*  SINCE THE LATEST SU STATUS AS IT RELATES TO A PRIOR TRAILER IN 04347764
043478*  SO - STORE OPEN STATUS                                         04347864
043481******************************************************************04348164
043482 1600-TKRPRPM-SU-CURR-TRIP-SO.                                    04348264
043483                                                                  04348364
043484     EXEC SQL                                                     04348464
043485         SELECT  (CURRENT DATE - FUNC_QTY DAYS)                   04348564
043486           INTO  :PV-SO-SU-TRIP-DTE                               04348664
043487           FROM  TKRPRPM                                          04348764
043488          WHERE  LOC_ID            = 90                           04348864
043489            AND  INTFC_SYS_CDE     = 'KHL'                        04348964
043490            AND  SYS_PRC_FUNC_CDE  = 'SUSUSO'                     04349064
043491            AND  FUNC_PRC_STAT_CDE = 'AC'                         04349164
043492     END-EXEC.                                                    04349264
043493                                                                  04349364
043494     EVALUATE TRUE                                                04349464
043495         WHEN SQLCODE = ZERO                                      04349564
043496              DISPLAY 'SO/SU SHIP PREV (SUSUSO): '                04349677
043497                            PV-SO-SU-TRIP-DTE                     04349777
043498         WHEN SQLCODE = +100                                      04349864
043499              DISPLAY 'PARA 1600-TKRPRPM-SU-CURR-TRIP-SO'         04349964
043500                       'PARM NOT FOUND'                           04350064
043501              DISPLAY 'SYS_PRC_FUNC_CDE =  SUSUSO'                04350164
043502              MOVE '0001-01-01' TO PV-DC-SHIPPED-PREV             04350264
043503         WHEN OTHER                                               04350364
043504             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          04350464
043505             MOVE  '1600-TKRPRPM-SU-CURR-TRIP-SO'                 04350564
043506                                   TO PV-ABEND-PARAGRAPH          04350664
043507             MOVE 'SYS_PRC_FUNC_CDE  = SUSUDS'                    04350764
043508                                   TO PV-ABEND-OPERATION          04350864
043509             MOVE 'CHECKING STORE UNLD PREV PARM'                 04350964
043510                                   TO PV-DB2-OPERATION-MESSAGE-1  04351064
043511             MOVE 'TKRPRPM'        TO PV-ABEND-STRUCTURE-1        04351164
043512             PERFORM 9900-DB2-ABEND                               04351264
043513     END-EVALUATE.                                                04351364
043514                                                                  04351464
043515******************************************************************04351564
043516*  FIND ALL TRIP IDS ON THE TSUOBTS TABLE THAT ARE AGING          04351664
043517*  AND WRITE TO OUTPUT FILE                                       04351764
043518******************************************************************04351864
043519 2000-PROCESS-TSUOBTS-TRIP-IDS.                                   04351964
043520     MOVE +0 TO PV-TRIP-IDS-FETCHED                               04352064
043521                PV-DC-SHIPPED-COUNT                               04352164
043522                PV-STORE-OPEN-COUNT                               04352264
043523                PV-STORE-OPN-PRE-CNT                              04352364
043524                PV-DC-SHIPPED-PRE-CNT.                            04352464
043525     SET PS-NOT-END-OF-TSUOBTS-CSR TO TRUE.                       04352564
043526     PERFORM 2100-OPEN-TSUOBTS-CSR.                               04352664
043527     PERFORM 2200-FETCH-TSUOBTS-CSR.                              04352764
043530     PERFORM 2300-PROCESS-TSUOBTS-CSR UNTIL                       04353064
043600             PS-END-OF-TSUOBTS-CSR.                               04360007
043700     PERFORM 2400-CLOSE-TSUOBTS-CSR.                              04370007
043800                                                                  04380007
043900                                                                  04390007
044000******************************************************************04400007
044100*  OPEN TSUOBTS TRIP ID CURSOR.                                   04410007
044200******************************************************************04420007
044300 2100-OPEN-TSUOBTS-CSR.                                           04430007
044400                                                                  04440007
044500     EXEC SQL                                                     04450007
044600         OPEN TSUOBTS-CSR                                         04460007
044700     END-EXEC.                                                    04470007
044800                                                                  04480007
044900     EVALUATE TRUE                                                04490007
045000         WHEN SQLCODE = ZERO                                      04500007
045100             CONTINUE                                             04510007
045200         WHEN OTHER                                               04520007
045300             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          04530007
045400             MOVE  '2100-OPEN-TSUOBTS-CSR '                       04540007
045500                                   TO PV-ABEND-PARAGRAPH          04550007
045600             MOVE 'OPEN CURSOR '                                  04560007
045700                                   TO PV-ABEND-OPERATION          04570007
045800             MOVE 'TSUOBTS'        TO PV-ABEND-STRUCTURE-1        04580007
045900             PERFORM 9900-DB2-ABEND                               04590007
046000     END-EVALUATE.                                                04600007
046100                                                                  04610007
046200                                                                  04620007
046300******************************************************************04630007
046400*  FETCH TSUOBTS TRIP ID CURSOR ROW.                              04640007
046500******************************************************************04650007
046600 2200-FETCH-TSUOBTS-CSR.                                          04660007
046700     EXEC SQL                                                     04670007
046800        FETCH TSUOBTS-CSR                                         04680007
046900         INTO  :PV-UNION-TYPE                                     04690010
047000             , :SUOBTS-OTBND-TRIP-ID                              04700007
047100             , :SUOBTS-TRIP-STAT-CDE                              04710010
047200             , :SUOBTR-DEST-OPER-UNT-ID                           04720010
047220             , :SUOBTS-DOOR-ID                                    04722010
047230             , :SUOBTS-TRLR-SEAL-ID                               04723010
047240             , :SUOBTS-SHIP-SCAC-CDE                              04724010
047250             , :SUOBTS-OTBND-STAT-TMST                            04725032
047260             , :SUOBTS-STAT-OPER-UNT-ID                           04726049
047400     END-EXEC.                                                    04740007
047500                                                                  04750007
047600     EVALUATE TRUE                                                04760007
047700         WHEN SQLCODE = ZERO                                      04770007
047701            DISPLAY                                               04770174
047710            'TRIP ID BEING PROCESSED IS ' SUOBTS-OTBND-TRIP-ID    04771074
047720             '-' PV-UNION-TYPE                                    04772074
047800             ADD +1 TO PV-TRIP-IDS-FETCHED                        04780007
047810             IF PV-UNION-TYPE = 'A'                               04781047
047811                ADD +1 TO PV-DC-SHIPPED-COUNT                     04781131
047820             ELSE                                                 04782031
047821                IF PV-UNION-TYPE = 'B'                            04782147
047822                   ADD +1 TO PV-STORE-OPEN-COUNT                  04782247
047840                ELSE                                              04784047
047850                   IF PV-UNION-TYPE = 'C'                         04785047
047860                      ADD +1 TO PV-STORE-OPN-PRE-CNT              04786048
047861                      DISPLAY 'STR OPEN PRV ' SUOBTS-OTBND-TRIP-ID04786155
047870                   ELSE                                           04787047
047880                      IF PV-UNION-TYPE = 'D'                      04788047
047890                         ADD +1 TO PV-DC-SHIPPED-PRE-CNT          04789048
047891                      END-IF                                      04789147
047892                   END-IF                                         04789247
047893                END-IF                                            04789347
047894             END-IF                                               04789447
047900         WHEN SQLCODE = +100                                      04790007
048000             SET PS-END-OF-TSUOBTS-CSR     TO  TRUE               04800007
048100         WHEN OTHER                                               04810007
048200             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          04820007
048300             MOVE  '2200-FETCH-TSUOBTS-CSR'                       04830007
048400                                   TO PV-ABEND-PARAGRAPH          04840007
048500             MOVE 'FETCH CURSOR '                                 04850007
048600                                   TO PV-ABEND-OPERATION          04860007
048700             MOVE 'TSUOBTS'        TO PV-ABEND-STRUCTURE-1        04870007
048800             PERFORM 9900-DB2-ABEND                               04880007
048900     END-EVALUATE.                                                04890007
049000                                                                  04900007
049100******************************************************************04910007
049200*  PROCESS TSUOBTS TRIP ID CURSOR ROW.                            04920007
049300******************************************************************04930007
049400 2300-PROCESS-TSUOBTS-CSR.                                        04940007
049500                                                                  04950007
051400     IF SUOBTS-TRIP-STAT-CDE  = PC-DS                             05140050
051401        PERFORM 3000-DIVERTED-TRAILER-CHECK                       05140153
051403        MOVE SUOBTR-DEST-OPER-UNT-ID  TO SU175-STAT-OPER-UNT-ID   05140379
051405     ELSE                                                         05140579
051406         MOVE SUOBTS-STAT-OPER-UNT-ID  TO SU175-STAT-OPER-UNT-ID  05140679
051407     END-IF                                                       05140750
051412     MOVE SUOBTS-OTBND-TRIP-ID     TO SU175-OTBND-TRIP-ID.        05141212
051413     MOVE SUOBTS-TRIP-STAT-CDE     TO SU175-TRIP-STAT-CDE.        05141312
051414     MOVE SUOBTR-DEST-OPER-UNT-ID  TO SU175-DEST-OPER-UNT-ID.     05141412
051415     MOVE SUOBTS-DOOR-ID           TO SU175-DOOR-ID.              05141512
051416     MOVE SUOBTS-TRLR-SEAL-ID      TO SU175-TRLR-SEAL-ID.         05141612
051417     MOVE SUOBTS-SHIP-SCAC-CDE     TO SU175-SHIP-SCAC-CDE.        05141712
051418     MOVE SUOBTS-OTBND-STAT-TMST   TO SU175-OTBND-STAT-TMST.      05141833
051419     MOVE PV-UNION-TYPE            TO SU175-TRIP-AGING-SW.        05141957
051422                                                                  05142279
051423     PERFORM 8000-WRITE-OTBND-TRIP-FILE.                          05142317
051430                                                                  05143011
051500     PERFORM 2200-FETCH-TSUOBTS-CSR.                              05150007
051600                                                                  05160007
051700******************************************************************05170007
051800*  CLOSE TSUOBTS TRIP ID CURSOR.                                  05180007
051900******************************************************************05190007
052000 2400-CLOSE-TSUOBTS-CSR.                                          05200007
052100     EXEC SQL                                                     05210007
052200        CLOSE TSUOBTS-CSR                                         05220007
052300     END-EXEC.                                                    05230007
052400                                                                  05240007
052500     EVALUATE TRUE                                                05250007
052600         WHEN SQLCODE = ZERO                                      05260007
052700             CONTINUE                                             05270007
052800         WHEN OTHER                                               05280007
052900             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          05290007
053000             MOVE  '2400-CLOSE-TSUOBTS-CSR'                       05300007
053100                                   TO PV-ABEND-PARAGRAPH          05310007
053200             MOVE 'CLOSE CURSOR '                                 05320007
053300                                   TO PV-ABEND-OPERATION          05330007
053400             MOVE 'TSUOBTS'        TO PV-ABEND-STRUCTURE-1        05340007
053500             PERFORM 9900-DB2-ABEND                               05350007
053600     END-EVALUATE.                                                05360007
053860                                                                  05386050
053861******************************************************************05386150
053862*  CHECK PARM TABLE TO SEE IF TRAILER WAS DIVERTED.               05386250
053863*  IF AN ENTRY IS FOUND, USE THE STORE NUMBER AS THE DESTINATION  05386360
053864*  ON THE OUTPUT FILE                                             05386460
053865******************************************************************05386560
053866 3000-DIVERTED-TRAILER-CHECK.                                     05386660
053867                                                                  05386760
053868     MOVE SUOBTS-OTBND-TRIP-ID    TO PV-DISPLAY-TRIP-ID.          05386860
053869                                                                  05386960
053870     EXEC SQL                                                     05387060
053871      SELECT D.ATTR_ELEM_NBR                                      05387160
053872        INTO :PV-ELEM-STORE                                       05387260
053873        FROM WST_INTGRTN_TYP A                                    05387360
053874           , WST_ATTR_DEFN   B                                    05387460
053875           , WST_ATTR_ELEM   C                                    05387560
053876           , WST_ATTR_ELEM   D                                    05387660
053877           , WST_ATTR_ELEM   E                                    05387760
053878           , WST_ATTR_ELEM   F                                    05387860
053879       WHERE A.INTGRTN_TYP_CDE   = 'TRLRDIVERT'                   05387960
053880         AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE              05388060
053881         AND B.ATTR_DEFN_SEQ_NBR = 1                              05388160
053882         AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE              05388260
053883         AND C.ATTR_DEFN_SEQ_NBR = 1                              05388360
053884         AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE              05388460
053885         AND D.ATTR_DEFN_SEQ_NBR = 2                              05388560
053886         AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE              05388660
053887         AND E.ATTR_DEFN_SEQ_NBR = 3                              05388760
053888         AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE              05388860
053889         AND F.ATTR_DEFN_SEQ_NBR = 4                              05388960
053890         AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR            05389060
053891         AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR            05389160
053892         AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR            05389260
053893         AND C.ATTR_ELEM_NBR     = :SUOBTS-OTBND-TRIP-ID          05389360
053894         AND E.ATTR_ELEM_TMST   <=  CURRENT TIMESTAMP             05389460
053895         AND F.ATTR_ELEM_TMST   >=  CURRENT TIMESTAMP             05389560
053896         WITH UR                                                  05389660
053897     END-EXEC.                                                    05389760
053898                                                                  05389860
053906                                                                  05390650
053907     EVALUATE TRUE                                                05390750
053908         WHEN SQLCODE = ZERO                                      05390850
053909         WHEN SQLCODE = -811                                      05390981
053910              MOVE PV-ELEM-STORE TO SUOBTR-DEST-OPER-UNT-ID       05391081
053911              DISPLAY 'TRAILER WAS DIVERTED FOR TRIP ID '         05391181
053912              PV-DISPLAY-TRIP-ID  ' TO STORE '                    05391281
053913                  SUOBTR-DEST-OPER-UNT-ID                         05391381
053914              SET PS-DIVERTED-TRAILER-YES TO TRUE                 05391481
053915         WHEN SQLCODE = +100                                      05391581
053916              SET PS-DIVERTED-TRAILER-NO  TO TRUE                 05391681
053960         WHEN OTHER                                               05396050
053970             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          05397050
053980             MOVE  '3000-DIVERTED-TRAILER-CHECK '                 05398051
053990                                   TO PV-ABEND-PARAGRAPH          05399050
053991             MOVE 'SELECT WST_* TABLES '                          05399151
053992                                   TO PV-ABEND-OPERATION          05399250
053993             MOVE 'CHECKING IF TRIP WAS DIVERTED '                05399351
053994                                   TO PV-DB2-OPERATION-MESSAGE-1  05399450
053995             MOVE PV-DISPLAY-TRIP-ID                              05399551
053996                                   TO PV-DB2-OPERATION-MESSAGE-2  05399651
053997             MOVE 'WST_INT'        TO PV-ABEND-STRUCTURE-1        05399751
053998             PERFORM 9900-DB2-ABEND                               05399850
053999     END-EVALUATE.                                                05399950
054000                                                                  05400050
054100******************************************************************05410007
071100******************************************************************07110007
071200*  WRITE ASSUMPTIVE CARTON OUTPUT FILE.                           07120007
071300******************************************************************07130007
071400 8000-WRITE-OTBND-TRIP-FILE.                                      07140007
071500                                                                  07150007
071900                                                                  07190007
072000     WRITE OTBND-TRIP-RECORD-OUT                                  07200007
072100      FROM SU175-AGING-TRIP-REC.                                  07210011
072200                                                                  07220007
072300     ADD +1 TO PV-TOTAL-WRITE-COUNT.                              07230011
072500                                                                  07250007
072600                                                                  07260007
072700******************************************************************07270007
072800*  CLOSE OUTPUT FILES.  DISPLAY COUNTS.                           07280007
072900******************************************************************07290007
073000 9000-EOJ-ROUTINE.                                                07300007
073200     CLOSE OTBND-TRIP-FILE-OUT.                                   07320012
073300                                                                  07330007
073400     MOVE PV-TRIP-IDS-FETCHED          TO  PV-DISPLAY-COUNT.      07340007
073500     DISPLAY 'TOTAL TRIP IDS FETCHED.: '   PV-DISPLAY-COUNT.      07350031
073600     DISPLAY '                         '.                         07360007
073700                                                                  07370007
073800     MOVE PV-DC-SHIPPED-COUNT          TO  PV-DISPLAY-COUNT.      07380031
073900     DISPLAY 'DC SHIPPED COUNT.......: '   PV-DISPLAY-COUNT.      07390031
074100     MOVE PV-STORE-OPEN-COUNT          TO  PV-DISPLAY-COUNT.      07410031
074200     DISPLAY 'STORE OPEN COUNT.......: '   PV-DISPLAY-COUNT.      07420031
074210     MOVE PV-STORE-OPN-PRE-CNT         TO  PV-DISPLAY-COUNT.      07421048
074220     DISPLAY 'STORE OPEN PREVIOUS....: '   PV-DISPLAY-COUNT.      07422047
074230     MOVE PV-DC-SHIPPED-PRE-CNT        TO  PV-DISPLAY-COUNT.      07423048
074240     DISPLAY 'DC SHIPPED PREVIOUS....: '   PV-DISPLAY-COUNT.      07424047
074300     MOVE PV-TOTAL-WRITE-COUNT         TO  PV-DISPLAY-COUNT.      07430007
074400     DISPLAY 'TOTAL RECORDS WRITTEN..: '   PV-DISPLAY-COUNT.      07440007
074500     DISPLAY '                       '.                           07450007
074600     DISPLAY '*****  SUKUT209 ENDED  *****'.                      07460007
074700                                                                  07470007
074800                                                                  07480007
074900******************************************************************07490007
075000*  FORMAT DB2 ABEND MESSAGES AND ABEND.                           07500007
075100******************************************************************07510007
075200 9900-DB2-ABEND.                                                  07520007
075300                                                                  07530007
075400     DISPLAY '*** DB2 ERROR '.                                    07540007
075500     DISPLAY '*** SQLCODE   = ' PV-DISPLAY-SQLCODE                07550007
075600     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM                  07560007
075700     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               07570007
075800     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               07580007
075900     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       07590007
076000     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       07600007
076100     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       07610007
076200     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             07620007
076300     DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2.             07630007
076400                                                                  07640007
076500                                                                  07650007
076600     COPY DPPD004.                                                07660007
076700                                                                  07670007
076800     IF SQLCODE NOT = -911                                        07680007
076900         EXEC SQL                                                 07690007
077000              ROLLBACK                                            07700007
077100         END-EXEC                                                 07710007
077200     END-IF.                                                      07720007
077300                                                                  07730007
077400     MOVE +4013                  TO PV-ABEND-CODE.                07740007
077500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         07750007
077600                                                                  07760007
