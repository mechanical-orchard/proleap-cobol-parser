000100*-----------------------*                                         00010034
000200 IDENTIFICATION DIVISION.                                         00020034
000300*-----------------------*                                         00030034
000400 PROGRAM-ID.    ETKCS351.                                         00040034
000500 AUTHOR.        DAN GRUBER.                                       00050034
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060034
000700 DATE-WRITTEN.  09-26-96.                                         00070034
000800 DATE-COMPILED.                                                   00080034
000900*                                                                 00090034
001000*----------------------------------------------------------------*00100034
001100*    E351 - ET-SIZE MAINTENANCE CRITERIA SELECTION               *00110034
001200*                                                                *00120034
001300*    THIS PROGRAM IS THE ENTRY POINT TO THE ET SIZE MAINTENANCE  *00130034
001400*    SYSTEM.  THIS IS THE INITIAL PROGRAM WHICH ALLOWS THE USER  *00140034
001500*    TO ENTER THE SIZE GROUP, NRF SIZE CODE, KOHLS DESCRIPTION,  *00150034
001600*    AND WHETHER OR NOT TO INCLUDE EXPIRED SIZES.  THE USER CAN  *00160034
001700*    ADD, INQUIRE, UPDATE OR DELETE SIZES.  A SELECTION LIST OF  *00170034
001800*    SIZES CAN ALSO BE DISPLAYED FOR THE USER TO PERFORM ACTIONS *00180034
001900*    AGAINST A PARTICULAR SIZE.                                  *00190034
002000*                                                                *00200034
002100*    AFTER THE INFORMATION IS ENTERED AND VERIFIED BY THE        *00210034
002200*    PROGRAM, THE PROGRAM TRANFERS CONTROL TO THE APPROPRIATE    *00220034
002300*    PROGRAM DEPENDING ON WHICH PFK KEY IS HIT.                  *00230034
002400*                                                                *00240034
002500*    PF13 - SIZE ADD      (E352 - PROGRAM ETKCS352).             *00250034
002600*    PF14 - SIZE INQUIRY  (E354 - PROGRAM ETKCS354).             *00260034
002700*    PF15 - SIZE UPDATE   (E352 - PROGRAM ETKCS352).             *00270034
002800*    PF16 - SIZE DELETE   (E352 - PROGRAM ETKCS352).             *00280034
002900*    PF17 - SIZE LIST     (E353 - PROGRAM ETKCS353).             *00290034
003000*                                                                *00300034
003100*    AFTER THE REQUESTED PROCESSING IS COMPLETE AND THE PF3 KEY  *00310034
003200*    IS HIT, CONTROL IS RETURNED BACK TO THIS PROGRAM.           *00320034
003300*                                                                *00330034
003400*----------------------------------------------------------------*00340034
003410* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00341036
003420*            - CHANGE CALL OF DPKUT100 TO                       * 00342036
003430*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00343036
003440*              MAKING THE CALL DYNAMIC VS STATIC                * 00344036
003450*                                                               * 00345036
003460*---------------------------------------------------------------* 00346036
CICS  *  CHANGED 10/28/2022    BY BARB SCHULTZ    WR: CHG0277210      * 00348037
CICS  *                                                               * 00349037
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00349137
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00349237
CICS  *                                                               * 00349337
CICS  *---------------------------------------------------------------* 00349437
003500                                                                  00350034
003600                                                                  00360034
003700 ENVIRONMENT DIVISION.                                            00370034
003800                                                                  00380034
003900 DATA DIVISION.                                                   00390034
004000                                                                  00400034
004100 WORKING-STORAGE SECTION.                                         00410034
004200                                                                  00420034
004300 01  PC-PROGRAM-CONSTANTS.                                        00430034
004400     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'ET351A  '. 00440034
004500     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'ETKM351 '. 00450034
004600     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'ETKCS351'. 00460034
004700     05  PC-EXP-SIZE-IND-DEFAULT   PIC  X(01)  VALUE  'N'.        00470034
004800     05  PC-TSYMSG-NUMBERS.                                       00480034
004900         10  PC-TSYMSG-00005       PIC  9(05)  VALUE  00005.      00490034
005000         10  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.      00500034
005100         10  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.      00510034
005200         10  PC-TSYMSG-00349       PIC  9(05)  VALUE  00349.      00520034
005300         10  PC-TSYMSG-01425       PIC  9(05)  VALUE  01425.      00530034
005400                                                                  00540034
005500 01  PV-PROGRAM-VARIABLES.                                        00550034
005600     05  PV-SIZE-GP-CODE           PIC S9(04)  COMP               00560034
005700                                               VALUE ZEROES.      00570034
005800     05  PV-SIZE-GP-DESC           PIC  X(30)  VALUE SPACES.      00580034
005900     05  PV-SIZE-GP-CODE-N         PIC  9(02)  VALUE ZEROES.      00590034
006000     05  PV-SIZE-GP-CODE-X         PIC  X(02)  VALUE SPACES.      00600034
006100     05  PV-NRF-SIZE-CODE-N        PIC  9(05)  VALUE ZEROES.      00610034
006200     05  PV-NRF-SIZE-CODE-X        PIC  X(05)  VALUE SPACES.      00620034
006300                                                                  00630034
006400 01  PS-PROGRAM-SWITCHES.                                         00640034
006500     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        00650034
006600         88  PS-ERROR                          VALUE  'Y'.        00660034
006700         88  PS-NO-ERROR                       VALUE  'N'.        00670034
006800     05  PS-SIZE-GP-DESC-SW        PIC  X(01)  VALUE  'N'.        00680034
006900         88  PS-SIZE-GP-DESC-FOUND             VALUE  'Y'.        00690034
007000         88  PS-SIZE-GP-DESC-NOT-FOUND         VALUE  'N'.        00700034
007100                                                                  00710034
007200 01  PM-PROGRAM-MESSAGES.                                         00720034
007300     05  PM-ABEND-INFO-A.                                         00730034
007400         10  FILLER                PIC X(15)   VALUE              00740034
007500                                   'DP020-SRC-AID: '.             00750034
007600         10  PM-A-SRC-AID          PIC X(02)   VALUE  SPACE.      00760034
007700         10  FILLER                PIC X(19)   VALUE              00770034
007800                                   '. DP020-FK-ACTION: '.         00780034
007900         10  PM-A-FK-ACTION        PIC X(01)   VALUE  SPACE.      00790034
008000         10  FILLER                PIC X(22)   VALUE              00800034
008100                                   '. DP020-FK-DISPN-IND: '.      00810034
008200         10  PM-A-FK-DISPN         PIC X(01)   VALUE  SPACE.      00820034
008300         10  FILLER                PIC X(01)   VALUE '.'.         00830034
008400         10  FILLER                PIC X(19)   VALUE SPACE.       00840034
008500                                                                  00850034
008600                                                                  00860034
008700*----------------------------------------------------------------*00870034
008800*    MAP LAYOUT                                                  *00880034
008900*----------------------------------------------------------------*00890034
009000                                                                  00900034
009100     COPY ETKM351.                                                00910034
009200 EJECT                                                            00920034
009300*----------------------------------------------------------------*00930034
009400*    ATTRIBUTE SETTINGS COPYBOOK.                                *00940034
009500*----------------------------------------------------------------*00950034
009600                                                                  00960034
009700     COPY DPWS015.                                                00970034
009800                                                                  00980034
009900*----------------------------------------------------------------*00990034
010000*    FUNCTION KEYS COPYBOOK                                      *01000034
010100*----------------------------------------------------------------*01010034
010200                                                                  01020034
010300     COPY DPWS016.                                                01030034
010400 EJECT                                                            01040034
010500******************************************************************01050034
010600** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01060034
010700** SUB-ROUTINE (DPKUT100).                                      **01070034
010800******************************************************************01080034
010900     COPY DPWS010I.                                               01090034
011000 EJECT                                                            01100034
011100******************************************************************01110034
CICS  ** PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.            **01120037
011400******************************************************************01140034
011500     COPY DPWS030.                                                01150034
CICS       COPY DPWS930.                                                01151037
011600 EJECT                                                            01160034
011700***************************************************************** 01170034
011800*    STANDARD COMMAREA.                                           01180034
011900***************************************************************** 01190034
012000                                                                  01200034
012100     COPY DPWS020.                                                01210034
012200     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01220034
012300                                                                  01230034
012400***************************************************************** 01240034
012500*    INTER-APPLICATION COMMAREA.                                  01250034
012600***************************************************************** 01260034
012700                                                                  01270034
012800         10  INTER-APPL-COMM-AREA PIC X(200).                     01280034
012900     COPY ETWS351.                                                01290034
013000***************************************************************** 01300034
013100*    SPECIFIC COMMMAREA FOR ETKCS351 (2865 BYTES MAX).            01310034
013200***************************************************************** 01320034
013300         10  ASC-SPECIFIC-COMMAREA.                               01330034
013400             15  ASC-SIZE-GP-CODE            PIC  X(02).          01340034
013500             15  ASC-SIZE-GP-DESC            PIC  X(30).          01350034
013600             15  ASC-NRF-SIZE-CODE           PIC  X(05).          01360034
013700             15  ASC-KOHLS-DESC              PIC  X(10).          01370034
013800             15  ASC-EXP-SIZE-IND            PIC  X(01).          01380034
013900                                                                  01390034
014000     EJECT                                                        01400034
014100*----------------------------------------------------------------*01410034
014200*    ABEND PROCESSING COPYBOOK.                                  *01420034
014300*----------------------------------------------------------------*01430034
014400                                                                  01440034
014500     COPY DPWS013.                                                01450034
014600                                                                  01460034
014700***************************************************************** 01470034
014800*  SQL AND COBOL DECLARATIONS FOR THE SIZE GROUP TABLE            01480034
014900***************************************************************** 01490034
015000     EXEC SQL                                                     01500034
015100         INCLUDE TSIZEGP                                          01510034
015200     END-EXEC.                                                    01520034
015300                                                                  01530034
015400***************************************************************** 01540034
015500*  STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                01550034
015600***************************************************************** 01560034
015700                                                                  01570034
015800     EXEC SQL                                                     01580034
015900         INCLUDE SQLCA                                            01590034
016000     END-EXEC.                                                    01600034
016100                                                                  01610034
016200                                                                  01620034
016300 EJECT                                                            01630034
016400 LINKAGE SECTION.                                                 01640034
016500                                                                  01650034
016600 01  DFHCOMMAREA.                                                 01660034
016700     05  FILLER                         OCCURS  1 TO 4072 TIMES   01670034
016800                                        DEPENDING ON EIBCALEN.    01680034
016900         10  FILLER                     PIC X.                    01690034
017000                                                                  01700034
017100                                                                  01710034
017200 PROCEDURE DIVISION.                                              01720034
017300***************************************************************** 01730034
017400** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 01740034
017500** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 01750034
017600** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 01760034
017700**                                                             ** 01770034
017800** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 01780034
017900** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 01790034
018000***************************************************************** 01800034
018100 0000-MAIN-MODULE.                                                01810034
018200                                                                  01820034
018300     INITIALIZE DP030-CICS-API-FIELDS.                            01830034
018400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       01840034
018500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          01850034
018600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         01860034
018700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       01870034
018800     MOVE LENGTH OF ET351AI        TO DP030-MAP-LENGTH (1).       01880034
018900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     01890034
019000     PERFORM 0001-CALL-CICS-ARCH-API.                             01900034
019100*                                                                 01910034
019200     PERFORM 1000-CONTROL-PROCESSING                              01920034
019300*                                                                 01930034
019400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     01940034
019500     PERFORM 0001-CALL-CICS-ARCH-API.                             01950034
019600                                                                  01960034
019700******************************************************************01970034
019800**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **01980034
019900**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **01990034
020000******************************************************************02000034
020100 0001-CALL-CICS-ARCH-API.                                         02010034
020200                                                                  02020034
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02030038
020400                                    DFHCOMMAREA                   02040037
020500                                    DP030-CICS-API-FIELDS         02050037
020600                                    DP020-STANDARD-COMMAREA       02060037
020700                                    ET351AI.                      02070037
020800*                                                                 02080034
020900     IF  DP030-RC-CALL-SUCCESSFUL                                 02090034
021000         CONTINUE                                                 02100034
021100     ELSE                                                         02110034
021200         SET DP013-NO-ROLLBACK                                    02120034
021300             DP013-XCTL-DISPLAY-RESTART                           02130034
021400             DP013-CICS-ABEND      TO TRUE                        02140034
CICS           MOVE '0001-CALL-CICS-ARCH-API'                           02150037
021600                                   TO DP013-PARAGRAPH             02160034
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O02170037
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02180037
021900         MOVE DP030-RETURN-CODE                                   02190034
022000                                   TO DP013-MESSAGE-TEXT (3)      02200034
022100         PERFORM DP013-0000-PROCESS-ABEND                         02210034
022200     END-IF.                                                      02220034
022300                                                                  02230034
022400 EJECT                                                            02240034
022500*----------------------------------------------------------------*02250034
022600*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02260034
022700*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02270034
022800*----------------------------------------------------------------*02280034
022900                                                                  02290034
023000 1000-CONTROL-PROCESSING.                                         02300034
023100                                                                  02310034
023200     EVALUATE TRUE                                                02320034
023300         WHEN DP020-NEXT-ACT-INITIAL                              02330034
023400             INITIALIZE ASC-SPECIFIC-COMMAREA                     02340034
023500             PERFORM 4000-BUILD-INITIAL-PANEL                     02350034
023600                                                                  02360034
023700         WHEN DP020-NEXT-ACT-READ-MAP                             02370034
023800             PERFORM 2000-FKEY-PROCESSING                         02380034
023900                                                                  02390034
024000         WHEN DP020-NEXT-ACT-RETURN                               02400034
024100             MOVE ET351-NRF-SIZE-CODE  TO  ASC-NRF-SIZE-CODE      02410034
024200             MOVE ET351-KOHLS-DESC     TO  ASC-KOHLS-DESC         02420034
024300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02430034
024400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02440034
024500                                                                  02450034
024600         WHEN OTHER                                               02460034
024700             SET DP013-LOGIC-ABEND                                02470034
024800                 DP013-NO-ROLLBACK TO TRUE                        02480034
024900             MOVE '1000-CONTROL-PROCESSING'                       02490034
025000                                   TO  DP013-PARAGRAPH            02500034
025100             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   02510034
025200                                   TO  DP013-MESSAGE-TEXT(1)      02520034
025300             MOVE DP020-NEXT-APPL-ACTIVITY                        02530034
025400                                   TO DP013-MESSAGE-TEXT(2)       02540034
025500             PERFORM DP013-0000-PROCESS-ABEND                     02550034
025600     END-EVALUATE.                                                02560034
025700                                                                  02570034
025800*----------------------------------------------------------------*02580034
025900* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*02590034
026000* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*02600034
026100* EDITS.                                                         *02610034
026200*----------------------------------------------------------------*02620034
026300                                                                  02630034
026400 2000-FKEY-PROCESSING.                                            02640034
026500                                                                  02650034
026600     EVALUATE TRUE                                                02660034
026700                                                                  02670034
026800         WHEN DP020-SRC-AID = DP016-CLEAR                         02680034
026900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02690034
027000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02700034
027100                                                                  02710034
027200         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     02720034
027300             INITIALIZE ASC-SPECIFIC-COMMAREA                     02730034
027400             MOVE LOW-VALUES TO ET351AO                           02740034
027500             PERFORM 4000-BUILD-INITIAL-PANEL                     02750034
027600             PERFORM 3200-RESET-ATTRIBUTES                        02760034
027700                                                                  02770034
027800         WHEN OTHER                                               02780034
027900             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 02790034
028000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02800034
028100             IF  PS-NO-ERROR                                      02810034
028200                 SET DP030-CONTINUE-GO TO TRUE                    02820034
028300                 PERFORM 2100-CHECK-FUNCTION-KEY                  02830034
028400             ELSE                                                 02840034
028500                 SET DP030-OVERRIDE-GO TO TRUE                    02850034
028600             END-IF                                               02860034
028700     END-EVALUATE.                                                02870034
028800                                                                  02880034
028900******************************************************************02890034
029000** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **02900034
029100** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **02910034
029200** FROM THE CICS ARCHITECTURE API.                              **02920034
029300******************************************************************02930034
029400 2100-CHECK-FUNCTION-KEY.                                         02940034
029500     EVALUATE TRUE                                                02950034
029600         WHEN DP020-FK-DISPN-GO (DP020-SRC-AID)                   02960034
029700             PERFORM 2110-PREPARE-INTER-APPL-COMM                 02970034
029800                                                                  02980034
029900         WHEN DP020-SRC-AID = DP016-ENTER                         02990034
030000             CONTINUE                                             03000034
030100                                                                  03010034
030200         WHEN OTHER                                               03020034
030300             SET DP013-NO-ROLLBACK                                03030034
030400                 DP013-XCTL-DISPLAY-RESTART                       03040034
030500                 DP013-CICS-ABEND  TO TRUE                        03050034
030600             MOVE '2100-CHECK-FUNCTION-KEY'                       03060034
030700                                   TO DP013-PARAGRAPH             03070034
030800             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      03080034
030900                                   TO DP013-MESSAGE-TEXT (1)      03090034
031000             MOVE 'OR CODE MISSING FROM THIS PROGRAM TO PROCESS:' 03100034
031100                                   TO DP013-MESSAGE-TEXT (2)      03110034
031200             MOVE DP020-SRC-AID    TO PM-A-SRC-AID                03120034
031300             MOVE DP020-FK-ACTION (DP020-SRC-AID)                 03130034
031400                                   TO PM-A-FK-ACTION              03140034
031500             MOVE DP020-FK-DISPN-IND (DP020-SRC-AID)              03150034
031600                                   TO PM-A-FK-DISPN               03160034
031700             MOVE PM-ABEND-INFO-A  TO DP013-MESSAGE-TEXT (3)      03170034
031800             MOVE 'REVIEW PFKEYS SETUP FOR THIS MNEMONIC.'        03180034
031900                                   TO DP013-MESSAGE-TEXT (4)      03190034
032000             PERFORM DP013-0000-PROCESS-ABEND                     03200034
032100     END-EVALUATE.                                                03210034
032200                                                                  03220034
032300******************************************************************03230034
032400** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **03240034
032500** INTER-APPLICATION COMMAREA.                                  **03250034
032600******************************************************************03260034
032700 2110-PREPARE-INTER-APPL-COMM.                                    03270034
032800     INITIALIZE ET351-INTER-APPL-COMMAREA.                        03280034
032900     MOVE ASC-SIZE-GP-CODE         TO PV-SIZE-GP-CODE-N.          03290034
033000     MOVE PV-SIZE-GP-CODE-N        TO ET351-SIZE-GP-CODE.         03300034
033100     MOVE ASC-SIZE-GP-DESC         TO ET351-SIZE-GP-DESC.         03310034
033200     MOVE ASC-NRF-SIZE-CODE        TO ET351-NRF-SIZE-CODE.        03320034
033300     MOVE ASC-KOHLS-DESC           TO ET351-KOHLS-DESC.           03330034
033400     MOVE ASC-EXP-SIZE-IND         TO ET351-EXP-SIZE-IND.         03340034
033500                                                                  03350034
033600 EJECT                                                            03360034
033700*----------------------------------------------------------------*03370034
033800* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*03380034
033900* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *03390034
034000* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *03400034
034100*----------------------------------------------------------------*03410034
034200                                                                  03420034
034300 2200-MOVE-SCREEN-TO-COMMAREA.                                    03430034
034400     IF  ASZGPCDL > ZERO                                          03440034
034500         MOVE ASZGPCDI             TO ASC-SIZE-GP-CODE            03450034
034600     ELSE                                                         03460034
034700         IF  ASZGPCDF = DP015-ERASE-EOF                           03470034
034800             MOVE SPACE            TO ASC-SIZE-GP-CODE            03480034
034900         END-IF                                                   03490034
035000     END-IF.                                                      03500034
035100                                                                  03510034
035200     IF  ANRFCDL > ZERO                                           03520034
035300         MOVE ANRFCDI              TO ASC-NRF-SIZE-CODE           03530034
035400     ELSE                                                         03540034
035500         IF  ANRFCDF = DP015-ERASE-EOF                            03550034
035600             MOVE SPACE            TO ASC-NRF-SIZE-CODE           03560034
035700         END-IF                                                   03570034
035800     END-IF.                                                      03580034
035900                                                                  03590034
036000     IF  AKDESCL > ZERO                                           03600034
036100         MOVE AKDESCI              TO ASC-KOHLS-DESC              03610034
036200     ELSE                                                         03620034
036300         IF  AKDESCF = DP015-ERASE-EOF                            03630034
036400             MOVE SPACE            TO ASC-KOHLS-DESC              03640034
036500         END-IF                                                   03650034
036600     END-IF.                                                      03660034
036700                                                                  03670034
036800     IF  AEXPINDL > ZERO                                          03680034
036900         MOVE AEXPINDI             TO ASC-EXP-SIZE-IND            03690034
037000     ELSE                                                         03700034
037100         IF  AEXPINDF = DP015-ERASE-EOF                           03710034
037200             MOVE SPACE            TO ASC-EXP-SIZE-IND            03720034
037300         END-IF                                                   03730034
037400     END-IF.                                                      03740034
037500                                                                  03750034
037600*----------------------------------------------------------------*03760034
037700* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *03770034
037800* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *03780034
037900* A SPECIFIC SCREEN THAT THE USER IS GOING TO (DISPN-GO) ARE     *03790034
038000* DONE IN THE DESTINATION PROGRAM, NOT HERE.                     *03800034
038100*----------------------------------------------------------------*03810034
038200                                                                  03820034
038300 3000-EDIT-DATA-IN-COMMAREA.                                      03830034
038400                                                                  03840034
038500     PERFORM 3200-RESET-ATTRIBUTES.                               03850034
038600                                                                  03860034
038700***  THE SIZE GROUP CODE IS REQUIRED AND MUST BE NUMERIC.         03870034
038800                                                                  03880034
038900     IF  ASC-SIZE-GP-CODE > SPACE                                 03890034
039000         MOVE ASC-SIZE-GP-CODE     TO DP010I-UNEDITED-FIELD       03900034
039100         MOVE LENGTH OF ASC-SIZE-GP-CODE TO DP010I-MAXIMUM-DIGITS 03910034
039200         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     03920034
039300         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  03930034
039410         CALL DP010I-NUMERIC-EDIT-ROUTINE                         03941035
039420                         USING DP010I-NUMERIC-EDIT-AREA           03942035
039500         IF  DP010I-ERROR-DETECTED                                03950034
039600             MOVE DP015-UNP-ALP-BRT-OFF                           03960034
039700                                   TO ASZGPCDA                    03970034
039800             MOVE DP015-RED        TO ASZGPCDC                    03980034
039900             MOVE DP015-REVERSE    TO ASZGPCDH                    03990034
040000             IF  PS-NO-ERROR                                      04000034
040100                 SET PS-ERROR                                     04010034
040200                     DP030-SET-CURSOR-APPL-1                      04020034
040300                     DP020-MSG-FATAL     TO TRUE                  04030034
040400                 MOVE PC-TSYMSG-00008    TO DP020-MSG-NUMBER      04040034
040500                 MOVE -1                 TO ASZGPCDL              04050034
040600             END-IF                                               04060034
040700             MOVE SPACES           TO ASC-SIZE-GP-DESC            04070034
040800                                      ASZGPDSO                    04080034
040900         ELSE                                                     04090034
041000             MOVE DP010I-NUMERIC-FIELD                            04100034
041100                                   TO PV-SIZE-GP-CODE-N           04110034
041200             MOVE PV-SIZE-GP-CODE-N                               04120034
041300                                   TO ASC-SIZE-GP-CODE            04130034
041400             MOVE ASC-SIZE-GP-CODE TO ASZGPCDO                    04140034
041500             PERFORM 3100-GET-SIZE-GP-DESC                        04150034
041600             MOVE PV-SIZE-GP-DESC  TO ASC-SIZE-GP-DESC            04160034
041700                                      ASZGPDSO                    04170034
041800         END-IF                                                   04180034
041900     ELSE                                                         04190034
042000         MOVE DP015-UNP-ALP-BRT-OFF                               04200034
042100                               TO ASZGPCDA                        04210034
042200         MOVE DP015-RED        TO ASZGPCDC                        04220034
042300         MOVE DP015-REVERSE    TO ASZGPCDH                        04230034
042400         IF  PS-NO-ERROR                                          04240034
042500             SET PS-ERROR                                         04250034
042600                 DP030-SET-CURSOR-APPL-1                          04260034
042700                 DP020-MSG-FATAL     TO TRUE                      04270034
042800             MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER          04280034
042900             MOVE -1                 TO ASZGPCDL                  04290034
043000         END-IF                                                   04300034
043100         MOVE SPACES           TO ASC-SIZE-GP-DESC                04310034
043200                                  ASZGPDSO                        04320034
043300     END-IF.                                                      04330034
043400                                                                  04340034
043500***  THE NRF SIZE CODE IS REQUIRED AND MUST BE NUMERIC.           04350034
043600                                                                  04360034
043700     IF  ASC-NRF-SIZE-CODE > SPACE                                04370034
043800         MOVE ASC-NRF-SIZE-CODE    TO DP010I-UNEDITED-FIELD       04380034
043900         MOVE LENGTH OF ASC-NRF-SIZE-CODE                         04390034
044000                                   TO DP010I-MAXIMUM-DIGITS       04400034
044100         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     04410034
044200         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  04420034
044310         CALL DP010I-NUMERIC-EDIT-ROUTINE                         04431035
044320                         USING DP010I-NUMERIC-EDIT-AREA           04432035
044400         IF  DP010I-ERROR-DETECTED                                04440034
044500             MOVE DP015-UNP-ALP-BRT-OFF                           04450034
044600                                   TO ANRFCDA                     04460034
044700             MOVE DP015-RED        TO ANRFCDC                     04470034
044800             MOVE DP015-REVERSE    TO ANRFCDH                     04480034
044900             IF  PS-NO-ERROR                                      04490034
045000                 SET PS-ERROR                                     04500034
045100                     DP030-SET-CURSOR-APPL-1                      04510034
045200                     DP020-MSG-FATAL     TO TRUE                  04520034
045300                 MOVE PC-TSYMSG-00008    TO DP020-MSG-NUMBER      04530034
045400                 MOVE -1                 TO ANRFCDL               04540034
045500             END-IF                                               04550034
045600         ELSE                                                     04560034
045700             MOVE DP010I-NUMERIC-FIELD                            04570034
045800                                      TO PV-NRF-SIZE-CODE-N       04580034
045900             MOVE PV-NRF-SIZE-CODE-N  TO PV-NRF-SIZE-CODE-X       04590034
046000             MOVE ASC-SIZE-GP-CODE    TO PV-SIZE-GP-CODE-N        04600034
046100             MOVE PV-SIZE-GP-CODE-N   TO PV-SIZE-GP-CODE-X        04610034
046200             IF ( PV-SIZE-GP-CODE-X(2:1)  EQUAL                   04620034
046300                           PV-NRF-SIZE-CODE-X(1:1) )              04630034
046400                 MOVE PV-NRF-SIZE-CODE-X                          04640034
046500                                        TO ASC-NRF-SIZE-CODE      04650034
046600                 MOVE ASC-NRF-SIZE-CODE TO ANRFCDO                04660034
046700             ELSE                                                 04670034
046800                 MOVE DP015-UNP-ALP-BRT-OFF                       04680034
046900                                       TO ANRFCDA                 04690034
047000                 MOVE DP015-RED        TO ANRFCDC                 04700034
047100                 MOVE DP015-REVERSE    TO ANRFCDH                 04710034
047200                 IF  PS-NO-ERROR                                  04720034
047300                     SET PS-ERROR                                 04730034
047400                         DP030-SET-CURSOR-APPL-1                  04740034
047500                         DP020-MSG-FATAL                          04750034
047600                                       TO TRUE                    04760034
047700                     MOVE PC-TSYMSG-01425                         04770034
047800                                       TO DP020-MSG-NUMBER        04780034
047900                     MOVE -1           TO ANRFCDL                 04790034
048000                 END-IF                                           04800034
048100             END-IF                                               04810034
048200         END-IF                                                   04820034
048300     ELSE                                                         04830034
048400         MOVE SPACES           TO ASC-NRF-SIZE-CODE               04840034
048500                                  ANRFCDO                         04850034
048600     END-IF.                                                      04860034
048700                                                                  04870034
048800***  THE EXPIRATION SIZE INDICATOR IS REQUIRED AND MUST BE        04880034
048900***  EITHER 'Y' OR 'N'.                                           04890034
049000                                                                  04900034
049100     IF ( ASC-EXP-SIZE-IND NOT EQUAL 'Y' )                        04910034
049200       AND ( ASC-EXP-SIZE-IND NOT EQUAL 'N' )                     04920034
049300         MOVE DP015-UNP-ALP-BRT-OFF                               04930034
049400                               TO AEXPINDA                        04940034
049500         MOVE DP015-RED        TO AEXPINDC                        04950034
049600         MOVE DP015-REVERSE    TO AEXPINDH                        04960034
049700         IF  PS-NO-ERROR                                          04970034
049800             SET PS-ERROR                                         04980034
049900                 DP030-SET-CURSOR-APPL-1                          04990034
050000                 DP020-MSG-FATAL     TO TRUE                      05000034
050100             MOVE PC-TSYMSG-00349    TO DP020-MSG-NUMBER          05010034
050200             MOVE -1                 TO AEXPINDL                  05020034
050300         END-IF                                                   05030034
050400     ELSE                                                         05040034
050500         MOVE ASC-EXP-SIZE-IND TO AEXPINDO                        05050034
050600     END-IF.                                                      05060034
050700                                                                  05070034
050800     IF  PS-NO-ERROR                                              05080034
050900         MOVE -1                   TO ASZGPCDL                    05090034
051000         SET DP030-SET-CURSOR-APPL-1                              05100034
051100                                   TO TRUE                        05110034
051200     END-IF.                                                      05120034
051300                                                                  05130034
051400*----------------------------------------------------------------*05140034
051500* CHECK IF THE SIZE GROUP CODE ENTERED ON THE CRITERIA SCREEN IS *05150034
051600* FOUND ON THE SIZE GROUP TABLE.  IF IT IS FOUND, DISPLAY THE    *05160034
051700* SIZE GROUP DESCRIPTION.  IF ITS NOT FOUND DISPLAY AN ERROR     *05170034
051800* MESSAGE.                                                       *05180034
051900*----------------------------------------------------------------*05190034
052000                                                                  05200034
052100 3100-GET-SIZE-GP-DESC.                                           05210034
052200                                                                  05220034
052300     PERFORM 7000-READ-SIZE-GP-TABLE.                             05230034
052400                                                                  05240034
052500     IF PS-SIZE-GP-DESC-FOUND                                     05250034
052600         CONTINUE                                                 05260034
052700     ELSE                                                         05270034
052800         SET PS-ERROR                                             05280034
052900             DP020-MSG-FATAL         TO TRUE                      05290034
053000         MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER          05300034
053100         MOVE DP015-UNP-ALP-BRT-OFF                               05310034
053200                                     TO ASZGPCDA                  05320034
053300         MOVE DP015-RED              TO ASZGPCDC                  05330034
053400         MOVE DP015-REVERSE          TO ASZGPCDH                  05340034
053500         MOVE -1                     TO ASZGPCDL                  05350034
053600         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      05360034
053700     END-IF.                                                      05370034
053800                                                                  05380034
053900*                                                                 05390034
054000******************************************************************05400034
054100** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **05410034
054200** MAP.                                                         **05420034
054300******************************************************************05430034
054400 3200-RESET-ATTRIBUTES.                                           05440034
054500     MOVE DP015-UNP-ALP-NOR-OFF    TO ASZGPCDA                    05450034
054600                                      ANRFCDA                     05460034
054700                                      AKDESCA                     05470034
054800                                      AEXPINDA.                   05480034
054900     MOVE DP015-GREEN              TO ASZGPCDC                    05490034
055000                                      ANRFCDC                     05500034
055100                                      AKDESCC                     05510034
055200                                      AEXPINDC.                   05520034
055300     MOVE DP015-UNDERLINE          TO ASZGPCDH                    05530034
055400                                      ANRFCDH                     05540034
055500                                      AKDESCH                     05550034
055600                                      AEXPINDH.                   05560034
055700*                                                                 05570034
055800*----------------------------------------------------------------*05580034
055900*  POSITIONS THE CURSOR IN THE SIZE GROUP CODE AND DEFAULTS THE  *05590034
056000*  EXPIRED SIZE INDICATOR TO AN 'N'.                             *05600034
056100*----------------------------------------------------------------*05610034
056200 4000-BUILD-INITIAL-PANEL.                                        05620034
056300     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        05630034
056400     MOVE -1                       TO ASZGPCDL.                   05640034
056500                                                                  05650034
056600     MOVE PC-EXP-SIZE-IND-DEFAULT  TO ASC-EXP-SIZE-IND            05660034
056700                                      AEXPINDO.                   05670034
056800                                                                  05680034
056900*                                                                 05690034
057000*----------------------------------------------------------------*05700034
057100*  RESTORES THE DATA ON THE SCREEN FROM THE COMM AREA.           *05710034
057200*----------------------------------------------------------------*05720034
057300 4400-MOVE-COMMAREA-TO-SCREEN.                                    05730034
057400     MOVE ASC-SIZE-GP-CODE         TO ASZGPCDO.                   05740034
057500     MOVE ASC-SIZE-GP-DESC         TO ASZGPDSO.                   05750034
057600     MOVE ASC-NRF-SIZE-CODE        TO ANRFCDO.                    05760034
057700     MOVE ASC-KOHLS-DESC           TO AKDESCO.                    05770034
057800     MOVE ASC-EXP-SIZE-IND         TO AEXPINDO.                   05780034
057900                                                                  05790034
058000*                                                                 05800034
058100*----------------------------------------------------------------*05810034
058200*  THIS PARAGRAPH RETRIEVES THE DESCRIPTION OF THE SIZE GROUP    *05820034
058300*  WHICH WAS ENTERED ON THE CRITERIA SCREEN.                     *05830034
058400*----------------------------------------------------------------*05840034
058500 7000-READ-SIZE-GP-TABLE.                                         05850034
058600                                                                  05860034
058700     MOVE ASC-SIZE-GP-CODE           TO PV-SIZE-GP-CODE-N.        05870034
058800     MOVE PV-SIZE-GP-CODE-N          TO PV-SIZE-GP-CODE.          05880034
058900     MOVE SPACES                     TO PV-SIZE-GP-DESC.          05890034
059000     SET PS-SIZE-GP-DESC-NOT-FOUND   TO TRUE.                     05900034
059100                                                                  05910034
059200     EXEC SQL                                                     05920034
059300         SELECT SIZE_GP_DESC                                      05930034
059400           INTO :SIZEGP-SIZE-GP-DESC                              05940034
059500           FROM  TSIZEGP                                          05950034
059600           WHERE SIZE_GP_CDE = :PV-SIZE-GP-CODE                   05960034
059700     END-EXEC.                                                    05970034
059800                                                                  05980034
059900     EVALUATE TRUE                                                05990034
060000         WHEN SQLCODE = 0                                         06000034
060100           SET PS-SIZE-GP-DESC-FOUND      TO TRUE                 06010034
060200           MOVE SIZEGP-SIZE-GP-DESC       TO PV-SIZE-GP-DESC      06020034
060300         WHEN SQLCODE = +100                                      06030034
060400           SET PS-SIZE-GP-DESC-NOT-FOUND  TO TRUE                 06040034
060500           MOVE SPACES                    TO PV-SIZE-GP-DESC      06050034
060600         WHEN OTHER                                               06060034
060700           MOVE SQLCA TO DP013-SQLCA                              06070034
060800           MOVE '7000-READ-SIZE-GP-TABLE' TO DP013-PARAGRAPH      06080034
060900           MOVE 'TSIZEGP' TO DP013-DB2-TABLE-NAME(2)              06090034
061000           PERFORM 9400-DB2-ERROR                                 06100034
061100     END-EVALUATE.                                                06110034
061200                                                                  06120034
061300*                                                                 06130034
061400*----------------------------------------------------------------*06140034
061500*  FORMAT INFORMATION RELATIVE TO A DB2 ERROR.                   *06150034
061600*----------------------------------------------------------------*06160034
061700                                                                  06170034
061800 9400-DB2-ERROR.                                                  06180034
061900     SET DP013-DB2-ABEND TO TRUE.                                 06190034
062000     SET DP013-NO-ROLLBACK TO TRUE.                               06200034
062100     SET DP013-XCTL-DISPLAY-RESTART TO TRUE.                      06210034
062200     MOVE SQLCA TO DP013-SQLCA                                    06220034
062300                                                                  06230034
062400     PERFORM DP013-0000-PROCESS-ABEND.                            06240034
062500                                                                  06250034
062600 EJECT                                                            06260034
062700*----------------------------------------------------------------*06270034
062800*    ABEND PROCESSOR MODULE                                      *06280034
062900*----------------------------------------------------------------*06290034
063000                                                                  06300034
063100     COPY DPPD013.                                                06310034
063200                                                                  06320034
