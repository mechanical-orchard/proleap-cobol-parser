000100******************************************************************00020001
000200 IDENTIFICATION DIVISION.                                         00030001
000300******************************************************************00040001
000400                                                                  00050001
000500 PROGRAM-ID.             TMKUT010.                                00060001
000600 AUTHOR.                 VIRGENE LENNEMAN.                        00070001
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00080001
000800 DATE-WRITTEN            02/03/98.                                00090001
000900 DATE-COMPILED.                                                   00100001
001000                                                                  00110001
001100*----------------------------------------------------------------*00120001
001200* THIS PROGRAM WILL TAKE IN AN EXTRACT FILE FROM THE TMKUT007    *00130001
001300* PROGRAM. IT WILL SUMMARIZE THE RECORDS ASSOCIATED TO THE VENDOR*00140001
001400* REPORTING AREA BY VENDOR, DEPT. AND TROUBLE REASON. IT WILL    *00150001
001500* CREATE VENDOR/DEPARTMENT/TROUBLE REASON TOTAL RECORDS (CF).    *00160001
001600*----------------------------------------------------------------*00170001
001700                                                                  00180001
001800******************************************************************00190001
001900 ENVIRONMENT DIVISION.                                            00200001
002000******************************************************************00210001
002100                                                                  00220001
002200 CONFIGURATION SECTION.                                           00230001
002300                                                                  00240001
002400 SOURCE-COMPUTER.        IBM-3090.                                00250001
002500 OBJECT-COMPUTER.        IBM-3090.                                00260001
002600                                                                  00270001
002700 INPUT-OUTPUT SECTION.                                            00280001
002800                                                                  00290001
002900 FILE-CONTROL.                                                    00300001
003000                                                                  00310001
003100      SELECT EXTRACT-TRBL-FILE-IN       ASSIGN TO INP01.          00320001
003200                                                                  00330001
003300      SELECT EXTRACT-TRBL-FILE-OUT      ASSIGN TO OUT01.          00340001
003400                                                                  00350001
003500******************************************************************00360001
003600 DATA DIVISION.                                                   00370001
003700******************************************************************00380001
003800                                                                  00390001
003900 FILE SECTION.                                                    00400001
004000 FD  EXTRACT-TRBL-FILE-IN                                         00410001
004100     LABEL RECORDS ARE STANDARD                                   00420001
004200     BLOCK CONTAINS 0 RECORDS                                     00430001
004300     RECORDING MODE IS F                                          00440001
004400     RECORD CONTAINS 400 CHARACTERS                               00450001
004500     DATA RECORD IS TE-TRBL-EXTRACT-RCD-IN.                       00460001
004600                                                                  00470001
004700 01  TE-TRBL-EXTRACT-RCD-IN          PIC X(400).                  00480001
004800                                                                  00490001
004900                                                                  00500001
005000 FD  EXTRACT-TRBL-FILE-OUT                                        00510001
005100     LABEL RECORDS ARE STANDARD                                   00520001
005200     BLOCK CONTAINS 0 RECORDS                                     00530001
005300     RECORDING MODE IS F                                          00540001
005400     RECORD CONTAINS 400 CHARACTERS                               00550001
005500     DATA RECORD IS TE-TRBL-EXTRACT-RCD-OUT.                      00560001
005600                                                                  00570001
005700 01  TE-TRBL-EXTRACT-RCD-OUT         PIC X(400).                  00580001
005800*------------------------------------------------------*          00590001
005900 WORKING-STORAGE SECTION.                                         00600001
006000*------------------------------------------------------*          00610001
006100 01 PC-PROGRAM-CONSTANTS.                                         00620001
006200    05 PC-PROGRAM-NAME               PIC X(08) VALUE 'TMKUT010'.  00630001
007520    05 PC-60                         PIC 9(02) VALUE 60.          00680001
008000    05 PC-A                          PIC X(01) VALUE 'A'.         00690008
008000    05 PC-B                          PIC X(01) VALUE 'B'.         00700008
008000                                                                  01100001
009600 01  WS-VDR-DEPT-TRBL-RECORD.                                     01110001
009700******* HEADER                                                    01120001
009700     05  VDTTL-RECORD-TYPE           PIC  X(2)        VALUE 'CF'. 01130006
009810     05  VDTTL-SORT-FIELD.                                        01140006
009830         10  VDTTL-SF-ENT-ID         PIC S9(09) VALUE 0 COMP.     01141006
009840         10  VDTTL-SF-DEPT-NBR       PIC  X(03) VALUE ZEROS.      01142009
009840         10  VDTTL-SF-TRBL-RSN       PIC S9(04) VALUE 0 COMP.     01143006
009840         10  VDTTL-SF-NOTIF-CDE      PIC  X(01) VALUE SPACES.     01144006
009850         10  FILLER                  PIC  X(15) VALUE SPACES.     01145006
009900     05  VDTTL-REPORT-DIVISION       PIC  X(2)  VALUE 'LL'.       01150006
009910     05  VDTTL-REPORT-NOTIF-CDE      PIC  X(1)  VALUE SPACES.     01160006
009910     05  VDTTL-REPORT-OPER-UNT-ID    PIC S9(4)  COMP.             01161012
009910     05  VDTTL-REPORT-GMM-NBR        PIC  X(2)  VALUE SPACES.     01162012
010000     05  FILLER                      PIC  X(05) VALUE SPACES.     01170012
009700******* DETAIL                                                    01180001
010010     05  VDTTL-ENT-ID                PIC S9(9)     COMP.          01190003
010010     05  VDTTL-ENT-NAME-DESC         PIC X(30).                   01190103
010010     05  VDTTL-DEPT-NBR              PIC X(03).                   01190203
010010     05  VDTTL-DEPT-DESCRIPTION      PIC X(32).                   01190303
010010     05  VDTTL-TRBL-RSN-CDE          PIC S9(4)     COMP.          01200003
010020     05  VDTTL-TRBL-RSN-CDE-DESC     PIC X(20).                   01210001
010030     05  VDTTL-ASSIGN-TOT-QTY        PIC S9(7)     COMP-3.        01220001
010040     05  VDTTL-AVG-RESOLV-HRS        PIC S9(5)     COMP-3.        01230014
010050     05  VDTTL-AVG-RESOLV-MINS       PIC S9(3)     COMP-3.        01240014
010060     05  FILLER                      PIC X(261).                  01270003
010300                                                                  01280001
010400 01 PS-PROGRAM-SWITCHES.                                          01290001
010500    05 PS-END-OF-FILE-SW             PIC X(01)     VALUE SPACE.   01300001
010600       88 PS-EOF                                   VALUE 'Y'.     01310001
010700       88 PS-NOT-EOF                               VALUE 'N'.     01320001
011500    05 PS-FIRST-TIME-SW              PIC X(01)     VALUE 'Y'.     01330009
011600       88 PS-FIRST-TIME                            VALUE 'Y'.     01340009
011700       88 PS-NOT-FIRST-TIME                        VALUE 'N'.     01350009
013600                                                                  01510001
013700 01 WS-HOLD-ACCUMULATORS.                                         01520001
014760****** VENDOR/DEPT TOTALS FOR 'CF' RECORD                         01780001
014200    05  WS-ASSIGN-TOT-QTY-VDPTT      PIC S9(7)     COMP-3         01830005
014300                                                   VALUE ZEROS.   01840001
014710    05  WS-RESOLVE-TOT-MIN-VDPTT     PIC S9(9)     COMP-3         01890005
014720                                                   VALUE ZEROS.   01900001
014725    05  WS-RESOLVE-TOT-QTY-VDPTT     PIC S9(5)     COMP-3         01950005
014726                                                   VALUE ZEROS.   01960001
014725    05  WS-HOLD-MINUTES              PIC S9(9)     COMP-3         01961009
014726                                                   VALUE ZEROS.   01962009
014725    05  WS-AVG-MINUTES               PIC S9(9)     COMP-3         01963009
014726                                                   VALUE ZEROS.   01964009
014725    05  WS-HOLD-QUANTITY             PIC S9(5)     COMP-3         01965009
014726                                                   VALUE ZEROS.   01966009
014760****** ASSORTED COUNTERS                                          01970001
014800    05  WS-RCD-READ-COUNT            PIC S9(7)     COMP-3         01980001
014900                                                   VALUE ZEROS.   01990001
015000    05  WS-RCD-BYPASS-COUNT          PIC S9(7)     COMP-3         02000001
015100                                                   VALUE ZEROS.   02010001
015400    05  WS-RCD-DTL-WRITE-COUNT       PIC S9(7)     COMP-3         02040001
015500                                                   VALUE ZEROS.   02050001
015600    05  WS-RCD-VDT-WRITE-COUNT       PIC S9(7)     COMP-3         02060010
015700                                                   VALUE ZEROS.   02070001
016400                                                                  02150001
016500 01 PV-PROGRAM-VARIABLES.                                         02160001
019010    05  PV-CALC-MINUTES              PIC S9(09)    COMP-3         02450008
019020                                                   VALUE ZEROS.   02460001
009810    05  PV-CUR-SORT-FIELD.                                        02470006
009830        10  PV-CUR-SF-ENT-ID         PIC S9(09) VALUE 0 COMP.     02480006
009840        10  PV-CUR-SF-DEPT-NBR       PIC  X(03) VALUE ZEROS.      02490009
009840        10  PV-CUR-SF-TRBL-RSN       PIC S9(04) VALUE 0 COMP.     02500006
009840        10  PV-CUR-SF-NOTIF-CDE      PIC  X(01) VALUE SPACES.     02510006
009850        10  FILLER                   PIC  X(15) VALUE SPACES.     02520006
009810    05  PV-PREV-SORT-FIELD.                                       02530006
009830        10  PV-PREV-SF-ENT-ID         PIC S9(09) VALUE 0 COMP.    02540006
009840        10  PV-PREV-SF-DEPT-NBR       PIC  X(03) VALUE ZEROS.     02550009
009840        10  PV-PREV-SF-TRBL-RSN       PIC S9(04) VALUE 0 COMP.    02560006
009840        10  PV-PREV-SF-NOTIF-CDE      PIC  X(01) VALUE SPACES.    02570006
009850        10  FILLER                    PIC  X(15) VALUE SPACES.    02580006
028200                                                                  02590001
029400 01  CC-CONTROL-CARD-PARAMETERS.                                  02600001
029700     05  CC-WRITE-DETAIL-CDE         PIC X(01)     VALUE SPACE.   02610004
029800         88  CC-NO-WRITE-DETAIL                    VALUE 'N'.     02620004
029900         88  CC-WRITE-DETAIL                       VALUE SPACE.   02630004
031000     05 FILLER                       PIC X(79)     VALUE SPACE.   02810004
031100                                                                  02820001
031200*** FILE LAYOUT AREA ****                                         02830001
031300     COPY TMRD001.                                                02840016
031400                                                                  02850001
033700 PROCEDURE DIVISION.                                              02870001
033800                                                                  02880001
033900 0000-MAINLINE-PROCESSING.                                        02890001
034000                                                                  02900001
034100     PERFORM 0100-INITIALIZATION.                                 02910004
034200                                                                  02920001
034300     PERFORM 0200-PROCESS-INPUT                                   02930004
034400         UNTIL PS-EOF.                                            02940001
034500                                                                  02950001
034600     PERFORM 9999-EOJ.                                            02960004
034700                                                                  02970001
034800     STOP RUN.                                                    02980001
034900                                                                  02990004
035000 0100-INITIALIZATION.                                             03000004
035100                                                                  03010001
035200     ACCEPT CC-CONTROL-CARD-PARAMETERS FROM SYSIN.                03020001
035300                                                                  03030001
035400     OPEN INPUT  EXTRACT-TRBL-FILE-IN.                            03040001
035500     OPEN OUTPUT EXTRACT-TRBL-FILE-OUT.                           03050001
035600                                                                  03060001
051000 0200-PROCESS-INPUT.                                              03420004
051100     PERFORM 0900-READ-INPUT-FILE.                                03430007
051100                                                                  03431004
051100     IF PS-EOF                                                    03431113
051100         NEXT SENTENCE                                            03431213
051100     ELSE                                                         03431313
051100         EVALUATE TRUE                                            03432013
051100             WHEN TM001-RECORD-TYPE-HEADER                        03433013
051100             WHEN TM001-RECORD-TYPE-VNDDTLSUM                     03433113
051100             WHEN TM001-RECORD-TYPE-VNDDPTSUM                     03433213
051100                 PERFORM 1000-WRITE-OUTPUT                        03434013
051100                 ADD +1 TO WS-RCD-BYPASS-COUNT                    03434113
051100             WHEN TM001-RECORD-TYPE-DETAIL                        03434213
051100                 IF TM001-RPT-AREA-VENDOR                         03435013
051100                     PERFORM 0300-PROCESS-DETAIL                  03439213
051110                     IF CC-WRITE-DETAIL                           03440013
051120                         PERFORM 1000-WRITE-OUTPUT                03450013
051100                         ADD +1 TO WS-RCD-DTL-WRITE-COUNT         03460013
051140                     END-IF                                       03470013
051180                 END-IF                                           03510013
051180         END-EVALUATE                                             03511013
051180     END-IF.                                                      03511113
051180                                                                  03512004
051180 0300-PROCESS-DETAIL.                                             03513004
051180     IF PV-CUR-SORT-FIELD EQUAL PV-PREV-SORT-FIELD                03514007
051180         PERFORM 0400-SAME-TRBL                                   03514107
051180     ELSE                                                         03514207
051180         PERFORM 0600-WRITE-CFREC                                 03514307
051180         PERFORM 0800-RESET                                       03514407
051180         PERFORM 0400-SAME-TRBL                                   03514507
051180     END-IF.                                                      03514607
051180                                                                  03514707
051180 0400-SAME-TRBL.                                                  03514807
051180     ADD +1 TO WS-ASSIGN-TOT-QTY-VDPTT.                           03514907
051180     PERFORM 0500-CHECK-FOR-RESOLVE.                              03515007
051180     MOVE TM001-ENT-ID        TO VDTTL-SF-ENT-ID                  03515107
051180                                 VDTTL-ENT-ID.                    03515207
051180     MOVE TM001-ENT-NAME-DESC TO VDTTL-ENT-NAME-DESC.             03515307
051180     MOVE TM001-DEPT-NBR      TO VDTTL-SF-DEPT-NBR                03515407
051180                                 VDTTL-DEPT-NBR.                  03515507
051180     MOVE TM001-DEPT-DESC     TO VDTTL-DEPT-DESCRIPTION.          03515607
051180     MOVE TM001-TRBL-RSN-CDE  TO VDTTL-SF-TRBL-RSN                03515707
051180                                 VDTTL-TRBL-RSN-CDE               03515807
051180     MOVE TM001-TRBL-RSN-CDE-DESC TO VDTTL-TRBL-RSN-CDE-DESC.     03515907
051180     MOVE SPACES              TO VDTTL-SF-NOTIF-CDE.              03516007
051180     IF TM001-TRBL-RSN-NOTIF                                      03516107
051180         MOVE PC-B            TO VDTTL-REPORT-NOTIF-CDE           03516207
051180     ELSE                                                         03516307
051180         MOVE PC-A            TO VDTTL-REPORT-NOTIF-CDE           03516407
051180     END-IF.                                                      03516507
051180     INITIALIZE VDTTL-REPORT-OPER-UNT-ID                          03516612
051180                VDTTL-REPORT-GMM-NBR.                             03516712
051180                                                                  03516912
051180     MOVE PV-CUR-SORT-FIELD   TO PV-PREV-SORT-FIELD.              03517012
051180                                                                  03517112
051931 0500-CHECK-FOR-RESOLVE.                                          03517212
051933     IF  TM001-RPT-RESOLVED                                       03517312
051934         ADD TM001-RESOLVED-MINUTES TO WS-RESOLVE-TOT-MIN-VDPTT   03517412
051936         MULTIPLY TM001-RESOLVED-HOURS BY PC-60                   03517512
051937             GIVING PV-CALC-MINUTES                               03517612
051938         ADD PV-CALC-MINUTES TO WS-RESOLVE-TOT-MIN-VDPTT          03517712
051940         ADD +1 TO WS-RESOLVE-TOT-QTY-VDPTT                       03517807
051954     END-IF.                                                      03519907
056639                                                                  03520007
056639 0600-WRITE-CFREC.                                                03520107
056639     IF PS-FIRST-TIME                                             03520207
056639         SET PS-NOT-FIRST-TIME TO TRUE                            03520307
056639     ELSE                                                         03520407
056639         MOVE WS-ASSIGN-TOT-QTY-VDPTT TO VDTTL-ASSIGN-TOT-QTY     03520507
056639         MOVE ZEROS                TO VDTTL-AVG-RESOLV-HRS        03520614
056639                                      VDTTL-AVG-RESOLV-MINS       03520714
056639         MOVE WS-RESOLVE-TOT-MIN-VDPTT TO WS-HOLD-MINUTES         03520809
056639         MOVE WS-RESOLVE-TOT-QTY-VDPTT TO WS-HOLD-QUANTITY        03520909
056639         PERFORM 0700-GET-HOURS-MIN                               03521007
056639         WRITE TE-TRBL-EXTRACT-RCD-OUT FROM                       03521107
056639              WS-VDR-DEPT-TRBL-RECORD                             03521207
056639         ADD +1 TO WS-RCD-VDT-WRITE-COUNT                         03521310
056639     END-IF.                                                      03521407
056639                                                                  03521507
056639 0700-GET-HOURS-MIN.                                              03521607
056621     IF  WS-HOLD-MINUTES = ZERO                                   03521807
056622     OR  WS-HOLD-QUANTITY = ZERO                                  03521907
056623         NEXT SENTENCE                                            03522007
056624     ELSE                                                         03522107
056625         DIVIDE WS-HOLD-MINUTES BY WS-HOLD-QUANTITY               03522207
056627                  GIVING WS-AVG-MINUTES ROUNDED                   03522407
056628                  ON SIZE ERROR                                   03522507
056629                       MOVE 0 TO WS-AVG-MINUTES                   03522607
056630         END-DIVIDE                                               03522707
056631                                                                  03522807
056632         DIVIDE WS-AVG-MINUTES BY PC-60                           03522907
056633                GIVING VDTTL-AVG-RESOLV-HRS                       03523014
056634                REMAINDER VDTTL-AVG-RESOLV-MINS                   03523114
056635                ON SIZE ERROR                                     03523207
056636                      MOVE 0 TO VDTTL-AVG-RESOLV-HRS              03523314
056637                                VDTTL-AVG-RESOLV-MINS             03523414
056638         END-DIVIDE.                                              03523507
056639                                                                  03523607
056639 0800-RESET.                                                      03523707
056639     INITIALIZE   WS-RESOLVE-TOT-MIN-VDPTT                        03523807
056639                  WS-RESOLVE-TOT-QTY-VDPTT                        03523907
056639                  WS-ASSIGN-TOT-QTY-VDPTT.                        03524407
085400                                                                  03524707
084000 0900-READ-INPUT-FILE.                                            03525807
084200      READ EXTRACT-TRBL-FILE-IN INTO                              03526007
084300           TM001-TROUBLE-EXT-RECORD                               03526107
084400      AT END                                                      03526207
084500           SET PS-EOF TO TRUE                                     03526307
084600      END-READ.                                                   03526407
084700                                                                  03526507
084800      IF  PS-EOF                                                  03526607
084900          NEXT SENTENCE                                           03526707
085000      ELSE                                                        03526807
085100          MOVE TM001-SORT-FIELD TO PV-CUR-SORT-FIELD              03526907
085100          ADD +1 TO WS-RCD-READ-COUNT                             03527007
085200      END-IF.                                                     03527107
085300                                                                  03527207
051180                                                                  03527307
086210 1000-WRITE-OUTPUT.                                               03527409
086240      WRITE TE-TRBL-EXTRACT-RCD-OUT FROM                          03527607
086250            TM001-TROUBLE-EXT-RECORD.                             03527707
086260                                                                  03527807
086280                                                                  03528007
086300 9999-EOJ.                                                        03528207
086410     PERFORM 0600-WRITE-CFREC.                                    03528609
086800                                                                  03528707
086900     CLOSE EXTRACT-TRBL-FILE-IN                                   03528807
087000           EXTRACT-TRBL-FILE-OUT.                                 03528907
087100                                                                  03529007
087200     DISPLAY '** INPUT RECORDS READ =========== '                 03529107
087300             WS-RCD-READ-COUNT.                                   03529207
087400     DISPLAY '** INPUT RECORDS NOT WRITTEN ==== '                 03529307
087500             WS-RCD-BYPASS-COUNT.                                 03529407
087800     DISPLAY '** DETAIL RECORDS WRITTEN ======= '                 03530107
087900             WS-RCD-DTL-WRITE-COUNT.                              03530207
087600     DISPLAY '** VENDOR DEPT. TRBL TOTAL RECORDS WRITTEN = '      03530315
087700             WS-RCD-VDT-WRITE-COUNT                               03530415
088000     DISPLAY ' '.                                                 03530507
088100     DISPLAY '** CONTROL CARD FOR THIS RUN IS = '                 03530607
088200             CC-CONTROL-CARD-PARAMETERS.                          03530707
051180                                                                  03530807
037300********   END OF TMKUT010 SOURCE   ****************************  03531107
