000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    ETKCS312.                                         00020000
000300 AUTHOR.        MARC BLAZICH. G&R.                                00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  02-24-94.                                         00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800*---------------------------------------------------------------* 00080000
000900*    TRANID      - E312                                         * 00090000
001000*    TYPE        - CICS ARCHITECTURE MAINTENANCE - DB2          * 00100000
001100*    DESCRIPTION - TRADING PARTNER FUNCTIONAL GROUP MAINTENANCE * 00110000
001200*    MAPSET      - EDKM312                                      * 00120000
001300*                                                               * 00130000
001400*    THIS PROGRAM WILL ADD, UPDATE, AND DELETE TRADING PARTNER  * 00140000
001500*    FUNCTIONAL GROUPS FOR A GIVEN TP_DKEY.                     * 00150000
001600*                                                               * 00160000
001700*    CHANGES:                                                   * 00170000
001800*     03/20/97 TOM MEDREK - FIXED APPLICATION SPECIFIC SECTION. * 00180000
001900*       ADDED NRF INDICATOR WHICH WAS ADDED TO ETWS300 &        * 00190000
002000*       ETWS301 EARLIER.                                        * 00200000
002100*                                                               * 00210000
002200******************************************************************00220000
002300*  DATE  05/14/03                                                 00230000
002400*  CHANGE MADE:                                                   00240000
002500*   ADDED CODE TO SEND ENT-ID IN MQSERIES UPDATE OF RMS/SUPPLIER. 00250000
002600*  MADE BY: JON FIEDLER             WR# : 24663                   00260000
002700******************************************************************00270000
002800*  DATE  06/16/03                                                 00280000
002900*  CHANGE MADE:                                                   00290000
003000*  FIXED ISSUE WITH INCORRECT PO AND ASN INDICATORS BEING SENT    00300000
003100*  OVER TO THE RMS/SUPPLIER SYSTEM. THIS ISSUE INVOLVES VENDORS   00310000
003200*  WHO HAVE MULTIPLE IDS. THE CHECK FOR PO AND ASN SETUP ONLY     00320000
003300*  LOOKED AT THE CURRENT TP_DKEY BEING ADDED, UPDATED, OR DELETED.00330000
003400*  THE CODE WILL NOW LOOK AT PO AND ASN SETUP FOR A PARTICULAR    00340000
003500*  ENT_ID AND WILL CHECK ALL TP_DKEYS INVOLVING ONE VENDOR FOR    00350000
003600*  PO AND ASN SETUP.                                              00360000
003700*  MADE BY: JON FIEDLER             WR# : 23521                   00370000
003800******************************************************************00380000
003900*  DATE  06/26/2003                                               00390000
004000*  CHANGE MADE:                                                   00400000
004100*   CHANGED THE PO/ASN SETUP CHECK TO EXTRACT BOTH TEST AND       00410000
004200*   PRODUCTION TRANSACTION SETS.                                  00420000
004300*  MADE BY: JON FIEDLER             WR# : 23521                   00430000
004400******************************************************************00440000
004410* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00441002
004420*            - CHANGE CALL OF DPKUT100 TO                       * 00442002
004430*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00443002
004440*              MAKING THE CALL DYNAMIC VS STATIC                * 00444002
004450*                                                               * 00445002
004460*---------------------------------------------------------------* 00446002
CICS  *  CHANGED 10/25/2022    BY BARB SCHULTZ    WR: CHG0277210      * 00447004
CICS  *                                                               * 00448003
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00449003
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00449103
004460*---------------------------------------------------------------* 00449303
004500                                                                  00450000
004600 ENVIRONMENT DIVISION.                                            00460000
004700 DATA DIVISION.                                                   00470000
004800                                                                  00480000
004900/                                                                 00490000
005000 WORKING-STORAGE SECTION.                                         00500000
005100                                                                  00510000
005200 01  DK-DB2-KEYS.                                                 00520000
005300     05  DK-TP-DKEY                   PIC S9(09) COMP.            00530000
005400     05  DK-FUNC-CDE                  PIC  X(02).                 00540000
005500     05  DK-DIR-IND                   PIC  X(01).                 00550000
005600                                                                  00560000
005700 01  PC-PROGRAM-CONSTANTS.                                        00570000
005800     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00580000
005900                                                    'ET312A  '.   00590000
006000     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00600000
006100                                                    'ETKM312 '.   00610000
006200     05  PC-APPL-MAP                    PIC S9(04)  VALUE  +1     00620000
006300                                                    COMP.         00630000
006400     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00640000
006500                                                    'ETKCS312'.   00650000
006600     05  PC-DPKUT100                    PIC  X(08)  VALUE         00660000
006700                                                    'DPKUT100'.   00670000
006800     05  PC-NULL-DATE                   PIC  X(10)  VALUE         00680000
006900                                                    '9999-09-09'. 00690000
007000     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      00700000
007100                                                    COMP-3.       00710000
007200     05  PC-TSYMSG-NUMBERS.                                       00720000
007300         10  PC-TSYMSG-00004            PIC  9(05)  VALUE  00004. 00730000
007400         10  PC-TSYMSG-00005            PIC  9(05)  VALUE  00005. 00740000
007500         10  PC-TSYMSG-00007            PIC  9(05)  VALUE  00007. 00750000
007600         10  PC-TSYMSG-00008            PIC  9(05)  VALUE  00008. 00760000
007700         10  PC-TSYMSG-00016            PIC  9(05)  VALUE  00016. 00770000
007800         10  PC-TSYMSG-00034            PIC  9(05)  VALUE  00034. 00780000
007900         10  PC-TSYMSG-00046            PIC  9(05)  VALUE  00046. 00790000
008000         10  PC-TSYMSG-00057            PIC  9(05)  VALUE  00057. 00800000
008100         10  PC-TSYMSG-00059            PIC  9(05)  VALUE  00059. 00810000
008200         10  PC-TSYMSG-00069            PIC  9(05)  VALUE  00069. 00820000
008300         10  PC-TSYMSG-00070            PIC  9(05)  VALUE  00070. 00830000
008400         10  PC-TSYMSG-00112            PIC  9(05)  VALUE  00112. 00840000
008500         10  PC-TSYMSG-00115            PIC  9(05)  VALUE  00115. 00850000
008600         10  PC-TSYMSG-00116            PIC  9(05)  VALUE  00116. 00860000
008700         10  PC-TSYMSG-00117            PIC  9(05)  VALUE  00117. 00870000
008800         10  PC-TSYMSG-00134            PIC  9(05)  VALUE  00134. 00880000
008900         10  PC-TSYMSG-00148            PIC  9(05)  VALUE  00148. 00890000
009000         10  PC-TSYMSG-00158            PIC  9(05)  VALUE  00158. 00900000
009100         10  PC-TSYMSG-00164            PIC  9(05)  VALUE  00164. 00910000
009200         10  PC-TSYMSG-00165            PIC  9(05)  VALUE  00165. 00920000
009300         10  PC-TSYMSG-00224            PIC  9(05)  VALUE  00224. 00930000
009400         10  PC-TSYMSG-00231            PIC  9(05)  VALUE  00231. 00940000
009500         10  PC-TSYMSG-00349            PIC  9(05)  VALUE  00349. 00950000
009600         10  PC-TSYMSG-00760            PIC  9(05)  VALUE  00760. 00960000
009700         10  PC-TSYMSG-00763            PIC  9(05)  VALUE  00763. 00970000
009800         10  PC-TSYMSG-00764            PIC  9(05)  VALUE  00764. 00980000
009900         10  PC-TSYMSG-00836            PIC  9(05)  VALUE  00836. 00990000
010000         10  PC-TSYMSG-00838            PIC  9(05)  VALUE  00838. 01000000
010100****  VENDOR SET UP FOR 860                                       01010000
010200         10  PC-TSYMSG-03463            PIC  9(05)  VALUE  03463. 01020000
010300     05  PC-VNKCS024                    PIC X(08) VALUE           01030000
010400                                                    'VNKCS024'.   01040000
010500                                                                  01050000
010600 01  PV-PROGRAM-VARIABLES.                                        01060000
010700     05  PV-INT-APPL-FORMAT-IND         PIC  X(01).               01070000
010800*****    88  PV-INTER-APPL-CRIT-ADD                 VALUE '1'.    01080000
010900         88  PV-INTER-APPL-CRIT-ADD                 VALUE ' '.    01090000
011000         88  PV-INTER-APPL-LIST-UPDATE              VALUE '4'.    01100000
011100         88  PV-INTER-APPL-LIST-DELETE              VALUE '5'.    01110000
011200                                                                  01120000
011300     05  PV-CICS-RESPONSE               PIC S9(04)  VALUE +0      01130000
011400                                                    COMP SYNC.    01140000
011500     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01150000
011600                                                    COMP SYNC.    01160000
011700     05  PV-DUP-COUNTER                 PIC S9(04) COMP.          01170000
011800     05  PV-TRAN-SET-CDE                PIC X(03).                01180000
011900     05  PV-PROD-TEST-IND               PIC X(01).                01190000
012000     05  PV-TEMP-TP-DKEY                PIC 9(12).                01200000
012100                                                                  01210000
012200 01  PS-PROGRAM-SWITCHES.                                         01220000
012300     05  PS-TRK-IND-SW                  PIC  X(01).               01230000
012400         88  PS-TRK-OK                              VALUE 'Y'.    01240000
012500         88  PS-TRK-ERR                             VALUE 'N'.    01250000
012600     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01260000
012700         88  PS-NO-ERROR                            VALUE 'Y'.    01270000
012800         88  PS-ERROR                               VALUE 'N'.    01280000
012900     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01290000
013000         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01300000
013100         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01310000
013200     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01320000
013300         88  PS-DONE                                VALUE 'Y'.    01330000
013400         88  PS-NOT-DONE                            VALUE 'N'.    01340000
013500     05  PS-MQ-SEND-SW                  PIC  X(01)  VALUE 'N'.    01350000
013600         88  PS-SEND                                VALUE 'Y'.    01360000
013700         88  PS-DONT-SEND                           VALUE 'N'.    01370000
013800     05  PS-PC860-EXISTS-SW             PIC  X(01)  VALUE ' '.    01380000
013900         88  PS-PC860-EXISTS                        VALUE 'Y'.    01390000
014000         88  PS-PC860-NOT-EXIST                     VALUE 'N'.    01400000
014100                                                                  01410000
014200*---------------------------------------------------------------* 01420000
014300*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 01430000
014400*---------------------------------------------------------------* 01440000
014500                                                                  01450000
014600     COPY ETWS301.                                                01460000
014700                                                                  01470000
014800/                                                                 01480000
014900*---------------------------------------------------------------* 01490000
015000*    MAP LAYOUT                                                 * 01500000
015100*---------------------------------------------------------------* 01510000
015200                                                                  01520000
015300     COPY ETKM312.                                                01530000
015400                                                                  01540000
015500/                                                                 01550000
015600*---------------------------------------------------------------* 01560000
015700*    ATTRIBUTE SETTINGS COPYBOOK.                               * 01570000
015800*---------------------------------------------------------------* 01580000
015900                                                                  01590000
016000     COPY DPWS015.                                                01600000
016100                                                                  01610000
016200*---------------------------------------------------------------* 01620000
016300*    FUNCTION KEYS COPYBOOK.                                    * 01630000
016400*---------------------------------------------------------------* 01640000
016500                                                                  01650000
016600     COPY DPWS016.                                                01660000
016700                                                                  01670000
016800/                                                                 01680000
016900**--------------------------------------------------------------* 01690000
017000** COMMAREA FOR VNKCS024                                        * 01700000
017100**--------------------------------------------------------------* 01710000
017200 01 VN007-COMMAREA.                                               01720000
017300     COPY VNWS007.                                                01730000
017400 EJECT                                                            01740000
017500*---------------------------------------------------------------* 01750000
017600*  WORK AREA FOR NUMERIC EDIT ROUTINE - DPKUT100                * 01760000
017700*---------------------------------------------------------------* 01770000
017800     COPY DPWS010I.                                               01780000
017900                                                                  01790000
018000/                                                                 01800000
018100*---------------------------------------------------------------* 01810000
CICS  *    PARAMETERS FOR CALLING CICS ARCHITECTURE API.              * 01820003
018300*---------------------------------------------------------------* 01830000
018400                                                                  01840000
018500     COPY DPWS030.                                                01850000
CICS       COPY DPWS930.                                                01851003
018600                                                                  01860000
018700/                                                                 01870000
018800*---------------------------------------------------------------* 01880000
018900*    STANDARD COMMAREA.                                         * 01890000
019000*---------------------------------------------------------------* 01900000
019100                                                                  01910000
019200     COPY DPWS020.                                                01920000
019300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01930000
019400                                                                  01940000
019500         10  INTER-APPL-COMM-AREA       PIC X(200).               01950000
019600     COPY ETWS300.                                                01960000
019700*---------------------------------------------------------------* 01970000
019800*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 01980000
019900*---------------------------------------------------------------* 01990000
020000         10  ASC-SPECIFIC-COMMAREA.                               02000000
020100             15  ASC-INT-APPL-FORMAT-IND    PIC X(01).            02010000
020200             15  ASC-ACTION-SW              PIC X(03).            02020000
020300                 88  ASC-ADD-PENDING        VALUE 'ADD'.          02030000
020400                 88  ASC-DELETE-PENDING     VALUE 'DEL'.          02040000
020500                 88  ASC-UPDATE-PENDING     VALUE 'UPD'.          02050000
020600             15  ASC-DELETE-SUCCESSFUL-SW   PIC X(01).            02060000
020700                 88  ASC-DELETE-SUCCESSFUL  VALUE 'Y'.            02070000
020800             15  ASC-ADD-SUCCESSFUL-SW      PIC X(01).            02080000
020900                 88  ASC-ADD-NOT-SUCCESSFUL VALUE ' '.            02090000
021000                 88  ASC-ADD-SUCCESSFUL     VALUE 'Y'.            02100000
021100             15  ASC-FIELDS-CHANGED-SW      PIC X(01).            02110000
021200                 88  ASC-FIELDS-CHANGED     VALUE 'Y'.            02120000
021300             15  ASC-KEY-FIELDS.                                  02130000
021400                 20  ASC-KEY-TP-DKEY       PIC S9(09)  COMP.      02140000
021500                 20  ASC-KEY-FUNC-CDE      PIC X(02).             02150000
021600                 20  ASC-KEY-DIR-IND       PIC X(01).             02160000
021700             15  ASC-ORIGINAL-FIELD-VALUES.                       02170000
021800                 20  ASC-LAST-CNTL-NBRX.                          02180000
021900                     25  ASC-LAST-CNTL-NBR         PIC  9(09).    02190000
022000                 20  ASC-CNTL-NBR-METH-CDE         PIC  X(01).    02200000
022100                 20  ASC-TRK-IND                   PIC  X(01).    02210000
022200                 20  ASC-OVRRD-CNTL-NBRX.                         02220000
022300                     25  ASC-OVRRD-CNTL-NBR        PIC  9(09).    02230000
022400                 20  ASC-OVRRD-CNTL-NBR-IND        PIC  X(01).    02240000
022500             15  ASC-NEWLY-ENTERED-FIELDS.                        02250000
022600                 20  ASC-LAST-CNTL-NBR-NEWX.                      02260000
022700                     25  ASC-LAST-CNTL-NBR-NEW     PIC  9(09).    02270000
022800                 20  ASC-CNTL-NBR-METH-CDE-NEW     PIC  X(01).    02280000
022900                 20  ASC-TRK-IND-NEW               PIC  X(01).    02290000
023000                 20  ASC-OVRRD-CNTL-NBR-NEWX.                     02300000
023100                     25  ASC-OVRRD-CNTL-NBR-NEW    PIC  9(09).    02310000
023200                 20  ASC-OVRRD-CNTL-NBR-IND-NEW    PIC  X(01).    02320000
023300             15  ASC-OTHER-FIELDS.                                02330000
023400                 20  ASC-ENT-ID                    PIC S9(9) COMP.02340000
023500                 20  ASC-VENDOR-NAME               PIC X(35).     02350000
023600                 20  ASC-VEND-INCHG-QUAL           PIC  X(02).    02360000
023700                 20  ASC-VEND-INCHG-ID             PIC  X(15).    02370000
023800                 20  ASC-NETWK-ID                  PIC  X(01).    02380000
023900                 20  ASC-NRFC-ID                   PIC  X(01).    02390000
024000                 20  ASC-NETWORK-NAME              PIC  X(15).    02400000
024100                 20  ASC-FUNC-NME                  PIC  X(25).    02410000
024200                 20  ASC-LAST-CHG-DTE         PIC X(10).          02420000
024300                 20  ASC-LAST-CHG-DTE-RDF     REDEFINES           02430000
024400                     ASC-LAST-CHG-DTE.                            02440000
024500                     25  ASC-LAST-CHG-DTE-YY  PIC X(04).          02450000
024600                     25  FILLER               PIC X(01).          02460000
024700                     25  ASC-LAST-CHG-DTE-MM  PIC X(02).          02470000
024800                     25  FILLER               PIC X(01).          02480000
024900                     25  ASC-LAST-CHG-DTE-DD  PIC X(02).          02490000
025000                 20  ASC-LAST-CHG-UID              PIC  X(08).    02500000
025100                 20  ASC-CURRENT-TIMESTAMP    PIC X(26).          02510000
025200                 20  ASC-CURRENT-TS-RDF       REDEFINES           02520000
025300                     ASC-CURRENT-TIMESTAMP.                       02530000
025400                     25  ASC-CURRENT-DATE     PIC X(10).          02540000
025500                     25  FILLER               PIC X(01).          02550000
025600                     25  ASC-CURRENT-TIME.                        02560000
025700                         30  ASC-HH           PIC 9(02).          02570000
025800                         30  FILLER           PIC X(01).          02580000
025900                         30  ASC-MIN          PIC 9(02).          02590000
026000                         30  FILLER           PIC X(01).          02600000
026100                         30  ASC-SEC          PIC 9(02).          02610000
026200                         30  FILLER           PIC X(01).          02620000
026300                         30  ASC-MILLI-SEC    PIC 9(06).          02630000
026400                 20  ASC-TRDPRT-INACTV-DTE    PIC X(10).          02640000
026500                 20  ASC-TRDPRT-ACTV-DTE      PIC X(10).          02650000
026600                                                                  02660000
026700             15  ASC-USE-SELECTION-QUEUE-IND                      02670000
026800                                        PIC  X(01).               02680000
026900                 88  ASC-USE-SELECTION-QUEUE        VALUE 'Y'.    02690000
027000             15  ASC-SEL-QUEUE-NAME     PIC  X(08).               02700000
027100             15  ASC-NUMBER-OF-TS-ITEMS PIC S9(05)  COMP-3.       02710000
027200             15  ASC-NUMBER-OF-SELECTED-ITEMS                     02720000
027300                                        PIC S9(09)  COMP-3.       02730000
027400             15  ASC-SEL-SUB            PIC S9(04)  COMP.         02740000
027500             15  ASC-SEL-ITEM           PIC S9(04)  COMP.         02750000
027600             15  ASC-INTER-APPL-COPY    PIC X(200).               02760000
027700                                                                  02770000
027800/                                                                 02780000
027900*---------------------------------------------------------------* 02790000
028000*    ABEND PROCESSING COPYBOOK.                                 * 02800000
028100*---------------------------------------------------------------* 02810000
028200     COPY DPWS013.                                                02820000
028300                                                                  02830000
028400/                                                                 02840000
028500*    DB2 AREA FOR FUNCTIONAL GROUPS                               02850000
028600                                                                  02860000
028700     EXEC SQL                                                     02870000
028800          INCLUDE TTRDFNC                                         02880000
028900     END-EXEC.                                                    02890000
029000                                                                  02900000
029100*    DB2 AREA FOR TRANSACTION SET TABLE                           02910000
029200                                                                  02920000
029300     EXEC SQL                                                     02930000
029400          INCLUDE TTRDTRN                                         02940000
029500     END-EXEC.                                                    02950000
029600                                                                  02960000
029700*    DB2 AREA FOR TRADING PARTNERSHIP TABLE                       02970000
029800                                                                  02980000
029900     EXEC SQL                                                     02990000
030000          INCLUDE TTRDPRT                                         03000000
030100     END-EXEC.                                                    03010000
030200                                                                  03020000
030300*    DB2 AREA FOR FUNC_CDE DESCRIPTIONS                           03030000
030400                                                                  03040000
030500     EXEC SQL                                                     03050000
030600          INCLUDE TFCNGRP                                         03060000
030700     END-EXEC.                                                    03070000
030800/                                                                 03080000
030900*    DB2 AREA FOR VENDOR EXTERNAL ENTERPRISE TABLE                03090000
031000                                                                  03100000
031100     EXEC SQL                                                     03110000
031200          INCLUDE TEXTENT                                         03120000
031300     END-EXEC.                                                    03130000
031400/                                                                 03140000
031500*    DB2 AREA FOR THE VENDOR NAME TABLE                           03150000
031600                                                                  03160000
031700     EXEC SQL                                                     03170000
031800          INCLUDE TENTNME                                         03180000
031900     END-EXEC.                                                    03190000
032000/                                                                 03200000
032100*---------------------------------------------------------------* 03210000
032200*    DB2 AREA FOR COMMUNICATIONS                                * 03220000
032300*---------------------------------------------------------------* 03230000
032400     EXEC SQL                                                     03240000
032500          INCLUDE SQLCA                                           03250000
032600     END-EXEC.                                                    03260000
032700                                                                  03270000
032800/                                                                 03280000
032900 LINKAGE SECTION.                                                 03290000
033000                                                                  03300000
033100 01  DFHCOMMAREA.                                                 03310000
033200     05  FILLER                         OCCURS  1 TO 4072 TIMES   03320000
033300                                        DEPENDING ON EIBCALEN.    03330000
033400         10  FILLER                     PIC X.                    03340000
033500                                                                  03350000
033600/                                                                 03360000
033700 PROCEDURE DIVISION.                                              03370000
033800*---------------------------------------------------------------* 03380000
033900*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 03390000
034000*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 03400000
034100*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 03410000
034200*---------------------------------------------------------------* 03420000
034300 0000-MAIN-MODULE.                                                03430000
034400                                                                  03440000
034500     INITIALIZE DP030-CICS-API-FIELDS.                            03450000
034600                                                                  03460000
034700     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03470000
034800     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03480000
034900     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03490000
035000                                                                  03500000
035100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03510000
035200                                                                  03520000
035300     MOVE LENGTH OF ET312AI        TO DP030-MAP-LENGTH (1).       03530000
035400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03540000
035500                                                                  03550000
035600     PERFORM 0001-CALL-CICS-ARCH-API.                             03560000
035700     PERFORM 1000-CONTROL-PROCESSING                              03570000
035800                                                                  03580000
035900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03590000
036000     PERFORM 0001-CALL-CICS-ARCH-API.                             03600000
036100                                                                  03610000
036200*---------------------------------------------------------------* 03620000
036300*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 03630000
036400*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 03640000
036500*---------------------------------------------------------------* 03650000
036600 0001-CALL-CICS-ARCH-API.                                         03660000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03670003
036800                                    DFHCOMMAREA                   03680003
036900                                    DP030-CICS-API-FIELDS         03690003
037000                                    DP020-STANDARD-COMMAREA       03700003
037100                                    ET312AI.                      03710003
037200                                                                  03720000
037300     IF  DP030-RC-CALL-SUCCESSFUL                                 03730000
037400         CONTINUE                                                 03740000
037500     ELSE                                                         03750000
037600         SET DP013-NO-ROLLBACK                                    03760000
037700             DP013-XCTL-DISPLAY-RESTART                           03770000
037800             DP013-CICS-ABEND      TO TRUE                        03780000
037900         MOVE '0001-CALL-CICS-ARCH-API'                           03790000
038000                                   TO DP013-PARAGRAPH             03800000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03810003
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03820003
038300         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      03830000
038400         PERFORM DP013-0000-PROCESS-ABEND                         03840000
038500     END-IF.                                                      03850000
038600                                                                  03860000
038700*---------------------------------------------------------------- 03870000
038800* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT       03880000
038900* COURSE OF ACTION IS FOR THIS TRANSACTION.                       03890000
039000*---------------------------------------------------------------- 03900000
039100                                                                  03910000
039200 1000-CONTROL-PROCESSING.                                         03920000
039300                                                                  03930000
039400     EVALUATE TRUE                                                03940000
039500         WHEN DP020-NEXT-ACT-INITIAL                              03950000
039600              PERFORM 1100-FIND-OBJECT-KEYS                       03960000
039700              IF  PS-ERROR                                        03970000
039800                  CONTINUE                                        03980000
039900              ELSE                                                03990000
040000                  MOVE ASC-KEY-TP-DKEY TO DK-TP-DKEY              04000000
040100                  PERFORM 4030-GET-TTRDPRT-ACTV-DTES              04010000
040200                  MOVE TRDPRT-ACTV-DTE   TO ASC-TRDPRT-ACTV-DTE   04020000
040300                  MOVE TRDPRT-INACTV-DTE TO ASC-TRDPRT-INACTV-DTE 04030000
040400                  EXEC SQL                                        04040000
040500                    SET :ASC-CURRENT-TIMESTAMP = CURRENT TIMESTAMP04050000
040600                  END-EXEC                                        04060000
040700                  EVALUATE TRUE                                   04070000
040800                      WHEN SQLCODE = 0                            04080000
040900                          CONTINUE                                04090000
041000                      WHEN OTHER                                  04100000
041100                          MOVE '1000-CONTROL-PROCESSING'          04110000
041200                                       TO DP013-PARAGRAPH         04120000
041300                          MOVE 'SET VARIABLE TO CURRENT TIMESTAMP'04130000
041400                                       TO DP013-MESSAGE-TEXT(1)   04140000
041500                          MOVE SQLCA   TO DP013-SQLCA             04150000
041600                          MOVE 'N/A    '                          04160000
041700                                       TO DP013-DB2-TABLE-NAME (1)04170000
041800                          SET DP013-DB2-ABEND                     04180000
041900                              DP013-XCTL-DISPLAY-RESTART TO TRUE  04190000
042000                          PERFORM DP013-0000-PROCESS-ABEND        04200000
042100                  END-EVALUATE                                    04210000
042200                  IF ASC-TRDPRT-INACTV-DTE < ASC-CURRENT-DATE     04220000
042300                  OR ASC-TRDPRT-ACTV-DTE   = PC-NULL-DATE         04230000
042400                      PERFORM 4000-BUILD-INITIAL-PANEL            04240000
042500                      PERFORM 3250-SET-ATTRIBUTES-TO-PROT         04250000
042600                      SET DP030-SET-CURSOR-TRAILER TO TRUE        04260000
042700*                     ** TRADING PARTNER INACTIVE. MAINTENANCE ** 04270000
042800*                     ** NOT ALLOWED                           ** 04280000
042900                      MOVE PC-TSYMSG-00836                        04290000
043000                                         TO DP020-MSG-NUMBER      04300000
043100                      SET DP020-MSG-INFORMATIONAL                 04310000
043200                                         TO TRUE                  04320000
043300                  ELSE                                            04330000
043400                      PERFORM 4000-BUILD-INITIAL-PANEL            04340000
043500                      PERFORM 3200-RESET-ATTRIBUTES               04350000
043600                      PERFORM 3500-SAVE-SCREEN-FIELDS             04360000
043700                      IF  SQLCODE = +100                          04370000
043800                      AND NOT ASC-ADD-PENDING                     04380000
043900                          SET DP020-NEXT-ACT-APPL-ERROR           04390000
044000                                         TO TRUE                  04400000
044100                          MOVE PC-TSYMSG-00148                    04410000
044200                                         TO DP020-MSG-NUMBER      04420000
044300                          SET DP020-MSG-INFORMATIONAL             04430000
044400                                         TO TRUE                  04440000
044500                      ELSE                                        04450000
044600                          IF  ASC-DELETE-PENDING                  04460000
044700*                             ** PRESS PF2 TO CONFIRM DELETE **   04470000
044800                              MOVE PC-TSYMSG-00004                04480000
044900                                         TO DP020-MSG-NUMBER      04490000
045000                              SET DP020-MSG-INFORMATIONAL         04500000
045100                                         TO TRUE                  04510000
045200                          END-IF                                  04520000
045300                      END-IF                                      04530000
045400                  END-IF                                          04540000
045500              END-IF                                              04550000
045600                                                                  04560000
045700         WHEN DP020-NEXT-ACT-READ-MAP                             04570000
045800             MOVE ASC-INTER-APPL-COPY TO INTER-APPL-COMM-AREA     04580000
045900             IF DP020-FK-NEXT-SELECTION (DP020-SRC-AID)           04590000
046000             OR DP020-FK-PREV-SELECTION (DP020-SRC-AID)           04600000
046100                 PERFORM 2000-PROCESS-PANEL                       04610000
046200             ELSE                                                 04620000
046300                 IF ASC-TRDPRT-INACTV-DTE < ASC-CURRENT-DATE      04630000
046400                 OR ASC-TRDPRT-ACTV-DTE   = PC-NULL-DATE          04640000
046500                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         04650000
046600                     PERFORM 3250-SET-ATTRIBUTES-TO-PROT          04660000
046700                     SET DP030-SET-CURSOR-TRAILER TO TRUE         04670000
046800*                    ** TRADING PARTNER INACTIVE. MAINTENANCE **  04680000
046900*                    ** NOT ALLOWED                           **  04690000
047000                     MOVE PC-TSYMSG-00836                         04700000
047100                                    TO DP020-MSG-NUMBER           04710000
047200                     SET DP020-MSG-INFORMATIONAL                  04720000
047300                                    TO TRUE                       04730000
047400                 ELSE                                             04740000
047500                     PERFORM 2000-PROCESS-PANEL                   04750000
047600                 END-IF                                           04760000
047700             END-IF                                               04770000
047800                                                                  04780000
047900         WHEN DP020-NEXT-ACT-RETURN                               04790000
048000             MOVE ASC-INTER-APPL-COPY TO INTER-APPL-COMM-AREA     04800000
048100             IF ASC-TRDPRT-INACTV-DTE < ASC-CURRENT-DATE          04810000
048200             OR ASC-TRDPRT-ACTV-DTE   = PC-NULL-DATE              04820000
048300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             04830000
048400                 PERFORM 3250-SET-ATTRIBUTES-TO-PROT              04840000
048500                 SET DP030-SET-CURSOR-TRAILER TO TRUE             04850000
048600*                ** TRADING PARTNER INACTIVE. MAINTENANCE **      04860000
048700*                ** NOT ALLOWED                           **      04870000
048800                 MOVE PC-TSYMSG-00836                             04880000
048900                                    TO DP020-MSG-NUMBER           04890000
049000                 SET DP020-MSG-INFORMATIONAL                      04900000
049100                                    TO TRUE                       04910000
049200             ELSE                                                 04920000
049300                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               04930000
049400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             04940000
049500             END-IF                                               04950000
049600                                                                  04960000
049700         WHEN OTHER                                               04970000
049800             SET DP013-LOGIC-ABEND TO TRUE                        04980000
049900             SET DP013-NO-ROLLBACK TO TRUE                        04990000
050000             MOVE '1000-CONTROL-PROCESSING'                       05000000
050100                                   TO DP013-PARAGRAPH             05010000
050200             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   05020000
050300                                   TO DP013-MESSAGE-TEXT(1)       05030000
050400             MOVE DP020-NEXT-APPL-ACTIVITY                        05040000
050500                                   TO DP013-MESSAGE-TEXT(2)       05050000
050600             PERFORM DP013-0000-PROCESS-ABEND                     05060000
050700     END-EVALUATE.                                                05070000
050800                                                                  05080000
050900     MOVE INTER-APPL-COMM-AREA TO ASC-INTER-APPL-COPY.            05090000
051000/                                                                 05100000
051100*---------------------------------------------------------------- 05110000
051200*  DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE     05120000
051300*  INTER-APPLICATION FORMAT CODE.                                 05130000
051400*---------------------------------------------------------------- 05140000
051500 1100-FIND-OBJECT-KEYS.                                           05150000
051600                                                                  05160000
051700     INITIALIZE ASC-SPECIFIC-COMMAREA.                            05170000
051800                                                                  05180000
051900     MOVE DP020-INT-APPL-FORMAT-IND                               05190000
052000                                 TO ASC-INT-APPL-FORMAT-IND.      05200000
052100                                                                  05210000
052200     MOVE ET300-TP-DKEY          TO                               05220000
052300          ASC-KEY-TP-DKEY                                         05230000
052400     MOVE ET300-ENT-ID           TO                               05240000
052500          ASC-ENT-ID                                              05250000
052600     MOVE ET300-VEND-INCHG-ID    TO                               05260000
052700          ASC-VEND-INCHG-ID                                       05270000
052800     MOVE ET300-VEND-INCHG-QUAL  TO                               05280000
052900          ASC-VEND-INCHG-QUAL                                     05290000
053000     MOVE ET300-NETWK-ID         TO                               05300000
053100          ASC-NETWK-ID                                            05310000
053200     MOVE ET300-NETWORK-NAME     TO                               05320000
053300          ASC-NETWORK-NAME                                        05330000
053400     MOVE ET300-VENDOR-NAME      TO                               05340000
053500          ASC-VENDOR-NAME                                         05350000
053600     MOVE ET300-FUNC-CDE         TO                               05360000
053700          ASC-KEY-FUNC-CDE                                        05370000
053800     MOVE ET300-DIR-IND          TO                               05380000
053900          ASC-KEY-DIR-IND                                         05390000
054000                                                                  05400000
054100     MOVE DP020-INT-APPL-FORMAT-IND TO                            05410000
054200          PV-INT-APPL-FORMAT-IND                                  05420000
054300                                                                  05430000
054400     EVALUATE TRUE                                                05440000
054500                                                                  05450000
054600         WHEN PV-INTER-APPL-CRIT-ADD                              05460000
054700             SET ASC-ADD-PENDING TO TRUE                          05470000
054800                                                                  05480000
054900         WHEN PV-INTER-APPL-LIST-UPDATE                           05490000
055000         WHEN PV-INTER-APPL-LIST-DELETE                           05500000
055100             IF PV-INTER-APPL-LIST-UPDATE                         05510000
055200                 SET ASC-UPDATE-PENDING                           05520000
055300                             TO TRUE                              05530000
055400             ELSE                                                 05540000
055500                 SET ASC-DELETE-PENDING                           05550000
055600                             TO TRUE                              05560000
055700             END-IF                                               05570000
055800             SET ASC-USE-SELECTION-QUEUE                          05580000
055900                             TO TRUE                              05590000
056000             MOVE ET300-NBR-SELECTED-ITEMS                        05600000
056100                             TO ASC-NUMBER-OF-SELECTED-ITEMS      05610000
056200             MOVE ET300-NUMBER-OF-TS-ITEMS                        05620000
056300                             TO ASC-NUMBER-OF-TS-ITEMS            05630000
056400             MOVE ET300-SEL-QUEUE-NAME                            05640000
056500                             TO ASC-SEL-QUEUE-NAME                05650000
056600             PERFORM 1120-PREPARE-LIST-ENTRY                      05660000
056700                                                                  05670000
056800         WHEN OTHER                                               05680000
056900             MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER             05690000
057000             SET DP020-MSG-FATAL                                  05700000
057100                 DP020-NEXT-ACT-APPL-ERROR                        05710000
057200                 PS-ERROR        TO TRUE                          05720000
057300     END-EVALUATE.                                                05730000
057400                                                                  05740000
057500/                                                                 05750000
057600*---------------------------------------------------------------- 05760000
057700* ENTRY IS FROM A LIST.  GET THE FORMAT NUMBER FROM THE TEMP      05770000
057800* STORAGE QUEUE PASSED FROM THE LIST.                             05780000
057900*---------------------------------------------------------------- 05790000
058000 1120-PREPARE-LIST-ENTRY.                                         05800000
058100                                                                  05810000
058200     MOVE ET301-MAX-ITEMS          TO ASC-SEL-SUB.                05820000
058300     MOVE ZERO                     TO ASC-SEL-ITEM.               05830000
058400     PERFORM 2110-GET-NEXT-RECORD.                                05840000
058500                                                                  05850000
058600/                                                                 05860000
058700*---------------------------------------------------------------- 05870000
058800* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA    05880000
058900* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT    05890000
059000* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST   05900000
059100* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID       05910000
059200* FUNCTION KEYS CAN GET THIS FAR.                                 05920000
059300*---------------------------------------------------------------- 05930000
059400                                                                  05940000
059500 2000-PROCESS-PANEL.                                              05950000
059600                                                                  05960000
059700     EVALUATE TRUE                                                05970000
059800         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    05980000
059900             IF  ASC-DELETE-SUCCESSFUL                            05990000
060000                 MOVE PC-TSYMSG-00116                             06000000
060100                                   TO DP020-MSG-NUMBER            06010000
060200                 SET DP020-MSG-FATAL                              06020000
060300                     PS-ERROR      TO TRUE                        06030000
060400                 PERFORM 3200-RESET-ATTRIBUTES                    06040000
060500             ELSE                                                 06050000
060600                 SET DP030-CONTINUE-GO                            06060000
060700                                   TO TRUE                        06070000
060800                 IF ASC-KEY-FUNC-CDE = 'PO'                       06080000
060900********  ONLY PROCEED WITH THE DELETE OF THE 850 PURCHASE ORDER  06090000
061000********  IF AN 860 PURCHASE ORDER CHANGE DOES NOT EXIST          06100000
061100                     INITIALIZE PS-PC860-EXISTS-SW                06110000
061200                     PERFORM 7050-CHK-FOR-PC860                   06120000
061300                     IF PS-PC860-NOT-EXIST                        06130000
061400                        PERFORM 7000-DELETE-TTRDFNC               06140000
061500                        PERFORM 8000-CHECK-PO-ASN-IND             06150000
061600                        MOVE 'Y' TO PS-MQ-SEND-SW                 06160000
061700                        PERFORM 8050-CHECK-EDI-PO-ASN-IND         06170000
061800                     END-IF                                       06180000
061900                 ELSE                                             06190000
062000                     PERFORM 7000-DELETE-TTRDFNC                  06200000
062100                     IF ASC-KEY-FUNC-CDE = 'PO' OR                06210000
062200                        ASC-KEY-FUNC-CDE = 'PC' OR                06220000
062300                        ASC-KEY-FUNC-CDE = 'SH'                   06230000
062400                        PERFORM 8000-CHECK-PO-ASN-IND             06240000
062500                        MOVE 'Y' TO PS-MQ-SEND-SW                 06250000
062600                     END-IF                                       06260000
062700                     PERFORM 8050-CHECK-EDI-PO-ASN-IND            06270000
062800                 END-IF                                           06280000
062900             END-IF                                               06290000
063000                                                                  06300000
063100         WHEN DP020-SRC-AID = DP016-CLEAR                         06310000
063200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06320000
063300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06330000
063400                                                                  06340000
063500         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06350000
063600*            SET DP030-DONT-ERASE                                 06360000
063700*                DP030-SEND-DATAONLY (PC-APPL-MAP)                06370000
063800*                              TO TRUE                            06380000
063900             PERFORM 4000-BUILD-INITIAL-PANEL                     06390000
064000             PERFORM 3200-RESET-ATTRIBUTES                        06400000
064100             PERFORM 3500-SAVE-SCREEN-FIELDS                      06410000
064200                                                                  06420000
064300         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             06430000
064400             IF  ASC-USE-SELECTION-QUEUE                          06440000
064500                 PERFORM 2110-GET-NEXT-RECORD                     06450000
064600                 PERFORM 4000-BUILD-INITIAL-PANEL                 06460000
064700                 IF ASC-TRDPRT-INACTV-DTE < ASC-CURRENT-DATE      06470000
064800                 OR ASC-TRDPRT-ACTV-DTE   = PC-NULL-DATE          06480000
064900                     PERFORM 3250-SET-ATTRIBUTES-TO-PROT          06490000
065000                     SET DP030-SET-CURSOR-TRAILER TO TRUE         06500000
065100*                    ** TRADING PARTNER INACTIVE. MAINTENANCE **  06510000
065200*                    ** NOT ALLOWED                           **  06520000
065300                     MOVE PC-TSYMSG-00836                         06530000
065400                                    TO DP020-MSG-NUMBER           06540000
065500                     SET DP020-MSG-INFORMATIONAL                  06550000
065600                                    TO TRUE                       06560000
065700                 ELSE                                             06570000
065800                     PERFORM 3200-RESET-ATTRIBUTES                06580000
065900                 END-IF                                           06590000
066000             ELSE                                                 06600000
066100*                --- BOTTOM OF LIST ---                           06610000
066200                 MOVE PC-TSYMSG-00070                             06620000
066300                                   TO DP020-MSG-NUMBER            06630000
066400                 SET DP020-MSG-INFORMATIONAL                      06640000
066500                                   TO TRUE                        06650000
066600             END-IF                                               06660000
066700                                                                  06670000
066800         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             06680000
066900             IF  ASC-USE-SELECTION-QUEUE                          06690000
067000                 PERFORM 2120-GET-PREV-RECORD                     06700000
067100                 PERFORM 4000-BUILD-INITIAL-PANEL                 06710000
067200                 IF ASC-TRDPRT-INACTV-DTE < ASC-CURRENT-DATE      06720000
067300                 OR ASC-TRDPRT-ACTV-DTE   = PC-NULL-DATE          06730000
067400                     PERFORM 3250-SET-ATTRIBUTES-TO-PROT          06740000
067500                     SET DP030-SET-CURSOR-TRAILER TO TRUE         06750000
067600*                    ** TRADING PARTNER INACTIVE. MAINTENANCE **  06760000
067700*                    ** NOT ALLOWED                           **  06770000
067800                     MOVE PC-TSYMSG-00836                         06780000
067900                                    TO DP020-MSG-NUMBER           06790000
068000                     SET DP020-MSG-INFORMATIONAL                  06800000
068100                                    TO TRUE                       06810000
068200                 ELSE                                             06820000
068300                     PERFORM 3200-RESET-ATTRIBUTES                06830000
068400                 END-IF                                           06840000
068500             ELSE                                                 06850000
068600*                --- TOP OF LIST ---                              06860000
068700                 MOVE PC-TSYMSG-00069                             06870000
068800                                   TO DP020-MSG-NUMBER            06880000
068900                 SET DP020-MSG-INFORMATIONAL                      06890000
069000                                   TO TRUE                        06900000
069100             END-IF                                               06910000
069200                                                                  06920000
069300         WHEN OTHER                                               06930000
069400             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06940000
069500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06950000
069600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06960000
069700             IF  PS-NO-ERROR                                      06970000
069800                 SET DP030-CONTINUE-GO                            06980000
069900                                   TO TRUE                        06990000
070000                 PERFORM 2100-CHECK-FUNCTION-KEY                  07000000
070100             ELSE                                                 07010000
070200                 SET DP030-OVERRIDE-GO                            07020000
070300                                   TO TRUE                        07030000
070400             END-IF                                               07040000
070500     END-EVALUATE.                                                07050000
070600                                                                  07060000
070700/                                                                 07070000
070800*---------------------------------------------------------------- 07080000
070900* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST. 07090000
071000* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE   07100000
071100* CICS ARCHITECTURE API.                                          07110000
071200*---------------------------------------------------------------- 07120000
071300 2100-CHECK-FUNCTION-KEY.                                         07130000
071400                                                                  07140000
071500     EVALUATE TRUE                                                07150000
071600         WHEN DP020-SRC-AID = DP016-ENTER                         07160000
071700             CONTINUE                                             07170000
071800                                                                  07180000
071900         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 07190000
072000                                                                  07200000
072100             IF ASC-ADD-PENDING                                   07210000
072200                 PERFORM 5000-ADD-TTRDFNC                         07220000
072300             END-IF                                               07230000
072400                                                                  07240000
072500             MOVE ASC-KEY-TP-DKEY     TO ET300-TP-DKEY            07250000
072600             MOVE ASC-ENT-ID          TO ET300-ENT-ID             07260000
072700             MOVE ASC-VENDOR-NAME     TO ET300-VENDOR-NAME        07270000
072800             MOVE ASC-VEND-INCHG-ID   TO ET300-VEND-INCHG-ID      07280000
072900             MOVE ASC-VEND-INCHG-QUAL TO ET300-VEND-INCHG-QUAL    07290000
073000                                                                  07300000
073100             MOVE ASC-NETWK-ID        TO ET300-NETWK-ID           07310000
073200             MOVE ASC-NETWORK-NAME    TO ET300-NETWORK-NAME       07320000
073300                                                                  07330000
073400             MOVE ASC-KEY-FUNC-CDE    TO ET300-FUNC-CDE           07340000
073500             MOVE ASC-KEY-DIR-IND     TO ET300-DIR-IND            07350000
073600                                                                  07360000
073700         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              07370000
073800             IF ASC-UPDATE-PENDING                                07380000
073900                 PERFORM 3600-CHECK-IF-FIELDS-CHANGED             07390000
074000                 IF  ASC-FIELDS-CHANGED                           07400000
074100                     SET DP030-CONTINUE-GO                        07410000
074200                                       TO TRUE                    07420000
074300                     PERFORM 6000-UPDATE-TTRDFNC                  07430000
074400                 ELSE                                             07440000
074500                     MOVE PC-TSYMSG-00046                         07450000
074600                                       TO DP020-MSG-NUMBER        07460000
074700                     SET DP020-MSG-INFORMATIONAL                  07470000
074800                                       TO TRUE                    07480000
074900                 END-IF                                           07490000
075000             END-IF                                               07500000
075100                                                                  07510000
075200         WHEN OTHER                                               07520000
075300             SET DP013-NO-ROLLBACK                                07530000
075400                 DP013-XCTL-DISPLAY-RESTART                       07540000
075500                 DP013-CICS-ABEND  TO TRUE                        07550000
075600             MOVE '2100-CHECK-FUNCTION-KEY'                       07560000
075700                                   TO DP013-PARAGRAPH             07570000
075800             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07580000
075900                                   TO DP013-MESSAGE-TEXT (1)      07590000
076000             PERFORM DP013-0000-PROCESS-ABEND                     07600000
076100     END-EVALUATE.                                                07610000
076200                                                                  07620000
076300/                                                                 07630000
076400 2110-GET-NEXT-RECORD.                                            07640000
076500                                                                  07650000
076600     ADD +1                        TO ASC-SEL-SUB.                07660000
076700     IF  ASC-SEL-SUB > ET301-MAX-ITEMS                            07670000
076800         ADD +1                    TO ASC-SEL-ITEM                07680000
076900         MOVE +1                   TO ASC-SEL-SUB                 07690000
077000     END-IF.                                                      07700000
077100                                                                  07710000
077200     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                07720000
077300         PERFORM 9100-READ-SEL-QUEUE                              07730000
077400         IF  ET301-ITEM (ASC-SEL-SUB) > ZERO                      07740000
077500             MOVE ET301-TP-DKEY     (ASC-SEL-SUB)                 07750000
077600                                   TO ASC-KEY-TP-DKEY             07760000
077700             MOVE ET301-ENT-ID   (ASC-SEL-SUB)                    07770000
077800                                   TO ASC-ENT-ID                  07780000
077900             MOVE ET301-VENDOR-NAME   (ASC-SEL-SUB)               07790000
078000                                   TO ASC-VENDOR-NAME             07800000
078100             MOVE ET301-VEND-INCHG-ID (ASC-SEL-SUB)               07810000
078200                                   TO ASC-VEND-INCHG-ID           07820000
078300             MOVE ET301-VEND-INCHG-QUAL (ASC-SEL-SUB)             07830000
078400                                   TO ASC-VEND-INCHG-QUAL         07840000
078500             MOVE ET301-NETWK-ID        (ASC-SEL-SUB)             07850000
078600                                   TO ASC-NETWK-ID                07860000
078700             MOVE ET301-NETWK-NAME      (ASC-SEL-SUB)             07870000
078800                                   TO ASC-NETWORK-NAME            07880000
078900             MOVE ET301-FUNC-CDE        (ASC-SEL-SUB)             07890000
079000                                   TO ASC-KEY-FUNC-CDE            07900000
079100             MOVE ET301-DIR-IND         (ASC-SEL-SUB)             07910000
079200                                   TO ASC-KEY-DIR-IND             07920000
079300*-->         IT'S POSSIBLE THAT THE USER DID AN UPDATE, DID A     07930000
079400*-->         "PREV", AND DID A NEXT TO RE-DISPLAY THIS RECORD.    07940000
079500*-->         IF SO, ET301-ACTION-SW WOULD EQUAL 'U', AND SHOULD   07950000
079600*-->         STAY THAT WAY.  THAT WAY, WHEN PF3'ING BACK TO THE   07960000
079700*-->         LIST, "UPD" WILL SHOW UP BESIDE THE UPDATED REC.     07970000
079800             IF ET301-ACTION-SW (ASC-SEL-SUB) > SPACES            07980000
079900                 CONTINUE                                         07990000
080000             ELSE                                                 08000000
080100                 SET ET301-INQ (ASC-SEL-SUB)                      08010000
080200                                       TO TRUE                    08020000
080300                 PERFORM 9200-REWRITE-LIST-QUEUE                  08030000
080400             END-IF                                               08040000
080500         ELSE                                                     08050000
080600             SUBTRACT +1 FROM ASC-SEL-SUB                         08060000
080700*            --- BOTTOM OF LIST ---                               08070000
080800             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08080000
080900             SET DP020-MSG-INFORMATIONAL                          08090000
081000                                   TO TRUE                        08100000
081100         END-IF                                                   08110000
081200     ELSE                                                         08120000
081300         SUBTRACT +1 FROM ASC-SEL-ITEM                            08130000
081400         MOVE ET301-MAX-ITEMS      TO ASC-SEL-SUB                 08140000
081500         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08150000
081600         SET DP020-MSG-INFORMATIONAL                              08160000
081700                                   TO TRUE                        08170000
081800     END-IF.                                                      08180000
081900                                                                  08190000
082000/                                                                 08200000
082100 2120-GET-PREV-RECORD.                                            08210000
082200                                                                  08220000
082300     SUBTRACT +1 FROM ASC-SEL-SUB.                                08230000
082400     IF  ASC-SEL-SUB < +1                                         08240000
082500         SUBTRACT +1 FROM ASC-SEL-ITEM                            08250000
082600         MOVE ET301-MAX-ITEMS      TO ASC-SEL-SUB                 08260000
082700     END-IF.                                                      08270000
082800                                                                  08280000
082900     IF  ASC-SEL-ITEM > ZERO                                      08290000
083000         PERFORM 9100-READ-SEL-QUEUE                              08300000
083100         MOVE ET301-TP-DKEY     (ASC-SEL-SUB)                     08310000
083200                               TO ASC-KEY-TP-DKEY                 08320000
083300         MOVE ET301-ENT-ID   (ASC-SEL-SUB)                        08330000
083400                               TO ASC-ENT-ID                      08340000
083500         MOVE ET301-VENDOR-NAME   (ASC-SEL-SUB)                   08350000
083600                               TO ASC-VENDOR-NAME                 08360000
083700         MOVE ET301-VEND-INCHG-ID (ASC-SEL-SUB)                   08370000
083800                               TO ASC-VEND-INCHG-ID               08380000
083900         MOVE ET301-VEND-INCHG-QUAL    (ASC-SEL-SUB)              08390000
084000                               TO ASC-VEND-INCHG-QUAL             08400000
084100         MOVE ET301-NETWK-ID        (ASC-SEL-SUB)                 08410000
084200                               TO ASC-NETWK-ID                    08420000
084300         MOVE ET301-NETWK-NAME      (ASC-SEL-SUB)                 08430000
084400                               TO ASC-NETWORK-NAME                08440000
084500         MOVE ET301-FUNC-CDE        (ASC-SEL-SUB)                 08450000
084600                               TO ASC-KEY-FUNC-CDE                08460000
084700         MOVE ET301-DIR-IND         (ASC-SEL-SUB)                 08470000
084800                               TO ASC-KEY-DIR-IND                 08480000
084900     ELSE                                                         08490000
085000         MOVE +1                   TO ASC-SEL-ITEM                08500000
085100                                      ASC-SEL-SUB                 08510000
085200*        --- TOP OF LIST ---                                      08520000
085300         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            08530000
085400         SET DP020-MSG-INFORMATIONAL                              08540000
085500                                   TO TRUE                        08550000
085600     END-IF.                                                      08560000
085700                                                                  08570000
085800/                                                                 08580000
085900*---------------------------------------------------------------- 08590000
086000*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE      08600000
086100*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.   08610000
086200*---------------------------------------------------------------- 08620000
086300 2200-MOVE-SCREEN-TO-COMMAREA.                                    08630000
086400                                                                  08640000
086500       IF FNCCDEL >       ZERO                                    08650000
086600           MOVE FNCCDEI TO ASC-KEY-FUNC-CDE                       08660000
086700       ELSE                                                       08670000
086800           IF FNCCDEF = DP015-ERASE-EOF                           08680000
086900               MOVE SPACES TO ASC-KEY-FUNC-CDE                    08690000
087000                              ASC-FUNC-NME                        08700000
087100           END-IF                                                 08710000
087200       END-IF                                                     08720000
087300                                                                  08730000
087400       IF DIRL    >       ZERO                                    08740000
087500           MOVE DIRI       TO ASC-KEY-DIR-IND                     08750000
087600       ELSE                                                       08760000
087700           IF DIRF    = DP015-ERASE-EOF                           08770000
087800               MOVE SPACES TO ASC-KEY-DIR-IND                     08780000
087900           END-IF                                                 08790000
088000       END-IF                                                     08800000
088100                                                                  08810000
088200       IF CTLNBRL >       ZERO                                    08820000
088300           MOVE CTLNBRI TO ASC-LAST-CNTL-NBR-NEWX                 08830000
088400       ELSE                                                       08840000
088500           IF CTLNBRF = DP015-ERASE-EOF                           08850000
088600               MOVE ZEROS  TO ASC-LAST-CNTL-NBR-NEW               08860000
088700           END-IF                                                 08870000
088800       END-IF                                                     08880000
088900                                                                  08890000
089000       IF MTHDL >         ZERO                                    08900000
089100           MOVE MTHDI TO ASC-CNTL-NBR-METH-CDE-NEW                08910000
089200       ELSE                                                       08920000
089300           IF MTHDF = DP015-ERASE-EOF                             08930000
089400               MOVE SPACES TO ASC-CNTL-NBR-METH-CDE-NEW           08940000
089500           END-IF                                                 08950000
089600       END-IF                                                     08960000
089700                                                                  08970000
089800       IF DOCL  >         ZERO                                    08980000
089900           MOVE DOCI  TO ASC-TRK-IND-NEW                          08990000
090000       ELSE                                                       09000000
090100           IF DOCF  = DP015-ERASE-EOF                             09010000
090200               MOVE SPACES TO ASC-TRK-IND-NEW                     09020000
090300           END-IF                                                 09030000
090400       END-IF                                                     09040000
090500                                                                  09050000
090600       IF OVRDNBRL >      ZERO                                    09060000
090700           MOVE OVRDNBRI TO ASC-OVRRD-CNTL-NBR-NEWX               09070000
090800       ELSE                                                       09080000
090900           IF OVRDNBRF = DP015-ERASE-EOF                          09090000
091000               MOVE ZEROS  TO ASC-OVRRD-CNTL-NBR-NEW              09100000
091100           END-IF                                                 09110000
091200       END-IF                                                     09120000
091300                                                                  09130000
091400       IF OVRDINDL >     ZERO                                     09140000
091500           MOVE OVRDINDI TO ASC-OVRRD-CNTL-NBR-IND-NEW            09150000
091600       ELSE                                                       09160000
091700           IF OVRDINDF = DP015-ERASE-EOF                          09170000
091800               MOVE SPACES TO ASC-OVRRD-CNTL-NBR-IND-NEW          09180000
091900           END-IF                                                 09190000
092000       END-IF.                                                    09200000
092100                                                                  09210000
092200/                                                                 09220000
092300*---------------------------------------------------------------- 09230000
092400*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE        09240000
092500*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).   09250000
092600*---------------------------------------------------------------- 09260000
092700 3000-EDIT-DATA-IN-COMMAREA.                                      09270000
092800                                                                  09280000
092900     SET PS-NO-ERROR         TO TRUE                              09290000
093000                                                                  09300000
093100     PERFORM 3200-RESET-ATTRIBUTES.                               09310000
093200                                                                  09320000
093300     EVALUATE TRUE                                                09330000
093400       WHEN ASC-ADD-PENDING                                       09340000
093500         PERFORM 3010-ADD-EDITS                                   09350000
093600         PERFORM 3020-UPDATE-EDITS                                09360000
093700       WHEN ASC-UPDATE-PENDING                                    09370000
093800         PERFORM 3020-UPDATE-EDITS                                09380000
093900     END-EVALUATE.                                                09390000
094000/                                                                 09400000
094100 3010-ADD-EDITS.                                                  09410000
094200                                                                  09420000
094300     IF ASC-KEY-FUNC-CDE = SPACE                                  09430000
094400         MOVE SPACE                          TO ASC-FUNC-NME      09440000
094500         MOVE DP015-UNP-ALP-BRT-MDT          TO FNCCDEA           09450000
094600         MOVE DP015-RED                      TO FNCCDEC           09460000
094700         MOVE DP015-REVERSE                  TO FNCCDEH           09470000
094800         IF PS-NO-ERROR                                           09480000
094900             SET PS-ERROR                    TO TRUE              09490000
095000             MOVE PC-TSYMSG-00007            TO DP020-MSG-NUMBER  09500000
095100             SET DP020-MSG-FATAL             TO TRUE              09510000
095200             MOVE -1                         TO FNCCDEL           09520000
095300             SET DP030-SET-CURSOR-APPL-1     TO TRUE              09530000
095400         END-IF                                                   09540000
095500     ELSE                                                         09550000
095600         MOVE ASC-KEY-FUNC-CDE               TO DK-FUNC-CDE       09560000
095700         PERFORM 4020-GET-FUNC-DESC                               09570000
095800         IF SQLCODE = +0                                          09580000
095900             MOVE FCNGRP-FUNC-NME            TO ASC-FUNC-NME      09590000
096000         ELSE                                                     09600000
096100             MOVE SPACE                      TO ASC-FUNC-NME      09610000
096200             MOVE DP015-UNP-ALP-BRT-MDT      TO FNCCDEA           09620000
096300             MOVE DP015-RED                  TO FNCCDEC           09630000
096400             MOVE DP015-REVERSE              TO FNCCDEH           09640000
096500             IF PS-NO-ERROR                                       09650000
096600                 SET PS-ERROR                TO TRUE              09660000
096700                 MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER  09670000
096800                 SET DP020-MSG-FATAL         TO TRUE              09680000
096900                 MOVE -1                     TO FNCCDEL           09690000
097000                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              09700000
097100             END-IF                                               09710000
097200         END-IF                                                   09720000
097300     END-IF.                                                      09730000
097400                                                                  09740000
097500     IF ASC-KEY-DIR-IND = 'R' OR 'S'                              09750000
097600         CONTINUE                                                 09760000
097700     ELSE                                                         09770000
097800         SET DP020-MSG-FATAL       TO TRUE                        09780000
097900         MOVE DP015-UNP-ALP-BRT-MDT                               09790000
098000                                   TO DIRA                        09800000
098100         MOVE DP015-RED            TO DIRC                        09810000
098200         MOVE DP015-REVERSE        TO DIRH                        09820000
098300         IF PS-NO-ERROR                                           09830000
098400             SET PS-ERROR          TO TRUE                        09840000
098500             MOVE PC-TSYMSG-00763  TO DP020-MSG-NUMBER            09850000
098600             MOVE -1               TO DIRL                        09860000
098700         END-IF                                                   09870000
098800         SET DP030-SET-CURSOR-APPL-1                              09880000
098900                                   TO TRUE                        09890000
099000     END-IF.                                                      09900000
099100                                                                  09910000
099200*   COMMENTED OUT BELOW CODE TO ALLOW INBOUND 'FA'.               09920000
099300                                                                  09930000
099400*    IF  ASC-KEY-FUNC-CDE = 'FA'                                  09940000
099500*    AND ASC-KEY-DIR-IND =  'R'                                   09950000
099600*        SET DP020-MSG-FATAL       TO TRUE                        09960000
099700*        MOVE DP015-UNP-ALP-BRT-MDT                               09970000
099800*                                  TO FNCCDEA                     09980000
099900*                                     DIRA                        09990000
100000*        MOVE DP015-RED            TO FNCCDEC                     10000000
100100*                                     DIRC                        10010000
100200*        MOVE DP015-REVERSE        TO FNCCDEH                     10020000
100300*                                     DIRH                        10030000
100400*        IF PS-NO-ERROR                                           10040000
100500*            SET PS-ERROR          TO TRUE                        10050000
100600*            ** RECEIVING AN FA WILL NOT BE RECORDED **           10060000
100700*            MOVE PC-TSYMSG-00838  TO DP020-MSG-NUMBER            10070000
100800*            MOVE -1               TO FNCCDEL                     10080000
100900*            SET DP030-SET-CURSOR-APPL-1                          10090000
101000*                                  TO TRUE                        10100000
101100*        END-IF                                                   10110000
101200*    END-IF.                                                      10120000
101300                                                                  10130000
101400     IF PS-NO-ERROR                                               10140000
101500         PERFORM 3015-EDIT-FOR-EXISTANCE                          10150000
101600     END-IF.                                                      10160000
101700                                                                  10170000
101800 3015-EDIT-FOR-EXISTANCE.                                         10180000
101900                                                                  10190000
102000     PERFORM                                                      10200000
102100         WITH TEST AFTER                                          10210000
102200         VARYING PV-RETRY-COUNTER                                 10220000
102300         FROM 1 BY 1                                              10230000
102400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10240000
102500            OR (SQLCODE = +0))                                    10250000
102600                                                                  10260000
102700         MOVE +0 TO PV-DUP-COUNTER                                10270000
102800                                                                  10280000
102900         EXEC SQL                                                 10290000
103000           SELECT COUNT(*)                                        10300000
103100           INTO   :PV-DUP-COUNTER                                 10310000
103200           FROM   TTRDFNC                                         10320000
103300           WHERE  TP_DKEY            = :ASC-KEY-TP-DKEY           10330000
103400             AND  FUNC_CDE           = :ASC-KEY-FUNC-CDE          10340000
103500             AND  DIR_IND            = :ASC-KEY-DIR-IND           10350000
103600         END-EXEC                                                 10360000
103700                                                                  10370000
103800         EVALUATE TRUE                                            10380000
103900             WHEN SQLCODE = +0                                    10390000
104000             WHEN SQLCODE = -904                                  10400000
104100             WHEN SQLCODE = -913                                  10410000
104200                 CONTINUE                                         10420000
104300                                                                  10430000
104400             WHEN SQLWARN0 NOT = SPACES                           10440000
104500             WHEN SQLCODE < ZERO                                  10450000
104600             WHEN SQLCODE > ZERO                                  10460000
104700                 MOVE '3015-COUNT-TTRDFNC'                        10470000
104800                                   TO DP013-PARAGRAPH             10480000
104900                 MOVE 'SELECT ON TTRDFNC'                         10490000
105000                                   TO DP013-MESSAGE-TEXT (1)      10500000
105100                 MOVE SQLCA        TO DP013-SQLCA                 10510000
105200                 MOVE 'TTRDFNC'    TO DP013-DB2-TABLE-NAME (1)    10520000
105300                 SET DP013-DB2-ABEND                              10530000
105400                     DP013-XCTL-DISPLAY-RESTART                   10540000
105500                                   TO TRUE                        10550000
105600                 PERFORM DP013-0000-PROCESS-ABEND                 10560000
105700         END-EVALUATE                                             10570000
105800     END-PERFORM.                                                 10580000
105900                                                                  10590000
106000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10600000
106100         MOVE '3015-COUNT-TTRDFNC'                                10610000
106200                                   TO DP013-PARAGRAPH             10620000
106300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     10630000
106400                                   TO DP013-MESSAGE-TEXT (1)      10640000
106500         MOVE 'A TTRDFNC ROW   '   TO DP013-MESSAGE-TEXT (2)      10650000
106600         MOVE SQLCA                TO DP013-SQLCA                 10660000
106700         MOVE 'TTRDFNC'            TO DP013-DB2-TABLE-NAME (1)    10670000
106800         SET DP013-DB2-ABEND                                      10680000
106900             DP013-XCTL-DISPLAY-RESTART                           10690000
107000                                   TO TRUE                        10700000
107100         PERFORM DP013-0000-PROCESS-ABEND                         10710000
107200     END-IF.                                                      10720000
107300                                                                  10730000
107400     IF PV-DUP-COUNTER > +0                                       10740000
107500         SET PS-ERROR                   TO TRUE                   10750000
107600         SET DP020-MSG-FATAL            TO TRUE                   10760000
107700         MOVE PC-TSYMSG-00231           TO DP020-MSG-NUMBER       10770000
107800         MOVE DP015-UNP-ALP-BRT-MDT     TO FNCCDEA                10780000
107900                                           DIRA                   10790000
108000         MOVE DP015-RED                 TO FNCCDEC                10800000
108100                                           DIRC                   10810000
108200         MOVE DP015-REVERSE             TO FNCCDEH                10820000
108300                                           DIRH                   10830000
108400         MOVE -1                        TO FNCCDEL                10840000
108500         SET DP030-SET-CURSOR-APPL-1    TO TRUE                   10850000
108600     END-IF.                                                      10860000
108700/                                                                 10870000
108800 3020-UPDATE-EDITS.                                               10880000
108900                                                                  10890000
109000     IF ASC-LAST-CNTL-NBR-NEWX > SPACES                           10900000
109100         MOVE ASC-LAST-CNTL-NBR-NEWX                              10910000
109200                                     TO DP010I-UNEDITED-FIELD     10920000
109300         MOVE 9                      TO DP010I-MAXIMUM-DIGITS     10930000
109400         MOVE 0                      TO DP010I-MAXIMUM-DECIMALS   10940000
109500         SET DP010I-NEGATIVE-NOT-ALLOWED                          10950000
109600                                     TO TRUE                      10960000
109710         CALL DP010I-NUMERIC-EDIT-ROUTINE                         10971001
109720                         USING DP010I-NUMERIC-EDIT-AREA           10972001
109800         IF DP010I-ERROR-DETECTED                                 10980000
109900             MOVE DP015-REVERSE      TO CTLNBRH                   10990000
110000             MOVE DP015-RED          TO CTLNBRC                   11000000
110100             MOVE DP015-UNP-ALP-BRT-MDT                           11010000
110200                                     TO CTLNBRA                   11020000
110300             IF PS-NO-ERROR                                       11030000
110400                 SET PS-ERROR        TO TRUE                      11040000
110500                 MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER         11050000
110600                 MOVE -1             TO CTLNBRL                   11060000
110700             END-IF                                               11070000
110800             SET DP030-SET-CURSOR-APPL-1                          11080000
110900                                       TO TRUE                    11090000
111000         ELSE                                                     11100000
111100             MOVE DP010I-NUMERIC-FIELD                            11110000
111200                                     TO ASC-LAST-CNTL-NBR-NEW     11120000
111300         END-IF                                                   11130000
111400     ELSE                                                         11140000
111500         MOVE ZERO TO ASC-LAST-CNTL-NBR-NEW                       11150000
111600     END-IF                                                       11160000
111700                                                                  11170000
111800     IF ASC-CNTL-NBR-METH-CDE-NEW = ' '                           11180000
111900         MOVE '1'                  TO ASC-CNTL-NBR-METH-CDE-NEW   11190000
112000     END-IF                                                       11200000
112100                                                                  11210000
112200     IF  ASC-KEY-DIR-IND = 'S'                                    11220000
112300         IF  ASC-CNTL-NBR-METH-CDE-NEW = '1'                      11230000
112400             CONTINUE                                             11240000
112500         ELSE                                                     11250000
112600            SET DP020-MSG-FATAL           TO TRUE                 11260000
112700            MOVE DP015-UNP-ALP-BRT-MDT    TO MTHDA                11270000
112800            MOVE DP015-RED                TO MTHDC                11280000
112900            MOVE DP015-REVERSE            TO MTHDH                11290000
113000            IF  PS-NO-ERROR                                       11300000
113100                MOVE -1                   TO MTHDL                11310000
113200                MOVE PC-TSYMSG-00005      TO DP020-MSG-NUMBER     11320000
113300                SET PS-ERROR              TO TRUE                 11330000
113400            END-IF                                                11340000
113500            SET DP030-SET-CURSOR-APPL-1   TO TRUE                 11350000
113600         END-IF                                                   11360000
113700     ELSE                                                         11370000
113800         IF  ASC-CNTL-NBR-METH-CDE-NEW = '0' OR '1'               11380000
113900             CONTINUE                                             11390000
114000         ELSE                                                     11400000
114100             SET DP020-MSG-FATAL          TO TRUE                 11410000
114200             MOVE DP015-UNP-ALP-BRT-MDT   TO MTHDA                11420000
114300             MOVE DP015-RED               TO MTHDC                11430000
114400             MOVE DP015-REVERSE           TO MTHDH                11440000
114500             IF  PS-NO-ERROR                                      11450000
114600                 MOVE -1                  TO MTHDL                11460000
114700                 MOVE PC-TSYMSG-00760     TO DP020-MSG-NUMBER     11470000
114800                 SET PS-ERROR             TO TRUE                 11480000
114900             END-IF                                               11490000
115000             SET DP030-SET-CURSOR-APPL-1                          11500000
115100                                          TO TRUE                 11510000
115200         END-IF                                                   11520000
115300     END-IF                                                       11530000
115400                                                                  11540000
115500     IF ASC-OVRRD-CNTL-NBR-NEWX > SPACES                          11550000
115600         MOVE ASC-OVRRD-CNTL-NBR-NEWX                             11560000
115700                                     TO DP010I-UNEDITED-FIELD     11570000
115800         MOVE 9                      TO DP010I-MAXIMUM-DIGITS     11580000
115900         MOVE 0                      TO DP010I-MAXIMUM-DECIMALS   11590000
116000         SET DP010I-NEGATIVE-NOT-ALLOWED                          11600000
116100                                     TO TRUE                      11610000
116210         CALL DP010I-NUMERIC-EDIT-ROUTINE                         11621001
116220                         USING DP010I-NUMERIC-EDIT-AREA           11622001
116300         IF DP010I-ERROR-DETECTED                                 11630000
116400             MOVE DP015-REVERSE      TO OVRDNBRH                  11640000
116500             MOVE DP015-RED          TO OVRDNBRC                  11650000
116600             MOVE DP015-UNP-ALP-BRT-MDT                           11660000
116700                                     TO OVRDNBRA                  11670000
116800             IF PS-NO-ERROR                                       11680000
116900                 SET PS-ERROR        TO TRUE                      11690000
117000                 MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER         11700000
117100                 MOVE -1             TO OVRDNBRL                  11710000
117200             END-IF                                               11720000
117300             SET DP030-SET-CURSOR-APPL-1                          11730000
117400                                       TO TRUE                    11740000
117500         ELSE                                                     11750000
117600             MOVE DP010I-NUMERIC-FIELD                            11760000
117700                                     TO ASC-OVRRD-CNTL-NBR-NEW    11770000
117800         END-IF                                                   11780000
117900     ELSE                                                         11790000
118000         MOVE ZERO TO ASC-OVRRD-CNTL-NBR-NEW                      11800000
118100     END-IF                                                       11810000
118200                                                                  11820000
118300     IF ASC-OVRRD-CNTL-NBR-IND-NEW = ' '                          11830000
118400         MOVE 'N' TO ASC-OVRRD-CNTL-NBR-IND-NEW                   11840000
118500     END-IF                                                       11850000
118600                                                                  11860000
118700     IF ASC-OVRRD-CNTL-NBR-IND-NEW = 'Y' OR 'N'                   11870000
118800         CONTINUE                                                 11880000
118900     ELSE                                                         11890000
119000         SET DP020-MSG-FATAL       TO TRUE                        11900000
119100         MOVE DP015-UNP-ALP-BRT-MDT                               11910000
119200                                   TO OVRDINDA                    11920000
119300         MOVE DP015-RED            TO OVRDINDC                    11930000
119400         MOVE DP015-REVERSE        TO OVRDINDH                    11940000
119500         IF PS-NO-ERROR                                           11950000
119600             MOVE -1                   TO OVRDINDL                11960000
119700             MOVE PC-TSYMSG-00349      TO DP020-MSG-NUMBER        11970000
119800             SET PS-ERROR              TO TRUE                    11980000
119900         END-IF                                                   11990000
120000         SET DP030-SET-CURSOR-APPL-1                              12000000
120100                                   TO TRUE                        12010000
120200     END-IF.                                                      12020000
120300                                                                  12030000
120400*********************************************************         12040000
120500*   ADDED CODE BELOW TO ALLOW US TO SET UP INBOUND 'FA'           12050000
120600*   RELATIONSHIPS.                                                12060000
120700*********************************************************         12070000
120800     IF ASC-TRK-IND-NEW = ' '                                     12080000
120900         IF ASC-KEY-DIR-IND = 'S'                                 12090000
121000             IF  ASC-KEY-FUNC-CDE = 'FA'                          12100000
121100                 MOVE '0'              TO ASC-TRK-IND-NEW         12110000
121200             ELSE                                                 12120000
121300                 MOVE '1'              TO ASC-TRK-IND-NEW         12130000
121400             END-IF                                               12140000
121500         ELSE                                                     12150000
121600             IF ASC-KEY-DIR-IND = 'R'                             12160000
121700                IF  ASC-KEY-FUNC-CDE = 'FA'                       12170000
121800                    MOVE '0'              TO ASC-TRK-IND-NEW      12180000
121900                ELSE                                              12190000
122000                    MOVE 'R'              TO ASC-TRK-IND-NEW      12200000
122100                END-IF                                            12210000
122200             END-IF                                               12220000
122300         END-IF                                                   12230000
122400     END-IF                                                       12240000
122500                                                                  12250000
122600     SET PS-TRK-ERR TO TRUE                                       12260000
122700                                                                  12270000
122800     EVALUATE TRUE                                                12280000
122900         WHEN ASC-KEY-DIR-IND = 'S'                               12290000
123000             IF  ASC-KEY-FUNC-CDE = 'FA'                          12300000
123100                 IF ASC-TRK-IND-NEW = '0'                         12310000
123200                     SET PS-TRK-OK  TO TRUE                       12320000
123300                 ELSE                                             12330000
123400                     IF PS-NO-ERROR                               12340000
123500                         MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER12350000
123600                     END-IF                                       12360000
123700                 END-IF                                           12370000
123800             ELSE                                                 12380000
123900                 IF ASC-TRK-IND-NEW = '1' OR '0'                  12390000
124000                     SET PS-TRK-OK  TO TRUE                       12400000
124100                 ELSE                                             12410000
124200                     IF PS-NO-ERROR                               12420000
124300                         MOVE PC-TSYMSG-00760  TO DP020-MSG-NUMBER12430000
124400                     END-IF                                       12440000
124500                 END-IF                                           12450000
124600             END-IF                                               12460000
124700         WHEN ASC-KEY-DIR-IND = 'R'                               12470000
124800             IF ASC-TRK-IND-NEW = '0' OR 'R' OR 'E'               12480000
124900                 SET PS-TRK-OK  TO TRUE                           12490000
125000             ELSE                                                 12500000
125100                 IF PS-NO-ERROR                                   12510000
125200                     MOVE PC-TSYMSG-00764  TO DP020-MSG-NUMBER    12520000
125300                 END-IF                                           12530000
125400             END-IF                                               12540000
125500     END-EVALUATE.                                                12550000
125600                                                                  12560000
125700     IF PS-TRK-ERR                                                12570000
125800         SET DP020-MSG-FATAL       TO TRUE                        12580000
125900         MOVE DP015-UNP-ALP-BRT-MDT                               12590000
126000                                   TO DOCA                        12600000
126100         MOVE DP015-RED            TO DOCC                        12610000
126200         MOVE DP015-REVERSE        TO DOCH                        12620000
126300         MOVE -1                   TO DOCL                        12630000
126400         SET PS-ERROR              TO TRUE                        12640000
126500         SET DP030-SET-CURSOR-APPL-1                              12650000
126600                                   TO TRUE                        12660000
126700     END-IF.                                                      12670000
126800/                                                                 12680000
126900 3200-RESET-ATTRIBUTES.                                           12690000
127000                                                                  12700000
127100     MOVE DP015-BLUE           TO  FNCCDEC                        12710000
127200                                   DIRC                           12720000
127300                                   CTLNBRC                        12730000
127400                                   MTHDC                          12740000
127500                                   OVRDNBRC                       12750000
127600                                   OVRDINDC                       12760000
127700                                   DOCC                           12770000
127800                                                                  12780000
127900     MOVE DP015-PRO-NOR-OFF    TO  FNCCDEA                        12790000
128000                                   DIRA                           12800000
128100                                   CTLNBRA                        12810000
128200                                   MTHDA                          12820000
128300                                   OVRDNBRA                       12830000
128400                                   OVRDINDA                       12840000
128500                                   DOCA                           12850000
128600                                                                  12860000
128700     MOVE DP015-HL-OFF         TO  FNCCDEH                        12870000
128800                                   DIRH                           12880000
128900                                   CTLNBRH                        12890000
129000                                   MTHDH                          12900000
129100                                   OVRDNBRH                       12910000
129200                                   OVRDINDH                       12920000
129300                                   DOCH                           12930000
129400                                                                  12940000
129500     IF  ASC-UPDATE-PENDING OR                                    12950000
129600         ASC-ADD-PENDING                                          12960000
129700         MOVE DP015-UNP-ALP-NOR-OFF TO CTLNBRA                    12970000
129800                                       MTHDA                      12980000
129900                                       OVRDNBRA                   12990000
130000                                       OVRDINDA                   13000000
130100                                       DOCA                       13010000
130200         MOVE DP015-GREEN           TO CTLNBRC                    13020000
130300                                       MTHDC                      13030000
130400                                       OVRDNBRC                   13040000
130500                                       OVRDINDC                   13050000
130600                                       DOCC                       13060000
130700         MOVE DP015-UNDERLINE       TO CTLNBRH                    13070000
130800                                       MTHDH                      13080000
130900                                       OVRDNBRH                   13090000
131000                                       OVRDINDH                   13100000
131100                                       DOCH                       13110000
131200     END-IF                                                       13120000
131300                                                                  13130000
131400     IF  ASC-ADD-PENDING                                          13140000
131500         MOVE DP015-UNP-ALP-NOR-OFF TO FNCCDEA                    13150000
131600                                       DIRA                       13160000
131700         MOVE DP015-GREEN           TO FNCCDEC                    13170000
131800                                       DIRC                       13180000
131900         MOVE DP015-UNDERLINE       TO FNCCDEH                    13190000
132000                                       DIRH                       13200000
132100     END-IF.                                                      13210000
132200                                                                  13220000
132300 3250-SET-ATTRIBUTES-TO-PROT.                                     13230000
132400                                                                  13240000
132500     MOVE DP015-BLUE           TO  FNCCDEC                        13250000
132600                                   DIRC                           13260000
132700                                   CTLNBRC                        13270000
132800                                   MTHDC                          13280000
132900                                   OVRDNBRC                       13290000
133000                                   OVRDINDC                       13300000
133100                                   DOCC                           13310000
133200                                                                  13320000
133300     MOVE DP015-PRO-NOR-OFF    TO  FNCCDEA                        13330000
133400                                   DIRA                           13340000
133500                                   CTLNBRA                        13350000
133600                                   MTHDA                          13360000
133700                                   OVRDNBRA                       13370000
133800                                   OVRDINDA                       13380000
133900                                   DOCA                           13390000
134000                                                                  13400000
134100     MOVE DP015-HL-OFF         TO  FNCCDEH                        13410000
134200                                   DIRH                           13420000
134300                                   CTLNBRH                        13430000
134400                                   MTHDH                          13440000
134500                                   OVRDNBRH                       13450000
134600                                   OVRDINDH                       13460000
134700                                   DOCH.                          13470000
134800                                                                  13480000
134900/                                                                 13490000
135000*---------------------------------------------------------------- 13500000
135100*    SAVE SCREEN FIELDS FOR LATER COMPARISONS                     13510000
135200*---------------------------------------------------------------- 13520000
135300                                                                  13530000
135400 3500-SAVE-SCREEN-FIELDS.                                         13540000
135500                                                                  13550000
135600     MOVE ASC-NEWLY-ENTERED-FIELDS        TO                      13560000
135700          ASC-ORIGINAL-FIELD-VALUES.                              13570000
135800/                                                                 13580000
135900*---------------------------------------------------------------- 13590000
136000*  CHECK TO SEE IF ANY FIELDS CHANGED.                            13600000
136100*---------------------------------------------------------------- 13610000
136200                                                                  13620000
136300 3600-CHECK-IF-FIELDS-CHANGED.                                    13630000
136400                                                                  13640000
136500     MOVE 'N'                    TO ASC-FIELDS-CHANGED-SW.        13650000
136600                                                                  13660000
136700     IF   ASC-NEWLY-ENTERED-FIELDS       =                        13670000
136800          ASC-ORIGINAL-FIELD-VALUES                               13680000
136900         CONTINUE                                                 13690000
137000     ELSE                                                         13700000
137100         SET ASC-FIELDS-CHANGED  TO TRUE                          13710000
137200     END-IF.                                                      13720000
137300                                                                  13730000
137400/                                                                 13740000
137500*---------------------------------------------------------------- 13750000
137600*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST      13760000
137700*    ENTRY.                                                       13770000
137800*---------------------------------------------------------------- 13780000
137900                                                                  13790000
138000 4000-BUILD-INITIAL-PANEL.                                        13800000
138100                                                                  13810000
138200     INITIALIZE DCLTTRDFNC                                        13820000
138300                DCLTFCNGRP                                        13830000
138400                DK-DB2-KEYS                                       13840000
138500                ASC-NEWLY-ENTERED-FIELDS                          13850000
138600                ASC-ORIGINAL-FIELD-VALUES.                        13860000
138700                                                                  13870000
138800     IF ASC-ADD-PENDING                                           13880000
138900         INITIALIZE  ASC-KEY-FUNC-CDE                             13890000
139000                     ASC-KEY-DIR-IND                              13900000
139100     END-IF                                                       13910000
139200                                                                  13920000
139300     MOVE ASC-KEY-TP-DKEY        TO DK-TP-DKEY                    13930000
139400     MOVE ASC-KEY-FUNC-CDE       TO DK-FUNC-CDE                   13940000
139500     MOVE ASC-KEY-DIR-IND        TO DK-DIR-IND                    13950000
139600                                                                  13960000
139700     PERFORM 4010-GET-TTRDFNC.                                    13970000
139800                                                                  13980000
139900     IF ASC-ADD-PENDING                                           13990000
140000         MOVE ASC-CURRENT-DATE   TO ASC-LAST-CHG-DTE              14000000
140100         MOVE DP020-USERID       TO ASC-LAST-CHG-UID              14010000
140200     END-IF                                                       14020000
140300                                                                  14030000
140400     IF SQLCODE = +100                                            14040000
140500         IF ASC-UPDATE-PENDING OR                                 14050000
140600            ASC-DELETE-PENDING                                    14060000
140700             SET PS-ERROR                                         14070000
140800                 DP020-MSG-FATAL                                  14080000
140900                 DP030-SET-CURSOR-TRAILER TO TRUE                 14090000
141000*-->         ** DETAIL DOESN'T EXIST **                           14100000
141100             IF ASC-UPDATE-PENDING                                14110000
141200                 MOVE PC-TSYMSG-00134    TO DP020-MSG-NUMBER      14120000
141300             ELSE                                                 14130000
141400                 SET ASC-DELETE-SUCCESSFUL TO TRUE                14140000
141500                 MOVE PC-TSYMSG-00116    TO DP020-MSG-NUMBER      14150000
141600             END-IF                                               14160000
141700         END-IF                                                   14170000
141800     ELSE                                                         14180000
141900         IF  ASC-DELETE-PENDING                                   14190000
142000             MOVE PC-TSYMSG-00004  TO DP020-MSG-NUMBER            14200000
142100             SET DP020-MSG-INFORMATIONAL                          14210000
142200                                   TO TRUE                        14220000
142300             IF  ASC-DELETE-SUCCESSFUL                            14230000
142400                 MOVE SPACES       TO ASC-DELETE-SUCCESSFUL-SW    14240000
142500             END-IF                                               14250000
142600         END-IF                                                   14260000
142700     END-IF.                                                      14270000
142800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        14280000
142900                                                                  14290000
143000*----------------------------------------------------------------*14300000
143100*  RETRIEVE THE ROW ASSOCIATED W/ THE DK- FIELDS                  14310000
143200*----------------------------------------------------------------*14320000
143300                                                                  14330000
143400 4010-GET-TTRDFNC.                                                14340000
143500                                                                  14350000
143600     PERFORM                                                      14360000
143700         WITH TEST AFTER                                          14370000
143800         VARYING PV-RETRY-COUNTER                                 14380000
143900         FROM 1 BY 1                                              14390000
144000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14400000
144100             OR (SQLCODE = +0)                                    14410000
144200             OR (SQLCODE = +100))                                 14420000
144300                                                                  14430000
144400         EXEC SQL                                                 14440000
144500              SELECT  LAST_CNTL_NBR                               14450000
144600                     ,CNTL_NBR_METH_CDE                           14460000
144700                     ,OVRRD_CNTL_NBR                              14470000
144800                     ,OVRRD_CNTL_NBR_IND                          14480000
144900                     ,TRK_IND                                     14490000
145000                     ,LAST_CHG_DTE                                14500000
145100                     ,LAST_CHG_UID                                14510000
145200                INTO  :TRDFNC-LAST-CNTL-NBR                       14520000
145300                     ,:TRDFNC-CNTL-NBR-METH-CDE                   14530000
145400                     ,:TRDFNC-OVRRD-CNTL-NBR                      14540000
145500                     ,:TRDFNC-OVRRD-CNTL-NBR-IND                  14550000
145600                     ,:TRDFNC-TRK-IND                             14560000
145700                     ,:TRDFNC-LAST-CHG-DTE                        14570000
145800                     ,:TRDFNC-LAST-CHG-UID                        14580000
145900                FROM TTRDFNC                                      14590000
146000               WHERE TP_DKEY  = :DK-TP-DKEY                       14600000
146100                 AND FUNC_CDE = :DK-FUNC-CDE                      14610000
146200                 AND DIR_IND  = :DK-DIR-IND                       14620000
146300         END-EXEC                                                 14630000
146400                                                                  14640000
146500         EVALUATE TRUE                                            14650000
146600             WHEN SQLCODE = +0                                    14660000
146700             WHEN SQLCODE = +100                                  14670000
146800             WHEN SQLCODE = -904                                  14680000
146900             WHEN SQLCODE = -913                                  14690000
147000                  CONTINUE                                        14700000
147100                                                                  14710000
147200             WHEN SQLWARN0 NOT = SPACES                           14720000
147300             WHEN SQLCODE < +0                                    14730000
147400             WHEN SQLCODE > +0                                    14740000
147500                  MOVE '4010-GET-TRDFNC'                          14750000
147600                                  TO DP013-PARAGRAPH              14760000
147700                  MOVE 'UNSUCCESSFUL SELECT TRDFNC'               14770000
147800                                  TO DP013-MESSAGE-TEXT (1)       14780000
147900                  MOVE SQLCA      TO DP013-SQLCA                  14790000
148000                  MOVE 'TRDFNC  ' TO DP013-DB2-TABLE-NAME (1)     14800000
148100                  SET DP013-DB2-ABEND                             14810000
148200                      DP013-XCTL-DISPLAY-RESTART                  14820000
148300                                  TO TRUE                         14830000
148400                  PERFORM DP013-0000-PROCESS-ABEND                14840000
148500         END-EVALUATE                                             14850000
148600     END-PERFORM.                                                 14860000
148700                                                                  14870000
148800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        14880000
148900         MOVE '4010-GET-TRDFNC'   TO DP013-PARAGRAPH              14890000
149000         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    14900000
149100                                  TO DP013-MESSAGE-TEXT (1)       14910000
149200         MOVE SQLCA               TO DP013-SQLCA                  14920000
149300         MOVE 'TTRDFNC '          TO DP013-DB2-TABLE-NAME (1)     14930000
149400         SET DP013-DB2-ABEND                                      14940000
149500             DP013-XCTL-DISPLAY-RESTART                           14950000
149600                                  TO TRUE                         14960000
149700         PERFORM DP013-0000-PROCESS-ABEND                         14970000
149800     END-IF.                                                      14980000
149900                                                                  14990000
150000     IF SQLCODE = +0                                              15000000
150100         PERFORM 4020-GET-FUNC-DESC                               15010000
150200     END-IF                                                       15020000
150300                                                                  15030000
150400     MOVE TRDFNC-LAST-CNTL-NBR      TO ASC-LAST-CNTL-NBR-NEW      15040000
150500     MOVE TRDFNC-CNTL-NBR-METH-CDE  TO ASC-CNTL-NBR-METH-CDE-NEW  15050000
150600     MOVE TRDFNC-OVRRD-CNTL-NBR     TO ASC-OVRRD-CNTL-NBR-NEW     15060000
150700     MOVE TRDFNC-OVRRD-CNTL-NBR-IND TO ASC-OVRRD-CNTL-NBR-IND-NEW 15070000
150800     MOVE TRDFNC-TRK-IND            TO ASC-TRK-IND-NEW            15080000
150900     MOVE TRDFNC-LAST-CHG-DTE       TO ASC-LAST-CHG-DTE           15090000
151000     MOVE TRDFNC-LAST-CHG-UID       TO ASC-LAST-CHG-UID           15100000
151100     MOVE FCNGRP-FUNC-NME           TO ASC-FUNC-NME.              15110000
151200/                                                                 15120000
151300*----------------------------------------------------------------*15130000
151400* SELECT A ROW FROM THE DB2 TPURITM TABLE.                       *15140000
151500*----------------------------------------------------------------*15150000
151600 4020-GET-FUNC-DESC.                                              15160000
151700                                                                  15170000
151800     PERFORM                                                      15180000
151900         WITH TEST AFTER                                          15190000
152000         VARYING PV-RETRY-COUNTER                                 15200000
152100         FROM 1 BY 1                                              15210000
152200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15220000
152300             OR (SQLCODE = +0)                                    15230000
152400             OR (SQLCODE = +100))                                 15240000
152500                                                                  15250000
152600                                                                  15260000
152700         EXEC SQL                                                 15270000
152800              SELECT   FUNC_NME                                   15280000
152900                INTO  :FCNGRP-FUNC-NME                            15290000
153000                FROM TFCNGRP                                      15300000
153100               WHERE FUNC_CDE = :DK-FUNC-CDE                      15310000
153200         END-EXEC                                                 15320000
153300                                                                  15330000
153400         EVALUATE TRUE                                            15340000
153500             WHEN SQLCODE = +0                                    15350000
153600             WHEN SQLCODE = +100                                  15360000
153700             WHEN SQLCODE = -904                                  15370000
153800             WHEN SQLCODE = -913                                  15380000
153900                  CONTINUE                                        15390000
154000                                                                  15400000
154100             WHEN SQLWARN0 NOT = SPACES                           15410000
154200             WHEN SQLCODE < +0                                    15420000
154300             WHEN SQLCODE > +0                                    15430000
154400                  MOVE '4020-GET-FCNGRP'                          15440000
154500                                  TO DP013-PARAGRAPH              15450000
154600                  MOVE 'UNSUCCESSFUL SELECT'                      15460000
154700                                  TO DP013-MESSAGE-TEXT (1)       15470000
154800                  MOVE SQLCA      TO DP013-SQLCA                  15480000
154900                  MOVE 'TRDFNC  ' TO DP013-DB2-TABLE-NAME (1)     15490000
155000                  SET DP013-DB2-ABEND                             15500000
155100                      DP013-XCTL-DISPLAY-RESTART                  15510000
155200                                  TO TRUE                         15520000
155300                  PERFORM DP013-0000-PROCESS-ABEND                15530000
155400         END-EVALUATE                                             15540000
155500     END-PERFORM.                                                 15550000
155600                                                                  15560000
155700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15570000
155800         MOVE '4020-GET-TFCNGRP'  TO DP013-PARAGRAPH              15580000
155900         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    15590000
156000                                  TO DP013-MESSAGE-TEXT (1)       15600000
156100         MOVE SQLCA               TO DP013-SQLCA                  15610000
156200         MOVE 'TFCNGRP '          TO DP013-DB2-TABLE-NAME (1)     15620000
156300         SET DP013-DB2-ABEND                                      15630000
156400             DP013-XCTL-DISPLAY-RESTART                           15640000
156500                                  TO TRUE                         15650000
156600         PERFORM DP013-0000-PROCESS-ABEND                         15660000
156700     END-IF.                                                      15670000
156800                                                                  15680000
156900/                                                                 15690000
157000*---------------------------------------------------------------- 15700000
157100* SELECT A TRADING PARTNERSHIP                                    15710000
157200*---------------------------------------------------------------- 15720000
157300 4030-GET-TTRDPRT-ACTV-DTES.                                      15730000
157400                                                                  15740000
157500     PERFORM                                                      15750000
157600         WITH TEST AFTER                                          15760000
157700         VARYING PV-RETRY-COUNTER                                 15770000
157800         FROM 1 BY 1                                              15780000
157900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15790000
158000            OR (SQLCODE = +0))                                    15800000
158100                                                                  15810000
158200         EXEC SQL                                                 15820000
158300             SELECT   ACTV_DTE                                    15830000
158400                   ,  INACTV_DTE                                  15840000
158500             INTO    :TRDPRT-ACTV-DTE                             15850000
158600                   , :TRDPRT-INACTV-DTE                           15860000
158700             FROM     TTRDPRT                                     15870000
158800             WHERE    TP_DKEY = :DK-TP-DKEY                       15880000
158900         END-EXEC                                                 15890000
159000                                                                  15900000
159100         EVALUATE TRUE                                            15910000
159200             WHEN SQLCODE = +0                                    15920000
159300             WHEN SQLCODE = -904                                  15930000
159400             WHEN SQLCODE = -913                                  15940000
159500                 CONTINUE                                         15950000
159600                                                                  15960000
159700             WHEN SQLWARN0 NOT = SPACES                           15970000
159800             WHEN SQLCODE < ZERO                                  15980000
159900             WHEN SQLCODE > ZERO                                  15990000
160000                 MOVE '4030-GET-TTRDPRT-ACTV-DTES'                16000000
160100                                   TO DP013-PARAGRAPH             16010000
160200                 MOVE 'SELECT ON TTRDPRT'                         16020000
160300                                   TO DP013-MESSAGE-TEXT (1)      16030000
160400                 MOVE SQLCA        TO DP013-SQLCA                 16040000
160500                 MOVE 'TTRDPRT'    TO DP013-DB2-TABLE-NAME (1)    16050000
160600                 SET DP013-DB2-ABEND                              16060000
160700                     DP013-XCTL-DISPLAY-RESTART                   16070000
160800                                   TO TRUE                        16080000
160900                 PERFORM DP013-0000-PROCESS-ABEND                 16090000
161000         END-EVALUATE                                             16100000
161100     END-PERFORM.                                                 16110000
161200                                                                  16120000
161300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16130000
161400         MOVE '4030-GET-TTRDPRT-ACTV-DTES'                        16140000
161500                                   TO DP013-PARAGRAPH             16150000
161600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     16160000
161700                                   TO DP013-MESSAGE-TEXT (1)      16170000
161800         MOVE 'A TTRDPRT ROW   '   TO DP013-MESSAGE-TEXT (2)      16180000
161900         MOVE SQLCA                TO DP013-SQLCA                 16190000
162000         MOVE 'TTRDPRT'            TO DP013-DB2-TABLE-NAME (1)    16200000
162100         SET DP013-DB2-ABEND                                      16210000
162200             DP013-XCTL-DISPLAY-RESTART                           16220000
162300                                   TO TRUE                        16230000
162400         PERFORM DP013-0000-PROCESS-ABEND                         16240000
162500     END-IF.                                                      16250000
162600                                                                  16260000
162700*----------------------------------------------------------------*16270000
162800*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *16280000
162900*----------------------------------------------------------------*16290000
163000                                                                  16300000
163100 4400-MOVE-COMMAREA-TO-SCREEN.                                    16310000
163200                                                                  16320000
163300     MOVE ASC-VENDOR-NAME                     TO VNDRNMEO         16330000
163400     MOVE ASC-VEND-INCHG-QUAL                 TO VTPIDQO          16340000
163500     MOVE ASC-VEND-INCHG-ID                   TO VTPIDO           16350000
163600     MOVE ASC-NETWK-ID                        TO NTWKCDEO         16360000
163700     MOVE ASC-NETWORK-NAME                    TO NTWKNMEO         16370000
163800     MOVE ASC-KEY-FUNC-CDE                    TO FNCCDEO          16380000
163900     MOVE ASC-FUNC-NME                        TO FNCNMEO          16390000
164000     MOVE ASC-KEY-DIR-IND                     TO DIRO             16400000
164100     MOVE ASC-LAST-CNTL-NBR-NEWX              TO CTLNBRO          16410000
164200     MOVE ASC-CNTL-NBR-METH-CDE-NEW           TO MTHDO            16420000
164300     MOVE ASC-OVRRD-CNTL-NBR-NEWX             TO OVRDNBRO         16430000
164400     MOVE ASC-OVRRD-CNTL-NBR-IND-NEW          TO OVRDINDO         16440000
164500     MOVE ASC-TRK-IND-NEW                     TO DOCO             16450000
164600                                                                  16460000
164700     IF ASC-LAST-CHG-DTE = PC-NULL-DATE                           16470000
164800         MOVE SPACES                          TO LCHGDTEO         16480000
164900     ELSE                                                         16490000
165000         STRING ASC-LAST-CHG-DTE-MM DELIMITED BY SIZE             16500000
165100                ' '                 DELIMITED BY SIZE             16510000
165200                ASC-LAST-CHG-DTE-DD DELIMITED BY SIZE             16520000
165300                ' '                 DELIMITED BY SIZE             16530000
165400                ASC-LAST-CHG-DTE-YY DELIMITED BY SIZE             16540000
165500                                            INTO LCHGDTEO         16550000
165600     END-IF                                                       16560000
165700                                                                  16570000
165800     MOVE ASC-LAST-CHG-UID                    TO LCHGUIDO         16580000
165900                                                                  16590000
166000     EVALUATE ASC-CNTL-NBR-METH-CDE-NEW                           16600000
166100         WHEN '0'                                                 16610000
166200             MOVE 'NOTRK'                     TO MTHDTXTO         16620000
166300         WHEN '1'                                                 16630000
166400             MOVE 'TRACK'                     TO MTHDTXTO         16640000
166500         WHEN OTHER                                               16650000
166600             MOVE SPACE                       TO MTHDTXTO         16660000
166700     END-EVALUATE.                                                16670000
166800                                                                  16680000
166900     EVALUATE TRUE                                                16690000
167000         WHEN ASC-KEY-DIR-IND   = 'S'                             16700000
167100             IF ASC-TRK-IND-NEW = '0'                             16710000
167200                 MOVE 'NOTRK'                 TO DOCTXTO          16720000
167300             ELSE                                                 16730000
167400                 MOVE 'TRACK'                 TO DOCTXTO          16740000
167500             END-IF                                               16750000
167600         WHEN ASC-KEY-DIR-IND   = 'R'                             16760000
167700             EVALUATE TRUE                                        16770000
167800                 WHEN ASC-TRK-IND-NEW = '0'                       16780000
167900                     MOVE 'NOACK'             TO DOCTXTO          16790000
168000                 WHEN ASC-TRK-IND-NEW = 'R'                       16800000
168100                     MOVE 'ACKREJ'            TO DOCTXTO          16810000
168200                 WHEN ASC-TRK-IND-NEW = 'E'                       16820000
168300                     MOVE 'ACKERR'            TO DOCTXTO          16830000
168400             END-EVALUATE                                         16840000
168500         WHEN OTHER                                               16850000
168600             MOVE SPACE                       TO DOCTXTO          16860000
168700     END-EVALUATE.                                                16870000
168800                                                                  16880000
168900     IF PS-NO-ERROR                                               16890000
169000         IF ASC-DELETE-PENDING                                    16900000
169100             SET DP030-SET-CURSOR-TRAILER                         16910000
169200                                        TO TRUE                   16920000
169300         ELSE                                                     16930000
169400             SET DP030-SET-CURSOR-APPL-1                          16940000
169500                                        TO TRUE                   16950000
169600             IF ASC-ADD-PENDING                                   16960000
169700                 MOVE -1                TO FNCCDEL                16970000
169800             ELSE                                                 16980000
169900                 MOVE -1                TO CTLNBRL                16990000
170000             END-IF                                               17000000
170100         END-IF                                                   17010000
170200     END-IF.                                                      17020000
170300/                                                                 17030000
170400*---------------------------------------------------------------- 17040000
170500* ADD A TRADING PARTNER RELATIONSHIP                              17050000
170600*---------------------------------------------------------------- 17060000
170700 5000-ADD-TTRDFNC.                                                17070000
170800                                                                  17080000
170900     PERFORM 6100-PREPARE-TTRDFNC.                                17090000
171000                                                                  17100000
171100     PERFORM                                                      17110000
171200         WITH TEST AFTER                                          17120000
171300         VARYING PV-RETRY-COUNTER                                 17130000
171400         FROM 1 BY 1                                              17140000
171500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17150000
171600             OR (SQLCODE = +0))                                   17160000
171700         EXEC SQL                                                 17170000
171800             INSERT INTO TTRDFNC                                  17180000
171900                        (TP_DKEY                                  17190000
172000                        ,FUNC_CDE                                 17200000
172100                        ,DIR_IND                                  17210000
172200                        ,LAST_CNTL_NBR                            17220000
172300                        ,CNTL_NBR_METH_CDE                        17230000
172400                        ,OVRRD_CNTL_NBR                           17240000
172500                        ,OVRRD_CNTL_NBR_IND                       17250000
172600                        ,TRK_IND                                  17260000
172700                        ,LAST_CHG_DTE                             17270000
172800                        ,LAST_CHG_UID)                            17280000
172900             VALUES     (:TRDFNC-TP-DKEY                          17290000
173000                        ,:TRDFNC-FUNC-CDE                         17300000
173100                        ,:TRDFNC-DIR-IND                          17310000
173200                        ,:TRDFNC-LAST-CNTL-NBR                    17320000
173300                        ,:TRDFNC-CNTL-NBR-METH-CDE                17330000
173400                        ,:TRDFNC-OVRRD-CNTL-NBR                   17340000
173500                        ,:TRDFNC-OVRRD-CNTL-NBR-IND               17350000
173600                        ,:TRDFNC-TRK-IND                          17360000
173700                        ,:TRDFNC-LAST-CHG-DTE                     17370000
173800                        ,:TRDFNC-LAST-CHG-UID)                    17380000
173900         END-EXEC                                                 17390000
174000                                                                  17400000
174100         EVALUATE TRUE                                            17410000
174200             WHEN SQLCODE = +0                                    17420000
174300             WHEN SQLCODE = -904                                  17430000
174400             WHEN SQLCODE = -913                                  17440000
174500                 CONTINUE                                         17450000
174600                                                                  17460000
174700                                                                  17470000
174800             WHEN SQLWARN0 NOT = SPACES                           17480000
174900             WHEN SQLCODE < +0                                    17490000
175000             WHEN SQLCODE > +0                                    17500000
175100                 MOVE '5000-ADD-TTRDFNC'                          17510000
175200                                   TO DP013-PARAGRAPH             17520000
175300                 MOVE 'INSERT A ROW ON TTRDFNC'                   17530000
175400                                   TO DP013-MESSAGE-TEXT(1)       17540000
175500                 MOVE SQLCA        TO DP013-SQLCA                 17550000
175600                 MOVE 'TTRDFNC'    TO DP013-DB2-TABLE-NAME (1)    17560000
175700                 SET DP013-DB2-ABEND                              17570000
175800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           17580000
175900                 PERFORM DP013-0000-PROCESS-ABEND                 17590000
176000         END-EVALUATE                                             17600000
176100     END-PERFORM.                                                 17610000
176200                                                                  17620000
176300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17630000
176400         MOVE '5000-ADD-TTRDFNC'   TO DP013-PARAGRAPH             17640000
176500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              17650000
176600                                   TO DP013-MESSAGE-TEXT (1)      17660000
176700         MOVE 'TO INSERT A TTRDFNC ROW'                           17670000
176800                                   TO DP013-MESSAGE-TEXT (2)      17680000
176900         MOVE SQLCA                TO DP013-SQLCA                 17690000
177000         MOVE 'TTRDFNC'            TO DP013-DB2-TABLE-NAME (1)    17700000
177100         SET DP013-DB2-ABEND                                      17710000
177200             DP013-XCTL-DISPLAY-RESTART                           17720000
177300                                   TO TRUE                        17730000
177400         PERFORM DP013-0000-PROCESS-ABEND                         17740000
177500     END-IF.                                                      17750000
177600                                                                  17760000
177700     MOVE PC-TSYMSG-00224        TO DP020-MSG-NUMBER              17770000
177800     SET DP020-MSG-INFORMATIONAL TO TRUE.                         17780000
177900                                                                  17790000
178000/                                                                 17800000
178100*---------------------------------------------------------------- 17810000
178200* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS   17820000
178300* OBJECT WAS UPDATED.                                             17830000
178400*---------------------------------------------------------------- 17840000
178500                                                                  17850000
178600 5200-UPDATE-SELECTION-QUEUE.                                     17860000
178700                                                                  17870000
178800     PERFORM 9100-READ-SEL-QUEUE.                                 17880000
178900                                                                  17890000
179000     IF  ASC-DELETE-SUCCESSFUL                                    17900000
179100         SET ET301-DEL (ASC-SEL-SUB)     TO TRUE                  17910000
179200     ELSE                                                         17920000
179300         SET ET301-UPD (ASC-SEL-SUB)     TO TRUE                  17930000
179400     END-IF.                                                      17940000
179500                                                                  17950000
179600     PERFORM 9200-REWRITE-LIST-QUEUE.                             17960000
179700                                                                  17970000
179800/                                                                 17980000
179900*---------------------------------------------------------------- 17990000
180000* UPDATE A TRADING PARTNERSHIP ROW                                18000000
180100*---------------------------------------------------------------- 18010000
180200 6000-UPDATE-TTRDFNC.                                             18020000
180300                                                                  18030000
180400     PERFORM 6100-PREPARE-TTRDFNC.                                18040000
180500                                                                  18050000
180600     PERFORM                                                      18060000
180700         WITH TEST AFTER                                          18070000
180800         VARYING PV-RETRY-COUNTER                                 18080000
180900         FROM 1 BY 1                                              18090000
181000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               18100000
181100             OR (SQLCODE = +0))                                   18110000
181200                                                                  18120000
181300         EXEC SQL                                                 18130000
181400             UPDATE TTRDFNC                                       18140000
181500              SET LAST_CNTL_NBR      = :TRDFNC-LAST-CNTL-NBR      18150000
181600                 ,CNTL_NBR_METH_CDE  = :TRDFNC-CNTL-NBR-METH-CDE  18160000
181700                 ,OVRRD_CNTL_NBR     = :TRDFNC-OVRRD-CNTL-NBR     18170000
181800                 ,OVRRD_CNTL_NBR_IND = :TRDFNC-OVRRD-CNTL-NBR-IND 18180000
181900                 ,TRK_IND            = :TRDFNC-TRK-IND            18190000
182000                 ,LAST_CHG_DTE       = :TRDFNC-LAST-CHG-DTE       18200000
182100                 ,LAST_CHG_UID       = :TRDFNC-LAST-CHG-UID       18210000
182200                                                                  18220000
182300             WHERE TP_DKEY  = :ASC-KEY-TP-DKEY                    18230000
182400               AND FUNC_CDE = :ASC-KEY-FUNC-CDE                   18240000
182500               AND DIR_IND  = :ASC-KEY-DIR-IND                    18250000
182600                                                                  18260000
182700         END-EXEC                                                 18270000
182800                                                                  18280000
182900         EVALUATE TRUE                                            18290000
183000             WHEN SQLCODE = +0                                    18300000
183100             WHEN SQLCODE = -904                                  18310000
183200             WHEN SQLCODE = -913                                  18320000
183300                 CONTINUE                                         18330000
183400                                                                  18340000
183500             WHEN SQLWARN0 NOT = SPACES                           18350000
183600             WHEN SQLCODE < +0                                    18360000
183700             WHEN SQLCODE > +0                                    18370000
183800                 MOVE '6000-UPDATE-TTRDFNC'                       18380000
183900                                   TO DP013-PARAGRAPH             18390000
184000                 MOVE 'UPDATE A ROW ON TTRDFNC'                   18400000
184100                                   TO DP013-MESSAGE-TEXT(1)       18410000
184200                 MOVE SQLCA        TO DP013-SQLCA                 18420000
184300                 MOVE 'TTRDFNC'    TO DP013-DB2-TABLE-NAME (1)    18430000
184400                 SET DP013-DB2-ABEND                              18440000
184500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           18450000
184600                 PERFORM DP013-0000-PROCESS-ABEND                 18460000
184700         END-EVALUATE                                             18470000
184800     END-PERFORM.                                                 18480000
184900                                                                  18490000
185000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        18500000
185100         MOVE '6000-UPDATE-TTRDFNC' TO DP013-PARAGRAPH            18510000
185200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              18520000
185300                                   TO DP013-MESSAGE-TEXT (1)      18530000
185400         MOVE 'TO UPDATE A TTRDFNC ROW'                           18540000
185500                                   TO DP013-MESSAGE-TEXT (2)      18550000
185600         MOVE SQLCA                TO DP013-SQLCA                 18560000
185700         MOVE 'TTRDFNC'            TO DP013-DB2-TABLE-NAME (1)    18570000
185800         SET DP013-DB2-ABEND                                      18580000
185900             DP013-XCTL-DISPLAY-RESTART                           18590000
186000                                   TO TRUE                        18600000
186100         PERFORM DP013-0000-PROCESS-ABEND                         18610000
186200     END-IF.                                                      18620000
186300                                                                  18630000
186400     MOVE PC-TSYMSG-00059        TO DP020-MSG-NUMBER              18640000
186500     SET DP020-MSG-INFORMATIONAL TO TRUE                          18650000
186600                                                                  18660000
186700     IF  ASC-USE-SELECTION-QUEUE                                  18670000
186800         PERFORM 5200-UPDATE-SELECTION-QUEUE                      18680000
186900     END-IF.                                                      18690000
187000                                                                  18700000
187100     PERFORM 3500-SAVE-SCREEN-FIELDS.                             18710000
187200                                                                  18720000
187300     MOVE   ASC-LAST-CHG-UID    TO LCHGUIDO.                      18730000
187400                                                                  18740000
187500     STRING ASC-LAST-CHG-DTE-MM DELIMITED BY SIZE                 18750000
187600            ' '                 DELIMITED BY SIZE                 18760000
187700            ASC-LAST-CHG-DTE-DD DELIMITED BY SIZE                 18770000
187800            ' '                 DELIMITED BY SIZE                 18780000
187900            ASC-LAST-CHG-DTE-YY DELIMITED BY SIZE                 18790000
188000                           INTO LCHGDTEO.                         18800000
188100                                                                  18810000
188200 6100-PREPARE-TTRDFNC.                                            18820000
188300                                                                  18830000
188400     INITIALIZE DCLTTRDFNC.                                       18840000
188500                                                                  18850000
188600     MOVE ASC-KEY-TP-DKEY            TO TRDFNC-TP-DKEY            18860000
188700     MOVE ASC-KEY-FUNC-CDE           TO TRDFNC-FUNC-CDE           18870000
188800     MOVE ASC-KEY-DIR-IND            TO TRDFNC-DIR-IND            18880000
188900     MOVE ASC-LAST-CNTL-NBR-NEW      TO TRDFNC-LAST-CNTL-NBR      18890000
189000     MOVE ASC-CNTL-NBR-METH-CDE-NEW  TO TRDFNC-CNTL-NBR-METH-CDE  18900000
189100     MOVE ASC-OVRRD-CNTL-NBR-NEW     TO TRDFNC-OVRRD-CNTL-NBR     18910000
189200     MOVE ASC-OVRRD-CNTL-NBR-IND-NEW TO TRDFNC-OVRRD-CNTL-NBR-IND 18920000
189300     MOVE ASC-TRK-IND-NEW            TO TRDFNC-TRK-IND            18930000
189400                                                                  18940000
189500     MOVE ASC-CURRENT-DATE           TO ASC-LAST-CHG-DTE          18950000
189600                                        TRDFNC-LAST-CHG-DTE       18960000
189700     MOVE DP020-USERID               TO ASC-LAST-CHG-UID          18970000
189800                                        TRDFNC-LAST-CHG-UID.      18980000
189900/                                                                 18990000
190000*---------------------------------------------------------------- 19000000
190100* DELETE A FUNCTIONAL GROUP ROW.  MUST FIRST DELETE ANY           19010000
190200* RELATED (VIA RI) ROWS.                                          19020000
190300*---------------------------------------------------------------- 19030000
190400 7000-DELETE-TTRDFNC.                                             19040000
190500     PERFORM 7100-DELETE-TTRDTRN                                  19050000
190600                                                                  19060000
190700     PERFORM                                                      19070000
190800         WITH TEST AFTER                                          19080000
190900         VARYING PV-RETRY-COUNTER                                 19090000
191000         FROM 1 BY 1                                              19100000
191100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               19110000
191200             OR (SQLCODE = +0))                                   19120000
191300                                                                  19130000
191400         EXEC SQL DELETE FROM TTRDFNC                             19140000
191500                                                                  19150000
191600          WHERE TP_DKEY = :ASC-KEY-TP-DKEY                        19160000
191700            AND FUNC_CDE = :ASC-KEY-FUNC-CDE                      19170000
191800            AND DIR_IND = :ASC-KEY-DIR-IND                        19180000
191900                                                                  19190000
192000         END-EXEC                                                 19200000
192100                                                                  19210000
192200         EVALUATE TRUE                                            19220000
192300             WHEN SQLCODE = +0                                    19230000
192400             WHEN SQLCODE = -904                                  19240000
192500             WHEN SQLCODE = -913                                  19250000
192600                 CONTINUE                                         19260000
192700                                                                  19270000
192800             WHEN SQLWARN0 NOT = SPACES                           19280000
192900             WHEN SQLCODE < +0                                    19290000
193000             WHEN SQLCODE > +0                                    19300000
193100                 MOVE '7000-DELETE-TTRDFNC'                       19310000
193200                                   TO DP013-PARAGRAPH             19320000
193300                 MOVE 'UPDATE A ROW ON TTRDFNC'                   19330000
193400                                   TO DP013-MESSAGE-TEXT(1)       19340000
193500                 MOVE SQLCA        TO DP013-SQLCA                 19350000
193600                 MOVE 'TTRDFNC' TO DP013-DB2-TABLE-NAME (1)       19360000
193700                 SET DP013-DB2-ABEND                              19370000
193800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           19380000
193900                 PERFORM DP013-0000-PROCESS-ABEND                 19390000
194000         END-EVALUATE                                             19400000
194100     END-PERFORM                                                  19410000
194200                                                                  19420000
194300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         19430000
194400         MOVE '7000-DELETE-TTRDFNC' TO DP013-PARAGRAPH            19440000
194500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              19450000
194600                                  TO DP013-MESSAGE-TEXT (1)       19460000
194700         MOVE 'TO DELETE A TTRDFNC ROW'                           19470000
194800                                  TO DP013-MESSAGE-TEXT (2)       19480000
194900         MOVE SQLCA                   TO DP013-SQLCA              19490000
195000         MOVE 'TTRDFNC'               TO DP013-DB2-TABLE-NAME (1) 19500000
195100         SET DP013-DB2-ABEND                                      19510000
195200             DP013-XCTL-DISPLAY-RESTART TO TRUE                   19520000
195300         PERFORM DP013-0000-PROCESS-ABEND                         19530000
195400     END-IF                                                       19540000
195500                                                                  19550000
195600     MOVE PC-TSYMSG-00115        TO DP020-MSG-NUMBER              19560000
195700     SET DP020-MSG-INFORMATIONAL                                  19570000
195800         ASC-DELETE-SUCCESSFUL TO TRUE                            19580000
195900                                                                  19590000
196000     IF ASC-USE-SELECTION-QUEUE                                   19600000
196100         PERFORM 5200-UPDATE-SELECTION-QUEUE                      19610000
196200     END-IF.                                                      19620000
196300                                                                  19630000
196400*---------------------------------------------------------------- 19640000
196500* BEFORE DELETING A ROW FROM TTRDTRN FOR A PO (850) CHECK IF THERE19650000
196600* EXIST ANY PURCHASE ORDER CHANGE DOCUMENT PC (860) RELATIONSHIPS 19660000
196700*---------------------------------------------------------------- 19670000
196800 7050-CHK-FOR-PC860.                                              19680000
196900     PERFORM                                                      19690000
197000         WITH TEST AFTER                                          19700000
197100         VARYING PV-RETRY-COUNTER                                 19710000
197200         FROM 1 BY 1                                              19720000
197300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               19730000
197400             OR (SQLCODE = +0)                                    19740000
197500             OR (SQLCODE = +100)                                  19750000
197600             OR (SQLCODE = -811))                                 19760000
197700                                                                  19770000
197800         EXEC SQL                                                 19780000
197900             SELECT TP_DKEY                                       19790000
198000                  , TRAN_SET_CDE                                  19800000
198100                  , PROD_TEST_IND                                 19810000
198200                  , INACTV_DTE                                    19820000
198300               INTO :TRDTRN-TP-DKEY                               19830000
198400                  , :TRDTRN-TRAN-SET-CDE                          19840000
198500                  , :TRDTRN-PROD-TEST-IND                         19850000
198600                  , :TRDTRN-INACTV-DTE                            19860000
198700               FROM TTRDTRN                                       19870000
198800              WHERE TP_DKEY        = :ASC-KEY-TP-DKEY             19880000
198900                AND TRAN_SET_CDE   = '860'                        19890000
199000                AND PROD_TEST_IND IN ('P', 'T')                   19900000
199100                AND DIR_IND        = 'S'                          19910000
199200                AND INACTV_DTE     = '9999-09-09'                 19920000
199300         END-EXEC                                                 19930000
199400                                                                  19940000
199500         EVALUATE TRUE                                            19950000
199600             WHEN SQLCODE = +0                                    19960000
199700             WHEN SQLCODE = -811                                  19970000
199800                 SET PS-PC860-EXISTS                              19980000
199900                     PS-ERROR                                     19990000
200000                     DP020-MSG-FATAL                              20000000
200100                     DP030-SET-CURSOR-APPL-1 TO TRUE              20010000
200200*************    VENDOR SET UP FOR 860                            20020000
200300                 MOVE PC-TSYMSG-03463   TO DP020-MSG-NUMBER       20030000
200400                                                                  20040000
200500             WHEN SQLCODE = +100                                  20050000
200600                 SET PS-PC860-NOT-EXIST TO TRUE                   20060000
200700                 MOVE ASC-KEY-TP-DKEY   TO PV-TEMP-TP-DKEY        20070000
200800                 STRING 'TP_DKEY: ' DELIMITED BY SIZE             20080000
200900                         PV-TEMP-TP-DKEY DELIMITED BY SIZE        20090000
201000                   INTO DP013-MESSAGE-TEXT (3)                    20100000
201100             WHEN SQLCODE = -904                                  20110000
201200             WHEN SQLCODE = -913                                  20120000
201300                 CONTINUE                                         20130000
201400                                                                  20140000
201500             WHEN SQLWARN0 NOT = SPACES                           20150000
201600             WHEN SQLCODE < +0                                    20160000
201700             WHEN SQLCODE > +0                                    20170000
201800                 MOVE '7050-CHK-FOR-PC860'                        20180000
201900                                   TO DP013-PARAGRAPH             20190000
202000                 MOVE 'SELECT A ROW ON TTRDTRN'                   20200000
202100                                   TO DP013-MESSAGE-TEXT(1)       20210000
202200                 MOVE SQLCA        TO DP013-SQLCA                 20220000
202300                 MOVE 'TTRDTRN'    TO DP013-DB2-TABLE-NAME (1)    20230000
202400                 SET DP013-DB2-ABEND                              20240000
202500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           20250000
202600                 PERFORM DP013-0000-PROCESS-ABEND                 20260000
202700         END-EVALUATE                                             20270000
202800     END-PERFORM.                                                 20280000
202900                                                                  20290000
203000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        20300000
203100         MOVE '7050-CHK-FOR-PC860' TO DP013-PARAGRAPH             20310000
203200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              20320000
203300                                   TO DP013-MESSAGE-TEXT (1)      20330000
203400         MOVE 'TO SELECT A TTRDTRN ROW'                           20340000
203500                                   TO DP013-MESSAGE-TEXT (2)      20350000
203600         MOVE SQLCA                TO DP013-SQLCA                 20360000
203700         MOVE 'TTRDTRN'            TO DP013-DB2-TABLE-NAME (1)    20370000
203800         SET DP013-DB2-ABEND                                      20380000
203900             DP013-XCTL-DISPLAY-RESTART                           20390000
204000                                   TO TRUE                        20400000
204100         PERFORM DP013-0000-PROCESS-ABEND                         20410000
204200     END-IF.                                                      20420000
204300                                                                  20430000
204400/                                                                 20440000
204500 7100-DELETE-TTRDTRN.                                             20450000
204600                                                                  20460000
204700     PERFORM                                                      20470000
204800         WITH TEST AFTER                                          20480000
204900         VARYING PV-RETRY-COUNTER                                 20490000
205000         FROM 1 BY 1                                              20500000
205100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               20510000
205200             OR (SQLCODE = +0)                                    20520000
205300             OR (SQLCODE = +100) )                                20530000
205400                                                                  20540000
205500         EXEC SQL DELETE FROM TTRDTRN                             20550000
205600                                                                  20560000
205700          WHERE TP_DKEY  = :ASC-KEY-TP-DKEY                       20570000
205800            AND DIR_IND  = :ASC-KEY-DIR-IND                       20580000
205900            AND FUNC_CDE = :ASC-KEY-FUNC-CDE                      20590000
206000                                                                  20600000
206100         END-EXEC                                                 20610000
206200                                                                  20620000
206300         EVALUATE TRUE                                            20630000
206400             WHEN SQLCODE = +0                                    20640000
206500             WHEN SQLCODE = +100                                  20650000
206600             WHEN SQLCODE = -904                                  20660000
206700             WHEN SQLCODE = -913                                  20670000
206800                 CONTINUE                                         20680000
206900                                                                  20690000
207000             WHEN SQLWARN0 NOT = SPACES                           20700000
207100             WHEN SQLCODE < +0                                    20710000
207200             WHEN SQLCODE > +0                                    20720000
207300                 MOVE '7100-DELETE-TTRDTRN'                       20730000
207400                                   TO DP013-PARAGRAPH             20740000
207500                 MOVE 'DELETE ROW(S) FROM TTRDTRN'                20750000
207600                                   TO DP013-MESSAGE-TEXT(1)       20760000
207700                 MOVE SQLCA        TO DP013-SQLCA                 20770000
207800                 MOVE 'TTRDTRN'    TO DP013-DB2-TABLE-NAME (1)    20780000
207900                 SET DP013-DB2-ABEND                              20790000
208000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           20800000
208100                 PERFORM DP013-0000-PROCESS-ABEND                 20810000
208200         END-EVALUATE                                             20820000
208300     END-PERFORM.                                                 20830000
208400                                                                  20840000
208500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        20850000
208600         MOVE '7100-DELETE-TTRDTRN' TO DP013-PARAGRAPH            20860000
208700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              20870000
208800                                   TO DP013-MESSAGE-TEXT (1)      20880000
208900         MOVE 'TO UPDATE A TTRDTRN TABLE'                         20890000
209000                                   TO DP013-MESSAGE-TEXT (2)      20900000
209100         MOVE SQLCA                TO DP013-SQLCA                 20910000
209200         MOVE 'TTRDTRN'            TO DP013-DB2-TABLE-NAME (1)    20920000
209300         SET DP013-DB2-ABEND                                      20930000
209400             DP013-XCTL-DISPLAY-RESTART                           20940000
209500                                   TO TRUE                        20950000
209600         PERFORM DP013-0000-PROCESS-ABEND                         20960000
209700     END-IF.                                                      20970000
209800/                                                                 20980000
209900*-----------------------------------------------------------------20990000
210000* CHECK TO SEE IF THE VENDOR RECENTLY DELETED IS SET UP FOR EDI   21000000
210100* PURCHASE ORDERS OR ASNS                                         21010000
210200*-----------------------------------------------------------------21020000
210300 7200-CHECK-PO-ASN-STATUS.                                        21030000
210400     PERFORM                                                      21040000
210500         WITH TEST AFTER                                          21050000
210600         VARYING PV-RETRY-COUNTER                                 21060000
210700         FROM 1 BY 1                                              21070000
210800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21080000
210900            OR (SQLCODE = +0 OR +100 OR -811))                    21090000
211000                                                                  21100000
211100         EXEC SQL                                                 21110000
211200             SELECT A.TP_DKEY                                     21120000
211300              INTO  :TRDTRN-TP-DKEY                               21130000
211400              FROM  TTRDTRN A                                     21140000
211500                   ,TTRDPRT B                                     21150000
211600              WHERE ENT_ID  = :ASC-ENT-ID                         21160000
211700                AND A.TP_DKEY = B.TP_DKEY                         21170000
211800                AND TRAN_SET_CDE = :PV-TRAN-SET-CDE               21180000
211900                AND A.INACTV_DTE = '9999-09-09'                   21190000
212000                AND B.INACTV_DTE = '9999-09-09'                   21200000
212100*               AND PROD_TEST_IND = 'P'                           21210000
212200         END-EXEC                                                 21220000
212300                                                                  21230000
212400         EVALUATE TRUE                                            21240000
212500             WHEN SQLCODE = +0                                    21250000
212600             WHEN SQLCODE = -904                                  21260000
212700             WHEN SQLCODE = -913                                  21270000
212800             WHEN SQLCODE = -811                                  21280000
212900             WHEN SQLCODE = +100                                  21290000
213000                 CONTINUE                                         21300000
213100             WHEN SQLWARN0 NOT = SPACE                            21310000
213200             WHEN SQLCODE < +0                                    21320000
213300             WHEN SQLCODE > +0                                    21330000
213400                 MOVE '7200-CHECK-PO-ASN-STATUS'                  21340000
213500                                 TO DP013-PARAGRAPH               21350000
213600                 MOVE 'SELECT ON TTRDTRN TABLE'                   21360000
213700                                 TO DP013-MESSAGE-TEXT (1)        21370000
213800                 MOVE SQLCA      TO DP013-SQLCA                   21380000
213900                 MOVE 'TTRDTRN'  TO DP013-DB2-TABLE-NAME (1)      21390000
214000                     SET DP013-DB2-ABEND                          21400000
214100                         DP013-XCTL-DISPLAY-RESTART               21410000
214200                                 TO TRUE                          21420000
214300                 PERFORM DP013-0000-PROCESS-ABEND                 21430000
214400         END-EVALUATE                                             21440000
214500     END-PERFORM.                                                 21450000
214600                                                                  21460000
214700     IF SQLCODE = -904 OR -913                                    21470000
214800        MOVE '7200-CHECK-PO-ASN-STATUS'                           21480000
214900                        TO DP013-PARAGRAPH                        21490000
215000        MOVE 'SELECT ON TTRDTRN TABLE'                            21500000
215100                        TO DP013-MESSAGE-TEXT (1)                 21510000
215200        MOVE SQLCA      TO DP013-SQLCA                            21520000
215300        MOVE 'TTRDTRN'  TO DP013-DB2-TABLE-NAME (1)               21530000
215400            SET DP013-DB2-ABEND                                   21540000
215500                DP013-XCTL-DISPLAY-RESTART                        21550000
215600                        TO TRUE                                   21560000
215700        PERFORM DP013-0000-PROCESS-ABEND                          21570000
215800     END-IF.                                                      21580000
215900                                                                  21590000
216000*---------------------------------------------------------------  21600000
216100* GET THE VENDOR NUMBER FOR SENDING MQ MESSAGE TO SUPPLIER SYSTEM 21610000
216200*---------------------------------------------------------------- 21620000
216300 7300-GET-VENDOR-NUMBER.                                          21630000
216400     PERFORM                                                      21640000
216500         WITH TEST AFTER                                          21650000
216600         VARYING PV-RETRY-COUNTER                                 21660000
216700         FROM 1 BY 1                                              21670000
216800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21680000
216900            OR (SQLCODE = +0 OR +100))                            21690000
217000                                                                  21700000
217100         EXEC SQL                                                 21710000
217200             SELECT B.DUN_NBR,                                    21720000
217300                    B.PRTNR_IND                                   21730000
217400              INTO  :EXTENT-DUN-NBR,                              21740000
217500                    :EXTENT-PRTNR-IND                             21750000
217600              FROM  TENTNME A                                     21760000
217700                 ,  TEXTENT B                                     21770000
217800              WHERE A.ENT_ID   = :ASC-ENT-ID                      21780000
217900                AND A.ENT_ID   = B.ENT_ID                         21790000
218000                AND A.TYPE_CDE = '01'                             21800000
218100                AND VND_IN_RMS_IND = 'Y'                          21810000
218200         END-EXEC                                                 21820000
218300                                                                  21830000
218400         EVALUATE TRUE                                            21840000
218500             WHEN SQLCODE = +0                                    21850000
218600             WHEN SQLCODE = +100                                  21860000
218700             WHEN SQLCODE = -904                                  21870000
218800             WHEN SQLCODE = -913                                  21880000
218900                 CONTINUE                                         21890000
219000             WHEN SQLWARN0 NOT = SPACE                            21900000
219100             WHEN SQLCODE < +0                                    21910000
219200             WHEN SQLCODE > +0                                    21920000
219300                 MOVE '7300-GET-VENDOR-NUMBER'                    21930000
219400                                 TO DP013-PARAGRAPH               21940000
219500                 MOVE 'SELECT ON TEXTENT TABLE'                   21950000
219600                                 TO DP013-MESSAGE-TEXT (1)        21960000
219700                 MOVE SQLCA      TO DP013-SQLCA                   21970000
219800                 MOVE 'TEXTENT'  TO DP013-DB2-TABLE-NAME (1)      21980000
219900                     SET DP013-DB2-ABEND                          21990000
220000                         DP013-XCTL-DISPLAY-RESTART               22000000
220100                                 TO TRUE                          22010000
220200                 PERFORM DP013-0000-PROCESS-ABEND                 22020000
220300         END-EVALUATE                                             22030000
220400     END-PERFORM.                                                 22040000
220500                                                                  22050000
220600     IF SQLCODE = -904 OR -913                                    22060000
220700        MOVE '7300-GET-VENDOR-NUMBER'                             22070000
220800                        TO DP013-PARAGRAPH                        22080000
220900        MOVE 'SELECT ON TEXTENT TABLE'                            22090000
221000                        TO DP013-MESSAGE-TEXT (1)                 22100000
221100        MOVE SQLCA      TO DP013-SQLCA                            22110000
221200        MOVE 'TEXTENT'  TO DP013-DB2-TABLE-NAME (1)               22120000
221300            SET DP013-DB2-ABEND                                   22130000
221400                DP013-XCTL-DISPLAY-RESTART                        22140000
221500                        TO TRUE                                   22150000
221600        PERFORM DP013-0000-PROCESS-ABEND                          22160000
221700     END-IF.                                                      22170000
221800                                                                  22180000
221900*-----------------------------------------------------------------22190000
222000* CHECK TO SEE IF THE VENDOR RECENTLY DELETED IS SET UP FOR EDI   22200000
222100* PURCHASE ORDERS OR ASNS                                         22210000
222200*-----------------------------------------------------------------22220000
222300 7400-CHECK-PROD-TEST-STATUS.                                     22230000
222400     PERFORM                                                      22240000
222500         WITH TEST AFTER                                          22250000
222600         VARYING PV-RETRY-COUNTER                                 22260000
222700         FROM 1 BY 1                                              22270000
222800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               22280000
222900            OR (SQLCODE = +0 OR +100 OR -811))                    22290000
223000                                                                  22300000
223100         EXEC SQL                                                 22310000
223200             SELECT A.TP_DKEY                                     22320000
223300              INTO  :TRDTRN-TP-DKEY                               22330000
223400              FROM  TTRDTRN A                                     22340000
223500                   ,TTRDPRT B                                     22350000
223600              WHERE ENT_ID  = :ASC-ENT-ID                         22360000
223700                AND A.TP_DKEY = B.TP_DKEY                         22370000
223800                AND TRAN_SET_CDE = :PV-TRAN-SET-CDE               22380000
223900                AND A.INACTV_DTE = '9999-09-09'                   22390000
224000                AND B.INACTV_DTE = '9999-09-09'                   22400000
224100                AND PROD_TEST_IND = :PV-PROD-TEST-IND             22410000
224200         END-EXEC                                                 22420000
224300                                                                  22430000
224400         EVALUATE TRUE                                            22440000
224500             WHEN SQLCODE = +0                                    22450000
224600             WHEN SQLCODE = -904                                  22460000
224700             WHEN SQLCODE = -913                                  22470000
224800             WHEN SQLCODE = -811                                  22480000
224900             WHEN SQLCODE = +100                                  22490000
225000                 CONTINUE                                         22500000
225100             WHEN SQLWARN0 NOT = SPACE                            22510000
225200             WHEN SQLCODE < +0                                    22520000
225300             WHEN SQLCODE > +0                                    22530000
225400                 MOVE '7400-CHECK-PROD-TEST-STATUS'               22540000
225500                                 TO DP013-PARAGRAPH               22550000
225600                 MOVE 'SELECT ON TTRDTRN TABLE'                   22560000
225700                                 TO DP013-MESSAGE-TEXT (1)        22570000
225800                 MOVE SQLCA      TO DP013-SQLCA                   22580000
225900                 MOVE 'TTRDTRN'  TO DP013-DB2-TABLE-NAME (1)      22590000
226000                     SET DP013-DB2-ABEND                          22600000
226100                         DP013-XCTL-DISPLAY-RESTART               22610000
226200                                 TO TRUE                          22620000
226300                 PERFORM DP013-0000-PROCESS-ABEND                 22630000
226400         END-EVALUATE                                             22640000
226500     END-PERFORM.                                                 22650000
226600                                                                  22660000
226700     IF SQLCODE = -904 OR -913                                    22670000
226800        MOVE '7400-CHECK-PROD-TEST-STATUS'                        22680000
226900                        TO DP013-PARAGRAPH                        22690000
227000        MOVE 'SELECT ON TTRDTRN TABLE'                            22700000
227100                        TO DP013-MESSAGE-TEXT (1)                 22710000
227200        MOVE SQLCA      TO DP013-SQLCA                            22720000
227300        MOVE 'TTRDTRN'  TO DP013-DB2-TABLE-NAME (1)               22730000
227400            SET DP013-DB2-ABEND                                   22740000
227500                DP013-XCTL-DISPLAY-RESTART                        22750000
227600                        TO TRUE                                   22760000
227700        PERFORM DP013-0000-PROCESS-ABEND                          22770000
227800     END-IF.                                                      22780000
227900                                                                  22790000
228000*---------------------------------------------------------------  22800000
228100* CHECK TO SEE WHETHER TO SEND PO AND/OR ASN INDICATOR TO RETEK   22810000
228200* SUPPLIER SYSTEM                                                 22820000
228300*---------------------------------------------------------------- 22830000
228400 8000-CHECK-PO-ASN-IND.                                           22840000
228500                                                                  22850000
228600     INITIALIZE VN007-SENDING-FIELDS.                             22860000
228700                                                                  22870000
228800*    MOVE '850' TO PV-TRAN-SET-CDE.                               22880000
228900*    PERFORM 7200-CHECK-PO-ASN-STATUS.                            22890000
229000*    IF SQLCODE = +000 OR -811                                    22900000
229100*       MOVE 'Y' TO VN007-EDI-PO-IND                              22910000
229200*    ELSE                                                         22920000
229300*       MOVE 'N' TO VN007-EDI-PO-IND                              22930000
229400*    END-IF.                                                      22940000
229500                                                                  22950000
229600     MOVE '850' TO PV-TRAN-SET-CDE.                               22960000
229700     MOVE 'P' TO PV-PROD-TEST-IND.                                22970000
229800     PERFORM 7400-CHECK-PROD-TEST-STATUS.                         22980000
229900     IF SQLCODE = +000 OR -811                                    22990000
230000        MOVE 'Y' TO VN007-EDI-PO-PROD-IND                         23000000
230100     ELSE                                                         23010000
230200        MOVE 'N' TO VN007-EDI-PO-PROD-IND                         23020000
230300     END-IF.                                                      23030000
230400                                                                  23040000
230500     MOVE '850' TO PV-TRAN-SET-CDE.                               23050000
230600     MOVE 'T' TO PV-PROD-TEST-IND.                                23060000
230700     PERFORM 7400-CHECK-PROD-TEST-STATUS.                         23070000
230800     IF SQLCODE = +000 OR -811                                    23080000
230900        MOVE 'Y' TO VN007-EDI-PO-TEST-IND                         23090000
231000     ELSE                                                         23100000
231100        MOVE 'N' TO VN007-EDI-PO-TEST-IND                         23110000
231200     END-IF.                                                      23120000
231300                                                                  23130000
231400     IF VN007-EDI-PO-PROD-IND = 'Y' OR                            23140000
231500        VN007-EDI-PO-TEST-IND = 'Y'                               23150000
231600           MOVE 'Y' TO VN007-EDI-PO-IND                           23160000
231700     ELSE                                                         23170000
231800        MOVE 'N' TO VN007-EDI-PO-IND.                             23180000
231900                                                                  23190000
232000     MOVE '856' TO PV-TRAN-SET-CDE.                               23200000
232100     PERFORM 7200-CHECK-PO-ASN-STATUS.                            23210000
232200     IF SQLCODE = +000 OR -811                                    23220000
232300        MOVE 'Y' TO VN007-EDI-ASN-IND                             23230000
232400     ELSE                                                         23240000
232500        MOVE 'N' TO VN007-EDI-ASN-IND                             23250000
232600     END-IF.                                                      23260000
232700                                                                  23270000
232800     MOVE '860' TO PV-TRAN-SET-CDE.                               23280000
232900     MOVE 'P' TO PV-PROD-TEST-IND.                                23290000
233000     PERFORM 7400-CHECK-PROD-TEST-STATUS.                         23300000
233100     IF SQLCODE = +000 OR -811                                    23310000
233200        MOVE 'Y' TO VN007-EDI-POCHG-PROD-IND                      23320000
233300     ELSE                                                         23330000
233400        MOVE 'N' TO VN007-EDI-POCHG-PROD-IND                      23340000
233500     END-IF.                                                      23350000
233600                                                                  23360000
233700     MOVE '860' TO PV-TRAN-SET-CDE.                               23370000
233800     MOVE 'T' TO PV-PROD-TEST-IND.                                23380000
233900     PERFORM 7400-CHECK-PROD-TEST-STATUS.                         23390000
234000     IF SQLCODE = +000 OR -811                                    23400000
234100        MOVE 'Y' TO VN007-EDI-POCHG-TEST-IND                      23410000
234200     ELSE                                                         23420000
234300        MOVE 'N' TO VN007-EDI-POCHG-TEST-IND                      23430000
234400     END-IF.                                                      23440000
234500                                                                  23450000
234600     IF VN007-EDI-POCHG-PROD-IND = 'Y' OR                         23460000
234700        VN007-EDI-POCHG-TEST-IND = 'Y'                            23470000
234800           MOVE 'Y' TO VN007-EDI-POCHG-IND                        23480000
234900     ELSE                                                         23490000
235000        MOVE 'N' TO VN007-EDI-POCHG-IND.                          23500000
235100                                                                  23510000
235200*-----------------------------------------------------------------23520000
235300* CHECK EDI PO AND ASN INDICATORS FOR DELETE                      23530000
235400*-----------------------------------------------------------------23540000
235500 8050-CHECK-EDI-PO-ASN-IND.                                       23550000
235600                                                                  23560000
235700     IF PS-SEND                                                   23570000
235800        PERFORM 8100-SEND-MQ-MESSAGE                              23580000
235900     END-IF.                                                      23590000
236000                                                                  23600000
236100     INITIALIZE PS-MQ-SEND-SW.                                    23610000
236200*---------------------------------------------------------------  23620000
236300* SEND MQSERIES MESSAGE TO VNKCS024 WHEN VENDOR DOCUMENT HAS      23630000
236400* BEEN DELETED FOR VENDORS SET UP FOR PO AND ASN DOCUMENTS.       23640000
236500* VNKCS024 WILL FORMAT AND SEND INFORMATION TO RMS SUPPLIER       23650000
236600* SYSTEM.                                                         23660000
236700*---------------------------------------------------------------- 23670000
236800 8100-SEND-MQ-MESSAGE.                                            23680000
236900                                                                  23690000
237000     PERFORM 7300-GET-VENDOR-NUMBER.                              23700000
237100     IF SQLCODE = +0                                              23710000
237200        MOVE EXTENT-DUN-NBR TO VN007-VND-NBR                      23720000
237300        MOVE ASC-ENT-ID TO VN007-ENT-ID                           23730000
237400        IF EXTENT-PRTNR-IND = 'Y'                                 23740000
237500           MOVE 'P' TO VN007-EDI-VNDR-TYPE-IND                    23750000
237600        ELSE                                                      23760000
237700           MOVE 'S' TO VN007-EDI-VNDR-TYPE-IND                    23770000
237800        END-IF                                                    23780000
237900                                                                  23790000
238000        EXEC CICS LINK PROGRAM (PC-VNKCS024)                      23800000
238100                      COMMAREA (VN007-COMMAREA)                   23810000
238200                          RESP (PV-CICS-RESPONSE)                 23820000
238300        END-EXEC                                                  23830000
238400                                                                  23840000
238500        IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                23850000
238600            CONTINUE                                              23860000
238700        ELSE                                                      23870000
238800            MOVE VN007-PROGRAM-NAME   TO DP013-PROGRAM            23880000
238900            MOVE VN007-PARAGRAPH-NAME TO DP013-PARAGRAPH          23890000
239000            MOVE VN007-MESSAGE        TO DP013-MESSAGE-TEXT (1)   23900000
239100            MOVE VN007-REASON-CODE    TO DP013-SQLCA              23910000
239200            SET DP013-DB2-ABEND                                   23920000
239300                DP013-ROLLBACK                                    23930000
239400             DP013-XCTL-DISPLAY-RESTART TO TRUE                   23940000
239500           PERFORM DP013-0000-PROCESS-ABEND                       23950000
239600        END-IF                                                    23960000
239700     END-IF.                                                      23970000
239800*---------------------------------------------------------------- 23980000
239900* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.        23990000
240000*---------------------------------------------------------------- 24000000
240100                                                                  24010000
240200 9100-READ-SEL-QUEUE.                                             24020000
240300     EXEC CICS                                                    24030000
240400         READQ TS                                                 24040000
240500             QUEUE (ASC-SEL-QUEUE-NAME)                           24050000
240600             INTO  (ET301-SELECTED-VNDRS)                         24060000
240700             ITEM  (ASC-SEL-ITEM)                                 24070000
240800             RESP  (PV-CICS-RESPONSE)                             24080000
240900     END-EXEC.                                                    24090000
241000                                                                  24100000
241100     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   24110000
241200         CONTINUE                                                 24120000
241300     ELSE                                                         24130000
241400         SET DP013-LOGIC-ABEND                                    24140000
241500             DP013-NO-ROLLBACK     TO TRUE                        24150000
241600         MOVE '9100-READ-SEL-QUEUE'                               24160000
241700                                   TO DP013-PARAGRAPH             24170000
241800         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   24180000
241900                                   TO DP013-MESSAGE-TEXT (1)      24190000
242000         PERFORM DP013-0000-PROCESS-ABEND                         24200000
242100     END-IF.                                                      24210000
242200                                                                  24220000
242300/                                                                 24230000
242400*---------------------------------------------------------------- 24240000
242500* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.        24250000
242600*---------------------------------------------------------------- 24260000
242700 9200-REWRITE-LIST-QUEUE.                                         24270000
242800                                                                  24280000
242900     EXEC CICS                                                    24290000
243000          WRITEQ TS                                               24300000
243100              QUEUE  (ASC-SEL-QUEUE-NAME)                         24310000
243200              FROM   (ET301-SELECTED-VNDRS)                       24320000
243300              ITEM   (ASC-SEL-ITEM)                               24330000
243400              RESP   (PV-CICS-RESPONSE)                           24340000
243500              REWRITE                                             24350000
243600     END-EXEC.                                                    24360000
243700                                                                  24370000
243800     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               24380000
243900         SET DP013-CICS-ABEND                                     24390000
244000             DP013-NO-ROLLBACK     TO TRUE                        24400000
244100         MOVE '9200-REWRITE-LIST-QUEUE'                           24410000
244200                                   TO DP013-PARAGRAPH             24420000
244300         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   24430000
244400                                   TO DP013-MESSAGE-TEXT (1)      24440000
244500         PERFORM DP013-0000-PROCESS-ABEND                         24450000
244600     END-IF.                                                      24460000
244700                                                                  24470000
244800/                                                                 24480000
244900*---------------------------------------------------------------- 24490000
245000*    ABEND PROCESSOR MODULE                                       24500000
245100*---------------------------------------------------------------- 24510000
245200                                                                  24520000
245300     COPY DPPD013.                                                24530000
