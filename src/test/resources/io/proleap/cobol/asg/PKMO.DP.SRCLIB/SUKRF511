000100******************************************************************00010002
000200 IDENTIFICATION DIVISION.                                         00020000
000300 PROGRAM-ID.             SUKRF511.                                00030000
000400 AUTHOR.                 MARY SARDINA.                            00040000
000500 INSTALLATION.           KOHLS.                                   00050000
000600 DATE-WRITTEN.           SEPTEMBER 1997.                          00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900******************************************************************00090000
001000* THIS PROGRAM WILL ALLOW THE USER TO ENTER THE SHIPPING UNIT     00100000
001100* NUMBER.  IT WILL VALIDATE ITS EXISTENCE, AND DISPLAY THE CARTON 00110000
001200* LEVEL INFORMATION.  IT WILL THE ALLOW THEM TO UPDATE THE PO AND 00120000
001300* /OR STORE IF THEY DO NOT MATCH.                                 00130000
001400******************************************************************00140000
001500* 10/04/2013 DAVE WELLER CHG0068598 TKID: TKMA602                 00150003
001600*            CHANGE TO ADD AN AUDIT TYPE FIELD TO THE SCREEN.     00160003
001700******************************************************************00170000
001710***RLK 04/14 BEG                                                  00171000
001720* 004/14/2014 RICH KELLEN CHG0078145 TKID: TKMAA71                00172000
001730*            CHANGE TO FLIP TO COMBO OR QC ONLY WHEN RFID AUD     00173000
001731*            NBR ENTERED AND RF OPEN AND QC ALSO OPEN FOR CARTON  00173100
001732*            OR RF CLOSED AND QC OPEN FOR CARTON.                 00173200
001733***RLK 04/14 END                                                  00173300
001734***RLK 04/14-1 BEG                                                00173400
001735* 04/07/2014  RICH KELLEN CHG0079586                              00173500
001736*             ADD PARA PERFORM OF 5000-POPULATE-AUDTYP TO         00173600
001737*             PARA 2240-CHECK-TABLES AS SU006 RFID SWITCHES WERE  00173700
001738*             NOT GETTING SET WHEN AUDITS WERE POSTPONED AND      00173800
001739*             RESTARTED. THIS CHANGE SHOULD FIX THAT.             00173900
001740*             ALSO ADDED PARA 2210-CHECK-FOR-ECOM TO LOOK TO SEE  00174000
001741*             IF PO IS ECOM. CHECK IN PARA 5000 WILL PERFORM      00174100
001742*             NEW PARA AND IF ECOM AUDIT WILL NOT PERFORM RFID    00174200
001743*             FUNCTIONS.                                          00174300
001744***RLK 04/14-1 END                                                00174400
001745***RLK 04/14-2 BEG                                                00174500
001746* 04/07/2014  RICH KELLEN CHG0080352                              00174600
001747*             ADDED PARA 2220-CHECK-FOR-RFID-DEPT TO CHECK IF     00174700
001748*             PO IS FOR DEPT WE'RE PROCESSING AS RFID. PERFORM    00174800
001749*             OF THIS PARA WAS ADDED TO PARA 5000-POPULATE-AUDTYP.00174900
001750***RLK 04/14-2 END                                                00175000
001751******************************************************************00175100
001752* JACK KRAMER 04/21/2014   CHG0069538                             00175200
001753*    MTK PROJECT - PACKAGE CODE CHANGES.                          00175300
001754* CHANGES IN PARAGRAPH:                                           00175400
001755*    2280-SELECT-PKGNG-CDE                                        00175500
001756*         TO PERFORM NEW PARAGRAPH IF PKGNG_CDE = M               00175600
001757* NEW PARAGRAPH:                                                  00175700
001758*    2600-CHECK-TRECITM                                           00175800
001759* ADDED DCLGENS FOR TRECITM, TPURITM AND TPOPRPK; DB2 KEY AND     00175900
001760*    VARIABLES AND SWITCHES FOR THE NEW PARAGRAPH                 00176000
001761******************************************************************00176101
001762* CHERI PARMLEY 09/25/2014    CHG0094517                          00176202
001763*   CHANGE PO# LENGTH FROM 7 TO 8 DIGITS                          00176301
001767******************************************************************00176700
001768* CHANGED 11/16/2021    BY JIM HUNTER      WR: CHG0263968         00176811
001769* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00176912
001770* MAKING THE CALL DYNAMIC VS STATIC.                              00177012
001772******************************************************************00177211
001773 ENVIRONMENT DIVISION.                                            00177300
001774 DATA DIVISION.                                                   00177400
001775******************************************************************00177500
001776                                                                  00177600
001777******************************************************************00177700
001778 WORKING-STORAGE SECTION.                                         00177800
001779******************************************************************00177900
001780 01  CA-COMMAREA.                                                 00178000
001781     COPY SUWS006.                                                00178100
001782    05  CA-PROGRAM-COMMAREA.                                      00178200
001783         10  CA-CARTON-FOUND-IND         PIC  X      VALUE 'Y'.   00178300
001784             88  CA-CARTON-FOUND                     VALUE 'Y'.   00178400
001785             88  CA-CARTON-NOT-FOUND                 VALUE 'N'.   00178500
001786         10  CA-AUDIT-IND-SW             PIC  X(01)  VALUE ' '.   00178600
001787             88  CA-AUDIT-EXISTS                     VALUE 'Y'.   00178700
001788             88  CA-AUDIT-NOT-EXISTS                 VALUE 'N'.   00178800
001789         10  CA-AUDIT-IND                PIC  X(01)  VALUE ' '.   00178900
001790             88  CA-SYST-PRMPTD-CRTN                 VALUE 'Y'.   00179000
001791             88  CA-NON-SYST-PRMPTD-CRTN             VALUE 'N'.   00179100
001792         10  CA-OLD-PO                   PIC S9(09)  VALUE  0     00179200
001800                                                     COMP.        00180000
001900         10  CA-OLD-STORE                PIC S9(04)  VALUE  0     00190000
002000                                                     COMP.        00200000
002100         10  CA-PF9-IND                  PIC  X(01)  VALUE SPACE. 00210000
002200             88  CA-AFTER-PF9                        VALUE 'Y'.   00220000
002300             88  CA-NO-PF9                           VALUE 'N'.   00230000
002400         10  CA-CART-LBL-TYP-CDE         PIC  X(01)  VALUE SPACE. 00240000
002500         10  CA-PBS-ERROR-IND            PIC  X(01)  VALUE ' '.   00250000
002600             88  CA-PBS-ASN-ERROR-EXISTS             VALUE 'Y'.   00260000
002700             88  CA-PBS-ASN-ERROR-NOT-EXISTS         VALUE 'N'.   00270000
002800         10  CA-SAVE-LAST-PROGRAM        PIC  X(08)  VALUE ' '.   00280000
002900                                                                  00290000
003000*                                                                 00300000
003100 01  DK-DB2-KEYS.                                                 00310000
003200     05  DK-AUDIT-CNTL-NBR               PIC S9(09)  COMP.        00320000
003300     05  DK-AUDIT-CNTL-NBR2              PIC S9(09)  COMP.        00330000
003400     05  DK-PO-NBR                       PIC S9(09)  COMP.        00340000
003500     05  DK-STORE                        PIC S9(4)   COMP.        00350000
003600     05  DK-PO-LNE-NBR                   PIC S9(09)  COMP.        00360000
003610     05  DK-PREPK-ID                     PIC S9(04)  COMP.        00361012
003700     05  DK-PO-RCVR-SEQ                  PIC S9(09)  COMP.        00370000
003800     05  DK-OPER-UNT-ID                  PIC S9(04)  COMP.        00380000
003900     05  DK-SHIPT-UNIT-ID                PIC S9(18)V COMP-3.      00390000
004000     05  DK-SHIPT-UNIT-ID2               PIC S9(18)V COMP-3.      00400000
004100     05  DK-DEPT                         PIC S9(4)V  COMP-3.      00410000
004200     05  DK-REC-SEQ-NBR                  PIC S9(09)  COMP.        00420000
004300*                                                                 00430000
004400 01  PC-PROGRAM-CONSTANTS.                                        00440000
004500     05  PC-E                            PIC  X(01)  VALUE 'E'.   00450000
004600     05  PC-N                            PIC  X(01)  VALUE 'N'.   00460000
004700     05  PC-P                            PIC  X(01)  VALUE 'P'.   00470000
004800     05  PC-K                            PIC  X(01)  VALUE 'K'.   00480000
004900     05  PC-RF                           PIC  X(02)  VALUE 'RF'.  00490000
005000     05  PC-PO                           PIC  X(02)  VALUE 'PO'.  00500000
005100     05  PC-RCV                          PIC  X(03)  VALUE 'RCV'. 00510000
005200     05  PC-0                            PIC  X(01)  VALUE '0'.   00520000
005300     05  PC-4                            PIC  X(01)  VALUE '4'.   00530000
005400     05  PC-5                            PIC  X(01)  VALUE '5'.   00540000
005500     05  PC-Y                            PIC  X(01)  VALUE 'Y'.   00550000
005600     05  PC-0-9                          PIC  9(01)  VALUE 0.     00560000
005700     05  PC-ACTIVE                       PIC  X(01)  VALUE 'A'.   00570000
005800     05  PC-18                           PIC S9(04)  VALUE 18     00580000
005900                                                     COMP SYNC.   00590000
006000     05  PC-19                           PIC S9(04)  VALUE 19     00600000
006100                                                     COMP SYNC.   00610000
006200     05  PC-20                           PIC S9(04)  VALUE 20     00620000
006300                                                     COMP SYNC.   00630000
006400     05  PC-NEG-9                        PIC S9(09)               00640000
006500                                                VALUE -999999999. 00650000
006600     05  PC-01                           PIC  X(02)  VALUE '01'.  00660000
006700     05  PC-DB2-NINES-DATE              PIC X(26)   VALUE         00670000
006800         '9999-09-09-09.09.09.999999'.                            00680000
006900     05  PC-PF-CONTINUE-PF-KEY-MSG       PIC  X(19)  VALUE        00690000
007000         'F2-CONTINUE        '.                                   00700000
007100     05  PC-PF-MATCH-PF-KEY-MSG          PIC  X(19)  VALUE        00710000
007200         'F2-MTCH  F9-NO MTCH'.                                   00720000
007300     05  PC-STARTED-STATUS               PIC  X(18)  VALUE        00730000
007400         'STARTED FOR:      '.                                    00740000
007500     05  PC-CLOSED-STATUS                PIC  X(18)  VALUE        00750000
007600         'CLOSED FOR:       '.                                    00760000
007700     05  PC-PO-REQUIRED                  PIC  X(18)  VALUE        00770000
007800         'PO NUMBER REQUIRED'.                                    00780000
007900     05  PC-INVALID-PO                   PIC  X(18)  VALUE        00790000
008000         'INVALID PO        '.                                    00800000
008100     05  PC-AUDIT-NO-LONGER-NEEDED-MSG   PIC  X(19)  VALUE        00810000
008200         'AUDIT COMPLETE     '.                                   00820000
008300     05  PC-QC-AUD-CPLTE                 PIC  X(19)  VALUE        00830000
008400         'QC AUD CPLT-RF ONLY'.                                   00840000
008500     05  PC-RETURN-PGM                   PIC  X(08)  VALUE        00850000
008600         'SUKRF509'.                                              00860000
008700     05  PC-AUDIT-STAT-PGM               PIC  X(08)  VALUE        00870000
008800         'SUKRF534'.                                              00880000
008900     05  PC-SU-CHECK-IN-PGM              PIC  X(08)  VALUE        00890000
009000         'SUKRF502'.                                              00900000
009100     05  PC-REPORT-PGM                   PIC  X(08)  VALUE        00910000
009200         'SUKRP002'.                                              00920000
009300     05  PC-PRTR-VALIDATION-PGM          PIC  X(08)  VALUE        00930000
009400         'DPKCS060'.                                              00940000
009500     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00950000
009600         'SUKRF511'.                                              00960000
009700     05  PC-PRINT-PROGRAM-NAME           PIC  X(08)  VALUE        00970000
009800         'SUKRF523'.                                              00980000
009900     05  PC-CARTON-CONTINUE-PGM          PIC  X(08)  VALUE        00990000
010000         'SUKRF512'.                                              01000000
010100     05  PC-UPC-SCAN-SCREEN              PIC  X(08)  VALUE        01010000
010200         'SUKRF518'.                                              01020000
010300     05  PC-AUDIT-CONT-PROGRAM           PIC  X(08)  VALUE        01030000
010400         'SUKRF520'.                                              01040000
010500     05  PC-AUDIT-CLOSE-PROGRAM          PIC  X(08)  VALUE        01050000
010600         'SUKRF516'.                                              01060000
010700     05  PC-MESSAGE-PROGRAM              PIC  X(08)  VALUE        01070000
010800         'SUKRF514'.                                              01080000
010900     05  PC-PREPK-QTY-SCREEN-PROGRAM     PIC  X(08)  VALUE        01090000
011000         'SUKRF540'.                                              01100000
011100     05  PC-COMMON-CARTON-CLOSE-PGM      PIC  X(08)  VALUE        01110000
011200         'SUKCS769'.                                              01120000
011300     05  PC-CURRENT-TRANID               PIC  X(04)  VALUE 'S511'.01130000
011400     05  PC-ENTER-THROUGH-MENU-MSG       PIC  X(19)  VALUE        01140000
011500         'ENTER THROUGH MENU '.                                   01150000
011600     05  PC-ENTER-CARTON-MSG             PIC  X(19)  VALUE        01160000
011700         'ENTER CARTON #     '.                                   01170000
011800     05  PC-TRANS-UNAVAILABLE-MSG        PIC  X(19)  VALUE        01180000
011900         'TRANS NOT AVAILABLE'.                                   01190000
012000     05  PC-PLS-ENT-FLD-MSG              PIC  X(19)  VALUE        01200000
012100         'PLEASE ENTER PO/STR'.                                   01210000
012200     05  PC-MUST-BE-NUM-MSG              PIC  X(19)  VALUE        01220000
012300         'MUST BE NUMERIC    '.                                   01230000
012400     05  PC-MUST-BE-GT-0-MSG             PIC  X(19)  VALUE        01240000
012500         'MUST BE > ZERO     '.                                   01250000
012600     05  PC-MUST-BE-PBS-MSG              PIC  X(19)  VALUE        01260000
012700         'RCVR NOT PK-BY-STR '.                                   01270000
012800     05  PC-FIRST-1-NOT-0-MSG            PIC  X(19)  VALUE        01280000
012900         'FIRST DIGIT NOT 0  '.                                   01290000
013000     05  PC-TOO-MANY-DIGITS              PIC  X(19)  VALUE        01300000
013100         'TOO MANY DIGITS    '.                                   01310000
013200     05  PC-STR-NOT-XCRIBED-MSG          PIC  X(19)  VALUE        01320000
013300         'STR NOT TRANSCRIBED'.                                   01330000
013400     05  PC-CICS-ERR-MSG                 PIC  X(19)  VALUE        01340000
013500         'CICS ACCESS ERROR  '.                                   01350000
013600     05  PC-WRONG-FACILITY               PIC  X(19)  VALUE        01360000
013700         'WRG FCLTY - F2 CONF'.                                   01370000
013800     05  PC-MORE-DIGITS-REQD             PIC  X(19)  VALUE        01380000
013900         'MORE DIGITS REQUIRD'.                                   01390000
014000     05  PC-INVALID-CHECK-DIGIT          PIC  X(19)  VALUE        01400000
014100         'INVALID CHECK DIGIT'.                                   01410000
014200     05  PC-PO-NOT-NUMERIC               PIC  X(19)  VALUE        01420000
014300         'PO NOT NUMERIC     '.                                   01430000
014400     05  PC-STORE-NOT-NUMERIC            PIC  X(19)  VALUE        01440000
014500         'STORE NOT NUMERIC  '.                                   01450000
014600     05  PC-NON-SYS-AUD-CRTN-MSG         PIC  X(19)  VALUE        01460000
014700         'NON SYSTEM AUD CRTN'.                                   01470000
014800     05  PC-PBS-ERROR-CARTON-MSG         PIC  X(19)  VALUE        01480000
014900         'PBS ASN ERR EXISTS '.                                   01490000
015000     05  PC-CCC-PARM-ERR-MSG             PIC  X(19)  VALUE        01500000
015100         'PARM ERROR-SUKCS769'.                                   01510000
015200     05  PC-CCC-DB2-ERR-MSG              PIC  X(19)  VALUE        01520000
015300         'DB2  ERROR-SUKCS769'.                                   01530000
015400     05  PC-CCC-MQ-ERR-MSG               PIC  X(19)  VALUE        01540000
015500         'MQ   ERROR-SUKCS769'.                                   01550000
015600     05  PC-CCC-OTHR-ERR-MSG             PIC  X(19)  VALUE        01560000
015700         'OTHR ERROR-SUKCS769'.                                   01570000
015800     05  PC-CCC-PGM-LINK-ERR             PIC  X(19)  VALUE        01580000
015900         'LINK ERR - SUKRF769'.                                   01590000
016000                                                                  01600000
016100 01  PS-PROGRAM-SWITCHES.                                         01610000
016200     05  PS-GOOD-CRTN-STAT-SW            PIC  X(01)  VALUE 'N'.   01620000
016300         88  PS-GOOD-CRTN-STAT                       VALUE 'Y'.   01630000
016400         88  PS-BAD-CRTN-STAT                        VALUE 'N'.   01640000
016500     05  PS-OUTBOUND-FOUND-SW           PIC X(01)    VALUE 'N'.   01650000
016600         88  PS-OUTBOUND-FOUND                       VALUE 'Y'.   01660000
016700         88  PS-NO-OUTBOUND-FOUND                    VALUE 'N'.   01670000
016800     05  PS-OPER-FOUND-SW               PIC X(01)    VALUE 'N'.   01680000
016900         88  PS-OPER-FOUND                           VALUE 'Y'.   01690000
017000         88  PS-NO-OPER-FOUND                        VALUE 'N'.   01700000
017100     05  PS-CARTON-ADJUST-DC-SW         PIC X(01)    VALUE 'N'.   01710000
017200         88  PS-CARTON-ADJUST-DC                     VALUE 'Y'.   01720000
017300         88  PS-NOT-CARTON-ADJUST-DC                 VALUE 'N'.   01730000
017400     05  PS-OUTBOUND-CARTON-SW          PIC X(01)    VALUE 'Y'.   01740000
017500         88  PS-OUTBOUND-CARTON                      VALUE 'Y'.   01750000
017600         88  PS-NO-OUTBOUND-CARTON                   VALUE 'N'.   01760000
017700     05  PS-SYSTEM-AUDIT-FOUND-SW       PIC X(01)    VALUE 'N'.   01770000
017800         88  PS-SYSTEM-AUDIT-NOT-FOUND               VALUE 'N'.   01780000
017900         88  PS-SYSTEM-AUDIT-FOUND                   VALUE 'Y'.   01790000
018000     05  PS-CHECK-DIGIT-IND              PIC  X(01)  VALUE 'N'.   01800000
018100         88  PS-VALID-CHECK-DIGIT                    VALUE 'Y'.   01810000
018200         88  PS-INVALID-CHECK-DIGIT                  VALUE 'N'.   01820000
018300     05  PS-SCANNED-DATA-IND             PIC  X(01)  VALUE 'Y'.   01830000
018400         88  PS-NOT-SCANNED-DATA                     VALUE 'N'.   01840000
018500         88  PS-SCANNED-DATA                         VALUE 'Y'.   01850000
018600     05  PS-ACCESS-ALLOWED-IND           PIC  X(01)  VALUE 'N'.   01860000
018700         88  PS-NO-ACCESS-ALLOWED                    VALUE 'N'.   01870000
018800         88  PS-ACCESS-ALLOWED                       VALUE 'Y'.   01880000
018900     05  PS-AUDIT-NBR-IND                PIC  X(01)  VALUE 'N'.   01890000
019000         88  PS-AUDIT-NBR-NOT-EXISTS                 VALUE 'N'.   01900000
019100         88  PS-AUDIT-NBR-EXISTS                     VALUE 'Y'.   01910000
019200     05  PS-PROMPTED-CRTN-SW             PIC  X(01)  VALUE 'Y'.   01920000
019300         88  PS-PROMPTED-CRTN                        VALUE 'Y'.   01930000
019400         88  PS-NOT-PROMPTED-CRTN                    VALUE 'N'.   01940000
019500     05  PS-RFID-AUDIT-EXISTS-SW         PIC  X(01)  VALUE 'Y'.   01950000
019600         88  PS-RFID-AUDIT-EXISTS                    VALUE 'Y'.   01960000
019700         88  PS-RFID-AUDIT-NOT-EXISTS                VALUE 'N'.   01970000
019800***RLK 04/14 BEG                                                  01980000
019900     05  PS-QC-AUDIT-EXISTS-SW           PIC  X(01)  VALUE 'N'.   01990000
020000         88  PS-QC-AUDIT-EXISTS                      VALUE 'Y'.   02000000
020100         88  PS-QC-AUDIT-NOT-EXISTS                  VALUE 'N'.   02010000
020200     05  PS-ECOM-IND                     PIC  X(01)  VALUE 'N'.   02020000
020300         88  PS-ECOM-YES                             VALUE 'Y'.   02030000
020400         88  PS-ECOM-NO                              VALUE 'N'.   02040000
020500***RLK 04/14-2 BEG                                                02050000
020600     05  PS-RFID-DEPT-IND                PIC  X(01)  VALUE 'N'.   02060000
020700         88  PS-RFID-DEPT-YES                        VALUE 'Y'.   02070000
020800         88  PS-RFID-DEPT-NO                         VALUE 'N'.   02080000
020900***RLK 04/14-2 END                                                02090000
021000***RLK 04/14 END                                                  02100000
021100     05  PS-ROW-FOUND-SW                 PIC  X(01)  VALUE 'Y'.   02110000
021200         88  PS-ROW-FOUND                            VALUE 'Y'.   02120000
021300         88  PS-ROW-NOT-FOUND                        VALUE 'N'.   02130000
021310     05  PS-CARTON-FOUND-SW              PIC  X(01)  VALUE 'N'.   02131000
021320         88  PS-CARTON-FOUND                         VALUE 'Y'.   02132000
021330         88  PS-CARTON-FOUND-NO                      VALUE 'N'.   02133000
021340     05  PS-DC-RFID-AUDIT-SW             PIC  X(01)  VALUE 'N'.   02134000
021350         88  PS-DC-RFID-AUDIT-YES                    VALUE 'Y'.   02135000
021360         88  PS-DC-RFID-AUDIT-NO                     VALUE 'N'.   02136000
021370     05  PS-OPEN-AUDIT-SW                PIC  X(01)  VALUE 'N'.   02137000
021380         88  PS-OPEN-AUDIT-YES                       VALUE 'Y'.   02138000
021390         88  PS-OPEN-AUDIT-NO                        VALUE 'N'.   02139000
021400     05  PS-TRECITM-FOUND-SW             PIC  X(01)  VALUE 'Y'.   02140000
021500         88  PS-TRECITM-FOUND                        VALUE 'Y'.   02150000
021600         88  PS-TRECITM-NOT-FOUND                    VALUE 'N'.   02160000
021700                                                                  02170000
021800 01  PV-PROGRAM-VARIABLES.                                        02180000
021900     05  PV-DISPLAY-AUD-CNTL-NBR         PIC  9(09).              02190000
022000     05  PV-DISPLAY-SHIPT-UNT-ID         PIC  9(18).              02200000
022100     05  PV-DISPLAY-REC-SEQ-NBR          PIC  9(09).              02210000
022200     05  PV-REC-SEQ-NBR                  PIC  9(03).              02220000
022210*CLP 09/25/2014                                                   02221001
022300     05  PV-PO                           PIC  X(08)  VALUE SPACE. 02230001
022400     05  PV-PO-N               REDEFINES PV-PO                    02240000
022500                                         PIC  ZZZZZZZ9.           02250001
022600*10/04/13 DW BEG                                                  02260000
022700     05  PV-PO-IS-RFID-IND               PIC  X(1)   VALUE SPACE. 02270000
022800*10/04/13 DW BEG                                                  02280000
022900     05  PV-CA-STORE                     PIC  X(04)  VALUE SPACE. 02290000
023000     05  PV-CA-STORE-N         REDEFINES PV-CA-STORE              02300000
023100                                         PIC ZZZ9.                02310000
023200     05  PV-STORE                        PIC  X(04)  VALUE SPACE. 02320000
023300     05  PV-STORE-N            REDEFINES PV-STORE                 02330000
023400                                         PIC ZZZ9.                02340000
023500     05  PV-CLOSED-DAYS                  PIC S9(04)  VALUE ZERO   02350000
023600                                                     COMP.        02360000
023700     05  PV-CLOSED-HOURS                 PIC S9(02)  VALUE ZERO   02370000
023800                                                     COMP.        02380000
023900     05  PV-CLOSED-MINUTES               PIC S9(02)  VALUE ZERO   02390000
024000                                                     COMP.        02400000
024100     05  PV-TOTAL-CLOSED-MINUTES         PIC S9(09)  VALUE ZERO   02410000
024200                                                     COMP.        02420000
024300     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE ZERO   02430000
024400                                                     COMP SYNC.   02440000
024500     05  PV-ORD-NBR                      PIC S9(09)  VALUE ZERO   02450000
024600                                                     COMP.        02460000
024700     05  PV-PO-NBR                       PIC S9(09)  VALUE ZERO   02470000
024710                                                     COMP.        02471000
024720     05  PV-SYSID                        PIC  X(04)  VALUE SPACE. 02472000
024730     05  PV-MESSAGE-AREA                 PIC  X(19)  VALUE SPACE. 02473000
024740     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  02474000
024750                                                     COMP SYNC.   02475000
024760     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 02476000
024770     05  PV-NULL-IND-1                   PIC S9(04)  VALUE +0     02477000
024780                                                     COMP.        02478000
024790     05  PV-OPER-UNT-ID                  PIC S9(04)  VALUE ZEROS  02479000
024800                                                     COMP.        02480000
024900     05  PV-FCLTY-ID                     PIC S9(04)  VALUE ZEROS  02490000
025000                                                     COMP.        02500000
025100     05  PV-TS-ITEM                      PIC S9(04)  VALUE ZERO   02510000
025200                                                     COMP.        02520000
025300     05  PV-SIGN-ON-INFO-LENGTH          PIC S9(04)  VALUE ZERO   02530000
025400                                                     COMP SYNC.   02540000
025500     05  PV-CTN-SNGL-DGIT-CHECK          PIC X(01)   VALUE SPACE. 02550010
025501         88 PV-SNGL-DGIT-VALID       VALUE                        02550110
025502                       '0', '1', '2', '3', '4',                   02550209
025503                       '5', '6', '7', '8', '9'.                   02550310
025510     05  PV-CTN.                                                  02551009
025600         10  PV-CTN-FIRST-DIGIT          PIC X(01).               02560000
025700         10  PV-CTN-LAST-17              PIC X(17).               02570000
025800         10  PV-CTN-FILLER               PIC X(02).               02580000
025900     05  FILLER REDEFINES PV-CTN.                                 02590000
026000         10  PV-CTN-SCAN-00              PIC X(02).               02600000
026100         10  PV-CTN-SCAN-THIRD-DGT       PIC X(01).               02610000
026200         10  PV-CTN-SCAN-LAST-17         PIC X(17).               02620000
026300     05  FILLER REDEFINES PV-CTN.                                 02630000
026400         10  PV-CTN-SCAN-00              PIC  X(02).              02640000
026500         10  PV-CTN-SCAN-LAST-18         PIC  X(18).              02650000
026600     05  PV-CHAR-COUNT                   PIC S9(04)  VALUE ZEROS  02660000
026700                                                     COMP SYNC.   02670000
026800     05  PV-ODDS-SUM                     PIC  9(04)  VALUE ZEROS. 02680000
026900     05  PV-EVENS-SUM                    PIC  9(04)  VALUE ZEROS. 02690000
027000     05  PV-TOTAL                        PIC  9(04).              02700000
027100     05  FILLER REDEFINES PV-TOTAL.                               02710000
027200         10  FILLER                      PIC  9(03).              02720000
027300         10  PV-TOTAL-LAST-DIGIT         PIC  9(01).              02730000
027400     05  PV-CHECK-DIGIT                  PIC  9(01).              02740000
027500     05  PV-WRITE-LENGTH                 PIC  9(04)  VALUE  80    02750000
027600                                                     COMP SYNC.   02760000
027700     05  PV-RBA                          PIC S9(08)  VALUE +0     02770000
027800                                                     COMP SYNC.   02780000
027900     05  PV-CTN-X                        PIC  X(18).              02790000
028000     05  PV-CTN-N REDEFINES PV-CTN-X     PIC  9(18).              02800000
028100     05  PV-CTN-1-18 REDEFINES PV-CTN-X.                          02810000
028200         10  PV-CTN-9-1                  PIC  9(01).              02820000
028300         10  PV-CTN-9-2                  PIC  9(01).              02830000
028400         10  PV-CTN-9-3                  PIC  9(01).              02840000
028500         10  PV-CTN-9-4                  PIC  9(01).              02850000
028600         10  PV-CTN-9-5                  PIC  9(01).              02860000
028700         10  PV-CTN-9-6                  PIC  9(01).              02870000
028800         10  PV-CTN-9-7                  PIC  9(01).              02880000
028900         10  PV-CTN-9-8                  PIC  9(01).              02890000
029000         10  PV-CTN-9-9                  PIC  9(01).              02900000
029100         10  PV-CTN-9-10                 PIC  9(01).              02910000
029200         10  PV-CTN-9-11                 PIC  9(01).              02920000
029300         10  PV-CTN-9-12                 PIC  9(01).              02930000
029400         10  PV-CTN-9-13                 PIC  9(01).              02940000
029500         10  PV-CTN-9-14                 PIC  9(01).              02950000
029600         10  PV-CTN-9-15                 PIC  9(01).              02960000
029700         10  PV-CTN-9-16                 PIC  9(01).              02970000
029800         10  PV-CTN-9-17                 PIC  9(01).              02980000
029900         10  PV-CTN-9-18                 PIC  9(01).              02990000
030000     05  PV-COMBINED-STRT-TMST           PIC  X(26).              03000000
030100                                                                  03010000
030200******************************************************************03020000
030300*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      03030000
030400******************************************************************03040000
030500     COPY DFHAID.                                                 03050000
030600                                                                  03060000
030700******************************************************************03070000
030800* COMMAREA FOR PCKUT713 - CARTON STATUS MODULE                    03080003
030900******************************************************************03090000
031000     COPY PCWS046.                                                03100000
031100                                                                  03110000
031200******************************************************************03120000
031300*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                03130000
031400******************************************************************03140000
031500     COPY DPWS013.                                                03150000
031600/                                                                 03160000
031700******************************************************************03170000
031800*    COMMON CARTON CLOSE COMMUNICATION AREA                       03180000
031900******************************************************************03190000
032000     COPY SUWS091.                                                03200000
032100******************************************************************03210000
032200*    COMMON RFID DETERMINATION COMMUNICATION AREA                 03220000
032300******************************************************************03230000
032400     COPY SUWS093.                                                03240000
032500/                                                                 03250000
032600******************************************************************03260000
032700*  SENDING/RECEIVING AREA FOR THE                                 03270000
032800*  PRINTER VALIDATION ROUTING (DPKCS060)                          03280000
032900******************************************************************03290000
033000     COPY DPWS072.                                                03300000
033100                                                                  03310000
033200******************************************************************03320000
033300*    COPY BOOK FOR THE CICSAUTH SUBROUTINE                        03330000
033400******************************************************************03340000
033500     COPY DPWS008.                                                03350000
033600                                                                  03360000
033700******************************************************************03370000
033800*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 03380000
033900*****************************************************************.03390000
034000     COPY DPWS010I.                                               03400000
034100                                                                  03410000
034200******************************************************************03420000
034300*  RANDOM NUMBER AREA.                                            03430000
034400******************************************************************03440000
034500     COPY DPWS902.                                                03450000
034600                                                                  03460000
034700******************************************************************03470000
034800*  GENERATED DSECT FOR THE SUKM511 MAPSET                         03480000
034900******************************************************************03490000
035000     COPY SUKM511.                                                03500000
035100                                                                  03510000
035200******************************************************************03520000
035300*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   03530000
035400******************************************************************03540000
035500     COPY DPWS015.                                                03550000
035600                                                                  03560000
035700*----------------------------------------------------------------*03570000
035800* HELP SCREEN COMMAREA                                            03580000
035900     COPY PCWS192.                                                03590000
036000*----------------------------------------------------------------*03600000
036100* HELP SCREEN WORK AREA                                           03610000
036200     COPY PCWS188.                                                03620000
036300                                                                  03630000
036400******************************************************************03640000
036500*  COPY BOOK CONTAINING ERROR/WARNING/INFORMATIONAL MESSAGES      03650000
036600*  TO BE DISPLAYED ON THE LRT                                     03660000
036700******************************************************************03670000
036800     COPY SUWS005.                                                03680000
036900                                                                  03690000
037000******************************************************************03700000
037100*  COPY BOOK USED IN CHECK IN PROCESSING                          03710000
037200*  MOVED TO CA-HOST-SAVE-AREA AND PASSED ALONG CARTON AUDIT AND   03720000
037300*  PASSED BACK TO THE CHECK-IN PROGRAM (SUKRF502)                 03730000
037400******************************************************************03740000
037500     COPY SUWS001.                                                03750000
037600                                                                  03760000
037700******************************************************************03770000
037800*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SUT_PO_AUD_EXC     03780000
037900*  TABLE                                                          03790000
038000******************************************************************03800000
038100     EXEC SQL                                                     03810000
038200         INCLUDE SUT00014                                         03820000
038300     END-EXEC.                                                    03830000
038400                                                                  03840000
038500******************************************************************03850000
038600*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      03860000
038700*  CARTON TABLE (SUT_OTBND_CART)                                  03870000
038800******************************************************************03880000
038900     EXEC SQL                                                     03890000
039000         INCLUDE SUT00024                                         03900000
039100     END-EXEC.                                                    03910000
039200                                                                  03920000
039300******************************************************************03930000
039400*  SQL AND COBOL DECLARATIONS FOR THE KOHLS/RETEK PARMS (TKRPRPM) 03940000
039500******************************************************************03950000
039600     EXEC SQL                                                     03960000
039700          INCLUDE TKRPRPM                                         03970000
039800     END-EXEC.                                                    03980000
039900                                                                  03990000
040000******************************************************************04000000
040100*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      04010000
040200*  AUDIT TRANSATION TABLE (TSUATRN)                               04020000
040300******************************************************************04030000
040400     EXEC SQL                                                     04040000
040500         INCLUDE TSUATRN                                          04050000
040600     END-EXEC.                                                    04060000
040700                                                                  04070000
040800******************************************************************04080000
040900*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      04090000
041000*  AUDIT TABLE (TSUNAUD)                                          04100000
041100******************************************************************04110000
041200     EXEC SQL                                                     04120000
041300         INCLUDE TSUNAUD                                          04130000
041400     END-EXEC.                                                    04140000
041500                                                                  04150000
041600******************************************************************04160000
041700*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE COMPANY CONTROL    04170000
041800*  TABLE (TCOCNTL)                                                04180000
041900******************************************************************04190000
042000     EXEC SQL                                                     04200000
042100         INCLUDE TCOCNTL                                          04210000
042200     END-EXEC.                                                    04220000
042300                                                                  04230000
042400******************************************************************04240000
042500*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE INBOUND SHIPPING UN04250000
042600*  PACKSLIP ASSIOCIATION TABLE                                    04260000
042700******************************************************************04270000
042800     EXEC SQL                                                     04280000
042900         INCLUDE TINPKSU                                          04290000
043000     END-EXEC.                                                    04300000
043100                                                                  04310000
043200******************************************************************04320000
043300*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE PACKSLIP HEADER TAB04330000
043400******************************************************************04340000
043500     EXEC SQL                                                     04350000
043600         INCLUDE TPKSLIP                                          04360000
043700     END-EXEC.                                                    04370000
043800                                                                  04380000
043900******************************************************************04390000
044000*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      04400000
044100*  UPC TABLE                                                      04410000
044200******************************************************************04420000
044300     EXEC SQL                                                     04430000
044400         INCLUDE TSHUUPC                                          04440000
044500     END-EXEC.                                                    04450000
044600                                                                  04460000
044700******************************************************************04470000
044800*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      04480000
044900*  (TSHPUNT)                                                      04490000
045000******************************************************************04500000
045100     EXEC SQL                                                     04510000
045200         INCLUDE TSHPUNT                                          04520000
045300     END-EXEC.                                                    04530000
045400                                                                  04540000
045500******************************************************************04550000
045600*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      04560000
045700*  AUDIT TRANSACTION EXCEPTION TABLE                              04570000
045800******************************************************************04580000
045900     EXEC SQL                                                     04590000
046000         INCLUDE TCTEXCP                                          04600000
046100     END-EXEC.                                                    04610000
046200                                                                  04620000
046300******************************************************************04630000
046400*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE PURCHASE ORDER     04640000
046500*  TABLE                                                          04650000
046600******************************************************************04660000
046700     EXEC SQL                                                     04670000
046800         INCLUDE TPURCHS                                          04680000
046900     END-EXEC.                                                    04690000
047000                                                                  04700000
047100******************************************************************04710000
047200*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE RECEIVING          04720000
047300*  TABLE                                                          04730000
047400******************************************************************04740000
047500     EXEC SQL                                                     04750000
047600         INCLUDE TRECEIV                                          04760000
047700     END-EXEC.                                                    04770000
047800                                                                  04780000
047900******************************************************************04790000
048000*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE XLT_LOC            04800000
048100*  TABLE                                                          04810000
048200******************************************************************04820000
048300     EXEC SQL                                                     04830000
048400         INCLUDE XLT00010                                         04840000
048500     END-EXEC.                                                    04850000
048600                                                                  04860000
048700******************************************************************04870000
048800*    DB2 AREA FOR THE PO AUDIT REQUEST TABLE (SUT_PO_AUD_REQ)   * 04880000
048900******************************************************************04890000
049000     EXEC SQL                                                     04900000
049100         INCLUDE SUT00015                                         04910000
049200     END-EXEC.                                                    04920000
049210                                                                  04921000
049220******************************************************************04922000
049230*    DB2 AREA FOR THE CHECK IN CROSS REFERENCE TABLE            * 04923000
049240******************************************************************04924000
049250     EXEC SQL                                                     04925000
049260         INCLUDE TSULBXF                                          04926000
049270     END-EXEC.                                                    04927000
049280                                                                  04928000
049290******************************************************************04929000
049300*    DB2 AREA FOR THE CHECK IN SHIP UNT LOCATION TABLE          * 04930000
049400******************************************************************04940000
049500     EXEC SQL                                                     04950000
049600         INCLUDE TSHUNLO                                          04960000
049700     END-EXEC.                                                    04970000
049800                                                                  04980000
049900******************************************************************04990000
050000*    DB2 AREA FOR THE RIT_RFID_VRFN TABLE                       * 05000000
050100******************************************************************05010000
050200     EXEC SQL                                                     05020000
050300         INCLUDE RIT00000                                         05030000
050400     END-EXEC.                                                    05040000
050500                                                                  05050000
050600** 12/05/13 JHA BEG                                               05060000
050700******************************************************************05070000
050800*    DB2 AREA FOR THE VENDOR AGREEMENT TABLE                    * 05080000
050900******************************************************************05090000
051000     EXEC SQL                                                     05100000
051100         INCLUDE TVNDAGR                                          05110000
051200     END-EXEC.                                                    05120000
051210** 12/05/13 JHA END                                               05121000
051220                                                                  05122000
051230***************************************************************** 05123000
051240*    DB2 AREA FOR PURCHASE ORDER LINE ITEM TABLE                * 05124000
051250***************************************************************** 05125000
051260     EXEC SQL                                                     05126000
051270          INCLUDE TPURITM                                         05127000
051280     END-EXEC.                                                    05128000
051290                                                                  05129000
051300***************************************************************** 05130000
051310*    DB2 AREA FOR RECEIPT ITEM TABLE                            * 05131000
051320***************************************************************** 05132000
051330     EXEC SQL                                                     05133000
051340          INCLUDE TRECITM                                         05134000
051350     END-EXEC.                                                    05135000
051360                                                                  05136000
051370***************************************************************** 05137000
051380*    DB2 AREA FOR PO PREPACK DATA                               * 05138000
051390***************************************************************** 05139000
051391     EXEC SQL                                                     05139100
051392          INCLUDE TPOPRPK                                         05139200
051393     END-EXEC.                                                    05139300
051394                                                                  05139400
051395******************************************************************05139500
051396*  COMMUNICATIONS AREA FOR DB2                                    05139600
051397******************************************************************05139700
051398     EXEC SQL                                                     05139800
051399         INCLUDE SQLCA                                            05139900
051400     END-EXEC.                                                    05140000
051500                                                                  05150000
051600******************************************************************05160000
051700 LINKAGE SECTION.                                                 05170000
051800******************************************************************05180000
051900 01  DFHCOMMAREA.                                                 05190000
052000     05  FILLER                         OCCURS  1 TO 4072 TIMES   05200000
052100                                        DEPENDING ON EIBCALEN.    05210000
052200         10  FILLER                     PIC X.                    05220000
052300                                                                  05230000
052400                                                                  05240000
052500******************************************************************05250000
052600 PROCEDURE DIVISION.                                              05260000
052700******************************************************************05270000
052800 0000-PROGRAM-MAINLINE.                                           05280000
052900     MOVE DFHCOMMAREA  TO  CA-COMMAREA.                           05290000
053000     MOVE LOW-VALUES   TO  SU511AI.                               05300000
053100     INITIALIZE PV-CTN                                            05310000
053200                PV-PO                                             05320000
053300                PV-STORE.                                         05330000
053400                                                                  05340000
053500     EVALUATE TRUE                                                05350000
053600****************************************************************  05360000
053700* DPKRF278 IS THE PGM FOR THE HELP SCREEN.                        05370000
053800****************************************************************  05380000
053900         WHEN EIBTRNID = 'Z278'                                   05390000
054000             MOVE DFHCOMMAREA          TO PC192-COMMAREA          05400000
054100             MOVE PC192-HOST-SAVE-AREA TO CA-COMMAREA             05410000
054200             SET SU006-PROCESS-SCREEN  TO TRUE                    05420000
054300             PERFORM 1000-SETUP-SCREEN                            05430000
054400             PERFORM 8000-SEND-MAP                                05440000
054500             PERFORM 8200-RETURN-TRANID                           05450000
054600                                                                  05460000
054700         WHEN SU006-INITIALIZE-SCREEN AND                         05470000
054800             SU006-LAST-PROGRAM    = PC-MESSAGE-PROGRAM AND       05480000
054900            (SU006-PGM-MSG-NBR = 22 OR                            05490000
055000             SU006-PGM-MSG-NBR = 23 OR                            05500000
055100             SU006-PGM-MSG-NBR = 24)                              05510000
055200             IF SU006-PGM-MSG-NBR = 23 OR                         05520000
055300                SU006-PGM-MSG-NBR = 24                            05530000
055400                 SET SU006-NO-UNIT-ADJ   TO TRUE                  05540000
055500             END-IF                                               05550000
055600             SET SU006-PROCESS-SCREEN TO TRUE                     05560000
055700             MOVE SU006-SHIP-UNIT-NBR-X TO PV-CTN                 05570000
055800             PERFORM 1200-RECEIVE-MAP                             05580000
055900             PERFORM 1300-EDIT-SELECTION                          05590000
056000             MOVE DP015-UNP-ALP-NOR-OFF      TO ACARTNA           05600000
056100             MOVE DP015-PRO-NOR-OFF          TO APOA              05610000
056200             MOVE DP015-PRO-NOR-OFF          TO ASTRA             05620000
056300             MOVE SU006-PO                   TO PV-PO-N           05630000
056400             MOVE PV-PO                      TO APOO              05640000
056500*10/04/13 DW BEG                                                  05650000
056600             IF PV-CTN NOT = SPACES                               05660000
056700                 PERFORM 5000-POPULATE-AUDTYP                     05670000
056800             END-IF                                               05680000
056900*10/04/13 DW END                                                  05690000
057000             IF CA-CART-LBL-TYP-CDE = PC-P                        05700000
057100                MOVE  'P2L'                  TO ASTRO             05710000
057200             ELSE                                                 05720000
057300                MOVE SU006-STORE             TO PV-STORE-N        05730000
057400                MOVE PV-STORE                TO ASTRO             05740000
057500             END-IF                                               05750000
057600             MOVE SU006-SHIP-UNIT-NBR        TO ACARTNO           05760000
057700             MOVE SU006-REC-SEQ-NBR          TO PV-REC-SEQ-NBR    05770000
057800             MOVE PV-REC-SEQ-NBR             TO ARCVRO            05780000
057900             MOVE PC-PF-MATCH-PF-KEY-MSG     TO APFKO             05790000
058000             MOVE SPACES                     TO AMSGLNO           05800000
058100             MOVE -1                         TO ACARTNL           05810000
058200             PERFORM 8000-SEND-MAP                                05820000
058300             PERFORM 8200-RETURN-TRANID                           05830000
058400                                                                  05840000
058500         WHEN EIBCALEN = ZERO                                     05850000
058600         WHEN EIBAID = DFHCLEAR                                   05860000
058700         WHEN SU006-INITIALIZE-SCREEN                             05870000
058800                                                                  05880000
058900             SET SU006-PROCESS-SCREEN  TO TRUE                    05890000
059000             SET SU006-UNIT-ADJ        TO TRUE                    05900000
059100             PERFORM 1000-SETUP-SCREEN                            05910000
059200                                                                  05920000
059300             PERFORM 8000-SEND-MAP                                05930000
059400             PERFORM 8200-RETURN-TRANID                           05940000
059500                                                                  05950000
059600         WHEN EIBAID = DFHENTER                                   05960000
059700             PERFORM 1200-RECEIVE-MAP                             05970000
059800             PERFORM 1300-EDIT-SELECTION                          05980000
059900             MOVE SU006-SHIP-UNIT-NBR-X       TO PV-CTN           05990000
060000             MOVE DP015-UNP-ALP-NOR-OFF      TO ACARTNA           06000000
060100             MOVE DP015-PRO-NOR-OFF          TO APOA              06010000
060200             MOVE DP015-PRO-NOR-OFF          TO ASTRA             06020000
060300             MOVE SU006-PO                   TO PV-PO-N           06030000
060400             MOVE PV-PO                      TO APOO              06040000
060500*10/04/13 DW BEG                                                  06050000
060600             IF PV-CTN NOT = SPACES                               06060000
060700                 PERFORM 5000-POPULATE-AUDTYP                     06070000
060800             END-IF                                               06080000
060900*10/04/13 DW END                                                  06090000
061000             IF CA-CART-LBL-TYP-CDE = PC-P                        06100000
061100                MOVE  'P2L'                  TO ASTRO             06110000
061200             ELSE                                                 06120000
061300                MOVE SU006-STORE             TO PV-STORE-N        06130000
061400                MOVE PV-STORE                TO ASTRO             06140000
061500             END-IF                                               06150000
061600             MOVE SU006-SHIP-UNIT-NBR        TO ACARTNO           06160000
061700             MOVE SU006-REC-SEQ-NBR          TO PV-REC-SEQ-NBR    06170000
061800             MOVE PV-REC-SEQ-NBR             TO ARCVRO            06180000
061900             MOVE PC-PF-MATCH-PF-KEY-MSG     TO APFKO             06190000
062000             MOVE SPACES                     TO AMSGLNO           06200000
062100             MOVE -1                         TO ACARTNL           06210000
062200                                                                  06220000
062300                                                                  06230000
062400*        THE USER PRESSED THE F2 TO CONTINUE FIRST RECEIVE AND    06240000
062500*        VALIDATE ANY VALUES THAT MAY HAVE BEEN ENTERED, THEN     06250000
062600*        CREATE AN AUDIT ROW, AND, IF NECESSARY, EXCEPTIONS ROWS  06260000
062700         WHEN EIBAID = DFHPF2                                     06270000
062800            PERFORM 1200-RECEIVE-MAP                              06280000
062900            PERFORM 1300-EDIT-SELECTION                           06290000
063000            MOVE SU006-SHIP-UNIT-NBR-X       TO PV-CTN            06300000
063100*10/04/13 DW BEG                                                  06310000
063200            IF PV-CTN NOT = SPACES                                06320000
063300               PERFORM 5000-POPULATE-AUDTYP                       06330000
063400            END-IF                                                06340000
063500*10/04/13 DW END                                                  06350000
063600                                                                  06360000
063700            IF SU006-SHIP-UNIT-NBR = SPACES OR ZEROES             06370000
063800               MOVE PM-CART-ID-REQ-MSG  TO AMSGLNO                06380000
063900            ELSE                                                  06390000
064000               IF SU006-PO = 0                                    06400000
064100                  MOVE PM-PO-NBR-REQ-MSG TO AMSGLNO               06410000
064200                  MOVE DP015-PRO-NOR-OFF          TO ACARTNA      06420000
064300                  MOVE DP015-UNP-ALP-NOR-OFF      TO APOA         06430000
064400                  MOVE DP015-UNP-ALP-NOR-OFF      TO ASTRA        06440000
064500                  MOVE SU006-PO                   TO PV-PO-N      06450000
064600                  MOVE PV-PO                      TO APOO         06460000
064700                  IF CA-CART-LBL-TYP-CDE = PC-P                   06470000
064800                    MOVE 'P2L'                 TO ASTRO           06480000
064900                  ELSE                                            06490000
065000                    MOVE SU006-STORE           TO PV-STORE-N      06500000
065100                    MOVE PV-STORE              TO ASTRO           06510000
065200                  END-IF                                          06520000
065300                  MOVE SU006-SHIP-UNIT-NBR        TO ACARTNO      06530000
065400                  MOVE SU006-REC-SEQ-NBR         TO PV-REC-SEQ-NBR06540000
065500                  MOVE PV-REC-SEQ-NBR             TO ARCVRO       06550000
065600                  MOVE PC-PF-CONTINUE-PF-KEY-MSG  TO APFKO        06560000
065700                  MOVE PC-PLS-ENT-FLD-MSG         TO AMSGLNO      06570000
065800                  MOVE -1                         TO APOL         06580000
065900               ELSE                                               06590000
066000                  MOVE SU006-AUDIT-CNTL-NBR TO SUATRN-AUD-CNTL-NBR06600000
066100                  MOVE SU006-SHIP-UNIT-NBR TO SUATRN-SHIPT-UNT-ID 06610000
066200                  MOVE CA-OLD-STORE    TO SUATRN-DEST-OPER-UNT-ID 06620000
066300                  MOVE SU006-USERID      TO SUATRN-UNT-AUD-USR-ID 06630000
066400                  MOVE CA-OLD-PO         TO SUATRN-TRN-NBR        06640000
066500                  MOVE SU006-REC-SEQ-NBR TO SUATRN-REC-SEQ-NBR    06650000
066600                  IF SU006-SYSTEM-GENERATED-AUDIT                 06660000
066700                    IF SU006-PO = CA-OLD-PO AND                   06670000
066800                       SU006-STORE = CA-OLD-STORE                 06680000
066900                        MOVE 'N'    TO SUATRN-UNT-AUD-ERR-IND     06690000
067000                                           SU006-AUD-ERR-IND      06700000
067100                    ELSE                                          06710000
067200                        MOVE 'Y'    TO SUATRN-UNT-AUD-ERR-IND     06720000
067300                                       SU006-AUD-ERR-IND          06730000
067400                        PERFORM 3100-PREPARE-EXCEPTION-INSERTS    06740000
067500                    END-IF                                        06750000
067600                    PERFORM 2260-SELECT-TSUATRN                   06760000
067700                    IF SUATRN-UNT-AUD-STRT-TMST                   06770000
067800                                     = PC-DB2-NINES-DATE          06780000
067900                       PERFORM 2290-UPDATE-TSUATRN                06790000
068000                    END-IF                                        06800000
068100                    PERFORM 2510-CHECK-IF-STOPPED                 06810000
068200                    IF SUNAUD-AUD-STRT-TMST = PC-DB2-NINES-DATE   06820000
068300                        PERFORM 2295-UPDATE-TSUNAUD               06830000
068400                    END-IF                                        06840000
068500                    IF SU006-QC-AND-RFID-AUD                      06850000
068600                        PERFORM 2300-UPDATE-COMBINED-RTN          06860000
068700                    END-IF                                        06870000
068800                  ELSE                                            06880000
068900*           IF THESE ARE BOTH EQUAL, NEITHER FIELD CHANGED, AND   06890000
069000*           THERE SHOULD BE NO EXCEPTION CREATED...IF EITHER DID  06900000
069100*           CHANGE, CREATE THE EXCEPTION                          06910000
069200                      IF SU006-PO = CA-OLD-PO AND                 06920000
069300                         SU006-STORE = CA-OLD-STORE               06930000
069400                          MOVE 'N'    TO SUATRN-UNT-AUD-ERR-IND   06940000
069500                                             SU006-AUD-ERR-IND    06950000
069600                          PERFORM  2270-INSERT-TSUATRN            06960000
069700                      ELSE                                        06970000
069800                          MOVE 'Y'    TO SUATRN-UNT-AUD-ERR-IND   06980000
069900                                         SU006-AUD-ERR-IND        06990000
070000                          PERFORM 2270-INSERT-TSUATRN             07000000
070100                          PERFORM 3100-PREPARE-EXCEPTION-INSERTS  07010000
070200                      END-IF                                      07020000
070300*10/04/13 DW BEG                                                  07030000
070400*                 MOVE SU006-PO           TO SHUUPC-TRN-NBR       07040000
070500*                 MOVE 'N'                TO PV-PO-IS-RFID-IND    07050000
070600*** DETERMINE IF THIS PO IS FOR AN RFID DEPARTMENT FOR MANUAL     07060000
070700*** AUDIT                                                         07070000
070800*                 PERFORM 5200-IS-PO-FOR-RFID-DEPT                07080000
070900*                 IF PV-PO-IS-RFID-IND = 'Y'                      07090000
071000*                   SET SU006-QC-AND-RFID-AUD TO TRUE             07100000
071100*                 ELSE                                            07110000
071200*                   SET SU006-QC-AUD-ONLY TO TRUE                 07120000
071300*                 END-IF                                          07130000
071400*10/04/13 DW END                                                  07140000
071500                  END-IF                                          07150000
071600                  MOVE CA-OLD-PO TO SU006-PO                      07160000
071700                  MOVE CA-OLD-STORE TO SU006-STORE                07170000
071800                  IF SU006-PREPK-ITYPE-PKGNG-CDE                  07180000
071900                     MOVE PC-PREPK-QTY-SCREEN-PROGRAM             07190000
072000                                          TO PV-TRANSFER-PROGRAM  07200000
072100                  ELSE                                            07210000
072200                     MOVE PC-UPC-SCAN-SCREEN                      07220000
072300                                          TO PV-TRANSFER-PROGRAM  07230000
072400                  END-IF                                          07240000
072500                  PERFORM 2100-XCTL-TO-SELECTED-PROGRAM           07250000
072600               END-IF                                             07260000
072700            END-IF                                                07270000
072800                                                                  07280000
072900*        THE USER PRESSED THE F9 TO RECORD UNMATCHED INFORMATION  07290000
073000         WHEN EIBAID = DFHPF9                                     07300000
073100            PERFORM 1200-RECEIVE-MAP                              07310000
073200            PERFORM 1300-EDIT-SELECTION                           07320000
073300                                                                  07330000
073400            SET CA-AFTER-PF9                TO TRUE               07340000
073500            MOVE DP015-PRO-NOR-OFF          TO ACARTNA            07350000
073600            MOVE DP015-UNP-ALP-NOR-OFF      TO APOA               07360000
073700            MOVE SU006-STORE                TO PV-STORE-N         07370000
073800            MOVE PV-STORE                   TO ASTRO              07380000
073900            IF SU006-SYSTEM-GENERATED-AUDIT                       07390000
074000               IF CA-CART-LBL-TYP-CDE = PC-K                      07400000
074100                  MOVE DP015-UNP-ALP-NOR-OFF      TO ASTRA        07410000
074200               END-IF                                             07420000
074300                                                                  07430000
074400               IF CA-CART-LBL-TYP-CDE = PC-P                      07440000
074500                  MOVE  'P2L'                  TO ASTRO           07450000
074600               END-IF                                             07460000
074700            ELSE                                                  07470000
074800                  MOVE DP015-UNP-ALP-NOR-OFF      TO ASTRA        07480000
074900            END-IF                                                07490000
075000                                                                  07500000
075100            MOVE SU006-PO                   TO PV-PO-N            07510000
075200            MOVE PV-PO                      TO APOO               07520000
075300*10/04/13 DW BEG                                                  07530000
075400            MOVE SU006-SHIP-UNIT-NBR-X       TO PV-CTN            07540000
075500            IF PV-CTN NOT = SPACES                                07550000
075600                PERFORM 5000-POPULATE-AUDTYP                      07560000
075700            END-IF                                                07570000
075800*10/04/13 DW END                                                  07580000
075900            MOVE SU006-SHIP-UNIT-NBR        TO ACARTNO            07590000
076000            MOVE SU006-REC-SEQ-NBR          TO PV-REC-SEQ-NBR     07600000
076100            MOVE PV-REC-SEQ-NBR             TO ARCVRO             07610000
076200            MOVE PC-PF-CONTINUE-PF-KEY-MSG  TO APFKO              07620000
076300            MOVE PC-PLS-ENT-FLD-MSG         TO AMSGLNO            07630000
076400            MOVE -1                         TO APOL               07640000
076500                                                                  07650000
076600         WHEN EIBAID = DFHPF3                                     07660000
076700             IF SU006-LAST-PROGRAM = PC-AUDIT-STAT-PGM            07670000
076800                 MOVE SU006-HOST-SAVE-AREA TO SU001-COMMON-DATA   07680000
076900                 MOVE PC-SU-CHECK-IN-PGM                          07690000
077000                                      TO PV-TRANSFER-PROGRAM      07700000
077100                 PERFORM 2150-XCTL-TO-SELECTED-PROGRAM            07710000
077200             ELSE                                                 07720000
077300                 MOVE PC-AUDIT-CLOSE-PROGRAM                      07730000
077400                                      TO PV-TRANSFER-PROGRAM      07740000
077500                 PERFORM 2100-XCTL-TO-SELECTED-PROGRAM            07750000
077600             END-IF                                               07760000
077700                                                                  07770000
077800         WHEN EIBAID = DFHPF1                                     07780000
077900              PERFORM 1600-HELP-SCREEN                            07790000
078000                                                                  07800000
078100         WHEN OTHER                                               07810000
078200             MOVE PM-UNRECOGNIZED-PF-KEY-MSG  TO  AMSGLNO         07820000
078300                                                                  07830000
078400     END-EVALUATE.                                                07840000
078500                                                                  07850000
078600     PERFORM 8100-SEND-DATA-ONLY.                                 07860000
078700     PERFORM 8200-RETURN-TRANID.                                  07870000
078800                                                                  07880000
078900     GOBACK.                                                      07890000
079000****************************************************************  07900000
079100* 1000-SETUP-SCREEN                                               07910000
079200*    INITIAL SETUP OF SCREEN FIELDS                               07920000
079300****************************************************************  07930000
079400 1000-SETUP-SCREEN.                                               07940000
079500                                                                  07950000
079600     EVALUATE TRUE                                                07960000
079700*    IF RETURNING TO THIS PROGRAM FROM THE AUDIT CLOSE/CONTINUE   07970000
079800*    SCREEN, INITIALIZE ALL THE SCREEN FIELDS, AND ONLY ALLOW     07980000
079900*    THE USER TO ENTER THE CARTON                                 07990000
080000     WHEN SU006-LAST-PROGRAM = PC-AUDIT-CONT-PROGRAM              08000000
080100         MOVE SPACES                      TO SU006-SHIP-UNIT-NBR-X08010000
080200         INITIALIZE  CA-PROGRAM-COMMAREA                          08020000
080300                     SU006-PO                                     08030000
080400                     SU006-REC-SEQ-NBR                            08040000
080500                     SU006-STORE                                  08050000
080600          SET SU006-NOT-MISDIRECT         TO TRUE                 08060000
080700          MOVE DP015-UNP-ALP-NOR-OFF      TO ACARTNA              08070000
080800          MOVE -1                         TO ACARTNL              08080000
080900          MOVE DP015-PRO-NOR-OFF          TO APOA                 08090000
081000          MOVE DP015-PRO-NOR-OFF          TO ASTRA                08100000
081100          MOVE SPACES                     TO AMSGLNO              08110000
081200                                                                  08120000
081300*    IF COMING FROM THE AUDIT STATUS PROGRAM(SUKRF534), USE THE   08130000
081400*    CARTON NUMBER FROM THE COMMAREA AND FILL IN THE PO, RCVR     08140000
081500*    AND STORE NUMBER FIELDS.                                     08150000
081600     WHEN SU006-LAST-PROGRAM = PC-AUDIT-STAT-PGM                  08160000
081700         MOVE SU006-SHIP-UNIT-NBR-X       TO PV-CTN               08170000
081800         PERFORM 1300-EDIT-SELECTION                              08180000
081900         MOVE DP015-UNP-ALP-NOR-OFF      TO ACARTNA               08190000
082000         MOVE DP015-PRO-NOR-OFF          TO APOA                  08200000
082100         MOVE DP015-PRO-NOR-OFF          TO ASTRA                 08210000
082200         MOVE SU006-PO                   TO PV-PO-N               08220000
082300         MOVE PV-PO                      TO APOO                  08230000
082400*10/04/13 DW BEG                                                  08240000
082500         IF PV-CTN NOT = SPACES                                   08250000
082600             PERFORM 5000-POPULATE-AUDTYP                         08260000
082700         END-IF                                                   08270000
082800*10/04/13 DW END                                                  08280000
082900         IF CA-CART-LBL-TYP-CDE = PC-P                            08290000
083000            MOVE 'P2L'                   TO ASTRO                 08300000
083100         ELSE                                                     08310000
083200            MOVE SU006-STORE             TO PV-STORE-N            08320000
083300            MOVE PV-STORE                TO ASTRO                 08330000
083400         END-IF                                                   08340000
083500         MOVE SU006-SHIP-UNIT-NBR        TO ACARTNO               08350000
083600         MOVE SU006-REC-SEQ-NBR          TO PV-REC-SEQ-NBR        08360000
083700         MOVE PV-REC-SEQ-NBR             TO ARCVRO                08370000
083800         MOVE PC-PF-MATCH-PF-KEY-MSG     TO APFKO                 08380000
083900         MOVE SPACES                     TO AMSGLNO               08390000
084000         MOVE -1                         TO ACARTNL               08400000
084100                                                                  08410000
084200*    IF THE MESSAGE NUMBER IS > 0, IT MEANS THIS IS A MISDIRECT   08420000
084300*    AND CONTROL IS RETURNING TO THIS PROGRAM FROM THE MESSAGE    08430000
084400*    SCREEN.  SETTING THE MDT ATTIRBUTE TO THE CARTON NUMBER      08440000
084500*    WILL FLAG THE VALIDATION ROUTINE TO DO THE VALIDATION AGAIN  08450000
084600     WHEN SU006-PGM-MSG-NBR > 0                                   08460000
084700          MOVE +0                     TO SU006-PGM-MSG-NBR        08470000
084800          MOVE DP015-UNP-ALP-NOR-MDT  TO ACARTNA                  08480000
084900          MOVE -1                     TO ACARTNL                  08490000
085000          MOVE DP015-PRO-NOR-OFF      TO APOA                     08500000
085100          MOVE DP015-PRO-NOR-OFF      TO ASTRA                    08510000
085200          MOVE PC-PF-MATCH-PF-KEY-MSG TO AMSGLNO                  08520000
085300                                                                  08530000
085400     WHEN OTHER                                                   08540000
085500          INITIALIZE CA-PROGRAM-COMMAREA                          08550000
085600                     SU006-PO                                     08560000
085700                     SU006-STORE                                  08570000
085800                     SU006-REC-SEQ-NBR                            08580000
085900          MOVE SPACES                 TO SU006-SHIP-UNIT-NBR-X    08590000
086000          SET SU006-NOT-MISDIRECT         TO TRUE                 08600000
086100                                                                  08610000
086200          MOVE DP015-UNP-ALP-NOR-OFF  TO ACARTNA                  08620000
086300          MOVE -1                     TO ACARTNL                  08630000
086400          MOVE DP015-PRO-NOR-OFF      TO APOA                     08640000
086500          MOVE DP015-PRO-NOR-OFF      TO ASTRA                    08650000
086600          MOVE SPACES                 TO AMSGLNO                  08660000
086700                                                                  08670000
086800     END-EVALUATE.                                                08680000
086900                                                                  08690000
087000*    IN ALL CASES, MOVE THE CURRENT COMMAREA TO THE SCREEN        08700000
087100     MOVE SU006-SHIP-UNIT-NBR-X       TO ACARTNO.                 08710000
087200     MOVE SU006-SHIP-UNIT-NBR-X       TO PV-CTN.                  08720000
087300     MOVE SU006-PO                    TO PV-PO-N.                 08730000
087400     MOVE PV-PO                       TO APOO.                    08740000
087500*10/04/13 DW BEG                                                  08750000
087600     MOVE SU006-SHIP-UNIT-NBR-X       TO PV-CTN                   08760000
087700     IF PV-CTN NOT = SPACES                                       08770000
087800         PERFORM 5000-POPULATE-AUDTYP                             08780000
087900     END-IF                                                       08790000
088000*10/04/13 DW END                                                  08800000
088100     MOVE SU006-REC-SEQ-NBR           TO PV-REC-SEQ-NBR           08810000
088200     MOVE PV-REC-SEQ-NBR              TO ARCVRO                   08820000
088300     IF CA-CART-LBL-TYP-CDE = PC-P                                08830000
088400        MOVE 'P2L'                    TO ASTRO                    08840000
088500     ELSE                                                         08850000
088600        MOVE SU006-STORE              TO PV-STORE-N               08860000
088700        MOVE PV-STORE                 TO ASTRO                    08870000
088800     END-IF.                                                      08880000
088900                                                                  08890000
089000*                                                                 08900000
089100*                                                                 08910000
089200 1200-RECEIVE-MAP.                                                08920000
089300     EXEC CICS                                                    08930000
089400         RECEIVE                                                  08940000
089500             MAP     ('SU511A')                                   08950000
089600             MAPSET  ('SUKM511')                                  08960000
089700             RESP    (PV-CICS-RESPONSE)                           08970000
089800     END-EXEC.                                                    08980000
089900                                                                  08990000
090000     EVALUATE TRUE                                                09000000
090100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 09010000
090200              PERFORM 1210-RECEIVE-SCREEN-FIELDS                  09020000
090300         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                09030000
090400              CONTINUE                                            09040000
090500         WHEN OTHER                                               09050000
090600              MOVE '1200-RECEIVE-MAP'                             09060000
090700                                      TO DP013-PARAGRAPH          09070000
090800              MOVE 'UNABLE TO RECEIVE MAP'                        09080000
090900                                      TO DP013-MESSAGE-TEXT (1)   09090000
091000              SET DP013-LOGIC-ABEND   TO TRUE                     09100000
091100              SET DP013-NO-ROLLBACK   TO TRUE                     09110000
091200              PERFORM 9999-WRITE-CICS-LOG-MSG                     09120000
091300     END-EVALUATE.                                                09130000
091400*                                                                 09140000
091500 1210-RECEIVE-SCREEN-FIELDS.                                      09150000
091600*                                                                 09160000
091700     IF  ACARTNL > ZERO                                           09170000
091800         MOVE ACARTNI                 TO PV-CTN                   09180000
091900     ELSE                                                         09190000
092000         IF ACARTNA = DP015-ERASE-EOF                             09200000
092100             MOVE SPACES              TO PV-CTN                   09210000
092200         END-IF                                                   09220000
092300     END-IF.                                                      09230000
092400*                                                                 09240000
092500     IF  APOL    > ZERO                                           09250000
092600         MOVE APOI                    TO PV-PO                    09260000
092700     ELSE                                                         09270000
092800         IF APOA    = DP015-ERASE-EOF                             09280000
092900             MOVE SPACES              TO PV-PO                    09290000
093000         END-IF                                                   09300000
093100     END-IF.                                                      09310000
093200                                                                  09320000
093300     IF  ASTRL   > ZERO                                           09330000
093400         MOVE ASTRI                   TO PV-STORE                 09340000
093500     ELSE                                                         09350000
093600         IF ASTRA   = DP015-ERASE-EOF                             09360000
093700             MOVE SPACES              TO PV-STORE                 09370000
093800         END-IF                                                   09380000
093900     END-IF.                                                      09390000
094000                                                                  09400000
094100                                                                  09410000
094200*                                                                 09420000
094300**************************************************************    09430000
094400* EDIT ALL ENTERABLE FIELDS (OPERATING UNIT ID, AND SELECT)  *    09440000
094500**************************************************************    09450000
094600 1300-EDIT-SELECTION.                                             09460000
094700                                                                  09470000
094800*    ONLY DO THE VERIFICATION OF THE CARTON NUMBER ON THE         09480000
094900*    DB2 TABLES IF THE CARTON NUMBER CHANGED.  THE VERIFICATION   09490000
095000*    WILL REPLACE THE STORE/PO/REC SEQ NUMBER WITH THE VALUES     09500000
095100*    FROM THE TABLE.                                              09510000
095200     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              09520000
095300     PERFORM 3200-SELECT-AUDIT.                                   09530000
095400     IF PV-CTN > SPACES                                           09540000
095500         SET CA-NO-PF9          TO TRUE                           09550000
095600         PERFORM 1310-EDIT-CARTON-NUMBER                          09560000
095700         PERFORM 1320-VERIFY-CARTON-NUMBER                        09570000
095800     END-IF.                                                      09580000
095900     IF SUT00015-PKGNG-TYP-CDE = 'RF'                             09590000
096000       SET SU006-RFID-AUDIT    TO TRUE                            09600000
096100       SET SU006-RFID-AUD-ONLY TO TRUE                            09610000
096110     END-IF.                                                      09611000
096120*10/04/13 DW BEG                                                  09612000
096130     IF PV-NULL-IND-1 < ZERO                                      09613000
096140       MOVE ZEROES  TO SUT00015-RWRK-AUD-CNTL-NBR                 09614000
096141     END-IF.                                                      09614100
096142     MOVE SUT00015-RWRK-AUD-CNTL-NBR                              09614200
096143         TO SU006-RFID-AUDIT-CNTL-NBR.                            09614300
096144*10/04/13 DW END                                                  09614400
096145     IF PS-SYSTEM-AUDIT-FOUND AND                                 09614500
096146       (SUT00015-AUD-STAT-CDE = 'N' OR                            09614600
096147        SUT00015-AUD-STAT-CDE = 'F' OR                            09614700
096148        SUT00015-AUD-STAT-CDE = 'P')                              09614800
096149         IF SU006-QC-AND-RFID-AUD                                 09614900
096150           MOVE SU006-RFID-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR    09615000
096160           PERFORM 3200-SELECT-AUDIT                              09616000
096170           IF (SUT00015-AUD-STAT-CDE = 'N' OR                     09617000
096180               SUT00015-AUD-STAT-CDE = 'F' OR                     09618000
096190               SUT00015-AUD-STAT-CDE = 'P')                       09619000
096200             MOVE PC-AUDIT-NO-LONGER-NEEDED-MSG                   09620000
096300                                     TO AMSGLNO                   09630000
096400             IF ( SUT00015-AUD-STAT-CDE = 'N' )                   09640000
096500               PERFORM 3250-LINK-COMMON-CARTON-CLOSE              09650000
096600             END-IF                                               09660000
096700             PERFORM 8100-SEND-DATA-ONLY                          09670000
096800             PERFORM 8200-RETURN-TRANID                           09680000
096900           ELSE                                                   09690000
097000*** QC AUDIT CLOSED ON COMBO- SWITCHING TO RF ONLY                09700000
097100             SET SU006-RFID-AUDIT    TO TRUE                      09710000
097200             SET SU006-RFID-AUD-ONLY TO TRUE                      09720000
097300             SET SU006-NO-AUD-ERR    TO TRUE                      09730000
097400             MOVE PC-QC-AUD-CPLTE TO AMSGLNO                      09740000
097500             MOVE SU006-RFID-AUDIT-CNTL-NBR TO                    09750000
097600                  SU006-AUDIT-CNTL-NBR                            09760000
097700             MOVE ZERO TO SU006-RFID-AUDIT-CNTL-NBR               09770000
097800           END-IF                                                 09780000
097900         ELSE                                                     09790000
098000***RLK 04/14 BEG                                                  09800000
098100          IF PS-SYSTEM-AUDIT-FOUND                                09810000
098200           IF SU006-RFID-AUD-ONLY                                 09820000
098300             SET PS-QC-AUDIT-NOT-EXISTS TO TRUE                   09830000
098400             PERFORM 3300-CHECK-FOR-OPEN-QC-AUDIT                 09840000
098500             IF PS-QC-AUDIT-EXISTS                                09850000
098600*** RFID AUDIT CLOSED AND OPEN QC AUDIT EXISTS, CONVERT TO QC AUD 09860000
098700               SET SU006-QC-AUDIT TO TRUE                         09870000
098800               SET SU006-QC-AUD-ONLY TO TRUE                      09880000
098900               MOVE SUT00015-AUD-CNTL-NBR TO SU006-AUDIT-CNTL-NBR 09890000
099000             ELSE                                                 09900000
099100               MOVE PC-AUDIT-NO-LONGER-NEEDED-MSG                 09910000
099200                                       TO AMSGLNO                 09920000
099300               IF ( SUT00015-AUD-STAT-CDE = 'N' )                 09930000
099400                 PERFORM 3250-LINK-COMMON-CARTON-CLOSE            09940000
099500               END-IF                                             09950000
099600               PERFORM 8100-SEND-DATA-ONLY                        09960000
099700               PERFORM 8200-RETURN-TRANID                         09970000
099800             END-IF                                               09980000
099900           ELSE                                                   09990000
100000            IF SU006-QC-AND-RFID-AUD                              10000000
100100*** THIS IS A COMBO AUDIT WHERE THE QC IS OPEN AND THE RFID IS    10010000
100200*** CLOSED, SO, CONVERT TO QC ONLY                                10020000
100300             MOVE SU006-RFID-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR  10030000
100400             PERFORM 3200-SELECT-AUDIT                            10040000
100500             IF (SUT00015-AUD-STAT-CDE = 'N' OR                   10050000
100600               SUT00015-AUD-STAT-CDE = 'F' OR                     10060000
100700               SUT00015-AUD-STAT-CDE = 'P')                       10070000
100800               SET SU006-QC-AUDIT TO TRUE                         10080000
100900               SET SU006-QC-AUD-ONLY TO TRUE                      10090000
101000               MOVE ZERO TO SU006-RFID-AUDIT-CNTL-NBR             10100000
101100               MOVE SUT00015-AUD-CNTL-NBR TO SU006-AUDIT-CNTL-NBR 10110000
101200               MOVE ZERO TO SU006-RFID-AUDIT-CNTL-NBR             10120000
101300             END-IF                                               10130000
101310            END-IF                                                10131000
101311           END-IF                                                 10131100
101312***RLK 04/14 END                                                  10131200
101313       END-IF                                                     10131300
101314     END-IF.                                                      10131400
101315                                                                  10131500
101316                                                                  10131600
101317*    IF NEEDED, GET DEFAULT PRINTER ID                            10131700
101318     IF SU006-PRINTER-DEST = SPACES                               10131800
101319         PERFORM 1400-GET-PRINTER-IDS                             10131900
101320     END-IF.                                                      10132000
101330                                                                  10133000
101340*  IF YOU HAVE A PBS ERROR STOP THE ASSOCIATE, KEEP DISPLAYING    10134000
101350*  ERROR, IF THEY SCAN A DIFFERENT CARTON RUN THROUGH THE EDITS   10135000
101360*  AGAIN                                                          10136000
101370     IF CA-PBS-ASN-ERROR-EXISTS                                   10137000
101380        IF PV-CTN > SPACES                                        10138000
101390           CONTINUE                                               10139000
101400        ELSE                                                      10140000
101500           MOVE SU006-SHIP-UNIT-NBR  TO PV-CTN                    10150000
101600        END-IF                                                    10160000
101700        MOVE SPACES TO CA-PBS-ERROR-IND                           10170000
101800     END-IF                                                       10180000
101900                                                                  10190000
102000                                                                  10200000
102100*    VALIDATE THE PO NUMBER THAT WAS ENTERED (IF ANY)             10210000
102200     IF PV-PO > SPACES                                            10220000
102300        MOVE PV-PO TO DK-PO-NBR                                   10230000
102400        IF DK-PO-NBR > ZEROES                                     10240000
102500            MOVE PV-PO             TO DP010I-UNEDITED-FIELD       10250000
102600            MOVE LENGTH OF PV-PO   TO DP010I-MAXIMUM-DIGITS       10260000
102700            MOVE ZERO              TO DP010I-MAXIMUM-DECIMALS     10270000
102800            SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE               10280000
102900                                                                  10290000
103010            CALL DP010I-NUMERIC-EDIT-ROUTINE                      10301011
103020                 USING DP010I-NUMERIC-EDIT-AREA                   10302011
103100                                                                  10310000
103200            IF  DP010I-ERROR-DETECTED                             10320000
103300                MOVE -1                  TO APOL                  10330000
103400                MOVE PC-PO-NOT-NUMERIC                            10340000
103500                                         TO AMSGLNO               10350000
103600                PERFORM 8100-SEND-DATA-ONLY                       10360000
103700                PERFORM 8200-RETURN-TRANID                        10370000
103800            ELSE                                                  10380000
103900                MOVE DP010I-NUMERIC-FIELD TO SU006-PO DK-PO-NBR   10390000
104000                PERFORM  2200-SELECT-PO                           10400000
104100            END-IF                                                10410000
104200        ELSE                                                      10420000
104300            MOVE -1                  TO APOL                      10430000
104400            MOVE PC-PO-REQUIRED TO AMSGLNO                        10440000
104500            PERFORM 8100-SEND-DATA-ONLY                           10450000
104600            PERFORM 8200-RETURN-TRANID                            10460000
104700        END-IF                                                    10470000
104800     END-IF.                                                      10480000
104900                                                                  10490000
105000*    VALIDATE THE STORE NUMBER THAT WAS ENTERED                   10500000
105100     IF PV-STORE > SPACES                                         10510000
105200         MOVE PV-STORE             TO DP010I-UNEDITED-FIELD       10520000
105300         MOVE LENGTH OF PV-STORE   TO DP010I-MAXIMUM-DIGITS       10530000
105400         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     10540000
105500         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  10550000
105610         CALL DP010I-NUMERIC-EDIT-ROUTINE                         10561011
105620              USING DP010I-NUMERIC-EDIT-AREA                      10562011
105700         IF  DP010I-ERROR-DETECTED                                10570000
105800             MOVE -1                     TO ASTRL                 10580000
105900             MOVE PC-STORE-NOT-NUMERIC   TO AMSGLNO               10590000
106000             PERFORM 8100-SEND-DATA-ONLY                          10600000
106100             PERFORM 8200-RETURN-TRANID                           10610000
106200         ELSE                                                     10620000
106300             MOVE DP010I-NUMERIC-FIELD TO SU006-STORE             10630000
106400         END-IF                                                   10640000
106500     END-IF.                                                      10650000
106600                                                                  10660000
106700     IF CA-NON-SYST-PRMPTD-CRTN                                   10670000
106800         MOVE PC-NON-SYS-AUD-CRTN-MSG TO AMSGLNO                  10680000
106900         MOVE -1                      TO ACARTNL                  10690000
107000         PERFORM 8100-SEND-DATA-ONLY                              10700000
107100         PERFORM 8200-RETURN-TRANID                               10710000
107200     END-IF.                                                      10720000
107300                                                                  10730000
107400**************************************************************    10740000
107500* EDIT THE CARTON NUMBER TO MAKE SURE IT IS A VALID VALUE    *    10750000
107600**************************************************************    10760000
107700 1310-EDIT-CARTON-NUMBER.                                         10770000
107800*    EDIT THE CARTON NUMBER -- FIRST DETERMINE IF THE NUMBER OF   10780000
107900*    CHARCTERS ENTERD WAS CORRECT                                 10790000
108000     MOVE 0 TO PV-CHAR-COUNT                                      10800000
108100     INSPECT PV-CTN TALLYING PV-CHAR-COUNT FOR CHARACTERS         10810000
108200                    BEFORE INITIAL SPACE                          10820000
108300     EVALUATE TRUE                                                10830000
108400       WHEN PV-CTN = SPACES                                       10840000
108500           MOVE -1                     TO ACARTNL                 10850000
108600           MOVE PC-PLS-ENT-FLD-MSG     TO AMSGLNO                 10860000
108700           PERFORM 8100-SEND-DATA-ONLY                            10870000
108800           PERFORM 8200-RETURN-TRANID                             10880000
108900*      WHEN PV-CHAR-COUNT = PC-18 AND                             10890000
109000*         ((PV-CTN-FIRST-DIGIT NOT =  PC-0) AND                   10900000
109100*          (PV-CTN-FIRST-DIGIT NOT =  PC-4) AND                   10910000
109200*          (PV-CTN-FIRST-DIGIT NOT =  PC-5))                      10920000
109300*          MOVE -1                     TO ACARTNL                 10930000
109400*          MOVE PC-FIRST-1-NOT-0-MSG   TO AMSGLNO                 10940000
109500*          PERFORM 8100-SEND-DATA-ONLY                            10950000
109600*          PERFORM 8200-RETURN-TRANID                             10960000
109700       WHEN PV-CHAR-COUNT < PC-18                                 10970000
109800           MOVE -1                     TO ACARTNL                 10980000
109900           MOVE PC-MORE-DIGITS-REQD    TO AMSGLNO                 10990000
110000           PERFORM 8100-SEND-DATA-ONLY                            11000000
110100           PERFORM 8200-RETURN-TRANID                             11010000
110200     END-EVALUATE.                                                11020000
110300                                                                  11030000
110400*    THE DETERMINE IF THE NUMBER WAS NUMERIC                      11040000
110500     SET DP010I-NEGATIVE-NOT-ALLOWED                              11050000
110600         PS-NOT-SCANNED-DATA         TO TRUE.                     11060000
110700                                                                  11070000
110800     IF PV-CHAR-COUNT = PC-18                                     11080000
110900        MOVE PV-CTN-LAST-17          TO DP010I-UNEDITED-FIELD     11090000
111000     ELSE                                                         11100000
111100         IF PV-CHAR-COUNT < PC-18                                 11110000
111200            MOVE PV-CTN              TO DP010I-UNEDITED-FIELD     11120000
111300         ELSE                                                     11130000
111400            MOVE PV-CTN-SCAN-LAST-17 TO DP010I-UNEDITED-FIELD     11140000
111500            SET PS-SCANNED-DATA      TO TRUE                      11150000
111600         END-IF                                                   11160000
111700     END-IF.                                                      11170000
111800                                                                  11180000
111900     MOVE 17                         TO DP010I-MAXIMUM-DIGITS.    11190000
112000     MOVE 0                          TO DP010I-MAXIMUM-DECIMALS.  11200000
112100                                                                  11210000
112210     CALL DP010I-NUMERIC-EDIT-ROUTINE                             11221011
112220          USING DP010I-NUMERIC-EDIT-AREA.                         11222011
112300                                                                  11230000
112301*                                                                 11230105
112302* ENSURE FIRST DIGIT IS ALSO NUMERIC                              11230205
112303*                                                                 11230305
112306     IF  PV-CHAR-COUNT < PC-18                                    11230605
112307         CONTINUE                                                 11230705
112308     ELSE                                                         11230805
112309         IF  PV-CHAR-COUNT = PC-18                                11230905
112310             MOVE PV-CTN-FIRST-DIGIT TO PV-CTN-SNGL-DGIT-CHECK    11231009
112311             IF  PV-SNGL-DGIT-VALID                               11231109
112320                 CONTINUE                                         11232005
112321             ELSE                                                 11232105
112322                 SET DP010I-ERROR-DETECTED  TO  TRUE              11232207
112323             END-IF                                               11232305
112324         ELSE                                                     11232405
112325             IF  PV-CHAR-COUNT = PC-20                            11232505
112326                 MOVE PV-CTN-SCAN-THIRD-DGT                       11232609
112327                                     TO PV-CTN-SNGL-DGIT-CHECK    11232709
112328                 IF  PV-SNGL-DGIT-VALID                           11232809
112329                     CONTINUE                                     11232909
112330                 ELSE                                             11233009
112331                     SET DP010I-ERROR-DETECTED  TO  TRUE          11233109
112332                 END-IF                                           11233209
112333             END-IF                                               11233309
112334         END-IF                                                   11233409
112335     END-IF.                                                      11233509
112336                                                                  11233609
112340*                                                                 11234005
112350*                                                                 11235005
112400     IF  DP010I-ERROR-DETECTED                                    11240000
112500         MOVE -1                     TO ACARTNL                   11250000
112600         MOVE PC-MUST-BE-NUM-MSG     TO AMSGLNO                   11260000
112700         PERFORM 8100-SEND-DATA-ONLY                              11270000
112800         PERFORM 8200-RETURN-TRANID                               11280000
112900     ELSE                                                         11290000
113000         IF DP010I-NUMERIC-FIELD = ZEROES                         11300000
113100             MOVE -1                  TO ACARTNL                  11310000
113200             MOVE PC-MUST-BE-GT-0-MSG TO AMSGLNO                  11320000
113300             PERFORM 8100-SEND-DATA-ONLY                          11330000
113400             PERFORM 8200-RETURN-TRANID                           11340000
113500         ELSE                                                     11350000
113600             COMPUTE SU006-SHIP-UNIT-NBR ROUNDED =                11360000
113700                  DP010I-NUM-FIELD-17-DIG-0-DEC * 1               11370000
113800                    EVALUATE TRUE                                 11380000
113900                      WHEN PV-CHAR-COUNT = PC-20                  11390000
114000                         MOVE PV-CTN-SCAN-LAST-18 TO              11400000
114100                                          SU006-SHIP-UNIT-NBR-X   11410000
114200                      WHEN PV-CHAR-COUNT = PC-18                  11420000
114300                         MOVE PV-CTN  TO SU006-SHIP-UNIT-NBR      11430000
114400                     END-EVALUATE                                 11440000
114500             MOVE SU006-SHIP-UNIT-NBR-X  TO ACARTNO               11450000
114600         END-IF                                                   11460000
114700     END-IF.                                                      11470000
114800                                                                  11480000
114900                                                                  11490000
115000*                                                                 11500000
115100**************************************************************    11510000
115200*1320-VERIFY-CARTON-NUMBER. *                                     11520000
115300* VERIFY THE CARTON NUMBER THAT WAS ENTERED ACTUALLY EXISTS  *    11530000
115400**************************************************************    11540000
115500 1320-VERIFY-CARTON-NUMBER.                                       11550000
115600     PERFORM 2240-CHECK-TABLES.                                   11560000
115700                                                                  11570000
115800*GB 1/9/01                                                        11580000
115900*    FOR A SYSTEM PROMPTED AUDIT, THE ASSOCIATE MAY ONLY AUDIT    11590000
116000*    SYSTEM SELECTED CARTONS, IF THE SYSTEM AUDIT/CARTON          11600000
116100*    COMBINATION IS NOT VALID, THEY WILL NOT BE ABLE TO AUDIT     11610000
116200*    THE SCANNED CARTON.                                          11620000
116300     SET CA-SYST-PRMPTD-CRTN TO TRUE.                             11630000
116400     IF PS-SYSTEM-AUDIT-FOUND                                     11640000
116500        PERFORM 2285-VERIFY-SYSTM-PRMPTD-CRTN                     11650000
116600     END-IF.                                                      11660000
116700*                                                                 11670000
116800     IF CA-NON-SYST-PRMPTD-CRTN                                   11680000
116900         MOVE PC-NON-SYS-AUD-CRTN-MSG TO AMSGLNO                  11690000
117000         MOVE -1                      TO ACARTNL                  11700000
117100         PERFORM 8100-SEND-DATA-ONLY                              11710000
117200         PERFORM 8200-RETURN-TRANID                               11720000
117300     END-IF.                                                      11730000
117400                                                                  11740000
117500*GB 1/9/01                                                        11750000
117600                                                                  11760000
117700*    IF THE CARTON WAS FOUND, CHECK FOR MISDIRECT                 11770000
117800*    IF THE OPERATING UNIT ID OF THE SHIPPING UNIT IS EQUAL       11780000
117900*    TO THE CURRENT OPER UNIT ID, OR IF IS ALREADY FLAGGED AS     11790000
118000*    A MISDIRECT, MOVE THE FIELDS AND CONTINUE ON...IF THEY ARE   11800000
118100*    DIFFERENT, AND IT ISN'T A MISDIRECT YET (A MESSAGE HASN'T    11810000
118200*    BEEN DISPLAYED), SET THE MISDIRECT FLAG, AND GO ON TO THE    11820000
118300*    MESSAGE SCREEN                                               11830000
118400     IF CA-CARTON-FOUND                                           11840000
118500         IF RECEIV-PACK-BY-ST-IND  =  'Y' OR                      11850000
118600           SHPUNT-ORGN-OPER-UNT-ID =  SU006-OPER-UNT-ID           11860000
118700           OR SU006-MISDIRECT                                     11870000
118800             MOVE SU006-PO                TO PV-PO-N              11880000
118900             MOVE PV-PO                   TO APOO                 11890000
119000             IF CA-CART-LBL-TYP-CDE = PC-P                        11900000
119100                MOVE  'P2L'               TO ASTRO                11910000
119200             ELSE                                                 11920000
119300                MOVE SU006-STORE          TO PV-STORE-N           11930000
119400                MOVE PV-STORE             TO ASTRO                11940000
119500             END-IF                                               11950000
119600             MOVE SU006-SHIP-UNIT-NBR     TO ACARTNO              11960000
119700             MOVE SU006-REC-SEQ-NBR       TO PV-REC-SEQ-NBR       11970000
119800             MOVE PV-REC-SEQ-NBR          TO ARCVRO               11980000
119900             MOVE PC-PF-MATCH-PF-KEY-MSG  TO APFKO                11990000
120000         ELSE                                                     12000000
120100             SET SU006-MISDIRECT          TO TRUE                 12010000
120200             MOVE 1                       TO SU006-PGM-MSG-NBR    12020000
120300             MOVE PC-MESSAGE-PROGRAM      TO PV-TRANSFER-PROGRAM  12030000
120400             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                12040000
120500         END-IF                                                   12050000
120600     ELSE                                                         12060000
120700         IF CA-PBS-ASN-ERROR-EXISTS                               12070000
120800             MOVE PC-PBS-ERROR-CARTON-MSG TO AMSGLNO              12080000
120900             MOVE -1                      TO ACARTNL              12090000
121000             PERFORM 8100-SEND-DATA-ONLY                          12100000
121100             PERFORM 8200-RETURN-TRANID                           12110000
121200         ELSE                                                     12120000
121300             PERFORM 3000-VALIDATE-CHECK-DIGIT                    12130000
121400             IF PS-INVALID-CHECK-DIGIT                            12140000
121500                MOVE PC-INVALID-CHECK-DIGIT  TO AMSGLNO           12150000
121600                MOVE -1                      TO ACARTNL           12160000
121700                PERFORM 8100-SEND-DATA-ONLY                       12170000
121800                PERFORM 8200-RETURN-TRANID                        12180000
121900             END-IF                                               12190000
122000         END-IF                                                   12200000
122100     END-IF.                                                      12210000
122200/                                                                 12220000
122300 1400-GET-PRINTER-IDS.                                            12230000
122400     PERFORM 1500-SELECT-PRINTER-IDS.                             12240000
122500                                                                  12250000
122600     EVALUATE TRUE                                                12260000
122700       WHEN  SU006-RECV-PRCS-AREA                                 12270000
122800           MOVE COCNTL-CA-RCVG-PRTR-ID                            12280000
122900                                  TO SU006-PRINTER-DEST           12290000
123000       WHEN  SU006-FLAT-PRCS-AREA                                 12300000
123100           MOVE COCNTL-CA-FLAT-PRTR-ID                            12310000
123200                                  TO SU006-PRINTER-DEST           12320000
123300       WHEN  SU006-SHIP-PRCS-AREA                                 12330000
123400           MOVE COCNTL-CA-SHIP-PRTR-ID                            12340000
123500                                  TO SU006-PRINTER-DEST           12350000
123600     END-EVALUATE.                                                12360000
123700                                                                  12370000
123800                                                                  12380000
123900******************************************************************12390000
124000* 1500-SELECT-PRINTER-IDS.                                       *12400000
124100*    SELECT THE DEFAULT PROCESSING AREA PRINTER, AND THE DEFAULT *12410000
124200* LOGISTICS PRINTER FROM THE COMPANY CONTROL TABLE               *12420000
124300* THERE ARE DEFAULTS FOR EACH AUDITING PROCESS AREA & LOGISTICS  *12430000
124400* WITHIN EACH FACILITY.  SELECT OF ALL FOUR ID'S FOR THE GIVEN   *12440000
124500* OPER UNIT ID AND THEN DETERMINE WHICH TO DISPLAY.              *12450000
124600******************************************************************12460000
124700 1500-SELECT-PRINTER-IDS.                                         12470000
124800                                                                  12480000
124900     MOVE SU006-OPER-UNT-ID     TO DK-OPER-UNT-ID.                12490000
125000                                                                  12500000
125100     EXEC SQL                                                     12510000
125200            SELECT                                                12520000
125300                    CA_RCVG_PRTR_ID                               12530000
125400                   ,CA_FLAT_PRTR_ID                               12540000
125500                   ,CA_SHIP_PRTR_ID                               12550000
125600                   ,CA_LGS_PRTR_ID                                12560000
125700            INTO                                                  12570000
125800                   :COCNTL-CA-RCVG-PRTR-ID                        12580000
125900                  ,:COCNTL-CA-FLAT-PRTR-ID                        12590000
126000                  ,:COCNTL-CA-SHIP-PRTR-ID                        12600000
126100                  ,:COCNTL-CA-LGS-PRTR-ID                         12610000
126200            FROM                                                  12620000
126300                    TCOCNTL                                       12630000
126400            WHERE                                                 12640000
126500                  OPER_UNT_ID     = :DK-OPER-UNT-ID               12650000
126600              AND FCLTY_ID        = 1                             12660000
126700     END-EXEC.                                                    12670000
126800                                                                  12680000
126900     IF SQLCODE = ZERO                                            12690000
127000         CONTINUE                                                 12700000
127100     ELSE                                                         12710000
127200             MOVE '1500-SELECT-PRINTER-IDS'                       12720000
127300                                         TO DP013-PARAGRAPH       12730000
127400             MOVE 'SELECT OF TCOCNTL'    TO DP013-MESSAGE-TEXT (1)12740000
127500             MOVE DK-OPER-UNT-ID         TO DP013-MESSAGE-TEXT (2)12750000
127600             MOVE SQLCA                  TO DP013-SQLCA           12760000
127700             MOVE 'TCOCNTL'            TO DP013-DB2-TABLE-NAME (1)12770000
127800             SET DP013-DB2-ABEND         TO TRUE                  12780000
127900             SET DP013-NO-ROLLBACK       TO TRUE                  12790000
128000             PERFORM 9999-WRITE-CICS-LOG-MSG                      12800000
128100                                                                  12810000
128200             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               12820000
128300              SET SU006-PROCESS-SCREEN TO TRUE                    12830000
128400             PERFORM 8100-SEND-DATA-ONLY                          12840000
128500             PERFORM 8200-RETURN-TRANID                           12850000
128600                                                                  12860000
128700     END-IF.                                                      12870000
128800                                                                  12880000
128900 1600-HELP-SCREEN.                                                12890000
129000     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      12900000
129100     MOVE 'SUKRF511'                  TO PC192-PROGRAM-NAME       12910000
129200     COPY PCPD188.                                                12920000
129300     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      12930000
129400     PERFORM 4200-XCTL-TO-HELP.                                   12940000
129500                                                                  12950000
129600                                                                  12960000
129700*                                                                 12970000
129800 2100-XCTL-TO-SELECTED-PROGRAM.                                   12980000
129900     SET SU006-INITIALIZE-SCREEN   TO  TRUE.                      12990000
130000     MOVE LENGTH OF CA-COMMAREA    TO  PV-COMMAREA-LENGTH.        13000000
130100     MOVE PC-CURRENT-PROGRAM-NAME  TO  SU006-LAST-PROGRAM.        13010000
130200                                                                  13020000
130300     EXEC CICS                                                    13030000
130400         XCTL                                                     13040000
130500             PROGRAM   (PV-TRANSFER-PROGRAM)                      13050000
130600             COMMAREA  (CA-COMMAREA)                              13060000
130700             LENGTH    (PV-COMMAREA-LENGTH)                       13070000
130800             RESP      (PV-CICS-RESPONSE)                         13080000
130900     END-EXEC.                                                    13090000
131000                                                                  13100000
131100     EVALUATE TRUE                                                13110000
131200         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 13120000
131300              CONTINUE                                            13130000
131400         WHEN OTHER                                               13140000
131500              MOVE '2100-XCTL-TO-SELECTED-PROGRAM'                13150000
131600                                     TO DP013-PARAGRAPH           13160000
131700              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       13170000
131800                                     TO DP013-MESSAGE-TEXT (1)    13180000
131900              MOVE PV-TRANSFER-PROGRAM                            13190000
132000                                     TO DP013-MESSAGE-TEXT (2)    13200000
132100              SET DP013-CICS-ABEND   TO TRUE                      13210000
132200              SET DP013-NO-ROLLBACK  TO TRUE                      13220000
132300              PERFORM 9999-WRITE-CICS-LOG-MSG                     13230000
132400              MOVE PM-TRANS-NOT-AVAILABLE-MSG                     13240000
132500                                     TO AMSGLNO                   13250000
132600              SET SU006-PROCESS-SCREEN TO TRUE                    13260000
132700              PERFORM 8100-SEND-DATA-ONLY                         13270000
132800              PERFORM 8200-RETURN-TRANID                          13280000
132900     END-EVALUATE.                                                13290000
133000                                                                  13300000
133100 2150-XCTL-TO-SELECTED-PROGRAM.                                   13310000
133200     SET SU001-INITIALIZE-SCREEN   TO  TRUE.                      13320000
133300     MOVE LENGTH OF SU001-COMMON-DATA TO  PV-COMMAREA-LENGTH.     13330000
133400     MOVE PC-CURRENT-PROGRAM-NAME  TO  SU001-LAST-PROGRAM.        13340000
133500                                                                  13350000
133600     EXEC CICS                                                    13360000
133700         XCTL                                                     13370000
133800             PROGRAM   (PV-TRANSFER-PROGRAM)                      13380000
133900             COMMAREA  (SU001-COMMON-DATA)                        13390000
134000             LENGTH    (PV-COMMAREA-LENGTH)                       13400000
134100             RESP      (PV-CICS-RESPONSE)                         13410000
134200     END-EXEC.                                                    13420000
134300                                                                  13430000
134400     EVALUATE TRUE                                                13440000
134500         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 13450000
134600              CONTINUE                                            13460000
134700         WHEN OTHER                                               13470000
134800              MOVE '2150-XCTL-TO-SELECTED-PROGRAM'                13480000
134900                                     TO DP013-PARAGRAPH           13490000
135000              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       13500000
135100                                     TO DP013-MESSAGE-TEXT (1)    13510000
135200              MOVE PV-TRANSFER-PROGRAM                            13520000
135300                                     TO DP013-MESSAGE-TEXT (2)    13530000
135400              MOVE 'SUKRF511'        TO  SU006-LAST-PROGRAM       13540000
135500              SET DP013-CICS-ABEND   TO TRUE                      13550000
135600              SET DP013-NO-ROLLBACK  TO TRUE                      13560000
135700              PERFORM 9999-WRITE-CICS-LOG-MSG                     13570000
135800              MOVE PM-TRANS-NOT-AVAILABLE-MSG                     13580000
135900                                     TO AMSGLNO                   13590000
136000              SET SU006-PROCESS-SCREEN TO TRUE                    13600000
136100              PERFORM 8100-SEND-DATA-ONLY                         13610000
136200              PERFORM 8200-RETURN-TRANID                          13620000
136300     END-EVALUATE.                                                13630000
136400                                                                  13640000
136500 2200-SELECT-PO.                                                  13650000
136600     EXEC SQL                                                     13660000
136700          SELECT PO_NBR                                           13670000
136800* 12/05/13 JHA  BEG                                               13680000
136900                ,DEPT_NBR                                         13690000
137000                ,ENT_ID                                           13700000
137100                ,PO_TYP_CDE                                       13710000
137200* 12/05/13 JHA  END                                               13720000
137300          INTO   :PURCHS-PO-NBR                                   13730000
137400* 12/05/13 JHA  BEG                                               13740000
137500                ,:PURCHS-DEPT-NBR                                 13750000
137600                ,:PURCHS-ENT-ID                                   13760000
137700                ,:PURCHS-PO-TYP-CDE                               13770000
137800* 12/05/13 JHA  END                                               13780000
137900          FROM  TPURCHS                                           13790000
138000          WHERE PO_NBR         = :DK-PO-NBR                       13800000
138100            AND VER_STATUS_CDE = 'A'                              13810000
138200     END-EXEC                                                     13820000
138300                                                                  13830000
138400     EVALUATE TRUE                                                13840000
138500         WHEN SQLCODE = +0                                        13850000
138600             CONTINUE                                             13860000
138700         WHEN SQLCODE = +100                                      13870000
138800             MOVE DP015-UNP-ALP-BRT-MDT  TO APOA                  13880000
138900             MOVE -1                     TO APOL                  13890000
139000             MOVE PC-INVALID-PO          TO AMSGLNO               13900000
139100             PERFORM 8100-SEND-DATA-ONLY                          13910000
139200             PERFORM 8200-RETURN-TRANID                           13920000
139300                                                                  13930000
139400         WHEN SQLWARN0 NOT = SPACES                               13940000
139500         WHEN SQLCODE NOT EQUAL ZERO                              13950000
139600             MOVE '2200-SELECT-PO'                                13960000
139700                             TO DP013-PARAGRAPH                   13970000
139800             MOVE 'CHECK VALID PO'                                13980000
139900                             TO DP013-MESSAGE-TEXT(1)             13990000
140000             MOVE PV-STORE                                        14000000
140100                             TO DP013-MESSAGE-TEXT(2)             14010000
140200             MOVE SQLCA      TO DP013-SQLCA                       14020000
140300             MOVE 'TPURCHS'  TO DP013-DB2-TABLE-NAME(1)           14030000
140400             SET DP013-DB2-ABEND                                  14040000
140500                             TO TRUE                              14050000
140600             SET DP013-NO-ROLLBACK                                14060000
140700                             TO TRUE                              14070000
140800             SET DP013-XCTL-DISPLAY-RESTART                       14080000
140900                             TO TRUE                              14090000
141000             PERFORM DP014-0000-PROCESS-ABEND                     14100000
141100                                                                  14110000
141200     END-EVALUATE.                                                14120000
141300                                                                  14130000
141400***RLK 04/14-1 BEG                                                14140000
141500 2210-CHECK-FOR-ECOM.                                             14150000
141600     EXEC SQL                                                     14160000
141700          SELECT  'Y'                                             14170000
141800          INTO   :PS-ECOM-IND                                     14180000
141900          FROM XLT_LOC A                                          14190000
142000          WHERE A.LOC_NBR     = :DK-STORE                         14200000
142100            AND A.E_BUS_IND   = 'Y'                               14210000
142200     END-EXEC                                                     14220000
142300                                                                  14230000
142400     EVALUATE TRUE                                                14240000
142500         WHEN SQLCODE = +0                                        14250000
142600             MOVE 'Y' TO PS-ECOM-IND                              14260000
142700         WHEN SQLCODE = +100                                      14270000
142800             MOVE 'N' TO PS-ECOM-IND                              14280000
142900                                                                  14290000
143000         WHEN SQLWARN0 NOT = SPACES                               14300000
143100         WHEN SQLCODE NOT EQUAL ZERO                              14310000
143200             MOVE '2210-CHECK-FOR-ECOM'                           14320000
143300                             TO DP013-PARAGRAPH                   14330000
143400             MOVE 'CHECK FOR ECOM'                                14340000
143500                             TO DP013-MESSAGE-TEXT(1)             14350000
143510             MOVE DK-STORE                                        14351000
143520                             TO DP013-MESSAGE-TEXT(2)             14352000
143530             MOVE SQLCA      TO DP013-SQLCA                       14353000
143540             MOVE 'XLT_LOC'  TO DP013-DB2-TABLE-NAME(1)           14354000
143550             SET DP013-DB2-ABEND                                  14355000
143560                             TO TRUE                              14356000
143570             SET DP013-NO-ROLLBACK                                14357000
143580                             TO TRUE                              14358000
143590             SET DP013-XCTL-DISPLAY-RESTART                       14359000
143600                             TO TRUE                              14360000
143610             PERFORM DP014-0000-PROCESS-ABEND                     14361000
143611                                                                  14361100
143612     END-EVALUATE.                                                14361200
143613***RLK 04/14-1 END                                                14361300
143614                                                                  14361400
143615***RLK 04/14-2 BEG                                                14361500
143616 2220-CHECK-FOR-RFID-DEPT.                                        14361600
143617     EXEC SQL                                                     14361700
143618          SELECT  'Y'                                             14361800
143619          INTO   :PS-RFID-DEPT-IND                                14361900
143620          FROM RIT_RFID_VRFN A                                    14362000
143621          WHERE RFID_LVL_CDE = 'STRDPT'                           14362100
143622            AND DEPT_NBR     = :DK-DEPT                           14362200
143623            AND (CURRENT TIMESTAMP BETWEEN EFF_STRT_TMST          14362300
143624                AND EFF_END_TMST)                                 14362400
143625          FETCH FIRST ROW ONLY                                    14362500
143626     END-EXEC                                                     14362600
143627                                                                  14362700
143628     EVALUATE TRUE                                                14362800
143629         WHEN SQLCODE = +0                                        14362900
143630         WHEN SQLCODE = -811                                      14363000
143631             MOVE 'Y' TO PS-RFID-DEPT-IND                         14363100
143632         WHEN SQLCODE = +100                                      14363200
143633             MOVE 'N' TO PS-RFID-DEPT-IND                         14363300
143634                                                                  14363400
143635         WHEN SQLWARN0 NOT = SPACES                               14363500
143636         WHEN SQLCODE NOT EQUAL ZERO                              14363600
143637             MOVE '2220-CHECK-FOR-RFID-DEPT'                      14363700
143638                             TO DP013-PARAGRAPH                   14363800
143639             MOVE 'CHECK FOR RFID DEPT'                           14363900
143640                             TO DP013-MESSAGE-TEXT(1)             14364000
143641             MOVE DK-DEPT                                         14364100
143642                             TO DP013-MESSAGE-TEXT(2)             14364200
143643             MOVE SQLCA      TO DP013-SQLCA                       14364300
143644             MOVE 'RIT_RFID_VRFN'  TO DP013-DB2-TABLE-NAME(1)     14364400
143645             SET DP013-DB2-ABEND                                  14364500
143646                             TO TRUE                              14364600
143647             SET DP013-NO-ROLLBACK                                14364700
143648                             TO TRUE                              14364800
143649             SET DP013-XCTL-DISPLAY-RESTART                       14364900
143650                             TO TRUE                              14365000
143651             PERFORM DP014-0000-PROCESS-ABEND                     14365100
143652                                                                  14365200
143653     END-EVALUATE.                                                14365300
143654***RLK 04/14-2 END                                                14365400
143655                                                                  14365500
143656******************************************************************14365600
143657* 2240-CHECK-TABLES                                               14365700
143658*    CHECK THE FOLLOWING TABLES FOR VALIDATION OF THE SHIP UNIT NB14365800
143659*    1. TSUATRN - TO SEE IF AN AUDIT HAS ALREADY BEEN STARTED     14365900
143660*    2. TSHPUNT AND TPKSLIP TO SEE IF THE CARTON ACTUALLY EXISTS  14366000
143661*       AND TO GET THE STORE AND PO NUMBER                        14366100
143662******************************************************************14366200
143663 2240-CHECK-TABLES.                                               14366300
143664***   DISPLAY THE MESSAGE THAT THE 'CARTON IS NOT CHECKED IN'     14366400
143665***   AND OTHER MESSAGES                                          14366500
143666***   ONLY ONCE                                                   14366600
143667     IF SU006-LAST-PROGRAM    = PC-MESSAGE-PROGRAM AND            14366700
143668       (SU006-PGM-MSG-NBR = 22 OR                                 14366800
143669        SU006-PGM-MSG-NBR = 23 OR                                 14366900
143670        SU006-PGM-MSG-NBR = 24)                                   14367000
143680         MOVE CA-SAVE-LAST-PROGRAM                                14368000
143690                                TO SU006-LAST-PROGRAM             14369000
143700         IF SU006-PGM-MSG-NBR = 23                                14370000
143800             SET SU006-MISDIRECT TO TRUE                          14380000
143900         END-IF                                                   14390000
144000     ELSE                                                         14400000
144100         PERFORM 4000-SELECT-SULBXF                               14410000
144200         PERFORM 4100-CHECK-CARTON-ADJ-DC                         14420000
144300         PERFORM 4400-SELECT-SHUNLO-OPER                          14430000
144400         PERFORM 4500-CHECK-CARTON-STATUS                         14440000
144500         IF PS-CARTON-ADJUST-DC                                   14450000
144600             IF PS-OPER-FOUND AND                                 14460000
144700                SHUNLO-OPER-UNT-ID NOT = SU006-OPER-UNT-ID        14470000
144800                 MOVE 23         TO SU006-PGM-MSG-NBR             14480000
144900                 MOVE PC-MESSAGE-PROGRAM                          14490000
145000                                     TO PV-TRANSFER-PROGRAM       14500000
145100                 MOVE SU006-LAST-PROGRAM                          14510000
145200                                     TO CA-SAVE-LAST-PROGRAM      14520000
145300                 PERFORM 2100-XCTL-TO-SELECTED-PROGRAM            14530000
145400             ELSE                                                 14540000
145500               IF PS-NO-OUTBOUND-CARTON                           14550000
145600                   MOVE 22         TO SU006-PGM-MSG-NBR           14560000
145700                   MOVE PC-MESSAGE-PROGRAM                        14570000
145800                                       TO PV-TRANSFER-PROGRAM     14580000
145900                   MOVE SU006-LAST-PROGRAM                        14590000
146000                                       TO CA-SAVE-LAST-PROGRAM    14600000
146100                   PERFORM 2100-XCTL-TO-SELECTED-PROGRAM          14610000
146200               ELSE                                               14620000
146300                   PERFORM 4300-SELECT-OUTBOUND                   14630000
146400                   IF PS-OUTBOUND-FOUND                           14640000
146500                       MOVE PM-CANT-AUD-KOHL-MSG       TO AMSGLNO 14650000
146600                       MOVE -1                         TO ACARTNL 14660000
146700                       PERFORM 8100-SEND-DATA-ONLY                14670000
146800                       PERFORM 8200-RETURN-TRANID                 14680000
146900                   ELSE                                           14690000
147000                       IF PS-BAD-CRTN-STAT                        14700000
147100                           MOVE 24         TO SU006-PGM-MSG-NBR   14710000
147200                           MOVE PC-MESSAGE-PROGRAM                14720000
147300                                       TO PV-TRANSFER-PROGRAM     14730000
147400                           MOVE SU006-LAST-PROGRAM                14740000
147500                                       TO CA-SAVE-LAST-PROGRAM    14750000
147600                           PERFORM 2100-XCTL-TO-SELECTED-PROGRAM  14760000
147700                       END-IF                                     14770000
147800                   END-IF                                         14780000
147900               END-IF                                             14790000
148000             END-IF                                               14800000
148100         END-IF                                                   14810000
148200     END-IF.                                                      14820000
148300                                                                  14830000
148400     MOVE SU006-SHIP-UNIT-NBR  TO SHPUNT-SHIPT-UNT-ID             14840000
148500                                  SUATRN-SHIPT-UNT-ID             14850000
148600                                  SULBXF-SHIPT-UNT-ID.            14860000
148700     MOVE SU006-AUDIT-CNTL-NBR TO SUATRN-AUD-CNTL-NBR             14870000
148800                                  SUT00015-AUD-CNTL-NBR.          14880000
148900                                                                  14890000
149000                                                                  14900000
149100                                                                  14910000
149200*    CHECK IF THE AUDIT ALREADY EXISTS...IF SO, GO ON TO THE      14920000
149300*    CARTON CONTINUATION SCREEN                                   14930000
149400     PERFORM 2260-SELECT-TSUATRN                                  14940000
149500     IF CA-AUDIT-EXISTS                                           14950000
149600         PERFORM 2510-CHECK-IF-STOPPED                            14960000
149700         IF SUATRN-UNT-AUD-STRT-TMST = PC-DB2-NINES-DATE          14970000
149800            CONTINUE                                              14980000
149900         ELSE                                                     14990000
150000            IF SU006-SYSTEM-GENERATED-AUDIT                       15000000
150100               PERFORM 2500-RESTART-AUDIT                         15010000
150200            END-IF                                                15020000
150300*                                                                 15030000
150400            PERFORM 2280-SELECT-PKGNG-CDE                         15040000
150500***RLK 04/14-1 BEG                                                15050000
150600            PERFORM 5000-POPULATE-AUDTYP                          15060000
150700***RLK 04/14-1 END                                                15070000
150800            MOVE PC-CARTON-CONTINUE-PGM   TO PV-TRANSFER-PROGRAM  15080000
150900            PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                 15090000
151000         END-IF                                                   15100000
151100     END-IF.                                                      15110000
151200                                                                  15120000
151300*    CHECK IF THE CARTON EXISTS                                   15130000
151400     SET CA-CARTON-FOUND              TO TRUE                     15140000
151500     PERFORM 2245-SELECT-SHUNLO.                                  15150000
151600     PERFORM 2250-SELECT-SHPUNT.                                  15160000
151700     PERFORM 2255-SELECT-TPKSLIP.                                 15170000
151800                                                                  15180000
151900     PERFORM 2280-SELECT-PKGNG-CDE.                               15190000
152000******************************************************************15200000
152100* 2245-SELECT-SHUNLO                                              15210000
152200*    CHECK IF PBS CARTON FLAGGED FOR ERRORS                       15220000
152300******************************************************************15230000
152400 2245-SELECT-SHUNLO.                                              15240000
152500                                                                  15250000
152600     EXEC SQL                                                     15260000
152700         SELECT A.OPER_UNT_ID                                     15270000
152800         INTO   :SHUNLO-OPER-UNT-ID                               15280000
152900          FROM  TSHUNLO A                                         15290000
153000          WHERE A.SCN_LOC_ID IN                                   15300000
153100                         ('PBSA','PBSB','PBSC','PBSD','PBSE')     15310000
153200           AND  A.SHIPT_UNT_ID  = :SHPUNT-SHIPT-UNT-ID            15320000
153300     END-EXEC.                                                    15330000
153400                                                                  15340000
153500     EVALUATE TRUE                                                15350000
153600         WHEN SQLCODE = ZERO                                      15360000
153700         WHEN SQLCODE = -811                                      15370000
153800              SET CA-CARTON-NOT-FOUND                             15380000
153900                  CA-PBS-ASN-ERROR-EXISTS TO TRUE                 15390000
154000         WHEN SQLCODE = +100                                      15400000
154100              CONTINUE                                            15410000
154200         WHEN SQLWARN0 NOT = SPACES                               15420000
154300         WHEN SQLCODE NOT EQUAL ZERO                              15430000
154400             MOVE '2245-SELECT-SHUNLO'  TO DP013-PARAGRAPH        15440000
154500             MOVE 'CHECK VALID CARTON'  TO DP013-MESSAGE-TEXT(1)  15450000
154600             MOVE SHPUNT-SHIPT-UNT-ID   TO PV-DISPLAY-SHIPT-UNT-ID15460000
154700             MOVE PV-DISPLAY-SHIPT-UNT-ID                         15470000
154800                                        TO DP013-MESSAGE-TEXT(2)  15480000
154900             MOVE SQLCA                 TO DP013-SQLCA            15490000
155000             MOVE 'TSHUNLO'             TO DP013-DB2-TABLE-NAME(1)15500000
155100             SET DP013-DB2-ABEND                                  15510000
155200                 DP013-NO-ROLLBACK       TO TRUE                  15520000
155300             PERFORM 9999-WRITE-CICS-LOG-MSG                      15530000
155400             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               15540000
155500             PERFORM 8100-SEND-DATA-ONLY                          15550000
155600             PERFORM 8200-RETURN-TRANID                           15560000
155700     END-EVALUATE.                                                15570000
155800                                                                  15580000
155900                                                                  15590000
156000******************************************************************15600000
156100* 2250-SELECT-SHPUNT                                              15610000
156200*    GET THE STORE NUMBER FROM THE SHIPPING UNIT TABLE            15620000
156300******************************************************************15630000
156400 2250-SELECT-SHPUNT.                                              15640000
156500                                                                  15650000
156600     EXEC SQL                                                     15660000
156700         SELECT A.DEST_OPER_UNT_ID                                15670000
156800              , A.ORGN_OPER_UNT_ID                                15680000
156900              , A.SHIPT_UNT_ID                                    15690000
157000              , A.ACTV_IND                                        15700000
157100         INTO   :SHPUNT-DEST-OPER-UNT-ID                          15710000
157200              , :SHPUNT-ORGN-OPER-UNT-ID                          15720000
157300              , :SHPUNT-SHIPT-UNT-ID                              15730000
157400              , :SHPUNT-ACTV-IND                                  15740000
157500          FROM  TSHPUNT A                                         15750000
157600          WHERE A.SHIPT_UNT_ID      = :SHPUNT-SHIPT-UNT-ID        15760000
157700     END-EXEC.                                                    15770000
157800                                                                  15780000
157900     EVALUATE TRUE                                                15790000
158000         WHEN SQLCODE = ZERO                                      15800000
158100           IF SHPUNT-ACTV-IND  = 'I'                              15810000
158200              SET CA-CARTON-NOT-FOUND      TO TRUE                15820000
158300              MOVE ZEROS                   TO SU006-STORE         15830000
158400                                              CA-OLD-STORE        15840000
158500           ELSE                                                   15850000
158600               PERFORM 2253-SELECT-SULBXF                         15860000
158700           END-IF                                                 15870000
158800         WHEN SQLCODE = +100                                      15880000
158900              SET CA-CARTON-NOT-FOUND      TO TRUE                15890000
159000              MOVE ZEROS                   TO SU006-STORE         15900000
159100                                              CA-OLD-STORE        15910000
159200         WHEN SQLWARN0 NOT = SPACES                               15920000
159300         WHEN SQLCODE NOT EQUAL ZERO                              15930000
159400             MOVE '2250-SELECT-SHPUNT'  TO DP013-PARAGRAPH        15940000
159500             MOVE 'CHECK VALID CARTON'  TO DP013-MESSAGE-TEXT(1)  15950000
159600             MOVE SHPUNT-SHIPT-UNT-ID   TO DP013-MESSAGE-TEXT(2)  15960000
159700             MOVE SQLCA                 TO DP013-SQLCA            15970000
159800             MOVE 'TSHPUNT'             TO DP013-DB2-TABLE-NAME(1)15980000
159900             SET DP013-DB2-ABEND                                  15990000
160000                 DP013-NO-ROLLBACK       TO TRUE                  16000000
160100             PERFORM 9999-WRITE-CICS-LOG-MSG                      16010000
160200             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               16020000
160300             PERFORM 8100-SEND-DATA-ONLY                          16030000
160400             PERFORM 8200-RETURN-TRANID                           16040000
160500     END-EVALUATE.                                                16050000
160600                                                                  16060000
160700                                                                  16070000
160800******************************************************************16080000
160900* 2253-SELECT-TSULBXF.                                            16090000
161000*    GET THE STORE NUMBER FROM THE CROSS REFERENCE TABLE          16100000
161100*    IF NOT FOUND, USE THE DEST FOUND ON TSHPUNT                  16110000
161200******************************************************************16120000
161300 2253-SELECT-SULBXF.                                              16130000
161400                                                                  16140000
161500     EXEC SQL                                                     16150000
161600         SELECT DEST_OPER_UNT_ID                                  16160000
161700              , CART_LBL_TYP_CDE                                  16170000
161800         INTO   :SULBXF-DEST-OPER-UNT-ID                          16180000
161900              , :SULBXF-CART-LBL-TYP-CDE                          16190000
162000          FROM  TSULBXF                                           16200000
162100          WHERE SHIPT_UNT_ID      = :SULBXF-SHIPT-UNT-ID          16210000
162200           AND  STAT_CDE          = 'A'                           16220000
162300     END-EXEC.                                                    16230000
162400                                                                  16240000
162500     EVALUATE TRUE                                                16250000
162600         WHEN SQLCODE = ZERO                                      16260000
162700              MOVE SULBXF-CART-LBL-TYP-CDE TO                     16270000
162800                                     CA-CART-LBL-TYP-CDE          16280000
162900              MOVE SULBXF-DEST-OPER-UNT-ID TO SU006-STORE         16290000
163000                                              CA-OLD-STORE        16300000
163100         WHEN SQLCODE = -811                                      16310000
163200              MOVE SHPUNT-DEST-OPER-UNT-ID TO SU006-STORE         16320000
163300                                              CA-OLD-STORE        16330000
163400              MOVE SULBXF-CART-LBL-TYP-CDE TO                     16340000
163500                                        CA-CART-LBL-TYP-CDE       16350000
163600         WHEN SQLCODE = +100                                      16360000
163700              MOVE SHPUNT-DEST-OPER-UNT-ID TO SU006-STORE         16370000
163800                                              CA-OLD-STORE        16380000
163900         WHEN SQLWARN0 NOT = SPACES                               16390000
164000         WHEN SQLCODE NOT EQUAL ZERO                              16400000
164100             MOVE '2253-SELECT-SULBXF'  TO DP013-PARAGRAPH        16410000
164200             MOVE 'CHECK VALID CARTON'  TO DP013-MESSAGE-TEXT(1)  16420000
164300             MOVE SHPUNT-SHIPT-UNT-ID   TO DP013-MESSAGE-TEXT(2)  16430000
164400             MOVE SQLCA                 TO DP013-SQLCA            16440000
164500             MOVE 'TSULBXF'             TO DP013-DB2-TABLE-NAME(1)16450000
164600             SET DP013-DB2-ABEND                                  16460000
164700                 DP013-NO-ROLLBACK       TO TRUE                  16470000
164800             PERFORM 9999-WRITE-CICS-LOG-MSG                      16480000
164900             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               16490000
165000             PERFORM 8100-SEND-DATA-ONLY                          16500000
165100             PERFORM 8200-RETURN-TRANID                           16510000
165200     END-EVALUATE.                                                16520000
165300                                                                  16530000
165400                                                                  16540000
165500******************************************************************16550000
165600* 2255-SELECT-TPKSLIP.                                            16560000
165700*    GET THE PO NUMBER FROM THE PACKSLIP TABLE                    16570000
165800******************************************************************16580000
165900 2255-SELECT-TPKSLIP.                                             16590000
166000                                                                  16600000
166100     EXEC SQL                                                     16610000
166200        SELECT  A.PO_NBR                                          16620000
166300              , B.REC_SEQ_NBR                                     16630000
166400          INTO  :INPKSU-PO-NBR                                    16640000
166500              , :PKSLIP-REC-SEQ-NBR                               16650000
166600          FROM  TINPKSU A                                         16660000
166700              , TPKSLIP B                                         16670000
166800          WHERE A.SHIPT_UNT_ID      = :SHPUNT-SHIPT-UNT-ID        16680000
166900            AND A.PO_NBR            = B.PO_NBR                    16690000
167000            AND A.SEQ_NBR           = B.SEQ_NBR                   16700000
167100            AND B.VER_STAT_CDE      = 'A'                         16710000
167200     END-EXEC.                                                    16720000
167300                                                                  16730000
167400     EVALUATE TRUE                                                16740000
167500         WHEN SQLCODE = ZERO                                      16750000
167600              MOVE INPKSU-PO-NBR   TO  SU006-PO                   16760000
167700                                       CA-OLD-PO                  16770000
167800              MOVE PKSLIP-REC-SEQ-NBR                             16780000
167900                                   TO  SU006-REC-SEQ-NBR          16790000
168000         WHEN SQLCODE = +100                                      16800000
168100*LMM                                                              16810000
168200              PERFORM 2275-SELECT-TSHUUPC                         16820000
168300*             SET CA-CARTON-NOT-FOUND       TO TRUE               16830000
168400*             MOVE ZEROS                    TO  SU006-PO          16840000
168500*                                               CA-OLD-PO         16850000
168600*                                               SU006-REC-SEQ-NBR 16860000
168700         WHEN SQLWARN0 NOT = SPACES                               16870000
168800         WHEN SQLCODE NOT EQUAL ZERO                              16880000
168900             MOVE '2255-SELECT-TPKSLIP'                           16890000
169000                             TO DP013-PARAGRAPH                   16900000
169100             MOVE 'CHECK VALID CARTON'                            16910000
169200                             TO DP013-MESSAGE-TEXT(1)             16920000
169300             MOVE SHPUNT-SHIPT-UNT-ID                             16930000
169400                             TO DP013-MESSAGE-TEXT(2)             16940000
169500             MOVE SQLCA      TO DP013-SQLCA                       16950000
169600             MOVE 'TPKSLIP'  TO DP013-DB2-TABLE-NAME(1)           16960000
169700             SET DP013-DB2-ABEND                                  16970000
169800                             TO TRUE                              16980000
169900             SET DP013-NO-ROLLBACK                                16990000
170000                             TO TRUE                              17000000
170100             PERFORM 9999-WRITE-CICS-LOG-MSG                      17010000
170200             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               17020000
170300             PERFORM 8100-SEND-DATA-ONLY                          17030000
170400             PERFORM 8200-RETURN-TRANID                           17040000
170500     END-EVALUATE.                                                17050000
170600                                                                  17060000
170700******************************************************************17070000
170800* 2260-SELECT-TSUATRN.                                            17080000
170900*    CHECK TO SEE IF THE AUDIT HAS ALREADY BEEN STARTED FOR THE   17090000
171000*    SHIPPING UNIT ID THAT WAS ENTERED                            17100000
171100******************************************************************17110000
171200 2260-SELECT-TSUATRN.                                             17120000
171300                                                                  17130000
171400     EXEC SQL                                                     17140000
171500         SELECT AUD_CNTL_NBR                                      17150000
171600               ,SHIPT_UNT_ID                                      17160000
171700               ,UNT_AUD_STRT_TMST                                 17170000
171800               ,UNT_AUD_STP_TMST                                  17180000
171900               ,UNT_PSPND_MNIT_QTY                                17190000
172000               ,UNT_CLO_MNIT_QTY                                  17200000
172100               ,UNT_AUD_USR_ID                                    17210000
172200               ,UNT_AUD_STAT_CDE                                  17220000
172300               ,TRN_NBR                                           17230000
172400               ,REC_SEQ_NBR                                       17240000
172500               ,DEST_OPER_UNT_ID                                  17250000
172600               ,DEST_FCLTY_ID                                     17260000
172700               ,UNT_AUD_ERR_IND                                   17270000
172800         INTO  :SUATRN-AUD-CNTL-NBR                               17280000
172900              ,:SUATRN-SHIPT-UNT-ID                               17290000
173000              ,:SUATRN-UNT-AUD-STRT-TMST                          17300000
173100              ,:SUATRN-UNT-AUD-STP-TMST                           17310000
173200              ,:SUATRN-UNT-PSPND-MNIT-QTY                         17320000
173300              ,:SUATRN-UNT-CLO-MNIT-QTY                           17330000
173400              ,:SUATRN-UNT-AUD-USR-ID                             17340000
173500              ,:SUATRN-UNT-AUD-STAT-CDE                           17350000
173600              ,:SUATRN-TRN-NBR                                    17360000
173700              ,:SUATRN-REC-SEQ-NBR                                17370000
173800              ,:SUATRN-DEST-OPER-UNT-ID                           17380000
173900              ,:SUATRN-DEST-FCLTY-ID                              17390000
174000              ,:SUATRN-UNT-AUD-ERR-IND                            17400000
174100          FROM  TSUATRN                                           17410000
174200          WHERE AUD_CNTL_NBR      = :SUATRN-AUD-CNTL-NBR          17420000
174300            AND SHIPT_UNT_ID      = :SUATRN-SHIPT-UNT-ID          17430000
174400     END-EXEC.                                                    17440000
174500                                                                  17450000
174600     EVALUATE TRUE                                                17460000
174700         WHEN SQLCODE = ZERO                                      17470000
174800              SET CA-AUDIT-EXISTS TO TRUE                         17480000
174900              MOVE SUATRN-UNT-AUD-STAT-CDE                        17490000
175000                                  TO SU006-SHIP-UNIT-STATUS       17500000
175100              MOVE SUATRN-UNT-AUD-ERR-IND                         17510000
175200                                  TO SU006-AUD-ERR-IND            17520000
175300              MOVE SUATRN-DEST-OPER-UNT-ID                        17530000
175400                                  TO SU006-STORE                  17540000
175500              MOVE SUATRN-TRN-NBR TO SU006-PO                     17550000
175600              MOVE SUATRN-REC-SEQ-NBR                             17560000
175700                                  TO SU006-REC-SEQ-NBR            17570000
175800                                                                  17580000
175900         WHEN SQLCODE = +100                                      17590000
176000              SET CA-AUDIT-NOT-EXISTS                             17600000
176100                  SU006-SHIP-UNIT-INPROCESS TO TRUE               17610000
176200                                                                  17620000
176300         WHEN SQLWARN0 NOT = SPACES                               17630000
176400         WHEN SQLCODE NOT EQUAL ZERO                              17640000
176500             MOVE '2260-SELECT-TSUATRN'                           17650000
176600                             TO DP013-PARAGRAPH                   17660000
176700             MOVE 'CHECK VALID CARTON'                            17670000
176800                             TO DP013-MESSAGE-TEXT(1)             17680000
176900             MOVE SUATRN-SHIPT-UNT-ID                             17690000
177000                             TO DP013-MESSAGE-TEXT(2)             17700000
177100             MOVE SQLCA      TO DP013-SQLCA                       17710000
177200             MOVE 'TSUATRN'  TO DP013-DB2-TABLE-NAME(1)           17720000
177300             SET DP013-DB2-ABEND                                  17730000
177400                             TO TRUE                              17740000
177500             SET DP013-NO-ROLLBACK                                17750000
177600                             TO TRUE                              17760000
177700             PERFORM 9999-WRITE-CICS-LOG-MSG                      17770000
177800             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               17780000
177900             PERFORM 8100-SEND-DATA-ONLY                          17790000
178000             PERFORM 8200-RETURN-TRANID                           17800000
178100     END-EVALUATE.                                                17810000
178200                                                                  17820000
178300******************************************************************17830000
178400* 2265-SELECT-TSUATRN-CMB.                                        17840000
178500*    CHECK TO SEE IF THE COMBINED AUDIT HAS ALREADY BEEN STARTED. 17850000
178600******************************************************************17860000
178700 2265-SELECT-TSUATRN-CMB.                                         17870000
178800                                                                  17880000
178900     MOVE SU006-RFID-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR2.        17890000
179000     MOVE SUATRN-SHIPT-UNT-ID       TO DK-SHIPT-UNIT-ID2.         17900000
179100     SET PS-ROW-NOT-FOUND           TO TRUE.                      17910000
179200                                                                  17920000
179300     EXEC SQL                                                     17930000
179400         SELECT UNT_AUD_STRT_TMST                                 17940000
179500           INTO :PV-COMBINED-STRT-TMST                            17950000
179600           FROM TSUATRN                                           17960000
179700          WHERE AUD_CNTL_NBR  = :DK-AUDIT-CNTL-NBR2               17970000
179800            AND SHIPT_UNT_ID  = :DK-SHIPT-UNIT-ID2                17980000
179900     END-EXEC.                                                    17990000
180000                                                                  18000000
180100     EVALUATE TRUE                                                18010000
180200         WHEN SQLCODE = ZERO                                      18020000
180300              SET PS-ROW-FOUND           TO TRUE                  18030000
180400                                                                  18040000
180500         WHEN SQLCODE = +100                                      18050000
180600              CONTINUE                                            18060000
180700                                                                  18070000
180800         WHEN SQLWARN0 NOT = SPACES                               18080000
180900         WHEN SQLCODE NOT EQUAL ZERO                              18090000
181000             MOVE '2265-SELECT-TSUATRN-CMB'                       18100000
181100                             TO DP013-PARAGRAPH                   18110000
181200             MOVE 'CHECK VALID CMB CARTON'                        18120000
181300                             TO DP013-MESSAGE-TEXT(1)             18130000
181400             MOVE DK-AUDIT-CNTL-NBR2                              18140000
181500                             TO DP013-MESSAGE-TEXT(2)             18150000
181600             MOVE DK-SHIPT-UNIT-ID2                               18160000
181700                             TO DP013-MESSAGE-TEXT(3)             18170000
181800             MOVE SQLCA      TO DP013-SQLCA                       18180000
181900             MOVE 'TSUATRN'  TO DP013-DB2-TABLE-NAME(1)           18190000
182000             SET DP013-DB2-ABEND                                  18200000
182100                             TO TRUE                              18210000
182200             SET DP013-NO-ROLLBACK                                18220000
182300                             TO TRUE                              18230000
182400             PERFORM 9999-WRITE-CICS-LOG-MSG                      18240000
182500             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               18250000
182600             PERFORM 8100-SEND-DATA-ONLY                          18260000
182700             PERFORM 8200-RETURN-TRANID                           18270000
182800     END-EVALUATE.                                                18280000
182900                                                                  18290000
183000******************************************************************18300000
183100 2270-INSERT-TSUATRN.                                             18310000
183200                                                                  18320000
183300     EXEC SQL                                                     18330000
183400         INSERT INTO TSUATRN                                      18340000
183500               (AUD_CNTL_NBR                                      18350000
183600              , SHIPT_UNT_ID                                      18360000
183700               ,UNT_AUD_STRT_TMST                                 18370000
183800               ,UNT_AUD_STP_TMST                                  18380000
183900               ,UNT_PSPND_MNIT_QTY                                18390000
184000               ,UNT_CLO_MNIT_QTY                                  18400000
184100               ,UNT_AUD_USR_ID                                    18410000
184200               ,UNT_AUD_STAT_CDE                                  18420000
184300               ,TRN_NBR                                           18430000
184400               ,REC_SEQ_NBR                                       18440000
184500               ,DEST_OPER_UNT_ID                                  18450000
184600               ,DEST_FCLTY_ID                                     18460000
184700               ,UNT_AUD_ERR_IND)                                  18470000
184800         VALUES (:SUATRN-AUD-CNTL-NBR                             18480000
184900                ,:SUATRN-SHIPT-UNT-ID                             18490000
185000                , CURRENT TIMESTAMP                               18500000
185100                ,:PC-DB2-NINES-DATE                               18510000
185200                , 0                                               18520000
185300                , 0                                               18530000
185400                ,:SUATRN-UNT-AUD-USR-ID                           18540000
185500                ,'IP'                                             18550000
185600                ,:SUATRN-TRN-NBR                                  18560000
185700                ,:SUATRN-REC-SEQ-NBR                              18570000
185800                ,:SUATRN-DEST-OPER-UNT-ID                         18580000
185900                ,1                                                18590000
186000                ,:SUATRN-UNT-AUD-ERR-IND)                         18600000
186100     END-EXEC.                                                    18610000
186200                                                                  18620000
186300     EVALUATE TRUE                                                18630000
186400         WHEN SQLCODE = ZERO                                      18640000
186500             CONTINUE                                             18650000
186600         WHEN SQLWARN0 NOT = SPACES                               18660000
186700         WHEN SQLCODE NOT EQUAL ZERO                              18670000
186800             MOVE '2270-INSERT-TSUATRN'                           18680000
186900                             TO DP013-PARAGRAPH                   18690000
187000             MOVE 'INSERT AUDIT RECORD'                           18700000
187100                             TO DP013-MESSAGE-TEXT(1)             18710000
187200             MOVE SUATRN-SHIPT-UNT-ID                             18720000
187300                             TO DP013-MESSAGE-TEXT(2)             18730000
187400             MOVE SUATRN-AUD-CNTL-NBR                             18740000
187500                             TO PV-DISPLAY-AUD-CNTL-NBR           18750000
187600             MOVE PV-DISPLAY-AUD-CNTL-NBR                         18760000
187700                             TO DP013-MESSAGE-TEXT(3)             18770000
187800             MOVE SQLCA      TO DP013-SQLCA                       18780000
187900             MOVE 'TSUATRN'  TO DP013-DB2-TABLE-NAME(1)           18790000
188000             SET DP013-DB2-ABEND                                  18800000
188100                             TO TRUE                              18810000
188200             SET DP013-NO-ROLLBACK                                18820000
188300                             TO TRUE                              18830000
188400             PERFORM 9999-WRITE-CICS-LOG-MSG                      18840000
188500             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               18850000
188600             PERFORM 8100-SEND-DATA-ONLY                          18860000
188700             PERFORM 8200-RETURN-TRANID                           18870000
188800     END-EVALUATE.                                                18880000
188900                                                                  18890000
189000*LMM                                                              18900000
189100******************************************************************18910000
189200* 2275-SELECT-TSHUUPC.                                            18920000
189300*    GET THE PO NUMBER FROM THE SHIPPING UNIT UPC TABLE           18930000
189400******************************************************************18940000
189500 2275-SELECT-TSHUUPC.                                             18950000
189600     EXEC SQL                                                     18960000
189700        SELECT  TRN_NBR                                           18970000
189800          INTO  :SHUUPC-TRN-NBR                                   18980000
189900          FROM  TSHUUPC                                           18990000
190000          WHERE SHIPT_UNT_ID      = :SHPUNT-SHIPT-UNT-ID          19000000
190100     END-EXEC.                                                    19010000
190200                                                                  19020000
190300     EVALUATE TRUE                                                19030000
190400         WHEN SQLCODE = ZERO                                      19040000
190500         WHEN SQLCODE = -811                                      19050000
190600              MOVE SHUUPC-TRN-NBR  TO  SU006-PO                   19060000
190700                                       CA-OLD-PO                  19070000
190800              MOVE ZEROS           TO  SU006-REC-SEQ-NBR          19080000
190900         WHEN SQLCODE = +100                                      19090000
191000              SET CA-CARTON-NOT-FOUND       TO TRUE               19100000
191100              MOVE ZEROS                    TO  SU006-PO          19110000
191200                                                CA-OLD-PO         19120000
191300                                                SU006-REC-SEQ-NBR 19130000
191400         WHEN SQLWARN0 NOT = SPACES                               19140000
191500         WHEN SQLCODE NOT EQUAL ZERO                              19150000
191600             MOVE '2275-SELECT-TSHUUPC'                           19160000
191700                             TO DP013-PARAGRAPH                   19170000
191800             MOVE 'CHECK VALID CARTON'                            19180000
191900                             TO DP013-MESSAGE-TEXT(1)             19190000
192000             MOVE SHUUPC-TRN-NBR                                  19200000
192100                             TO DP013-MESSAGE-TEXT(2)             19210000
192200             MOVE SQLCA      TO DP013-SQLCA                       19220000
192300             MOVE 'TSHUUPC'  TO DP013-DB2-TABLE-NAME(1)           19230000
192400             SET DP013-DB2-ABEND                                  19240000
192500                             TO TRUE                              19250000
192600             SET DP013-NO-ROLLBACK                                19260000
192700                             TO TRUE                              19270000
192800             PERFORM 9999-WRITE-CICS-LOG-MSG                      19280000
192900             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               19290000
193000             PERFORM 8100-SEND-DATA-ONLY                          19300000
193100             PERFORM 8200-RETURN-TRANID                           19310000
193200     END-EVALUATE.                                                19320000
193300                                                                  19330000
193400                                                                  19340000
193500******************************************************************19350000
193600* 2280-SELECT-PKGNG-CDE.                                          19360000
193700*    GET THE PACK TYPE FROM RECEIVING TABLE                       19370000
193800******************************************************************19380000
193900                                                                  19390000
194000                                                                  19400000
194100 2280-SELECT-PKGNG-CDE.                                           19410000
194200     MOVE SU006-PO               TO RECEIV-ORD-NBR.               19420000
194300     MOVE SU006-REC-SEQ-NBR      TO RECEIV-REC-SEQ-NBR.           19430000
194400     MOVE SPACE                  TO RECEIV-PACK-BY-ST-IND.        19440000
194500                                                                  19450000
194600     EXEC SQL                                                     19460000
194700        SELECT  PKGNG_CDE                                         19470000
194800             ,  PACK_BY_ST_IND                                    19480000
194900          INTO  :RECEIV-PKGNG-CDE                                 19490000
195000             ,  :RECEIV-PACK-BY-ST-IND                            19500000
195100          FROM  TRECEIV                                           19510000
195200          WHERE ORD_NBR           = :RECEIV-ORD-NBR               19520000
195300            AND REC_SEQ_NBR       = :RECEIV-REC-SEQ-NBR           19530000
195400     END-EXEC.                                                    19540000
195500                                                                  19550000
195600     EVALUATE TRUE                                                19560000
195700         WHEN SQLCODE = ZERO                                      19570000
195800         WHEN SQLCODE = -811                                      19580000
195900            IF RECEIV-PKGNG-CDE = 'B' OR 'C'                      19590000
196000               SET SU006-BULK-CSPK-PKGNG-CDE TO TRUE              19600000
196100            ELSE                                                  19610000
196200               IF SU006-ECOMMERCE-LOCATION                        19620000
196300                  MOVE SPACE TO SU006-PKGNG-CDE-IND               19630000
196400               ELSE                                               19640000
196500                 IF RECEIV-PKGNG-CDE = 'I'                        19650000
196600                    SET SU006-PREPK-ITYPE-PKGNG-CDE               19660000
196700                        SU006-PREPACK-NOT-CLOSED TO TRUE          19670000
196800                 ELSE                                             19680000
196900                    IF RECEIV-PKGNG-CDE = 'M'                     19690000
197000                       PERFORM 2600-CHECK-TRECITM                 19700000
197100                    ELSE                                          19710000
197200                       MOVE SPACE TO SU006-PKGNG-CDE-IND          19720000
197300                    END-IF                                        19730000
197400                 END-IF                                           19740000
197500               END-IF                                             19750000
197600            END-IF                                                19760000
197700         WHEN SQLCODE = +100                                      19770000
197800              MOVE SPACE TO SU006-PKGNG-CDE-IND                   19780000
197900         WHEN SQLWARN0 NOT = SPACES                               19790000
198000         WHEN SQLCODE NOT EQUAL ZERO                              19800000
198100             MOVE '2280-SELECT-PKGNG-CDE'                         19810000
198200                             TO DP013-PARAGRAPH                   19820000
198300             MOVE 'CHECK PACKAGING CODE '                         19830000
198400                             TO DP013-MESSAGE-TEXT(1)             19840000
198500             MOVE SU006-PO                                        19850000
198600                             TO DP013-MESSAGE-TEXT(2)             19860000
198700             MOVE SQLCA      TO DP013-SQLCA                       19870000
198800             MOVE 'TRECEIV'  TO DP013-DB2-TABLE-NAME(1)           19880000
198900             SET DP013-DB2-ABEND                                  19890000
199000                             TO TRUE                              19900000
199100             SET DP013-NO-ROLLBACK                                19910000
199200                             TO TRUE                              19920000
199300             PERFORM 9999-WRITE-CICS-LOG-MSG                      19930000
199400             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               19940000
199500             PERFORM 8100-SEND-DATA-ONLY                          19950000
199600             PERFORM 8200-RETURN-TRANID                           19960000
199700     END-EVALUATE.                                                19970000
199800                                                                  19980000
199900                                                                  19990000
200000******************************************************************20000000
200100* 2285-VERIFY-SYSTM-PRMPTD-CART.                                  20010000
200200*  VALIDATE THAT THE ASSOCIATE IS SCANNING A CARTON THAT WAS      20020000
200300*  SELECTED AS PART OF THE SYSTEM GENERATED AUDIT                 20030000
200400******************************************************************20040000
200500 2285-VERIFY-SYSTM-PRMPTD-CRTN.                                   20050000
200600                                                                  20060000
200700                                                                  20070000
200800     EXEC SQL                                                     20080000
200900        SELECT  PO_NBR                                            20090000
201000          INTO  :SUT00015-PO-NBR                                  20100000
201100          FROM  TSUATRN A                                         20110000
201200              , SUT_PO_AUD_REQ B                                  20120000
201300          WHERE A.AUD_CNTL_NBR    = B.AUD_CNTL_NBR                20130000
201400          AND   B.AUD_CNTL_NBR    = :SUT00015-AUD-CNTL-NBR        20140000
201500          AND   A.SHIPT_UNT_ID    = :SUATRN-SHIPT-UNT-ID          20150000
201600     END-EXEC                                                     20160000
201700                                                                  20170000
201800     EVALUATE TRUE                                                20180000
201900         WHEN SQLCODE = ZERO                                      20190000
202000         WHEN SQLCODE = -811                                      20200000
202100              SET CA-SYST-PRMPTD-CRTN TO TRUE                     20210000
202200         WHEN SQLCODE = +100                                      20220000
202300              SET CA-NON-SYST-PRMPTD-CRTN TO TRUE                 20230000
202400         WHEN SQLWARN0 NOT = SPACES                               20240000
202500         WHEN SQLCODE NOT EQUAL ZERO                              20250000
202600             MOVE '2285-VERIFY-SYSTM-PRMPTD-CRTN'                 20260000
202700                             TO DP013-PARAGRAPH                   20270000
202800             MOVE 'CHECK SYSTEM GENERTED CRTN'                    20280000
202900                             TO DP013-MESSAGE-TEXT(1)             20290000
203000             MOVE SU006-PO                                        20300000
203100                             TO DP013-MESSAGE-TEXT(2)             20310000
203200             MOVE SQLCA      TO DP013-SQLCA                       20320000
203300             MOVE 'SUT_PO_AUD_REQ'                                20330000
203400                             TO DP013-DB2-TABLE-NAME(1)           20340000
203500             SET DP013-DB2-ABEND                                  20350000
203600                             TO TRUE                              20360000
203700             SET DP013-NO-ROLLBACK                                20370000
203800                             TO TRUE                              20380000
203900             PERFORM 9999-WRITE-CICS-LOG-MSG                      20390000
204000             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               20400000
204100             PERFORM 8100-SEND-DATA-ONLY                          20410000
204200             PERFORM 8200-RETURN-TRANID                           20420000
204300     END-EVALUATE.                                                20430000
204400                                                                  20440000
204500 2290-UPDATE-TSUATRN.                                             20450000
204600                                                                  20460000
204700     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              20470000
204800                                                                  20480000
204900     IF  SUATRN-UNT-AUD-USR-ID  >  SPACES                         20490000
205000         CONTINUE                                                 20500000
205100     ELSE                                                         20510000
205200         MOVE SU006-USERID      TO SUATRN-UNT-AUD-USR-ID          20520000
205300     END-IF.                                                      20530000
205400                                                                  20540000
205500     IF SUATRN-UNT-AUD-STRT-TMST = PC-DB2-NINES-DATE              20550000
205600                                                                  20560000
205700       EXEC SQL                                                   20570000
205800           UPDATE TSUATRN                                         20580000
205900           SET UNT_AUD_STRT_TMST =  CURRENT TIMESTAMP             20590000
206000              ,UNT_AUD_ERR_IND   = :SUATRN-UNT-AUD-ERR-IND        20600000
206100              ,UNT_AUD_USR_ID    = :SUATRN-UNT-AUD-USR-ID         20610000
206200           WHERE  AUD_CNTL_NBR   = :SUATRN-AUD-CNTL-NBR           20620000
206300             AND  SHIPT_UNT_ID   = :SUATRN-SHIPT-UNT-ID           20630000
206400       END-EXEC                                                   20640000
206500     ELSE                                                         20650000
206600       IF SUATRN-UNT-AUD-ERR-IND   = 'Y'                          20660000
206700           EXEC SQL                                               20670000
206800               UPDATE TSUATRN                                     20680000
206900               SET UNT_AUD_ERR_IND     = :SUATRN-UNT-AUD-ERR-IND  20690000
207000                  ,UNT_AUD_USR_ID      = :SUATRN-UNT-AUD-USR-ID   20700000
207100               WHERE  AUD_CNTL_NBR     = :SUATRN-AUD-CNTL-NBR     20710000
207200                 AND  SHIPT_UNT_ID     = :SUATRN-SHIPT-UNT-ID     20720000
207300           END-EXEC                                               20730000
207400       ELSE                                                       20740000
207500           MOVE ZEROES TO SQLCODE                                 20750000
207600       END-IF                                                     20760000
207700     END-IF                                                       20770000
207800                                                                  20780000
207900     EVALUATE TRUE                                                20790000
208000         WHEN SQLCODE = ZERO                                      20800000
208100             CONTINUE                                             20810000
208200         WHEN SQLWARN0 NOT = SPACES                               20820000
208300         WHEN SQLCODE < ZERO                                      20830000
208400         WHEN SQLCODE > ZERO                                      20840000
208500             MOVE '2290-UPDATE-TSUATRN'                           20850000
208600                 TO DP013-PARAGRAPH                               20860000
208700             MOVE 'UPDATE OF TSUNAUD'                             20870000
208800                 TO DP013-MESSAGE-TEXT (1)                        20880000
208900             MOVE SU006-AUDIT-CNTL-NBR-X                          20890000
209000                 TO DP013-MESSAGE-TEXT (2)                        20900000
209100             MOVE SQLCA            TO DP013-SQLCA                 20910000
209200             MOVE 'TSUATRN'        TO DP013-DB2-TABLE-NAME (1)    20920000
209300             SET DP013-DB2-ABEND   TO TRUE                        20930000
209400             SET DP013-NO-ROLLBACK TO TRUE                        20940000
209500             PERFORM 9999-WRITE-CICS-LOG-MSG                      20950000
209600             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               20960000
209700             PERFORM 8100-SEND-DATA-ONLY                          20970000
209800             PERFORM 8200-RETURN-TRANID                           20980000
209900     END-EVALUATE.                                                20990000
210000                                                                  21000000
210100******************************************************************21010000
210200 2292-UPDATE-TSUATRN-CMB.                                         21020000
210300                                                                  21030000
210400     EXEC SQL                                                     21040000
210500           UPDATE TSUATRN                                         21050000
210600           SET UNT_AUD_STRT_TMST =  CURRENT TIMESTAMP             21060000
210700              ,UNT_AUD_USR_ID    = :SU006-USERID                  21070000
210800           WHERE  AUD_CNTL_NBR   = :DK-AUDIT-CNTL-NBR2            21080000
210900             AND  SHIPT_UNT_ID   = :DK-SHIPT-UNIT-ID2             21090000
211000     END-EXEC.                                                    21100000
211100                                                                  21110000
211200     EVALUATE TRUE                                                21120000
211300         WHEN SQLCODE = ZERO                                      21130000
211400             CONTINUE                                             21140000
211500                                                                  21150000
211600         WHEN SQLWARN0 NOT = SPACES                               21160000
211700         WHEN SQLCODE < ZERO                                      21170000
211800         WHEN SQLCODE > ZERO                                      21180000
211900             MOVE '2292-UPDATE-TSUATRN-CMB'                       21190000
212000                                   TO DP013-PARAGRAPH             21200000
212100             MOVE 'UPDATE OF TSUNAUD'                             21210000
212200                                   TO DP013-MESSAGE-TEXT (1)      21220000
212300             MOVE DK-AUDIT-CNTL-NBR2                              21230000
212400                                   TO DP013-MESSAGE-TEXT (2)      21240000
212500             MOVE DK-SHIPT-UNIT-ID2                               21250000
212600                                   TO DP013-MESSAGE-TEXT (3)      21260000
212700             MOVE SQLCA            TO DP013-SQLCA                 21270000
212800             MOVE 'TSUATRN'        TO DP013-DB2-TABLE-NAME (1)    21280000
212900             SET DP013-DB2-ABEND   TO TRUE                        21290000
213000             SET DP013-NO-ROLLBACK TO TRUE                        21300000
213100             PERFORM 9999-WRITE-CICS-LOG-MSG                      21310000
213200             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               21320000
213300             PERFORM 8100-SEND-DATA-ONLY                          21330000
213400             PERFORM 8200-RETURN-TRANID                           21340000
213500     END-EVALUATE.                                                21350000
213600                                                                  21360000
213700******************************************************************21370000
213800 2295-UPDATE-TSUNAUD.                                             21380000
213900                                                                  21390000
214000     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              21400000
214100                                                                  21410000
214200     EXEC SQL                                                     21420000
214300         UPDATE TSUNAUD                                           21430000
214400                                                                  21440000
214500         SET    AUD_STRT_TMST =  CURRENT TIMESTAMP                21450000
214600         WHERE  AUD_CNTL_NBR  = :SUATRN-AUD-CNTL-NBR              21460000
214700     END-EXEC.                                                    21470000
214800                                                                  21480000
214900     EVALUATE TRUE                                                21490000
215000         WHEN SQLCODE = ZERO                                      21500000
215100             CONTINUE                                             21510000
215200         WHEN SQLWARN0 NOT = SPACES                               21520000
215300         WHEN SQLCODE < ZERO                                      21530000
215400         WHEN SQLCODE > ZERO                                      21540000
215500             MOVE '2295-UPDATE-TSUNAUD'                           21550000
215600                 TO DP013-PARAGRAPH                               21560000
215700             MOVE 'UPDATE OF TSUNAUD'                             21570000
215800                 TO DP013-MESSAGE-TEXT (1)                        21580000
215900             MOVE SU006-AUDIT-CNTL-NBR-X                          21590000
216000                 TO DP013-MESSAGE-TEXT (2)                        21600000
216100             MOVE SQLCA            TO DP013-SQLCA                 21610000
216200             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    21620000
216300             SET DP013-DB2-ABEND   TO TRUE                        21630000
216400             SET DP013-NO-ROLLBACK TO TRUE                        21640000
216500             PERFORM 9999-WRITE-CICS-LOG-MSG                      21650000
216600             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               21660000
216700             PERFORM 8100-SEND-DATA-ONLY                          21670000
216800             PERFORM 8200-RETURN-TRANID                           21680000
216900     END-EVALUATE.                                                21690000
217000                                                                  21700000
217100******************************************************************21710000
217200 2297-UPDATE-TSUNAUD-CMB.                                         21720000
217300                                                                  21730000
217400     EXEC SQL                                                     21740000
217500         UPDATE TSUNAUD                                           21750000
217600            SET  AUD_STRT_TMST =  CURRENT TIMESTAMP               21760000
217700          WHERE  AUD_CNTL_NBR  = :DK-AUDIT-CNTL-NBR2              21770000
217800     END-EXEC.                                                    21780000
217900                                                                  21790000
218000     EVALUATE TRUE                                                21800000
218100         WHEN SQLCODE = ZERO                                      21810000
218200             CONTINUE                                             21820000
218300                                                                  21830000
218400         WHEN SQLWARN0 NOT = SPACES                               21840000
218500         WHEN SQLCODE < ZERO                                      21850000
218600         WHEN SQLCODE > ZERO                                      21860000
218700             MOVE '2297-UPDATE-TSUNAUD-CMB'                       21870000
218800                 TO DP013-PARAGRAPH                               21880000
218900             MOVE 'UPDATE OF TSUNAUD'                             21890000
219000                 TO DP013-MESSAGE-TEXT (1)                        21900000
219100             MOVE DK-AUDIT-CNTL-NBR2                              21910000
219200                 TO DP013-MESSAGE-TEXT (2)                        21920000
219300             MOVE SQLCA            TO DP013-SQLCA                 21930000
219400             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    21940000
219500             SET DP013-DB2-ABEND   TO TRUE                        21950000
219600             SET DP013-NO-ROLLBACK TO TRUE                        21960000
219700             PERFORM 9999-WRITE-CICS-LOG-MSG                      21970000
219800             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               21980000
219900             PERFORM 8100-SEND-DATA-ONLY                          21990000
220000             PERFORM 8200-RETURN-TRANID                           22000000
220100     END-EVALUATE.                                                22010000
220200                                                                  22020000
220300******************************************************************22030000
220400 2300-UPDATE-COMBINED-RTN.                                        22040000
220500                                                                  22050000
220600     PERFORM 2265-SELECT-TSUATRN-CMB.                             22060000
220700     IF PS-ROW-FOUND                                              22070000
220800        IF PV-COMBINED-STRT-TMST  = PC-DB2-NINES-DATE             22080000
220900           PERFORM 2292-UPDATE-TSUATRN-CMB                        22090000
221000        END-IF                                                    22100000
221100     END-IF.                                                      22110000
221200                                                                  22120000
221300     PERFORM 2515-CHECK-IF-STOPPED-CMB.                           22130000
221400     IF PV-COMBINED-STRT-TMST = PC-DB2-NINES-DATE                 22140000
221500        PERFORM 2297-UPDATE-TSUNAUD-CMB                           22150000
221600     END-IF.                                                      22160000
221700                                                                  22170000
221800******************************************************************22180000
221900 2400-INSERT-TCTEXCP.                                             22190000
222000                                                                  22200000
222100     EXEC SQL                                                     22210000
222200         INSERT INTO TCTEXCP                                      22220000
222300               (AUD_CNTL_NBR,                                     22230000
222400                SHIPT_UNT_ID,                                     22240000
222500                VILN_GP_CDE,                                      22250000
222600                VILN_GP_SEQ_NBR,                                  22260000
222700                OVRRID_SYS_DAT_TXT)                               22270000
222800         VALUES                                                   22280000
222900               (:CTEXCP-AUD-CNTL-NBR                              22290000
223000              , :CTEXCP-SHIPT-UNT-ID                              22300000
223100              , 'VA'                                              22310000
223200              , :CTEXCP-VILN-GP-SEQ-NBR                           22320000
223300              , :CTEXCP-OVRRID-SYS-DAT-TXT)                       22330000
223400     END-EXEC.                                                    22340000
223500                                                                  22350000
223600     EVALUATE TRUE                                                22360000
223700         WHEN SQLCODE = ZERO                                      22370000
223800             CONTINUE                                             22380000
223900         WHEN SQLWARN0 NOT = SPACES                               22390000
224000         WHEN SQLCODE NOT EQUAL ZERO                              22400000
224100             MOVE '2400-INSERT-TCTEXCP'                           22410000
224200                             TO DP013-PARAGRAPH                   22420000
224300             MOVE 'INSERT TCTEXCP      '                          22430000
224400                             TO DP013-MESSAGE-TEXT(1)             22440000
224500             MOVE CTEXCP-SHIPT-UNT-ID                             22450000
224600                             TO DP013-MESSAGE-TEXT(2)             22460000
224700             MOVE SQLCA      TO DP013-SQLCA                       22470000
224800             MOVE 'TCTEXCP'  TO DP013-DB2-TABLE-NAME(1)           22480000
224900             SET DP013-DB2-ABEND                                  22490000
225000                             TO TRUE                              22500000
225100             SET DP013-NO-ROLLBACK                                22510000
225200                             TO TRUE                              22520000
225300             PERFORM 9999-WRITE-CICS-LOG-MSG                      22530000
225400             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               22540000
225500             PERFORM 8100-SEND-DATA-ONLY                          22550000
225600             PERFORM 8200-RETURN-TRANID                           22560000
225700     END-EVALUATE.                                                22570000
225800                                                                  22580000
225900***************************************************************** 22590000
226000*  2500-RESTART-AUDIT                                           * 22600000
226100* RESTART THE COMPLETED/POSTPONED AUDIT.                        * 22610000
226200* CALCULATE THE MINUTES IT WAS CLOSED/POSTPONED, AND RESET THE  * 22620000
226300* AUDIT STOP TIMESTAMP * *                                        22630000
226400***************************************************************** 22640000
226500 2500-RESTART-AUDIT.                                              22650000
226600                                                                  22660000
226700*    DETERMINE IF THE STOP TIMESTAMP WAS UPDATED                  22670000
226800     PERFORM 2510-CHECK-IF-STOPPED.                               22680000
226900                                                                  22690000
227000     IF SUNAUD-AUD-STP-TMST NOT EQUAL TO                          22700000
227100                               '9999-09-09-09.09.09.999999'       22710000
227200*    FIRST CALCULATED THE MINUTES SINCE IT WAS STOPPED            22720000
227300         PERFORM 2520-CALC-STOP-MINUTES                           22730000
227400     ELSE                                                         22740000
227500         MOVE 0               TO PV-TOTAL-CLOSED-MINUTES          22750000
227600     END-IF.                                                      22760000
227700                                                                  22770000
227800*    UPDATE THE MINUTES POSTPONED/COMPLETED AND RESET THE         22780000
227900*    STOP TIMESTAMP                                               22790000
228000     IF SU006-AUDIT-COMPLETE                                      22800000
228100         PERFORM 2530-UPDATE-COMPLETE-MINUTES                     22810000
228200     ELSE                                                         22820000
228300         IF SU006-AUDIT-POSTPONE                                  22830000
228400            PERFORM 2540-UPDATE-POSTPONE-MINUTES                  22840000
228500         END-IF                                                   22850000
228600     END-IF.                                                      22860000
228700                                                                  22870000
228800***************************************************************** 22880000
228900*  2510-CHECK-IF-STOPPED.                                       * 22890000
229000* RESTART THE COMPLETED/POSTPONED AUDIT.                        * 22900000
229100* DETERMINED IF THE AUDIT WAS STOPPED BY THE CORRECT PROCEDURE  * 22910000
229200* IF IT STOPPED BECAUSE OF FAILED COMMUNICATIONS, THE AUD-STP-TMST22920000
229300* WOULD NOT HAVE BEEN UPDATED.                                  * 22930000
229400***************************************************************** 22940000
229500 2510-CHECK-IF-STOPPED.                                           22950000
229600                                                                  22960000
229700     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              22970000
229800                                                                  22980000
229900     EXEC SQL                                                     22990000
230000         SELECT                                                   23000000
230100                AUD_STRT_TMST                                     23010000
230200              , AUD_STP_TMST                                      23020000
230300         INTO                                                     23030000
230400                :SUNAUD-AUD-STRT-TMST                             23040000
230500              , :SUNAUD-AUD-STP-TMST                              23050000
230600         FROM                                                     23060000
230700                TSUNAUD                                           23070000
230800         WHERE                                                    23080000
230900                AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             23090000
231000     END-EXEC.                                                    23100000
231100                                                                  23110000
231200     EVALUATE TRUE                                                23120000
231300         WHEN SQLCODE = ZERO                                      23130000
231400             CONTINUE                                             23140000
231500                                                                  23150000
231600         WHEN SQLWARN0 NOT = SPACES                               23160000
231700         WHEN SQLCODE < ZERO                                      23170000
231800         WHEN SQLCODE > ZERO                                      23180000
231900             MOVE '2510-CHECK-IF-STOPPED.'                        23190000
232000                 TO DP013-PARAGRAPH                               23200000
232100             MOVE 'SELECT OF TSUNAUD'                             23210000
232200                 TO DP013-MESSAGE-TEXT (1)                        23220000
232300             MOVE SU006-AUDIT-CNTL-NBR-X                          23230000
232400                 TO DP013-MESSAGE-TEXT (2)                        23240000
232500             MOVE SQLCA            TO DP013-SQLCA                 23250000
232600             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    23260000
232700             SET DP013-DB2-ABEND   TO TRUE                        23270000
232800             SET DP013-NO-ROLLBACK TO TRUE                        23280000
232900             PERFORM 9999-WRITE-CICS-LOG-MSG                      23290000
233000             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               23300000
233100             PERFORM 8100-SEND-DATA-ONLY                          23310000
233200             PERFORM 8200-RETURN-TRANID                           23320000
233300     END-EVALUATE.                                                23330000
233400                                                                  23340000
233500***************************************************************** 23350000
233600*  2515-CHECK-IF-STOPPED-CMB.                                   * 23360000
233700***************************************************************** 23370000
233800 2515-CHECK-IF-STOPPED-CMB.                                       23380000
233900                                                                  23390000
234000     EXEC SQL                                                     23400000
234100         SELECT AUD_STRT_TMST                                     23410000
234200         INTO   :PV-COMBINED-STRT-TMST                            23420000
234300         FROM   TSUNAUD                                           23430000
234400         WHERE  AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR2            23440000
234500     END-EXEC.                                                    23450000
234600                                                                  23460000
234700     EVALUATE TRUE                                                23470000
234800         WHEN SQLCODE = ZERO                                      23480000
234900             CONTINUE                                             23490000
235000                                                                  23500000
235100         WHEN SQLWARN0 NOT = SPACES                               23510000
235200         WHEN SQLCODE < ZERO                                      23520000
235300         WHEN SQLCODE > ZERO                                      23530000
235400             MOVE '2515-CHECK-IF-STOPPED-CMB'                     23540000
235500                                   TO DP013-PARAGRAPH             23550000
235600             MOVE 'SELECT OF TSUNAUD'                             23560000
235700                                   TO DP013-MESSAGE-TEXT (1)      23570000
235800             MOVE DK-AUDIT-CNTL-NBR2                              23580000
235900                                   TO DP013-MESSAGE-TEXT (2)      23590000
236000             MOVE SQLCA            TO DP013-SQLCA                 23600000
236100             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    23610000
236200             SET DP013-DB2-ABEND   TO TRUE                        23620000
236300             SET DP013-NO-ROLLBACK TO TRUE                        23630000
236400             PERFORM 9999-WRITE-CICS-LOG-MSG                      23640000
236500             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               23650000
236600             PERFORM 8100-SEND-DATA-ONLY                          23660000
236700             PERFORM 8200-RETURN-TRANID                           23670000
236800     END-EVALUATE.                                                23680000
236900                                                                  23690000
237000***************************************************************** 23700000
237100*  2520-CALC-STOP-MINUTES.                                      * 23710000
237200* RESTART THE COMPLETED/POSTPONED AUDIT.                        * 23720000
237300* CALCULATE THE MINUTES IT WAS CLOSED/POSTPONED, AND RESET THE  * 23730000
237400* AUDIT STOP TIMESTAMP * *                                        23740000
237500***************************************************************** 23750000
237600 2520-CALC-STOP-MINUTES.                                          23760000
237700                                                                  23770000
237800     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              23780000
237900                                                                  23790000
238000     EXEC SQL                                                     23800000
238100         SELECT                                                   23810000
238200                DAYS(CURRENT DATE)     - DAYS(AUD_STP_TMST)       23820000
238300              , HOUR(CURRENT TIME)    - HOUR(AUD_STP_TMST)        23830000
238400              , MINUTE(CURRENT TIME)  - MINUTE(AUD_STP_TMST)      23840000
238500         INTO                                                     23850000
238600                :PV-CLOSED-DAYS                                   23860000
238700              , :PV-CLOSED-HOURS                                  23870000
238800              , :PV-CLOSED-MINUTES                                23880000
238900         FROM                                                     23890000
239000                TSUNAUD                                           23900000
239100         WHERE                                                    23910000
239200                AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             23920000
239300     END-EXEC.                                                    23930000
239400                                                                  23940000
239500     EVALUATE TRUE                                                23950000
239600         WHEN SQLCODE = ZERO                                      23960000
239700             COMPUTE PV-TOTAL-CLOSED-MINUTES =                    23970000
239800                ((PV-CLOSED-DAYS     * 1440) +                    23980000
239900                 (PV-CLOSED-HOURS    * 60)   +                    23990000
240000                  PV-CLOSED-MINUTES)                              24000000
240100                                                                  24010000
240200         WHEN SQLWARN0 NOT = SPACES                               24020000
240300         WHEN SQLCODE < ZERO                                      24030000
240400         WHEN SQLCODE > ZERO                                      24040000
240500             MOVE '2520-CALC-STOP-MINUTES.'                       24050000
240600                 TO DP013-PARAGRAPH                               24060000
240700             MOVE 'SELECT OF TSUNAUD'                             24070000
240800                 TO DP013-MESSAGE-TEXT (1)                        24080000
240900             MOVE SU006-AUDIT-CNTL-NBR-X                          24090000
241000                 TO DP013-MESSAGE-TEXT (2)                        24100000
241100             MOVE SQLCA            TO DP013-SQLCA                 24110000
241200             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    24120000
241300             SET DP013-DB2-ABEND   TO TRUE                        24130000
241400             SET DP013-NO-ROLLBACK TO TRUE                        24140000
241500             PERFORM 9999-WRITE-CICS-LOG-MSG                      24150000
241600             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               24160000
241700             PERFORM 8100-SEND-DATA-ONLY                          24170000
241800             PERFORM 8200-RETURN-TRANID                           24180000
241900     END-EVALUATE.                                                24190000
242000                                                                  24200000
242100                                                                  24210000
242200***************************************************************** 24220000
242300*  2530-UPDATE-COMPLETE-MINUTES                                 * 24230000
242400* UPDATE THE TABLE WITH THE ADDITION OF THE CURRENT CLOSED      * 24240000
242500* MINUTES TO THE EXISTING CLOSED MINUTES -- UPDATE THE STOP     * 24250000
242600* TIMESTAMP TO THE DEFAULT VALUE                                * 24260000
242700***************************************************************** 24270000
242800 2530-UPDATE-COMPLETE-MINUTES.                                    24280000
242900                                                                  24290000
243000     SET SU006-AUDIT-INPROCESS TO TRUE.                           24300000
243100     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              24310000
243200                                                                  24320000
243300     EXEC SQL                                                     24330000
243400         UPDATE TSUNAUD                                           24340000
243500                                                                  24350000
243600         SET AUD_CLO_MNIT_QTY = AUD_CLO_MNIT_QTY +                24360000
243700                                :PV-TOTAL-CLOSED-MINUTES          24370000
243800           , AUD_STP_TMST     = '9999-09-09-09.09.09.999999'      24380000
243900           , AUD_STAT_CDE     = :SU006-AUDIT-STATUS               24390000
244000                                                                  24400000
244100         WHERE  AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             24410000
244200     END-EXEC.                                                    24420000
244300                                                                  24430000
244400     EVALUATE TRUE                                                24440000
244500         WHEN SQLCODE = ZERO                                      24450000
244600             CONTINUE                                             24460000
244700         WHEN SQLWARN0 NOT = SPACES                               24470000
244800         WHEN SQLCODE < ZERO                                      24480000
244900         WHEN SQLCODE > ZERO                                      24490000
245000             MOVE '2530-UPDATE-COMPLETE-MINUTES'                  24500000
245100                 TO DP013-PARAGRAPH                               24510000
245200             MOVE 'UPDATE OF TSUNAUD'                             24520000
245300                 TO DP013-MESSAGE-TEXT (1)                        24530000
245400             MOVE SU006-AUDIT-CNTL-NBR-X                          24540000
245500                 TO DP013-MESSAGE-TEXT (2)                        24550000
245600             MOVE SQLCA            TO DP013-SQLCA                 24560000
245700             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    24570000
245800             SET DP013-DB2-ABEND   TO TRUE                        24580000
245900             SET DP013-NO-ROLLBACK TO TRUE                        24590000
246000             PERFORM 9999-WRITE-CICS-LOG-MSG                      24600000
246100             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               24610000
246200             PERFORM 8100-SEND-DATA-ONLY                          24620000
246300             PERFORM 8200-RETURN-TRANID                           24630000
246400     END-EVALUATE.                                                24640000
246500                                                                  24650000
246600                                                                  24660000
246700***************************************************************** 24670000
246800*  2540-UPDATE-POSTPONE-MINUTES                                 * 24680000
246900* UPDATE THE TABLE WITH THE ADDITION OF THE CURRENT CLOSED      * 24690000
247000* MINUTES TO THE EXISTING POSTPONED MINUTES -- UPDATE THE STOP  * 24700000
247100* TIMESTAMP TO THE DEFAULT VALUE                                * 24710000
247200***************************************************************** 24720000
247300 2540-UPDATE-POSTPONE-MINUTES.                                    24730000
247400                                                                  24740000
247500     SET SU006-AUDIT-INPROCESS TO TRUE.                           24750000
247600     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              24760000
247700                                                                  24770000
247800     EXEC SQL                                                     24780000
247900         UPDATE TSUNAUD                                           24790000
248000                                                                  24800000
248100         SET AUD_PSPND_MNIT_QTY = AUD_PSPND_MNIT_QTY +            24810000
248200                                :PV-TOTAL-CLOSED-MINUTES          24820000
248300           , AUD_STP_TMST     = '9999-09-09-09.09.09.999999'      24830000
248400           , AUD_STAT_CDE     = :SU006-AUDIT-STATUS               24840000
248500                                                                  24850000
248600         WHERE  AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             24860000
248700     END-EXEC.                                                    24870000
248800                                                                  24880000
248900     EVALUATE TRUE                                                24890000
249000         WHEN SQLCODE = ZERO                                      24900000
249100             CONTINUE                                             24910000
249200         WHEN SQLWARN0 NOT = SPACES                               24920000
249300         WHEN SQLCODE < ZERO                                      24930000
249400         WHEN SQLCODE > ZERO                                      24940000
249500             MOVE '2540-UPDATE-POSTPONE-MINUTES'                  24950000
249600                 TO DP013-PARAGRAPH                               24960000
249700             MOVE 'UPDATE OF TSUNAUD'                             24970000
249800                 TO DP013-MESSAGE-TEXT (1)                        24980000
249900             MOVE SU006-AUDIT-CNTL-NBR-X                          24990000
250000                 TO DP013-MESSAGE-TEXT (2)                        25000000
250100             MOVE SQLCA            TO DP013-SQLCA                 25010000
250200             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    25020000
250300             SET DP013-DB2-ABEND   TO TRUE                        25030000
250400             SET DP013-NO-ROLLBACK TO TRUE                        25040000
250500             PERFORM 9999-WRITE-CICS-LOG-MSG                      25050000
250600             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               25060000
250700             PERFORM 8100-SEND-DATA-ONLY                          25070000
250800             PERFORM 8200-RETURN-TRANID                           25080000
250900     END-EVALUATE.                                                25090000
251000                                                                  25100000
251100 2600-CHECK-TRECITM.                                              25110000
251110                                                                  25111000
251120     MOVE SU006-SHIP-UNIT-NBR      TO DK-SHIPT-UNIT-ID.           25112000
251130     MOVE SU006-REC-SEQ-NBR        TO DK-REC-SEQ-NBR.             25113000
251140     SET PS-TRECITM-FOUND          TO TRUE.                       25114000
251150                                                                  25115000
251160     EXEC SQL                                                     25116000
251170         SELECT B.ORD_NBR                                         25117000
251180         INTO   :PV-ORD-NBR                                       25118000
251190         FROM   TSHUUPC A                                         25119000
251191            ,   TRECITM B                                         25119100
251192         WHERE A.SHIPT_UNT_ID   = :DK-SHIPT-UNIT-ID               25119200
251193           AND B.ORD_NBR        = A.TRN_NBR                       25119300
251194           AND B.REC_SEQ_NBR    = :DK-REC-SEQ-NBR                 25119400
251195           AND B.ORD_LNE_NBR    = A.TRN_LNE_NBR                   25119500
251196           AND B.VER_STATUS_CDE = 'A'                             25119600
251197           FETCH FIRST 1 ROW ONLY                                 25119700
251198     END-EXEC.                                                    25119800
251199     EVALUATE TRUE                                                25119900
251200         WHEN SQLCODE = +0                                        25120000
251201         WHEN SQLCODE = -811                                      25120100
251202             SET PS-TRECITM-FOUND    TO TRUE                      25120200
251203                                                                  25120300
251204         WHEN SQLCODE = +100                                      25120400
251205             SET PS-TRECITM-NOT-FOUND    TO TRUE                  25120500
251206                                                                  25120600
251207         WHEN OTHER                                               25120700
251208            MOVE '2600-CHECK-TRECITM'                             25120800
251209                                     TO DP013-PARAGRAPH           25120900
251210            MOVE 'ERROR ON SELECT TRECITM 1'                      25121000
251211                                     TO DP013-MESSAGE-TEXT(1)     25121100
251212            MOVE DK-SHIPT-UNIT-ID    TO PV-DISPLAY-SHIPT-UNT-ID   25121200
251213            MOVE DK-REC-SEQ-NBR      TO PV-DISPLAY-REC-SEQ-NBR    25121300
251214            STRING ' CARTON = '                                   25121400
251215                   PV-DISPLAY-SHIPT-UNT-ID                        25121500
251216                       DELIMITED BY SIZE                          25121600
251217                           INTO DP013-MESSAGE-TEXT (2)            25121700
251218            STRING ' RECEIVER = '                                 25121800
251219                   PV-DISPLAY-REC-SEQ-NBR                         25121900
251220                       DELIMITED BY SIZE                          25122000
251221                           INTO DP013-MESSAGE-TEXT (3)            25122100
251222            MOVE SQLCA               TO DP013-SQLCA               25122200
251223            MOVE 'TSHUUPC'           TO DP013-DB2-TABLE-NAME(1)   25122300
251224            MOVE 'TRECITM'           TO DP013-DB2-TABLE-NAME(2)   25122400
251225            SET DP013-DB2-ABEND      TO TRUE                      25122500
251226            SET DP013-NO-ROLLBACK    TO TRUE                      25122600
251227            SET DP013-XCTL-DISPLAY-RESTART                        25122700
251228                                     TO TRUE                      25122800
251229            PERFORM DP014-0000-PROCESS-ABEND                      25122900
251230     END-EVALUATE.                                                25123000
251231                                                                  25123100
251232     IF PS-TRECITM-FOUND                                          25123200
251233        EXEC SQL                                                  25123300
251234            SELECT B.ORD_NBR                                      25123400
251235            INTO   :PV-ORD-NBR                                    25123500
251236            FROM   TSHUUPC A                                      25123600
251237               ,   TRECITM B                                      25123700
251238               ,   TPOPRPK C                                      25123800
251239            WHERE A.SHIPT_UNT_ID    = :DK-SHIPT-UNIT-ID           25123900
251240              AND B.ORD_NBR         = A.TRN_NBR                   25124000
251241              AND B.REC_SEQ_NBR     = :DK-REC-SEQ-NBR             25124100
251242              AND B.ORD_LNE_NBR     = A.TRN_LNE_NBR               25124200
251243              AND C.PO_NBR          = B.ORD_NBR                   25124300
251244              AND C.PO_PREPK_ID     = B.PREPK_ID                  25124400
251245              AND C.PREPK_TYP_CDE   = 'I'                         25124500
251246              AND B.VER_STATUS_CDE  = 'A'                         25124600
251247              AND B.PREPK_DRV_LNE_CDE = 'A'                       25124700
251248              AND B.CASE_PACK_QTY     > 1                         25124800
251249              FETCH FIRST 1 ROW ONLY                              25124900
251250        END-EXEC                                                  25125000
251251        EVALUATE TRUE                                             25125100
251252            WHEN SQLCODE = +0                                     25125200
251253            WHEN SQLCODE = -811                                   25125300
251254                 SET SU006-PREPK-ITYPE-PKGNG-CDE                  25125400
251255                     SU006-PREPACK-NOT-CLOSED  TO TRUE            25125500
251256                                                                  25125600
251257            WHEN SQLCODE = +100                                   25125700
251258                 MOVE SPACE TO SU006-PKGNG-CDE-IND                25125800
251259                                                                  25125900
251260            WHEN OTHER                                            25126000
251261               MOVE '2600-CHECK-TRECITM'                          25126100
251262                                     TO DP013-PARAGRAPH           25126200
251263               MOVE 'ERROR ON SELECT TRECITM / TPOPRPK'           25126300
251264                                     TO DP013-MESSAGE-TEXT(1)     25126400
251265               MOVE DK-SHIPT-UNIT-ID TO PV-DISPLAY-SHIPT-UNT-ID   25126500
251266               MOVE DK-REC-SEQ-NBR   TO PV-DISPLAY-REC-SEQ-NBR    25126600
251267               STRING ' CARTON = '                                25126700
251268                      PV-DISPLAY-SHIPT-UNT-ID                     25126800
251269                          DELIMITED BY SIZE                       25126900
251270                              INTO DP013-MESSAGE-TEXT (2)         25127000
251271               STRING ' RECEIVER = '                              25127100
251272                      PV-DISPLAY-REC-SEQ-NBR                      25127200
251273                          DELIMITED BY SIZE                       25127300
251274                              INTO  DP013-MESSAGE-TEXT(3)         25127400
251275               MOVE SQLCA               TO DP013-SQLCA            25127500
251276               MOVE 'TSHUUPC'           TO DP013-DB2-TABLE-NAME(1)25127600
251277               MOVE 'TRECITM'           TO DP013-DB2-TABLE-NAME(2)25127700
251278               MOVE 'TPOPRPK'           TO DP013-DB2-TABLE-NAME(3)25127800
251279               SET DP013-DB2-ABEND      TO TRUE                   25127900
251280               SET DP013-NO-ROLLBACK    TO TRUE                   25128000
251281               SET DP013-XCTL-DISPLAY-RESTART                     25128100
251282                                        TO TRUE                   25128200
251283               PERFORM DP014-0000-PROCESS-ABEND                   25128300
251284        END-EVALUATE                                              25128400
251285     ELSE                                                         25128500
251286        EXEC SQL                                                  25128600
251287            SELECT B.PO_NBR                                       25128700
251288            INTO   :PV-PO-NBR                                     25128800
251289            FROM   TSHUUPC A                                      25128900
251290               ,   TPURITM B                                      25129000
251291               ,   TPOPRPK C                                      25129100
251292            WHERE A.SHIPT_UNT_ID   = :DK-SHIPT-UNIT-ID            25129200
251293              AND B.PO_NBR         = A.TRN_NBR                    25129300
251294              AND B.PO_LNE_NBR     = A.TRN_LNE_NBR                25129400
251295              AND B.VER_STATUS_CDE = 'A'                          25129500
251296              AND C.PO_NBR         = B.PO_NBR                     25129600
251297              AND C.PO_PREPK_ID    = B.PO_PREPK_ID                25129700
251298              AND C.PREPK_TYP_CDE  = 'I'                          25129800
251299              FETCH FIRST 1 ROW ONLY                              25129900
251300        END-EXEC                                                  25130000
251301        EVALUATE TRUE                                             25130100
251302            WHEN SQLCODE = +0                                     25130200
251303            WHEN SQLCODE = -811                                   25130300
251304                 SET SU006-PREPK-ITYPE-PKGNG-CDE                  25130400
251305                     SU006-PREPACK-NOT-CLOSED  TO TRUE            25130500
251306                                                                  25130600
251307            WHEN SQLCODE = +100                                   25130700
251308                 MOVE SPACE TO SU006-PKGNG-CDE-IND                25130800
251309            WHEN OTHER                                            25130900
251310               MOVE '2600-CHECK-TRECITM'                          25131000
251311                                     TO DP013-PARAGRAPH           25131100
251312               MOVE 'ERROR ON SELECT TPURITM / TPOPRPK'           25131200
251313                                     TO DP013-MESSAGE-TEXT(1)     25131300
251314               MOVE DK-SHIPT-UNIT-ID TO PV-DISPLAY-SHIPT-UNT-ID   25131400
251315               MOVE DK-REC-SEQ-NBR   TO PV-DISPLAY-REC-SEQ-NBR    25131500
251316               STRING ' CARTON = '                                25131600
251317                      PV-DISPLAY-SHIPT-UNT-ID                     25131700
251318                          DELIMITED BY SIZE                       25131800
251319                              INTO DP013-MESSAGE-TEXT (2)         25131900
251320               STRING ' RECEIVER = '                              25132000
251321                      PV-DISPLAY-REC-SEQ-NBR                      25132100
251322                          DELIMITED BY SIZE                       25132200
251323                              INTO  DP013-MESSAGE-TEXT(3)         25132300
251324               MOVE SQLCA               TO DP013-SQLCA            25132400
251325               MOVE 'TSHUUPC'           TO DP013-DB2-TABLE-NAME(1)25132500
251326               MOVE 'TPURITM'           TO DP013-DB2-TABLE-NAME(2)25132600
251327               MOVE 'TPOPRPK'           TO DP013-DB2-TABLE-NAME(3)25132700
251328               SET DP013-DB2-ABEND      TO TRUE                   25132800
251329               SET DP013-NO-ROLLBACK    TO TRUE                   25132900
251330               SET DP013-XCTL-DISPLAY-RESTART                     25133000
251331                                        TO TRUE                   25133100
251332               PERFORM DP014-0000-PROCESS-ABEND                   25133200
251333        END-EVALUATE                                              25133300
251334     END-IF.                                                      25133400
251335                                                                  25133500
251336******************************************************************25133600
251337*  3000-VALIDATE-CHECK-DIGIT                                     *25133700
251338*  THE SHIP UNIT NUMBER WAS NOT FOUND ON THE TABLES...VALIDATE   *25133800
251339*  THAT IS IT A VALID SHIPPING UNIT NUMBER - IF SO CONTINUE      *25133900
251340******************************************************************25134000
251350 3000-VALIDATE-CHECK-DIGIT.                                       25135000
251360     COMPUTE PV-ODDS-SUM =                                        25136000
251370             3 * (PV-CTN-9-1  + PV-CTN-9-3  + PV-CTN-9-5  +       25137000
251380             PV-CTN-9-7  + PV-CTN-9-9  + PV-CTN-9-11 +            25138000
251390             PV-CTN-9-13 + PV-CTN-9-15 + PV-CTN-9-17).            25139000
251400                                                                  25140000
251500     COMPUTE PV-EVENS-SUM =                                       25150000
251600             PV-CTN-9-2  + PV-CTN-9-4  + PV-CTN-9-6  +            25160000
251700             PV-CTN-9-8  + PV-CTN-9-10 + PV-CTN-9-12 +            25170000
251800             PV-CTN-9-14 + PV-CTN-9-16.                           25180000
251900     COMPUTE PV-TOTAL = PV-ODDS-SUM + PV-EVENS-SUM.               25190000
252000     COMPUTE PV-CHECK-DIGIT = 10 - PV-TOTAL-LAST-DIGIT.           25200000
252100     IF PV-CHECK-DIGIT = PV-CTN-9-18                              25210000
252200         SET PS-VALID-CHECK-DIGIT TO TRUE                         25220000
252300     ELSE                                                         25230000
252400         SET PS-INVALID-CHECK-DIGIT TO TRUE                       25240000
252500     END-IF.                                                      25250000
252600                                                                  25260000
252700                                                                  25270000
252800******************************************************************25280000
252900*  3100-PREPARE-EXCEPTIN-INSERTS.                                *25290000
253000******************************************************************25300000
253100 3100-PREPARE-EXCEPTION-INSERTS.                                  25310000
253200     MOVE SU006-AUDIT-CNTL-NBR TO CTEXCP-AUD-CNTL-NBR.            25320000
253300     MOVE SU006-SHIP-UNIT-NBR TO CTEXCP-SHIPT-UNT-ID.             25330000
253400                                                                  25340000
253500     IF SU006-PO NOT = CA-OLD-PO                                  25350000
253600         INITIALIZE CTEXCP-OVRRID-SYS-DAT-TXT                     25360000
253700         MOVE SU006-PO        TO CTEXCP-OVRRID-SYS-DAT-TXT        25370000
253800         MOVE '01'            TO CTEXCP-VILN-GP-SEQ-NBR           25380000
253900         PERFORM 2400-INSERT-TCTEXCP                              25390000
254000     END-IF.                                                      25400000
254100                                                                  25410000
254200     IF SU006-STORE NOT = CA-OLD-STORE                            25420000
254300         INITIALIZE CTEXCP-OVRRID-SYS-DAT-TXT                     25430000
254400         MOVE SU006-STORE     TO CTEXCP-OVRRID-SYS-DAT-TXT        25440000
254500         MOVE '02'            TO CTEXCP-VILN-GP-SEQ-NBR           25450000
254600         PERFORM 2400-INSERT-TCTEXCP                              25460000
254700     END-IF.                                                      25470000
254800                                                                  25480000
254900                                                                  25490000
255000 3200-SELECT-AUDIT.                                               25500000
255100                                                                  25510000
255200                                                                  25520000
255300     EXEC SQL                                                     25530000
255400*10/04/13 DW BEG                                                  25540000
255500         SELECT                                                   25550000
255600                AUD_CNTL_NBR                                      25560000
255700             ,  AUD_STAT_CDE                                      25570000
255800             ,  PKGNG_TYP_CDE                                     25580000
255900             ,  PO_PREPK_ID                                       25590000
256000             ,  RWRK_AUD_CNTL_NBR                                 25600000
256100         INTO                                                     25610000
256200                :SUT00015-AUD-CNTL-NBR                            25620000
256300             ,  :SUT00015-AUD-STAT-CDE                            25630000
256400             ,  :SUT00015-PKGNG-TYP-CDE                           25640000
256500             ,  :SUT00015-PO-PREPK-ID                             25650000
256600             ,  :SUT00015-RWRK-AUD-CNTL-NBR                       25660000
256700                :PV-NULL-IND-1                                    25670000
256800         FROM                                                     25680000
256900                SUT_PO_AUD_REQ                                    25690000
257000         WHERE                                                    25700000
257100                AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             25710000
257200*10/04/13 DW END                                                  25720000
257300     END-EXEC.                                                    25730000
257400                                                                  25740000
257500     EVALUATE TRUE                                                25750000
257600         WHEN SQLCODE = ZERO                                      25760000
257700             SET PS-SYSTEM-AUDIT-FOUND TO TRUE                    25770000
257800                                                                  25780000
257900         WHEN SQLCODE = +100                                      25790000
258000             SET PS-SYSTEM-AUDIT-NOT-FOUND TO TRUE                25800000
258100                                                                  25810000
258200         WHEN SQLWARN0 NOT = SPACES                               25820000
258300         WHEN SQLCODE < ZERO                                      25830000
258400         WHEN SQLCODE > ZERO                                      25840000
258500             MOVE '3200-SELECT-AUDIT'                             25850000
258600                 TO DP013-PARAGRAPH                               25860000
258700             MOVE 'SELECT OF SUT_PO_AUD_REQ'                      25870000
258800                 TO DP013-MESSAGE-TEXT (1)                        25880000
258900             MOVE SU006-AUDIT-CNTL-NBR-X                          25890000
259000                 TO DP013-MESSAGE-TEXT (2)                        25900000
259100             MOVE SQLCA            TO DP013-SQLCA                 25910000
259200             MOVE 'SUT00015'       TO DP013-DB2-TABLE-NAME (1)    25920000
259300             SET DP013-DB2-ABEND   TO TRUE                        25930000
259400             SET DP013-NO-ROLLBACK TO TRUE                        25940000
259500             PERFORM 9999-WRITE-CICS-LOG-MSG                      25950000
259600             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               25960000
259700             PERFORM 8100-SEND-DATA-ONLY                          25970000
259800             PERFORM 8200-RETURN-TRANID                           25980000
259900     END-EVALUATE.                                                25990000
260000/                                                                 26000000
260100**************************************************************    26010000
260200* 3250-LINK-COMMON-CARTON-CLOSE                              *    26020000
260300*     WHEN APPLICABLE FILL IN COPYBOOK SUWS091               *    26030000
260400*                     LINK TO SUKCS769                       *    26040000
260500*                     CHECK RETURN FOR ERRORS UPON RETURN    *    26050000
260600**************************************************************    26060000
260700 3250-LINK-COMMON-CARTON-CLOSE.                                   26070000
260800                                                                  26080000
260900     INITIALIZE CCC-REQUEST-COMMUNICATION-AREA.                   26090000
261000                                                                  26100000
261100     MOVE '00'                    TO SU091-RET-CODE.              26110000
261200     MOVE PC-CURRENT-PROGRAM-NAME TO SU091-CALLING-PGM.           26120000
261300     MOVE SU006-OPER-UNT-ID       TO SU091-OPER-UNT-ID.           26130000
261400                                                                  26140000
261500     IF ( SU006-SHIP-UNIT-NBR NUMERIC )                           26150000
261600         MOVE SU006-SHIP-UNIT-NBR TO SU091-SHIPT-UNT-ID           26160000
261700     ELSE                                                         26170000
261800         MOVE ZEROS               TO SU091-SHIPT-UNT-ID           26180000
261900     END-IF.                                                      26190000
262000                                                                  26200000
262100     MOVE SU006-AUDIT-CNTL-NBR    TO SU091-AUD-CNTL-NBR.          26210000
262200     MOVE SUT00015-AUD-STAT-CDE   TO SU091-AUD-STAT-CDE.          26220000
262300                                                                  26230000
262400     IF ( SU006-SYSTEM-GENERATED-AUDIT )                          26240000
262500         SET SU091-PROMPTED-AUDIT TO TRUE                         26250000
262600     ELSE                                                         26260000
262700         IF ( SU006-MANUAL-GENERATED-AUDIT )                      26270000
262800             SET SU091-MANUAL-AUDIT TO TRUE                       26280000
262900         END-IF                                                   26290000
263000     END-IF.                                                      26300000
263100                                                                  26310000
263200     MOVE SU006-USERID            TO SU091-ASSOC-ID.              26320000
263300                                                                  26330000
263400     EXEC CICS LINK                                               26340000
263500               PROGRAM  (PC-COMMON-CARTON-CLOSE-PGM)              26350000
263600               COMMAREA (CCC-REQUEST-COMMUNICATION-AREA)          26360000
263700               LENGTH   (LENGTH OF CCC-REQUEST-COMMUNICATION-AREA)26370000
263800               RESP     (PV-CICS-RESPONSE)                        26380000
263900     END-EXEC.                                                    26390000
264000                                                                  26400000
264100     EVALUATE TRUE                                                26410000
264200         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 26420000
264300             IF ( SU091-SUCCESS )                                 26430000
264400                 CONTINUE                                         26440000
264500             ELSE                                                 26450000
264600                 EVALUATE TRUE                                    26460000
264700                    WHEN SU091-PARAMETER-ERROR                    26470000
264800                        MOVE PC-CCC-PARM-ERR-MSG    TO AMSGLNO    26480000
264900                    WHEN SU091-DB2-ERROR                          26490000
265000                        MOVE PC-CCC-DB2-ERR-MSG     TO AMSGLNO    26500000
265100                    WHEN SU091-MQ-ERROR                           26510000
265200                        MOVE PC-CCC-MQ-ERR-MSG      TO AMSGLNO    26520000
265300                    WHEN SU091-OTHER-ERROR                        26530000
265400                        MOVE PC-CCC-OTHR-ERR-MSG    TO AMSGLNO    26540000
265500                 END-EVALUATE                                     26550000
265600             END-IF                                               26560000
265700         WHEN OTHER                                               26570000
265800             MOVE '3250-LINK-COMMON-CARTON-CLOSE'                 26580000
265900               TO DP013-PARAGRAPH                                 26590000
266000             MOVE 'BAD LINK TO PGM SUKCS769'                      26600000
266100               TO DP013-MESSAGE-TEXT (1)                          26610000
266200             SET DP013-CICS-ABEND   TO TRUE                       26620000
266300             SET DP013-NO-ROLLBACK  TO TRUE                       26630000
266400             PERFORM 9999-WRITE-CICS-LOG-MSG                      26640000
266500             MOVE PC-CCC-PGM-LINK-ERR TO AMSGLNO                  26650000
266600     END-EVALUATE.                                                26660000
266700***RLK 04/14 BEG                                                  26670000
266800 3300-CHECK-FOR-OPEN-QC-AUDIT.                                    26680000
266900                                                                  26690000
267000     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              26700000
267100     MOVE SU006-SHIP-UNIT-NBR  TO DK-SHIPT-UNIT-ID.               26710000
267200                                                                  26720000
267300     EXEC SQL                                                     26730000
267400         SELECT 'Y'                                               26740000
267500               ,A.AUD_CNTL_NBR                                    26750000
267600         INTO                                                     26760000
267700                :PS-QC-AUDIT-EXISTS-SW                            26770000
267800               ,:SUT00015-AUD-CNTL-NBR                            26780000
267900         FROM  SUT_PO_AUD_REQ A                                   26790000
268000              ,TSUATRN        B                                   26800000
268100         WHERE RWRK_AUD_CNTL_NBR   = :DK-AUDIT-CNTL-NBR           26810000
268200           AND B.AUD_CNTL_NBR      = A.AUD_CNTL_NBR               26820000
268300           AND B.SHIPT_UNT_ID      = :DK-SHIPT-UNIT-ID            26830000
268400           AND A.AUD_STAT_CDE      = 'I'                          26840000
268500           AND B.UNT_AUD_STAT_CDE  = 'IP'                         26850000
268600     END-EXEC.                                                    26860000
268700                                                                  26870000
268800     EVALUATE TRUE                                                26880000
268900         WHEN SQLCODE = ZERO                                      26890000
269000         WHEN SQLCODE = -811                                      26900000
269100             CONTINUE                                             26910000
269200         WHEN SQLCODE = +100                                      26920000
269300             SET PS-QC-AUDIT-NOT-EXISTS TO TRUE                   26930000
269400                                                                  26940000
269500         WHEN SQLWARN0 NOT = SPACES                               26950000
269600         WHEN SQLCODE < ZERO                                      26960000
269700         WHEN SQLCODE > ZERO                                      26970000
269800             MOVE '3300-CHECK-FOR-OPEN-QC-AUDIT'                  26980000
269900                 TO DP013-PARAGRAPH                               26990000
270000             MOVE 'SELECT OF SUT_PO_AUD_REQ'                      27000000
270100                 TO DP013-MESSAGE-TEXT (1)                        27010000
270200             MOVE SU006-AUDIT-CNTL-NBR-X                          27020000
270300                 TO DP013-MESSAGE-TEXT (2)                        27030000
270400             MOVE SQLCA            TO DP013-SQLCA                 27040000
270500             MOVE 'SUT00015'       TO DP013-DB2-TABLE-NAME (1)    27050000
270600             SET DP013-DB2-ABEND   TO TRUE                        27060000
270700             SET DP013-NO-ROLLBACK TO TRUE                        27070000
270800             PERFORM 9999-WRITE-CICS-LOG-MSG                      27080000
270900             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               27090000
271000             PERFORM 8100-SEND-DATA-ONLY                          27100000
271100             PERFORM 8200-RETURN-TRANID                           27110000
271200     END-EVALUATE.                                                27120000
271300/                                                                 27130000
271400***RLK 04/14 END                                                  27140000
271500*10/04/13 DW BEG                                                  27150000
271600***************************************************************** 27160000
271700* CHECK FOR OPEN AUDIT                                            27170000
271800***************************************************************** 27180000
271900 3400-CHECK-FOR-OPEN-AUDIT.                                       27190000
272000                                                                  27200000
272100                                                                  27210000
272200     EXEC SQL                                                     27220000
272300         SELECT                                                   27230000
272400                'Y'                                               27240000
272500         INTO                                                     27250000
272600                :PS-OPEN-AUDIT-SW                                 27260000
272700         FROM                                                     27270000
272800                SUT_PO_AUD_REQ                                    27280000
272900         WHERE                                                    27290000
273000                AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             27300000
273100           AND  AUD_STAT_CDE     = 'I'                            27310000
273200     END-EXEC.                                                    27320000
273300                                                                  27330000
273400     EVALUATE TRUE                                                27340000
273500         WHEN SQLCODE = ZERO                                      27350000
273600            SET PS-OPEN-AUDIT-YES TO TRUE                         27360000
273700         WHEN SQLCODE = +100                                      27370000
273800            SET PS-OPEN-AUDIT-NO TO TRUE                          27380000
273900                                                                  27390000
274000         WHEN SQLWARN0 NOT = SPACES                               27400000
274100         WHEN SQLCODE < ZERO                                      27410000
274200         WHEN SQLCODE > ZERO                                      27420000
274300             MOVE '3400-CHECK-FOR-OPEN-AUDIT'                     27430000
274400                 TO DP013-PARAGRAPH                               27440000
274500             MOVE 'SELECT OF SUT_PO_AUD_REQ'                      27450000
274600                 TO DP013-MESSAGE-TEXT (1)                        27460000
274700             MOVE DK-AUDIT-CNTL-NBR                               27470000
274800                 TO DP013-MESSAGE-TEXT (2)                        27480000
274900             MOVE SQLCA            TO DP013-SQLCA                 27490000
275000             MOVE 'SUT00015'       TO DP013-DB2-TABLE-NAME (1)    27500000
275100             SET DP013-DB2-ABEND   TO TRUE                        27510000
275200             SET DP013-NO-ROLLBACK TO TRUE                        27520000
275300             PERFORM 9999-WRITE-CICS-LOG-MSG                      27530000
275400             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               27540000
275500             PERFORM 8100-SEND-DATA-ONLY                          27550000
275600             PERFORM 8200-RETURN-TRANID                           27560000
275700     END-EVALUATE.                                                27570000
275800/                                                                 27580000
275900*10/04/13 DW END                                                  27590000
276000 4000-SELECT-SULBXF.                                              27600000
276100                                                                  27610000
276200     MOVE SU006-SHIP-UNIT-NBR   TO DK-SHIPT-UNIT-ID.              27620000
276300                                                                  27630000
276400     EXEC SQL                                                     27640000
276500         SELECT CART_LBL_TYP_CDE                                  27650000
276600             ,  BRCDE_NBR                                         27660000
276700         INTO   :SULBXF-CART-LBL-TYP-CDE                          27670000
276800             ,  :SULBXF-BRCDE-NBR                                 27680000
276900          FROM  TSULBXF                                           27690000
277000          WHERE SHIPT_UNT_ID      = :DK-SHIPT-UNIT-ID             27700000
277100           AND  STAT_CDE          = 'A'                           27710000
277200     END-EXEC.                                                    27720000
277300                                                                  27730000
277400     EVALUATE TRUE                                                27740000
277500         WHEN SQLCODE = ZERO                                      27750000
277600         WHEN SQLCODE = -811                                      27760000
277700              CONTINUE                                            27770000
277800         WHEN SQLCODE = +100                                      27780000
277810         WHEN SQLCODE = -310                                      27781004
277900              SET PS-NO-OUTBOUND-CARTON TO TRUE                   27790000
278000         WHEN SQLWARN0 NOT = SPACES                               27800000
278100         WHEN SQLCODE NOT EQUAL ZERO                              27810000
278200             MOVE '4000-SELECT-SULBXF'  TO DP013-PARAGRAPH        27820000
278300             MOVE 'CHECK VALID CARTON'  TO DP013-MESSAGE-TEXT(1)  27830000
278400             MOVE DK-SHIPT-UNIT-ID      TO DP013-MESSAGE-TEXT(2)  27840000
278500             MOVE SQLCA                 TO DP013-SQLCA            27850000
278600             MOVE 'TSULBXF'             TO DP013-DB2-TABLE-NAME(1)27860000
278700             SET DP013-DB2-ABEND                                  27870000
278800                 DP013-NO-ROLLBACK       TO TRUE                  27880000
278900             PERFORM 9999-WRITE-CICS-LOG-MSG                      27890000
279000             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               27900000
279100             MOVE -1                     TO ACARTNL               27910000
279200             PERFORM 8100-SEND-DATA-ONLY                          27920000
279300             PERFORM 8200-RETURN-TRANID                           27930000
279400     END-EVALUATE.                                                27940000
279500                                                                  27950000
279600 4100-CHECK-CARTON-ADJ-DC.                                        27960000
279700                                                                  27970000
279800     MOVE SU006-OPER-UNT-ID     TO DK-OPER-UNT-ID.                27980000
279900                                                                  27990000
280000     EXEC SQL                                                     28000000
280100         SELECT FUNC_TXT                                          28010000
280200           INTO :KRPRPM-FUNC-TXT                                  28020000
280300           FROM TKRPRPM                                           28030000
280400          WHERE SYS_PRC_FUNC_CDE  = 'CRTADJ'                      28040000
280500            AND LOC_ID            = :DK-OPER-UNT-ID               28050000
280600            AND INTFC_SYS_CDE     = 'KHL'                         28060000
280700            AND FUNC_PRC_STAT_CDE = 'AC'                          28070000
280800            AND (CURRENT DATE                                     28080000
280900        BETWEEN DATE(FUNC_BEG_TMST) AND                           28090000
281000                DATE(FUNC_END_TMST) )                             28100000
281100     END-EXEC.                                                    28110000
281200                                                                  28120000
281300     EVALUATE SQLCODE                                             28130000
281400         WHEN ZERO                                                28140000
281500             IF KRPRPM-FUNC-TXT = 'Y'                             28150000
281600                 SET PS-CARTON-ADJUST-DC  TO TRUE                 28160000
281700             ELSE                                                 28170000
281800                 SET PS-NOT-CARTON-ADJUST-DC  TO TRUE             28180000
281900             END-IF                                               28190000
282000         WHEN OTHER                                               28200000
282100              MOVE '4100-CHECK-CARTON-ADJ-DC'                     28210000
282200                               TO DP013-PARAGRAPH                 28220000
282300              MOVE 'SELECT CARTON ADJUSTMENT IND'                 28230000
282400                               TO DP013-MESSAGE-TEXT (1)          28240000
282500              MOVE SQLCA       TO DP013-SQLCA                     28250000
282600              SET DP013-DB2-ABEND                                 28260000
282700                               TO TRUE                            28270000
282800              PERFORM DP014-0000-PROCESS-ABEND                    28280000
282900     END-EVALUATE.                                                28290000
283000                                                                  28300000
283100*                                                                 28310000
283200 4200-XCTL-TO-HELP.                                               28320000
283300                                                                  28330000
283400     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH.      28340000
283500     SET  SU006-INITIALIZE-SCREEN     TO TRUE.                    28350000
283600     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA.    28360000
283700                                                                  28370000
283800     EXEC CICS                                                    28380000
283900         XCTL                                                     28390000
284000             PROGRAM   (PV-TRANSFER-PROGRAM)                      28400000
284100             COMMAREA  (PC192-COMMAREA)                           28410000
284200             LENGTH    (PV-COMMAREA-LENGTH)                       28420000
284300             RESP      (PV-CICS-RESPONSE)                         28430000
284400     END-EXEC.                                                    28440000
284500                                                                  28450000
284600     EVALUATE TRUE                                                28460000
284700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 28470000
284800              CONTINUE                                            28480000
284900         WHEN OTHER                                               28490000
285000             MOVE '4200-XCTL-TO-HELP '                            28500000
285100                 TO DP013-PARAGRAPH                               28510000
285200             MOVE 'SUKRF511 - UNABLE TO XCTL TO PROGRAM: '        28520000
285300                 TO DP013-MESSAGE-TEXT (1)                        28530000
285400             MOVE PV-TRANSFER-PROGRAM                             28540000
285500                 TO DP013-MESSAGE-TEXT (2)                        28550000
285600             SET DP013-CICS-ABEND  TO TRUE                        28560000
285700             SET DP013-ROLLBACK TO TRUE                           28570000
285800             PERFORM 9999-WRITE-CICS-LOG-MSG                      28580000
285900             MOVE PC-TRANS-UNAVAILABLE-MSG TO AMSGLNO             28590000
286000             SET SU006-PROCESS-SCREEN TO TRUE                     28600000
286100             PERFORM 8000-SEND-MAP                                28610000
286200             PERFORM 8200-RETURN-TRANID                           28620000
286300     END-EVALUATE.                                                28630000
286400                                                                  28640000
286500 4300-SELECT-OUTBOUND.                                            28650000
286600                                                                  28660000
286700     EXEC SQL                                                     28670000
286800         SELECT SHIPT_UNT_ID                                      28680000
286900           INTO :SUT00024-SHIPT-UNT-ID                            28690000
287000           FROM SUT_OTBND_CART                                    28700000
287100          WHERE SHIPT_UNT_ID = :DK-SHIPT-UNIT-ID                  28710000
287200     END-EXEC.                                                    28720000
287300                                                                  28730000
287400     EVALUATE SQLCODE                                             28740000
287500         WHEN ZERO                                                28750000
287600             SET PS-OUTBOUND-FOUND    TO TRUE                     28760000
287700         WHEN +100                                                28770000
287800             SET PS-NO-OUTBOUND-FOUND TO TRUE                     28780000
287900         WHEN OTHER                                               28790000
288000              MOVE DK-SHIPT-UNIT-ID TO PV-DISPLAY-SHIPT-UNT-ID    28800000
288100              MOVE '4300-SELECT-OUTBOUND'                         28810000
288200                               TO DP013-PARAGRAPH                 28820000
288300              STRING ' CARTON = '                                 28830000
288400                     PV-DISPLAY-SHIPT-UNT-ID                      28840000
288500                         DELIMITED BY SIZE                        28850000
288600                             INTO DP013-MESSAGE-TEXT (1)          28860000
288700              MOVE SQLCA       TO DP013-SQLCA                     28870000
288800              SET DP013-DB2-ABEND                                 28880000
288900                               TO TRUE                            28890000
289000              PERFORM DP014-0000-PROCESS-ABEND                    28900000
289100     END-EVALUATE.                                                28910000
289200                                                                  28920000
289300 4400-SELECT-SHUNLO-OPER.                                         28930000
289400                                                                  28940000
289500     EXEC SQL                                                     28950000
289600         SELECT A.OPER_UNT_ID                                     28960000
289700         INTO   :SHUNLO-OPER-UNT-ID                               28970000
289800          FROM  TSHUNLO A                                         28980000
289900         WHERE  A.SHIPT_UNT_ID  = :DK-SHIPT-UNIT-ID               28990000
290000     END-EXEC.                                                    29000000
290100                                                                  29010000
290200     EVALUATE TRUE                                                29020000
290300         WHEN SQLCODE = ZERO                                      29030000
290400         WHEN SQLCODE = -811                                      29040000
290500              SET PS-OPER-FOUND  TO TRUE                          29050000
290600         WHEN SQLCODE = +100                                      29060000
290700              SET PS-NO-OPER-FOUND  TO TRUE                       29070000
290800         WHEN SQLWARN0 NOT = SPACES                               29080000
290900         WHEN SQLCODE NOT EQUAL ZERO                              29090000
291000             MOVE '4400-SELECT-SHUNLO-OPER'                       29100000
291100                                        TO DP013-PARAGRAPH        29110000
291200             MOVE 'SELECT OPER'         TO DP013-MESSAGE-TEXT(1)  29120000
291300             MOVE DK-SHIPT-UNIT-ID      TO PV-DISPLAY-SHIPT-UNT-ID29130000
291400             MOVE PV-DISPLAY-SHIPT-UNT-ID                         29140000
291500                                        TO DP013-MESSAGE-TEXT(2)  29150000
291600             MOVE SQLCA                 TO DP013-SQLCA            29160000
291700             MOVE 'TSHUNLO'             TO DP013-DB2-TABLE-NAME(1)29170000
291800             SET DP013-DB2-ABEND                                  29180000
291900                 DP013-NO-ROLLBACK       TO TRUE                  29190000
292000             PERFORM 9999-WRITE-CICS-LOG-MSG                      29200000
292100             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               29210000
292200             PERFORM 8100-SEND-DATA-ONLY                          29220000
292300             PERFORM 8200-RETURN-TRANID                           29230000
292400     END-EVALUATE.                                                29240000
292500                                                                  29250000
292600 4500-CHECK-CARTON-STATUS.                                        29260000
292700                                                                  29270000
292800     INITIALIZE  PC046-COMMAREA-REC.                              29280000
292900     SET   PC046-FROM-CRTN-STAT  TO  TRUE.                        29290000
293000     MOVE  DK-SHIPT-UNIT-ID      TO  PC046-CARTON-ID.             29300000
293100                                                                  29310000
293200                                                                  29320000
293300     CALL PC046-CARTON-STATUS-MODULE                              29330000
293400             USING DFHEIBLK                                       29340000
293500             PC046-COMMAREA                                       29350000
293600             PC046-COMMAREA-REC                                   29360000
293700     END-CALL                                                     29370000
293800                                                                  29380000
293900     IF  PC046-SUCCESSFUL                                         29390000
294000         IF ((PC046-SCANNED-ONTO-TRLR OR                          29400000
294100              PC046-LOADED-ONTO-TRLR)                             29410000
294200                     AND                                          29420000
294300          (PC046-TRIP-STATUS NOT = 'DO' AND 'AO' AND '  '))       29430000
294400             SET  PS-BAD-CRTN-STAT  TO  TRUE                      29440000
294500     ELSE                                                         29450000
294600             SET  PS-GOOD-CRTN-STAT TO  TRUE                      29460000
294700     END-IF.                                                      29470000
294800                                                                  29480000
294900* 12/05/13 JHA BEG                                                29490000
295000******************************************************************29500000
295100* 5000-POPULATE-AUDTYP IN SCREEN                                 *29510000
295200******************************************************************29520000
295300 5000-POPULATE-AUDTYP.                                            29530000
295400                                                                  29540000
295500     MOVE SU006-PO                      TO DK-PO-NBR.             29550000
295600     MOVE SU006-OPER-UNT-ID             TO DK-OPER-UNT-ID         29560000
295700                                           KRPRPM-LOC-ID.         29570000
295800****  GB 3/30/14                                                  29580000
295900     IF SU006-SYSTEM-GENERATED-AUDIT                              29590000
296000       IF SU006-RFID-QC-AUDIT-IND > SPACE                         29600000
296100         CONTINUE                                                 29610000
296200       ELSE                                                       29620000
296300         IF SU006-RFID-AUD-ONLY                                   29630000
296400           SET SU006-RFID-AUDIT TO TRUE                           29640000
296500         ELSE                                                     29650000
296600           SET SU006-QC-AUDIT TO TRUE                             29660000
296700         END-IF                                                   29670000
296800       END-IF                                                     29680000
296900     END-IF.                                                      29690000
297000****  GB 3/30/14                                                  29700000
297001                                                                  29700112
297010**  PO AUDIT EXCEPTIONS OF INTEREST ARE AT THE PO LEVEL,          29701000
297020**  NOT THE PO/LINE LEVEL, SO WE USE ZERO FOR LINE NBR            29702000
297021**  NOT THE PO/PREPACK LEVEL, SO WE USE ZERO FOR PREPACK NBR      29702112
297030     MOVE +0                            TO DK-PO-LNE-NBR          29703012
297031                                           DK-PREPK-ID.           29703112
297040     PERFORM 5100-SELECT-AUD-TYP-CDE.                             29704000
297050                                                                  29705000
297060     IF SU006-MANUAL-GENERATED-AUDIT                              29706000
297070        PERFORM 2200-SELECT-PO                                    29707000
297080        MOVE PURCHS-ENT-ID              TO VNDAGR-ENT-ID          29708000
297090        MOVE PURCHS-DEPT-NBR            TO VNDAGR-DEPT-NBR        29709000
297100                                           DK-DEPT                29710000
297200***RLK 04/14-1 BEG                                                29720000
297300        MOVE SU006-STORE                TO DK-STORE               29730000
297400        PERFORM 2210-CHECK-FOR-ECOM                               29740000
297500***RLK 04/14-2 BEG                                                29750000
297600        PERFORM 2220-CHECK-FOR-RFID-DEPT                          29760000
297610***RLK 04/14-2 END                                                29761000
297620*** IF PO IS ECOM, THEN, LOOKUP FOR RFID CHECK WILL NOT BE        29762000
297630*** PERFORMED AND PROGRAM WILL PROCESS AUDIT AS QC.               29763000
297640        IF PS-ECOM-NO                                             29764000
297650***RLK 04/14-2 BEG                                                29765000
297660          AND PS-RFID-DEPT-YES                                    29766000
297670***RLK 04/14-2 END                                                29767000
297680          PERFORM 5300-GET-VENDOR-CODE                            29768000
297690          PERFORM 5350-CHECK-DC-AUDITING                          29769000
297700        END-IF                                                    29770000
297800***RLK 04/14-1 END                                                29780000
297900                                                                  29790000
298000          PERFORM 5050-CHECK-VENDOR-TAGGING                       29800000
298100                                                                  29810000
298110       IF SUT00014-AUD-TYP-CDE > ' '                              29811000
298120          IF SUT00014-AUD-TYP-CDE = 'A'                           29812000
298130*** IF DC NOT DOING RFID AUDITING, THEN ONLY QC AUDITS ALLOWED    29813000
298140            IF PS-DC-RFID-AUDIT-YES                               29814000
298150              IF SU006-QC-AND-RFID-AUD                            29815000
298160                MOVE '*** 100%  COMBO  ***'   TO AUDTYPO          29816000
298170              ELSE                                                29817000
298180                MOVE '*** 100% QC ***'        TO AUDTYPO          29818000
298190              END-IF                                              29819000
298200            ELSE                                                  29820000
298300              MOVE '*** 100% QC ***'            TO AUDTYPO        29830000
298400            END-IF                                                29840000
298500***     THE FOLLOWING ELSE MEANS SUT00014-AUD-TYPE-CDE <> 'A'     29850000
298600          ELSE                                                    29860000
298700            IF SUT00014-AUD-TYP-CDE = 'R'                         29870000
298800                MOVE '*** 100% RFID ***'  TO AUDTYPO              29880000
298900            ELSE                                                  29890000
299000              IF SUT00014-AUD-TYP-CDE = 'Q'                       29900000
299100                MOVE '*** 100% QC ***'    TO AUDTYPO              29910000
299200              ELSE                                                29920000
299300                IF SUT00014-AUD-TYP-CDE = 'N'                     29930000
299400                   MOVE '***DC MANUAL***'    TO AUDTYPO           29940000
299500                END-IF                                            29950000
299600              END-IF                                              29960000
299700            END-IF                                                29970000
299800          END-IF                                                  29980000
299900*** THE FOLLOWING ELSE MEANS SUT00014-AUD-TYPE-CDE = SPACES       29990000
300000       ELSE                                                       30000000
300100**     USER HAS SELECTED WHAT TYPE OF MANUAL AUDIT TO BE PERFORMED30010000
300200        IF SU006-100-AUDIT-CHECK                                  30020000
300300           MOVE '*** DC 100% ***'       TO AUDTYPO                30030000
300400        ELSE                                                      30040000
300500           IF SU006-SPOT-AUDIT-CHECK                              30050000
300600             IF SU006-QC-AND-RFID-AUD                             30060000
300700              MOVE '***DC MNL COMBO***' TO AUDTYPO                30070000
300800             ELSE                                                 30080000
300900              MOVE '***DC MANUAL QC***' TO AUDTYPO                30090000
301000             END-IF                                               30100000
301100           ELSE                                                   30110000
301200              IF SU006-REWORK-AUDIT-CHECK                         30120000
301300                 MOVE '*** REWORK ***'  TO AUDTYPO                30130000
301400              ELSE                                                30140000
301500**              NOT A VALID SELECTION                             30150000
301600                 CONTINUE                                         30160000
301700              END-IF                                              30170000
301800           END-IF                                                 30180000
301900        END-IF                                                    30190000
302000       END-IF                                                     30200000
302100     ELSE                                                         30210000
302200***RLK 04/14 BEG                                                  30220000
302300*** IF AN OPEN QC AUDIT EXISTS FOR THIS CARTON,BUT, AN RFID       30230000
302400*** AUDIT NBR WAS ENTERED IT WILL BE CONVERTED TO A COMBO AUDIT.  30240000
302500       IF SU006-RFID-AUD-ONLY                                     30250000
302600         SET PS-QC-AUDIT-NOT-EXISTS TO TRUE                       30260000
302700         PERFORM 3300-CHECK-FOR-OPEN-QC-AUDIT                     30270000
302800         IF PS-QC-AUDIT-EXISTS                                    30280000
302900           SET SU006-QC-AUDIT TO TRUE                             30290000
303000           SET SU006-QC-AND-RFID-AUD TO TRUE                      30300000
303100           MOVE SU006-AUDIT-CNTL-NBR TO SU006-RFID-AUDIT-CNTL-NBR 30310000
303200           MOVE SUT00015-AUD-CNTL-NBR TO SU006-AUDIT-CNTL-NBR     30320000
303300         END-IF                                                   30330000
303310       END-IF                                                     30331000
303320***RLK 04/14 END                                                  30332000
303330*** SUT00014-AUD-TYP-CDE = 'A' INDICATES A PO AUDIT EXCEPTION     30333000
303340       IF SUT00014-AUD-TYP-CDE = 'A'                              30334000
303350         IF SU006-100-AUDIT-CHECK                                 30335000
303360           MOVE '*** 100% QC ***'            TO AUDTYPO           30336000
303370           SET SU006-QC-AUD-ONLY           TO TRUE                30337000
303380         ELSE                                                     30338000
303390           IF SU006-SPOT-AUDIT-CHECK                              30339000
303400             MOVE '*** 100% RFID ***'        TO AUDTYPO           30340000
303500             SET SU006-RFID-AUD-ONLY         TO TRUE              30350000
303600           ELSE                                                   30360000
303700             IF SU006-REWORK-AUDIT-CHECK                          30370000
303800               MOVE '*** 100%  COMBO  ***'   TO AUDTYPO           30380000
303900               SET SU006-QC-AND-RFID-AUD         TO TRUE          30390000
304000             END-IF                                               30400000
304100           END-IF                                                 30410000
304200         END-IF                                                   30420000
304300*** THE FOLLOWING ELSE MEANS SUT00014-AUD-TYPE-CDE <> 'A'         30430000
304400       ELSE                                                       30440000
304500         IF SU006-RFID-AUDIT-CNTL-NBR > 0                         30450000
304600*** THE ABOVE FIELD IS ONLY POPULATED WHERE THERE IS BOTH         30460000
304700***     A PROMPTED AND RFID AUDIT                                 30470000
304800           SET PS-CARTON-FOUND-NO TO TRUE                         30480000
304900           MOVE SU006-RFID-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR    30490000
305000           MOVE SU006-SHIP-UNIT-NBR  TO DK-SHIPT-UNIT-ID          30500000
305100           PERFORM 5060-CHECK-FOR-CRTN-IN-AUD                     30510000
305200           IF PS-CARTON-FOUND                                     30520000
305300             MOVE '***  COMBO  ***'            TO AUDTYPO         30530000
305400             SET SU006-QC-AND-RFID-AUD         TO TRUE            30540000
305500           ELSE                                                   30550000
305600             MOVE '*** QCAUDIT ***'          TO AUDTYPO           30560000
305700             SET SU006-QC-AUD-ONLY           TO TRUE              30570000
305800             MOVE 0 TO SU006-RFID-AUDIT-CNTL-NBR                  30580000
305900           END-IF                                                 30590000
306000         ELSE                                                     30600000
306100           IF SU006-RFID-AUDIT                                    30610000
306200               MOVE '*** RF ONLY ***'          TO AUDTYPO         30620000
306300               SET SU006-RFID-AUD-ONLY         TO TRUE            30630000
306400           ELSE                                                   30640000
306500             MOVE '*** QCAUDIT ***'          TO AUDTYPO           30650000
306600             SET SU006-QC-AUD-ONLY           TO TRUE              30660000
306700           END-IF                                                 30670000
306800         END-IF                                                   30680000
306900       END-IF                                                     30690000
307000     END-IF.                                                      30700000
307100                                                                  30710000
307200     MOVE DP015-PRO-NOR-OFF      TO AUDTYPA.                      30720000
307300*** BECAUSE A COMBO AUDIT MAY HAVE MORE QC CARTONS THAN RF WE     30730000
307400*** NEED TO CHECK EACH CARTON TO VERIFY IT IS FOR RF. IF NOT      30740000
307500*** WE NEED TO RESET SU006 INDICATORS SO AUDIT PROCESS ONLY       30750000
307600*** PROCESSES QC DATA. THIS ONLY APPLIES TO SYSTEM PROMPTED       30760000
307700*** AUDITS.                                                       30770000
307800     IF SU006-MANUAL-GENERATED-AUDIT                              30780000
307900       IF SU006-RFID-QC-AUDIT-IND > SPACE                         30790000
308000         CONTINUE                                                 30800000
308100       ELSE                                                       30810000
308200         IF SU006-RFID-AUD-ONLY                                   30820000
308300           SET SU006-RFID-AUDIT TO TRUE                           30830000
308400         ELSE                                                     30840000
308500****  GB 3/30/14                                                  30850000
308510           SET SU006-QC-AUDIT TO TRUE                             30851000
308520****  GB 3/30/14                                                  30852000
308530         END-IF                                                   30853000
308540       END-IF                                                     30854000
308550     ELSE                                                         30855000
308560       IF SU006-QC-AND-RFID-AUD                                   30856000
308570         SET PS-CARTON-FOUND-NO TO TRUE                           30857000
308580         MOVE SU006-RFID-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR      30858000
308590         MOVE SU006-SHIP-UNIT-NBR  TO DK-SHIPT-UNIT-ID            30859000
308600         PERFORM 5060-CHECK-FOR-CRTN-IN-AUD                       30860000
308700         IF PS-CARTON-FOUND                                       30870000
308800           SET PS-CARTON-FOUND-NO TO TRUE                         30880000
308900           MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR         30890000
309000           MOVE SU006-SHIP-UNIT-NBR  TO DK-SHIPT-UNIT-ID          30900000
309100           PERFORM 5060-CHECK-FOR-CRTN-IN-AUD                     30910000
309200           IF PS-CARTON-FOUND                                     30920000
309300             CONTINUE                                             30930000
309400           ELSE                                                   30940000
309500             SET SU006-RFID-AUD-ONLY TO TRUE                      30950000
309600             SET SU006-RFID-AUDIT TO TRUE                         30960000
309700           END-IF                                                 30970000
309800         ELSE                                                     30980000
309900           SET SU006-QC-AUD-ONLY TO TRUE                          30990000
310000           SET SU006-QC-AUDIT TO TRUE                             31000000
310100         END-IF                                                   31010000
310200       END-IF                                                     31020000
310300     END-IF.                                                      31030000
310400                                                                  31040000
310500******************************************************************31050000
310600* 5050-CHECK-VENDOR-TAGGING.                                      31060000
310700* FOR MANUAL AUDITS, IF AN RFID AUDIT WAS PERFORMED ON THIS       31070000
310800* PO,RCVR, THEN, THIS WILL BE A COMBINED QC/RFID AUDIT.           31080000
310900******************************************************************31090000
311000 5050-CHECK-VENDOR-TAGGING.                                       31100000
311100                                                                  31110000
311200     IF SUT00014-AUD-TYP-CDE = 'Q'                                31120000
311300       OR PS-ECOM-YES                                             31130000
311400***   USER HAS SPECIFIED 100% QC ONLY IN AUDIT. RFID NOT INCLUDED.31140000
311500***   OR PO IS ECOM AND RFID NOT INCLUDED.                        31150000
311600        SET SU006-QC-AUD-ONLY                TO TRUE              31160000
311700        SET SU006-QC-AUDIT                   TO TRUE              31170000
311710     ELSE                                                         31171000
311720        IF SUT00014-AUD-TYP-CDE = 'R'                             31172000
311730***      USER HAS SPECIFIED RFID TO BE INCLUDED IN AUDIT EVEN IF  31173000
311740***      VENDOR IS COMPLIANT                                      31174000
311750             SET SU006-RFID-AUDIT            TO TRUE              31175000
311760             SET SU006-RFID-AUD-ONLY         TO TRUE              31176000
311770        ELSE                                                      31177000
311780*** IF DC NOT DOING RFID AUDITING, THEN ONLY QC AUDITS ALLOWED    31178000
311790          IF SUT00014-AUD-TYP-CDE = 'A'                           31179000
311800            IF PS-DC-RFID-AUDIT-YES                               31180000
311900***         USER HAS SPECIFIED BOTH QC AND RFID (PROVIDED VENDOR  31190000
312000***         IS TAGGING(CODE 11) OR COMPLIANT(CODE 12))            31200000
312100              IF VNDAGR-TYP-CDE = 11                              31210000
312200              OR VNDAGR-TYP-CDE = 12                              31220000
312300                 SET SU006-QC-AND-RFID-AUD   TO TRUE              31230000
312400              ELSE                                                31240000
312500                 SET SU006-QC-AUD-ONLY       TO TRUE              31250000
312600              END-IF                                              31260000
312700            ELSE                                                  31270000
312800                 SET SU006-QC-AUD-ONLY       TO TRUE              31280000
312900            END-IF                                                31290000
313000          ELSE                                                    31300000
313100            IF PS-DC-RFID-AUDIT-YES                               31310000
313200***         NO PO EXCEPTION.  THERE WILL ALWAYS BE A QC AUDIT AND 31320000
313300***         MAYBE RFID AS WELL IF VENDOR TAGS AND ISN'T COMPLIANT 31330000
313400              SET SU006-QC-AUDIT             TO TRUE              31340000
313500              IF VNDAGR-TYP-CDE = 11                              31350000
313600                 SET SU006-QC-AND-RFID-AUD   TO TRUE              31360000
313700              ELSE                                                31370000
313800                 SET SU006-QC-AUD-ONLY       TO TRUE              31380000
313900              END-IF                                              31390000
314000            ELSE                                                  31400000
314100*** IF DC IS NOT RF AUDITING AUDIT WILL BE QC ONLY                31410000
314200              SET SU006-QC-AUD-ONLY       TO TRUE                 31420000
314300            END-IF                                                31430000
314400          END-IF                                                  31440000
314500        END-IF                                                    31450000
314600     END-IF.                                                      31460000
314700                                                                  31470000
314800******************************************************************31480000
314900* 5060-CHECK-FOR-CRTN-IN-AUD                                   *  31490000
315000* THIS CHECK WILL DETERMINE IF CARTON IS ALSO IN AUDIT           *31500000
315100******************************************************************31510000
315200 5060-CHECK-FOR-CRTN-IN-AUD.                                      31520000
315300                                                                  31530000
315400     EXEC SQL                                                     31540000
315500          SELECT 'Y'                                              31550000
315600          INTO :PS-CARTON-FOUND-SW                                31560000
315700          FROM TSUATRN                                            31570000
315800          WHERE AUD_CNTL_NBR      = :DK-AUDIT-CNTL-NBR            31580000
315900            AND SHIPT_UNT_ID      = :DK-SHIPT-UNIT-ID             31590000
316000          WITH UR                                                 31600000
316100     END-EXEC.                                                    31610000
316200                                                                  31620000
316300     EVALUATE TRUE                                                31630000
316400         WHEN SQLCODE = +0                                        31640000
316500*** THIS WILL VERIFY THAT AUDIT IS STILL OPEN. IF NOT IT IS       31650000
316600*** THE SAME AS CARTON NOT FOUND.                                 31660000
316700           PERFORM 3400-CHECK-FOR-OPEN-AUDIT                      31670000
316800           IF PS-OPEN-AUDIT-YES                                   31680000
316900             SET  PS-CARTON-FOUND TO TRUE                         31690000
317000           ELSE                                                   31700000
317100             SET PS-CARTON-FOUND-NO TO TRUE                       31710000
317200           END-IF                                                 31720000
317300         WHEN SQLCODE = +100                                      31730000
317400             SET PS-CARTON-FOUND-NO TO TRUE                       31740000
317500                                                                  31750000
317600         WHEN SQLWARN0 NOT = SPACES                               31760000
317700         WHEN SQLCODE NOT EQUAL ZERO                              31770000
317800             MOVE '5060-CHECK-FOR-CRTN-IN-AUD'                    31780000
317900                             TO DP013-PARAGRAPH                   31790000
318000             MOVE 'ERROR ON SELECT'                               31800000
318100                             TO DP013-MESSAGE-TEXT(1)             31810000
318200             MOVE DK-PO-NBR  TO DP013-MESSAGE-TEXT(2)             31820000
318300             MOVE DK-PO-LNE-NBR                                   31830000
318400                             TO DP013-MESSAGE-TEXT(3)             31840000
318500             MOVE DK-OPER-UNT-ID                                  31850000
318600                             TO DP013-MESSAGE-TEXT(4)             31860000
318700             MOVE SQLCA      TO DP013-SQLCA                       31870000
318800             MOVE 'SUT_PO_AUD_EXC'                                31880000
318900                             TO DP013-DB2-TABLE-NAME(1)           31890000
319000             MOVE 'TSUATRN'                                       31900000
319100                             TO DP013-DB2-TABLE-NAME(2)           31910000
319200             SET DP013-DB2-ABEND                                  31920000
319300                             TO TRUE                              31930000
319400             SET DP013-NO-ROLLBACK                                31940000
319500                             TO TRUE                              31950000
319600             SET DP013-XCTL-DISPLAY-RESTART                       31960000
319700                             TO TRUE                              31970000
319800             PERFORM DP014-0000-PROCESS-ABEND                     31980000
319900                                                                  31990000
320000     END-EVALUATE.                                                32000000
320100                                                                  32010000
320200******************************************************************32020000
320300* 5100-SELECT-AUD-TYP-CDE                                        *32030000
320400******************************************************************32040000
320500 5100-SELECT-AUD-TYP-CDE.                                         32050000
320600                                                                  32060000
320700     EXEC SQL                                                     32070000
320800          SELECT AUD_TYP_CDE                                      32080000
320900            INTO :SUT00014-AUD-TYP-CDE                            32090000
321000            FROM SUT_PO_AUD_EXC                                   32100000
321100           WHERE PO_NBR         = :DK-PO-NBR                      32110000
321200             AND PO_LNE_NBR     = :DK-PO-LNE-NBR                  32120000
321210             AND PO_PREPK_ID    = :DK-PREPK-ID                    32121012
321300             AND OPER_UNT_ID    = :DK-OPER-UNT-ID                 32130000
321400           WITH UR                                                32140000
321500     END-EXEC.                                                    32150000
321600                                                                  32160000
321700     EVALUATE TRUE                                                32170000
321800         WHEN SQLCODE = +0                                        32180000
321900             CONTINUE                                             32190000
322000                                                                  32200000
322100         WHEN SQLCODE = +100                                      32210000
322200             MOVE SPACES     TO SUT00014-AUD-TYP-CDE              32220000
322300                                                                  32230000
322400         WHEN SQLWARN0 NOT = SPACES                               32240000
322500         WHEN SQLCODE NOT EQUAL ZERO                              32250000
322600             MOVE '5100-SELECT-AUD-TYP-CDE'                       32260000
322700                             TO DP013-PARAGRAPH                   32270000
322800             MOVE 'ERROR ON SELECT'                               32280000
322900                             TO DP013-MESSAGE-TEXT(1)             32290000
323000             MOVE DK-PO-NBR  TO DP013-MESSAGE-TEXT(2)             32300000
323100             MOVE DK-PO-LNE-NBR                                   32310000
323200                             TO DP013-MESSAGE-TEXT(3)             32320000
323300             MOVE DK-OPER-UNT-ID                                  32330000
323400                             TO DP013-MESSAGE-TEXT(4)             32340000
323500             MOVE SQLCA      TO DP013-SQLCA                       32350000
323600             MOVE 'SUT_PO_AUD_EXC'                                32360000
323700                             TO DP013-DB2-TABLE-NAME(1)           32370000
323800             SET DP013-DB2-ABEND                                  32380000
323900                             TO TRUE                              32390000
324000             SET DP013-NO-ROLLBACK                                32400000
324100                             TO TRUE                              32410000
324200             SET DP013-XCTL-DISPLAY-RESTART                       32420000
324300                             TO TRUE                              32430000
324400             PERFORM DP014-0000-PROCESS-ABEND                     32440000
324500                                                                  32450000
324600     END-EVALUATE.                                                32460000
324700                                                                  32470000
324800******************************************************************32480000
324900* 5200-IS-PO-FOR-RFID-DEPT                                       *32490000
325000******************************************************************32500000
325100 5200-IS-PO-FOR-RFID-DEPT.                                        32510000
325200                                                                  32520000
325300     EXEC SQL                                                     32530000
325400         SELECT  'Y'                                              32540000
325500           INTO  :PV-PO-IS-RFID-IND                               32550000
325600           FROM TSHUUPC          C                                32560000
325700              , XLT_UPC          P                                32570000
325800              , XLT_SKU          S                                32580000
325900              , XLT_VND_STYL     V                                32590000
326000              , (SELECT DEPT_NBR                                  32600000
326100                   FROM RIT_RFID_VRFN F                           32610000
326200                  WHERE F.STR_NBR      = 0                        32620000
326300                    AND F.SUB_CL_NBR   = 0                        32630000
326400                    AND F.MAJ_CL_NBR   = 0                        32640000
326500                    AND F.RFID_LVL_CDE = 'DPTSCL'                 32650000
326600                    AND CURRENT DATE BETWEEN DATE(EFF_STRT_TMST)  32660000
326700                                     AND DATE(EFF_END_TMST)) E    32670000
326800          WHERE C.TRN_NBR         = :SHUUPC-TRN-NBR               32680000
326900            AND C.UPC_NBR         = P.UPC_NBR                     32690000
327000            AND P.INTR_UPC_ID     = S.INTR_UPC_ID                 32700000
327100            AND V.STYL_ID         = S.STYL_ID                     32710000
327200            AND V.DEPT_NBR        = E.DEPT_NBR                    32720000
327300          FETCH FIRST 1 ROWS ONLY                                 32730000
327400           WITH UR                                                32740000
327500     END-EXEC.                                                    32750000
327600                                                                  32760000
327700     EVALUATE TRUE                                                32770000
327800         WHEN SQLCODE = +0                                        32780000
327900            CONTINUE                                              32790000
328000                                                                  32800000
328100         WHEN SQLCODE = +100                                      32810000
328200            MOVE 'N'             TO PV-PO-IS-RFID-IND             32820000
328300                                                                  32830000
328400         WHEN OTHER                                               32840000
328500            MOVE '5200-IS-PO-FOR-RFID-DEPT'                       32850000
328600                                 TO DP013-PARAGRAPH               32860000
328700            MOVE 'ERROR ON SELECT'                                32870000
328800                                 TO DP013-MESSAGE-TEXT(1)         32880000
328900            MOVE SHUUPC-TRN-NBR  TO DP013-MESSAGE-TEXT(2)         32890000
329000            MOVE SQLCA           TO DP013-SQLCA                   32900000
329100            MOVE 'TSHUUPC'       TO DP013-DB2-TABLE-NAME(1)       32910000
329200            SET DP013-DB2-ABEND  TO TRUE                          32920000
329300            SET DP013-NO-ROLLBACK                                 32930000
329400                                 TO TRUE                          32940000
329500            SET DP013-XCTL-DISPLAY-RESTART                        32950000
329600                                 TO TRUE                          32960000
329700            PERFORM DP014-0000-PROCESS-ABEND                      32970000
329800     END-EVALUATE.                                                32980000
329900                                                                  32990000
330000******************************************************************33000000
330100* 5300-GET-VENDOR-CODE.                                          *33010000
330200******************************************************************33020000
330300 5300-GET-VENDOR-CODE.                                            33030000
330400                                                                  33040000
330500     EXEC SQL                                                     33050000
330600          SELECT TYP_CDE                                          33060000
330700            INTO :VNDAGR-TYP-CDE                                  33070000
330800            FROM TVNDAGR                                          33080000
330900           WHERE ENT_ID          = :VNDAGR-ENT-ID                 33090000
331000             AND DEPT_NBR        = :VNDAGR-DEPT-NBR               33100000
331100             AND AGRMT_TYP_ID    = '4'                            33110000
331200             AND TYP_CDE      IN (11,12)                          33120000
331300             AND EFFECTIVE_DATE <= CURRENT DATE                   33130000
331400             AND EXPIRATION_DATE > CURRENT DATE                   33140000
331500             ORDER BY TYP_CDE                                     33150000
331600            FETCH FIRST 1 ROW ONLY                                33160000
331700           WITH UR                                                33170000
331800     END-EXEC.                                                    33180000
331900                                                                  33190000
332000     EVALUATE TRUE                                                33200000
332100         WHEN SQLCODE = +0                                        33210000
332200             CONTINUE                                             33220000
332300                                                                  33230000
332400         WHEN SQLCODE = +100                                      33240000
332500             MOVE ZEROES         TO VNDAGR-TYP-CDE                33250000
332600                                                                  33260000
332700         WHEN OTHER                                               33270000
332800            MOVE '5300-GET-VENDOR-CODE'                           33280000
332900                                 TO DP013-PARAGRAPH               33290000
333000            MOVE 'ERROR ON SELECT'                                33300000
333100                                 TO DP013-MESSAGE-TEXT(1)         33310000
333200            MOVE VNDAGR-ENT-ID   TO DP013-MESSAGE-TEXT(2)         33320000
333300            MOVE VNDAGR-DEPT-NBR TO DP013-MESSAGE-TEXT(3)         33330000
333400            MOVE SQLCA           TO DP013-SQLCA                   33340000
333500            MOVE 'TVNDAGR'       TO DP013-DB2-TABLE-NAME(1)       33350000
333600            SET DP013-DB2-ABEND  TO TRUE                          33360000
333700            SET DP013-NO-ROLLBACK                                 33370000
333800                                 TO TRUE                          33380000
333900            SET DP013-XCTL-DISPLAY-RESTART                        33390000
334000                                 TO TRUE                          33400000
334100            PERFORM DP014-0000-PROCESS-ABEND                      33410000
334200     END-EVALUATE.                                                33420000
334300                                                                  33430000
334400******************************************************************33440000
334500* 5350-CHECK-DC-AUDITING.                                        *33450000
334600******************************************************************33460000
334700 5350-CHECK-DC-AUDITING.                                          33470000
334800                                                                  33480000
334900     EXEC SQL                                                     33490000
335000          SELECT SYS_PRC_FUNC_CDE                                 33500000
335100          INTO :KRPRPM-SYS-PRC-FUNC-CDE                           33510000
335200          FROM TKRPRPM                                            33520000
335300          WHERE SYS_PRC_FUNC_CDE  = 'RFDAUD'                      33530000
335400            AND LOC_ID            = :KRPRPM-LOC-ID                33540000
335500            AND FUNC_PRC_STAT_CDE = 'AC'                          33550000
335600            AND INTFC_SYS_CDE     = 'KHL'                         33560000
335700            AND FUNC_TXT = 'Y'                                    33570000
335800           WITH UR                                                33580000
335900     END-EXEC.                                                    33590000
336000                                                                  33600000
336100     EVALUATE TRUE                                                33610000
336200         WHEN SQLCODE = +0                                        33620000
336300*** DC IS DOING RFID AUDITING                                     33630000
336400             SET PS-DC-RFID-AUDIT-YES TO TRUE                     33640000
336500                                                                  33650000
336600         WHEN SQLCODE = +100                                      33660000
336700*** DC IS NOT DOING RFID AUDITING                                 33670000
336800             SET PS-DC-RFID-AUDIT-NO  TO TRUE                     33680000
336900                                                                  33690000
337000         WHEN OTHER                                               33700000
337100            MOVE '5350-CHECK-DC-AUDITING'                         33710000
337200                                 TO DP013-PARAGRAPH               33720000
337300            MOVE 'ERROR ON SELECT'                                33730000
337400                                 TO DP013-MESSAGE-TEXT(1)         33740000
337500            MOVE KRPRPM-LOC-ID   TO DP013-MESSAGE-TEXT(2)         33750000
337600            MOVE SQLCA           TO DP013-SQLCA                   33760000
337700            MOVE 'TKRPRPM'       TO DP013-DB2-TABLE-NAME(1)       33770000
337800            SET DP013-DB2-ABEND  TO TRUE                          33780000
337900            SET DP013-NO-ROLLBACK                                 33790000
338000                                 TO TRUE                          33800000
338100            SET DP013-XCTL-DISPLAY-RESTART                        33810000
338200                                 TO TRUE                          33820000
338300            PERFORM DP014-0000-PROCESS-ABEND                      33830000
338400     END-EVALUATE.                                                33840000
338500                                                                  33850000
338600* 12/05/13 JHA END                                                33860000
338700******************************************************************33870000
338800*  8000-SEND-MAP                                                 *33880000
338900*  SEND THE REFRESHED MAP IMAGE TO THE SCREEN                    *33890000
339000******************************************************************33900000
339100 8000-SEND-MAP.                                                   33910000
339200     EXEC CICS                                                    33920000
339300         SEND                                                     33930000
339400             MAP     ('SU511A')                                   33940000
339500             MAPSET  ('SUKM511')                                  33950000
339600             ERASE                                                33960000
339700             RESP    (PV-CICS-RESPONSE)                           33970000
339800     END-EXEC.                                                    33980000
339900                                                                  33990000
340000     EVALUATE TRUE                                                34000000
340100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 34010000
340200             CONTINUE                                             34020000
340300         WHEN OTHER                                               34030000
340400             MOVE '8000-SEND-MAP'   TO DP013-PARAGRAPH            34040000
340500             MOVE 'UNABLE TO SEND MAP'                            34050000
340600                                    TO DP013-MESSAGE-TEXT (1)     34060000
340700             SET DP013-CICS-ABEND   TO TRUE                       34070000
340800             SET DP013-NO-ROLLBACK  TO TRUE                       34080000
340900             PERFORM 9999-WRITE-CICS-LOG-MSG                      34090000
341000     END-EVALUATE.                                                34100000
341100*                                                                 34110000
341200 8100-SEND-DATA-ONLY.                                             34120000
341300                                                                  34130000
341400     EXEC CICS                                                    34140000
341500         SEND                                                     34150000
341600             MAP       ('SU511A')                                 34160000
341700             MAPSET    ('SUKM511')                                34170000
341800             CURSOR                                               34180000
341900             DATAONLY                                             34190000
342000             RESP      (PV-CICS-RESPONSE)                         34200000
342100     END-EXEC.                                                    34210000
342200                                                                  34220000
342300     EVALUATE TRUE                                                34230000
342400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 34240000
342500             CONTINUE                                             34250000
342600         WHEN OTHER                                               34260000
342700             MOVE '8100-SEND-DATA-ONLY'                           34270000
342800                                    TO DP013-PARAGRAPH            34280000
342900             MOVE 'UNABLE TO SEND DATA'                           34290000
343000                                    TO DP013-MESSAGE-TEXT (1)     34300000
343100             SET DP013-CICS-ABEND   TO TRUE                       34310000
343200             SET DP013-NO-ROLLBACK  TO TRUE                       34320000
343300             PERFORM 9999-WRITE-CICS-LOG-MSG                      34330000
343400     END-EVALUATE.                                                34340000
343500*                                                                 34350000
343600 8200-RETURN-TRANID.                                              34360000
343700     MOVE LENGTH OF CA-COMMAREA  TO  PV-COMMAREA-LENGTH.          34370000
343800                                                                  34380000
343900     EXEC CICS                                                    34390000
344000         RETURN                                                   34400000
344100             TRANSID   (PC-CURRENT-TRANID)                        34410000
344200             COMMAREA  (CA-COMMAREA)                              34420000
344300             LENGTH    (PV-COMMAREA-LENGTH)                       34430000
344400             RESP      (PV-CICS-RESPONSE)                         34440000
344500     END-EXEC.                                                    34450000
344600                                                                  34460000
344700     EVALUATE TRUE                                                34470000
344800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 34480000
344900             CONTINUE                                             34490000
345000         WHEN OTHER                                               34500000
345100             MOVE '8200-RETURN-TRANID'                            34510000
345200                                    TO DP013-PARAGRAPH            34520000
345300             MOVE 'UNABLE TO RETURN TO TRANID'                    34530000
345400                                    TO DP013-MESSAGE-TEXT (1)     34540000
345500             SET DP013-CICS-ABEND   TO TRUE                       34550000
345600             SET DP013-NO-ROLLBACK  TO TRUE                       34560000
345700             PERFORM 9999-WRITE-CICS-LOG-MSG                      34570000
345800     END-EVALUATE.                                                34580000
345900*                                                                 34590000
346000*                                                                 34600000
346100 9999-WRITE-CICS-LOG-MSG.                                         34610000
346200     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            34620000
346300     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           34630000
346400     INITIALIZE DP013-SRC-TASK-NUMBER                             34640000
346500                DP013-STACK.                                      34650000
346600     SET DP013-LINK-RETURN           TO TRUE.                     34660000
346700                                                                  34670000
346800     EXEC CICS                                                    34680000
346900         LINK                                                     34690000
347000             PROGRAM   (DP013-NAME)                               34700000
347100             COMMAREA  (DP013-PARAMETERS)                         34710000
347200             LENGTH    (DP013-LENGTH)                             34720000
347300     END-EXEC.                                                    34730000
347400                                                                  34740000
347500*----------------------------------------------------------------*34750000
347600*    ABEND PROCESSOR MODULE                                      *34760000
347700*----------------------------------------------------------------*34770000
347800                                                                  34780000
347900     COPY DPPD014.                                                34790000
348000                                                                  34800000
