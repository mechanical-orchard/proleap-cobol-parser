000100 IDENTIFICATION DIVISION.                                         00010008
000200 PROGRAM-ID.      EPKUT351.                                       00020008
000300 AUTHOR.          COGNIZANT.                                      00030008
000400 DATE-WRITTEN.    SEPTEMBER,2013.                                 00040008
000500                                                                  00050008
000600*-----------------------------------------------------------      00060008
000700*       TIERED PRICING CORRECTION IDENTIFIER                      00070020
000800*-----------------------------------------------------------      00080008
000900*-----------------------------------------------------------      00090008
001000* HISTORY LOG:                                                    00100008
001100*-----------------------------------------------------------      00110008
001200* DATE: 09/30/2013                                                00120046
001300* WR/IR#:                                                         00130046
001400* PROGRAMMER: COGNIZANT                                           00140046
001500* THIS PROGRAM IS A MODIFIED VERSION OF EPKUT122.                 00150046
001600* DESCRIPTION: REMOVED THE EMERGENCY FILE EXTRACT PROCESS IN THE  00160046
001700*   NIGHTLY CYCLE. THIS IS DONE TO AVOID SORTING ISSUE FOR PROMO  00170046
001800*   SEND TO STORES.                                               00180046
005502* DATE:                                                           00190008
005503* WR/IR#:                                                         00200008
005504* PROGRAMMER:                                                     00210008
005505* DESCRIPTION:                                                    00220008
005506*                                                                 00230008
005507*----------------------------------------------------------       00240008
005508 ENVIRONMENT DIVISION.                                            00250008
005509*----------------------------------------------------------       00260008
005510 CONFIGURATION SECTION.                                           00270008
005511 SOURCE-COMPUTER.        IBM-3090.                                00280008
005512 OBJECT-COMPUTER.        IBM-3090.                                00290008
005513                                                                  00300008
005514 INPUT-OUTPUT SECTION.                                            00310008
005515                                                                  00320008
005516 FILE-CONTROL.                                                    00330008
005517                                                                  00340008
005518     SELECT CONTROL-CARD-PGM-LAST-RUN-TMST                        00350008
005519       ASSIGN TO INP01.                                           00360015
005520     SELECT CONTROL-CARD-PGM-CURR-TMST                            00370008
005521       ASSIGN TO INP02.                                           00380015
005522     SELECT CONTROL-CARD-CURR-PRICG-DTE                           00390008
005523       ASSIGN TO INP03.                                           00400015
005524     SELECT CONTROL-CARD-FUTRE-CORR-DTE                           00410008
005525       ASSIGN TO INP04.                                           00420015
005526     SELECT CONTROL-CARD-CRIT-EFF-DTE                             00430008
005527       ASSIGN TO INP05.                                           00440015
005528     SELECT PROMO-NIGHT-FILE                                      00450008
005529       ASSIGN TO OUT01.                                           00460015
005530                                                                  00470008
005531 DATA DIVISION.                                                   00480008
005532 FILE SECTION.                                                    00490008
005533                                                                  00500008
005534 FD  CONTROL-CARD-PGM-LAST-RUN-TMST                               00510008
005535     RECORDING MODE F                                             00520008
005536     BLOCK CONTAINS 0 RECORDS                                     00530008
005537     LABEL RECORDS ARE OMITTED                                    00540008
005538     DATA RECORD IS CNTRL-CARD-PGM-LAST-RUN-REC.                  00550008
005539 01  CNTRL-CARD-PGM-LAST-RUN-REC                   PIC  X(080).   00560008
005540                                                                  00570008
005541 FD  CONTROL-CARD-PGM-CURR-TMST                                   00580008
005542     RECORDING MODE F                                             00590008
005543     BLOCK CONTAINS 0 RECORDS                                     00600008
005544     LABEL RECORDS ARE OMITTED                                    00610008
005545     DATA RECORD IS CNTRL-CARD-PGM-CURR-RUN-REC.                  00620008
005546 01  CNTRL-CARD-PGM-CURR-RUN-REC                   PIC  X(080).   00630008
005547                                                                  00640045
005548 FD  CONTROL-CARD-CURR-PRICG-DTE                                  00650008
005549     RECORDING MODE F                                             00660008
005550     BLOCK CONTAINS 0 RECORDS                                     00670008
005551     LABEL RECORDS ARE OMITTED                                    00680008
005552     DATA RECORD IS CNTRL-CARD-CURR-PRICG-DTE-REC.                00690008
005553 01  CNTRL-CARD-CURR-PRICG-DTE-REC                 PIC  X(080).   00700008
005554                                                                  00710008
005555 FD  CONTROL-CARD-FUTRE-CORR-DTE                                  00720008
005556     RECORDING MODE F                                             00730008
005557     BLOCK CONTAINS 0 RECORDS                                     00740008
005558     LABEL RECORDS ARE OMITTED                                    00750008
005559     DATA RECORD IS CNTRL-CARD-FUTRE-CORR-DTE-REC.                00760008
005560 01  CNTRL-CARD-FUTRE-CORR-DTE-REC                 PIC  X(080).   00770008
005561                                                                  00780008
005562 FD  CONTROL-CARD-CRIT-EFF-DTE                                    00790008
005563     RECORDING MODE F                                             00800008
005564     BLOCK CONTAINS 0 RECORDS                                     00810008
005565     LABEL RECORDS ARE OMITTED                                    00820008
005566     DATA RECORD IS CNTRL-CARD-CRIT-EFF-DTE-REC.                  00830008
005567 01  CNTRL-CARD-CRIT-EFF-DTE-REC                   PIC  X(080).   00840008
005568                                                                  00850008
005569 FD  PROMO-NIGHT-FILE                                             00860008
005570     RECORDING MODE F                                             00870008
005571     BLOCK CONTAINS 0 RECORDS                                     00880008
005572     LABEL RECORDS ARE OMITTED                                    00890008
005573     DATA RECORD IS PROMO-NIGHT-ID-RECORD.                        00900008
005574 01  PROMO-NIGHT-RECORD                            PIC  X(200).   00910008
005575                                                                  00920008
005576 WORKING-STORAGE SECTION.                                         00930008
005577*-----------------------------------------------------------      00940008
005578* PS - PROGRAM SWITCHES                                           00950008
005579*-----------------------------------------------------------      00960008
005580 01  PS-PROGRAM-SWITCHES.                                         00970008
005581     05  PS-TIER-PRICG-CSR-EOF-SW                  PIC  X(001).   00980008
005582       88  PS-TIER-PRICG-CSR-EOF                     VALUE 'Y'.   00990008
005583       88  PS-TIER-PRICG-CSR-NOT-EOF                 VALUE 'N'.   01000008
005584     05  PS-TIER-PRICG-ADHOC-CSR-EOF-SW            PIC  X(001).   01010008
005585       88  PS-TIER-PRICG-ADHOC-CSR-EOF               VALUE 'Y'.   01020008
005586       88  PS-TIER-PRICG-ADHC-CSR-NOT-EOF            VALUE 'N'.   01030012
005587     05  PS-REC-FOUND-SW                           PIC  X(001).   01040008
005588       88  PS-REC-FOUND                              VALUE 'Y'.   01050008
005589       88  PS-NO-REC-FOUND                           VALUE 'N'.   01060008
005590     05  PS-WRITE-PROMO-SW                         PIC  X(001).   01070008
005591       88  PS-WRITE-PROMO                            VALUE 'Y'.   01080008
005592       88  PS-DONT-WRITE-PROMO                       VALUE 'N'.   01090008
005593     05  PS-FILE-STATUS                            PIC  X(002).   01100008
005594       88  PS-SUCCESSFUL-COMPLETION                  VALUE '00'.  01110008
005595       88  PS-END-OF-FILE                            VALUE '10'.  01120008
005596       88  PS-SUCCESSFUL-OPEN                        VALUE '97'.  01130008
005597     05  PS-END-OF-CNTL-CRD-SW                     PIC  X(001).   01140008
005598       88  PS-END-OF-CNTL-CRD-FILE                   VALUE 'Y'.   01150008
005599       88  PS-NOT-END-OF-CNTL-CRD-FILE               VALUE 'N'.   01160008
005600                                                                  01170008
005601*-----------------------------------------------------------      01180008
005602* PROGRAM CONSTANTS                                               01190008
005603*-----------------------------------------------------------      01200008
005604 01  PC-PROGRAM-CONSTANTS.                                        01210008
005605     05  PC-CURRENT-PROGRAM-NAME                   PIC  X(008)    01220008
005606       VALUE 'EPKUT351'.                                          01230008
005700     05  PC-PRICING-BUS-EVENT                      PIC  X(003)    01240008
005800       VALUE '090'.                                               01250008
005900     05  PC-ADHOC-DEV-BUS-EVENT                    PIC  X(003)    01260008
006000       VALUE '050'.                                               01270008
006010     05  PC-RMS-PRC-SETUP-IND                      PIC  X(001)    01280008
006020       VALUE 'R'.                                                 01290008
006030     05  PC-ADHOC-PRC-SETUP-IND                    PIC  X(001)    01300008
006040       VALUE 'A'.                                                 01310008
006050     05  PC-ADHOC-STR-GRP-TYP-CDE                  PIC  X(005)    01320015
006060       VALUE '99999'.                                             01330015
006070     05  PC-ADHOC-STR-SPEC-CDE                     PIC  X(004)    01340008
006080       VALUE '5000'.                                              01350008
006090     05  PC-STR-SELN-HIER-CDE                      PIC  X(002)    01360008
006091       VALUE '61'.                                                01370008
006092     05  PC-FILE-ACT-TYPE                          PIC  X(003)    01380008
006093       VALUE 'CHG'.                                               01390008
006094     05  PC-APPLY-NIGHTLY                          PIC  X(001)    01400008
006095       VALUE 'N'.                                                 01410008
006096     05  PC-APPLY-CORRECTION                       PIC  X(001)    01420008
006097       VALUE 'C'.                                                 01430008
006098     05  PC-TIER-PRICG-STAT-CDE                    PIC  X(001).   01440008
006099       88  PC-SCHEDULED-STATUS                       VALUE 'S'.   01450008
006100       88  PC-DELETE-STATUS                          VALUE 'D'.   01460008
006101       88  PC-CANCEL-STATUS                          VALUE 'C'.   01470008
006102     05  PC-ADD-STAT-CDE                           PIC  X(001)    01480008
006103       VALUE 'A'.                                                 01490008
006104     05  PC-DELETE-STAT-CDE                        PIC  X(001)    01500008
006105       VALUE 'D'.                                                 01510008
006106     05  PC-MDSE-INCL-IND                          PIC  X(001)    01520008
006107       VALUE 'I'.                                                 01530008
006108                                                                  01540008
006109*-----------------------------------------------------------      01550008
006110* PV- PROGRAM VARIABLES                                           01560008
006120*-----------------------------------------------------------      01570008
006130 01  PV-PROGRAM-VARAIBLES.                                        01580008
006140     05  PV-SQL-SUB                                PIC S9(004)    01590015
006150                                                     VALUE +0     01600015
006160                                                     COMP.        01610015
006190     05  PV-ACTL-STRT-TMST.                                       01620015
006200       10  PV-ACTL-STRT-TMST-DATE                  PIC  X(010)    01630015
006300                                                     VALUE SPACES.01640015
006400       10  FILLER                                  PIC  X(016)    01650015
006500                                                     VALUE SPACES.01660015
006600     05  PV-ACTL-END-TMST                          PIC  X(026)    01670015
006700                                                     VALUE SPACES.01680015
006800     05  PV-SOR-LAST-UPD-TMST                      PIC  X(026)    01690015
006900                                                     VALUE SPACES.01700015
007000     05  PV-EFF-STRT-TMST                          PIC  X(026)    01710015
007100                                                     VALUE SPACES.01720015
007200     05  PV-EFF-END-TMST                           PIC  X(026)    01730015
007300                                                     VALUE SPACES.01740015
007400     05  PV-EFF-END-NULL                           PIC S9(004)    01750015
007500                                                     VALUE ZEROS  01760015
007600                                                     COMP.        01770015
007700     05  PV-ABEND-CODE                             PIC  9999      01780015
007800                                                     VALUE ZEROS  01790015
007900                                                     COMP.        01800015
008000     05  PV-FUL-FILE-STR                           PIC  9(005)    01810015
008100                                                     VALUE ZEROS. 01820015
008200     05  EP111-CC-DATE-PLUS1                       PIC  X(010)    01830015
008300                                                     VALUE SPACES.01840015
008400     05  EP113-CC-CRNT-DTE-MINUS1                  PIC  X(010)    01850015
008500                                                     VALUE SPACES.01860015
008600                                                                  01870015
008680*----------------------------------------------------------       01880008
008690* FULL FILE EXTRACT OUTPUT FILE.                                  01890008
008700*----------------------------------------------------------       01900008
008800     COPY EPRD072.                                                01910008
008900                                                                  01920008
009000*----------------------------------------------------------       01930008
009100* EPCC111 CONTROL CARD LAYOUT                                     01940008
009200*----------------------------------------------------------       01950008
009300     COPY EPRD111.                                                01960008
009400                                                                  01970008
009500*----------------------------------------------------------       01980008
009600* EPCC113 CONTROL CARD LAYOUT                                     01990008
009700*----------------------------------------------------------       02000008
009800     COPY EPRD113.                                                02010008
009900                                                                  02020008
010000*----------------------------------------------------------       02030008
010100* EPCC400 CONTROL CARD LAYOUT                                     02040008
010200*----------------------------------------------------------       02050008
010300     COPY EPRD400.                                                02060008
010301                                                                  02070045
010302*----------------------------------------------------------       02080008
010303* EPCC401 CONTROL CARD LAYOUT                                     02090008
010304*----------------------------------------------------------       02100008
010305     COPY EPRD401.                                                02110008
010400                                                                  02120008
010500*----------------------------------------------------------       02130008
010600* EPCC128 CONTROL CARD LAYOUT                                     02140008
010700*----------------------------------------------------------       02150008
010800     COPY EPRD128.                                                02160008
010810                                                                  02170008
010820*----------------------------------------------------------       02180008
010830* DATE ROUTINE COPY MEMBERS                                       02190008
010840*----------------------------------------------------------       02200008
010850     COPY DPWS500.                                                02210008
010860                                                                  02220008
010870*-----------------------------------------------------------      02230008
010880* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         02240008
010890*-----------------------------------------------------------      02250008
010900     COPY DPWS004.                                                02260008
011000                                                                  02270008
011100*-----------------------------------------------------------      02280008
011200* DB2 ABEND COPYBOOK                                              02290008
011300*-----------------------------------------------------------      02300008
011400     COPY DPWS900.                                                02310008
011500                                                                  02320008
011600*-----------------------------------------------------------      02330008
011700* DB2 MESSAGE AREA                                                02340008
011800*-----------------------------------------------------------      02350008
011900     COPY SQLCA2.                                                 02360008
012000                                                                  02370008
012100*-----------------------------------------------------------      02380008
012200* PROGRAM COUNTERS                                                02390008
012300*-----------------------------------------------------------      02400008
012400 01  PC-PROGRAM-COUNTERS.                                         02410008
012500     05  PC-CNT-READ-RECS                          PIC  9(009)    02420008
012600                                                     VALUE 0.     02430008
012700     05  PC-CNT-NIGHT-RECS                         PIC  9(009)    02440008
012800                                                     VALUE 0.     02450008
013210     05  PC-CNT-RMS-RECS                           PIC  9(009)    02460008
013220                                                     VALUE 0.     02470008
013230     05  PC-CNT-ADHOC-RECS                         PIC  9(009)    02480008
013240                                                    VALUE 0.      02490008
013241     05  PC-CNT-ADD-RECS                           PIC  9(009)    02500009
013242                                                     VALUE 0.     02510009
013243     05  PC-CNT-DELTE-RECS                         PIC  9(009)    02520009
013244                                                    VALUE 0.      02530009
013250     05  PC-CNT-DEVT-RECS                          PIC  9(009)    02540008
013260                                                     VALUE 0.     02550008
013261     05  PC-CNT-PROMO-RECS                         PIC  9(009)    02560009
013262                                                     VALUE 0.     02570009
013270     05  PC-CNT-PMAP-RECS                          PIC  9(009)    02580008
013280                                                     VALUE 0.     02590008
013290     05  PC-CNT-ERROR-RECS                         PIC  9(009)    02600008
013291                                                     VALUE 0.     02610008
013292     05  PC-CNT-ALL-RECS                           PIC  9(009)    02620008
013293                                                     VALUE 0.     02630008
013294     05  PC-CNT-SPACES                             PIC  9(009)    02640008
013295                                                     VALUE 0.     02650008
013296     05  PC-CNT-POS                                PIC  9(009)    02660008
013297                                                     VALUE 0.     02670008
013298     05  PC-CNT-EXCL-CHECK                         PIC  9(009)    02680008
013299                                                     VALUE 0.     02690008
013300     05  PC-MAX-RETRIES                            PIC S9(004)    02700008
013301                                                     VALUE +5     02710008
013302                                                     COMP.        02720008
013303                                                                  02730008
013304*-----------------------------------------------------------      02740008
013305* ERROR HANDLING                                                  02750008
013306*-----------------------------------------------------------      02760008
013307 01  PV-MISC-ABEND-FIELDS.                                        02770008
013308     05  PV-PARAGRAPH-NAME                         PIC  X(030)    02780008
013309                                                     VALUE SPACE. 02790008
013310     05  PV-OPERATION-MSG-1                         PIC  X(040)   02800008
013320                                                      VALUE SPACE.02810008
013330     05  PV-OPERATION-MSG-2                         PIC  X(040)   02820008
013340                                                      VALUE SPACE.02830008
013350     05  PV-DB2-OPERATION                           PIC  X(030)   02840008
013360                                                      VALUE SPACE.02850008
013370 01  ABEND-CODE                                     PIC S9(004)   02860008
013380                                                      VALUE ZEROS 02870008
013390                                                      COMP        02880008
013400                                                      SYNC.       02890008
013500   88  ABEND-4003-CTRL-CARD-ERROR                     VALUE +4003.02900008
013600   88  ABEND-4013-DB2-ERROR                           VALUE +4013.02910008
013700   88  ABEND-4019-CAL-SUB-ERROR                       VALUE +4019.02920008
013800   88  ABEND-4020-MQ-ERROR                            VALUE +4020.02930008
013900   88  ABEND-4444-FORCED-ABEND                        VALUE +4444.02940008
014000   88  ABEND-4008                                     VALUE +4008.02950008
014100                                                                  02960008
014200                                                                  02970008
014300*-----------------------------------------------------------      02980008
014400* DB2 COMMUNICATIONS AREA                                         02990008
014500*-----------------------------------------------------------      03000008
014600     EXEC SQL                                                     03010008
014700       INCLUDE SQLCA                                              03020008
014800     END-EXEC.                                                    03030008
014900                                                                  03040008
015000*-----------------------------------------------------------      03050008
015100* DB2 TABLE XST00023(XST_STR_GP_MBSHP) - STORE GROUP              03060008
015200*-----------------------------------------------------------      03070008
015300     EXEC SQL                                                     03080008
015400       INCLUDE XST00023                                           03090008
015500     END-EXEC.                                                    03100008
015600                                                                  03110008
015700*-----------------------------------------------------------      03120008
015800* DB2 TABLE XST00028(XST_MDSE_LNE_SELN) - MERCHANDISE TABLE       03130008
015900*-----------------------------------------------------------      03140008
016000     EXEC SQL                                                     03150008
016100       INCLUDE XST00028                                           03160008
016200     END-EXEC.                                                    03170008
016300                                                                  03180008
016400*-----------------------------------------------------------      03190008
016500* DB2 TABLE XST00029(XST_PROMO_STR_GP) - STORE ZONE PRICING       03200008
016600*                                               TABLE             03210008
016700*-----------------------------------------------------------      03220008
016800     EXEC SQL                                                     03230008
016900       INCLUDE XST00029                                           03240008
017000     END-EXEC.                                                    03250008
017100                                                                  03260008
017900*-----------------------------------------------------------      03270008
018000* DB2 TABLE XST00031(XST_PROMO_ADHC_RLT) ADHOC RELATION           03280008
018100*-----------------------------------------------------------      03290008
018200     EXEC SQL                                                     03300008
018210       INCLUDE XST00031                                           03310008
018220     END-EXEC.                                                    03320008
018230                                                                  03330008
018240*-----------------------------------------------------------      03340008
018250* DB2 TABLE XST00033(XST_PROMO_ADHC_STR) PROMO ADHOC STORES       03350008
018260*-----------------------------------------------------------      03360008
018270     EXEC SQL                                                     03370008
018280       INCLUDE XST00033                                           03380008
018290     END-EXEC.                                                    03390008
018300                                                                  03400008
018310*-----------------------------------------------------------      03410008
018320* DB2 TABLE XST00035(XST_TIER_PRICG) TIERED PRICING               03420008
018330*-----------------------------------------------------------      03430008
018340     EXEC SQL                                                     03440008
018350       INCLUDE XST00035                                           03450008
018360     END-EXEC.                                                    03460008
018370                                                                  03470008
018400*-----------------------------------------------------------      03480008
018500* TIERED PRICING CHANGE INTERFACE INCLUDE CURSOR. (RMS)           03490008
018600*-----------------------------------------------------------      03500008
018700     EXEC SQL                                                     03510008
018800       DECLARE TIER-PRICG-RMS CURSOR FOR                          03520015
018810         SELECT TERPRC.PROMO_INTFC_SUB_ID                         03530009
018900               ,TERPRC.STAT_CDE                                   03540009
019000               ,TERPRC.LAST_UPD_TMST                              03550008
019100               ,TERPRC.SOR_LAST_UPD_TMST                          03560008
019210               ,STRGP.PROMO_INTFC_ID                              03570009
019300               ,STRGP.MDSE_LNE_ID                                 03580008
019400               ,STRGP.STR_GP_TYP_CDE                              03590008
019500               ,STRGP.STR_GP_ID                                   03600008
019600               ,STRGP.STR_SELN_HIER_CDE                           03610008
019700               ,STRGP.ACTL_STRT_TMST                              03620008
019800               ,STRGP.ACTL_END_TMST                               03630008
019900               ,MDSSEL.PRICG_TYP_CDE                              03640008
020000         FROM XST_TIER_PRICG     TERPRC                           03650015
020100             ,XST_PROMO_STR_GP   STRGP                            03660015
020200             ,XST_MDSE_LNE_SELN  MDSSEL                           03670015
020210         WHERE TERPRC.PROMO_INTFC_ID = MDSSEL.PROMO_INTFC_ID      03680015
020400           AND TERPRC.MDSE_LNE_ID    = MDSSEL.MDSE_LNE_ID         03690015
020500           AND MDSSEL.PROMO_INTFC_ID = STRGP.PROMO_INTFC_ID       03700015
020600           AND MDSSEL.MDSE_LNE_ID    = STRGP.MDSE_LNE_ID          03710015
020800           AND STRGP.STAT_CDE  IN ('S')                           03720015
020900           AND (TERPRC.LAST_UPD_TMST                              03730015
021000               BETWEEN :EP400-CC-PREV-RUN-CUTOFF-TMST             03740015
021100                   AND :EP401-CC-CURR-RUN-CUTOFF-TMST)            03750015
021200           AND ((:EP111-CC-CRNT-DTE                               03760015
021300               BETWEEN DATE(STRGP.ACTL_STRT_TMST)                 03770015
021400                   AND DATE(STRGP.ACTL_END_TMST))                 03780015
021500           OR  (DATE(STRGP.ACTL_STRT_TMST)                        03790015
021600               BETWEEN :EP111-CC-DATE-PLUS1                       03800015
021700                   AND :EP113-CC-CRNT-DTE-MINUS1))                03810015
021710         FOR FETCH ONLY                                           03820015
021720         WITH UR                                                  03830015
021730     END-EXEC.                                                    03840008
021740                                                                  03850008
021750*-----------------------------------------------------------      03860008
021760* TIERED PRICING CHANGE ID ADHOC CURSOR.                          03870008
021770*-----------------------------------------------------------      03880008
021780     EXEC SQL                                                     03890008
021790       DECLARE TIER-PRICG-ADHOC CURSOR FOR                        03900011
021791         SELECT TERPRC.PROMO_INTFC_SUB_ID                         03910009
021792               ,TERPRC.STAT_CDE                                   03920009
021801               ,TERPRC.LAST_UPD_TMST                              03930008
021802               ,TERPRC.SOR_LAST_UPD_TMST                          03940008
021803               ,ADHOC.PROMO_INTFC_ID                              03950008
021804               ,ADHOC.MDSE_LNE_ID                                 03960008
021805               ,ADHOC.ADHC_STR_GP_ID                              03970008
021806               ,ADHOC.STR_SELN_HIER_CDE                           03980008
021807               ,ADHOC.ACTL_STRT_TMST                              03990008
021808               ,ADHOC.ACTL_END_TMST                               04000008
021809               ,MDSSEL.PRICG_TYP_CDE                              04010008
021810         FROM XST_TIER_PRICG     TERPRC                           04020008
021820             ,XST_PROMO_ADHC_RLT ADHOC                            04030008
021830             ,XST_MDSE_LNE_SELN  MDSSEL                           04040008
021840         WHERE TERPRC.PROMO_INTFC_ID = MDSSEL.PROMO_INTFC_ID      04050008
021850           AND TERPRC.MDSE_LNE_ID    = MDSSEL.MDSE_LNE_ID         04060008
021860           AND ADHOC.PROMO_INTFC_ID  = MDSSEL.PROMO_INTFC_ID      04070008
021870           AND ADHOC.MDSE_LNE_ID     = MDSSEL.MDSE_LNE_ID         04080008
021871           AND ADHOC.STAT_CDE  IN ('S')                           04090008
021873           AND (TERPRC.LAST_UPD_TMST                              04100008
021874               BETWEEN :EP400-CC-PREV-RUN-CUTOFF-TMST             04110008
021875                   AND :EP401-CC-CURR-RUN-CUTOFF-TMST)            04120008
021876           AND ((:EP111-CC-CRNT-DTE                               04130008
021877               BETWEEN DATE(ADHOC.ACTL_STRT_TMST)                 04140008
021878                   AND DATE(ADHOC.ACTL_END_TMST))                 04150008
021879           OR  (DATE(ADHOC.ACTL_STRT_TMST)                        04160008
021880               BETWEEN :EP111-CC-DATE-PLUS1                       04170008
021890                   AND :EP113-CC-CRNT-DTE-MINUS1))                04180008
021900         FOR FETCH ONLY                                           04190008
021910         WITH UR                                                  04200008
021911     END-EXEC.                                                    04210008
021912                                                                  04220008
021968 LINKAGE SECTION.                                                 04230008
021969                                                                  04240008
021970*----------------------------------------------------------       04250008
021971 PROCEDURE DIVISION.                                              04260008
021972*----------------------------------------------------------       04270008
021973 0000-MAINLINE.                                                   04280008
021974                                                                  04290008
021975     PERFORM 1000-INITIALIZATION.                                 04300008
021976                                                                  04310008
021977     PERFORM 2000-PROCESS-TIERED-PRICING.                         04320008
021978                                                                  04330008
021979     PERFORM 9999-WRAPUP.                                         04340008
021980                                                                  04350008
021981     GOBACK.                                                      04360008
021982                                                                  04370008
021983*0000-EXIT.                                                       04380008
021984 EJECT.                                                           04390008
021985                                                                  04400008
021986*----------------------------------------------------------       04410008
021987* 1000-INITIALIZATION.                                            04420008
021988*     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS      04430008
021989*     FILES, READS INPUT FILES, AND PROCESSES ANY INPUT FILE      04440008
021990*     PARAMETERS IT MAY NEED TO USE TO READ THE PROMO             04450008
021991*     INTERFACE ID FILE.                                          04460008
021992*----------------------------------------------------------       04470008
021993 1000-INITIALIZATION.                                             04480008
021994                                                                  04490008
021995     OPEN INPUT  CONTROL-CARD-CURR-PRICG-DTE                      04500008
021996                 CONTROL-CARD-FUTRE-CORR-DTE                      04510008
021997                 CONTROL-CARD-PGM-CURR-TMST                       04520045
021998                 CONTROL-CARD-PGM-LAST-RUN-TMST                   04530008
021999                 CONTROL-CARD-CRIT-EFF-DTE.                       04540008
022000     OPEN OUTPUT PROMO-NIGHT-FILE.                                04550008
022100                                                                  04560008
022200     INITIALIZE EP072-PROMO-INTFC-RECORD.                         04570008
022300                                                                  04580008
022400     PERFORM 1010-READ-PGM-CURR-RUN-CARD.                         04590008
022500     PERFORM 1020-READ-PGM-LAST-RUN-CARD.                         04600008
022600     PERFORM 1030-READ-CURR-PRICG-DTE-CARD.                       04610008
022700     PERFORM 1040-READ-FUTRE-CORR-DTE-CARD.                       04620008
022800     PERFORM 1050-READ-CRIT-EFF-DTE-CARD.                         04630008
022900     PERFORM 6100-DATE-ROUTINE.                                   04640008
023000                                                                  04650008
023100*1000-EXIT.                                                       04660008
023200 EJECT.                                                           04670008
023300                                                                  04680008
025700*----------------------------------------------------------       04690008
025800* 1010-READ-PGM-CURR-RUN-CARD.                                    04700008
025900*     READ CONTROL CARD EPCC401. THIS CONTROL CARD CONTAINS       04710008
026000*     THE CURRENT TIMESTAMP                                       04720008
026100*----------------------------------------------------------       04730008
026200 1010-READ-PGM-CURR-RUN-CARD.                                     04740008
026300                                                                  04750008
026400     READ CONTROL-CARD-PGM-CURR-TMST                              04760008
026500                                    INTO EP401-CC-CONTROL-CARD    04770008
026600       AT END                                                     04780008
026700          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    04790008
026800                                                                  04800008
026900     IF PS-END-OF-CNTL-CRD-FILE                                   04810008
027000       DISPLAY ' '                                                04820008
027100       DISPLAY '** ABEND     **'                                  04830008
027200       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      04840008
027300       DISPLAY '** PARAGRAPH **  = 1010-READ-PGM-CURR-RUN-CARD'   04850008
027400       DISPLAY '** CONTROL FILE IS EMPTY  '                       04860008
027500       DISPLAY ' '                                                04870008
027600       MOVE +4002 TO ABEND-CODE                                   04880008
027700       CALL 'ILBOABN0' USING ABEND-CODE                           04890008
027800     ELSE                                                         04900008
027900       DISPLAY '** PROGRAM LAST RUN CONTROL CARD  **'             04910008
028000       DISPLAY '** EPCC401    **  =' EP401-CC-CURR-RUN-CUTOFF-TMST04920012
028100       DISPLAY ' '                                                04930008
028200     END-IF.                                                      04940008
028300                                                                  04950008
028310*1010-EXIT.                                                       04960008
028320 EJECT.                                                           04970008
028321                                                                  04980045
028322*----------------------------------------------------------       04990008
028323* 1020-READ-PGM-LAST-RUN-CARD.                                    05000008
028324*     READ CONTROL CARD EPCC400. THIS CONTROL CARD CONTAINS       05010008
028325*     THE TIMESTAMP FROM THE LAST RUN OF EPKUT351                 05020008
028326*----------------------------------------------------------       05030008
028327 1020-READ-PGM-LAST-RUN-CARD.                                     05040008
028328                                                                  05050008
028329     READ CONTROL-CARD-PGM-LAST-RUN-TMST                          05060008
028330                                    INTO EP400-CC-CONTROL-CARD    05070008
028331       AT END                                                     05080008
028332          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    05090008
028333                                                                  05100008
028334     IF PS-END-OF-CNTL-CRD-FILE                                   05110008
028335       DISPLAY ' '                                                05120008
028336       DISPLAY '** ABEND     **'                                  05130008
028337       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      05140008
028338       DISPLAY '** PARAGRAPH **  = 1020-READ-PGM-LAST-RUN-CARD'   05150008
028339       DISPLAY '** CONTROL FILE IS EMPTY  '                       05160008
028340       DISPLAY ' '                                                05170008
028341       MOVE +4002 TO ABEND-CODE                                   05180008
028342       CALL 'ILBOABN0' USING ABEND-CODE                           05190008
028343     ELSE                                                         05200008
028344       DISPLAY '** PROGRAM LAST RUN CONTROL CARD  **'             05210008
028345       DISPLAY '** EPCC400    **  =' EP400-CC-PREV-RUN-CUTOFF-TMST05220012
028346       DISPLAY ' '                                                05230008
028347     END-IF.                                                      05240008
028348                                                                  05250008
028349*1020-EXIT.                                                       05260008
028350 EJECT.                                                           05270008
028351                                                                  05280008
028352*----------------------------------------------------------       05290008
028353* 1030-READ-CURR-PRICG-DTE-CARD.                                  05300008
028354*     READ CONTROL CARD EPCC111. THIS CONTROL CARD CONTAINS       05310008
028355*     THE CURRENT PRICING DATE.                                   05320008
028356*----------------------------------------------------------       05330008
028357 1030-READ-CURR-PRICG-DTE-CARD.                                   05340008
028358                                                                  05350008
028359     READ CONTROL-CARD-CURR-PRICG-DTE                             05360008
028360                               INTO EP111-CC-CONTROL-CARD         05370008
028361       AT END                                                     05380008
028362          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    05390008
028363                                                                  05400008
028364     IF PS-END-OF-CNTL-CRD-FILE                                   05410008
028365       DISPLAY ' '                                                05420008
028366       DISPLAY '** ABEND     **'                                  05430008
028367       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      05440008
028368       DISPLAY '** PARAGRAPH **  = 1030-READ-CURR-PRICG-DTE-CARD' 05450008
028369       DISPLAY '** CONTROL FILE IS EMPTY  '                       05460008
028370       DISPLAY ' '                                                05470008
028371       MOVE +4002 TO ABEND-CODE                                   05480008
028372       CALL 'ILBOABN0' USING ABEND-CODE                           05490008
028373     ELSE                                                         05500008
028374       DISPLAY '** CURRENT PRICING DATE CONTROL CARD  **'         05510008
028375       DISPLAY '** EPCC111       **  = ' EP111-CC-CRNT-DTE        05520008
028376       DISPLAY ' '                                                05530008
028377     END-IF.                                                      05540008
028378                                                                  05550008
028379*1030-EXIT.                                                       05560008
028380 EJECT.                                                           05570008
028381                                                                  05580008
028382*----------------------------------------------------------       05590008
028383* 1040-READ-FUTRE-CORR-DTE-CARD.                                  05600008
028384*     READ CONTROL CARD EPCC113. THIS CONTROL CARD CONTAINS       05610008
028385*     THE NEXT FUTURE CORRECTIONS DATE                            05620008
028386*----------------------------------------------------------       05630008
028387 1040-READ-FUTRE-CORR-DTE-CARD.                                   05640008
028388                                                                  05650008
028389     READ CONTROL-CARD-FUTRE-CORR-DTE                             05660008
028390                               INTO EP113-CC-CONTROL-CARD         05670008
028391       AT END                                                     05680008
028392          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    05690008
028393                                                                  05700008
028394     IF PS-END-OF-CNTL-CRD-FILE                                   05710008
028395       DISPLAY ' '                                                05720008
028396       DISPLAY '** ABEND     **'                                  05730008
028397       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      05740008
028398       DISPLAY '** PARAGRAPH **  = 1040-READ-FUTRE-CORR-DTE-CARD' 05750008
028399       DISPLAY '** CONTROL FILE IS EMPTY  '                       05760008
028400       DISPLAY ' '                                                05770008
028401       MOVE +4002 TO ABEND-CODE                                   05780008
028402       CALL 'ILBOABN0' USING ABEND-CODE                           05790008
028403     ELSE                                                         05800008
028404       DISPLAY '** FUTURE CORRECTION DATE CONTROL CARD  **'       05810008
028405       DISPLAY '** EPCC113       **  = ' EP113-CC-CRNT-DTE        05820008
028406       DISPLAY ' '                                                05830008
028407     END-IF.                                                      05840008
028408                                                                  05850008
028409*1040-EXIT.                                                       05860008
028410 EJECT.                                                           05870008
028411                                                                  05880008
028412*----------------------------------------------------------       05890008
028413* 1050-READ-CRIT-EFF-DTE-CARD.                                    05900008
028414*     READ CONTROL CARD EPCC128  THIS CONTROL CARD CONTAINS       05910008
028415*     THE CRITICAL EFFECTIVE DATE, WHICH DETERMINES IF CHANGES    05920008
028416*     ARE EMERGENCY OR NIGHTLY.                                   05930008
028417*----------------------------------------------------------       05940008
028418 1050-READ-CRIT-EFF-DTE-CARD.                                     05950008
028419                                                                  05960008
028420     READ CONTROL-CARD-CRIT-EFF-DTE                               05970008
028421                               INTO EP128-CC-CONTROL-CARD         05980008
028422       AT END                                                     05990008
028423          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    06000008
028424                                                                  06010008
028425     IF PS-END-OF-CNTL-CRD-FILE                                   06020008
028426       DISPLAY ' '                                                06030008
028427       DISPLAY '** ABEND     **'                                  06040008
028428       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      06050008
028429       DISPLAY '** PARAGRAPH **  = 1050-READ-CRIT-EFF-DTE-CARD'   06060008
028430       DISPLAY '** CONTROL FILE IS EMPTY  '                       06070008
028431       DISPLAY ' '                                                06080008
028432       MOVE +4002 TO ABEND-CODE                                   06090008
028433       CALL 'ILBOABN0' USING ABEND-CODE                           06100008
028434     ELSE                                                         06110008
028435       DISPLAY '** CRITICAL EFFECTIVE DATE CONTROL CARD  **'      06120008
028436       DISPLAY '** EPCC128       **  = ' EP128-CC-CRITICAL-DTE    06130008
028437       DISPLAY ' '                                                06140008
028438     END-IF.                                                      06150008
028439                                                                  06160008
028440*1050-EXIT.                                                       06170008
028441 EJECT.                                                           06180008
028442                                                                  06190008
028443*----------------------------------------------------------       06200008
028444* 2000-PROCESS-TIERED-PRICING                                     06210008
028445*     MAIN PROCESSING AREA - EXECUTES RMS AND ADHOC QUERY         06220008
028446*     TO IDENTIFY TIERED PRICING CHANGES AND CREATES OUTPUT       06230008
028447*     FILES TO IDENTIFY WHICH STORE GROUP/PROMO INTERFACE I.D     06240008
028448*     COMBO'S NEED RECORDS CREATED FOR THE STORE SERVER.          06250008
028449*----------------------------------------------------------       06260008
028450 2000-PROCESS-TIERED-PRICING.                                     06270008
028451                                                                  06280008
028452     PERFORM 2100-PROCESS-RMS-CURSOR.                             06290008
028453                                                                  06300008
028454     PERFORM 2200-PROCESS-ADHOC-CURSOR.                           06310008
028455                                                                  06320008
028456*2000-EXIT.                                                       06330008
028457 EJECT.                                                           06340008
028458                                                                  06350008
028459*----------------------------------------------------------       06360008
028460* 2100-PROCESS-RMS-CURSOR.                                        06370008
028461*     READ THE RECORD FROM THE TIERED PRICING TABLE AND           06380008
028462*     CREATE PROMO AND PMAP RECORDS BASED ON THE RECORD READ.     06390008
028463*----------------------------------------------------------       06400008
028464 2100-PROCESS-RMS-CURSOR.                                         06410008
028465                                                                  06420021
028466     PERFORM 2110-OPEN-TIER-PRICG-RMS.                            06430015
028467     PERFORM 2120-FETCH-TIER-PRICG-RMS                            06440015
028468       UNTIL PS-TIER-PRICG-CSR-EOF.                               06450008
028469     PERFORM 2130-CLOSE-TIER-PRICG-RMS.                           06460015
028470                                                                  06470008
028471*2100-EXIT.                                                       06480015
028472 EJECT.                                                           06490008
028473                                                                  06500008
028474*----------------------------------------------------------       06510008
028475* 2110-OPEN-TIER-PRICG-RMS.                                       06520015
028476*     OPEN THE SIMPLE PRICING CURSOR (RMS).                       06530008
028477*----------------------------------------------------------       06540008
028478 2110-OPEN-TIER-PRICG-RMS.                                        06550015
028479                                                                  06560008
028480     PERFORM                                                      06570008
028481         WITH TEST AFTER                                          06580008
028482         VARYING PV-SQL-SUB                                       06590008
028490         FROM 1 BY 1                                              06600008
028500         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 06610008
028600                   OR  SQLCODE = 0)                               06620008
028700                                                                  06630008
028800         EXEC SQL                                                 06640008
028900           OPEN TIER-PRICG-RMS                                    06650021
029000         END-EXEC                                                 06660008
029100                                                                  06670008
029200         EVALUATE TRUE                                            06680008
029300           WHEN SQLCODE = -904                                    06690015
029400           WHEN SQLCODE = -911                                    06700015
029500           WHEN SQLCODE = -913                                    06710015
029600             CONTINUE                                             06720015
029700           WHEN SQLCODE = 0                                       06730015
029800             SET PS-TIER-PRICG-CSR-NOT-EOF TO TRUE                06740015
029900           WHEN SQLWARN0 NOT EQUAL SPACE                          06750015
030000           WHEN SQLCODE NOT EQUAL ZERO                            06760015
030100             MOVE '2110-OPEN-TIER-PRICG-RMS'                      06770015
030200                                     TO PV-PARAGRAPH-NAME         06780008
030300             MOVE 'ERROR ON OPEN OF TIER PRICG RMS CURSOR'        06790018
030400                                     TO PV-DB2-OPERATION          06800008
030500             PERFORM 9900-SQL-ABEND-ROUTINE                       06810015
030600         END-EVALUATE                                             06820008
030700     END-PERFORM.                                                 06830008
030800                                                                  06840008
030900     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         06850008
031000       MOVE '2110-OPEN-TIER-PRICG-RMS'                            06860015
031100                             TO  PV-PARAGRAPH-NAME                06870008
031200       MOVE 'OPEN RETRIES EXCEEDED'                               06880015
031300                              TO  PV-DB2-OPERATION                06890008
031400       PERFORM 9900-SQL-ABEND-ROUTINE                             06900015
031500     END-IF.                                                      06910008
031600                                                                  06920008
031700*2110-EXIT.                                                       06930008
031800 EJECT.                                                           06940008
031900                                                                  06950008
032000*----------------------------------------------------------       06960008
032100* 2120-FETCH-TIER-PRICG-RMS.                                      06970015
032200*     FETCH THE SIMPLE PRICING ID CURSOR. (RMS)                   06980008
032300*----------------------------------------------------------       06990008
032400 2120-FETCH-TIER-PRICG-RMS.                                       07000015
032500                                                                  07010008
032600     PERFORM                                                      07020008
032700         WITH TEST AFTER                                          07030008
032800         VARYING PV-SQL-SUB                                       07040008
032900         FROM 1 BY 1                                              07050008
033000         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 07060008
033100                   OR  SQLCODE = 0                                07070008
033200                   OR  SQLCODE = +100)                            07080008
033300                                                                  07090008
033400         EXEC SQL                                                 07100021
033500           FETCH TIER-PRICG-RMS                                   07110021
033510           INTO  :XST00035-PROMO-INTFC-SUB-ID                     07120021
033600                ,:XST00035-STAT-CDE                               07130021
033700                ,:XST00035-LAST-UPD-TMST                          07140021
033800                ,:XST00035-SOR-LAST-UPD-TMST                      07150021
033900                ,:XST00029-PROMO-INTFC-ID                         07160021
034000                ,:XST00029-MDSE-LNE-ID                            07170021
034100                ,:XST00029-STR-GP-TYP-CDE                         07180021
034200                ,:XST00029-STR-GP-ID                              07190021
034300                ,:XST00029-STR-SELN-HIER-CDE                      07200021
034400                ,:XST00029-ACTL-STRT-TMST                         07210021
034500                ,:XST00029-ACTL-END-TMST                          07220021
034600                ,:XST00028-PRICG-TYP-CDE                          07230021
034700         END-EXEC                                                 07240021
034800                                                                  07250008
034900         EVALUATE TRUE                                            07260021
035000           WHEN SQLCODE = -904                                    07270021
035100           WHEN SQLCODE = -911                                    07280021
035200           WHEN SQLCODE = -913                                    07290021
035300             CONTINUE                                             07300021
035400           WHEN SQLCODE = ZERO                                    07310021
035500             PERFORM 3000-FORMAT-RMS-OUTPUT                       07320021
035600             ADD 1 TO PC-CNT-RMS-RECS                             07330021
035700           WHEN SQLCODE = +100                                    07340021
035800             SET PS-TIER-PRICG-CSR-EOF TO TRUE                    07350021
035900           WHEN SQLWARN0 NOT EQUAL SPACE                          07360021
036000           WHEN SQLCODE NOT EQUAL ZERO                            07370021
036100             MOVE '2120-FETCH-TIER-PRICG-RMS'                     07380021
036200                                    TO PV-PARAGRAPH-NAME          07390021
036300             MOVE 'ERROR ON FETCHING TIER PRICG RMS CURSOR'       07400021
036400                                    TO PV-DB2-OPERATION           07410021
036500             PERFORM 9900-SQL-ABEND-ROUTINE                       07420021
036600         END-EVALUATE                                             07430021
036700     END-PERFORM.                                                 07440008
036800                                                                  07450008
036900     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         07460021
037000       MOVE '2120-FETCH-TIER-PRICG-RMS'                           07470015
037100                               TO  PV-PARAGRAPH-NAME              07480008
037200       MOVE 'FETCH RETRIES EXCEEDED'                              07490015
037300                               TO  PV-DB2-OPERATION               07500008
037400       PERFORM 9900-SQL-ABEND-ROUTINE                             07510015
037500     END-IF.                                                      07520008
037600                                                                  07530008
037700*2120-EXIT.                                                       07540008
037800 EJECT.                                                           07550008
037900                                                                  07560008
038000*-----------------------------------------------------------      07570008
038100* 2130-CLOSE-TIER-PRICG-RMS.                                      07580015
038200*                                                                 07590008
038300*-----------------------------------------------------------      07600008
038400 2130-CLOSE-TIER-PRICG-RMS.                                       07610015
038500                                                                  07620008
038600     PERFORM                                                      07630008
038700         WITH TEST AFTER                                          07640008
038800         VARYING PV-SQL-SUB                                       07650008
038900         FROM 1 BY 1                                              07660008
039000         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 07670008
039100                   OR  SQLCODE = 0)                               07680008
039200                                                                  07690008
039300         EXEC SQL                                                 07700021
039400           CLOSE TIER-PRICG-RMS                                   07710021
039500         END-EXEC                                                 07720021
039600                                                                  07730008
039700         EVALUATE TRUE                                            07740021
039800           WHEN SQLCODE = -904                                    07750021
039900           WHEN SQLCODE = -911                                    07760021
040000           WHEN SQLCODE = -913                                    07770021
040100           WHEN SQLCODE = 0                                       07780021
040200             CONTINUE                                             07790021
040300           WHEN SQLWARN0 NOT EQUAL SPACE                          07800021
040400           WHEN SQLCODE NOT EQUAL ZERO                            07810021
040500             MOVE '2130-CLOSE-TIER-PRICG-RMS'                     07820021
040600                                     TO PV-PARAGRAPH-NAME         07830021
040700             MOVE 'ERROR ON CLOSE OF TIER PRICG RMS CURSOR'       07840021
040800                                     TO PV-DB2-OPERATION          07850021
040900             PERFORM 9900-SQL-ABEND-ROUTINE                       07860021
041000         END-EVALUATE                                             07870021
041100     END-PERFORM.                                                 07880008
041200                                                                  07890008
041300     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         07900008
041400       MOVE '2130-CLOSE-TIER-PRICG-RMS'                           07910015
041500                               TO  PV-PARAGRAPH-NAME              07920008
041600       MOVE 'CLOSE RETRIES EXCEEDED'                              07930015
041700                               TO  PV-DB2-OPERATION               07940008
041800       PERFORM 9900-SQL-ABEND-ROUTINE                             07950015
041900     END-IF.                                                      07960008
042000                                                                  07970008
042100*2130-EXIT.                                                       07980008
042200 EJECT.                                                           07990008
042300                                                                  08000008
042400*----------------------------------------------------------       08010008
042500* 2200-PROCESS-ADHOC-CURSOR.                                      08020008
042600*     READ THE RECORD FROM THE SIMPLE PRICING TABLE AND           08030008
042700*     CREATE PROMO AND RECORDS BASED ON THE RECORD READ.          08040008
042800*----------------------------------------------------------       08050008
042900 2200-PROCESS-ADHOC-CURSOR.                                       08060008
042910                                                                  08070022
043000     PERFORM 2210-OPEN-TIER-PRICG-ADHOC.                          08080008
043100     PERFORM 2220-FETCH-TIER-PRICG-ADHOC                          08090008
043200       UNTIL PS-TIER-PRICG-ADHOC-CSR-EOF.                         08100015
043300     PERFORM 2230-CLOSE-TIER-PRICG-ADHOC.                         08110008
043400                                                                  08120008
043500*2200-EXIT.                                                       08130008
043600 EJECT.                                                           08140008
043700                                                                  08150008
043800*----------------------------------------------------------       08160008
043900* 2210-OPEN-TIER-PRICG-ADHOC.                                     08170008
044000*     OPEN THE SIMPLE PRICING ADHOC CURSOR.                       08180008
044100*----------------------------------------------------------       08190008
044200 2210-OPEN-TIER-PRICG-ADHOC.                                      08200008
044300                                                                  08210008
044400     PERFORM                                                      08220008
044500         WITH TEST AFTER                                          08230008
044600         VARYING PV-SQL-SUB                                       08240008
044700         FROM 1 BY 1                                              08250008
044800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 08260008
044900                   OR  SQLCODE = 0)                               08270008
045000                                                                  08280008
045100         EXEC SQL                                                 08290021
045200           OPEN TIER-PRICG-ADHOC                                  08300021
045300         END-EXEC                                                 08310021
045400                                                                  08320008
045500         EVALUATE TRUE                                            08330008
045600           WHEN SQLCODE = -904                                    08340015
045700           WHEN SQLCODE = -911                                    08350015
045800           WHEN SQLCODE = -913                                    08360015
045900             CONTINUE                                             08370015
046000           WHEN SQLCODE = 0                                       08380015
046100             SET PS-TIER-PRICG-ADHC-CSR-NOT-EOF TO TRUE           08390015
046200           WHEN SQLWARN0 NOT EQUAL SPACE                          08400015
046300           WHEN SQLCODE NOT EQUAL ZERO                            08410015
046400             MOVE '2210-OPEN-TIER-PRICG-ADHOC'                    08420015
046500                                     TO PV-PARAGRAPH-NAME         08430008
046600             MOVE 'ERROR ON OPEN OF TIER PRICG ADHOC CURSOR'      08440018
046700                                     TO PV-DB2-OPERATION          08450008
046800             PERFORM 9900-SQL-ABEND-ROUTINE                       08460015
046900         END-EVALUATE                                             08470008
047000     END-PERFORM.                                                 08480008
047100                                                                  08490008
047200     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         08500017
047300       MOVE '2210-OPEN-TIER-PRICG-ADHOC'                          08510015
047400                             TO  PV-PARAGRAPH-NAME                08520008
047500       MOVE 'OPEN RETRIES EXCEEDED'                               08530015
047600                              TO  PV-DB2-OPERATION                08540008
047700       PERFORM 9900-SQL-ABEND-ROUTINE                             08550015
047800     END-IF.                                                      08560008
047900                                                                  08570008
048000*2210-EXIT.                                                       08580008
048100 EJECT.                                                           08590008
048200                                                                  08600008
048300*----------------------------------------------------------       08610008
048400* 2220-FETCH-TIER-PRICG-ADHOC.                                    08620008
048500*     FETCH THE SIMPLE PRICING ADHOC CURSOR.                      08630008
048600*----------------------------------------------------------       08640008
048700 2220-FETCH-TIER-PRICG-ADHOC.                                     08650008
048800                                                                  08660008
048900     PERFORM                                                      08670008
049000         WITH TEST AFTER                                          08680008
049100         VARYING PV-SQL-SUB                                       08690008
049200         FROM 1 BY 1                                              08700008
049300         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 08710008
049400                   OR  SQLCODE = 0                                08720008
049500                   OR  SQLCODE = +100)                            08730008
049600                                                                  08740008
049700         EXEC SQL                                                 08750021
049800           FETCH TIER-PRICG-ADHOC                                 08760021
049810           INTO  :XST00035-PROMO-INTFC-SUB-ID                     08770021
049900                ,:XST00035-STAT-CDE                               08780021
050000                ,:XST00035-LAST-UPD-TMST                          08790021
050100                ,:XST00035-SOR-LAST-UPD-TMST                      08800021
050200                ,:XST00031-PROMO-INTFC-ID                         08810021
050300                ,:XST00031-MDSE-LNE-ID                            08820021
050400                ,:XST00031-ADHC-STR-GP-ID                         08830021
050500                ,:XST00031-STR-SELN-HIER-CDE                      08840021
050600                ,:XST00031-ACTL-STRT-TMST                         08850021
050700                ,:XST00031-ACTL-END-TMST                          08860021
050800                ,:XST00028-PRICG-TYP-CDE                          08870021
050900         END-EXEC                                                 08880021
051000                                                                  08890008
051100         EVALUATE TRUE                                            08900021
051200           WHEN SQLCODE = -904                                    08910021
051300           WHEN SQLCODE = -911                                    08920021
051400           WHEN SQLCODE = -913                                    08930021
051500             CONTINUE                                             08940021
051600           WHEN SQLCODE = ZERO                                    08950021
051700             PERFORM 3100-FORMAT-ADHOC-OUTPUT                     08960021
051800             ADD 1 TO PC-CNT-ADHOC-RECS                           08970021
051810           WHEN SQLCODE = +100                                    08980021
051820             SET PS-TIER-PRICG-ADHOC-CSR-EOF TO TRUE              08990021
051830           WHEN SQLWARN0 NOT EQUAL SPACE                          09000021
051840           WHEN SQLCODE NOT EQUAL ZERO                            09010021
051850             MOVE '2220-FETCH-TIER-PRICG-ADHOC'                   09020021
051860                                    TO PV-PARAGRAPH-NAME          09030021
051870             MOVE 'ERROR ON FETCHING TIER PRICG ADHOC CURSOR'     09040021
051880                                    TO PV-DB2-OPERATION           09050021
051881             DISPLAY 'SQLCODE= ' SQLCODE                          09060021
051882             PERFORM 9900-SQL-ABEND-ROUTINE                       09070021
051883         END-EVALUATE                                             09080021
051884     END-PERFORM.                                                 09090008
051885                                                                  09100008
051886     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         09110021
051887       MOVE '2220-FETCH-TIER-PRICG-ADHOC'                         09120015
051888                               TO  PV-PARAGRAPH-NAME              09130008
051889       MOVE 'FETCH RETRIES EXCEEDED'                              09140015
051890                               TO  PV-DB2-OPERATION               09150008
051891       PERFORM 9900-SQL-ABEND-ROUTINE                             09160015
051892     END-IF.                                                      09170008
051893                                                                  09180008
051894*2220-EXIT.                                                       09190008
051895 EJECT.                                                           09200008
051896                                                                  09210008
051897*-----------------------------------------------------------      09220008
051898* 2230-CLOSE-TIER-PRICG-ADHOC.                                    09230008
051899*     CLOSE THE SIMPLE PRICING ADHOC CURSOR.                      09240008
051900*-----------------------------------------------------------      09250008
051901 2230-CLOSE-TIER-PRICG-ADHOC.                                     09260008
051902                                                                  09270008
051903     PERFORM                                                      09280008
051904         WITH TEST AFTER                                          09290008
051905         VARYING PV-SQL-SUB                                       09300008
051906         FROM 1 BY 1                                              09310008
051907         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 09320008
051908                   OR  SQLCODE = 0)                               09330008
051909                                                                  09340008
051910         EXEC SQL                                                 09350021
051911           CLOSE TIER-PRICG-ADHOC                                 09360021
051912         END-EXEC                                                 09370021
051913                                                                  09380008
051914         EVALUATE TRUE                                            09390021
051915           WHEN SQLCODE = -904                                    09400021
051916           WHEN SQLCODE = -911                                    09410021
051917           WHEN SQLCODE = -913                                    09420021
051918           WHEN SQLCODE = 0                                       09430021
051919             CONTINUE                                             09440021
051920           WHEN SQLWARN0 NOT EQUAL SPACE                          09450021
051921           WHEN SQLCODE NOT EQUAL ZERO                            09460021
051922             MOVE '2230-CLOSE-TIER-PRICG-ADHOC'                   09470021
051923                                     TO PV-PARAGRAPH-NAME         09480021
051924             MOVE 'ERROR ON CLOSE OF TIER PRICG ADHOC CURSOR'     09490021
051925                                     TO PV-DB2-OPERATION          09500021
051926             PERFORM 9900-SQL-ABEND-ROUTINE                       09510021
051927         END-EVALUATE                                             09520021
051928     END-PERFORM.                                                 09530008
051929                                                                  09540008
051930     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         09550008
051931       MOVE '2230-CLOSE-TIER-PRICG-ADHOC'                         09560015
051932                               TO  PV-PARAGRAPH-NAME              09570008
051933       MOVE 'CLOSE RETRIES EXCEEDED'                              09580015
051934                               TO  PV-DB2-OPERATION               09590008
051935       PERFORM 9900-SQL-ABEND-ROUTINE                             09600015
051936     END-IF.                                                      09610008
051937                                                                  09620008
051938*2230-EXIT.                                                       09630008
051939 EJECT.                                                           09640008
051940                                                                  09650008
052104*-----------------------------------------------------------      09660008
052105* 3000-FORMAT-RMS-OUTPUT.                                         09670008
052106*     POPULATE COPYBOOK EPRD072.                                  09680008
052107*-----------------------------------------------------------      09690008
052108 3000-FORMAT-RMS-OUTPUT.                                          09700008
052109                                                                  09710008
052110     INITIALIZE EP072-PROMO-INTFC-RECORD.                         09720008
052111     MOVE PC-PRICING-BUS-EVENT                                    09730008
052112                             TO EP072-BUSINESS-EVENT-ID.          09740008
052113     MOVE PC-RMS-PRC-SETUP-IND                                    09750008
052114                             TO EP072-PRC-SETUP-IND.              09760008
052115     MOVE XST00029-STR-GP-TYP-CDE                                 09770008
052116                             TO EP072-SETUP-STR-GRP-TYP-CDE.      09780008
052117     MOVE XST00029-STR-GP-ID                                      09790008
052118                             TO EP072-SETUP-STR-GRP-ID.           09800008
052119     MOVE XST00029-STR-SELN-HIER-CDE                              09810008
052120                             TO EP072-STR-SELN-HIER-CDE.          09820008
052121     MOVE XST00029-STR-GP-TYP-CDE                                 09830008
052122                             TO EP072-DIST-STR-GRP-TYP-CDE.       09840008
052123     MOVE XST00029-STR-GP-ID                                      09850008
052124                             TO EP072-DIST-STR-GRP-ID.            09860008
052125     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               09870008
052126                                                                  09880019
052127     MOVE XST00029-ACTL-STRT-TMST                                 09890008
052128                             TO PV-ACTL-STRT-TMST.                09900008
052129                                                                  09910008
052130     IF PV-ACTL-STRT-TMST-DATE > EP128-CC-CRITICAL-DTE            09920008
052131       AND PV-ACTL-STRT-TMST-DATE < EP113-CC-CRNT-DTE             09930015
052132         MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND               09940015
052133     ELSE                                                         09950008
052134       IF PV-ACTL-STRT-TMST-DATE <= EP128-CC-CRITICAL-DTE         09960008
052135         MOVE PC-APPLY-CORRECTION                                 09970015
052136                                  TO EP072-APPLY-IND              09980008
052137       END-IF                                                     09990008
052138     END-IF.                                                      10000008
052139                                                                  10010008
052156     MOVE XST00029-PROMO-INTFC-ID                                 10020015
052157                             TO EP072-PROMO-INTFC-ID.             10030015
052158     MOVE XST00029-MDSE-LNE-ID                                    10040015
052159                             TO EP072-MERCH-LNE-ID.               10050015
052160     MOVE XST00028-PRICG-TYP-CDE                                  10060015
052161                             TO EP072-PRICG-TYP-CDE.              10070015
052162     MOVE PC-MDSE-INCL-IND                                        10080015
052163                             TO EP072-MDSE-INC-EXC-IND.           10090015
052164     MOVE XST00029-ACTL-STRT-TMST                                 10100015
052165                             TO EP072-STR-GRP-PROMO-STRT-TMST.    10110015
052166     MOVE XST00029-ACTL-END-TMST                                  10120015
052167                             TO EP072-STR-GRP-PROMO-END-TMST.     10130015
052168     MOVE XST00035-SOR-LAST-UPD-TMST                              10140015
052169                             TO EP072-SOR-LAST-UPD-TMST.          10150015
052170                                                                  10160015
052185     MOVE XST00035-STAT-CDE  TO PC-TIER-PRICG-STAT-CDE.           10170019
052186                                                                  10180018
052188     IF EP072-APPLY-NIGHTLY                                       10190015
052189       IF PC-SCHEDULED-STATUS                                     10200018
052191         MOVE PC-ADD-STAT-CDE          TO EP072-RECORD-ACTION     10210018
052192         PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                    10220018
052193       ELSE                                                       10230018
052194         IF PC-DELETE-STATUS OR PC-CANCEL-STATUS                  10240018
052195           MOVE PC-ADD-STAT-CDE        TO EP072-RECORD-ACTION     10250018
052196           PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                  10260018
052197           MOVE PC-DELETE-STAT-CDE     TO EP072-RECORD-ACTION     10270018
052198           MOVE XST00035-PROMO-INTFC-SUB-ID                       10280018
052199                                       TO EP072-PROMO-INTFC-SUB-ID10290018
052200           PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                  10300018
052201         END-IF                                                   10310018
052202       END-IF                                                     10320018
052203     END-IF.                                                      10330026
052204                                                                  10340026
052205     IF EP072-APPLY-CORRECTION                                    10350026
052206       IF PC-SCHEDULED-STATUS                                     10360018
052207         MOVE PC-ADD-STAT-CDE          TO EP072-RECORD-ACTION     10370018
052208*        PERFORM 4100-WRITE-EMERG-APPLY-RECORD                    10380023
052209         MOVE PC-APPLY-NIGHTLY         TO EP072-APPLY-IND         10390023
052210         PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                    10400018
052211       ELSE                                                       10410018
052212         IF PC-DELETE-STATUS OR PC-CANCEL-STATUS                  10420018
052213           MOVE PC-ADD-STAT-CDE        TO EP072-RECORD-ACTION     10430018
052215           MOVE PC-APPLY-NIGHTLY       TO EP072-APPLY-IND         10440023
052216           PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                  10450018
052217           MOVE PC-DELETE-STAT-CDE     TO EP072-RECORD-ACTION     10460018
052218           MOVE XST00035-PROMO-INTFC-SUB-ID                       10470018
052219                                       TO EP072-PROMO-INTFC-SUB-ID10480018
052220           MOVE PC-APPLY-CORRECTION    TO EP072-APPLY-IND         10490024
052222           MOVE PC-APPLY-NIGHTLY       TO EP072-APPLY-IND         10500023
052223           PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                  10510018
052224         END-IF                                                   10520018
052225       END-IF                                                     10530018
052226     END-IF.                                                      10540018
052227                                                                  10550018
052228*3000-EXIT.                                                       10560018
052229 EJECT.                                                           10570018
052230*-----------------------------------------------------------      10580018
052231* 3100-FORMAT-ADHOC-OUTPUT.                                       10590018
052232*     POPULATE COPYBOOK EPRD072.                                  10600018
052233*-----------------------------------------------------------      10610018
052234 3100-FORMAT-ADHOC-OUTPUT.                                        10620018
052235                                                                  10630018
052236     INITIALIZE EP072-PROMO-INTFC-RECORD.                         10640018
052237     MOVE PC-PRICING-BUS-EVENT                                    10650018
052238                             TO EP072-BUSINESS-EVENT-ID.          10660018
052239     MOVE PC-ADHOC-PRC-SETUP-IND                                  10670018
052240                             TO EP072-PRC-SETUP-IND.              10680018
052241     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                10690018
052242                             TO EP072-SETUP-STR-GRP-TYP-CDE.      10700018
052243     MOVE XST00031-ADHC-STR-GP-ID                                 10710018
052244                             TO EP072-SETUP-STR-GRP-ID.           10720018
052245     MOVE XST00031-STR-SELN-HIER-CDE                              10730018
052246                             TO EP072-STR-SELN-HIER-CDE.          10740018
052247     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                10750018
052248                             TO EP072-DIST-STR-GRP-TYP-CDE.       10760018
052249     MOVE XST00031-ADHC-STR-GP-ID                                 10770018
052250                             TO EP072-DIST-STR-GRP-ID.            10780008
052251     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               10790008
052252                                                                  10800008
052260     MOVE XST00031-ACTL-STRT-TMST                                 10810008
052270                             TO PV-ACTL-STRT-TMST.                10820008
052280                                                                  10830008
052281     IF PV-ACTL-STRT-TMST-DATE > EP128-CC-CRITICAL-DTE            10840008
052282       AND PV-ACTL-STRT-TMST-DATE < EP113-CC-CRNT-DTE             10850015
052283         MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND               10860015
052284     ELSE                                                         10870008
052285       IF PV-ACTL-STRT-TMST-DATE <= EP128-CC-CRITICAL-DTE         10880008
052286         MOVE PC-APPLY-CORRECTION                                 10890015
052287                                  TO EP072-APPLY-IND              10900008
052288       END-IF                                                     10910008
052289     END-IF.                                                      10920008
052311                                                                  10930008
052312     MOVE XST00031-PROMO-INTFC-ID                                 10940008
052313                             TO EP072-PROMO-INTFC-ID.             10950008
052314     MOVE XST00031-MDSE-LNE-ID                                    10960008
052315                             TO EP072-MERCH-LNE-ID.               10970008
052316     MOVE XST00028-PRICG-TYP-CDE                                  10980008
052317                             TO EP072-PRICG-TYP-CDE.              10990008
052318     MOVE PC-MDSE-INCL-IND                                        11000008
052319                             TO EP072-MDSE-INC-EXC-IND.           11010008
052320     MOVE XST00031-ACTL-STRT-TMST                                 11020008
052321                             TO EP072-STR-GRP-PROMO-STRT-TMST.    11030008
052322     MOVE XST00031-ACTL-END-TMST                                  11040008
052323                             TO EP072-STR-GRP-PROMO-END-TMST.     11050008
052324     MOVE XST00035-SOR-LAST-UPD-TMST                              11060008
052325                             TO EP072-SOR-LAST-UPD-TMST.          11070008
052327                                                                  11080019
052346     MOVE XST00035-STAT-CDE  TO PC-TIER-PRICG-STAT-CDE.           11090019
052347                                                                  11100019
052348     IF EP072-APPLY-NIGHTLY                                       11110019
052349       IF PC-SCHEDULED-STATUS                                     11120019
052350         MOVE PC-ADD-STAT-CDE          TO EP072-RECORD-ACTION     11130019
052351         PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                    11140019
052352       ELSE                                                       11150019
052353         IF PC-DELETE-STATUS OR PC-CANCEL-STATUS                  11160019
052354           MOVE PC-ADD-STAT-CDE        TO EP072-RECORD-ACTION     11170019
052355           PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                  11180019
052356           MOVE PC-DELETE-STAT-CDE     TO EP072-RECORD-ACTION     11190019
052357           MOVE XST00035-PROMO-INTFC-SUB-ID                       11200019
052358                                       TO EP072-PROMO-INTFC-SUB-ID11210019
052359           PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                  11220019
052360         END-IF                                                   11230019
052361       END-IF                                                     11240019
052362     END-IF.                                                      11250027
052363                                                                  11260027
052364     IF EP072-APPLY-CORRECTION                                    11270027
052365       IF PC-SCHEDULED-STATUS                                     11280019
052366         MOVE PC-ADD-STAT-CDE          TO EP072-RECORD-ACTION     11290019
052368         MOVE PC-APPLY-NIGHTLY         TO EP072-APPLY-IND         11300023
052369         PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                    11310023
052370       ELSE                                                       11320019
052371         IF PC-DELETE-STATUS OR PC-CANCEL-STATUS                  11330019
052372           MOVE PC-ADD-STAT-CDE        TO EP072-RECORD-ACTION     11340019
052375           MOVE PC-APPLY-NIGHTLY       TO EP072-APPLY-IND         11350023
052376           PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                  11360023
052377           MOVE PC-DELETE-STAT-CDE     TO EP072-RECORD-ACTION     11370019
052378           MOVE XST00035-PROMO-INTFC-SUB-ID                       11380019
052379                                       TO EP072-PROMO-INTFC-SUB-ID11390019
052380           MOVE PC-APPLY-CORRECTION    TO EP072-APPLY-IND         11400025
052382           MOVE PC-APPLY-NIGHTLY       TO EP072-APPLY-IND         11410023
052383           PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                  11420019
052384         END-IF                                                   11430019
052385       END-IF                                                     11440019
052386     END-IF.                                                      11450019
052387                                                                  11460008
052388*3100-EXIT.                                                       11470008
052389 EJECT.                                                           11480008
052390                                                                  11490008
052451*----------------------------------------------------------       11500008
052452* 4000-WRITE-NIGHT-APPLY-RECORD.                                  11510008
052453*     WRITES THE PROMO FULL FILE RECORD TO THE FULL FILE          11520008
052454*----------------------------------------------------------       11530008
052455 4000-WRITE-NIGHT-APPLY-RECORD.                                   11540008
052456                                                                  11550008
052457     WRITE PROMO-NIGHT-RECORD FROM EP072-PROMO-INTFC-RECORD.      11560008
052458                                                                  11570008
052459     ADD 1           TO PC-CNT-NIGHT-RECS                         11580008
052460                        PC-CNT-ALL-RECS.                          11590008
052470                                                                  11600008
052480*4000-EXIT.                                                       11610008
052490 EJECT.                                                           11620008
052500                                                                  11630008
052830*----------------------------------------------------------       11640015
052840* DATE ROUTINE TO SET UP THE PROCESS DATE IN                      11650015
052850* CCYYMMDD FORMAT.                                                11660015
052860*----------------------------------------------------------       11670015
052870 6100-DATE-ROUTINE.                                               11680008
052880                                                                  11690008
052890     INITIALIZE DPG51 DPG52 DPG53                                 11700008
052900                DPG54 DPG55 DPG56.                                11710008
053000                                                                  11720008
053100     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      11730008
053200     SET DPG51-INCREMENT-DATE       TO TRUE.                      11740008
053210     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      11750008
053220     MOVE 1                         TO DPG51-INCR-DECR-DAYS-9.    11760008
053230     MOVE EP111-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    11770008
053240                                                                  11780008
053241     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    11790008
053242                                             DPG54 DPG55 DPG56.   11800008
053243                                                                  11810008
053244     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  11820008
053245       DISPLAY '** ABEND **'                                      11830015
053246       DISPLAY '** PROGRAM = EPKUT351'                            11840015
053247       DISPLAY 'DATE = ' EP111-CC-CRNT-DTE                        11850015
053248       DISPLAY DPG54-ERROR-MESSAGE                                11860015
053249       MOVE 4019 TO PV-ABEND-CODE                                 11870015
053250       CALL 'ILBOABN0' USING PV-ABEND-CODE                        11880015
053251     END-IF.                                                      11890015
053252                                                                  11900008
053253     MOVE DPG55-DB2-ISO-DATE-FMT     TO EP111-CC-DATE-PLUS1.      11910008
053254                                                                  11920008
053255     INITIALIZE DPG51 DPG52 DPG53                                 11930008
053256                DPG54 DPG55 DPG56.                                11940008
053257                                                                  11950008
053258     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      11960008
053259     SET DPG51-DECREMENT-DATE       TO TRUE.                      11970008
053260     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      11980008
053261     MOVE 1                         TO DPG51-INCR-DECR-DAYS-9.    11990008
053262     MOVE EP113-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    12000008
053263                                                                  12010008
053264     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    12020008
053265                                             DPG54 DPG55 DPG56.   12030008
053266                                                                  12040008
053267     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  12050008
053268       DISPLAY '** ABEND **'                                      12060015
053269       DISPLAY '** PROGRAM = EPKUT351'                            12070015
053270       DISPLAY 'DATE = ' EP111-CC-CRNT-DTE                        12080015
053271       DISPLAY DPG54-ERROR-MESSAGE                                12090015
053272       MOVE 4019 TO PV-ABEND-CODE                                 12100015
053273       CALL 'ILBOABN0' USING PV-ABEND-CODE                        12110015
053274     END-IF.                                                      12120015
053275                                                                  12130008
053276     MOVE DPG55-DB2-ISO-DATE-FMT    TO EP113-CC-CRNT-DTE-MINUS1.  12140008
053277                                                                  12150008
053278*6100-EXIT.                                                       12160008
053279 EJECT.                                                           12170008
053280                                                                  12180008
054800*----------------------------------------------------------       12190008
054900* 9900-SQL-ABEND-ROUTINE.                                         12200008
055000*     SQL ABEND ROUTINE.                                          12210008
055100*----------------------------------------------------------       12220008
055200 9900-SQL-ABEND-ROUTINE.                                          12230008
055300                                                                  12240008
055400     DISPLAY '** ABEND     **'.                                   12250008
055500     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        12260008
055600     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              12270008
055700     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               12280008
055800                                                                  12290008
055900     COPY DPPD004.                                                12300008
056000     SET ABEND-4013-DB2-ERROR TO TRUE.                            12310008
056100     CALL 'ILBOABN0' USING ABEND-CODE.                            12320008
056200                                                                  12330008
056300*9900-EXIT.                                                       12340008
056400 EJECT.                                                           12350008
056500                                                                  12360008
056600*----------------------------------------------------------       12370008
056700* 9999-WRAPUP.                                                    12380008
056800*     END OF PROGRAM ROUTINE.  CLOSES ALL FILES AND DISPLAYS      12390008
056900*     ANY DATA FROM THE PROGRAM.                                  12400008
057000*----------------------------------------------------------       12410008
057100 9999-WRAPUP.                                                     12420008
057200                                                                  12430008
058000     CLOSE CONTROL-CARD-CURR-PRICG-DTE                            12440008
058010           CONTROL-CARD-FUTRE-CORR-DTE                            12450008
058011           CONTROL-CARD-PGM-CURR-TMST                             12460045
058020           CONTROL-CARD-PGM-LAST-RUN-TMST                         12470008
058030           CONTROL-CARD-CRIT-EFF-DTE                              12480008
058040           PROMO-NIGHT-FILE.                                      12490008
058060                                                                  12500008
058070     DISPLAY ' '.                                                 12510008
058080     DISPLAY '*********************************************'.     12520008
058090     DISPLAY 'PROGRAM NAME: ' PC-CURRENT-PROGRAM-NAME.            12530008
058100     DISPLAY '*********************************************'.     12540008
058200     DISPLAY 'NUMBER OF NIGHT RECS WRITTEN:   ' PC-CNT-NIGHT-RECS.12550009
058310     DISPLAY 'NUMBER OF ADD RECS WRITTEN:     ' PC-CNT-ADD-RECS.  12560009
058320     DISPLAY 'NUMBER OF DELETE RECS WRITTEN:  ' PC-CNT-DELTE-RECS.12570009
058400     DISPLAY 'NUMBER OF RECS FROM RMS QUERY:  ' PC-CNT-RMS-RECS.  12580009
058500     DISPLAY 'NUMBER OF RECS FROM ADHC QUERY: ' PC-CNT-ADHOC-RECS.12590008
058700     DISPLAY 'ALL RECS WRITTEN: ' PC-CNT-ALL-RECS.                12600008
058800     DISPLAY '*********************************************'.     12610008
058900                                                                  12620008
059000*9999-EXIT.                                                       12630008
059100 EJECT.                                                           12640008
059200                                                                  12650008
