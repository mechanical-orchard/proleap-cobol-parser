000100 TITLE 'STORE TRAILER SCAN SUMMARY'.                              00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300 PROGRAM-ID.    SUKCS548.                                         00030006
000400 AUTHOR.        DENISE HAHN.                                      00040000
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
000600 DATE-WRITTEN.  MARCH 2019.                                       00060000
000700 DATE-COMPILED.                                                   00070000
263968*---------------------------------------------------------------* 00071017
263968* CHANGED 11/15/2021    BY JIM HUNTER      WR: CHG0263968         00072017
263968* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00073017
263968* MAKING THE CALL DYNAMIC VS STATIC.                              00074017
263968*                                                                 00074118
001110* CHANGED 01/09/2023    BY JEAN KURK       WR: CHG0278099         00074218
001120* CHANGE CALL OF DPKCS030 TO BE DYNAMIC                           00074318
263968*---------------------------------------------------------------* 00075017
000800 ENVIRONMENT DIVISION.                                            00080000
000900 DATA DIVISION.                                                   00090000
001000                                                                  00100000
001100 WORKING-STORAGE SECTION.                                         00110000
001200                                                                  00120000
001300 01  DK-DB2-KEYS.                                                 00130000
001400     05  DK-OTBND-TRIP-ID             PIC S9(9) COMP VALUE ZERO.  00140000
001500                                                                  00150000
001600 01  PC-PROGRAM-CONSTANTS.                                        00160000
001700     05  PC-INTER-APPL-CODES.                                     00170000
001800         10  PC-INTER-APPL-LIST         PIC  X(01)  VALUE '2'.    00180000
001900     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00190000
002000                                                    'SU548A  '.   00200006
002100     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00210000
002200                                                    'SUKM548 '.   00220006
002300     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00230000
002400                                                    'SUKCS548'.   00240006
002500     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00250000
002600     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00260000
002700     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00270000
002800     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +10     00280000
002900                                                    COMP SYNC.    00290000
003000     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00300000
003100                                                    COMP SYNC.    00310000
003200     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00320000
003300                                                    +1000000      00330000
003400                                                    COMP-3.       00340000
003500     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00350000
003600                                                    COMP SYNC.    00360000
003700     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00370000
003800     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00380000
003900     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00390000
004000     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00400000
004100                                                                  00410000
004200* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00420000
004300* 00005 - INVALID VALUE                                         * 00430000
004400* 00008 - MUST BE NUMERIC                                       * 00440000
004410* 00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED   * 00441000
004411* 00051 - NO END OF RANGE HAS BEEN SPECIFIED                    * 00441100
004412* 00052 - END OF RANGE PRECEDES START OF RANGE                  * 00441200
004413* 00053 - NO START OF RANGE HAS BEEN SPECIFIED                  * 00441300
004414* 00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED    * 00441400
004415* 00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED      * 00441500
004416* 00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION        * 00441600
004417* 00069 - TOP OF LIST                                           * 00441700
004418* 00070 - BOTTOM OF LIST                                        * 00441800
004419* 00101 - VALUE MUST BE > ZERO AND < 100,000,000                * 00441900
004420* 00148 - DATA DOES NOT EXIST                                   * 00442000
004421* 00279 - MORE ITEMS TO DISPLAY                                 * 00442100
004422* 00551 - WAIT 15 SECONDS;RETRY FUNCTION AGAIN; IF UNSUCCESSFUL * 00442200
004423* 02816 - INVALID TRAILER STATUS FOR UPDATE FUNCTION            * 00442300
004424* 99901 - INVALID COMMAND WAS ENTERED                           * 00442400
004425* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00442500
004426     05  PC-TSYMSG-NUMBERS.                                       00442600
004427         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00442700
004428         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00442800
004429         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00442900
004430         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00443000
004440         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00444000
004450         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00445000
004460         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00446000
004470         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00447000
004480         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00448000
004490         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00449000
004500         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00450000
004600         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00460000
004700         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  00470000
004800         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00480000
004900         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  00490000
005000         10  PC-TSYMSG-02816            PIC  9(05)  VALUE 02816.  00500000
005100         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00510000
005200*                                                                 00520000
005300 01  PS-PROGRAM-SWITCHES.                                         00530000
005400     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'N'.    00540000
005500         88  PS-NO-ERROR                            VALUE 'N'.    00550000
005600         88  PS-ERROR                               VALUE 'Y'.    00560000
005700     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00570000
005800         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00580000
005900         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00590000
006000     05  PS-END-OF-CURSOR-SW            PIC  X(01)  VALUE 'N'.    00600000
006100         88  PS-END-OF-CURSOR                       VALUE 'Y'.    00610000
006200         88  PS-END-OF-CURSOR-NO                    VALUE 'N'.    00620000
006300     05  PS-LIST-END-SW                 PIC  X(01)  VALUE 'N'.    00630000
006400         88  PS-LIST-END                            VALUE 'Y'.    00640000
006500         88  PS-NO-LIST-END                         VALUE 'N'.    00650000
006600*                                                                 00660000
006700 01  PV-PROGRAM-VARIABLES.                                        00670000
006800     05  PV-SUB                         PIC S9(04)  VALUE +0      00680000
006900                                                    COMP SYNC.    00690000
007000     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00700000
007100                                                    COMP SYNC.    00710000
007200     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00720000
007300                                                    COMP-3.       00730000
007400     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00740000
007500                                                    COMP-3.       00750000
007600     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      00760000
007700                                                    COMP-3.       00770000
007800     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00780000
007900                                                    COMP-3.       00790000
008000     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      00800000
008100                                                    COMP-3.       00810000
008200     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      00820000
008300                                                    COMP-3.       00830000
008400     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      00840000
008500                                                    COMP-3.       00850000
008600     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      00860000
008700                                                    COMP SYNC.    00870000
008800     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      00880000
008900                                                    COMP SYNC.    00890000
009000     05  PV-ITEM                        PIC S9(04)  VALUE +0      00900000
009100                                                    COMP SYNC.    00910000
009200     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      00920000
009300                                                    COMP SYNC.    00930000
009400     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      00940000
009500                                                    COMP SYNC.    00950000
009600     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      00960000
009700                                                    COMP SYNC.    00970000
009800     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      00980000
009900                                                    COMP SYNC.    00990000
010000     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01000000
010100                                                    COMP SYNC.    01010000
010200     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01020000
010300                                                    COMP SYNC.    01030000
010400     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01040000
010500                                                    COMP SYNC.    01050000
010600     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01060000
010700                                                    COMP SYNC.    01070000
010800     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01080000
010900                                                    COMP SYNC.    01090000
011000     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01100000
011100                                                    COMP SYNC.    01110000
011200     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01120000
011300                                                    COMP SYNC.    01130000
011400     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01140000
011500                                                    COMP SYNC.    01150000
011600     05  PV-DB2-DATE.                                             01160000
011700         10  PV-DB2-MM                PIC XX VALUE ZERO.          01170000
011800         10  FILLER                   PIC X VALUE '/'.            01180000
011900         10  PV-DB2-DD                PIC XX VALUE ZERO.          01190000
012000         10  FILLER                   PIC X VALUE '/'.            01200000
012100         10  PV-DB2-YY                PIC XX VALUE ZERO.          01210000
012200     05  PV-DATE                      PIC  X(10) VALUE SPACES.    01220000
012300     05  PV-TIME                      PIC  X(08) VALUE SPACES.    01230000
012400     05  PV-DB2-COUNT                 PIC S9(08) COMP VALUE ZERO. 01240000
012500     05  PV-SCAN-TYPE-COUNT           PIC S9(09) COMP VALUE ZERO. 01250000
012600     05  PV-SCAN-COUNT                PIC S9(09) COMP VALUE ZERO. 01260000
012700     05  PV-NOT-SCAN-COUNT            PIC S9(09) COMP VALUE ZERO. 01270000
012800     05  PV-ATTR-ELEM-NBR             PIC  S9(10)V9(5) COMP-3.    01280000
012900     05  PV-DISP-TRIP                 PIC  Z(09) VALUE ZERO.      01290000
013000     05  PV-WORK-TMST                 PIC  X(26) VALUE SPACES.    01300000
013010     05  PV-WORK-TMST-R REDEFINES PV-WORK-TMST.                   01301000
013020         10 PV-CC                     PIC  X(02).                 01302000
013030         10 PV-YY                     PIC  X(02).                 01303000
013031         10 FILLER                    PIC  X(01).                 01303100
013032         10 PV-MM                     PIC  X(02).                 01303200
013033         10 FILLER                    PIC  X(01).                 01303300
013034         10 PV-DD                     PIC  X(02).                 01303400
013035         10 FILLER                    PIC  X(01).                 01303500
013036         10 PV-HR                     PIC  X(02).                 01303600
013037         10 FILLER                    PIC  X(01).                 01303700
013038         10 PV-MN                     PIC  X(02).                 01303800
013039         10 FILLER                    PIC  X(10).                 01303900
013040                                                                  01304000
013050     05  PV-WORK-DATE                 PIC  X(08) VALUE SPACES.    01305000
013060     05  PV-WORK-DATE-R REDEFINES PV-WORK-DATE.                   01306000
013070         10 PV-DATE-YY                PIC  X(02).                 01307000
013080         10 PV-DATE-DASH-1            PIC  X(01).                 01308000
013090         10 PV-DATE-MM                PIC  X(02).                 01309000
013100         10 PV-DATE-DASH-2            PIC  X(01).                 01310000
013110         10 PV-DATE-DD                PIC  X(02).                 01311000
013120                                                                  01312000
013130     05  PV-WORK-TIME                 PIC  X(05) VALUE SPACES.    01313000
013140     05  PV-WORK-TIME-R REDEFINES PV-WORK-TIME.                   01314000
013150         10 PV-TIME-HR                PIC  X(02).                 01315000
013160         10 PV-TIME-COLON             PIC  X(01).                 01316000
013170         10 PV-TIME-MN                PIC  X(02).                 01317000
013180******************************************************************01318000
013190**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01319000
013200**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01320000
013300**  APPLICATION-SPECIFIC COMMAREA.                              **01330000
013400******************************************************************01340000
013500 01  LQW-LIST-QUEUE-WORK-AREA.                                    01350000
013600     05  LQW-BLOCK-MODIFIED           PIC  X(01)  VALUE SPACE.    01360000
013700     05  LQW-ITEM-ENTRIES                  OCCURS 10 TIMES        01370000
013800                                           INDEXED BY LQW-IDX.    01380000
013900         10  LQW-LIST-ITEM-NUMBER     PIC S9(09)  COMP-3.         01390000
014000         10  LQW-TEMP-SELECTED-SW     PIC  X(01).                 01400000
014100         10  LQW-SELECTED-SW          PIC  X(01).                 01410000
014200             88  LQW-SELECT                         VALUE 'S'.    01420000
014300             88  LQW-DESELECT                       VALUE ' '.    01430000
014400         10  LQW-ACTION               PIC  X(03).                 01440000
014500         10  LQW-SCAN-CODE            PIC  X(04).                 01450000
014600         10  LQW-SCAN-DESCR           PIC  X(50).                 01460000
014700         10  LQW-SCAN-COUNT           PIC  9(09).                 01470003
014800                                                                  01480000
014900                                                                  01490000
015000*---------------------------------------------------------------* 01500000
015100*  RECORD LAYOUT FOR THE MESSAGE SELECTION TEMP STORAGE QUEUE.  * 01510000
015200*---------------------------------------------------------------* 01520000
015300                                                                  01530000
015400     COPY SUWS010.                                                01540000
015500                                                                  01550000
015600                                                                  01560000
015700*---------------------------------------------------------------* 01570000
015800*    MAP LAYOUT                                                 * 01580000
015900*---------------------------------------------------------------* 01590000
016000                                                                  01600000
016100     COPY SUKM548.                                                01610006
016200*                                                                 01620000
016300 01  MR-OCCURS-LAYOUT                   REDEFINES  SU548AO.       01630006
016400     05  FILLER                         PIC X(343).               01640015
016500     05  MR-SCROLL-AREA                 OCCURS 10 TIMES.          01650000
016600         10  MR-SELECTL                 PIC S9(04) COMP.          01660000
016700         10  MR-SELECTA                 PIC  X(01).               01670000
016800         10  MR-SELECTC                 PIC  X(01).               01680000
016900         10  MR-SELECTH                 PIC  X(01).               01690000
017000         10  MR-SELECTI                 PIC  X(01).               01700000
017100                                                                  01710000
017200         10  MR-ACTIONL                 PIC S9(04) COMP.          01720000
017300         10  MR-ACTIONA                 PIC  X(01).               01730000
017400         10  MR-ACTIONC                 PIC  X(01).               01740000
017500         10  MR-ACTIONH                 PIC  X(01).               01750000
017600         10  MR-ACTION                  PIC  X(03).               01760000
017700                                                                  01770000
017710         10  MR-SCAN-CODEL              PIC S9(04) COMP.          01771008
017720         10  MR-SCAN-CODEA              PIC  X(01).               01772008
017730         10  MR-SCAN-CODEC              PIC  X(01).               01773008
017740         10  MR-SCAN-CODEH              PIC  X(01).               01774008
017750         10  MR-SCAN-CODE               PIC  X(04).               01775008
017760                                                                  01776008
017800         10  MR-SCAN-DESCR-L            PIC S9(04) COMP.          01780000
017900         10  MR-SCAN-DESCR-A            PIC  X(01).               01790000
018000         10  MR-SCAN-DESCR-C            PIC  X(01).               01800000
018100         10  MR-SCAN-DESCR-H            PIC  X(01).               01810000
018200         10  MR-SCAN-DESCR              PIC  X(50).               01820000
018300                                                                  01830000
018400         10  MR-SCAN-CNT-L              PIC S9(04) COMP.          01840000
018500         10  MR-SCAN-CNT-A              PIC  X(01).               01850000
018600         10  MR-SCAN-CNT-C              PIC  X(01).               01860000
018700         10  MR-SCAN-CNT-H              PIC  X(01).               01870000
018800         10  MR-SCAN-CNT                PIC  Z(07).               01880003
018900                                                                  01890000
019000     05  FILLER                         PIC X(012).               01900000
019100/                                                                 01910000
019200*---------------------------------------------------------------* 01920000
019300*    ASSOCIATE INFO SUBROUTINE PARAMETERS                         01930000
019400*---------------------------------------------------------------* 01940000
019500                                                                  01950000
019600     COPY XLWS067.                                                01960000
019700                                                                  01970000
019800*---------------------------------------------------------------* 01980000
019900*    ATTRIBUTE SETTINGS                                           01990000
020000*---------------------------------------------------------------* 02000000
020100                                                                  02010000
020200     COPY DPWS015.                                                02020000
020300                                                                  02030000
020400*---------------------------------------------------------------* 02040000
020500*    FUNCTION KEYS                                                02050000
020600*---------------------------------------------------------------* 02060000
020700                                                                  02070000
020800     COPY DPWS016.                                                02080000
020900                                                                  02090000
021000*---------------------------------------------------------------* 02100000
021100*    NUMERIC EDIT LAYOUT.                                       * 02110000
021200*---------------------------------------------------------------* 02120000
021300                                                                  02130000
021400     COPY DPWS010I.                                               02140000
021500/                                                                 02150000
021600*---------------------------------------------------------------* 02160000
021700*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * 02170018
021800*---------------------------------------------------------------* 02180000
021900                                                                  02190000
022000     COPY DPWS030.                                                02200000
022000     COPY DPWS930.                                                02201018
022100/                                                                 02210000
022200*---------------------------------------------------------------* 02220000
022300*    STANDARD COMMAREA.                                         * 02230000
022400*---------------------------------------------------------------* 02240000
022500                                                                  02250000
022600     COPY DPWS020.                                                02260000
022700     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02270000
022800                                                                  02280000
022900*---------------------------------------------------------------* 02290000
023000* INTER-APPLICATION COMMAREA.                                   * 02300000
023100*   DPWS054 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 02310000
023200*             SPEC SCREEN.                                      * 02320000
023300*   DPWS056 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 02330000
023400*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 02340000
023500*---------------------------------------------------------------* 02350000
023600                                                                  02360000
023700         10  INTER-APPL-COMM-AREA       PIC X(200).               02370000
023800                                                                  02380000
023900*                                                                 02390000
024000     COPY SUWS009.                                                02400000
024100*---------------------------------------------------------------* 02410000
024200*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02420000
024300*---------------------------------------------------------------* 02430000
024400         10  ASC-SPECIFIC-COMMAREA.                               02440000
024500             15  ASC-INT-APPL-FORMAT-IND    PIC  X(01).           02450000
024600             15  ASC-LIST-KEYS.                                   02460000
024700                 20  ASC-KEY-TRIP-ID        PIC S9(09) COMP.      02470000
024800                 20  ASC-KEY-SCAC           PIC  X(04).           02480000
024900                 20  ASC-KEY-TRLR           PIC  X(12).           02490000
025000                 20  ASC-KEY-SRL            PIC  9(09).           02500000
025100             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02510000
025200                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  02520000
025300                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   02530000
025400                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   02540000
025500                                                                  02550000
025600                 20  ASC-ITEM-ARRAY.                              02560000
025700                     25  ASC-ITEM-ENTRIES OCCURS 10 TIMES.        02570000
025800                         30  ASC-LIST-ITEM-NUMBER                 02580000
025900                                                     PIC S9(09)   02590000
026000                                                     COMP-3.      02600000
026100                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  02610000
026200                             88  ASC-VALID-SELECT    VALUE ' '    02620000
026300                                                           'S'.   02630000
026400                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   02640000
026500                             88  ASC-TEMP-SELECT     VALUE 'S'.   02650000
026600                         30  ASC-SELECTED-SW         PIC  X(01).  02660000
026700                             88  ASC-NO-SELECT       VALUE ' '.   02670000
026800                             88  ASC-SELECT          VALUE 'S'.   02680000
026900                         30  ASC-ACTION              PIC  X(03).  02690000
027000                         30  ASC-SCAN-CDE            PIC  X(04).  02700008
027100                         30  ASC-TYPE-DESC           PIC  X(50).  02710000
027200                         30  ASC-SCAN-CNT            PIC  9(09).  02720000
027300                                                                  02730000
027400             15  ASC-STR-NBR       PIC  9(04).                    02740000
027410             15  ASC-TRLR-STATUS   PIC  X(10).                    02741012
027500             15  ASC-STORE-NAME    PIC  X(50).                    02750000
027600             15  ASC-CARTON-CNT    PIC S9(09) COMP-3.             02760000
027700             15  ASC-UNIT-CNT      PIC S9(09) COMP-3.             02770000
027800             15  ASC-TOTAL-SCAN    PIC S9(09) COMP-3.             02780000
027900             15  ASC-MFST-NO-SCN   PIC S9(09) COMP-3.             02790000
028000             15  ASC-SO-DATE       PIC  X(08).                    02800000
028100             15  ASC-SO-TIME       PIC  X(05).                    02810000
028200             15  ASC-SO-NAME       PIC  X(23).                    02820000
028300             15  ASC-SU-DATE       PIC  X(08).                    02830000
028400             15  ASC-SU-TIME       PIC  X(05).                    02840000
028500             15  ASC-SU-NAME       PIC  X(23).                    02850000
028600             15  ASC-STR-DVRT      PIC  9(04).                    02860000
028700                                                                  02870000
028800             15  ASC-BLK-SUB          PIC S9(04) COMP SYNC.       02880000
028900             15  ASC-ITEM-SUB         PIC S9(04) COMP SYNC.       02890000
029000             15  ASC-NUMBER-OF-ITEMS-READ      PIC S9(09) COMP-3. 02900000
029100             15  ASC-NUMBER-OF-SELECTED-ITEMS  PIC S9(09) COMP-3. 02910000
029200             15  ASC-ITEMS-DISPLAYED           PIC S9(03) COMP-3. 02920000
029300             15  ASC-ITEM-AT-TOP-OF-PANEL      PIC S9(09) COMP-3. 02930000
029400             15  ASC-ITEM-AT-BOT-OF-PANEL      PIC S9(09) COMP-3. 02940000
029500             15  ASC-HIGHEST-BLOCK-WRITTEN     PIC S9(04) COMP    02950000
029600                                                          SYNC.   02960000
029700             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   02970000
029800                                                          COMP-3. 02980000
029900             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   02990000
030000                                                          COMP-3. 03000000
030100             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03010000
030200                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03020000
030300                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03030000
030400             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03040000
030500                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03050000
030600                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03060000
030700             15  ASC-LIST-QUEUE-NAME.                             03070000
030800                 20  ASC-LIST-TERM-ID                PIC  X(04).  03080000
030900                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03090000
031000                                                          COMP-3. 03100000
031100                 20  ASC-LIST-SEQ                    PIC  9(01).  03110000
031200             15  ASC-SEL-QUEUE-NAME-IN.                           03120000
031300                 20  ASC-SEL-TERM-ID-IN              PIC  X(04).  03130000
031400                 20  ASC-SEL-TASK-NUMBER-IN          PIC S9(05)   03140000
031500                                                          COMP-3. 03150000
031600                 20  ASC-SEL-SEQ-IN                  PIC  9(01).  03160000
031700             15  ASC-SEL-QUEUE-NAME-OUT.                          03170000
031800                 20  ASC-SEL-TERM-ID-OUT             PIC  X(04).  03180000
031900                 20  ASC-SEL-TASK-NUMBER-OUT         PIC S9(05)   03190000
032000                                                          COMP-3. 03200000
032100                 20  ASC-SEL-SEQ-OUT                 PIC  9(01).  03210000
032200                                                                  03220000
032300             15  ASC-USE-SELECTION-QUEUE-IND                      03230000
032400                                                 PIC  X(01).      03240000
032500                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 03250000
032600             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05)  COMP-3.    03260000
032700             15  ASC-SEL-SUB               PIC S9(04)  COMP.      03270000
032800             15  ASC-SEL-ITEM              PIC S9(04)  COMP.      03280000
032900             15  ASC-START-ITEM-REQUEST.                          03290000
033000                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03300000
033100                                                                  03310000
033200                                                                  03320000
033300                                                                  03330000
033400*    ABEND PROCESSING                                             03340000
033500                                                                  03350000
033600     COPY DPWS013.                                                03360000
033700                                                                  03370000
033800*----------------------------------------------------------------*03380000
033900*  TSUOBTR - OUTBOUND TRIP                                       *03390001
034000*----------------------------------------------------------------*03400000
034100     EXEC SQL                                                     03410000
034200          INCLUDE TSUOBTR                                         03420001
034300     END-EXEC.                                                    03430000
034400                                                                  03440000
034500                                                                  03450000
034501*----------------------------------------------------------------*03450101
034502*  TCNTRID - OUTBOUND TRAILER ID                                 *03450201
034503*----------------------------------------------------------------*03450301
034504     EXEC SQL                                                     03450401
034505          INCLUDE TCNTRID                                         03450501
034506     END-EXEC.                                                    03450601
034507                                                                  03450701
034508                                                                  03450801
034510*----------------------------------------------------------------*03451001
034520*  SUT_TRIP_SUM                                                  *03452001
034530*----------------------------------------------------------------*03453001
034540     EXEC SQL                                                     03454001
034550          INCLUDE SUT00007                                        03455001
034560     END-EXEC.                                                    03456001
034570                                                                  03457001
034580                                                                  03458001
034600*----------------------------------------------------------------*03460000
034700*  SUT_OTBND_CART                                                *03470000
034800*----------------------------------------------------------------*03480000
034900     EXEC SQL                                                     03490000
035000          INCLUDE SUT00024                                        03500000
035100     END-EXEC.                                                    03510000
035200                                                                  03520000
035300                                                                  03530000
035400*----------------------------------------------------------------*03540000
035500*  SUT_OTBND_SCN_TYP                                             *03550000
035600*----------------------------------------------------------------*03560000
035700     EXEC SQL                                                     03570000
035800          INCLUDE SUT00120                                        03580000
035900     END-EXEC.                                                    03590000
036000                                                                  03600000
036100                                                                  03610000
036200*----------------------------------------------------------------*03620000
036300*  SUT_OTBND_STR_SCN                                             *03630000
036400*----------------------------------------------------------------*03640000
036500     EXEC SQL                                                     03650000
036600          INCLUDE SUT00121                                        03660000
036700     END-EXEC.                                                    03670000
036800                                                                  03680000
036900                                                                  03690000
037000*----------------------------------------------------------------*03700000
037100*  WST_INTGRTN_TYP                                               *03710000
037200*----------------------------------------------------------------*03720000
037300     EXEC SQL                                                     03730000
037400          INCLUDE WST00008                                        03740000
037500     END-EXEC.                                                    03750000
037600                                                                  03760000
037700                                                                  03770000
037800*----------------------------------------------------------------*03780000
037900*  WST_ATTR_DEFN                                                 *03790000
038000*----------------------------------------------------------------*03800000
038100     EXEC SQL                                                     03810000
038200          INCLUDE WST00009                                        03820000
038300     END-EXEC.                                                    03830000
038400                                                                  03840000
038500                                                                  03850000
038600*----------------------------------------------------------------*03860000
038700*  WST_ATTR_ELEM                                                 *03870000
038800*----------------------------------------------------------------*03880000
038900     EXEC SQL                                                     03890000
039000          INCLUDE WST00010                                        03900000
039100     END-EXEC.                                                    03910000
039200                                                                  03920000
039300                                                                  03930000
039400*----------------------------------------------------------------*03940000
039500*  TSUOBTS - OUTBOUND TRIP STATUS                                *03950000
039600*----------------------------------------------------------------*03960000
039700     EXEC SQL                                                     03970000
039800          INCLUDE TSUOBTS                                         03980000
039900     END-EXEC.                                                    03990000
040000                                                                  04000000
040100                                                                  04010000
040200*----------------------------------------------------------------*04020000
040300*  XLT_LOC                                                       *04030000
040400*----------------------------------------------------------------*04040000
040500     EXEC SQL                                                     04050000
040600          INCLUDE XLT00010                                        04060000
040700     END-EXEC.                                                    04070000
040800                                                                  04080000
040900                                                                  04090000
041000* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 04100000
041100* DRIVING CURSOR                                                * 04110000
041200* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 04120000
041300     EXEC SQL                                                     04130000
041400         DECLARE TRIP-STR-SCAN-CSR CURSOR FOR                     04140000
041500            SELECT B.SCN_TYP_CDE                                  04150000
041600                 , B.SCN_TYP_LNG_DES                              04160000
041700                 , COUNT(*)                                       04170000
041800              FROM SUT_OTBND_STR_SCN A                            04180000
041900                 , SUT_OTBND_SCN_TYP B                            04190000
042000            WHERE A.SCN_OTBND_TRIP_ID  = :DK-OTBND-TRIP-ID        04200000
042100              AND B.SCN_TYP_CDE        =  A.SCN_TYP_CDE           04210000
042200            GROUP BY B.SCN_TYP_CDE                                04220000
042300                   , B.SCN_TYP_LNG_DES                            04230000
042400            ORDER BY B.SCN_TYP_CDE                                04240000
042500                   , B.SCN_TYP_LNG_DES                            04250000
042600             WITH UR                                              04260000
042700     END-EXEC.                                                    04270000
042800                                                                  04280000
042900                                                                  04290000
043000*---------------------------------------------------------------* 04300000
043100*    DB2 AREA FOR COMMUNICATIONS                                * 04310000
043200*---------------------------------------------------------------* 04320000
043300     EXEC SQL                                                     04330000
043400          INCLUDE SQLCA                                           04340000
043500     END-EXEC.                                                    04350000
043600                                                                  04360000
043700/                                                                 04370000
043800 LINKAGE SECTION.                                                 04380000
043900                                                                  04390000
044000 01  DFHCOMMAREA.                                                 04400000
044100     05  FILLER                         OCCURS  1 TO 4072 TIMES   04410000
044200                                        DEPENDING ON EIBCALEN.    04420000
044300         10  FILLER                     PIC X.                    04430000
044400                                                                  04440000
044500 EJECT                                                            04450000
044600 PROCEDURE DIVISION.                                              04460000
044700******************************************************************04470000
044800**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **04480000
044900**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **04490000
045000**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **04500000
045100******************************************************************04510000
045200 0000-MAIN-MODULE.                                                04520000
045300     INITIALIZE DP030-CICS-API-FIELDS.                            04530000
045400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04540000
045500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04550000
045600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04560000
045700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04570000
045800     MOVE LENGTH OF SU548AI        TO DP030-MAP-LENGTH (1).       04580006
045900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04590000
046000     PERFORM 0001-CALL-CICS-ARCH-API.                             04600000
046100*                                                                 04610000
046200     PERFORM 1000-CONTROL-PROCESSING                              04620000
046300*                                                                 04630000
046400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04640000
046500     PERFORM 0001-CALL-CICS-ARCH-API.                             04650000
046600                                                                  04660000
046700******************************************************************04670000
046800**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **04680000
046900**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **04690000
047000******************************************************************04700000
047100 0001-CALL-CICS-ARCH-API.                                         04710000
047200*    CALL 'DPKCS030' USING DFHEIBLK                               04720018
047200     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04721018
047300                           DFHCOMMAREA                            04730000
047400                           DP030-CICS-API-FIELDS                  04740000
047500                           DP020-STANDARD-COMMAREA                04750000
047600                           SU548AI.                               04760006
047700*                                                                 04770000
047800     IF  DP030-RC-CALL-SUCCESSFUL                                 04780000
047900         CONTINUE                                                 04790000
048000     ELSE                                                         04800000
048100         SET DP013-NO-ROLLBACK                                    04810000
048200             DP013-XCTL-DISPLAY-RESTART                           04820000
048300             DP013-CICS-ABEND      TO TRUE                        04830000
048400         MOVE '0001-CALL-CICS-ARCH-API'                           04840000
048500                                   TO DP013-PARAGRAPH             04850000
048600*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX04860018
048700*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      04870018
048600         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04871018
048700-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04872018
048800         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04880000
048900         PERFORM DP013-0000-PROCESS-ABEND                         04890000
049000     END-IF.                                                      04900000
049100*----------------------------------------------------------------*04910000
049200* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04920000
049300* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04930000
049400*                                                                *04940000
049500* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04950000
049600*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04960000
049700*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04970000
049800*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04980000
049900*----------------------------------------------------------------*04990000
050000                                                                  05000000
050100 1000-CONTROL-PROCESSING.                                         05010000
050200                                                                  05020000
050300     EVALUATE TRUE                                                05030000
050400         WHEN DP020-NEXT-ACT-INITIAL                              05040000
050500             INITIALIZE ASC-SPECIFIC-COMMAREA                     05050000
050600             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05060000
050700                                      ASC-SEL-TERM-ID-OUT         05070000
050800             MOVE DP020-SRC-TASK-NUMBER                           05080000
050900                                   TO ASC-LIST-TASK-NUMBER        05090000
051000                                      ASC-SEL-TASK-NUMBER-OUT     05100000
051100             MOVE PC-LIST-QUEUE-SEQ                               05110000
051200                                   TO ASC-LIST-SEQ                05120000
051300             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ-OUT             05130000
051400             SET PS-COMMAREA-VALID TO TRUE                        05140000
051500                                                                  05150000
051600             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05160000
051700                                                                  05170000
051800             IF  PS-ERROR                                         05180000
051900                 CONTINUE                                         05190000
052000             ELSE                                                 05200000
052100                 PERFORM 4000-BUILD-INITIAL-PANEL                 05210000
052200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05220000
052300             END-IF                                               05230000
052400                                                                  05240000
052500***-----$TEMPLATE NOTE$-------------------------------------------05250000
052600*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,05260000
052700*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  05270000
052800*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.05280000
052900***---------------------------------------------------------------05290000
053000             IF  PS-COMMAREA-NOT-VALID                            05300000
053100***              MOVE PC-TSYMSG-99901                             05310000
053200***                                TO DP020-MSG-NUMBER            05320000
053300***              SET DP020-MSG-FATAL                              05330000
053400***                                TO TRUE                        05340000
053500                 SET DP020-NEXT-ACT-APPL-ERROR                    05350000
053600                                   TO TRUE                        05360000
053700             ELSE                                                 05370000
053800                 PERFORM 4000-BUILD-INITIAL-PANEL                 05380000
053900             END-IF                                               05390000
054000                                                                  05400000
054100         WHEN DP020-NEXT-ACT-READ-MAP                             05410000
054200             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05420000
054300                                   TO PV-TOP-ITEM                 05430000
054400             PERFORM 2000-PROCESS-PANEL                           05440000
054500                                                                  05450000
054600         WHEN DP020-NEXT-ACT-RETURN                               05460000
054700             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05470000
054800                                   TO PV-TOP-ITEM                 05480000
054900             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05490000
055000             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05500000
055100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05510000
055200                                                                  05520000
055300*            MOVE ASC-STR-NBR          TO SU011-CURR-OPER-UNT-ID  05530000
055400*            PERFORM 2050-DELETE-LIST-QUEUE                       05540000
055500*            PERFORM 4000-BUILD-INITIAL-PANEL                     05550000
055600                                                                  05560000
055700                                                                  05570000
055800         WHEN OTHER                                               05580000
055900             SET DP013-LOGIC-ABEND TO TRUE                        05590000
056000             SET DP013-NO-ROLLBACK TO TRUE                        05600000
056100             MOVE '1000-CONTROL-PROCESSING'                       05610000
056200                                   TO DP013-PARAGRAPH             05620000
056300             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05630000
056400                                   TO DP013-MESSAGE-TEXT(1)       05640000
056500             PERFORM DP013-0000-PROCESS-ABEND                     05650000
056600     END-EVALUATE.                                                05660000
056700                                                                  05670000
056800 EJECT                                                            05680000
056900*----------------------------------------------------------------*05690000
057000* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05700000
057100* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05710000
057200*----------------------------------------------------------------*05720000
057300                                                                  05730000
057400 1100-PROCESS-INTER-APPL-COMM.                                    05740000
057500                                                                  05750000
057600     SET PS-COMMAREA-VALID         TO TRUE.                       05760000
057700     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05770000
057800     MOVE DP020-INT-APPL-FORMAT-IND TO ASC-INT-APPL-FORMAT-IND    05780000
057900     EVALUATE DP020-INT-APPL-FORMAT-IND                           05790000
058000                                                                  05800000
058100         WHEN PC-INTER-APPL-LIST                                  05810000
058200             SET ASC-USE-SELECTION-QUEUE TO TRUE                  05820000
058300             MOVE SU009-NUMBER-OF-SELECTED-ITEMS                  05830000
058400                                   TO ASC-NUMBER-OF-SELECTED-ITEMS05840000
058500             MOVE SU009-NUMBER-OF-TS-ITEMS                        05850000
058600                                    TO ASC-NUMBER-OF-TS-ITEMS     05860000
058700             MOVE SU009-SEL-QUEUE-NAME                            05870000
058800                                    TO ASC-SEL-QUEUE-NAME-IN      05880000
058900                                                                  05890000
059000             MOVE SU009-TRIP-ID      TO ASC-KEY-TRIP-ID           05900000
059100             MOVE SU009-SCAC-CDE     TO ASC-KEY-SCAC              05910000
059200             MOVE SU009-TRLR-ID      TO ASC-KEY-TRLR              05920000
059300             MOVE SU009-TRLR-SRL-NBR TO ASC-KEY-SRL               05930000
059400             MOVE SU009-DEST-STR-NBR TO ASC-STR-NBR               05940000
059410             MOVE SU009-TRLR-STATUS  TO ASC-TRLR-STATUS           05941014
059500                                                                  05950000
059600             PERFORM 1120-PREPARE-LIST-ENTRY                      05960000
059700                                                                  05970000
059800         WHEN OTHER                                               05980000
059900             MOVE PC-TSYMSG-00148                                 05990000
060000                                     TO DP020-MSG-NUMBER          06000000
060100             SET DP020-MSG-FATAL                                  06010000
060200                 DP020-NEXT-ACT-APPL-ERROR                        06020000
060300                                     TO TRUE                      06030000
060400     END-EVALUATE.                                                06040000
060500                                                                  06050000
060600                                                                  06060000
060700 1120-PREPARE-LIST-ENTRY.                                         06070000
060800     MOVE SU010-MAX-ITEMS          TO ASC-SEL-SUB.                06080000
060900     MOVE ZERO                     TO ASC-SEL-ITEM.               06090000
061000     PERFORM 2110-GET-NEXT-MESSAGE.                               06100000
061100/                                                                 06110000
061200 2110-GET-NEXT-MESSAGE.                                           06120000
061300     ADD +1                        TO ASC-SEL-SUB.                06130000
061400     IF  ASC-SEL-SUB > SU010-MAX-ITEMS                            06140000
061500         ADD +1                    TO ASC-SEL-ITEM                06150000
061600         MOVE +1                   TO ASC-SEL-SUB                 06160000
061700     END-IF.                                                      06170000
061800     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                06180000
061900         PERFORM 9100-READ-SEL-QUEUE                              06190000
062000         IF  SU010-ITEM (ASC-SEL-SUB) > ZERO                      06200000
062100             MOVE SU010-TRLR-SRL-NBR (ASC-SEL-SUB)                06210000
062200                                     TO ASC-KEY-SRL               06220000
062300             MOVE SU010-TRIP-ID (ASC-SEL-SUB)                     06230000
062400                                     TO ASC-KEY-TRIP-ID           06240000
062500             MOVE SU010-DEST-NBR (ASC-SEL-SUB)                    06250000
062600                                     TO ASC-STR-NBR               06260000
062700             MOVE SU010-SCAC (ASC-SEL-SUB)                        06270000
062800                                     TO ASC-KEY-SCAC              06280000
062900             MOVE SU010-TRLR-ID (ASC-SEL-SUB)                     06290000
063000                                     TO ASC-KEY-TRLR              06300000
063100             MOVE SU010-TRIP-STATUS (ASC-SEL-SUB)                 06310016
063110                                     TO ASC-TRLR-STATUS           06311016
063200             SET SU010-INQ (ASC-SEL-SUB)                          06320000
063300                                   TO TRUE                        06330000
063400             PERFORM 9200-REWRITE-LIST-QUEUE                      06340000
063500         ELSE                                                     06350000
063600             SUBTRACT +1 FROM ASC-SEL-SUB                         06360000
063700*            --- BOTTOM OF LIST ---                               06370000
063800             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            06380000
063900             SET DP020-MSG-INFORMATIONAL                          06390000
064000                                   TO TRUE                        06400000
064100         END-IF                                                   06410000
064200     ELSE                                                         06420000
064300         SUBTRACT +1 FROM ASC-SEL-ITEM                            06430000
064400         MOVE SU010-MAX-ITEMS      TO ASC-SEL-SUB                 06440000
064500         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06450000
064600         SET DP020-MSG-INFORMATIONAL                              06460000
064700                                   TO TRUE                        06470000
064800     END-IF.                                                      06480000
064900                                                                  06490000
065000 2120-GET-PREV-MESSAGE.                                           06500000
065100     SUBTRACT +1                   FROM ASC-SEL-SUB.              06510000
065200     IF  ASC-SEL-SUB < 1                                          06520000
065300         SUBTRACT 1                FROM ASC-SEL-ITEM              06530000
065400         MOVE SU010-MAX-ITEMS      TO ASC-SEL-SUB                 06540000
065500     END-IF.                                                      06550000
065600     IF  ASC-SEL-ITEM  > ZERO                                     06560000
065700         PERFORM 9100-READ-SEL-QUEUE                              06570000
065800         IF  SU010-ITEM (ASC-SEL-SUB) > ZERO                      06580000
065900             MOVE SU010-TRLR-SRL-NBR (ASC-SEL-SUB)                06590000
066000                                     TO ASC-KEY-SRL               06600000
066100             MOVE SU010-TRIP-ID (ASC-SEL-SUB)                     06610000
066200                                     TO ASC-KEY-TRIP-ID           06620000
066300             MOVE SU010-DEST-NBR (ASC-SEL-SUB)                    06630000
066400                                     TO ASC-STR-NBR               06640000
066500             MOVE SU010-SCAC (ASC-SEL-SUB)                        06650000
066600                                     TO ASC-KEY-SCAC              06660000
066700             MOVE SU010-TRLR-ID (ASC-SEL-SUB)                     06670000
066800                                     TO ASC-KEY-TRLR              06680000
066810             MOVE SU010-TRIP-STATUS (ASC-SEL-SUB)                 06681016
066820                                     TO ASC-TRLR-STATUS           06682016
066900                                                                  06690000
067000             SET SU010-INQ (ASC-SEL-SUB)                          06700000
067100                                   TO TRUE                        06710000
067200             PERFORM 9200-REWRITE-LIST-QUEUE                      06720000
067300         ELSE                                                     06730000
067400             MOVE +1               TO ASC-SEL-ITEM                06740000
067500                                      ASC-SEL-SUB                 06750000
067600*            --- TOP OF LIST ---                                  06760000
067700             MOVE PC-TSYMSG-00069  TO DP020-MSG-NUMBER            06770000
067800             SET DP020-MSG-INFORMATIONAL                          06780000
067900                                   TO TRUE                        06790000
068000         END-IF                                                   06800000
068100     END-IF.                                                      06810000
068200*----------------------------------------------------------------*06820000
068300* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *06830000
068400* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06840000
068500* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06850000
068600* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06860000
068700* FUNCTION KEYS CAN GET THIS FAR.                                *06870000
068800*----------------------------------------------------------------*06880000
068900                                                                  06890000
069000 2000-PROCESS-PANEL.                                              06900000
069100     EVALUATE TRUE                                                06910000
069200         WHEN DP020-SRC-AID = DP016-CLEAR                         06920000
069300             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06930000
069400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06940000
069500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06950000
069600                                                                  06960000
069700         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06970000
069800             PERFORM 2050-DELETE-LIST-QUEUE                       06980000
069900             PERFORM 4000-BUILD-INITIAL-PANEL                     06990000
070000                                                                  07000000
070100         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    07010000
070200             PERFORM 2140-DESELECT-ALL-ITEMS                      07020000
070300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07030000
070400                                                                  07040000
070500         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  07050000
070600             PERFORM 2150-SELECT-ALL-ITEMS                        07060000
070700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07070000
070800                                                                  07080000
070900         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             07090000
071000                                                                  07100000
071100             IF ASC-USE-SELECTION-QUEUE                           07110000
071200                 PERFORM 2110-GET-NEXT-MESSAGE                    07120000
071300                 IF PS-LIST-END                                   07130000
071400                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07140000
071500                     SET PS-NO-LIST-END TO TRUE                   07150000
071600                 ELSE                                             07160000
071700                     PERFORM 2050-DELETE-LIST-QUEUE               07170000
071800                     PERFORM 3200-RESET-ATTRIBUTES                07180000
071900                     PERFORM 4000-BUILD-INITIAL-PANEL             07190000
072000                 END-IF                                           07200000
072100               ELSE                                               07210000
072200*            --- BOTTOM OF LIST ---                               07220000
072300                 MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER         07230000
072400                 SET DP020-MSG-INFORMATIONAL TO TRUE              07240000
072500                 SET PS-LIST-END      TO TRUE                     07250000
072600             END-IF                                               07260000
072700                                                                  07270000
072800         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             07280000
072900                                                                  07290000
073000             EVALUATE TRUE                                        07300000
073100                 WHEN PS-LIST-END                                 07310000
073200*                    --- TOP OF LIST ---                          07320000
073300                     MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER07330000
073400                     SET DP020-MSG-INFORMATIONAL                  07340000
073500                         DP030-SET-CURSOR-APPL-1                  07350000
073600                                   TO TRUE                        07360000
073700                     MOVE -1       TO MR-SELECTL (1)              07370000
073800                 WHEN ASC-SEL-ITEM = ZERO                         07380000
073900                     MOVE PC-TSYMSG-00069  TO DP020-MSG-NUMBER    07390000
074000                     SET DP020-MSG-INFORMATIONAL                  07400000
074100                         DP030-SET-CURSOR-APPL-1                  07410000
074200                                   TO TRUE                        07420000
074300                     MOVE -1       TO MR-SELECTL (1)              07430000
074400                 WHEN ASC-SEL-ITEM >  ZERO                        07440000
074500                     PERFORM 2120-GET-PREV-MESSAGE                07450000
074600                     IF ASC-SEL-ITEM >  ZERO                      07460000
074700                         PERFORM 2050-DELETE-LIST-QUEUE           07470000
074800                         PERFORM 3200-RESET-ATTRIBUTES            07480000
074900                         PERFORM 4000-BUILD-INITIAL-PANEL         07490000
075000                     ELSE                                         07500000
075100                         MOVE PC-TSYMSG-00069                     07510000
075200                                           TO DP020-MSG-NUMBER    07520000
075300                         SET DP020-MSG-INFORMATIONAL              07530000
075400                             DP030-SET-CURSOR-APPL-1              07540000
075500                                           TO TRUE                07550000
075600                         MOVE -1   TO MR-SELECTL (1)              07560000
075700                     END-IF                                       07570000
075800             END-EVALUATE                                         07580000
075900                                                                  07590000
076000         WHEN OTHER                                               07600000
076100             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07610000
076200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07620000
076300             IF  PS-NO-ERROR                                      07630000
076400                 SET DP030-CONTINUE-GO                            07640000
076500                                 TO TRUE                          07650000
076600                 PERFORM 2100-CHECK-FUNCTION-KEY                  07660000
076700             ELSE                                                 07670000
076800                 SET DP030-OVERRIDE-GO                            07680000
076900                                 TO TRUE                          07690000
077000             END-IF                                               07700000
077100     END-EVALUATE.                                                07710000
077200 EJECT                                                            07720000
077300*----------------------------------------------------------------*07730000
077400*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *07740000
077500*----------------------------------------------------------------*07750000
077600 2050-DELETE-LIST-QUEUE.                                          07760000
077700                                                                  07770000
077800     EXEC CICS                                                    07780000
077900         DELETEQ TS                                               07790000
078000             QUEUE (ASC-LIST-QUEUE-NAME)                          07800000
078100             RESP  (PV-CICS-RESP)                                 07810000
078200     END-EXEC.                                                    07820000
078300                                                                  07830000
078400     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       07840000
078500        (PV-CICS-RESP = DFHRESP(QIDERR))                          07850000
078600         CONTINUE                                                 07860000
078700     ELSE                                                         07870000
078800         SET DP013-CICS-ABEND      TO TRUE                        07880000
078900         SET DP013-NO-ROLLBACK     TO TRUE                        07890000
079000                                                                  07900000
079100         MOVE '2050-DELETE-LIST-QUEUE'                            07910000
079200                                   TO DP013-PARAGRAPH             07920000
079300         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    07930000
079400                                   TO DP013-MESSAGE-TEXT (1)      07940000
079500         PERFORM DP013-0000-PROCESS-ABEND                         07950000
079600     END-IF.                                                      07960000
079700                                                                  07970000
079800     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  07980000
079900/                                                                 07990000
080000*----------------------------------------------------------------*08000000
080100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*08010000
080200* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *08020000
080300* CICS ARCHITECTURE API.                                         *08030000
080400*                                                                *08040000
080500* WHEN SCREEN WAS ORIGINALLY WRITTEN IT DID NOT NAVIGATE ANYWHERE*08050000
080600* LOCAL FUNC 01 & 02 ARE NOT USED BUT ARE IN THE PROGRAM FOR ANY *08060000
080700* POTENTIAL CHANGES TO NAVIGATE TO ANOTHER SCREEN                *08070000
080800*----------------------------------------------------------------*08080000
080900 2100-CHECK-FUNCTION-KEY.                                         08090000
081000     EVALUATE TRUE                                                08100000
081100*        WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              08110000
081200*            PERFORM 2050-DELETE-LIST-QUEUE                       08120000
081300*            PERFORM 4000-BUILD-INITIAL-PANEL                     08130000
081400                                                                  08140000
081500*        WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              08150000
081600*            IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              08160000
081700*                INITIALIZE SU009-INTER-APPL-COMMAREA             08170000
081800*                MOVE ASC-NUMBER-OF-SELECTED-ITEMS                08180000
081900*                               TO SU009-NUMBER-OF-SELECTED-ITEMS 08190000
082000*                MOVE ASC-STR-NBR      TO SU009-STR-NBR           08200000
082100*                MOVE ASC-STR-NAME     TO SU009-STR-NAME          08210000
082200*                PERFORM 5000-PREPARE-SEL-QUEUE                   08220000
082300*            ELSE                                                 08230000
082400*                SET DP030-OVERRIDE-GO                            08240000
082500*                                  TO TRUE                        08250000
082600*                MOVE PC-TSYMSG-00057                             08260000
082700*                                  TO DP020-MSG-NUMBER            08270000
082800*                SET DP020-MSG-WARNING                            08280000
082900*                                  TO TRUE                        08290000
083000*                MOVE -1           TO MR-SELECTL(1)               08300000
083100*                SET DP030-SET-CURSOR-APPL-1                      08310000
083200*                                  TO TRUE                        08320000
083300*                PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08330000
083400*            END-IF                                               08340000
083500                                                                  08350000
083600         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  08360000
083700             MOVE +1               TO PV-TOP-ITEM                 08370000
083800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08380000
083900                                                                  08390000
084000         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   08400000
084100             PERFORM 2110-BROWSE-BACKWARD                         08410000
084200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08420000
084300                                                                  08430000
084400         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   08440000
084500             PERFORM 2120-BROWSE-FORWARD                          08450000
084600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08460000
084700                                                                  08470000
084800         WHEN DP020-SRC-AID = DP016-ENTER                         08480000
084900             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   08490000
085000             IF  PS-ERROR                                         08500000
085100                 CONTINUE                                         08510000
085200             ELSE                                                 08520000
085300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08530000
085400             END-IF                                               08540000
085500                                                                  08550000
085600         WHEN OTHER                                               08560000
085700             SET DP013-NO-ROLLBACK                                08570000
085800                 DP013-XCTL-DISPLAY-RESTART                       08580000
085900                 DP013-CICS-ABEND  TO TRUE                        08590000
086000             MOVE '2100-CHECK-FUNCTION-KEY'                       08600000
086100                                   TO DP013-PARAGRAPH             08610000
086200             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08620000
086300                                   TO DP013-MESSAGE-TEXT (1)      08630000
086400             PERFORM DP013-0000-PROCESS-ABEND                     08640000
086500     END-EVALUATE.                                                08650000
086600*                                                                 08660000
086700*----------------------------------------------------------------*08670000
086800*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *08680000
086900*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *08690000
087000*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *08700000
087100*    MESSAGE.                                                    *08710000
087200*----------------------------------------------------------------*08720000
087300                                                                  08730000
087400 2110-BROWSE-BACKWARD.                                            08740000
087500     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    08750000
087600         GIVING PV-TOP-ITEM.                                      08760000
087700*                                                                 08770000
087800     IF  ((PV-TOP-ITEM < +1)                                      08780000
087900       OR (PV-TOP-ITEM = +1))                                     08790000
088000         MOVE +1                   TO PV-TOP-ITEM                 08800000
088100*        -- TOP OF LIST --                                        08810000
088200         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            08820000
088300         SET DP020-MSG-INFORMATIONAL TO TRUE                      08830000
088400     END-IF.                                                      08840000
088500                                                                  08850000
088600 EJECT                                                            08860000
088700*----------------------------------------------------------------*08870000
088800*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *08880000
088900*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *08890000
089000*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *08900000
089100*----------------------------------------------------------------*08910000
089200                                                                  08920000
089300 2120-BROWSE-FORWARD.                                             08930000
089400                                                                  08940000
089500     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              08950000
089600         GIVING PV-TOP-ITEM.                                      08960000
089700     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   08970000
089800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08980000
089900                                   TO PV-TOP-ITEM                 08990000
090000*        -- BOTTOM OF LIST --                                     09000000
090100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            09010000
090200         SET DP020-MSG-INFORMATIONAL                              09020000
090300                                   TO TRUE                        09030000
090400     ELSE                                                         09040000
090500         COMPUTE PV-BOTTOM-ITEM =                                 09050000
090600             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 09060000
090700         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            09070000
090800*            -- BOTTOM OF LIST --                                 09080000
090900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            09090000
091000             SET DP020-MSG-INFORMATIONAL                          09100000
091100                                   TO TRUE                        09110000
091200         END-IF                                                   09120000
091300     END-IF.                                                      09130000
091400 EJECT                                                            09140000
091500*----------------------------------------------------------------*09150000
091600*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *09160000
091700*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *09170000
091800*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *09180000
091900*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *09190000
092000*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *09200000
092100*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *09210000
092200*----------------------------------------------------------------*09220000
092300                                                                  09230000
092400 2130-CHECK-FOR-JUMP-BROWSE.                                      09240000
092500     SET PS-NO-ERROR               TO TRUE.                       09250000
092600     IF (ASC-START-ITEM-REQUEST = SPACE)                          09260000
092700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09270000
092800                                   TO PV-TOP-ITEM                 09280000
092900     ELSE                                                         09290000
093000         MOVE ASC-START-ITEM-REQUEST                              09300000
093100                                   TO DP010I-UNEDITED-FIELD       09310000
093200         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       09320000
093300         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     09330000
093400         SET DP010I-NEGATIVE-NOT-ALLOWED                          09340000
093500                                   TO TRUE                        09350000
263968         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09361017
263968              USING DP010I-NUMERIC-EDIT-AREA                      09362017
093700                                                                  09370000
093800         IF  NOT DP010I-ERROR-DETECTED                            09380000
093900             MOVE DP010I-NUMERIC-FIELD                            09390000
094000                                   TO  ASC-START-ITEM-REQUEST-N   09400000
094100             IF  ASC-START-ITEM-REQUEST-N > ZERO                  09410000
094200                 IF  ASC-START-ITEM-REQUEST-N >                   09420000
094300                                          ASC-NUMBER-OF-ITEMS-READ09430000
094400                     MOVE SPACE TO ASC-START-ITEM-REQUEST         09440000
094500                     COMPUTE PV-TOP-ITEM =                        09450000
094600                             ASC-NUMBER-OF-ITEMS-READ             09460000
094700                             - PC-ITEMS-PER-PANEL + 1             09470000
094800                     IF  PV-TOP-ITEM < +1                         09480000
094900                         MOVE +1   TO PV-TOP-ITEM                 09490000
095000                         MOVE PC-TSYMSG-00070                     09500000
095100                                   TO DP020-MSG-NUMBER            09510000
095200                         SET DP020-MSG-INFORMATIONAL              09520000
095300                                   TO TRUE                        09530000
095400                     END-IF                                       09540000
095500                 ELSE                                             09550000
095600                     MOVE ASC-START-ITEM-REQUEST-N                09560000
095700                                   TO PV-TOP-ITEM                 09570000
095800                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      09580000
095900                     COMPUTE PV-BOTTOM-ITEM =                     09590000
096000                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     09600000
096100                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ09610000
096200*                        -- BOTTOM OF LIST --                     09620000
096300                         MOVE PC-TSYMSG-00070                     09630000
096400                                   TO DP020-MSG-NUMBER            09640000
096500                         SET DP020-MSG-INFORMATIONAL              09650000
096600                                   TO TRUE                        09660000
096700                     END-IF                                       09670000
096800                 END-IF                                           09680000
096900             ELSE                                                 09690000
097000*                --- VALUE OUT OF RANGE ----                      09700000
097100                 MOVE PC-TSYMSG-00101                             09710000
097200                                   TO DP020-MSG-NUMBER            09720000
097300                 MOVE -1           TO ASTRTITL                    09730000
097400                 SET DP030-SET-CURSOR-APPL-1                      09740000
097500                                   TO TRUE                        09750000
097600                 MOVE DP015-REVERSE                               09760000
097700                                   TO ASTRTITH                    09770000
097800                 MOVE DP015-RED    TO ASTRTITC                    09780000
097900                 MOVE DP015-UNP-NUM-BRT-MDT                       09790000
098000                                   TO ASTRTITA                    09800000
098100                 SET DP020-MSG-FATAL                              09810000
098200                                   TO TRUE                        09820000
098300                 SET PS-ERROR      TO TRUE                        09830000
098400             END-IF                                               09840000
098500                                                                  09850000
098600         ELSE                                                     09860000
098700             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09870000
098800             MOVE -1               TO ASTRTITL                    09880000
098900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09890000
099000             MOVE DP015-REVERSE    TO ASTRTITH                    09900000
099100             MOVE DP015-RED        TO ASTRTITC                    09910000
099200             MOVE DP015-UNP-NUM-BRT-MDT                           09920000
099300                                   TO ASTRTITA                    09930000
099400             SET DP020-MSG-FATAL   TO TRUE                        09940000
099500             SET PS-ERROR          TO TRUE                        09950000
099600         END-IF                                                   09960000
099700     END-IF.                                                      09970000
099800 EJECT                                                            09980000
099900*----------------------------------------------------------------*09990000
100000*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *10000000
100100*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *10010000
100200*----------------------------------------------------------------*10020000
100300 2140-DESELECT-ALL-ITEMS.                                         10030000
100400     MOVE +1                       TO ASC-BLK-SUB.                10040000
100500                                                                  10050000
100600     PERFORM 2141-CLEAR-SELECTED-INDS                             10060000
100700         VARYING ASC-ITEM-SUB                                     10070000
100800         FROM 1 BY 1                                              10080000
100900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10090000
101000                                                                  10100000
101100     ADD +1                        TO ASC-BLK-SUB.                10110000
101200                                                                  10120000
101300     PERFORM 2141-CLEAR-SELECTED-INDS                             10130000
101400         VARYING ASC-ITEM-SUB                                     10140000
101500         FROM 1 BY 1                                              10150000
101600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10160000
101700                                                                  10170000
101800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10180000
101900                                   TO PV-LIST-ITEM-NUMBER.        10190000
102000                                                                  10200000
102100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10210000
102200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10220000
102300                                                                  10230000
102400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10240000
102500        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      10250000
102600         MOVE +1                   TO ASC-BLK-SUB                 10260000
102700                                                                  10270000
102800         PERFORM 5100-WRITE-TEMP-STORAGE                          10280000
102900                                                                  10290000
103000         MOVE +1                   TO PV-BLOCK-NUMBER             10300000
103100                                                                  10310000
103200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10320000
103300             PV-FIRST-BLOCK-IN-ARRAY - 1                          10330000
103400                                                                  10340000
103500         PERFORM                                                  10350000
103600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10360000
103700                                                                  10370000
103800             PERFORM 4410-READ-TEMP-STORAGE                       10380000
103900                                                                  10390000
104000             PERFORM 2141-CLEAR-SELECTED-INDS                     10400000
104100                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 10410000
104200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10420000
104300                                                                  10430000
104400             PERFORM 5100-WRITE-TEMP-STORAGE                      10440000
104500                                                                  10450000
104600             ADD +1                TO PV-BLOCK-NUMBER             10460000
104700                                                                  10470000
104800         END-PERFORM                                              10480000
104900                                                                  10490000
105000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10500000
105100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10510000
105200                                                                  10520000
105300         PERFORM                                                  10530000
105400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10540000
105500                   ASC-HIGHEST-BLOCK-WRITTEN                      10550000
105600                                                                  10560000
105700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10570000
105800                                   TO PV-BLOCK-NUMBER             10580000
105900                                                                  10590000
106000             PERFORM 4410-READ-TEMP-STORAGE                       10600000
106100                                                                  10610000
106200             PERFORM 2141-CLEAR-SELECTED-INDS                     10620000
106300                 VARYING ASC-ITEM-SUB                             10630000
106400                 FROM 1 BY 1                                      10640000
106500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10650000
106600                                                                  10660000
106700             PERFORM 5100-WRITE-TEMP-STORAGE                      10670000
106800                                                                  10680000
106900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10690000
107000                                                                  10700000
107100         END-PERFORM                                              10710000
107200                                                                  10720000
107300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10730000
107400                                   TO PV-BLOCK-NUMBER             10740000
107500                                                                  10750000
107600         PERFORM 4410-READ-TEMP-STORAGE                           10760000
107700     END-IF.                                                      10770000
107800                                                                  10780000
107900                                                                  10790000
108000     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 10800000
108100     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.10810000
108200     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  10820000
108300                                                                  10830000
108400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10840000
108500                                                                  10850000
108600 EJECT                                                            10860000
108700*----------------------------------------------------------------*10870000
108800*    MARK EACH ITEM AS BEING NOT SELECTED.                       *10880000
108900*----------------------------------------------------------------*10890000
109000                                                                  10900000
109100 2141-CLEAR-SELECTED-INDS.                                        10910000
109200                                                                  10920000
109300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10930000
109400             NOT EQUAL ZERO                                       10940000
109500         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10950000
109600             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10960000
109700                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    10970000
109800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10980000
109900                                   TO TRUE                        10990000
110000         END-IF                                                   11000000
110100     END-IF.                                                      11010000
110200                                                                  11020000
110300/                                                                 11030000
110400*----------------------------------------------------------------*11040000
110500*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *11050000
110600*  FOR ALL ITEMS.                                                *11060000
110700*----------------------------------------------------------------*11070000
110800                                                                  11080000
110900 2150-SELECT-ALL-ITEMS.                                           11090000
111000                                                                  11100000
111100     MOVE +1                       TO ASC-BLK-SUB.                11110000
111200                                                                  11120000
111300     PERFORM 2151-SET-SELECTED-INDS                               11130000
111400         VARYING ASC-ITEM-SUB                                     11140000
111500         FROM 1 BY 1                                              11150000
111600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11160000
111700                                                                  11170000
111800     ADD +1                        TO ASC-BLK-SUB.                11180000
111900                                                                  11190000
112000     PERFORM 2151-SET-SELECTED-INDS                               11200000
112100         VARYING ASC-ITEM-SUB                                     11210000
112200         FROM 1 BY 1                                              11220000
112300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11230000
112400                                                                  11240000
112500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11250000
112600                                   TO PV-LIST-ITEM-NUMBER.        11260000
112700                                                                  11270000
112800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11280000
112900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11290000
113000                                                                  11300000
113100     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11310000
113200        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    11320000
113300         MOVE +1                   TO ASC-BLK-SUB                 11330000
113400                                                                  11340000
113500         PERFORM 5100-WRITE-TEMP-STORAGE                          11350000
113600                                                                  11360000
113700         MOVE +1                   TO PV-BLOCK-NUMBER             11370000
113800                                                                  11380000
113900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11390000
114000             PV-FIRST-BLOCK-IN-ARRAY - 1                          11400000
114100                                                                  11410000
114200         PERFORM                                                  11420000
114300             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11430000
114400                                                                  11440000
114500             PERFORM 4410-READ-TEMP-STORAGE                       11450000
114600                                                                  11460000
114700             PERFORM 2151-SET-SELECTED-INDS                       11470000
114800                 VARYING ASC-ITEM-SUB                             11480000
114900                 FROM 1 BY 1                                      11490000
115000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11500000
115100                                                                  11510000
115200             PERFORM 5100-WRITE-TEMP-STORAGE                      11520000
115300                                                                  11530000
115400             ADD +1                TO PV-BLOCK-NUMBER             11540000
115500                                                                  11550000
115600         END-PERFORM                                              11560000
115700                                                                  11570000
115800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11580000
115900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11590000
116000                                                                  11600000
116100         PERFORM                                                  11610000
116200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11620000
116300                   ASC-HIGHEST-BLOCK-WRITTEN                      11630000
116400                                                                  11640000
116500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11650000
116600                                   TO PV-BLOCK-NUMBER             11660000
116700                                                                  11670000
116800             PERFORM 4410-READ-TEMP-STORAGE                       11680000
116900                                                                  11690000
117000             PERFORM 2151-SET-SELECTED-INDS                       11700000
117100                 VARYING ASC-ITEM-SUB                             11710000
117200                 FROM 1 BY 1                                      11720000
117300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11730000
117400                                                                  11740000
117500             PERFORM 5100-WRITE-TEMP-STORAGE                      11750000
117600                                                                  11760000
117700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11770000
117800                                                                  11780000
117900         END-PERFORM                                              11790000
118000                                                                  11800000
118100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11810000
118200                                   TO PV-BLOCK-NUMBER             11820000
118300                                                                  11830000
118400         PERFORM 4410-READ-TEMP-STORAGE                           11840000
118500     END-IF.                                                      11850000
118600                                                                  11860000
118700                                                                  11870000
118800     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             11880000
118900                       ASC-NUMBER-OF-SELECTED-ITEMS.              11890000
119000                                                                  11900000
119100     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11910000
119200                                                                  11920000
119300 EJECT                                                            11930000
119400*----------------------------------------------------------------*11940000
119500*    MARK EACH ITEM AS BEING SELECTED.                           *11950000
119600*----------------------------------------------------------------*11960000
119700                                                                  11970000
119800 2151-SET-SELECTED-INDS.                                          11980000
119900                                                                  11990000
120000     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           12000000
120100             NOT EQUAL ZERO                                       12010000
120200         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12020000
120300             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12030000
120400                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        12040000
120500                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12050000
120600                               TO  TRUE                           12060000
120700         END-IF                                                   12070000
120800     END-IF.                                                      12080000
120900******************************************************************12090000
121000** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **12100000
121100** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **12110000
121200******************************************************************12120000
121300 2200-MOVE-SCREEN-TO-COMMAREA.                                    12130000
121400                                                                  12140000
121500     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             12150000
121600     MOVE +1                       TO PV-SUB.                     12160000
121700*                                                                 12170000
121800     PERFORM 3100-SET-SUBSCRIPTS.                                 12180000
121900     IF  ASTRTITL > ZERO                                          12190000
122000         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          12200000
122100     ELSE                                                         12210000
122200         IF  ASTRTITF = DP015-ERASE-EOF                           12220000
122300             INITIALIZE ASC-START-ITEM-REQUEST                    12230000
122400         END-IF                                                   12240000
122500     END-IF.                                                      12250000
122600     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          12260000
122700         VARYING PV-SUB                                           12270000
122800         FROM 1 BY 1                                              12280000
122900         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      12290000
123000******************************************************************12300000
123100** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**12310000
123200******************************************************************12320000
123300 2210-MOVE-LINES-TO-COMMAREA.                                     12330000
123400     IF  MR-SELECTL (PV-SUB) > ZERO                               12340000
123500         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             12350000
123600         MOVE MR-SELECTI (PV-SUB)                                 12360000
123700                                   TO ASC-TEMP-SELECTED-SW        12370000
123800                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12380000
123900     ELSE                                                         12390000
124000         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                12400000
124100                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     12410000
124200                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        12420000
124300                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12430000
124400         END-IF                                                   12440000
124500     END-IF.                                                      12450000
124600     ADD +1                        TO ASC-ITEM-SUB.               12460000
124700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12470000
124800         ADD +1                    TO ASC-BLK-SUB                 12480000
124900         MOVE +1                   TO ASC-ITEM-SUB                12490000
125000     END-IF.                                                      12500000
125100                                                                  12510000
125200                                                                  12520000
125300******************************************************************12530000
125400** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **12540000
125500** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **12550000
125600******************************************************************12560000
125700 3000-EDIT-DATA-IN-COMMAREA.                                      12570000
125710                                                                  12571001
125720                                                                  12572001
125800     SET PS-NO-ERROR               TO TRUE.                       12580000
125900     PERFORM 3200-RESET-ATTRIBUTES.                               12590000
126000     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     12600000
126100**                                                                12610000
126200* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              12620000
126300* EDITTING IS DONE FROM THE BOTTOM UP.                            12630000
126400**                                                                12640000
126500     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       12650000
126600         ASC-ITEMS-DISPLAYED - 1.                                 12660000
126700     PERFORM 3100-SET-SUBSCRIPTS.                                 12670000
126800     PERFORM 3300-EDIT-SELECTIONS                                 12680000
126900         VARYING PV-SUB                                           12690000
127000         FROM PV-SUB BY -1                                        12700000
127100         UNTIL PV-SUB < +1                                        12710000
127200*                                                                 12720000
127300     IF  PS-NO-ERROR                                              12730000
127400         PERFORM 3400-CHECK-RANGE-SEQUENCE                        12740000
127500     END-IF.                                                      12750000
127600*                                                                 12760000
127700     IF  ((PS-NO-ERROR)                                           12770000
127800       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   12780000
127900       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    12790000
128000             PERFORM 3500-MARK-RANGE-AS-SELECTED                  12800000
128100     END-IF.                                                      12810000
128200                                                                  12820000
128300                                                                  12830000
128400*----------------------------------------------------------------*12840000
128500*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *12850000
128600*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*12860000
128700*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *12870000
128800*                                                                *12880000
128900*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *12890000
129000*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *12900000
129100*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *12910000
129200*    US IN THE 2ND BLOCK OF THE ARRAY.                           *12920000
129300*----------------------------------------------------------------*12930000
129400                                                                  12940000
129500 3100-SET-SUBSCRIPTS.                                             12950000
129600                                                                  12960000
129700     COMPUTE ASC-ITEM-SUB =                                       12970000
129800         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        12980000
129900                                                                  12990000
130000     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         13000000
130100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            13010000
130200                                                                  13020000
130300         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               13030000
130400     ELSE                                                         13040000
130500         MOVE +1                     TO ASC-BLK-SUB               13050000
130600     END-IF.                                                      13060000
130700******************************************************************13070000
130800** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **13080000
130900******************************************************************13090000
131000                                                                  13100000
131100 3200-RESET-ATTRIBUTES.                                           13110000
131200     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   13120000
131300     MOVE DP015-GREEN              TO ASTRTITC.                   13130000
131400     MOVE DP015-UNDERLINE          TO ASTRTITH.                   13140000
131500*                                                                 13150000
131600     PERFORM                                                      13160000
131700         VARYING PV-SUB                                           13170000
131800         FROM 1 BY 1                                              13180000
131900         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        13190000
132000         MOVE DP015-UNP-ALP-NOR-OFF                               13200000
132100                                   TO MR-SELECTA (PV-SUB)         13210000
132200         MOVE DP015-ASK-NOR-OFF    TO MR-SCAN-DESCR-A (PV-SUB)    13220000
132300                                      MR-SCAN-CNT-A (PV-SUB)      13230000
132400         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         13240000
132500         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         13250000
132600     END-PERFORM.                                                 13260000
132700                                                                  13270000
132800******************************************************************13280000
132900** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **13290000
133000** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **13300000
133100** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **13310000
133200** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **13320000
133300******************************************************************13330000
133400 3300-EDIT-SELECTIONS.                                            13340000
133500     EVALUATE TRUE                                                13350000
133600         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13360000
133700             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         13370000
133800                 CONTINUE                                         13380000
133900         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         13390000
134000             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        13400000
134100                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   13410000
134200                 MOVE ASC-TEMP-SELECTED-SW                        13420000
134300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13430000
134400                                TO ASC-SELECTED-SW                13440000
134500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13450000
134600             END-IF                                               13460000
134700         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13470000
134800                 = SPACE                                          13480000
134900             EVALUATE TRUE                                        13490000
135000                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       13500000
135100                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS13510000
135200                     MOVE SPACE TO ASC-SELECTED-SW                13520000
135300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13530000
135400             END-EVALUATE                                         13540000
135500         WHEN OTHER                                               13550000
135600             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           13560000
135700             SET DP020-MSG-FATAL    TO TRUE                       13570000
135800             MOVE -1                TO MR-SELECTL (PV-SUB)        13580000
135900             SET DP030-SET-CURSOR-APPL-1                          13590000
136000                                    TO TRUE                       13600000
136100             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        13610000
136200             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        13620000
136300             SET PS-ERROR TO TRUE                                 13630000
136400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13640000
136500                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     13650000
136600                 MOVE SPACE         TO ASC-SELECTED-SW            13660000
136700                                        (ASC-BLK-SUB ASC-ITEM-SUB)13670000
136800             END-IF                                               13680000
136900     END-EVALUATE.                                                13690000
137000                                                                  13700000
137100     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 13710000
137200     SUBTRACT +1 FROM ASC-ITEM-SUB.                               13720000
137300     IF  ASC-ITEM-SUB < 1                                         13730000
137400         SUBTRACT +1 FROM ASC-BLK-SUB                             13740000
137500         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                13750000
137600     END-IF.                                                      13760000
137700                                                                  13770000
137800                                                                  13780000
137900******************************************************************13790000
138000** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **13800000
138100** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **13810000
138200** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**13820000
138300** THE ENDING.                                                  **13830000
138400******************************************************************13840000
138500 3310-EDIT-RANGE.                                                 13850000
138600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     13860000
138700             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 13870000
138800                                   TO ASC-SELECTED-SW             13880000
138900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13890000
139000             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   13900000
139100         ELSE                                                     13910000
139200             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       13920000
139300                 CONTINUE                                         13930000
139400             ELSE                                                 13940000
139500*                -- ONLY ONE END-OF-RANGE ALLOWED --              13950000
139600                 MOVE PC-TSYMSG-00055                             13960000
139700                                   TO DP020-MSG-NUMBER            13970000
139800                 SET DP020-MSG-FATAL                              13980000
139900                                   TO TRUE                        13990000
140000                 MOVE -1           TO MR-SELECTL (PV-SUB)         14000000
140100                 SET DP030-SET-CURSOR-APPL-1                      14010000
140200                                   TO TRUE                        14020000
140300                 SET PS-ERROR      TO TRUE                        14030000
140400             END-IF                                               14040000
140500         END-IF.                                                  14050000
140600                                                                  14060000
140700                                                                  14070000
140800******************************************************************14080000
140900** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **14090000
141000** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **14100000
141100******************************************************************14110000
141200 3400-CHECK-RANGE-SEQUENCE.                                       14120000
141300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       14130000
141400       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      14140000
141500       AND  ASC-START-OF-SELECTED-RANGE >                         14150000
141600                                         ASC-END-OF-SELECTED-RANGE14160000
141700*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                14170000
141800         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 14180000
141900         SET DP020-MSG-FATAL TO TRUE                              14190000
142000         SET PS-ERROR TO TRUE                                     14200000
142100         PERFORM 3410-POSITION-AT-ERROR                           14210000
142200     END-IF.                                                      14220000
142300                                                                  14230000
142400                                                                  14240000
142500******************************************************************14250000
142600** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **14260000
142700** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **14270000
142800** SHOULD BE POSITIONED ON A RANGE ERROR.                       **14280000
142900******************************************************************14290000
143000 3410-POSITION-AT-ERROR.                                          14300000
143100     SET DP030-SET-CURSOR-APPL-1                                  14310000
143200                                   TO TRUE.                       14320000
143300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 14330000
143400                    - PV-TOP-ITEM + 1.                            14340000
143500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14350000
143600         CONTINUE                                                 14360000
143700     ELSE                                                         14370000
143800         MOVE -1                   TO MR-SELECTL (PV-SUB)         14380000
143900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14390000
144000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14400000
144100     END-IF.                                                      14410000
144200*                                                                 14420000
144300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   14430000
144400                    - PV-TOP-ITEM + 1.                            14440000
144500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14450000
144600         CONTINUE                                                 14460000
144700     ELSE                                                         14470000
144800         MOVE -1                   TO MR-SELECTL (PV-SUB)         14480000
144900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14490000
145000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14500000
145100     END-IF.                                                      14510000
145200                                                                  14520000
145300                                                                  14530000
145400*----------------------------------------------------------------*14540000
145500*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *14550000
145600*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *14560000
145700*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *14570000
145800*----------------------------------------------------------------*14580000
145900                                                                  14590000
146000 3500-MARK-RANGE-AS-SELECTED.                                     14600000
146100     MOVE +1                       TO  ASC-BLK-SUB.               14610000
146200     PERFORM 3510-MARK-SELECTED-INDS                              14620000
146300         VARYING ASC-ITEM-SUB                                     14630000
146400         FROM 1 BY 1                                              14640000
146500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14650000
146600                                                                  14660000
146700     ADD +1                        TO ASC-BLK-SUB.                14670000
146800     PERFORM 3510-MARK-SELECTED-INDS                              14680000
146900         VARYING ASC-ITEM-SUB                                     14690000
147000         FROM 1 BY 1                                              14700000
147100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14710000
147200                                                                  14720000
147300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               14730000
147400                                   TO  PV-LIST-ITEM-NUMBER.       14740000
147500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            14750000
147600         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         14760000
147700               PC-ITEMS-PER-PANEL).                               14770000
147800                                                                  14780000
147900     MOVE ASC-START-OF-SELECTED-RANGE                             14790000
148000                                   TO PV-START-OF-SELECTED-RANGE. 14800000
148100     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            14810000
148200         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  14820000
148300               PC-ITEMS-PER-PANEL).                               14830000
148400                                                                  14840000
148500     MOVE ASC-END-OF-SELECTED-RANGE                               14850000
148600                                   TO  PV-END-OF-SELECTED-RANGE.  14860000
148700     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             14870000
148800         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    14880000
148900               PC-ITEMS-PER-PANEL).                               14890000
149000     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             14900000
149100         PV-FIRST-BLOCK-IN-ARRAY + 1.                             14910000
149200                                                                  14920000
149300     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    14930000
149400        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        14940000
149500         MOVE +1                   TO ASC-BLK-SUB                 14950000
149600         PERFORM 5100-WRITE-TEMP-STORAGE                          14960000
149700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         14970000
149800             PV-FIRST-BLOCK-IN-ARRAY - 1                          14980000
149900                                                                  14990000
150000         PERFORM                                                  15000000
150100             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      15010000
150200                   PV-PREV-BLOCK-IN-ARRAY                         15020000
150300             MOVE PV-FIRST-BLOCK-IN-RANGE                         15030000
150400                                   TO PV-BLOCK-NUMBER             15040000
150500             PERFORM 4410-READ-TEMP-STORAGE                       15050000
150600             PERFORM 3510-MARK-SELECTED-INDS                      15060000
150700                 VARYING ASC-ITEM-SUB                             15070000
150800                 FROM 1 BY 1                                      15080000
150900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15090000
151000             PERFORM 5100-WRITE-TEMP-STORAGE                      15100000
151100             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     15110000
151200         END-PERFORM                                              15120000
151300                                                                  15130000
151400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15140000
151500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15150000
151600         PERFORM                                                  15160000
151700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15170000
151800                   PV-LAST-BLOCK-IN-RANGE                         15180000
151900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          15190000
152000                                   TO PV-BLOCK-NUMBER             15200000
152100             PERFORM 4410-READ-TEMP-STORAGE                       15210000
152200             PERFORM 3510-MARK-SELECTED-INDS                      15220000
152300                 VARYING ASC-ITEM-SUB                             15230000
152400                 FROM 1 BY 1                                      15240000
152500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15250000
152600             PERFORM 5100-WRITE-TEMP-STORAGE                      15260000
152700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      15270000
152800         END-PERFORM                                              15280000
152900                                                                  15290000
153000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             15300000
153100                                   TO PV-BLOCK-NUMBER             15310000
153200         PERFORM 4410-READ-TEMP-STORAGE                           15320000
153300     END-IF.                                                      15330000
153400                                                                  15340000
153500     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 15350000
153600                                      ASC-END-OF-SELECTED-RANGE.  15360000
153700                                                                  15370000
153800                                                                  15380000
153900*----------------------------------------------------------------*15390000
154000* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *15400000
154100*----------------------------------------------------------------*15410000
154200                                                                  15420000
154300 3510-MARK-SELECTED-INDS.                                         15430000
154400                                                                  15440000
154500     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15450000
154600                                ASC-ITEM-SUB) >                   15460000
154700         ASC-START-OF-SELECTED-RANGE)                             15470000
154800     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15480000
154900                                ASC-ITEM-SUB) =                   15490000
155000         ASC-START-OF-SELECTED-RANGE)                             15500000
155100                                                                  15510000
155200         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15520000
155300                                    ASC-ITEM-SUB) <               15530000
155400             ASC-END-OF-SELECTED-RANGE)                           15540000
155500         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15550000
155600                                    ASC-ITEM-SUB) =               15560000
155700             ASC-END-OF-SELECTED-RANGE)                           15570000
155800                                                                  15580000
155900             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15590000
156000                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   15600000
156100                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   15610000
156200                               TO TRUE                            15620000
156300                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              15630000
156400                               TO TRUE                            15640000
156500                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    15650000
156600             END-IF                                               15660000
156700         END-IF                                                   15670000
156800     END-IF.                                                      15680000
156900                                                                  15690000
157000 EJECT                                                            15700000
157100*----------------------------------------------------------------*15710000
157200*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *15720000
157300*    INITIALIZE ALL COUNTERS AND FLAGS.                          *15730000
157400*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *15740000
157500*    DISPLAY THE PANEL TO USER.                                  *15750000
157600*----------------------------------------------------------------*15760000
157700                                                                  15770000
157800 4000-BUILD-INITIAL-PANEL.                                        15780000
157900                                                                  15790000
158000     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             15800000
158100                                ASC-BLOCK-ENTRIES (2).            15810000
158200     MOVE +1                 TO ASC-BLK-SUB.                      15820000
158300     SET ASC-ITEMS-LEFT-ON-DB                                     15830000
158400                             TO TRUE.                             15840000
158500                                                                  15850000
158600     MOVE ZERO               TO ASC-ITEM-SUB                      15860000
158700                                ASC-NUMBER-OF-ITEMS-READ          15870000
158800                                ASC-NUMBER-OF-SELECTED-ITEMS      15880000
158900                                ASC-HIGHEST-BLOCK-WRITTEN         15890000
159000                                ASC-START-OF-SELECTED-RANGE       15900000
159100                                ASC-END-OF-SELECTED-RANGE         15910000
159200                                ASC-ITEM-AT-TOP-OF-PANEL.         15920000
159300                                                                  15930000
159310     PERFORM 4025-GET-TRLR-INFO.                                  15931001
159320                                                                  15932001
159400     PERFORM 4030-STORE-NAME.                                     15940000
159500     PERFORM 4040-TRIP-SO-DATE.                                   15950000
159600                                                                  15960000
160900     PERFORM 4050-TRIP-SU-DATE.                                   16090000
161000                                                                  16100000
162200                                                                  16220000
162300     PERFORM 4060-TRIP-CART-UNT-CNT.                              16230000
162400     PERFORM 4070-SCAN-CNT.                                       16240000
162500     PERFORM 4080-MFST-NOT-SCAN.                                  16250000
162600     PERFORM 4090-CHECK-TRLR-DIVERT.                              16260000
162700                                                                  16270000
162800     PERFORM 4100-PREPARE-CURSOR                                  16280000
162900                                                                  16290000
163000     PERFORM 4010-OPEN-CURSOR.                                    16300000
163100                                                                  16310000
163200     PERFORM 4300-READ-ITEMS-FROM-DB.                             16320000
163300                                                                  16330000
163400     PERFORM 4020-CLOSE-CURSOR.                                   16340000
163500                                                                  16350000
163600     MOVE +1                 TO PV-TOP-ITEM.                      16360000
163700                                                                  16370000
163800*    IF MORE THAN ONE ITEM WAS SELECTED, SHOW A BLANK LIST        16380000
163900*    FOR THOSE ITEMS THAT WERE NOT FOUND.  THIS ALLOWS THE USER   16390000
164000*    TO BROWSE THRU THEIR SELECTIONS WITHOUT JUMPING BACK TO      16400000
164100*    THE ORIGINAL SCREEN.                                         16410000
164200     EVALUATE TRUE                                                16420000
164300         WHEN SU010-SELECTED-ITEMS > 1                            16430000
164400             IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                  16440000
164500                 SET DP020-MSG-WARNING TO  TRUE                   16450000
164600                 MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER       16460000
164700                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              16470000
164800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             16480000
164900             ELSE                                                 16490000
165000                 MOVE -1               TO MR-SELECTL (1)          16500000
165100                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              16510000
165200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             16520000
165300             END-IF                                               16530000
165400         WHEN OTHER                                               16540000
165500             IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                  16550000
165600                 SET DP020-NEXT-ACT-APPL-ERROR TO TRUE            16560000
165700                 SET DP020-MSG-FATAL   TO  TRUE                   16570000
165800                 MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER       16580000
165900             ELSE                                                 16590000
166000                 MOVE -1               TO MR-SELECTL (1)          16600000
166100                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              16610000
166200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             16620000
166300             END-IF                                               16630000
166400     END-EVALUATE.                                                16640000
166500                                                                  16650000
166600                                                                  16660000
166700 4010-OPEN-CURSOR.                                                16670000
166800                                                                  16680000
166900     EXEC SQL                                                     16690000
167000          OPEN TRIP-STR-SCAN-CSR                                  16700000
167100     END-EXEC.                                                    16710000
167200                                                                  16720000
167300     EVALUATE TRUE                                                16730000
167400         WHEN SQLCODE = ZERO                                      16740000
167500             CONTINUE                                             16750000
167600         WHEN SQLCODE = -904                                      16760000
167700         WHEN SQLCODE = -911                                      16770000
167800         WHEN SQLCODE = -913                                      16780000
167900             PERFORM 9900-SOFT-ABORT                              16790000
168000         WHEN SQLWARN0 NOT = SPACES                               16800000
168100         WHEN SQLCODE < ZERO                                      16810000
168200         WHEN SQLCODE > ZERO                                      16820000
168300             MOVE DK-OTBND-TRIP-ID TO PV-DISP-TRIP                16830000
168400             MOVE '4010-OPEN-CURSOR'                              16840000
168500                                   TO DP013-PARAGRAPH             16850000
168600             MOVE 'OPEN CURSOR'                                   16860000
168700                                   TO DP013-MESSAGE-TEXT (1)      16870000
168800             MOVE PV-DISP-TRIP     TO DP013-MESSAGE-TEXT (2)      16880000
168900             MOVE SQLCA            TO DP013-SQLCA                 16890000
169000             MOVE 'SUT_OTBND_STR_SCN' TO DP013-DB2-TABLE-NAME (1) 16900000
169100             MOVE 'SUT_OTBND_SCN_TYP' TO DP013-DB2-TABLE-NAME (2) 16910000
169200             SET DP013-DB2-ABEND                                  16920000
169300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               16930000
169400             PERFORM DP013-0000-PROCESS-ABEND                     16940000
169500     END-EVALUATE.                                                16950000
169600                                                                  16960000
169700                                                                  16970000
169800 4020-CLOSE-CURSOR.                                               16980000
169900                                                                  16990000
170000     EXEC SQL                                                     17000000
170100          CLOSE TRIP-STR-SCAN-CSR                                 17010000
170200     END-EXEC.                                                    17020000
170300*                                                                 17030000
170400     EVALUATE TRUE                                                17040000
170500         WHEN SQLCODE = ZERO                                      17050000
170600             CONTINUE                                             17060000
170700         WHEN SQLCODE = -904                                      17070000
170800         WHEN SQLCODE = -911                                      17080000
170900         WHEN SQLCODE = -913                                      17090000
171000             PERFORM 9900-SOFT-ABORT                              17100000
171100         WHEN SQLWARN0 NOT = SPACES                               17110000
171200         WHEN SQLCODE < ZERO                                      17120000
171300         WHEN SQLCODE > ZERO                                      17130000
171400             MOVE DK-OTBND-TRIP-ID TO PV-DISP-TRIP                17140000
171500             MOVE '4020-CLOSE-CURSOR'                             17150000
171600                                   TO DP013-PARAGRAPH             17160000
171700             MOVE 'CLOSE CURSOR'                                  17170000
171800                                   TO DP013-MESSAGE-TEXT (1)      17180000
171900             MOVE PV-DISP-TRIP     TO DP013-MESSAGE-TEXT (2)      17190000
172000             MOVE SQLCA            TO DP013-SQLCA                 17200000
172100             MOVE 'SUT_OTBND_STR_SCN' TO DP013-DB2-TABLE-NAME (1) 17210000
172200             MOVE 'SUT_OTBND_SCN_TYP' TO DP013-DB2-TABLE-NAME (2) 17220000
172300             SET DP013-DB2-ABEND                                  17230000
172400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               17240000
172500             PERFORM DP013-0000-PROCESS-ABEND                     17250000
172600     END-EVALUATE.                                                17260000
172700                                                                  17270000
172800                                                                  17280000
172801*----------------------------------------------------------------*17280101
172802* GET THE TRAILER INFORMATION ASSOCIATED WITH THE TRIP           *17280201
172803*----------------------------------------------------------------*17280301
172810 4025-GET-TRLR-INFO.                                              17281001
172811                                                                  17281101
172820     MOVE ASC-KEY-TRIP-ID  TO  SUOBTR-OTBND-TRIP-ID.              17282001
172830                                                                  17283001
172860     EXEC SQL                                                     17286001
172870          SELECT  A.TRLR_SRL_NBR                                  17287001
172871                 ,B.SCAC_CDE                                      17287101
172872                 ,B.TRLR_ID                                       17287201
172880            INTO :SUOBTR-TRLR-SRL-NBR                             17288001
172881                ,:CNTRID-SCAC-CDE                                 17288101
172882                ,:CNTRID-TRLR-ID                                  17288201
172890            FROM  TSUOBTR A                                       17289001
172891               ,  TCNTRID B                                       17289101
172892           WHERE A.OTBND_TRIP_ID  =  :SUOBTR-OTBND-TRIP-ID        17289201
172893             AND A.TRLR_SRL_NBR   =  B.TRLR_SRL_NBR               17289301
172897     END-EXEC.                                                    17289701
172898                                                                  17289801
172899     EVALUATE TRUE                                                17289901
172900         WHEN SQLCODE = ZERO                                      17290001
172901              MOVE CNTRID-SCAC-CDE     TO ASC-KEY-SCAC            17290101
172902              MOVE CNTRID-TRLR-ID      TO ASC-KEY-TRLR            17290201
172903              MOVE SUOBTR-TRLR-SRL-NBR TO ASC-KEY-SRL             17290301
172905         WHEN SQLCODE = +100                                      17290501
172906              MOVE SPACES           TO  ASC-KEY-SCAC              17290601
172907                                        ASC-KEY-TRLR              17290701
172908              MOVE ZEROES           TO  ASC-KEY-SRL               17290801
172910         WHEN SQLCODE = -904                                      17291001
172911         WHEN SQLCODE = -911                                      17291101
172912         WHEN SQLCODE = -913                                      17291201
172913             PERFORM 9900-SOFT-ABORT                              17291301
172914         WHEN SQLWARN0 NOT = SPACE                                17291401
172915         WHEN SQLCODE NOT = ZERO                                  17291501
172916             MOVE SUOBTR-OTBND-TRIP-ID TO PV-DISP-TRIP            17291601
172917             MOVE SQLCA            TO DP013-SQLCA                 17291701
172918             MOVE '4025-GET-TRLR-INFO' TO DP013-PARAGRAPH         17291801
172919             MOVE 'GET TRAILER INFO: '                            17291901
172920                                   TO DP013-MESSAGE-TEXT (1)      17292001
172921             STRING 'TRIP:'   PV-DISP-TRIP                        17292101
172922                    ' STORE:' ASC-STR-NBR                         17292201
172923                                      DELIMITED BY SIZE           17292301
172924                                 INTO DP013-MESSAGE-TEXT (2)      17292401
172925             MOVE SQLCA            TO DP013-SQLCA                 17292501
172926             MOVE 'TSUOBTR'           TO DP013-DB2-TABLE-NAME (1) 17292601
172927             MOVE 'TCNTRID'           TO DP013-DB2-TABLE-NAME (2) 17292701
172928             SET DP013-DB2-ABEND   TO TRUE                        17292801
172929             PERFORM DP013-0000-PROCESS-ABEND                     17292901
172930     END-EVALUATE.                                                17293001
172931                                                                  17293101
172932                                                                  17293201
172940*----------------------------------------------------------------*17294000
173000* STORE NAME THE TRAILER IS MANIFESTED FOR                       *17300000
173100*----------------------------------------------------------------*17310000
173200 4030-STORE-NAME.                                                 17320000
173300     MOVE ASC-STR-NBR TO XLT00010-LOC-NBR.                        17330000
173400                                                                  17340000
173500     MOVE SPACES      TO ASC-STORE-NAME.                          17350000
173600                                                                  17360000
173700     EXEC SQL                                                     17370000
173800          SELECT  LOC_NM                                          17380000
173900            INTO :XLT00010-LOC-NM                                 17390000
174000            FROM  XLT_LOC                                         17400000
174100           WHERE  LOC_NBR  = :XLT00010-LOC-NBR                    17410000
174200     END-EXEC.                                                    17420000
174300                                                                  17430000
174400     EVALUATE TRUE                                                17440000
174500         WHEN SQLCODE = ZERO                                      17450000
174600              MOVE XLT00010-LOC-NM  TO  ASC-STORE-NAME            17460000
174700         WHEN SQLCODE = +100                                      17470000
174800              MOVE 'UNKNOWN'        TO  ASC-STORE-NAME            17480000
174900         WHEN SQLCODE = -904                                      17490000
175000         WHEN SQLCODE = -911                                      17500000
175100         WHEN SQLCODE = -913                                      17510000
175200             PERFORM 9900-SOFT-ABORT                              17520000
175300         WHEN SQLWARN0 NOT = SPACE                                17530000
175400         WHEN SQLCODE NOT = ZERO                                  17540000
175500             MOVE DK-OTBND-TRIP-ID TO PV-DISP-TRIP                17550000
175600             MOVE SQLCA            TO DP013-SQLCA                 17560000
175700             MOVE '4030-STORE-NAME' TO DP013-PARAGRAPH            17570000
175800             MOVE 'FETCH CURSOR'                                  17580000
175900                                   TO DP013-MESSAGE-TEXT (1)      17590000
176000             STRING 'TRIP:'   PV-DISP-TRIP                        17600000
176100                    ' STORE:' ASC-STR-NBR                         17610000
176200                                      DELIMITED BY SIZE           17620000
176300                                 INTO DP013-MESSAGE-TEXT (2)      17630000
176400             MOVE SQLCA            TO DP013-SQLCA                 17640000
176500             MOVE 'SUT_OTBND_STR_SCN' TO DP013-DB2-TABLE-NAME (1) 17650000
176600             MOVE 'SUT_OTBND_SCN_TYP' TO DP013-DB2-TABLE-NAME (2) 17660000
176700             SET DP013-DB2-ABEND   TO TRUE                        17670000
176800             PERFORM DP013-0000-PROCESS-ABEND                     17680000
176900     END-EVALUATE.                                                17690000
177000                                                                  17700000
177100                                                                  17710000
177200*----------------------------------------------------------------*17720000
177300* DATE/TIME/ASSOCIATE FOR STORE UNLOAD STATUS                    *17730000
177400*----------------------------------------------------------------*17740000
177500 4040-TRIP-SO-DATE.                                               17750000
177600     MOVE SPACES           TO ASC-SO-DATE.                        17760000
177700     MOVE SPACES           TO ASC-SO-TIME.                        17770000
177800     MOVE SPACES           TO SUOBTS-OTBND-STAT-TMST.             17780011
177810     MOVE SPACES           TO SUOBTS-OTBND-STAT-USR-ID.           17781011
177900                                                                  17790000
178000     MOVE ASC-KEY-TRIP-ID  TO SUOBTS-OTBND-TRIP-ID.               17800000
178100                                                                  17810000
178200     EXEC SQL                                                     17820000
178300          SELECT  OTBND_STAT_TMST                                 17830000
178400                 ,OTBND_STAT_USR_ID                               17840000
178500            INTO :SUOBTS-OTBND-STAT-TMST                          17850000
178600                ,:SUOBTS-OTBND-STAT-USR-ID                        17860000
178700            FROM  TSUOBTS                                         17870000
178800           WHERE  OTBND_TRIP_ID  = :SUOBTS-OTBND-TRIP-ID          17880000
178900             AND  TRIP_STAT_CDE  = 'SO'                           17890000
179000     END-EXEC.                                                    17900000
179100                                                                  17910000
179200     EVALUATE TRUE                                                17920000
179300         WHEN SQLCODE = ZERO                                      17930000
179400         WHEN SQLCODE = -811                                      17940000
179500              MOVE SUOBTS-OTBND-STAT-TMST   TO PV-WORK-TMST       17950000
179600              PERFORM 4045-USER-NAME                              17960000
179700              IF XL067-KOHLS-NOT-FOUND                            17970000
179800                 MOVE 'UNKNOWN'             TO ASC-SO-NAME        17980005
179900              ELSE                                                17990000
180000                 MOVE XL067-COMBINED-NAME-2 TO ASC-SO-NAME        18000000
180100              END-IF                                              18010000
180101                                                                  18010110
180110              MOVE PV-YY            TO  PV-DATE-YY                18011010
180120              MOVE PV-MM            TO  PV-DATE-MM                18012010
180130              MOVE PV-DD            TO  PV-DATE-DD                18013010
180140              MOVE '-'              TO  PV-DATE-DASH-1            18014010
180150              MOVE '-'              TO  PV-DATE-DASH-2            18015010
180160              MOVE PV-WORK-DATE     TO  ASC-SO-DATE               18016010
180180              MOVE PV-HR            TO  PV-TIME-HR                18018010
180190              MOVE PV-MN            TO  PV-TIME-MN                18019010
180191              MOVE ':'              TO  PV-TIME-COLON             18019110
180192              MOVE PV-WORK-TIME     TO  ASC-SO-TIME               18019210
180193                                                                  18019310
180200         WHEN SQLCODE = +100                                      18020000
180210              MOVE SPACES           TO  ASC-SO-DATE               18021010
180220                                        ASC-SO-TIME               18022010
180300                                        ASC-SO-NAME               18030010
180310                                                                  18031010
180400         WHEN SQLCODE = -904                                      18040000
180500         WHEN SQLCODE = -911                                      18050000
180600         WHEN SQLCODE = -913                                      18060000
180700             PERFORM 9900-SOFT-ABORT                              18070000
180800         WHEN SQLWARN0 NOT = SPACE                                18080000
180900         WHEN SQLCODE NOT = ZERO                                  18090000
181000             MOVE SUOBTS-OTBND-TRIP-ID TO PV-DISP-TRIP            18100000
181100             MOVE SQLCA                TO DP013-SQLCA             18110000
181200             MOVE '4040-TRIP-SO-DATE'  TO DP013-PARAGRAPH         18120000
181300             MOVE '4040-TRIP-SO-DATE'                             18130000
181400                                   TO DP013-MESSAGE-TEXT (1)      18140000
181500             STRING 'TRIP:'   PV-DISP-TRIP                        18150000
181600                    ' STORE:' ASC-STR-NBR                         18160000
181700                                      DELIMITED BY SIZE           18170000
181800                                 INTO DP013-MESSAGE-TEXT (2)      18180000
181900             MOVE SQLCA            TO DP013-SQLCA                 18190000
182000             MOVE 'TSUOBTS'           TO DP013-DB2-TABLE-NAME (1) 18200000
182100             SET DP013-DB2-ABEND   TO TRUE                        18210000
182200             PERFORM DP013-0000-PROCESS-ABEND                     18220000
182300     END-EVALUATE.                                                18230000
182400                                                                  18240000
182410                                                                  18241000
182420*----------------------------------------------------------------*18242000
182421*                                                                *18242100
182422*----------------------------------------------------------------*18242200
182423 4045-USER-NAME.                                                  18242300
182424                                                                  18242400
182425     INITIALIZE XL067-USER-COMMAREA.                              18242500
182426                                                                  18242600
182427     SET XL067-BY-USER-ID            TO TRUE.                     18242700
182428     SET XL067-SELECT-KOHLS-USER     TO TRUE.                     18242800
182429                                                                  18242900
182430     MOVE SUOBTS-OTBND-STAT-USR-ID   TO XL067-KEY-USER-ID.        18243000
182431                                                                  18243100
182432     CALL XL067-USER-PGM USING DFHEIBLK                           18243200
182433                               XL067-COMMAREA                     18243300
182434                               XL067-USER-COMMAREA.               18243400
182435                                                                  18243500
182436     EVALUATE TRUE                                                18243600
182437         WHEN XL067-SUCCESSFUL                                    18243700
182438             CONTINUE                                             18243800
182439         WHEN OTHER                                               18243900
182440              DISPLAY '***********************************'       18244000
182441              DISPLAY '****     SUKCS548  ABEND       ****'       18244106
182442              DISPLAY '***********************************'       18244200
182443              DISPLAY '**  PARAGRAPH 4045-USER-NAME     **'       18244300
182444              DISPLAY '**  UNSUCCESSFUL CALL TO XLKUT067**'       18244400
182445              DISPLAY '**  SEE PROD COPYBOOK XLWS067    **'       18244500
182446              DISPLAY '**  XL067-RETURN-CODE:'  XL067-RETURN-CODE 18244600
182447              DISPLAY '***********************************'       18244700
182448              MOVE '4045-USER-NAME' TO DP013-PARAGRAPH            18244800
182449              MOVE 'SELECT INFO PROBLEM '                         18244900
182450                                    TO DP013-MESSAGE-TEXT (1)     18245000
182451              MOVE SQLCA            TO DP013-SQLCA                18245100
182452              MOVE 'XLT_USR '       TO DP013-DB2-TABLE-NAME (1)   18245200
182453              SET DP013-DB2-ABEND   TO TRUE                       18245300
182454              PERFORM DP013-0000-PROCESS-ABEND                    18245400
182455     END-EVALUATE.                                                18245500
182456                                                                  18245600
182457                                                                  18245700
182458*----------------------------------------------------------------*18245800
182459* DATE/TIME/ASSOCIATE FOR STORE UNLOAD STATUS                    *18245900
182460*----------------------------------------------------------------*18246000
182461 4050-TRIP-SU-DATE.                                               18246100
182462     MOVE SPACES      TO ASC-SU-DATE.                             18246200
182463     MOVE SPACES      TO ASC-SU-TIME.                             18246300
182464     MOVE SPACES      TO ASC-SU-NAME.                             18246400
182465     MOVE SPACES      TO SUOBTS-OTBND-STAT-TMST.                  18246511
182466     MOVE SPACES      TO SUOBTS-OTBND-STAT-USR-ID.                18246611
182467                                                                  18246700
182468     MOVE ASC-KEY-TRIP-ID  TO SUOBTS-OTBND-TRIP-ID.               18246800
182469                                                                  18246900
182470     EXEC SQL                                                     18247000
182471          SELECT  OTBND_STAT_TMST                                 18247100
182472                 ,OTBND_STAT_USR_ID                               18247200
182473            INTO :SUOBTS-OTBND-STAT-TMST                          18247300
182474                ,:SUOBTS-OTBND-STAT-USR-ID                        18247400
182475            FROM  TSUOBTS                                         18247500
182476           WHERE  OTBND_TRIP_ID  = :SUOBTS-OTBND-TRIP-ID          18247600
182477             AND  TRIP_STAT_CDE  = 'SU'                           18247700
182478            WITH UR                                               18247800
182479     END-EXEC.                                                    18247900
182480                                                                  18248000
182481     EVALUATE TRUE                                                18248100
182482         WHEN SQLCODE = ZERO                                      18248200
182483         WHEN SQLCODE = -811                                      18248300
182484              MOVE SUOBTS-OTBND-STAT-TMST   TO PV-WORK-TMST       18248400
182485              PERFORM 4045-USER-NAME                              18248500
182486              IF XL067-KOHLS-NOT-FOUND                            18248600
182487                 MOVE 'UNKNOWN'             TO ASC-SU-NAME        18248705
182488              ELSE                                                18248800
182489                 MOVE XL067-COMBINED-NAME-2 TO ASC-SU-NAME        18248900
182490              END-IF                                              18249000
182491                                                                  18249110
182492              MOVE PV-YY            TO  PV-DATE-YY                18249210
182493              MOVE PV-MM            TO  PV-DATE-MM                18249310
182494              MOVE PV-DD            TO  PV-DATE-DD                18249410
182495              MOVE '-'              TO  PV-DATE-DASH-1            18249510
182496              MOVE '-'              TO  PV-DATE-DASH-2            18249610
182497              MOVE PV-WORK-DATE     TO  ASC-SU-DATE               18249710
182498              MOVE PV-HR            TO  PV-TIME-HR                18249810
182499              MOVE PV-MN            TO  PV-TIME-MN                18249910
182500              MOVE ':'              TO  PV-TIME-COLON             18250010
182501              MOVE PV-WORK-TIME     TO  ASC-SU-TIME               18250110
182502                                                                  18250210
182503         WHEN SQLCODE = +100                                      18250300
182504              MOVE SPACES           TO  ASC-SU-DATE               18250410
182505                                        ASC-SU-TIME               18250510
182506                                        ASC-SU-NAME               18250610
182507                                                                  18250710
182508         WHEN SQLCODE = -904                                      18250800
182509         WHEN SQLCODE = -911                                      18250900
182510         WHEN SQLCODE = -913                                      18251000
182511             PERFORM 9900-SOFT-ABORT                              18251100
182512         WHEN SQLWARN0 NOT = SPACE                                18251200
182513         WHEN SQLCODE NOT = ZERO                                  18251300
182514             MOVE SUOBTS-OTBND-TRIP-ID TO PV-DISP-TRIP            18251400
182515             MOVE SQLCA                TO DP013-SQLCA             18251500
182516             MOVE '4050-TRIP-SU-DATE'  TO DP013-PARAGRAPH         18251600
182517             MOVE '4050-TRIP-SU-DATE'                             18251700
182518                                   TO DP013-MESSAGE-TEXT (1)      18251800
182519             STRING 'TRIP:'   PV-DISP-TRIP                        18251900
182520                    ' STORE:' ASC-STR-NBR                         18252000
182521                                      DELIMITED BY SIZE           18252100
182522                                 INTO DP013-MESSAGE-TEXT (2)      18252200
182523             MOVE SQLCA            TO DP013-SQLCA                 18252300
182524             MOVE 'TSUOBTS'           TO DP013-DB2-TABLE-NAME (1) 18252400
182525             SET DP013-DB2-ABEND   TO TRUE                        18252500
182526             PERFORM DP013-0000-PROCESS-ABEND                     18252600
182527     END-EVALUATE.                                                18252700
182528                                                                  18252800
182529                                                                  18252900
182530*----------------------------------------------------------------*18253000
182531* GET THE MOST MOST CURRENT CARTON/UNIT COUNT FROM SUT_TRIP_SUM  *18253100
182532*----------------------------------------------------------------*18253200
182533 4060-TRIP-CART-UNT-CNT.                                          18253300
182534     MOVE ZEROES      TO ASC-CARTON-CNT.                          18253400
182535     MOVE ZEROES      TO ASC-UNIT-CNT.                            18253500
182536                                                                  18253600
182537     MOVE  ASC-KEY-TRIP-ID  TO  SUT00007-OTBND-TRIP-ID.           18253700
182538                                                                  18253800
182539     EXEC SQL                                                     18253900
182540          SELECT  A.UNT_QTY                                       18254000
182541                 ,A.CART_QTY                                      18254100
182542            INTO  :SUT00007-UNT-QTY                               18254200
182543                 ,:SUT00007-CART-QTY                              18254300
182544            FROM  SUT_TRIP_SUM A                                  18254400
182545           WHERE  A.OTBND_TRIP_ID = :SUT00007-OTBND-TRIP-ID       18254500
182546             AND  A.CRE_TMST IN                                   18254600
182547                    (SELECT MAX(B.CRE_TMST)                       18254700
182548                       FROM SUT_TRIP_SUM B                        18254800
182549                      WHERE A.OTBND_TRIP_ID = B.OTBND_TRIP_ID)    18254900
182550            WITH UR                                               18255000
182551     END-EXEC.                                                    18255100
182552                                                                  18255200
182553     EVALUATE TRUE                                                18255300
182554         WHEN SQLCODE = ZERO                                      18255400
182555         WHEN SQLCODE = -811                                      18255500
182556              MOVE SUT00007-UNT-QTY  TO ASC-UNIT-CNT              18255600
182557              MOVE SUT00007-CART-QTY TO ASC-CARTON-CNT            18255700
182558         WHEN SQLCODE = +100                                      18255800
182559              MOVE ZEROES            TO ASC-UNIT-CNT              18255900
182560                                        ASC-CARTON-CNT            18256000
182561         WHEN SQLCODE = -904                                      18256100
182562         WHEN SQLCODE = -911                                      18256200
182563         WHEN SQLCODE = -913                                      18256300
182564             PERFORM 9900-SOFT-ABORT                              18256400
182565         WHEN SQLWARN0 NOT = SPACE                                18256500
182566         WHEN SQLCODE NOT = ZERO                                  18256600
182567             MOVE SUT00007-OTBND-TRIP-ID TO PV-DISP-TRIP          18256700
182568             MOVE SQLCA                TO DP013-SQLCA             18256800
182569             MOVE '4060-TRIP-CART-UNT-CNT' TO DP013-PARAGRAPH     18256900
182570             MOVE '4060-TRIP-CART-UNT-CNT'                        18257000
182571                                   TO DP013-MESSAGE-TEXT (1)      18257100
182572             STRING 'TRIP:'   PV-DISP-TRIP                        18257200
182573                    ' STORE:' ASC-STR-NBR                         18257300
182574                                      DELIMITED BY SIZE           18257400
182575                                 INTO DP013-MESSAGE-TEXT (2)      18257500
182576             MOVE SQLCA            TO DP013-SQLCA                 18257600
182577             MOVE 'SUT_TRIP_SUM'      TO DP013-DB2-TABLE-NAME (1) 18257700
182578             SET DP013-DB2-ABEND   TO TRUE                        18257800
182579             PERFORM DP013-0000-PROCESS-ABEND                     18257900
182580     END-EVALUATE.                                                18258000
182581                                                                  18258100
182582                                                                  18258200
182583*----------------------------------------------------------------*18258300
182584* COUNT THE TOTAL NUMBER OF SCANS FOR THE TRAILER BY THE STORE   *18258400
182585*----------------------------------------------------------------*18258500
182586 4070-SCAN-CNT.                                                   18258600
182587     MOVE ZEROES      TO ASC-TOTAL-SCAN.                          18258700
182588                                                                  18258800
182589     MOVE  ASC-KEY-TRIP-ID  TO  SUT00121-SCN-OTBND-TRIP-ID.       18258900
182590                                                                  18259000
182591     EXEC SQL                                                     18259100
182592          SELECT  COUNT(*)                                        18259200
182593            INTO :PV-SCAN-COUNT                                   18259300
182594            FROM  SUT_OTBND_STR_SCN                               18259400
182595           WHERE  SCN_OTBND_TRIP_ID = :SUT00121-SCN-OTBND-TRIP-ID 18259500
182596            WITH UR                                               18259600
182597     END-EXEC.                                                    18259700
182598                                                                  18259800
182599     EVALUATE TRUE                                                18259900
182600         WHEN SQLCODE = ZERO                                      18260000
182601              MOVE PV-SCAN-COUNT     TO ASC-TOTAL-SCAN            18260100
182602         WHEN SQLCODE = +100                                      18260200
182603              MOVE ZEROES            TO ASC-TOTAL-SCAN            18260300
182604         WHEN SQLCODE = -904                                      18260400
182605         WHEN SQLCODE = -911                                      18260500
182606         WHEN SQLCODE = -913                                      18260600
182607             PERFORM 9900-SOFT-ABORT                              18260700
182608         WHEN SQLWARN0 NOT = SPACE                                18260800
182610         WHEN SQLCODE NOT = ZERO                                  18261000
182611             MOVE SUT00121-SCN-OTBND-TRIP-ID TO PV-DISP-TRIP      18261100
182612             MOVE SQLCA                TO DP013-SQLCA             18261200
182613             MOVE '4070-SCAN-CNT'      TO DP013-PARAGRAPH         18261300
182614             MOVE '4070-SCAN-CNT'                                 18261400
182615                                   TO DP013-MESSAGE-TEXT (1)      18261500
182616             STRING 'TRIP:'   PV-DISP-TRIP                        18261600
182617                    ' STORE:' ASC-STR-NBR                         18261700
182618                                      DELIMITED BY SIZE           18261800
182619                                 INTO DP013-MESSAGE-TEXT (2)      18261900
182620             MOVE SQLCA            TO DP013-SQLCA                 18262000
182621             MOVE 'SUT_OTBND_STR_SCN' TO DP013-DB2-TABLE-NAME (1) 18262100
182622             SET DP013-DB2-ABEND   TO TRUE                        18262200
182623             PERFORM DP013-0000-PROCESS-ABEND                     18262300
182624     END-EVALUATE.                                                18262400
182625                                                                  18262500
182626                                                                  18262600
182627*----------------------------------------------------------------*18262700
182628* COUNT THE NUMBER OF CARTONS MANIFESTED TO THE TRAILER BUT NOT  *18262800
182629* SCANNED BY THE STORE YET                                       *18262900
182630*----------------------------------------------------------------*18263000
182631 4080-MFST-NOT-SCAN.                                              18263100
182632      MOVE ZEROES      TO ASC-MFST-NO-SCN.                        18263200
182633                                                                  18263300
182634      MOVE ASC-KEY-TRIP-ID  TO  SUT00024-OTBND-TRIP-ID            18263400
182635                                                                  18263500
182636     EXEC SQL                                                     18263600
182637          SELECT  COUNT(*)                                        18263700
182638            INTO :PV-NOT-SCAN-COUNT                               18263800
182639            FROM  SUT_OTBND_CART A                                18263900
182640           WHERE  OTBND_TRIP_ID = :SUT00024-OTBND-TRIP-ID         18264000
182641             AND NOT EXISTS                                       18264100
182642                 (SELECT *                                        18264200
182643                    FROM SUT_OTBND_STR_SCN B                      18264300
182644                   WHERE B.SCN_OTBND_TRIP_ID = A.OTBND_TRIP_ID    18264400
182645                     AND NOT B.SCN_TYP_CDE IN ('SSAR','SSAM')     18264500
182646                     AND B.SHIPT_UNT_ID = A.SHIPT_UNT_ID)         18264600
182647            WITH UR                                               18264700
182648     END-EXEC.                                                    18264800
182649                                                                  18264900
182650     EVALUATE TRUE                                                18265000
182651         WHEN SQLCODE = ZERO                                      18265100
182652              MOVE PV-NOT-SCAN-COUNT TO ASC-MFST-NO-SCN           18265200
182653         WHEN SQLCODE = +100                                      18265300
182654              MOVE ZEROES            TO ASC-MFST-NO-SCN           18265400
182655         WHEN SQLCODE = -904                                      18265500
182656         WHEN SQLCODE = -911                                      18265600
182657         WHEN SQLCODE = -913                                      18265700
182658             PERFORM 9900-SOFT-ABORT                              18265800
182659         WHEN SQLWARN0 NOT = SPACE                                18265900
182660         WHEN SQLCODE NOT = ZERO                                  18266000
182661             MOVE SUT00024-OTBND-TRIP-ID TO PV-DISP-TRIP          18266100
182662             MOVE SQLCA                TO DP013-SQLCA             18266200
182663             MOVE '4080-MFST-NOT-SCAN' TO DP013-PARAGRAPH         18266300
182664             MOVE '4080-MFST-NOT-SCAN'                            18266400
182665                                   TO DP013-MESSAGE-TEXT (1)      18266500
182666             STRING 'TRIP:'   PV-DISP-TRIP                        18266600
182667                    ' STORE:' ASC-STR-NBR                         18266700
182668                                      DELIMITED BY SIZE           18266800
182669                                 INTO DP013-MESSAGE-TEXT (2)      18266900
182670             MOVE SQLCA            TO DP013-SQLCA                 18267000
182671             MOVE 'SUT_OTBND_CART'    TO DP013-DB2-TABLE-NAME (1) 18267100
182672             MOVE 'SUT_OTBND_STR_SCN' TO DP013-DB2-TABLE-NAME (2) 18267200
182673             SET DP013-DB2-ABEND   TO TRUE                        18267300
182674             PERFORM DP013-0000-PROCESS-ABEND                     18267400
182675     END-EVALUATE.                                                18267500
182676                                                                  18267600
182677                                                                  18267700
182678*----------------------------------------------------------------*18267800
182679* CHECK IF TRAILER WAS DIVERTED FROM A DIFFERENT STORE           *18267900
182680*----------------------------------------------------------------*18268000
182681 4090-CHECK-TRLR-DIVERT.                                          18268100
182682                                                                  18268200
182683      MOVE  ZEROES           TO  ASC-STR-DVRT.                    18268300
182684                                                                  18268400
182685      MOVE  ASC-KEY-TRIP-ID  TO  WST00010-ATTR-ELEM-NBR.          18268500
182686                                                                  18268600
182687     EXEC SQL                                                     18268700
182688          SELECT  D.ATTR_ELEM_NBR                                 18268800
182689            INTO :PV-ATTR-ELEM-NBR                                18268900
182690            FROM                                                  18269000
182691                  WST_INTGRTN_TYP  A                              18269100
182692               ,  WST_ATTR_DEFN    B                              18269200
182693               ,  WST_ATTR_ELEM    C                              18269300
182694               ,  WST_ATTR_ELEM    D                              18269400
182695               ,  WST_ATTR_ELEM    E                              18269500
182696               ,  WST_ATTR_ELEM    F                              18269600
182697            WHERE                                                 18269700
182698                  A.INTGRTN_TYP_CDE   = 'TRLRDIVERT'              18269800
182699              AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE         18269900
182700              AND B.ATTR_DEFN_SEQ_NBR = 1                         18270000
182701              AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE         18270100
182702              AND C.ATTR_DEFN_SEQ_NBR = 1                         18270200
182703              AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE         18270300
182704              AND D.ATTR_DEFN_SEQ_NBR = 2                         18270400
182705              AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE         18270500
182706              AND E.ATTR_DEFN_SEQ_NBR = 3                         18270600
182707              AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE         18270700
182708              AND F.ATTR_DEFN_SEQ_NBR = 4                         18270800
182709              AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR       18270900
182710              AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR       18271000
182711              AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR       18271100
182712              AND C.ATTR_ELEM_NBR     = :WST00010-ATTR-ELEM-NBR   18271200
182713            WITH UR                                               18271300
182714     END-EXEC.                                                    18271400
182715                                                                  18271500
182716     EVALUATE TRUE                                                18271600
182717         WHEN SQLCODE = ZERO                                      18271700
182718         WHEN SQLCODE = -811                                      18271800
182719              MOVE PV-ATTR-ELEM-NBR  TO ASC-STR-DVRT              18271900
182720         WHEN SQLCODE = +100                                      18272000
182721              MOVE ZEROES            TO ASC-STR-DVRT              18272100
182722         WHEN SQLCODE = -904                                      18272200
182723         WHEN SQLCODE = -911                                      18272300
182724         WHEN SQLCODE = -913                                      18272400
182725             PERFORM 9900-SOFT-ABORT                              18272500
182726         WHEN SQLWARN0 NOT = SPACE                                18272600
182727         WHEN SQLCODE NOT = ZERO                                  18272700
182728             MOVE WST00010-ATTR-ELEM-NBR TO PV-DISP-TRIP          18272800
182729             MOVE SQLCA                TO DP013-SQLCA             18272900
182730             MOVE '4090-CHECK-TRLR-DIVERT'                        18273000
182731                                       TO DP013-PARAGRAPH         18273100
182732             MOVE '4090-CHECK-TRLR-DIVERT'                        18273200
182733                                   TO DP013-MESSAGE-TEXT (1)      18273300
182734             STRING 'TRIP:'   PV-DISP-TRIP                        18273400
182735                    ' STORE:' ASC-STR-NBR                         18273500
182736                                      DELIMITED BY SIZE           18273600
182737                                 INTO DP013-MESSAGE-TEXT (2)      18273700
182738             MOVE SQLCA            TO DP013-SQLCA                 18273800
182739             MOVE 'WST_INTGRTN_TYP'   TO DP013-DB2-TABLE-NAME (1) 18273900
182740             MOVE 'WST_ATTR_DEFN'     TO DP013-DB2-TABLE-NAME (2) 18274000
182741             MOVE 'WST_ATTR_ELEM'     TO DP013-DB2-TABLE-NAME (3) 18274100
182742             SET DP013-DB2-ABEND   TO TRUE                        18274200
182743             PERFORM DP013-0000-PROCESS-ABEND                     18274300
182744     END-EVALUATE.                                                18274400
182745                                                                  18274500
182746                                                                  18274600
182747*----------------------------------------------------------------*18274700
182748*    SET UP THE HOST VARIABLES.                                  *18274800
182749*----------------------------------------------------------------*18274900
182750                                                                  18275000
182760 4100-PREPARE-CURSOR.                                             18276000
182770                                                                  18277000
182780     MOVE ASC-KEY-TRIP-ID    TO DK-OTBND-TRIP-ID.                 18278000
182790                                                                  18279000
182800                                                                  18280000
182900*----------------------------------------------------------------*18290000
183000*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *18300000
183100*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *18310000
183200*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *18320000
183300*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *18330000
183400*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *18340000
183500*                                                                *18350000
183600*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *18360000
183700*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *18370000
183800*    UPON INITIALIZATION.                                        *18380000
183900*----------------------------------------------------------------*18390000
184000                                                                  18400000
184100 4300-READ-ITEMS-FROM-DB.                                         18410000
184200                                                                  18420000
184300     PERFORM                                                      18430000
184400         VARYING PV-READ-COUNT                                    18440000
184500         FROM 1 BY 1                                              18450000
184600         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    18460000
184700            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         18470000
184800                                                                  18480000
184900         PERFORM 4310-FETCH                                       18490000
185000                                                                  18500000
185100         IF  ASC-ITEMS-LEFT-ON-DB                                 18510000
185200             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                18520000
185300                 ADD +1            TO ASC-ITEM-SUB                18530000
185400             ELSE                                                 18540000
185500                 ADD +1            TO ASC-BLK-SUB                 18550000
185600                 MOVE +1           TO ASC-ITEM-SUB                18560000
185700                                                                  18570000
185800                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         18580000
185900                     MOVE +1       TO ASC-BLK-SUB                 18590000
186000                     SET ASC-BLOCK-MODIFIED (1)                   18600000
186100                                   TO TRUE                        18610000
186200                     PERFORM 5100-WRITE-TEMP-STORAGE              18620000
186300                     MOVE ASC-BLOCK-ENTRIES                       18630000
186400                               (PC-MAX-BLOCKS-IN-ARRAY)           18640000
186500                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 18650000
186600                     ADD +1        TO ASC-BLK-SUB                 18660000
186700                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   18670000
186800                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      18680000
186900                                   TO TRUE                        18690000
187000                 END-IF                                           18700000
187100             END-IF                                               18710000
187200             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    18720000
187300             PERFORM 4300A-MOVE-TO-COMMAREA                       18730000
187400         END-IF                                                   18740000
187500     END-PERFORM.                                                 18750000
187600                                                                  18760000
187700     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          18770000
187800         MOVE +1               TO ASC-BLK-SUB                     18780000
187900         PERFORM 5100-WRITE-TEMP-STORAGE                          18790000
188000         ADD +1                TO ASC-BLK-SUB                     18800000
188100         PERFORM 5100-WRITE-TEMP-STORAGE                          18810000
188200                                                                  18820000
188300         MOVE 1                TO ASC-BLK-SUB                     18830000
188400                                  PV-BLOCK-NUMBER                 18840000
188500         PERFORM 4410-READ-TEMP-STORAGE                           18850000
188600         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             18860000
188700             MOVE 2            TO ASC-BLK-SUB                     18870000
188800                                  PV-BLOCK-NUMBER                 18880000
188900             PERFORM 4410-READ-TEMP-STORAGE                       18890000
189000         END-IF                                                   18900000
189100     END-IF.                                                      18910000
189200/                                                                 18920000
189300 4300A-MOVE-TO-COMMAREA.                                          18930000
189400                                                                  18940000
189500     MOVE ASC-NUMBER-OF-ITEMS-READ TO ASC-LIST-ITEM-NUMBER        18950000
189600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18960000
189700                                                                  18970000
189800     MOVE SUT00120-SCN-TYP-CDE     TO ASC-SCAN-CDE                18980000
189900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18990000
190000     MOVE SUT00120-SCN-TYP-LNG-DES TO ASC-TYPE-DESC               19000000
190100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19010000
190200     MOVE PV-SCAN-TYPE-COUNT       TO ASC-SCAN-CNT                19020000
190300                                       (ASC-BLK-SUB ASC-ITEM-SUB).19030000
190400                                                                  19040000
190500                                                                  19050000
190600*----------------------------------------------------------------*19060000
190700*    FETCH THE MESSAGE CURSOR.                                   *19070000
190800*----------------------------------------------------------------*19080000
190900                                                                  19090000
191000 4310-FETCH.                                                      19100000
191100                                                                  19110000
191200     EXEC SQL                                                     19120000
191300          FETCH TRIP-STR-SCAN-CSR                                 19130000
191400           INTO :SUT00120-SCN-TYP-CDE                             19140000
191500              , :SUT00120-SCN-TYP-LNG-DES                         19150000
191600              , :PV-SCAN-TYPE-COUNT                               19160000
191700     END-EXEC.                                                    19170000
191800*                                                                 19180000
191900     EVALUATE TRUE                                                19190000
192000         WHEN SQLCODE = ZERO                                      19200000
192100         WHEN SQLCODE = +100                                      19210000
192200              CONTINUE                                            19220000
192300         WHEN SQLCODE = -904                                      19230000
192400         WHEN SQLCODE = -911                                      19240000
192500         WHEN SQLCODE = -913                                      19250000
192600             PERFORM 9900-SOFT-ABORT                              19260000
192700         WHEN SQLWARN0 NOT = SPACE                                19270000
192800         WHEN SQLCODE NOT = ZERO                                  19280000
192900             MOVE DK-OTBND-TRIP-ID TO PV-DISP-TRIP                19290000
193000             MOVE '4310-FETCH-CURSOR'                             19300000
193100                                   TO DP013-PARAGRAPH             19310000
193200             MOVE 'FETCH CURSOR'                                  19320000
193300                                   TO DP013-MESSAGE-TEXT (1)      19330000
193400             MOVE PV-DISP-TRIP     TO DP013-MESSAGE-TEXT (2)      19340000
193500             MOVE SQLCA            TO DP013-SQLCA                 19350000
193600             MOVE 'SUT_OTBND_STR_SCN' TO DP013-DB2-TABLE-NAME (1) 19360000
193700             MOVE 'SUT_OTBND_SCN_TYP' TO DP013-DB2-TABLE-NAME (2) 19370000
193800             SET DP013-DB2-ABEND   TO TRUE                        19380000
193900             PERFORM DP013-0000-PROCESS-ABEND                     19390000
194000     END-EVALUATE.                                                19400000
194100                                                                  19410000
194200     IF  SQLCODE EQUAL +100                                       19420000
194300         SET ASC-NO-ITEMS-LEFT-ON-DB                              19430000
194400                                   TO TRUE                        19440000
194500     END-IF.                                                      19450000
194600                                                                  19460000
194700                                                                  19470000
194800*----------------------------------------------------------------*19480000
194900* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *19490000
195000*----------------------------------------------------------------*19500000
195100                                                                  19510000
195200 4400-MOVE-COMMAREA-TO-SCREEN.                                    19520000
195300     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             19530000
195400         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          19540000
195500         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          19550000
195600             MOVE +1    TO ASC-BLK-SUB                            19560000
195700             PERFORM 5100-WRITE-TEMP-STORAGE                      19570000
195800             ADD +1     TO ASC-BLK-SUB                            19580000
195900             PERFORM 5100-WRITE-TEMP-STORAGE                      19590000
196000             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             19600000
196100                 GIVING PV-BLOCK-NUMBER                           19610000
196200                 REMAINDER PV-REMAINDER                           19620000
196300             IF  PV-REMAINDER > ZERO                              19630000
196400                 ADD +1 TO PV-BLOCK-NUMBER                        19640000
196500             END-IF                                               19650000
196600             MOVE +1    TO ASC-BLK-SUB                            19660000
196700             PERFORM 4410-READ-TEMP-STORAGE                       19670000
196800             ADD +1     TO ASC-BLK-SUB                            19680000
196900                           PV-BLOCK-NUMBER                        19690000
197000             PERFORM 4410-READ-TEMP-STORAGE                       19700000
197100     END-IF.                                                      19710000
197200     MOVE +1            TO ASC-BLK-SUB.                           19720000
197300     COMPUTE ASC-ITEM-SUB =                                       19730000
197400         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              19740000
197500         + PC-ITEMS-PER-PANEL).                                   19750000
197600*                                                                 19760000
197700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        19770000
197800         ADD +1         TO ASC-BLK-SUB                            19780000
197900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            19790000
198000     END-IF.                                                      19800000
198100*                                                                 19810000
198200     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           19820000
198300         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                19830000
198400     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        19840000
198500     PERFORM 4420-FORMAT-LIST-LINES                               19850000
198600         VARYING PV-SUB                                           19860000
198700         FROM PC-ITEMS-PER-PANEL BY -1                            19870000
198800         UNTIL PV-SUB < +1.                                       19880000
198900*                                                                 19890000
199000     COMPUTE ASC-ITEMS-DISPLAYED =                                19900000
199100         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          19910000
199200     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    19920000
199300                                      ASTRTITO.                   19930000
199400     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    19940000
199500     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    19950000
199600     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            19960000
199700                                   TO ASELITO.                    19970000
199800*                                                                 19980000
199900     IF  DP020-MSG-NUMBER-X = SPACE                               19990000
200000         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  20000000
200100*            --- MORE ITEMS TO DISPLAY ----                       20010000
200200             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            20020000
200300             SET DP020-MSG-INFORMATIONAL TO TRUE                  20030000
200400         END-IF                                                   20040000
200500     END-IF.                                                      20050000
200600                                                                  20060000
200700     MOVE ASC-STR-NBR                 TO ASTRO.                   20070000
200800     MOVE ASC-STORE-NAME              TO ANAMEO.                  20080000
200900     MOVE ASC-CARTON-CNT              TO ACRTCNTO.                20090000
201000     MOVE ASC-KEY-SCAC                TO ASCACO.                  20100000
201100     MOVE ASC-KEY-TRLR                TO ATRLRO.                  20110000
201200     MOVE ASC-KEY-TRIP-ID             TO ATRIPO.                  20120000
201300     MOVE ASC-UNIT-CNT                TO AUNTCNTO.                20130000
201400     MOVE ASC-KEY-SRL                 TO ASRLNBRO.                20140000
201410     MOVE ASC-TRLR-STATUS             TO ASTATO.                  20141013
201500     MOVE ASC-TOTAL-SCAN              TO ASCNCNTO.                20150000
201600     MOVE ASC-SO-DATE                 TO AOPENDTO.                20160000
201700     MOVE ASC-SO-TIME                 TO AOPENTMO.                20170000
201800     MOVE ASC-SO-NAME                 TO AOPENNMO.                20180000
201900     MOVE ASC-MFST-NO-SCN             TO ANOTCNTO.                20190000
202000     MOVE ASC-SU-DATE                 TO AUNLDDTO.                20200000
202100     MOVE ASC-SU-TIME                 TO AUNLDTMO.                20210000
202200     MOVE ASC-SU-NAME                 TO AUNLDNMO.                20220000
202300                                                                  20230000
202400     IF  ASC-STR-DVRT   > 0                                       20240000
202500         STRING '*** TRAILER DIVERTED TO STORE '                  20250000
202600                ASC-STR-DVRT                                      20260000
202700                ' ***'                   DELIMITED BY SIZE        20270000
202800                                    INTO ATRDVRTO                 20280000
202900         MOVE DP015-YELLOW            TO ATRDVRTC                 20290000
203000     ELSE                                                         20300000
203100         MOVE SPACES                  TO ATRDVRTO                 20310000
203200         MOVE DP015-GREEN             TO ATRDVRTC                 20320000
203300     END-IF.                                                      20330000
203400                                                                  20340000
203500                                                                  20350000
203600*----------------------------------------------------------------*20360000
203700*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *20370000
203800*----------------------------------------------------------------*20380000
203900                                                                  20390000
204000 4410-READ-TEMP-STORAGE.                                          20400000
204100                                                                  20410000
204200     EXEC CICS                                                    20420000
204300         READQ TS                                                 20430000
204400             QUEUE (ASC-LIST-QUEUE-NAME)                          20440000
204500             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20450000
204600             ITEM  (PV-BLOCK-NUMBER)                              20460000
204700             RESP  (PV-CICS-RESP)                                 20470000
204800     END-EXEC.                                                    20480000
204900                                                                  20490000
205000     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       20500000
205100       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     20510000
205200         CONTINUE                                                 20520000
205300     ELSE                                                         20530000
205400         SET DP013-CICS-ABEND     TO TRUE                         20540000
205500         SET DP013-NO-ROLLBACK    TO TRUE                         20550000
205600         MOVE '4410-READ-TEMP-STORAGE'                            20560000
205700                                  TO DP013-PARAGRAPH              20570000
205800         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      20580000
205900                                  TO DP013-MESSAGE-TEXT(1)        20590000
206000         PERFORM DP013-0000-PROCESS-ABEND                         20600000
206100     END-IF.                                                      20610000
206200                                                                  20620000
206300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             20630000
206400*                                                                 20640000
206500     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         20650000
206600         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               20660000
206700     END-IF.                                                      20670000
206800                                                                  20680000
206900                                                                  20690000
207000*----------------------------------------------------------------*20700000
207100*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *20710000
207200*----------------------------------------------------------------*20720000
207300                                                                  20730000
207400 4420-FORMAT-LIST-LINES.                                          20740000
207500     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      20750000
207600         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                20760000
207700         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           20770000
207800                                    MR-SCAN-DESCR-A (PV-SUB)      20780000
207900                                    MR-SCAN-CNT-A (PV-SUB)        20790000
208000         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           20800000
208100         MOVE SPACE              TO MR-SELECTI (PV-SUB)           20810000
208200                                    MR-ACTION (PV-SUB)            20820000
208210                                    MR-SCAN-CODE (PV-SUB)         20821009
208220                                    MR-SCAN-DESCR (PV-SUB)        20822009
208300     ELSE                                                         20830000
208400         PERFORM 4420A-FILL-SCREEN                                20840000
208500*                                                                 20850000
208600         IF  DP030-SET-CURSOR-TRAILER                             20860000
208700             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)20870000
208800                 > SPACE)                                         20880000
208900               OR (PV-SUB = 1))                                   20890000
209000                SET DP030-SET-CURSOR-APPL-1 TO TRUE               20900000
209100                MOVE -1          TO MR-SELECTL (PV-SUB)           20910000
209200             END-IF                                               20920000
209300         END-IF                                                   20930000
209400*                                                                 20940000
209500         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           20950000
209600             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           20960000
209700                                 TO MR-ACTION (PV-SUB)            20970000
209800         END-IF                                                   20980000
209900     END-IF.                                                      20990000
210000     SUBTRACT +1 FROM ASC-ITEM-SUB                                21000000
210100     IF  ASC-ITEM-SUB < + 1                                       21010000
210200         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  21020000
210300         MOVE +1                 TO ASC-BLK-SUB                   21030000
210400     END-IF.                                                      21040000
210500                                                                  21050000
210600                                                                  21060000
210700 4420A-FILL-SCREEN.                                               21070000
210800     IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)          21080000
210900                                                   > SPACE        21090000
211000         MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     21100000
211100                                 TO MR-SELECTI (PV-SUB)           21110000
211200     ELSE                                                         21120000
211300         MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)          21130000
211400                                 TO MR-SELECTI (PV-SUB)           21140000
211500     END-IF.                                                      21150000
211600                                                                  21160000
211700                                                                  21170000
211800     MOVE ASC-SCAN-CDE(ASC-BLK-SUB ASC-ITEM-SUB)                  21180008
211900                                 TO MR-SCAN-CODE (PV-SUB).        21190008
211910     MOVE ASC-TYPE-DESC(ASC-BLK-SUB ASC-ITEM-SUB)                 21191008
211920                                 TO MR-SCAN-DESCR (PV-SUB).       21192008
212000     MOVE ASC-SCAN-CNT (ASC-BLK-SUB ASC-ITEM-SUB)                 21200000
212100                                 TO MR-SCAN-CNT  (PV-SUB).        21210000
212200                                                                  21220000
212300                                                                  21230000
212400******************************************************************21240000
212500** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **21250000
212600** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **21260000
212700** ISSUE A WARNING.                                             **21270000
212800******************************************************************21280000
212900 4430-CHECK-FOR-BEGIN-AND-END.                                    21290000
213000     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       21300000
213100         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     21310000
213200*            -- NO END-OF-RANGE SPECFIED ---                      21320000
213300             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            21330000
213400             SET DP020-MSG-WARNING TO TRUE                        21340000
213500             PERFORM 4431-POSITION-AT-WARNING                     21350000
213600         END-IF                                                   21360000
213700     ELSE                                                         21370000
213800         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     21380000
213900*            -- NO BEGINNING-OF-RANGE SPECFIED ---                21390000
214000             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            21400000
214100             SET DP020-MSG-WARNING TO TRUE                        21410000
214200             PERFORM 4431-POSITION-AT-WARNING                     21420000
214300         END-IF                                                   21430000
214400     END-IF.                                                      21440000
214500                                                                  21450000
214600                                                                  21460000
214700******************************************************************21470000
214800** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **21480000
214900** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **21490000
215000** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **21500000
215100** POSITION THE CURSOR THERE.                                   **21510000
215200******************************************************************21520000
215300 4431-POSITION-AT-WARNING.                                        21530000
215400     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 21540000
215500                    - PV-TOP-ITEM + 1.                            21550000
215600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      21560000
215700         CONTINUE                                                 21570000
215800     ELSE                                                         21580000
215900         SET DP030-SET-CURSOR-APPL-1                              21590000
216000                                   TO TRUE                        21600000
216100         MOVE -1                   TO MR-SELECTL (PV-SUB)         21610000
216200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         21620000
216300         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         21630000
216400     END-IF.                                                      21640000
216500*                                                                 21650000
216600     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   21660000
216700                    - PV-TOP-ITEM + 1.                            21670000
216800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      21680000
216900         CONTINUE                                                 21690000
217000     ELSE                                                         21700000
217100         SET DP030-SET-CURSOR-APPL-1                              21710000
217200                                   TO TRUE                        21720000
217300         MOVE -1                   TO MR-SELECTL (PV-SUB)         21730000
217400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         21740000
217500         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         21750000
217600     END-IF.                                                      21760000
217700                                                                  21770000
217800                                                                  21780000
217900*----------------------------------------------------------------*21790000
218000* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *21800000
218100* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *21810000
218200* FOR THE SELECTED ITEMS QUEUE.                                  *21820000
218300*                                                                *21830000
218400* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *21840000
218500* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *21850000
218600* THE ARRAY IS FULL.                                             *21860000
218700*----------------------------------------------------------------*21870000
218800                                                                  21880000
218900 5000-PREPARE-SEL-QUEUE.                                          21890000
219000                                                                  21900000
219100     MOVE +1                   TO  ASC-BLK-SUB.                   21910000
219200     PERFORM 5100-WRITE-TEMP-STORAGE.                             21920000
219300     ADD +1                    TO  ASC-BLK-SUB.                   21930000
219400     PERFORM 5100-WRITE-TEMP-STORAGE.                             21940000
219500                                                                  21950000
219600     MOVE ASC-SEL-QUEUE-NAME-OUT TO  SU009-SEL-QUEUE-NAME.        21960000
219700     PERFORM 6010-DELETE-SEL-QUEUE.                               21970000
219800                                                                  21980000
219900     SET ASC-UPDATE-TSQ        TO  TRUE.                          21990000
220000                                                                  22000000
220100     SET SU010-IDX             TO  1.                             22010000
220200     MOVE ZERO                 TO SU009-NUMBER-OF-TS-ITEMS.       22020000
220300     INITIALIZE SU010-SELECTED-ITEM-ARRAY.                        22030000
220400                                                                  22040000
220500     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           22050000
220600             VARYING PV-ITEM                                      22060000
220700             FROM 1 BY 1                                          22070000
220800             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     22080000
220900                                                                  22090000
221000     IF  SU010-IDX > 1                                            22100000
221100         PERFORM 5205-WRITE-SEL-QUEUE                             22110000
221200         ADD +1                TO SU009-NUMBER-OF-TS-ITEMS        22120000
221300     END-IF.                                                      22130000
221400                                                                  22140000
221500                                                                  22150000
221600*----------------------------------------------------------------*22160000
221700*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *22170000
221800*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *22180000
221900*----------------------------------------------------------------*22190000
222000                                                                  22200000
222100 5100-WRITE-TEMP-STORAGE.                                         22210000
222200     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     22220000
222300                                   TO PV-LIST-ITEM-NUMBER.        22230000
222400     COMPUTE PV-BLOCK-NUMBER =                                    22240000
222500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    22250000
222600                                                                  22260000
222700     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             22270000
222800     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             22280000
222900         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      22290000
223000             PERFORM 5105-REWRITE-ASC-LISTQ                       22300000
223100         END-IF                                                   22310000
223200     ELSE                                                         22320000
223300         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       22330000
223400         ASC-HIGHEST-BLOCK-WRITTEN + 1                            22340000
223500         PERFORM 5110-WRITE-ASC-LISTQ                             22350000
223600         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   22360000
223700     END-IF.                                                      22370000
223800                                                                  22380000
223900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             22390000
224000******************************************************************22400000
224100** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **22410000
224200** SPECIFIC COMMAREA.                                           **22420000
224300******************************************************************22430000
224400 5105-REWRITE-ASC-LISTQ.                                          22440000
224500     EXEC CICS                                                    22450000
224600         WRITEQ TS                                                22460000
224700             QUEUE (ASC-LIST-QUEUE-NAME)                          22470000
224800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22480000
224900             ITEM  (PV-BLOCK-NUMBER)                              22490000
225000             REWRITE                                              22500000
225100             RESP  (PV-CICS-RESP)                                 22510000
225200     END-EXEC.                                                    22520000
225300                                                                  22530000
225400     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           22540000
225500         CONTINUE                                                 22550000
225600     ELSE                                                         22560000
225700         SET DP013-CICS-ABEND            TO TRUE                  22570000
225800         SET DP013-NO-ROLLBACK           TO TRUE                  22580000
225900         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       22590000
226000         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     22600000
226100                                         TO DP013-MESSAGE-TEXT(1) 22610000
226200         PERFORM DP013-0000-PROCESS-ABEND                         22620000
226300     END-IF.                                                      22630000
226400                                                                  22640000
226500                                                                  22650000
226600******************************************************************22660000
226700** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **22670000
226800** SPECIFIC COMMAREA.                                           **22680000
226900******************************************************************22690000
227000 5110-WRITE-ASC-LISTQ.                                            22700000
227100     EXEC CICS                                                    22710000
227200         WRITEQ TS                                                22720000
227300             QUEUE (ASC-LIST-QUEUE-NAME)                          22730000
227400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22740000
227500             ITEM  (PV-BLOCK-NUMBER)                              22750000
227600             RESP  (PV-CICS-RESP)                                 22760000
227700     END-EXEC.                                                    22770000
227800     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      22780000
227900         SET DP013-CICS-ABEND      TO TRUE                        22790000
228000         SET DP013-NO-ROLLBACK     TO TRUE                        22800000
228100         MOVE '5110-WRITE-ASC-LISTQ'                              22810000
228200                                   TO DP013-PARAGRAPH             22820000
228300         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           22830000
228400                                   TO DP013-MESSAGE-TEXT(1)       22840000
228500         PERFORM DP013-0000-PROCESS-ABEND                         22850000
228600     END-IF.                                                      22860000
228700                                                                  22870000
228800                                                                  22880000
228900*----------------------------------------------------------------*22890000
229000* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *22900000
229100* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *22910000
229200*                                                                *22920000
229300* PROGRAM WAS INITIALLY WRITTEN TO NOT GO ANYHERE SO FILLING     *22930000
229400* THE RECORDS IS BLANK                                           *22940000
229500* FOR FUTURE NAVIGATION - THIS WILL NEED TO BE UPDATED           *22950000
229600*----------------------------------------------------------------*22960000
229700                                                                  22970000
229800 5200-FILL-SEL-QUEUE-RECORD.                                      22980000
229900                                                                  22990000
230000                                                                  23000000
230100     PERFORM 6112-READ-LIST-QUEUE.                                23010000
230200                                                                  23020000
230300     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       23030000
230400         PERFORM                                                  23040000
230500         VARYING LQW-IDX                                          23050000
230600         FROM 1 BY 1                                              23060000
230700         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            23070000
230800           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          23080000
230900                                                                  23090000
231000             IF  LQW-SELECT (LQW-IDX)                             23100000
231100                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              23110000
231200                                   TO SU010-ITEM (SU010-IDX)      23120000
231300                 MOVE SPACE        TO SU010-ACTION-SW (SU010-IDX) 23130000
231400                 MOVE ASC-KEY-TRIP-ID TO SU010-TRIP-ID            23140000
231500                                         (SU010-IDX)              23150000
231600                 MOVE ASC-KEY-SCAC    TO SU010-SCAC (SU010-IDX)   23160000
231700                 MOVE ASC-KEY-TRLR    TO SU010-TRLR-ID(SU010-IDX) 23170000
231800                 MOVE ASC-KEY-SRL     TO SU010-TRLR-SRL-NBR       23180000
231900                                         (SU010-IDX)              23190000
232000                                                                  23200000
232100                 SET SU010-IDX UP BY 1                            23210000
232200                 IF  SU010-IDX > SU010-MAX-ITEMS                  23220000
232300                     PERFORM 5205-WRITE-SEL-QUEUE                 23230000
232400                     ADD +1        TO SU009-NUMBER-OF-TS-ITEMS    23240000
232500                     INITIALIZE SU010-SELECTED-ITEM-ARRAY         23250000
232600                     SET SU010-IDX TO  1                          23260000
232700                 END-IF                                           23270000
232800             END-IF                                               23280000
232900         END-PERFORM                                              23290000
233000     END-IF.                                                      23300000
233100                                                                  23310000
233200                                                                  23320000
233300*----------------------------------------------------------------*23330000
233400*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *23340000
233500*----------------------------------------------------------------*23350000
233600                                                                  23360000
233700 5205-WRITE-SEL-QUEUE.                                            23370000
233800                                                                  23380000
233900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            23390000
234000                                   TO SU010-SELECTED-ITEMS.       23400000
234100                                                                  23410000
234200     EXEC CICS                                                    23420000
234300          WRITEQ TS                                               23430000
234400              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      23440000
234500              FROM  (SU010-SELECT-RECORD)                         23450000
234600              ITEM  (PV-SEL-QUEUE-ITEM)                           23460000
234700              RESP  (PV-CICS-RESP)                                23470000
234800     END-EXEC.                                                    23480000
234900                                                                  23490000
235000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23500000
235100         CONTINUE                                                 23510000
235200     ELSE                                                         23520000
235300         SET DP013-CICS-ABEND      TO TRUE                        23530000
235400         SET DP013-NO-ROLLBACK     TO TRUE                        23540000
235500         MOVE '5205-WRITE-SEL-QUEUE'                              23550000
235600                                   TO DP013-PARAGRAPH             23560000
235700         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          23570000
235800                                   TO DP013-MESSAGE-TEXT(1)       23580000
235900         PERFORM DP013-0000-PROCESS-ABEND                         23590000
236000     END-IF.                                                      23600000
236100                                                                  23610000
236200                                                                  23620000
236300******************************************************************23630000
236400** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **23640000
236500** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **23650000
236600** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **23660000
236700** THE USER.                                                    **23670000
236800******************************************************************23680000
236900 6000-REFRESH-PANEL-FROM-TEMP.                                    23690000
237000     IF  ASC-UPDATE-TSQ                                           23700000
237100         SET ASC-NO-TSQ-UPDATE TO TRUE                            23710000
237200         MOVE ZERO                 TO PV-SAVE-ITEM                23720000
237300                                      PV-SEL-QUEUE-ITEM           23730000
237400         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        23740000
237500                                   TO PV-HOLD-SELECTED-ITEMS      23750000
237600         MOVE +1                   TO PV-ITEMS-PROCESSED          23760000
237700         PERFORM 6100-UPDATE-TSQ                                  23770000
237800             UNTIL PV-ITEMS-PROCESSED >                           23780000
237900                                     PV-HOLD-SELECTED-ITEMS       23790000
238000         PERFORM 6010-DELETE-SEL-QUEUE                            23800000
238100         INITIALIZE ASC-BLOCK-ENTRIES (1)                         23810000
238200                    ASC-BLOCK-ENTRIES (2)                         23820000
238300     END-IF.                                                      23830000
238400                                                                  23840000
238500                                                                  23850000
238600*----------------------------------------------------------------*23860000
238700*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *23870000
238800*----------------------------------------------------------------*23880000
238900 6010-DELETE-SEL-QUEUE.                                           23890000
239000                                                                  23900000
239100     EXEC CICS                                                    23910000
239200         DELETEQ TS                                               23920000
239300             QUEUE (ASC-SEL-QUEUE-NAME-OUT)                       23930000
239400             RESP  (PV-CICS-RESP)                                 23940000
239500     END-EXEC.                                                    23950000
239600*                                                                 23960000
239700     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      23970000
239800        (PV-CICS-RESP = DFHRESP(QIDERR)))                         23980000
239900         CONTINUE                                                 23990000
240000     ELSE                                                         24000000
240100         SET DP013-CICS-ABEND TO TRUE                             24010000
240200         SET DP013-NO-ROLLBACK TO TRUE                            24020000
240300         MOVE '6010-DELETE-SEL-QUEUE'                             24030000
240400                        TO DP013-PARAGRAPH                        24040000
240500         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         24050000
240600                        TO DP013-MESSAGE-TEXT (1)                 24060000
240700         PERFORM DP013-0000-PROCESS-ABEND                         24070000
240800     END-IF.                                                      24080000
240900                                                                  24090000
241000                                                                  24100000
241100*----------------------------------------------------------------*24110000
241200*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *24120000
241300*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *24130000
241400*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *24140000
241500*    THE TEMP QUEUE.                                             *24150000
241600*----------------------------------------------------------------*24160000
241700                                                                  24170000
241800 6100-UPDATE-TSQ.                                                 24180000
241900                                                                  24190000
242000     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             24200000
242100     PERFORM 6105-READ-SEL-QUEUE.                                 24210000
242200     PERFORM                                                      24220000
242300         VARYING SU010-IDX                                        24230000
242400         FROM 1 BY 1                                              24240000
242500         UNTIL ((PV-ITEMS-PROCESSED >                             24250000
242600                              PV-HOLD-SELECTED-ITEMS)             24260000
242700         OR (SU010-IDX GREATER THAN SU010-MAX-ITEMS))             24270000
242800         IF  SU010-ACTION-SW (SU010-IDX) > SPACE                  24280000
242900             PERFORM 6110-PROCESS-ITEMS                           24290000
243000         END-IF                                                   24300000
243100         ADD +1                TO PV-ITEMS-PROCESSED              24310000
243200     END-PERFORM.                                                 24320000
243300     PERFORM 6111-WRITE-LIST-QUEUE.                               24330000
243400                                                                  24340000
243500                                                                  24350000
243600*----------------------------------------------------------------*24360000
243700*    READ THE LIST QUEUE RECORD.                                 *24370000
243800*----------------------------------------------------------------*24380000
243900                                                                  24390000
244000 6105-READ-SEL-QUEUE.                                             24400000
244100                                                                  24410000
244200     EXEC CICS                                                    24420000
244300          READQ TS                                                24430000
244400              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      24440000
244500              INTO  (SU010-SELECT-RECORD)                         24450000
244600              ITEM  (PV-SEL-QUEUE-ITEM)                           24460000
244700              RESP  (PV-CICS-RESP)                                24470000
244800     END-EXEC.                                                    24480000
244900*                                                                 24490000
245000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24500000
245100         CONTINUE                                                 24510000
245200     ELSE                                                         24520000
245300         SET DP013-CICS-ABEND      TO  TRUE                       24530000
245400         SET DP013-NO-ROLLBACK     TO  TRUE                       24540000
245500         MOVE '6105-READ-SEL-QUEUE'                               24550000
245600                                   TO  DP013-PARAGRAPH            24560000
245700         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           24570000
245800                                   TO  DP013-MESSAGE-TEXT(1)      24580000
245900         PERFORM DP013-0000-PROCESS-ABEND                         24590000
246000     END-IF.                                                      24600000
246100                                                                  24610000
246200                                                                  24620000
246300*----------------------------------------------------------------*24630000
246400*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*24640000
246500*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*24650000
246600*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *24660000
246700*----------------------------------------------------------------*24670000
246800                                                                  24680000
246900 6110-PROCESS-ITEMS.                                              24690000
247000                                                                  24700000
247100     COMPUTE PV-ITEM = 1 + ((SU010-ITEM (SU010-IDX) - 1)          24710000
247200                     / PC-ITEMS-PER-PANEL).                       24720000
247300                                                                  24730000
247400     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           24740000
247500         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          24750000
247600             PERFORM 6111-WRITE-LIST-QUEUE                        24760000
247700         END-IF                                                   24770000
247800         MOVE PV-ITEM          TO PV-SAVE-ITEM                    24780000
247900                                                                  24790000
248000         PERFORM 6112-READ-LIST-QUEUE                             24800000
248100         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               24810000
248200             CONTINUE                                             24820000
248300         END-IF                                                   24830000
248400     END-IF.                                                      24840000
248500                                                                  24850000
248600     COMPUTE PV-SUB = (SU010-ITEM (SU010-IDX)                     24860000
248700                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              24870000
248800     SET LQW-DESELECT (PV-SUB) TO    TRUE                         24880000
248900     MOVE LQW-SELECTED-SW (PV-SUB)                                24890000
249000                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  24900000
249100     EVALUATE TRUE                                                24910000
249200         WHEN SU010-INQ (SU010-IDX)                               24920000
249300              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             24930000
249400                                                                  24940000
249500         WHEN SU010-UPD (SU010-IDX)                               24950000
249600              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             24960000
249700                                                                  24970000
249800         WHEN SU010-DEL (SU010-IDX)                               24980000
249900              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             24990000
250000                                                                  25000000
250100         WHEN SU010-ERR (SU010-IDX)                               25010000
250200              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             25020000
250300     END-EVALUATE.                                                25030000
250400                                                                  25040000
250500     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                25050000
250600                                                                  25060000
250700                                                                  25070000
250800*----------------------------------------------------------------*25080000
250900*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *25090000
251000*----------------------------------------------------------------*25100000
251100                                                                  25110000
251200 6111-WRITE-LIST-QUEUE.                                           25120000
251300                                                                  25130000
251400     EXEC CICS                                                    25140000
251500         WRITEQ TS                                                25150000
251600             QUEUE (ASC-LIST-QUEUE-NAME)                          25160000
251700             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     25170000
251800             ITEM  (PV-SAVE-ITEM)                                 25180000
251900             REWRITE                                              25190000
252000             RESP  (PV-CICS-RESP)                                 25200000
252100     END-EXEC.                                                    25210000
252200*                                                                 25220000
252300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25230000
252400         CONTINUE                                                 25240000
252500     ELSE                                                         25250000
252600         SET DP013-CICS-ABEND  TO  TRUE                           25260000
252700         SET DP013-NO-ROLLBACK TO  TRUE                           25270000
252800         MOVE '6111-WRITE-LIST-QUEUE'                             25280000
252900                               TO  DP013-PARAGRAPH                25290000
253000         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  25300000
253100                               TO  DP013-MESSAGE-TEXT(1)          25310000
253200         PERFORM DP013-0000-PROCESS-ABEND                         25320000
253300     END-IF.                                                      25330000
253400                                                                  25340000
253500                                                                  25350000
253600*----------------------------------------------------------------*25360000
253700*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*25370000
253800*----------------------------------------------------------------*25380000
253900                                                                  25390000
254000 6112-READ-LIST-QUEUE.                                            25400000
254100                                                                  25410000
254200     EXEC CICS                                                    25420000
254300         READQ TS                                                 25430000
254400             QUEUE (ASC-LIST-QUEUE-NAME)                          25440000
254500             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     25450000
254600             ITEM  (PV-ITEM)                                      25460000
254700             RESP  (PV-CICS-RESP)                                 25470000
254800     END-EXEC.                                                    25480000
254900*                                                                 25490000
255000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25500000
255100         CONTINUE                                                 25510000
255200     ELSE                                                         25520000
255300         SET DP013-CICS-ABEND        TO TRUE                      25530000
255400         SET DP013-NO-ROLLBACK       TO TRUE                      25540000
255500         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           25550000
255600         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    25560000
255700                                     TO DP013-MESSAGE-TEXT(1)     25570000
255800         PERFORM DP013-0000-PROCESS-ABEND                         25580000
255900     END-IF.                                                      25590000
256000                                                                  25600000
256100                                                                  25610000
256200 9100-READ-SEL-QUEUE.                                             25620000
256300     EXEC CICS                                                    25630000
256400         READQ TS                                                 25640000
256500             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        25650000
256600             INTO  (SU010-SELECT-RECORD)                          25660000
256700             ITEM  (ASC-SEL-ITEM)                                 25670000
256800             RESP  (PV-CICS-RESP)                                 25680000
256900     END-EXEC.                                                    25690000
257000                                                                  25700000
257100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       25710000
257200         CONTINUE                                                 25720000
257300     ELSE                                                         25730000
257400         SET DP013-LOGIC-ABEND                                    25740000
257500             DP013-NO-ROLLBACK     TO TRUE                        25750000
257600         MOVE '9100-READ-SEL-QUEUE'                               25760000
257700                                   TO DP013-PARAGRAPH             25770000
257800         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   25780000
257900                                   TO DP013-MESSAGE-TEXT (1)      25790000
258000         PERFORM DP013-0000-PROCESS-ABEND                         25800000
258100     END-IF.                                                      25810000
258200                                                                  25820000
258300                                                                  25830000
258400*-----------------------------------------------------------      25840000
258500* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.        25850000
258600*-----------------------------------------------------------      25860000
258700 9200-REWRITE-LIST-QUEUE.                                         25870000
258800           EXEC CICS                                              25880000
258900                WRITEQ TS                                         25890000
259000                    QUEUE  (ASC-SEL-QUEUE-NAME-IN)                25900000
259100                    FROM   (SU010-SELECT-RECORD)                  25910000
259200                    ITEM   (ASC-SEL-ITEM)                         25920000
259300                    RESP   (PV-CICS-RESP)                         25930000
259400                    REWRITE                                       25940000
259500           END-EXEC.                                              25950000
259600                                                                  25960000
259700     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   25970000
259800         SET DP013-CICS-ABEND                                     25980000
259900             DP013-NO-ROLLBACK     TO TRUE                        25990000
260000         MOVE '9200-REWRITE-LIST-QUEUE'                           26000000
260100                                         TO DP013-PARAGRAPH       26010000
260200         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   26020000
260300                                         TO DP013-MESSAGE-TEXT (1)26030000
260400         PERFORM DP013-0000-PROCESS-ABEND                         26040000
260500     END-IF.                                                      26050000
260600                                                                  26060000
260700                                                                  26070000
260800 9900-SOFT-ABORT.                                                 26080000
260900     SET PS-ERROR         TO TRUE.                                26090000
261000     SET DP020-MSG-FATAL  TO TRUE.                                26100000
261100     MOVE 'THROUGH SOFT-ABORT PARA'                               26110000
261200                            TO DP013-MESSAGE-TEXT (1)             26120000
261300     MOVE PC-TSYMSG-00551 TO DP020-MSG-NUMBER.                    26130000
261400                                                                  26140000
261500     MOVE 'PROGRAM EXIT CALL' TO DP013-MESSAGE-TEXT (1).          26150000
261600     PERFORM 0001-CALL-CICS-ARCH-API.                             26160000
261700                                                                  26170000
261800                                                                  26180000
261900*----------------------------------------------------------------*26190000
262000*    ABEND PROCESSOR MODULE                                      *26200000
262100*----------------------------------------------------------------*26210000
262200                                                                  26220000
262300     COPY DPPD013.                                                26230000
