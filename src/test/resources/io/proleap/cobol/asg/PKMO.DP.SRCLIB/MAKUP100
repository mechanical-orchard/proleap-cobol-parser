      *************************                                                 
       IDENTIFICATION DIVISION.                                                 
      *************************                                                 
       PROGRAM-ID.      MAKUP100.                                               
       AUTHOR.          MEP/FPS.                                                
       INSTALLATION.    KOHLS DEPARTMENT STORES.                                
       DATE-WRITTEN.    09/20/99.                                               
       DATE-COMPILED.                                                           
      ****************************************************************          
      * THIS IS A TITMCLT REPAIR PROGRAM. IT WILL GO THROUGH ALL     *          
      * TITMCLT "SKU" RECORDS, AND EXPIRE THE TITMCLT AND ITS        *          
      * PARENT RELATIONSHIPS IF THERE'S NO CORRESPONDING RECORD IN   *          
      * TSK.                                                         *          
      * IF THERE *IS* A CORRESPONDING RECORD IN TSK, USE IT TO       *          
      * VERIFY & CORRECT THE CORRESPONDING TMDSEIT RECORD.  (IF NO   *          
      * TMDSEIT RECORD EXISTS, USE DATA FROM TSK TO CREATE TMDSEIT.  *          
      * THEN SEE IF THE TITMCLT BELONGS TO THE CORRECT GROUP.  IF    *          
      * NOT, REPAIR THE GROUP RELATIONSHIPS.  IF THE GROUP NEEDS TO  *          
      * BE BRIDGED, DO SO.                                                      
      ****************************************************************          
      ****************************************************************          
      *                                                                         
       ENVIRONMENT DIVISION.                                                    
      *                                                                         
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
      *                                                                         
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
      ***************                                                           
       DATA DIVISION.                                                           
      ***************                                                           
      *                                                                         
       FILE SECTION.                                                            
                                                                                
      *                                                                         
       WORKING-STORAGE SECTION.                                                 
      *                                                                         
      ***************************************************************           
       01 FILLER                          PIC X(08)  VALUE 'BEGIN WS'.          
      ***************************************************************           
       01  PV-ABEND-CODE                    PIC S9(04)     VALUE +0             
                                                           COMP SYNC.           
       01  PV-PROGRAM-VARIABLES.                                                
           05  PV-ABEND-PARAGRAPH         PIC X(30)      VALUE SPACES.          
           05  PV-FETCH-COUNT             PIC S9(04)     COMP                   
                                                         VALUE ZERO.            
           05  FIXES-SINCE-LAST-COMMIT    PIC S9(04)     COMP                   
                                                         VALUE ZERO.            
           05  FETCHES-SINCE-LAST-COMMIT  PIC S9(04)     COMP                   
                                                         VALUE ZERO.            
           05  CONVERT-STAT-CHNG-DTE      PIC S9(8)     DISPLAY.                
           05  FILLER REDEFINES CONVERT-STAT-CHNG-DTE.                          
               10  STRING-STAT-CHNG-DTE      PIC X(8).                          
           05  PV-GRP-CHLD-CLUSTR-ID       PIC S9(09)     COMP-3                
                                                         VALUE ZERO.            
           05  PV-STAT-CHNGD-DATE         PIC X(07)      VALUE SPACES.          
           05  PV-JULIAN-DATE.                                                  
               10 PV-JULIAN-YEAR          PIC  9(02)     VALUE ZERO.            
               10 PV-JULIAN-DAY           PIC  9(03)     VALUE ZERO.            
           05  PV-WORK-JULIAN-DATE        PIC  9(05)     VALUE ZERO.            
           05  PC-NEG-1                   PIC S9(04)     COMP SYNC              
                                                         VALUE -1.              
           05  PC-Q                         PIC X(01)    VALUE ''''.            
           05  PC-DQ                        PIC X(01)    VALUE '"'.             
           05  PC-QUESTION                  PIC X(01)    VALUE '?'.             
           05  PC-UNDERSCORE                PIC X(01)    VALUE '_'.             
           05  PC-ASTERISK                  PIC X(01)    VALUE '*'.             
           05  PC-PGMNAME                   PIC X(08)    VALUE                  
                                                         'MAKUP100'.            
           05  PV-CENTURY                  PIC X(02).                           
           05  PV-SETUP-DATE-10            PIC X(10).                           
           05  PV-SETUP-DATE-7             PIC 9(07) DISPLAY.                   
           05  PV-ITEM-EXPIRED          PIC 9(06) COMP   VALUE ZEROS.           
           05  PV-MDSEIT-UPDATED        PIC 9(06) COMP   VALUE ZEROS.           
           05  PV-MDSEIT-INSERTED       PIC 9(06) COMP   VALUE ZEROS.           
           05  PV-GROUP-REL-EXPIRED     PIC 9(06) COMP   VALUE ZEROS.           
           05  PV-GROUP-REL-INSERTED    PIC 9(06) COMP   VALUE ZEROS.           
           05  PV-GROUP-INSERTED        PIC 9(05) COMP   VALUE ZEROS.           
           05  PV-ITEMS-FETCHED         PIC 9(09) COMP   VALUE ZEROES.          
           05  PV-DISPLAY-NUMBER        PIC 9(06) DISPLAY VALUE ZEROS.          
           05  PV-ITMCLT-CLUSTR-DESC       PIC X(40) VALUE SPACES.              
                                                                                
       01  CURSOR-CONTROL-INFO.                                                 
           05 LIKE-DEPT-NUM                PIC 999.                             
           05 LIKE-CLASS-NUM               PIC 99.                              
                                                                                
FPS    01  WS-DEPT-DATA.                                                        
FPS        05  WS-INPUT-DATA-DEPT                        VALUE SPACES.          
FPS            10  WS-INPDD-DPT             PIC X(3).                           
FPS            10  WS-INPDD-HYP3            PIC X(1).                           
FPS            10  WS-INPDD-SCL             PIC X(2).                           
FPS        05 WS-FIX-GRP-SW.                                                    
FPS            10  FILLER                   PIC X(1)     VALUE SPACES.          
FPS            10  WS-FIX-GROUP             PIC X(1).                           
                                                                                
       01  CC-CONTROL-CARD.                                                     
           05  CC-PGMNAME                   PIC X(08)    VALUE SPACES.          
           05  FILLER                       PIC X(1)     VALUE SPACE.           
           05  CC-INPUT-DATA-DATE                        VALUE SPACES.          
               10  CC-INPDD-YYYY            PIC X(4).                           
               10  CC-INPDD-HYP1            PIC X(1).                           
               10  CC-INPDD-MM              PIC X(2).                           
               10  CC-INPDD-HYP2            PIC X(1).                           
               10  CC-INPDD-DD              PIC X(2).                           
           05  FILLER                       PIC X(1)     VALUE SPACES.          
           05  CC-INPUT-DATA-DEPT                        VALUE SPACES.          
               10  CC-INPDD-DPT             PIC X(3).                           
               10  CC-INPDD-HYP3            PIC X(1).                           
               10  CC-INPDD-SCL             PIC X(2).                           
           05  FILLER                       PIC X(1)     VALUE SPACES.          
           05  CC-INPUT-GROUP-Y-N                        VALUE SPACES.          
               10  CC-FIX-GROUP             PIC X(1).                           
                                                                                
       01  CD-CPU-DATE.                                                         
           05  CD-CPU-YR                    PIC 9(2)       VALUE ZEROS.         
           05  CD-CPU-MO                    PIC 9(2)       VALUE ZEROS.         
           05  CD-CPU-DD                    PIC 9(2)       VALUE ZEROS.         
                                                                                
       01  CT-CPU-TIME.                                                         
           05  CT-CPU-HH                    PIC 9(2)       VALUE ZEROS.         
           05  CT-CPU-MM                    PIC 9(2)       VALUE ZEROS.         
           05  CT-CPU-SS                    PIC 9(2)       VALUE ZEROS.         
           05  CT-CPU-HS                    PIC 9(2)       VALUE ZEROS.         
                                                                                
       01  WS-DB2-TIMESTAMP.                                                    
           05  WS-TS-CC                     PIC XX    VALUE SPACES.             
           05  WS-TS-YY                     PIC XX    VALUE SPACES.             
           05  FILLER                       PIC X     VALUE '-'.                
           05  WS-TS-MO                     PIC XX    VALUE SPACES.             
           05  FILLER                       PIC X     VALUE '-'.                
           05  WS-TS-DD                     PIC XX    VALUE SPACES.             
           05  FILLER                       PIC X     VALUE '-'.                
           05  WS-TS-HH                     PIC XX    VALUE SPACES.             
           05  FILLER                       PIC X     VALUE '.'.                
           05  WS-TS-MM                     PIC XX    VALUE SPACES.             
           05  FILLER                       PIC X     VALUE '.'.                
           05  WS-TS-SS                     PIC XX    VALUE SPACES.             
           05  FILLER                       PIC X     VALUE '.'.                
           05  WS-TS-MS                     PIC X(6)  VALUE SPACES.             
                                                                                
       01  WS-DB2-DATE.                                                         
           05  WS-DB-CC                     PIC XX    VALUE SPACES.             
           05  WS-DB-YY                     PIC XX    VALUE SPACES.             
           05  FILLER                       PIC X     VALUE '-'.                
           05  WS-DB-MO                     PIC XX    VALUE SPACES.             
           05  FILLER                       PIC X     VALUE '-'.                
           05  WS-DB-DD                     PIC XX    VALUE SPACES.             
           05  FILLER                       PIC X     VALUE '-'.                
           05  WS-DB-HH                     PIC XX    VALUE '00'.               
           05  FILLER                       PIC X     VALUE '.'.                
           05  WS-DB-MM                     PIC XX    VALUE '00'.               
           05  FILLER                       PIC X     VALUE '.'.                
           05  WS-DB-SS                     PIC XX    VALUE '00'.               
                                                                                
       01  WS-TIMESTAMP                   PIC X(26).                            
       01  FILLER REDEFINES WS-TIMESTAMP.                                       
           05  FILLER                     PIC X(14).                            
           05  WS-MINUTE                  PIC X(02).                            
           05  FILLER                     PIC X(02).                            
           05  WS-SECOND                  PIC X(01).                            
           05  FILLER                     PIC X(01).                            
           05  WS-NANOSEC                 PIC X(06).                            
                                                                                
       01  PS-SWITCHES.                                                         
FPS        05 PS-DEPT-LEFT-SWITCH         PIC X      VALUE 'Y'.                 
FPS           88 PS-MORE-DEPTS                       VALUE 'Y'.                 
FPS           88 PS-NO-MORE-DEPTS                    VALUE 'N'.                 
           05 PS-PARENTS-LEFT-SWITCH      PIC X      VALUE 'Y'.                 
              88 PS-MORE-PARENTS                     VALUE 'Y'.                 
              88 PS-NO-MORE-PARENTS                  VALUE 'N'.                 
           05 DONE-FIXING-ITEMS-IND       PIC X      VALUE 'N'.                 
              88 DONE-FIXING-ITEMS                   VALUE 'Y'.                 
              88 NOT-DONE-FIXING-ITEMS               VALUE 'N'.                 
           05 ITEM-MODIFIED-IND           PIC X      VALUE 'N'.                 
              88 MODIFIED-ITEM                       VALUE 'Y'.                 
              88 ITEM-UNTOUCHED                      VALUE 'N'.                 
           05 ITEM-TO-FIX-IND             PIC X      VALUE 'N'.                 
              88 GOT-AN-ITEM                         VALUE 'Y'.                 
              88 NEED-AN-ITEM-TO-FIX                 VALUE 'N'.                 
           05 DONE-FIXING-SUBCLASS-IND    PIC X      VALUE 'N'.                 
              88 DONE-FIXING-SUBCLASS                VALUE 'Y'.                 
              88 NOT-DONE-FIXING-SUBCLASS            VALUE 'N'.                 
           05 TSK-FOUND-IND               PIC X      VALUE 'N'.                 
              88 FOUND-A-TSK                         VALUE 'Y'.                 
              88 NO-TSK                              VALUE 'N'.                 
           05 GRP-FOUND-IND               PIC X      VALUE 'N'.                 
              88 FOUND-A-GRP                         VALUE 'Y'.                 
              88 NO-GRP                              VALUE 'N'.                 
           05 PRNT-GRP-FOUND-IND          PIC X      VALUE 'N'.                 
              88 FOUND-A-PRNT-GRP                    VALUE 'Y'.                 
              88 NO-PRNT-GRP                         VALUE 'N'.                 
           05 TMDSEIT-FOUND-IND           PIC X      VALUE 'N'.                 
              88 FOUND-A-TMDSEIT                     VALUE 'Y'.                 
              88 NO-TMDSEIT                          VALUE 'N'.                 
           05 TMDSEIT-MISMATCH-IND        PIC X      VALUE 'Y'.                 
              88 TMDSEIT-OKAY                        VALUE 'Y'.                 
              88 TMDSEIT-MISMATCH                    VALUE 'D', 'S',            
                                                 'C', 'V', 'A', 'E'.            
              88 TMDSEIT-DATE-MISMATCH               VALUE 'D'.                 
              88 TMDSEIT-STAT-MISMATCH               VALUE 'S'.                 
              88 TMDSEIT-DESC-MISMATCH               VALUE 'C'.                 
              88 TMDSEIT-VNDR-MISMATCH               VALUE 'V'.                 
              88 TMDSEIT-AMT-MISMATCH                VALUE 'A'.                 
              88 TMDSEIT-CDE-MISMATCH                VALUE 'E'.                 
           05 ERROR-IND                   PIC X      VALUE 'N'.                 
              88 ERROR-EXISTS                        VALUE 'Y'.                 
              88 NO-ERROR                            VALUE 'N'.                 
                                                                                
       01 CONVERSION-INFO.                                                      
          10 INTERMED-PIC-9-3          PIC  9(3) DISPLAY.                       
          10 INTERMED-PIC-X-3  REDEFINES INTERMED-PIC-9-3 PIC X(3).             
          10 INTERMED-PIC-9-5V2        PIC  9(5)V9(2).                          
          10 INTERMED-PIC-X-7V REDEFINES INTERMED-PIC-9-5V2 PIC X(7).           
          10 INTERMED-PIC-9-7          PIC  9(7) DISPLAY.                       
          10 INTERMED-PIC-X-7  REDEFINES INTERMED-PIC-9-7  PIC X(7).            
          10 INTERMED-PIC-9-10         PIC  9(10) DISPLAY.                      
          10 INTERMED-PIC-X-10 REDEFINES INTERMED-PIC-9-10 PIC X(10).           
                                                                                
                                                                                
                                                                                
      * DECLARE VARIABLES FOR SUBROUTINE CALL  (SQLCODE TEXT)                   
                                                                                
       01  WS-MSG-TEXT                   PIC X(512).                            
       01  WS-MAX-SIZE                   PIC S9(09) COMP                        
                                                    VALUE 512.                  
       01  WS-MSG-LENGTH                 PIC S9(09) COMP.                       
                                                                                
           EXEC SQL BEGIN DECLARE SECTION END-EXEC.                             
                                                                                
       01      USERNAME                   PIC X(10)      VARYING.               
       01      PASSWD                     PIC X(10)      VARYING.               
       01      PC-ENT01-TYPE-CDE          PIC X(02)      VALUE '01'.            
       01      PV-ORACLE-ID               PIC X(1)       VALUE '/'.             
       01      PV-ITMCLT-CLUSTR           PIC X(40)      VALUE SPACES.          
       01      PV-CURRENT-DATE            PIC X(10)      VALUE SPACES.          
       01      PV-CURRENT-TMST            PIC X(79)      VALUE SPACES.          
       01      PV-CURRENT-TMST-NEW        PIC X(19)      VALUE SPACES.          
       01      PV-CURR-END-TMST           PIC X(19)      VALUE SPACES.          
       01      PV-INITIAL-STRT-TMST       PIC X(19)      VALUE                  
                                          '0000-00-00-00.00.00'.                
       01      PV-INITIAL-END-TMST        PIC X(19)      VALUE                  
                                          '0000-00-00-23.59.59'.                
       01      PV-INPUT-BEG-TMST          PIC X(19)      VALUE SPACES.          
       01      PV-INPUT-END-TMST          PIC X(19)      VALUE SPACES.          
       01      PV-INPUT-DTE               PIC X(10)      VALUE SPACES.          
       01      PV-NEW-TMST                PIC X(19)      VALUE SPACES.          
       01      PV-CURRENT-JULIAN-DATE     PIC S9(05)V    COMP-3                 
                                                         VALUE ZERO.            
       01      PV-EFF-END-DTE-NULL         PIC S9(04)     COMP                  
                                                         VALUE ZERO.            
       01      PV-CLUSTR-TYP-CDE-NULL      PIC S9(04)     COMP                  
                                                         VALUE ZERO.            
       01      PV-HIER-TYP-CDE-NULL        PIC S9(04)     COMP                  
                                                         VALUE ZERO.            
       01      PV-HIER-CDE-NULL            PIC S9(04)     COMP                  
                                                         VALUE ZERO.            
       01      PV-MDSE-NM-CDE-NULL         PIC S9(04)     COMP                  
                                                         VALUE ZERO.            
       01      PV-PROD-SERV-CDE-NULL       PIC S9(04)     COMP                  
                                                         VALUE ZERO.            
       01      PV-OWNER-ID-NULL            PIC S9(04)     COMP                  
                                                         VALUE ZERO.            
       01      PV-STAT-CHNG-DTE-NULL       PIC S9(04)     COMP                  
                                                         VALUE ZERO.            
       01      PV-SIZE-DESC-NULL           PIC S9(04)     COMP                  
                                                         VALUE ZERO.            
       01      PV-COLOR-DESC-NULL          PIC S9(04)     COMP                  
                                                         VALUE ZERO.            
       01      PV-VNDR-INHOUSE-NBR-NULL    PIC S9(04)     COMP                  
                                                         VALUE ZERO.            
       01      PV-VNDR-STYL-ID-NULL        PIC S9(04)     COMP                  
                                                         VALUE ZERO.            
       01      PV-UNIT-RTL-AMT-NULL        PIC S9(04)     COMP                  
                                                         VALUE ZERO.            
       01      PV-UNIT-RTL-UOM-CDE-NULL    PIC S9(04)     COMP                  
                                                         VALUE ZERO.            
       01      PV-GRP-QTY-NULL             PIC S9(04)     COMP                  
                                                         VALUE ZERO.            
       01      PV-GRP-RTL-AMT-NULL         PIC S9(04)     COMP                  
                                                         VALUE ZERO.            
       01      PV-ENT-ID-NULL              PIC S9(04)     COMP                  
                                                         VALUE ZERO.            
       01      PV-CHLD-CDE-NULL            PIC S9(04)     COMP                  
                                                         VALUE ZERO.            
       01      PV-LIKE-SUBCLASS            PIC X(8)                             
                                             VALUE '010-11-%'.                  
       01      PREV-ITEM-CLUSTR-NAME       PIC X(20).                           
FPS    01      PV-DEPT-RECORD              PIC X(40).                           
                                                                                
      ******************************************************************        
      *    VARIABLES FOR ORACLE DATA                                            
      *                                                                         
      ******************************************************************        
      ******************************************************************        
      *     * COBOL DECLARATION FOR TABLE TITMCLT                               
      ******************************************************************        
       01        DCLTITMCLT.                                                    
                 10   ITMCLT-ITEM-CLUSTR-ID      PIC S9(10) COMP-3.             
                 10   ITMCLT-ITEM-CLUSTR-NAME    PIC X(20).                     
                 10   ITMCLT-ITEM-CLUSTR-DESC    PIC X(40).                     
                 10   ITMCLT-EFF-BEG-TMST        PIC X(19).                     
                 10   ITMCLT-EFF-END-TMST        PIC X(19).                     
                 10   ITMCLT-CLUSTR-TYP-CDE      PIC X(01).                     
                 10   ITMCLT-HIER-TYP-CDE        PIC X(01).                     
                 10   ITMCLT-HIER-CDE            PIC X(03).                     
                 10   ITMCLT-ITEM-CLUSTR-CDE     PIC X(01).                     
                 10   ITMCLT-MDSE-NM-CDE         PIC X(01).                     
                 10   ITMCLT-PROD-SERV-CDE       PIC X(01).                     
                 10   ITMCLT-CRE-BY-UID          PIC X(08).                     
                 10   ITMCLT-CRE-TMST            PIC X(19).                     
                 10   ITMCLT-LAST-UPD-BY-UID     PIC X(08).                     
                 10   ITMCLT-LAST-UPD-TMST       PIC X(19).                     
                 10   ITMCLT-ARCH-DTE            PIC X(19).                     
                 10   ITMCLT-OWNER-ID            PIC S9(10) COMP-3.             
                 10   ITMCLT-OWNER-ID-NULL       PIC S9(04)     COMP.           
                 10   NEW-ITEM-CLUSTR-ID      PIC S9(10) COMP-3.                
                 10   NEW-ITEM-CLUSTR-NAME    PIC X(20).                        
                 10   NEW-ITEM-CLUSTR-DESC    PIC X(40).                        
      ******************************************************************        
      * COBOL DECLARATION FOR TABLE TMDSEIT                                     
      ******************************************************************        
       01  DCLTMDSEIT.                                                          
           10 MDSEIT-ITEM-CLUSTR-ID         PIC  S9(9) COMP.                    
           10 MDSEIT-STAT-CHNG-DTE          PIC   X(19).                        
           10 MDSEIT-STAT-CDE               PIC  S9(3)  COMP-3.                 
           10 MDSEIT-SIZE-DESC              PIC   X(20).                        
           10 MDSEIT-COLOR-DESC             PIC   X(20).                        
           10 MDSEIT-VNDR-INHOUSE-NBR       PIC  S9(3)  COMP-3.                 
           10 MDSEIT-VNDR-STYL-ID           PIC   X(20).                        
           10 MDSEIT-UNIT-RTL-AMT           PIC  X(10).                         
           10 MDSEIT-UNIT-RTL-UOM-CDE       PIC   X(4).                         
           10 MDSEIT-GRP-QTY                PIC  S9(3)  COMP-3.                 
           10 MDSEIT-GRP-RTL-AMT            PIC  X(10).                         
           10 MDSEIT-ENT-ID                 PIC S9(10) COMP-3.                  
           10 COMPARE-STAT-CHNG-DTE         PIC   X(19).                        
                                                                                
      ******************************************************************        
      * MORE TSK INFO.                                                          
      ******************************************************************        
       01 MORE-ITEM-INFO.                                                       
           10 ITEM-PARENT-GROUP-ID              PIC S9(10) COMP-3.              
           10 ITEM-ID                           PIC S9(10) COMP-3.              
           10 ITEM-PARENT-GROUP-NAME            PIC X(20).                      
           10 ITEM-PARENT-VST-ID                PIC S9(10) COMP-3.              
           10 ITEM-PARENT-VST-NAME              PIC X(20).                      
           10 START-HERE-TMST                   PIC X(19).                      
      ******************************************************************        
      *     * COBOL DECLARATION FOR TABLE TSK                                   
      ******************************************************************        
       01  MYTSK.                                                               
           10 TSK-UNIT-RTL-UOM-CDE              PIC X(04).                      
           10 MY-VNDR-IN-HSE-NMBR               PIC X(05).                      
           10 MY-STATUS-CODE                    PIC X(04).                      
           10 MY-STAT-CHNGD-DATE                PIC X(07).                      
           10 MY-GP-QTY                         PIC X(04).                      
           10 MY-GP-RTL-AMT                     PIC X(10).                      
           10 MY-CUR-UNIT-RTL-AMT               PIC X(10).                      
           10 MY-ENT-ID                         PIC X(11).                      
           10 TSK-VNDR-STYL-ID                  PIC X(20).                      
                                                                                
      *     EXEC SQL                                                            
      *          INCLUDE TITMCLT                                                
      *     END-EXEC.                                                           
                                                                                
            EXEC SQL                                                            
                 INCLUDE TITMCLC                                                
            END-EXEC.                                                           
                                                                                
      *     EXEC SQL                                                            
      *          INCLUDE TMDSEIT                                                
      *     END-EXEC.                                                           
                                                                                
            EXEC SQL                                                            
                 INCLUDE TDPPRCT                                                
            END-EXEC.                                                           
                                                                                
            EXEC SQL                                                            
                 INCLUDE TSK                                                    
            END-EXEC.                                                           
                                                                                
           EXEC SQL END DECLARE SECTION END-EXEC.                               
                                                                                
      * ORA COMMUNICATION AREA                                                  
                                                                                
        01       SQLCA.                                                         
                 05  SQLCAID               PIC X(8).                            
                 05  SQLCABC               PIC S9(9) COMPUTATIONAL.             
                 05  SQLCODE               PIC S9(9) COMPUTATIONAL.             
                 05  SQLERRM.                                                   
                     49 SQLERRML           PIC S9(4) COMPUTATIONAL.             
                     49 SQLERRMC           PIC X(70).                           
                 05  SQLERRP               PIC X(8).                            
                 05  SQLERRD OCCURS 6 TIMES                                     
                                           PIC S9(9) COMPUTATIONAL.             
                 05  SQLWARN.                                                   
                     10 SQLWARN0           PIC X(1).                            
                     10 SQLWARN1           PIC X(1).                            
                     10 SQLWARN2           PIC X(1).                            
                     10 SQLWARN3           PIC X(1).                            
                     10 SQLWARN4           PIC X(1).                            
                     10 SQLWARN5           PIC X(1).                            
                     10 SQLWARN6           PIC X(1).                            
                     10 SQLWARN7           PIC X(1).                            
                 05  SQLEXT                PIC X(8).                            
       EJECT                                                                    
                                                                                
           COPY SQLCA2.                                                         
       EJECT                                                                    
                                                                                
      ****************************************************************          
       PROCEDURE DIVISION.                                                      
      ****************************************************************          
      ****************************************************************          
      * A000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE  *          
      * PROGRAM.                                                     *          
      ****************************************************************          
       A000-PROGRAM-MAINLINE.                                                   
                                                                                
           PERFORM A100-INITIAL.                                                
FPS        PERFORM S100-OPEN-DEPT-CURSOR.                                       
FPS        IF SQLCODE = 0                                                       
FPS           PERFORM A125-PROCESS-FIX UNTIL PS-NO-MORE-DEPTS                   
FPS        END-IF.                                                              
FPS        PERFORM S200-CLOSE-DEPT-CURSOR.                                      
FPS        PERFORM S175-UPDATE-TDPPRCT                                          
                                                                                
           PERFORM A200-COMPLETE.                                               
                                                                                
           DISPLAY '**************************************************'.        
           DISPLAY ' ITEMS FETCHED        : ' PV-ITEMS-FETCHED.                 
           DISPLAY ' ITEMS EXPIRED        : ' PV-ITEM-EXPIRED.                  
           DISPLAY '**************************************************'.        
           DISPLAY ' MDSEIT INSERTED      : ' PV-MDSEIT-INSERTED.               
           DISPLAY ' MDSEIT UPDATED       : ' PV-MDSEIT-UPDATED.                
           DISPLAY '**************************************************'.        
           DISPLAY ' GROUPS INSERTED      : ' PV-GROUP-INSERTED.                
           DISPLAY ' GROUP RELS EXPIRED   : ' PV-GROUP-REL-EXPIRED.             
           DISPLAY ' GROUP RELS INSERTED  : ' PV-GROUP-REL-INSERTED.            
           DISPLAY '**************************************************'.        
                                                                                
           STOP RUN.                                                            
                                                                                
      *****************************************************************         
      * A100-INITIAL.                                                 *         
      *****************************************************************         
       A100-INITIAL.                                                            
           MOVE 'A100-INITIAL' TO PV-ABEND-PARAGRAPH.                           
           DISPLAY '**********************************'.                        
           DISPLAY 'MAKUP100 PROGRAM'                                           
                                                                                
           DISPLAY '**********************************'.                        
CMNT  *    MOVE 'DEVTEAM' TO USERNAME-ARR.                                      
OUT   *    MOVE 7  TO USERNAME-LEN.                                             
FOR   *    MOVE 'DEVTEAM' TO PASSWD-ARR.                                        
PROD  *    MOVE 7  TO PASSWD-LEN.                                               
                                                                                
SCTEMP*    MOVE 'QATEAM' TO USERNAME-ARR.                                       
SCTEMP*    MOVE 6  TO USERNAME-LEN.                                             
SCTEMP*    MOVE 'QATEAM' TO PASSWD-ARR.                                         
SCTEMP*    MOVE 6  TO PASSWD-LEN.                                               
                                                                                
CMNT  *    MOVE 'PRODTEAM' TO USERNAME-ARR.                                     
OUT   *    MOVE 8  TO USERNAME-LEN.                                             
FOR   *    MOVE 'PRODTEAM' TO PASSWD-ARR.                                       
TEST  *    MOVE 8  TO PASSWD-LEN.                                               
                                                                                
           DISPLAY 'ATTEMPTING LOGON AS ' USERNAME-ARR.                         
                                                                                
CMNT  *    EXEC SQL                                                             
FOR   *     CONNECT :USERNAME IDENTIFIED BY :PASSWD                             
PROD  *    END-EXEC.                                                            
                                                                                
CMNT       EXEC SQL                                                             
FOR         CONNECT :PV-ORACLE-ID                                               
TEST       END-EXEC.                                                            
                                                                                
           IF SQLCODE = 0                                                       
             DISPLAY 'CONNECTED TO ORACLE AS USER: ' PV-ORACLE-ID               
           ELSE                                                                 
               PERFORM Z999-SQL-ERROR                                           
           END-IF.                                                              
                                                                                
           EXEC SQL                                                             
            ALTER SESSION                                                       
                  SET NLS_DATE_FORMAT = 'YYYY-MM-DD-HH24.MI.SS'                 
           END-EXEC.                                                            
                                                                                
           EXEC SQL                                                             
            SELECT SYSDATE                                                      
            INTO :PV-CURRENT-TMST                                               
            FROM DUAL                                                           
           END-EXEC.                                                            
                                                                                
           DISPLAY 'SYSDATE = ' PV-CURRENT-TMST.                                
           MOVE PV-CURRENT-TMST TO PV-CURRENT-TMST-NEW.                         
                                                                                
FPS        EXEC SQL                                                             
FPS          DECLARE GETDEPT                                                    
FPS             CURSOR FOR                                                      
FPS             SELECT                                                          
FPS                    PRC_NM,                                                  
FPS                    EFF_BEG_TMST                                             
FPS             FROM                                                            
FPS                    TDPPRCT                                                  
FPS             WHERE                                                           
FPS                    PRC_STAT_CDE = 'A'                                       
FPS               AND  PRC_TXT = 'MAK100'                                       
FPS               AND  EFF_END_TMST IS NULL                                     
FPS          ORDER BY PRC_TXT                                                   
FPS        END-EXEC.                                                            
                                                                                
           EXEC SQL                                                             
             DECLARE FIXITEM                                                    
                CURSOR FOR                                                      
                SELECT   /*+  INDEX(TITMCLT IITMCLT1) */                        
                ITEM_CLUSTR_ID,                                                 
                ITEM_CLUSTR_NAME,                                               
                OWNER_ID,                                                       
                LAST_UPD_TMST                                                   
             FROM                                                               
                  TITMCLT                                                       
             WHERE                                                              
                  ITEM_CLUSTR_CDE IN ('I')                                      
                  AND     MDSE_NM_CDE IN ('M')                                  
                  AND     PROD_SERV_CDE IN ('P')                                
                  AND     EFF_END_TMST IS NULL                                  
                  AND     ITEM_CLUSTR_NAME > :PREV-ITEM-CLUSTR-NAME             
                  AND     ITEM_CLUSTR_NAME LIKE :PV-LIKE-SUBCLASS               
                  AND     LAST_UPD_TMST > :START-HERE-TMST                      
             ORDER BY ITEM_CLUSTR_NAME                                          
           END-EXEC.                                                            
                                                                                
      *    EXEC SQL                                                             
      *      DECLARE FINDPARENTS                                                
      *         CURSOR FOR                                                      
      *         SELECT   /*+  INDEX(TITMCLC IITMCLC1) */                        
      *         PRNT_ITM_CLUSTR_ID                                              
      *      FROM                                                               
      *           TITMCLC                                                       
      *      WHERE                                                              
      *           CHLD_ITM_CLUSTR_ID = :ITMCLT-ITEM-CLUSTR-ID                   
      *           AND     REL_TYP_CDE = 'M'                                     
      *           AND     EFF_END_TMST IS NULL                                  
      *    END-EXEC.                                                            
      *                                                                         
      *                                                                         
      * CURSOR FOR TITMCLT TABLE                                                
      *                                                                         
      *   THIS CURSOR IS USED ONLY TO EXPIRE PARENT RELATIONSHIPS               
      *        SO MAKE SURE YOU'RE ONLY SELECTING OPEN RELATIONSHIPS            
      *        OF OPEN ITEMS.                                                   
           EXEC SQL                                                             
             DECLARE PRNTSKU      CURSOR FOR                                    
               SELECT B.CHLD_ITM_CLUSTR_ID,                                     
                      B.PRNT_ITM_CLUSTR_ID                                      
               FROM   TITMCLT A,                                                
                      TITMCLC B                                                 
               WHERE  A.ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME             
               AND    A.HIER_CDE        IS NULL                                 
               AND    A.ITEM_CLUSTR_CDE = 'I'                                   
               AND    B.REL_TYP_CDE     =  'M'                                  
               AND    A.ITEM_CLUSTR_ID   = B.CHLD_ITM_CLUSTR_ID                 
               AND  ( A.EFF_END_TMST IS NULL                                    
                        OR A.EFF_END_TMST > :PV-CURR-END-TMST )                 
               AND  ( B.EFF_END_TMST IS NULL                                    
                        OR B.EFF_END_TMST > :PV-CURR-END-TMST )                 
           END-EXEC.                                                            
                                                                                
           ACCEPT PV-JULIAN-DATE   FROM DAY.                                    
           ACCEPT CD-CPU-DATE      FROM DATE.                                   
           DISPLAY 'CPU-DATE : ' CD-CPU-DATE.                                   
           ACCEPT CT-CPU-TIME      FROM TIME.                                   
           IF CD-CPU-YR > '80'                                                  
              MOVE '19'      TO WS-TS-CC                                        
           ELSE                                                                 
              MOVE '20'      TO WS-TS-CC.                                       
           MOVE CD-CPU-YR    TO WS-TS-YY.                                       
           MOVE CD-CPU-MO    TO WS-TS-MO.                                       
           MOVE CD-CPU-DD    TO WS-TS-DD.                                       
           MOVE CT-CPU-HH    TO WS-TS-HH.                                       
           MOVE CT-CPU-MM    TO WS-TS-MM.                                       
           MOVE CT-CPU-SS    TO WS-TS-SS.                                       
           MOVE ZERO         TO WS-TS-MS.                                       
           MOVE   PV-JULIAN-DATE  TO PV-WORK-JULIAN-DATE.                       
           MOVE   PV-WORK-JULIAN-DATE  TO                                       
                                     PV-CURRENT-JULIAN-DATE.                    
            IF CD-CPU-YR > '80'                                                 
               MOVE '19'               TO PV-CENTURY                            
            ELSE                                                                
               MOVE '20'               TO PV-CENTURY.                           
            STRING  PV-CENTURY          DELIMITED BY SIZE                       
                    CD-CPU-YR           DELIMITED BY SIZE                       
                    '-'                 DELIMITED BY SIZE                       
                    CD-CPU-MO           DELIMITED BY SIZE                       
                    '-'                 DELIMITED BY SIZE                       
                    CD-CPU-DD           DELIMITED BY SIZE                       
                                      INTO  PV-CURRENT-DATE.                    
           DISPLAY 'PV-CURRENT-DATE : ' PV-CURRENT-DATE.                        
                                                                                
           MOVE PV-INITIAL-END-TMST  TO PV-CURR-END-TMST.                       
           MOVE PV-CURRENT-DATE      TO PV-CURR-END-TMST(1:10).                 
                                                                                
FPS   *****************************************************************         
FPS   * A125-PROCESS-FIX                                                        
FPS   *****************************************************************         
FPS    A125-PROCESS-FIX.                                                        
FPS                                                                             
FPS        PERFORM S150-FETCH-DEPT-CURSOR                                       
FPS        IF SQLCODE = 0                                                       
FPS           PERFORM A150-SETUP                                                
FPS           PERFORM W100-OPEN-ITEM-CURSOR                                     
FPS           IF NO-ERROR                                                       
FPS              PERFORM B100-FIX-ITEMS                                         
FPS                  UNTIL ( (NOT NO-ERROR) OR DONE-FIXING-ITEMS )              
FPS              IF NOT NO-ERROR                                                
FPS                 EXEC SQL                                                    
FPS                    ROLLBACK RELEASE                                         
FPS                 END-EXEC                                                    
FPS              END-IF                                                         
FPS           END-IF                                                            
FPS        END-IF.                                                              
      *****************************************************************         
      * A150-SETUP                                                              
      *****************************************************************         
       A150-SETUP.                                                              
           MOVE 'A150-XX' TO PV-ABEND-PARAGRAPH.                                
                                                                                
           IF ( (CC-INPDD-DPT < '010') OR (CC-INPDD-DPT > '815' ) )             
               DISPLAY PC-PGMNAME '- CONTROL CARD DEPT NAME ERROR : '           
                        CC-CONTROL-CARD                                         
               MOVE +4001 TO PV-ABEND-CODE                                      
               CALL 'ILBOABN0' USING PV-ABEND-CODE                              
           END-IF.                                                              
           IF ( (CC-INPDD-SCL < '01') OR (CC-INPDD-SCL > '99') )                
               DISPLAY PC-PGMNAME '- CONTROL CARD SUBCLASS ERROR : '            
                        CC-INPDD-SCL                                            
               MOVE '01' TO CC-INPDD-SCL                                        
               DISPLAY '    REPLACE WITH : ' CC-INPDD-SCL                       
           END-IF.                                                              
           IF CC-FIX-GROUP NOT = 'Y'                                            
              DISPLAY '*#*#*#*#*#*#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'                
              DISPLAY 'GROUP RELATIONSHIPS WILL NOT BE CHECKED!'                
              DISPLAY '*#*#*#*#*#*#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'                
           END-IF.                                                              
                                                                                
      *    DISPLAY PC-PGMNAME ' - LAST UPDATE DATE: '                           
      *             CC-INPUT-DATA-DATE.                                         
           MOVE PV-INITIAL-STRT-TMST TO PV-INPUT-BEG-TMST                       
           MOVE CC-INPUT-DATA-DATE   TO PV-INPUT-BEG-TMST(1:10).                
           MOVE PV-INITIAL-END-TMST  TO PV-INPUT-END-TMST.                      
           MOVE CC-INPUT-DATA-DATE   TO PV-INPUT-END-TMST(1:10).                
           MOVE PV-INITIAL-STRT-TMST TO START-HERE-TMST.                        
           MOVE CC-INPUT-DATA-DATE   TO START-HERE-TMST(1:10).                  
                                                                                
           MOVE 0 TO FIXES-SINCE-LAST-COMMIT.                                   
           MOVE 0 TO FETCHES-SINCE-LAST-COMMIT.                                 
           MOVE CC-INPDD-DPT TO LIKE-DEPT-NUM.                                  
           MOVE CC-INPDD-SCL TO LIKE-CLASS-NUM.                                 
           MOVE LIKE-CLASS-NUM TO PV-LIKE-SUBCLASS(5:2).                        
           MOVE LIKE-DEPT-NUM  TO PV-LIKE-SUBCLASS(1:3).                        
           MOVE SPACES     TO PREV-ITEM-CLUSTR-NAME.                            
           MOVE PV-LIKE-SUBCLASS(1:6) TO PREV-ITEM-CLUSTR-NAME.                 
           SET NOT-DONE-FIXING-ITEMS TO TRUE.                                   
           SET DONE-FIXING-SUBCLASS TO TRUE.                                    
           SET NO-ERROR TO TRUE.                                                
                                                                                
      *****************************************************************         
      * A200-COMPLETE                                                 *         
      *****************************************************************         
       A200-COMPLETE.                                                           
           MOVE 'A200-COMPLETE' TO PV-ABEND-PARAGRAPH.                          
                                                                                
           EXEC SQL                                                             
             COMMIT RELEASE                                                     
           END-EXEC.                                                            
                                                                                
           IF SQLCODE NOT = ZERO                                                
              MOVE SQLCODE    TO SQLCODE2                                       
              MOVE SQLERRD(3) TO SQLERRD3                                       
              DISPLAY '** COMMIT ERROR'                                         
              DISPLAY '** ABEND **       ** = SQLERROR'                         
              DISPLAY '** PROGRAM        ** = MAKUP100'                         
              DISPLAY '** SQLCODE        ** = ' SQLCODE2                        
              DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3                        
              DISPLAY '** SQLERRM        ** = ' SQLERRM                         
              DISPLAY '** SQLERRMC       ** = ' SQLERRMC                        
              MOVE SPACES TO WS-MSG-TEXT                                        
              CALL 'SQLGLM' USING WS-MSG-TEXT,                                  
                                  WS-MAX-SIZE,                                  
                                  WS-MSG-LENGTH                                 
              DISPLAY 'MESSAGE TEXT      ** = ' WS-MSG-TEXT                     
           END-IF.                                                              
                                                                                
           EXEC SQL                                                             
            SELECT SYSDATE                                                      
            INTO :PV-CURRENT-TMST                                               
            FROM DUAL                                                           
           END-EXEC.                                                            
                                                                                
           DISPLAY 'MAKUP100 PROGRAM FINISHED AT '                              
                          PV-CURRENT-TMST.                                      
                                                                                
      *****************************************************************         
      * B100-FIX-ITEMS                                                          
      * FOR EACH TITMCLT IN A SUBCLASS                                          
      *    CHECK IF THERE'S A TSK                                               
      *    IF NO TSK                                                            
      *      EXPIRE THE TITMCLT AND ALL ITS PARENT TITMCLC'S                    
      *    ELSE                                                                 
      *    END-IF                                                               
      * END FOR                                                                 
      * NEXT SUBCLASS                                                           
      *****************************************************************         
       B100-FIX-ITEMS.                                                          
                                                                                
           IF ( (FETCHES-SINCE-LAST-COMMIT > 99) OR                             
                (FIXES-SINCE-LAST-COMMIT > 9) )                                 
              PERFORM W150-CLOSE-ITEM-CURSOR                                    
              IF NO-ERROR                                                       
                 PERFORM W300-COMMIT-ETC                                        
                 PERFORM W100-OPEN-ITEM-CURSOR                                  
              END-IF                                                            
           END-IF.                                                              
           IF NO-ERROR                                                          
              PERFORM  V175-FETCH-ITEM-LOOP                                     
              IF (NO-ERROR AND (NOT DONE-FIXING-ITEMS) )                        
                 PERFORM  W400-SELECT-TSK                                       
      *          DISPLAY 'BACK IN B100-FIX-ITEMS'                               
                 IF NO-TSK                                                      
      *             DISPLAY '   XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'        
      *             DISPLAY '   EXPIRE ' ITMCLT-ITEM-CLUSTR-ID                  
      *                 ' ' ITMCLT-ITEM-CLUSTR-NAME ' AND ITS PARENTS'          
      *             DISPLAY '   NO TSK RECORDS FOUND'                           
      *             DISPLAY '   XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'        
                    PERFORM  C410-EXPIRE-SKU-PARNT-REL                          
                    SET MODIFIED-ITEM TO TRUE                                   
                 ELSE                                                           
                    PERFORM C600-CHECK-AND-REPAIR                               
                 END-IF                                                         
                 MOVE ZEROES TO ITMCLT-ITEM-CLUSTR-ID                           
                 MOVE SPACES TO ITMCLT-ITEM-CLUSTR-NAME                         
                 MOVE ZEROES TO ITMCLT-OWNER-ID                                 
                 MOVE SPACES TO ITMCLT-LAST-UPD-TMST                            
              END-IF                                                            
           END-IF.                                                              
      *    IF MODIFIED-ITEM                                                     
      *       DISPLAY '* - * - * - * - * - * - * - * - * - * - *'               
      *    END-IF.                                                              
                                                                                
           CONTINUE.                                                            
      *****************************************************************         
      *                                                               *         
      *****************************************************************         
       C200-INSERT-TITMCLT.                                                     
                                                                                
           MOVE 'C200-INSERT-TITMCLT'                                           
                     TO  PV-ABEND-PARAGRAPH.                                    
                                                                                
             PERFORM X100-REPLACE-SPEC-CHARS.                                   
                                                                                
             PERFORM C250-CREATE-CLUSTR-ID.                                     
             IF ITMCLT-HIER-CDE = 'DPT'                                         
                 MOVE NEW-ITEM-CLUSTR-ID TO ITMCLT-OWNER-ID                     
             END-IF.                                                            
             MOVE NEW-ITEM-CLUSTR-ID  TO ITMCLC-CHLD-ITM-CLUSTR-ID.             
             MOVE PC-NEG-1               TO PV-EFF-END-DTE-NULL.                
                                                                                
           EXEC SQL                                                             
             INSERT INTO   TITMCLT                                              
                  (ITEM_CLUSTR_ID,                                              
                   ITEM_CLUSTR_NAME,                                            
                   ITEM_CLUSTR_DESC,                                            
                   ITEM_CLUSTR_CDE,                                             
                   EFF_BEG_TMST,                                                
                   EFF_END_TMST,                                                
                   CLUSTR_TYP_CDE,                                              
                   HIER_TYP_CDE,                                                
                   HIER_CDE,                                                    
                   MDSE_NM_CDE,                                                 
                   PROD_SERV_CDE,                                               
                   CRE_BY_UID,                                                  
                   CRE_TMST,                                                    
                   LAST_UPD_BY_UID,                                             
                   LAST_UPD_TMST,                                               
                   OWNER_ID)                                                    
               VALUES                                                           
                  (:NEW-ITEM-CLUSTR-ID,                                         
                   :NEW-ITEM-CLUSTR-NAME,                                       
                   :NEW-ITEM-CLUSTR-DESC,                                       
                   :ITMCLT-ITEM-CLUSTR-CDE,                                     
                   SYSDATE,                                                     
                   :ITMCLT-EFF-END-TMST:PV-EFF-END-DTE-NULL,                    
                   :ITMCLT-CLUSTR-TYP-CDE:PV-CLUSTR-TYP-CDE-NULL,               
                   :ITMCLT-HIER-TYP-CDE:PV-HIER-TYP-CDE-NULL,                   
                   :ITMCLT-HIER-CDE:PV-HIER-CDE-NULL,                           
                   :ITMCLT-MDSE-NM-CDE:PV-MDSE-NM-CDE-NULL,                     
                   :ITMCLT-PROD-SERV-CDE:PV-PROD-SERV-CDE-NULL,                 
                   'MAKUP100',                                                  
                   SYSDATE,                                                     
                   'MAKUP100',                                                  
                   SYSDATE,                                                     
                   :ITMCLT-OWNER-ID:ITMCLT-OWNER-ID-NULL)                       
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZEROS                                               
               DISPLAY 'INSERT CLUSTER :'                                       
               DISPLAY 'ITEM-CLUSTR-ID   = ' ITMCLT-ITEM-CLUSTR-ID              
               DISPLAY 'ITEM-CLUSTR-NAME = ' ITMCLT-ITEM-CLUSTR-NAME            
               DISPLAY 'ITEM-CLUSTR-DESC = ' ITMCLT-ITEM-CLUSTR-DESC            
               DISPLAY 'HIER-CDE         = ' ITMCLT-HIER-CDE                    
               DISPLAY '*******************************************'            
                                                                                
             WHEN OTHER                                                         
               DISPLAY 'UNABLE TO INSERT CLUSTER :'                             
               DISPLAY 'ITEM-CLUSTR-ID   = ' NEW-ITEM-CLUSTR-ID                 
               DISPLAY 'ITEM-CLUSTR-NAME = ' NEW-ITEM-CLUSTR-NAME               
               DISPLAY 'ITEM-CLUSTR-DESC = ' NEW-ITEM-CLUSTR-DESC               
               DISPLAY 'HIER-CDE         = ' ITMCLT-HIER-CDE                    
               DISPLAY 'HIER-CDE-NULL    = ' PV-HIER-CDE-NULL                   
               DISPLAY 'ITMCLT-ITEM-CLUSTR-CDE= '                               
                                     ITMCLT-ITEM-CLUSTR-CDE                     
               DISPLAY 'ITMCLT-CLUSTR-TYP-CDE = '                               
                                      ITMCLT-CLUSTR-TYP-CDE                     
               DISPLAY 'ITMCLT-CLUSTR-TYP-CDE-NULL='                            
                                      PV-CLUSTR-TYP-CDE-NULL                    
               DISPLAY 'ITMCLT-HIER-TYP-CDE   = '                               
                                      ITMCLT-HIER-TYP-CDE                       
               DISPLAY 'ITMCLT-HIER-TYP-CDE-NULL='                              
                                      PV-HIER-TYP-CDE-NULL                      
               DISPLAY 'ITMCLT-MDSE-NM-CDE    = '                               
                                      ITMCLT-MDSE-NM-CDE                        
               DISPLAY 'ITMCLT-MDSE-NM-CDE-NULL= '                              
                                      PV-MDSE-NM-CDE-NULL                       
               DISPLAY 'ITMCLT-PROD-SERV-CDE  = '                               
                                      ITMCLT-PROD-SERV-CDE                      
               DISPLAY 'ITMCLT-PROD-SERV-CDE-NULL='                             
                                      PV-PROD-SERV-CDE-NULL                     
               DISPLAY 'ITMCLT-OWNER-ID       = ' ITMCLT-OWNER-ID               
               DISPLAY 'ITMCLT-OWNER-ID-NULL= '   PV-OWNER-ID-NULL              
               DISPLAY '*******************************************'            
               DISPLAY PV-ABEND-PARAGRAPH                                       
               PERFORM Z999-SQL-ERROR                                           
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      *     CREATE CLUSTER ID                                         *         
      *****************************************************************         
       C250-CREATE-CLUSTR-ID.                                                   
                                                                                
           MOVE 'C250-CREATE-CLUSTR-ID'  TO   PV-ABEND-PARAGRAPH.               
                                                                                
           EXEC SQL                                                             
               SELECT ITEM_CLUSTR_SEQ.NEXTVAL                                   
               INTO   :NEW-ITEM-CLUSTR-ID                                       
               FROM DUAL                                                        
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZEROS                                               
               CONTINUE                                                         
             WHEN OTHER                                                         
               DISPLAY PV-ABEND-PARAGRAPH                                       
               PERFORM Z999-SQL-ERROR                                           
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      * EXPIRE ALL RELATIONSHIPS WITH PARENTS FOR SELECTED SKU (ITEM)  *        
      * AND THEN EXPIRE THE SKU ITSELF.                                *        
      ******************************************************************        
       C410-EXPIRE-SKU-PARNT-REL.                                               
                                                                                
            PERFORM X100-REPLACE-SPEC-CHARS.                                    
            SET PS-MORE-PARENTS TO TRUE.                                        
                                                                                
            PERFORM  D250-OPEN-PARNT-CSR-SKU.                                   
                                                                                
            PERFORM  D260-FETCH-N-EXPIRE-PRNT-REL                               
              UNTIL  PS-NO-MORE-PARENTS.                                        
                                                                                
            PERFORM  D270-CLOSE-PARNT-CSR-SKU.                                  
                                                                                
            PERFORM  C455-EXPIRE-CLUSTER-SKU.                                   
                                                                                
      *****************************************************************         
      *                                                               *         
      *****************************************************************         
       C455-EXPIRE-CLUSTER-SKU.                                                 
           MOVE 'C455-EXPIRE-CLUSTER-SKU'                                       
                     TO  PV-ABEND-PARAGRAPH.                                    
           PERFORM  X100-REPLACE-SPEC-CHARS.                                    
           DISPLAY 'EXPIRE ITEM-CLUSTR-NAME =' ITMCLT-ITEM-CLUSTR-NAME.         
      *    DISPLAY '     EFF_END_TMST > ' PV-CURR-END-TMST                      
                                                                                
           EXEC SQL                                                             
             UPDATE   TITMCLT                                                   
             SET   EFF_END_TMST        = SYSDATE - 300,                         
                   LAST_UPD_BY_UID     = 'MAKUP100',                            
                   LAST_UPD_TMST       = SYSDATE                                
             WHERE                                                              
                      ITEM_CLUSTR_NAME = :ITMCLT-ITEM-CLUSTR-NAME               
                AND   HIER_CDE         IS NULL                                  
                AND   ITEM_CLUSTR_CDE = 'I'                                     
                AND   ((EFF_END_TMST IS NULL) OR                                
                      (EFF_END_TMST > :PV-CURR-END-TMST))                       
           END-EXEC.                                                            
                                                                                
FPSXXX*      SET   EFF_END_TMST        = :PV-CURRENT-TMST,                      
                                                                                
           EVALUATE TRUE                                                        
                                                                                
             WHEN SQLCODE = ZEROS                                               
               DISPLAY 'TITMCLT EXPIRED: ' ITMCLT-ITEM-CLUSTR-NAME              
               ADD 1 TO PV-ITEM-EXPIRED                                         
                                                                                
             WHEN SQLCODE = 1403                                                
               DISPLAY 'TITMCLT CLUSTER DOES NOT EXIST, NOT EXPIRED.'           
               DISPLAY ITMCLT-ITEM-CLUSTR-NAME                                  
                                                                                
             WHEN OTHER                                                         
               DISPLAY PV-ABEND-PARAGRAPH                                       
               PERFORM Z999-SQL-ERROR                                           
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      *                                                                *        
      ******************************************************************        
       C500-EXPIRE-RELATIONSHIPS.                                               
                                                                                
           MOVE 'C500-EXPIRE-RELATIONSHIPS'                                     
                     TO  PV-ABEND-PARAGRAPH.                                    
           EXEC SQL                                                             
             UPDATE   TITMCLC                                                   
              SET  EFF_END_TMST        =  :PV-CURRENT-TMST,                     
                   LAST_UPD_TMST       =  SYSDATE,                              
                   LAST_UPD_BY_UID     =  'MAKUP100'                            
               WHERE                                                            
                   PRNT_ITM_CLUSTR_ID  = :ITMCLC-PRNT-ITM-CLUSTR-ID             
              AND  CHLD_ITM_CLUSTR_ID  = :ITMCLC-CHLD-ITM-CLUSTR-ID             
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZEROS                                               
               DISPLAY 'TITMCLC EXPIRED: ' ITMCLT-ITEM-CLUSTR-NAME              
               DISPLAY 'PRNT_ITM_CLUSTR_ID=' ITMCLC-PRNT-ITM-CLUSTR-ID          
               DISPLAY 'CHLD_ITM_CLUSTR_ID=' ITMCLC-CHLD-ITM-CLUSTR-ID          
             WHEN SQLCODE = 1403                                                
               DISPLAY 'TITMCLC CLUSTER DOES NOT EXIST, NOT EXPIRED.'           
               DISPLAY 'PRNT_ITM_CLUSTR_ID=' ITMCLC-PRNT-ITM-CLUSTR-ID          
               DISPLAY 'CHLD_ITM_CLUSTR_ID=' ITMCLC-CHLD-ITM-CLUSTR-ID          
             WHEN OTHER                                                         
               DISPLAY PV-ABEND-PARAGRAPH                                       
               PERFORM Z999-SQL-ERROR                                           
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      *                                                                *        
      ******************************************************************        
       C600-CHECK-AND-REPAIR.                                                   
                                                                                
      *    FIRST, SELECT FROM TMDSEIT.                                          
      *    IF THERE IS NONE, USE THE STUFF FROM TSK TO INSERT ONE.              
      *    IF THERE'S ONE, BUT ANY OF THE FIELDS DON'T MATCH, UPDATE IT.        
                                                                                
           MOVE ITMCLT-ITEM-CLUSTR-ID TO MDSEIT-ITEM-CLUSTR-ID                  
           PERFORM W500-SELECT-TMDSEIT                                          
                                                                                
           IF FOUND-A-TMDSEIT                                                   
               PERFORM F500-COMPARE-AND-UPDATE-MDSEIT                           
           ELSE                                                                 
               IF NO-ERROR                                                      
      *           DISPLAY 'INSERT TMDSEIT FOR '                                 
      *            ITMCLT-ITEM-CLUSTR-ID ' ' ITMCLT-ITEM-CLUSTR-NAME            
                  PERFORM W530-SET-MDSEIT-NULLS                                 
                  PERFORM  W510-INSERT-TMDSEIT                                  
                  SET MODIFIED-ITEM TO TRUE                                     
               END-IF                                                           
           END-IF                                                               
                                                                                
      *    NEXT, GET THE GROUP PARENT.  IF THE GROUP ISN'T RIGHT,               
      *    EXPIRE THAT PARENT, GET THE REAL GROUP, AND INSERT PARENT REL.       
                                                                                
           IF NO-ERROR AND CC-FIX-GROUP = 'Y'                                   
              IF TSK-GROUP-CODE = SPACES                                        
                 PERFORM W625-SELECT-N-CORRECT-GRP                              
              ELSE                                                              
                 PERFORM W600-CHECK-PARENT-GROUP                                
              END-IF                                                            
           END-IF  .                                                            
                                                                                
      ******************************************************************        
      *                                                                *        
      ******************************************************************        
       C700-INSERT-ITMCLC.                                                      
                                                                                
           MOVE    'C700-INSERT-ITMCLC' TO PV-ABEND-PARAGRAPH.                  
      *    DISPLAY  '     '  PV-ABEND-PARAGRAPH.                                
           MOVE 'M'                    TO ITMCLC-REL-TYP-CDE.                   
           MOVE PC-NEG-1               TO PV-EFF-END-DTE-NULL.                  
                                                                                
           EXEC SQL                                                             
             INSERT INTO   TITMCLC                                              
                 (PRNT_ITM_CLUSTR_ID,                                           
                   CHLD_ITM_CLUSTR_ID,                                          
                   REL_TYP_CDE,                                                 
                   EFF_BEG_TMST,                                                
                   EFF_END_TMST,                                                
                   CRE_BY_UID,                                                  
                   CRE_TMST,                                                    
                   LAST_UPD_BY_UID,                                             
                   LAST_UPD_TMST,                                               
                   CHLD_ITM_CLSTR_CDE)                                          
               VALUES                                                           
                  (:ITMCLC-PRNT-ITM-CLUSTR-ID,                                  
                   :ITMCLC-CHLD-ITM-CLUSTR-ID,                                  
                   :ITMCLC-REL-TYP-CDE,                                         
                   SYSDATE,                                                     
                   :ITMCLC-EFF-END-TMST:PV-EFF-END-DTE-NULL,                    
                   'MAKUP100',                                                  
                   SYSDATE,                                                     
                   'MAKUP100',                                                  
                   SYSDATE,                                                     
                   :ITMCLC-CHLD-ITM-CLSTR-CDE:PV-CHLD-CDE-NULL)                 
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZEROS                                               
             DISPLAY 'TITMCLC INSERTED: '                                       
             DISPLAY 'PRNT-ITM-CLUSTR-ID = ' ITMCLC-PRNT-ITM-CLUSTR-ID          
             DISPLAY 'CHLD-ITM-CLUSTR-ID = ' ITMCLC-CHLD-ITM-CLUSTR-ID          
             WHEN SQLCODE = -1                                                  
             DISPLAY 'TITMCLC RELATIONSHIP ALREADY EXISTS: '                    
             DISPLAY 'PRNT-ITM-CLUSTR-ID = ' ITMCLC-PRNT-ITM-CLUSTR-ID          
             DISPLAY 'CHLD-ITM-CLUSTR-ID = ' ITMCLC-CHLD-ITM-CLUSTR-ID          
                                                                                
             EXEC SQL EXECUTE                                                   
               BEGIN                                                            
                   TITMCLC_TRIG_PKG.RESET_TABLE;                                
               END;                                                             
             END-EXEC                                                           
                                                                                
             EVALUATE TRUE                                                      
                WHEN SQLCODE = ZEROS                                            
                DISPLAY 'PLSQL TABLE RESET'                                     
                WHEN OTHER                                                      
                DISPLAY 'CAN NOT RESET PLSQL TABLE'                             
                PERFORM Z999-SQL-ERROR                                          
             END-EVALUATE                                                       
                                                                                
               CONTINUE                                                         
             WHEN OTHER                                                         
             DISPLAY 'PRNT-ITM-CLUSTR-ID = ' ITMCLC-PRNT-ITM-CLUSTR-ID          
             DISPLAY 'CHLD-ITM-CLUSTR-ID = ' ITMCLC-CHLD-ITM-CLUSTR-ID          
             DISPLAY PV-ABEND-PARAGRAPH                                         
             PERFORM Z999-SQL-ERROR                                             
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      *  EXPIRE RELATIONSHIP TO CURRENT (INCORRECT) GROUP.            *         
      *****************************************************************         
       C800-EXPIRE-CURR-GRP-REL.                                                
                                                                                
           EXEC SQL                                                             
               UPDATE TITMCLC                                                   
               SET EFF_END_TMST = SYSDATE,                                      
                   LAST_UPD_TMST = SYSDATE,                                     
                   LAST_UPD_BY_UID = 'MAKUP100'                                 
               WHERE CHLD_ITM_CLUSTR_ID = :ITMCLT-ITEM-CLUSTR-ID                
                 AND PRNT_ITM_CLUSTR_ID = :ITEM-PARENT-GROUP-ID                 
                 AND EFF_END_TMST IS NULL                                       
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZEROS                                               
               DISPLAY 'GROUP LEVEL TITMCLC EXPIRED'                            
               DISPLAY 'ITEM ID: ' ITMCLT-ITEM-CLUSTR-ID                        
               DISPLAY 'PARENT GROUP ID: ' ITEM-PARENT-GROUP-ID                 
               ADD 1 TO PV-GROUP-REL-EXPIRED                                    
             WHEN SQLCODE = +1403                                               
               DISPLAY 'NO GROUP REL TO CANCEL'                                 
               DISPLAY 'GROUP LEVEL TITMCLC NOT EXPIRED'                        
               DISPLAY 'ITEM ID: ' ITMCLT-ITEM-CLUSTR-ID                        
               DISPLAY 'PARENT GROUP ID: ' ITEM-PARENT-GROUP-ID                 
               CONTINUE                                                         
             WHEN OTHER                                                         
               DISPLAY ' C800-EXPIRE-CURR-GRP-REL '                             
               PERFORM Z999-SQL-ERROR                                           
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      *  FIND ITEM-CLUSTR-ID FOR CORRECT GROUP PARENT.                *         
      *****************************************************************         
       C825-FIND-GRP-INFO.                                                      
                                                                                
           SET NO-GRP TO TRUE.                                                  
           MOVE ITMCLT-ITEM-CLUSTR-NAME TO                                      
                    ITEM-PARENT-GROUP-NAME                                      
           MOVE TSK-GROUP-CODE TO ITEM-PARENT-GROUP-NAME(8:3)                   
                                                                                
           EXEC SQL                                                             
                   SELECT ITEM_CLUSTR_ID                                        
                   INTO  :ITEM-PARENT-GROUP-ID                                  
                   FROM   TITMCLT                                               
                   WHERE                                                        
                     ITEM_CLUSTR_NAME = :ITEM-PARENT-GROUP-NAME                 
                     AND HIER_CDE = 'GRP'                                       
                     AND OWNER_ID = :ITMCLT-OWNER-ID                            
                     AND EFF_END_TMST IS NULL                                   
           END-EXEC                                                             
                                                                                
           EVALUATE TRUE                                                        
                     WHEN SQLCODE = ZEROS                                       
                        SET FOUND-A-GRP TO TRUE                                 
                     WHEN SQLCODE = 1403                                        
                        DISPLAY 'GROUP ' ITEM-PARENT-GROUP-NAME                 
                                ' HAS NOT BEEN BRIDGED - CREATE IT'             
                     WHEN OTHER                                                 
                        DISPLAY 'C825-FIND-GRP-INFO '                           
                             ITEM-PARENT-GROUP-NAME                             
                        PERFORM Z999-SQL-ERROR                                  
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      *  GET A CLUSTR ID FOR A NEW GROUP, AND INSERT IT TO TITMCLT.   *         
      *****************************************************************         
       C850-CREATE-GRP.                                                         
                                                                                
           MOVE 'S' TO ITMCLT-CLUSTR-TYP-CDE                                    
           MOVE LOW-VALUES TO ITMCLT-MDSE-NM-CDE                                
           MOVE LOW-VALUES TO ITMCLT-PROD-SERV-CDE                              
           MOVE 'M'   TO    ITMCLT-HIER-TYP-CDE                                 
           MOVE 'C'   TO    ITMCLT-ITEM-CLUSTR-CDE                              
           MOVE 'GRP' TO    ITMCLT-HIER-CDE                                     
           MOVE ZEROES    TO  PV-HIER-CDE-NULL                                  
                                  PV-HIER-TYP-CDE-NULL                          
                                  PV-CLUSTR-TYP-CDE-NULL                        
                                  PV-CHLD-CDE-NULL                              
                                                                                
           MOVE PC-NEG-1  TO  PV-MDSE-NM-CDE-NULL                               
                                  PV-PROD-SERV-CDE-NULL                         
                                  PV-EFF-END-DTE-NULL                           
                                                                                
           MOVE SPACES      TO    NEW-ITEM-CLUSTR-NAME                          
           STRING  TSK-MERCH-DEPT-NMBR  DELIMITED BY SIZE                       
                       '-' DELIMITED BY SIZE                                    
                       TSK-MERCH-CLASS-NMBR DELIMITED BY SIZE                   
                       '-' DELIMITED BY SIZE                                    
                       TSK-GROUP-CODE   DELIMITED BY SIZE                       
                             INTO    NEW-ITEM-CLUSTR-NAME                       
           MOVE NEW-ITEM-CLUSTR-NAME TO NEW-ITEM-CLUSTR-DESC.                   
           PERFORM C200-INSERT-TITMCLT.                                         
           IF NO-ERROR                                                          
              MOVE NEW-ITEM-CLUSTR-ID TO  ITEM-PARENT-GROUP-ID                  
              ADD 1 TO  PV-GROUP-INSERTED                                       
           END-IF.                                                              
                                                                                
      *****************************************************************         
      *  BUILD   GROUP CLUSTERS AND  THEIR                            *         
      *  RELATIONSHIPS TO SKU ITEM.                                   *         
      *****************************************************************         
       C900-PROCESS-GRP-INFO.                                                   
                                                                                
               MOVE 'S' TO ITMCLT-CLUSTR-TYP-CDE                                
               MOVE LOW-VALUES TO ITMCLT-MDSE-NM-CDE                            
               MOVE LOW-VALUES TO ITMCLT-PROD-SERV-CDE                          
                                                                                
               MOVE 'M'   TO    ITMCLT-HIER-TYP-CDE                             
               MOVE 'C'   TO    ITMCLT-ITEM-CLUSTR-CDE                          
                                                                                
               MOVE 'GRP' TO    ITMCLT-HIER-CDE                                 
                                                                                
               MOVE ZEROES    TO  PV-HIER-CDE-NULL                              
                                  PV-HIER-TYP-CDE-NULL                          
                                  PV-CLUSTR-TYP-CDE-NULL                        
                                  PV-OWNER-ID-NULL                              
                                  PV-CHLD-CDE-NULL                              
                                                                                
               MOVE PC-NEG-1  TO  PV-MDSE-NM-CDE-NULL                           
                                  PV-PROD-SERV-CDE-NULL                         
                                                                                
               MOVE SPACES      TO    ITMCLT-ITEM-CLUSTR-NAME                   
               STRING  TSK-MERCH-DEPT-NMBR  DELIMITED BY SIZE                   
                       '-' DELIMITED BY SIZE                                    
                       TSK-MERCH-CLASS-NMBR DELIMITED BY SIZE                   
                       '-' DELIMITED BY SIZE                                    
                       TSK-GROUP-CODE   DELIMITED BY SIZE                       
                             INTO    ITMCLT-ITEM-CLUSTR-NAME                    
               MOVE ITMCLT-ITEM-CLUSTR-NAME TO ITMCLT-ITEM-CLUSTR-DESC          
               PERFORM  C825-FIND-GRP-INFO                                      
               IF NO-ERROR                                                      
                  IF NO-GRP                                                     
                     PERFORM  C850-CREATE-GRP                                   
                  END-IF                                                        
                                                                                
      *********** INSERT GROUP CLUSTR AND RELATIONSHIPS **************          
      *                                                              *          
      *                                                              *          
                 IF NO-ERROR                                                    
                    MOVE ITMCLT-ITEM-CLUSTR-ID TO                               
                                            ITMCLC-CHLD-ITM-CLUSTR-ID           
                    MOVE ITEM-PARENT-GROUP-ID TO                                
                                            ITMCLC-PRNT-ITM-CLUSTR-ID           
                                            PV-GRP-CHLD-CLUSTR-ID               
                    MOVE 'M'         TO ITMCLC-REL-TYP-CDE                      
                    MOVE 'I'         TO ITMCLC-CHLD-ITM-CLSTR-CDE               
                    PERFORM C700-INSERT-ITMCLC                                  
                    IF NO-ERROR                                                 
                      ADD 1 TO PV-GROUP-REL-INSERTED                            
                    END-IF                                                      
                  END-IF                                                        
               END-IF.                                                          
                                                                                
      ******************************************************************        
      *                                                                *        
      ******************************************************************        
       D250-OPEN-PARNT-CSR-SKU.                                                 
           MOVE 'D250-OPEN-PARNT-SKU-CSR'                                       
                     TO  PV-ABEND-PARAGRAPH.                                    
TEST  *    DISPLAY '   OPENING CURSOR TO EXPIRE PARENT RELS FOR'                
TEST  *    DISPLAY '     ITEM_CLUSTR_NAME = ' ITMCLT-ITEM-CLUSTR-NAME           
TEST  *    DISPLAY '     EFF_END_TMST > '                                       
TEST  *              PV-CURR-END-TMST                                           
           EXEC SQL                                                             
               OPEN  PRNTSKU                                                    
           END-EXEC.                                                            
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZEROS                                               
                CONTINUE                                                        
             WHEN SQLCODE = 1403                                                
               SET PS-NO-MORE-PARENTS TO TRUE                                   
             WHEN OTHER                                                         
               DISPLAY PV-ABEND-PARAGRAPH                                       
               PERFORM Z999-SQL-ERROR                                           
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      *                                                                *        
      ******************************************************************        
       D260-FETCH-N-EXPIRE-PRNT-REL.                                            
           MOVE 'D260-FETCH-N-EXPIRE-PRNT-REL'                                  
                     TO  PV-ABEND-PARAGRAPH.                                    
           EXEC SQL                                                             
               FETCH PRNTSKU                                                    
               INTO  :ITMCLC-CHLD-ITM-CLUSTR-ID,                                
                     :ITMCLC-PRNT-ITM-CLUSTR-ID                                 
           END-EXEC.                                                            
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZEROS                                               
                                                                                
               PERFORM C500-EXPIRE-RELATIONSHIPS                                
                                                                                
                                                                                
             WHEN SQLCODE = 1403                                                
               SET PS-NO-MORE-PARENTS   TO TRUE                                 
             WHEN OTHER                                                         
               DISPLAY PV-ABEND-PARAGRAPH                                       
               PERFORM Z999-SQL-ERROR                                           
           END-EVALUATE.                                                        
      ******************************************************************        
      *                                                                *        
      ******************************************************************        
       D270-CLOSE-PARNT-CSR-SKU.                                                
           MOVE 'D270-CLOSE-PARNT-CSR-SKU' TO PV-ABEND-PARAGRAPH.               
           EXEC SQL                                                             
              CLOSE  PRNTSKU                                                    
           END-EXEC.                                                            
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZEROS                                               
               CONTINUE                                                         
                                                                                
             WHEN OTHER                                                         
               DISPLAY PV-ABEND-PARAGRAPH                                       
               PERFORM Z999-SQL-ERROR                                           
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      *                                                                *        
      ******************************************************************        
       F500-COMPARE-AND-UPDATE-MDSEIT.                                          
                                                                                
      *    DISPLAY 'F500-COMPARE-AND-UPDATE-MDSEIT'                             
           SET TMDSEIT-OKAY TO TRUE.                                            
FPSY2K*    IF ( (TSK-STAT-CHNGD-DATE  = 9999999)                                
FPSY2K*       OR (TSK-STAT-CHNGD-DATE  = 999999)                                
FPSY2K*       OR (TSK-STAT-CHNGD-DATE  = 9999990) )                             
FPSY2K     IF TSK-STAT-CHNGD-DATE = 0                                           
               MOVE SPACES TO COMPARE-STAT-CHNG-DTE                             
           ELSE                                                                 
              IF    TSK-STAT-CHNGD-DATE    > ZERO                               
                MOVE  TSK-STAT-CHNGD-DATE    TO  PV-STAT-CHNGD-DATE             
                MOVE  PV-STAT-CHNGD-DATE(1:2) TO WS-DB-YY                       
      *         DISPLAY 'PV-STAT-CHNGD-DATE: ' PV-STAT-CHNGD-DATE               
                IF WS-DB-YY(1:1) < '8'                                          
                   MOVE '20'      TO  WS-DB-CC                                  
                ELSE                                                            
                   MOVE '19'      TO  WS-DB-CC                                  
                END-IF                                                          
                MOVE  PV-STAT-CHNGD-DATE(3:2) TO WS-DB-MO                       
                MOVE  PV-STAT-CHNGD-DATE(5:2) TO WS-DB-DD                       
      *         DISPLAY 'WS-DB2-DATE : ' WS-DB2-DATE                            
                MOVE  WS-DB2-DATE             TO COMPARE-STAT-CHNG-DTE          
              ELSE                                                              
                MOVE  SPACES                  TO COMPARE-STAT-CHNG-DTE          
              END-IF                                                            
           END-IF                                                               
           IF WS-DB-MO = '99'                                                   
               MOVE SPACES TO COMPARE-STAT-CHNG-DTE                             
               MOVE PC-NEG-1 TO PV-STAT-CHNG-DTE-NULL                           
           END-IF                                                               
           IF ( MDSEIT-STAT-CDE NOT = TSK-STATUS-CODE )                         
              SET TMDSEIT-STAT-MISMATCH TO TRUE                                 
           END-IF                                                               
           IF ( ( MDSEIT-SIZE-DESC NOT = TSK-LONG-SIZE-DESC ) OR                
                ( MDSEIT-COLOR-DESC NOT = TSK-LONG-COLOR-DESC ) )               
              SET TMDSEIT-DESC-MISMATCH TO TRUE                                 
           END-IF                                                               
           IF (                                                                 
                ( MDSEIT-VNDR-INHOUSE-NBR NOT =                                 
                              TSK-VNDR-IN-HSE-NMBR ) OR                         
                ( MDSEIT-VNDR-STYL-ID NOT =                                     
                              TSK-VNDR-STYL-ID )                                
                OR ( MDSEIT-ENT-ID NOT = TSK-ENT-ID )                           
               )                                                                
              SET TMDSEIT-VNDR-MISMATCH TO TRUE                                 
           END-IF                                                               
           INSPECT MDSEIT-GRP-RTL-AMT                                           
                   REPLACING LEADING SPACE BY ZERO                              
           INSPECT MDSEIT-UNIT-RTL-AMT                                          
                   REPLACING LEADING SPACE BY ZERO                              
           IF ( ( MDSEIT-GRP-QTY NOT = TSK-GP-QTY )                             
                    OR                                                          
                ( MDSEIT-GRP-RTL-AMT NOT =                                      
                              MY-GP-RTL-AMT ) OR                                
                ( MDSEIT-UNIT-RTL-AMT                                           
                     NOT = MY-CUR-UNIT-RTL-AMT )                                
               )                                                                
              SET TMDSEIT-AMT-MISMATCH TO TRUE                                  
           END-IF                                                               
           IF ( MDSEIT-UNIT-RTL-UOM-CDE NOT =                                   
                              TSK-UNIT-RTL-UOM-CDE )                            
              SET TMDSEIT-CDE-MISMATCH TO TRUE                                  
           END-IF                                                               
           IF ( MDSEIT-STAT-CHNG-DTE NOT =                                      
                              COMPARE-STAT-CHNG-DTE )                           
              SET TMDSEIT-DATE-MISMATCH TO TRUE                                 
           END-IF                                                               
           IF TMDSEIT-MISMATCH                                                  
              DISPLAY '   . . . . . . . . . . . . . . . . . . . . . .'          
              DISPLAY '   TMDSEIT MIS-MATCH ON '                                
                                               ITMCLT-ITEM-CLUSTR-NAME          
              IF TMDSEIT-DATE-MISMATCH                                          
                DISPLAY '   DATES: ' MDSEIT-STAT-CHNG-DTE '  '                  
                   TSK-STAT-CHNGD-DATE                                          
                   ' (' COMPARE-STAT-CHNG-DTE  ')'                              
              END-IF                                                            
              IF TMDSEIT-STAT-MISMATCH                                          
                DISPLAY '   STATUS: ' MDSEIT-STAT-CDE '  '                      
                              TSK-STATUS-CODE                                   
              END-IF                                                            
              IF TMDSEIT-DESC-MISMATCH                                          
                DISPLAY '   SIZE:  ' MDSEIT-SIZE-DESC '  '                      
                              TSK-LONG-SIZE-DESC                                
                DISPLAY '   COLOR: ' MDSEIT-COLOR-DESC '  '                     
                              TSK-LONG-COLOR-DESC                               
              END-IF                                                            
              IF TMDSEIT-VNDR-MISMATCH                                          
                DISPLAY '   VNDR-INH:  ' MDSEIT-VNDR-INHOUSE-NBR                
                     '  ' MY-VNDR-IN-HSE-NMBR                                   
                DISPLAY '   VNDR-STYL: ' MDSEIT-VNDR-STYL-ID                    
                     '  ' TSK-VNDR-STYL-ID                                      
              END-IF                                                            
              IF TMDSEIT-AMT-MISMATCH                                           
                DISPLAY '   UNIT-RTL: ' MDSEIT-UNIT-RTL-AMT '  '                
                              MY-CUR-UNIT-RTL-AMT                               
                DISPLAY '   GRP-QTY:  ' MDSEIT-GRP-QTY '  '                     
                              TSK-GP-QTY                                        
                DISPLAY '   GRP-RTL:  ' MDSEIT-GRP-RTL-AMT '  '                 
                              MY-GP-RTL-AMT                                     
              END-IF                                                            
              IF TMDSEIT-CDE-MISMATCH                                           
                DISPLAY '   RTL-UOM: ' MDSEIT-UNIT-RTL-UOM-CDE                  
                     '  ' TSK-UNIT-RTL-UOM-CDE                                  
              END-IF                                                            
              DISPLAY '   . . . . . . . . . . . . . . . . . . . . . .'          
                                                                                
              IF MDSEIT-ENT-ID NOT = TSK-ENT-ID                                 
      *          DISPLAY '   ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! !'           
                 DISPLAY '   VENDOR (ENT-ID) MIS-MATCH ON '                     
                                      ITMCLT-ITEM-CLUSTR-NAME                   
                 DISPLAY '   ' MDSEIT-ENT-ID '  ' TSK-ENT-ID                    
      *          DISPLAY '   ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! !'           
              END-IF                                                            
                                                                                
              PERFORM W530-SET-MDSEIT-NULLS                                     
              PERFORM W520-UPDATE-TMDSEIT                                       
              SET MODIFIED-ITEM TO TRUE                                         
           END-IF.                                                              
                                                                                
FPS   ******************************************************************        
FPS   * S100-OPEN-DEPT-CURSOR.                                         *        
FPS   ******************************************************************        
FPS    S100-OPEN-DEPT-CURSOR.                                                   
FPS        MOVE 'S100-OPEN-DEPT-CSR'                                            
FPS                  TO  PV-ABEND-PARAGRAPH.                                    
FPS        DISPLAY '   OPENING CURSOR TO GET THE DEPARTMENT'                    
FPS        EXEC SQL                                                             
FPS            OPEN  GETDEPT                                                    
FPS        END-EXEC.                                                            
FPS        EVALUATE TRUE                                                        
FPS          WHEN SQLCODE = ZEROS                                               
FPS             CONTINUE                                                        
FPS          WHEN SQLCODE = 1403                                                
FPS            SET PS-NO-MORE-DEPTS TO TRUE                                     
FPS          WHEN OTHER                                                         
FPS            DISPLAY PV-ABEND-PARAGRAPH                                       
FPS            PERFORM Z999-SQL-ERROR                                           
FPS        END-EVALUATE.                                                        
FPS                                                                             
FPS   ****************************************************************          
FPS   * S150-FETCH-DEPT-CURSOR.                                      *          
FPS   ****************************************************************          
FPS    S150-FETCH-DEPT-CURSOR.                                                  
FPS   *    DISPLAY 'S150 FETCH DEPARTMENT RECORD'.                              
FPS                                                                             
FPS        EXEC SQL                                                             
FPS            FETCH GETDEPT                                                    
FPS            INTO                                                             
FPS                 :DPPRCT-PRC-NM,                                             
FPS                 :DPPRCT-EFF-BEG-TMST                                        
FPS        END-EXEC.                                                            
FPS                                                                             
FPS        EVALUATE TRUE                                                        
FPS          WHEN SQLCODE = ZEROS                                               
FPS             DISPLAY '  '                                                    
FPS             DISPLAY '******************************'                        
FPS             DISPLAY 'PROCESSING FOR DEPT: ' DPPRCT-PRC-NM                   
FPS             DISPLAY 'BEGINING DATE:       ' DPPRCT-EFF-BEG-TMST             
FPS             DISPLAY '******************************'                        
FPS             DISPLAY '  '                                                    
FPS             MOVE DPPRCT-EFF-BEG-TMST TO CC-INPUT-DATA-DATE                  
FPS             MOVE DPPRCT-PRC-NM      TO WS-DEPT-DATA                         
FPS             MOVE WS-INPUT-DATA-DEPT TO CC-INPUT-DATA-DEPT                   
FPS             MOVE WS-FIX-GROUP       TO CC-FIX-GROUP                         
FPS          WHEN SQLCODE = 1403                                                
FPS             SET PS-NO-MORE-DEPTS TO TRUE                                    
FPS          WHEN OTHER                                                         
FPS             DISPLAY 'S150-FETCH-DEPT-CURSOR'                                
FPS             DISPLAY 'ERROR ON FETCH OF GETDEPT CURSOR'                      
FPS             PERFORM Z999-SQL-ERROR                                          
FPS         END-EVALUATE.                                                       
FPS                                                                             
FPS   ****************************************************************          
FPS   * S175-UPDATE-TDPPRCT.                                         *          
FPS   ****************************************************************          
FPS    S175-UPDATE-TDPPRCT.                                                     
FPS        DISPLAY 'S175-UPDATE-TDPPRCT'.                                       
FPS                                                                             
FPS        EXEC SQL                                                             
FPS          UPDATE  TDPPRCT                                                    
FPS            SET  EFF_END_TMST = :PV-CURRENT-TMST,                            
FPS                 PRC_TMST     = SYSDATE                                      
FPS          WHERE  APPL_ID      = 'MA'                                         
FPS            AND  PRC_STAT_CDE = 'A'                                          
FPS            AND  PRC_TXT      = 'MAK100'                                     
FPS        END-EXEC.                                                            
FPS   *        AND  PRC_NM       = :DPPRCT-PRC-NM                               
FPS                                                                             
FPS        DISPLAY 'S175 SQLCODE: ' SQLCODE.                                    
FPS                                                                             
FPS        EVALUATE TRUE                                                        
FPS          WHEN SQLCODE = ZEROS                                               
FPS             CONTINUE                                                        
FPS          WHEN SQLCODE = 1403                                                
FPS             DISPLAY 'EXPIRE DATE: ' PV-CURRENT-TMST                         
FPS             DISPLAY 'DEPT RECORD: ' DPPRCT-PRC-NM                           
FPS          WHEN OTHER                                                         
FPS             DISPLAY 'S175-UPDATE-TDPPRCT'                                   
FPS             DISPLAY 'ERROR ON UPDATING TDPPRCT'                             
FPS             DISPLAY 'FOR RECORD: ' DPPRCT-PRC-NM                            
FPS             PERFORM Z999-SQL-ERROR                                          
FPS         END-EVALUATE.                                                       
FPS                                                                             
FPS   ****************************************************************          
FPS   * S200-CLOSE-DEPT-CURSOR                                       *          
FPS   ****************************************************************          
FPS    S200-CLOSE-DEPT-CURSOR.                                                  
FPS        DISPLAY 'CLOSING GETDEPT CURSOR'.                                    
FPS                                                                             
FPS        EXEC SQL                                                             
FPS            CLOSE  GETDEPT                                                   
FPS        END-EXEC.                                                            
FPS                                                                             
FPS        DISPLAY 'S200 SQLCODE: ' SQLCODE.                                    
FPS                                                                             
FPS        EVALUATE TRUE                                                        
FPS          WHEN SQLCODE = ZEROS                                               
FPS             CONTINUE                                                        
FPS          WHEN OTHER                                                         
FPS            DISPLAY 'S200-CLOSE-DEPT-CURSOR  -- UNABLE TO CLOSE'             
FPS            PERFORM Z999-SQL-ERROR                                           
FPS        END-EVALUATE.                                                        
FPS                                                                             
      ****************************************************************          
      *                                                              *          
      ****************************************************************          
       V175-FETCH-ITEM-LOOP.                                                    
                                                                                
           SET NEED-AN-ITEM-TO-FIX TO TRUE                                      
           PERFORM UNTIL ( DONE-FIXING-ITEMS OR (NOT NO-ERROR)                  
              OR GOT-AN-ITEM)                                                   
              PERFORM W175-FETCH-ITEM-CURSOR                                    
              IF GOT-AN-ITEM                                                    
                 SET ITEM-UNTOUCHED TO TRUE                                     
                 CONTINUE                                                       
              ELSE                                                              
                 IF DONE-FIXING-SUBCLASS                                        
                    PERFORM W150-CLOSE-ITEM-CURSOR                              
                    PERFORM W300-COMMIT-ETC                                     
                    PERFORM W200-INCREMENT-SUBCLASS                             
                    IF (NO-ERROR AND NOT-DONE-FIXING-ITEMS)                     
                        PERFORM W100-OPEN-ITEM-CURSOR                           
                    END-IF                                                      
                 ELSE                                                           
                    SET ERROR-EXISTS TO TRUE                                    
                    DISPLAY 'V175-FETCH-ITEM-LOOP UNABLE TO FETCH'              
                 END-IF                                                         
              END-IF                                                            
           END-PERFORM.                                                         
                                                                                
      ****************************************************************          
      *                                                              *          
      ****************************************************************          
       W100-OPEN-ITEM-CURSOR.                                                   
                                                                                
      *    DISPLAY ' '.                                                         
      *    DISPLAY '*****************************************'.                 
      *    DISPLAY 'OPENING FIXITEM CURSOR FOR'.                                
      *    DISPLAY '    ITEM_CLUSTR_NAME > ' PREV-ITEM-CLUSTR-NAME.             
      *    DISPLAY ' '.                                                         
                                                                                
           EXEC SQL                                                             
               OPEN  FIXITEM                                                    
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZEROS                                               
               CONTINUE                                                         
      *      WHEN SQLCODE = 1403                                                
      *        SET DONE-FIXING-SUBCLASS TO TRUE                                 
      *        DISPLAY 'UNABLE TO OPEN FIXITEM CURSOR'                          
      *        CONTINUE                                                         
             WHEN OTHER                                                         
               DISPLAY 'UNABLE TO OPEN FIXITEM CURSOR'                          
               DISPLAY 'W100-OPEN-ITEM-CURSOR'                                  
               PERFORM Z999-SQL-ERROR                                           
           END-EVALUATE.                                                        
                                                                                
      ****************************************************************          
      *                                                              *          
      ****************************************************************          
       W150-CLOSE-ITEM-CURSOR.                                                  
           EXEC SQL                                                             
               CLOSE  FIXITEM                                                   
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZEROS                                               
                CONTINUE                                                        
             WHEN OTHER                                                         
               DISPLAY 'W150-CLOSE-ITEM-CURSOR  -- UNABLE TO CLOSE'             
               PERFORM Z999-SQL-ERROR                                           
           END-EVALUATE.                                                        
                                                                                
      ****************************************************************          
      *                                                              *          
      ****************************************************************          
       W175-FETCH-ITEM-CURSOR.                                                  
                                                                                
                                                                                
           EXEC SQL                                                             
               FETCH FIXITEM                                                    
               INTO                                                             
                    :ITMCLT-ITEM-CLUSTR-ID,                                     
                    :ITMCLT-ITEM-CLUSTR-NAME,                                   
                    :ITMCLT-OWNER-ID     :ITMCLT-OWNER-ID-NULL,                 
                    :ITMCLT-LAST-UPD-TMST                                       
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZEROS                                               
                MOVE ITMCLT-ITEM-CLUSTR-NAME TO                                 
                                PREV-ITEM-CLUSTR-NAME                           
                ADD 1 TO PV-ITEMS-FETCHED                                       
                ADD 1 TO FETCHES-SINCE-LAST-COMMIT                              
      *         DISPLAY 'FETCHED ' ITMCLT-ITEM-CLUSTR-NAME                      
                SET NOT-DONE-FIXING-SUBCLASS TO TRUE                            
                SET GOT-AN-ITEM TO TRUE                                         
             WHEN SQLCODE = 1403                                                
                SET DONE-FIXING-SUBCLASS TO TRUE                                
      *         DISPLAY 'NO MORE ITEMS FOR ' PV-LIKE-SUBCLASS                   
             WHEN OTHER                                                         
                DISPLAY 'W175-FETCH-ITEM-CURSOR'                                
                DISPLAY 'ERROR ON FETCH OF FIXITEM CURSOR'                      
                PERFORM Z999-SQL-ERROR                                          
            END-EVALUATE.                                                       
                                                                                
      ****************************************************************          
      *                                                              *          
      ****************************************************************          
       W200-INCREMENT-SUBCLASS.                                                 
                                                                                
TEST  *    DISPLAY ' '                                                          
TEST  *    DISPLAY '-----------------------------------------'                  
TEST  *    DISPLAY 'INCREMENTING SUBCLASS FROM '                                
      *               PREV-ITEM-CLUSTR-NAME                                     
TEST  *    DISPLAY ' '                                                          
                                                                                
                EXEC SQL                                                        
                   SELECT   /*+  INDEX(TITMCLT IITMCLT1) */                     
                   ITEM_CLUSTR_NAME                                             
                   INTO   :ITMCLT-ITEM-CLUSTR-NAME                              
                   FROM   TITMCLT                                               
                   WHERE                                                        
                     ITEM_CLUSTR_CDE IN ('I')                                   
                     AND  MDSE_NM_CDE IN ('M')                                  
                     AND  PROD_SERV_CDE IN ('P')                                
                     AND  EFF_END_TMST IS NULL                                  
                     AND  ITEM_CLUSTR_NAME > :PREV-ITEM-CLUSTR-NAME             
                     AND  LAST_UPD_TMST >  :START-HERE-TMST                     
                   ORDER BY ITEM_CLUSTR_NAME                                    
                 END-EXEC                                                       
                                                                                
                 EVALUATE TRUE                                                  
                     WHEN SQLCODE = ZEROS                                       
                     WHEN SQLCODE = 2112                                        
                     WHEN SQLCODE = -2112                                       
                        SET NOT-DONE-FIXING-SUBCLASS TO TRUE                    
      *                 DISPLAY '      NEXT ITEM '                              
      *                                ITMCLT-ITEM-CLUSTR-NAME                  
                        MOVE ITMCLT-ITEM-CLUSTR-NAME TO                         
                                  PV-LIKE-SUBCLASS                              
                        MOVE '%' TO PV-LIKE-SUBCLASS(8:1)                       
                        MOVE SPACES TO PREV-ITEM-CLUSTR-NAME                    
                        MOVE ITMCLT-ITEM-CLUSTR-NAME(1:9) TO                    
                                  PREV-ITEM-CLUSTR-NAME                         
                        IF CC-INPDD-DPT NOT =                                   
                               ITMCLT-ITEM-CLUSTR-NAME(1:3)                     
      *                    DISPLAY '%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%'            
      *                    DISPLAY '  DONE WITH DEPT ' CC-INPDD-DPT             
      *                    DISPLAY '%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%'            
                           SET DONE-FIXING-ITEMS TO TRUE                        
                        END-IF                                                  
                        MOVE SPACES TO ITMCLT-ITEM-CLUSTR-NAME                  
                     WHEN SQLCODE = 1403                                        
TEST  *                 DISPLAY '      NO ITEMS WHERE '                         
      *                   ' ITEM_CLUSTR_NAME > ' PV-LIKE-SUBCLASS               
                        SET DONE-FIXING-ITEMS TO TRUE                           
                        CONTINUE                                                
                     WHEN OTHER                                                 
                        DISPLAY 'W200-INCREMENT-SUBCLASS'                       
TESTFP                  DISPLAY 'START HERE: ' START-HERE-TMST                  
                        DISPLAY                                                 
                          '  ERROR CHECKING IF SUBCLASS IS VALID'               
                        PERFORM Z999-SQL-ERROR                                  
                 END-EVALUATE  .                                                
      *    IF NO-ERROR AND (NOT DONE-FIXING-ITEMS)                              
      *      DISPLAY 'TO: ' PV-LIKE-SUBCLASS                                    
TEST  *      DISPLAY '---------------------------------------'                  
      *    END-IF.                                                              
                                                                                
      ****************************************************************          
      *                                                              *          
      ****************************************************************          
       W300-COMMIT-ETC.                                                         
                                                                                
           MOVE 0 TO FETCHES-SINCE-LAST-COMMIT                                  
                                                                                
           EXEC SQL                                                             
               COMMIT                                                           
           END-EXEC.                                                            
                                                                                
           MOVE 0 TO FIXES-SINCE-LAST-COMMIT.                                   
                                                                                
      ****************************************************************          
      *                                                                *        
      ******************************************************************        
       W400-SELECT-TSK.                                                         
                                                                                
           MOVE 'W400-SELECT-TSK'                                               
                      TO  PV-ABEND-PARAGRAPH.                                   
           SET NO-TSK TO TRUE                                                   
           MOVE ITMCLT-ITEM-CLUSTR-NAME(1:3) TO TSK-MERCH-DEPT-NMBR             
           MOVE ITMCLT-ITEM-CLUSTR-NAME(5:2) TO TSK-MERCH-CLASS-NMBR            
           MOVE ITMCLT-ITEM-CLUSTR-NAME(8:3) TO TSK-SEQ-NMBR                    
           MOVE ZEROES TO TSK-STAT-CHNGD-DATE,                                  
           IF ( (TSK-MERCH-DEPT-NMBR < '010') OR                                
                    (TSK-MERCH-DEPT-NMBR < '010') )                             
             SET ERROR-EXISTS TO TRUE                                           
             DISPLAY 'INVALID DPT OF *' TSK-MERCH-DEPT-NMBR                     
                     '* IN W400-SELECT-TSK'                                     
           ELSE                                                                 
           EXEC SQL                                                             
              SELECT                                                            
                     STATUS_CODE,                                               
                     STAT_CHNGD_DATE,                                           
                     LONG_VENDOR_STYLE,                                         
                     VNDR_IN_HSE_NMBR,                                          
                     LONG_SIZE_DESC,                                            
                     LONG_COLOR_DESC,                                           
                     GROUP_CODE,                                                
                     GP_QTY,                                                    
                     GP_RTL_AMT,                                                
                     CUR_UNIT_RTL_AMT,                                          
                     RTL_UNIT_MSRMNT,                                           
                     ENT_ID                                                     
              INTO   :MY-STATUS-CODE,                                           
                     :MY-STAT-CHNGD-DATE,                                       
                     :TSK-VNDR-STYL-ID,                                         
                     :MY-VNDR-IN-HSE-NMBR,                                      
                     :TSK-LONG-SIZE-DESC,                                       
                     :TSK-LONG-COLOR-DESC,                                      
                     :TSK-GROUP-CODE,                                           
                     :MY-GP-QTY,                                                
                     :MY-GP-RTL-AMT,                                            
                     :MY-CUR-UNIT-RTL-AMT,                                      
                     :TSK-UNIT-RTL-UOM-CDE,                                     
                     :MY-ENT-ID                                                 
              FROM TSK                                                          
              WHERE MERCH_DEPT_NMBR   =:TSK-MERCH-DEPT-NMBR                     
                AND MERCH_CLASS_NMBR  =:TSK-MERCH-CLASS-NMBR                    
                AND SEQ_NMBR          =:TSK-SEQ-NMBR                            
           END-EXEC                                                             
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZEROS                                               
                                                                                
             SET FOUND-A-TSK TO TRUE                                            
             INSPECT MY-STATUS-CODE                                             
                  REPLACING LEADING SPACE BY ZERO                               
             MOVE MY-STATUS-CODE       TO INTERMED-PIC-9-3                      
TEST  *      DISPLAY 'STATUS-CODE *'   MY-STATUS-CODE '*'                       
TEST  *      DISPLAY 'STATUS-CODE '    INTERMED-PIC-9-3                         
             MOVE INTERMED-PIC-9-3     TO TSK-STATUS-CODE                       
             INSPECT MY-ENT-ID                                                  
                  REPLACING LEADING SPACE BY ZERO                               
             MOVE MY-ENT-ID(2:10)      TO INTERMED-PIC-9-10                     
TEST  *      DISPLAY 'ENT-ID *'        MY-ENT-ID '*'                            
TEST  *      DISPLAY 'ENT-ID '         INTERMED-PIC-9-10                        
             MOVE INTERMED-PIC-9-10    TO TSK-ENT-ID                            
             INSPECT MY-VNDR-IN-HSE-NMBR                                        
                  REPLACING LEADING SPACE BY ZERO                               
             MOVE MY-VNDR-IN-HSE-NMBR                                           
                                  TO INTERMED-PIC-9-3                           
TEST  *      DISPLAY 'VNDR-IN-HSE-NMBR *' MY-VNDR-IN-HSE-NMBR                   
TEST  *                               '*'                                       
TEST  *      DISPLAY 'VNDR-IN-HSE-NMBR ' INTERMED-PIC-9-3                       
             MOVE INTERMED-PIC-9-3     TO TSK-VNDR-IN-HSE-NMBR                  
             INSPECT MY-GP-QTY                                                  
                  REPLACING LEADING SPACE BY ZERO                               
             MOVE MY-GP-QTY            TO INTERMED-PIC-9-3                      
TEST  *      DISPLAY 'GP-QTY *'        MY-GP-QTY '*'                            
TEST  *      DISPLAY 'GP-QTY '         INTERMED-PIC-9-3                         
             MOVE INTERMED-PIC-9-3     TO TSK-GP-QTY                            
             INSPECT MY-GP-RTL-AMT                                              
                  REPLACING LEADING SPACE BY ZERO                               
             MOVE MY-GP-RTL-AMT(4:7)   TO INTERMED-PIC-X-7V                     
TEST  *      DISPLAY 'GP-RTL-AMT *'    MY-GP-RTL-AMT '*'                        
TEST  *      DISPLAY 'GP-RTL-AMT '     INTERMED-PIC-9-5V2                       
             INSPECT MY-CUR-UNIT-RTL-AMT                                        
                  REPLACING LEADING SPACE BY ZERO                               
             MOVE MY-CUR-UNIT-RTL-AMT(4:7)  TO INTERMED-PIC-X-7V                
TEST  *      DISPLAY 'CURR-UNIT-RTL-AMT *'                                      
TEST  *                          MY-CUR-UNIT-RTL-AMT '*'                        
TEST  *      DISPLAY 'CURR-UNIT-RTL-AMT ' INTERMED-PIC-9-5V2                    
             INSPECT MY-STAT-CHNGD-DATE                                         
                  REPLACING LEADING SPACE BY ZERO                               
             MOVE MY-STAT-CHNGD-DATE(2:6) TO INTERMED-PIC-X-7                   
TEST  *      DISPLAY 'STATUS-CHNGD-DATE *'                                      
TEST  *                          MY-STAT-CHNGD-DATE '*'                         
TEST  *      DISPLAY 'STATUS-CHNGD-DATE ' INTERMED-PIC-9-7                      
             MOVE INTERMED-PIC-9-7     TO                                       
                                 TSK-STAT-CHNGD-DATE                            
                                                                                
TEST  *      DISPLAY 'STATUS-CDE =   '    TSK-STATUS-CODE                       
TEST  *      DISPLAY 'INHOUSE-NBR =  '    MY-VNDR-IN-HSE-NMBR                   
TEST  *      DISPLAY 'GRP-QTY     =  '    TSK-GP-QTY                            
TEST  *      DISPLAY 'UNIT-RTL-AMT = ' MY-CUR-UNIT-RTL-AMT                      
TEST  *      DISPLAY 'GRP-RTL-AMT =  ' MY-GP-RTL-AMT                            
                                                                                
             WHEN SQLCODE = +1403                                               
               CONTINUE                                                         
             WHEN OTHER                                                         
               DISPLAY PV-ABEND-PARAGRAPH                                       
               PERFORM Z999-SQL-ERROR                                           
           END-EVALUATE                                                         
                                                                                
           IF SQLCODE = ZERO                                                    
              IF    TSK-STAT-CHNGD-DATE    > ZERO                               
                                                                                
FPSY2K*          IF ( (TSK-STAT-CHNGD-DATE  = 9999999)                          
FPSY2K*            OR (TSK-STAT-CHNGD-DATE  = 9999990)                          
FPSY2K*            OR (TSK-STAT-CHNGD-DATE  = 999999) )                         
FPSY2K           IF TSK-STAT-CHNGD-DATE = 0                                     
                    MOVE PC-NEG-1 TO PV-STAT-CHNG-DTE-NULL                      
                 ELSE                                                           
                    MOVE  TSK-STAT-CHNGD-DATE    TO  PV-STAT-CHNGD-DATE         
                    MOVE  PV-STAT-CHNGD-DATE(2:2) TO WS-DB-YY                   
                    IF WS-DB-YY(1:1) < '8'                                      
                       MOVE '20'      TO  WS-DB-CC                              
                    ELSE                                                        
                       MOVE '19'      TO  WS-DB-CC                              
                    END-IF                                                      
                    MOVE  PV-STAT-CHNGD-DATE(4:2) TO WS-DB-MO                   
                    MOVE  PV-STAT-CHNGD-DATE(6:2) TO WS-DB-DD                   
      *             DISPLAY 'WS-DB2-DATE : ' WS-DB2-DATE                        
                    MOVE  WS-DB2-DATE      TO MDSEIT-STAT-CHNG-DTE              
                    MOVE  ZERO    TO PV-STAT-CHNG-DTE-NULL                      
                 END-IF                                                         
                                                                                
              ELSE                                                              
                 MOVE PC-NEG-1 TO PV-STAT-CHNG-DTE-NULL                         
              END-IF                                                            
           END-IF                                                               
           END-IF.                                                              
                                                                                
      ***************************************************************** *       
      *                                                                *        
      ******************************************************************        
       W500-SELECT-TMDSEIT.                                                     
                                                                                
           MOVE 'W500-SELECT-TMDSEIT'                                           
                     TO  PV-ABEND-PARAGRAPH.                                    
      *    DISPLAY  PV-ABEND-PARAGRAPH.                                         
           SET NO-TMDSEIT TO TRUE.                                              
                                                                                
           EXEC SQL                                                             
             SELECT                                                             
                   STAT_CHNG_DTE                                                
                  ,STAT_CDE                                                     
                  ,SIZE_DESC                                                    
                  ,COLOR_DESC                                                   
                  ,VNDR_INHOUSE_NBR                                             
                  ,VNDR_STYL_ID                                                 
                  ,UNIT_RTL_AMT                                                 
                  ,UNIT_RTL_UOM_CDE                                             
                  ,GRP_QTY                                                      
                  ,GRP_RTL_AMT                                                  
                  ,ENT_ID                                                       
              INTO                                                              
                   :MDSEIT-STAT-CHNG-DTE:PV-STAT-CHNG-DTE-NULL,                 
                   :MDSEIT-STAT-CDE,                                            
                   :MDSEIT-SIZE-DESC:PV-SIZE-DESC-NULL,                         
                   :MDSEIT-COLOR-DESC:PV-COLOR-DESC-NULL,                       
                   :MDSEIT-VNDR-INHOUSE-NBR:PV-VNDR-INHOUSE-NBR-NULL,           
                   :MDSEIT-VNDR-STYL-ID:PV-VNDR-STYL-ID-NULL,                   
                   :MDSEIT-UNIT-RTL-AMT:PV-UNIT-RTL-AMT-NULL,                   
                   :MDSEIT-UNIT-RTL-UOM-CDE:PV-UNIT-RTL-UOM-CDE-NULL,           
                   :MDSEIT-GRP-QTY:PV-GRP-QTY-NULL,                             
                   :MDSEIT-GRP-RTL-AMT:PV-GRP-RTL-AMT-NULL,                     
                   :MDSEIT-ENT-ID:PV-ENT-ID-NULL                                
              FROM   TMDSEIT                                                    
              WHERE ITEM_CLUSTR_ID = :MDSEIT-ITEM-CLUSTR-ID                     
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZEROS                                               
               SET FOUND-A-TMDSEIT TO TRUE                                      
             WHEN SQLCODE = +1403                                               
               DISPLAY 'NO TMDSEIT ROW FOR:' MDSEIT-ITEM-CLUSTR-ID              
             WHEN OTHER                                                         
               DISPLAY PV-ABEND-PARAGRAPH                                       
               DISPLAY 'ITEM-CLUSTER-ID = ' MDSEIT-ITEM-CLUSTR-ID               
               PERFORM Z999-SQL-ERROR                                           
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      *                                                                *        
      ******************************************************************        
       W510-INSERT-TMDSEIT.                                                     
                                                                                
           MOVE 'W510-INSERT-TMDSEIT'                                           
                     TO  PV-ABEND-PARAGRAPH.                                    
TEST  *    DISPLAY 'ITEM_CLUSTR_ID ' MDSEIT-ITEM-CLUSTR-ID                      
TEST  *    DISPLAY 'STAT_CHNG_DTE ' MDSEIT-STAT-CHNG-DTE                        
TEST  *    DISPLAY 'STAT_CDE ' MDSEIT-STAT-CDE                                  
TEST  *    DISPLAY 'SIZE_DESC ' MDSEIT-SIZE-DESC                                
TEST  *    DISPLAY 'COLOR_DESC ' MDSEIT-COLOR-DESC                              
TEST  *    DISPLAY 'VNDR_INHOUSE_NBR ' MDSEIT-VNDR-INHOUSE-NBR                  
TEST  *    DISPLAY 'VNDR_STYL_ID ' MDSEIT-VNDR-STYL-ID                          
TEST  *    DISPLAY 'UNIT_RTL_AMT ' MDSEIT-UNIT-RTL-AMT                          
TEST  *    DISPLAY 'UNIT_RTL_UOM_CDE ' MDSEIT-UNIT-RTL-UOM-CDE                  
TEST  *    DISPLAY 'GRP_QTY ' MDSEIT-GRP-QTY                                    
TEST  *    DISPLAY 'GRP_RTL_AMT ' MDSEIT-GRP-RTL-AMT                            
TEST  *    DISPLAY 'ENT_ID ' MDSEIT-ENT-ID                                      
                                                                                
           EXEC SQL                                                             
             INSERT INTO   TMDSEIT (ITEM_CLUSTR_ID                              
                  ,STAT_CHNG_DTE                                                
                  ,STAT_CDE                                                     
                  ,SIZE_DESC                                                    
                  ,COLOR_DESC                                                   
                  ,VNDR_INHOUSE_NBR                                             
                  ,VNDR_STYL_ID                                                 
                  ,UNIT_RTL_AMT                                                 
                  ,UNIT_RTL_UOM_CDE                                             
                  ,GRP_QTY                                                      
                  ,GRP_RTL_AMT                                                  
                  ,ENT_ID)                                                      
               VALUES                                                           
                  (:MDSEIT-ITEM-CLUSTR-ID,                                      
                   :MDSEIT-STAT-CHNG-DTE:PV-STAT-CHNG-DTE-NULL,                 
                   :MDSEIT-STAT-CDE,                                            
                   :MDSEIT-SIZE-DESC:PV-SIZE-DESC-NULL,                         
                   :MDSEIT-COLOR-DESC:PV-COLOR-DESC-NULL,                       
                   :MDSEIT-VNDR-INHOUSE-NBR:PV-VNDR-INHOUSE-NBR-NULL,           
                   :MDSEIT-VNDR-STYL-ID:PV-VNDR-STYL-ID-NULL,                   
                   :MDSEIT-UNIT-RTL-AMT:PV-UNIT-RTL-AMT-NULL,                   
                   :MDSEIT-UNIT-RTL-UOM-CDE:PV-UNIT-RTL-UOM-CDE-NULL,           
                   :MDSEIT-GRP-QTY:PV-GRP-QTY-NULL,                             
                   :MDSEIT-GRP-RTL-AMT:PV-GRP-RTL-AMT-NULL,                     
                   :MDSEIT-ENT-ID:PV-ENT-ID-NULL)                               
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZEROS                                               
               DISPLAY 'MDSEIT INSERTED : ' MDSEIT-ITEM-CLUSTR-ID               
               ADD 1 TO  PV-MDSEIT-INSERTED                                     
             WHEN OTHER                                                         
               DISPLAY PV-ABEND-PARAGRAPH                                       
               DISPLAY 'ITEM-CLUSTER-ID = ' MDSEIT-ITEM-CLUSTR-ID               
               PERFORM Z999-SQL-ERROR                                           
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      *                                                                *        
      ******************************************************************        
       W520-UPDATE-TMDSEIT.                                                     
                                                                                
           MOVE 'W520-UPDATE-TMDSEIT'                                           
                     TO  PV-ABEND-PARAGRAPH.                                    
FPSY2K*    IF  MDSEIT-STAT-CHNG-DTE = '1999-99-99-00.00.00'                     
FPSY2K*      MOVE SPACES TO MDSEIT-STAT-CHNG-DTE                                
FPSY2K*      MOVE PC-NEG-1 TO PV-STAT-CHNG-DTE-NULL                             
FPSY2K*    END-IF.                                                              
                                                                                
           EXEC SQL                                                             
             UPDATE   TMDSEIT                                                   
             SET                                                                
                  STAT_CHNG_DTE =                                               
                       :MDSEIT-STAT-CHNG-DTE:PV-STAT-CHNG-DTE-NULL              
                 ,STAT_CDE      =:MDSEIT-STAT-CDE                               
                 ,SIZE_DESC     =:MDSEIT-SIZE-DESC:PV-SIZE-DESC-NULL            
                 ,COLOR_DESC    =:MDSEIT-COLOR-DESC:PV-COLOR-DESC-NULL          
                 ,VNDR_INHOUSE_NBR =                                            
                     :MDSEIT-VNDR-INHOUSE-NBR:PV-VNDR-INHOUSE-NBR-NULL          
                 ,VNDR_STYL_ID  =                                               
                       :MDSEIT-VNDR-STYL-ID:PV-VNDR-STYL-ID-NULL                
                 ,UNIT_RTL_AMT  =                                               
                       :MDSEIT-UNIT-RTL-AMT:PV-UNIT-RTL-AMT-NULL                
                 ,UNIT_RTL_UOM_CDE =                                            
                     :MDSEIT-UNIT-RTL-UOM-CDE:PV-UNIT-RTL-UOM-CDE-NULL          
                 ,GRP_QTY     =:MDSEIT-GRP-QTY:PV-GRP-QTY-NULL                  
                 ,GRP_RTL_AMT =:MDSEIT-GRP-RTL-AMT:PV-GRP-RTL-AMT-NULL          
                 ,ENT_ID      =:MDSEIT-ENT-ID:PV-ENT-ID-NULL                    
                WHERE ITEM_CLUSTR_ID  = :MDSEIT-ITEM-CLUSTR-ID                  
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZEROS                                               
               DISPLAY 'UPDATED TMDSEIT: ' MDSEIT-ITEM-CLUSTR-ID                
      *        DISPLAY '     ITEM-CLUSTER-ID  = '                               
      *                        MDSEIT-ITEM-CLUSTR-ID                            
TEST  *        DISPLAY '     STAT-CHNG-DTE    = '                               
TEST  *                        MDSEIT-STAT-CHNG-DTE                             
TEST  *        DISPLAY '     STAT_CDE         = ' MDSEIT-STAT-CDE               
TEST  *        DISPLAY '     SIZE_DESC        = ' MDSEIT-SIZE-DESC              
TEST  *        DISPLAY '     COLOR_DESC       = ' MDSEIT-COLOR-DESC             
TEST  *        DISPLAY '     VNDR_INHOUSE_NBR = '                               
TEST  *                        MDSEIT-VNDR-INHOUSE-NBR                          
TEST  *        DISPLAY '     VNDR_STYL_ID     = '                               
TEST  *                        MDSEIT-VNDR-STYL-ID                              
TEST  *        DISPLAY '     UNIT_RTL_AMT     = '                               
TEST  *                        MDSEIT-UNIT-RTL-AMT                              
TEST  *        DISPLAY '     UNIT_RTL_UOM_CDE = '                               
TEST  *                        MDSEIT-UNIT-RTL-UOM-CDE                          
TEST  *        DISPLAY '     GRP_QTY          = ' MDSEIT-GRP-QTY                
TEST  *        DISPLAY '     GRP_RTL_AMT      = '                               
TEST  *                        MDSEIT-GRP-RTL-AMT                               
TEST  *        DISPLAY '     ENT_ID           = ' MDSEIT-ENT-ID                 
               ADD 1 TO PV-MDSEIT-UPDATED                                       
             WHEN SQLCODE = +1403                                               
               DISPLAY 'CAN NOT UPDATE TMDSEIT FOR:'                            
               DISPLAY 'ITEM-CLUSTER-ID  = ' MDSEIT-ITEM-CLUSTR-ID              
                                  ' ' ITMCLT-ITEM-CLUSTR-NAME                   
             WHEN OTHER                                                         
               DISPLAY PV-ABEND-PARAGRAPH                                       
               DISPLAY 'UNABLE TO UPDATE TMDSEIT'                               
               DISPLAY 'ITEM-CLUSTER-ID = ' MDSEIT-ITEM-CLUSTR-ID               
                                  ' ' ITMCLT-ITEM-CLUSTR-NAME                   
               DISPLAY 'STAT-CHNG-DTE    = ' MDSEIT-STAT-CHNG-DTE               
               DISPLAY 'STAT_CDE         = ' MDSEIT-STAT-CDE                    
               DISPLAY 'SIZE_DESC        = ' MDSEIT-SIZE-DESC                   
               DISPLAY 'COLOR_DESC       = ' MDSEIT-COLOR-DESC                  
               DISPLAY 'VNDR_INHOUSE_NBR = ' MDSEIT-VNDR-INHOUSE-NBR            
               DISPLAY 'VNDR_STYL_ID     = ' MDSEIT-VNDR-STYL-ID                
               DISPLAY 'UNIT_RTL_AMT     = ' MDSEIT-UNIT-RTL-AMT                
               DISPLAY 'UNIT_RTL_UOM_CDE = ' MDSEIT-UNIT-RTL-UOM-CDE            
               DISPLAY 'GRP_QTY          = ' MDSEIT-GRP-QTY                     
               DISPLAY 'GRP_RTL_AMT      = ' MDSEIT-GRP-RTL-AMT                 
               DISPLAY 'ENT_ID           = ' MDSEIT-ENT-ID                      
               PERFORM Z999-SQL-ERROR                                           
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      *                                                                *        
      ******************************************************************        
       W530-SET-MDSEIT-NULLS.                                                   
                                                                                
      *    DISPLAY 'W530-SET-MDSEIT-NULLS'                                      
           IF    TSK-STAT-CHNGD-DATE    > ZERO                                  
FPSY2K*      IF TSK-STAT-CHNGD-DATE  = 9999999                                  
FPSY2K*        MOVE PC-NEG-1 TO PV-STAT-CHNG-DTE-NULL                           
FPSY2K*        MOVE SPACES TO MDSEIT-STAT-CHNG-DTE                              
FPSY2K*      ELSE                                                               
               MOVE 'CCYY-MM-DD.00.00.01' TO MDSEIT-STAT-CHNG-DTE               
               MOVE  TSK-STAT-CHNGD-DATE    TO  PV-STAT-CHNGD-DATE              
               MOVE  PV-STAT-CHNGD-DATE(1:2) TO WS-DB-YY                        
               IF WS-DB-YY(1:1) < '8'                                           
                  MOVE '20'      TO  WS-DB-CC                                   
               ELSE                                                             
                  MOVE '19'      TO  WS-DB-CC                                   
               END-IF                                                           
               MOVE  PV-STAT-CHNGD-DATE(3:2) TO WS-DB-MO                        
               MOVE  PV-STAT-CHNGD-DATE(5:2) TO WS-DB-DD                        
      *        DISPLAY 'WS-DB2-DATE : ' WS-DB2-DATE                             
               MOVE  WS-DB2-DATE             TO MDSEIT-STAT-CHNG-DTE            
               MOVE  ZERO    TO PV-STAT-CHNG-DTE-NULL                           
FPSY2K*      END-IF                                                             
           ELSE                                                                 
              MOVE PC-NEG-1 TO PV-STAT-CHNG-DTE-NULL                            
              MOVE SPACES TO MDSEIT-STAT-CHNG-DTE                               
           END-IF                                                               
TEST  *    DISPLAY 'MDSEIT-STAT-CHNG-DTE = ' MDSEIT-STAT-CHNG-DTE               
           IF TSK-LONG-SIZE-DESC = SPACES                                       
               MOVE -1 TO PV-SIZE-DESC-NULL                                     
           ELSE                                                                 
               MOVE  0 TO PV-SIZE-DESC-NULL                                     
           END-IF                                                               
           IF TSK-LONG-COLOR-DESC = SPACES                                      
               MOVE -1 TO PV-COLOR-DESC-NULL                                    
           ELSE                                                                 
               MOVE  0 TO PV-COLOR-DESC-NULL                                    
           END-IF                                                               
           MOVE 0 TO PV-VNDR-INHOUSE-NBR-NULL                                   
           IF TSK-VNDR-STYL-ID = SPACES                                         
               MOVE -1 TO PV-VNDR-STYL-ID-NULL                                  
           ELSE                                                                 
               MOVE  0 TO PV-VNDR-STYL-ID-NULL                                  
           END-IF                                                               
           MOVE 0 TO PV-UNIT-RTL-AMT-NULL                                       
           IF TSK-UNIT-RTL-UOM-CDE = SPACES                                     
               MOVE -1 TO PV-UNIT-RTL-UOM-CDE-NULL                              
           ELSE                                                                 
               MOVE  0 TO PV-UNIT-RTL-UOM-CDE-NULL                              
           END-IF                                                               
TEST  *    DISPLAY 'GONNA MOVE MY-VNDR-IN-HSE-NMBR'                             
           MOVE MY-VNDR-IN-HSE-NMBR  TO MDSEIT-VNDR-INHOUSE-NBR                 
TEST  *    DISPLAY 'GONNA MOVE TSK-GP-QTY'                                      
           MOVE TSK-GP-QTY           TO MDSEIT-GRP-QTY                          
TEST  *    DISPLAY 'GONNA MOVE TSK-STATUS-CODE'                                 
           MOVE TSK-STATUS-CODE          TO MDSEIT-STAT-CDE                     
           MOVE TSK-VNDR-STYL-ID TO MDSEIT-VNDR-STYL-ID                         
           MOVE TSK-ENT-ID TO MDSEIT-ENT-ID                                     
           MOVE TSK-LONG-SIZE-DESC  TO MDSEIT-SIZE-DESC                         
           MOVE TSK-LONG-COLOR-DESC TO MDSEIT-COLOR-DESC                        
           MOVE TSK-STATUS-CODE TO MDSEIT-STAT-CDE                              
           MOVE MY-VNDR-IN-HSE-NMBR TO MDSEIT-VNDR-INHOUSE-NBR                  
           MOVE TSK-UNIT-RTL-UOM-CDE TO MDSEIT-UNIT-RTL-UOM-CDE                 
           MOVE TSK-GP-QTY TO MDSEIT-GRP-QTY                                    
           MOVE MY-GP-RTL-AMT TO MDSEIT-GRP-RTL-AMT                             
           MOVE MY-CUR-UNIT-RTL-AMT TO MDSEIT-UNIT-RTL-AMT                      
           MOVE 0 TO PV-GRP-QTY-NULL                                            
           MOVE 0 TO PV-GRP-RTL-AMT-NULL                                        
           MOVE 0 TO PV-ENT-ID-NULL    .                                        
                                                                                
      ****************************************************************          
      *                                                              *          
      ****************************************************************          
       W625-SELECT-N-CORRECT-GRP.                                               
                                                                                
      *    DISPLAY 'W625-SELECT-N-CORRECT-GRP'                                  
           PERFORM W650-HORRIBLE-GROUP-QUERY                                    
              IF FOUND-A-PRNT-GRP                                               
                 IF TSK-GROUP-CODE = SPACES                                     
      *          ITEM SHOULDN'T BELONG TO A GROUP. CANCEL GROUP REL             
                    DISPLAY '   ITEM ' ITMCLT-ITEM-CLUSTR-ID                    
                            ' SHOULD NOT BELONG TO A GROUP BUT DOES'            
                    PERFORM  C800-EXPIRE-CURR-GRP-REL                           
                    SET MODIFIED-ITEM TO TRUE                                   
                 ELSE                                                           
                    IF NOT ( TSK-GROUP-CODE =                                   
                             ITEM-PARENT-GROUP-NAME(8:3) )                      
                       DISPLAY '   - - - - - - - - - - - - - - - - - - '        
                       DISPLAY '   ITM ' ITMCLT-ITEM-CLUSTR-ID                  
                          ' BELONGS TO GROUP ' ITEM-PARENT-GROUP-NAME           
                       DISPLAY '     BUT SHOULD BELONG TO '                     
                                            TSK-GROUP-CODE                      
                       DISPLAY '   - - - - - - - - - - - - - - - - - - '        
                       PERFORM  C800-EXPIRE-CURR-GRP-REL                        
                       PERFORM  C900-PROCESS-GRP-INFO                           
                       SET MODIFIED-ITEM TO TRUE                                
                    END-IF                                                      
                 END-IF                                                         
              ELSE                                                              
                 IF NO-ERROR                                                    
      *             ITEM DOESN'T BELONG TO A GROUP. SHOULD IT?                  
                    IF NOT (TSK-GROUP-CODE = SPACES)                            
                       DISPLAY '   ITEM ' ITMCLT-ITEM-CLUSTR-ID                 
                               ' ' ITMCLT-ITEM-CLUSTR-NAME                      
                                  'DOES NOT BELONG TO A GROUP'                  
                       DISPLAY '     BUT SHOULD BELONG TO '                     
                                           TSK-GROUP-CODE                       
                       PERFORM  C900-PROCESS-GRP-INFO                           
                       SET MODIFIED-ITEM TO TRUE                                
                    END-IF                                                      
                 END-IF                                                         
              END-IF.                                                           
                                                                                
      ****************************************************************          
      *                                                              *          
      ****************************************************************          
       W600-CHECK-PARENT-GROUP.                                                 
                                                                                
      *    DISPLAY 'W600-CHECK-PARENT-GROUP'                                    
           PERFORM C825-FIND-GRP-INFO                                           
           IF NO-ERROR                                                          
              IF NO-GRP                                                         
      *          GROUP HAS NOT BEEN BRIDGED.  BRIDGE IT AND                     
      *          THEN CREATE RELATIONSHIP                                       
                 PERFORM  C850-CREATE-GRP                                       
                 IF NO-ERROR                                                    
                    MOVE ITMCLT-ITEM-CLUSTR-ID TO                               
                                            ITMCLC-CHLD-ITM-CLUSTR-ID           
                    MOVE ITEM-PARENT-GROUP-ID TO                                
                                            ITMCLC-PRNT-ITM-CLUSTR-ID           
                                            PV-GRP-CHLD-CLUSTR-ID               
                    MOVE 'M'         TO ITMCLC-REL-TYP-CDE                      
                    MOVE 'I'         TO ITMCLC-CHLD-ITM-CLSTR-CDE               
                    PERFORM C700-INSERT-ITMCLC                                  
                    IF NO-ERROR                                                 
                      ADD 1 TO PV-GROUP-REL-INSERTED                            
                      SET MODIFIED-ITEM TO TRUE                                 
                    END-IF                                                      
                 END-IF                                                         
              ELSE                                                              
      *          GROUP EXISTS, SEE IF ITEM IS RELATED TO IT                     
                 EXEC SQL                                                       
                     SELECT                                                     
                            R.PRNT_ITM_CLUSTR_ID                                
                     INTO                                                       
                       :ITEM-ID                                                 
                     FROM TITMCLC R                                             
                     WHERE R.CHLD_ITM_CLUSTR_ID = :ITMCLT-ITEM-CLUSTR-ID        
                       AND R.PRNT_ITM_CLUSTR_ID = :ITEM-PARENT-GROUP-ID         
                       AND R.REL_TYP_CDE = 'M'                                  
                       AND R.EFF_END_TMST IS NULL                               
                 END-EXEC                                                       
                                                                                
                 EVALUATE TRUE                                                  
                   WHEN SQLCODE = ZEROS                                         
TEST  *               DISPLAY '     BELONGS TO CORRECT GROUP '                  
                      CONTINUE                                                  
                   WHEN SQLCODE = +1403                                         
      *               ITEM IS NOT RELATED TO PROPER GROUP.                      
      *               SEE IF IT'S RELATED TO *ANY* GROUP.  IF SO,               
      *               EXPIRE THAT RELATIONSHIP.  INSERT PROPER                  
      *               RELATIONSHIP.                                             
TEST  *               DISPLAY '     DOESN''T BELONG TO GROUP '                  
TEST  *                               TSK-GROUP-CODE                            
                      PERFORM W625-SELECT-N-CORRECT-GRP                         
                   WHEN OTHER                                                   
                      DISPLAY 'W600-CHECK-PARENT-GROUP'                         
                      DISPLAY 'ITEM-CLUSTER-ID = ' ITMCLT-ITEM-CLUSTR-ID        
                       ' ' ITMCLT-ITEM-CLUSTR-NAME                              
                      PERFORM Z999-SQL-ERROR                                    
              END-IF                                                            
           END-IF.                                                              
                                                                                
      ****************************************************************          
      *                                                              *          
      ****************************************************************          
       W650-HORRIBLE-GROUP-QUERY.                                               
                                                                                
      *    DISPLAY 'W650-HORRIBLE-GROUP-QUERY'                                  
           SET NO-PRNT-GRP TO TRUE.                                             
TEST       EXEC SQL                                                             
TEST        SELECT SYSDATE                                                      
TEST        INTO :PV-CURRENT-TMST                                               
TEST        FROM DUAL                                                           
TEST       END-EXEC.                                                            
TEST                                                                            
TEST  *    DISPLAY 'TIME BEFORE GROUP PARENT SELECT = ' PV-CURRENT-TMST.        
                                                                                
           EXEC SQL                                                             
               SELECT                                                           
FPS918                /*+  FIRST ROWS */                                        
FPS918*               /*+  INDEX(R IITMCLC1) */                                 
FPS918*               /*+  INDEX(I IITMCLT0) */                                 
                      R.PRNT_ITM_CLUSTR_ID  ,                                   
                      I.ITEM_CLUSTR_NAME                                        
               INTO                                                             
                 :ITEM-PARENT-GROUP-ID,                                         
                 :ITEM-PARENT-GROUP-NAME                                        
               FROM TITMCLT I, TITMCLC R                                        
               WHERE R.CHLD_ITM_CLUSTR_ID = :ITMCLT-ITEM-CLUSTR-ID              
                 AND R.PRNT_ITM_CLUSTR_ID = I.ITEM_CLUSTR_ID                    
                 AND I.EFF_END_TMST IS NULL                                     
                 AND R.EFF_END_TMST IS NULL                                     
                 AND I.HIER_CDE = 'GRP'                                         
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
             WHEN SQLCODE = ZEROS                                               
                SET FOUND-A-PRNT-GRP TO TRUE                                    
             WHEN SQLCODE = 2112                                                
             WHEN SQLCODE = -2112                                               
                DISPLAY '        **********************************'            
                DISPLAY '        **********************************'            
                DISPLAY '        ' ITMCLT-ITEM-CLUSTR-ID ' '                    
                                  ITMCLT-ITEM-CLUSTR-NAME                       
                DISPLAY '        BELONGS TO MORE THAN ONE GROUP!'               
                DISPLAY '        ' ITEM-PARENT-GROUP-ID ' '                     
                                 ITEM-PARENT-GROUP-NAME                         
                DISPLAY '        **********************************'            
                DISPLAY '        **********************************'            
                DISPLAY 'W650-HORRIBLE-GROUP-QUERY'                             
                PERFORM Z999-SQL-ERROR                                          
             WHEN SQLCODE = +1403                                               
TEST  *         DISPLAY 'NO GROUP REL FOR: ' ITMCLT-ITEM-CLUSTR-ID              
TEST  *                ' ' ITMCLT-ITEM-CLUSTR-NAME                              
                CONTINUE                                                        
             WHEN OTHER                                                         
                DISPLAY 'W650-HORRIBLE-GROUP-QUERY'                             
                DISPLAY 'ITEM-CLUSTER-ID = ' ITMCLT-ITEM-CLUSTR-ID              
                       ' ' ITMCLT-ITEM-CLUSTR-NAME                              
                PERFORM Z999-SQL-ERROR                                          
           END-EVALUATE.                                                        
TEST       EXEC SQL                                                             
TEST        SELECT SYSDATE                                                      
TEST        INTO :PV-CURRENT-TMST                                               
TEST        FROM DUAL                                                           
TEST       END-EXEC.                                                            
TEST                                                                            
TEST  *    DISPLAY '      AFTER GROUP PARENT SELECT = ' PV-CURRENT-TMST.        
                                                                                
      ****************************************************************          
      *                                                              *          
      ****************************************************************          
                                                                                
       X100-REPLACE-SPEC-CHARS.                                                 
                                                                                
           INSPECT ITMCLT-ITEM-CLUSTR-DESC                                      
           REPLACING ALL PC-Q     BY SPACE.                                     
                                                                                
           INSPECT ITMCLT-ITEM-CLUSTR-DESC                                      
           REPLACING ALL PC-QUESTION BY SPACE.                                  
                                                                                
           INSPECT ITMCLT-ITEM-CLUSTR-DESC                                      
           REPLACING ALL PC-DQ     BY SPACE.                                    
                                                                                
           INSPECT ITMCLT-ITEM-CLUSTR-DESC                                      
           REPLACING ALL PC-UNDERSCORE BY SPACE.                                
                                                                                
           INSPECT ITMCLT-ITEM-CLUSTR-DESC                                      
           REPLACING ALL PC-ASTERISK   BY SPACE.                                
                                                                                
                                                                                
      ****************************************************************          
      *                                                              *          
      ****************************************************************          
       Z999-SQL-ERROR.                                                          
                                                                                
           SET ERROR-EXISTS TO TRUE.                                            
           MOVE SQLCODE    TO SQLCODE2.                                         
           MOVE SQLERRD(3) TO SQLERRD3.                                         
           DISPLAY '** ABEND **       ** = SQLERROR'.                           
           DISPLAY '** PROGRAM        ** = MAKUP100'.                           
           DISPLAY '** SQLCODE        ** = ' SQLCODE2.                          
           DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                          
           DISPLAY '** SQLERRM        ** = ' SQLERRM.                           
           DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                          
           DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                        
                                                                                
           MOVE SPACES TO WS-MSG-TEXT.                                          
      *    GET FULL TEXT OF ERROR MESSAGE                                       
                                                                                
           CALL 'SQLGLM' USING WS-MSG-TEXT,                                     
                               WS-MAX-SIZE,                                     
                               WS-MSG-LENGTH.                                   
           DISPLAY 'MESSAGE TEXT      ** = ' WS-MSG-TEXT.                       
                                                                                
           EXEC SQL                                                             
            ROLLBACK WORK RELEASE                                               
           END-EXEC.                                                            
                                                                                
           MOVE +4013 TO PV-ABEND-CODE.                                         
           CALL 'ILBOABN0' USING PV-ABEND-CODE.                                 
      *                                                                         
      ******************************************************************        
