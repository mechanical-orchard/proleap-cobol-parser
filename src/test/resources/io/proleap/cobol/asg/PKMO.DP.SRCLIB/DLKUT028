000300 IDENTIFICATION DIVISION.                                         00030001
000400 PROGRAM-ID.    DLKUT028.                                         00040001
000500 AUTHOR.        DENISE HAHN.                                      00050001
000600                                                                  00060001
000700 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00070001
000800 DATE-WRITTEN.  DECEMBER 2008.                                    00080001
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100 ENVIRONMENT DIVISION.                                            00110001
001200 CONFIGURATION SECTION.                                           00120001
001300 SOURCE-COMPUTER. IBM-3090.                                       00130001
001400 OBJECT-COMPUTER. IBM-3090.                                       00140001
001500                                                                  00150001
001600****************************************************************  00160001
001700*                                                              *  00170001
001800*  IF AN ASSOCIATE IS CURRENTLY ATTACHED TO 2 ACTIVE           *  00180001
001900*  ASSIGNMENTS, THIS PROGRAM IS CALLED  TO REMOVE THE          *  00190001
001910*  ASSOCIATE FROM THE ASSIGNMENTS.                             *  00191001
002000*                                                              *  00200001
002010*  THIS MODULE IS CALLED BY DLKCS410                           *  00201011
002020*                                                              *  00202001
002100*  DB2 ACCESS:                                                 *  00210001
002200*     DLT_TEM_ASGMT (DLT00003) TABLE                           *  00220001
002300*                SELECTS                                       *  00230001
002400*                                                              *  00240001
002500*     DLT_ASGMT (DLT00004) TABLE                               *  00250001
002600*                SELECTS                                       *  00260001
002700*                                                              *  00270001
002710*     TUPLDER (TUPLDER) - UPLOAD ERROR TABLE                   *  00271001
002720*                INSERTS                                       *  00272001
002730*                                                              *  00273001
002800****************************************************************  00280001
002900                                                                  00290001
003000 DATA DIVISION.                                                   00300001
003100 WORKING-STORAGE SECTION.                                         00310001
003110*                                                                 00311003
003120 01  DK-DB2-KEUS.                                                 00312003
003121     05  DK-USER-ID               PIC  X(08).                     00312108
003200*                                                                 00320001
003300 01  PV-PROGRAM-VARIABLES.                                        00330007
003310     05  PV-USR-TYP-CDE           PIC  X(01).                     00331008
003330         88  PV-USER-IS-KOHLS                VALUE 'K'.           00333007
003340         88  PV-USER-IS-TEMP                 VALUE 'T'.           00334007
003341     05  PV-DISPLAY-TEXT          PIC  XXXXX  VALUE ZEROS.        00334111
003342     05  PV-DISPLAY-SQLCODE       PIC  -999.                      00334217
003343     05  PV-DISPLAY-OPER          PIC  Z(04).                     00334317
003344     05  PV-HOLD-TIMESTAMP        PIC  X(26).                     00334417
003345     05  PV-LABOR-CURRENT-TMST    PIC  X(26).                     00334517
003350                                                                  00335007
003351     05  PV-RETRY-COUNTER         PIC S9(04) VALUE 0 COMP.        00335117
003352     05  PV-MODULE-FAIL-MSG.                                      00335217
003353         10  FILLER               PIC  X(05)  VALUE 'PARA:'.      00335317
003355         10  PV-MODULE-PARAGRPAH  PIC  X(30)  VALUE SPACE.        00335517
003356                                                                  00335617
003357     05  PV-CICS-RESP             PIC S9(04)  VALUE +0            00335717
003358                                              COMP SYNC.          00335817
003359     05  PV-CICS-MSG-AREA         PIC  X(80)  VALUE SPACE.        00335917
003360     05  PV-CICS-MSG-AREA2        PIC  X(100) VALUE SPACE.        00336017
003361     05  PV-CICS-MSG-HOLD.                                        00336117
003362         10  FILLER               PIC  X(01)  VALUE SPACE.        00336217
003363         10  PV-CICS-MSG-DATA     PIC  X(79)  VALUE SPACE.        00336317
003365     05  PV-COMMAREA-LENGTH       PIC S9(04)  COMP                00336517
003366                                              VALUE +0.           00336617
003367     05  PV-NULL-IND1             PIC S9(04)  VALUE ZEROS         00336721
003368                                              COMP SYNC.          00336821
003369     05  PV-NULL-IND2             PIC S9(04)  VALUE ZEROS         00336921
003370                                              COMP SYNC.          00337021
003380                                                                  00338017
004600 01  PS-SWITCHES.                                                 00460004
004700     05  PS-DISPLAY-PARA-SW           PIC X(01)  VALUE 'N'.       00470004
004800         88  PS-DISPLAY-PARA                     VALUE 'Y'.       00480004
004900         88  PS-DONT-DISPLAY-PARA                VALUE 'N'.       00490004
005000     05  PS-DISPLAY-DETAIL-SW         PIC X(01)  VALUE 'N'.       00500004
005100         88  PS-DISPLAY-DETAIL                   VALUE 'Y'.       00510004
005200         88  PS-DONT-DISPLAY-DETAIL              VALUE 'N'.       00520004
005210     05  PS-END-OF-CURSOR-SW          PIC X(01)  VALUE 'N'.       00521006
005220         88  PS-END-OF-CURSOR                    VALUE 'Y'.       00522006
005230         88  PS-END-OF-CURSOR-NO                 VALUE 'N'.       00523006
005240     05  PS-CALLED-MODULE-ERROR-SW    PIC X(01)  VALUE 'N'.       00524012
005250         88  PS-CALLED-MODULE-ERROR              VALUE 'Y'.       00525012
005260         88  PS-CALLED-MODULE-ERROR-NO           VALUE 'N'.       00526012
005270     05  PS-ERROR-SW                  PIC X(01)  VALUE 'N'.       00527013
005280         88  PS-ERROR                            VALUE 'Y'.       00528013
005290         88  PS-ERROR-NO                         VALUE 'N'.       00529013
006100                                                                  00610012
006200 01  PC-CONSTANTS.                                                00620004
006300     05  PC-MAX-RETRIES           PIC S9(04) VALUE +3 COMP.       00630004
006500     05  PC-ASTERISK-LINE         PIC X(40)  VALUE ALL '*'.       00650017
006710     05  PC-CURRENT-PROGRAM-NAME  PIC X(08)  VALUE 'DLKUT028'.    00671017
006800                                                                  00680003
006810*----------------------------------------------------------------*00681003
006820*    COMMAREA TO BE PASSED TO DLKUP002                            00682003
006830*----------------------------------------------------------------*00683003
006840     COPY DLWS005.                                                00684003
006850                                                                  00685003
006903*----------------------------------------------------------------*00690303
006904*    COMMAREA TO BE PASSED TO XLKUP033                            00690403
006905*----------------------------------------------------------------*00690503
006906     COPY XLWS072.                                                00690603
006907                                                                  00690703
007310*----------------------------------------------------------------*00731003
007400*  DLT_ASGMT - LABOR ASSIGNMENT HEADER                            00740001
007401*----------------------------------------------------------------*00740103
007500     EXEC SQL                                                     00750001
007600         INCLUDE DLT00004                                         00760001
007700     END-EXEC.                                                    00770001
007710                                                                  00771001
007720*----------------------------------------------------------------*00772003
007800*   DLT_TEM_ASGMT - ASSOCIATES THAT ARE ATTACHED TO ASSIGNMENT    00780001
007801*----------------------------------------------------------------*00780103
007900     EXEC SQL                                                     00790001
008000         INCLUDE DLT00003                                         00800001
008100     END-EXEC.                                                    00810001
008200                                                                  00820001
008201*----------------------------------------------------------------*00820103
008210*   TUPLDER - UPLOAD ERROR TABLE                                  00821001
008211*----------------------------------------------------------------*00821103
008230     EXEC SQL                                                     00823001
008240         INCLUDE TUPLDER                                          00824001
008250     END-EXEC.                                                    00825001
008260                                                                  00826001
008270*----------------------------------------------------------------*00827003
008280*                                                                 00828003
008290*----------------------------------------------------------------*00829003
008300     EXEC SQL                                                     00830001
008400          INCLUDE SQLCA                                           00840001
008500     END-EXEC.                                                    00850001
008600                                                                  00860001
008610*---------------------------------------------------------------* 00861002
008620*   CURSOR CONTAINING THE ACTIVE ASSIGNMENTS THAT THE ASSOCIATE * 00862002
008621*   IS ATTACHED TO                                              * 00862102
008630*---------------------------------------------------------------* 00863002
008640     EXEC SQL                                                     00864002
008650          DECLARE ACTIVE_ASGMT_CSR CURSOR WITH HOLD FOR           00865022
008660             SELECT A.ASGMT_STRT_DTE                              00866003
008670                   ,A.ASGMT_NBR_TXT                               00867003
008680                   ,A.ASGMT_NBR_SEQ_NBR                           00868003
008690                   ,A.TEM_ASGMT_SEQ_NBR                           00869003
008700                   ,A.KOHLS_USR_ID                                00870003
008701                   ,A.TMP_USR_ID                                  00870103
008702                   ,A.JN_TMST                                     00870203
008703                   ,A.CRE_BY_USR_ID                               00870303
008705                   ,B.ASGMT_STRT_TM                               00870503
008706                   ,B.WK_TYP_DESC                                 00870603
008707                   ,B.WK_AREA_DESC                                00870703
008708                   ,B.DC_NBR                                      00870803
008710              FROM  DLT_TEM_ASGMT   A                             00871009
008711                   ,DLT_ASGMT       B                             00871109
008713             WHERE (A.KOHLS_USR_ID      = :DK-USER-ID  OR         00871303
008714                    A.TMP_USR_ID        = :DK-USER-ID)            00871403
008715               AND  A.LVE_RSN_CDE       = 'N'                     00871503
008716               AND  B.ASGMT_STRT_DTE    =  A.ASGMT_STRT_DTE       00871603
008717               AND  B.ASGMT_NBR_TXT     =  A.ASGMT_NBR_TXT        00871703
008718               AND  B.ASGMT_NBR_SEQ_NBR =  A.ASGMT_NBR_SEQ_NBR    00871803
008719               AND  B.ASGMT_STP_RSN_CDE = 'N'                     00871903
008720           ORDER BY  A.JN_TMST                                    00872003
008723     END-EXEC.                                                    00872302
008730                                                                  00873001
008800 LINKAGE SECTION.                                                 00880001
008900     COPY DLWS024.                                                00890001
009000                                                                  00900001
009100                                                                  00910001
009200 PROCEDURE DIVISION USING DL024-ASGMT-COMMAREA.                   00920001
009300                                                                  00930001
009400     SET DL024-SUCCESSFUL                                         00940013
009500         PS-ERROR-NO       TO  TRUE.                              00950013
009900                                                                  00990001
010801     MOVE  DL024-KEY-USER-ID     TO  DK-USER-ID.                  01080107
010802     MOVE  DL024-USER-FOUND-CODE TO  PV-USR-TYP-CDE.              01080207
010804                                                                  01080404
010805     SET  PS-END-OF-CURSOR-NO TO  TRUE.                           01080506
010806                                                                  01080606
010810     PERFORM 4000-OPEN-CURSOR.                                    01081006
010811     PERFORM 4010-FETCH-CURSOR.                                   01081106
010812     IF  PS-END-OF-CURSOR-NO                                      01081206
010813         PERFORM 2000-PROCESS-CURSOR                              01081306
010814           UNTIL PS-END-OF-CURSOR                                 01081410
010815              OR PS-ERROR                                         01081513
010816     END-IF.                                                      01081613
010817     PERFORM 4020-CLOSE-CURSOR.                                   01081713
010830                                                                  01083004
012400     GOBACK.                                                      01240006
012500                                                                  01250006
012600                                                                  01260006
012694*--------------------------------------------------------------*  01269404
012695*                                                              *  01269504
012696*--------------------------------------------------------------*  01269604
012697 2000-PROCESS-CURSOR.                                             01269704
012698***  MOVE '2000-PROCESS-CURSOR '          TO PV-ABEND-PARAGRAPH.  01269804
012699***  DISPLAY 'NOW IN 2000-PROCESS-CURSOR '.                       01269904
012700                                                                  01270004
012751                                                                  01275104
012752     IF  SQLCODE = ZERO                                           01275213
012753         PERFORM 4500-INSERT-TUPLDER                              01275319
012754         PERFORM 3000-PROCESS-ASGMT                               01275419
012755         IF  PS-ERROR-NO                                          01275519
012756            PERFORM 3500-CREATE-S-MOVE                            01275619
012757         END-IF                                                   01275719
012758     END-IF.                                                      01275819
012759                                                                  01275919
012760     IF  PS-ERROR-NO                                              01276019
012761         PERFORM 4010-FETCH-CURSOR                                01276119
012767     END-IF.                                                      01276717
012821                                                                  01282104
012822                                                                  01282217
012823*--------------------------------------------------------------*  01282317
012824* THE FOLLOWING IS TO PROCESS THE CALL TO DLKUP002 TO          *  01282417
012825* END ASSOCIATE FROM AN ASSIGNMENT                             *  01282517
012826*--------------------------------------------------------------*  01282617
012827 3000-PROCESS-ASGMT.                                              01282717
012828                                                                  01282817
012829     INITIALIZE DL005-ASGMT-COMMAREA.                             01282917
012830                                                                  01283017
012831     MOVE DLT00003-ASGMT-STRT-DTE TO  DL005-KEY-START-DTE.        01283117
012832     MOVE DLT00003-ASGMT-NBR-TXT  TO  DL005-KEY-NBR-TXT.          01283217
012833     MOVE DLT00003-ASGMT-NBR-SEQ-NBR                              01283317
012834                                  TO  DL005-KEY-NBR-SEQ-NBR.      01283417
012835     MOVE DLT00003-TEM-ASGMT-SEQ-NBR                              01283517
012836                                  TO  DL005-KEY-TEM-ASGMT-SEQ-NBR.01283617
012837     MOVE DL024-KEY-USER-ID       TO  DL005-KEY-ADD-BY-USER-ID    01283717
012838                                      DL005-KEY-USER-ID.          01283817
012839     MOVE PV-USR-TYP-CDE          TO  DL005-KEY-USR-TYPE-CDE.     01283917
012840     MOVE PC-CURRENT-PROGRAM-NAME TO  DL005-KEY-LVE-PGM-NM        01284017
012841                                      DL005-ORIG-CALLING-PGM-NM.  01284117
012842                                                                  01284217
012843     SET DL005-BY-ASGMT-NBR                                       01284317
012844         DL005-END-FROM-ASGMT                                     01284417
012845         DL005-COMMIT-UPDATE                                      01284517
012846         DL005-KEY-LVE-RSN-SMOVE                                  01284617
012847         PS-CALLED-MODULE-ERROR-NO TO TRUE.                       01284717
012848                                                                  01284817
012849     MOVE ' END ' TO PV-DISPLAY-TEXT.                             01284917
012850                                                                  01285017
012851     PERFORM 6300-CALL-DLKUP002.                                  01285117
012852                                                                  01285217
012853     IF  PS-CALLED-MODULE-ERROR                                   01285317
012854         SET PS-ERROR           TO TRUE                           01285417
012855         MOVE 'DLKUP002'        TO DL024-CALL-MOD-FAIL-NM         01285517
012856         MOVE DL005-RETURN-CODE TO DL024-CALL-MOD-FAIL-ERR-CDE    01285617
012857         SET DL024-CALLED-MODULE-FAILURE TO TRUE                  01285717
012858         IF  DL005-SQL-ERROR                                      01285817
012859             MOVE DL005-ASGMT-SQLCODE TO                          01285917
012860                  DL024-CALL-MOD-FAIL-SQL-CDE                     01286017
012861             MOVE DL005-SQL-ERROR-PARA TO                         01286117
012862                  DL024-CALL-MOD-FAIL-SQL-PARA                    01286217
012863         END-IF                                                   01286317
012864     END-IF.                                                      01286406
012865                                                                  01286506
012866                                                                  01286615
012867 3220-GET-TIMESTAMP.                                              01286715
012868                                                                  01286815
012869     EXEC SQL                                                     01286915
012870          SET  :PV-LABOR-CURRENT-TMST =                           01287015
012871               (TIMESTAMP(:PV-HOLD-TIMESTAMP) - 1 SECOND)         01287115
012872     END-EXEC.                                                    01287215
012873                                                                  01287315
012874                                                                  01287415
012875*--------------------------------------------------------------*  01287515
012876* THE FOLLOWING IS TO PROCESS THE CALL TO XLKUP033 TO LOG AN   *  01287615
012877* INDIRECT CODE OF AN S (SYSTEM) MOVE FOR THE ASSOCIATE        *  01287715
012878*--------------------------------------------------------------*  01287815
012879 3500-CREATE-S-MOVE.                                              01287915
012880                                                                  01288015
012881     INITIALIZE XL072-EAI-EXPORT-COMMAREA.                        01288115
012882                                                                  01288215
012883     SET XL072-PC-APP-ID                                          01288315
012884         XL072-COMMIT-UPDATE TO TRUE.                             01288415
012885                                                                  01288515
012886     MOVE PC-CURRENT-PROGRAM-NAME TO XL072-CRE-PGM-NM.            01288615
012887                                                                  01288715
012888     MOVE ZEROES                  TO XL072-EVNT-KY-1-NBR          01288815
012889                                     XL072-EVNT-KY-2-NBR          01288915
012890                                     XL072-EVNT-KY-3-NBR          01289015
012891                                     XL072-EVNT-KY-4-NBR          01289115
012892                                     XL072-EVNT-KY-5-NBR.         01289215
012893                                                                  01289315
012894     MOVE SPACES                  TO XL072-EVNT-KY-1-TXT          01289415
012895                                     XL072-EVNT-KY-2-TXT          01289515
012896                                     XL072-EVNT-KY-3-TXT          01289615
012897                                     XL072-EVNT-KY-4-TXT          01289715
012898                                     XL072-EVNT-KY-5-TXT          01289815
012899                                     XL072-EVNT-KY-1-TMST         01289915
012900                                     XL072-EVNT-KY-2-TMST         01290015
012901                                     XL072-EVNT-KY-3-TMST         01290115
012902                                     XL072-EVNT-KY-4-TMST         01290215
012903                                     XL072-EVNT-KY-5-TMST.        01290315
012904                                                                  01290415
012905     MOVE 'DC LABOR'          TO XL072-EVNT-OBJ-TXT.              01290515
012906     MOVE 'INDIRECT LABOR'    TO XL072-EVNT-OBJ-ACTN-TXT.         01290615
012907     MOVE DL024-KEY-USER-ID   TO XL072-CRE-BY-USR-ID.             01290715
012908     MOVE DL024-KEY-DC-NBR    TO XL072-EVNT-KY-1-NBR.             01290815
012909**                                                                01290915
012910     IF  DLT00004-WK-TYP-DESC   = 'RECV'                          01291015
012911         MOVE 'SRMOVE'        TO XL072-EVNT-KY-1-TXT              01291115
012912     END-IF.                                                      01291215
012913     IF  DLT00004-WK-TYP-DESC   = 'SHIP'                          01291315
012914         MOVE 'SSMOVE'        TO XL072-EVNT-KY-1-TXT              01291415
012915     END-IF.                                                      01291515
012916     IF  DLT00004-WK-TYP-DESC   = 'P2L'                           01291615
012917         MOVE 'SPMOVE'        TO XL072-EVNT-KY-1-TXT              01291715
012918     END-IF.                                                      01291815
012919     IF  DLT00004-WK-TYP-DESC   = 'FLAT'                          01291915
012920         MOVE 'SFMOVE'        TO XL072-EVNT-KY-1-TXT              01292015
012921     END-IF.                                                      01292115
012922     IF  DLT00004-WK-TYP-DESC   = 'RLABL'                         01292215
012923         MOVE 'SLMOVE'        TO XL072-EVNT-KY-1-TXT              01292315
012924     END-IF.                                                      01292415
012925     IF  DLT00004-WK-TYP-DESC   = 'MASTCON'                       01292515
012926         MOVE 'SMMOVE'        TO XL072-EVNT-KY-1-TXT              01292615
012927     END-IF.                                                      01292715
012928                                                                  01292815
012929     MOVE DL005-ASSOC-TMST    TO PV-HOLD-TIMESTAMP.               01292915
012930     PERFORM 3220-GET-TIMESTAMP.                                  01293015
012931     MOVE PV-LABOR-CURRENT-TMST  TO  XL072-EVNT-KY-1-TMST.        01293116
012932                                                                  01293215
012933     SET XL072-COPYBOOK-NOT-USED TO TRUE.                         01293315
012934                                                                  01293415
012935     PERFORM 6500-CALL-XLKUP033.                                  01293515
012936                                                                  01293615
012937     IF  PS-CALLED-MODULE-ERROR                                   01293715
012938         SET PS-ERROR TO TRUE                                     01293815
012939         MOVE 'XLKUP033'        TO DL024-CALL-MOD-FAIL-NM         01293917
012940         MOVE XL072-RETURN-CODE TO DL024-CALL-MOD-FAIL-ERR-CDE    01294015
012941         SET DL024-CALLED-MODULE-FAILURE TO TRUE                  01294115
012942         IF  XL072-SQL-ERROR                                      01294215
012943             MOVE XL072-EAI-DB-SQLCODE TO                         01294315
012944                  DL024-CALL-MOD-FAIL-SQL-CDE                     01294415
012945             MOVE XL072-SQL-ERROR-PARA TO                         01294515
012946                  DL024-CALL-MOD-FAIL-SQL-PARA                    01294615
012947         END-IF                                                   01294715
012949     END-IF.                                                      01294915
012952                                                                  01295215
012953                                                                  01295315
012954*--------------------------------------------------------------*  01295415
012955*                                                              *  01295515
012956*--------------------------------------------------------------*  01295615
012957 4000-OPEN-CURSOR.                                                01295715
012958***  MOVE '4000-OPEN-CURSOR'             TO PV-ABEND-PARAGRAPH.   01295815
012959***  DISPLAY 'NOW IN 1000-OPEN-CURSOR '.                          01295915
012960                                                                  01296015
012961     PERFORM                                                      01296115
012962         WITH TEST AFTER                                          01296215
012963             VARYING PV-RETRY-COUNTER                             01296315
012964             FROM 1 BY 1                                          01296415
012965             UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES              01296515
012966                OR SQLCODE = ZERO                                 01296615
012967                                                                  01296715
012968         EXEC SQL                                                 01296815
012969              OPEN  ACTIVE_ASGMT_CSR                              01296915
012970         END-EXEC                                                 01297015
012971                                                                  01297115
012972         EVALUATE TRUE                                            01297215
012973             WHEN SQLCODE = ZERO                                  01297315
012974                  CONTINUE                                        01297415
012975                                                                  01297515
012976             WHEN SQLCODE = +100                                  01297615
012977             WHEN SQLCODE = -904                                  01297715
012978             WHEN SQLCODE = -913                                  01297815
012979             WHEN SQLCODE = -911                                  01297915
012980             WHEN SQLWARN0 NOT = SPACES                           01298015
012981             WHEN SQLCODE NOT = ZERO                              01298115
012982                  MOVE +4             TO PV-RETRY-COUNTER         01298215
012983         END-EVALUATE                                             01298315
012984     END-PERFORM.                                                 01298415
012985                                                                  01298515
012986                                                                  01298615
012987     IF  SQLCODE = ZERO                                           01298717
012988         CONTINUE                                                 01298817
012989     ELSE                                                         01298915
012990         IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                    01299017
012991             MOVE '4000-'         TO DL024-CALL-MOD-FAIL-SQL-PARA 01299117
012992             MOVE SQLCODE         TO DL024-ASGMT-SQLCODE          01299217
012993             SET DL024-SQL-ERROR  TO TRUE                         01299317
012994             MOVE SQLCA           TO DL024-SQLCA                  01299417
012995                                                                  01299517
012996             MOVE SPACES TO PV-CICS-MSG-AREA2                     01299617
012997             MOVE DL024-KEY-DC-NBR  TO  PV-DISPLAY-OPER           01299717
012998             STRING ' DLKUT028 -'                                 01299817
012999                    PV-DISPLAY-OPER  '-'                          01299917
013000                    DL024-KEY-WK-TYP '-'                          01300017
013001                    DL024-KEY-WK-AREA '-'                         01300117
013002                    DL024-KEY-USER-ID '-'                         01300217
013003                    DL024-USER-FOUND-CODE    DELIMITED BY SIZE    01300317
013004                                        INTO PV-CICS-MSG-AREA2    01300417
013005             MOVE LENGTH OF PV-CICS-MSG-AREA2                     01300517
013006               TO PV-COMMAREA-LENGTH                              01300617
013007             PERFORM 9200-WRITE-TO-CSSL                           01300717
013008                                                                  01300817
013009             MOVE SPACES TO PV-CICS-MSG-AREA2                     01300917
013010             MOVE SQLCODE          TO  PV-DISPLAY-SQLCODE         01301017
013011             STRING ' DLKUT028 -'                                 01301117
013012                   ' PARA: 4000 - '                               01301217
013013                   ' SQLCODE: '        PV-DISPLAY-SQLCODE         01301317
013014                                       DELIMITED BY SIZE          01301417
013015                                  INTO PV-CICS-MSG-AREA2          01301517
013016             MOVE LENGTH OF PV-CICS-MSG-AREA2                     01301617
013017               TO PV-COMMAREA-LENGTH                              01301717
013018             PERFORM 9200-WRITE-TO-CSSL                           01301817
013019        END-IF                                                    01301915
013020     END-IF.                                                      01302015
013021                                                                  01302115
013022                                                                  01302215
013023*--------------------------------------------------------------*  01302315
013024*                                                              *  01302415
013025*--------------------------------------------------------------*  01302515
013026 4010-FETCH-CURSOR.                                               01302615
013027***  MOVE '4010-PROCESS-CURSOR '          TO PV-ABEND-PARAGRAPH.  01302715
013028***  DISPLAY 'NOW IN 4010-PROCESS-CURSOR '.                       01302815
013029                                                                  01302915
013030     PERFORM                                                      01303015
013031         WITH TEST AFTER                                          01303115
013032         VARYING PV-RETRY-COUNTER                                 01303215
013033         FROM 1 BY 1                                              01303315
013034         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  01303415
013035            OR SQLCODE = ZERO                                     01303515
013036            OR SQLCODE = +100                                     01303615
013037                                                                  01303715
013038         EXEC SQL                                                 01303815
013039             FETCH  ACTIVE_ASGMT_CSR                              01303915
013040                                                                  01304015
013041              INTO :DLT00003-ASGMT-STRT-DTE                       01304115
013042                 , :DLT00003-ASGMT-NBR-TXT                        01304215
013043                 , :DLT00003-ASGMT-NBR-SEQ-NBR                    01304315
013044                 , :DLT00003-TEM-ASGMT-SEQ-NBR                    01304415
013045                 , :DLT00003-KOHLS-USR-ID  :PV-NULL-IND1          01304521
013046                 , :DLT00003-TMP-USR-ID    :PV-NULL-IND2          01304621
013047                 , :DLT00003-JN-TMST                              01304715
013048                 , :DLT00003-CRE-BY-USR-ID                        01304815
013049                 , :DLT00004-ASGMT-STRT-TM                        01304915
013050                 , :DLT00004-WK-TYP-DESC                          01305015
013051                 , :DLT00004-WK-AREA-DESC                         01305115
013052                 , :DLT00004-DC-NBR                               01305215
013053                                                                  01305315
013054         END-EXEC                                                 01305415
013055                                                                  01305515
013056         EVALUATE TRUE                                            01305615
013057             WHEN SQLCODE = ZERO                                  01305715
013058                  IF  PV-NULL-IND1  =  -1                         01305821
013059                      MOVE  SPACES  TO  DLT00003-KOHLS-USR-ID     01305921
013060                  END-IF                                          01306021
013061                  IF  PV-NULL-IND2  =  -1                         01306121
013062                      MOVE  SPACES  TO  DLT00003-TMP-USR-ID       01306221
013063                  END-IF                                          01306321
013064                                                                  01306421
013065             WHEN SQLCODE = +100                                  01306515
013066                  SET PS-END-OF-CURSOR TO TRUE                    01306615
013067                                                                  01306715
013068             WHEN SQLCODE = -904                                  01306815
013069             WHEN SQLCODE = -911                                  01306915
013070             WHEN SQLCODE = -913                                  01307015
013071             WHEN SQLWARN0 NOT = SPACES                           01307115
013072             WHEN SQLCODE NOT = ZERO                              01307215
013073                  MOVE +4             TO PV-RETRY-COUNTER         01307315
013074         END-EVALUATE                                             01307415
013075     END-PERFORM.                                                 01307515
013076                                                                  01307615
013077     IF SQLCODE = ZERO  OR                                        01307715
013078        SQLCODE = +100                                            01307815
013079        CONTINUE                                                  01307915
013080     ELSE                                                         01308015
013081        IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                     01308117
013082            MOVE '4010-'         TO DL024-CALL-MOD-FAIL-SQL-PARA  01308217
013083            MOVE SQLCODE         TO DL024-ASGMT-SQLCODE           01308317
013084            SET DL024-SQL-ERROR  TO TRUE                          01308417
013085            SET PS-ERROR         TO TRUE                          01308522
013086            MOVE SQLCA           TO DL024-SQLCA                   01308622
013087                                                                  01308722
013088             MOVE SPACES TO PV-CICS-MSG-AREA2                     01308822
013089             MOVE DL024-KEY-DC-NBR  TO  PV-DISPLAY-OPER           01308922
013090             STRING ' DLKUT028 -'                                 01309022
013091                    PV-DISPLAY-OPER  '-'                          01309122
013092                    DL024-KEY-WK-TYP '-'                          01309222
013093                    DL024-KEY-WK-AREA '-'                         01309322
013094                    DL024-KEY-USER-ID '-'                         01309422
013095                    DL024-USER-FOUND-CODE    DELIMITED BY SIZE    01309522
013096                                        INTO PV-CICS-MSG-AREA2    01309622
013097             MOVE LENGTH OF PV-CICS-MSG-AREA2                     01309722
013098               TO PV-COMMAREA-LENGTH                              01309822
013099             PERFORM 9200-WRITE-TO-CSSL                           01309922
013100                                                                  01310022
013101             MOVE SPACES TO PV-CICS-MSG-AREA2                     01310122
013102             MOVE SQLCODE           TO  PV-DISPLAY-SQLCODE        01310222
013103             STRING ' DLKUT028 -'                                 01310322
013104                   ' PARA: 4010 - '                               01310422
013105                   ' SQLCODE: '        PV-DISPLAY-SQLCODE         01310522
013106                                       DELIMITED BY SIZE          01310622
013107                                  INTO PV-CICS-MSG-AREA2          01310722
013108             MOVE LENGTH OF PV-CICS-MSG-AREA2                     01310822
013109               TO PV-COMMAREA-LENGTH                              01310922
013110             PERFORM 9200-WRITE-TO-CSSL                           01311022
013111        END-IF                                                    01311122
013112     END-IF.                                                      01311222
013113                                                                  01311322
013114                                                                  01311422
013115*--------------------------------------------------------------*  01311522
013116*                                                              *  01311622
013117*--------------------------------------------------------------*  01311722
013118 4020-CLOSE-CURSOR.                                               01311822
013119**** MOVE '3000-CLOSE-CURSOR'             TO PV-ABEND-PARAGRAPH.  01311922
013120***  DISPLAY 'NOW IN  3000-CLOSE-CURSOR'.                         01312022
013121                                                                  01312122
013122     PERFORM                                                      01312222
013123         WITH TEST AFTER                                          01312322
013124         VARYING PV-RETRY-COUNTER                                 01312422
013125         FROM 1 BY 1                                              01312522
013126         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  01312622
013127            OR SQLCODE = ZERO                                     01312722
013128                                                                  01312822
013129         EXEC SQL                                                 01312922
013130              CLOSE ACTIVE_ASGMT_CSR                              01313022
013131         END-EXEC                                                 01313122
013132                                                                  01313222
013133         EVALUATE TRUE                                            01313322
013134             WHEN SQLCODE = ZERO                                  01313422
013135                  CONTINUE                                        01313522
013136                                                                  01313622
013137             WHEN SQLCODE = -904                                  01313722
013138             WHEN SQLCODE = -913                                  01313822
013139             WHEN SQLCODE = -911                                  01313922
013140             WHEN SQLCODE = +100                                  01314022
013141             WHEN SQLWARN0 NOT = SPACES                           01314122
013142             WHEN SQLCODE NOT = ZERO                              01314222
013143                  MOVE +4             TO PV-RETRY-COUNTER         01314322
013144         END-EVALUATE                                             01314422
013145     END-PERFORM.                                                 01314522
013146                                                                  01314622
013147     IF SQLCODE = ZERO                                            01314722
013148        CONTINUE                                                  01314822
013149     ELSE                                                         01314922
013150        IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                     01315022
013151            MOVE '3000-'         TO DL024-CALL-MOD-FAIL-SQL-PARA  01315122
013152            MOVE SQLCODE         TO DL024-ASGMT-SQLCODE           01315222
013153            SET DL024-SQL-ERROR  TO TRUE                          01315322
013154            MOVE SQLCA           TO DL024-SQLCA                   01315422
013155                                                                  01315522
013156             MOVE SPACES TO PV-CICS-MSG-AREA2                     01315622
013157             MOVE DL024-KEY-DC-NBR  TO  PV-DISPLAY-OPER           01315722
013158             STRING ' DLKUT028 -'                                 01315822
013159                    PV-DISPLAY-OPER  '-'                          01315922
013160                    DL024-KEY-WK-TYP '-'                          01316022
013161                    DL024-KEY-WK-AREA '-'                         01316122
013162                    DL024-KEY-USER-ID '-'                         01316222
013163                    DL024-USER-FOUND-CODE    DELIMITED BY SIZE    01316322
013164                                        INTO PV-CICS-MSG-AREA2    01316422
013165             MOVE LENGTH OF PV-CICS-MSG-AREA2                     01316522
013166               TO PV-COMMAREA-LENGTH                              01316622
013167             PERFORM 9200-WRITE-TO-CSSL                           01316722
013168                                                                  01316822
013169             MOVE SPACES TO PV-CICS-MSG-AREA2                     01316922
013170             MOVE SQLCODE           TO  PV-DISPLAY-SQLCODE        01317022
013171             STRING ' DLKUT028 -'                                 01317122
013172                   ' PARA: 4020 - '                               01317222
013173                   ' SQLCODE: '        PV-DISPLAY-SQLCODE         01317322
013174                                       DELIMITED BY SIZE          01317422
013175                                  INTO PV-CICS-MSG-AREA2          01317522
013176             MOVE LENGTH OF PV-CICS-MSG-AREA2                     01317622
013177               TO PV-COMMAREA-LENGTH                              01317722
013178             PERFORM 9200-WRITE-TO-CSSL                           01317822
013179        END-IF                                                    01317922
013180     END-IF.                                                      01318022
013181                                                                  01318122
013182                                                                  01318222
013183 4500-INSERT-TUPLDER.                                             01318322
013184                                                                  01318422
013185     MOVE DLT00004-DC-NBR              TO UPLDER-OPER-UNT-ID.     01318522
013186     MOVE 'F'                          TO UPLDER-UPLD-TRN-CDE.    01318623
013187     MOVE '101'                        TO UPLDER-ERR-CDE.         01318722
013188     MOVE  0                           TO UPLDER-UPLD-SEQ-NBR.    01318822
013189                                                                  01318922
013190     INITIALIZE  UPLDER-PKT-TXT.                                  01319022
013191     MOVE DLT00004-DC-NBR  TO  PV-DISPLAY-OPER                    01319122
013192     STRING   PV-DISPLAY-OPER         ' '                         01319222
013193              DL024-KEY-USER-ID       ' '                         01319322
013194              DLT00004-WK-TYP-DESC    ' '                         01319422
013195              DLT00004-WK-AREA-DESC   ' '                         01319522
013196              DLT00003-ASGMT-STRT-DTE ' '                         01319622
013197              DLT00003-ASGMT-NBR-TXT  ' '                         01319722
013198              DLT00003-JN-TMST        DELIMITED BY SIZE           01319822
013199                                     INTO UPLDER-PKT-TXT.         01319922
013200                                                                  01320022
013201     EXEC SQL                                                     01320122
013202         INSERT                                                   01320222
013203           INTO TUPLDER                                           01320322
013204             ( OPER_UNT_ID                                        01320422
013205             , UPLD_TRN_CDE                                       01320522
013206             , ERR_CDE                                            01320622
013207             , PRC_TMST                                           01320722
013208             , UPLD_SEQ_NBR                                       01320822
013209             , PKT_TXT                                            01320922
013210             )                                                    01321022
013211             VALUES                                               01321122
013212             ( :UPLDER-OPER-UNT-ID                                01321222
013213             , :UPLDER-UPLD-TRN-CDE                               01321322
013214             , :UPLDER-ERR-CDE                                    01321422
013215             ,  CURRENT TIMESTAMP                                 01321522
013216             , :UPLDER-UPLD-SEQ-NBR                               01321622
013217             , :UPLDER-PKT-TXT                                    01321722
013218             )                                                    01321822
013219     END-EXEC.                                                    01321922
013220                                                                  01322022
013221     EVALUATE TRUE                                                01322122
013222         WHEN SQLCODE = ZERO                                      01322222
013223             CONTINUE                                             01322322
013224         WHEN SQLWARN0 NOT = SPACES                               01322422
013225         WHEN SQLCODE  NOT = ZERO                                 01322522
013226                                                                  01322622
013227            MOVE '4500-'         TO DL024-CALL-MOD-FAIL-SQL-PARA  01322722
013228            MOVE SQLCODE         TO DL024-ASGMT-SQLCODE           01322822
013229            SET DL024-SQL-ERROR  TO TRUE                          01322922
013230            MOVE SQLCA           TO DL024-SQLCA                   01323022
013231                                                                  01323122
013232             MOVE SPACES TO PV-CICS-MSG-AREA2                     01323222
013233             MOVE DL024-KEY-DC-NBR  TO  PV-DISPLAY-OPER           01323322
013234             STRING ' DLKUT028 -'                                 01323422
013235                    PV-DISPLAY-OPER  '-'                          01323522
013236                    DL024-KEY-WK-TYP '-'                          01323622
013237                    DL024-KEY-WK-AREA '-'                         01323722
013238                    DL024-KEY-USER-ID '-'                         01323822
013239                    DL024-USER-FOUND-CODE    DELIMITED BY SIZE    01323922
013240                                        INTO PV-CICS-MSG-AREA2    01324022
013241             MOVE LENGTH OF PV-CICS-MSG-AREA2                     01324122
013242               TO PV-COMMAREA-LENGTH                              01324222
013243             PERFORM 9200-WRITE-TO-CSSL                           01324322
013244                                                                  01324422
013245             MOVE SPACES TO PV-CICS-MSG-AREA2                     01324522
013246             MOVE SQLCODE           TO  PV-DISPLAY-SQLCODE        01324622
013247             STRING ' DLKUT028 -'                                 01324722
013248                   ' PARA: 4500-INSERT-TUPLDER'                   01324822
013249                   ' SQLCODE: '        PV-DISPLAY-SQLCODE         01324922
013250                                       DELIMITED BY SIZE          01325022
013251                                  INTO PV-CICS-MSG-AREA2          01325122
013252             MOVE LENGTH OF PV-CICS-MSG-AREA2                     01325222
013253               TO PV-COMMAREA-LENGTH                              01325322
013254             PERFORM 9200-WRITE-TO-CSSL                           01325422
013255                                                                  01325522
013256     END-EVALUATE.                                                01325622
013257                                                                  01325722
013258*-----------------------------------------------------------------01325822
013259*  CALL DLKUP002 TO EITHER END THE ASSOCIATE FORM AN ASSIGNMENT  *01325922
013260*  OR ADD THE ASSOCIATE TO AN ASSIGNMENT.                        *01326022
013261*-----------------------------------------------------------------01326122
013262 6300-CALL-DLKUP002.                                              01326222
013263                                                                  01326322
013264     CALL DL005-USER-PGM USING DFHEIBLK                           01326422
013265                               DL005-COMMAREA                     01326522
013266                               DL005-ASGMT-COMMAREA.              01326622
013267                                                                  01326722
013268     EVALUATE TRUE                                                01326822
013269         WHEN DL005-SUCCESSFUL                                    01326922
013270             CONTINUE                                             01327022
013271         WHEN OTHER                                               01327122
013272             SET PS-CALLED-MODULE-ERROR TO TRUE                   01327222
013273             MOVE SPACES TO PV-CICS-MSG-AREA2                     01327322
013274             STRING ' DLKUT028 - '           DELIMITED BY SIZE    01327422
013275                    'CALLED MODULE FAILED'   DELIMITED BY SIZE    01327522
013276                                           INTO PV-CICS-MSG-AREA2 01327622
013277             MOVE LENGTH OF PV-CICS-MSG-AREA2                     01327722
013278               TO PV-COMMAREA-LENGTH                              01327822
013279             PERFORM 9200-WRITE-TO-CSSL                           01327922
013280                                                                  01328022
013281             MOVE SPACES TO PV-CICS-MSG-AREA2                     01328122
013282             MOVE '6300-CALL-DLKUP002' TO PV-MODULE-PARAGRPAH     01328222
013283             MOVE DL005-ASGMT-SQLCODE  TO PV-DISPLAY-SQLCODE      01328322
013284             STRING ' DLKUT028 - '        PV-MODULE-FAIL-MSG      01328422
013285                    ' TO '                PV-DISPLAY-TEXT         01328522
013286                    ' ASSIGNMENT'                                 01328622
013287                    ' RETURN CODE: '      DL005-RETURN-CODE       01328722
013288                    ' SQLCODE: '          PV-DISPLAY-SQLCODE      01328822
013289                                          DELIMITED BY SIZE       01328922
013290                                     INTO PV-CICS-MSG-AREA2       01329022
013291             MOVE LENGTH OF PV-CICS-MSG-AREA2                     01329122
013292               TO PV-COMMAREA-LENGTH                              01329222
013293             PERFORM 9200-WRITE-TO-CSSL                           01329322
013294                                                                  01329422
013295             MOVE SPACES TO PV-CICS-MSG-AREA2                     01329522
013296             MOVE DL024-KEY-DC-NBR  TO  PV-DISPLAY-OPER           01329622
013297             STRING ' DLKUT028 -'                                 01329722
013298                    PV-DISPLAY-OPER  '-'                          01329822
013299                    DL024-KEY-WK-TYP '-'                          01329922
013300                    DL024-KEY-WK-AREA '-'                         01330022
013301                    DL024-KEY-USER-ID '-'                         01330122
013302                    DL024-USER-FOUND-CODE    DELIMITED BY SIZE    01330222
013303                                        INTO PV-CICS-MSG-AREA2    01330322
013304             MOVE LENGTH OF PV-CICS-MSG-AREA2                     01330422
013305               TO PV-COMMAREA-LENGTH                              01330522
013306             PERFORM 9200-WRITE-TO-CSSL                           01330622
013307     END-EVALUATE.                                                01330722
013308                                                                  01330822
013309                                                                  01330922
013310*-----------------------------------------------------------------01331022
013311*  CALL XLKUP033 TO LOG AN INDIRECT SYSTEM MOVE TO THE EAI       *01331122
013312*  BUSINESS EVENT TABLES.                                        *01331222
013313*-----------------------------------------------------------------01331322
013314 6500-CALL-XLKUP033.                                              01331422
013315                                                                  01331522
013316     CALL XL072-USER-PGM USING DFHEIBLK                           01331622
013317                              XL072-COMMAREA                      01331722
013318                              XL072-EAI-EXPORT-COMMAREA.          01331822
013319                                                                  01331922
013320     EVALUATE TRUE                                                01332022
013321         WHEN XL072-SUCCESSFUL                                    01332122
013322             CONTINUE                                             01332222
013323         WHEN OTHER                                               01332322
013324             SET PS-CALLED-MODULE-ERROR TO TRUE                   01332422
013325             MOVE SPACES TO PV-CICS-MSG-AREA2                     01332522
013326             STRING ' DLKUT028 - '                                01332622
013327                    'CALLED MODULE FAILED'   DELIMITED BY SIZE    01332722
013328                                           INTO PV-CICS-MSG-AREA2 01332822
013329             MOVE LENGTH OF PV-CICS-MSG-AREA2                     01332922
013330               TO PV-COMMAREA-LENGTH                              01333022
013331             PERFORM 9200-WRITE-TO-CSSL                           01333122
013332                                                                  01333222
013333             MOVE SPACES TO PV-CICS-MSG-AREA2                     01333322
013334             MOVE '6500-CALL-XLKUP033' TO PV-MODULE-PARAGRPAH     01333422
013335             MOVE XL072-EAI-DB-SQLCODE TO PV-DISPLAY-SQLCODE      01333522
013336             STRING ' DLKUT028 - '        PV-MODULE-FAIL-MSG      01333622
013337                    ' RETURN CODE: '      XL072-RETURN-CODE       01333722
013338                    ' SQLCODE: '          PV-DISPLAY-SQLCODE      01333822
013339                                          DELIMITED BY SIZE       01333922
013340                                     INTO PV-CICS-MSG-AREA2       01334022
013341             MOVE LENGTH OF PV-CICS-MSG-AREA2                     01334122
013342               TO PV-COMMAREA-LENGTH                              01334222
013343             PERFORM 9200-WRITE-TO-CSSL                           01334322
013344                                                                  01334422
013345             MOVE SPACES TO PV-CICS-MSG-AREA2                     01334522
013346             MOVE DL024-KEY-DC-NBR  TO  PV-DISPLAY-OPER           01334622
013347             STRING ' DLKUT028 -'                                 01334722
013348                    PV-DISPLAY-OPER  '-'                          01334822
013349                    DL024-KEY-WK-TYP '-'                          01334922
013350                    DL024-KEY-WK-AREA '-'                         01335022
013351                    DL024-KEY-USER-ID '-'                         01335122
013352                    DL024-USER-FOUND-CODE    DELIMITED BY SIZE    01335222
013353                                        INTO PV-CICS-MSG-AREA2    01335322
013354             MOVE LENGTH OF PV-CICS-MSG-AREA2                     01335422
013355               TO PV-COMMAREA-LENGTH                              01335522
013356             PERFORM 9200-WRITE-TO-CSSL                           01335622
013357     END-EVALUATE.                                                01335722
013358                                                                  01335822
013359                                                                  01335922
013360 9200-WRITE-TO-CSSL.                                              01336022
013361                                                                  01336122
013362     EXEC CICS                                                    01336222
013363          WRITEQ TD                                               01336322
013364           QUEUE  ('CSSL')                                        01336422
013365            FROM  (PV-CICS-MSG-AREA2)                             01336522
013366          LENGTH  (PV-COMMAREA-LENGTH)                            01336622
013367            RESP  (PV-CICS-RESP)                                  01336722
013370     END-EXEC.                                                    01337020
013400                                                                  01340006
