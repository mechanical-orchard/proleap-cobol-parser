000100 IDENTIFICATION DIVISION.                                         00010002
000200 PROGRAM-ID.             SUKUT120.                                00020099
000300 AUTHOR.                 AL PETERS.                               00030099
000310 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00031099
000400 DATE-WRITTEN.           JUNE, 2008.                              00040099
000500 DATE-COMPILED.                                                   00050002
000600***************************************************************** 00060002
001000*                                                               * 00100002
001100*  THIS PROGRAM WILL EXTRACT MANIFEST DATA FROM TRAILERS THAT   * 00110068
001200*  WERE SHIPPED THE PRIOR FISCAL WEEK.  A COMMA DELIMITED FILE  * 00120068
001300*  WILL BE CREATED AND FTP'D TO LOGISTICS AND BEST PRACTICES.   * 00130099
001400*                                                               * 00140002
001500***************************************************************** 00150002
002100                                                                  00210002
002200 ENVIRONMENT DIVISION.                                            00220002
002300 CONFIGURATION SECTION.                                           00230002
002400 SOURCE-COMPUTER.    IBM-3090.                                    00240002
002500 OBJECT-COMPUTER.    IBM-3090.                                    00250002
002600                                                                  00260002
002700 INPUT-OUTPUT SECTION.                                            00270002
002800 FILE-CONTROL.                                                    00280002
002810     SELECT CONTROL-FILE         ASSIGN TO INP01.                 00281068
002820                                                                  00282068
002900     SELECT MANIFEST-FILE        ASSIGN TO OUT01.                 00290068
003000                                                                  00300002
003100 DATA DIVISION.                                                   00310002
003200 FILE SECTION.                                                    00320002
003300                                                                  00330002
003310 FD  CONTROL-FILE                                                 00331068
003320     RECORDING MODE IS F                                          00332068
003330     LABEL RECORDS ARE STANDARD                                   00333068
003340     DATA RECORD IS CONTROL-REC.                                  00334068
003350                                                                  00335068
003360 01  CONTROL-REC                 PIC X(80).                       00336068
003370                                                                  00337068
003400 FD  MANIFEST-FILE                                                00340068
003500     RECORDING MODE IS F                                          00350002
003600     LABEL RECORDS ARE STANDARD                                   00360002
003700     DATA RECORD IS MANIFEST-REC.                                 00370068
003800                                                                  00380043
003900 01  MANIFEST-REC                PIC X(194).                      00390099
004000                                                                  00400043
004100 WORKING-STORAGE SECTION.                                         00410002
004110                                                                  00411051
004120*----------------------------------------------------------------*00412051
004130*  OUTPUT LAYOUT FOR DELIMITED FILE                              *00413062
004140*----------------------------------------------------------------*00414051
004150     COPY SURD077.                                                00415068
004151                                                                  00415197
004152 01  MANIFEST-HDR1-REC.                                           00415299
004153     05  MF-HDR1-DELIMIT-01      PIC  X(01)  VALUE ','.           00415399
004154     05  MF-HDR1-DELIMIT-02      PIC  X(01)  VALUE ','.           00415499
004155     05  MF-HDR1-STORE           PIC  X(05)  VALUE 'STORE'.       00415599
004156     05  MF-HDR1-DELIMIT-03      PIC  X(01)  VALUE ','.           00415699
004157     05  MF-HDR1-OTBND           PIC  X(05)  VALUE 'OTBND'.       00415799
004158     05  MF-HDR1-DELIMIT-04      PIC  X(01)  VALUE ','.           00415899
004159     05  MF-HDR1-TRLR-SRL        PIC  X(04)  VALUE 'TRLR'.        00415999
004160     05  MF-HDR1-DELIMIT-05      PIC  X(01)  VALUE ','.           00416099
004161     05  MF-HDR1-DELIMIT-06      PIC  X(01)  VALUE ','.           00416199
004162     05  MF-HDR1-TRLR-SIZE       PIC  X(04)  VALUE 'TRLR'.        00416299
004163     05  MF-HDR1-DELIMIT-07      PIC  X(01)  VALUE ','.           00416399
004164     05  MF-HDR1-DELIMIT-08      PIC  X(01)  VALUE ','.           00416499
004165     05  MF-HDR1-DELIMIT-09      PIC  X(01)  VALUE ','.           00416599
004166     05  MF-HDR1-DELIMIT-10      PIC  X(01)  VALUE ','.           00416699
004167     05  MF-HDR1-DELIMIT-11      PIC  X(01)  VALUE ','.           00416799
004168     05  MF-HDR1-DELIMIT-12      PIC  X(01)  VALUE ','.           00416899
004169     05  MF-HDR1-DELIMIT-13      PIC  X(01)  VALUE ','.           00416999
004170     05  FILLER                  PIC  X(163) VALUE SPACES.        00417099
004171                                                                  00417199
004172 01  MANIFEST-HDR2-REC.                                           00417299
004173     05  MF-HDR2-DC              PIC  X(02)  VALUE 'DC'.          00417399
004174     05  MF-HDR2-DELIMIT-01      PIC  X(01)  VALUE ','.           00417499
004175     05  MF-HDR2-STORE           PIC  X(05)  VALUE 'STORE'.       00417599
004176     05  MF-HDR2-DELIMIT-02      PIC  X(01)  VALUE ','.           00417699
004177     05  MF-HDR2-OPEN            PIC  X(04)  VALUE 'OPEN'.        00417799
004178     05  MF-HDR2-DELIMIT-03      PIC  X(01)  VALUE ','.           00417899
004179     05  MF-HDR2-TRIP            PIC  X(04)  VALUE 'TRIP'.        00417999
004180     05  MF-HDR2-DELIMIT-04      PIC  X(01)  VALUE ','.           00418099
004181     05  MF-HDR2-SRL             PIC  X(03)  VALUE 'SRL'.         00418199
004182     05  MF-HDR2-DELIMIT-05      PIC  X(01)  VALUE ','.           00418299
004183     05  MF-HDR2-SCAC            PIC  X(04)  VALUE 'SCAC'.        00418399
004184     05  MF-HDR2-DELIMIT-06      PIC  X(01)  VALUE ','.           00418499
004185     05  MF-HDR2-TRLR            PIC  X(04)  VALUE 'TRLR'.        00418599
004186     05  MF-HDR2-DELIMIT-07      PIC  X(01)  VALUE ','.           00418699
004187     05  MF-HDR2-SIZE            PIC  X(04)  VALUE 'SIZE'.        00418799
004188     05  MF-HDR2-DELIMIT-08      PIC  X(01)  VALUE ','.           00418899
004189     05  MF-HDR2-SUMMARY         PIC  X(07)  VALUE 'SUMMARY'.     00418999
004190     05  MF-HDR2-DELIMIT-09      PIC  X(01)  VALUE ','.           00419099
004191     05  MF-HDR2-CART            PIC  X(04)  VALUE 'CART'.        00419199
004192     05  MF-HDR2-DELIMIT-10      PIC  X(01)  VALUE ','.           00419299
004193     05  MF-HDR2-UNT             PIC  X(03)  VALUE 'UNT'.         00419399
004194     05  MF-HDR2-DELIMIT-11      PIC  X(01)  VALUE ','.           00419499
004195     05  MF-HDR2-SHIPPED         PIC  X(07)  VALUE 'SHIPPED'.     00419599
004196     05  MF-HDR2-DELIMIT-12      PIC  X(01)  VALUE ','.           00419699
004197     05  MF-HDR2-CLOSED          PIC  X(06)  VALUE 'CLOSED'.      00419799
004198     05  MF-HDR2-DELIMIT-13      PIC  X(01)  VALUE ','.           00419899
004199     05  MF-HDR2-OPEN            PIC  X(04)  VALUE 'OPEN'.        00419999
004200     05  MF-HDR2-DELIMIT-14      PIC  X(01)  VALUE ','.           00420099
004201     05  FILLER                  PIC  X(119) VALUE SPACES.        00420199
004202                                                                  00420299
004203 01  MANIFEST-HDR3-REC.                                           00420399
004204     05  MF-HDR3-DC-NBR          PIC  X(03)  VALUE 'NBR'.         00420499
004205     05  MF-HDR3-DELIMIT-01      PIC  X(01)  VALUE ','.           00420599
004206     05  MF-HDR3-STORE-NBR       PIC  X(03)  VALUE 'NBR'.         00420699
004207     05  MF-HDR3-DELIMIT-02      PIC  X(01)  VALUE ','.           00420799
004208     05  MF-HDR3-DATE            PIC  X(04)  VALUE 'DATE'.        00420899
004209     05  MF-HDR3-DELIMIT-03      PIC  X(01)  VALUE ','.           00420999
004210     05  MF-HDR3-ID              PIC  X(02)  VALUE 'ID'.          00421099
004211     05  MF-HDR3-DELIMIT-04      PIC  X(01)  VALUE ','.           00421199
004212     05  MF-HDR3-SRL-NBR         PIC  X(03)  VALUE 'NBR'.         00421299
004213     05  MF-HDR3-DELIMIT-05      PIC  X(01)  VALUE ','.           00421399
004214     05  MF-HDR3-CDE             PIC  X(03)  VALUE 'CDE'.         00421499
004215     05  MF-HDR3-DELIMIT-06      PIC  X(01)  VALUE ','.           00421599
004216     05  MF-HDR3-TRLR-ID         PIC  X(02)  VALUE 'ID'.          00421699
004217     05  MF-HDR3-DELIMIT-07      PIC  X(01)  VALUE ','.           00421799
004218     05  MF-HDR3-MU              PIC  X(02)  VALUE 'MU'.          00421899
004219     05  MF-HDR3-DELIMIT-08      PIC  X(01)  VALUE ','.           00421999
004220     05  MF-HDR3-SUMM-DATE       PIC  X(04)  VALUE 'DATE'.        00422099
004221     05  MF-HDR3-DELIMIT-09      PIC  X(01)  VALUE ','.           00422199
004222     05  MF-HDR3-CART-QTY        PIC  X(03)  VALUE 'QTY'.         00422299
004223     05  MF-HDR3-DELIMIT-10      PIC  X(01)  VALUE ','.           00422399
004224     05  MF-HDR3-UNT-QTY         PIC  X(03)  VALUE 'QTY'.         00422499
004225     05  MF-HDR3-DELIMIT-11      PIC  X(01)  VALUE ','.           00422599
004226     05  MF-HDR3-SHIP-DATE       PIC  X(04)  VALUE 'DATE'.        00422699
004227     05  MF-HDR3-DELIMIT-12      PIC  X(01)  VALUE ','.           00422799
004228     05  MF-HDR3-CLOSED-DATE     PIC  X(04)  VALUE 'DATE'.        00422899
004229     05  MF-HDR3-DELIMIT-13      PIC  X(01)  VALUE ','.           00422999
004230     05  MF-HDR3-OPEN-DATE       PIC  X(04)  VALUE 'DATE'.        00423099
004231     05  MF-HDR3-DELIMIT-14      PIC  X(01)  VALUE ','.           00423199
004232     05  FILLER                  PIC  X(136) VALUE SPACES.        00423299
004233                                                                  00423399
004234 01  DT-DC-COUNT                 PIC  ZZZZZZ9.                    00423499
004240                                                                  00424099
004300                                                                  00430002
006400 01  PV-PROGRAM-VARIABLES.                                        00640002
006500     05  FILLER                  PIC  X(31)  VALUE                00650033
006600         '** BEGINNING OF SUKUT120 W/S **'.                       00660068
006700     05  PV-PROGRAM-NAME         PIC  X(08)  VALUE 'SUKUT120'.    00670068
006800     05  PV-CURRENT-DATE.                                         00680002
006900         10  PV-CURRENT-YEAR     PIC  9(02)  VALUE ZEROS.         00690002
007000         10  PV-CURRENT-MONTH    PIC  9(02)  VALUE ZEROS.         00700002
007100         10  PV-CURRENT-DAY      PIC  9(02)  VALUE ZEROS.         00710002
007200     05  PV-CURRENT-TIME.                                         00720002
007300         10  PV-CURRENT-HOUR     PIC  9(02)  VALUE ZEROS.         00730002
007400         10  PV-CURRENT-MINUTE   PIC  9(02)  VALUE ZEROS.         00740002
007500         10  FILLER              PIC  9(02)  VALUE ZEROS.         00750002
007510                                                                  00751070
007600     05  PV-CNTRL-CARD.                                           00760070
007800         10  PV-CNTRL-FROM-DTE   PIC  X(10).                      00780070
007810         10  FILLER              PIC  X.                          00781080
007900         10  PV-CNTRL-TO-DTE     PIC  X(10).                      00790070
007910         10  FILLER              PIC  X.                          00791080
008000         10  PV-CNTRL-DURATION   PIC  X.                          00800070
008310                                                                  00831049
008320     05  PV-PREV-DC-NBR          PIC S9(4) COMP.                  00832078
008321     05  PV-DC                   PIC X(04) VALUE SPACES.          00832178
008330                                                                  00833078
008400     05  PV-DC-NBR                    PIC  S9(4) COMP.            00840070
008410     05  PV-STORE-NBR                 PIC  S9(4) COMP.            00841070
008500     05  PV-STORE-OPEN-DATE           PIC  X(10).                 00850070
008510     05  PV-OTBND-TRIP-ID             PIC  S9(9) COMP.            00851070
008520     05  PV-TRLR-SRL-NBR              PIC  S9(9) COMP.            00852070
008530     05  PV-SCAC-CD                   PIC  X(4).                  00853070
008540     05  PV-TRLR-ID                   PIC  X(12).                 00854070
008550     05  PV-TRLR-SIZE                 PIC  S9(4) COMP.            00855070
008551     05  PV-TRIP-STAT-CDE             PIC  X(2).                  00855181
008560     05  PV-TRLR-SUMM-TMST            PIC  X(26).                 00856074
008570     05  PV-CARTON-QTY                PIC  S9(4) COMP.            00857070
008580     05  PV-UNIT-QTY                  PIC  S9(9) COMP.            00858070
008590     05  PV-TRLR-SHIP-TMST            PIC  X(26).                 00859070
008591     05  PV-TRLR-CLOSE-TMST           PIC  X(26).                 00859170
008592     05  PV-TRLR-OPEN-TMST            PIC  X(26).                 00859299
008600                                                                  00860022
008610     05  PV-COMMA                     PIC  X(01)  VALUE ','.      00861066
008620                                                                  00862066
008700 01  PC-COUNTERS.                                                 00870056
008800     05  PC-MANIFEST-READ            PIC 9(07)    VALUE ZEROS.    00880074
008810     05  PC-MANIFEST-WRITTEN         PIC 9(07)    VALUE ZEROS.    00881074
008820     05  PC-DC-CNT                   PIC 9(07)    VALUE ZEROS.    00882094
008900                                                                  00890056
009100 01  PS-PROGRAM-SWITCHES.                                         00910022
009200     05  PS-END-OF-MANIFEST-SW   PIC X(01)        VALUE 'N'.      00920073
009300         88  MORE-MFST-CSR                        VALUE 'N'.      00930073
009400         88  END-OF-MFST-CSR                      VALUE 'Y'.      00940073
009500                                                                  00950022
009510     05  PS-END-OF-CONTROL-SW    PIC X(01)        VALUE 'N'.      00951073
009520         88  MORE-CONTROLS                        VALUE 'N'.      00952073
009530         88  END-OF-CONTROLS                      VALUE 'Y'.      00953073
009600*----------------------------------------------------------------*00960022
009700*  COMMUNICATIONS AREA2 FOR DB2                                  *00970022
009800*----------------------------------------------------------------*00980022
009900     COPY SQLCA2.                                                 00990022
010000                                                                  01000022
010100     EXEC SQL                                                     01010022
010200          INCLUDE SQLCA                                           01020022
010300     END-EXEC.                                                    01030022
010400                                                                  01040022
010500*----------------------------------------------------------------*01050022
010600*  OUTBOUND TRAILER TRIP STATUS TABLE                            *01060068
010700*----------------------------------------------------------------*01070022
010800     EXEC SQL                                                     01080022
010900          INCLUDE TSUOBTS                                         01090068
011000     END-EXEC.                                                    01100022
011100                                                                  01110022
011200*----------------------------------------------------------------*01120022
011300*  OUTBOUND TRAILER TRIP TABLE                                   *01130068
011400*----------------------------------------------------------------*01140022
011500     EXEC SQL                                                     01150022
011600          INCLUDE TSUOBTR                                         01160068
011700     END-EXEC.                                                    01170022
011800                                                                  01180022
011900*----------------------------------------------------------------*01190030
012000*  LOGISTICS LOCATION TABLE                                      *01200068
012100*----------------------------------------------------------------*01210030
012200     EXEC SQL                                                     01220030
012300          INCLUDE XLT00010                                        01230068
012400     END-EXEC.                                                    01240030
012500                                                                  01250030
012600*----------------------------------------------------------------*01260030
012700*  TRAILER DEFINITION TABLE                                      *01270068
012800*----------------------------------------------------------------*01280030
012900     EXEC SQL                                                     01290030
013000          INCLUDE TCNTRID                                         01300068
013100     END-EXEC.                                                    01310030
013200                                                                  01320030
013400*----------------------------------------------------------------*01340068
013500*  TRIP SUMMARY TABLE                                            *01350068
013600*----------------------------------------------------------------*01360068
013700     EXEC SQL                                                     01370068
013800          INCLUDE SUT00007                                        01380068
013900     END-EXEC.                                                    01390068
014000*----------------------------------------------------------------*01400022
014100*   MFST_CSR SELECTS ALL THE OUTBOUND TRIPS THAT WERE SHIPPED    *01410070
014200*   FOR THE DESIRED DATES.                                       *01420069
014201*----------------------------------------------------------------*01420169
014210     EXEC SQL                                                     01421070
014220       DECLARE MFST_CSR CURSOR FOR                                01422070
014300         SELECT A.STAT_OPER_UNT_ID    AS  DC_NBR                  01430070
014400              , B.DEST_OPER_UNT_ID    AS  STORE_NBR               01440070
014500              , C.OPN_DTE             AS  STORE_OPEN_DATE         01450070
014600              , A.OTBND_TRIP_ID                                   01460070
014700              , B.TRLR_SRL_NBR                                    01470070
014800              , D.SCAC_CDE                                        01480070
014900              , D.TRLR_ID                                         01490070
015000              , D.TRLR_SIZE_MU                                    01500070
015100              , A.TRIP_STAT_CDE                                   01510070
015200              , A.OTBND_STAT_TMST     AS  TRLR_SHIP_TMST          01520070
015300              , E.OTBND_STAT_TMST     AS  TRLR_CLOSE_TMST         01530070
015400              , G.OTBND_STAT_TMST     AS  TRLR_OPEN_TMST          01540099
016900         FROM TSUOBTS A                                           01690077
016910            , TSUOBTR B                                           01691077
016920            , XLT_LOC C                                           01692077
016930            , TCNTRID D                                           01693077
016940            , TSUOBTS E                                           01694077
016941            , TSUOBTS G                                           01694199
016950         WHERE DATE(A.OTBND_STAT_TMST)  >=  :PV-CNTRL-FROM-DTE    01695073
016960           AND DATE(A.OTBND_STAT_TMST)  <=  :PV-CNTRL-TO-DTE      01696074
016970           AND A.TRIP_STAT_CDE           =  'DS'                  01697070
016980           AND A.OTBND_TRIP_ID           =  B.OTBND_TRIP_ID       01698070
016990           AND B.DEST_OPER_UNT_ID        =  C.LOC_NBR             01699070
016991           AND B.TRLR_SRL_NBR            =  D.TRLR_SRL_NBR        01699170
016992           AND A.OTBND_TRIP_ID           =  E.OTBND_TRIP_ID       01699270
016993           AND A.OTBND_TRIP_ID           =  G.OTBND_TRIP_ID       01699399
016994           AND E.TRIP_STAT_CDE           =  'DC'                  01699499
016995           AND E.OTBND_STAT_TMST  IN                              01699599
016996               (SELECT MAX(F.OTBND_STAT_TMST)                     01699699
016997                  FROM TSUOBTS F                                  01699799
016998                 WHERE E.OTBND_TRIP_ID  =  F.OTBND_TRIP_ID        01699899
016999                   AND F.TRIP_STAT_CDE  =  'DC')                  01699999
017000           AND G.OTBND_STAT_TMST  IN                              01700099
017001               (SELECT MIN(H.OTBND_STAT_TMST)                     01700199
017002                  FROM TSUOBTS H                                  01700299
017003                 WHERE G.OTBND_TRIP_ID  =  H.OTBND_TRIP_ID        01700399
017004                   AND H.TRIP_STAT_CDE  =  'DO')                  01700499
017005         ORDER BY  A.STAT_OPER_UNT_ID                             01700599
017006                 ,  B.DEST_OPER_UNT_ID                            01700699
017010                 ,  A.OTBND_STAT_TMST                             01701070
017020     END-EXEC.                                                    01702070
017030                                                                  01703070
017040                                                                  01704070
017050*----------------------------------------------------------------*01705070
017100*  ABEND DATA AREAS                                              *01710022
017200*----------------------------------------------------------------*01720022
017300 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          01730022
017400                                             COMP SYNC.           01740022
017500     88  AC-BAD-DATA                         VALUE +4003.         01750022
017600     88  AC-DB2-ERROR                        VALUE +4013.         01760022
017700                                                                  01770022
017800 01  ABEND-AREAS.                                                 01780022
017900     05  AA-ABEND-TMK            PIC  X(40)  VALUE                01790061
018000             '*****       ABEND'.                                 01800022
018100     05  AA-PROGRAM-TMK          PIC  X(40)  VALUE                01810061
018200             '*****   PROGRAM: SUKUT120'.                         01820070
018300     05  AA-PARAGRAPH-TMK.                                        01830061
018400         10  FILLER              PIC  X(17)  VALUE                01840022
018500             '***** PARAGRAPH: '.                                 01850022
018600         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        01860022
018700     05  AA-MESSAGE-LINE.                                         01870022
018800         10  FILLER              PIC  X(06)  VALUE '*****'.       01880022
018900         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        01890022
019000     05  AA-DB2-ERROR-TMK        PIC  X(40)  VALUE                01900061
019100             '*****    DB2 ERROR'.                                01910022
019200     05  AA-DB2-OPERATION-TMK.                                    01920061
019300         10  FILLER              PIC  X(17)  VALUE                01930022
019400             '***** OPERATION: '.                                 01940022
019500         10  AA-DB2-OPERATION.                                    01950022
019600             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        01960022
019700             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        01970022
019800     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        01980022
019900     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        01990022
020000     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        02000022
020100     05  AA-DB2-TABLE-4          PIC  X(08)  VALUE SPACES.        02010032
020200                                                                  02020022
020300     COPY DPWS004.                                                02030022
020400 01  FILLER                      PIC  X(25)  VALUE                02040022
020500     '** END OF SUKUT120 W/S **'.                                 02050070
020600                                                                  02060022
020700 PROCEDURE DIVISION.                                              02070022
020800                                                                  02080042
020900 A100-MAIN.                                                       02090022
021000     PERFORM B100-INITIALIZATION.                                 02100022
021100                                                                  02110022
021200     PERFORM B300-PROCESS-MANIFEST-REC                            02120073
021300       UNTIL END-OF-MFST-CSR.                                     02130070
021400                                                                  02140022
021500     PERFORM B400-END-PROGRAM.                                    02150073
021600                                                                  02160022
021700     GOBACK.                                                      02170022
021800                                                                  02180022
021900 B100-INITIALIZATION.                                             02190022
022000*----------------------------------------------------------------*02200022
022100*    OPEN FILES AND PERFORM INITIALIZATION.                      *02210070
022200*----------------------------------------------------------------*02220022
022300     OPEN INPUT  CONTROL-FILE                                     02230070
022310          OUTPUT MANIFEST-FILE.                                   02231070
022400                                                                  02240022
022500     INITIALIZE DCLTSUOBTS                                        02250070
022600                DCLTSUOBTR                                        02260070
022800                DCLTCNTRID                                        02280070
022810                DCLXLT00010                                       02281070
022820                DCLSUT00007                                       02282075
022900                MANIFEST-REC.                                     02290070
022910                                                                  02291072
022920     PERFORM B200-READ-CONTROL-FILE.                              02292073
023000                                                                  02300022
023010     DISPLAY '*********************************'.                 02301088
023020     DISPLAY '* EXTRACT MANIFEST DATE RANGE *  '.                 02302088
023030     DISPLAY '*********************************'.                 02303088
023040     DISPLAY '* FROM DATE = ' PV-CNTRL-FROM-DTE                   02304088
023050     DISPLAY '* TO DATE   = ' PV-CNTRL-TO-DTE                     02305088
023051     DISPLAY '* DURATION  = ' PV-CNTRL-DURATION                   02305199
023060     DISPLAY '*********************************'.                 02306088
023070                                                                  02307088
023080** THIS INITIAL WRITE PUTS A RECORD OF HEADINGS AS THE FIRST      02308097
023090** RECORD ON THE FILE.                                            02309097
023091                                                                  02309197
023092     MOVE MANIFEST-HDR1-REC TO MANIFEST-REC.                      02309299
023093     WRITE MANIFEST-REC.                                          02309399
023094                                                                  02309497
023095     MOVE MANIFEST-HDR2-REC TO MANIFEST-REC.                      02309599
023096     WRITE MANIFEST-REC.                                          02309699
023097                                                                  02309799
023098     MOVE MANIFEST-HDR3-REC TO MANIFEST-REC.                      02309899
023099     WRITE MANIFEST-REC.                                          02309999
023100                                                                  02310099
023101** END OF PRINT HEADINGS.                                         02310199
023102                                                                  02310299
023110     PERFORM Y100-OPEN-MFST-CSR.                                  02311070
023200                                                                  02320051
023300     PERFORM R100-FETCH-MANIFEST-REC.                             02330074
023400     IF END-OF-MFST-CSR                                           02340074
023500         DISPLAY '***  SUKUT120   ***'                            02350070
023600         DISPLAY 'FIRST FETCH OF MFST CURSOR        '             02360070
023700         DISPLAY 'NO MANIFEST RECORDS FOUND         '             02370070
023800         DISPLAY ' '                                              02380051
023900     END-IF.                                                      02390051
024000                                                                  02400097
025002                                                                  02500297
025010 B200-READ-CONTROL-FILE.                                          02501073
025020*----------------------------------------------------------------*02502073
025030*    READ THE CONTROL RECORD AND MOVE THE DATE RANGE FOR         *02503073
025040*    PROCESSING.                                                 *02504073
025050*----------------------------------------------------------------*02505073
025060     READ CONTROL-FILE INTO PV-CNTRL-CARD                         02506073
025070       AT END                                                     02507073
025080         SET END-OF-CONTROLS TO TRUE.                             02508086
025099                                                                  02509973
025100 B300-PROCESS-MANIFEST-REC.                                       02510073
025200*----------------------------------------------------------------*02520022
025300*    CREATING OUTPUT FILE BY MOVING FIELDS FETCHED INTO THEIR    *02530022
025400*    CORRESPONDING COPYBOOK FIELDS.                              *02540022
025500*----------------------------------------------------------------*02550022
025594                                                                  02559482
025600     INITIALIZE SU077-MFST-EXTRACT-RECORD.                        02560070
025700                                                                  02570022
025800     MOVE PV-DC-NBR                TO SU077-DC-NBR.               02580070
026000     MOVE PV-STORE-NBR             TO SU077-STORE-NBR.            02600070
026010     MOVE PV-STORE-OPEN-DATE       TO SU077-STORE-OPEN-DATE.      02601070
026100     MOVE PV-OTBND-TRIP-ID         TO SU077-OTBND-TRIP-ID.        02610070
026200     MOVE PV-TRLR-SRL-NBR          TO SU077-TRLR-SRL-NBR.         02620070
026300     MOVE PV-SCAC-CD               TO SU077-SCAC.                 02630070
026400     MOVE PV-TRLR-ID               TO SU077-TRLR-ID.              02640075
026500     MOVE PV-TRLR-SIZE             TO SU077-TRLR-SIZE.            02650070
026600     MOVE PV-TRLR-SUMM-TMST        TO SU077-TRLR-SUMMARY-TMST.    02660074
026610     MOVE PV-CARTON-QTY            TO SU077-CARTON-QTY.           02661070
026620     MOVE PV-UNIT-QTY              TO SU077-UNIT-QTY.             02662070
026630     MOVE PV-TRLR-SHIP-TMST        TO SU077-TRLR-SHIP-TMST.       02663071
026640     MOVE PV-TRLR-CLOSE-TMST       TO SU077-TRLR-CLOSE-TMST.      02664071
026641     MOVE PV-TRLR-OPEN-TMST        TO SU077-TRLR-OPEN-TMST.       02664199
026642     MOVE PV-COMMA                 TO SU077-COMMA-01              02664299
026650                                      SU077-COMMA-02              02665071
026660                                      SU077-COMMA-03              02666071
026670                                      SU077-COMMA-04              02667071
026680                                      SU077-COMMA-05              02668071
026690                                      SU077-COMMA-06              02669071
026700                                      SU077-COMMA-07              02670071
026710                                      SU077-COMMA-08              02671071
026720                                      SU077-COMMA-09              02672071
026730                                      SU077-COMMA-10              02673071
026740                                      SU077-COMMA-11              02674071
026741                                      SU077-COMMA-12              02674171
026742                                      SU077-COMMA-13              02674299
026743                                      SU077-COMMA-14.             02674399
026750                                                                  02675066
026800     PERFORM W100-WRITE-MANIFEST-REC.                             02680071
026900                                                                  02690059
027000     PERFORM R100-FETCH-MANIFEST-REC.                             02700071
027100                                                                  02710022
027200 B400-END-PROGRAM.                                                02720073
027300*----------------------------------------------------------------*02730022
027400*    ENDING PROCESSING: DISPLAYS COUNTS, AND CLOSES FILES.       *02740022
027500*----------------------------------------------------------------*02750022
027600     CLOSE MANIFEST-FILE.                                         02760073
027601                                                                  02760185
027602*    DISPLAY THE LAST DC COUNT.                                   02760285
027603                                                                  02760385
027610     MOVE PV-PREV-DC-NBR TO PV-DC                                 02761085
027620     MOVE PV-DC-NBR      TO PV-PREV-DC-NBR                        02762085
027621     MOVE PC-DC-CNT      TO DT-DC-COUNT                           02762196
027630     DISPLAY '       '                                            02763085
027640     DISPLAY '****************************'                       02764085
027650     DISPLAY 'DC = ' PV-DC                                        02765085
027660     DISPLAY 'TOTAL RECS = ' DT-DC-COUNT                          02766095
027670     DISPLAY '****************************'                       02767085
027680     MOVE ZERO TO PC-DC-CNT                                       02768085
027690                                                                  02769085
027700*    DISPLAY THE FINIAL RECORD COUNTS                             02770085
027710                                                                  02771085
027800     DISPLAY '       '                                            02780022
027900     DISPLAY '**********************************'                 02790022
028000     DISPLAY '******** SUKUT120 SUMMARY ********'.                02800073
028300     DISPLAY 'MANIFEST RECS FETCHED  = '                          02830073
028400                                       PC-MANIFEST-READ.          02840075
028500     DISPLAY 'TOTAL RECORDS WRITTEN  = '                          02850026
028600                                       PC-MANIFEST-WRITTEN.       02860075
028700     DISPLAY '**********************************'                 02870026
028800     DISPLAY '       '                                            02880026
028900                                                                  02890026
029000     PERFORM Y200-CLOSE-MFST-CSR.                                 02900073
029100                                                                  02910026
029200 R100-FETCH-MANIFEST-REC.                                         02920071
029300*----------------------------------------------------------------*02930026
029400*  RETRIEVES THE MFST_CSR DATA                                   *02940071
029500*----------------------------------------------------------------*02950026
029600     EXEC SQL                                                     02960042
029700         FETCH   MFST_CSR                                         02970071
029800          INTO  :PV-DC-NBR                                        02980071
029900               ,:PV-STORE-NBR                                     02990071
030000               ,:PV-STORE-OPEN-DATE                               03000071
030100               ,:PV-OTBND-TRIP-ID                                 03010071
030110               ,:PV-TRLR-SRL-NBR                                  03011071
030120               ,:PV-SCAC-CD                                       03012071
030130               ,:PV-TRLR-ID                                       03013071
030140               ,:PV-TRLR-SIZE                                     03014081
030150               ,:PV-TRIP-STAT-CDE                                 03015081
030170               ,:PV-TRLR-SHIP-TMST                                03017071
030180               ,:PV-TRLR-CLOSE-TMST                               03018071
030190               ,:PV-TRLR-OPEN-TMST                                03019099
030200     END-EXEC.                                                    03020042
030300                                                                  03030041
030400     EVALUATE TRUE                                                03040026
030500         WHEN SQLCODE = ZERO                                      03050026
030510             PERFORM R200-GET-CARTON-SUM-UNITS                    03051071
030600             ADD 1 TO PC-MANIFEST-READ                            03060074
030630             PERFORM R300-DISPLAY-DC-COUNTS                       03063083
030700         WHEN SQLCODE = +100                                      03070026
030800             SET END-OF-MFST-CSR TO TRUE                          03080074
030900                                                                  03090026
031000         WHEN SQLWARN0 NOT = SPACES                               03100026
031100         WHEN SQLCODE  NOT = ZERO                                 03110026
031200             MOVE 'R100-FETCH-MFST-REC'                           03120074
031300                                        TO AA-PARAGRAPH-NAME      03130026
031400             MOVE 'UNSUCCESSFUL FETCH WITH MFST_CSR'              03140074
031500                                        TO AA-DB2-OPERATION       03150026
031600             MOVE 'TSUOBTS'             TO AA-DB2-TABLE-1         03160074
031700             MOVE 'TSUOBTR'             TO AA-DB2-TABLE-2         03170074
031800             MOVE 'TCNTRID'             TO AA-DB2-TABLE-3         03180074
031900             MOVE 'XLT_LOC'             TO AA-DB2-TABLE-4         03190074
032000             PERFORM Z998-DB2-ABEND                               03200026
032100     END-EVALUATE.                                                03210026
032200                                                                  03220026
032300 R200-GET-CARTON-SUM-UNITS.                                       03230071
032400*----------------------------------------------------------------*03240071
032500*  RETRIEVES THE CARTON SUMMARY UNITS                            *03250071
032600*----------------------------------------------------------------*03260071
032700     EXEC SQL                                                     03270071
032800         SELECT A.CRE_TMST        AS SUMMARY_DATE                 03280071
032900              , A.CART_QTY                                        03290071
033000              , A.UNT_QTY                                         03300071
033010         INTO                                                     03301074
033020                :SUT00007-CRE-TMST                                03302074
033030              , :SUT00007-CART-QTY                                03303074
033040              , :SUT00007-UNT-QTY                                 03304074
033100           FROM SUT_TRIP_SUM A                                    03310071
033200          WHERE A.OTBND_TRIP_ID = :PV-OTBND-TRIP-ID               03320074
033300            AND A.CRE_TMST  IN                                    03330074
033400              (SELECT MAX(B.CRE_TMST)                             03340074
033500                 FROM SUT_TRIP_SUM B                              03350074
033600                WHERE A.OTBND_TRIP_ID  =  B.OTBND_TRIP_ID)        03360074
033700     END-EXEC.                                                    03370074
033800                                                                  03380071
033810     EVALUATE TRUE                                                03381074
033820         WHEN SQLCODE = ZERO                                      03382074
033830             MOVE SUT00007-CRE-TMST TO PV-TRLR-SUMM-TMST          03383074
033831             MOVE SUT00007-CART-QTY TO PV-CARTON-QTY              03383174
033832             MOVE SUT00007-UNT-QTY  TO PV-UNIT-QTY                03383274
033850         WHEN SQLCODE = +100                                      03385074
033860             SET END-OF-MFST-CSR TO TRUE                          03386074
033870                                                                  03387074
033880         WHEN SQLWARN0 NOT = SPACES                               03388074
033890         WHEN SQLCODE  NOT = ZERO                                 03389074
033891             MOVE 'R100-FETCH-MFST-REC'                           03389174
033892                                        TO AA-PARAGRAPH-NAME      03389274
033893             MOVE 'UNSUCCESSFUL FETCH WITH MFST_CSR'              03389374
033894                                        TO AA-DB2-OPERATION       03389474
033895             MOVE 'TSUOBTS'             TO AA-DB2-TABLE-1         03389574
033896             MOVE 'TSUOBTR'             TO AA-DB2-TABLE-2         03389674
033897             MOVE 'TCNTRID'             TO AA-DB2-TABLE-3         03389774
033898             MOVE 'XLT_LOC'             TO AA-DB2-TABLE-4         03389874
033899             PERFORM Z998-DB2-ABEND                               03389974
033900     END-EVALUATE.                                                03390074
033910                                                                  03391071
033920 R300-DISPLAY-DC-COUNTS.                                          03392083
033930*----------------------------------------------------------------*03393083
033940*  DISPLAY EACH DC AND ITS NUMBER OF RECORDS                     *03394083
033950*----------------------------------------------------------------*03395083
034100     IF PV-DC-NBR = PV-PREV-DC-NBR                                03410091
034110         ADD +1 TO PC-DC-CNT                                      03411091
034300     ELSE                                                         03430091
034310         IF PV-PREV-DC-NBR = ZERO                                 03431091
034311             MOVE PV-DC-NBR      TO PV-PREV-DC-NBR                03431191
034312             ADD +1 TO PC-DC-CNT                                  03431292
034330         ELSE                                                     03433091
034400             MOVE PV-PREV-DC-NBR TO PV-DC                         03440091
034500             MOVE PV-DC-NBR      TO PV-PREV-DC-NBR                03450091
034510             MOVE PC-DC-CNT      TO DT-DC-COUNT                   03451094
034600             DISPLAY '       '                                    03460091
034700             DISPLAY '****************************'               03470091
034800             DISPLAY 'DC = ' PV-DC                                03480091
034900             DISPLAY 'TOTAL RECS = ' DT-DC-COUNT                  03490094
035000             DISPLAY '****************************'               03500091
035100             MOVE +1 TO PC-DC-CNT                                 03510091
035500         END-IF                                                   03550091
035501     END-IF.                                                      03550191
035510                                                                  03551083
035600 W100-WRITE-MANIFEST-REC.                                         03560070
035700*----------------------------------------------------------------*03570026
035800*    WRITE THE MANIFEST RECORDS TO THE FILE                      *03580070
035900*----------------------------------------------------------------*03590026
036000                                                                  03600026
036100     WRITE MANIFEST-REC FROM SU077-MFST-EXTRACT-RECORD.           03610070
036200**   WRITE MANIFEST-REC.                                          03620070
036300                                                                  03630026
036400     ADD 1 TO PC-MANIFEST-WRITTEN.                                03640074
036500                                                                  03650026
036800 Y100-OPEN-MFST-CSR.                                              03680070
036900*---------------------------------------------------------------- 03690026
037000*    OPEN MFST_CSR CURSOR.                                        03700070
037100*---------------------------------------------------------------- 03710026
037200                                                                  03720026
037300     EXEC SQL                                                     03730026
037400         OPEN MFST_CSR                                            03740070
037500     END-EXEC.                                                    03750026
037600                                                                  03760026
037700     EVALUATE TRUE                                                03770026
037800         WHEN SQLCODE = ZERO                                      03780026
037900             CONTINUE                                             03790026
038000         WHEN SQLWARN0 NOT = SPACES                               03800026
038100         WHEN SQLCODE  NOT = ZERO                                 03810026
038200             MOVE 'Y100-OPEN-MFST-CSR'                            03820070
038300                                 TO AA-PARAGRAPH-NAME             03830026
038400             MOVE 'UNSUCCESSFUL OPEN ON MFST_CSR'                 03840070
038500                                 TO AA-DB2-OPERATION              03850026
038600             MOVE 'TSUOBTS'      TO AA-DB2-TABLE-1                03860070
038700             MOVE 'TSUOBTR'      TO AA-DB2-TABLE-2                03870070
038800             MOVE 'TCNTRID'      TO AA-DB2-TABLE-3                03880070
038900             MOVE 'XLT_LOC'      TO AA-DB2-TABLE-4                03890070
039000             MOVE SPACES         TO AA-MESSAGE                    03900026
039001             DISPLAY '***************************************'    03900179
039010             DISPLAY '* CNTRL FROM DATE = ' PV-CNTRL-FROM-DTE     03901079
039020             DISPLAY '* CNTRL TO DATE   = ' PV-CNTRL-TO-DTE       03902079
039030             DISPLAY '***************************************'    03903079
039100             PERFORM Z998-DB2-ABEND                               03910026
039200     END-EVALUATE.                                                03920026
039300                                                                  03930026
039400 Y200-CLOSE-MFST-CSR.                                             03940070
039500*---------------------------------------------------------------- 03950026
039600*    CLOSE THE MFST_CSR CURSOR.                                 * 03960070
039700*---------------------------------------------------------------- 03970026
039800                                                                  03980026
039900     EXEC SQL                                                     03990026
040000         CLOSE MFST_CSR                                           04000070
040100     END-EXEC.                                                    04010026
040200                                                                  04020026
040300     EVALUATE TRUE                                                04030026
040400         WHEN SQLCODE = ZERO                                      04040026
040500              CONTINUE                                            04050026
040600                                                                  04060026
040700         WHEN SQLWARN0 NOT = SPACES                               04070026
040800         WHEN SQLCODE  NOT = ZERO                                 04080026
040900             MOVE 'Y200-CLOSE-MFST-CSR'                           04090070
041000                                 TO AA-PARAGRAPH-NAME             04100026
041100             MOVE 'UNSUCCESSFUL CLOSE ON MFST_CSR'                04110070
041200                                 TO AA-DB2-OPERATION              04120026
041300             MOVE 'TSUOBTS'      TO AA-DB2-TABLE-1                04130070
041400             MOVE 'TSUOBTR'      TO AA-DB2-TABLE-2                04140070
041500             MOVE 'TCNTRID'      TO AA-DB2-TABLE-3                04150070
041600             MOVE 'XLT_LOC'      TO AA-DB2-TABLE-4                04160070
041700             MOVE SPACES         TO AA-MESSAGE                    04170026
041800             PERFORM Z998-DB2-ABEND                               04180026
041900     END-EVALUATE.                                                04190026
042000                                                                  04200026
042100 Z998-DB2-ABEND.                                                  04210026
042200*----------------------------------------------------------------*04220026
042300*    ABEND ROUTINE FOR DB2 ERRORS                                *04230026
042400*----------------------------------------------------------------*04240026
042500     CLOSE CONTROL-FILE                                           04250070
042510           MANIFEST-FILE.                                         04251070
042600                                                                  04260026
042700     DISPLAY AA-ABEND-TMK.                                        04270061
042800     DISPLAY AA-DB2-ERROR-TMK.                                    04280061
042900     DISPLAY AA-PROGRAM-TMK.                                      04290061
043000     DISPLAY AA-PARAGRAPH-TMK.                                    04300061
043100     DISPLAY AA-DB2-OPERATION-TMK.                                04310061
043200     DISPLAY AA-DB2-TABLE-1.                                      04320026
043300     DISPLAY AA-DB2-TABLE-2.                                      04330026
043400     DISPLAY AA-DB2-TABLE-3.                                      04340026
043500     DISPLAY AA-DB2-TABLE-4.                                      04350032
043600     SET AC-DB2-ERROR TO TRUE.                                    04360026
043700                                                                  04370026
043800     COPY DPPD004.                                                04380026
043900                                                                  04390026
044000     CALL 'ILBOABN0' USING ABEND-CODE.                            04400026
044100                                                                  04410026
