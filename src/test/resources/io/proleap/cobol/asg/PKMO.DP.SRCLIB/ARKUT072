000100******************************************************************00010005
000200 IDENTIFICATION DIVISION.                                         00020005
000300******************************************************************00030005
000400                                                                  00040005
000500 PROGRAM-ID.             ARKUT072.                                00050005
000600 AUTHOR.                 BRIAN HASSLINGER.                        00060005
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070005
000800 DATE-WRITTEN            10-26-2006.                              00080005
000900 DATE-COMPILED.                                                   00090005
001000                                                                  00100005
001100******************************************************************00110005
001200* SSN VERIFICATION PROGRAM. MATCH THE SSN FROM THE INPUT FILE     00120005
001300* TO THE NEW WORKDAY FILE (11/22/16). THIS IS DONE BY READING     00130005
      * THE WORKDAY FILE INTO AN ARRAY AND THEN SEACHING ON THE SSN.    00140005
001300* EITHER A MATCHING EMPLOYEE WILL BE FOUND OR NOT.                00150005
001400* IF MATCH IS FOUND, UPDATE TO ART_EMP_DISC.                      00160005
001500* IF NEW DISC STATUS IS LIFETIME (FROM AR067) AND NO EMP ID, ADD  00170005
001500* ROW TO ART_EMP_DISC WITH SSN FOR THE EMP ID.                    00180005
001700******************************************************************00190005
001800* 09/09/2011 RCW CHANGE FOR FEEDS TO AND FROM FIRST DATA          00200005
001700******************************************************************00210005
001800* 09/10/2012  COGNIZANT   CR32924                                 00220005
001800*  - MODIFIED PROGRAM TO HANDLE THE CONDITION OF SQLCODE=-811     00230005
001800*    IN PARA 8000-SELECT-XST-ASSOC, SO THAT THE PROGRAM DOES      00240005
001800*    NOT ABEND. INSTEAD WRITE A REPORT FILE. THIS IS A CASE       00250005
001800*    THAT HAPPENS WHEN DIFFERENT ASSOCIATE IDS ARE MAPPED TO A    00260005
001800*    SINGLE SSN.                                                  00270005
001800*    EMAIL ALERT WILL BE SENT WHEN THIS HAPPENS.                  00280005
001900******************************************************************00290005
CHG000* 12/12/2012  BRIAN HASSLINGER  CHG0051783                        00300005
CHG000*  - DO NOT SEND NON DISCOUNT FLAG BACK TO FD WHEN NO ASSOCIATE   00310005
CHG000*    EXISTS IN KOHL'S ASSOCIATE TABLES.                           00320005
P10237******************************************************************00330005
P10237* 26/08/2015  COGNIZANT         CHG0125054                        00340005
P10237*  - MODIFIED THE CODE TO DETOKENIZE THE ACCOUNT NUMBER IN THE    00350005
P10237*    INPUT FILE TO SEARCH PRIN                                    00360005
P10237*    AS PART OF EMPLOYEE DISCOUNT CHANGES IN COSA                 00370005
P10237*    SECURITY PROJECT.                                            00380005
001900******************************************************************00390005
P10237******************************************************************00400005
P10237* 11/28/2016  CHERI PARMLEY     CHG0168613                        00410005
P10237*  - ELIMINATE THE XST_ASSOC AND XST_ASSOC_EMPT TABLES AND USE    00420005
P10237*    THE WORKDAY FILE AS SOURCE FOR ASSOCIATE LOOKUP.             00430005
001900******************************************************************00440005
P10237******************************************************************00441007
P10237* 08/08/2023  BOB MCASEY        CHG0291875                        00442007
P10237*  - ELIMINATE THE XST_ASSOC AND XST_ASSOC_EMPT TABLES AND USE    00443007
P10237*    THE WORKDAY FILE AS SOURCE FOR ASSOCIATE LOOKUP.             00444007
001900******************************************************************00445007
EMAIL * 09/12/2023  JIM HUNTER        CHG0293949                        00446011
EMAIL *  - WRITE AN EMAIL WHEN THE FISERV FILE CONTAINS A LOW NUMBER    00447008
EMAIL *    OF RECORDS (< 30,000).                                       00448008
EMAIL ******************************************************************00449008
002000                                                                  00450005
002100******************************************************************00460005
002200 ENVIRONMENT DIVISION.                                            00470005
002300******************************************************************00480005
002400                                                                  00490005
002500 CONFIGURATION SECTION.                                           00500005
002600                                                                  00510005
002700 SOURCE-COMPUTER.        IBM-3090.                                00520005
002800 OBJECT-COMPUTER.        IBM-3090.                                00530005
002900                                                                  00540005
003000 INPUT-OUTPUT SECTION.                                            00550005
003100                                                                  00560005
003200 FILE-CONTROL.                                                    00570005
003300                                                                  00580005
003400     SELECT EMPLOYEE-ACCOUNT-IN-FILE                              00590005
003500         ASSIGN TO INP01.                                         00600005
003600                                                                  00610005
003700     SELECT CONTROL-CARD-1                                        00620005
003800         ASSIGN TO INP02.                                         00630005
003900                                                                  00640005
004000     SELECT CONTROL-CARD-2                                        00650005
004100         ASSIGN TO INP03.                                         00660005
004200                                                                  00670005
003400     SELECT WD-EMPLOYEE-ACCOUNT-FILE                              00680005
003500         ASSIGN TO INP04.                                         00690005
                                                                        00700005
004300     SELECT EMPLOYEE-DISC-UPDATE-FILE                             00710005
004400         ASSIGN TO OUT01.                                         00720005
004500                                                                  00730005
EMAIL      SELECT EMAIL-FILE                                            00731008
EMAIL          ASSIGN TO OUT02.                                         00732008
004500                                                                  00733008
004600******************************************************************00740005
004700 DATA DIVISION.                                                   00750005
004800******************************************************************00760005
004900                                                                  00770005
005000 FILE SECTION.                                                    00780005
005100                                                                  00790005
005200 FD EMPLOYEE-ACCOUNT-IN-FILE                                      00800005
005300     RECORDING MODE IS F                                          00810005
005400     BLOCK CONTAINS 0 RECORDS                                     00820005
005500     LABEL RECORDS ARE STANDARD.                                  00830005
005600 01 EMPLOYEE-ACCOUNT-IN-REC           PIC X(33).                  00840005
005700                                                                  00850005
005800 FD CONTROL-CARD-1                                                00860005
005900     RECORDING MODE IS F                                          00870005
006000     BLOCK CONTAINS 0 RECORDS                                     00880005
006100     LABEL RECORDS ARE STANDARD.                                  00890005
006200                                                                  00900005
006300 01 CONTROL-CARD-1-REC.                                           00910005
006400    05 CC-ACCT-PRE                    PIC X(3).                   00920005
006500    05 FILLER                         PIC X(1).                   00930005
006600    05 CC-FD-PRIN                     PIC X(4).                   00940005
006700    05 FILLER                         PIC X(72).                  00950005
006800                                                                  00960005
006900 FD CONTROL-CARD-2                                                00970005
007000     RECORDING MODE IS F                                          00980005
007100     BLOCK CONTAINS 0 RECORDS                                     00990005
007200     LABEL RECORDS ARE STANDARD.                                  01000005
007300                                                                  01010005
007400 01 CONTROL-CARD-2-REC.                                           01020005
007500    05 CC-PROD-TEST-CNTL              PIC X(4).                   01030005
007600    05 FILLER                         PIC X(76).                  01040005
007700                                                                  01050005
005200 FD WD-EMPLOYEE-ACCOUNT-FILE                                      01060005
005300     RECORDING MODE IS F                                          01070005
005400     BLOCK CONTAINS 0 RECORDS                                     01080005
005500     LABEL RECORDS ARE STANDARD.                                  01090005
005600 01 WD-EMPLOYEE-ACCOUNT-IN-REC        PIC X(200).                 01100005
005700                                                                  01110005
007800 FD EMPLOYEE-DISC-UPDATE-FILE                                     01120005
007900     RECORDING MODE IS F                                          01130005
008000     BLOCK CONTAINS 0 RECORDS                                     01140005
008100     LABEL RECORDS ARE STANDARD.                                  01150005
008200 01 EMPLOYEE-DISC-UPDATE-REC          PIC X(80).                  01160005
005700                                                                  01160108
EMAIL  FD  EMAIL-FILE                                                   01161008
EMAIL      RECORDING MODE IS F                                          01162008
EMAIL      LABEL RECORDS ARE STANDARD                                   01163008
EMAIL      BLOCK CONTAINS 0 RECORDS.                                    01164008
EMAIL                                                                   01165008
EMAIL  01  EMAIL-RECORD                     PIC X(80).                  01166008
EMAIL                                                                   01167008
008300                                                                  01170005
008400 WORKING-STORAGE SECTION.                                         01180005
008500******************************************************************01190005
008600*                        ABEND CODES                              01200005
008700******************************************************************01210005
008800     COPY ARWS052.                                                01220005
008900                                                                  01230005
009000******************************************************************01240005
009100*                        SWITCHES                                 01250005
009200******************************************************************01260005
009300 01 PS-PROGRAM-SWITCHES.                                          01270005
009400    05 PS-ART-EMP-DISC-SW             PIC X      VALUE "N".       01280005
009500       88 PS-EMP-DISC-EXIST                      VALUE "Y".       01290005
009600       88 PS-EMP-DISC-DNE                        VALUE "N".       01300005
009700    05 PS-ASSOC-FOUND-SW              PIC X      VALUE SPACES.    01310005
009800       88 PS-ASSOC-FOUND                         VALUE 'Y'.       01320005
009900       88 PS-NO-ASSOC-FOUND                      VALUE 'N'.       01330005
010000    05 PS-EOF-CONTROL-CARD-1-SW       PIC X      VALUE 'N'.       01340005
010100       88 PS-EOF-CONTROL-CARD-1                  VALUE 'Y'.       01350005
010200       88 PS-NOT-EOF-CONTROL-CARD-1              VALUE 'N'.       01360005
010000    05 PS-EOF-WORKDAY-SW              PIC X      VALUE 'N'.       01370005
010100       88 PS-EOF-WORKDAY                         VALUE 'Y'.       01380005
010200       88 PS-NOT-EOF-WORKDAY                     VALUE 'N'.       01390005
010300    05 PS-INSERT-SW                   PIC X      VALUE SPACES.    01400005
010400       88 PS-SUCCESSFUL-INSERT                   VALUE "Y".       01410005
010500       88 PS-UNSUCCESSFUL-INSERT                 VALUE "N".       01420005
010600    05 PS-PROCESSING-SW               PIC X      VALUE SPACES.    01430005
010700       88 PS-CONTINUE-PROCESSING                 VALUE 'Y'.       01440005
010800       88 PS-STOP-PROCESSING                     VALUE 'N'.       01450005
010900    05 PS-RECS-TO-PROCESS-SW          PIC X      VALUE SPACES.    01460005
011000       88 PS-PROCESS-1                           VALUE "1".       01470005
011100       88 PS-PROCESS-MANY                        VALUE "M".       01480005
011200    05 PS-UPDATE-SW                   PIC X      VALUE SPACES.    01490005
011300       88 PS-SUCCESSFUL-UPDATE                   VALUE "Y".       01500005
011400       88 PS-UNSUCCESSFUL-UPDATE                 VALUE "N".       01510005
011500    05 PS-WRITE-STATUS-SW             PIC X      VALUE SPACES.    01520005
011600       88 PS-WRITE-EMP-ACCT                      VALUE "E".       01530005
011700       88 PS-WRITE-UNKNOWN                       VALUE "U".       01540005
011800                                                                  01550005
011900******************************************************************01560005
012000*                        CONSTANTS                                01570005
012100******************************************************************01580005
012200 01 PC-PROGRAM-CONSTANTS.                                         01590005
012300    05 PC-DUPLICATE-ROW-SQLCODE       PIC S9(9)  VALUE -803       01600005
012400                                                 COMP.            01610005
012500    05 PC-ROW-NOT-FOUND-SQLCODE       PIC S9(9)  VALUE +100       01620005
012600                                                 COMP.            01630005
012700    05 PC-SUCCESSFUL-SQLCODE          PIC S9(9)  VALUE ZEROES     01640005
012800                                                 COMP.            01650005
          05 PC-MORE-THAN-ONE-ROW           PIC S9(9)  VALUE -811       01660005
                                                       COMP.            01670005
012900    05 PC-FD-DISC-LIFETIME            PIC X(1)   VALUE "E".       01680005
013000    05 PC-FD-DISC-REGULAR             PIC X(1)   VALUE "A".       01690005
013010    05 PC-FD-NEW-ACC-ADD              PIC X(1)   VALUE " ".       01700005
013100    05 PC-LIFETIME-DISC-STAT          PIC X(1)   VALUE 'L'.       01710005
013200    05 PC-NO-DISC-STAT                PIC X(1)   VALUE 'N'.       01720005
013300    05 PC-PROGRAM-NAME                PIC X(8)   VALUE 'ARKUT072'.01730005
013400    05 PC-REG-DISC-STAT               PIC X(1)   VALUE 'R'.       01740005
013500                                                                  01750005
013600******************************************************************01760005
013700*                        VARIABLES                                01770005
013800******************************************************************01780005
013900 01 PV-PROGRAM-VARIABLES.                                         01790005
014000    05 PV-NO-ASSOC-COUNT              PIC S9(9)  VALUE ZEROES     01800005
014100                                                 COMP.            01810005
014000    05 PV-ASSOC-COUNT                 PIC S9(9)  VALUE ZEROES     01820005
014100                                                 COMP.            01830005
014200    05 PV-IDX-MAX                     PIC S9(4)  VALUE ZEROES     01840005
014300                                                 COMP.            01850005
014200    05 PV-IDX2-MAX                    PIC S9(6)  VALUE ZEROES     01860005
014300                                                 COMP.            01870005
014200    05 PV-SSN-TABLE-COUNT             PIC S9(9)  VALUE ZEROES     01880005
014300                                                 COMP.            01890005
014400    05 PV-INSERT-COUNT                PIC S9(9)  VALUE ZEROES     01900005
014500                                                 COMP.            01910005
014600    05 PV-NON-ASSOC-COUNT             PIC S9(9)  VALUE ZEROES     01920005
014700                                                 COMP.            01930005
014800    05 PV-NON-MON-COUNT               PIC S9(9)  VALUE ZEROES     01940005
014900                                                 COMP.            01950005
015000    05 PV-READ-COUNT                  PIC S9(9)  VALUE ZEROES     01960005
015100                                                 COMP.            01970005
015200    05 PV-UPDATE-COUNT                PIC S9(9)  VALUE ZEROES     01980005
015300                                                 COMP.            01990005
015200    05 PV-DELETE-COUNT                PIC S9(9)  VALUE ZEROES     02000006
015300                                                 COMP.            02010006
015200    05 PV-DUPSSN-COUNT                PIC S9(9)  VALUE ZEROES     02020005
015300                                                 COMP.            02030005
015400    05 PV-DB2-TABLE-NAME              PIC X(30)  VALUE SPACES.    02040005
015500    05 PV-KEY-VALUE-NAME              PIC X(30)  VALUE SPACES.    02050005
015600    05 PV-KEY-VALUE                   PIC X(30)  VALUE SPACES.    02060005
015700    05 PV-OPERATION-MSG               PIC X(30)  VALUE SPACES.    02070005
015800    05 PV-PARAGRAPH-NAME              PIC X(30)  VALUE SPACES.    02080005
015900                                                                  02090005
016000    05 PV-CURR-TMST                   PIC X(26)  VALUE SPACES.    02100005
016100    05 PV-PGM-BEG-TMST                PIC X(26)  VALUE SPACES.    02110005
016200    05 PV-PGM-END-TMST                PIC X(26)  VALUE SPACES.    02120005
016300                                                                  02130005
016400    05 PV-ACCOUNTS-PROCESSED          PIC 9(02)  VALUE ZEROS.     02140005
016500    05 PV-ACCT-TO-PRCS                PIC 9(02)  VALUE ZEROS.     02150005
016600    05 PV-BTCH-NBR.                                               02160005
016700       10 PV-BTCH-SEQ-NBR             PIC 9(1)   VALUE ZERO.      02170005
016800       10 PV-BTCH-MM                  PIC 9(2)   VALUE ZEROS.     02180005
016900       10 PV-BTCH-DD                  PIC 9(2)   VALUE ZEROS.     02190005
017000    05 PV-CURR-ACCT-PRE               PIC X(3)   VALUE SPACES.    02200005
017100    05 PV-CURR-ACCT-NBR               PIC 9(10)  VALUE ZEROES.    02210005
017200    05 PV-CURR-ACCT-STAT-CDE          PIC X(1)   VALUE SPACES.    02220005
017300    05 PV-CURR-ASSOC-ID               PIC X(11)  VALUE SPACES.    02230005
017400    05 PV-CURR-DISC-STAT-CDE          PIC X(1)   VALUE SPACES.    02240005
017500    05 PV-CURR-EMP-ID                 PIC X(11)  VALUE SPACES.    02250005
017600    05 PV-CURR-SSN                    PIC X(9)   VALUE SPACES.    02260005
017600    05 PV-CURR-SSN-NBR                PIC X(9)   VALUE SPACES.    02270005
017600    05 PV-CURR-EMP-NM                 PIC X(88)  VALUE SPACES.    02280005
017200    05 PV-CURR-EMP-STAT-CDE           PIC X(1)   VALUE SPACES.    02290005
017200    05 PV-CURR-EMP-TYP-CDE            PIC X(1)   VALUE SPACES.    02300005
017200    05 PV-CURR-LOC-NBR                PIC 9(04)  VALUE ZEROES.    02310005
017200    05 PV-CURR-DISC-DTE               PIC X(10)  VALUE SPACES.    02320005
017200    05 PV-CURR-TERM-DTE               PIC X(10)  VALUE SPACES.    02330005
017700    05 PV-DISPLAY-NUMERIC             PIC 9(10)  VALUE ZEROS.     02340005
017800    05 PV-PREV-ACCT-PRE               PIC X(3)   VALUE SPACES.    02350005
017900    05 PV-SRCH-PRIN                   PIC X(4)   VALUE SPACES.    02360005
P10237    05 PV-ACCT-NBR-12.                                            02370005
P10237       10 PV-ACCT-NBR-10              PIC X(10)  VALUE SPACES.    02380005
P10237       10 FILLER                      PIC X(02)  VALUE '00'.      02390005
018000                                                                  02400005
018100    05 PV-TEMP-EMP-ACCT-REC.                                      02410005
018200       07 PV-TEAR-RECORD-TYPE         PIC  X(1)  VALUE SPACES.    02420005
018300       07 PV-TEAR-ACCT-PREF           PIC  X(6)  VALUE SPACES.    02430005
018400       07 PV-TEAR-ACCT-NBR            PIC  X(10) VALUE SPACES.    02440005
018500       07 PV-TEAR-ROLE-CDE            PIC  X(2)  VALUE SPACES.    02450005
018600       07 PV-TEAR-MBR-SEQ-NBR         PIC  X(3)  VALUE SPACES.    02460005
018700       07 PV-TEAR-SSN                 PIC  X(9)  VALUE SPACES.    02470005
018800       07 PV-TEAR-DISC-STAT-CDE       PIC  X(1)  VALUE SPACES.    02480005
018900       07 PV-TEAR-ACCT-STAT-CDE       PIC  X(1)  VALUE SPACES.    02490005
019000                                                                  02500005
103800    05 IND-ART00001-TERM-DTE        PIC S9(4)  VALUE ZEROES COMP. 02510005
103900    05 IND-ART00001-DISC-DTE        PIC S9(4)  VALUE ZEROES COMP. 02520005
019000                                                                  02530005
019100 01 PT-ACCT-PRIN-TABLE.                                           02540005
019200    05 PT-ACCT-PRIN-ARRAY   OCCURS 1 TO 200 TIMES                 02550005
019300                             DEPENDING ON PV-IDX-MAX              02560005
019400                             ASCENDING KEY IS PT-ACCT-PRE         02570005
019500                             INDEXED BY PV-IDX.                   02580005
019600       10 PT-ACCT-PRE                 PIC  X(3).                  02590005
019700       10 PT-FD-PRIN                  PIC  X(4).                  02600005
                                                                        02610005
                                                                        02620005
019100 01 PT-SSN-TABLE.                                                 02630005
019200    05 PT-SSN-ARRAY         OCCURS 1 TO 200000 TIMES              02640005
019300                             DEPENDING ON PV-IDX2-MAX             02650005
019400                             ASCENDING KEY IS PT-SSN-NBR          02660005
019500                             INDEXED BY PV-IDX2.                  02670005
019600       10 PT-EMP-ID                  PIC  X(07).                  02680005
019600       10 PT-SSN-NBR                 PIC  X(09).                  02690005
019600       10 PT-EMP-NM                  PIC  X(88).                  02700005
019600       10 PT-EMP-STAT-CDE            PIC  X(01).                  02710005
019600       10 PT-EMP-TYP-CDE             PIC  X(01).                  02720005
019600       10 PT-LOC-NBR                 PIC  9(04).                  02730005
019600       10 PT-DISC-DTE                PIC  X(10).                  02740005
019600       10 PT-TERM-DTE                PIC  X(10).                  02740108
EMAIL                                                                   02741008
EMAIL  01  EM-EMAIL-LINE1.                                              02741108
EMAIL      05  FILLER                  PIC X(80)    VALUE               02741208
EMAIL          ' ARK056 FILE FROM FISERV HAS LOW RECORD COUNT.'.        02741308
EMAIL                                                                   02741708
EMAIL  01  EM-EMAIL-BLANK-LINE         PIC X(80)    VALUE SPACES.       02741908
EMAIL                                                                   02742008
EMAIL  01  EM-EMAIL-LINE2.                                              02742108
EMAIL      05  FILLER                  PIC X(22)    VALUE               02742208
EMAIL          ' FISERV RECORD COUNT: '.                                02742308
EMAIL      05  EM-RECORD-COUNT         PIC ZZZ,ZZ9  VALUE ZERO.         02742408
EMAIL      05  FILLER                  PIC X(51)    VALUE SPACES.       02742508
EMAIL                                                                   02742608
                                                                        02743008
019800******************************************************************02760005
019900*                        COPYBOOKS                                02770005
020000******************************************************************02780005
020100                                                                  02790005
020200******************************************************************02800005
020300* EMPLOYEE DELTA ACCOUNT FILE RECORD LAYOUT                       02810005
020400******************************************************************02820005
020500     COPY ARRD067.                                                02830005
020600                                                                  02840005
020200******************************************************************02850005
020300* EMPLOYEE WORKDAY ACCOUNT FILE RECORD LAYOUT                     02860005
020400******************************************************************02870005
020500     COPY ARRD100.                                                02880005
020600                                                                  02890005
020700******************************************************************02900005
020800* FD NON-MON UPDATE RECORD LAYOUT                                 02910005
020900******************************************************************02920005
021000     COPY ARRD068.                                                02930005
021100                                                                  02940005
P10237******************************************************************02950005
P10237* LAYOUT THAT DEFINES THE PARAMETERS NEEDED TO INVOKE PROTEGRITY *02960005
P10237* MODULE                                                         *02970005
P10237******************************************************************02980005
P10237     COPY PTYCCSIP.                                               02990005
P10237                                                                  03000005
P10237******************************************************************03010005
P10237* LAYOUT THAT DEFINES THE WORKING VARIABLES TO INVOKE PROTEGRITY *03020005
P10237* MODULE                                                         *03030005
P10237******************************************************************03040005
P10237     COPY DPWS031.                                                03050005
P10237                                                                  03060005
021200******************************************************************03070005
021300* DPWS004 VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004 03080005
021400******************************************************************03090005
021500     COPY DPWS004.                                                03100005
021600                                                                  03110005
021700******************************************************************03120005
021800* DB2 MESSAGE AREA                                                03130005
021900******************************************************************03140005
022000     COPY SQLCA2.                                                 03150005
022100                                                                  03160005
022200******************************************************************03170005
022300*                     SQL DECLARATIONS                            03180005
022400******************************************************************03190005
022500                                                                  03200005
022600******************************************************************03210005
022700*  STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                03220005
022800******************************************************************03230005
022900     EXEC SQL                                                     03240005
023000         INCLUDE SQLCA                                            03250005
023100     END-EXEC.                                                    03260005
024600******************************************************************03270005
024700*                     ART_EMP_DISC                                03280005
024800******************************************************************03290005
024900     EXEC SQL                                                     03300005
025000         INCLUDE ART00001                                         03310005
025100     END-EXEC.                                                    03320005
025200                                                                  03330005
026300******************************************************************03340005
026400 PROCEDURE DIVISION.                                              03350005
026500******************************************************************03360005
026600*--------------*                                                  03370005
026700 0000-MAINLINE.                                                   03380005
026800*--------------*                                                  03390005
026900                                                                  03400005
027000     PERFORM Z050-INITIALIZE.                                     03410005
027100                                                                  03420005
027200     PERFORM 1000-PROCESS-EMP-ACCT-FILE.                          03430005
027300                                                                  03440005
027400     PERFORM Z100-END-PROC.                                       03450005
027500                                                                  03460005
027600     STOP RUN.                                                    03470005
027700                                                                  03480005
027800*-------------------------------*                                 03490005
027900 1000-PROCESS-EMP-ACCT-FILE.                                      03500005
028000*-------------------------------*                                 03510005
028100     SET PS-CONTINUE-PROCESSING TO TRUE.                          03520005
028200                                                                  03530005
028300     PERFORM 4020-READ-TWO-EMPL-ACCT.                             03540005
028400                                                                  03550005
028500     PERFORM 2000-PROCESS-EMP-SSN                                 03560005
028600       UNTIL PS-STOP-PROCESSING.                                  03570005
028700                                                                  03580005
028800*-------------------------------*                                 03590005
028900 2000-PROCESS-EMP-SSN.                                            03600005
029000*-------------------------------*                                 03610005
029100** DETERMINE IF THE ACCOUNTS ARE THE SAME                         03620005
029200     IF AR067-ACCT-NBR = PV-TEAR-ACCT-NBR                         03630005
029300        MOVE 2                      TO PV-ACCT-TO-PRCS            03640005
029400     ELSE                                                         03650005
029500        MOVE 1                      TO PV-ACCT-TO-PRCS            03660005
029600     END-IF.                                                      03670005
029700                                                                  03680005
029800     SET PS-WRITE-UNKNOWN           TO TRUE.                      03690005
029900     PERFORM 2100-PROCESS-ACCOUNT                                 03700005
030000     VARYING PV-ACCOUNTS-PROCESSED FROM 1 BY 1                    03710005
030100       UNTIL PV-ACCOUNTS-PROCESSED > PV-ACCT-TO-PRCS              03720005
030200          OR PS-WRITE-EMP-ACCT.                                   03730005
030300                                                                  03740005
030400     IF PS-WRITE-EMP-ACCT                                         03750005
030500        ADD 1                          TO PV-ASSOC-COUNT          03760005
030600        MOVE AR067-ACCT-NBR            TO PV-CURR-ACCT-NBR        03770005
      *CLP                                                              03780005
030700        MOVE PT-SSN-NBR(PV-IDX2)       TO PV-CURR-SSN-NBR         03790005
030700        MOVE PT-EMP-ID(PV-IDX2)        TO PV-CURR-EMP-ID          03800005
              MOVE PT-EMP-NM(PV-IDX2)        TO PV-CURR-EMP-NM          03810005
              MOVE PT-EMP-STAT-CDE(PV-IDX2)  TO PV-CURR-EMP-STAT-CDE    03820005
              MOVE PT-EMP-TYP-CDE(PV-IDX2)   TO PV-CURR-EMP-TYP-CDE     03830005
              MOVE PT-LOC-NBR(PV-IDX2)       TO PV-CURR-LOC-NBR         03840005
              MOVE PT-DISC-DTE(PV-IDX2)      TO PV-CURR-DISC-DTE        03850005
              MOVE PT-TERM-DTE(PV-IDX2)      TO PV-CURR-TERM-DTE        03860005
030800        PERFORM 2200-UPDATE-EMPL-ACCT-FILE                        03870005
030810                                                                  03880005
030811*--> IF NEW ACCOUNT ADD, WRITE NON MON TO ADD FLAG TO FD          03890005
030820        IF AR067-DISC-STAT-CDE = PC-FD-NEW-ACC-ADD                03900005
030822           MOVE AR067-ACCT-NBR         TO PV-CURR-ACCT-NBR        03910005
030823           MOVE PC-FD-DISC-REGULAR     TO AR068-DISC-STAT-CDE     03920005
030824           PERFORM 5000-WRITE-EMP-DISC-UPD                        03930005
030830        END-IF                                                    03940005
030900     ELSE                                                         03950005
031000        IF AR067-DISC-STAT-CDE = PC-FD-DISC-LIFETIME              03960005
031100           ADD 1                       TO PV-NO-ASSOC-COUNT       03970007
0823RM           DISPLAY 'BYPASSING FISERV LTD INS ' AR067-ACCT-NBR     03980007
0823RM*          MOVE AR067-ACCT-NBR         TO PV-CURR-ACCT-NBR        03990007
      *CLP                                                              04000005
031300*          MOVE PT-EMP-ID(PV-IDX2)     TO PV-CURR-EMP-ID          04010005
      *CLP 04-18-17                                                     04020005
0823RM*          MOVE PV-CURR-SSN            TO PV-CURR-EMP-ID          04030007
0823RM*          MOVE PC-LIFETIME-DISC-STAT  TO PV-CURR-DISC-STAT-CDE   04040007
0823RM*          PERFORM 2200-UPDATE-EMPL-ACCT-FILE                     04050007
031600        ELSE                                                      04060005
CHG000* IF THE FLAG FROM FD IS AN N, THEN NO NEED TO SEND ANYTHING      04070005
CHG000* BACK TO FD.                                                     04080005
CHG000           IF AR067-DISC-STAT-CDE = PC-NO-DISC-STAT               04090005
CHG000*             ADD 1 TO COUNTER FOR N RECEIVED FROM FD THAT DO     04100005
CHG000*             NOT HAVE A MATCHING ASSOC AT KOHL'S.                04110005
CHG000              ADD 1                       TO PV-NO-ASSOC-COUNT    04120005
CHG000           ELSE                                                   04130005
031700              ADD 1                       TO PV-NON-ASSOC-COUNT   04140005
031800              MOVE AR067-ACCT-NBR         TO PV-CURR-ACCT-NBR     04150005
031810              MOVE PC-NO-DISC-STAT        TO AR068-DISC-STAT-CDE  04160005
031900*             WRITE A NON-MON TO REMOVE DISC CODE                 04170005
032000              PERFORM 5000-WRITE-EMP-DISC-UPD                     04180005
CHG000           END-IF                                                 04190005
032100        END-IF                                                    04200005
032200     END-IF.                                                      04210005
032300                                                                  04220005
032400     IF PS-PROCESS-MANY                                           04230005
032500        IF PV-ACCT-TO-PRCS = 1                                    04240005
032600           PERFORM 4030-READ-NEXT-ACCT-REC                        04250005
032700        ELSE                                                      04260005
032800           PERFORM 4020-READ-TWO-EMPL-ACCT                        04270005
032900        END-IF                                                    04280005
033000     ELSE                                                         04290005
033100        SET PS-STOP-PROCESSING      TO TRUE                       04300005
033200     END-IF.                                                      04310005
033300                                                                  04320005
033400*-------------------------------*                                 04330005
033500 2100-PROCESS-ACCOUNT.                                            04340005
033600*-------------------------------*                                 04350005
033700                                                                  04360005
033800     IF PV-ACCOUNTS-PROCESSED = 1                                 04370005
034000        MOVE AR067-SSN                  TO PV-CURR-SSN            04380005
034100     ELSE                                                         04390005
034200        MOVE PV-TEAR-SSN                TO PV-CURR-SSN            04400005
034400     END-IF.                                                      04410005
034500                                                                  04420005
034800     SET PS-NO-ASSOC-FOUND TO TRUE.                               04430005
047800     SEARCH ALL PT-SSN-ARRAY                                      04440005
047900        AT END SET PS-NO-ASSOC-FOUND  TO TRUE                     04450005
048000        WHEN PT-SSN-NBR (PV-IDX2) = PV-CURR-SSN                   04460005
048100             SET PS-ASSOC-FOUND TO TRUE                           04470005
048200     END-SEARCH.                                                  04480005
034700                                                                  04490005
034800     IF PS-ASSOC-FOUND                                            04500005
034900        SET PS-WRITE-EMP-ACCT           TO TRUE                   04510005
035000        IF PV-ACCOUNTS-PROCESSED = 1                              04520005
035100           IF AR067-DISC-STAT-CDE = PC-FD-DISC-REGULAR            04530005
035110           OR AR067-DISC-STAT-CDE = PC-FD-NEW-ACC-ADD             04540005
035200              MOVE PC-REG-DISC-STAT    TO PV-CURR-DISC-STAT-CDE   04550005
035300           ELSE                                                   04560005
035400              IF AR067-DISC-STAT-CDE = PC-FD-DISC-LIFETIME        04570005
035500                 MOVE PC-LIFETIME-DISC-STAT TO                    04580005
035600                                          PV-CURR-DISC-STAT-CDE   04590005
035700              ELSE                                                04600005
035800                 MOVE PC-NO-DISC-STAT TO PV-CURR-DISC-STAT-CDE    04610005
035900              END-IF                                              04620005
036000           END-IF                                                 04630005
036100        ELSE                                                      04640005
036200           IF PV-TEAR-DISC-STAT-CDE = PC-FD-DISC-REGULAR          04650005
036210           OR PV-TEAR-DISC-STAT-CDE = PC-FD-NEW-ACC-ADD           04660005
036300              MOVE PC-REG-DISC-STAT    TO PV-CURR-DISC-STAT-CDE   04670005
036400           ELSE                                                   04680005
036500              IF PV-TEAR-DISC-STAT-CDE = PC-FD-DISC-LIFETIME      04690005
036600              MOVE PC-LIFETIME-DISC-STAT TO                       04700005
036700                                          PV-CURR-DISC-STAT-CDE   04710005
036800              ELSE                                                04720005
036900                 MOVE PC-NO-DISC-STAT TO PV-CURR-DISC-STAT-CDE    04730005
037000              END-IF                                              04740005
037100           END-IF                                                 04750005
037200        END-IF                                                    04760005
037300     END-IF.                                                      04770005
037400                                                                  04780005
037500*-------------------------------*                                 04790005
037600 2200-UPDATE-EMPL-ACCT-FILE.                                      04800005
037700*-------------------------------*                                 04810005
037800*    DELETE ROWS WITH EMPLOYEE ID OF SSN (NOT LIFETIME)           04820005
037900     MOVE PV-CURR-ACCT-NBR             TO ART00001-ACCT-NBR.      04830005
038000     MOVE PV-CURR-EMP-ID               TO ART00001-EMP-ID.        04840005
038100                                                                  04850005
038200     PERFORM 8300-DELETE-ART-EMP-DISC.                            04860005
038300                                                                  04870005
038400     PERFORM 8200-SELECT-ART-EMP-DISC.                            04880005
038500                                                                  04890005
038600     IF PS-EMP-DISC-EXIST                                         04900005
038700        IF  ART00001-DISC-STAT-CDE NOT = PC-LIFETIME-DISC-STAT    04910005
038800        AND ART00001-DISC-STAT-CDE NOT = PV-CURR-DISC-STAT-CDE    04920005
038900           MOVE PV-CURR-DISC-STAT-CDE  TO ART00001-DISC-STAT-CDE  04930005
039000*          UPDATE-EMP-DISC                                        04940005
039100           PERFORM 8400-UPDATE-ART-EMP-DISC                       04950005
039200        END-IF                                                    04960005
039300     ELSE                                                         04970005
039400        MOVE PV-CURR-DISC-STAT-CDE     TO ART00001-DISC-STAT-CDE  04980005
039500*       INSERT-EMP-DISC                                           04990005
      *CLP                                                              05000005
              MOVE PV-CURR-SSN-NBR           TO ART00001-SSN-NBR        05010005
              MOVE PV-CURR-EMP-STAT-CDE      TO ART00001-EMP-STAT-CDE   05020005
              IF PV-CURR-EMP-TYP-CDE = 'H' OR 'E' OR 'N'                05030005
                  MOVE '5'                   TO ART00001-EMP-TYP-CDE    05040005
              ELSE                                                      05050005
                  MOVE '6'                   TO ART00001-EMP-TYP-CDE    05060005
              END-IF                                                    05070005
              MOVE PV-CURR-EMP-NM            TO ART00001-EMP-NM         05080005
              MOVE PV-CURR-LOC-NBR           TO ART00001-LOC-NBR        05090005
              MOVE PV-CURR-DISC-DTE          TO ART00001-DISC-DTE       05100005
              MOVE PV-CURR-TERM-DTE          TO ART00001-TERM-DTE       05110005
              IF PV-CURR-TERM-DTE = SPACES                              05120005
039600            PERFORM 8500-INSERT-ART-EMP-DISC                      05130005
              ELSE                                                      05140005
039600            PERFORM 8501-INSERT-ART-EMP-DISC                      05150005
              END-IF                                                    05160005
039700     END-IF.                                                      05170005
039800                                                                  05180005
039900*-------------------------------*                                 05190005
040000 4010-READ-EMPL-ACCT-FILE.                                        05200005
040100*-------------------------------*                                 05210005
040200     MOVE SPACES                  TO PV-TEMP-EMP-ACCT-REC.        05220005
040300                                                                  05230005
040400     READ EMPLOYEE-ACCOUNT-IN-FILE                                05240005
040500        INTO PV-TEMP-EMP-ACCT-REC                                 05250005
040600        AT END                                                    05260005
040700           SET PS-STOP-PROCESSING TO TRUE                         05270005
040800     END-READ.                                                    05280005
040900                                                                  05290005
041000     IF NOT PS-STOP-PROCESSING                                    05300005
041100        ADD 1 TO PV-READ-COUNT                                    05310005
041200     END-IF.                                                      05320005
041300                                                                  05330005
041400*-------------------------------*                                 05340005
041500 4020-READ-TWO-EMPL-ACCT.                                         05350005
041600*-------------------------------*                                 05360005
041700     PERFORM 4010-READ-EMPL-ACCT-FILE.                            05370005
041800                                                                  05380005
041900     IF PS-CONTINUE-PROCESSING                                    05390005
042000** FD     SENDS JOINT ACCOUNT ENTITY AS TWO RECORDS               05400005
042100** BUT THEY SHOULD BE PROCESSED AT ONE TIME. MOVE                 05410005
042200** THE INITIAL READ TO A TEMP RECORD THEN READ                    05420005
042300** THE NEXT RECORD FROM THE FILE.  THIS WILL ALLOW                05430005
042400** US TO DETERMINE IF THE TWO RECORDS HAVE THE SAME               05440005
042500** ACCOUNT NUMBER (JOINT ACCTS).                                  05450005
042600        MOVE PV-TEMP-EMP-ACCT-REC    TO AR067-EMPLOYEE-DELTA-REC  05460005
042700        PERFORM 4010-READ-EMPL-ACCT-FILE                          05470005
042800        IF PS-STOP-PROCESSING                                     05480005
042900           MOVE SPACES                TO PV-TEMP-EMP-ACCT-REC     05490005
043000           SET PS-PROCESS-1           TO TRUE                     05500005
043100           SET PS-CONTINUE-PROCESSING TO TRUE                     05510005
043200        ELSE                                                      05520005
043300           SET PS-PROCESS-MANY        TO TRUE                     05530005
043400        END-IF                                                    05540005
043500     END-IF.                                                      05550005
043600                                                                  05560005
043700*-------------------------------*                                 05570005
043800 4030-READ-NEXT-ACCT-REC.                                         05580005
043900*-------------------------------*                                 05590005
044000     MOVE PV-TEMP-EMP-ACCT-REC     TO AR067-EMPLOYEE-DELTA-REC    05600005
044100                                                                  05610005
044200     PERFORM 4010-READ-EMPL-ACCT-FILE.                            05620005
044300                                                                  05630005
044400     IF PS-STOP-PROCESSING                                        05640005
044500        MOVE SPACES                TO PV-TEMP-EMP-ACCT-REC        05650005
044600        SET PS-PROCESS-1           TO TRUE                        05660005
044700        SET PS-CONTINUE-PROCESSING TO TRUE                        05670005
044800     ELSE                                                         05680005
044900        SET PS-PROCESS-MANY        TO TRUE                        05690005
045000     END-IF.                                                      05700005
045100                                                                  05710005
045200*-----------------------------*                                   05720005
045300 5000-WRITE-EMP-DISC-UPD.                                         05730005
045400*-----------------------------*                                   05740005
045500*    CHECK IF NEED BATCH HEADER AND CREATE                        05750005
P10237     PERFORM 5300-DETOKENIZE-ACCT-NBR.                            05760005
045700     IF PV-CURR-ACCT-PRE NOT = PV-PREV-ACCT-PRE                   05770005
045800        PERFORM 5100-LOOKUP-PRIN                                  05780005
045900        MOVE PV-CURR-ACCT-PRE    TO PV-PREV-ACCT-PRE              05790005
046000     END-IF.                                                      05800005
046100*    FORMAT BATCH NON-MON                                         05810005
046200     STRING '639305'             DELIMITED BY SIZE                05820005
046300            PV-CURR-ACCT-NBR     DELIMITED BY SIZE                05830005
046400            INTO AR068-ACCT-NBR.                                  05840005
046600     MOVE PV-SRCH-PRIN           TO AR068-KOHLS-SORT-PRIN.        05850005
046700*    WRITE NON-MON                                                05860005
046800     WRITE EMPLOYEE-DISC-UPDATE-REC                               05870005
046900        FROM AR068-EMP-DISC-UPDATE-REC.                           05880005
047000     ADD 1                       TO PV-NON-MON-COUNT.             05890005
047100                                                                  05900005
047200                                                                  05910005
047300*-----------------------------*                                   05920005
047400 5100-LOOKUP-PRIN.                                                05930005
047500*-----------------------------*                                   05940005
047600                                                                  05950005
047700     IF CC-PROD-TEST-CNTL = 'PROD'                                05960005
047800        SEARCH ALL PT-ACCT-PRIN-ARRAY                             05970005
047900           AT END MOVE ZEROES         TO PV-SRCH-PRIN             05980005
048000           WHEN PT-ACCT-PRE (PV-IDX) = PV-CURR-ACCT-PRE           05990005
048100                MOVE PT-FD-PRIN (PV-IDX) TO PV-SRCH-PRIN          06000005
048200        END-SEARCH                                                06010005
048300     ELSE                                                         06020005
048400        MOVE ZEROES                   TO PV-SRCH-PRIN             06030005
048500     END-IF.                                                      06040005
048600                                                                  06050005
P10237*-----------------------------*                                   06060005
P10237 5300-DETOKENIZE-ACCT-NBR.                                        06070005
P10237*-----------------------------*                                   06080005
P10237     INITIALIZE CSI-PARAMETERS                                    06090005
P10237                DP031-PROTEG-PGM-PARAMETERS                       06100005
P10237                PV-ACCT-NBR-12.                                   06110005
P10237                                                                  06120005
P10237     MOVE AR067-ACCT-NBR              TO PV-ACCT-NBR-10.          06130005
P10237                                                                  06140005
P10237     SET CSI-DECRYPT-FUNCTION         TO TRUE.                    06150005
P10237     SET DP031-ACCTNBR                TO TRUE.                    06160005
P10237     MOVE 'ACCT-NBR'                  TO DP031-FIELD.             06170005
P10237     MOVE PV-ACCT-NBR-12              TO DP031-CIPHER-TEXT.       06180005
P10237     MOVE 12                          TO DP031-INPUT-LEN.         06190005
P10237                                                                  06200005
P10237     PERFORM DP031-0000-PROTG-TOKEN-DETOKEN.                      06210009
P10237                                                                  06220009
P10237     IF CSI-RETURN-CODE NOT = ZERO                                06230009
P10237        DISPLAY 'ACCOUNT NBR      : ' AR067-ACCT-NBR              06240009
P10237        PERFORM DP031-9999-ABEND                                  06250009
P10237     ELSE                                                         06260009
P10237        MOVE DP031-CLEAR-TEXT (1:3)  TO PV-CURR-ACCT-PRE          06270009
P10237     END-IF.                                                      06280009
P10237                                                                  06290005
048700*-----------------------------*                                   06300005
048800 5500-READ-WORKDAY-ASSOC.                                         06310005
048900*-----------------------------*                                   06320005
           READ WD-EMPLOYEE-ACCOUNT-FILE INTO AR100-WD-EMPLOYEE-REC     06330005
040600        AT END                                                    06340005
040700           SET PS-EOF-WORKDAY TO TRUE                             06350005
040800     END-READ.                                                    06360005
                                                                        06370005
079700     IF PS-NOT-EOF-WORKDAY                                        06380005
079900        MOVE AR100-EMP-ID   TO PT-EMP-ID (PV-IDX2)                06390005
079900        MOVE AR100-SSN-NBR TO PT-SSN-NBR (PV-IDX2)                06400005
              MOVE AR100-EMP-NM  TO PT-EMP-NM  (PV-IDX2)                06410005
              MOVE AR100-EMP-STAT-CDE TO PT-EMP-STAT-CDE(PV-IDX2)       06420005
              MOVE AR100-EMP-TYP-CDE  TO PT-EMP-TYP-CDE (PV-IDX2)       06430005
              MOVE AR100-LOC-NBR      TO PT-LOC-NBR(PV-IDX2)            06440005
              MOVE AR100-DISC-DTE     TO PT-DISC-DTE(PV-IDX2)           06450005
              MOVE AR100-TERM-DTE     TO PT-TERM-DTE(PV-IDX2)           06460005
              ADD 1 TO PV-SSN-TABLE-COUNT                               06470005
080100        SET PV-IDX2 UP BY 1                                       06480005
080200     END-IF.                                                      06490005
080300                                                                  06500005
053900                                                                  06510005
060700                                                                  06520005
060800*-----------------------------*                                   06530005
060900 8200-SELECT-ART-EMP-DISC.                                        06540005
061000*-----------------------------*                                   06550005
061100     EXEC SQL                                                     06560005
061200           SELECT DISC_STAT_CDE                                   06570005
061300            INTO                                                  06580005
061400                 :ART00001-DISC-STAT-CDE                          06590005
061500            FROM ART_EMP_DISC                                     06600005
061600           WHERE ACCT_NBR = :ART00001-ACCT-NBR                    06610005
061700             AND EMP_ID   = :ART00001-EMP-ID                      06620005
061800            WITH UR                                               06630005
061900     END-EXEC.                                                    06640005
062000                                                                  06650005
062100     EVALUATE TRUE                                                06660005
062200        WHEN SQLCODE = PC-SUCCESSFUL-SQLCODE                      06670005
062300           SET PS-EMP-DISC-EXIST         TO TRUE                  06680005
062400        WHEN SQLCODE = PC-ROW-NOT-FOUND-SQLCODE                   06690005
062500           SET PS-EMP-DISC-DNE           TO TRUE                  06700005
062600        WHEN OTHER                                                06710005
062700           MOVE '8200-SELECT-ART-EMP-DISC' TO PV-PARAGRAPH-NAME   06720005
062800           MOVE 'ACCT_NBR,EMP_ID'        TO PV-KEY-VALUE-NAME     06730005
062900                                                                  06740005
063000           MOVE ART00001-ACCT-NBR        TO PV-KEY-VALUE          06750005
063100                                                                  06760005
063200           MOVE 'ART_EMP_DISC'           TO PV-DB2-TABLE-NAME     06770005
063300           MOVE 'SELECT ERROR'           TO PV-OPERATION-MSG      06780005
063400                                                                  06790005
063500           SET ABEND-4013-DB2-ERROR      TO TRUE                  06800005
063600           PERFORM Z999-ABEND                                     06810005
063700     END-EVALUATE.                                                06820005
063800                                                                  06830005
063900*-----------------------------*                                   06840005
064000 8300-DELETE-ART-EMP-DISC.                                        06850005
064100*-----------------------------*                                   06860005
064200** DELETE ANY ROWS ACCOUNT/SSN ROWS. THE NEW ROW WILL             06870005
064300** BE ADDED USING THE ASSOC ID OR A NEW SSN. WE NEED              06880005
064400** TO DO THIS TO KEEP THE TABLE UPDATE DATE WITH THE              06890005
064500** LATEST SSN (IF ASSOC ID IS NOT USED) AND ELIMINATE             06900005
064600** DUPLICATE ROWS IN WHICH ONE ROWS USES THE SSN AND              06910005
064700** THE OTHER USES THE ASSOC ID ASSOCIATED WITH THE                06920005
064800** SAME SSN.                                                      06930005
064900     EXEC SQL                                                     06940005
065000         DELETE FROM ART_EMP_DISC                                 06950005
065100          WHERE ACCT_NBR = :ART00001-ACCT-NBR                     06960005
065200            AND (EMP_ID   = :PV-CURR-SSN                          06970005
065300             OR  LENGTH(STRIP(EMP_ID,BOTH))= 9)                   06980005
065400            AND DISC_STAT_CDE <> 'L'                              06990005
065500     END-EXEC.                                                    07000005
065600                                                                  07010005
065700     EVALUATE TRUE                                                07020005
065800        WHEN SQLCODE = PC-SUCCESSFUL-SQLCODE                      07030005
0723RM*          CONTINUE                                               07040006
0723RM           ADD 1 TO PV-DELETE-COUNT                               07050006
066000        WHEN SQLCODE = PC-ROW-NOT-FOUND-SQLCODE                   07060005
066100           CONTINUE                                               07070005
066200        WHEN OTHER                                                07080005
066300           MOVE '8300-DELETE-ART-EMP-DISC' TO PV-PARAGRAPH-NAME   07090005
066400           MOVE 'ACCT_NBR,SS_NBR'        TO PV-KEY-VALUE-NAME     07100005
066500           MOVE ART00001-ACCT-NBR        TO PV-DISPLAY-NUMERIC    07110005
066600           MOVE SPACES                   TO PV-KEY-VALUE          07120005
066700           STRING                                                 07130005
066800               PV-DISPLAY-NUMERIC DELIMITED BY SIZE               07140005
066900               ','                DELIMITED BY SIZE               07150005
067000               PV-CURR-SSN        DELIMITED BY SIZE               07160005
067100           INTO PV-KEY-VALUE                                      07170005
067200           END-STRING                                             07180005
067300           MOVE 'ART_EMP_DISC'           TO PV-DB2-TABLE-NAME     07190005
067400           MOVE 'DELETE ERROR'           TO PV-OPERATION-MSG      07200005
067500           SET ABEND-4013-DB2-ERROR      TO TRUE                  07210005
067600           PERFORM Z999-ABEND                                     07220005
067700     END-EVALUATE.                                                07230005
067800                                                                  07240005
067900*-----------------------------*                                   07250005
068000 8400-UPDATE-ART-EMP-DISC.                                        07260005
068100*-----------------------------*                                   07270005
068200     EXEC SQL                                                     07280005
068300         UPDATE ART_EMP_DISC                                      07290005
068400          SET DISC_STAT_CDE = :ART00001-DISC-STAT-CDE             07300005
068500             ,LAST_UPD_DTE  = CURRENT DATE                        07310005
068600          WHERE ACCT_NBR = :ART00001-ACCT-NBR                     07320005
068700            AND EMP_ID   = :ART00001-EMP-ID                       07330005
068800     END-EXEC.                                                    07340005
068900                                                                  07350005
069000     EVALUATE TRUE                                                07360005
069100        WHEN SQLCODE = PC-SUCCESSFUL-SQLCODE                      07370005
069200           SET PS-SUCCESSFUL-UPDATE      TO TRUE                  07380005
069300           ADD 1                         TO PV-UPDATE-COUNT       07390005
069400*       WHEN SQLCODE = PC-ROW-NOT-FOUND-SQLCODE                   07400005
069500*          SET PS-UNSUCCESSFUL-UPDATE    TO TRUE                  07410005
069600        WHEN OTHER                                                07420005
069700           MOVE '8400-UPDATE-ART-EMP-DISC' TO PV-PARAGRAPH-NAME   07430005
069800           MOVE 'ACCT_NBR,EMP_ID'        TO PV-KEY-VALUE-NAME     07440005
069900                                                                  07450005
070000           MOVE ART00001-ACCT-NBR        TO PV-DISPLAY-NUMERIC    07460005
070100           MOVE SPACES                   TO PV-KEY-VALUE          07470005
070200           STRING                                                 07480005
070300              PV-DISPLAY-NUMERIC DELIMITED BY SIZE                07490005
070400              ','                DELIMITED BY SIZE                07500005
070500              ART00001-EMP-ID    DELIMITED BY SIZE                07510005
070600              INTO PV-KEY-VALUE                                   07520005
070700           END-STRING                                             07530005
070800                                                                  07540005
070900           MOVE 'ART_EMP_DISC'           TO PV-DB2-TABLE-NAME     07550005
071000           MOVE 'UPDATE ERROR'           TO PV-OPERATION-MSG      07560005
071100           SET ABEND-4013-DB2-ERROR      TO TRUE                  07570005
071200           PERFORM Z999-ABEND                                     07580005
071300        END-EVALUATE.                                             07590005
071400*---------------------*                                           07600005
071500 8500-INSERT-ART-EMP-DISC.                                        07610005
071600*---------------------*                                           07620005
071700     EXEC SQL                                                     07630005
071800         INSERT INTO ART_EMP_DISC VALUES                          07640005
071900           (:ART00001-ACCT-NBR                                    07650005
072000           ,:ART00001-EMP-ID                                      07660005
072100           ,:ART00001-DISC-STAT-CDE                               07670005
072200           ,CURRENT DATE                                          07680005
072300           ,NULL                                                  07690005
                 ,:ART00001-SSN-NBR                                     07700005
                 ,:ART00001-EMP-NM                                      07710005
                 ,:ART00001-EMP-STAT-CDE                                07720005
                 ,:ART00001-EMP-TYP-CDE                                 07730005
                 ,:ART00001-LOC-NBR                                     07740005
                 ,:ART00001-DISC-DTE                                    07750005
                 ,NULL)                                                 07760005
072400     END-EXEC.                                                    07770005
072500                                                                  07780005
072600     EVALUATE TRUE                                                07790005
072700        WHEN SQLCODE = PC-SUCCESSFUL-SQLCODE                      07800005
072800           SET PS-SUCCESSFUL-INSERT      TO TRUE                  07810005
072900           ADD 1                         TO PV-INSERT-COUNT       07820005
073000*       WHEN SQLCODE = PC-DUPLICATE-ROW-SQLCODE                   07830005
073100*          SET PS-UNSUCCESSFUL-INSERT    TO TRUE                  07840005
073200        WHEN OTHER                                                07850005
073300           MOVE '8500-INSERT-ART-EMP-DISC' TO PV-PARAGRAPH-NAME   07860005
073400           MOVE 'ACCT_NBR,EMP_ID'        TO PV-KEY-VALUE-NAME     07870005
073500                                                                  07880005
073600           MOVE ART00001-ACCT-NBR        TO PV-DISPLAY-NUMERIC    07890005
073700           MOVE SPACES                   TO PV-KEY-VALUE          07900005
073800           STRING                                                 07910005
073900               PV-DISPLAY-NUMERIC DELIMITED BY SIZE               07920005
074000               ','                DELIMITED BY SIZE               07930005
074100               ART00001-EMP-ID    DELIMITED BY SIZE               07940005
074200           INTO PV-KEY-VALUE                                      07950005
074300           END-STRING                                             07960005
074400                                                                  07970005
074500           MOVE 'ART_EMP_DISC'           TO PV-DB2-TABLE-NAME     07980005
074600           MOVE 'INSERT ERROR'           TO PV-OPERATION-MSG      07990005
074700           SET ABEND-4013-DB2-ERROR      TO TRUE                  08000005
074800           PERFORM Z999-ABEND                                     08010005
074900     END-EVALUATE.                                                08020005
075000                                                                  08030005
071400*---------------------*                                           08040005
071500 8501-INSERT-ART-EMP-DISC.                                        08050005
071600*---------------------*                                           08060005
071700     EXEC SQL                                                     08070005
071800         INSERT INTO ART_EMP_DISC VALUES                          08080005
071900           (:ART00001-ACCT-NBR                                    08090005
072000           ,:ART00001-EMP-ID                                      08100005
072100           ,:ART00001-DISC-STAT-CDE                               08110005
072200           ,CURRENT DATE                                          08120005
072300           ,NULL                                                  08130005
                 ,:ART00001-SSN-NBR                                     08140005
                 ,:ART00001-EMP-NM                                      08150005
                 ,:ART00001-EMP-STAT-CDE                                08160005
                 ,:ART00001-EMP-TYP-CDE                                 08170005
                 ,:ART00001-LOC-NBR                                     08180005
                 ,:ART00001-DISC-DTE                                    08190005
                 ,:ART00001-TERM-DTE)                                   08200005
072400     END-EXEC.                                                    08210005
072500                                                                  08220005
072600     EVALUATE TRUE                                                08230005
072700        WHEN SQLCODE = PC-SUCCESSFUL-SQLCODE                      08240005
072800           SET PS-SUCCESSFUL-INSERT      TO TRUE                  08250005
072900           ADD 1                         TO PV-INSERT-COUNT       08260005
073000*       WHEN SQLCODE = PC-DUPLICATE-ROW-SQLCODE                   08270005
073100*          SET PS-UNSUCCESSFUL-INSERT    TO TRUE                  08280005
073200        WHEN OTHER                                                08290005
073300           MOVE '8501-INSERT-ART-EMP-DISC' TO PV-PARAGRAPH-NAME   08300005
073400           MOVE 'ACCT_NBR,EMP_ID'        TO PV-KEY-VALUE-NAME     08310005
073500                                                                  08320005
073600           MOVE ART00001-ACCT-NBR        TO PV-DISPLAY-NUMERIC    08330005
073700           MOVE SPACES                   TO PV-KEY-VALUE          08340005
073800           STRING                                                 08350005
073900               PV-DISPLAY-NUMERIC DELIMITED BY SIZE               08360005
074000               ','                DELIMITED BY SIZE               08370005
074100               ART00001-EMP-ID    DELIMITED BY SIZE               08380005
074200           INTO PV-KEY-VALUE                                      08390005
074300           END-STRING                                             08400005
074400                                                                  08410005
074500           MOVE 'ART_EMP_DISC'           TO PV-DB2-TABLE-NAME     08420005
074600           MOVE 'INSERT ERROR'           TO PV-OPERATION-MSG      08430005
074700           SET ABEND-4013-DB2-ERROR      TO TRUE                  08440005
074800           PERFORM Z999-ABEND                                     08450005
074900     END-EVALUATE.                                                08460005
                                                                        08470005
075100 9000-ACCEPT-CURR-TMST.                                           08480005
075200*-----------------------------*                                   08490005
075300                                                                  08500005
075400     EXEC SQL                                                     08510005
075500         SET :PV-CURR-TMST = CURRENT TIMESTAMP                    08520005
075600     END-EXEC.                                                    08530005
075700                                                                  08540005
075800     IF SQLCODE NOT = PC-SUCCESSFUL-SQLCODE OR                    08550005
075900        SQLWARN0 = 'W'                                            08560005
076000        MOVE '9000-ACCEPT-CURR-TMST' TO PV-PARAGRAPH-NAME         08570005
076100        MOVE ' '                     TO PV-DB2-TABLE-NAME         08580005
076200        MOVE 'GET TMST'              TO PV-OPERATION-MSG          08590005
076300        PERFORM Z999-ABEND                                        08600005
076400     END-IF.                                                      08610005
076500                                                                  08620005
076600******************************************************************08630005
076700* Z050 - INITIALIZE                                               08640005
076800******************************************************************08650005
076900 Z050-INITIALIZE.                                                 08660005
077000                                                                  08670005
P10237     MOVE PC-PROGRAM-NAME    TO DP031-PROGRAM-NAME.               08680005
P10237                                                                  08690005
077100     OPEN INPUT EMPLOYEE-ACCOUNT-IN-FILE                          08700005
077200          CONTROL-CARD-1                                          08710005
077300          CONTROL-CARD-2                                          08720005
                WD-EMPLOYEE-ACCOUNT-FILE.                               08730005
077400     OPEN OUTPUT EMPLOYEE-DISC-UPDATE-FILE                        08740008
EMAIL                  EMAIL-FILE.                                      08750008
077500                                                                  08751008
077600     PERFORM 9000-ACCEPT-CURR-TMST.                               08760005
077700     MOVE PV-CURR-TMST       TO PV-PGM-BEG-TMST.                  08770005
077800     MOVE PV-CURR-TMST (6:2) TO PV-BTCH-MM.                       08780005
077900     MOVE PV-CURR-TMST (9:2) TO PV-BTCH-DD.                       08790005
078000                                                                  08800005
078100     SET PV-IDX              TO 1.                                08810005
078200     PERFORM Z060-READ-CONTROL-CARD-1                             08820005
078300        UNTIL PS-EOF-CONTROL-CARD-1.                              08830005
078400                                                                  08840005
078500     SET PV-IDX-MAX TO PV-IDX.                                    08850005
078600     SUBTRACT 1              FROM PV-IDX-MAX.                     08860005
078700                                                                  08870005
078800     READ CONTROL-CARD-2.                                         08880005
078900                                                                  08890005
           SET PV-IDX2             TO 1.                                08900005
078200     PERFORM 5500-READ-WORKDAY-ASSOC                              08910005
078300        UNTIL PS-EOF-WORKDAY.                                     08920005
                                                                        08930005
078500     SET PV-IDX2-MAX TO PV-IDX2.                                  08940005
078600     SUBTRACT 1              FROM PV-IDX2-MAX.                    08950005
                                                                        08960005
079000******************************************************************08970005
079100* Z060 - LOAD THE ACCT PRE - FD PRIN ARRAY                        08980005
079200******************************************************************08990005
079300 Z060-READ-CONTROL-CARD-1.                                        09000005
079400     READ CONTROL-CARD-1                                          09010005
079500        AT END SET PS-EOF-CONTROL-CARD-1 TO TRUE.                 09020005
079600                                                                  09030005
079700     IF PS-NOT-EOF-CONTROL-CARD-1                                 09040005
079800     AND CC-ACCT-PRE (1:1) NOT = '*'                              09050005
079900        MOVE CC-ACCT-PRE   TO PT-ACCT-PRE (PV-IDX)                09060005
080000        MOVE CC-FD-PRIN    TO PT-FD-PRIN  (PV-IDX)                09070005
080100        SET PV-IDX UP BY 1                                        09080005
080200     END-IF.                                                      09090005
080300                                                                  09100005
080400******************************************************************09110005
080500* Z100 - PREFORMS TASK TERMINATION PROCESSING                     09120005
080600******************************************************************09130005
080700 Z100-END-PROC.                                                   09140005
080800                                                                  09150005
080900     PERFORM 9000-ACCEPT-CURR-TMST.                               09160005
081000     MOVE PV-CURR-TMST TO PV-PGM-END-TMST.                        09170005
081100                                                                  09180005
081200     DISPLAY ' '.                                                 09190005
081300     DISPLAY '**********************'.                            09200005
081400     DISPLAY '   ARKUT072 CONTROLS  '.                            09210005
081500     DISPLAY '**********************'.                            09220005
081600     DISPLAY 'BEG DATE/TMST = ' PV-PGM-BEG-TMST                   09230005
081700     DISPLAY 'END DATE/TMST = ' PV-PGM-END-TMST                   09240005
081800     DISPLAY '======================'.                            09250005
081900     DISPLAY ' '.                                                 09260005
082000     DISPLAY 'RECORDS READ     : ' PV-READ-COUNT.                 09270005
082100     DISPLAY 'EMPLOYEE         : ' PV-ASSOC-COUNT.                09280005
082200     DISPLAY 'INSERTS          : ' PV-INSERT-COUNT.               09290005
082300     DISPLAY 'UPDATES          : ' PV-UPDATE-COUNT.               09300005
0723RM     DISPLAY 'DELETES          : ' PV-DELETE-COUNT.               09310006
082400     DISPLAY 'NON EMPLOYEE     : ' PV-NON-ASSOC-COUNT.            09320005
082500     DISPLAY 'NON MON UPDATE   : ' PV-NON-MON-COUNT.              09330005
CHG000     DISPLAY 'NON EMP NON ASSOC: ' PV-NO-ASSOC-COUNT.             09340005
CHG000     DISPLAY 'SSN TABLE COUNT  : ' PV-SSN-TABLE-COUNT.            09350005
082600     IF PV-NON-MON-COUNT = 0                                      09360005
082700        DISPLAY ' '                                               09370005
082800        DISPLAY '*** NO NON-MONS TO SEND TO FIRST DATA ***'       09380005
082900     END-IF.                                                      09390005
083000                                                                  09400005
EMAIL **   CREATE EMAIL FILE IF NUMBER OF FISERV RECORDS IS LOW.        09400108
EMAIL      IF PV-READ-COUNT < 30000                                     09400308
EMAIL          WRITE EMAIL-RECORD   FROM EM-EMAIL-BLANK-LINE            09400408
EMAIL          WRITE EMAIL-RECORD   FROM EM-EMAIL-LINE1                 09400508
EMAIL          WRITE EMAIL-RECORD   FROM EM-EMAIL-BLANK-LINE            09400608
EMAIL          MOVE  PV-READ-COUNT    TO EM-RECORD-COUNT                09400708
EMAIL          WRITE EMAIL-RECORD   FROM EM-EMAIL-LINE2                 09400808
EMAIL      END-IF.                                                      09402008
EMAIL                                                                   09403008
083100     CLOSE EMPLOYEE-ACCOUNT-IN-FILE                               09410005
083200           CONTROL-CARD-1                                         09420005
083300           CONTROL-CARD-2                                         09430005
                 WD-EMPLOYEE-ACCOUNT-FILE                               09440005
083400           EMPLOYEE-DISC-UPDATE-FILE                              09450008
EMAIL            EMAIL-FILE.                                            09451008
083500                                                                  09460005
083600******************************************************************09470005
083700* Z999 - ABEND ROUTINE                                            09480005
083800******************************************************************09490005
083900 Z999-ABEND.                                                      09500005
084000                                                                  09510005
084100     IF ABEND-4013-DB2-ERROR                                      09520005
084200                                                                  09530005
084300        PERFORM D999-DISPLAY-SQLCA                                09540005
084400                                                                  09550005
084500        MOVE SQLCODE    TO SQLCODE2                               09560005
084600        MOVE SQLERRD(3) TO SQLERRD3                               09570005
084700                                                                  09580005
084800        DISPLAY '** ABEND           ** = SQLABEND'                09590005
084900        DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME        09600005
085000        DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME      09610005
085100        DISPLAY '** KEY VALUE NAME  ** = ' PV-KEY-VALUE-NAME      09620005
085200        DISPLAY '** KEY VALUE       ** = ' PV-KEY-VALUE           09630005
085300        DISPLAY '** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME      09640005
085400        DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG       09650005
085500        DISPLAY '** SQLCODE         ** = ' SQLCODE2               09660005
085600        DISPLAY '** ROWS PROCESSED  ** = ' SQLERRD3               09670005
085700        DISPLAY '** SQLERRM         ** = ' SQLERRM                09680005
085800        DISPLAY '** SQLERRMC        ** = ' SQLERRMC               09690005
085900     END-IF.                                                      09700005
086000     CALL 'ILBOABN0' USING ABEND-CODE.                            09710005
086100                                                                  09720005
086200******************************************************************09730005
086300* D999 - DISPLAY SQL INFORMATION IN READABLE FORMAT               09740005
086400******************************************************************09750005
086500 D999-DISPLAY-SQLCA.                                              09760005
086600******************************************************************09770005
086700*  THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   09780005
086800*  MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        09790005
086900* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     09800005
087000*  FORMAT.                                                        09810005
087100******************************************************************09820005
087200        COPY DPPD004.                                             09830005
P10237                                                                  09840005
P10237******************************************************************09850005
P10237*      COPY MEMBER DPPD031 CONTAINS STATEMENTS NEEDED TO INVOKE   09860005
P10237*      PROTEGRITY MODULE FOR PROTECTION/UNPROTECTION              09870005
P10237******************************************************************09880005
P10237      COPY DPPD031.                                               09890005
P10237                                                                  09900005
P10237******************************************************************09910005
