000100***************************************************************** 00010004
000200 IDENTIFICATION DIVISION.                                         00011004
000300***************************************************************** 00012004
000400                                                                  00013004
000500 PROGRAM-ID.             SUKUT016.                                00014004
000600 AUTHOR.                 MICHAEL WALTERS.                         00015004
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00016004
000800 DATE-WRITTEN            OCTOBER, 1997.                           00017004
000900 DATE-COMPILED.                                                   00018004
001000***************************************************************** 00019004
001100***************************************************************** 00020004
001200*  THIS PROGRAM BUMP THE CARTON AND AUDIT FILES TOGETHER.  IN   * 00030004
001300*  THE PROCESS, VENDOR OVER/SHORT EXCEPTIONS WILL ALSO BE FOUND * 00040004
001400***************************************************************** 00050004
001500***************************************************************** 00060004
001600 ENVIRONMENT DIVISION.                                            00070004
001700***************************************************************** 00080004
001800                                                                  00090004
001900 CONFIGURATION SECTION.                                           00100004
002000                                                                  00110004
002100 SOURCE-COMPUTER.        IBM-3090.                                00120004
002200 OBJECT-COMPUTER.        IBM-3090.                                00130004
002300                                                                  00140004
002400 INPUT-OUTPUT SECTION.                                            00150004
002500                                                                  00160004
002600 FILE-CONTROL.                                                    00170004
002700*                                                                 00180004
002800     SELECT AUDIT-EXTRACT-FILE                                    00190004
002900         ASSIGN TO INP01.                                         00200004
003000                                                                  00210004
003100     SELECT VENDOR-EXTRACT-FILE                                   00220004
003200         ASSIGN TO INP02.                                         00230004
003300                                                                  00240004
003400     SELECT VENDOR-MERGE-FILE                                     00250004
003500         ASSIGN TO OUT01.                                         00260004
003600*                                                                 00270004
003700***************************************************************** 00280004
003800 DATA DIVISION.                                                   00290004
003900***************************************************************** 00300004
004000*                                                                 00310004
004100 FILE SECTION.                                                    00320004
004200*                                                                 00330004
004300 FD  AUDIT-EXTRACT-FILE                                           00340004
004400     RECORDING MODE IS F                                          00350004
004500     BLOCK CONTAINS 0  RECORDS.                                   00360004
004600 01  AUDIT-EXTRACT-RECORD            PIC  X(200).                 00370004
004700                                                                  00380004
004800 FD  VENDOR-EXTRACT-FILE                                          00390004
004900     RECORDING MODE IS F                                          00400004
005000     BLOCK CONTAINS 0  RECORDS.                                   00410004
005100 01  VENDOR-EXTRACT-RECORD           PIC  X(200).                 00420004
005200                                                                  00430004
005300 FD  VENDOR-MERGE-FILE                                            00440004
005400     RECORDING MODE IS F                                          00450004
005500     BLOCK CONTAINS 0  RECORDS.                                   00460004
005600 01  VENDOR-MERGE-RECORD             PIC  X(200).                 00470004
005700*                                                                 00480004
005800                                                                  00490004
005900 WORKING-STORAGE SECTION.                                         00500004
006000*                                                                 00510004
006100 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00520004
006200                                                   COMP SYNC.     00530004
006300*                                                                 00540004
006400 01  PROGRAM-SWITCHES.                                            00550004
006500     05  PS-EOF-AUDIT-EXTRACT-SW     PIC  X(01)    VALUE 'N'.     00560004
006600         88  PS-EOF-AUDIT-EXTRACT                  VALUE 'Y'.     00570004
006700         88  PS-NOT-EOF-AUDIT-EXTRACT             VALUE 'N'.      00580004
006800     05  PS-EOF-VENDOR-EXTRACT-SW    PIC  X(01)    VALUE 'N'.     00590004
006900         88  PS-EOF-VENDOR-EXTRACT                 VALUE 'Y'.     00600004
007000         88  PS-NOT-EOF-VENDOR-EXTRACT             VALUE 'N'.     00610004
007100     05  PS-PROCESS-SW               PIC  X(01)    VALUE ' '.     00620004
007200         88  PS-PROCESS-VENDOR-EXTRACT             VALUE 'V'.     00630004
007300         88  PS-PROCESS-AUDIT-EXTRACT              VALUE 'A'.     00640004
007400         88  PS-PROCESS-BOTH                       VALUE 'B'.     00650004
007500*                                                                 00660004
007600 01  PC-CONSTANTS.                                                00670004
007700     05  PC-1                        PIC S9(03)    VALUE +1       00680004
007800                                                   COMP-3.        00690004
007900     05  PC-A                        PIC  X(01)    VALUE 'A'.     00700004
008000     05  PC-Y                        PIC  X(01)    VALUE 'Y'.     00710004
008100     05  PC-RCV                      PIC  X(03)    VALUE 'RCV'.   00720004
008200     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00730004
008300         'SUKUT016'.                                              00740004
008400*                                                                 00750004
008500 01  PV-MISC-FIELDS.                                              00760004
008600     05  PV-WRITE-COUNT              PIC S9(09)    COMP.          00770004
008700     05  PV-PBS-IND-COUNT            PIC S9(09)    COMP.          00780004
008800     05  PV-HOLD-PO-NBR              PIC S9(09)    COMP.          00790004
008900     05  PV-LINE-SUB                 PIC S9(03)    VALUE ZERO     00800004
009000                                                   COMP-3.        00810004
009100     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     00820004
009200                                                   COMP SYNC.     00830004
009300     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  00840004
009400     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  00850004
009500     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  00860004
009600     05  PV-AUDIT-NBR-X              PIC  X(09).                  00870004
009700     05  PV-AUDIT-NBR REDEFINES PV-AUDIT-NBR-X                    00880004
009800                                     PIC  9(09).                  00890004
009900     05  PV-SKU-COUNT                    PIC S9(09)  VALUE +0     00900004
010000                                                     COMP-3.      00910004
010100*                                                                 00920004
010200******************************************************************00930004
010300*  RECORD LAYOUT FOR THE AUDIT EXTRACT INPUT FILE                 00940004
010400******************************************************************00950004
010500 01  AUDIT-EXTRACT.                                               00960004
010600     COPY SURD003.                                                00970004
010700                                                                  00980004
010800*                                                                 00990004
010900******************************************************************01000004
011000*  RECORD LAYOUT FOR THE VENDOR EXTRACT INPUT FILE                01010004
011100******************************************************************01020004
011200 01  VENDOR-EXTRACT.                                              01030004
011300     COPY SURD003.                                                01040004
011400                                                                  01050004
011500*                                                                 01060004
011600******************************************************************01070004
011700*  RECORD LAYOUT FOR THE VENDOR MERGE OUTPUT FILE                 01080004
011800******************************************************************01090004
011900 01  VENDOR-MERGE.                                                01100004
012000     COPY SURD003.                                                01110004
012100                                                                  01120004
012200 EJECT                                                            01130004
012300*                                                                 01140004
012400 PROCEDURE DIVISION.                                              01150004
012500*                                                                 01160004
012600 0000-MAINLINE-PROCESSING.                                        01170004
012700******************************************************************01180004
012800**  THIS IS THE MAIN DRIVER FOR THE PROGRAM.                      01190004
012900******************************************************************01200004
013000*                                                                 01210004
013100     PERFORM 1000-INITIALIZATION.                                 01220004
013200*                                                                 01230004
013300     PERFORM 2000-BUMP-FILES                                      01240004
013400         UNTIL PS-EOF-AUDIT-EXTRACT                               01250004
013500           AND PS-EOF-VENDOR-EXTRACT.                             01260004
013600*                                                                 01270004
013700     PERFORM 9000-EOJ-ROUTINE.                                    01280004
013800*                                                                 01290004
013900     GOBACK.                                                      01300004
014000*                                                                 01310004
014100*                                                                 01320004
014200 1000-INITIALIZATION.                                             01330004
014300******************************************************************01340004
014400**  PERFORM THE INITIAL PROCESSING FOR THE PROGRAM.               01350004
014500******************************************************************01360004
014600                                                                  01370004
014700     OPEN INPUT  AUDIT-EXTRACT-FILE                               01380004
014800                 VENDOR-EXTRACT-FILE                              01390004
014900          OUTPUT VENDOR-MERGE-FILE.                               01400004
015000                                                                  01410004
015100     SET PS-NOT-EOF-AUDIT-EXTRACT                                 01420004
015200         PS-NOT-EOF-VENDOR-EXTRACT    TO TRUE                     01430004
015300                                                                  01440004
015400     PERFORM 7000-READ-AUDIT-EXTRACT-FILE.                        01450004
015500     PERFORM 7001-READ-VENDOR-EXTRACT-FILE.                       01460004
015600                                                                  01470004
015700     IF PS-EOF-AUDIT-EXTRACT                                      01480004
015800         DISPLAY '** AUDIT EXTRACT IS EMPTY **'                   01490004
015900     END-IF.                                                      01500004
016000                                                                  01510004
016100     IF PS-EOF-VENDOR-EXTRACT                                     01520004
016200         DISPLAY '** VENDOR EXTRACT IS EMPTY **'                  01530004
016300     END-IF.                                                      01540004
016400*                                                                 01550004
016500****************************************************************  01560004
016600*  2000-BUMP-FILES.                                               01570004
016700*  MATCH THE RECORDS OF WHAT WAS AUDITED WITH WHAT THE VENDOR     01580004
016800*  SAID THEY SENT US (VENDOR EXTRACT)                             01590004
016900*  MATCH THE RECORDS AT THE AUDIT/PO/RECEIVER/CARTON/UPC LEVEL.   01600004
017000****************************************************************  01610004
017100 2000-BUMP-FILES.                                                 01620004
017200                                                                  01630004
017300     PERFORM 2001-COMPARE-KEYS.                                   01640004
017400                                                                  01650004
017500     INITIALIZE SU003-EXTRACT-RECORD OF VENDOR-MERGE.             01660004
017600                                                                  01670004
017700     EVALUATE TRUE                                                01680004
017800*      IF BOTH FILES ARE ON MATCHING RECORDS, MOVE THE AUDIT EXTRA01690004
017900*      RECORD TO THE VENDOR MERGE RECORD, AND MOVE THE QUANTITY   01700004
018000*      EXPECTED FROM VENDOR EXTRACT RECORD TO THE VENDOR MERGE REC01710004
018100       WHEN  PS-PROCESS-BOTH                                      01720004
018200         MOVE SU003-EXTRACT-RECORD OF AUDIT-EXTRACT               01730004
018300           TO SU003-EXTRACT-RECORD OF VENDOR-MERGE                01740004
018400                                                                  01750004
018500         MOVE SU003-QTY-EXP        OF VENDOR-EXTRACT              01760004
018600           TO SU003-QTY-EXP        OF VENDOR-MERGE                01770004
018700                                                                  01780004
018800         PERFORM 7000-READ-AUDIT-EXTRACT-FILE                     01790004
018900         PERFORM 7001-READ-VENDOR-EXTRACT-FILE                    01800004
019000                                                                  01810004
019100*      IF THE VENDOR EXTRACT IS BEHIND THE AUDIT EXTRACT IT IS A  01820004
019200*      SHORTAGE.  MOVE THE EXTRACT RECORD FROM THE VENDOR EXTRACT 01830004
019300*      VENDOR MERGE RECORD, AND SET BOTH ERROR QUANTITIES TO +1.  01840004
019400       WHEN  PS-PROCESS-VENDOR-EXTRACT                            01850004
019500         MOVE SU003-EXTRACT-RECORD OF VENDOR-EXTRACT              01860004
019600           TO SU003-EXTRACT-RECORD OF VENDOR-MERGE                01870004
019700         MOVE +1 TO SU003-PICK-ERR-CNT      OF VENDOR-MERGE       01880004
               IF SU003-QC-AUDIT OF VENDOR-MERGE                        01890004
                   MOVE +1                                              01900004
019800                 TO SU003-UNT-ERR-CNT-COMBO OF VENDOR-MERGE       01910004
               END-IF                                                   01920004
019900         ADD  +1 TO SU003-TOT-ERR-QTY       OF VENDOR-MERGE       01930004
020000                                                                  01940004
020100         PERFORM 7001-READ-VENDOR-EXTRACT-FILE                    01950004
020200                                                                  01960004
020300*      IF THE AUDIT EXTRACT IS BEHIND THE VENDOR EXTRACT IT IS AN 01970004
020400*      OVERAGE.  MOVE THE EXTRACT RECORD FROM THE AUDIT EXTRACT TO01980004
020500*      VENDOR MERGE RECORD, AND SET BOTH ERROR QUANTITIES TO +1 (I01990004
020600*      ARE LESS THAN 1, OTHERWISE IGNORE)                         02000004
020700*      ADD +1 TO THE TOTAL NUMBER OF ERRORS THAT MAY OR MAY NOT   02010004
020800*      ALREADY EXISTS ON THE EXCEPTION TABLE (SET IN SUKUT009)    02020004
020900       WHEN  PS-PROCESS-AUDIT-EXTRACT                             02030004
021000         MOVE SU003-EXTRACT-RECORD OF AUDIT-EXTRACT               02040004
021100           TO SU003-EXTRACT-RECORD OF VENDOR-MERGE                02050004
021200         MOVE +1 TO SU003-PICK-ERR-CNT      OF VENDOR-MERGE       02060004
               IF SU003-QC-AUDIT OF VENDOR-MERGE                        02070004
                   MOVE +1                                              02080004
021300                 TO SU003-UNT-ERR-CNT-COMBO OF VENDOR-MERGE       02090004
               END-IF                                                   02100004
021400         ADD  +1 TO SU003-TOT-ERR-QTY       OF VENDOR-MERGE       02110004
021500                                                                  02120004
021600         PERFORM 7000-READ-AUDIT-EXTRACT-FILE                     02130004
021700     END-EVALUATE.                                                02140004
021800                                                                  02150004
021900     PERFORM 8000-WRITE-VENDOR-MERGE-FILE.                        02160004
022000                                                                  02170004
022100                                                                  02180004
022200****************************************************************  02190004
022300*  2001-COMPARE-KEYS.                                             02200004
022400*  DETERMINE IF THE FILES MATCH.   IF THEY DON'T, DETERMINE WHICH 02210004
022500*  FILE TO PROCESS                                                02220004
022600****************************************************************  02230004
022700 2001-COMPARE-KEYS.                                               02240004
022800                                                                  02250004
022900     EVALUATE TRUE                                                02260004
023000*        WHEN THE AUDIT NUMBER IS DIFFERENT                       02270004
023100         WHEN SU003-AUD-CNTL-NBR  OF AUDIT-EXTRACT <              02280004
023200              SU003-AUD-CNTL-NBR  OF VENDOR-EXTRACT               02290004
023300             SET PS-PROCESS-AUDIT-EXTRACT      TO TRUE            02300004
023400         WHEN SU003-AUD-CNTL-NBR  OF AUDIT-EXTRACT >              02310004
023500              SU003-AUD-CNTL-NBR  OF VENDOR-EXTRACT               02320004
023600             SET PS-PROCESS-VENDOR-EXTRACT     TO TRUE            02330004
023700                                                                  02340004
023800*        PO NUMBER                                                02350004
023900         WHEN SU003-PO-NBR        OF AUDIT-EXTRACT <              02360004
024000              SU003-PO-NBR        OF VENDOR-EXTRACT               02370004
024100             SET PS-PROCESS-AUDIT-EXTRACT      TO TRUE            02380004
024200         WHEN SU003-PO-NBR        OF AUDIT-EXTRACT >              02390004
024300              SU003-PO-NBR        OF VENDOR-EXTRACT               02400004
024400             SET PS-PROCESS-VENDOR-EXTRACT     TO TRUE            02410004
024500                                                                  02420004
024600*        RECEIVER NUMBER                                          02430004
024700         WHEN SU003-REC-SEQ-NBR   OF AUDIT-EXTRACT <              02440004
024800              SU003-REC-SEQ-NBR   OF VENDOR-EXTRACT               02450004
024900             SET PS-PROCESS-AUDIT-EXTRACT      TO TRUE            02460004
025000         WHEN SU003-REC-SEQ-NBR   OF AUDIT-EXTRACT >              02470004
025100              SU003-REC-SEQ-NBR   OF VENDOR-EXTRACT               02480004
025200             SET PS-PROCESS-VENDOR-EXTRACT     TO TRUE            02490004
025300                                                                  02500004
025400*        CARTON NUMBER                                            02510004
025500         WHEN SU003-SHIPT-UNT-ID  OF AUDIT-EXTRACT <              02520004
025600              SU003-SHIPT-UNT-ID  OF VENDOR-EXTRACT               02530004
025700             SET PS-PROCESS-AUDIT-EXTRACT      TO TRUE            02540004
025800         WHEN SU003-SHIPT-UNT-ID  OF AUDIT-EXTRACT >              02550004
025900              SU003-SHIPT-UNT-ID  OF VENDOR-EXTRACT               02560004
026000             SET PS-PROCESS-VENDOR-EXTRACT     TO TRUE            02570004
026100                                                                  02580004
026200*        UPC NUMBER                                               02590004
026300         WHEN SU003-INTR-UPC-ID OF AUDIT-EXTRACT <                02600004
026400              SU003-INTR-UPC-ID OF VENDOR-EXTRACT                 02610004
026500             SET PS-PROCESS-AUDIT-EXTRACT      TO TRUE            02620004
026600         WHEN SU003-INTR-UPC-ID OF AUDIT-EXTRACT >                02630004
026700              SU003-INTR-UPC-ID OF VENDOR-EXTRACT                 02640004
026800             SET PS-PROCESS-VENDOR-EXTRACT     TO TRUE            02650004
026900                                                                  02660004
027000*        IF IT IS THE SAME ITEM, PROCESS BOTH RECORDS             02670004
027100         WHEN OTHER                                               02680004
027200             SET PS-PROCESS-BOTH               TO TRUE            02690004
027300     END-EVALUATE.                                                02700004
027400                                                                  02710004
027500                                                                  02720004
027600****************************************************************  02730004
027700* 7000-READ-AUDIT-EXTRACT-FILE                                 *  02740004
027800* READ THE NEXT RECORD OF THE AUDIT EXTRACT FILE               *  02750004
027900****************************************************************  02760004
028000 7000-READ-AUDIT-EXTRACT-FILE.                                    02770004
028100                                                                  02780004
028200     READ AUDIT-EXTRACT-FILE                                      02790004
028300     INTO SU003-EXTRACT-RECORD OF AUDIT-EXTRACT                   02800004
028400        AT END                                                    02810004
028500           SET PS-EOF-AUDIT-EXTRACT TO TRUE                       02820004
028600           MOVE +999999999 TO SU003-AUD-CNTL-NBR OF AUDIT-EXTRACT 02830004
028700     END-READ.                                                    02840004
028800                                                                  02850004
028900****************************************************************  02860004
029000* 7001-READ-VENDOR-EXTRACT-FILE                                *  02870004
029100* READ THE NEXT RECORD OF THE VENDOR EXTRACT FILE              *  02880004
029200****************************************************************  02890004
029300 7001-READ-VENDOR-EXTRACT-FILE.                                   02900004
029400                                                                  02910004
029500     READ VENDOR-EXTRACT-FILE                                     02920004
029600     INTO SU003-EXTRACT-RECORD OF VENDOR-EXTRACT                  02930004
029700        AT END                                                    02940004
029800           SET PS-EOF-VENDOR-EXTRACT TO TRUE                      02950004
029900           MOVE +999999999 TO SU003-AUD-CNTL-NBR OF VENDOR-EXTRACT02960004
030000     END-READ.                                                    02970004
030100                                                                  02980004
030200*                                                                 02990004
030300****************************************************************  03000004
030400* 8000-WRITE-VENDOR-MERGE-FILE                                 *  03010004
030500* WRITE THE NEXT RECROD OF THE VENDOR MERGE FILE               *  03020004
030600****************************************************************  03030004
030700 8000-WRITE-VENDOR-MERGE-FILE.                                    03040004
030800                                                                  03050004
030900     WRITE VENDOR-MERGE-RECORD                                    03060004
031000       FROM SU003-EXTRACT-RECORD OF VENDOR-MERGE.                 03070004
031100*                                                                 03080004
031200 9000-EOJ-ROUTINE.                                                03090004
031300                                                                  03100004
031400     CLOSE AUDIT-EXTRACT-FILE                                     03110004
031500           VENDOR-EXTRACT-FILE                                    03120004
031600           VENDOR-MERGE-FILE.                                     03130004
031700                                                                  03140004
