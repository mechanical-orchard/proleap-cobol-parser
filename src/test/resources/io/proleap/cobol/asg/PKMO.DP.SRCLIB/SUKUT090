000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300 PROGRAM-ID.             SUKUT090.                                00030047
000400 AUTHOR.                 LYNN MCADAMS.                            00040048
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050048
000600 DATE-WRITTEN            SEPTEMBER, 2004.                         00060048
000700 DATE-COMPILED.                                                   00070048
000800*----------------------------------------------------------------*00080048
000900* THIS PROGRAM WILL GET THE CURRENT CARTON LOCATION CODE AND     *00090048
001000* PROCESS AREA FROM THE WORK ORDER INSTRUCTION DATABASE.         *00100048
001100* THE INPUT FILE IS SORTED IN OPER-PO-RCVR-SRC-LINE SEQUENCE.    *00110048
001200*                                                                *00120048
001300* THE LAYOUT FOR THE INPUT AND OUTPUT FILE IS SURD045.           *00130048
001400*----------------------------------------------------------------*00140048
001500 ENVIRONMENT DIVISION.                                            00150048
001600 INPUT-OUTPUT SECTION.                                            00160048
001700                                                                  00170048
001800 FILE-CONTROL.                                                    00180048
001900                                                                  00190048
002000     SELECT INPUT-FILE ASSIGN TO INP01.                           00200048
002100     SELECT EXTRACT-FILE ASSIGN TO OUT01.                         00210048
002200                                                                  00220048
002300***************************************************************** 00230048
002400 DATA DIVISION.                                                   00240048
002500 FILE SECTION.                                                    00250048
002600*                                                                 00260048
002700 FD  INPUT-FILE                                                   00270048
002800     RECORDING MODE IS F                                          00280048
002900     LABEL RECORDS ARE STANDARD                                   00290048
003000     BLOCK CONTAINS 0 RECORDS.                                    00300048
003100 01  INPUT-RECORD                PIC X(200).                      00310048
003200                                                                  00320048
003300 FD  EXTRACT-FILE                                                 00330048
003400     RECORDING MODE IS F                                          00340048
003500     LABEL RECORDS ARE STANDARD                                   00350048
003600     BLOCK CONTAINS 0 RECORDS.                                    00360048
003700 01  EXTRACT-RECORD              PIC X(200).                      00370048
003800*                                                                 00380048
003900***************************************************************** 00390048
004000 WORKING-STORAGE SECTION.                                         00400048
004100                                                                  00410048
004200 01  PS-PROGRAM-SWITCHES.                                         00420048
004300     05  PS-END-OF-INPUT-FILE-SW        PIC X(01)  VALUE 'N'.     00430048
004400         88  PS-END-OF-INPUT-FILE                  VALUE 'Y'.     00440048
004500         88  PS-NOT-END-OF-INPUT-FILE              VALUE 'N'.     00450048
004600                                                                  00460048
004700     05  PS-END-ZERO-LEVEL-WO-CSR-SW    PIC X(01)  VALUE 'N'.     00470048
004800         88  PS-END-ZERO-LEVEL-WO-CSR-YES          VALUE 'Y'.     00480048
004900         88  PS-END-ZERO-LEVEL-WO-CSR-NO           VALUE 'N'.     00490048
005000     05  PS-END-LINE-LEVEL-WO-CSR-SW    PIC X(01)  VALUE 'N'.     00500048
005100         88  PS-END-LINE-LEVEL-WO-CSR-YES          VALUE 'Y'.     00510048
005200         88  PS-END-LINE-LEVEL-WO-CSR-NO           VALUE 'N'.     00520048
005300                                                                  00530048
005400     05  PS-ZERO-LEVEL-WO-SW            PIC X(01)  VALUE 'N'.     00540048
005500         88  PS-PO-ZERO-LVL-WO-YES                 VALUE 'Y'.     00550048
005600         88  PS-PO-ZERO-LVL-WO-NO                  VALUE 'N'.     00560048
005700     05  PS-LINE-LEVEL-WO-SW            PIC X(01)  VALUE 'N'.     00570048
005800         88  PS-PO-LINE-LVL-WO-YES                 VALUE 'Y'.     00580048
005900         88  PS-PO-LINE-LVL-WO-NO                  VALUE 'N'.     00590048
006000                                                                  00600048
006100     05  PS-CURRENT-LINE-HAS-WO-SW      PIC X(01)  VALUE 'N'.     00610048
006200         88  PS-CURRENT-LINE-HAS-WO-YES            VALUE 'Y'.     00620048
006300         88  PS-CURRENT-LINE-HAS-WO-NO             VALUE 'N'.     00630048
006400     05  PS-FIRST-TIME-CURR-LINE-SW     PIC X(01)  VALUE 'N'.     00640048
006500         88  PS-FIRST-TIME-CURRENT-LINE-YES        VALUE 'Y'.     00650048
006600         88  PS-FIRST-TIME-CURRENT-LINE-NO         VALUE 'N'.     00660048
006700                                                                  00670048
006800     05  PS-TOO-SOON-TO-REPORT-SW     PIC X(01)  VALUE 'N'.       00680000
006900         88  PS-TOO-SOON-TO-REPORT               VALUE 'Y'.       00690000
007000         88  PS-TOO-SOON-TO-REPORT-NO            VALUE 'N'.       00700000
007100     05  PS-TOO-LATE-TO-REPORT-SW     PIC X(01)  VALUE 'N'.       00710000
007200         88  PS-TOO-LATE-TO-REPORT               VALUE 'Y'.       00720000
007300         88  PS-TOO-LATE-TO-REPORT-NO            VALUE 'N'.       00730000
007700                                                                  00770000
007800 01  ABEND-CODE                       PIC S9(04) VALUE ZERO       00780000
007900                                                 COMP SYNC.       00790000
008000     88  ABEND-4013-DB2-ERROR                    VALUE +4013.     00800000
008100                                                                  00810000
008200 01  PV-PROGRAM-VARIABLES.                                        00820000
008210     05  PV-ATTR-DEPT                 PIC  S9(10)V9(5) COMP-3.    00821049
008300     05  PV-PREVIOUS-PO               PIC S9(09)  VALUE ZEROES.   00830000
008400     05  PV-PREVIOUS-RCVR             PIC S9(09)  VALUE ZEROES.   00840000
008500     05  PV-PREVIOUS-LINE             PIC S9(09)  VALUE ZEROES.   00850000
008600     05  PV-PREVIOUS-OPER             PIC S9(04)  VALUE ZEROES.   00860000
008700                                                                  00870000
008800     05  PV-ZERO-LEVEL-PROC-AREA      PIC X(06)   VALUE SPACES.   00880000
008900     05  PV-LINE-LEVEL-PROC-AREA      PIC X(06)   VALUE SPACES.   00890000
009000                                                                  00900000
009100     05  PV-ZERO-LEVEL-LINE-LOC       PIC X(05)   VALUE SPACES.   00910000
009200     05  PV-LINE-LEVEL-LINE-LOC       PIC X(05)   VALUE SPACES.   00920000
009300                                                                  00930000
009400     05  PV-LINE-LEVEL-COUNT          PIC S9(09) VALUE ZERO       00940000
009500                                                  COMP SYNC.      00950000
009600     05  PV-READ-COUNT                PIC S9(09) VALUE ZERO       00960000
009700                                                  COMP SYNC.      00970000
009800     05  PV-WRITE-EXTR-COUNT          PIC S9(09) VALUE ZERO       00980000
009900                                                  COMP SYNC.      00990000
010000                                                                  01000000
010100     05  PV-DISPLAY-READ-CNT          PIC ZZZ,ZZZ,ZZ9.            01010000
010200     05  PV-DISPLAY-WRITE-CNT         PIC ZZZ,ZZZ,ZZ9.            01020000
010300                                                                  01030000
010400     05  PV-DISPLAY-TRN-NBR           PIC Z(9)-.                  01040000
010500     05  PV-DISPLAY-RCVR-SEQ-NBR      PIC Z(9)-.                  01050000
010600     05  PV-DISPLAY-TRN-LNE-NBR       PIC Z(9)-.                  01060000
010700     05  PV-DISPLAY-ORGN-LOC-NBR      PIC Z(9)-.                  01070000
010800     05  PV-DISPLAY-UPC-NBR           PIC Z(9)-.                  01080000
010900                                                                  01090000
011000     05  PV-DB2-CURRENT-TIMESTAMP     PIC X(26)  VALUE SPACE.     01100000
011100     05  PV-DB2-FUNCTION              PIC X(30)  VALUE SPACE.     01110000
011200     05  PV-DB2-TABLE-NAME1           PIC X(15)  VALUE SPACE.     01120011
011300     05  PV-DB2-TABLE-NAME2           PIC X(15)  VALUE SPACE.     01130011
011400     05  PV-DB2-TABLE-NAME3           PIC X(15)  VALUE SPACE.     01140011
011500                                                                  01150000
011600     05  PV-RETAIL-AMOUNT             PIC S9(09)V99 VALUE ZERO    01160000
011700                                                  COMP SYNC.      01170000
011800     05  PV-CARTON-UNIT-COUNT         PIC S9(09) VALUE ZERO       01180000
011900                                                  COMP SYNC.      01190000
012000     05  PV-RETAIL-AMOUNT-EXTENDED    PIC S9(09)V99 VALUE ZERO    01200000
012100                                                  COMP SYNC.      01210000
012200     05  PV-OPEN-DATE                 PIC X(10) VALUE SPACE.      01220000
012300     05  PV-CURRENT-DATE              PIC X(10) VALUE SPACE.      01230000
012400                                                                  01240000
012500     05  PV-WORK-TMST.                                            01250000
012600         10  PV-WORK-DATE             PIC X(10) VALUE SPACE.      01260000
012700         10  PV-WORK-DASH             PIC X(01) VALUE SPACE.      01270000
012800         10  PV-WORK-TIME             PIC X(08) VALUE SPACE.      01280000
012900         10  PV-WORK-DOT              PIC X(01) VALUE SPACE.      01290000
013000         10  PV-WORK-MICRO            PIC 9(06) VALUE ZEROES.     01300000
013100     05  PV-OTHER-BEG-TMST            PIC X(26) VALUE SPACE.      01310000
013200     05  PV-OTHER-END-TMST            PIC X(26) VALUE SPACE.      01320000
013300     05  PV-FLAT-BEG-TMST             PIC X(26) VALUE SPACE.      01330000
013400     05  PV-FLAT-END-TMST             PIC X(26) VALUE SPACE.      01340000
013500     05  PV-JWL-BEG-TMST              PIC X(26) VALUE SPACE.      01350000
013600     05  PV-JWL-END-TMST              PIC X(26) VALUE SPACE.      01360000
013700     05  PV-JEWELRY-DEPT              PIC 9(03).                  01370032
013800                                                                  01380032
013900 01  DK-DB-KEYS.                                                  01390000
014000     05  DK-TRN-NBR                  PIC  S9(09) COMP.            01400000
014100     05  DK-RCVR-SEQ-NBR             PIC  S9(09) COMP.            01410000
014200     05  DK-TRN-LNE-NBR              PIC  S9(09) COMP.            01420000
014300     05  DK-ORGN-LOC-NBR             PIC  S9(09) COMP.            01430000
014400     05  DK-DEST-LOC-NBR             PIC  S9(09) COMP.            01440000
014500                                                                  01450000
014600 01 PC-PROGRAM-CONSTANTS.                                         01460000
014700     05 PC-PROGRAM-NAME              PIC X(08)  VALUE 'SUKUT090'. 01470000
014800     05 PC-DEFAULT-TMST              PIC X(26)                    01480000
014900             VALUE '9999-09-09-09.09.09.999999'.                  01490000
015000     05 PC-01                       PIC  X(01)  VALUE '1'.        01500000
015100                                                                  01510000
015200 01  PV-ABEND-FIELDS.                                             01520000
015300     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         01530000
015400                                                 COMP SYNC.       01540000
015500     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'SUKUT090'.01550000
015600     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01560000
015700     05  PV-ABEND-OPERATION           PIC  X(51) VALUE SPACES.    01570000
015800     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACES.    01580000
015900     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(30) VALUE SPACES.    01590000
016000     05  PV-DISPLAY-SQLCODE           PIC -9(05) VALUE ZEROES.    01600000
016100     05  PV-SQL-RETURN-CD             PIC  999-.                  01610000
016200     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01620000
016300     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01630000
016400     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01640000
016500     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01650000
016600                                                                  01660000
016700******************************************************************01670000
016800*  USED FOR DB2 ERROR MESSAGE BUILDING                            01680000
016900******************************************************************01690000
017000     COPY DPWS004.                                                01700000
017100                                                                  01710000
017200*----------------------------------------------------------------*01720000
017300*    ABEND PROCESSING COPYBOOK.                                  *01730000
017400*----------------------------------------------------------------*01740000
017500     COPY DPWS013.                                                01750000
017600                                                                  01760000
017700******************************************************************01770000
017800*   DB2 SQL COMMUNICATION AREA                                    01780000
017900******************************************************************01790000
018000     EXEC SQL                                                     01800000
018100          INCLUDE SQLCA                                           01810000
018200     END-EXEC.                                                    01820000
018300                                                                  01830000
018400*DB2 AREA FOR COMMUNICATIONS AREA2                                01840000
018500     COPY SQLCA2.                                                 01850000
018600                                                                  01860000
018700******************************************************************01870000
018800*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   01880000
018900*   TUPCPLS                                                       01890000
019000******************************************************************01900000
019100     EXEC SQL                                                     01910000
019200          INCLUDE TUPCPLS                                         01920000
019300     END-EXEC.                                                    01930000
019400                                                                  01940000
019500******************************************************************01950000
019600*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   01960000
019700*   XLT_UPC                                                       01970000
019800******************************************************************01980000
019900     EXEC SQL                                                     01990000
020000          INCLUDE XLT00006                                        02000000
020100     END-EXEC.                                                    02010000
020200                                                                  02020000
020300******************************************************************02030000
020400*   XLT_LOC DATABASE                                              02040000
020500******************************************************************02050000
020600     EXEC SQL                                                     02060000
020700          INCLUDE XLT00010                                        02070000
020800     END-EXEC.                                                    02080000
020900                                                                  02090000
021000******************************************************************02100000
021100*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   02110000
021200*   WORK ORDER INSTRUCTION TABLE.                                 02120000
021300******************************************************************02130000
021400     EXEC SQL                                                     02140000
021500          INCLUDE TWKORIN                                         02150000
021600     END-EXEC.                                                    02160000
021700                                                                  02170000
021800******************************************************************02180000
021900*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   02190000
022000*   SU OTBOUND UPC TABLE - SUT_OTBND_UPC                          02200000
022100******************************************************************02210000
022200     EXEC SQL                                                     02220000
022300          INCLUDE SUT00028                                        02230000
022400     END-EXEC.                                                    02240000
022500                                                                  02250000
022600******************************************************************02260000
022700*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   02270000
022800*   PC PROCESS AREA ASSOCIATION TABLE PCT_PRC_AREA_ASSN           02280000
022900******************************************************************02290000
023000     EXEC SQL                                                     02300000
023100          INCLUDE PCT00003                                        02310000
023200     END-EXEC.                                                    02320000
023300                                                                  02330000
023400******************************************************************02340000
023500*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   02350000
023600*   RC - KOHLS TO RETEK PROCESSING PARAMETERS TABLE               02360000
023700******************************************************************02370000
023800     EXEC SQL                                                     02380000
023900          INCLUDE TKRPRPM                                         02390000
024000     END-EXEC.                                                    02400000
024100                                                                  02410000
024200******************************************************************02420001
024300*  SQL AND COBOL DECLARATIONS FOR WST_INTGRTN_TYP                 02430001
024400******************************************************************02440001
024500     EXEC SQL                                                     02450001
024600          INCLUDE WST00008                                        02460001
024700     END-EXEC.                                                    02470001
024800******************************************************************02480001
024900*  SQL AND COBOL DECLARATIONS FOR WST_ATTR_DEFN                   02490001
025000******************************************************************02500001
025100     EXEC SQL                                                     02510001
025200          INCLUDE WST00009                                        02520001
025300     END-EXEC.                                                    02530001
025400******************************************************************02540001
025500*  SQL AND COBOL DECLARATIONS FOR WST_ATTR_ELEM                   02550001
025600******************************************************************02560001
025700     EXEC SQL                                                     02570001
025800          INCLUDE WST00010                                        02580001
025900     END-EXEC.                                                    02590001
026000                                                                  02600001
026100                                                                  02610000
026200******************************************************************02620000
026300* ZERO LEVEL CURSOR                                               02630000
026400******************************************************************02640000
026500     EXEC SQL                                                     02650000
026600          DECLARE ZERO-LEVEL-WO-CSR CURSOR FOR                    02660000
026700   SELECT STOP_TMST                                               02670000
026800        , PRC_FCLTY_AREA_ID                                       02680000
026900        , LNE_LOC_CDE                                             02690000
027000        , SCREEN_SEQ_NBR                                          02700000
027100     FROM TWKORIN                                                 02710000
027200    WHERE ORD_NBR          = :DK-TRN-NBR                          02720000
027300      AND RCVR_SEQ_NBR     = :DK-RCVR-SEQ-NBR                     02730000
027400      AND ORD_LNE_NBR      = 0                                    02740000
027500      AND WORK_ORD_SEQ_NBR = 1                                    02750000
027600      AND VER_STATUS_CDE   = 'A'                                  02760000
027700   ORDER BY SCREEN_SEQ_NBR                                        02770000
027800     WITH UR                                                      02780000
027900     END-EXEC.                                                    02790000
028000                                                                  02800000
028100******************************************************************02810000
028200* LINE LEVEL CURSOR                                               02820000
028300******************************************************************02830000
028400     EXEC SQL                                                     02840000
028500          DECLARE LINE-LEVEL-WO-CSR CURSOR FOR                    02850000
028600   SELECT STOP_TMST                                               02860000
028700        , PRC_FCLTY_AREA_ID                                       02870000
028800        , LNE_LOC_CDE                                             02880000
028900        , SCREEN_SEQ_NBR                                          02890000
029000     FROM TWKORIN                                                 02900000
029100    WHERE ORD_NBR          = :DK-TRN-NBR                          02910000
029200      AND RCVR_SEQ_NBR     = :DK-RCVR-SEQ-NBR                     02920000
029300      AND ORD_LNE_NBR      = :DK-TRN-LNE-NBR                      02930000
029400      AND WORK_ORD_SEQ_NBR = 1                                    02940000
029500      AND VER_STATUS_CDE   = 'A'                                  02950000
029600   ORDER BY SCREEN_SEQ_NBR                                        02960000
029700     WITH UR                                                      02970000
029800     END-EXEC.                                                    02980000
029900                                                                  02990000
031400                                                                  03140000
031500***********************************************************       03150000
031600*  RECORD LAYOUT FOR THE SML EXTRACT FILE FOR CARTONS             03160000
031700*  CREATED AND NOT MANIFESTED TO A TRAILER.                       03170000
031800***********************************************************       03180000
031900*INPUT FILE LAYOUT                                                03190000
032000*OUTPUT FILE LAYOUT                                               03200000
032100     COPY SURD045.                                                03210000
032200                                                                  03220000
032300                                                                  03230000
032400***********************************************************       03240000
032500 PROCEDURE DIVISION.                                              03250000
032600***********************************************************       03260000
032700     DISPLAY '***BEGINNING SUKUT090***'.                          03270000
032800                                                                  03280000
032900     PERFORM 1000-INITIALIZE.                                     03290000
033000                                                                  03300000
033100     PERFORM 2000-PROCESS-EXTRACTS                                03310000
033200         UNTIL PS-END-OF-INPUT-FILE.                              03320000
033300                                                                  03330000
033400     PERFORM 9000-CLOSE-FILES.                                    03340000
033500                                                                  03350000
033600     GOBACK.                                                      03360000
033700                                                                  03370000
033800                                                                  03380000
033900******************************************************************03390000
034000*  DO FIRST TIME PROGRAM INITIALIZE TASKS.                        03400000
034100 1000-INITIALIZE.                                                 03410000
034200******************************************************************03420000
034300     OPEN INPUT  INPUT-FILE                                       03430000
034400          OUTPUT EXTRACT-FILE.                                    03440000
034500                                                                  03450000
034600                                                                  03460000
034700     PERFORM 7000-READ-INPUT-FILE.                                03470000
034800                                                                  03480000
034900***************************************************************** 03490000
035000 2000-PROCESS-EXTRACTS.                                           03500000
035100***************************************************************** 03510000
035200     MOVE '2000-PROCESS-EXTRACTS   ' TO PV-ABEND-PARAGRAPH.       03520000
035300                                                                  03530000
035400     SET  PS-TOO-SOON-TO-REPORT-NO                                03540000
035500          PS-TOO-LATE-TO-REPORT-NO  TO  TRUE.                     03550000
035600                                                                  03560000
035700     IF SU045-CART-SRC-CDE = 'P2L'                                03570000
035800         SET SU045-TYP-CDE-P2L  TO TRUE                           03580000
035900     ELSE                                                         03590000
036000         IF SU045-CART-SRC-CDE = 'JWL'                            03600000
036100             SET SU045-TYP-CDE-JWL  TO TRUE                       03610000
036200         ELSE                                                     03620000
036300             IF SU045-CART-SRC-CDE = 'FXR'                        03630000
036400                 SET SU045-TYP-CDE-OTHER TO TRUE                  03640000
036500             ELSE                                                 03650000
036600                 PERFORM 2200-JEWELRY-DEPT-CHK                    03660033
036700             END-IF                                               03670000
036800         END-IF                                                   03680000
036900     END-IF.                                                      03690000
037000                                                                  03700000
037100     IF PS-TOO-SOON-TO-REPORT OR PS-TOO-LATE-TO-REPORT            03710000
037200         CONTINUE                                                 03720000
037300     ELSE                                                         03730000
037400         IF SU045-TRN-NBR      = PV-PREVIOUS-PO   AND             03740000
037500            SU045-RCVR-SEQ-NBR = PV-PREVIOUS-RCVR AND             03750000
037600            SU045-TRN-LNE-NBR  = PV-PREVIOUS-LINE                 03760000
037700             IF PS-CURRENT-LINE-HAS-WO-YES                        03770000
037800                 MOVE PV-LINE-LEVEL-PROC-AREA TO SU045-PRC-AREA-ID03780000
037900                 MOVE PV-LINE-LEVEL-LINE-LOC TO SU045-LNE-LOC-CDE 03790000
038000             ELSE                                                 03800000
038100                 MOVE PV-ZERO-LEVEL-PROC-AREA TO SU045-PRC-AREA-ID03810000
038200                 MOVE PV-ZERO-LEVEL-LINE-LOC TO SU045-LNE-LOC-CDE 03820000
038300             END-IF                                               03830000
038400         ELSE                                                     03840000
038500             IF SU045-TRN-NBR      = PV-PREVIOUS-PO  AND          03850000
038600                 SU045-RCVR-SEQ-NBR = PV-PREVIOUS-RCVR            03860000
038700                  IF PS-PO-LINE-LVL-WO-YES AND                    03870000
038800                     SU045-TRN-LNE-NBR > 0                        03880000
038900                        PERFORM 2120-PROCESS-LINE-LEVEL-WO-CSR    03890000
039000                  END-IF                                          03900000
039100                  IF PS-CURRENT-LINE-HAS-WO-YES                   03910000
039200                      MOVE PV-LINE-LEVEL-PROC-AREA TO             03920000
039300                                                 SU045-PRC-AREA-ID03930000
039400                      MOVE PV-LINE-LEVEL-LINE-LOC  TO             03940000
039500                                                 SU045-LNE-LOC-CDE03950000
039600                  ELSE                                            03960000
039700                      MOVE PV-ZERO-LEVEL-PROC-AREA TO             03970000
039800                                                 SU045-PRC-AREA-ID03980000
039900                      MOVE PV-ZERO-LEVEL-LINE-LOC TO              03990000
040000                                                SU045-LNE-LOC-CDE 04000000
040100                  END-IF                                          04010000
040200              ELSE                                                04020000
040300                  PERFORM 7010-OPEN-ZERO-LEVEL-WO-CSR             04030000
040400                  PERFORM 7020-FETCH-ZERO-LEVEL-WO-CSR            04040000
040500                  PERFORM 2100-PROCESS-ZERO-LEVEL-WO-CSR          04050000
040600                      UNTIL WKORIN-STOP-TMST = PC-DEFAULT-TMST    04060000
040700                        OR PS-END-ZERO-LEVEL-WO-CSR-YES           04070000
040800                  PERFORM 7030-CLOSE-ZERO-LEVEL-WO-CSR            04080000
040900                  PERFORM 2110-LINE-LEVEL-COUNT                   04090000
041000                  IF PS-PO-LINE-LVL-WO-YES AND                    04100000
041100                     SU045-TRN-LNE-NBR > 0                        04110000
041200                        PERFORM 2120-PROCESS-LINE-LEVEL-WO-CSR    04120000
041300                  END-IF                                          04130000
041400                  IF PS-CURRENT-LINE-HAS-WO-YES                   04140000
041500                      MOVE PV-LINE-LEVEL-PROC-AREA TO             04150000
041600                                                 SU045-PRC-AREA-ID04160000
041700                      MOVE PV-LINE-LEVEL-LINE-LOC  TO             04170000
041800                                                 SU045-LNE-LOC-CDE04180000
041900                  ELSE                                            04190000
042000                      MOVE PV-ZERO-LEVEL-PROC-AREA TO             04200000
042100                                                 SU045-PRC-AREA-ID04210000
042200                      MOVE PV-ZERO-LEVEL-LINE-LOC  TO             04220000
042300                                                 SU045-LNE-LOC-CDE04230000
042400                   END-IF                                         04240000
042500             END-IF                                               04250000
042600         END-IF                                                   04260000
042700     END-IF.                                                      04270000
042800                                                                  04280000
042900     IF PS-TOO-SOON-TO-REPORT OR PS-TOO-LATE-TO-REPORT            04290000
043000         CONTINUE                                                 04300000
043100     ELSE                                                         04310000
043200         IF SU045-CART-SRC-CDE = 'P2L' OR                         04320000
043300            SU045-CART-SRC-CDE = 'JWL' OR                         04330000
043400            SU045-TYP-CDE      = 'J'                              04340000
043500             CONTINUE                                             04350000
043600         ELSE                                                     04360000
043700             IF SU045-ORGN-LOC-NBR NOT = PV-PREVIOUS-OPER         04370000
043800                 PERFORM 4100-GET-DATE-RANGE                      04380000
043900                 MOVE SU045-ORGN-LOC-NBR TO PV-PREVIOUS-OPER      04390000
044000             END-IF                                               04400000
044100             IF SU045-PRC-AREA-ID NOT = SPACES                    04410000
044200                  PERFORM 4000-GET-PROCESS-AREA-GROUP             04420000
044300             END-IF                                               04430000
044400         END-IF                                                   04440000
044500     END-IF.                                                      04450000
044600                                                                  04460000
044700     IF PS-TOO-SOON-TO-REPORT OR PS-TOO-LATE-TO-REPORT            04470000
044800         CONTINUE                                                 04480000
044900     ELSE                                                         04490000
045000         IF SU045-TRN-NBR      = PV-PREVIOUS-PO   AND             04500000
045100            SU045-RCVR-SEQ-NBR = PV-PREVIOUS-RCVR AND             04510000
045200            SU045-TRN-LNE-NBR  = PV-PREVIOUS-LINE                 04520000
045300               CONTINUE                                           04530000
045400         ELSE                                                     04540000
045500               MOVE ZEROES  TO PV-RETAIL-AMOUNT                   04550000
045600               PERFORM 3000-SELECT-RETAIL-PRICE                   04560000
045700         END-IF                                                   04570000
045800     END-IF                                                       04580000
045900                                                                  04590000
046000     IF PS-TOO-SOON-TO-REPORT OR PS-TOO-LATE-TO-REPORT            04600000
046100         CONTINUE                                                 04610000
046200     ELSE                                                         04620000
046300         PERFORM 3200-GET-CARTON-UNIT-COUNT                       04630000
046400         MULTIPLY PV-CARTON-UNIT-COUNT                            04640000
046500            BY  PV-RETAIL-AMOUNT                                  04650000
046600               GIVING PV-RETAIL-AMOUNT-EXTENDED                   04660000
046700         MOVE PV-RETAIL-AMOUNT-EXTENDED TO SU045-RETAIL-AMT       04670000
046800         PERFORM 8000-WRITE-EXTRACT                               04680000
046900     END-IF.                                                      04690000
047000                                                                  04700000
047100     MOVE SU045-TRN-NBR      TO PV-PREVIOUS-PO.                   04710000
047200     MOVE SU045-RCVR-SEQ-NBR TO PV-PREVIOUS-RCVR.                 04720000
047300     MOVE SU045-TRN-LNE-NBR  TO PV-PREVIOUS-LINE.                 04730000
047400                                                                  04740000
047500     PERFORM 7000-READ-INPUT-FILE.                                04750000
047600                                                                  04760000
047700***************************************************************** 04770000
047800 2100-PROCESS-ZERO-LEVEL-WO-CSR.                                  04780000
047900***************************************************************** 04790000
048000                                                                  04800000
048100     PERFORM 7020-FETCH-ZERO-LEVEL-WO-CSR.                        04810000
048200                                                                  04820000
048300***************************************************************** 04830000
048400 2110-LINE-LEVEL-COUNT.                                           04840000
048500***************************************************************** 04850000
048600     MOVE SU045-TRN-NBR      TO DK-TRN-NBR                        04860000
048700     MOVE SU045-RCVR-SEQ-NBR TO DK-RCVR-SEQ-NBR                   04870000
048800     MOVE SU045-ORGN-LOC-NBR TO DK-ORGN-LOC-NBR                   04880000
048900                                                                  04890000
049000     EXEC SQL                                                     04900000
049100       SELECT COUNT(*)                                            04910000
049200         INTO  :PV-LINE-LEVEL-COUNT                               04920000
049300         FROM TWKORIN                                             04930000
049400        WHERE ORD_NBR          = :DK-TRN-NBR                      04940000
049500          AND RCVR_SEQ_NBR     = :DK-RCVR-SEQ-NBR                 04950000
049600          AND ORD_LNE_NBR      > 0                                04960000
049700          AND WORK_ORD_SEQ_NBR = 1                                04970000
049800          AND VER_STATUS_CDE   = 'A'                              04980000
049810         WITH UR                                                  04981054
049900     END-EXEC.                                                    04990000
050000                                                                  05000000
050100     EVALUATE TRUE                                                05010000
050200         WHEN SQLCODE = +0                                        05020000
050300              IF PV-LINE-LEVEL-COUNT > 0                          05030000
050400                 SET PS-PO-LINE-LVL-WO-YES TO TRUE                05040000
050500              ELSE                                                05050000
050600                 SET PS-PO-LINE-LVL-WO-NO  TO TRUE                05060000
050700              END-IF                                              05070000
050800         WHEN SQLCODE = +100                                      05080000
050900         WHEN SQLWARN0 NOT = SPACE                                05090000
051000         WHEN SQLCODE  NOT = +0                                   05100000
051100              MOVE '2110-LINE-LEVEL-COUNT'                        05110000
051200                                   TO PV-ABEND-PARAGRAPH          05120000
051300              MOVE 'ATTEMPTING TO SELECT TWKORIN'                 05130000
051400                                   TO PV-ABEND-OPERATION          05140000
051500              MOVE DK-TRN-NBR      TO                             05150000
051600                                PV-DISPLAY-TRN-NBR                05160000
051700              MOVE DK-RCVR-SEQ-NBR    TO                          05170000
051800                                PV-DISPLAY-RCVR-SEQ-NBR           05180000
051900              MOVE DK-ORGN-LOC-NBR    TO                          05190000
052000                                PV-DISPLAY-ORGN-LOC-NBR           05200000
052100              PERFORM Z999-SQL-ABEND                              05210000
052200     END-EVALUATE.                                                05220000
052300                                                                  05230000
052400***************************************************************** 05240000
052500 2120-PROCESS-LINE-LEVEL-WO-CSR.                                  05250000
052600                                                                  05260000
052700     PERFORM 7040-OPEN-LINE-LEVEL-WO-CSR.                         05270000
052800     PERFORM 7050-FETCH-LINE-LEVEL-WO-CSR                         05280000
052900       UNTIL WKORIN-STOP-TMST = PC-DEFAULT-TMST                   05290000
053000          OR PS-END-LINE-LEVEL-WO-CSR-YES.                        05300000
053100     PERFORM 7060-CLOSE-LINE-LEVEL-WO-CSR.                        05310000
053200                                                                  05320000
053210***************************************************************** 05321049
053211** BRINGS JEWELRY DEPARTMENTS - USED FOR 425 TROUBLES             05321150
053230***************************************************************** 05323049
053300 2200-JEWELRY-DEPT-CHK.                                           05330033
053301                                                                  05330149
053302     MOVE  SU045-DEPT-NBR          TO  PV-ATTR-DEPT.              05330250
053304                                                                  05330449
053305     EXEC SQL                                                     05330549
053310          SELECT C.INTGRTN_TYP_CDE                                05331052
053311            INTO :WST00010-INTGRTN-TYP-CDE                        05331151
053320            FROM WST_INTGRTN_TYP A                                05332049
053330               , WST_ATTR_DEFN   B                                05333049
053340               , WST_ATTR_ELEM   C                                05334049
053350           WHERE A.INTGRTN_TYP_CDE    =  'JEWLRYDEPT'             05335049
053360             AND A.INTGRTN_TYP_CDE    =  B.INTGRTN_TYP_CDE        05336049
053370             AND B.ATTR_DEFN_SEQ_NBR  =  1                        05337049
053380             AND A.INTGRTN_TYP_CDE    =  C.INTGRTN_TYP_CDE        05338049
053390             AND C.ATTR_DEFN_SEQ_NBR  =  1                        05339049
053391             AND C.ATTR_ELEM_NBR      =  :PV-ATTR-DEPT            05339149
053392            WITH UR                                               05339254
053393     END-EXEC.                                                    05339349
053394                                                                  05339449
053395     EVALUATE TRUE                                                05339549
053396         WHEN SQLCODE = +0                                        05339649
053397              SET SU045-TYP-CDE-JWL  TO  TRUE                     05339749
053398              PERFORM 5000-CHECK-JWL-CRTNS                        05339849
053399                                                                  05339949
053400         WHEN SQLCODE = +100                                      05340049
053401             CONTINUE                                             05340149
053402         WHEN SQLWARN0 NOT = SPACE                                05340249
053403         WHEN SQLCODE  NOT = +0                                   05340349
053404              MOVE 'CHECK JWL DEPT'  TO PV-ABEND-OPERATION        05340449
053405              MOVE 'WST_INTGRTN_TYP' TO PV-DB2-TABLE-NAME1        05340549
053406              MOVE 'WST_ATTR_DEFN'   TO PV-DB2-TABLE-NAME2        05340649
053407              MOVE 'WST_ATTR_ELEM'   TO PV-DB2-TABLE-NAME3        05340749
053408              MOVE '2200-JEWELRY-DEPT-CHK'                        05340850
053409                                     TO PV-ABEND-PARAGRAPH        05340950
053410             PERFORM Z999-SQL-ABEND                               05341050
053411     END-EVALUATE.                                                05341150
053420                                                                  05342049
060300                                                                  06030033
060400***************************************************************** 06040000
060500 3000-SELECT-RETAIL-PRICE.                                        06050000
060600***************************************************************** 06060000
060700     MOVE SU045-UPC-NBR      TO SUT00028-UPC-NBR.                 06070000
060800                                                                  06080000
060900     EXEC SQL                                                     06090000
061000       SELECT UNT_RTL_AMT                                         06100000
061100         INTO  :UPCPLS-UNT-RTL-AMT                                06110000
061200         FROM XLT_UPC A                                           06120000
061300            , TUPCPLS B                                           06130000
061400        WHERE A.UPC_NBR        = :SUT00028-UPC-NBR                06140000
061500          AND A.INTR_UPC_ID    = B.UPC_ID                         06150000
061600          AND B.EFF_END_TMST  IS NULL                             06160000
061700          AND B.STR_NBR        = 0                                06170000
061710         WITH UR                                                  06171054
061800     END-EXEC.                                                    06180000
061900                                                                  06190000
062000     EVALUATE TRUE                                                06200000
062100         WHEN SQLCODE = +0                                        06210000
062200              MOVE UPCPLS-UNT-RTL-AMT  TO  PV-RETAIL-AMOUNT       06220000
062300         WHEN SQLCODE = +100                                      06230000
062400              MOVE ZEROES                TO  PV-RETAIL-AMOUNT     06240000
062500         WHEN SQLWARN0 NOT = SPACE                                06250000
062600         WHEN SQLCODE  NOT = +0                                   06260000
062700              MOVE '3000-SELECT-RETAIL-PRICE'                     06270000
062800                                   TO PV-ABEND-PARAGRAPH          06280000
062900              MOVE 'ATTEMPTING TO SELECT RCTPRCRCPT'              06290000
063000                                   TO PV-ABEND-OPERATION          06300000
063100              MOVE SU045-TRN-NBR      TO  PV-DISPLAY-TRN-NBR      06310000
063200              MOVE SU045-RCVR-SEQ-NBR TO  PV-DISPLAY-RCVR-SEQ-NBR 06320000
063300              MOVE SU045-ORGN-LOC-NBR TO  PV-DISPLAY-ORGN-LOC-NBR 06330000
063400              MOVE SU045-TRN-LNE-NBR  TO  PV-DISPLAY-TRN-LNE-NBR  06340000
063500              MOVE SU045-UPC-NBR      TO  PV-DISPLAY-UPC-NBR      06350000
063600              PERFORM Z999-SQL-ABEND                              06360000
063700     END-EVALUATE.                                                06370000
063800                                                                  06380000
063900***************************************************************** 06390000
064000 3200-GET-CARTON-UNIT-COUNT.                                      06400000
064100***************************************************************** 06410000
064200     MOVE SU045-TRN-NBR      TO SUT00028-TRN-NBR.                 06420000
064300     MOVE SU045-TRN-LNE-NBR  TO SUT00028-TRN-LNE-NBR.             06430000
064400     MOVE SU045-RCVR-SEQ-NBR TO SUT00028-RCVR-SEQ-NBR.            06440000
064500     MOVE SU045-SHIPT-UNT-ID TO SUT00028-SHIPT-UNT-ID.            06450000
064600     MOVE SU045-UPC-NBR      TO SUT00028-UPC-NBR.                 06460000
064700                                                                  06470000
064800     EXEC SQL                                                     06480000
064900       SELECT SUM(SHPD_UNT_QTY)                                   06490000
065000         INTO  :SUT00028-SHPD-UNT-QTY                             06500000
065100         FROM SUT_OTBND_UPC                                       06510000
065200        WHERE TRN_NBR          = :SUT00028-TRN-NBR                06520000
065300          AND UPC_NBR          = :SUT00028-UPC-NBR                06530000
065400          AND RCVR_SEQ_NBR     = :SUT00028-RCVR-SEQ-NBR           06540000
065500          AND SHIPT_UNT_ID     = :SUT00028-SHIPT-UNT-ID           06550000
065600          AND SHPD_UNT_QTY     > 0                                06560000
065610         WITH UR                                                  06561054
065700     END-EXEC.                                                    06570000
065800                                                                  06580000
065900     EVALUATE TRUE                                                06590000
066000         WHEN SQLCODE = +0                                        06600000
066100              MOVE SUT00028-SHPD-UNT-QTY TO PV-CARTON-UNIT-COUNT  06610000
066200                                            SU045-UNIT-COUNT      06620000
066300         WHEN SQLCODE = +100                                      06630000
066400         WHEN SQLCODE = -305                                      06640000
066500              MOVE ZEROES TO PV-CARTON-UNIT-COUNT                 06650000
066600         WHEN SQLWARN0 NOT = SPACE                                06660000
066700         WHEN SQLCODE  NOT = +0                                   06670000
066800              MOVE '3200-GET-CARTON-UNIT-COUNT'                   06680000
066900                                   TO PV-ABEND-PARAGRAPH          06690000
067000              MOVE 'ATTEMPTING TO SELECT OTBNDCART'               06700000
067100                                   TO PV-ABEND-OPERATION          06710000
067200              MOVE SUT00028-TRN-NBR      TO                       06720000
067300                                PV-DISPLAY-TRN-NBR                06730000
067400              MOVE SUT00028-RCVR-SEQ-NBR    TO                    06740000
067500                                PV-DISPLAY-RCVR-SEQ-NBR           06750000
067600              PERFORM Z999-SQL-ABEND                              06760000
067700     END-EVALUATE.                                                06770000
067800                                                                  06780000
067900***************************************************************** 06790000
068000 4000-GET-PROCESS-AREA-GROUP.                                     06800000
068100***************************************************************** 06810000
068200     MOVE SU045-PRC-AREA-ID  TO PCT00003-PRCG-AREA-CDE.           06820000
068300     MOVE SU045-ORGN-LOC-NBR TO PCT00003-OPER-UNT-ID.             06830000
068400                                                                  06840000
068500     EXEC SQL                                                     06850000
068600       SELECT PRC_AREA_GP_CDE                                     06860000
068700         INTO  :PCT00003-PRC-AREA-GP-CDE                          06870000
068800         FROM PCT_PRC_AREA_ASSN                                   06880000
068900        WHERE PRCG_AREA_CDE    = :PCT00003-PRCG-AREA-CDE          06890000
069000          AND OPER_UNT_ID      = :PCT00003-OPER-UNT-ID            06900000
069010         WITH UR                                                  06901054
069100     END-EXEC.                                                    06910000
069200                                                                  06920000
069300     EVALUATE TRUE                                                06930000
069400         WHEN SQLCODE = +0                                        06940000
069500             IF PCT00003-PRC-AREA-GP-CDE = 'FLAT'                 06950000
069600                SET SU045-TYP-CDE-FLAT        TO TRUE             06960000
069700             ELSE                                                 06970000
069800                SET SU045-TYP-CDE-OTHER       TO TRUE             06980000
069900             END-IF                                               06990000
070000             PERFORM 4200-CHECK-DATE-RANGE                        07000000
070100         WHEN SQLCODE = +100                                      07010000
070200             CONTINUE                                             07020000
070300         WHEN SQLWARN0 NOT = SPACE                                07030000
070400         WHEN SQLCODE  NOT = +0                                   07040000
070500              MOVE '4000-GET-PROCESS-AREA-GROUP'                  07050000
070600                                        TO PV-ABEND-PARAGRAPH     07060000
070700              MOVE 'ATTEMPTING TO SELECT PROCESS GROUP'           07070000
070800                                        TO PV-ABEND-OPERATION     07080000
070900              MOVE SUT00028-TRN-NBR     TO PV-DISPLAY-TRN-NBR     07090000
071000              MOVE SUT00028-RCVR-SEQ-NBR                          07100000
071100                                        TO PV-DISPLAY-RCVR-SEQ-NBR07110000
071200              PERFORM Z999-SQL-ABEND                              07120000
071300     END-EVALUATE.                                                07130000
071400                                                                  07140000
071500******************************************************************07150000
071600* - SELECT START TMST WHEN A CARTON OTHER THAN FLAT SHOULD BE    *07160000
071700*   ATTACHED TO A TRAILER.                                       *07170000
071800*   (CURRENT TIMESTAMP - A.FUNC_QTY DAYS - B.FUNC_QTY HOURS)     *07180000
071900*                                                                *07190000
072000* - SELECT END TMST WHEN A CARTON OTHER THAN FLAT SHOULD         *07200000
072100*   APPEAR ON THE REPORT.                                        *07210000
072200*   (CURRENT TIMESTAMP - B.FUNC_QTY HOURS)                       *07220000
072300*                                                                *07230000
072400******************************************************************07240000
072500 4100-GET-DATE-RANGE.                                             07250000
072600                                                                  07260000
072700     MOVE SU045-ORGN-LOC-NBR  TO  DK-ORGN-LOC-NBR.                07270000
072800                                                                  07280000
072900     EXEC SQL                                                     07290000
073000        SELECT                                                    07300000
073100          (CURRENT TIMESTAMP - F.FUNC_QTY HOURS)                  07310000
073200        , (CURRENT TIMESTAMP - E.FUNC_QTY DAYS - F.FUNC_QTY HOURS)07320000
073300        , (CURRENT TIMESTAMP - H.FUNC_QTY HOURS)                  07330000
073400        , (CURRENT TIMESTAMP - E.FUNC_QTY DAYS - H.FUNC_QTY HOURS)07340000
073500           INTO                                                   07350000
073600                 :PV-OTHER-END-TMST                               07360000
073700               , :PV-OTHER-BEG-TMST                               07370000
073800               , :PV-FLAT-END-TMST                                07380000
073900               , :PV-FLAT-BEG-TMST                                07390000
074000          FROM                                                    07400000
074100              TKRPRPM E                                           07410000
074200           ,  TKRPRPM F                                           07420000
074300           ,  TKRPRPM H                                           07430000
074400                                                                  07440000
074500         WHERE                                                    07450000
074600              E.LOC_ID            =  :DK-ORGN-LOC-NBR             07460000
074700          AND E.SYS_PRC_FUNC_CDE  =   'MFSTDY'                    07470000
074800          AND F.LOC_ID            =  :DK-ORGN-LOC-NBR             07480000
074900          AND F.SYS_PRC_FUNC_CDE  =   'CTNOTH'                    07490000
075000          AND H.LOC_ID            =  :DK-ORGN-LOC-NBR             07500000
075100          AND H.SYS_PRC_FUNC_CDE  =   'CTNFLT'                    07510000
075110         WITH UR                                                  07511054
075200     END-EXEC.                                                    07520000
075300                                                                  07530000
075400     EVALUATE TRUE                                                07540000
075500         WHEN SQLCODE = ZERO                                      07550000
075600            MOVE SU045-ORGN-LOC-NBR    TO  PV-DISPLAY-ORGN-LOC-NBR07560000
075700            DISPLAY '** ORGN LOC ID ** = ' PV-DISPLAY-ORGN-LOC-NBR07570000
075800            DISPLAY '** FLT END TMST ** = ' PV-FLAT-BEG-TMST      07580000
075900            DISPLAY '** FLT BEG TMST ** = ' PV-FLAT-END-TMST      07590000
076000            DISPLAY '** OTH END TMST ** = ' PV-OTHER-BEG-TMST     07600000
076100            DISPLAY '** OTH BEG TMST ** = ' PV-OTHER-END-TMST     07610000
076200         WHEN OTHER                                               07620000
076300             MOVE '4100-GET-DATE-RANGE' TO PV-ABEND-PARAGRAPH     07630000
076400             MOVE 'GET DATE RANGE'      TO PV-ABEND-OPERATION     07640000
076500             MOVE 'TKRPRPM     '        TO PV-DB2-TABLE-NAME1     07650000
076600             PERFORM Z999-SQL-ABEND                               07660000
076700     END-EVALUATE.                                                07670000
076800                                                                  07680000
076900***************************************************************** 07690000
077000 4200-CHECK-DATE-RANGE.                                           07700000
077100***************************************************************** 07710000
077200     SET  PS-TOO-SOON-TO-REPORT-NO                                07720000
077300          PS-TOO-LATE-TO-REPORT-NO  TO  TRUE                      07730000
077400     MOVE SU045-CRE-DATE TO  PV-WORK-DATE.                        07740000
077500     MOVE SU045-CRE-TIME TO  PV-WORK-TIME.                        07750000
077600     MOVE '-'            TO  PV-WORK-DASH.                        07760000
077700     MOVE '.'            TO  PV-WORK-DOT.                         07770000
077800     MOVE ZEROES         TO  PV-WORK-MICRO.                       07780000
077900                                                                  07790000
078000     IF SU045-PRC-AREA-ID  = 'FLAT'                               07800000
078100         IF PV-WORK-TMST  <  PV-FLAT-BEG-TMST                     07810000
078200             SET  PS-TOO-SOON-TO-REPORT  TO  TRUE                 07820000
078300         ELSE                                                     07830000
078400             IF PV-WORK-TMST  >  PV-FLAT-END-TMST                 07840000
078500                 SET  PS-TOO-LATE-TO-REPORT  TO  TRUE             07850000
078600             END-IF                                               07860000
078700         END-IF                                                   07870000
078800     ELSE                                                         07880000
078900         IF PV-WORK-TMST  <  PV-OTHER-BEG-TMST                    07890000
079000             SET  PS-TOO-SOON-TO-REPORT  TO  TRUE                 07900000
079100         ELSE                                                     07910000
079200             IF PV-WORK-TMST  >  PV-OTHER-END-TMST                07920000
079300                 SET  PS-TOO-LATE-TO-REPORT  TO  TRUE             07930000
079400             END-IF                                               07940000
079500         END-IF                                                   07950000
079600     END-IF.                                                      07960000
079700                                                                  07970000
079800***************************************************************** 07980000
079900* ONCE IT HAS BEEN DETERMINED THAT THE PO/RCVR HAS A JEWELRY DEPT,07990000
080000* THE CARTONS FOR THAT PO/RCVR HAVE TO BE CHECKED TO SEE IF THEY  08000000
080100* WERE CREATED MORE THAN 10 DAYS AGO OR IF THEY ARE BEING SENT TO 08010000
080200* A NEW STORE THAT IS OPENING IN LESS THAN 21 DAYS.               08020000
080300***************************************************************** 08030000
080400 5000-CHECK-JWL-CRTNS.                                            08040000
080500                                                                  08050000
080600     MOVE SU045-ORGN-LOC-NBR  TO  DK-ORGN-LOC-NBR.                08060000
080700                                                                  08070000
080800     EXEC SQL                                                     08080000
080900         SELECT                                                   08090000
081000          (CURRENT TIMESTAMP - G.FUNC_QTY HOURS)                  08100000
081100        , (CURRENT TIMESTAMP - E.FUNC_QTY DAYS - G.FUNC_QTY HOURS)08110000
081200           INTO                                                   08120000
081300                 :PV-JWL-END-TMST                                 08130000
081400               , :PV-JWL-BEG-TMST                                 08140000
081500           FROM                                                   08150000
081600               TKRPRPM E                                          08160000
081700            ,  TKRPRPM G                                          08170000
081800          WHERE                                                   08180000
081900               E.LOC_ID            =  :DK-ORGN-LOC-NBR            08190000
082000           AND E.SYS_PRC_FUNC_CDE  =   'MFSTDY'                   08200000
082100           AND G.LOC_ID            =  :DK-ORGN-LOC-NBR            08210000
082200           AND G.SYS_PRC_FUNC_CDE  =   'CTNJWL'                   08220000
082210          WITH UR                                                 08221054
082300     END-EXEC.                                                    08230000
082400                                                                  08240000
082500     EVALUATE TRUE                                                08250000
082600         WHEN SQLCODE = ZERO                                      08260000
082700             PERFORM 5100-CHECK-JWL-DATES                         08270000
082800         WHEN OTHER                                               08280000
082900             MOVE '5000-CHECK-JWL-CRTNS' TO PV-ABEND-PARAGRAPH    08290000
083000             MOVE 'GET DATE RANGE'       TO PV-ABEND-OPERATION    08300000
083100             MOVE 'TKRPRPM     '         TO PV-DB2-TABLE-NAME1    08310000
083200             MOVE SUT00028-TRN-NBR       TO   PV-DISPLAY-TRN-NBR  08320000
083300             MOVE SUT00028-RCVR-SEQ-NBR TO PV-DISPLAY-RCVR-SEQ-NBR08330000
083400             PERFORM Z999-SQL-ABEND                               08340000
083500     END-EVALUATE.                                                08350000
083600                                                                  08360000
083700***************************************************************** 08370000
083800 5100-CHECK-JWL-DATES.                                            08380000
083900                                                                  08390000
084000     SET  PS-TOO-SOON-TO-REPORT-NO                                08400000
084100          PS-TOO-LATE-TO-REPORT-NO  TO  TRUE                      08410000
084200     MOVE SU045-CRE-DATE TO  PV-WORK-DATE.                        08420000
084300     MOVE SU045-CRE-TIME TO  PV-WORK-TIME.                        08430000
084400     MOVE '-'            TO  PV-WORK-DASH.                        08440000
084500     MOVE '.'            TO  PV-WORK-DOT.                         08450000
084600     MOVE ZEROES         TO  PV-WORK-MICRO.                       08460000
084700                                                                  08470000
084800     IF PV-WORK-TMST  <  PV-JWL-BEG-TMST                          08480000
084900         SET  PS-TOO-LATE-TO-REPORT  TO  TRUE                     08490000
085000     ELSE                                                         08500000
085100         IF PV-WORK-TMST  >  PV-JWL-END-TMST                      08510000
085200             SET  PS-TOO-SOON-TO-REPORT  TO  TRUE                 08520000
085300         ELSE                                                     08530000
085400             PERFORM 5200-CHECK-JWL-NEW-STR                       08540000
085500         END-IF                                                   08550000
085600     END-IF.                                                      08560000
085700                                                                  08570000
085800***************************************************************** 08580000
085900* CHECK IF FOR A NEW STORE, DETERMINE IF THE CURRENT DATE IS    * 08590000
086000* WITHIN 21 DAYS OF THE STORE OPENING.                          * 08600000
086100***************************************************************** 08610000
086200 5200-CHECK-JWL-NEW-STR.                                          08620000
086300     MOVE SU045-DEST-LOC-NBR  TO  DK-DEST-LOC-NBR.                08630000
086400                                                                  08640000
086500     EXEC SQL                                                     08650000
086600          SELECT  (A.OPN_DTE - B.FUNC_QTY DAYS)                   08660000
086700                , CURRENT_DATE                                    08670000
086800            INTO  :PV-OPEN-DATE                                   08680000
086900                , :PV-CURRENT-DATE                                08690000
087000            FROM  XLT_LOC A                                       08700000
087100               ,  TKRPRPM B                                       08710000
087200           WHERE  A.LOC_NBR          = :DK-DEST-LOC-NBR           08720000
087300             AND  B.LOC_ID           = 90                         08730000
087400             AND  B.INTFC_SYS_CDE    = 'KHL'                      08740000
087500             AND  B.SYS_PRC_FUNC_CDE = 'JWLNEW'                   08750000
087510            WITH UR                                               08751054
087600     END-EXEC.                                                    08760000
087700                                                                  08770000
087800     EVALUATE TRUE                                                08780000
087900         WHEN SQLCODE = ZERO                                      08790000
088000         WHEN SQLCODE = -811                                      08800000
088100              IF PV-CURRENT-DATE < PV-OPEN-DATE                   08810000
088200                  SET PS-TOO-SOON-TO-REPORT   TO TRUE             08820000
088300              END-IF                                              08830000
088400         WHEN SQLCODE = +100                                      08840000
088500              CONTINUE                                            08850000
088600         WHEN OTHER                                               08860000
088700             MOVE '5200-CHECK-JWL-NEW-STR'   TO PV-ABEND-PARAGRAPH08870000
088800             MOVE 'CHECK IF STORE IS NEW'  TO PV-ABEND-OPERATION  08880000
088900             MOVE 'XLT_LOC    '            TO PV-DB2-TABLE-NAME1  08890000
089000             PERFORM Z999-SQL-ABEND                               08900000
089100     END-EVALUATE.                                                08910000
089200                                                                  08920000
089300***************************************************************** 08930000
089400 7000-READ-INPUT-FILE.                                            08940000
089500***************************************************************** 08950000
089600      READ INPUT-FILE INTO SU045-EXTRACT-RECORD                   08960000
089700        AT END                                                    08970000
089800           SET PS-END-OF-INPUT-FILE TO TRUE                       08980000
089900        NOT AT END                                                08990000
090000           ADD +1 TO PV-READ-COUNT                                09000000
090100      END-READ.                                                   09010000
090200                                                                  09020000
090300***************************************************************** 09030000
090400 7010-OPEN-ZERO-LEVEL-WO-CSR.                                     09040000
090500***************************************************************** 09050000
090600     INITIALIZE PV-ZERO-LEVEL-PROC-AREA                           09060000
090700                PV-ZERO-LEVEL-LINE-LOC                            09070000
090800                PV-LINE-LEVEL-PROC-AREA                           09080000
090900                PV-LINE-LEVEL-LINE-LOC                            09090000
091000                                                                  09100000
091100     SET PS-END-ZERO-LEVEL-WO-CSR-NO                              09110000
091200         PS-CURRENT-LINE-HAS-WO-NO TO TRUE                        09120000
091300                                                                  09130000
091400     MOVE SU045-TRN-NBR      TO DK-TRN-NBR                        09140000
091500     MOVE SU045-RCVR-SEQ-NBR TO DK-RCVR-SEQ-NBR                   09150000
091600     MOVE SU045-ORGN-LOC-NBR TO DK-ORGN-LOC-NBR                   09160000
091700                                                                  09170000
091800     EXEC SQL                                                     09180000
091900         OPEN ZERO-LEVEL-WO-CSR                                   09190000
092000     END-EXEC.                                                    09200000
092100                                                                  09210000
092200     EVALUATE TRUE                                                09220000
092300         WHEN SQLCODE = +0                                        09230000
092400             CONTINUE                                             09240000
092500         WHEN SQLWARN0 NOT = SPACE                                09250000
092600         WHEN SQLCODE  NOT = +0                                   09260000
092700              MOVE DK-TRN-NBR      TO PV-DISPLAY-TRN-NBR          09270000
092800              MOVE DK-RCVR-SEQ-NBR TO PV-DISPLAY-RCVR-SEQ-NBR     09280000
092900              MOVE DK-ORGN-LOC-NBR TO PV-DISPLAY-ORGN-LOC-NBR     09290000
093000                                                                  09300000
093100              MOVE '7010-OPEN-ZERO-LEVEL-WO-CSR'                  09310000
093200                                   TO PV-ABEND-PARAGRAPH          09320000
093300              MOVE 'OPEN CURSOR '  TO PV-ABEND-OPERATION          09330000
093400              MOVE 'TWKORIN '      TO PV-DB2-TABLE-NAME1          09340000
093500                                                                  09350000
093600             PERFORM Z999-SQL-ABEND                               09360000
093700     END-EVALUATE.                                                09370000
093800                                                                  09380000
093900                                                                  09390000
094000***************************************************************** 09400000
094100* FETCH ZERO LEVEL WORK ORDER INFORMATION FOR PO-RCVR             09410000
094200 7020-FETCH-ZERO-LEVEL-WO-CSR.                                    09420000
094300***************************************************************** 09430000
094400                                                                  09440000
094500     EXEC SQL                                                     09450000
094600          FETCH ZERO-LEVEL-WO-CSR                                 09460000
094700           INTO  :WKORIN-STOP-TMST                                09470000
094800               , :WKORIN-PRC-FCLTY-AREA-ID                        09480000
094900               , :WKORIN-LNE-LOC-CDE                              09490000
095000               , :WKORIN-SCREEN-SEQ-NBR                           09500000
095100     END-EXEC.                                                    09510000
095200                                                                  09520000
095300     EVALUATE TRUE                                                09530000
095400         WHEN SQLCODE = +0                                        09540000
095500              IF WKORIN-STOP-TMST = PC-DEFAULT-TMST               09550000
095600                 MOVE WKORIN-PRC-FCLTY-AREA-ID TO                 09560000
095700                      PV-ZERO-LEVEL-PROC-AREA                     09570000
095800                 MOVE WKORIN-LNE-LOC-CDE TO                       09580000
095900                      PV-ZERO-LEVEL-LINE-LOC                      09590000
096000                 SET PS-END-ZERO-LEVEL-WO-CSR-YES TO TRUE         09600000
096100              ELSE                                                09610000
096200                 MOVE WKORIN-PRC-FCLTY-AREA-ID TO                 09620000
096300                      PV-ZERO-LEVEL-PROC-AREA                     09630000
096400                 MOVE WKORIN-LNE-LOC-CDE TO                       09640000
096500                      PV-ZERO-LEVEL-LINE-LOC                      09650000
096600              END-IF                                              09660000
096700         WHEN SQLCODE = +100                                      09670000
096800              SET PS-END-ZERO-LEVEL-WO-CSR-YES TO TRUE            09680000
096900         WHEN SQLWARN0 NOT = SPACE                                09690000
097000         WHEN SQLCODE  NOT = +0                                   09700000
097100              MOVE '7020-FETCH-ZERO-LEVEL-WO-CSR'                 09710000
097200                                   TO PV-ABEND-PARAGRAPH          09720000
097300              MOVE 'ATTEMPTING TO FETCH ZERO-LEVEL CURSOR'        09730000
097400                                   TO PV-ABEND-OPERATION          09740000
097500                                                                  09750000
097600              MOVE DK-TRN-NBR         TO                          09760000
097700                                PV-DISPLAY-TRN-NBR                09770000
097800                                                                  09780000
097900              MOVE DK-RCVR-SEQ-NBR    TO                          09790000
098000                                PV-DISPLAY-RCVR-SEQ-NBR           09800000
098100                                                                  09810000
098200              MOVE DK-ORGN-LOC-NBR    TO                          09820000
098300                                PV-DISPLAY-ORGN-LOC-NBR           09830000
098400                                                                  09840000
098500              PERFORM Z999-SQL-ABEND                              09850000
098600     END-EVALUATE.                                                09860000
098700                                                                  09870000
098800                                                                  09880000
098900***************************************************************** 09890000
099000 7030-CLOSE-ZERO-LEVEL-WO-CSR.                                    09900000
099100***************************************************************** 09910000
099200     EXEC SQL                                                     09920000
099300         CLOSE ZERO-LEVEL-WO-CSR                                  09930000
099400     END-EXEC                                                     09940000
099500                                                                  09950000
099600     EVALUATE TRUE                                                09960000
099700         WHEN SQLCODE = ZERO                                      09970000
099800             CONTINUE                                             09980000
099900         WHEN OTHER                                               09990000
100000             MOVE '7030-CLOSE-ZERO-LEVEL-CURSOR'                  10000000
100100                                 TO PV-ABEND-PARAGRAPH            10010000
100200             MOVE 'CLOSE CURSOR '                                 10020000
100300                                 TO PV-ABEND-OPERATION            10030000
100400             MOVE 'TWKORIN '                                      10040000
100500                                 TO PV-DB2-TABLE-NAME1            10050000
100600             PERFORM Z999-SQL-ABEND                               10060000
100700     END-EVALUATE.                                                10070000
100800                                                                  10080000
100900***************************************************************** 10090000
101000 7040-OPEN-LINE-LEVEL-WO-CSR.                                     10100000
101100***************************************************************** 10110000
101200     INITIALIZE PV-LINE-LEVEL-PROC-AREA                           10120000
101300                PV-LINE-LEVEL-LINE-LOC                            10130000
101400                                                                  10140000
101500     SET PS-END-LINE-LEVEL-WO-CSR-NO                              10150000
101600         PS-CURRENT-LINE-HAS-WO-NO                                10160000
101700         PS-FIRST-TIME-CURRENT-LINE-YES TO TRUE                   10170000
101800                                                                  10180000
101900     MOVE SU045-TRN-LNE-NBR  TO PV-PREVIOUS-LINE                  10190000
102000                                                                  10200000
102100     MOVE SU045-TRN-NBR      TO DK-TRN-NBR                        10210000
102200     MOVE SU045-RCVR-SEQ-NBR TO DK-RCVR-SEQ-NBR                   10220000
102300     MOVE SU045-TRN-LNE-NBR  TO DK-TRN-LNE-NBR                    10230000
102400     MOVE SU045-ORGN-LOC-NBR TO DK-ORGN-LOC-NBR                   10240000
102500                                                                  10250000
102600     EXEC SQL                                                     10260000
102700         OPEN LINE-LEVEL-WO-CSR                                   10270000
102800     END-EXEC.                                                    10280000
102900                                                                  10290000
103000     EVALUATE TRUE                                                10300000
103100         WHEN SQLCODE = +0                                        10310000
103200             CONTINUE                                             10320000
103300         WHEN SQLWARN0 NOT = SPACE                                10330000
103400         WHEN SQLCODE  NOT = +0                                   10340000
103500             MOVE '7040-OPEN-LINE-LEVEL-WO-CSR'                   10350000
103600                                 TO PV-ABEND-PARAGRAPH            10360000
103700             MOVE 'OPEN CURSOR '                                  10370000
103800                                 TO PV-ABEND-OPERATION            10380000
103900             MOVE 'TWKORIN '                                      10390000
104000                                 TO PV-DB2-TABLE-NAME1            10400000
104100             PERFORM Z999-SQL-ABEND                               10410000
104200     END-EVALUATE.                                                10420000
104300                                                                  10430000
104400                                                                  10440000
104500***************************************************************** 10450000
104600* FETCH LINE LEVEL WORK ORDER INFORMATION FOR PO-RCVR-LINE        10460000
104700 7050-FETCH-LINE-LEVEL-WO-CSR.                                    10470000
104800***************************************************************** 10480000
104900                                                                  10490000
105000     EXEC SQL                                                     10500000
105100          FETCH LINE-LEVEL-WO-CSR                                 10510000
105200           INTO  :WKORIN-STOP-TMST                                10520000
105300               , :WKORIN-PRC-FCLTY-AREA-ID                        10530000
105400               , :WKORIN-LNE-LOC-CDE                              10540000
105500               , :WKORIN-SCREEN-SEQ-NBR                           10550000
105600     END-EXEC.                                                    10560000
105700                                                                  10570000
105800     EVALUATE TRUE                                                10580000
105900         WHEN SQLCODE = +0                                        10590000
106000              SET PS-FIRST-TIME-CURRENT-LINE-NO TO TRUE           10600000
106100              IF WKORIN-STOP-TMST = PC-DEFAULT-TMST               10610000
106200                 MOVE WKORIN-PRC-FCLTY-AREA-ID TO                 10620000
106300                      PV-LINE-LEVEL-PROC-AREA                     10630000
106400                 MOVE WKORIN-LNE-LOC-CDE TO                       10640000
106500                      PV-LINE-LEVEL-LINE-LOC                      10650000
106600                 SET PS-END-LINE-LEVEL-WO-CSR-YES   TO TRUE       10660000
106700                 SET PS-CURRENT-LINE-HAS-WO-YES TO TRUE           10670000
106800              ELSE                                                10680000
106900                 MOVE WKORIN-PRC-FCLTY-AREA-ID TO                 10690000
107000                      PV-LINE-LEVEL-PROC-AREA                     10700000
107100                 MOVE WKORIN-LNE-LOC-CDE TO                       10710000
107200                      PV-LINE-LEVEL-LINE-LOC                      10720000
107300                 SET PS-CURRENT-LINE-HAS-WO-YES TO TRUE           10730000
107400              END-IF                                              10740000
107500         WHEN SQLCODE = +100                                      10750000
107600              IF PS-FIRST-TIME-CURRENT-LINE-YES                   10760000
107700                 SET PS-CURRENT-LINE-HAS-WO-NO TO TRUE            10770000
107800              END-IF                                              10780000
107900              SET PS-END-LINE-LEVEL-WO-CSR-YES TO TRUE            10790000
108000         WHEN SQLWARN0 NOT = SPACE                                10800000
108100         WHEN SQLCODE  NOT = +0                                   10810000
108200              MOVE '7050-FETCH-LINE-LEVEL-WO-CSR'                 10820000
108300                                   TO PV-ABEND-PARAGRAPH          10830000
108400              MOVE 'ATTEMPTING TO FETCH LINE-LEVEL CURSOR'        10840000
108500                                   TO PV-ABEND-OPERATION          10850000
108600              MOVE DK-TRN-NBR         TO                          10860000
108700                                PV-DISPLAY-TRN-NBR                10870000
108800              MOVE DK-RCVR-SEQ-NBR    TO                          10880000
108900                                PV-DISPLAY-RCVR-SEQ-NBR           10890000
109000              MOVE DK-TRN-LNE-NBR     TO                          10900000
109100                                PV-DISPLAY-TRN-LNE-NBR            10910000
109200              MOVE DK-ORGN-LOC-NBR    TO                          10920000
109300                                PV-DISPLAY-ORGN-LOC-NBR           10930000
109400              PERFORM Z999-SQL-ABEND                              10940000
109500     END-EVALUATE.                                                10950000
109600                                                                  10960000
109700                                                                  10970000
109800***************************************************************** 10980000
109900 7060-CLOSE-LINE-LEVEL-WO-CSR.                                    10990000
110000***************************************************************** 11000000
110100     EXEC SQL                                                     11010000
110200         CLOSE LINE-LEVEL-WO-CSR                                  11020000
110300     END-EXEC                                                     11030000
110400                                                                  11040000
110500                                                                  11050000
110600     EVALUATE TRUE                                                11060000
110700         WHEN SQLCODE = ZERO                                      11070000
110800             CONTINUE                                             11080000
110900         WHEN OTHER                                               11090000
111000             MOVE '7060-CLOSE-LINE-LEVEL-CURSOR'                  11100000
111100                                 TO PV-ABEND-PARAGRAPH            11110000
111200             MOVE 'CLOSE CURSOR '                                 11120000
111300                                 TO PV-ABEND-OPERATION            11130000
111400             MOVE 'TWKORIN '                                      11140000
111500                                 TO PV-DB2-TABLE-NAME1            11150000
111600             PERFORM Z999-SQL-ABEND                               11160000
111700     END-EVALUATE.                                                11170000
111800                                                                  11180000
111900                                                                  11190000
112000                                                                  11200000
112100***************************************************************** 11210000
112200 8000-WRITE-EXTRACT.                                              11220000
112300***************************************************************** 11230000
112400     WRITE EXTRACT-RECORD                                         11240000
112500       FROM SU045-EXTRACT-RECORD.                                 11250000
112600                                                                  11260000
112700     ADD +1 TO PV-WRITE-EXTR-COUNT.                               11270000
112800                                                                  11280000
112900***************************************************************** 11290000
113000 9000-CLOSE-FILES.                                                11300000
113100                                                                  11310000
113200     MOVE PV-READ-COUNT              TO PV-DISPLAY-READ-CNT.      11320000
113300     DISPLAY 'TOT RECS READ       : '   PV-DISPLAY-READ-CNT.      11330000
113400                                                                  11340000
113500     MOVE PV-WRITE-EXTR-COUNT        TO PV-DISPLAY-WRITE-CNT.     11350000
113600     DISPLAY 'TOT RECS WRITTEN    : '   PV-DISPLAY-WRITE-CNT.     11360000
113700                                                                  11370000
113800*DISPLAY READ TOTAL SHOULD EQUAL WRITE TOTAL                      11380000
113900     CLOSE INPUT-FILE                                             11390000
114000           EXTRACT-FILE.                                          11400000
114100                                                                  11410000
114200                                                                  11420000
114300***************************************************************** 11430000
114400 Z999-SQL-ABEND.                                                  11440000
114500***************************************************************** 11450000
114600     MOVE SQLCODE                     TO PV-DISPLAY-SQLCODE.      11460000
114700                                                                  11470000
114800     DISPLAY '** ABEND **         ** = SQLERROR'.                 11480000
114900     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                11490000
115000     DISPLAY '** TRN NBR      ** = ' PV-DISPLAY-TRN-NBR.          11500000
115100     DISPLAY '** RCVR SEQ NBR ** = ' PV-DISPLAY-RCVR-SEQ-NBR.     11510000
115200     DISPLAY '** TRN LNE NBR  ** = ' PV-DISPLAY-TRN-LNE-NBR.      11520000
115300                                                                  11530000
115400                                                                  11540000
115500     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             11550000
115600     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                11560000
115700     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME1.             11570000
115800     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME2.             11580000
115900     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME3.             11590011
116000     DISPLAY '** SQLCODE   ** = ' PV-DISPLAY-SQLCODE.             11600000
116100                                                                  11610000
116200     MOVE +4013                  TO PV-ABEND-CODE.                11620000
116300     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         11630000
