00001 *************************                                         02/05/92
00002  IDENTIFICATION DIVISION.                                         MBKCS103
00003 *************************                                            LV041
00004  PROGRAM-ID.    MBKCS103.                                            CL**2
00005  AUTHOR.        MIKE FURLICK.                                        CL**2
00006  INSTALLATION.  KOHLS DEPARTMENT STORES.                             CL**2
00007  DATE-WRITTEN.  9-16-91.                                             CL**2
00008  DATE-COMPILED.                                                      CL**2
00009                                                                      CL**2
00010 *****************************************************************    CL**2
00011 *    R103 - MERCHANDISE AREA INQUIRY                                 CL**2
00012 *                                                                    CL**2
00013 *    THIS PROGRAM GENERATES A LIST OF MERCHANDISE AREA INFORMATION   CL**2
00014 *    BASED UPON KEY VALUES SUPPLIED BY MBKCS102 (MERCHANDISE AREA    CL**2
00015 *    LIST).  THE OPERATOR MAY "PAGE" FORWARD TO THE NEXT SELECTED    CL**2
00016 *    KEY DATA BY PRESSING PF20.  THE MERCHANDISE AREA RESPONSIBLE    CL*21
00017 *    INQUIRY, DEPARTMENT INQUIRY, AND SUB-CLASS INQUIRY MAY ALSO     CL**2
00018 *    BE INVOKED FROM HERE.                                           CL**2
00019 *                                                                    CL**2
00020 *****************************************************************    CL**2
00021                                                                      CL**2
00022 *                                                                    CL**2
00023 *                                                                    CL**2
00024 *                                                                    CL**2
00025  ENVIRONMENT DIVISION.                                               CL**2
00026 *                                                                    CL**2
00027 *                                                                    CL**2
00028 *                                                                    CL**2
00029  DATA DIVISION.                                                      CL**2
00030 *                                                                    CL**2
00031 *                                                                    CL**2
00032  WORKING-STORAGE SECTION.                                            CL**2
00033 *                                                                    CL**2
00034  01  PC-PROGRAM-CONSTANTS.                                           CL**2
00035      05  PC-NAVIGATOR-TRAN-ID           PIC X(04)    VALUE 'Z008'.   CL**2
00036      05  PC-MAXIMUM-COMMAREA-LENGTH     PIC S9(04)   VALUE +4072     CL**2
00037                                                      COMP SYNC.      CL**2
00038      05  PC-CURRENT-MAP-NAME            PIC X(08)    VALUE           CL**2
00039      'MB103A  '.                                                     CL**2
00040      05  PC-CURRENT-MAPSET-NAME         PIC X(08)    VALUE           CL**2
00041      'MBKM103 '.                                                     CL**2
00042      05  PC-CURRENT-PROGRAM-NAME        PIC X(08)    VALUE           CL**2
00043      'MBKCS103'.                                                     CL**2
00044      05  PC-BLOCK-LENGTH                PIC S9(04)   VALUE +1314     CL**2
00045                                                      COMP SYNC.      CL**2
00046      05  PC-FIELD-LENGTH                PIC S9(04)   VALUE +5        CL**2
00047                                                      COMP SYNC.      CL**2
00048      05  PC-ERASE-EOF-COMP              PIC S9(04)   VALUE +128      CL**2
00049                                                      COMP SYNC.      CL**2
00050      05  FILLER REDEFINES PC-ERASE-EOF-COMP.                         CL**2
00051          10  FILLER                     PIC X(01).                   CL**2
00052          10  PC-ERASE-EOF               PIC X(01).                   CL**2
00053      05  PC-ZERO                        PIC X(3)     VALUE '000'.    CL**7
00054      05  PC-GMA                         PIC X(3)     VALUE 'GMA'.    CL**7
00055      05  PC-DMA                         PIC X(3)     VALUE 'DMA'.    CL**7
00056      05  PC-DPT                         PIC X(3)     VALUE 'DPT'.    CL**7
00057      05  PC-MCL                         PIC X(3)     VALUE 'MCL'.    CL**7
00058      05  PC-SCL                         PIC X(3)     VALUE 'SCL'.    CL**7
00059      05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3         CL**2
00060                                                      COMP-3.         CL**2
00061      05  PC-NO-DISPLAY-DATE             PIC X(10)    VALUE           CL*29
00062                                                      '9999-09-09'.   CL*29
00063      05  PC-MBISUBCL                    PIC X(8)     VALUE           CL**2
00064                                                      'MBISUBCL'.     CL**2
00065  01  PC-COMPANY                         PIC XX       VALUE '03'.     CL**2
00066 *                                                                    CL**2
00067  01  PC-TSYMSG-NUMBERS.                                              CL**2
00068      05  PC-TSYMSG-00005                PIC 9(5)    VALUE 00005.     CL**2
00069      05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.     CL**2
00070      05  PC-TSYMSG-00045                PIC 9(5)    VALUE 00045.     CL**3
00071      05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.     CL**3
00072      05  PC-TSYMSG-00051                PIC 9(5)    VALUE 00051.     CL**2
00073      05  PC-TSYMSG-00052                PIC 9(5)    VALUE 00052.     CL**2
00074      05  PC-TSYMSG-00053                PIC 9(5)    VALUE 00053.     CL**2
00075      05  PC-TSYMSG-00054                PIC 9(5)    VALUE 00054.     CL**2
00076      05  PC-TSYMSG-00055                PIC 9(5)    VALUE 00055.     CL**2
00077      05  PC-TSYMSG-00057                PIC 9(5)    VALUE 00057.     CL**2
00078      05  PC-TSYMSG-00061                PIC 9(5)    VALUE 00061.     CL**2
00079      05  PC-TSYMSG-00062                PIC 9(5)    VALUE 00062.     CL**2
00080      05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.     CL**2
00081      05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.     CL**2
00082      05  PC-TSYMSG-00176                PIC 9(5)    VALUE 00176.     CL*26
00083      05  PC-TSYMSG-99901                PIC 9(5)    VALUE 99901.     CL*32
00084 *                                                                    CL**2
00085  01  PM-PROGRAM-MESSAGES.                                            CL**2
00086      05  PM-PROGRAM-MESSAGE-12          PIC X(78)    VALUE           CL**2
00087      'INVALID NEXT APPLICATION ACTIVITY RECEIVED'.                   CL**2
00088      05  PM-PROGRAM-MESSAGE-22          PIC X(78)    VALUE           CL**2
00089      'LOGIC ERROR IN TRYING TO READ MD LIST QUEUE - RESP = '.        CL**2
00090      05  FILLER REDEFINES PM-PROGRAM-MESSAGE-22.                     CL**2
00091          10  FILLER                     PIC X(61).                   CL**2
00092          10  PM-RESP-22                 PIC 9999.                    CL**2
00093          10  FILLER                     PIC X(12).                   CL**2
00094 *                                                                    CL**2
00095  01  PS-PROGRAM-SUBSCRIPTS.                                          CL**2
00096      05  PS-SUB                         PIC S9(04)   VALUE +0        CL**2
00097                                                      COMP SYNC.      CL**2
00098      05  PS-MA-SUB1                     PIC S9(04)   VALUE +0        CL**2
00099                                                      COMP SYNC.      CL**2
00100      05  PS-MA-SUB2                     PIC S9(04)   VALUE +0        CL**2
00101                                                      COMP SYNC.      CL**2
00102      05  PS-ITEM-SUB                    PIC S9(09)   VALUE +0        CL**2
00103                                                      COMP-3.         CL**2
00104                                                                      CL**2
00105  01  PS-PROGRAM-SWITCHES.                                            CL**2
00106      05  PS-MAP-SEND-TYPE               PIC X(01)    VALUE '1'.      CL**2
00107          88  PS-SEND-MAP-N-DATA-FRSET                VALUE '1'.      CL**2
00108          88  PS-SEND-MAP-N-DATA-FRSET-CPOSN          VALUE '2'.      CL**2
00109          88  PS-SEND-DATA-ONLY-FRSET                 VALUE '3'.      CL**2
00110          88  PS-SEND-DATA-ONLY                       VALUE '4'.      CL**2
00111          88  PS-SEND-DATA-ONLY-ERASEAUP              VALUE '5'.      CL**2
00112          88  PS-SEND-MAP-ONLY-FRSET                  VALUE '6'.      CL**2
00113      05  PS-ERROR-SW                    PIC X(01)    VALUE 'N'.      CL**2
00114          88  PS-ERROR                                VALUE 'Y'.      CL**2
00115          88  PS-NO-ERROR                             VALUE 'N'.      CL**2
00116      05  PS-INTER-APPL-VALID-SW         PIC X(01)    VALUE 'N'.      CL**2
00117          88  PS-INTER-APPL-VALID                     VALUE 'Y'.      CL**2
00118          88  PS-INTER-APPL-NOT-VALID                 VALUE 'N'.      CL**2
00119      05  PS-PROCESSING-SW               PIC X(01)    VALUE 'N'.      CL**2
00120          88  PS-CONTINUE                             VALUE 'Y'.      CL*23
00121          88  PS-DONT-PROCESS                         VALUE 'N'.      CL*23
00122      05  PS-COMAREA-SW                  PIC X(01)    VALUE 'N'.      CL*32
00123          88  PS-COMMAREA-VALID                       VALUE 'Y'.      CL*32
00124          88  PS-COMMAREA-NOT-VALID                   VALUE 'N'.      CL*32
00125      EJECT                                                           CL**2
00126  01  PV-PROGRAM-VARIABLES.                                           CL**2
00127      05  PV-CICS-RESPONSE               PIC S9(04)   VALUE +0        CL**2
00128                                                      COMP SYNC.      CL**2
00129      05  PV-RESP                        PIC S9(04)   VALUE +0        CL**2
00130                                                      COMP SYNC.      CL**2
00131      05  PV-ITEM                        PIC S9(04)   VALUE +0        CL**2
00132                                                      COMP SYNC.      CL**2
00133      05  PV-MA-ITEM                     PIC S9(04)   VALUE +0        CL**2
00134                                                      COMP SYNC.      CL**2
00135      05  PV-MESSAGE                     PIC X(78)    VALUE SPACES.   CL**2
00136      05  PV-SQL-SUB                     PIC S9(4)    COMP.           CL**2
00137      05  PV-RETRY-COUNTER               PIC S9(3)    COMP-3.         CL**2
00138      05  PV-WORK-DATE.                                               CL**2
00139          10  PV-WD-MM                   PIC XX.                      CL**2
00140          10  FILLER                     PIC X        VALUE '/'.      CL**2
00141          10  PV-WD-DD                   PIC XX.                      CL**2
00142          10  FILLER                     PIC X        VALUE '/'.      CL**2
00143          10  PV-WD-YY                   PIC XX.                      CL**2
00144 *                                                                    CL**2
00145  01  PV-DB2-DATE.                                                    CL**2
00146      05  FILLER                         PIC XX.                      CL**2
00147      05  PV-DD-YY                       PIC XX.                      CL**2
00148      05  FILLER                         PIC X.                       CL**2
00149      05  PV-DD-MM                       PIC XX.                      CL**2
00150      05  FILLER                         PIC X.                       CL**2
00151      05  PV-DD-DD                       PIC XX.                      CL**2
00152  EJECT                                                               CL**2
00153 *****************************************************************    CL**2
00154 *    STANDARD COMMAREA.                                              CL**2
00155 *****************************************************************    CL**2
00156                                                                      CL**2
00157      COPY DPWS020.                                                   CL*40
00158      05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                   CL**2
00159                                                                      CL**2
00160 *****************************************************************    CL**2
00161 *    INTER-APPLICATION COMMAREA.                                     CL**2
00162 *****************************************************************    CL**2
00163                                                                      CL**2
00164          10  INTER-APPL-COMM-AREA       PIC X(200).                  CL**2
00165      COPY MBWS005.                                                   CL*41
00166 *****************************************************************    CL**2
00167 *    SPECIFIC COMMMAREA FOR MBKCS103.                                CL**2
00168 *****************************************************************    CL**2
00169          10  MB103-SPECIFIC-COMMAREA.                                CL**2
00170              15  MB103-APPL-CURSOR-POSITION          PIC S9(04)      CL**2
00171                                                      COMP.           CL**2
00172              15  MB103-MA-SUB                        PIC S9(4)       CL**2
00173                                                          COMP.       CL**2
00174              15  MB103-MA-ITEM                       PIC S9(4)       CL**2
00175                                                          COMP.       CL**2
00176              15  MB103-LAST-KEY-DATA.                                CL**2
00177                  20  MB103-LAST-GMA-NBR              PIC X(02).      CL**2
00178                  20  MB103-LAST-DMA-NBR              PIC X(02).      CL**2
00179                  20  MB103-LAST-DEPT-NBR             PIC X(03).      CL**2
00180                  20  MB103-LAST-MCLASS-NBR           PIC X(02).      CL**2
00181                  20  MB103-LAST-SCLASS-NBR           PIC X(03).      CL**2
00182                  20  MB103-LAST-MDSELV-NBR           PIC X(03).      CL**2
00183              15  MB103-GMA-DESC                      PIC X(25).      CL*28
00184              15  MB103-DMA-DESC                      PIC X(25).      CL*28
00185              15  MB103-DEPT-DESC                     PIC X(25).      CL*28
00186              15  MB103-MCLASS-DESC                   PIC X(25).      CL*28
00187              15  MB103-SCLASS-DESC                   PIC X(25).      CL*28
00188              15  MB103-STRT-DATE                     PIC X(8).       CL**2
00189              15  MB103-END-DATE                      PIC X(8).       CL**2
00190              15  MB103-GEN-MDSE-TYPE-CDE             PIC X.          CL**2
00191              15  MB103-BYR-NBR                       PIC X(3).       CL**2
00192              15  MB103-CHG-DATE                      PIC X(8).       CL**2
00193              15  MB103-CRE-DATE                      PIC X(8).       CL**2
00194              15  MB103-DISPLAY-ATTRIBUTES.                           CL*18
00195                  20  MB103-LAST-DMA-ATTR             PIC X.          CL*18
00196                  20  MB103-LAST-DEPT-ATTR            PIC X.          CL*18
00197                  20  MB103-LAST-MCLASS-ATTR          PIC X.          CL*18
00198                  20  MB103-LAST-SCLASS-ATTR          PIC X.          CL*18
00199                  20  MB103-LAST-DMA-ATTR-HEAD        PIC X.          CL*39
00200                  20  MB103-LAST-DEPT-ATTR-HEAD       PIC X.          CL*39
00201                  20  MB103-LAST-MCLASS-ATTR-HEAD     PIC X.          CL*39
00202                  20  MB103-LAST-SCLASS-ATTR-HEAD     PIC X.          CL*39
00203              15  MB103-TEMP-QUEUE-NAME.                              CL**2
00204                  20  MB103-TERM-ID                   PIC X(4).       CL**2
00205                  20  MB103-TASK-NUMBER               PIC S9(7)       CL**2
00206                                                          COMP-3.     CL**2
00207              15  MB103-LIST-SWITCH                   PIC X.          CL**2
00208                  88  MB103-IS-A-LIST                 VALUE 'Y'.      CL*23
00209                  88  MB103-IS-NO-LIST                VALUE 'N'.      CL*23
00210              15  MB103-DEPT-SW                       PIC X.          CL*12
00211                  88  MB103-IS-A-DEPT                 VALUE 'Y'.      CL*23
00212                  88  MB103-IS-NO-DEPT                VALUE 'N'.      CL*23
00213              15  MB103-MAJ-CLASS-SW                  PIC X.          CL*35
00214                  88  MB103-IS-A-MAJCL                VALUE 'Y'.      CL*35
00215                  88  MB103-IS-NO-MAJCL               VALUE 'N'.      CL*35
00216              15  MB103-SUB-CLASS-SW                  PIC X.          CL*35
00217                  88  MB103-IS-A-SUBCL                VALUE 'Y'.      CL*35
00218                  88  MB103-IS-NO-SUBCL               VALUE 'N'.      CL*35
00219              15  MB103-SAVE-INTER-APPL-COMMAREA      PIC X(200).     CL**2
00220              15  MB103-SAVE-LIST-QUEUE               PIC X(2100).    CL**5
00221 *                                                                    CL**2
00222      EJECT                                                           CL**2
00223 *****************************************************************    CL**2
00224 *    MERCHANDISE AREA LIST RECORD LAYOUT.                            CL**2
00225 *****************************************************************    CL**2
00226  01 MA-LIST-RECORD.                                                  CL**2
00227      COPY MBWS003.                                                   CL*41
00228                                                                      CL**2
00229 *                                                                    CL**2
00230      EJECT                                                           CL**2
00231 *****************************************************************    CL**2
00232 *    ABEND PROCESSING COPYBOOK.                                      CL**2
00233 *****************************************************************    CL**2
00234                                                                      CL**2
00235      COPY DPWS013.                                                   CL**2
00236                                                                      CL**2
00237      EJECT                                                           CL**2
00238 *****************************************************************    CL**2
00239 *    ATTRIBUTE SETTINGS COPYBOOK.                                    CL**2
00240 *****************************************************************    CL**2
00241                                                                      CL**2
00242      COPY DPWS015.                                                   CL**2
00243                                                                      CL**2
00244 *****************************************************************    CL**2
00245 *    CURRENT DATE AND TIME COPYBOOK.                                 CL**2
00246 *****************************************************************    CL**2
00247                                                                      CL**2
00248      COPY DPWS017.                                                   CL**2
00249                                                                      CL**2
00250 *****************************************************************    CL**2
00251 *    TOGGLE FUNCTION KEY LINES COPYBOOK.                             CL**2
00252 *****************************************************************    CL**2
00253                                                                      CL**2
00254      COPY DPWS009.                                                   CL**2
                                                                        MBKCS101
      *****************************************************************         
      *    SYSTEM MESSAGE FIELDS                                                
      *****************************************************************         
                                                                                
           COPY DPWS006.                                                        
                                                                                
00256 *****************************************************************    CL**2
00257 *    FUNCTION KEYS COPYBOOK.                                         CL**2
00258 *****************************************************************    CL**2
00259                                                                      CL**2
00260      COPY DPWS016.                                                   CL**2
00261                                                                      CL**2
00262 *****************************************************************    CL**2
00263 *    DPKUT045 COPYBOOK.                                              CL**2
00264 *****************************************************************    CL**2
00265                                                                      CL**2
00266      COPY DPWS045.                                                   CL**2
00267                                                                      CL**2
00268 *****************************************************************    CL**2
00269 *    NUMERIC EDIT LAYOUT.                                            CL**2
00270 *****************************************************************    CL**2
00271                                                                      CL**2
00272      COPY DPWS010I.                                                  CL**2
00273                                                                      CL**2
00274 *****************************************************************    CL**2
00275 *    MESSAGE RECORD LAYOUT                                           CL**2
00276 *****************************************************************    CL**2
00277                                                                      CL**2
00278      COPY DPRD507I.                                                  CL**2
00279                                                                      CL**2
00280 *****************************************************************    CL**2
00281 *    STANDARD ATTENTION IDENTIFIER LIST                              CL**2
00282 *****************************************************************    CL**2
00283                                                                      CL**2
00284      COPY DFHAID.                                                    CL**2
00285                                                                      CL**2
00286 *****************************************************************    CL**2
00287 *    STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST           CL**2
00288 *****************************************************************    CL**2
00289                                                                      CL**2
00290      COPY DFHBMSCA.                                                  CL**2
00291                                                                      CL**2
00292 *****************************************************************    CL**2
00293 *    MAP LAYOUT                                                      CL**2
00294 *****************************************************************    CL**2
00295                                                                      CL**2
00296      COPY MBKM103.                                                   CL**2
00297  01  MD-MAP-DATA-AREA  REDEFINES MB103AO PIC X(1200).                CL**2
00298 *                                                                    CL**2
00299  EJECT                                                               CL**2
00300 *                                                                    CL**2
00301 *    DB2 AREA FOR TMDSEAR                                            CL**2
00302 *                                                                    CL**2
00303      EXEC SQL                                                        CL**2
00304           INCLUDE TMDSEAR                                            CL**2
00305      END-EXEC.                                                       CL**2
00306 *                                                                    CL**2
00307 *    DB2 AREA FOR COMMUNICATIONS                                     CL**2
00308 *                                                                    CL**2
00309      EXEC SQL                                                        CL**2
00310           INCLUDE SQLCA                                              CL**2
00311      END-EXEC.                                                       CL**2
00312 *                                                                    CL**2
00313  EJECT                                                               CL**2
00314  LINKAGE SECTION.                                                    CL**2
00315                                                                      CL**2
00316  01  DFHCOMMAREA.                                                    CL**2
00317      05  FILLER                         OCCURS  1 TO 4072 TIMES      CL**2
00318                                         DEPENDING ON EIBCALEN.       CL**2
00319          10  FILLER                     PIC X.                       CL**2
00320                                                                      CL**2
00321 *                                                                    CL**2
00322 *                                                                    CL**2
00323 *                                                                    CL**2
00324  PROCEDURE DIVISION.                                                 CL**2
00325                                                                      CL**2
00326                                                                      CL**2
00327  0000-MAIN-MODULE.                                                   CL**2
00328                                                                      CL**2
00329 ******************************************************************   CL**2
00330 *    PROCESS THIS TRANSACTION IF THE COMMAREA IS VALID.              CL**2
00331 ******************************************************************   CL**2
00332                                                                      CL**2
00333      PERFORM DP015-0000-CHECK-COMMAREA.                              CL**2
00334                                                                      CL**2
00335      IF DP020-SRC-RETURN-W-TRAN-ID                                   CL**2
00336          PERFORM 1000-CONTROL-PROCESSING                             CL**2
00337      END-IF.                                                         CL**2
00338                                                                      CL**2
00339      PERFORM DP003-0000-RETURN-TO-CICS.                              CL**2
00340  EJECT                                                               CL**2
00341 ******************************************************************   CL**2
00342 *    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT       CL**2
00343 *    COURSE OF ACTION IS FOR THIS TRANSACTION.                       CL**2
00344 *                                                                    CL**2
00345 *    PERFORMED BY 0000-MAIN-MODULE.                                  CL**2
00346 ******************************************************************   CL**2
00347 *                                                                    CL**2
00348  1000-CONTROL-PROCESSING.                                            CL**2
00349 *                                                                    CL**2
00350      SET PS-CONTINUE           TO  TRUE.                             CL*23
00351 *                                                                    CL**2
00352      EVALUATE TRUE                                                   CL**2
00353          WHEN DP020-NEXT-ACT-INITIAL                                 CL**2
00354              PERFORM 4100-VALIDATE-COMMAREA                          CL*31
00355              IF  PS-COMMAREA-NOT-VALID                               CL*31
00356                  MOVE PC-TSYMSG-99901                                CL*31
00357                                TO  DP020-MSG-NUMBER                  CL*31
00358                  SET DP020-MSG-FATAL                                 CL*31
00359                                TO  TRUE                              CL*31
00360                  MOVE DP016-PF3                                      CL*33
00361                                TO  DP020-SRC-AID                     CL*33
00362                  PERFORM DP015-1000-START-NAVIGATOR                  CL*31
00363              ELSE                                                    CL*31
00364                  INITIALIZE MB103-SPECIFIC-COMMAREA                  CL*31
00365                  SET PS-SEND-MAP-N-DATA-FRSET                        CL*31
00366                                TO  TRUE                              CL*31
00367                  SET DP020-NEXT-ACT-READ-MAP                         CL*31
00368                                TO  TRUE                              CL*31
00369                  PERFORM 2000-BUILD-INITIAL-PANEL                    CL*31
00370              END-IF                                                  CL*31
00371 *                                                                    CL**2
00372          WHEN DP020-NEXT-ACT-READ-MAP                                CL**2
00373              PERFORM 3000-PROCESS-PANEL                              CL**2
00374 *                                                                    CL**2
00375          WHEN DP020-NEXT-ACT-RETURN                                  CL**2
00376              SET PS-SEND-MAP-N-DATA-FRSET                            CL**2
00377                                TO  TRUE                              CL**2
00378              MOVE MB103-SAVE-INTER-APPL-COMMAREA                     CL**2
00379                                TO  MB005-INTER-APPL-COMMAREA         CL**2
00380              PERFORM 3400-MOVE-COMMAREA-TO-SCREEN                    CL**2
00381              PERFORM 2200-DISPLAY-PANEL                              CL**2
00382 *                                                                    CL**2
00383          WHEN DP020-NEXT-ACT-ERROR                                   CL**2
00384              MOVE DP020-MSG-MESSAGE TO PV-MESSAGE                    CL**2
00385              IF DP020-NAV-MNEMONIC = SPACES                          CL**2
00386                  MOVE SPACES   TO  ANAVCMDO                          CL**2
00387                  MOVE DP015-UNDERLINE                                CL**2
00388                                TO  ANAVCMDH                          CL**2
00389                  MOVE DP015-GREEN                                    CL**2
00390                                TO  ANAVCMDC                          CL**2
00391              ELSE                                                    CL**2
00392                  MOVE DP015-REVERSE                                  CL**2
00393                                TO  ANAVCMDH                          CL**2
00394                  MOVE DP015-RED                                      CL**2
00395                                TO  ANAVCMDC                          CL**2
00396              END-IF                                                  CL**2
00397 *                                                                    CL**2
00398              MOVE PV-MESSAGE   TO  DP020-MSG-MESSAGE                 CL**2
00399                                                                      CL**2
00400              SET DP020-MSG-FATAL                                     CL**2
00401                                TO  TRUE                              CL**2
00402              SET PS-SEND-DATA-ONLY-FRSET                             CL**2
00403                                TO  TRUE                              CL**2
00404              PERFORM 2200-DISPLAY-PANEL                              CL**2
00405 *                                                                    CL**2
00406          WHEN OTHER                                                  CL**2
00407              SET DP013-LOGIC-ABEND TO TRUE                           CL**2
00408              SET DP013-NO-ROLLBACK TO TRUE                           CL**2
00409              MOVE 'B100-CONTROL-PROCESSING'                          CL**2
00410                                TO  DP013-PARAGRAPH                   CL**2
00411              MOVE PM-PROGRAM-MESSAGE-12                              CL**2
00412                                TO  DP013-MESSAGE-TEXT(1)             CL**2
00413              PERFORM DP013-0000-PROCESS-ABEND                        CL**2
00414      END-EVALUATE.                                                   CL**2
00415 *                                                                    CL**2
00416  EJECT                                                               CL**2
00417 ******************************************************************   CL**2
00418 *    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST         CL**2
00419 *    ENTRY.                                                          CL**2
00420 *                                                                    CL**2
00421 *    PERFORMED BY 1000-CONTROL-PROCESSING.                           CL**2
00422 ******************************************************************   CL**2
00423 *                                                                    CL**2
00424  2000-BUILD-INITIAL-PANEL.                                           CL**2
00425 *                                                                    CL**2
00426      MOVE 1                    TO  MB103-MA-ITEM                     CL**8
00427                                    MB103-MA-SUB.                     CL**8
00428      IF  DP020-MB-MERCH-AREA-LIST                                    CL*31
00429          PERFORM 2150-READ-LIST-QUEUE                                CL*30
00430          MOVE MB003-KEY-DATA (1)   TO  MB103-LAST-KEY-DATA           CL*27
00431          MOVE MA-LIST-RECORD       TO  MB103-SAVE-LIST-QUEUE         CL**5
00432          SET MB103-IS-A-LIST       TO  TRUE                          CL*23
00433      ELSE                                                            CL**2
00434          MOVE MB005-REQUEST-DATA   TO  MB103-LAST-KEY-DATA           CL**2
00435          SET MB103-IS-NO-LIST      TO  TRUE                          CL*23
00436 *                                                                    CL*19
00437 *    ENSURE THE DATA WAS PASSED PROPERLY.                            CL*19
00438 *                                                                    CL*19
00439          IF  MB103-LAST-DMA-NBR GREATER THAN ZERO                    CL*19
00440              MOVE PC-DMA           TO  MB103-LAST-MDSELV-NBR         CL*19
00441          ELSE                                                        CL*19
00442              MOVE PC-ZERO          TO  MB103-LAST-DMA-NBR            CL*19
00443          END-IF                                                      CL*19
00444 *                                                                    CL*19
00445          IF  MB103-LAST-DEPT-NBR GREATER THAN ZERO                   CL*19
00446              MOVE PC-DPT           TO  MB103-LAST-MDSELV-NBR         CL*19
00447          ELSE                                                        CL*19
00448              MOVE PC-ZERO          TO  MB103-LAST-DEPT-NBR           CL*19
00449          END-IF                                                      CL*19
00450 *                                                                    CL*19
00451          IF  MB103-LAST-MCLASS-NBR GREATER THAN ZERO                 CL*19
00452              MOVE PC-MCL           TO  MB103-LAST-MDSELV-NBR         CL*19
00453          ELSE                                                        CL*19
00454              MOVE PC-ZERO          TO  MB103-LAST-MCLASS-NBR         CL*19
00455          END-IF                                                      CL*19
00456 *                                                                    CL*19
00457          IF  MB103-LAST-SCLASS-NBR GREATER THAN ZERO                 CL*19
00458              MOVE PC-SCL           TO  MB103-LAST-MDSELV-NBR         CL*19
00459          ELSE                                                        CL*19
00460              MOVE PC-ZERO          TO  MB103-LAST-SCLASS-NBR         CL*19
00461          END-IF                                                      CL*19
00462 *                                                                    CL*19
00463      END-IF.                                                         CL**2
00464 *                                                                    CL**2
00465      PERFORM 2100-RETRIEVE-DATA-FOR-PANEL.                           CL**2
00466 *                                                                    CL**2
00467      MOVE PC-COMPANY           TO  AOPERCOO.                         CL**3
00468      PERFORM 2200-DISPLAY-PANEL.                                     CL**2
00469 *                                                                    CL**2
00470  EJECT                                                               CL**2
00471 ******************************************************************   CL**2
00472 *    DETERMINE WHAT LEVEL OF DATA WAS PASSED AND PERFORM THE         CL**2
00473 *    READ FOR EACH LEVEL.                                            CL**2
00474 *                                                                    CL**2
00475 *    PERFORMED BY 2000, 2160, 3000                                   CL**2
00476 ******************************************************************   CL**2
00477 *                                                                    CL**2
00478  2100-RETRIEVE-DATA-FOR-PANEL.                                       CL**2
00479 *                                                                    CL**2
00480 *    FIRST, SET UP THE HOST VARIABLES.                               CL**2
00481 *                                                                    CL**2
00482      MOVE MB103-LAST-GMA-NBR   TO  MDSEAR-GMA-NBR.                   CL**2
00483      MOVE MB103-LAST-DMA-NBR   TO  MDSEAR-DMA-NBR.                   CL**2
00484      MOVE MB103-LAST-DEPT-NBR  TO  MDSEAR-DEPT-NBR.                  CL**2
00485      MOVE MB103-LAST-MCLASS-NBR                                      CL**2
00486                                TO  MDSEAR-MAJ-CL-NBR.                CL**2
00487      MOVE MB103-LAST-SCLASS-NBR                                      CL**2
00488                                TO  MDSEAR-SUB-CL-NBR.                CL**2
00489      MOVE MB103-LAST-MDSELV-NBR                                      CL**2
00490                                TO  MDSEAR-MDSELV-CDE.                CL**2
00491 *                                                                    CL**2
00492 *    NOW, READ THE ROW AND MOVE THE LOWEST LEVEL DETAIL INFO         CL**2
00493 *    TO THE COMM AREA.  (THE FIRST READ WILL ALWAYS RETURN THE       CL**2
00494 *    LOWEST LEVEL DETAIL BECAUSE OF THE KEY INFORMATION USED).       CL**2
00495 *                                                                    CL**2
00496      PERFORM 2110-READ-MDSEAR.                                       CL**2
00497      PERFORM 2120-SAVE-DETAIL.                                       CL**2
00498 *                                                                    CL**2
00499 *    DETERMINE THE NEXT LEVEL TO READ, BLANK SCREEN FOR DETAIL       CL**2
00500 *    FIELDS NOT REQUESTED.  SUB-CLASS CHECK FIRST.                   CL**2
00501 *                                                                    CL**2
00502      IF  MB103-LAST-SCLASS-NBR GREATER THAN ZERO                     CL**2
00503          MOVE MDSEAR-DESC      TO  MB103-SCLASS-DESC                 CL**7
00504          MOVE PC-ZERO          TO  MDSEAR-SUB-CL-NBR                 CL**7
00505          MOVE PC-MCL           TO  MDSEAR-MDSELV-CDE                 CL**7
00506          SET MB103-IS-A-SUBCL  TO  TRUE                              CL*23
00507          PERFORM 2110-READ-MDSEAR                                    CL**2
00508          MOVE DP015-ASK-NOR-OFF                                      CL*38
00509                                TO  MB103-LAST-SCLASS-ATTR            CL*18
00510          MOVE DP015-ASK-BRT-OFF                                      CL*39
00511                                TO  MB103-LAST-SCLASS-ATTR-HEAD       CL*39
00512      ELSE                                                            CL**2
00513          SET MB103-IS-NO-SUBCL TO  TRUE                              CL*23
00514          MOVE DP015-ASK-DRK-OFF                                      CL**2
00515                                TO  MB103-LAST-SCLASS-ATTR            CL*18
00516                                    MB103-LAST-SCLASS-ATTR-HEAD       CL*39
00517      END-IF.                                                         CL**2
00518 *                                                                    CL**2
00519 *    MAJOR CLASS NEXT.                                               CL**2
00520 *                                                                    CL**2
00521      IF  MB103-LAST-MCLASS-NBR GREATER THAN ZERO                     CL**2
00522          MOVE MDSEAR-DESC      TO  MB103-MCLASS-DESC                 CL**7
00523          MOVE PC-ZERO          TO  MDSEAR-MAJ-CL-NBR                 CL**7
00524          MOVE PC-DPT           TO  MDSEAR-MDSELV-CDE                 CL**7
00525          SET MB103-IS-A-MAJCL  TO  TRUE                              CL*35
00526          PERFORM 2110-READ-MDSEAR                                    CL**2
00527          MOVE DP015-ASK-NOR-OFF                                      CL*38
00528                                TO  MB103-LAST-MCLASS-ATTR            CL*18
00529          MOVE DP015-ASK-BRT-OFF                                      CL*39
00530                                TO  MB103-LAST-MCLASS-ATTR-HEAD       CL*39
00531      ELSE                                                            CL**2
00532          SET MB103-IS-NO-MAJCL TO  TRUE                              CL*35
00533          MOVE DP015-ASK-DRK-OFF                                      CL*18
00534                                TO  MB103-LAST-MCLASS-ATTR            CL*18
00535                                    MB103-LAST-MCLASS-ATTR-HEAD       CL*39
00536      END-IF.                                                         CL**2
00537 *                                                                    CL**2
00538 *    DEPARTMENT NEXT.                                                CL**2
00539 *                                                                    CL**2
00540      IF  MB103-LAST-DEPT-NBR GREATER THAN ZERO                       CL**2
00541          MOVE MDSEAR-DESC      TO  MB103-DEPT-DESC                   CL**7
00542          MOVE PC-ZERO          TO  MDSEAR-DEPT-NBR                   CL**7
00543          MOVE PC-DMA           TO  MDSEAR-MDSELV-CDE                 CL**7
00544          SET MB103-IS-A-DEPT   TO  TRUE                              CL*23
00545          PERFORM 2110-READ-MDSEAR                                    CL**2
00546          MOVE DP015-ASK-NOR-OFF                                      CL*38
00547                                TO  MB103-LAST-DEPT-ATTR              CL*18
00548          MOVE DP015-ASK-BRT-OFF                                      CL*39
00549                                TO  MB103-LAST-DEPT-ATTR-HEAD         CL*39
00550      ELSE                                                            CL**2
00551          SET MB103-IS-NO-DEPT  TO  TRUE                              CL*23
00552          MOVE DP015-ASK-DRK-OFF                                      CL**2
00553                                TO  MB103-LAST-DEPT-ATTR              CL*18
00554                                    MB103-LAST-DEPT-ATTR-HEAD         CL*39
00555      END-IF.                                                         CL**2
00556 *                                                                    CL**2
00557 *    NOW THE DMA.                                                    CL**2
00558 *                                                                    CL**2
00559      IF  MB103-LAST-DMA-NBR GREATER THAN ZERO                        CL**2
00560          MOVE MDSEAR-DESC      TO  MB103-DMA-DESC                    CL**9
00561          MOVE DP015-ASK-NOR-OFF                                      CL*38
00562                                TO  MB103-LAST-DMA-ATTR               CL*18
00563          MOVE DP015-ASK-BRT-OFF                                      CL*39
00564                                TO  MB103-LAST-DMA-ATTR-HEAD          CL*39
00565      ELSE                                                            CL**2
00566          MOVE DP015-ASK-DRK-OFF                                      CL**2
00567                                TO  MB103-LAST-DMA-ATTR               CL*18
00568                                    MB103-LAST-DMA-ATTR-HEAD          CL*39
00569      END-IF.                                                         CL**2
00570 *                                                                    CL**2
00571 *    THE GMA IS ALWAYS REQUIRED, UNCONDITIONALLY PERFORM READ.       CL**2
00572 *                                                                    CL**2
00573      MOVE PC-ZERO              TO  MDSEAR-DMA-NBR.                   CL**7
00574      MOVE PC-GMA               TO  MDSEAR-MDSELV-CDE.                CL**7
00575      PERFORM 2110-READ-MDSEAR.                                       CL**2
00576      MOVE MDSEAR-DESC          TO  MB103-GMA-DESC.                   CL**2
00577 *                                                                    CL**2
00578      PERFORM 3400-MOVE-COMMAREA-TO-SCREEN.                           CL**2
00579 *                                                                    CL**2
00580  EJECT                                                               CL**2
00581 ******************************************************************   CL**2
00582 *    READ THE TMDSEAR TABLE HERE.                                    CL**2
00583 *                                                                    CL**2
00584 *    PERFORMED BY 2100.                                              CL**2
00585 ******************************************************************   CL**2
00586 *                                                                    CL**2
00587  2110-READ-MDSEAR.                                                   CL**2
00588 *                                                                    CL**2
00589      PERFORM                                                         CL**2
00590          WITH TEST AFTER                                             CL**2
00591          VARYING PV-SQL-SUB                                          CL**2
00592          FROM 1 BY 1                                                 CL**2
00593          UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                CL**2
00594             OR SQLCODE = 0                                           CL**2
00595             OR SQLCODE = +100                                        CL**2
00596 *                                                                    CL**2
00597          EXEC SQL                                                    CL**2
00598               SELECT                                                 CL**2
00599                      CHG_DTE,                                        CL**8
00600                      CRE_DTE,                                        CL**8
00601                      STRT_DTE,                                       CL**8
00602                      END_DTE,                                        CL**2
00603                      GEN_MDSE_TYP_CDE,                               CL**2
00604                      MDSEAR_DESC,                                    CL**2
00605                      BYR_NBR                                         CL**2
00606               INTO                                                   CL**2
00607                      :MDSEAR-CHG-DTE,                                CL**8
00608                      :MDSEAR-CRE-DTE,                                CL**8
00609                      :MDSEAR-STRT-DTE,                               CL**8
00610                      :MDSEAR-END-DTE,                                CL**2
00611                      :MDSEAR-GEN-MDSE-TYP-CDE,                       CL**2
00612                      :MDSEAR-DESC,                                   CL**2
00613                      :MDSEAR-BYR-NBR                                 CL**2
00614               FROM                                                   CL**2
00615                      TMDSEAR                                         CL**2
00616               WHERE                                                  CL**2
00617                     (OPERCO_NBR     = :PC-COMPANY                    CL*27
00618                 AND  GMA_NBR        = :MDSEAR-GMA-NBR                CL**2
00619                 AND  DMA_NBR        = :MDSEAR-DMA-NBR                CL**2
00620                 AND  DEPT_NBR       = :MDSEAR-DEPT-NBR               CL**2
00621                 AND  MAJ_CL_NBR     = :MDSEAR-MAJ-CL-NBR             CL**2
00622                 AND  SUB_CL_NBR     = :MDSEAR-SUB-CL-NBR             CL**2
00623                 AND  MDSELV_CDE     = :MDSEAR-MDSELV-CDE)            CL*27
00624          END-EXEC                                                    CL**2
00625 *                                                                    CL**2
00626          EVALUATE TRUE                                               CL**2
00627              WHEN SQLCODE = -904                                     CL**2
00628              WHEN SQLCODE = -913                                     CL**2
00629              WHEN SQLCODE = +100                                     CL**6
00630              WHEN SQLCODE = ZERO                                     CL**2
00631                   CONTINUE                                           CL**2
00632              WHEN SQLWARN0 NOT EQUAL SPACE                           CL**2
00633              WHEN SQLCODE NOT EQUAL ZERO                             CL**2
00634                   MOVE '2110-READ-MDSEAR'                            CL**2
00635                                TO  DP013-PARAGRAPH                   CL**2
00636                   MOVE 'READ MDSEAR'                                 CL**2
00637                                TO  DP013-MESSAGE-TEXT (1)            CL**2
00638                   MOVE SQLCA   TO  DP013-SQLCA                       CL**2
00639                   SET DP013-DB2-ABEND                                CL**2
00640                                TO  TRUE                              CL**2
00641                   PERFORM DP013-0000-PROCESS-ABEND                   CL**2
00642          END-EVALUATE                                                CL**2
00643      END-PERFORM.                                                    CL**2
00644 *                                                                    CL**2
00645      IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                      CL**2
00646          MOVE '2110-READ-MDSEAR'                                     CL**2
00647                                TO  DP013-PARAGRAPH                   CL**2
00648          MOVE 'MAX RETRIES EXCEEDED FOR READ MDSEAR'                 CL**2
00649                                TO  DP013-MESSAGE-TEXT (1)            CL**2
00650          MOVE SQLCA            TO  DP013-SQLCA                       CL**2
00651          SET DP013-DB2-ABEND   TO  TRUE                              CL**2
00652          PERFORM DP013-0000-PROCESS-ABEND                            CL**2
00653      END-IF.                                                         CL**2
00654 *                                                                    CL**2
00655      IF  SQLCODE EQUAL +100                                          CL**6
00656          MOVE 'NOT FOUND'      TO  MDSEAR-DESC                       CL**6
00657      END-IF.                                                         CL**6
00658 *                                                                    CL**6
00659  EJECT                                                               CL**2
00660 ******************************************************************   CL**2
00661 *    MOVE THE LOWEST LEVEL DETAIL INFORMATION TO THE COMMAREA.       CL**2
00662 *                                                                    CL**2
00663 *    PERFORMED BY 2100                                               CL**2
00664 ******************************************************************   CL**2
00665 *                                                                    CL**2
00666  2120-SAVE-DETAIL.                                                   CL**2
00667 *                                                                    CL**2
00668      MOVE MDSEAR-CHG-DTE       TO  PV-DB2-DATE.                      CL**2
00669      MOVE PV-DD-MM             TO  PV-WD-MM.                         CL**2
00670      MOVE PV-DD-DD             TO  PV-WD-DD.                         CL**2
00671      MOVE PV-DD-YY             TO  PV-WD-YY.                         CL**2
00672      MOVE PV-WORK-DATE         TO  MB103-CHG-DATE.                   CL**3
00673 *                                                                    CL**2
00674      MOVE MDSEAR-CRE-DTE       TO  PV-DB2-DATE.                      CL**2
00675      MOVE PV-DD-MM             TO  PV-WD-MM.                         CL**2
00676      MOVE PV-DD-DD             TO  PV-WD-DD.                         CL**2
00677      MOVE PV-DD-YY             TO  PV-WD-YY.                         CL**2
00678      MOVE PV-WORK-DATE         TO  MB103-CRE-DATE.                   CL**3
00679 *                                                                    CL**2
00680      MOVE MDSEAR-STRT-DTE      TO  PV-DB2-DATE.                      CL**2
00681      MOVE PV-DD-MM             TO  PV-WD-MM.                         CL**2
00682      MOVE PV-DD-DD             TO  PV-WD-DD.                         CL**2
00683      MOVE PV-DD-YY             TO  PV-WD-YY.                         CL**2
00684      MOVE PV-WORK-DATE         TO  MB103-STRT-DATE.                  CL**3
00685 *                                                                    CL**2
00686      IF  MDSEAR-END-DTE EQUAL PC-NO-DISPLAY-DATE                     CL*29
00687          MOVE SPACES           TO  MB103-END-DATE                    CL*29
00688      ELSE                                                            CL*29
00689          MOVE MDSEAR-END-DTE   TO  PV-DB2-DATE                       CL*29
00690          MOVE PV-DD-MM         TO  PV-WD-MM                          CL*29
00691          MOVE PV-DD-DD         TO  PV-WD-DD                          CL*29
00692          MOVE PV-DD-YY         TO  PV-WD-YY                          CL*29
00693          MOVE PV-WORK-DATE     TO  MB103-END-DATE                    CL*29
00694      END-IF.                                                         CL*29
00695 *                                                                    CL**2
00696      MOVE MDSEAR-GEN-MDSE-TYP-CDE                                    CL**5
00697                                TO  MB103-GEN-MDSE-TYPE-CDE.          CL**2
00698      MOVE MDSEAR-BYR-NBR       TO  MB103-BYR-NBR.                    CL**2
00699 *                                                                    CL**2
00700  EJECT                                                               CL**2
00701 ******************************************************************   CL**2
00702 *    READ THE TEMPORARY STORAGE QUEUE THAT CONTAINS THE SELECTED     CL**2
00703 *    MERCHANDISE DEPARTMENTS FROM MBKCS123 (MERCH DEPT DISCNT LST)   CL**2
00704 *                                                                    CL**2
00705 *    PERFORMED BY 2000, 2160                                         CL**2
00706 ******************************************************************   CL**2
00707 *                                                                    CL**2
00708  2150-READ-LIST-QUEUE.                                               CL**2
00709 *                                                                    CL**2
00710      EXEC CICS                                                       CL**2
00711          READQ TS                                                    CL**2
00712          QUEUE(MB005-LIST-QUEUE-NAME)                                CL**2
00713          INTO(MA-LIST-RECORD)                                        CL**2
00714          LENGTH(MB005-LIST-QUEUE-LENGTH)                             CL**2
00715          ITEM(MB103-MA-ITEM)                                         CL**2
00716          RESP(PV-RESP)                                               CL**2
00717      END-EXEC.                                                       CL**2
00718 *                                                                    CL**2
00719      IF  PV-RESP EQUAL DFHRESP(NORMAL)                               CL*30
00720          CONTINUE                                                    CL**2
00721      ELSE                                                            CL**2
00722          MOVE PV-RESP          TO  PM-RESP-22                        CL**2
00723          SET DP013-LOGIC-ABEND TO  TRUE                              CL**2
00724          SET DP013-NO-ROLLBACK TO  TRUE                              CL**2
00725          MOVE '2150-READ-LIST-QUEUE'                                 CL**2
00726                                TO  DP013-PARAGRAPH                   CL**2
00727          MOVE PM-PROGRAM-MESSAGE-22                                  CL**2
00728                                TO  DP013-MESSAGE-TEXT (1)            CL**2
00729          PERFORM DP013-0000-PROCESS-ABEND                            CL**2
00730      END-IF.                                                         CL**2
00731 *                                                                    CL**2
00732  EJECT                                                               CL**2
00733 ******************************************************************   CL**2
00734 *    READ THE TEMP STORAGE QUEUE, GET THE NEXT BUSINESS GROUP.       CL**2
00735 *    IF AT END, RETURN TO CALLING PROGRAM, ELSE, CONTINUE.           CL**3
00736 *                                                                    CL**2
00737 *    PERFORMED BY 3000                                               CL**2
00738 ******************************************************************   CL**2
00739 *                                                                    CL**2
00740  2160-GET-NEXT-MDSEAR.                                               CL**2
00741 *                                                                    CL**2
00742      ADD 1                     TO  MB103-MA-SUB.                     CL**2
00743      IF  MB103-MA-SUB GREATER THAN MB003-MAX-ITEMS                   CL*27
00744          ADD 1                 TO  MB103-MA-ITEM                     CL**2
00745          MOVE 1                TO  MB103-MA-SUB                      CL**2
00746          PERFORM 2150-READ-LIST-QUEUE                                CL**5
00747          MOVE MA-LIST-RECORD       TO  MB103-SAVE-LIST-QUEUE         CL**5
00748      ELSE                                                            CL**5
00749          MOVE MB103-SAVE-LIST-QUEUE                                  CL**5
00750                                    TO  MA-LIST-RECORD                CL**5
00751      END-IF.                                                         CL**2
00752 *                                                                    CL**2
00753      IF  MB003-KEY-DATA (MB103-MA-SUB) GREATER THAN SPACES           CL*27
00754          MOVE MB003-KEY-DATA (MB103-MA-SUB)                          CL*27
00755                                TO  MB103-LAST-KEY-DATA               CL**3
00756          PERFORM 2100-RETRIEVE-DATA-FOR-PANEL                        CL**2
00757      ELSE                                                            CL**2
00758          SUBTRACT 1          FROM  MB103-MA-SUB                      CL*24
00759          MOVE PC-TSYMSG-00070  TO  DP020-MSG-NUMBER                  CL*22
00760          SET DP020-MSG-INFORMATIONAL                                 CL*22
00761                                TO  TRUE                              CL*22
00762      END-IF.                                                         CL**2
00763 *                                                                    CL**2
00764  EJECT                                                               CL**2
00765 ******************************************************************   CL**2
00766 *    FILL THE MAP WITH THE NECESSARY DATA AND WRITE IT OUT.          CL**2
00767 *                                                                    CL**2
00768 *    PERFORMED BY 1000-CONTROL-PROCESSING.                           CL**2
00769 *    PERFORMED BY 3000-PROCESS-PANEL.                                CL**2
00770 ******************************************************************   CL**2
00771 *                                                                    CL**2
00772  2200-DISPLAY-PANEL.                                                 CL**2
00773 *                                                                    CL**2
00774      PERFORM DP017-0000-GET-CURR-DATE-TIME.                          CL**2
00775      MOVE DP017-EDITED-TIME-HMS                                      CL**2
00776                                TO  ATIMEO.                           CL**2
00777      MOVE -1                   TO  ANAVCMDL.                         CL*16
00778 *                                                                    CL**2
00779      IF  PS-SEND-MAP-N-DATA-FRSET                                    CL**2
00780          PERFORM DP002-0000-FORMAT-TITLE-LINES                       CL**2
00781          PERFORM DP009-0000-LOAD-FK-LINES                            CL**2
00782      END-IF.                                                         CL**2
00783 *                                                                    CL**2
00784      PERFORM DP005-0000-FORMAT-MSG-LINES.                            CL**2
00785                                                                      CL**2
00786      PERFORM DP008-0000-WRITE-PANEL.                                 CL**2
00787 *                                                                    CL**2
00788  EJECT                                                               CL**2
00789 ******************************************************************   CL**2
00790 *    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED     CL**2
00791 *    ON WHAT FUNCTION KEY WAS SELECTED.                              CL**2
00792 *                                                                    CL**2
00793 *    PERFORMED BY 1000-CONTROL-PROCESSING.                           CL**2
00794 ******************************************************************   CL**2
00795 *                                                                    CL**2
00796  3000-PROCESS-PANEL.                                                 CL**2
00797 *                                                                    CL**2
00798      PERFORM DP007-0000-GET-PANEL.                                   CL**2
00799      SET PS-SEND-DATA-ONLY-FRSET                                     CL**2
00800                                TO TRUE.                              CL**2
00801      PERFORM 3100-CHECK-LOCAL-FKEYS.                                 CL**2
00802 *                                                                    CL**2
00803  EJECT                                                               CL**2
00804 ******************************************************************   CL**2
00805 *   DETERMINE THE PROCESSING PATH HERE.                              CL**2
00806 *                                                                    CL**2
00807 *   PERFORMED BY 3000.                                               CL**2
00808 ******************************************************************   CL**2
00809 *                                                                    CL**2
00810  3100-CHECK-LOCAL-FKEYS.                                             CL**2
00811 *                                                                    CL**2
00812      EVALUATE TRUE                                                   CL**2
00813 *                                                                    CL**2
00814          WHEN DP020-SRC-AID = DP016-CLEAR                            CL**2
00815          WHEN DP020-FK-REFRESH(DP020-SRC-AID)                        CL**2
00816              MOVE SPACES       TO  ANAVCMDO                          CL*37
00817                                    ANAVKEYO                          CL*37
00818              SET PS-SEND-MAP-N-DATA-FRSET                            CL**2
00819                                TO  TRUE                              CL**2
00820              PERFORM 3400-MOVE-COMMAREA-TO-SCREEN                    CL**2
00821              PERFORM 2200-DISPLAY-PANEL                              CL**2
00822 *                                                                    CL**2
00823 *    "NEXT" PROCESSING - POSITION TO NEXT MERCH AREA CODE            CL**2
00824 *                                                                    CL**2
00825          WHEN DP020-FK-NEXT-SELECTION(DP020-SRC-AID)                 CL*21
00826              IF  MB103-IS-A-LIST                                     CL*23
00827                  PERFORM 2160-GET-NEXT-MDSEAR                        CL**2
00828              ELSE                                                    CL**2
00829                  MOVE PC-TSYMSG-00070                                CL*22
00830                                TO  DP020-MSG-NUMBER                  CL*22
00831                  SET DP020-MSG-INFORMATIONAL                         CL*22
00832                                TO  TRUE                              CL*22
00833              END-IF                                                  CL**2
00834              PERFORM 2200-DISPLAY-PANEL                              CL*22
00835 *                                                                    CL**2
00836          WHEN DP020-SRC-AID = DP016-PF21                             CL*17
00837              PERFORM 3500-LOAD-INTER-APPL                            CL*17
00838              PERFORM 4000-NAVIGATE                                   CL*17
00839 *                                                                    CL*17
00840          WHEN DP020-SRC-AID = DP016-PF22                             CL*17
00841              IF  MB103-IS-A-DEPT                                     CL*23
00842                  IF  MB103-IS-A-MAJCL                                CL*35
00843                      SET DP020-MSG-WARNING                           CL*35
00844                                TO  TRUE                              CL*35
00845                      MOVE PC-TSYMSG-00176                            CL*35
00846                                TO  DP020-MSG-NUMBER                  CL*35
00847                      PERFORM 2200-DISPLAY-PANEL                      CL*35
00848                  ELSE                                                CL*35
00849                      PERFORM 3500-LOAD-INTER-APPL                    CL*35
00850                      PERFORM 4000-NAVIGATE                           CL*35
00851                  END-IF                                              CL*35
00852              ELSE                                                    CL*35
00853                  SET DP020-MSG-WARNING                               CL*35
00854                                TO  TRUE                              CL*25
00855                  MOVE PC-TSYMSG-00176                                CL*25
00856                                TO  DP020-MSG-NUMBER                  CL*25
00857                  PERFORM 2200-DISPLAY-PANEL                          CL*12
00858              END-IF                                                  CL*14
00859 *                                                                    CL*12
00860          WHEN DP020-SRC-AID = DP016-PF23                             CL**5
00861              IF  MB103-IS-A-SUBCL                                    CL*23
00862                  PERFORM 3500-LOAD-INTER-APPL                        CL*12
00863                  PERFORM 4000-NAVIGATE                               CL*12
00864              ELSE                                                    CL*12
00865                  SET DP020-MSG-WARNING                               CL*25
00866                                TO  TRUE                              CL*25
00867                  MOVE PC-TSYMSG-00176                                CL*25
00868                                TO  DP020-MSG-NUMBER                  CL*25
00869                  PERFORM 2200-DISPLAY-PANEL                          CL*12
00870              END-IF                                                  CL*14
00871 *                                                                    CL**2
00872          WHEN DP020-SRC-AID = DP016-PA2                              CL**2
00873              PERFORM DP009-0000-LOAD-FK-LINES                        CL**2
00874              PERFORM DP017-0000-GET-CURR-DATE-TIME                   CL**2
00875              SET PS-SEND-DATA-ONLY                                   CL**2
00876                                TO  TRUE                              CL**2
00877              MOVE -1           TO  ANAVCMDL                          CL**2
00878              PERFORM DP008-0000-WRITE-PANEL                          CL**2
00879 *                                                                    CL**2
00880          WHEN DP020-FK-RETURN(DP020-SRC-AID)                         CL**2
00881          WHEN DP020-FK-GO-TO-TRAN(DP020-SRC-AID)                     CL**3
00882               PERFORM 4000-NAVIGATE                                  CL**2
00883 *                                                                    CL**2
00884          WHEN DP020-SRC-AID = DP016-ENTER                            CL**2
00885              IF  DP020-NAV-MNEMONIC GREATER THAN SPACES              CL**2
00886                  PERFORM 4000-NAVIGATE                               CL**2
00887              ELSE                                                    CL**2
00888                  PERFORM 2200-DISPLAY-PANEL                          CL**2
00889              END-IF                                                  CL**2
00890 *                                                                    CL**2
00891          WHEN OTHER                                                  CL**2
00892              MOVE PC-TSYMSG-00045                                    CL**2
00893                                TO  DP020-MSG-NUMBER                  CL**2
00894              SET DP020-MSG-FATAL                                     CL**2
00895                                TO  TRUE                              CL**2
00896              MOVE -1           TO  ANAVCMDL                          CL**2
00897              PERFORM 2200-DISPLAY-PANEL                              CL**2
00898      END-EVALUATE.                                                   CL**2
00899 *                                                                    CL**2
00900  EJECT                                                               CL**2
00901 ******************************************************************   CL**2
00902 *    HERE WE SIMPLY MOVE DATA ENTERED ON THE SCREEN TO THE COMM      CL**2
00903 *    AREA.                                                           CL**2
00904 *                                                                    CL**2
00905 *    PERFORMED BY 3000                                               CL**2
00906 ******************************************************************   CL**2
00907 *                                                                    CL**2
00908 *3200-MOVE-SCREEN-TO-COMMAREA.                                       CL**2
00909 *                                                                    CL**2
00910  EJECT                                                               CL**2
00911 ******************************************************************   CL**2
00912 *    HERE WE SIMPLY ENSURE THE DATA IS CORRECT.  IF NOT, ISSUE       CL**2
00913 *    APPROPRIATE ERRORS.                                             CL**2
00914 *                                                                    CL**2
00915 *    PERFORMED BY 3000                                               CL**2
00916 ******************************************************************   CL**2
00917 *                                                                    CL**2
00918 *3300-EDIT-DATA-IN-COMMAREA.                                         CL**2
00919 *                                                                    CL**2
00920  EJECT                                                               CL**2
00921 ******************************************************************   CL**2
00922 *    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.              CL**2
00923 *                                                                    CL**2
00924 *    PERFORMED BY 2000, 2160.                                        CL**2
00925 ******************************************************************   CL**2
00926 *                                                                    CL**2
00927  3400-MOVE-COMMAREA-TO-SCREEN.                                       CL**2
00928 *                                                                    CL**2
00929      MOVE MB103-LAST-DMA-ATTR-HEAD                                   CL*39
00930                                TO  ADMAHEDA.                         CL*39
00931      MOVE MB103-LAST-DMA-ATTR  TO  ADMAA                             CL*39
00932                                    ADMADESA.                         CL*18
00933      MOVE MB103-LAST-DEPT-ATTR-HEAD                                  CL*39
00934                                TO  ADPTHEDA                          CL*39
00935                                    ABUYHEDA.                         CL*39
00936      MOVE MB103-LAST-DEPT-ATTR TO  ADEPTA                            CL*39
00937                                    ADPTDESA                          CL*36
00938                                    ABUYERA.                          CL*36
00939      MOVE MB103-LAST-MCLASS-ATTR-HEAD                                CL*39
00940                                TO  AMCLHEDA.                         CL*39
00941      MOVE MB103-LAST-MCLASS-ATTR                                     CL*39
00942                                TO  AMCLASSA                          CL*39
00943                                    AMCDESA.                          CL*18
00944      MOVE MB103-LAST-SCLASS-ATTR-HEAD                                CL*39
00945                                TO  ASCLHEDA.                         CL*39
00946      MOVE MB103-LAST-SCLASS-ATTR                                     CL*39
00947                                TO  ASCLASSA                          CL*39
00948                                    ASCDESA.                          CL*18
00949 *                                                                    CL*18
00950      MOVE MB103-LAST-GMA-NBR   TO  AGMAO.                            CL**3
00951      MOVE MB103-LAST-DMA-NBR   TO  ADMAO.                            CL**3
00952      MOVE MB103-LAST-DEPT-NBR  TO  ADEPTO.                           CL**3
00953      MOVE MB103-LAST-MCLASS-NBR                                      CL**2
00954                                TO  AMCLASSO.                         CL**3
00955      MOVE MB103-LAST-SCLASS-NBR                                      CL**2
00956                                TO  ASCLASSO.                         CL**3
00957 *                                                                    CL**2
00958      MOVE MB103-GMA-DESC       TO  AGMADESO.                         CL**3
00959      MOVE MB103-DMA-DESC       TO  ADMADESO.                         CL**3
00960      MOVE MB103-DEPT-DESC      TO  ADPTDESO.                         CL**3
00961      MOVE MB103-MCLASS-DESC    TO  AMCDESO.                          CL**3
00962      MOVE MB103-SCLASS-DESC    TO  ASCDESO.                          CL**3
00963 *                                                                    CL**2
00964      MOVE MB103-STRT-DATE      TO  ASTARTO.                          CL**3
00965      MOVE MB103-END-DATE       TO  AENDO.                            CL**3
00966      MOVE MB103-GEN-MDSE-TYPE-CDE                                    CL**2
00967                                TO  AGENRLO.                          CL**3
00968      MOVE MB103-BYR-NBR        TO  ABUYERO.                          CL**3
00969      MOVE MB103-CHG-DATE       TO  ACHANGEO.                         CL**3
00970      MOVE MB103-CRE-DATE       TO  ACREATEO.                         CL**3
00971      MOVE PC-COMPANY           TO  AOPERCOO.                         CL**5
00972 *                                                                    CL*11
00973  EJECT                                                               CL*11
00974 ******************************************************************   CL*11
00975 *    LOAD THE INTER APPLICATION COMM AREA WITH THE CURRENT INFO      CL*11
00976 *    FROM THE PROGRAM SPECIFIC COMM AREA.                            CL*11
00977 *                                                                    CL*11
00978 *    PERFORMED BY 3100                                               CL*11
00979 ******************************************************************   CL*11
00980 *                                                                    CL*11
00981  3500-LOAD-INTER-APPL.                                               CL*11
00982 *                                                                    CL*11
00983      MOVE MB005-INTER-APPL-COMMAREA                                  CL*11
00984                                TO  MB103-SAVE-INTER-APPL-COMMAREA.   CL*11
00985 *                                                                    CL*11
00986      MOVE SPACES               TO  MB005-LIST-QUEUE-NAME.            CL*11
00987      MOVE MB103-LAST-GMA-NBR   TO  MB005-GMA-NUMBER.                 CL*11
00988      MOVE MB103-LAST-DMA-NBR   TO  MB005-DMA-NUMBER.                 CL*11
00989      MOVE MB103-LAST-DEPT-NBR  TO  MB005-DEPT-NUMBER.                CL*11
00990      MOVE MB103-LAST-MCLASS-NBR                                      CL*11
00991                                TO  MB005-MCLASS-NUMBER.              CL*11
00992      MOVE MB103-LAST-SCLASS-NBR                                      CL*11
00993                                TO  MB005-SCLASS-NUMBER.              CL*11
00994      MOVE MB103-LAST-MDSELV-NBR                                      CL*11
00995                                TO  MB005-MDSEAR-LEVEL.               CL*11
00996 *                                                                    CL**2
00997  EJECT                                                               CL**2
00998 ******************************************************************   CL**2
00999 *    IF THE USER HITS A KEY THAT REQUIRES US TO GO TO ANOTHER        CL**2
01000 *    TRANSACTION, SAVE THE INTER APPLICATION COMMUNICATIONS AREA     CL**2
01001 *    AND START THE NAVIGATOR.  DONT SAVE THE INTER APPL COMM AREA    CL*11
01002 *    FOR THE DEPARTMENT OR SUB-CLASS INQUIRY (PF22, PF23).           CL*11
01003 *                                                                    CL*11
01004 *    PERFORMED BY 3000                                               CL**2
01005 ******************************************************************   CL**2
01006 *                                                                    CL**2
01007  4000-NAVIGATE.                                                      CL**2
01008 *                                                                    CL**2
01009      COMPUTE MB005-NUMBER-PROCESSED-ITEMS =                          CL**4
01010          ((MB103-MA-ITEM - 1) * MB003-MAX-ITEMS) +                   CL*27
01011            MB103-MA-SUB.                                             CL**4
01012 *                                                                    CL**4
01013      IF  DP020-SRC-AID = DP016-PF21                                  CL*18
01014      OR  DP020-SRC-AID = DP016-PF22                                  CL*18
01015      OR  DP020-SRC-AID = DP016-PF23                                  CL*11
01016          CONTINUE                                                    CL*11
01017      ELSE                                                            CL*11
01018          MOVE MB005-INTER-APPL-COMMAREA                              CL*11
01019                                TO  MB103-SAVE-INTER-APPL-COMMAREA    CL*11
01020      END-IF.                                                         CL*11
01021      SET DP020-MB-MERCH-AREA-INQUIRY                                 CL*34
01022                                TO  TRUE.                             CL*34
01023 *                                                                    CL*11
01024      PERFORM DP015-1000-START-NAVIGATOR.                             CL**2
01025 *                                                                    CL*31
01026  EJECT                                                               CL*31
01027 ******************************************************************   CL*31
01028 *    ENSURE THIS PROGRAM WAS ENTERED PROPERLY.                       CL*31
01029 *                                                                    CL*31
01030 *    PERFORMED BY 1000                                               CL*31
01031 ******************************************************************   CL*31
01032 *                                                                    CL*31
01033  4100-VALIDATE-COMMAREA.                                             CL*31
01034 *                                                                    CL*31
01035      IF (DP020-MB-MERCH-AREA-SELECT                                  CL*31
01036      OR  DP020-MB-MERCH-AREA-LIST)                                   CL*31
01037          SET PS-COMMAREA-VALID TO  TRUE                              CL*31
01038      ELSE                                                            CL*31
01039          SET PS-COMMAREA-NOT-VALID                                   CL*31
01040                                TO  TRUE                              CL*31
01041      END-IF.                                                         CL*31
01042 *                                                                    CL**2
01043  EJECT                                                               CL**2
01044 ******************************************************************   CL**2
01045 *    FILL IN SCREEN HEADER MODULE                                    CL**2
01046 ******************************************************************   CL**2
01047                                                                      CL**2
01048      COPY DPPD002.                                                   CL**2
01049  EJECT                                                               CL**2
01050 ******************************************************************   CL**2
01051 *    RETURN TO CICS MODULE                                           CL**2
01052 ******************************************************************   CL**2
01053                                                                      CL**2
01054      COPY DPPD003.                                                   CL**2
01055  EJECT                                                               CL**2
01056 ******************************************************************   CL**2
01057 *    FORMAT MESSAGE LINES MODULE                                     CL**2
01058 ******************************************************************   CL**2
01059                                                                      CL**2
01060      COPY DPPD005.                                                   CL**2
01061  EJECT                                                               CL**2
01062 ******************************************************************   CL**2
01063 *    GET PANEL MODULE                                                CL**2
01064 ******************************************************************   CL**2
01065                                                                      CL**2
01066      COPY DPPD007.                                                   CL**2
01067  EJECT                                                               CL**2
01068 ******************************************************************   CL**2
01069 *    WRITE PANEL MODULE                                              CL**2
01070 ******************************************************************   CL**2
01071                                                                      CL**2
01072      COPY DPPD008.                                                   CL**2
01073  EJECT                                                               CL**2
01074 ******************************************************************   CL**2
01075 *    TOGGLE THE FUNCTION KEY LINE MODULE                             CL**2
01076 ******************************************************************   CL**2
01077                                                                      CL**2
01078      COPY DPPD009.                                                   CL**2
01079  EJECT                                                               CL**2
01080 ******************************************************************   CL**2
01081 *    ABEND PROCESSOR MODULE                                          CL**2
01082 ******************************************************************   CL**2
01083                                                                      CL**2
01084      COPY DPPD013.                                                   CL**2
01085  EJECT                                                               CL**2
01086 ******************************************************************   CL**2
01087 *    CHECK COMMUNICATION AREA MODULE                                 CL**2
01088 ******************************************************************   CL**2
01089                                                                      CL**2
01090      COPY DPPD015.                                                   CL**2
01091  EJECT                                                               CL**2
01092 ******************************************************************   CL**2
01093 *    UPDATE TIME AND DATE MODULE                                     CL**2
01094 ******************************************************************   CL**2
01095                                                                      CL**2
01096      COPY DPPD017.                                                   CL**2
