000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    PCKCS135.                                         00040000
000500 AUTHOR.        BECKY WENDT.                                      00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  01-19-94.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900*----------------------------------------------------------------*00090000
001000*    E135 - OPERATION DESCRIPTION CRITERIA SPECIFICATION         *00100000
001100*                                                                *00110000
001200*    THIS PROGRAM ALLOWS THE USER ENTER EITHER THE FACILITY      *00120000
001300*    AREA ID, OR THE OPERATION DESCRIPTION TO BE PASSED TO THE   *00130000
001400*    OPERATION DESCRIPTION LIST PROGRAM.                         *00140000
1122RM*---------------------------------------------------------------- 00151002
1122RM* DATE  11/07/2022                                              * 00152002
1122RM*            - ADD COPYBOOK DPWS930                             * 00153002
1122RM*              CHANGE CALL TO DPWS030 FROM STATIC TO            * 00154002
1122RM*              DYNAMIC.                                         * 00155002
1122RM*     MADE BY: BOB MCASEY              WR/IR #: CHG0277910      * 00156002
001500*----------------------------------------------------------------*00157002
001600                                                                  00160000
001700                                                                  00170000
001800                                                                  00180000
001900 ENVIRONMENT DIVISION.                                            00190000
002000                                                                  00200000
002100                                                                  00210000
002200                                                                  00220000
002300 DATA DIVISION.                                                   00230000
002400                                                                  00240000
002500                                                                  00250000
002600 WORKING-STORAGE SECTION.                                         00260000
002700*                                                                 00270000
002800 01  PC-PROGRAM-CONSTANTS.                                        00280000
002900     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'PC135A  '. 00290000
003000     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'PCKM135 '. 00300000
003100     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'PCKCS135'. 00310000
003200     05  PC-TSYMSG-NUMBERS.                                       00320000
003300         10  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.      00330000
003400         10  PC-TSYMSG-00095       PIC  9(05)  VALUE  00095.      00340000
003500         10  PC-TSYMSG-00224       PIC  9(05)  VALUE  00224.      00350000
003600         10  PC-TSYMSG-00717       PIC  9(05)  VALUE  00717.      00360000
003700*                                                                 00370000
003800 01  PS-PROGRAM-SWITCHES.                                         00380000
003900     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        00390000
004000         88  PS-ERROR                          VALUE  'Y'.        00400000
004100         88  PS-NO-ERROR                       VALUE  'N'.        00410000
004200                                                                  00420000
004300*----------------------------------------------------------------*00430000
004400*    MAP LAYOUT                                                  *00440000
004500*----------------------------------------------------------------*00450000
004600                                                                  00460000
004700     COPY PCKM135.                                                00470000
004800     EJECT                                                        00480000
004900*----------------------------------------------------------------*00490000
005000*    ATTRIBUTE SETTINGS COPYBOOK.                                *00500000
005100*----------------------------------------------------------------*00510000
005200                                                                  00520000
005300     COPY DPWS015.                                                00530000
005400                                                                  00540000
005500*----------------------------------------------------------------*00550000
005600*    FUNCTION KEYS COPYBOOK                                      *00560000
005700*----------------------------------------------------------------*00570000
005800                                                                  00580000
005900     COPY DPWS016.                                                00590000
006000 EJECT                                                            00600000
006100******************************************************************00610000
006200** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **00620000
006300** SUB-ROUTINE (DPKUT100).                                      **00630000
006400******************************************************************00640000
006500     COPY DPWS010I.                                               00650000
006600 EJECT                                                            00660000
006700******************************************************************00670000
006800** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS            **00680000
006900** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **00690000
007000******************************************************************00700000
007100     COPY DPWS030.                                                00710000
1122RM     COPY DPWS930.                                                00711002
007200 EJECT                                                            00720000
007300***************************************************************** 00730000
007400*    STANDARD COMMAREA.                                           00740000
007500***************************************************************** 00750000
007600                                                                  00760000
007700     COPY DPWS020.                                                00770000
007800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                00780000
007900                                                                  00790000
008000***************************************************************** 00800000
008100*    INTER-APPLICATION COMMAREA.                                  00810000
008200***************************************************************** 00820000
008300                                                                  00830000
008400         10  INTER-APPL-COMM-AREA PIC X(200).                     00840000
008500     COPY PCWS000.                                                00850000
008600***************************************************************** 00860000
008700*    SPECIFIC COMMMAREA FOR PCKCS135.                             00870000
008800***************************************************************** 00880000
008900         10  ASC-SPECIFIC-COMMAREA.                               00890000
009000             15  ASC-OPER-UNIT-ID            PIC  9(04).          00900000
009100             15  ASC-FCLTY-ID                PIC  9(04).          00910000
009200             15  ASC-FCLTY-AREA-ID           PIC  X(06).          00920000
009300             15  ASC-OPER-DESC               PIC  X(25).          00930000
009400             15  ASC-FACILITY-QUEUE-NAME     PIC  X(08).          00940000
009500         10  FILLER                          PIC  X(2818).        00950000
009600     EJECT                                                        00960000
009700*----------------------------------------------------------------*00970000
009800*    ABEND PROCESSING COPYBOOK.                                  *00980000
009900*----------------------------------------------------------------*00990000
010000                                                                  01000000
010100     COPY DPWS013.                                                01010000
010200                                                                  01020000
010300                                                                  01030000
010400 EJECT                                                            01040000
010500 LINKAGE SECTION.                                                 01050000
010600                                                                  01060000
010700 01  DFHCOMMAREA.                                                 01070000
010800     05  FILLER                         OCCURS  1 TO 4072 TIMES   01080000
010900                                        DEPENDING ON EIBCALEN.    01090000
011000         10  FILLER                     PIC X.                    01100000
011100                                                                  01110000
011200                                                                  01120000
011300 PROCEDURE DIVISION.                                              01130000
011400***************************************************************** 01140000
011500** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 01150000
011600** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 01160000
011700** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 01170000
011800**                                                             ** 01180000
011900** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 01190000
012000** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 01200000
012100***************************************************************** 01210000
012200 0000-MAIN-MODULE.                                                01220000
012300     INITIALIZE DP030-CICS-API-FIELDS.                            01230000
012400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       01240000
012500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          01250000
012600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         01260000
012700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       01270000
012800     MOVE LENGTH OF PC135AI        TO DP030-MAP-LENGTH (1).       01280000
012900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     01290000
013000     PERFORM 0001-CALL-CICS-ARCH-API.                             01300000
013100*                                                                 01310000
013200     PERFORM 1000-CONTROL-PROCESSING                              01320000
013300*                                                                 01330000
013400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     01340000
013500     PERFORM 0001-CALL-CICS-ARCH-API.                             01350000
013600                                                                  01360000
013700 0001-CALL-CICS-ARCH-API.                                         01370000
1122RM*    CALL 'DPKCS030' USING DFHEIBLK                               01380002
1122RM     CALL DP930-CICS-ARCH-API                                     01382002
1122RM                     USING DFHEIBLK                               01383002
013900                           DFHCOMMAREA                            01390000
014000                           DP030-CICS-API-FIELDS                  01400000
014100                           DP020-STANDARD-COMMAREA                01410000
014200                           PC135AI.                               01420000
014300*                                                                 01430000
014400     IF  DP030-RC-CALL-SUCCESSFUL                                 01440000
014500         CONTINUE                                                 01450000
014600     ELSE                                                         01460000
014700         SET DP013-NO-ROLLBACK                                    01470000
014800             DP013-XCTL-DISPLAY-RESTART                           01480000
014900             DP013-CICS-ABEND      TO TRUE                        01490000
015000         MOVE 'BEFORE 0000-MAIN-MODULE'                           01500000
015100                                   TO DP013-PARAGRAPH             01510000
1122RM*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX01520002
1122RM*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      01530002
1122RM         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O01531002
1122RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      01532002
015400         MOVE DP030-RETURN-CODE                                   01540000
015500                                   TO DP013-MESSAGE-TEXT (3)      01550000
015600         PERFORM DP013-0000-PROCESS-ABEND                         01560000
015700     END-IF.                                                      01570000
015800 EJECT                                                            01580000
015900*----------------------------------------------------------------*01590000
016000*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *01600000
016100*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *01610000
016200*----------------------------------------------------------------*01620000
016300                                                                  01630000
016400 1000-CONTROL-PROCESSING.                                         01640000
016500                                                                  01650000
016600     EVALUATE TRUE                                                01660000
016700         WHEN DP020-NEXT-ACT-INITIAL                              01670000
016800             INITIALIZE ASC-SPECIFIC-COMMAREA                     01680000
016900             PERFORM 4000-BUILD-INITIAL-PANEL                     01690000
017000                                                                  01700000
017100         WHEN DP020-NEXT-ACT-READ-MAP                             01710000
017200             PERFORM 2000-FKEY-PROCESSING                         01720000
017300                                                                  01730000
017400         WHEN DP020-NEXT-ACT-RETURN                               01740000
017500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 01750000
017600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   01760000
017700                                                                  01770000
017800         WHEN OTHER                                               01780000
017900             SET DP013-LOGIC-ABEND                                01790000
018000                 DP013-NO-ROLLBACK TO TRUE                        01800000
018100             MOVE '1000-CONTROL-PROCESSING'                       01810000
018200                                   TO  DP013-PARAGRAPH            01820000
018300             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   01830000
018400                                   TO  DP013-MESSAGE-TEXT(1)      01840000
018500             MOVE DP020-NEXT-APPL-ACTIVITY                        01850000
018600                                   TO DP013-MESSAGE-TEXT(2)       01860000
018700             PERFORM DP013-0000-PROCESS-ABEND                     01870000
018800     END-EVALUATE.                                                01880000
018900                                                                  01890000
019000*----------------------------------------------------------------*01900000
019100* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*01910000
019200* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*01920000
019300* EDITS.                                                         *01930000
019400*----------------------------------------------------------------*01940000
019500                                                                  01950000
019600 2000-FKEY-PROCESSING.                                            01960000
019700                                                                  01970000
019800     EVALUATE TRUE                                                01980000
019900                                                                  01990000
020000         WHEN DP020-SRC-AID = DP016-CLEAR                         02000000
020100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02010000
020200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02020000
020300                                                                  02030000
020400         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     02040000
020500             INITIALIZE ASC-SPECIFIC-COMMAREA                     02050000
020600             PERFORM 4000-BUILD-INITIAL-PANEL                     02060000
020700             PERFORM 3200-RESET-ATTRIBUTES                        02070000
020800                                                                  02080000
020900         WHEN OTHER                                               02090000
021000             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 02100000
021100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02110000
021200             IF  PS-NO-ERROR                                      02120000
021300                 SET DP030-CONTINUE-GO TO TRUE                    02130000
021400                 PERFORM 2100-CHECK-FUNCTION-KEY                  02140000
021500             ELSE                                                 02150000
021600                 SET DP030-OVERRIDE-GO TO TRUE                    02160000
021700             END-IF                                               02170000
021800     END-EVALUATE.                                                02180000
021900******************************************************************02190000
022000** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **02200000
022100** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **02210000
022200** FROM THE CICS ARCHITECTURE API.                              **02220000
022300******************************************************************02230000
022400 2100-CHECK-FUNCTION-KEY.                                         02240000
022500     EVALUATE TRUE                                                02250000
022600         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 02260000
022700             PERFORM 2110-PREPARE-INTER-APPL-COMM                 02270000
022800                                                                  02280000
022900         WHEN DP020-SRC-AID = DP016-ENTER                         02290000
023000             CONTINUE                                             02300000
023100                                                                  02310000
023200         WHEN OTHER                                               02320000
023300             SET DP013-NO-ROLLBACK                                02330000
023400                 DP013-XCTL-DISPLAY-RESTART                       02340000
023500                 DP013-CICS-ABEND  TO TRUE                        02350000
023600             MOVE '2100-CHECK-FUNCTION-KEY'                       02360000
023700                                   TO DP013-PARAGRAPH             02370000
023800             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      02380000
023900                                   TO DP013-MESSAGE-TEXT (1)      02390000
024000             PERFORM DP013-0000-PROCESS-ABEND                     02400000
024100     END-EVALUATE.                                                02410000
024200******************************************************************02420000
024300** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **02430000
024400** INTER-APPLICATION COMMAREA.                                  **02440000
024500******************************************************************02450000
024600 2110-PREPARE-INTER-APPL-COMM.                                    02460000
024700     INITIALIZE PC000-INTER-APPL-COMMAREA.                        02470000
024800     MOVE ASC-OPER-UNIT-ID         TO PC000-OPERATING-UNIT-ID.    02480000
024900     MOVE ASC-FCLTY-ID             TO PC000-FACILITY-ID.          02490000
025000     MOVE ASC-FCLTY-AREA-ID        TO PC000-FACILITY-AREA-ID.     02500000
025100     MOVE ASC-OPER-DESC            TO PC000-OPERATION-DESC.       02510000
025200     MOVE ASC-FACILITY-QUEUE-NAME  TO PC000-FACILITY-QUEUE-NAME.  02520000
025300 EJECT                                                            02530000
025400*----------------------------------------------------------------*02540000
025500* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*02550000
025600* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *02560000
025700* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *02570000
025800*----------------------------------------------------------------*02580000
025900                                                                  02590000
026000 2200-MOVE-SCREEN-TO-COMMAREA.                                    02600000
026100     IF  AFCLTYAL > ZERO                                          02610000
026200         MOVE AFCLTYAI             TO ASC-FCLTY-AREA-ID           02620000
026300     ELSE                                                         02630000
026400         IF  AFCLTYAF = DP015-ERASE-EOF                           02640000
026500             MOVE SPACE            TO ASC-FCLTY-AREA-ID           02650000
026600         END-IF                                                   02660000
026700     END-IF.                                                      02670000
026800                                                                  02680000
026900     IF  AOPDESCL > ZERO                                          02690000
027000         MOVE AOPDESCI             TO ASC-OPER-DESC               02700000
027100     ELSE                                                         02710000
027200         IF  AOPDESCF = DP015-ERASE-EOF                           02720000
027300             MOVE SPACE            TO ASC-OPER-DESC               02730000
027400         END-IF                                                   02740000
027500     END-IF.                                                      02750000
027600*----------------------------------------------------------------*02760000
027700* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *02770000
027800* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *02780000
027900* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*02790000
028000* IN THE DESTINATION PROGRAM, NOT HERE.                          *02800000
028100*----------------------------------------------------------------*02810000
028200                                                                  02820000
028300 3000-EDIT-DATA-IN-COMMAREA.                                      02830000
028400     PERFORM 3200-RESET-ATTRIBUTES.                               02840000
028500*                                                                 02850000
028600     IF  ASC-FCLTY-AREA-ID > SPACES AND ASC-OPER-DESC > SPACES    02860000
028700         SET PS-ERROR                                             02870000
028800             DP020-MSG-FATAL   TO TRUE                            02880000
028900         MOVE PC-TSYMSG-00717  TO DP020-MSG-NUMBER                02890000
029000         MOVE DP015-UNP-ALP-BRT-OFF                               02900000
029100                               TO AFCLTYAA                        02910000
029200                                  AOPDESCA                        02920000
029300         MOVE DP015-RED        TO AFCLTYAC                        02930000
029400                                  AOPDESCC                        02940000
029500         MOVE DP015-REVERSE    TO AFCLTYAH                        02950000
029600                                  AOPDESCH                        02960000
029700         MOVE -1               TO AFCLTYAL                        02970000
029800                                  AOPDESCL                        02980000
029900         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      02990000
030000     END-IF.                                                      03000000
030100*                                                                 03010000
030200     IF  PS-NO-ERROR                                              03020000
030300         MOVE -1                   TO AFCLTYAL                    03030000
030400         SET DP030-SET-CURSOR-APPL-1                              03040000
030500                                   TO TRUE                        03050000
030600     END-IF.                                                      03060000
030700******************************************************************03070000
030800** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **03080000
030900** MAP.                                                         **03090000
031000******************************************************************03100000
031100 3200-RESET-ATTRIBUTES.                                           03110000
031200     MOVE DP015-PRO-NOR-OFF        TO AOPERIDA                    03120000
031300                                      AFCLTYIA.                   03130000
031400     MOVE DP015-UNP-ALP-NOR-OFF    TO AFCLTYAA                    03140000
031500                                      AOPDESCA.                   03150000
031600     MOVE DP015-BLUE               TO AOPERIDC                    03160000
031700                                      AFCLTYIC.                   03170000
031800     MOVE DP015-GREEN              TO AFCLTYAC                    03180000
031900                                      AOPDESCC.                   03190000
032000     MOVE DP015-UNDERLINE          TO AFCLTYAH                    03200000
032100                                      AOPDESCH.                   03210000
032200*                                                                 03220000
032300*----------------------------------------------------------------*03230000
032400*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *03240000
032500*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *03250000
032600*  IT HERE.                                                      *03260000
032700*----------------------------------------------------------------*03270000
032800 4000-BUILD-INITIAL-PANEL.                                        03280000
032900     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        03290000
033000     MOVE -1                       TO AFCLTYAL.                   03300000
033100     MOVE PC000-FACILITY-QUEUE-NAME TO ASC-FACILITY-QUEUE-NAME.   03310000
033200     MOVE PC000-OPERATING-UNIT-ID  TO AOPERIDO                    03320000
033300                                      ASC-OPER-UNIT-ID.           03330000
033400     MOVE PC000-FACILITY-ID        TO AFCLTYIO                    03340000
033500                                      ASC-FCLTY-ID.               03350000
033600*                                                                 03360000
033700*----------------------------------------------------------------*03370000
033800*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *03380000
033900*----------------------------------------------------------------*03390000
034000 4400-MOVE-COMMAREA-TO-SCREEN.                                    03400000
034100     MOVE ASC-OPER-UNIT-ID         TO AOPERIDO.                   03410000
034200     MOVE ASC-FCLTY-ID             TO AFCLTYIO.                   03420000
034300     MOVE ASC-FCLTY-AREA-ID        TO AFCLTYAO.                   03430000
034400     MOVE ASC-OPER-DESC            TO AOPDESCO.                   03440000
034500 EJECT                                                            03450000
034600*----------------------------------------------------------------*03460000
034700*    ABEND PROCESSOR MODULE                                      *03470000
034800*----------------------------------------------------------------*03480000
034900                                                                  03490000
035000     COPY DPPD013.                                                03500000
