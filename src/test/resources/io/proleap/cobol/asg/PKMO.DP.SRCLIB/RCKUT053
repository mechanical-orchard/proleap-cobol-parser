000100******************************************************************        
000200 IDENTIFICATION DIVISION.                                                 
000300******************************************************************        
000400                                                                          
000500 PROGRAM-ID.             RCKUT053.                                        
000600 AUTHOR.                 STEPHANIE HERON.                                 
000700 INSTALLATION.           KOHLS.                                           
000800 DATE-WRITTEN            JULY 1997.                                       
000900 DATE-COMPILED.                                                           
001000                                                                          
001100******************************************************************        
001200*  THE PURPOSE OF THIS ROLL THE BATCH PROCESS DATE TO THE NEXT DAY        
001500******************************************************************        
001600 ENVIRONMENT DIVISION.                                                    
001700                                                                          
001800 CONFIGURATION SECTION.                                                   
001900                                                                          
002000 SOURCE-COMPUTER.        IBM-3090.                                        
002100 OBJECT-COMPUTER.        IBM-3090.                                        
002200                                                                          
002300 INPUT-OUTPUT SECTION.                                                    
002400                                                                          
002500 FILE-CONTROL.                                                            
002600                                                                          
002700     SELECT CONTROL-CARD-FILE                                             
002800         ASSIGN TO IN01.                                                  
002900                                                                          
003000******************************************************************        
003100 DATA DIVISION.                                                           
003200******************************************************************        
003300                                                                          
003400 FILE SECTION.                                                            
003500                                                                          
003600 FD  CONTROL-CARD-FILE                                                    
003700     RECORDING MODE IS F                                                  
003800     BLOCK CONTAINS 0 RECORDS                                             
003900     LABEL RECORDS ARE STANDARD.                                          
004000                                                                          
004100 01  CONTROL-CARD-REC                    PIC X(80).                       
004110                                                                          
004300******************************************************************        
004400 WORKING-STORAGE SECTION.                                                 
004500******************************************************************        
004600                                                                          
004700 01  ABEND-CODE                          PIC S9(04)  VALUE +0             
004800                                                     COMP SYNC.           
004900*                                                                         
005000 01  PC-PROGRAM-CONSTANTS.                                                
005100     05  PC-MAX-RETRIES                  PIC S9(04)  VALUE +3             
005200                                                     COMP SYNC.           
005300     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE                
005400                                                     'RCKUT053'.          
005500     05  PC-TYPE-CODE-LONG-NAME          PIC  X(02)  VALUE '01'.          
005510     05  PC-CURRENT-DATE                 PIC  X(10)  VALUE SPACES.        
005520     05  PC-NEXT-DAY                     PIC  X(10)  VALUE SPACES.        
005530     05  PC-PREV-DAY                     PIC  X(10)  VALUE SPACES.        
005600*                                                                         
005700 01  PV-PROGRAM-VARIABLES.                                                
005800     05  PV-OPEN-COUNTER                 PIC S9(04)  VALUE ZERO           
005900                                                     COMP SYNC.           
006000     05  PV-CLOSE-COUNTER                PIC S9(04)  VALUE ZERO           
006100                                                     COMP SYNC.           
006200     05  PV-RETRY-COUNTER                PIC S9(04)  VALUE ZERO           
006300                                                     COMP SYNC.           
006400     05  PV-SELECT-COUNTER               PIC S9(04)  VALUE ZERO           
006500                                                     COMP SYNC.           
006600     05  PV-VFYD-UNIT-CNT                PIC S9(09)  VALUE ZERO           
006700                                                     COMP SYNC.           
006800     05  PV-UNIT-RETAIL-AMT              PIC S9(07)V99 VALUE ZERO         
006900                                                     COMP-3.              
007000     05  PV-TOT-UNIT-RETAIL-AMT          PIC S9(07)V99 VALUE ZERO         
007100                                                     COMP-3.              
007200     05  PV-UNIT-COST-AMT                PIC S9(07)V99 VALUE ZERO         
007300                                                     COMP-3.              
007400     05  PV-TOT-UNIT-COST-AMT            PIC S9(07)V99 VALUE ZERO         
007500                                                     COMP-3.              
007600     05  PV-RCVR-RECS-WRITTEN            PIC  9(07)  VALUE ZERO           
007700                                                     COMP-3.              
007800     05  PV-PARAGRAPH-NAME               PIC  X(30)  VALUE SPACES.        
007900     05  PV-DB2-OPERATION-MESSAGE-1      PIC  X(79)  VALUE SPACES.        
008000     05  PV-DB2-OPERATION-MESSAGE-2      PIC  X(79)  VALUE SPACES.        
008100     05  PV-DB2-OPERATION-MESSAGE-3      PIC  X(79)  VALUE SPACES.        
008200     05  PV-DB2-OPERATION-MESSAGE-4      PIC  X(79)  VALUE SPACES.        
008300     05  PV-DB2-TABLE-NAME-1             PIC  X(18)  VALUE SPACES.        
008400     05  PV-DB2-TABLE-NAME-2             PIC  X(18)  VALUE SPACES.        
008500     05  PV-DB2-TABLE-NAME-3             PIC  X(18)  VALUE SPACES.        
008600     05  PV-ERROR-MESSAGE-1              PIC  X(60)  VALUE SPACES.        
008700     05  PV-ERROR-MESSAGE-2              PIC  X(60)  VALUE SPACES.        
008800     05  PV-ERROR-MESSAGE-3              PIC  X(60)  VALUE SPACES.        
008900     05  PV-ERROR-PO-NBR                 PIC  9(07)  VALUE ZEROS.         
009000     05  PV-ERROR-REC-SEQ-NBR            PIC  9(04)  VALUE ZEROS.         
009100     05  PV-ERROR-PO-LNE-NBR             PIC  9(04)  VALUE ZEROS.         
009200                                                                          
009300     05  PV-DATE-OUT                     PIC  9(06)  VALUE ZEROS.         
009400     05  PV-DATE-OUT-R                   REDEFINES                        
009500         PV-DATE-OUT.                                                     
009600         10  PV-DATE-OUT-MONTH           PIC  9(02).                      
009700         10  PV-DATE-OUT-DAY             PIC  9(02).                      
009800         10  PV-DATE-OUT-YEAR            PIC  9(02).                      
009900                                                                          
010000 01  PS-PROGRAM-SWITCHES.                                                 
010001     05  PS-END-OF-JOURNAL-RCVRS-SW      PIC X(01)   VALUE 'N'.           
010010         88  PS-END-OF-JOURNAL-RCVRS                 VALUE 'Y'.           
010300     05  PS-END-OF-TRECITM-CSR-SW        PIC X(01)   VALUE 'N'.           
010400         88  PS-END-OF-TRECITM-CSR                   VALUE 'Y'.           
010500         88  PS-NOT-END-OF-TRECITM-CSR               VALUE 'N'.           
010600*                                                                         
010700 01  CONTROL-CARD-LAYOUT.                                                 
010800     05  CONTROL-DATE                    PIC X(10).                       
010810         88  DEFAULT-DATE                     VALUE '9999-09-09'.         
010900                                                                          
011400******************************************************************        
011500*  DB2 FORMATTED MESSAGE AREA                                             
011600******************************************************************        
011700     COPY DPWS004.                                                        
011800*                                                                         
011900*                                                                         
012000******************************************************************        
012100*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE COMPANY CONTROL            
012110*  TABLE                                                                  
012200******************************************************************        
012300     EXEC SQL                                                             
012400          INCLUDE TCOCNTL                                                 
012500     END-EXEC.                                                            
018100******************************************************************        
018200*  COMMUNICATIONS AREA FOR DB2                                            
018300******************************************************************        
018400     EXEC SQL                                                             
018500          INCLUDE SQLCA                                                   
018600     END-EXEC.                                                            
018700*                                                                         
018800*                                                                         
023300 PROCEDURE DIVISION.                                                      
023400                                                                          
023500******************************************************************        
023600*  0000-INITIAL-ROUTINE  -  MAIN LINE OF THE PROGRAM PERFORMS THE         
023700*  INITIALIZATION ROUTINE AND CONTROLS THE PROCESSING OF THE PGM.         
023800******************************************************************        
023900                                                                          
024000 0000-MAINLINE.                                                           
024100                                                                          
024200     PERFORM 0100-HOUSEKEEPING.                                           
024300                                                                          
024800     PERFORM 1100-PROCESS.                                                
025000                                                                          
025700     STOP RUN.                                                            
025800                                                                          
025900 0100-HOUSEKEEPING.                                                       
026000                                                                          
026100     OPEN INPUT  CONTROL-CARD-FILE.                                       
026101                                                                          
026110     READ CONTROL-CARD-FILE                                               
026120       INTO CONTROL-CARD-LAYOUT.                                          
026200                                                                          
026300     PERFORM 1010-GET-DATES.                                              
026400                                                                          
066610 1010-GET-DATES.                                                          
067300                                                                          
067400     EXEC SQL                                                             
067500          SELECT CURRENT DATE                                             
067600                ,CURRENT DATE  + 1 DAY                                    
067700                ,CURRENT DATE  - 1 DAY                                    
067710                ,BTCH_PRC_DTE  + 1 DAY                                    
067800          INTO  :PC-CURRENT-DATE                                          
067900               ,:PC-NEXT-DAY                                              
068000               ,:PC-PREV-DAY                                              
068010               ,:COCNTL-BTCH-PRC-DTE                                      
068100          FROM   TCOCNTL                                                  
068700     END-EXEC.                                                            
068800                                                                          
068900     EVALUATE TRUE                                                        
069000         WHEN SQLCODE = ZERO                                              
069010         WHEN SQLCODE = -811                                              
069100              CONTINUE                                                    
069400         WHEN SQLWARN0 NOT = SPACE                                        
069500         WHEN SQLCODE NOT = ZERO                                          
069600             MOVE '2500-GET-DATES    '                                    
069700                                 TO PV-PARAGRAPH-NAME                     
069800             MOVE 'SELECT DATES FROM COMPANY CONTROL TABLE'               
069900                                 TO PV-DB2-OPERATION-MESSAGE-1            
071400             MOVE 'TCOCNTL'      TO PV-DB2-TABLE-NAME-1                   
071500             PERFORM 9100-DB2-ABEND                                       
071600     END-EVALUATE.                                                        
071800                                                                          
071900 1100-PROCESS.                                                            
072000                                                                          
072001     EVALUATE TRUE                                                        
072002         WHEN DEFAULT-DATE                                                
072010           IF  COCNTL-BTCH-PRC-DTE > PC-NEXT-DAY OR                       
072020               COCNTL-BTCH-PRC-DTE < PC-PREV-DAY                          
072021                 DISPLAY '** ABEND                            **'         
072022                 DISPLAY '** PROGRAM    = RCKUT053            **'         
072024                 DISPLAY '** PROCESS DATE NOT WITHIN +-1 DAY  **'         
072025                 DISPLAY '** PC-CURRENT-DATE = ' PC-CURRENT-DATE          
072026                 DISPLAY '** PC-NEXT-DAY     = ' PC-NEXT-DAY              
072027                 DISPLAY '** PC-PREV-DAY     = ' PC-PREV-DAY              
072028                 DISPLAY '** BATCH PROCESS   = '                          
072029                                             COCNTL-BTCH-PRC-DTE          
072030                 MOVE +4002 TO ABEND-CODE                                 
072031                 CALL 'ILBOABN0' USING ABEND-CODE                         
072040           ELSE                                                           
072050               PERFORM 1200-UPDATE-TCOCNTL                                
072060           END-IF                                                         
072070         WHEN OTHER                                                       
072080           MOVE CONTROL-DATE TO COCNTL-BTCH-PRC-DTE                       
072090           PERFORM 1200-UPDATE-TCOCNTL                                    
072091     END-EVALUATE.                                                        
072092                                                                          
072093                                                                          
072500 1200-UPDATE-TCOCNTL.                                                     
072600                                                                          
072700     EXEC SQL                                                             
072800          UPDATE TCOCNTL                                                  
072810                 SET BTCH_PRC_DTE = :COCNTL-BTCH-PRC-DTE                  
072890     END-EXEC.                                                            
072891                                                                          
072892     EVALUATE TRUE                                                        
072893         WHEN SQLCODE = ZERO                                              
072895              CONTINUE                                                    
072896         WHEN SQLWARN0 NOT = SPACE                                        
072897         WHEN SQLCODE NOT = ZERO                                          
072898             MOVE '1200-UPDATE-TCOCNTL'                                   
072899                                 TO PV-PARAGRAPH-NAME                     
072900             MOVE 'ERROR UPDATING THE BTCH PROCESS DATE   '               
072901                                 TO PV-DB2-OPERATION-MESSAGE-1            
072902             MOVE 'TCOCNTL'      TO PV-DB2-TABLE-NAME-1                   
072903             PERFORM 9100-DB2-ABEND                                       
072904     END-EVALUATE.                                                        
072905                                                                          
072910 9100-DB2-ABEND.                                                          
073000******************************************************************        
073100*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL            
073200*  ERROR OR WARNING CODE OCCURS.                                          
073300******************************************************************        
073400     DISPLAY '9100-DB2-ABEND'.                                            
073500     DISPLAY '** ABEND           **'.                                     
073600     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.          
073700     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.                
073800     DISPLAY '** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME-1.              
073900     DISPLAY '**                 ** = ' PV-DB2-TABLE-NAME-2.              
074000     DISPLAY '**                 ** = ' PV-DB2-TABLE-NAME-3.              
074100     DISPLAY '** OPERATION       ** = ' PV-DB2-OPERATION-MESSAGE-1        
074200     DISPLAY '**                 ** = ' PV-DB2-OPERATION-MESSAGE-2        
074300     DISPLAY '**                 ** = ' PV-DB2-OPERATION-MESSAGE-3        
074400     DISPLAY '**                 ** = ' PV-DB2-OPERATION-MESSAGE-4        
074500     DISPLAY '**                 ** = '                                   
074600                                                                          
074700******************************************************************        
074800* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-            
074900* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE                 
075000* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE             
075100* FORMAT.                                                                 
075200******************************************************************        
075300     COPY DPPD004.                                                        
075400                                                                          
075500     MOVE +4013                  TO ABEND-CODE.                           
075600     CALL 'ILBOABN0' USING ABEND-CODE.                                    
