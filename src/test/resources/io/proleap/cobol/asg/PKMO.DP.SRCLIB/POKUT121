000100 ID  DIVISION.                                                    00010009
000200 PROGRAM-ID.         POKUT121.                                    00020009
000300 AUTHOR.             COGNIZANT.                                   00030009
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040009
000500 DATE-WRITTEN.       04/2010.                                     00050009
000600 DATE-COMPILED.                                                   00060009
000700                                                                  00070009
000800******************************************************************00080009
000900*     PURCHASE ORDER/RECEIPTS EXTRACT                             00090009
001000******************************************************************00100009
001100*     CHANGE LOG                                                  00110009
001200******************************************************************00120009
001300* 03/22/10 MADE BY: COGNIZANT               WR/IR #: 2344         00130009
001400* CHANGES:                                                        00140009
001500*                                                                 00150009
001600*     THIS PROGRAM HAS THE FOLLOWING CHANGES AS PART OF EP.       00160009
001700*                                                                 00170009
001800*     1.EXTRACTS THE ACTIVE OPEN ORDERS ,CREATES A                00180009
001900*       ACTIVE PO EXTRACT BY PRODUCT,ORGANIZATION AND WEEK        00190009
002000*       LEVEL INSTEAD OF PRODUCT AND MONTH LEVEL.                 00200009
002100*                                                                 00210009
002200*     2.EXTRACTS THE RECEIPTS,CREATES THE RECEIPT EXTRACT         00220009
002300*       FOR THE CURRENT FISCAL WEEK BY PRODUCT,ORGANIZATION       00230009
002400*       AND WEEK LEVEL INSTEAD OF PRODUCT AND MONTH LEVEL.        00240009
002500*                                                                 00250009
002600*     3.THIS ALSO CREATES A EARLY RECEIPT CATEGORY DATA           00260009
002700*       IN THE RECEIPT FILE,ALONG WITH THE REGULAR RECEIPT DATA.  00270009
002800*       EARLY RECEIPT IS THOSE ORDERS SHIPPED BEFORE THE          00280009
002900*       OPEN TO BUY DATE.                                         00290009
003000*                                                                 00300009
003100*     3.AS PART OF PERFORMANCE RECOMMENDATION CHANGES-CHANGED     00310009
003200*       THE DRIVING CURSOR QUERY,AND ALSO THE LOGIC RELATED TO    00320009
003300*       THE TDTATTR TABLE.                                        00330009
003400******************************************************************00340009
003500* 04/12/12 MADE BY: COGNIZANT               WR/IR #: CRQ 23538    00350009
003600* CHANGES: CHANGED RECORD LAYOUT FOR PO RECORDS AND PO RECEIPT    00360009
003700* RECORDS. STARTED EXTRACTING CREATED BY UID FROM TPURCHS TABLE.  00370009
003800******************************************************************00380009
003900* 07/18/12 MADE BY: COGNIZANT               WR/IR #: CRQ 29188    00390009
004000* CHANGES: CHANGED RECORD LAYOUT FOR PO RECORDS. STARTED          00400009
004100* EXTRACTING WEEK DATA FROM TDTATTR TABLE.                        00410009
004200******************************************************************00420009
RECLSS* 05/16/14 MADE BY: COGNIZANT               WR/IR #: PRB 46230    00430009
RECLSS* CHANGES: MODIFIED THE DRIVING CURSOR AND RECLASS RECEIPT CURSOR 00440009
RECLSS* TO USE THE PO CREATION DATE INSTEAD OF MONTH START DATE WHILE   00450009
RECLSS* CHECKING FOR RECLASS CONDITION.                                 00460009
RECLSS* MODIFIED THE RECLASS CURSOR TO GET THE NEW DEPT NUMBER WHEN THE 00470009
RECLSS* SKU UNDER THE PO WAS RECLASSIFIED BEFORE IT IS VERIFIED.        00480009
RECLSS******************************************************************00490009
C98147* 11/04/14 MADE BY: LINDA FRIESS            CHG0098147            00500009
C98147* CHANGES: RECOMPILED TO BRING IN POWS010 & POWS016 COPYBOOKS     00510009
C98147*          WITH EXPANDED PO NUMBER & REPLACED HARD-CODED          00520009
C98147*          REFERENCES TO POWS010 E-BUS-IND                        00530009
C98147***************************************************************** 00540009
      * 10/23/15 MADE BY: COGNIZANT               WR/IR #:CHG0126740    00550009
      * CHANGES: MODIFIED THE RECLASS RECEIPT CURSOR TO GET THE NEW     00560009
      * DEPT NUMBER FROM VENDOR STYLE TABLE WHEN THE SKU UNDER THE PO   00570009
      * WAS RECLASSIFIED BEFORE IT WAS VERIFIED.                        00580009
      ******************************************************************00590009
11752A* 06/06/17 MADE BY: J SELWITSCHKA           WR/IR #:              00600009
11752A* CHANGES: MODIFIED THE PULL DATA FOR LATEST WEEK ONLY INSTEAD OF 00610009
11752A* MONTH TO DATE.                                                  00620009
11752A******************************************************************00630009
11752A* 06/23/17 MADE BY: J SELWITSCHKA                                 00640009
11752A* CHANGES: NEW VERSION POKUT121 IS A COPY OF POKUT118 WITH EP     00650009
11752A*       UPGRADE CHANGES. CREATED BECAUSE EP UPGRADE VERSION       00660009
11752A*       WILL BE RUNNING IN PARALLEL WITH OLD VERSION.             00670009
11752A******************************************************************00680009
C87519* 01/19/18 MADE BY: COGNIZANT               WR/IR #:PRB 68153     00690009
C87519* CHANGES: ADDED ORDER BY KY_DTE TO DATE_CURSOR SO THAT SEARCH    00700009
C87519*          ALL WOULDN'T BE AFFECTED DUE TO NEW TDTATTR INSERT.    00710009
C87519*          THIS WAS ADDED TO PREVENT POK125 FAILURE IF TDTATTR    00720009
C87519*          ROWS ARE NOT IN ORDER.                                 00730009
C87519******************************************************************00740009
217030* 01/31/19 MADE BY: JIM HUNTER              CHG0217030            00750009
217030*     MAINFRAME REFACTORING - DB2 LUW HANDLES CALLS WITH          00760009
217030*     CHAR FORMATTING DIFFERENTLY THAN THE MAINFRAME VERSION      00770009
217030*     OF DB2.  REPLACING THE CHAR FORMATTING WITH DIGITS.         00780009
217030*     SINCE CHAR RETURNS A LEADING SPACE AND TRAILING DECIMAL     00790009
217030*     POINT AND DIGITS DOESN'T THE POSITIONAL PARMS IN THE CALL   00800009
217030*     MUST BE SHIFTED ONE TO THE LEFT.                            00810009
217030*     SEE RCL_RECEIPT_CURSOR.                                     00820009
217030******************************************************************00830009
248808* 09/15/20 MADE BY: SRINIVASAN SIVARAJ      CHG0248808            00832011
248808*     ADDED ONE NEW CONDITION IN ACTIVE_PO_CURSOR TO INCREASE THE 00833011
248808*     DB2 PERFORMANCE OF THE PROGRAM                              00834011
217030******************************************************************00839111
004300                                                                  00840009
004400 ENVIRONMENT DIVISION.                                            00850009
004500*                                                                 00860009
004600 CONFIGURATION SECTION.                                           00870009
004700*                                                                 00880009
004800 SOURCE-COMPUTER.        IBM-3090.                                00890009
004900 OBJECT-COMPUTER.        IBM-3090.                                00900009
005000*                                                                 00910009
005100 INPUT-OUTPUT SECTION.                                            00920009
005200 FILE-CONTROL.                                                    00930009
005300     SELECT  ACTIVE-PO-FILE                                       00940009
005400         ASSIGN TO OUT01.                                         00950009
005500                                                                  00960009
005600     SELECT  RECEIPTS-FILE                                        00970009
005700         ASSIGN TO OUT02.                                         00980009
005800                                                                  00990009
005900     SELECT  MONTH-RECEIPTS-FILE                                  01000009
006000         ASSIGN TO OUT03.                                         01010009
006100                                                                  01020009
006200     SELECT  CNTL-DEF-RCPTS-FILE                                  01030009
006300         ASSIGN TO INP01.                                         01040009
006400                                                                  01050009
006500 DATA DIVISION.                                                   01060009
006600 FILE SECTION.                                                    01070009
006700*                                                                 01080009
006800 FD  CNTL-DEF-RCPTS-FILE                                          01090009
006900     RECORDING  MODE IS F                                         01100009
007000     LABEL RECORDS ARE STANDARD                                   01110009
007100     BLOCK CONTAINS 0 RECORDS.                                    01120009
007200 01  CNTL-DEF-RCPTS-REC           PIC X(80).                      01130009
007300                                                                  01140009
007400 FD  ACTIVE-PO-FILE                                               01150009
007500     RECORDING MODE IS F                                          01160009
007600     LABEL RECORDS ARE STANDARD                                   01170009
007700     BLOCK CONTAINS 0 RECORDS.                                    01180009
007800 01  ACTIVE-PO-RECORD             PIC X(210).                     01190009
007900*                                                                 01200009
008000 FD  RECEIPTS-FILE                                                01210009
008100     RECORDING MODE IS F                                          01220009
008200     LABEL RECORDS ARE STANDARD                                   01230009
008300     BLOCK CONTAINS 0 RECORDS.                                    01240009
008400 01  RECEIPTS-RECORD              PIC X(108).                     01250009
008500*                                                                 01260009
008600 FD  MONTH-RECEIPTS-FILE                                          01270009
008700     RECORDING MODE IS F                                          01280009
008800     LABEL RECORDS ARE STANDARD                                   01290009
008900     BLOCK CONTAINS 0 RECORDS.                                    01300009
009000 01  MONTH-RECEIPTS-RECORD        PIC X(210).                     01310009
009100*                                                                 01320009
009200                                                                  01330009
009300 WORKING-STORAGE SECTION.                                         01340009
009400*                                                                 01350009
009500 01  PC-PROGRAM-CONSTANTS.                                        01360009
009600     05  PC-MAX-RETRIES           PIC S9(03)  VALUE +03           01370009
009700                                              COMP-3.             01380009
009800     05  PC-EMPTY-DATE            PIC X(10)   VALUE '0001-01-01'. 01390009
009900     05  PC-ALL-NINES             PIC X(10)   VALUE '9999-09-09'. 01400009
010000     05  PC-NULL-TMST             PIC X(26)  VALUE                01410009
010100                                 '9999-09-09-09.09.09.999999'.    01420009
010200     05  PV-MIN-VERFYD-TMST       PIC  X(26).                     01430009
010300     05  PV-MIN-VERFYD-TMST-IND   PIC  S9(04)  COMP VALUE ZERO.   01440009
010400     05  PV-DB2-DATE              PIC  X(10).                     01450009
010500     05  PC-APLSYS-CDE            PIC X(02)   VALUE 'OB'.         01460009
010600     05  PC-MDSELV-CDE            PIC X(03)   VALUE 'DPT'.        01470009
010700     05  PC-DEST-0                PIC 9(04)   VALUE 0000.         01480009
010800     05  E-BUS-NULL-IND           PIC S9(04)  COMP VALUE ZERO.    01490009
010900     05  WS-PREV-RECEIV-ORD-NBR   PIC S9(9)   COMP VALUE ZEROES.  01500009
011000     05  WS-PREV-RECEIV-REC-SEQ-NBR PIC S9(9)   COMP VALUE ZEROES.01510009
011100     05  WS-PREV-RECITM-ORD-LNE-NBR PIC S9(9)   COMP VALUE ZEROES.01520009
           05  WS-VERFYD-TMST-DATE        PIC X(10).                    01530009
011200     05  WS-FIRST-RCVD-DATE.                                      01540009
011300        10  WS-RCVD-YEAR          PIC 9(02).                      01550009
011400        10  WS-RCVD-MONTH         PIC 9(02).                      01560009
011500        10  WS-RCVD-DAY           PIC 9(02).                      01570009
011600     05  WS-FIRST-RCVD-DATE-CHAR.                                 01580009
011700        10  WS-RCVD-CENT-CHAR     PIC X(02).                      01590009
011800        10  WS-RCVD-YEAR-CHAR     PIC X(02).                      01600009
011900        10  FILLER                PIC X(01)   VALUE '-'.          01610009
012000        10  WS-RCVD-MONTH-CHAR    PIC X(02).                      01620009
012100        10  FILLER                PIC X(01)   VALUE '-'.          01630009
012200        10  WS-RCVD-DAY-CHAR      PIC X(02).                      01640009
012300     05  FETCH-COUNT              PIC 9(09)   VALUE 0.            01650009
012400     05  FETCH-COUNT-RCLS         PIC 9(09)   VALUE 0.            01660009
012500*                                                                 01670009
012600 01  ST-SYSTEM-TIME               PIC X(26)   VALUE SPACE.        01680009
012700 01  SD-SYSTEM-DATE                           VALUE ZERO.         01690009
012800     05  SD-SYSTEM-YEAR           PIC  9(02).                     01700009
012900     05  SD-SYSTEM-MONTH          PIC  9(02).                     01710009
013000     05  SD-SYSTEM-DAY            PIC  9(02).                     01720009
013100*                                                                 01730009
013200 01  SD-SYSTEM-DATE-CENT                      VALUE ZERO.         01740009
013300     05  SD-SYSTEM-CENT-CC        PIC  9(02).                     01750009
013400     05  SD-SYSTEM-CENT-YY        PIC  9(02).                     01760009
013500     05  SD-SYSTEM-CENT-MM        PIC  9(02).                     01770009
013600     05  SD-SYSTEM-CENT-DD        PIC  9(02).                     01780009
013700*                                                                 01790009
013800 01  CC-CONTROL-CARD.                                             01800009
013900     05  CC-CALENDAR-TYPE         PIC X(02)   VALUE SPACES.       01810009
014000     05  FILLER                   PIC X(01)   VALUE SPACES.       01820009
014100     05  CC-DATE.                                                 01830009
014200         10  CC-MM                PIC 9(02)   VALUE ZEROES.       01840009
014300         10  CC-DD                PIC 9(02)   VALUE ZEROES.       01850009
014400         10  CC-CC                PIC 9(02)   VALUE ZEROES.       01860009
014500         10  CC-YY                PIC 9(02)   VALUE ZEROES.       01870009
014600     05  FILLER                   PIC X(71)   VALUE SPACES.       01880009
014700*                                                                 01890009
014800 01  PV-PROGRAM-VARIABLES.                                        01900009
014900     05  PV-ALLPLN-DEST-NBR       PIC S9(4)   VALUE ZERO COMP.    01910009
015000     05  PV-ALL-ZEROS             PIC X(100)  VALUE ALL '0'.      01920009
015100     05  PV-START-DATE            PIC X(10)   VALUE SPACE.        01930009
015200     05  PV-START-ALL-DATE        PIC X(10)   VALUE SPACE.        01940009
015300     05  PV-START-DATE-3          PIC X(10).                      01950009
015400     05  PV-END-DATE              PIC X(10).                      01960009
015500     05  PV-PARAGRAPH-NAME        PIC X(30)   VALUE SPACE.        01970009
015600     05  PV-DB2-OPER-ATTEMPTED    PIC X(30)   VALUE SPACE.        01980009
015700     05  PV-SQL-SUB               PIC S9(4)   VALUE ZERO  COMP.   01990009
015800     05  PV-HOLD-PURITM-UNT-QTY   PIC 9(09)   VALUE ZERO.         02000009
015900     05  PV-HOLD-UNIT-RTL         PIC S9(9)V99                    02010009
016000                                              VALUE ZERO COMP-3.  02020009
016100     05  PV-UNIT-RTL              PIC S9(9)V99                    02030009
016200                                              VALUE ZERO COMP-3.  02040009
016300     05  PV-PURITM-APP-PO-LNE-NBR PIC  S9(9)  COMP.               02050009
016400     05  PV-VERIFIED-DATE.                                        02060009
016500         10  PV-VERIFIED-CC       PIC X(02)   VALUE SPACES.       02070009
016600         10  PV-VERIFIED-YY       PIC X(02)   VALUE SPACES.       02080009
016700         10  PV-VERIFIED-MM       PIC X(02)   VALUE SPACES.       02090009
016800     05  PV-TEMP-ISO-DATE.                                        02100009
016900         10  PV-TEMP-ISO-CC       PIC X(02)   VALUE SPACES.       02110009
017000         10  PV-TEMP-ISO-YY       PIC X(02)   VALUE SPACES.       02120009
017100         10  FILLER               PIC X(01)   VALUE SPACES.       02130009
017200         10  PV-TEMP-ISO-MM       PIC X(02)   VALUE SPACES.       02140009
017300         10  FILLER               PIC X(01)   VALUE SPACES.       02150009
017400         10  PV-TEMP-ISO-DD       PIC X(02)   VALUE SPACES.       02160009
017500     05  PV-DPT-TABLE.                                            02170009
017600         10  PV-DPT-ENTRY         OCCURS 500 TIMES                02180009
017700                                  INDEXED BY PV-DPT-INDEX.        02190009
017800             15  PV-DPT-NBR       PIC X(003).                     02200009
017900             15  PV-DPT-DESC      PIC X(025).                     02210009
018000             15  PV-OPERCO-NBR    PIC X(002).                     02220009
018100             15  PV-DPT-DMA-NBR   PIC X(002).                     02230009
018200             15  PV-DPT-DMA-LAST-NAME                             02240009
018300                                  PIC X(018).                     02250009
018400             15  PV-DPT-DMA-FIR-NAME                              02260009
018500                                  PIC X(012).                     02270009
018600             15  PV-DPT-GMA-NBR   PIC X(002).                     02280009
018700             15  PV-DPT-GMA-LAST-NAME                             02290009
018800                                  PIC X(018).                     02300009
018900             15  PV-DPT-GMA-FIR-NAME                              02310009
019000                                  PIC X(012).                     02320009
019100     05  PV-START-TMESTAMP        PIC X(26).                      02330009
019200     05  PV-END-TMESTAMP          PIC X(26).                      02340009
019300     05  PV-ML-START-TMESTAMP     PIC X(26).                      02350009
019400     05  PV-ML-END-TMESTAMP       PIC X(26).                      02360009
019500     05  PV-STORE-NBR             PIC 9(04).                      02370009
019600     05  PV-STORE-NBR-X  REDEFINES                                02380009
019700         PV-STORE-NBR             PIC X(04).                      02390009
019800     05  PV-STR-DC-NBR            PIC S9(04) COMP.                02400009
019900*                                                                 02410009
020000     05  PV-STR-TABLE.                                            02420009
020100         10  PV-STR-ENTRY         OCCURS 2000 TIMES               02430009
020200                                  INDEXED BY PV-STR-INDEX.        02440009
020300             15  PV-STORE-NMBR    PIC X(004).                     02450009
020400             15  PV-DC-NMBR       PIC X(004).                     02460009
020500*                                                                 02470009
020600     05  PV-MAJ-CLASS             PIC 9(2)  VALUE ZEROS.          02480009
020700     05  PV-OTB-FSCL-MNTH-BEG     PIC X(10).                      02490009
020800*                                                                 02500009
020900     05  PV-TEMP-SKU.                                             02510009
021000         10  PV-TEMP-DEPT         PIC 9(03) VALUE ZEROES.         02520009
021100         10  PV-TEMP-CLASS        PIC 9(02) VALUE ZEROES.         02530009
021200         10  PV-TEMP-SKU-SEQ      PIC 9(03) VALUE ZEROES.         02540009
021300     05  PV-TEMP-SKU-RED REDEFINES PV-TEMP-SKU                    02550009
021400                                  PIC 9(08).                      02560009
021500     05  PV-TEMP-MAJ-CL.                                          02570009
021600         10  PV-TEMP-MAJ-CL-1     PIC 9(01) VALUE 0.              02580009
021700         10  FILLER               PIC 9(01) VALUE 0.              02590009
021800     05  PV-NULL-IND.                                             02600009
021900         10  PV-MAJ-CL-NBR-IND    PIC S9(4)  COMP VALUE +0.       02610009
022000         10  PV-SUB-CL-NBR-IND    PIC S9(4)  COMP VALUE +0.       02620009
022100         10  PV-SKU-NBR-IND       PIC S9(4)  COMP VALUE +0.       02630009
022200     05  ROW-ID                   PIC S9(04) COMP VALUE 0.        02640009
022300     05  ROW-ID-TPLN              PIC S9(04) COMP VALUE 0.        02650009
022400     05  ROW-ID-DTE               PIC S9(04) COMP VALUE 0.        02660009
022500     05  WS-SQLERRD3              PIC S9(04) COMP VALUE 0.        02670009
022600     05  WS-SQLERRD3-TPLN         PIC S9(04) COMP VALUE 0.        02680009
022700     05  PV-DATE-TABLE.                                           02690009
022800         10  PV-DATE-TB-SIZE      PIC  9(5).                      02700009
022900         10  PV-DATE-ENTRY        OCCURS 20000 TIMES              02710009
023000                                 DEPENDING ON PV-DATE-TB-SIZE     02720009
023100                                 ASCENDING KEY IS PV-DTATTR-KY-DTE02730009
023200                                 INDEXED BY PV-DATE-INDEX.        02740009
023300             15  PV-FSCL-YR-NBR         PIC X(004).               02750009
023400             15  PV-FSCL-MN-NBR         PIC X(002).               02760009
023500             15  PV-CAL-MN-NBR          PIC X(002).               02770009
023600             15  PV-OTB-MONTH           PIC X(002).               02780009
023700             15  PV-OTB-FSCL-WEEK       PIC X(001).               02790009
023800             15  PV-OTB-FSCL-WEEK-BEG   PIC X(010).               02800009
023900             15  PV-DTATTR-KY-DTE       PIC X(010).               02810009
024000*                                                                 02820009
024100 01  PV-PROGRAM-ARRAY-VAR.                                        02830009
024200     05  PV-PO-NBR-A              PIC S9(9)      COMP             02840009
024300                                  OCCURS 100     TIMES.           02850009
024400     05  PV-DEPT-NBR-A            PIC X(3)                        02860009
024500                                  OCCURS 100     TIMES.           02870009
024600     05  PV-PO-TYP-CDE-A          PIC X(2)                        02880009
024700                                  OCCURS 100     TIMES.           02890009
024800     05  PV-CRE-BY-UID-A          PIC X(8)                        02900009
024900                                  OCCURS 100     TIMES.           02910009
025000     05  PV-AD-EVNT-DTE-A         PIC X(10)                       02920009
025100                                  OCCURS 100     TIMES.           02930009
025200     05  PV-MAJ-CL-NBR-A          PIC S9(4)V     COMP-3           02940009
025300                                  OCCURS 100     TIMES.           02950009
025400     05  PV-SUB-CL-NBR-A          PIC S9(4)V     COMP-3           02960009
025500                                  OCCURS 100     TIMES.           02970009
025600     05  PV-CL-NBR-A              PIC X(2)                        02980009
025700                                  OCCURS 100     TIMES.           02990009
025800     05  PV-OTB-PER-NBR-A         PIC X(6)                        03000009
025900                                  OCCURS 100     TIMES.           03010009
026000     05  PV-APP-PO-LNE-NBR-A      PIC S9(9)      COMP             03020009
026100                                  OCCURS 100     TIMES.           03030009
026200     05  PV-PO-LNE-NBR-A          PIC S9(9)      COMP             03040009
026300                                  OCCURS 100     TIMES.           03050009
026400     05  PV-GP-QTY-A              PIC S9(4)      COMP             03060009
026500                                  OCCURS 100     TIMES.           03070009
026600     05  PV-GP-RTL-AMT-A          PIC S9(5)V9(2) COMP-3           03080009
026700                                  OCCURS 100     TIMES.           03090009
026800     05  PV-UNT-QTY-A             PIC S9(9)      COMP             03100009
026900                                  OCCURS 100     TIMES.           03110009
027000     05  PV-UNT-RTL-PR-AMT-A      PIC S9(6)V9(2) COMP-3           03120009
027100                                  OCCURS 100     TIMES.           03130009
027200     05  PV-UNT-COST-AMT-A        PIC S9(4)V9(3) COMP-3           03140009
027300                                  OCCURS 100     TIMES.           03150009
027400     05  PV-SKU-SEQ-NBR-A         PIC X(3)                        03160009
027500                                  OCCURS 100     TIMES.           03170009
027600     05  PV-SKU-NBR-A             PIC S9(8)V     COMP-3           03180009
027700                                  OCCURS 100     TIMES.           03190009
027800     05  PV-STATUS-CDE-A          PIC X(2)                        03200009
027900                                  OCCURS 100     TIMES.           03210009
028000     05  PV-DONT-SHIP-BEF-DTE-A   PIC X(10)                       03220009
028100                                  OCCURS 100     TIMES.           03230009
028200     05  PV-CAN-IFNOT-SHIP-DTE-A  PIC X(10)                       03240009
028300                                  OCCURS 100     TIMES.           03250009
028400     05  PV-EXT-CAN-DTE-A         PIC X(10)                       03260009
028500                                  OCCURS 100     TIMES.           03270009
028600     05  PV-ENT-NAME-DESC-A       PIC X(250)                      03280009
028700                                  OCCURS 100     TIMES.           03290009
028800     05  PV-PO-SHRT-CYC-IND-A     PIC X(1)                        03300009
028900                                  OCCURS 100     TIMES.           03310009
029000     05  PV-MAJ-CL-NBR-IND-A      PIC S9(4)      COMP VALUE +0    03320009
029100                                  OCCURS 100     TIMES.           03330009
029200     05  PV-SUB-CL-NBR-IND-A      PIC S9(4)      COMP VALUE +0    03340009
029300                                  OCCURS 100     TIMES.           03350009
029400     05  PV-SKU-NBR-IND-A         PIC S9(4)      COMP VALUE +0    03360009
029500                                  OCCURS 100     TIMES.           03370009
029600     05  PV-CALCED-OTB-DATE-A                                     03380009
029700                                  PIC X(10)                       03390009
029800                                  OCCURS 100     TIMES.           03400009
029900     05  PV-CURR-SPLIT-QTY-A      PIC S9(9)      COMP             03410009
030000                                  OCCURS 100     TIMES.           03420009
030100     05  PV-DEST-NBR-A            PIC S9(4)      COMP             03430009
030200                                  OCCURS 100     TIMES.           03440009
030300     05  PV-FSCL-YR-NBR-A         PIC   X(4)                      03450009
030400                                  OCCURS 100     TIMES.           03460009
030500     05  PV-FSCL-MN-NBR-A         PIC   X(2)                      03470009
030600                                  OCCURS 100     TIMES.           03480009
030700     05  PV-CAL-MN-NBR-A          PIC   X(2)                      03490009
030800                                  OCCURS 100     TIMES.           03500009
030900     05  PV-OTB-MONTH-A           PIC   X(2)                      03510009
031000                                  OCCURS 100     TIMES.           03520009
031100     05  PV-OTB-FSCL-WEEK-NBR-A   PIC   X(1)                      03530009
031200                                  OCCURS 100     TIMES.           03540009
031300     05  PV-OTB-FSCL-WK-BEG-DTE-A PIC   X(10)                     03550009
031400                                  OCCURS 100     TIMES.           03560009
031500     05  PV-KY-DTE-A              PIC   X(10)                     03570009
031600                                  OCCURS 100     TIMES.           03580009
031700*                                                                 03590009
031800 01  PS-PROGRAM-SWITCHES.                                         03600009
031900     05  PS-MORE-ROWS-SW          PIC X       VALUE 'Y'.          03610009
032000         88  PS-MORE-ROWS                     VALUE 'Y'.          03620009
032100         88  PS-NO-MORE-ROWS                  VALUE 'N'.          03630009
032200     05  PS-DC-MORE-ROWS-SW       PIC X       VALUE 'Y'.          03640009
032300         88  PS-DC-MORE-ROWS                  VALUE 'Y'.          03650009
032400         88  PS-DC-NO-MORE-ROWS               VALUE 'N'.          03660009
032500     05  PS-MORE-DEPT-ROWS-SW     PIC X       VALUE 'Y'.          03670009
032600         88  PS-MORE-DEPT-ROWS                VALUE 'Y'.          03680009
032700         88  PS-NO-MORE-DEPT-ROWS             VALUE 'N'.          03690009
032800     05  PS-MORE-DATE-ROWS-SW     PIC X       VALUE 'Y'.          03700009
032900         88  PS-MORE-DATE-ROWS                VALUE 'Y'.          03710009
033000         88  PS-NO-MORE-DATE-ROWS             VALUE 'N'.          03720009
033100     05  PS-MORE-ALLPLN-ROWS-SW   PIC X       VALUE 'Y'.          03730009
033200         88  PS-MORE-ALLPLN-ROWS              VALUE 'Y'.          03740009
033300         88  PS-NO-MORE-ALLPLN-ROWS           VALUE 'N'.          03750009
033400     05  PS-DISTRO-EXISTS-SW      PIC X       VALUE 'Y'.          03760009
033500         88  PS-DISTRO-EXISTS                 VALUE 'Y'.          03770009
033600         88  PS-NO-DISTRO-EXISTS              VALUE 'N'.          03780009
033700     05  PS-MORE-STORE-ROWS-SW    PIC X(01)   VALUE 'Y'.          03790009
033800         88  PS-MORE-STORE-ROWS               VALUE 'Y'.          03800009
033900         88  PS-NO-MORE-STORE-ROWS            VALUE 'N'.          03810009
034000     05  PS-RECLASS-IND           PIC X(01)   VALUE 'N'.          03820009
034100         88  PS-RECLASS-EXISTS                VALUE 'Y'.          03830009
034200         88  PS-RECLASS-DOES-NOT-EXIST        VALUE 'N'.          03840009
034300*                                                                 03850009
034400******************************************************************03860009
034500*    CALENDAR ROUTINE                                             03870009
034600******************************************************************03880009
034700     COPY DPWS500.                                                03890009
034800*                                                                 03900009
034900******************************************************************03910009
035000*  ACTIVE PO EXTRACT RECORD LAYOUT.                               03920009
035100******************************************************************03930009
035200     COPY POWS010.                                                03940009
035300*                                                                 03950009
035400******************************************************************03960009
035500*  RECEIPTS EXTRACT RECORD LAYOUT.                                03970009
035600******************************************************************03980009
035700     COPY POWS016.                                                03990009
035800*                                                                 04000009
035900******************************************************************04010009
036000*      OTB PERIOD ROUTINE FIELDS                                  04020009
036100******************************************************************04030009
036200                                                                  04040009
036300     COPY POWS055.                                                04050009
036400     EJECT                                                        04060009
036500                                                                  04070009
036600*****  SQL ABEND ROUTINE WORKING STORAGE                          04080009
036700*                                                                 04090009
036800     COPY DPWS004.                                                04100009
036900     EJECT                                                        04110009
037000*                                                                 04120009
037100*****  DB2 RECEIVER ITEM TABLE                                    04130009
037200*                                                                 04140009
037300     EXEC SQL                                                     04150009
037400         INCLUDE TRECITM                                          04160009
037500     END-EXEC.                                                    04170009
037600*                                                                 04180009
037700*****  DB2 RECIEVER DISTRIBUTION TABLE                            04190009
037800*                                                                 04200009
037900     EXEC SQL                                                     04210009
038000         INCLUDE TRECDIS                                          04220009
038100     END-EXEC.                                                    04230009
038200*                                                                 04240009
038300*****  DB2 PURCHASE ORDER ITEM TABLE                              04250009
038400*                                                                 04260009
038500     EXEC SQL                                                     04270009
038600         INCLUDE TPURITM                                          04280009
038700     END-EXEC.                                                    04290009
038800                                                                  04300009
038900*                                                                 04310009
039000*****  DB2 RECEIVER                                               04320009
039100*                                                                 04330009
039200     EXEC SQL                                                     04340009
039300         INCLUDE TRECEIV                                          04350009
039400     END-EXEC.                                                    04360009
039500                                                                  04370009
039600*****  DB2 MERCHANDISE AREA                                       04380009
039700*                                                                 04390009
039800     EXEC SQL                                                     04400009
039900         INCLUDE TMDSEAR                                          04410009
040000     END-EXEC.                                                    04420009
040100                                                                  04430009
040200                                                                  04440009
040300*****  DB2 APPLICATION SYSTEM AVAIL TABLE LAYOUT                  04450009
040400*                                                                 04460009
040500     EXEC SQL                                                     04470009
040600         INCLUDE TAPLAVL                                          04480009
040700     END-EXEC.                                                    04490009
040800                                                                  04500009
040900*                                                                 04510009
041000*****  DB2 PURCASE ORDER TABLE                                    04520009
041100*                                                                 04530009
041200     EXEC SQL                                                     04540009
041300         INCLUDE TPURCHS                                          04550009
041400     END-EXEC.                                                    04560009
041500*                                                                 04570009
041600*****  DB2 PURCASE ORDER STATUS CODE TABLE                        04580009
041700*                                                                 04590009
041800     EXEC SQL                                                     04600009
041900         INCLUDE TSTATCD                                          04610009
042000     END-EXEC.                                                    04620009
042100*                                                                 04630009
042200*****  DB2 PURCASE ORDER PLAN SHIP TABLE                          04640009
042300*                                                                 04650009
042400     EXEC SQL                                                     04660009
042500         INCLUDE TPLNSHP                                          04670009
042600     END-EXEC.                                                    04680009
042700*                                                                 04690009
042800*****  DB2 VENDOR NAME TABLE                                      04700009
042900*                                                                 04710009
043000     EXEC SQL                                                     04720009
043100         INCLUDE TENTNME                                          04730009
043200     END-EXEC.                                                    04740009
043300*                                                                 04750009
043400*****  DB2  TALLPLN  TABLE                                        04760009
043500*                                                                 04770009
043600     EXEC SQL                                                     04780009
043700         INCLUDE TALLPLN                                          04790009
043800     END-EXEC.                                                    04800009
043900*                                                                 04810009
044000*****  DB2   LOCATION  TABLE                                      04820009
044100*                                                                 04830009
044200     EXEC SQL                                                     04840009
044300         INCLUDE XMT00001                                         04850009
044400     END-EXEC.                                                    04860009
044500*                                                                 04870009
044600*****  DB2   DC/LOC    TABLE                                      04880009
044700*                                                                 04890009
044800     EXEC SQL                                                     04900009
044900         INCLUDE XMT00002                                         04910009
045000     END-EXEC.                                                    04920009
045100*                                                                 04930009
045200*****  DB2   SKU    TABLE                                         04940009
045300*                                                                 04950009
045400     EXEC SQL                                                     04960009
045500         INCLUDE XLT00003                                         04970009
045600     END-EXEC.                                                    04980009
045700*                                                                 04990009
045800*****  DB2   VENDOR STYLE TABLE                                   05000009
045900*                                                                 05010009
046000     EXEC SQL                                                     05020009
046100         INCLUDE XLT00004                                         05030009
046200     END-EXEC.                                                    05040009
046300*                                                                 05050009
046400*****  DB2   ITEM RECLASS TABLE                                   05060009
046500*                                                                 05070009
046600     EXEC SQL                                                     05080009
046700         INCLUDE IMT00015                                         05090009
046800     END-EXEC.                                                    05100009
046900*                                                                 05110009
047000***************************************************************** 05120009
047100*    SQL COMMUNICATION AREA                                       05130009
047200***************************************************************** 05140009
047300     EXEC SQL                                                     05150009
047400         INCLUDE SQLCA                                            05160009
047500     END-EXEC.                                                    05170009
047600*                                                                 05180009
047700     EJECT                                                        05190009
047800                                                                  05200009
047900     COPY SQLCA2.                                                 05210009
048000*                                                                 05220009
048100***************************************************************** 05230009
048200*   CURSOR FOR RETRIEVING ACTIVE PO RECORDS                       05240009
048300***************************************************************** 05250009
048400                                                                  05260009
048500     EXEC SQL                                                     05270009
048600        DECLARE ACTIVE_PO_CURSOR CURSOR                           05280009
048700         WITH ROWSET POSITIONING FOR                              05290009
048800        SELECT A.PO_NBR,                                          05300009
048900               A.DEPT_NBR,                                        05310009
049000               A.PO_TYP_CDE,                                      05320009
049100               A.CRE_BY_UID,                                      05330009
049200               B.AD_EVNT_DTE,                                     05340009
049300               V.MAJ_CL_NBR,                                      05350009
049400               V.SUB_CL_NBR,                                      05360009
049500               B.CL_NBR,                                          05370009
049600               A.OTB_PER_NBR,                                     05380009
049700               B.APP_PO_LNE_NBR,                                  05390009
049800               B.PO_LNE_NBR,                                      05400009
049900               B.GP_QTY,                                          05410009
050000               B.GP_RTL_AMT,                                      05420009
050100               B.UNT_QTY,                                         05430009
050200               B.UNT_RTL_PR_AMT,                                  05440009
050300               B.UNT_COST_AMT,                                    05450009
050400               B.SKU_SEQ_NBR,                                     05460009
050500               S.SKU_NBR,                                         05470009
050600               B.STATUS_CDE,                                      05480009
050700               E.DONT_SHIP_BEF_DTE,                               05490009
050800               E.CAN_IFNOT_SHIP_DTE,                              05500009
050900               E.EXT_CAN_DTE,                                     05510009
051000               F.ENT_NAME_DESC,                                   05520009
051100               A.PO_SHRT_CYC_IND,                                 05530009
051200               DATE( E.DONT_SHIP_BEF_DTE +                        05540009
051300                :POLDTM-SHIPT-WND-DAY-QTY DAYS )                  05550009
051400        FROM   TPURCHS A,                                         05560009
051500               TSTATCD C,                                         05570009
051600               TPLNSHP E,                                         05580009
051700               TENTNME F,                                         05590009
051800               TPURITM B LEFT OUTER JOIN                          05600009
051900               XLT_SKU S ON B.ITM_NBR = S.ITM_NBR                 05610009
052000               LEFT OUTER JOIN                                    05620009
052100               XLT_VND_STYL V ON S.STYL_ID= V.STYL_ID             05630009
052200        WHERE (A.PO_CATEG_CDE= 'MR')                AND           05640009
052300              (A.VER_STATUS_CDE = 'A')              AND           05650009
248808              ( A.PO_NBR = A.PO_NBR )               AND           05660011
052500              (A.PO_NBR = B.PO_NBR)                 AND           05670009
052600              (B.VER_STATUS_CDE = 'A')              AND           05680009
052700                                                                  05690009
052800              (A.PO_NBR = E.PO_NBR)                 AND           05700009
052900              (E.VER_STATUS_CDE = 'A')              AND           05710009
053000                                                                  05720009
053100              (A.STATUS_CDE = C.STATUS_CDE)         AND           05730009
053200              (C.STATUS_TYP_CDE = 'P')              AND           05740009
053300              (C.STATUS_CLS = 'ACT')                AND           05750009
053400                                                                  05760009
053500              (B.STATUS_CDE IN ('AC','AP','CB', 'CM')) AND        05770009
053600                                                                  05780009
053700              (F.ENT_ID = A.ENT_ID)                 AND           05790009
053800              (F.TYPE_CDE = '01')                   AND           05800009
053900              (B.UNT_QTY > 0)                                     05810009
054000        WITH UR                                                   05820009
054100     END-EXEC.                                                    05830009
054200                                                                  05840009
054300***************************************************************** 05850009
054400* THIS IS THE DRIVING CURSOR OF THE RECEIPT_CURSOR.  THIS         05860009
054500* CURSOR WAS INSERTED TO MAKE THE RECEIPT_CURSOR MORE EFFICIENT.  05870009
054600***************************************************************** 05880009
054700                                                                  05890009
054800     EXEC SQL                                                     05900009
054900        DECLARE DRIVING_CURSOR CURSOR FOR                         05910009
055000                                                                  05920009
055100* SELECT FOR RECEIVERS THAT HAD A RECLASS FOR AT LEAST 1 SKU      05930009
055200* SELECT FOR RECEIVERS THAT HAD NO RECLASS FOR ANY SKUS           05940009
055300                                                                  05950009
055400      SELECT                                                      05960009
055500       CASE                                                       05970009
055600       WHEN (SELECT 'Y' FROM SYSIBM.SYSDUMMY1                     05980009
055700             WHERE EXISTS                                         05990009
055800             (SELECT 1                                            06000009
055900                  FROM TRECITM B                                  06010009
056000                      ,XLT_SKU S                                  06020009
056100                      ,IMT_RECLS R                                06030009
056200                 WHERE  E.ORD_NBR         = B.ORD_NBR             06040009
056300                   AND  E.REC_SEQ_NBR     = B.REC_SEQ_NBR         06050009
056400                   AND  (B.VER_STATUS_CDE = 'A')                  06060009
056500                   AND  B.ITM_NBR         = S.ITM_NBR             06070009
056600                   AND  R.SKU_NBR         = S.SKU_NBR             06080009
056700         AND         RECLS_TMST                                   06090009
RECLSS                          BETWEEN  P.CRE_TMST                     06100009
056900                              AND  :PV-END-TMESTAMP               06110009
057000                     AND (OLD_DEPT_NBR      <> NW_DEPT_NBR        06120009
057100             OR OLD_MAJ_CL_NBR     <> NW_MAJ_CL_NBR))) = 'Y'      06130009
057200        THEN 'Y'                                                  06140009
RECLSS        ELSE 'N' END,ORD_NBR, REC_SEQ_NBR,P.CRE_TMST              06150009
057400                FROM TRECEIV E,                                   06160009
RECLSS                     TPURCHS P                                    06170009
057500               WHERE  E.VERFYD_TMST                               06180009
057600                      BETWEEN  :PV-START-TMESTAMP                 06190009
057700                          AND  :PV-END-TMESTAMP                   06200009
057800                       AND  E.ML_POST_TMST                        06210009
057900                      BETWEEN  :PV-ML-START-TMESTAMP              06220009
058000                          AND  :PV-ML-END-TMESTAMP                06230009
058100                 AND (E.VER_STATUS_CDE = 'A')                     06240009
RECLSS                 AND (E.ORD_NBR = P.PO_NBR)                       06250009
RECLSS                 AND (P.VER_STATUS_CDE = 'A')                     06260009
058200              ORDER BY 1, 2, 3                                    06270009
058300              WITH UR                                             06280009
058400     END-EXEC                                                     06290009
058500*                                                                 06300009
058600***************************************************************** 06310009
058700*  RECEIPT CURSOR - FOR RECEIVERS WHERE THERE IS NO RECLASS       06320009
058800***************************************************************** 06330009
058900     EXEC SQL                                                     06340009
059000        DECLARE RECEIPT_CURSOR CURSOR FOR                         06350009
059100            SELECT                                                06360009
059200                   SUM(B.AP_VERIFY_ITM_QTY),                      06370009
059300                   C.GP_QTY,                                      06380009
059400                   C.GP_RTL_AMT,                                  06390009
059500                   C.UNT_RTL_PR_AMT,                              06400009
059600                   C.UNT_COST_AMT,                                06410009
059700                   V.MAJ_CL_NBR,                                  06420009
059800                   V.SUB_CL_NBR,                                  06430009
059900                   C.CL_NBR,                                      06440009
060000                   D.DEPT_NBR,                                    06450009
060100                   D.PO_NBR,                                      06460009
060200                   A.ORD_LNE_NBR,                                 06470009
060300                   D.PO_TYP_CDE,                                  06480009
060400                   D.CRE_BY_UID,                                  06490009
060500                   D.OTB_PER_NBR,                                 06500009
060600                   F.STATUS_CLS,                                  06510009
060700                   G.ENT_NAME_DESC,                               06520009
060800                   H.DONT_SHIP_BEF_DTE,                           06530009
060900                   D.PO_SHRT_CYC_IND,                             06540009
061000                   B.STR_NBR,                                     06550009
                         DATE(E.VERFYD_TMST),                           06560009
061100                   (H.DONT_SHIP_BEF_DTE +                         06570009
061200                     :POLDTM-SHIPT-WND-DAY-QTY DAYS )  AS SHIPDAYS06580009
061300            FROM TRECITM A,                                       06590009
061400                 TRECDIS B,                                       06600009
061500                 TPURCHS D,                                       06610009
                       TRECEIV E,                                       06620009
061600                 TSTATCD F,                                       06630009
061700                 TENTNME G,                                       06640009
061800                 TPLNSHP H,                                       06650009
061900                 TPURITM C LEFT OUTER JOIN                        06660009
062000                 XLT_SKU S ON C.ITM_NBR=S.ITM_NBR                 06670009
062100                 LEFT OUTER JOIN XLT_VND_STYL V                   06680009
062200                 ON S.STYL_ID=V.STYL_ID                           06690009
062300         WHERE     (H.PO_NBR = D.PO_NBR)                   AND    06700009
062400                   (H.VER_STATUS_CDE = 'A')                AND    06710009
062500                   (A.VER_STATUS_CDE = 'A')                AND    06720009
062600                   (B.VER_STATUS_CDE = 'A')                AND    06730009
062700                   (D.VER_STATUS_CDE = 'A')                AND    06740009
062800                   (A.ORD_NBR = B.ORD_NBR)                 AND    06750009
                         (A.ORD_NBR = E.ORD_NBR)                 AND    06760009
062900                   (A.ORD_LNE_NBR = B.ORD_LNE_NBR)         AND    06770009
063000                   (A.REC_SEQ_NBR = B.REC_SEQ_NBR)         AND    06780009
                         (A.REC_SEQ_NBR = E.REC_SEQ_NBR)         AND    06790009
063100                                                                  06800009
063200                   (A.ORD_NBR = :RECEIV-ORD-NBR)           AND    06810009
063300                   (A.REC_SEQ_NBR = :RECEIV-REC-SEQ-NBR)   AND    06820009
063400                                                                  06830009
063500                   (D.STATUS_CDE = F.STATUS_CDE)           AND    06840009
063600                   (F.STATUS_TYP_CDE = 'P')                AND    06850009
063700                                                                  06860009
063800                   (A.ORD_NBR = C.PO_NBR)                  AND    06870009
063900                   (A.ORD_LNE_NBR = C.APP_PO_LNE_NBR)      AND    06880009
064000                   (A.PO_VER_NBR = C.VER_NBR)              AND    06890009
064100                   (C.PO_NBR = D.PO_NBR)                   AND    06900009
064200                   (D.VER_STATUS_CDE = 'A')                AND    06910009
064300                   (G.ENT_ID = D.ENT_ID)                   AND    06920009
064400                   (G.TYPE_CDE = '01')                            06930009
064500            GROUP BY                                              06940009
064600                   D.DEPT_NBR,                                    06950009
064700                   V.MAJ_CL_NBR,                                  06960009
064800                   V.SUB_CL_NBR,                                  06970009
064900                   C.CL_NBR,                                      06980009
065000                   C.GP_QTY,                                      06990009
065100                   C.GP_RTL_AMT,                                  07000009
065200                   C.UNT_RTL_PR_AMT,                              07010009
065300                   C.UNT_COST_AMT,                                07020009
065400                   D.PO_NBR,                                      07030009
065500                   A.ORD_LNE_NBR,                                 07040009
065600                   D.PO_TYP_CDE,                                  07050009
065700                   D.CRE_BY_UID,                                  07060009
065800                   D.OTB_PER_NBR,                                 07070009
065900                   F.STATUS_CLS,                                  07080009
066000                   G.ENT_NAME_DESC,                               07090009
066100                   H.DONT_SHIP_BEF_DTE,                           07100009
066200                   D.PO_SHRT_CYC_IND,                             07110009
066300                   B.STR_NBR,                                     07120009
                         DATE(E.VERFYD_TMST)                            07130009
066400            WITH UR                                               07140009
066500     END-EXEC.                                                    07150009
066600***************************************************************** 07160009
066700*  RECEIPT CURSOR - FOR RECEIVERS WHERE THERE HAS BEEN A RECLASS  07170009
066800***************************************************************** 07180009
066900* NOTES REGARDING THIS RECLASS CURSOR:                            07190009
067000*  - WE ONLY PROCESS DEPT OR MAJOR CLASS RECLASSES - NO SUB CLASS 07200009
067100*  - THERE ARE MULTIPLE UNIONS TO ACCOUNT FOR SEVERAL CONDITIONS  07210009
067200*   1) MULTIPLE RECLASSES FOR THE SAME SKUS IN THIS TIMEFRAME -   07220009
067300*      SOME WITH A DEPT RECLASS AND A SEPERATE MAJOR CLASS CHANGE 07230009
067400*   2) SOME SKUS IN THE RECEIVER DO NOT HAVE A RECLASS, OTHERS DO 07240009
067500*   3) SOME OF THE RECLASSES ARE BEFORE THE VERIFY, OTHERS AFTER  07250009
067600*  - IF THERE IS ONE OR MORE DEPARTMENT RECLASS, WE WILL USE THE  07260009
067700*    EARLIEST DEPARTMENT RECLASS                                  07270009
067800*  - IF THERE IS NO DEPARTMENT RECLASS, USE THE EARLIEST          07280009
067900*    MAJOR CLASS RECLASS.                                         07290009
068000***************************************************************** 07300009
068100     EXEC SQL                                                     07310009
068200        DECLARE RCL_RECEIPT_CURSOR CURSOR FOR                     07320009
068300                                                                  07330009
068400* THIS SELECTS RECEIPTS WHERE A DEPT RECLASS EXISTS FOR THE MONTH 07340009
068500* AND THE VERIFY DATE WAS BEFORE THE RECLASS DATE.                07350009
068600* FIRST DEPT RECLASS IS USED IF THERE IS MORE THAN 1 DEPT RECLASS.07360009
068700* OLD DEPT & CLASS ARE USED (FROM IMT_RECLS).                     07370009
068800                                                                  07380009
068900            SELECT                                                07390009
069000                   SUM(B.AP_VERIFY_ITM_QTY),                      07400009
069100                   C.GP_QTY,                                      07410009
069200                   C.GP_RTL_AMT,                                  07420009
069300                   C.UNT_RTL_PR_AMT,                              07430009
069400                   C.UNT_COST_AMT,                                07440009
069500                   R.OLD_MAJ_CL_NBR,                              07450009
069600                   R.OLD_SUB_CL_NBR,                              07460009
069700                   C.CL_NBR,                                      07470009
217030                   SUBSTR(DIGITS(R.OLD_DEPT_NBR),2,3),            07480009
069900                   D.PO_NBR,                                      07490009
070000                   A.ORD_LNE_NBR,                                 07500009
070100                   D.PO_TYP_CDE,                                  07510009
070200                   D.CRE_BY_UID,                                  07520009
070300                   D.OTB_PER_NBR,                                 07530009
070400                   F.STATUS_CLS,                                  07540009
070500                   G.ENT_NAME_DESC,                               07550009
070600                   H.DONT_SHIP_BEF_DTE,                           07560009
070700                   D.PO_SHRT_CYC_IND,                             07570009
070800                   B.STR_NBR,                                     07580009
                         DATE(E.VERFYD_TMST),                           07590009
070900                   (H.DONT_SHIP_BEF_DTE +                         07600009
071000                     :POLDTM-SHIPT-WND-DAY-QTY DAYS ) AS SHIPDAYS 07610009
071100            FROM TRECITM A,                                       07620009
071200                 TRECDIS B,                                       07630009
071300                 TPURCHS D,                                       07640009
071400                 TRECEIV E,                                       07650009
071500                 TSTATCD F,                                       07660009
071600                 TENTNME G,                                       07670009
071700                 TPLNSHP H,                                       07680009
071800                 TPURITM C LEFT OUTER JOIN                        07690009
071900                 XLT_SKU S ON C.ITM_NBR=S.ITM_NBR                 07700009
072000                 LEFT OUTER JOIN XLT_VND_STYL V                   07710009
072100                 ON S.STYL_ID=V.STYL_ID                           07720009
072200                 LEFT OUTER JOIN IMT_RECLS R                      07730009
072300                 ON S.SKU_NBR=R.SKU_NBR                           07740009
072400         WHERE     (H.PO_NBR = D.PO_NBR)                   AND    07750009
072500                   (H.VER_STATUS_CDE = 'A')                AND    07760009
072600                   (A.VER_STATUS_CDE = 'A')                AND    07770009
072700                   (B.VER_STATUS_CDE = 'A')                AND    07780009
072800                   (D.VER_STATUS_CDE = 'A')                AND    07790009
072900                   (A.ORD_NBR = B.ORD_NBR)                 AND    07800009
073000                   (A.ORD_NBR = E.ORD_NBR)                 AND    07810009
073100                   (A.ORD_LNE_NBR = B.ORD_LNE_NBR)         AND    07820009
073200                   (A.REC_SEQ_NBR = B.REC_SEQ_NBR)         AND    07830009
073300                   (A.REC_SEQ_NBR = E.REC_SEQ_NBR)         AND    07840009
073400                   (A.ORD_NBR = :RECEIV-ORD-NBR)           AND    07850009
073500                   (A.REC_SEQ_NBR = :RECEIV-REC-SEQ-NBR)   AND    07860009
073600                   (D.STATUS_CDE = F.STATUS_CDE)           AND    07870009
073700                   (F.STATUS_TYP_CDE = 'P')                AND    07880009
073800                   (A.ORD_NBR = C.PO_NBR)                  AND    07890009
073900                   (A.ORD_LNE_NBR = C.APP_PO_LNE_NBR)      AND    07900009
074000                   (A.PO_VER_NBR = C.VER_NBR)              AND    07910009
074100                   (C.PO_NBR = D.PO_NBR)                   AND    07920009
074200                   (D.VER_STATUS_CDE = 'A')                AND    07930009
074300                   (G.ENT_ID = D.ENT_ID)                   AND    07940009
074400                   (G.TYPE_CDE = '01')                     AND    07950009
074500                   (DATE(E.VERFYD_TMST) >= :PV-START-DATE  AND    07960009
074600                    DATE(E.VERFYD_TMST) < DATE(RECLS_TMST) AND    07970009
074700                   (DATE (RECLS_TMST) BETWEEN                     07980009
RECLSS                    DATE(D.CRE_TMST)    AND :PV-END-DATE)) AND    07990009
074900                    OLD_DEPT_NBR <> NW_DEPT_NBR            AND    08000009
075000                    NOT EXISTS(                                   08010009
075100                       SELECT 1                                   08020009
075200                           FROM XLT_SKU S2,                       08030009
075300                                IMT_RECLS R2                      08040009
075400                          WHERE S2.SKU_NBR=R2.SKU_NBR             08050009
075500                            AND S2.SKU_NBR=S.SKU_NBR              08060009
075600                            AND (DATE (RECLS_TMST)                08070009
RECLSS                                BETWEEN  DATE(D.CRE_TMST)         08080009
075800                                    AND  :PV-END-DATE)            08090009
075900                            AND  OLD_DEPT_NBR <> NW_DEPT_NBR      08100009
076000                            AND RECLS_TMST < R.RECLS_TMST)        08110009
076100            GROUP BY                                              08120009
076200                   R.OLD_DEPT_NBR,                                08130009
076300                   R.OLD_MAJ_CL_NBR,                              08140009
076400                   R.OLD_SUB_CL_NBR,                              08150009
076500                   C.CL_NBR,                                      08160009
076600                   C.GP_QTY,                                      08170009
076700                   C.GP_RTL_AMT,                                  08180009
076800                   C.UNT_RTL_PR_AMT,                              08190009
076900                   C.UNT_COST_AMT,                                08200009
077000                   D.PO_NBR,                                      08210009
077100                   A.ORD_LNE_NBR,                                 08220009
077200                   D.PO_TYP_CDE,                                  08230009
077300                   D.CRE_BY_UID,                                  08240009
077400                   D.OTB_PER_NBR,                                 08250009
077500                   F.STATUS_CLS,                                  08260009
077600                   G.ENT_NAME_DESC,                               08270009
077700                   H.DONT_SHIP_BEF_DTE,                           08280009
077800                   D.PO_SHRT_CYC_IND,                             08290009
077900                   B.STR_NBR,                                     08300009
                         DATE(E.VERFYD_TMST)                            08310009
078000                                                                  08320009
078100        UNION                                                     08330009
078200                                                                  08340009
078300* THIS SELECTS RECEIPTS WHERE A MAJOR CLASS RECLASS EXISTS FOR    08350009
078400* THE MONTH BUT THERE IS NO DEPT RECLASS FOR THE MONTH.           08360009
078500* THE VERIFY DATE WAS BEFORE THE RECLASS DATE.                    08370009
078600* FIRST MAJOR CLASS RECLASS IS USED IF THERE IS MORE THAN 1       08380009
078700* MAJOR CLASS RECLASS.                                            08390009
078800* OLD DEPT & CLASS ARE USED (FROM IMT_RECLS).                     08400009
078900            SELECT                                                08410009
079000                   SUM(B.AP_VERIFY_ITM_QTY),                      08420009
079100                   C.GP_QTY,                                      08430009
079200                   C.GP_RTL_AMT,                                  08440009
079300                   C.UNT_RTL_PR_AMT,                              08450009
079400                   C.UNT_COST_AMT,                                08460009
079500                   R.OLD_MAJ_CL_NBR,                              08470009
079600                   R.OLD_SUB_CL_NBR,                              08480009
079700                   C.CL_NBR,                                      08490009
217030                   SUBSTR(DIGITS(R.OLD_DEPT_NBR),2,3),            08500009
079900                   D.PO_NBR,                                      08510009
080000                   A.ORD_LNE_NBR,                                 08520009
080100                   D.PO_TYP_CDE,                                  08530009
080200                   D.CRE_BY_UID,                                  08540009
080300                   D.OTB_PER_NBR,                                 08550009
080400                   F.STATUS_CLS,                                  08560009
080500                   G.ENT_NAME_DESC,                               08570009
080600                   H.DONT_SHIP_BEF_DTE,                           08580009
080700                   D.PO_SHRT_CYC_IND,                             08590009
080800                   B.STR_NBR,                                     08600009
                         DATE(E.VERFYD_TMST),                           08610009
080900                   (H.DONT_SHIP_BEF_DTE +                         08620009
081000                     :POLDTM-SHIPT-WND-DAY-QTY DAYS ) AS SHIPDAYS 08630009
081100            FROM TRECITM A,                                       08640009
081200                 TRECDIS B,                                       08650009
081300                 TPURCHS D,                                       08660009
081400                 TRECEIV E,                                       08670009
081500                 TSTATCD F,                                       08680009
081600                 TENTNME G,                                       08690009
081700                 TPLNSHP H,                                       08700009
081800                 TPURITM C LEFT OUTER JOIN                        08710009
081900                 XLT_SKU S ON C.ITM_NBR=S.ITM_NBR                 08720009
082000                 LEFT OUTER JOIN XLT_VND_STYL V                   08730009
082100                 ON S.STYL_ID=V.STYL_ID                           08740009
082200                 LEFT OUTER JOIN IMT_RECLS R                      08750009
082300                 ON S.SKU_NBR=R.SKU_NBR                           08760009
082400         WHERE     (H.PO_NBR = D.PO_NBR)                   AND    08770009
082500                   (H.VER_STATUS_CDE = 'A')                AND    08780009
082600                   (A.VER_STATUS_CDE = 'A')                AND    08790009
082700                   (B.VER_STATUS_CDE = 'A')                AND    08800009
082800                   (D.VER_STATUS_CDE = 'A')                AND    08810009
082900                   (A.ORD_NBR = B.ORD_NBR)                 AND    08820009
083000                   (A.ORD_NBR = E.ORD_NBR)                 AND    08830009
083100                   (A.ORD_LNE_NBR = B.ORD_LNE_NBR)         AND    08840009
083200                   (A.REC_SEQ_NBR = B.REC_SEQ_NBR)         AND    08850009
083300                   (A.REC_SEQ_NBR = E.REC_SEQ_NBR)         AND    08860009
083400                   (A.ORD_NBR = :RECEIV-ORD-NBR)           AND    08870009
083500                   (A.REC_SEQ_NBR = :RECEIV-REC-SEQ-NBR)   AND    08880009
083600                   (D.STATUS_CDE = F.STATUS_CDE)           AND    08890009
083700                   (F.STATUS_TYP_CDE = 'P')                AND    08900009
083800                   (A.ORD_NBR = C.PO_NBR)                  AND    08910009
083900                   (A.ORD_LNE_NBR = C.APP_PO_LNE_NBR)      AND    08920009
084000                   (A.PO_VER_NBR = C.VER_NBR)              AND    08930009
084100                   (C.PO_NBR = D.PO_NBR)                   AND    08940009
084200                   (D.VER_STATUS_CDE = 'A')                AND    08950009
084300                   (G.ENT_ID = D.ENT_ID)                   AND    08960009
084400                   (G.TYPE_CDE = '01')                     AND    08970009
084500                   (DATE(E.VERFYD_TMST) >= :PV-START-DATE  AND    08980009
084600                    DATE(E.VERFYD_TMST) < DATE(RECLS_TMST) AND    08990009
084700                   (DATE (RECLS_TMST) BETWEEN                     09000009
RECLSS                    DATE(D.CRE_TMST)    AND :PV-END-DATE)) AND    09010009
084900                    OLD_MAJ_CL_NBR <> NW_MAJ_CL_NBR        AND    09020009
085000                    NOT EXISTS(                                   09030009
085100                       SELECT 1                                   09040009
085200                           FROM XLT_SKU S2,                       09050009
085300                                IMT_RECLS R2                      09060009
085400                          WHERE S2.SKU_NBR=R2.SKU_NBR             09070009
085500                            AND S2.SKU_NBR=S.SKU_NBR              09080009
085600                            AND (DATE (RECLS_TMST)                09090009
RECLSS                                BETWEEN  DATE(D.CRE_TMST)         09100009
085800                                    AND  :PV-END-DATE)            09110009
085900                            AND  OLD_DEPT_NBR <> NW_DEPT_NBR) AND 09120009
086000                    NOT EXISTS(                                   09130009
086100                       SELECT 1                                   09140009
086200                           FROM XLT_SKU S2,                       09150009
086300                                IMT_RECLS R2                      09160009
086400                          WHERE S2.SKU_NBR=R2.SKU_NBR             09170009
086500                            AND S2.SKU_NBR=S.SKU_NBR              09180009
086600                            AND (DATE (RECLS_TMST)                09190009
RECLSS                                BETWEEN  DATE(D.CRE_TMST)         09200009
086800                                    AND  :PV-END-DATE)            09210009
086900                            AND  OLD_MAJ_CL_NBR <> NW_MAJ_CL_NBR  09220009
087000                            AND RECLS_TMST < R.RECLS_TMST)        09230009
087100            GROUP BY                                              09240009
087200                   R.OLD_DEPT_NBR,                                09250009
087300                   R.OLD_MAJ_CL_NBR,                              09260009
087400                   R.OLD_SUB_CL_NBR,                              09270009
087500                   C.CL_NBR,                                      09280009
087600                   C.GP_QTY,                                      09290009
087700                   C.GP_RTL_AMT,                                  09300009
087800                   C.UNT_RTL_PR_AMT,                              09310009
087900                   C.UNT_COST_AMT,                                09320009
088000                   D.PO_NBR,                                      09330009
088100                   A.ORD_LNE_NBR,                                 09340009
088200                   D.PO_TYP_CDE,                                  09350009
088300                   D.CRE_BY_UID,                                  09360009
088400                   D.OTB_PER_NBR,                                 09370009
088500                   F.STATUS_CLS,                                  09380009
088600                   G.ENT_NAME_DESC,                               09390009
088700                   H.DONT_SHIP_BEF_DTE,                           09400009
088800                   D.PO_SHRT_CYC_IND,                             09410009
088900                   B.STR_NBR,                                     09420009
                         DATE(E.VERFYD_TMST)                            09430009
089000        UNION                                                     09440009
089100                                                                  09450009
089200* THIS SELECTS RECEIPTS WHERE A DEPT RECLASS EXISTS FOR THE MONTH 09460009
089300* AND THE VERIFY DATE WAS ON OR AFTER THE MIN(RECLASS DATE).      09470009
089400* FIRST DEPT RECLASS IS USED IF THERE IS MORE THAN 1 DEPT RECLASS.09480009
089500* NEW DEPT & CLASS ARE USED (FROM XLT_VND_STYL).                  09490009
089600                                                                  09500009
089700            SELECT                                                09510009
089800                   SUM(B.AP_VERIFY_ITM_QTY),                      09520009
089900                   C.GP_QTY,                                      09530009
090000                   C.GP_RTL_AMT,                                  09540009
090100                   C.UNT_RTL_PR_AMT,                              09550009
090200                   C.UNT_COST_AMT,                                09560009
090300                   V.MAJ_CL_NBR,                                  09570009
090400                   V.SUB_CL_NBR,                                  09580009
090500                   C.CL_NBR,                                      09590009
RECLSS*                  D.DEPT_NBR,                                    09600009
217030                   SUBSTR(DIGITS(V.DEPT_NBR),2,3),                09610009
090700                   D.PO_NBR,                                      09620009
090800                   A.ORD_LNE_NBR,                                 09630009
090900                   D.PO_TYP_CDE,                                  09640009
091000                   D.CRE_BY_UID,                                  09650009
091100                   D.OTB_PER_NBR,                                 09660009
091200                   F.STATUS_CLS,                                  09670009
091300                   G.ENT_NAME_DESC,                               09680009
091400                   H.DONT_SHIP_BEF_DTE,                           09690009
091500                   D.PO_SHRT_CYC_IND,                             09700009
091600                   B.STR_NBR,                                     09710009
                         DATE(E.VERFYD_TMST),                           09720009
091700                   (H.DONT_SHIP_BEF_DTE +                         09730009
091800                     :POLDTM-SHIPT-WND-DAY-QTY DAYS ) AS SHIPDAYS 09740009
091900            FROM TRECITM A,                                       09750009
092000                 TRECDIS B,                                       09760009
092100                 TPURCHS D,                                       09770009
092200                 TRECEIV E,                                       09780009
092300                 TSTATCD F,                                       09790009
092400                 TENTNME G,                                       09800009
092500                 TPLNSHP H,                                       09810009
092600                 TPURITM C LEFT OUTER JOIN                        09820009
092700                 XLT_SKU S ON C.ITM_NBR=S.ITM_NBR                 09830009
092800                 LEFT OUTER JOIN XLT_VND_STYL V                   09840009
092900                 ON S.STYL_ID=V.STYL_ID                           09850009
093000                 LEFT OUTER JOIN IMT_RECLS R                      09860009
093100                 ON S.SKU_NBR=R.SKU_NBR                           09870009
093200         WHERE     (H.PO_NBR = D.PO_NBR)                   AND    09880009
093300                   (H.VER_STATUS_CDE = 'A')                AND    09890009
093400                   (A.VER_STATUS_CDE = 'A')                AND    09900009
093500                   (B.VER_STATUS_CDE = 'A')                AND    09910009
093600                   (D.VER_STATUS_CDE = 'A')                AND    09920009
093700                   (A.ORD_NBR = B.ORD_NBR)                 AND    09930009
093800                   (A.ORD_NBR = E.ORD_NBR)                 AND    09940009
093900                   (A.ORD_LNE_NBR = B.ORD_LNE_NBR)         AND    09950009
094000                   (A.REC_SEQ_NBR = B.REC_SEQ_NBR)         AND    09960009
094100                   (A.REC_SEQ_NBR = E.REC_SEQ_NBR)         AND    09970009
094200                   (A.ORD_NBR = :RECEIV-ORD-NBR)           AND    09980009
094300                   (A.REC_SEQ_NBR = :RECEIV-REC-SEQ-NBR)   AND    09990009
094400                   (D.STATUS_CDE = F.STATUS_CDE)           AND    10000009
094500                   (F.STATUS_TYP_CDE = 'P')                AND    10010009
094600                   (A.ORD_NBR = C.PO_NBR)                  AND    10020009
094700                   (A.ORD_LNE_NBR = C.APP_PO_LNE_NBR)      AND    10030009
094800                   (A.PO_VER_NBR = C.VER_NBR)              AND    10040009
094900                   (C.PO_NBR = D.PO_NBR)                   AND    10050009
095000                   (D.VER_STATUS_CDE = 'A')                AND    10060009
095100                   (G.ENT_ID = D.ENT_ID)                   AND    10070009
095200                   (G.TYPE_CDE = '01')                     AND    10080009
095300                   (DATE(E.VERFYD_TMST) BETWEEN                   10090009
095400                       DATE(RECLS_TMST) AND :PV-END-DATE   AND    10100009
095500                   (DATE (RECLS_TMST)   BETWEEN                   10110009
RECLSS                    DATE(D.CRE_TMST)    AND :PV-END-DATE)) AND    10120009
095700                    OLD_DEPT_NBR <> NW_DEPT_NBR            AND    10130009
095800                    NOT EXISTS(                                   10140009
095900                       SELECT 1                                   10150009
096000                           FROM XLT_SKU S2,                       10160009
096100                                IMT_RECLS R2                      10170009
096200                          WHERE S2.SKU_NBR=R2.SKU_NBR             10180009
096300                            AND S2.SKU_NBR=S.SKU_NBR              10190009
096400                            AND (DATE (RECLS_TMST)                10200009
RECLSS                                BETWEEN  DATE(D.CRE_TMST)         10210009
096600                                    AND  :PV-END-DATE)            10220009
096700                            AND  OLD_DEPT_NBR <> NW_DEPT_NBR      10230009
096800                            AND RECLS_TMST < R.RECLS_TMST)        10240009
096900            GROUP BY                                              10250009
RECLSS*                  D.DEPT_NBR,                                    10260009
RECLSS                   V.DEPT_NBR,                                    10270009
097100                   V.MAJ_CL_NBR,                                  10280009
097200                   V.SUB_CL_NBR,                                  10290009
097300                   C.CL_NBR,                                      10300009
097400                   C.GP_QTY,                                      10310009
097500                   C.GP_RTL_AMT,                                  10320009
097600                   C.UNT_RTL_PR_AMT,                              10330009
097700                   C.UNT_COST_AMT,                                10340009
097800                   D.PO_NBR,                                      10350009
097900                   A.ORD_LNE_NBR,                                 10360009
098000                   D.PO_TYP_CDE,                                  10370009
098100                   D.CRE_BY_UID,                                  10380009
098200                   D.OTB_PER_NBR,                                 10390009
098300                   F.STATUS_CLS,                                  10400009
098400                   G.ENT_NAME_DESC,                               10410009
098500                   H.DONT_SHIP_BEF_DTE,                           10420009
098600                   D.PO_SHRT_CYC_IND,                             10430009
098700                   B.STR_NBR,                                     10440009
                         DATE(E.VERFYD_TMST)                            10450009
098800        UNION                                                     10460009
098900                                                                  10470009
099000* THIS SELECTS RECEIPTS WHERE A MAJOR CLASS RECLASS EXISTS FOR    10480009
099100* THE MONTH BUT THERE IS NO DEPT RECLASS FOR THE MONTH.           10490009
099200* THE VERIFY DATE WAS ON OR AFTER THE RECLASS DATE.               10500009
099300* FIRST MAJOR CLASS RECLASS IS USED IF THERE IS MORE THAN 1       10510009
099400* MAJOR CLASS RECLASS.                                            10520009
099500* NEW DEPT & CLASS ARE USED (FROM XLT_VND_STYL).                  10530009
099600                                                                  10540009
099700            SELECT                                                10550009
099800                   SUM(B.AP_VERIFY_ITM_QTY),                      10560009
099900                   C.GP_QTY,                                      10570009
100000                   C.GP_RTL_AMT,                                  10580009
100100                   C.UNT_RTL_PR_AMT,                              10590009
100200                   C.UNT_COST_AMT,                                10600009
100300                   V.MAJ_CL_NBR,                                  10610009
100400                   V.SUB_CL_NBR,                                  10620009
100500                   C.CL_NBR,                                      10630009
100600                   D.DEPT_NBR,                                    10640009
100700                   D.PO_NBR,                                      10650009
100800                   A.ORD_LNE_NBR,                                 10660009
100900                   D.PO_TYP_CDE,                                  10670009
101000                   D.CRE_BY_UID,                                  10680009
101100                   D.OTB_PER_NBR,                                 10690009
101200                   F.STATUS_CLS,                                  10700009
101300                   G.ENT_NAME_DESC,                               10710009
101400                   H.DONT_SHIP_BEF_DTE,                           10720009
101500                   D.PO_SHRT_CYC_IND,                             10730009
101600                   B.STR_NBR,                                     10740009
                         DATE(E.VERFYD_TMST),                           10750009
101700                   (H.DONT_SHIP_BEF_DTE +                         10760009
101800                     :POLDTM-SHIPT-WND-DAY-QTY DAYS ) AS SHIPDAYS 10770009
101900            FROM TRECITM A,                                       10780009
102000                 TRECDIS B,                                       10790009
102100                 TPURCHS D,                                       10800009
102200                 TRECEIV E,                                       10810009
102300                 TSTATCD F,                                       10820009
102400                 TENTNME G,                                       10830009
102500                 TPLNSHP H,                                       10840009
102600                 TPURITM C LEFT OUTER JOIN                        10850009
102700                 XLT_SKU S ON C.ITM_NBR=S.ITM_NBR                 10860009
102800                 LEFT OUTER JOIN XLT_VND_STYL V                   10870009
102900                 ON S.STYL_ID=V.STYL_ID                           10880009
103000                 LEFT OUTER JOIN IMT_RECLS R                      10890009
103100                 ON S.SKU_NBR=R.SKU_NBR                           10900009
103200         WHERE     (H.PO_NBR = D.PO_NBR)                   AND    10910009
103300                   (H.VER_STATUS_CDE = 'A')                AND    10920009
103400                   (A.VER_STATUS_CDE = 'A')                AND    10930009
103500                   (B.VER_STATUS_CDE = 'A')                AND    10940009
103600                   (D.VER_STATUS_CDE = 'A')                AND    10950009
103700                   (A.ORD_NBR = B.ORD_NBR)                 AND    10960009
103800                   (A.ORD_NBR = E.ORD_NBR)                 AND    10970009
103900                   (A.ORD_LNE_NBR = B.ORD_LNE_NBR)         AND    10980009
104000                   (A.REC_SEQ_NBR = B.REC_SEQ_NBR)         AND    10990009
104100                   (A.REC_SEQ_NBR = E.REC_SEQ_NBR)         AND    11000009
104200                   (A.ORD_NBR = :RECEIV-ORD-NBR)           AND    11010009
104300                   (A.REC_SEQ_NBR = :RECEIV-REC-SEQ-NBR)   AND    11020009
104400                   (D.STATUS_CDE = F.STATUS_CDE)           AND    11030009
104500                   (F.STATUS_TYP_CDE = 'P')                AND    11040009
104600                   (A.ORD_NBR = C.PO_NBR)                  AND    11050009
104700                   (A.ORD_LNE_NBR = C.APP_PO_LNE_NBR)      AND    11060009
104800                   (A.PO_VER_NBR = C.VER_NBR)              AND    11070009
104900                   (C.PO_NBR = D.PO_NBR)                   AND    11080009
105000                   (D.VER_STATUS_CDE = 'A')                AND    11090009
105100                   (G.ENT_ID = D.ENT_ID)                   AND    11100009
105200                   (G.TYPE_CDE = '01')                     AND    11110009
105300                   (DATE(E.VERFYD_TMST) BETWEEN                   11120009
105400                       DATE(RECLS_TMST) AND :PV-END-DATE   AND    11130009
105500                   (DATE (RECLS_TMST)   BETWEEN                   11140009
RECLSS                    DATE(D.CRE_TMST)   AND :PV-END-DATE)) AND     11150009
105700                    OLD_MAJ_CL_NBR <> NW_MAJ_CL_NBR        AND    11160009
105800                                                                  11170009
105900* THERE IS NO DEPT RECLASS FOR THE MONTH.                         11180009
106000                                                                  11190009
106100                    NOT EXISTS(                                   11200009
106200                       SELECT 1                                   11210009
106300                           FROM XLT_SKU S2,                       11220009
106400                                IMT_RECLS R2                      11230009
106500                          WHERE S2.SKU_NBR=R2.SKU_NBR             11240009
106600                            AND S2.SKU_NBR=S.SKU_NBR              11250009
106700                            AND (DATE (RECLS_TMST)                11260009
RECLSS                                BETWEEN  DATE(D.CRE_TMST)         11270009
106900                                    AND  :PV-END-DATE)            11280009
107000                            AND  OLD_DEPT_NBR <> NW_DEPT_NBR) AND 11290009
107100                                                                  11300009
107200* THERE IS NO EARLIER MAJOR CLASS RECLASS FOR THE MONTH.          11310009
107300                                                                  11320009
107400                    NOT EXISTS(                                   11330009
107500                       SELECT 1                                   11340009
107600                           FROM XLT_SKU S2,                       11350009
107700                                IMT_RECLS R2                      11360009
107800                          WHERE S2.SKU_NBR=R2.SKU_NBR             11370009
107900                            AND S2.SKU_NBR=S.SKU_NBR              11380009
108000                            AND (DATE (RECLS_TMST)                11390009
RECLSS                                BETWEEN  DATE(D.CRE_TMST)         11400009
108200                                    AND  :PV-END-DATE)            11410009
108300                            AND  OLD_MAJ_CL_NBR <> NW_MAJ_CL_NBR  11420009
108400                            AND RECLS_TMST < R.RECLS_TMST)        11430009
108500            GROUP BY                                              11440009
108600                   D.DEPT_NBR,                                    11450009
108700                   V.MAJ_CL_NBR,                                  11460009
108800                   V.SUB_CL_NBR,                                  11470009
108900                   C.CL_NBR,                                      11480009
109000                   C.GP_QTY,                                      11490009
109100                   C.GP_RTL_AMT,                                  11500009
109200                   C.UNT_RTL_PR_AMT,                              11510009
109300                   C.UNT_COST_AMT,                                11520009
109400                   D.PO_NBR,                                      11530009
109500                   A.ORD_LNE_NBR,                                 11540009
109600                   D.PO_TYP_CDE,                                  11550009
109700                   D.CRE_BY_UID,                                  11560009
109800                   D.OTB_PER_NBR,                                 11570009
109900                   F.STATUS_CLS,                                  11580009
110000                   G.ENT_NAME_DESC,                               11590009
110100                   H.DONT_SHIP_BEF_DTE,                           11600009
110200                   D.PO_SHRT_CYC_IND,                             11610009
110300                   B.STR_NBR,                                     11620009
                         DATE(E.VERFYD_TMST)                            11630009
110400        UNION                                                     11640009
110500                                                                  11650009
110600* THIS SELECT FOR RECEIPTS WHERE THE SKU DID NOT HAVE A RECLASS   11660009
110700* DURING THE EXTRACT TIMEFRAME, BUT OTHER SKUS IN THE RECEIVER    11670009
110800* DID HAVE A RECLASS. DEPT & CLASS FROM XLT_VND_STYL ARE USED     11680009
110900                                                                  11690009
111000            SELECT                                                11700009
111100                   SUM(B.AP_VERIFY_ITM_QTY),                      11710009
111200                   C.GP_QTY,                                      11720009
111300                   C.GP_RTL_AMT,                                  11730009
111400                   C.UNT_RTL_PR_AMT,                              11740009
111500                   C.UNT_COST_AMT,                                11750009
111600                   V.MAJ_CL_NBR,                                  11760009
111700                   V.SUB_CL_NBR,                                  11770009
111800                   C.CL_NBR,                                      11780009
217030                   SUBSTR(DIGITS(V.DEPT_NBR),2,3),                11790009
112000                   D.PO_NBR,                                      11800009
112100                   A.ORD_LNE_NBR,                                 11810009
112200                   D.PO_TYP_CDE,                                  11820009
112300                   D.CRE_BY_UID,                                  11830009
112400                   D.OTB_PER_NBR,                                 11840009
112500                   F.STATUS_CLS,                                  11850009
112600                   G.ENT_NAME_DESC,                               11860009
112700                   H.DONT_SHIP_BEF_DTE,                           11870009
112800                   D.PO_SHRT_CYC_IND,                             11880009
112900                   B.STR_NBR,                                     11890009
                         DATE(E.VERFYD_TMST),                           11900009
113000                   (H.DONT_SHIP_BEF_DTE +                         11910009
113100                     :POLDTM-SHIPT-WND-DAY-QTY DAYS ) AS SHIPDAYS 11920009
113200            FROM TRECITM A,                                       11930009
113300                 TRECDIS B,                                       11940009
113400                 TPURCHS D,                                       11950009
113500                 TRECEIV E,                                       11960009
113600                 TSTATCD F,                                       11970009
113700                 TENTNME G,                                       11980009
113800                 TPLNSHP H,                                       11990009
113900                 TPURITM C LEFT OUTER JOIN                        12000009
114000                 XLT_SKU S ON C.ITM_NBR=S.ITM_NBR                 12010009
114100                 LEFT OUTER JOIN XLT_VND_STYL V                   12020009
114200                 ON S.STYL_ID=V.STYL_ID                           12030009
114300         WHERE     (H.PO_NBR = D.PO_NBR)                   AND    12040009
114400                   (H.VER_STATUS_CDE = 'A')                AND    12050009
114500                   (A.VER_STATUS_CDE = 'A')                AND    12060009
114600                   (B.VER_STATUS_CDE = 'A')                AND    12070009
114700                   (D.VER_STATUS_CDE = 'A')                AND    12080009
114800                   (A.ORD_NBR = B.ORD_NBR)                 AND    12090009
114900                   (A.ORD_NBR = E.ORD_NBR)                 AND    12100009
115000                   (A.ORD_LNE_NBR = B.ORD_LNE_NBR)         AND    12110009
115100                   (A.REC_SEQ_NBR = B.REC_SEQ_NBR)         AND    12120009
115200                   (A.REC_SEQ_NBR = E.REC_SEQ_NBR)         AND    12130009
115300                   (A.ORD_NBR = :RECEIV-ORD-NBR)           AND    12140009
115400                   (A.REC_SEQ_NBR = :RECEIV-REC-SEQ-NBR)   AND    12150009
115500                   (D.STATUS_CDE = F.STATUS_CDE)           AND    12160009
115600                   (F.STATUS_TYP_CDE = 'P')                AND    12170009
115700                   (A.ORD_NBR = C.PO_NBR)                  AND    12180009
115800                   (A.ORD_LNE_NBR = C.APP_PO_LNE_NBR)      AND    12190009
115900                   (A.PO_VER_NBR = C.VER_NBR)              AND    12200009
116000                   (C.PO_NBR = D.PO_NBR)                   AND    12210009
116100                   (D.VER_STATUS_CDE = 'A')                AND    12220009
116200                   (G.ENT_ID = D.ENT_ID)                   AND    12230009
116300                   (G.TYPE_CDE = '01')                     AND    12240009
116400                    NOT EXISTS (SELECT 1                          12250009
116500                      FROM  IMT_RECLS R                           12260009
116600                     WHERE  R.SKU_NBR = S.SKU_NBR                 12270009
116700                       AND  (DATE (RECLS_TMST) BETWEEN            12280009
RECLSS                         DATE(D.CRE_TMST) AND :PV-END-DATE)       12290009
116900                       AND (OLD_DEPT_NBR <> NW_DEPT_NBR           12300009
117000                         OR OLD_MAJ_CL_NBR <> NW_MAJ_CL_NBR))     12310009
117100            GROUP BY                                              12320009
117200                   V.DEPT_NBR,                                    12330009
117300                   V.MAJ_CL_NBR,                                  12340009
117400                   V.SUB_CL_NBR,                                  12350009
117500                   C.CL_NBR,                                      12360009
117600                   C.GP_QTY,                                      12370009
117700                   C.GP_RTL_AMT,                                  12380009
117800                   C.UNT_RTL_PR_AMT,                              12390009
117900                   C.UNT_COST_AMT,                                12400009
118000                   D.PO_NBR,                                      12410009
118100                   A.ORD_LNE_NBR,                                 12420009
118200                   D.PO_TYP_CDE,                                  12430009
118300                   D.CRE_BY_UID,                                  12440009
118400                   D.OTB_PER_NBR,                                 12450009
118500                   F.STATUS_CLS,                                  12460009
118600                   G.ENT_NAME_DESC,                               12470009
118700                   H.DONT_SHIP_BEF_DTE,                           12480009
118800                   D.PO_SHRT_CYC_IND,                             12490009
118900                   B.STR_NBR,                                     12500009
                         DATE(E.VERFYD_TMST)                            12510009
119000           WITH UR                                                12520009
119100     END-EXEC.                                                    12530009
119200******************************************************************12540009
119300*  DB2 DEPT CL CURSOR                                             12550009
119400******************************************************************12560009
119500     EXEC SQL                                                     12570009
119600        DECLARE DEPT_CURSOR CURSOR FOR                            12580009
119700          SELECT A.OPERCO_NBR,                                    12590009
119800                 GMA_NBR,                                         12600009
119900                 DMA_NBR,                                         12610009
120000                 DEPT_NBR,                                        12620009
120100                 MAJ_CL_NBR,                                      12630009
120200                 MDSEAR_DESC                                      12640009
120300            FROM TMDSEAR A,                                       12650009
120400                 TAPLAVL B                                        12660009
120500            WHERE (A.MDSEAR_DKEY = B.MDSEAR_DKEY) AND             12670009
120600                  (MDSELV_CDE = :PC-MDSELV-CDE)   AND             12680009
120700                  (APLSYS_CDE = :PC-APLSYS-CDE)   AND             12690009
120800                  (DATE (CURRENT TIMESTAMP) BETWEEN               12700009
120900                                    STRT_DTE AND END_DTE) AND     12710009
121000                  (DATE (CURRENT TIMESTAMP) BETWEEN               12720009
121100                     MDSEAR_STRT_DTE AND MDSEAR_END_DTE)          12730009
121200            ORDER BY DEPT_NBR                                     12740009
121300            WITH UR                                               12750009
121400                                                                  12760009
121500     END-EXEC.                                                    12770009
121600***************************************************************** 12780009
121700*   SELECT ALL OF THE STORE DATA FOR A PURCHASE ORDER NUMBER      12790009
121800*   AND PURCHASE ORDER LINE NUMBER                                12800009
121900***************************************************************** 12810009
122000                                                                  12820009
122100     EXEC SQL                                                     12830009
122200        DECLARE TALLPLN_CURSOR CURSOR                             12840009
122300           WITH ROWSET POSITIONING FOR                            12850009
122400           SELECT CURR_SPLIT_QTY,                                 12860009
122500                  DEST_NBR                                        12870009
122600           FROM TALLPLN                                           12880009
122700           WHERE PO_NBR  = :PURCHS-PO-NBR                         12890009
122800             AND PO_LNE_NBR = :PURITM-PO-LNE-NBR                  12900009
122900             AND CURR_SPLIT_QTY ^= 0                              12910009
123000            WITH UR                                               12920009
123100     END-EXEC.                                                    12930009
123200***************************************************************** 12940009
123300*SELECT ALL THE STORES WITH THEIR DC'S.                           12950009
123400***************************************************************** 12960009
123500     EXEC SQL                                                     12970009
123600        DECLARE STORE_CURSOR CURSOR FOR                           12980009
123700          SELECT XL1.LOC_NBR,                                     12990009
123800                 XL1.LOC_5_ABBR_NM,                               13000009
123900                 XL2.LOC_NBR                                      13010009
124000            FROM XMT_LOC XL1,                                     13020009
124100                 XMT_LOC XL2                                      13030009
124200           WHERE XL2.LOC_TYP_CDE = 'DC'                           13040009
124300             AND XL2.LOC_NBR =                                    13050009
124400                (SELECT DC_NBR                                    13060009
124500                   FROM XMT_DC_LOC_ASGMT DLA1                     13070009
124600                  WHERE DLA1.LOC_NBR = XL1.LOC_NBR                13080009
124700                    AND DLA1.PO_STRT_DTE =                        13090009
124800                       (SELECT MAX(PO_STRT_DTE)                   13100009
124900                          FROM XMT_DC_LOC_ASGMT DLA2              13110009
125000                         WHERE DLA2.PO_STRT_DTE <=                13120009
125100                               CURRENT DATE                       13130009
125200                          AND DLA1.LOC_NBR = DLA2.LOC_NBR))       13140009
125300           ORDER BY XL1.LOC_NBR                                   13150009
125400            WITH UR                                               13160009
125500     END-EXEC.                                                    13170009
125600                                                                  13180009
125700***************************************************************** 13190009
125800*SELECT ALL THE FISCAL MONTH/YEAR                                 13200009
125900***************************************************************** 13210009
126000     EXEC SQL                                                     13220009
126100        DECLARE DATE_CURSOR CURSOR                                13230009
126200         WITH ROWSET POSITIONING FOR                              13240009
126300            SELECT                                                13250009
126400                FSCL_YR_NBR                                       13260009
126500               ,FSCL_MN_NBR                                       13270009
126600               ,CAL_MN_NBR                                        13280009
126700               ,FSCL_WK_NBR                                       13290009
126800               ,WK_IN_MN_NBR                                      13300009
126900               ,FSCL_WK_BEG_DTE                                   13310009
127000               ,KY_DTE                                            13320009
127100            FROM                                                  13330009
127200                TDTATTR                                           13340009
C87519                ORDER BY KY_DTE                                   13350009
127300            WITH UR                                               13360009
127400     END-EXEC.                                                    13370009
127500 01  ABEND-CODE               PIC S9(04)  VALUE ZERO              13380009
127600                                          COMP SYNC.              13390009
127700     EJECT                                                        13400009
127800 LINKAGE SECTION.                                                 13410009
127900*                                                                 13420009
128000 PROCEDURE DIVISION.                                              13430009
128100*                                                                 13440009
128200******************************************************************13450009
128300* MAIN PROCESSING PARA                                            13460009
128400******************************************************************13470009
128500 A100-MAIN-MODULE.                                                13480009
128600                                                                  13490009
128700     ACCEPT ST-SYSTEM-TIME FROM TIME.                             13500009
128800                                                                  13510009
128900     DISPLAY 'PROGRAM START      : ' ST-SYSTEM-TIME.              13520009
129000                                                                  13530009
129100     PERFORM B100-OPEN-FILES.                                     13540009
129200     PERFORM B150-PROCESS-STORE-CURSOR.                           13550009
129300     PERFORM B200-PROCESS-DATE-CURSOR.                            13560009
129400     PERFORM B210-EDIT-CONTROL-CARD.                              13570009
129500     PERFORM B220-SELECT-TPOLDTM                                  13580009
129600     PERFORM B250-PROCESS-DEPT-CURSOR.                            13590009
129700                                                                  13600009
129800     PERFORM B300-EXTRACT-ACTIVE-POS.                             13610009
129900     PERFORM B400-EXTRACT-RECEIPTS.                               13620009
130000                                                                  13630009
130100     DISPLAY 'FETCH COUNT      = ' FETCH-COUNT.                   13640009
130200     DISPLAY 'FETCH COUNT-RCLS = ' FETCH-COUNT-RCLS.              13650009
130300                                                                  13660009
130400     PERFORM B500-CLOSE-FILES.                                    13670009
130500                                                                  13680009
130600     GOBACK.                                                      13690009
130700                                                                  13700009
130800******************************************************************13710009
130900*    OPEN THE INPUT & OUTPUT FILES FOR PROCESSING                 13720009
131000******************************************************************13730009
131100 B100-OPEN-FILES.                                                 13740009
131200                                                                  13750009
131300     OPEN OUTPUT ACTIVE-PO-FILE                                   13760009
131400                 MONTH-RECEIPTS-FILE                              13770009
131500                 RECEIPTS-FILE.                                   13780009
131600     OPEN INPUT  CNTL-DEF-RCPTS-FILE.                             13790009
131700                                                                  13800009
131800******************************************************************13810009
131900*  PROCESS THE ACTIVE PO DATA                                     13820009
132000******************************************************************13830009
132100                                                                  13840009
132200 B150-PROCESS-STORE-CURSOR.                                       13850009
132300                                                                  13860009
132400     ACCEPT SD-SYSTEM-DATE FROM DATE.                             13870009
132500     MOVE SD-SYSTEM-YEAR  TO SD-SYSTEM-CENT-YY                    13880009
132600     MOVE SD-SYSTEM-MONTH TO SD-SYSTEM-CENT-MM                    13890009
132700     MOVE SD-SYSTEM-DAY   TO SD-SYSTEM-CENT-DD                    13900009
132800                                                                  13910009
132900     IF SD-SYSTEM-YEAR > 80                                       13920009
133000        MOVE '19'         TO SD-SYSTEM-CENT-CC                    13930009
133100     ELSE                                                         13940009
133200        MOVE '20'         TO SD-SYSTEM-CENT-CC                    13950009
133300     END-IF                                                       13960009
133400                                                                  13970009
133500     INITIALIZE PV-STR-TABLE.                                     13980009
133600     PERFORM  Z850-OPEN-STORE-CURSOR.                             13990009
133700     PERFORM  Z860-FETCH-STORE-CURSOR.                            14000009
133800                                                                  14010009
133900     PERFORM UNTIL PS-NO-MORE-STORE-ROWS                          14020009
134000        PERFORM B170-LOAD-STORE-TABLE                             14030009
134100        PERFORM Z860-FETCH-STORE-CURSOR                           14040009
134200     END-PERFORM.                                                 14050009
134300                                                                  14060009
134400     PERFORM Z870-CLOSE-STORE-CURSOR.                             14070009
134500                                                                  14080009
134600******************************************************************14090009
134700*  LOAD THE STORE DATA INTO AN INTERNAL TABLE                     14100009
134800******************************************************************14110009
134900                                                                  14120009
135000 B170-LOAD-STORE-TABLE.                                           14130009
135100                                                                  14140009
135200     IF PV-STR-INDEX          >  2000                             14150009
135300         DISPLAY  '*** ABEND ***'                                 14160009
135400         DISPLAY  '*** STORE TABLE HAS EXCEEDED 2000 ENTRIES***'  14170009
135500         MOVE     +4002            TO ABEND-CODE                  14180009
135600         CALL     'ILBOABN0' USING ABEND-CODE                     14190009
135700     END-IF.                                                      14200009
135800     MOVE XMT00001-LOC-NBR         TO PV-STORE-NMBR(PV-STR-INDEX).14210009
135900     MOVE PV-STR-DC-NBR            TO PV-DC-NMBR(PV-STR-INDEX).   14220009
136000     SET PV-STR-INDEX UP BY 1.                                    14230009
136100                                                                  14240009
136200******************************************************************14250009
136300*  SEARCH THE STORE TABLE FOR THE CORRECT DC NUMBER.              14260009
136400******************************************************************14270009
136500                                                                  14280009
136600 B190-SEARCH-STORE-TABLE.                                         14290009
136700                                                                  14300009
136800     SEARCH                      PV-STR-ENTRY                     14310009
136900      AT  END                                                     14320009
137000          DISPLAY 'STORE NOT FOUND '                              14330009
137100                  'STORE NUMBER =  '  PV-STORE-NBR                14340009
137200          MOVE PV-STORE-NBR              TO PO010-DC-NBR          14350009
137300          INITIALIZE PV-STORE-NBR                                 14360009
137400                     PV-ALLPLN-DEST-NBR                           14370009
137500      WHEN PV-STORE-NMBR(PV-STR-INDEX) = PV-STORE-NBR             14380009
137600           MOVE PV-DC-NMBR(PV-STR-INDEX) TO PO010-DC-NBR          14390009
137700     END-SEARCH.                                                  14400009
137800******************************************************************14410009
137900*  PROCESS FOR LOADING THE DATE DATA INTO AN INTERNAL TABLE.      14420009
138000******************************************************************14430009
138100 B200-PROCESS-DATE-CURSOR.                                        14440009
138200                                                                  14450009
138300      PERFORM D100-OPEN-DATE-CURSOR.                              14460009
138400      SET PV-DATE-INDEX TO 1.                                     14470009
138500      PERFORM D200-FETCH-DATE-CURSOR.                             14480009
138600                                                                  14490009
138700      PERFORM UNTIL PS-NO-MORE-DATE-ROWS                          14500009
138800           PERFORM VARYING ROW-ID-DTE FROM 1 BY 1                 14510009
138900              UNTIL ROW-ID-DTE > SQLERRD (3)                      14520009
139000              PERFORM D300-LOAD-DATE-TABLE                        14530009
139100           END-PERFORM                                            14540009
139200          PERFORM D200-FETCH-DATE-CURSOR                          14550009
139300      END-PERFORM.                                                14560009
139400                                                                  14570009
139500      PERFORM D500-CLOSE-DATE-CURSOR.                             14580009
139600                                                                  14590009
139700******************************************************************14600009
139800*  GET THE DATE INFORMATION BY CALLING THE KOHLS CALENDAR         14610009
139900*  ROUTINE.                                                       14620009
140000******************************************************************14630009
140100 B210-EDIT-CONTROL-CARD.                                          14640009
140200*                                                                 14650009
140300     ACCEPT CC-CONTROL-CARD   FROM SYSIN.                         14660009
140400     ACCEPT DPG51-SYSTEM-DATE FROM DATE.                          14670009
140500                                                                  14680009
140600     DISPLAY 'CONTROL CARD : ' CC-CONTROL-CARD.                   14690009
140700                                                                  14700009
140800     MOVE CC-DATE              TO DPG52-LK-DATE-INPUT             14710009
140900     MOVE CC-CALENDAR-TYPE     TO DPG51-CALENDAR-TYPE.            14720009
141000     SET  DPG52-LK-DTE-GREG-CC TO TRUE.                           14730009
141100                                                                  14740009
141200     CALL DP500-KOHLS-CALENDAR-ROUTINE USING                      14750009
141300                                DPG51 DPG52                       14760009
141400                                DPG53 DPG54                       14770009
141500                                DPG55 DPG56.                      14780009
141600                                                                  14790009
141700     IF DPG54-NO-ERROR                                            14800009
11752A*        MOVE DPG56-FIRST-FP-DB2-ISO-FMT                          14810009
11752A         MOVE DPG55-1ST-WKDY-DB2ISO-FMT                           14820009
141900                                       TO PV-START-DATE           14830009
142000         MOVE DPG55-DB2-ISO-DATE-FMT   TO PV-END-DATE             14840009
142100         DISPLAY 'PICKING UP RECEIPTS BETWEEN ' PV-START-DATE     14850009
142200                 ' AND ' PV-END-DATE                              14860009
142300                                                                  14870009
142400         MOVE  PV-START-DATE           TO PV-START-TMESTAMP(1:10) 14880009
142500         MOVE  PV-END-DATE             TO PV-END-TMESTAMP(1:10)   14890009
142600         MOVE '-00.00.00.000000'       TO PV-START-TMESTAMP(11:16)14900009
142700         MOVE '-23.59.59.999999'       TO PV-END-TMESTAMP(11:16)  14910009
142800         MOVE DPG56-FISCAL-YEAR-NBR    TO PV-VERIFIED-YY          14920009
142900         MOVE DPG56-FISCAL-PERIOD-NBR  TO PV-VERIFIED-MM          14930009
143000         DISPLAY 'PV-START-TMESTAMP'      PV-START-TMESTAMP       14940009
143100                                     ','  PV-END-TMESTAMP         14950009
143200                                                                  14960009
143300         EXEC SQL                                                 14970009
143400           SELECT DATE(:PV-START-DATE ) - 2 DAYS,                 14980009
143500                  DATE(:PV-END-DATE   ) + 2 DAYS                  14990009
143600             INTO                                                 15000009
143700                 :PV-ML-START-TMESTAMP,                           15010009
143800                 :PV-ML-END-TMESTAMP                              15020009
143900           FROM SYSIBM.SYSDUMMY1                                  15030009
144000         END-EXEC                                                 15040009
144100                                                                  15050009
144200         IF SQLCODE NOT = ZERO                                    15060009
144300                 MOVE 'B210-EDIT-CONTROL-CARD'                    15070009
144400                                    TO  PV-PARAGRAPH-NAME         15080009
144500                 MOVE 'DATE SELECTION FROM SYSDUMMY'              15090009
144600                                    TO  PV-DB2-OPER-ATTEMPTED     15100009
144700                 PERFORM Z900-SQL-ABEND                           15110009
144800         END-IF                                                   15120009
144900                                                                  15130009
145000         MOVE '-00.00.00.000000'    TO PV-ML-START-TMESTAMP(11:16)15140009
145100         MOVE '-23.59.59.999999'    TO PV-ML-END-TMESTAMP(11:16)  15150009
145200                                                                  15160009
145300         DISPLAY 'PV-ML-START-TMESTAMP' PV-ML-START-TMESTAMP      15170009
145400                                   ','  PV-ML-END-TMESTAMP        15180009
145500     ELSE                                                         15190009
145600         DISPLAY '** ABEND ** IN POKUT121'                        15200009
145700         DISPLAY 'DATE ERROR : ' DPG54-ERROR-MESSAGE              15210009
145800         MOVE +4003                    TO ABEND-CODE              15220009
145900         CALL 'ILBOABN0' USING ABEND-CODE                         15230009
146000     END-IF.                                                      15240009
146100******************************************************************15250009
146200* B220-SELECT-TPOLDTM.                                           *15260009
146300*     THIS PARAGRAPH SELECTS THE OTB SHIP DAYS QTY FROM TPOLDTM  *15270009
146400*     FOR USE IN CALCULATING THE OTB DATE FIELDS.                *15280009
146500******************************************************************15290009
146600                                                                  15300009
146700 B220-SELECT-TPOLDTM.                                             15310009
146800                                                                  15320009
146900     PERFORM                                                      15330009
147000         WITH TEST AFTER                                          15340009
147100         VARYING POWS055-RETRY-COUNTER                            15350009
147200         FROM 1 BY 1                                              15360009
147300         UNTIL ((POWS055-RETRY-COUNTER > POWS055-MAX-RETRIES)     15370009
147400                   OR (SQLCODE = ZERO))                           15380009
147500         EXEC SQL                                                 15390009
147600             SELECT SHIPT_WND_DAY_QTY                             15400009
147700               INTO :POLDTM-SHIPT-WND-DAY-QTY                     15410009
147800               FROM TPOLDTM                                       15420009
147900            WITH UR                                               15430009
148000         END-EXEC                                                 15440009
148100                                                                  15450009
148200         EVALUATE TRUE                                            15460009
148300             WHEN SQLCODE = ZERO                                  15470009
148400                 MOVE ZEROES          TO POWS055-SQLCODE          15480009
148500             WHEN SQLWARN0 NOT = SPACES                           15490009
148600             WHEN SQLCODE < ZERO                                  15500009
148700             WHEN SQLCODE > ZERO                                  15510009
148800                 SET POWS055-BAD-SELECT-TO-TPOLDTM                15520009
148900                                      TO TRUE                     15530009
149000                 MOVE SQLCODE         TO POWS055-SQLCODE          15540009
149100         END-EVALUATE                                             15550009
149200        END-PERFORM.                                              15560009
149300*                                                                 15570009
149400     IF  POWS055-RETRY-COUNTER > POWS055-MAX-RETRIES              15580009
149500         SET POWS055-BAD-SELECT-TO-TPOLDTM                        15590009
149600                                      TO TRUE                     15600009
149700         MOVE SQLCODE                 TO POWS055-SQLCODE          15610009
149800         DISPLAY '** ABEND **'                                    15620009
149900         DISPLAY '** PGM =  POKUT121 **'                          15630009
150000         DISPLAY '** PARAGRAPH = B220-SELECT-TPOLDTM'             15640009
150100         DISPLAY '** ' POWS055-ERROR-TYPE                         15650009
150200         MOVE POWS055-SQLCODE         TO ABEND-CODE               15660009
150300         CALL 'ILBOABN0' USING ABEND-CODE                         15670009
150400     END-IF.                                                      15680009
150500                                                                  15690009
150600******************************************************************15700009
150700*  PROCESS FOR GETTING THE DEPARTMENT DATA FROM DATABASE          15710009
150800******************************************************************15720009
150900 B250-PROCESS-DEPT-CURSOR.                                        15730009
151000                                                                  15740009
151100      INITIALIZE PV-DPT-TABLE.                                    15750009
151200      PERFORM Z800-OPEN-DEPT-CURSOR.                              15760009
151300      SET PV-DPT-INDEX TO 1.                                      15770009
151400      PERFORM Z810-FETCH-DEPT-CURSOR.                             15780009
151500                                                                  15790009
151600      PERFORM UNTIL PS-NO-MORE-DEPT-ROWS                          15800009
151700          PERFORM B270-LOAD-DEPT-TABLE                            15810009
151800          PERFORM Z810-FETCH-DEPT-CURSOR                          15820009
151900      END-PERFORM.                                                15830009
152000                                                                  15840009
152100      PERFORM Z820-CLOSE-DEPT-CURSOR.                             15850009
152200******************************************************************15860009
152300* LOAD THE DEPT DATA INTO AN INTERNAL TABLE                       15870009
152400******************************************************************15880009
152500                                                                  15890009
152600 B270-LOAD-DEPT-TABLE.                                            15900009
152700                                                                  15910009
152800     IF PV-DPT-INDEX             > 500                            15920009
152900         DISPLAY '*** ABEND ***'                                  15930009
153000         DISPLAY '*** DEPARTMENT TABLE HAS EXCEEDED 500 ENTRIES'  15940009
153100         MOVE    +4002           TO ABEND-CODE                    15950009
153200         CALL    'ILBOABN0' USING ABEND-CODE                      15960009
153300     END-IF.                                                      15970009
153400                                                                  15980009
153500     MOVE MDSEAR-OPERCO-NBR      TO PV-OPERCO-NBR(PV-DPT-INDEX).  15990009
153600     MOVE MDSEAR-GMA-NBR         TO PV-DPT-GMA-NBR(PV-DPT-INDEX). 16000009
153700     MOVE MDSEAR-DMA-NBR         TO PV-DPT-DMA-NBR(PV-DPT-INDEX). 16010009
153800     MOVE MDSEAR-DEPT-NBR        TO PV-DPT-NBR(PV-DPT-INDEX).     16020009
153900     MOVE MDSEAR-DESC            TO PV-DPT-DESC(PV-DPT-INDEX).    16030009
154000                                                                  16040009
154100     SET PV-DPT-INDEX UP BY 1.                                    16050009
154200                                                                  16060009
154300******************************************************************16070009
154400* PROCESS FOR ACTIVE PO DATA                                      16080009
154500******************************************************************16090009
154600                                                                  16100009
154700 B300-EXTRACT-ACTIVE-POS.                                         16110009
154800*                                                                 16120009
154900     SET PS-MORE-ROWS TO TRUE.                                    16130009
155000     PERFORM Z500-OPEN-ACTIVE-PO-CURSOR.                          16140009
155100     PERFORM Z600-FETCH-ACTIVE-PO-ROW.                            16150009
155200                                                                  16160009
155300     PERFORM                                                      16170009
155400           UNTIL PS-NO-MORE-ROWS                                  16180009
155500           PERFORM VARYING ROW-ID FROM 1 BY 1                     16190009
155600              UNTIL ROW-ID > WS-SQLERRD3                          16200009
155700              PERFORM C100-PROCESS-ACTIVE-PO-ROWS                 16210009
155800           END-PERFORM                                            16220009
155900          PERFORM Z600-FETCH-ACTIVE-PO-ROW                        16230009
156000     END-PERFORM                                                  16240009
156100                                                                  16250009
156200     PERFORM Z700-CLOSE-ACTIVE-PO-CURSOR.                         16260009
156300                                                                  16270009
156400******************************************************************16280009
156500* PROCESS FOR RECEIPT DATA                                        16290009
156600******************************************************************16300009
156700                                                                  16310009
156800 B400-EXTRACT-RECEIPTS.                                           16320009
156900*                                                                 16330009
157000     SET PS-DC-MORE-ROWS TO TRUE.                                 16340009
157100     PERFORM Z500-OPEN-DRIVING-CURSOR.                            16350009
157200     ACCEPT ST-SYSTEM-TIME FROM TIME.                             16360009
157300                                                                  16370009
157400     DISPLAY 'DRIVING CURSOR START TIME: ' ST-SYSTEM-TIME.        16380009
157500                                                                  16390009
157600     PERFORM Z600-FETCH-DRIVING-ROW.                              16400009
157700                                                                  16410009
157800     PERFORM C500-PROCESS-DRIVING-ROWS                            16420009
157900             UNTIL PS-DC-NO-MORE-ROWS.                            16430009
158000                                                                  16440009
158100     PERFORM Z700-CLOSE-DRIVING-CURSOR.                           16450009
158200                                                                  16460009
158300******************************************************************16470009
158400*  CLOSE ALL FILES USED BY THIS PROGRAM.                          16480009
158500******************************************************************16490009
158600 B500-CLOSE-FILES.                                                16500009
158700                                                                  16510009
158800     CLOSE       ACTIVE-PO-FILE                                   16520009
158900                 CNTL-DEF-RCPTS-FILE                              16530009
159000                 MONTH-RECEIPTS-FILE                              16540009
159100                 RECEIPTS-FILE.                                   16550009
159200*                                                                 16560009
159300******************************************************************16570009
159400*  PROCESS ALL ROWS RETURNED FROM THE ACTIVE PO CURSOR.           16580009
159500******************************************************************16590009
159600 C100-PROCESS-ACTIVE-PO-ROWS.                                     16600009
159700                                                                  16610009
159800     INITIALIZE PO010-RECORD.                                     16620009
159900     MOVE PV-PO-NBR-A(ROW-ID)              TO PO010-PO-NUMBER     16630009
160000                                              PURCHS-PO-NBR       16640009
160100     MOVE PV-PO-LNE-NBR-A(ROW-ID)          TO                     16650009
160200                                        PURITM-PO-LNE-NBR         16660009
160300     MOVE PV-APP-PO-LNE-NBR-A(ROW-ID)      TO                     16670009
160400                                        PO010-PO-LINE.            16680009
160500     MOVE PV-PO-SHRT-CYC-IND-A(ROW-ID)     TO                     16690009
160600                                        PO010-PO-SHRT-CYC-IND.    16700009
160700     MOVE PV-APP-PO-LNE-NBR-A(ROW-ID)      TO                     16710009
160800                                      PV-PURITM-APP-PO-LNE-NBR.   16720009
160900                                                                  16730009
161000     IF PV-SKU-NBR-IND-A(ROW-ID) = 0                              16740009
161100        MOVE PV-SKU-NBR-A(ROW-ID)          TO PO010-SKU-NBR       16750009
161200        MOVE PV-MAJ-CL-NBR-A(ROW-ID) TO PV-MAJ-CLASS              16760009
161300        MOVE PV-MAJ-CLASS                  TO PO010-MAJOR-CLASS   16770009
161400        MOVE PV-SUB-CL-NBR-A(ROW-ID) TO PO010-MINOR-CLASS         16780009
161500     ELSE                                                         16790009
161600         MOVE PV-DEPT-NBR-A(ROW-ID)        TO PV-TEMP-DEPT        16800009
161700         MOVE PV-CL-NBR-A(ROW-ID)          TO PV-TEMP-CLASS       16810009
161800         MOVE PV-SKU-SEQ-NBR-A(ROW-ID) TO PV-TEMP-SKU-SEQ         16820009
161900         MOVE PV-TEMP-SKU-RED              TO PO010-SKU-NBR       16830009
162000         MOVE PV-CL-NBR-A(ROW-ID)(1:1) TO PV-TEMP-MAJ-CL-1        16840009
162100         MOVE PV-TEMP-MAJ-CL               TO PO010-MAJOR-CLASS   16850009
162200         MOVE PV-CL-NBR-A(ROW-ID)          TO PO010-MINOR-CLASS   16860009
162300     END-IF.                                                      16870009
162400     MOVE PV-STATUS-CDE-A(ROW-ID)          TO PO010-STATUS-CDE.   16880009
162500     MOVE PV-DEPT-NBR-A(ROW-ID)            TO PO010-DEPT.         16890009
162600     MOVE PV-PO-TYP-CDE-A(ROW-ID)          TO PO010-PO-TYP-CDE.   16900009
162700     MOVE PV-CRE-BY-UID-A(ROW-ID)          TO PO010-CRE-BY-UID.   16910009
162800                                                                  16920009
162900     IF PV-AD-EVNT-DTE-A(ROW-ID) = PC-EMPTY-DATE                  16930009
163000         MOVE PC-ALL-NINES                 TO PO010-AD-DATE       16940009
163100     ELSE                                                         16950009
163200         MOVE PV-AD-EVNT-DTE-A(ROW-ID) TO PO010-AD-DATE           16960009
163300     END-IF.                                                      16970009
163400                                                                  16980009
163500     MOVE PV-DONT-SHIP-BEF-DTE-A(ROW-ID)     TO POWS055-INPUT-DATE16990009
163600     MOVE PV-CALCED-OTB-DATE-A(ROW-ID)  TO                        17000009
163700                                        POWS055-CALCED-OTB-DATE   17010009
163800     PERFORM C300-CALC-WEEKLY-OTB.                                17020009
163900                                                                  17030009
164000     MOVE PV-DONT-SHIP-BEF-DTE-A(ROW-ID)     TO PV-TEMP-ISO-DATE. 17040009
164100     MOVE PV-TEMP-ISO-CC                     TO PO010-SHIP-CC.    17050009
164200     MOVE PV-TEMP-ISO-YY                     TO PO010-SHIP-YY.    17060009
164300     MOVE PV-TEMP-ISO-MM                     TO PO010-SHIP-MM.    17070009
164400     MOVE PV-TEMP-ISO-DD                     TO PO010-SHIP-DD.    17080009
164500                                                                  17090009
164600     IF PV-EXT-CAN-DTE-A(ROW-ID) = PC-EMPTY-DATE                  17100009
164700         MOVE PV-CAN-IFNOT-SHIP-DTE-A(ROW-ID)                     17110009
164800                                             TO PV-TEMP-ISO-DATE  17120009
164900     ELSE                                                         17130009
165000         MOVE PV-EXT-CAN-DTE-A(ROW-ID)       TO PV-TEMP-ISO-DATE  17140009
165100     END-IF.                                                      17150009
165200                                                                  17160009
165300     MOVE PV-TEMP-ISO-MM             TO PO010-CANCEL-MM.          17170009
165400     MOVE PV-TEMP-ISO-DD             TO PO010-CANCEL-DD.          17180009
165500     MOVE PV-ENT-NAME-DESC-A(ROW-ID)                              17190009
165600                                     TO PO010-VENDOR-NAME.        17200009
165700                                                                  17210009
165800     IF PV-GP-QTY-A(ROW-ID) > 1                                   17220009
165900         COMPUTE PV-HOLD-UNIT-RTL ROUNDED =                       17230009
166000              PV-GP-RTL-AMT-A(ROW-ID)/                            17240009
166100                             PV-GP-QTY-A (ROW-ID)                 17250009
166200         END-COMPUTE                                              17260009
166300     ELSE                                                         17270009
166400         COMPUTE PV-HOLD-UNIT-RTL =                               17280009
166500              PV-UNT-RTL-PR-AMT-A(ROW-ID)                         17290009
166600         END-COMPUTE                                              17300009
166700     END-IF.                                                      17310009
166800     MOVE PV-UNT-COST-AMT-A(ROW-ID)     TO PO010-UNIT-COST.       17320009
166900     MOVE PV-HOLD-UNIT-RTL              TO PO010-UNIT-RETAIL.     17330009
167000     MOVE PV-UNT-QTY-A(ROW-ID)          TO PV-HOLD-PURITM-UNT-QTY.17340009
167100                                                                  17350009
167200     IF PV-DEPT-NBR-A(ROW-ID) = PV-DPT-NBR(PV-DPT-INDEX)          17360009
167300         CONTINUE                                                 17370009
167400     ELSE                                                         17380009
167500         SET PV-DPT-INDEX               TO +1                     17390009
167600         PERFORM C150-SEARCH-DEPT-TABLE                           17400009
167700     END-IF.                                                      17410009
167800                                                                  17420009
167900     MOVE PV-DPT-GMA-NBR(PV-DPT-INDEX)                            17430009
168000                                        TO PO010-GMA-NBR          17440009
168100     MOVE PV-DPT-DMA-NBR(PV-DPT-INDEX)                            17450009
168200                                        TO PO010-DMA-NBR          17460009
168300     MOVE PV-OPERCO-NBR(PV-DPT-INDEX)                             17470009
168400                                        TO PO010-OPERCO-NBR.      17480009
168500     MOVE PV-DPT-DESC(PV-DPT-INDEX)                               17490009
168600                                        TO PO010-DEPT-DESC.       17500009
168700                                                                  17510009
168800     SET PS-NO-DISTRO-EXISTS            TO TRUE.                  17520009
168900     SET PS-MORE-ALLPLN-ROWS            TO TRUE.                  17530009
169000                                                                  17540009
169100     PERFORM Z825-OPEN-TALLPLN-CURSOR.                            17550009
169200                                                                  17560009
169300     PERFORM UNTIL PS-NO-MORE-ALLPLN-ROWS                         17570009
169400         PERFORM Z830-FETCH-TALLPLN-CURSOR                        17580009
169500                                                                  17590009
169600         PERFORM VARYING ROW-ID-TPLN FROM 1 BY 1                  17600009
169700           UNTIL ROW-ID-TPLN > WS-SQLERRD3-TPLN                   17610009
169800            MOVE PV-CURR-SPLIT-QTY-A(ROW-ID-TPLN)                 17620009
169900                                        TO PO010-OPEN-UNITS       17630009
170000            IF PV-DEST-NBR-A(ROW-ID-TPLN) =                       17640009
170100                                     PV-ALLPLN-DEST-NBR           17650009
170200                 MOVE PV-DC-NMBR(PV-STR-INDEX)                    17660009
170300                                        TO PO010-DC-NBR           17670009
170400             ELSE                                                 17680009
170500                 MOVE PV-DEST-NBR-A(ROW-ID-TPLN)                  17690009
170600                                        TO PV-STORE-NBR           17700009
170700                                           PV-ALLPLN-DEST-NBR     17710009
170800                 SET PV-STR-INDEX       TO 1                      17720009
170900                 PERFORM B190-SEARCH-STORE-TABLE                  17730009
171000            END-IF                                                17740009
171100                                                                  17750009
171200            MOVE PO010-DC-NBR           TO  XMT00001-LOC-NBR      17760009
171300            PERFORM C110-PROCESS-EBUS-DATA                        17770009
171400            PERFORM Z150-WRITE-ACTIVE-PO-REC                      17780009
171500            COMPUTE PV-HOLD-PURITM-UNT-QTY =                      17790009
171600                    PV-HOLD-PURITM-UNT-QTY -                      17800009
171700                           PV-CURR-SPLIT-QTY-A(ROW-ID-TPLN)       17810009
171800        END-PERFORM                                               17820009
171900     END-PERFORM.                                                 17830009
172000                                                                  17840009
172100     PERFORM Z835-CLOSE-TALLPLN-CURSOR.                           17850009
172200                                                                  17860009
172300     IF PV-HOLD-PURITM-UNT-QTY  = 0                               17870009
172400         CONTINUE                                                 17880009
172500     ELSE                                                         17890009
172600         SET PS-NO-DISTRO-EXISTS        TO TRUE                   17900009
172700     END-IF.                                                      17910009
172800                                                                  17920009
172900     IF PS-NO-DISTRO-EXISTS                                       17930009
173000         MOVE PV-HOLD-PURITM-UNT-QTY                              17940009
173100                                        TO PO010-OPEN-UNITS       17950009
173200         MOVE PC-DEST-0                 TO PO010-DC-NBR           17960009
C98147         MOVE 'N'                       TO PO010-E-BUS-IND        17970009
173400         PERFORM Z150-WRITE-ACTIVE-PO-REC                         17980009
173500     END-IF.                                                      17990009
173600                                                                  18000009
173700******************************************************************18010009
173800* GET THE EBUSINESS INDICATOR FOR ACTIVE PO DATA                  18020009
173900******************************************************************18030009
174000                                                                  18040009
174100 C110-PROCESS-EBUS-DATA.                                          18050009
174200                                                                  18060009
174300     INITIALIZE E-BUS-NULL-IND XMT00001-E-BUS-IND                 18070009
174400     EXEC SQL                                                     18080009
174500          SELECT                                                  18090009
174600                LOC.E_BUS_IND                                     18100009
174700          INTO                                                    18110009
174800               :XMT00001-E-BUS-IND                                18120009
174900               :E-BUS-NULL-IND                                    18130009
175000           FROM                                                   18140009
175100                XMT_LOC  LOC                                      18150009
175200           WHERE                                                  18160009
175300                LOC.LOC_NBR      = :XMT00001-LOC-NBR              18170009
175400           WITH UR                                                18180009
175500     END-EXEC                                                     18190009
175600                                                                  18200009
175700     IF SQLCODE = 0                                               18210009
175800         IF E-BUS-NULL-IND < 0 THEN                               18220009
C98147           MOVE 'N'                 TO  PO010-E-BUS-IND           18230009
176000                                        PO016-E-BUS-IND           18240009
176100         ELSE                                                     18250009
C98147           MOVE XMT00001-E-BUS-IND  TO  PO010-E-BUS-IND           18260009
176300                                        PO016-E-BUS-IND           18270009
176400         END-IF                                                   18280009
176500     ELSE                                                         18290009
176600         MOVE 'C110-PROCESS-EBUS-DATA'                            18300009
176700                                    TO PV-PARAGRAPH-NAME          18310009
176800         MOVE 'RETRIEVING E-BUSINESS INDICATOR'                   18320009
176900                                    TO PV-DB2-OPER-ATTEMPTED      18330009
177000         DISPLAY 'PURCHS-PO-NBR' PURCHS-PO-NBR                    18340009
177100         PERFORM Z900-SQL-ABEND                                   18350009
177200     END-IF.                                                      18360009
177300                                                                  18370009
177400******************************************************************18380009
177500*  SEARCH THE DEPARTMENT TABLE FOR THE VALID DEPARTMENT NUMBER.   18390009
177600******************************************************************18400009
177700 C150-SEARCH-DEPT-TABLE.                                          18410009
177800      SEARCH                         PV-DPT-ENTRY                 18420009
177900          AT  END                                                 18430009
178000              DISPLAY 'NOT FOUND IN MBS'                          18440009
178100                       'DEPT NUMBER =  '                          18450009
178200                          PV-DEPT-NBR-A(ROW-ID)                   18460009
178300          WHEN PV-DPT-NBR(PV-DPT-INDEX) =                         18470009
178400                          PV-DEPT-NBR-A(ROW-ID)                   18480009
178500              CONTINUE                                            18490009
178600      END-SEARCH.                                                 18500009
178700                                                                  18510009
178800******************************************************************18520009
178900*  PROCESS ALL ROWS RETURNED FROM THE RECEIPT CURSOR.             18530009
179000******************************************************************18540009
179100 C200-PROCESS-RECEIPT-ROWS.                                       18550009
179200                                                                  18560009
179300     INITIALIZE PO010-RECORD.                                     18570009
179400     MOVE RECDIS-AP-VERIFY-ITM-QTY      TO PO016-UNITS.           18580009
179500                                                                  18590009
179600     IF PURITM-GP-QTY > 1                                         18600009
179700         COMPUTE PV-UNIT-RTL ROUNDED =                            18610009
179800              PURITM-GP-RTL-AMT / PURITM-GP-QTY                   18620009
179900         END-COMPUTE                                              18630009
180000     ELSE                                                         18640009
180100         COMPUTE PV-UNIT-RTL =                                    18650009
180200              PURITM-UNT-RTL-PR-AMT                               18660009
180300         END-COMPUTE                                              18670009
180400     END-IF.                                                      18680009
180500                                                                  18690009
180600     COMPUTE PO016-RETAIL =                                       18700009
180700         (PV-UNIT-RTL *  PO016-UNITS).                            18710009
180800     MOVE PO016-RETAIL                  TO PO010-RECEIPTS.        18720009
180900     COMPUTE PO016-COST  =                                        18730009
181000         (PURITM-UNT-COST-AMT   *  PO016-UNITS).                  18740009
181100                                                                  18750009
181200     IF  PV-MAJ-CL-NBR-IND = 0                                    18760009
181300         MOVE XLT00004-MAJ-CL-NBR       TO PV-MAJ-CLASS           18770009
181400         MOVE PV-MAJ-CLASS              TO PO016-CLASS            18780009
181500                                           PO010-MAJOR-CLASS      18790009
181600     ELSE                                                         18800009
181700         MOVE PURITM-CL-NBR             TO PO016-CLASS            18810009
181800                                           PO010-MAJOR-CLASS      18820009
181900         MOVE '0'                       TO PO016-MIN-CL           18830009
182000                                           PO010-MIN-CL           18840009
182100     END-IF.                                                      18850009
182200                                                                  18860009
182300     MOVE PURCHS-DEPT-NBR               TO PO016-DEPT             18870009
182400                                           PO016-VEND-KEY-DEPT    18880009
182500                                           PO010-DEPT.            18890009
182600     MOVE ENTNME-ENT-NAME-DESC          TO PO016-VEND-KEY-NAME    18900009
182700                                           PO010-VENDOR-NAME.     18910009
182800     MOVE PV-VERIFIED-MM                TO PO016-MM.              18920009
182900     MOVE PV-VERIFIED-YY                TO PO016-YY.              18930009
           PERFORM C400-GET-WK-FOR-VERFYD.                              18940009
183000     MOVE PURCHS-PO-NBR                 TO PO016-PO-NUMBER        18950009
183100                                           PO010-PO-NUMBER.       18960009
183200     MOVE PURCHS-PO-TYP-CDE             TO PO016-PO-TYP-CDE.      18970009
183300     MOVE PURCHS-CRE-BY-UID             TO PO016-CRE-BY-UID.      18980009
183400     MOVE PURCHS-PO-SHRT-CYC-IND        TO PO016-PO-SHRT-CYC-IND  18990009
183500                                           PO010-PO-SHRT-CYC-IND. 19000009
183600     MOVE PLNSHP-DONT-SHIP-BEF-DTE      TO POWS055-INPUT-DATE.    19010009
183700     PERFORM C300-CALC-WEEKLY-OTB.                                19020009
183800                                                                  19030009
183900     MOVE RECDIS-STR-NBR            TO  XMT00001-LOC-NBR          19040009
184000     PERFORM C110-PROCESS-EBUS-DATA                               19050009
184100                                                                  19060009
184200     IF  RECEIV-ORD-NBR = WS-PREV-RECEIV-ORD-NBR AND              19070009
184300         RECITM-ORD-LNE-NBR = WS-PREV-RECITM-ORD-LNE-NBR AND      19080009
184400         RECEIV-REC-SEQ-NBR = WS-PREV-RECEIV-REC-SEQ-NBR          19090009
184500         CONTINUE                                                 19100009
184600     ELSE                                                         19110009
184700         PERFORM C210-PROCESS-EARLY-REC-DATA                      19120009
184800                                                                  19130009
184900     END-IF                                                       19140009
185000                                                                  19150009
185100     MOVE POWS055-CALCED-OTB-DATE TO DPG52-LK-DATE-INPUT          19160009
185200     MOVE CC-CALENDAR-TYPE TO DPG51-CALENDAR-TYPE.                19170009
185300     SET  DPG52-LK-DTE-ISO-FMT TO TRUE.                           19180009
185400                                                                  19190009
185500     CALL DP500-KOHLS-CALENDAR-ROUTINE USING                      19200009
185600                                DPG51 DPG52                       19210009
185700                                DPG53 DPG54                       19220009
185800                                DPG55 DPG56.                      19230009
185900                                                                  19240009
186000     IF DPG54-NO-ERROR                                            19250009
186100         MOVE DPG56-FIRST-FP-DB2-ISO-FMT TO PV-OTB-FSCL-MNTH-BEG  19260009
186200     ELSE                                                         19270009
186300         DISPLAY '** ABEND ** IN PUKUT121'                        19280009
186400         DISPLAY 'DATE ERROR : ' DPG54-ERROR-MESSAGE              19290009
186500         MOVE +4003 TO ABEND-CODE                                 19300009
186600         CALL 'ILBOABN0' USING ABEND-CODE                         19310009
186700     END-IF.                                                      19320009
186800                                                                  19330009
186900***SET THE EARLY RECEIPT INDICATOR IF THE FIRST GOODS RECEIVED    19340009
187000***DATE IS LESS THAN THE OPEN TO BUY DATE.                        19350009
187100                                                                  19360009
187200     IF WS-FIRST-RCVD-DATE-CHAR < PV-OTB-FSCL-MNTH-BEG            19370009
187300        MOVE 'Y'                       TO  PO016-EAR-REC-IND      19380009
187400     ELSE                                                         19390009
187500        MOVE 'N'                       TO  PO016-EAR-REC-IND      19400009
187600     END-IF                                                       19410009
187700                                                                  19420009
187800     MOVE PC-ALL-NINES                 TO PO010-AD-DATE.          19430009
187900                                                                  19440009
188000     PERFORM Z100-WRITE-RECEIPT-EXT-REC.                          19450009
188100                                                                  19460009
188200     IF STATCD-STATUS-CLS = 'ACT'                                 19470009
188300         PERFORM Z125-WRITE-MONTH-RECEIPTS-REC                    19480009
188400     END-IF.                                                      19490009
188500                                                                  19500009
188600     IF PS-RECLASS-DOES-NOT-EXIST                                 19510009
188700         COMPUTE FETCH-COUNT = FETCH-COUNT + 1                    19520009
188800         PERFORM Z300-FETCH-RECEIPT-ROW                           19530009
188900     ELSE                                                         19540009
189000         COMPUTE FETCH-COUNT-RCLS = FETCH-COUNT-RCLS + 1          19550009
189100         PERFORM Z350-FETCH-RCLS-RECEIPT-ROW                      19560009
189200     END-IF.                                                      19570009
189300                                                                  19580009
189400******************************************************************19590009
189500*  GET THE FIRST GOODS RECEIVED DATA FROM TRECITM TABLE AND       19600009
189600*  CATEGORY THE RECEIPT AS EARLY OR REGULAR RECEIPT DATA.         19610009
189700******************************************************************19620009
189800 C210-PROCESS-EARLY-REC-DATA.                                     19630009
189900*                                                                 19640009
190000     INITIALIZE  PV-MIN-VERFYD-TMST-IND                           19650009
190100     MOVE  RECEIV-ORD-NBR     TO     WS-PREV-RECEIV-ORD-NBR       19660009
190200     MOVE  RECITM-ORD-LNE-NBR TO     WS-PREV-RECITM-ORD-LNE-NBR   19670009
190300     MOVE  RECEIV-REC-SEQ-NBR TO     WS-PREV-RECEIV-REC-SEQ-NBR   19680009
190400                                                                  19690009
190500     EXEC SQL                                                     19700009
190600          SELECT                                                  19710009
190700                MIN(VERFYD_TMST)                                  19720009
190800            INTO                                                  19730009
190900                :PV-MIN-VERFYD-TMST                               19740009
191000                :PV-MIN-VERFYD-TMST-IND                           19750009
191100            FROM TRECITM                                          19760009
191200           WHERE                                                  19770009
191300                ORD_NBR        =  :RECEIV-ORD-NBR                 19780009
191400           AND  ORD_LNE_NBR    =  :RECITM-ORD-LNE-NBR             19790009
191500           AND  REC_SEQ_NBR    =  :RECEIV-REC-SEQ-NBR             19800009
191600           AND  VER_STATUS_CDE =  'A'                             19810009
191700           AND  VERFYD_TMST    ^= :PC-NULL-TMST                   19820009
191800          WITH UR                                                 19830009
191900     END-EXEC                                                     19840009
192000                                                                  19850009
192100     EVALUATE SQLCODE                                             19860009
192200     WHEN 00                                                      19870009
192300                                                                  19880009
192400        IF PV-MIN-VERFYD-TMST-IND NOT = 0                         19890009
192500           MOVE SPACES    TO PV-MIN-VERFYD-TMST                   19900009
192600        END-IF                                                    19910009
192700        MOVE PV-MIN-VERFYD-TMST      TO PV-DB2-DATE               19920009
192800        MOVE PV-DB2-DATE             TO WS-FIRST-RCVD-DATE-CHAR   19930009
192900                                                                  19940009
193000     WHEN 100                                                     19950009
193100                                                                  19960009
193200        MOVE  999999                 TO WS-FIRST-RCVD-DATE        19970009
193300        MOVE  '99'                   TO WS-RCVD-CENT-CHAR         19980009
193400        MOVE  WS-RCVD-YEAR           TO WS-RCVD-YEAR-CHAR         19990009
193500        MOVE  WS-RCVD-MONTH          TO WS-RCVD-MONTH-CHAR        20000009
193600        MOVE  WS-RCVD-DAY            TO WS-RCVD-DAY-CHAR          20010009
193700     WHEN OTHER                                                   20020009
193800          MOVE 'C210-PROCESS-EARLY-REC-DATA'                      20030009
193900                                     TO PV-PARAGRAPH-NAME         20040009
194000          MOVE 'RETRIEVING E-BUSINESS INDICATOR'                  20050009
194100                                     TO PV-DB2-OPER-ATTEMPTED     20060009
194200          DISPLAY  'ORDER NUMBER: '    RECEIV-ORD-NBR             20070009
194300          PERFORM Z900-SQL-ABEND                                  20080009
194400     END-EVALUATE.                                                20090009
194500                                                                  20100009
194600******************************************************************20110009
194700* THIS IS FOR GETTING THE OTB DATE FROM THE INTERNAL TABLE.       20120009
194800***************************************************************** 20130009
194900                                                                  20140009
195000 C300-CALC-WEEKLY-OTB.                                            20150009
195100                                                                  20160009
195200         SET PV-DATE-INDEX            TO +1                       20170009
195300         SEARCH  ALL                 PV-DATE-ENTRY                20180009
195400             AT  END                                              20190009
195500                 DISPLAY 'NOT FOUND IN THE DATE TABLE C300'       20200009
195600                          POWS055-CALCED-OTB-DATE                 20210009
195700             WHEN PV-DTATTR-KY-DTE(PV-DATE-INDEX) =               20220009
195800                                 POWS055-CALCED-OTB-DATE          20230009
195900                  MOVE PV-FSCL-YR-NBR(PV-DATE-INDEX)(3:2)         20240009
196000                                      TO PO010-DIST-YY            20250009
196100                  MOVE PV-FSCL-MN-NBR(PV-DATE-INDEX)              20260009
196200                                      TO PO010-DIST-MM            20270009
196300                  MOVE PV-OTB-MONTH(PV-DATE-INDEX)                20280009
196400                                      TO PO010-DIST-WW            20290009
196500         END-SEARCH.                                              20300009
196600                                                                  20310009
194600******************************************************************20320009
194700* THIS IS FOR GETTING THE FISCAL WK NBR FOR THE VERFYD TMST.      20330009
194800***************************************************************** 20340009
194900                                                                  20350009
195000 C400-GET-WK-FOR-VERFYD.                                          20360009
195100                                                                  20370009
195200         SET PV-DATE-INDEX            TO +1                       20380009
195300         SEARCH  ALL                 PV-DATE-ENTRY                20390009
195400             AT  END                                              20400009
195500                 DISPLAY 'NOT FOUND IN THE DATE TABLE C400'       20410009
195600                          WS-VERFYD-TMST-DATE                     20420009
195700             WHEN PV-DTATTR-KY-DTE(PV-DATE-INDEX) =               20430009
195800                                 WS-VERFYD-TMST-DATE              20440009
195900                  MOVE PV-OTB-MONTH(PV-DATE-INDEX)                20450009
196000                                      TO PO016-WW                 20460009
196500         END-SEARCH.                                              20470009
196600                                                                  20480009
196700******************************************************************20490009
196800* PROCESS FOR CALLING THE RECEIPT CURSOR FETCH PROCESS            20500009
196900******************************************************************20510009
197000                                                                  20520009
197100 C500-PROCESS-DRIVING-ROWS.                                       20530009
197200*                                                                 20540009
197300     SET PS-MORE-ROWS TO TRUE.                                    20550009
197400     IF PS-RECLASS-DOES-NOT-EXIST                                 20560009
197500         PERFORM Z200-OPEN-RECEIPT-CURSOR                         20570009
197600         PERFORM Z300-FETCH-RECEIPT-ROW                           20580009
197700                                                                  20590009
197800         PERFORM C200-PROCESS-RECEIPT-ROWS                        20600009
197900           UNTIL PS-NO-MORE-ROWS                                  20610009
198000                                                                  20620009
198100         PERFORM Z400-CLOSE-RECEIPT-CURSOR                        20630009
198200     ELSE                                                         20640009
198300         PERFORM Z250-OPEN-RCLS-RECEIPT-CURSOR                    20650009
198400         PERFORM Z350-FETCH-RCLS-RECEIPT-ROW                      20660009
198500                                                                  20670009
198600         PERFORM C200-PROCESS-RECEIPT-ROWS                        20680009
198700           UNTIL PS-NO-MORE-ROWS                                  20690009
198800                                                                  20700009
198900         PERFORM Z450-CLOSE-RCLS-RECEIPT-CURSOR                   20710009
199000     END-IF.                                                      20720009
199100                                                                  20730009
199200     PERFORM Z600-FETCH-DRIVING-ROW.                              20740009
199300                                                                  20750009
199400******************************************************************20760009
199500*    OPEN THE CURSOR WHICH WILL RETRIEVE DATE FROM THE            20770009
199600*    TDTATTR  TABLE.                                              20780009
199700******************************************************************20790009
199800                                                                  20800009
199900 D100-OPEN-DATE-CURSOR.                                           20810009
200000                                                                  20820009
200100     PERFORM                                                      20830009
200200         WITH TEST AFTER                                          20840009
200300         VARYING PV-SQL-SUB                                       20850009
200400         FROM 1 BY 1                                              20860009
200500         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       20870009
200600                   OR SQLCODE = 0                                 20880009
200700                   OR SQLCODE = +100)                             20890009
200800                                                                  20900009
200900         EXEC SQL                                                 20910009
201000             OPEN DATE_CURSOR                                     20920009
201100         END-EXEC                                                 20930009
201200                                                                  20940009
201300         EVALUATE TRUE                                            20950009
201400             WHEN SQLCODE = -904                                  20960009
201500             WHEN SQLCODE = -911                                  20970009
201600             WHEN SQLCODE = 0                                     20980009
201700                 CONTINUE                                         20990009
201800             WHEN SQLCODE = +100                                  21000009
201900                SET PS-NO-MORE-DATE-ROWS TO TRUE                  21010009
202000             WHEN SQLWARN NOT = SPACES                            21020009
202100             WHEN SQLCODE NOT = ZERO                              21030009
202200                MOVE 'D100-OPEN-DATE-CURSOR'                      21040009
202300                                         TO  PV-PARAGRAPH-NAME    21050009
202400                MOVE 'OPEN ON CURSOR'                             21060009
202500                                         TO  PV-DB2-OPER-ATTEMPTED21070009
202600                PERFORM Z900-SQL-ABEND                            21080009
202700         END-EVALUATE                                             21090009
202800     END-PERFORM.                                                 21100009
202900*                                                                 21110009
203000     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        21120009
203100         MOVE 'D100-OPEN-DATE-CURSOR'                             21130009
203200                                         TO  PV-PARAGRAPH-NAME    21140009
203300         MOVE 'OPEN RETRIES EXCEEDED'                             21150009
203400                                         TO  PV-DB2-OPER-ATTEMPTED21160009
203500         PERFORM Z900-SQL-ABEND                                   21170009
203600     END-IF.                                                      21180009
203700                                                                  21190009
203800******************************************************************21200009
203900*    FETCH THE NEXT ROW OF THE DATE CURSOR.                       21210009
204000******************************************************************21220009
204100                                                                  21230009
204200 D200-FETCH-DATE-CURSOR.                                          21240009
204300                                                                  21250009
204400     EXEC SQL                                                     21260009
204500         FETCH NEXT ROWSET  FROM DATE_CURSOR FOR 100 ROWS         21270009
204600            INTO                                                  21280009
204700                :PV-FSCL-YR-NBR-A                                 21290009
204800               ,:PV-FSCL-MN-NBR-A                                 21300009
204900               ,:PV-CAL-MN-NBR-A                                  21310009
205000               ,:PV-OTB-MONTH-A                                   21320009
205100               ,:PV-OTB-FSCL-WEEK-NBR-A                           21330009
205200               ,:PV-OTB-FSCL-WK-BEG-DTE-A                         21340009
205300               ,:PV-KY-DTE-A                                      21350009
205400     END-EXEC.                                                    21360009
205500                                                                  21370009
205600     IF SQLCODE = +100                                            21380009
205700         SET PS-NO-MORE-DATE-ROWS TO TRUE                         21390009
205800         PERFORM VARYING ROW-ID-DTE FROM 1 BY 1                   21400009
205900              UNTIL ROW-ID-DTE > SQLERRD (3)                      21410009
206000              PERFORM D300-LOAD-DATE-TABLE                        21420009
206100         END-PERFORM                                              21430009
206200     ELSE                                                         21440009
206300         IF SQLCODE NOT = 0                                       21450009
206400              MOVE 'D200-FETCH-DATE-CURSOR'                       21460009
206500                                  TO PV-PARAGRAPH-NAME            21470009
206600              MOVE 'FETCH ROW FROM DEPT CURSOR     '              21480009
206700                                  TO PV-DB2-OPER-ATTEMPTED        21490009
206800             PERFORM Z900-SQL-ABEND                               21500009
206900         END-IF                                                   21510009
207000     END-IF.                                                      21520009
207100                                                                  21530009
207200******************************************************************21540009
207300*    LOAD THE DATE ATTRIBUTE DATA INTO AN INTERNAL TABLE.         21550009
207400******************************************************************21560009
207500 D300-LOAD-DATE-TABLE.                                            21570009
207600                                                                  21580009
207700     IF PV-DATE-INDEX             > 20000                         21590009
207800         DISPLAY '*** ABEND ***'                                  21600009
207900         DISPLAY '*** DATE TABLE HAS EXCEEDED 20000 ENTRIES'      21610009
208000         MOVE    +4002           TO ABEND-CODE                    21620009
208100         CALL    'ILBOABN0' USING ABEND-CODE                      21630009
208200     END-IF.                                                      21640009
208300                                                                  21650009
208400     ADD 01                      TO PV-DATE-TB-SIZE.              21660009
208500     MOVE PV-FSCL-YR-NBR-A(ROW-ID-DTE)                            21670009
208600                                 TO PV-FSCL-YR-NBR(PV-DATE-INDEX) 21680009
208700     MOVE PV-FSCL-MN-NBR-A(ROW-ID-DTE)                            21690009
208800                                 TO PV-FSCL-MN-NBR(PV-DATE-INDEX).21700009
208900     MOVE PV-CAL-MN-NBR-A(ROW-ID-DTE)                             21710009
209000                                 TO PV-CAL-MN-NBR(PV-DATE-INDEX). 21720009
209100     MOVE PV-OTB-MONTH-A(ROW-ID-DTE)                              21730009
209200                                 TO PV-OTB-MONTH(PV-DATE-INDEX).  21740009
209300     MOVE PV-OTB-FSCL-WEEK-NBR-A(ROW-ID-DTE)                      21750009
209400                                 TO                               21760009
209500                                 PV-OTB-FSCL-WEEK(PV-DATE-INDEX). 21770009
209600     MOVE PV-OTB-FSCL-WK-BEG-DTE-A(ROW-ID-DTE)                    21780009
209700                                 TO                               21790009
209800                              PV-OTB-FSCL-WEEK-BEG(PV-DATE-INDEX).21800009
209900     MOVE PV-KY-DTE-A(ROW-ID-DTE)                                 21810009
210000                               TO PV-DTATTR-KY-DTE(PV-DATE-INDEX).21820009
210100                                                                  21830009
210200     SET PV-DATE-INDEX UP BY 1.                                   21840009
210300                                                                  21850009
210400******************************************************************21860009
210500*    CLOSE THE DATE CURSOR.                                       21870009
210600******************************************************************21880009
210700                                                                  21890009
210800 D500-CLOSE-DATE-CURSOR.                                          21900009
210900                                                                  21910009
211000     PERFORM                                                      21920009
211100         WITH TEST AFTER                                          21930009
211200         VARYING PV-SQL-SUB                                       21940009
211300         FROM 1 BY 1                                              21950009
211400         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       21960009
211500                   OR SQLCODE = 0)                                21970009
211600                                                                  21980009
211700         EXEC SQL                                                 21990009
211800             CLOSE DATE_CURSOR                                    22000009
211900         END-EXEC                                                 22010009
212000                                                                  22020009
212100         EVALUATE TRUE                                            22030009
212200             WHEN SQLCODE = -904                                  22040009
212300             WHEN SQLCODE = -911                                  22050009
212400             WHEN SQLCODE = 0                                     22060009
212500                 CONTINUE                                         22070009
212600             WHEN SQLWARN NOT = SPACES                            22080009
212700             WHEN SQLCODE NOT = ZERO                              22090009
212800                 MOVE 'D500-CLOSE-DATE-CURSOR'                    22100009
212900                               TO  PV-PARAGRAPH-NAME              22110009
213000                 MOVE 'CLOSE ON CURSOR'                           22120009
213100                               TO  PV-DB2-OPER-ATTEMPTED          22130009
213200                 PERFORM Z900-SQL-ABEND                           22140009
213300         END-EVALUATE                                             22150009
213400     END-PERFORM.                                                 22160009
213500*                                                                 22170009
213600     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        22180009
213700         MOVE 'D500-CLOSE-DATE-CURSOR'                            22190009
213800                               TO  PV-PARAGRAPH-NAME              22200009
213900         MOVE 'CLOSE RETRIES EXCEEDED'                            22210009
214000                               TO  PV-DB2-OPER-ATTEMPTED          22220009
214100         PERFORM Z900-SQL-ABEND                                   22230009
214200     END-IF.                                                      22240009
214300                                                                  22250009
214400******************************************************************22260009
214500* WRITE RECEIPT DATA INTO OUTPUT FILE                             22270009
214600******************************************************************22280009
214700                                                                  22290009
214800 Z100-WRITE-RECEIPT-EXT-REC.                                      22300009
214900                                                                  22310009
215000     WRITE RECEIPTS-RECORD FROM PO016-RECORD.                     22320009
215100                                                                  22330009
215200******************************************************************22340009
215300* WRITE MONTHLY RECEIPT DATA INTO OUTPUT FILE                     22350009
215400******************************************************************22360009
215500                                                                  22370009
215600 Z125-WRITE-MONTH-RECEIPTS-REC.                                   22380009
215700                                                                  22390009
215800     WRITE MONTH-RECEIPTS-RECORD FROM PO010-RECORD.               22400009
215900                                                                  22410009
216000******************************************************************22420009
216100* WRITE ACTIVE PO RECORDS INTO OUTPUT FILE                        22430009
216200******************************************************************22440009
216300                                                                  22450009
216400 Z150-WRITE-ACTIVE-PO-REC.                                        22460009
216500                                                                  22470009
216600*    DISPLAY 'PO010-PO-NUMBER.' PO010-PO-NUMBER.                  22480009
216700     WRITE ACTIVE-PO-RECORD FROM PO010-RECORD.                    22490009
216800                                                                  22500009
216900******************************************************************22510009
217000*    OPEN THE CURSOR WHICH WILL RETRIEVE RECEIPTS FROM THE        22520009
217100*    RECEIVING/PO TABLES.                                         22530009
217200******************************************************************22540009
217300                                                                  22550009
217400 Z200-OPEN-RECEIPT-CURSOR.                                        22560009
217500                                                                  22570009
217600     INITIALIZE DCLXLT00003                                       22580009
217700                DCLXLT00004.                                      22590009
217800     PERFORM                                                      22600009
217900         WITH TEST AFTER                                          22610009
218000         VARYING PV-SQL-SUB                                       22620009
218100         FROM 1 BY 1                                              22630009
218200         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       22640009
218300                   OR SQLCODE = 0                                 22650009
218400                   OR SQLCODE = +100)                             22660009
218500                                                                  22670009
218600         EXEC SQL                                                 22680009
218700             OPEN RECEIPT_CURSOR                                  22690009
218800         END-EXEC                                                 22700009
218900                                                                  22710009
219000         EVALUATE TRUE                                            22720009
219100             WHEN SQLCODE = -904                                  22730009
219200             WHEN SQLCODE = -911                                  22740009
219300             WHEN SQLCODE = 0                                     22750009
219400                 CONTINUE                                         22760009
219500             WHEN SQLCODE = +100                                  22770009
219600                 SET PS-NO-MORE-ROWS TO TRUE                      22780009
219700             WHEN SQLWARN NOT = SPACES                            22790009
219800             WHEN SQLCODE NOT = ZERO                              22800009
219900                 MOVE 'Z200-OPEN-RECEIPT-CURSOR'                  22810009
220000                                     TO  PV-PARAGRAPH-NAME        22820009
220100                 MOVE 'OPEN ON CURSOR'                            22830009
220200                                     TO  PV-DB2-OPER-ATTEMPTED    22840009
220300                 PERFORM Z900-SQL-ABEND                           22850009
220400         END-EVALUATE                                             22860009
220500     END-PERFORM.                                                 22870009
220600                                                                  22880009
220700     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        22890009
220800         MOVE 'Z200-OPEN-RECEIPT-CURSOR'                          22900009
220900                               TO  PV-PARAGRAPH-NAME              22910009
221000         MOVE 'OPEN RETRIES EXCEEDED'                             22920009
221100                               TO  PV-DB2-OPER-ATTEMPTED          22930009
221200         PERFORM Z900-SQL-ABEND                                   22940009
221300     END-IF.                                                      22950009
221400                                                                  22960009
221500******************************************************************22970009
221600*    OPEN THE CURSOR WHICH WILL RETRIEVE RECEIPTS FROM THE        22980009
221700*    RECEIVING/PO TABLES FOR RECLASSED RECEIPTS.                  22990009
221800******************************************************************23000009
221900                                                                  23010009
222000 Z250-OPEN-RCLS-RECEIPT-CURSOR.                                   23020009
222100                                                                  23030009
222200     INITIALIZE DCLXLT00003                                       23040009
222300                DCLXLT00004                                       23050009
222400                DCLIMT00015.                                      23060009
222500     PERFORM                                                      23070009
222600         WITH TEST AFTER                                          23080009
222700         VARYING PV-SQL-SUB                                       23090009
222800         FROM 1 BY 1                                              23100009
222900         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       23110009
223000                   OR SQLCODE = 0                                 23120009
223100                   OR SQLCODE = +100)                             23130009
223200                                                                  23140009
223300         EXEC SQL                                                 23150009
223400             OPEN RCL_RECEIPT_CURSOR                              23160009
223500         END-EXEC                                                 23170009
223600                                                                  23180009
223700         EVALUATE TRUE                                            23190009
223800             WHEN SQLCODE = -904                                  23200009
223900             WHEN SQLCODE = -911                                  23210009
224000             WHEN SQLCODE = 0                                     23220009
224100                 CONTINUE                                         23230009
224200             WHEN SQLCODE = +100                                  23240009
224300                 SET PS-NO-MORE-ROWS TO TRUE                      23250009
224400             WHEN SQLWARN NOT = SPACES                            23260009
224500             WHEN SQLCODE NOT = ZERO                              23270009
224600                 MOVE 'Z250-OPEN-RCLS-RECEIPT-CURSOR'             23280009
224700                               TO  PV-PARAGRAPH-NAME              23290009
224800                 MOVE 'OPEN ON CURSOR'                            23300009
224900                               TO  PV-DB2-OPER-ATTEMPTED          23310009
225000                 PERFORM Z900-SQL-ABEND                           23320009
225100         END-EVALUATE                                             23330009
225200     END-PERFORM.                                                 23340009
225300*                                                                 23350009
225400     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        23360009
225500         MOVE 'Z250-OPEN-RCLS-RECEIPT-CURSOR'                     23370009
225600                               TO  PV-PARAGRAPH-NAME              23380009
225700         MOVE 'OPEN RETRIES EXCEEDED'                             23390009
225800                               TO  PV-DB2-OPER-ATTEMPTED          23400009
225900         PERFORM Z900-SQL-ABEND                                   23410009
226000     END-IF.                                                      23420009
226100                                                                  23430009
226200******************************************************************23440009
226300*    FETCH THE NEXT ROW OF THE RECEIPT CURSOR.                    23450009
226400******************************************************************23460009
226500                                                                  23470009
226600 Z300-FETCH-RECEIPT-ROW.                                          23480009
226700                                                                  23490009
226800     INITIALIZE PV-NULL-IND.                                      23500009
226900     EXEC SQL                                                     23510009
227000         FETCH RECEIPT_CURSOR                                     23520009
227100         INTO  :RECDIS-AP-VERIFY-ITM-QTY,                         23530009
227200               :PURITM-GP-QTY,                                    23540009
227300               :PURITM-GP-RTL-AMT,                                23550009
227400               :PURITM-UNT-RTL-PR-AMT,                            23560009
227500               :PURITM-UNT-COST-AMT,                              23570009
227600               :XLT00004-MAJ-CL-NBR:PV-MAJ-CL-NBR-IND,            23580009
227700               :XLT00004-SUB-CL-NBR:PV-SUB-CL-NBR-IND,            23590009
227800               :PURITM-CL-NBR,                                    23600009
227900               :PURCHS-DEPT-NBR,                                  23610009
228000               :PURCHS-PO-NBR,                                    23620009
228100               :RECITM-ORD-LNE-NBR,                               23630009
228200               :PURCHS-PO-TYP-CDE,                                23640009
228300               :PURCHS-CRE-BY-UID,                                23650009
228400               :PURCHS-OTB-PER-NBR,                               23660009
228500               :STATCD-STATUS-CLS,                                23670009
228600               :ENTNME-ENT-NAME-DESC,                             23680009
228700               :PLNSHP-DONT-SHIP-BEF-DTE,                         23690009
228800               :PURCHS-PO-SHRT-CYC-IND,                           23700009
228900               :RECDIS-STR-NBR,                                   23710009
                     :WS-VERFYD-TMST-DATE,                              23720009
229000               :POWS055-CALCED-OTB-DATE                           23730009
229100     END-EXEC.                                                    23740009
229200                                                                  23750009
229300     IF SQLCODE = +100                                            23760009
229400         SET PS-NO-MORE-ROWS          TO TRUE                     23770009
229500     ELSE                                                         23780009
229600         IF SQLCODE NOT = 0                                       23790009
229700              MOVE 'Z300-FETCH-RECEIPT-ROW'                       23800009
229800                                      TO PV-PARAGRAPH-NAME        23810009
229900              MOVE 'FETCH ROW FROM RECEIPT CURSOR'                23820009
230000                                      TO PV-DB2-OPER-ATTEMPTED    23830009
230100             PERFORM Z900-SQL-ABEND                               23840009
230200         END-IF                                                   23850009
230300     END-IF.                                                      23860009
230400                                                                  23870009
230500******************************************************************23880009
230600*    FETCH THE NEXT ROW OF THE RECLASS CURSOR.                    23890009
230700******************************************************************23900009
230800                                                                  23910009
230900 Z350-FETCH-RCLS-RECEIPT-ROW.                                     23920009
231000                                                                  23930009
231100     INITIALIZE PV-NULL-IND.                                      23940009
231200     EXEC SQL                                                     23950009
231300         FETCH RCL_RECEIPT_CURSOR                                 23960009
231400         INTO  :RECDIS-AP-VERIFY-ITM-QTY,                         23970009
231500               :PURITM-GP-QTY,                                    23980009
231600               :PURITM-GP-RTL-AMT,                                23990009
231700               :PURITM-UNT-RTL-PR-AMT,                            24000009
231800               :PURITM-UNT-COST-AMT,                              24010009
231900               :XLT00004-MAJ-CL-NBR:PV-MAJ-CL-NBR-IND,            24020009
232000               :XLT00004-SUB-CL-NBR:PV-SUB-CL-NBR-IND,            24030009
232100               :PURITM-CL-NBR,                                    24040009
232200               :PURCHS-DEPT-NBR,                                  24050009
232300               :PURCHS-PO-NBR,                                    24060009
232400               :RECITM-ORD-LNE-NBR,                               24070009
232500               :PURCHS-PO-TYP-CDE,                                24080009
232600               :PURCHS-CRE-BY-UID,                                24090009
232700               :PURCHS-OTB-PER-NBR,                               24100009
232800               :STATCD-STATUS-CLS,                                24110009
232900               :ENTNME-ENT-NAME-DESC,                             24120009
233000               :PLNSHP-DONT-SHIP-BEF-DTE,                         24130009
233100               :PURCHS-PO-SHRT-CYC-IND,                           24140009
233200               :RECDIS-STR-NBR,                                   24150009
                     :WS-VERFYD-TMST-DATE,                              24160009
233300               :POWS055-CALCED-OTB-DATE                           24170009
233400     END-EXEC.                                                    24180009
233500                                                                  24190009
233600     IF SQLCODE = +100                                            24200009
233700         SET PS-NO-MORE-ROWS          TO TRUE                     24210009
233800     ELSE                                                         24220009
233900         IF SQLCODE NOT = 0                                       24230009
234000              MOVE 'Z350-FETCH-RCLS-RECEIPT-ROW'                  24240009
234100                                      TO PV-PARAGRAPH-NAME        24250009
234200              MOVE 'FETCH ROW FROM RECLASS CURSOR'                24260009
234300                                      TO PV-DB2-OPER-ATTEMPTED    24270009
234400             PERFORM Z900-SQL-ABEND                               24280009
234500         END-IF                                                   24290009
234600     END-IF.                                                      24300009
234700                                                                  24310009
234800******************************************************************24320009
234900*    CLOSE THE RECEIPT CURSOR.                                    24330009
235000******************************************************************24340009
235100 Z400-CLOSE-RECEIPT-CURSOR.                                       24350009
235200                                                                  24360009
235300     PERFORM                                                      24370009
235400         WITH TEST AFTER                                          24380009
235500         VARYING PV-SQL-SUB                                       24390009
235600         FROM 1 BY 1                                              24400009
235700         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       24410009
235800                   OR SQLCODE = 0)                                24420009
235900                                                                  24430009
236000         EXEC SQL                                                 24440009
236100             CLOSE RECEIPT_CURSOR                                 24450009
236200         END-EXEC                                                 24460009
236300                                                                  24470009
236400         EVALUATE TRUE                                            24480009
236500             WHEN SQLCODE = -904                                  24490009
236600             WHEN SQLCODE = -911                                  24500009
236700             WHEN SQLCODE = 0                                     24510009
236800                 CONTINUE                                         24520009
236900             WHEN SQLWARN NOT = SPACES                            24530009
237000             WHEN SQLCODE NOT = ZERO                              24540009
237100                 MOVE 'Z400-CLOSE-RECEIPT-CURSOR'                 24550009
237200                               TO  PV-PARAGRAPH-NAME              24560009
237300                 MOVE 'CLOSE ON CURSOR'                           24570009
237400                               TO  PV-DB2-OPER-ATTEMPTED          24580009
237500                 PERFORM Z900-SQL-ABEND                           24590009
237600         END-EVALUATE                                             24600009
237700     END-PERFORM.                                                 24610009
237800*                                                                 24620009
237900     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        24630009
238000         MOVE 'Z400-CLOSE-RECEIPT-CURSOR'                         24640009
238100                               TO  PV-PARAGRAPH-NAME              24650009
238200         MOVE 'CLOSE RETRIES EXCEEDED'                            24660009
238300                               TO  PV-DB2-OPER-ATTEMPTED          24670009
238400         PERFORM Z900-SQL-ABEND                                   24680009
238500     END-IF.                                                      24690009
238600                                                                  24700009
238700******************************************************************24710009
238800*    CLOSE THE RECLASS RECEIPT CURSOR.                            24720009
238900******************************************************************24730009
239000                                                                  24740009
239100 Z450-CLOSE-RCLS-RECEIPT-CURSOR.                                  24750009
239200                                                                  24760009
239300     PERFORM                                                      24770009
239400         WITH TEST AFTER                                          24780009
239500         VARYING PV-SQL-SUB                                       24790009
239600         FROM 1 BY 1                                              24800009
239700         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       24810009
239800                   OR SQLCODE = 0)                                24820009
239900                                                                  24830009
240000         EXEC SQL                                                 24840009
240100             CLOSE RCL_RECEIPT_CURSOR                             24850009
240200         END-EXEC                                                 24860009
240300                                                                  24870009
240400         EVALUATE TRUE                                            24880009
240500             WHEN SQLCODE = -904                                  24890009
240600             WHEN SQLCODE = -911                                  24900009
240700             WHEN SQLCODE = 0                                     24910009
240800                 CONTINUE                                         24920009
240900             WHEN SQLWARN NOT = SPACES                            24930009
241000             WHEN SQLCODE NOT = ZERO                              24940009
241100                 MOVE 'Z450-CLOSE-RECLASS-CURSOR'                 24950009
241200                               TO  PV-PARAGRAPH-NAME              24960009
241300                 MOVE 'CLOSE ON CURSOR'                           24970009
241400                               TO  PV-DB2-OPER-ATTEMPTED          24980009
241500                 PERFORM Z900-SQL-ABEND                           24990009
241600         END-EVALUATE                                             25000009
241700     END-PERFORM.                                                 25010009
241800*                                                                 25020009
241900     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        25030009
242000         MOVE 'Z450-CLOSE-RECLASS-CURSOR'                         25040009
242100                               TO  PV-PARAGRAPH-NAME              25050009
242200         MOVE 'CLOSE RETRIES EXCEEDED'                            25060009
242300                               TO  PV-DB2-OPER-ATTEMPTED          25070009
242400         PERFORM Z900-SQL-ABEND                                   25080009
242500     END-IF.                                                      25090009
242600                                                                  25100009
242700******************************************************************25110009
242800*    OPEN THE DRIVING CURSOR                                      25120009
242900******************************************************************25130009
243000                                                                  25140009
243100 Z500-OPEN-DRIVING-CURSOR.                                        25150009
243200                                                                  25160009
243300     INITIALIZE DCLXLT00003                                       25170009
243400                DCLXLT00004.                                      25180009
243500     PERFORM                                                      25190009
243600         WITH TEST AFTER                                          25200009
243700         VARYING PV-SQL-SUB                                       25210009
243800         FROM 1 BY 1                                              25220009
243900         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       25230009
244000                   OR SQLCODE = 0                                 25240009
244100                   OR SQLCODE = +100)                             25250009
244200                                                                  25260009
244300         EXEC SQL                                                 25270009
244400             OPEN DRIVING_CURSOR                                  25280009
244500         END-EXEC                                                 25290009
244600                                                                  25300009
244700         EVALUATE TRUE                                            25310009
244800             WHEN SQLCODE = -904                                  25320009
244900             WHEN SQLCODE = -911                                  25330009
245000             WHEN SQLCODE = 0                                     25340009
245100                 CONTINUE                                         25350009
245200             WHEN SQLCODE = +100                                  25360009
245300                 SET PS-DC-NO-MORE-ROWS TO TRUE                   25370009
245400             WHEN SQLWARN NOT = SPACES                            25380009
245500             WHEN SQLCODE NOT = ZERO                              25390009
245600                 MOVE 'Z500-OPEN-DRIVING-CURSOR'                  25400009
245700                               TO  PV-PARAGRAPH-NAME              25410009
245800                 MOVE 'OPEN ON CURSOR'                            25420009
245900                               TO  PV-DB2-OPER-ATTEMPTED          25430009
246000                 PERFORM Z900-SQL-ABEND                           25440009
246100         END-EVALUATE                                             25450009
246200     END-PERFORM.                                                 25460009
246300*                                                                 25470009
246400     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        25480009
246500         MOVE 'Z500-OPEN-DRIVING-CURSOR'                          25490009
246600                               TO  PV-PARAGRAPH-NAME              25500009
246700         MOVE 'OPEN RETRIES EXCEEDED'                             25510009
246800                               TO  PV-DB2-OPER-ATTEMPTED          25520009
246900         PERFORM Z900-SQL-ABEND                                   25530009
247000     END-IF.                                                      25540009
247100                                                                  25550009
247200******************************************************************25560009
247300*    OPEN THE CURSOR WHICH WILL RETRIEVE ACTIVE POS FROM THE      25570009
247400*    PO TABLES.                                                   25580009
247500******************************************************************25590009
247600                                                                  25600009
247700 Z500-OPEN-ACTIVE-PO-CURSOR.                                      25610009
247800                                                                  25620009
247900     INITIALIZE  DCLXLT00003                                      25630009
248000                 DCLXLT00004.                                     25640009
248100     PERFORM                                                      25650009
248200         WITH TEST AFTER                                          25660009
248300         VARYING PV-SQL-SUB                                       25670009
248400         FROM 1 BY 1                                              25680009
248500         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       25690009
248600                   OR SQLCODE = 0                                 25700009
248700                   OR SQLCODE = +100)                             25710009
248800                                                                  25720009
248900         EXEC SQL                                                 25730009
249000             OPEN ACTIVE_PO_CURSOR                                25740009
249100         END-EXEC                                                 25750009
249200                                                                  25760009
249300         EVALUATE TRUE                                            25770009
249400             WHEN SQLCODE = -904                                  25780009
249500             WHEN SQLCODE = -911                                  25790009
249600             WHEN SQLCODE = 0                                     25800009
249700                 CONTINUE                                         25810009
249800             WHEN SQLCODE = +100                                  25820009
249900                 SET PS-NO-MORE-ROWS TO TRUE                      25830009
250000             WHEN SQLWARN NOT = SPACES                            25840009
250100             WHEN SQLCODE NOT = ZERO                              25850009
250200                 MOVE 'Z500-OPEN-ACTIVE-PO-CURSOR'                25860009
250300                                     TO  PV-PARAGRAPH-NAME        25870009
250400                 MOVE 'OPEN ON CURSOR'                            25880009
250500                                     TO  PV-DB2-OPER-ATTEMPTED    25890009
250600                 PERFORM Z900-SQL-ABEND                           25900009
250700         END-EVALUATE                                             25910009
250800     END-PERFORM.                                                 25920009
250900*                                                                 25930009
251000     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        25940009
251100         MOVE 'Z500-OPEN-ACTIVE-PO-CURSOR'                        25950009
251200                                     TO  PV-PARAGRAPH-NAME        25960009
251300         MOVE 'OPEN RETRIES EXCEEDED'                             25970009
251400                                     TO  PV-DB2-OPER-ATTEMPTED    25980009
251500         PERFORM Z900-SQL-ABEND                                   25990009
251600     END-IF.                                                      26000009
251700                                                                  26010009
251800******************************************************************26020009
251900*    FETCH THE NEXT ROW OF THE DRIVING CURSOR.                    26030009
252000******************************************************************26040009
252100                                                                  26050009
252200 Z600-FETCH-DRIVING-ROW.                                          26060009
252300                                                                  26070009
252400     INITIALIZE PV-NULL-IND.                                      26080009
252500     EXEC SQL                                                     26090009
252600         FETCH DRIVING_CURSOR                                     26100009
252700         INTO  :PS-RECLASS-IND,                                   26110009
252800               :RECEIV-ORD-NBR,                                   26120009
252900               :RECEIV-REC-SEQ-NBR                                26130009
253000     END-EXEC.                                                    26140009
253100                                                                  26150009
253200     IF SQLCODE = +100                                            26160009
253300         SET PS-DC-NO-MORE-ROWS       TO TRUE                     26170009
253400     ELSE                                                         26180009
253500         IF SQLCODE NOT = 0                                       26190009
253600              MOVE 'Z600-FETCH-DRIVING-ROW'                       26200009
253700                                      TO PV-PARAGRAPH-NAME        26210009
253800              MOVE 'FETCH ROW FROM RECEIPT CURSOR'                26220009
253900                                      TO PV-DB2-OPER-ATTEMPTED    26230009
254000             PERFORM Z900-SQL-ABEND                               26240009
254100         END-IF                                                   26250009
254200     END-IF.                                                      26260009
254300                                                                  26270009
254400******************************************************************26280009
254500*    FETCH THE NEXT ROW OF THE ACTIVE PO CURSOR.                  26290009
254600******************************************************************26300009
254700                                                                  26310009
254800 Z600-FETCH-ACTIVE-PO-ROW.                                        26320009
254900                                                                  26330009
255000     PERFORM VARYING ROW-ID FROM 1 BY 1                           26340009
255100              UNTIL ROW-ID > 100                                  26350009
255200           MOVE ZEROES  TO  PV-PO-NBR-A(ROW-ID)                   26360009
255300                            PV-MAJ-CL-NBR-A(ROW-ID)               26370009
255400                            PV-SUB-CL-NBR-A(ROW-ID)               26380009
255500                            PV-APP-PO-LNE-NBR-A(ROW-ID)           26390009
255600                            PV-PO-LNE-NBR-A(ROW-ID)               26400009
255700                            PV-GP-QTY-A(ROW-ID)                   26410009
255800                            PV-GP-RTL-AMT-A(ROW-ID)               26420009
255900                            PV-UNT-QTY-A(ROW-ID)                  26430009
256000                            PV-UNT-RTL-PR-AMT-A(ROW-ID)           26440009
256100                            PV-UNT-COST-AMT-A(ROW-ID)             26450009
256200                            PV-SKU-NBR-A(ROW-ID)                  26460009
256300                            PV-MAJ-CL-NBR-IND-A(ROW-ID)           26470009
256400                            PV-SUB-CL-NBR-IND-A(ROW-ID)           26480009
256500                            PV-SKU-NBR-IND-A(ROW-ID)              26490009
256600                            PV-CURR-SPLIT-QTY-A(ROW-ID)           26500009
256700                            PV-DEST-NBR-A(ROW-ID)                 26510009
256800         MOVE SPACES  TO    PV-DEPT-NBR-A(ROW-ID)                 26520009
256900                            PV-PO-TYP-CDE-A(ROW-ID)               26530009
257000                            PV-CRE-BY-UID-A(ROW-ID)               26540009
257100                            PV-AD-EVNT-DTE-A(ROW-ID)              26550009
257200                            PV-CL-NBR-A(ROW-ID)                   26560009
257300                            PV-OTB-PER-NBR-A(ROW-ID)              26570009
257400                            PV-SKU-SEQ-NBR-A(ROW-ID)              26580009
257500                            PV-STATUS-CDE-A(ROW-ID)               26590009
257600                            PV-DONT-SHIP-BEF-DTE-A(ROW-ID)        26600009
257700                            PV-CAN-IFNOT-SHIP-DTE-A(ROW-ID)       26610009
257800                            PV-EXT-CAN-DTE-A(ROW-ID)              26620009
257900                            PV-ENT-NAME-DESC-A(ROW-ID)            26630009
258000                            PV-PO-SHRT-CYC-IND-A(ROW-ID)          26640009
258100                            PV-CALCED-OTB-DATE-A(ROW-ID)          26650009
258200     END-PERFORM                                                  26660009
258300                                                                  26670009
258400     INITIALIZE PV-NULL-IND.                                      26680009
258500     EXEC SQL                                                     26690009
258600         FETCH NEXT ROWSET  FROM ACTIVE_PO_CURSOR FOR 100 ROWS    26700009
258700         INTO  :PV-PO-NBR-A,                                      26710009
258800               :PV-DEPT-NBR-A,                                    26720009
258900               :PV-PO-TYP-CDE-A,                                  26730009
259000               :PV-CRE-BY-UID-A,                                  26740009
259100               :PV-AD-EVNT-DTE-A,                                 26750009
259200               :PV-MAJ-CL-NBR-A:PV-MAJ-CL-NBR-IND-A,              26760009
259300               :PV-SUB-CL-NBR-A:PV-SUB-CL-NBR-IND-A,              26770009
259400               :PV-CL-NBR-A,                                      26780009
259500               :PV-OTB-PER-NBR-A,                                 26790009
259600               :PV-APP-PO-LNE-NBR-A,                              26800009
259700               :PV-PO-LNE-NBR-A,                                  26810009
259800               :PV-GP-QTY-A,                                      26820009
259900               :PV-GP-RTL-AMT-A,                                  26830009
260000               :PV-UNT-QTY-A,                                     26840009
260100               :PV-UNT-RTL-PR-AMT-A,                              26850009
260200               :PV-UNT-COST-AMT-A,                                26860009
260300               :PV-SKU-SEQ-NBR-A,                                 26870009
260400               :PV-SKU-NBR-A:PV-SKU-NBR-IND-A,                    26880009
260500               :PV-STATUS-CDE-A,                                  26890009
260600               :PV-DONT-SHIP-BEF-DTE-A,                           26900009
260700               :PV-CAN-IFNOT-SHIP-DTE-A,                          26910009
260800               :PV-EXT-CAN-DTE-A,                                 26920009
260900               :PV-ENT-NAME-DESC-A,                               26930009
261000               :PV-PO-SHRT-CYC-IND-A,                             26940009
261100               :PV-CALCED-OTB-DATE-A                              26950009
261200     END-EXEC.                                                    26960009
261300                                                                  26970009
261400     MOVE SQLERRD (3)                 TO  WS-SQLERRD3             26980009
261500     IF SQLCODE = +100                                            26990009
261600         SET PS-NO-MORE-ROWS          TO TRUE                     27000009
261700         PERFORM VARYING ROW-ID FROM 1 BY 1                       27010009
261800*             UNTIL ROW-ID > SQLERRD (3)                          27020009
261900              UNTIL ROW-ID > WS-SQLERRD3                          27030009
262000              PERFORM C100-PROCESS-ACTIVE-PO-ROWS                 27040009
262100         END-PERFORM                                              27050009
262200     ELSE                                                         27060009
262300         IF (SQLCODE > 0)                                         27070009
262400             CONTINUE                                             27080009
262500         ELSE                                                     27090009
262600         IF SQLCODE NOT = 0                                       27100009
262700              MOVE 'Z600-FETCH-ACTIVE-PO-ROW'                     27110009
262800                                      TO PV-PARAGRAPH-NAME        27120009
262900              MOVE 'FETCH ROW FROM ACTIVE PO CURSOR'              27130009
263000                                      TO PV-DB2-OPER-ATTEMPTED    27140009
263100             PERFORM Z900-SQL-ABEND                               27150009
263200         END-IF                                                   27160009
263300     END-IF.                                                      27170009
263400                                                                  27180009
263500******************************************************************27190009
263600*    CLOSE THE ACTIVE PO CURSOR.                                  27200009
263700******************************************************************27210009
263800                                                                  27220009
263900 Z700-CLOSE-ACTIVE-PO-CURSOR.                                     27230009
264000                                                                  27240009
264100     PERFORM                                                      27250009
264200         WITH TEST AFTER                                          27260009
264300         VARYING PV-SQL-SUB                                       27270009
264400         FROM 1 BY 1                                              27280009
264500         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       27290009
264600                   OR SQLCODE = 0)                                27300009
264700                                                                  27310009
264800         EXEC SQL                                                 27320009
264900             CLOSE ACTIVE_PO_CURSOR                               27330009
265000         END-EXEC                                                 27340009
265100                                                                  27350009
265200         EVALUATE TRUE                                            27360009
265300             WHEN SQLCODE = -904                                  27370009
265400             WHEN SQLCODE = -911                                  27380009
265500             WHEN SQLCODE = 0                                     27390009
265600                 CONTINUE                                         27400009
265700             WHEN SQLWARN NOT = SPACES                            27410009
265800             WHEN SQLCODE NOT = ZERO                              27420009
265900                 MOVE 'Z700-CLOSE-ACTIVE-PO-CURSOR'               27430009
266000                               TO  PV-PARAGRAPH-NAME              27440009
266100                 MOVE 'CLOSE ON CURSOR'                           27450009
266200                               TO  PV-DB2-OPER-ATTEMPTED          27460009
266300                 PERFORM Z900-SQL-ABEND                           27470009
266400         END-EVALUATE                                             27480009
266500     END-PERFORM.                                                 27490009
266600*                                                                 27500009
266700     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        27510009
266800         MOVE 'Z700-CLOSE-ACTIVE-PO-CURSOR'                       27520009
266900                               TO  PV-PARAGRAPH-NAME              27530009
267000         MOVE 'CLOSE RETRIES EXCEEDED'                            27540009
267100                               TO  PV-DB2-OPER-ATTEMPTED          27550009
267200         PERFORM Z900-SQL-ABEND                                   27560009
267300     END-IF.                                                      27570009
267400                                                                  27580009
267500******************************************************************27590009
267600*    CLOSE THE DRIVING CURSOR.                                    27600009
267700******************************************************************27610009
267800                                                                  27620009
267900 Z700-CLOSE-DRIVING-CURSOR.                                       27630009
268000                                                                  27640009
268100     PERFORM                                                      27650009
268200         WITH TEST AFTER                                          27660009
268300         VARYING PV-SQL-SUB                                       27670009
268400         FROM 1 BY 1                                              27680009
268500         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       27690009
268600                   OR SQLCODE = 0)                                27700009
268700                                                                  27710009
268800         EXEC SQL                                                 27720009
268900             CLOSE DRIVING_CURSOR                                 27730009
269000         END-EXEC                                                 27740009
269100                                                                  27750009
269200         EVALUATE TRUE                                            27760009
269300             WHEN SQLCODE = -904                                  27770009
269400             WHEN SQLCODE = -911                                  27780009
269500             WHEN SQLCODE = 0                                     27790009
269600                 CONTINUE                                         27800009
269700             WHEN SQLWARN NOT = SPACES                            27810009
269800             WHEN SQLCODE NOT = ZERO                              27820009
269900                 MOVE 'Z700-CLOSE-DRIVING-CURSOR'                 27830009
270000                               TO  PV-PARAGRAPH-NAME              27840009
270100                 MOVE 'CLOSE ON CURSOR'                           27850009
270200                               TO  PV-DB2-OPER-ATTEMPTED          27860009
270300                 PERFORM Z900-SQL-ABEND                           27870009
270400         END-EVALUATE                                             27880009
270500     END-PERFORM.                                                 27890009
270600*                                                                 27900009
270700     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        27910009
270800         MOVE 'Z700-CLOSE-DRIVING-CURSOR'                         27920009
270900                               TO  PV-PARAGRAPH-NAME              27930009
271000         MOVE 'CLOSE RETRIES EXCEEDED'                            27940009
271100                               TO  PV-DB2-OPER-ATTEMPTED          27950009
271200         PERFORM Z900-SQL-ABEND                                   27960009
271300     END-IF.                                                      27970009
271400                                                                  27980009
271500******************************************************************27990009
271600*    OPEN THE CURSOR WHICH WILL RETRIEVE DEPARTMENTS FROM THE     28000009
271700*    TMDSEAR TABLE.                                               28010009
271800******************************************************************28020009
271900                                                                  28030009
272000 Z800-OPEN-DEPT-CURSOR.                                           28040009
272100                                                                  28050009
272200     PERFORM                                                      28060009
272300         WITH TEST AFTER                                          28070009
272400         VARYING PV-SQL-SUB                                       28080009
272500         FROM 1 BY 1                                              28090009
272600         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       28100009
272700                   OR SQLCODE = 0                                 28110009
272800                   OR SQLCODE = +100)                             28120009
272900                                                                  28130009
273000         EXEC SQL                                                 28140009
273100             OPEN DEPT_CURSOR                                     28150009
273200         END-EXEC                                                 28160009
273300                                                                  28170009
273400         EVALUATE TRUE                                            28180009
273500             WHEN SQLCODE = -904                                  28190009
273600             WHEN SQLCODE = -911                                  28200009
273700             WHEN SQLCODE = 0                                     28210009
273800                 CONTINUE                                         28220009
273900             WHEN SQLCODE = +100                                  28230009
274000                SET PS-NO-MORE-DEPT-ROWS TO TRUE                  28240009
274100             WHEN SQLWARN NOT = SPACES                            28250009
274200             WHEN SQLCODE NOT = ZERO                              28260009
274300                MOVE 'Z800-OPEN-DEPT-CURSOR'                      28270009
274400                                         TO  PV-PARAGRAPH-NAME    28280009
274500                MOVE 'OPEN ON CURSOR'                             28290009
274600                                         TO  PV-DB2-OPER-ATTEMPTED28300009
274700                PERFORM Z900-SQL-ABEND                            28310009
274800         END-EVALUATE                                             28320009
274900     END-PERFORM.                                                 28330009
275000*                                                                 28340009
275100     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        28350009
275200         MOVE 'Z800-OPEN-DEPT-CURSOR'                             28360009
275300                               TO  PV-PARAGRAPH-NAME              28370009
275400         MOVE 'OPEN RETRIES EXCEEDED'                             28380009
275500                               TO  PV-DB2-OPER-ATTEMPTED          28390009
275600         PERFORM Z900-SQL-ABEND                                   28400009
275700     END-IF.                                                      28410009
275800                                                                  28420009
275900******************************************************************28430009
276000*    FETCH THE NEXT ROW OF THE DEPARMENT CURSOR.                  28440009
276100******************************************************************28450009
276200                                                                  28460009
276300 Z810-FETCH-DEPT-CURSOR.                                          28470009
276400                                                                  28480009
276500     EXEC SQL                                                     28490009
276600         FETCH DEPT_CURSOR                                        28500009
276700         INTO  :MDSEAR-OPERCO-NBR,                                28510009
276800               :MDSEAR-GMA-NBR,                                   28520009
276900               :MDSEAR-DMA-NBR,                                   28530009
277000               :MDSEAR-DEPT-NBR,                                  28540009
277100               :MDSEAR-MAJ-CL-NBR,                                28550009
277200               :MDSEAR-DESC                                       28560009
277300     END-EXEC.                                                    28570009
277400                                                                  28580009
277500     IF SQLCODE = +100                                            28590009
277600         SET PS-NO-MORE-DEPT-ROWS TO TRUE                         28600009
277700     ELSE                                                         28610009
277800         IF SQLCODE NOT = 0                                       28620009
277900              MOVE 'Z810-FETCH-DEPT-CURSOR'                       28630009
278000                                  TO PV-PARAGRAPH-NAME            28640009
278100              MOVE 'FETCH ROW FROM DEPT CURSOR     '              28650009
278200                                  TO PV-DB2-OPER-ATTEMPTED        28660009
278300             PERFORM Z900-SQL-ABEND                               28670009
278400         END-IF                                                   28680009
278500     END-IF.                                                      28690009
278600                                                                  28700009
278700******************************************************************28710009
278800*    CLOSE THE DEPARTMENT CURSOR.                                 28720009
278900******************************************************************28730009
279000                                                                  28740009
279100 Z820-CLOSE-DEPT-CURSOR.                                          28750009
279200                                                                  28760009
279300     PERFORM                                                      28770009
279400         WITH TEST AFTER                                          28780009
279500         VARYING PV-SQL-SUB                                       28790009
279600         FROM 1 BY 1                                              28800009
279700         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       28810009
279800                   OR SQLCODE = 0)                                28820009
279900                                                                  28830009
280000         EXEC SQL                                                 28840009
280100             CLOSE DEPT_CURSOR                                    28850009
280200         END-EXEC                                                 28860009
280300                                                                  28870009
280400         EVALUATE TRUE                                            28880009
280500             WHEN SQLCODE = -904                                  28890009
280600             WHEN SQLCODE = -911                                  28900009
280700             WHEN SQLCODE = 0                                     28910009
280800                 CONTINUE                                         28920009
280900             WHEN SQLWARN NOT = SPACES                            28930009
281000             WHEN SQLCODE NOT = ZERO                              28940009
281100                 MOVE 'Z820-CLOSE-DEPT-CURSOR'                    28950009
281200                               TO  PV-PARAGRAPH-NAME              28960009
281300                 MOVE 'CLOSE ON CURSOR'                           28970009
281400                               TO  PV-DB2-OPER-ATTEMPTED          28980009
281500                 PERFORM Z900-SQL-ABEND                           28990009
281600         END-EVALUATE                                             29000009
281700     END-PERFORM.                                                 29010009
281800*                                                                 29020009
281900     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        29030009
282000         MOVE 'Z820-CLOSE-DEPT-CURSOR'                            29040009
282100                               TO  PV-PARAGRAPH-NAME              29050009
282200         MOVE 'CLOSE RETRIES EXCEEDED'                            29060009
282300                               TO  PV-DB2-OPER-ATTEMPTED          29070009
282400         PERFORM Z900-SQL-ABEND                                   29080009
282500     END-IF.                                                      29090009
282600                                                                  29100009
282700******************************************************************29110009
282800*  OPEN THE TALLPLN CURSOR                                        29120009
282900******************************************************************29130009
283000                                                                  29140009
283100 Z825-OPEN-TALLPLN-CURSOR.                                        29150009
283200                                                                  29160009
283300     PERFORM                                                      29170009
283400         WITH TEST AFTER                                          29180009
283500         VARYING PV-SQL-SUB                                       29190009
283600         FROM 1 BY 1                                              29200009
283700         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       29210009
283800                   OR SQLCODE = 0                                 29220009
283900                   OR SQLCODE = +100)                             29230009
284000                                                                  29240009
284100                                                                  29250009
284200          EXEC SQL                                                29260009
284300              OPEN TALLPLN_CURSOR                                 29270009
284400          END-EXEC                                                29280009
284500                                                                  29290009
284600         EVALUATE TRUE                                            29300009
284700                                                                  29310009
284800         WHEN SQLCODE = +000                                      29320009
284900             CONTINUE                                             29330009
285000         WHEN SQLWARN NOT = SPACES                                29340009
285100         WHEN SQLCODE NOT = +000                                  29350009
285200             MOVE 'Z825-OPEN-TALLPLN-CURSOR '                     29360009
285300                               TO PV-PARAGRAPH-NAME               29370009
285400             MOVE 'OPEN ON TALLPLN CURSOR'                        29380009
285500                               TO PV-DB2-OPER-ATTEMPTED           29390009
285600                                                                  29400009
285700             PERFORM Z900-SQL-ABEND                               29410009
285800                                                                  29420009
285900          END-EVALUATE                                            29430009
286000     END-PERFORM.                                                 29440009
286100     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        29450009
286200         MOVE 'Z824-OPEN-TALLPLN-CURSOR'                          29460009
286300                               TO  PV-PARAGRAPH-NAME              29470009
286400         MOVE 'OPEN RETRIES EXCEEDED'                             29480009
286500                               TO  PV-DB2-OPER-ATTEMPTED          29490009
286600         PERFORM Z900-SQL-ABEND                                   29500009
286700     END-IF.                                                      29510009
286800 EJECT                                                            29520009
286900                                                                  29530009
287000******************************************************************29540009
287100*    THIS PARAGRAPH RETRIEVES THE DEST NUMBER AND THE             29550009
287200*    CURR-SPLIT-QTY FROM TABLE TALLPLN.                           29560009
287300******************************************************************29570009
287400                                                                  29580009
287500 Z830-FETCH-TALLPLN-CURSOR.                                       29590009
287600                                                                  29600009
287700     EXEC SQL                                                     29610009
287800        FETCH NEXT ROWSET FROM TALLPLN_CURSOR FOR 100 ROWS        29620009
287900            INTO :PV-CURR-SPLIT-QTY-A                             29630009
288000               , :PV-DEST-NBR-A                                   29640009
288100     END-EXEC.                                                    29650009
288200                                                                  29660009
288300     MOVE SQLERRD (3)       TO WS-SQLERRD3-TPLN                   29670009
288400     EVALUATE TRUE                                                29680009
288500         WHEN SQLCODE = +0                                        29690009
288600             SET PS-DISTRO-EXISTS       TO TRUE                   29700009
288700                                                                  29710009
288800         WHEN SQLCODE = +100                                      29720009
288900             IF WS-SQLERRD3-TPLN  > 0                             29730009
289000               SET PS-DISTRO-EXISTS       TO TRUE                 29740009
289100             END-IF                                               29750009
289200             SET PS-NO-MORE-ALLPLN-ROWS TO TRUE                   29760009
289300                                                                  29770009
289400         WHEN OTHER                                               29780009
289500              MOVE 'Z830-FETCH-TALLPLN-RECORD'                    29790009
289600                            TO PV-PARAGRAPH-NAME                  29800009
289700              MOVE 'UNSUCCESSFUL FETCH OF TALLPLN'                29810009
289800                             TO PV-DB2-OPER-ATTEMPTED             29820009
289900              PERFORM Z900-SQL-ABEND                              29830009
290000     END-EVALUATE.                                                29840009
290100                                                                  29850009
290200******************************************************************29860009
290300*    CLOSE TALLPLN CURSOR                                         29870009
290400******************************************************************29880009
290500 Z835-CLOSE-TALLPLN-CURSOR.                                       29890009
290600                                                                  29900009
290700     PERFORM                                                      29910009
290800         WITH TEST AFTER                                          29920009
290900         VARYING PV-SQL-SUB                                       29930009
291000         FROM 1 BY 1                                              29940009
291100         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       29950009
291200                   OR SQLCODE = 0)                                29960009
291300                                                                  29970009
291400         EXEC SQL                                                 29980009
291500             CLOSE TALLPLN_CURSOR                                 29990009
291600         END-EXEC                                                 30000009
291700                                                                  30010009
291800         EVALUATE TRUE                                            30020009
291900             WHEN SQLCODE = -904                                  30030009
292000             WHEN SQLCODE = -911                                  30040009
292100             WHEN SQLCODE = 0                                     30050009
292200                 CONTINUE                                         30060009
292300             WHEN SQLWARN NOT = SPACES                            30070009
292400             WHEN SQLCODE NOT = ZERO                              30080009
292500                 MOVE 'Z835-CLOSE-TALLPLN-CURSOR'                 30090009
292600                               TO  PV-PARAGRAPH-NAME              30100009
292700                 MOVE 'CLOSE ON CURSOR'                           30110009
292800                               TO  PV-DB2-OPER-ATTEMPTED          30120009
292900                 PERFORM Z900-SQL-ABEND                           30130009
293000         END-EVALUATE                                             30140009
293100     END-PERFORM.                                                 30150009
293200*                                                                 30160009
293300     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        30170009
293400         MOVE 'Z835-CLOSE-TALLPLN-CURSOR'                         30180009
293500                               TO  PV-PARAGRAPH-NAME              30190009
293600         MOVE 'CLOSE RETRIES EXCEEDED'                            30200009
293700                               TO  PV-DB2-OPER-ATTEMPTED          30210009
293800         PERFORM Z900-SQL-ABEND                                   30220009
293900     END-IF.                                                      30230009
294000                                                                  30240009
294100******************************************************************30250009
294200*    OPEN THE CURSOR WHICH WILL RETRIEVE STORE AND DC NUMBERS     30260009
294300*    FROM THE XMT_LOC TABLE.                                      30270009
294400******************************************************************30280009
294500                                                                  30290009
294600 Z850-OPEN-STORE-CURSOR.                                          30300009
294700                                                                  30310009
294800     PERFORM                                                      30320009
294900         WITH TEST AFTER                                          30330009
295000         VARYING PV-SQL-SUB                                       30340009
295100         FROM 1 BY 1                                              30350009
295200         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       30360009
295300                   OR SQLCODE = 0                                 30370009
295400                   OR SQLCODE = +100)                             30380009
295500                                                                  30390009
295600         EXEC SQL                                                 30400009
295700             OPEN STORE_CURSOR                                    30410009
295800         END-EXEC                                                 30420009
295900                                                                  30430009
296000         EVALUATE TRUE                                            30440009
296100             WHEN SQLCODE = -904                                  30450009
296200             WHEN SQLCODE = -911                                  30460009
296300             WHEN SQLCODE = 0                                     30470009
296400                 CONTINUE                                         30480009
296500             WHEN SQLCODE = +100                                  30490009
296600                 SET PS-NO-MORE-STORE-ROWS TO TRUE                30500009
296700             WHEN SQLWARN NOT = SPACES                            30510009
296800             WHEN SQLCODE NOT = ZERO                              30520009
296900                 MOVE 'Z850-OPEN-STORE-CURSOR'                    30530009
297000                               TO  PV-PARAGRAPH-NAME              30540009
297100                 MOVE 'OPEN ON CURSOR'                            30550009
297200                               TO  PV-DB2-OPER-ATTEMPTED          30560009
297300                 PERFORM Z900-SQL-ABEND                           30570009
297400         END-EVALUATE                                             30580009
297500     END-PERFORM.                                                 30590009
297600*                                                                 30600009
297700     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        30610009
297800         MOVE 'Z600-OPEN-STORE-CURSOR'                            30620009
297900                               TO  PV-PARAGRAPH-NAME              30630009
298000         MOVE 'OPEN RETRIES EXCEEDED'                             30640009
298100                               TO  PV-DB2-OPER-ATTEMPTED          30650009
298200         PERFORM Z900-SQL-ABEND                                   30660009
298300     END-IF.                                                      30670009
298400                                                                  30680009
298500******************************************************************30690009
298600*    FETCH THE NEXT ROW OF THE STORE CURSOR.                      30700009
298700******************************************************************30710009
298800                                                                  30720009
298900 Z860-FETCH-STORE-CURSOR.                                         30730009
299000                                                                  30740009
299100     EXEC SQL                                                     30750009
299200         FETCH STORE_CURSOR                                       30760009
299300         INTO :XMT00001-LOC-NBR                                   30770009
299400             ,:XMT00001-LOC-5-ABBR-NM                             30780009
299500             ,:PV-STR-DC-NBR                                      30790009
299600     END-EXEC.                                                    30800009
299700                                                                  30810009
299800     IF SQLCODE = +100                                            30820009
299900         SET PS-NO-MORE-STORE-ROWS TO TRUE                        30830009
300000     ELSE                                                         30840009
300100         IF SQLCODE NOT = 0                                       30850009
300200              MOVE 'Z860-FETCH-STORE-CURSOR'                      30860009
300300                                       TO PV-PARAGRAPH-NAME       30870009
300400              MOVE 'FETCH ROW FROM STORE CURSOR     '             30880009
300500                                      TO PV-DB2-OPER-ATTEMPTED    30890009
300600             PERFORM Z900-SQL-ABEND                               30900009
300700         END-IF                                                   30910009
300800     END-IF.                                                      30920009
300900                                                                  30930009
301000******************************************************************30940009
301100*    CLOSE THE STORE CURSOR.                                      30950009
301200******************************************************************30960009
301300                                                                  30970009
301400 Z870-CLOSE-STORE-CURSOR.                                         30980009
301500                                                                  30990009
301600     PERFORM                                                      31000009
301700         WITH TEST AFTER                                          31010009
301800         VARYING PV-SQL-SUB                                       31020009
301900         FROM 1 BY 1                                              31030009
302000         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       31040009
302100                   OR SQLCODE = 0)                                31050009
302200                                                                  31060009
302300         EXEC SQL                                                 31070009
302400             CLOSE STORE_CURSOR                                   31080009
302500         END-EXEC                                                 31090009
302600                                                                  31100009
302700         EVALUATE TRUE                                            31110009
302800             WHEN SQLCODE = -904                                  31120009
302900             WHEN SQLCODE = -911                                  31130009
303000             WHEN SQLCODE = 0                                     31140009
303100                 CONTINUE                                         31150009
303200             WHEN SQLWARN NOT = SPACES                            31160009
303300             WHEN SQLCODE NOT = ZERO                              31170009
303400                 MOVE 'Z870-CLOSE-STORE-CURSOR'                   31180009
303500                               TO  PV-PARAGRAPH-NAME              31190009
303600                 MOVE 'CLOSE ON CURSOR'                           31200009
303700                               TO  PV-DB2-OPER-ATTEMPTED          31210009
303800                 PERFORM Z900-SQL-ABEND                           31220009
303900         END-EVALUATE                                             31230009
304000     END-PERFORM.                                                 31240009
304100*                                                                 31250009
304200     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        31260009
304300         MOVE 'Z870-CLOSE-STORE-CURSOR'                           31270009
304400                               TO  PV-PARAGRAPH-NAME              31280009
304500         MOVE 'CLOSE RETRIES EXCEEDED'                            31290009
304600                               TO  PV-DB2-OPER-ATTEMPTED          31300009
304700         PERFORM Z900-SQL-ABEND                                   31310009
304800     END-IF.                                                      31320009
304900                                                                  31330009
305000******************************************************************31340009
305100*  STANDARD DB2 ERROR ABEND ROUTINE                               31350009
305200*  THIS ROUTINE FORCES AN ABEND DUE TO A DB2 PROBLEM.             31360009
305300******************************************************************31370009
305400                                                                  31380009
305500 Z900-SQL-ABEND.                                                  31390009
305600                                                                  31400009
305700     MOVE +4013                 TO ABEND-CODE.                    31410009
305800     DISPLAY '**  ABEND     **'.                                  31420009
305900     DISPLAY '**  PROGRAM   **  =  POKUT121'.                     31430009
306000     DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            31440009
306100     DISPLAY '**  OPERATION **  = ' PV-DB2-OPER-ATTEMPTED.        31450009
306200                                                                  31460009
306300*    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         31470009
306400*    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        31480009
306500                                                                  31490009
306600     COPY DPPD004.                                                31500009
306700                                                                  31510009
306800     CALL 'ILBOABN0'  USING ABEND-CODE.                           31520009
306900    EJECT                                                         31530009
307000                                                                  31540009
