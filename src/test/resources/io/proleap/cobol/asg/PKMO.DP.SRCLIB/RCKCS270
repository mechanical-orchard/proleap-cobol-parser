000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             RCKCS270.                                00050000
000600 AUTHOR.                 LOUIE CRISOSTOMO.                        00060000
000700 INSTALLATION.           KOHLS.                                   00070000
000800 DATE-WRITTEN            FEBRUARY 1995.                           00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*                    QUALITY CONTROL MENU                         00120000
001300*-----------------------------------------------------------------00130000
001400* THIS PROGRAM DISPLAYS THE QUALITY CONTROL MENU ON THE LRT       00140000
001500* (LASER RADIO TERMINAL) AND PASSES CONTROL TO THE PROGRAM        00150000
001600* WHICH PROCESSES THE SELECTED FUNCTION.                          00160000
001700******************************************************************00170000
263784*---------------------------------------------------------------* 00171017
263784* CHANGED 11/10/2021    BY JIM HUNTER      WR: CHG0263784         00172017
263784* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00173017
263784* MAKING THE CALL DYNAMIC VS STATIC.                              00174017
263784*---------------------------------------------------------------* 00175017
001800                                                                  00180000
001900******************************************************************00190000
002000 ENVIRONMENT DIVISION.                                            00200000
002100******************************************************************00210000
002200                                                                  00220000
002300******************************************************************00230000
002400 DATA DIVISION.                                                   00240000
002500******************************************************************00250000
002600                                                                  00260000
002700******************************************************************00270000
002800 WORKING-STORAGE SECTION.                                         00280000
002900******************************************************************00290000
003000 01  CA-COMMAREA.                                                 00300000
003100     05  CA-COMMON-DATA.                                          00310000
003200         10  CA-TRANSACTION-STATUS                                00320000
003300                                         PIC  X(01)  VALUE SPACE. 00330000
003400             88  CA-INITIALIZE-SCREEN                VALUE 'S'.   00340000
003500             88  CA-PROCESS-SCREEN                   VALUE 'R'.   00350000
003600         10  CA-LAST-PROGRAM             PIC  X(08)  VALUE SPACE. 00360000
003700     05  CA-PROGRAM-DATA.                                         00370000
003800         10  CA-SELECTION-X              PIC  X(01)  VALUE SPACE. 00380000
003900         10  CA-SELECTION  REDEFINES  CA-SELECTION-X              00390000
004000                                         PIC  9(01).              00400000
004100             88  CA-VALID-SELECTION                  VALUE        00410000
004200                 1 2.                                             00420016
004300             88  CA-SELECTION-ONE                    VALUE 1.     00430000
004400             88  CA-SELECTION-TWO                    VALUE 2.     00440000
004500             88  CA-SELECTION-THREE                  VALUE 3.     00450000
004600                                                                  00460000
004700 01  PC-PROGRAM-CONSTANTS.                                        00470000
004800     05  PC-COMMAREA-LENGTH              PIC S9(04)  VALUE +10    00480000
004900                                                     COMP.        00490000
005000     05  PC-TRANSFER-DOWN-LENGTH         PIC S9(04)  VALUE +9     00500000
005100                                                     COMP.        00510000
005200     05  PC-DC-RF-APPL-PGM               PIC  X(08)  VALUE        00520000
005300         'MPKCS027'.                                              00530000
005400     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00540000
005500         'RCKCS270'.                                              00550000
005600     05  PC-MENU-TRANID                  PIC  X(04)  VALUE 'E270'.00560000
005700     05  PC-CHECK-AUTH-FOR-TRAN-M026     PIC  X(04)  VALUE 'M026'.00570000
005800     05  PC-CHECK-AUTH-FOR-TRAN-M023     PIC  X(04)  VALUE 'M023'.00580000
005900     05  PC-CHECK-AUTH-FOR-TRAN-E271     PIC  X(04)  VALUE 'E271'.00590000
006100     05  PC-END-OF-SESSION-MSG           PIC  X(19)  VALUE        00610000
006200         'END OF SESSION     '.                                   00620000
006300     05  PC-INVALID-SELECTION-MSG        PIC  X(19)  VALUE        00630000
006400         'INVALID SELECTION  '.                                   00640000
006500     05  PC-UNRECOGNIZED-PF-KEY-MSG      PIC  X(19)  VALUE        00650000
006600         'UNRECOGNIZED PF KEY'.                                   00660000
006700     05  PC-ACCESS-NOT-ALLOWED-MSG       PIC  X(19)  VALUE        00670000
006800         'USER NOT AUTHORIZED'.                                   00680000
006900     05  PC-NON-NUMERIC-SELECTION-MSG    PIC  X(19)  VALUE        00690000
007000         'NUMERIC VALUE REQ. '.                                   00700000
007100     05  PC-PROGRAM-FUNCTION-KEYS        PIC  X(19)  VALUE        00710000
007200         'F0 =END            '.                                   00720000
007300     05  PC-TRANS-UNAVAILABLE-MSG        PIC  X(19)  VALUE        00730000
007400         'TRANS NOT AVAILABLE'.                                   00740000
007500     05  PC-CICS-ABEND-MSG               PIC  X(19)  VALUE        00750000
007600         'CICS ABEND -CALL DP'.                                   00760000
007700     05  PC-CICSAUTH-MSG                 PIC  X(19)  VALUE        00770000
007800         'CICSAUTH BAD RETURN'.                                   00780000
007900                                                                  00790000
008000                                                                  00800000
008100 01  PN-PGM-NAME-DATA.                                            00810000
008200     05  PN-SELECTION-01-PROGRAM         PIC  X(08)  VALUE        00820000
008300         'MPKCS026'.                                              00830000
008400     05  PN-SELECTION-02-PROGRAM         PIC  X(08)  VALUE        00840000
008500         'MPKCS023'.                                              00850000
009000                                                                  00900000
009100 01  PN-PGM-NAME-TABLE  REDEFINES  PN-PGM-NAME-DATA.              00910000
009200     05  PN-PGM-NAME  OCCURS 2 TIMES                              00920015
009300                      INDEXED BY PN-INDX                          00930000
009400                                         PIC  X(08).              00940000
009500                                                                  00950000
009600 01  PS-PROGRAM-SWITCHES.                                         00960000
009700     05  PS-ACCESS-ALLOWED-IND           PIC  X(01)  VALUE 'N'.   00970000
009800         88  PS-NO-ACCESS-ALLOWED                    VALUE 'N'.   00980000
009900         88  PS-ACCESS-ALLOWED                       VALUE 'Y'.   00990000
009910     05  PS-UPC-CERT-AVAIL-SW            PIC  X(01)  VALUE 'Y'.   00991003
009920         88  PS-UPC-CERT-AVAIL-YES                   VALUE 'Y'.   00992003
009930         88  PS-UPC-CERT-AVAIL-NO                    VALUE 'N'.   00993003
010000                                                                  01000000
010100                                                                  01010000
010200 01  PV-PROGRAM-VARIABLES.                                        01020000
010300     05  PV-DISP-SQLCODE                 PIC  -999.               01030011
010310     05  PV-MESSAGE-AREA                 PIC  X(19)  VALUE SPACE. 01031011
010400     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  01040000
010500                                                     COMP SYNC.   01050000
010600     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 01060000
010700     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01070000
010800                                                     COMP.        01080000
010900                                                                  01090000
011000******************************************************************01100000
011100*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               01110000
011200******************************************************************01120000
011300     COPY DPWS013.                                                01130000
011400                                                                  01140000
011500******************************************************************01150000
011600*    COPY BOOK FOR THE CICSAUTH SUBROUTINE                        01160000
011700******************************************************************01170000
011800     COPY DPWS008.                                                01180000
011900                                                                  01190000
012000******************************************************************01200000
012100*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 01210000
012200******************************************************************01220000
012300     COPY DPWS010I.                                               01230000
012400                                                                  01240000
012500******************************************************************01250000
012600*  GENERATED DSECT FOR THE MPKM027 MAPSET                         01260000
012700******************************************************************01270000
012800     COPY RCKM270.                                                01280000
012900                                                                  01290000
013000******************************************************************01300000
013100*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   01310000
013200******************************************************************01320000
013300     COPY DPWS015.                                                01330000
013400                                                                  01340000
013500******************************************************************01350000
013600* HELP SCREEN COMMAREA                                            01360000
013700******************************************************************01370000
013800     COPY PCWS192.                                                01380000
013900******************************************************************01390000
014000* HELP SCREEN WORK AREA                                           01400000
014100******************************************************************01410000
014200     COPY PCWS188.                                                01420000
014300******************************************************************01430000
014400*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      01440000
014500******************************************************************01450000
014600     COPY DFHAID.                                                 01460000
014700                                                                  01470000
014701*                                                                 01470101
014702***                                                               01470201
014703***  DMH BEGIN - 1/20/14 -                                        01470301
014704*                                                                 01470401
014705***  NEW ITEM SYSTEM IS BEING INSTALLED. NEW PARM IS BEING ADDED  01470501
014706***  TO PREVENT DC'S FROM USING UPC CERTIFICATION PROCESS DURING  01470601
014707***  DATA CONVERSION                                              01470701
014710*                                                                 01471001
014711*                                                                 01471101
014720*                                                                 01472001
014730*  PARM TABLE - TKRPRPM                                           01473001
014731*                                                                 01473101
014740     EXEC SQL                                                     01474001
014750          INCLUDE TKRPRPM                                         01475001
014760     END-EXEC.                                                    01476001
014770                                                                  01477001
014780*                                                                 01478001
014790*  COMMUNICATIONS AREA FOR DB2                                    01479001
014791*                                                                 01479101
014792     EXEC SQL                                                     01479201
014793         INCLUDE SQLCA                                            01479301
014794     END-EXEC.                                                    01479401
014795                                                                  01479501
014796*                                                                 01479601
014797***                                                               01479701
014798***  DMH END   - 1/20/14 -                                        01479801
014799**                                                                01479901
014800*                                                                 01480001
014810******************************************************************01481001
014900 LINKAGE SECTION.                                                 01490000
015000******************************************************************01500000
015100 01  DFHCOMMAREA                         PIC  X(700).             01510000
015200                                                                  01520000
015300******************************************************************01530000
015400 PROCEDURE DIVISION.                                              01540000
015500******************************************************************01550000
015600 0000-PROGRAM-MAINLINE.                                           01560000
015700     IF EIBTRNID = 'Z278'                                         01570000
015800         MOVE DFHCOMMAREA            TO PC192-COMMAREA            01580000
015900         MOVE PC192-HOST-SAVE-AREA   TO CA-COMMAREA               01590000
016000     ELSE                                                         01600000
016100         MOVE DFHCOMMAREA            TO CA-COMMAREA               01610000
016200     END-IF.                                                      01620000
016300     MOVE LOW-VALUES                 TO RC270AI.                  01630000
016400                                                                  01640000
016500     EVALUATE TRUE                                                01650000
016600         WHEN EIBCALEN = ZERO                                     01660000
016700         WHEN EIBAID = DFHCLEAR                                   01670000
016800         WHEN CA-INITIALIZE-SCREEN                                01680000
016801*                                                                 01680101
016803***  DMH BEGIN - 1/20/14 -                                        01680301
016805*                                                                 01680501
016820*****1/22/14  PERFORM 3000-CHECK-UPC-CERT-AVAIL                   01682014
016830*                                                                 01683002
016840***  DMH END   - 1/20/14 -                                        01684002
016850*                                                                 01685002
016900              INITIALIZE CA-COMMAREA                              01690000
017000              PERFORM 8000-SEND-MAP                               01700000
017100              PERFORM 8200-RETURN-TRANID                          01710000
017200         WHEN EIBAID = DFHPF1                                     01720000
017300              PERFORM 1400-HELP-SCREEN                            01730000
017400         WHEN EIBAID = DFHENTER                                   01740000
017500              PERFORM 1000-RECEIVE-MAP                            01750000
017600              PERFORM 1100-EDIT-SELECTION                         01760000
017700         WHEN EIBAID = DFHPF3                                     01770000
017800              MOVE PC-DC-RF-APPL-PGM TO PV-TRANSFER-PROGRAM       01780000
017900              PERFORM 2100-XCTL-TO-SELECTED-PROGRAM               01790000
018000         WHEN OTHER                                               01800000
018100              MOVE PC-UNRECOGNIZED-PF-KEY-MSG                     01810000
018200                                     TO AMSGLNO                   01820000
018300              PERFORM 8100-SEND-DATA-ONLY                         01830000
018400              PERFORM 8200-RETURN-TRANID                          01840000
018500     END-EVALUATE.                                                01850000
018600                                                                  01860000
018700     GOBACK.                                                      01870000
018800*                                                                 01880000
018900*                                                                 01890000
019000 1000-RECEIVE-MAP.                                                01900000
019100     EXEC CICS                                                    01910000
019200         RECEIVE MAP    ('RC270A')                                01920000
019300                 MAPSET ('RCKM270')                               01930000
019400                 RESP   (PV-CICS-RESPONSE)                        01940000
019500     END-EXEC.                                                    01950000
019600                                                                  01960000
019700     EVALUATE TRUE                                                01970000
019800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 01980000
019900              PERFORM 1010-RECEIVE-SCREEN-FIELDS                  01990000
020000         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                02000000
020100              CONTINUE                                            02010000
020200         WHEN OTHER                                               02020000
020300              MOVE '1000-RECEIVE-MAP'                             02030000
020400                                     TO DP013-PARAGRAPH           02040000
020500              MOVE 'UNABLE TO RECEIVE MAP'                        02050000
020600                                     TO DP013-MESSAGE-TEXT (1)    02060000
020700              SET DP013-LOGIC-ABEND  TO TRUE                      02070000
020800              SET DP013-NO-ROLLBACK  TO TRUE                      02080000
020900              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              02090000
021000     END-EVALUATE.                                                02100000
021100*                                                                 02110000
021200*                                                                 02120000
021300 1010-RECEIVE-SCREEN-FIELDS.                                      02130000
021400     IF  ASELECTL > ZERO                                          02140000
021500         MOVE ASELECTI               TO CA-SELECTION-X            02150000
021600     END-IF.                                                      02160000
021700*                                                                 02170000
021800*                                                                 02180000
021900 1100-EDIT-SELECTION.                                             02190000
022000     MOVE CA-SELECTION-X             TO DP010I-UNEDITED-FIELD.    02200000
022100     MOVE 1                          TO DP010I-MAXIMUM-DIGITS.    02210000
022200     MOVE 0                          TO DP010I-MAXIMUM-DECIMALS.  02220000
022300     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     02230000
022400                                                                  02240000
263784     CALL DP010I-NUMERIC-EDIT-ROUTINE                             02251017
263784          USING DP010I-NUMERIC-EDIT-AREA.                         02252017
022600                                                                  02260000
022700     IF  DP010I-ERROR-DETECTED                                    02270000
022800         MOVE PC-NON-NUMERIC-SELECTION-MSG                        02280000
022900                                     TO AMSGLNO                   02290000
023000         PERFORM 8100-SEND-DATA-ONLY                              02300000
023100         PERFORM 8200-RETURN-TRANID                               02310000
023200     ELSE                                                         02320000
023300         MOVE DP010I-NUMERIC-FIELD   TO CA-SELECTION              02330000
023400     END-IF.                                                      02340000
023500                                                                  02350000
023501*                                                                 02350103
023502***  DMH BEGIN - 1/20/14 -                                        02350203
023503*                                                                 02350303
023504     PERFORM 3000-CHECK-UPC-CERT-AVAIL                            02350403
023510                                                                  02351003
023511     IF  CA-SELECTION-TWO  AND                                    02351106
023512         PS-UPC-CERT-AVAIL-NO                                     02351203
023513         MOVE DP015-UNP-NUM-BRT-MDT  TO ASELECTA                  02351303
023514         MOVE '    UPC CERTIFY    '  TO AMSGLNO                   02351408
023515         MOVE 'CURRENT UNAVAILABLE'  TO  AMSGLN1O                 02351508
023516         MOVE '  PLEASE SEE YOUR  '  TO  AMSGLN2O                 02351608
023517         MOVE '    SUPERVISOR     '  TO  AMSGLN3O                 02351708
023518         MOVE '** HOLD FREIGHT ** '  TO  AMSGLN4O                 02351808
023519         MOVE '******************'   TO  AMSGLN5O                 02351908
023522         PERFORM 8100-SEND-DATA-ONLY                              02352203
023530         PERFORM 8200-RETURN-TRANID                               02353003
023540     ELSE                                                         02354003
023550*                                                                 02355003
023560***  DMH END   - 1/20/14 -                                        02356003
023570*                                                                 02357003
023600     IF  CA-VALID-SELECTION                                       02360000
023700         PERFORM 2000-PROCESS-SELECTION                           02370000
023800     ELSE                                                         02380000
023900         MOVE DP015-UNP-NUM-BRT-MDT  TO ASELECTA                  02390000
024000         MOVE PC-INVALID-SELECTION-MSG                            02400000
024100                                     TO AMSGLNO                   02410000
024200         PERFORM 8100-SEND-DATA-ONLY                              02420000
024300         PERFORM 8200-RETURN-TRANID                               02430000
024400     END-IF.                                                      02440000
024500*                                                                 02450000
024600*                                                                 02460000
024700*                                                                 02470000
024800 1400-HELP-SCREEN.                                                02480000
024900     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      02490000
025000     MOVE 'RCKCS270'                  TO PC192-PROGRAM-NAME       02500000
025100     COPY PCPD188.                                                02510000
025200     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      02520000
025300     PERFORM 2200-XCTL-TO-HELP.                                   02530000
025400                                                                  02540000
025500*                                                                 02550000
025600 2000-PROCESS-SELECTION.                                          02560000
025700     SET PN-INDX                     TO CA-SELECTION.             02570000
025800     IF CA-SELECTION < 5                                          02580000
025900         PERFORM 9000-CHECK-RACF                                  02590000
026000     ELSE                                                         02600000
026100         MOVE PN-PGM-NAME (PN-INDX)  TO PV-TRANSFER-PROGRAM       02610000
026200         PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                    02620000
026300     END-IF.                                                      02630000
026400                                                                  02640000
026500     IF  PS-ACCESS-ALLOWED                                        02650000
026600         MOVE PN-PGM-NAME (PN-INDX)  TO PV-TRANSFER-PROGRAM       02660000
026700         PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                    02670000
026800     ELSE                                                         02680000
026900         MOVE DP015-UNP-NUM-BRT-MDT  TO ASELECTA                  02690000
027000         PERFORM 8100-SEND-DATA-ONLY                              02700000
027100         PERFORM 8200-RETURN-TRANID                               02710000
027200     END-IF.                                                      02720000
027300*                                                                 02730000
027400*                                                                 02740000
027500 2100-XCTL-TO-SELECTED-PROGRAM.                                   02750000
027600     SET CA-INITIALIZE-SCREEN        TO TRUE.                     02760000
027700     MOVE PC-CURRENT-PROGRAM-NAME    TO CA-LAST-PROGRAM.          02770000
027800                                                                  02780000
027900     EXEC CICS                                                    02790000
028000         XCTL                                                     02800000
028100             PROGRAM   (PV-TRANSFER-PROGRAM)                      02810000
028200             COMMAREA  (CA-COMMAREA)                              02820000
028300             LENGTH    (PC-TRANSFER-DOWN-LENGTH)                  02830000
028400             RESP      (PV-CICS-RESPONSE)                         02840000
028500     END-EXEC.                                                    02850000
028600                                                                  02860000
028700     EVALUATE TRUE                                                02870000
028800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02880000
028900              CONTINUE                                            02890000
029000         WHEN OTHER                                               02900000
029100              MOVE '2100-XCTL-TO-SELECTED-PROGRAM'                02910000
029200                                     TO DP013-PARAGRAPH           02920000
029300              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       02930000
029400                                     TO DP013-MESSAGE-TEXT (1)    02940000
029500              MOVE PV-TRANSFER-PROGRAM                            02950000
029600                                     TO DP013-MESSAGE-TEXT (2)    02960000
029700              SET DP013-CICS-ABEND   TO TRUE                      02970000
029800              SET DP013-NO-ROLLBACK  TO TRUE                      02980000
029900              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              02990000
030000              MOVE PC-TRANS-UNAVAILABLE-MSG                       03000000
030100                                     TO AMSGLNO                   03010000
030200              SET CA-PROCESS-SCREEN  TO TRUE                      03020000
030300              PERFORM 8100-SEND-DATA-ONLY                         03030000
030400              PERFORM 8200-RETURN-TRANID                          03040000
030500     END-EVALUATE.                                                03050000
030600*                                                                 03060000
030700*                                                                 03070000
030800 2200-XCTL-TO-HELP.                                               03080000
030900                                                                  03090000
031000     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH.      03100000
031100     SET CA-INITIALIZE-SCREEN         TO TRUE.                    03110000
031200     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA.    03120000
031300                                                                  03130000
031400     EXEC CICS                                                    03140000
031500         XCTL                                                     03150000
031600             PROGRAM   (PV-TRANSFER-PROGRAM)                      03160000
031700             COMMAREA  (PC192-COMMAREA)                           03170000
031800             LENGTH    (PV-COMMAREA-LENGTH)                       03180000
031900             RESP      (PV-CICS-RESPONSE)                         03190000
032000     END-EXEC.                                                    03200000
032100                                                                  03210000
032200     EVALUATE TRUE                                                03220000
032300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03230000
032400              CONTINUE                                            03240000
032500         WHEN OTHER                                               03250000
032600              MOVE '2200-XCTL-TO-HELP'                            03260000
032700                                     TO DP013-PARAGRAPH           03270000
032800              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       03280000
032900                                     TO DP013-MESSAGE-TEXT (1)    03290000
033000              MOVE PV-TRANSFER-PROGRAM                            03300000
033100                                     TO DP013-MESSAGE-TEXT (2)    03310000
033200              SET DP013-CICS-ABEND   TO TRUE                      03320000
033300              SET DP013-NO-ROLLBACK  TO TRUE                      03330000
033400              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              03340000
033500              MOVE PC-TRANS-UNAVAILABLE-MSG                       03350000
033600                                     TO AMSGLNO                   03360000
033700              SET CA-PROCESS-SCREEN TO TRUE                       03370000
033800              PERFORM 8100-SEND-DATA-ONLY                         03380000
033900              PERFORM 8200-RETURN-TRANID                          03390000
034000     END-EVALUATE.                                                03400000
034001*                                                                 03400102
034002***  DMH BEGIN - 1/20/14 -                                        03400202
034003*                                                                 03400302
034010 3000-CHECK-UPC-CERT-AVAIL.                                       03401002
034011     MOVE 'Y' TO  PS-UPC-CERT-AVAIL-SW.                           03401113
034012     MOVE ZEROES TO  SQLCODE.                                     03401213
034013                                                                  03401303
034014     EXEC SQL                                                     03401402
034021          SELECT FUNC_TXT                                         03402103
034022            INTO  :PS-UPC-CERT-AVAIL-SW                           03402203
034023            FROM TKRPRPM                                          03402304
034024           WHERE LOC_ID             =  90                         03402403
034025             AND INTFC_SYS_CDE      = 'KHL'                       03402503
034026             AND SYS_PRC_FUNC_CDE   = 'UPCCRT'                    03402603
034027             AND FUNC_PRC_STAT_CDE  = 'AC'                        03402705
034028             AND FUNC_BEG_TMST     <=  CURRENT TIMESTAMP          03402803
034029             AND FUNC_END_TMST     >=  CURRENT TIMESTAMP          03402903
034030     END-EXEC                                                     03403003
034031                                                                  03403103
034032     EVALUATE TRUE                                                03403203
034033         WHEN SQLCODE = ZERO                                      03403303
034034              MOVE '    UPC CERTIFY    ' TO  AMSGLN1O             03403409
034035              MOVE 'CURRENT UNAVAILABLE' TO  AMSGLN2O             03403509
034036              MOVE '  PLEASE SEE YOUR  ' TO  AMSGLN3O             03403609
034037              MOVE '    SUPERVISOR     ' TO  AMSGLN4O             03403709
034038              MOVE '** HOLD FREIGHT ** ' TO  AMSGLN5O             03403809
034045         WHEN OTHER                                               03404503
034046              MOVE 'Y' TO  PS-UPC-CERT-AVAIL-SW                   03404603
034047              MOVE '3000-CHECK-UPC-CERT-AVAIL'                    03404710
034048                  TO DP013-PARAGRAPH                              03404810
034049              MOVE SQLCODE  TO  PV-DISP-SQLCODE                   03404911
034050              STRING  'UNABLE TO SELECT TKRPRPM '                 03405011
034051                       PV-DISP-SQLCODE   DELIMITED BY SIZE        03405112
034052                INTO DP013-MESSAGE-TEXT (1)                       03405211
034053              SET DP013-CICS-ABEND     TO TRUE                    03405311
034054              SET DP013-NO-ROLLBACK    TO TRUE                    03405411
034055              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              03405511
034060     END-EVALUATE.                                                03406003
034062                                                                  03406202
034070                                                                  03407002
034100*                                                                 03410000
034110*                                                                 03411002
034120***  DMH END   - 1/20/14 -                                        03412002
034130*                                                                 03413002
034200*                                                                 03420000
034300 8000-SEND-MAP.                                                   03430000
034400     EXEC CICS                                                    03440000
034500         SEND MAP       ('RC270A')                                03450000
034600              MAPSET    ('RCKM270')                               03460000
034700              ERASE                                               03470000
034800              RESP      (PV-CICS-RESPONSE)                        03480000
034900     END-EXEC.                                                    03490000
035000                                                                  03500000
035100     EVALUATE TRUE                                                03510000
035200         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03520000
035300              CONTINUE                                            03530000
035400         WHEN OTHER                                               03540000
035500              MOVE '8000-SEND-MAP'   TO DP013-PARAGRAPH           03550000
035600              MOVE 'UNABLE TO SEND MAP'                           03560000
035700                                     TO DP013-MESSAGE-TEXT (1)    03570000
035800              SET DP013-CICS-ABEND   TO TRUE                      03580000
035900              SET DP013-NO-ROLLBACK  TO TRUE                      03590000
036000              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              03600000
036100     END-EVALUATE.                                                03610000
036200*                                                                 03620000
036300*                                                                 03630000
036400 8100-SEND-DATA-ONLY.                                             03640000
036500     MOVE -1 TO ASELECTL.                                         03650000
036600                                                                  03660000
036700     EXEC CICS                                                    03670000
036800         SEND MAP       ('RC270A')                                03680000
036900              MAPSET    ('RCKM270')                               03690000
037000              CURSOR                                              03700000
037100              DATAONLY                                            03710000
037200              RESP      (PV-CICS-RESPONSE)                        03720000
037300     END-EXEC.                                                    03730000
037400                                                                  03740000
037500     EVALUATE TRUE                                                03750000
037600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03760000
037700              CONTINUE                                            03770000
037800         WHEN OTHER                                               03780000
037900              MOVE '8100-SEND-DATA-ONLY'                          03790000
038000                                     TO DP013-PARAGRAPH           03800000
038100              MOVE 'UNABLE TO SEND DATA'                          03810000
038200                                     TO DP013-MESSAGE-TEXT (1)    03820000
038300              SET DP013-CICS-ABEND   TO TRUE                      03830000
038400              SET DP013-NO-ROLLBACK  TO TRUE                      03840000
038500              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              03850000
038600     END-EVALUATE.                                                03860000
038700*                                                                 03870000
038800*                                                                 03880000
038900 8200-RETURN-TRANID.                                              03890000
039000     EXEC CICS                                                    03900000
039100         RETURN TRANSID   (PC-MENU-TRANID)                        03910000
039200                COMMAREA  (CA-COMMAREA)                           03920000
039300                LENGTH    (PC-COMMAREA-LENGTH)                    03930000
039400                RESP      (PV-CICS-RESPONSE)                      03940000
039500     END-EXEC.                                                    03950000
039600                                                                  03960000
039700     EVALUATE TRUE                                                03970000
039800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03980000
039900              CONTINUE                                            03990000
040000         WHEN OTHER                                               04000000
040100              MOVE '8200-RETURN-TRANID'                           04010000
040200                                     TO DP013-PARAGRAPH           04020000
040300              MOVE 'UNABLE TO RETURN TO TRANID'                   04030000
040400                                     TO DP013-MESSAGE-TEXT (1)    04040000
040500              SET DP013-CICS-ABEND   TO TRUE                      04050000
040600              SET DP013-NO-ROLLBACK  TO TRUE                      04060000
040700              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              04070000
040800     END-EVALUATE.                                                04080000
040900*                                                                 04090000
041000*                                                                 04100000
041100 9000-CHECK-RACF.                                                 04110000
041200******************************************************************04120000
041300*  CHECK ACCESSS AUTHORITY OF USER                                04130000
041400******************************************************************04140000
041500     SET DP008-RSRC-TYPE-TRAN        TO TRUE.                     04150000
041600     SET DP008-ACCESS-TYPE-USE       TO TRUE.                     04160000
041700                                                                  04170000
041800     EVALUATE TRUE                                                04180000
041900         WHEN CA-SELECTION-ONE                                    04190000
042000              MOVE PC-CHECK-AUTH-FOR-TRAN-M026                    04200000
042100                                     TO DP008-RESOURCE-NAME       04210000
042200         WHEN CA-SELECTION-TWO                                    04220000
042300              MOVE PC-CHECK-AUTH-FOR-TRAN-M023                    04230000
042400                                     TO DP008-RESOURCE-NAME       04240000
043100     END-EVALUATE.                                                04310000
043200                                                                  04320000
043300     EXEC CICS                                                    04330000
043400          LINK PROGRAM  (DP008-SECURITY-SUBROUTINE)               04340000
043500               COMMAREA (DP008-SECURITY-COMMAREA)                 04350000
043600               LENGTH   (DP008-SECURITY-COMMAREA-LENGTH)          04360000
043700               RESP     (PV-CICS-RESPONSE)                        04370000
043800     END-EXEC.                                                    04380000
043900                                                                  04390000
044000     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)                       04400000
044100         IF  DP008-CALL-SUCCESSFUL                                04410000
044200             IF  DP008-ACCESS-ALLOWED                             04420000
044300                 SET PS-ACCESS-ALLOWED                            04430000
044400                                     TO TRUE                      04440000
044500             ELSE                                                 04450000
044600                 MOVE PC-ACCESS-NOT-ALLOWED-MSG                   04460000
044700                                     TO AMSGLNO                   04470000
044800             END-IF                                               04480000
044900         ELSE                                                     04490000
045000             MOVE PC-CICSAUTH-MSG    TO AMSGLNO                   04500000
045100         END-IF                                                   04510000
045200     ELSE                                                         04520000
045300         MOVE '9000-CHECK-RACF'      TO DP013-PARAGRAPH           04530000
045400         MOVE 'BAD LINK TO RACF PROGRAM'                          04540000
045500                                     TO DP013-MESSAGE-TEXT (1)    04550000
045600         SET DP013-CICS-ABEND        TO TRUE                      04560000
045700         SET DP013-NO-ROLLBACK       TO TRUE                      04570000
045800         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   04580000
045900     END-IF.                                                      04590000
046000*                                                                 04600000
046100*                                                                 04610000
046200 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  04620000
046300     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            04630000
046400     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           04640000
046500     INITIALIZE DP013-SRC-TASK-NUMBER                             04650000
046600                DP013-STACK.                                      04660000
046700     SET DP013-LINK-RETURN           TO TRUE.                     04670000
046800                                                                  04680000
046900     EXEC CICS                                                    04690000
047000         LINK                                                     04700000
047100             PROGRAM   (DP013-NAME)                               04710000
047200             COMMAREA  (DP013-PARAMETERS)                         04720000
047300             LENGTH    (DP013-LENGTH)                             04730000
047400     END-EXEC.                                                    04740000
