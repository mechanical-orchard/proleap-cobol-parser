000100 IDENTIFICATION DIVISION.                                         00010017
000200 PROGRAM-ID.     APKUP055.                                        00020017
000300 AUTHOR.         M WILKINSON.                                     00030017
000400*DATE-WRITTEN.   JAN  29, 1997.                                   00040017
000500*DATE-COMPILED.                                                   00050017
000600***************************************************************** 00060026
000700*    COBOL 2 WITH SQL                                           * 00070026
000800*                                                               * 00080026
000900*    DELETE THE ROWS IN ACCOUNTS PAYABLE TABLES THAT MATCH      * 00090026
001000*    REQUEST SEQUENCE NUMBERS IN THE INPUT FILE RECORDS.        * 00100026
001100*                                                               * 00110026
001200*    TINVCTM - INVOICE TERMS TABLE                              * 00120026
001300*    TALCHRG - ALLOWANCE CHARGE TABLE                           * 00130026
001400*    TVNDINV - VENDOR SUPPLIED INVOICE ITEMS TABLE              * 00140026
001500*    TMIITEM - MDS INVOICE ITEMS TABLE                          * 00150026
001600*    TPREQIT - PAYMENT REQUEST ITEMS TABLE                      * 00160026
001800*    TMDINVC - MDS INVOICE INFO TABLE                           * 00180026
001900*    TINVOIC - INVOICE SUMMARY INFO TABLE                       * 00190026
002000*    TPAYREQ - PAYMENT REQUEST TABLE                            * 00200026
002100*    TEXINVC - AP-EXPENSE INVOICE TABLE                         * 00210026
002300*                                                               * 00230026
002400* INPUT:                                                        * 00240026
002500* 1.  DSN OF PAYT REQ SEQ NBRS TO BE DELETED                    * 00250026
002600*     - PKMO.AP.APRD067.PURGE.INVOICES -                        * 00260026
002700* OUTPUT:                                                       * 00270026
002800* 1.  DELETE DB2 ACCOUNTS PAYABLE DATA THAT MATCHES             * 00280026
002900*     INPUT PAY-REQ-SEQ-NUMBER                                  * 00290026
003000***************************************************************** 00300026
003100* CHANGE LOG:                                                   * 00310026
003200*                                                               * 00320026
003300*    DATE: 01/30/98                                             * 00330026
003400*    CHANGE MADE: EXTRACT AGED INVOICES WITH DELETE STATUS      * 00340026
003500*    MADE BY: ROBIN BERNOSKI          WR/IR #: 5587             * 00350026
003501*                                                               * 00350126
003510*    DATE: 06/17/2002                                           * 00351026
003511*    ARK PO PROJECT PHASE 1.  ELIMINATED ALL REFERENCES TO      * 00351126
003520*    TABLE TINCEDI.  REPLACED PAYT_REQ_SEQ_NBR WITH PO_NBR      * 00352026
003530*    AND INVC_ID IN WHERE CONDITIONS.  ADDED LOGIC IN           * 00353026
003540*    POPULATING PO-NBR AND INVC-ID.  CORRECTED ABEND            * 00354026
003550*    MESSAGES.  PARAGRAPHS MODIFIED ARE B200, D250, D550,       * 00355026
003560*    D600, AND D300.                                            * 00356026
003580*    MADE BY:  KEVIN CATLIN           WR/IR #: 23500            * 00358026
003590*                                                               * 00359026
003591*  09/09/02                                                     * 00359131
003592*      ARK PO PROJECT PHASE 2.  REMOVE ALL REFERENCES TO TABLE  * 00359226
003593*      TPPDREV.  REPLACE PAYT-REQ-SEQ-NBR WITH PO-NBR AND       * 00359326
003594*      INVC-ID IN MOVES AND IN WHERE CONDITIONS OF SQL SELECTS. * 00359426
003595*      PARAGRAPHS MODIFIED ARE S200, B200, D100, AND D150.      * 00359526
003596*  BY: KEVIN CATLIN                   WR #: 23500               * 00359626
003597*                                                               * 00359726
003598*  03/11/07                                                     * 00359833
003599*      MATCH BY DC PROJECT.                                     * 00359932
003600*      REMOVED ALL REFERENCES TO TPAYREQ.                       * 00360032
003603*  BY: ROLF NOHE                      WR #: 21578               * 00360332
003604*                                                               * 00360432
003605* DATE  11/14/2014                                              * 00360535
003606*      RECOMPILED THE  PROGRAM. CHANGES WERE MADE TO APRD067    * 00360635
003607*      COPYBOOK.                                                * 00360735
003608*      MADE BY: COGNIZANT              WR/IR: CHG0094517        * 00360835
003610***************************************************************** 00361032
003700 ENVIRONMENT DIVISION.                                            00370017
003800                                                                  00380017
003900 INPUT-OUTPUT SECTION.                                            00390017
004000                                                                  00400017
004100 FILE-CONTROL.                                                    00410017
004200                                                                  00420017
004300     SELECT TDELETE-FILE                                          00430017
004400         ASSIGN         TO UT-S-INP01.                            00440017
004500                                                                  00450017
004600 DATA DIVISION.                                                   00460017
004700                                                                  00470017
004800 FILE SECTION.                                                    00480017
004900                                                                  00490017
005000 FD  TDELETE-FILE                                                 00500017
005100         LABEL RECORDS  ARE STANDARD                              00510017
005200         RECORDING MODE IS  F                                     00520017
005300         DATA RECORD    IS  TDELETE-RECORD.                       00530017
005400                                                                  00540017
005500 01  TDELETE-RECORD                PIC X(80).                     00550017
005600                                                                  00560017
005700/                                                                 00570017
005800 WORKING-STORAGE SECTION.                                         00580017
005900                                                                  00590017
006000 01  FILLER                        PIC X(25) VALUE                00600017
006100                             'WS FOR APKUP055 BEGINS==>'.         00610017
006200 01  ABEND-CODE                    PIC S9(4) COMP SYNC            00620017
006300                                             VALUE ZEROS.         00630017
006400     88 AP-PARM-ERROR              VALUE +4003.                   00640017
006500     88 AP-TABLE-FULL              VALUE +4004.                   00650017
006600     88 AP-EMPTY-FILE              VALUE +4005.                   00660017
006700     88 AP-DB2-ERROR               VALUE +4013.                   00670017
006800                                                                  00680017
006900 01  WS-RETRY-COUNTER              PIC S9(4) COMP VALUE ZERO.     00690017
007000                                                                  00700017
007100 01  WS-RETRY-MAX                  PIC S9(4) COMP VALUE 3.        00710017
007200                                                                  00720017
007300 01  WS-SWITCH-AREA.                                              00730017
007400     05  WS-INPUT-END-SW           PIC X(03)  VALUE 'NO '.        00740017
007500         88  WS-END-OF-INPUT                  VALUE 'YES'.        00750017
007600         88  WS-NOT-END-OF-INPUT              VALUE 'NO '.        00760017
008000                                                                  00800017
008100 01  WS-ABEND-FIELDS.                                             00810017
008200     05  WS-ABEND-PROGRAM             PIC X(8)  VALUE 'APKUP055'. 00820017
008300     05  WS-ABEND-PARAGRAPH           PIC X(50) VALUE SPACES.     00830017
008400     05  WS-ABEND-OPERATION           PIC X(50) VALUE SPACES.     00840017
008500     05  WS-ABEND-STRUCTURE-1         PIC X(8)  VALUE SPACES.     00850017
008600     05  WS-ABEND-STRUCTURE-2         PIC X(8)  VALUE SPACES.     00860017
008700     05  WS-ABEND-STATUS              PIC XX    VALUE SPACES.     00870017
008800                                                                  00880017
008900*                                                                 00890017
009000 01  WS-PROGRAM-COUNTERS.                                         00900017
009100     05  WS-INPUT-REC-CNT        PIC 9(6)   VALUE ZEROS.          00910017
009200     05  WS-INPUT-REC-CNT-DISP   PIC ZZZZZ9 VALUE ZEROS.          00920017
009300     05  WS-INVCTM-DEL-CNT       PIC 9(6)   VALUE ZEROS.          00930017
009400     05  WS-MIITEM-DEL-CNT       PIC 9(6)   VALUE ZEROS.          00940017
009500     05  WS-PREQIT-DEL-CNT       PIC 9(6)   VALUE ZEROS.          00950017
009600     05  WS-ALCHRG-DEL-CNT       PIC 9(6)   VALUE ZEROS.          00960017
009700     05  WS-MDINVC-DEL-CNT       PIC 9(6)   VALUE ZEROS.          00970017
009800     05  WS-INVOIC-DEL-CNT       PIC 9(6)   VALUE ZEROS.          00980017
009900     05  WS-VNDINV-DEL-CNT       PIC 9(6)   VALUE ZEROS.          00990017
010200     05  WS-EXINVC-DEL-CNT       PIC 9(6)   VALUE ZEROS.          01020017
010400     05  WS-DELETE-CNT-DISP      PIC ZZZZZ9 VALUE ZEROS.          01040017
010500                                                                  01050017
010600     COPY DPWS004.                                                01060017
010700                                                                  01070017
010800     COPY APRD067.                                                01080017
010900                                                                  01090017
011000 01  FILLER                      PIC X(35)  VALUE                 01100017
011100     'END OF AP WORK RECORD AREA       **'.                       01110017
011200                                                                  01120017
011300                                                                  01130017
011400******************************************************************01140017
011500*  COMMUNICATIONS AREA2 FOR DB2                                   01150017
011600******************************************************************01160017
011700     COPY SQLCA2.                                                 01170017
011800                                                                  01180017
011900                                                                  01190017
012000     EXEC SQL                                                     01200017
012100          INCLUDE SQLCA                                           01210017
012200     END-EXEC.                                                    01220017
012300                                                                  01230017
012400     EXEC SQL                                                     01240017
012500          INCLUDE TINVCTM                                         01250017
012600     END-EXEC.                                                    01260017
012700                                                                  01270017
012800     EXEC SQL                                                     01280017
012900          INCLUDE TALCHRG                                         01290017
013000     END-EXEC.                                                    01300017
013100                                                                  01310017
013200     EXEC SQL                                                     01320017
013300          INCLUDE TPREQIT                                         01330017
013400     END-EXEC.                                                    01340017
013500                                                                  01350017
013600     EXEC SQL                                                     01360017
013700          INCLUDE TMIITEM                                         01370017
013800     END-EXEC.                                                    01380017
013900                                                                  01390017
014400     EXEC SQL                                                     01440017
014500          INCLUDE TINVOIC                                         01450017
014600     END-EXEC.                                                    01460017
014700                                                                  01470017
014800     EXEC SQL                                                     01480017
014900          INCLUDE TMDINVC                                         01490017
015000     END-EXEC.                                                    01500017
015100                                                                  01510017
015600     EXEC SQL                                                     01560017
015700          INCLUDE TVNDINV                                         01570017
015800     END-EXEC.                                                    01580017
015900                                                                  01590017
016000     EXEC SQL                                                     01600017
016100          INCLUDE TEXINVC                                         01610017
016200     END-EXEC.                                                    01620017
016300                                                                  01630017
016800 01  FILLER                        PIC X(25) VALUE                01680017
016900          '<====WS FOR APKUP055 ENDS'.                            01690017
017000                                                                  01700017
017100*LINKAGE SECTION.                                                 01710017
017200                                                                  01720017
017300                                                                  01730017
017400 PROCEDURE DIVISION.                                              01740017
017500                                                                  01750017
017600 A100-MAINLINE.                                                   01760017
017700                                                                  01770017
017800     PERFORM B100-HOUSEKEEPING.                                   01780017
017900     PERFORM B200-PROCESSING UNTIL WS-END-OF-INPUT.               01790017
018000                                                                  01800017
018100     PERFORM B300-END-OF-JOB.                                     01810017
018200                                                                  01820017
018300     GOBACK.                                                      01830017
018400        EJECT                                                     01840017
018600                                                                  01860022
018700***************************************************************** 01870017
018800*    PERFORM ALL OF THE DATE AND FILE OPENING ROUTINES          * 01880017
018900***************************************************************** 01890017
019010 B100-HOUSEKEEPING.                                               01901022
019020                                                                  01902022
019100     OPEN  INPUT   TDELETE-FILE.                                  01910017
019200                                                                  01920017
019300     INITIALIZE DCLTINVCTM                                        01930017
019400                DCLTALCHRG                                        01940017
019500                DCLTMIITEM                                        01950017
019600                DCLTPREQIT                                        01960017
019700                DCLTMDINVC                                        01970017
019800                DCLTINVOIC                                        01980017
020000                DCLTVNDINV                                        02000017
020110                DCLTEXINVC.                                       02011026
020200                                                                  02020017
020300     PERFORM R100-READ-INVOIC.                                    02030022
020310                                                                  02031022
020400     IF WS-END-OF-INPUT                                           02040023
020500         DISPLAY '**********************************'             02050017
020600         DISPLAY '*   EMPTY INVOICE FILE           *'             02060017
020700         DISPLAY '*   PROGRAM ** = APKUP055        *'             02070017
020800         DISPLAY '**********************************'             02080017
020900     END-IF.                                                      02090017
021000                                                                  02100017
021300***************************************************************** 02130017
021400*     DELETE DATA FROM INVOICE TABLES THAT MATCH INPUT          * 02140022
021500*     PAYT-REQ-SEQ-NBR OR PO-NBR, INVC-ID COMBINATION.          * 02150022
021600***************************************************************** 02160017
021610 B200-PROCESSING.                                                 02161022
021700                                                                  02170022
022000     MOVE AP067-PAYT-REQ-SEQ-NBR TO PREQIT-PAYT-REQ-SEQ-NBR       02200026
022100                                    MIITEM-PAYT-REQ-SEQ-NBR       02210017
022200                                    VNDINV-PAYT-REQ-SEQ-NBR       02220017
022300                                    MDINVC-PAYT-REQ-SEQ-NBR       02230017
022400                                    INVOIC-PAYT-REQ-SEQ-NBR       02240017
022700                                    EXINVC-PAYT-REQ-SEQ-NBR.      02270026
022900                                                                  02290017
022910     MOVE AP067-PO-NBR           TO INVOIC-PO-NBR                 02291021
022920                                    MDINVC-PO-NBR                 02292021
022930                                    EXINVC-PO-NBR                 02293021
022931                                    INVCTM-PO-NBR                 02293126
022932                                    ALCHRG-PO-NBR.                02293232
022940                                                                  02294021
022950     MOVE AP067-INVC-ID          TO INVOIC-INVC-ID                02295021
022960                                    MDINVC-INVC-ID                02296021
022961                                    INVCTM-INVC-ID                02296126
022962                                    ALCHRG-INVC-ID                02296226
022970                                    EXINVC-INVC-ID.               02297021
022980                                                                  02298021
023000     PERFORM D100-DELETE-TINVCTM.                                 02300021
023100     PERFORM D150-DELETE-TALCHRG.                                 02310021
023500                                                                  02350017
023600     IF AP067-INVC-TYP-CDE = 'MI' OR 'RI' OR 'WO'                 02360017
023700        PERFORM D350-DELETE-TVNDINV                               02370017
023800        PERFORM D400-DELETE-TMIITEM                               02380017
023900        PERFORM D450-DELETE-TPREQIT                               02390017
024100        PERFORM D550-DELETE-TMDINVC                               02410017
024200     ELSE                                                         02420017
024300        IF AP067-INVC-TYP-CDE = 'EI'                              02430017
024400           PERFORM D600-DELETE-TEXINVC                            02440017
024500        ELSE                                                      02450017
024600           CONTINUE                                               02460017
024700        END-IF                                                    02470017
024800     END-IF.                                                      02480017
024900                                                                  02490017
024910     PERFORM D250-DELETE-TINVOIC.                                 02491021
024920                                                                  02492021
025000***************************************************************** 02500017
025100*     COMMIT DATA AFTER EVERY 100 INPUT KEYS                    * 02510017
025200***************************************************************** 02520017
025300     IF WS-INPUT-REC-CNT(5:2) = '00'                              02530017
025400        PERFORM C100-COMMIT.                                      02540017
025500                                                                  02550017
025600     PERFORM R100-READ-INVOIC.                                    02560017
025700                                                                  02570017
026000***************************************************************** 02600017
026100*     FINISH THE ERROR PROCESS, REPORT ON NECESSARY TOTALS,       02610017
026200*     AND CLOSE ALL FILES                                         02620017
026300***************************************************************** 02630017
026310 B300-END-OF-JOB.                                                 02631022
026400                                                                  02640022
026500     MOVE WS-INPUT-REC-CNT            TO  WS-INPUT-REC-CNT-DISP.  02650017
026600     DISPLAY 'INPUT PAYT-REQ-SEQ-NBRS = ' WS-INPUT-REC-CNT-DISP.  02660017
026700     MOVE WS-INVCTM-DEL-CNT           TO  WS-DELETE-CNT-DISP      02670017
026800     DISPLAY 'TINVCTM ROWS DELETED    = ' WS-DELETE-CNT-DISP.     02680017
026900     MOVE WS-ALCHRG-DEL-CNT           TO  WS-DELETE-CNT-DISP      02690017
027000     DISPLAY 'TALCHRG ROWS DELETED    = ' WS-DELETE-CNT-DISP.     02700017
027100     MOVE WS-VNDINV-DEL-CNT           TO  WS-DELETE-CNT-DISP      02710017
027200     DISPLAY 'TVNDINV ROWS DELETED    = ' WS-DELETE-CNT-DISP.     02720017
027300     MOVE WS-MIITEM-DEL-CNT           TO  WS-DELETE-CNT-DISP      02730017
027400     DISPLAY 'TMIITEM ROWS DELETED    = ' WS-DELETE-CNT-DISP.     02740017
027500     MOVE WS-PREQIT-DEL-CNT           TO  WS-DELETE-CNT-DISP      02750017
027600     DISPLAY 'TPREQIT ROWS DELETED    = ' WS-DELETE-CNT-DISP.     02760017
027900     MOVE WS-MDINVC-DEL-CNT           TO  WS-DELETE-CNT-DISP      02790017
028000     DISPLAY 'TMDINVC ROWS DELETED    = ' WS-DELETE-CNT-DISP.     02800017
028100     MOVE WS-INVOIC-DEL-CNT           TO  WS-DELETE-CNT-DISP      02810017
028200     DISPLAY 'TINVOIC ROWS DELETED    = ' WS-DELETE-CNT-DISP.     02820017
028500     MOVE WS-EXINVC-DEL-CNT           TO  WS-DELETE-CNT-DISP      02850017
028600     DISPLAY 'TEXINVC ROWS DELETED    = ' WS-DELETE-CNT-DISP.     02860017
028900                                                                  02890017
029000     CLOSE TDELETE-FILE.                                          02900017
029100                                                                  02910017
029200 C100-COMMIT.                                                     02920017
029300     EXEC SQL                                                     02930017
029400         COMMIT                                                   02940017
029500     END-EXEC.                                                    02950017
029600                                                                  02960017
029700     EVALUATE TRUE                                                02970017
029800         WHEN SQLCODE = ZEROS                                     02980017
029900             CONTINUE                                             02990017
030000         WHEN OTHER                                               03000017
030100             MOVE 'C100-COMMIT                  '                 03010017
030200                            TO WS-ABEND-PARAGRAPH                 03020017
030300             MOVE 'UNSUCCESSFUL COMMIT        '                   03030017
030400                           TO WS-ABEND-OPERATION                  03040017
030500             MOVE '        ' TO WS-ABEND-STRUCTURE-1              03050019
030600             MOVE '        ' TO WS-ABEND-STRUCTURE-2              03060017
030700             PERFORM Z999-SQL-ERROR                               03070017
030800     END-EVALUATE.                                                03080017
030900                                                                  03090017
031000 D100-DELETE-TINVCTM.                                             03100017
031100                                                                  03110017
031200     PERFORM WITH TEST AFTER                                      03120017
031300        VARYING WS-RETRY-COUNTER FROM 1 BY 1                      03130017
031400        UNTIL   WS-RETRY-COUNTER > WS-RETRY-MAX OR                03140017
031500                SQLCODE = ZERO OR                                 03150017
031600                SQLCODE = +100                                    03160017
031700        EXEC SQL                                                  03170017
031800               DELETE                                             03180017
031900               FROM                                               03190017
032000                    TINVCTM                                       03200017
032100               WHERE PO_NBR  = :INVCTM-PO-NBR                     03210026
032110                 AND INVC_ID = :INVCTM-INVC-ID                    03211026
032200        END-EXEC                                                  03220017
032300                                                                  03230017
032400        EVALUATE TRUE                                             03240017
032500            WHEN SQLCODE = ZERO                                   03250017
032600                 ADD +1 TO WS-INVCTM-DEL-CNT                      03260017
032700            WHEN SQLCODE = +100                                   03270017
032800                 CONTINUE                                         03280017
032900            WHEN SQLCODE = -904                                   03290017
033000            WHEN SQLCODE = -913                                   03300017
033100              CONTINUE                                            03310017
033200            WHEN SQLWARN0 NOT = SPACES                            03320017
033300            WHEN SQLCODE  NOT = ZERO                              03330017
033400              MOVE 'D100-DELETE-TINVCTM          '                03340017
033500                            TO WS-ABEND-PARAGRAPH                 03350017
033600              MOVE 'UNSUCCESSFUL DELETE TINVCTM'                  03360019
033700                            TO WS-ABEND-OPERATION                 03370017
033800              MOVE 'TINVCTM ' TO WS-ABEND-STRUCTURE-1             03380017
033900              MOVE '        ' TO WS-ABEND-STRUCTURE-2             03390017
033910              DISPLAY 'PO-NBR = '  INVCTM-PO-NBR                  03391030
033911              DISPLAY 'INVOICE = ' INVCTM-INVC-ID                 03391130
034000              PERFORM Z999-SQL-ERROR                              03400017
034100           END-EVALUATE                                           03410017
034200     END-PERFORM.                                                 03420017
034300                                                                  03430017
034400     IF WS-RETRY-COUNTER > WS-RETRY-MAX                           03440017
034500         MOVE 'D100-DELETE-TINVCTM          '                     03450017
034600                       TO WS-ABEND-PARAGRAPH                      03460017
034700         MOVE 'MAX RETRIES EXCEEDED ON DELETE TINVCTM'            03470019
034800                         TO WS-ABEND-OPERATION                    03480017
034900         PERFORM Z999-SQL-ERROR                                   03490017
035000     END-IF.                                                      03500017
035100                                                                  03510017
035200 D150-DELETE-TALCHRG.                                             03520017
035300                                                                  03530017
035400     PERFORM WITH TEST AFTER                                      03540017
035500        VARYING WS-RETRY-COUNTER FROM 1 BY 1                      03550017
035600        UNTIL   WS-RETRY-COUNTER > WS-RETRY-MAX OR                03560017
035700                SQLCODE = ZERO OR                                 03570017
035800                SQLCODE = +100                                    03580017
035900        EXEC SQL                                                  03590017
036000               DELETE                                             03600017
036100               FROM                                               03610017
036200                    TALCHRG                                       03620017
036300               WHERE PO_NBR  = :ALCHRG-PO-NBR                     03630026
036310                 AND INVC_ID = :ALCHRG-INVC-ID                    03631026
036400        END-EXEC                                                  03640017
036500                                                                  03650017
036600        EVALUATE TRUE                                             03660017
036700            WHEN SQLCODE = ZERO                                   03670017
036800                 ADD +1 TO WS-ALCHRG-DEL-CNT                      03680017
036900            WHEN SQLCODE = +100                                   03690017
037000                 CONTINUE                                         03700017
037100            WHEN SQLCODE = -904                                   03710017
037200            WHEN SQLCODE = -913                                   03720017
037300              CONTINUE                                            03730017
037400            WHEN SQLWARN0 NOT = SPACES                            03740017
037500            WHEN SQLCODE  NOT = ZERO                              03750017
037600              MOVE 'D150-DELETE-TALCHRG          '                03760017
037700                            TO WS-ABEND-PARAGRAPH                 03770017
037800              MOVE 'UNSUCCESSFUL DELETE TALCHRG'                  03780019
037900                            TO WS-ABEND-OPERATION                 03790017
038000              MOVE 'TALCHRG ' TO WS-ABEND-STRUCTURE-1             03800017
038100              MOVE '        ' TO WS-ABEND-STRUCTURE-2             03810017
038110              DISPLAY 'PO-NBR = '  ALCHRG-PO-NBR                  03811030
038111              DISPLAY 'INVOICE = ' ALCHRG-INVC-ID                 03811130
038200              PERFORM Z999-SQL-ERROR                              03820017
038300           END-EVALUATE                                           03830017
038400     END-PERFORM.                                                 03840017
038500                                                                  03850017
038600     IF WS-RETRY-COUNTER > WS-RETRY-MAX                           03860017
038700         MOVE 'D150-DELETE-TALCHRG          '                     03870017
038800                       TO WS-ABEND-PARAGRAPH                      03880017
038900         MOVE 'MAX RETRIES EXCEEDED ON DELETE TALCHRG'            03890019
039000                         TO WS-ABEND-OPERATION                    03900017
039100         PERFORM Z999-SQL-ERROR                                   03910017
039200     END-IF.                                                      03920017
039300                                                                  03930017
043600 D250-DELETE-TINVOIC.                                             04360017
043700                                                                  04370017
043800     PERFORM WITH TEST AFTER                                      04380017
043900        VARYING WS-RETRY-COUNTER FROM 1 BY 1                      04390017
044000        UNTIL   WS-RETRY-COUNTER > WS-RETRY-MAX OR                04400017
044100                SQLCODE = ZERO OR                                 04410017
044200                SQLCODE = +100                                    04420017
044300        EXEC SQL                                                  04430017
044400               DELETE                                             04440017
044500               FROM                                               04450017
044600                    TINVOIC                                       04460017
044700               WHERE PO_NBR   = :INVOIC-PO-NBR                    04470021
044710                 AND INVC_ID  = :INVOIC-INVC-ID                   04471021
044800        END-EXEC                                                  04480017
044900                                                                  04490017
045000        EVALUATE TRUE                                             04500017
045100            WHEN SQLCODE = ZERO                                   04510017
045200                 ADD +1 TO WS-INVOIC-DEL-CNT                      04520017
045300            WHEN SQLCODE = +100                                   04530017
045400                 CONTINUE                                         04540017
045500            WHEN SQLCODE = -904                                   04550017
045600            WHEN SQLCODE = -913                                   04560017
045700              CONTINUE                                            04570017
045800            WHEN SQLWARN0 NOT = SPACES                            04580017
045900            WHEN SQLCODE  NOT = ZERO                              04590017
046000              MOVE 'D250-DELETE-TINVOIC          '                04600019
046100                            TO WS-ABEND-PARAGRAPH                 04610017
046200              MOVE 'UNSUCCESSFUL DELETE TINVOIC'                  04620019
046300                            TO WS-ABEND-OPERATION                 04630017
046400              MOVE 'TINVOIC ' TO WS-ABEND-STRUCTURE-1             04640019
046500              MOVE '        ' TO WS-ABEND-STRUCTURE-2             04650017
046510              DISPLAY 'PO-NBR = ' INVOIC-PO-NBR                   04651021
046520              DISPLAY 'INVC-ID = ' INVOIC-INVC-ID                 04652021
046600              PERFORM Z999-SQL-ERROR                              04660017
046700           END-EVALUATE                                           04670017
046800     END-PERFORM.                                                 04680017
046900                                                                  04690017
047000     IF WS-RETRY-COUNTER > WS-RETRY-MAX                           04700017
047100         MOVE 'D250-DELETE-TINVOIC          '                     04710019
047200                       TO WS-ABEND-PARAGRAPH                      04720017
047300         MOVE 'MAX RETRIES EXCEEDED ON DELETE TINVOIC'            04730019
047400                         TO WS-ABEND-OPERATION                    04740017
047500         PERFORM Z999-SQL-ERROR                                   04750017
047600     END-IF.                                                      04760017
047700                                                                  04770017
052000 D350-DELETE-TVNDINV.                                             05200017
052100                                                                  05210017
052200     PERFORM WITH TEST AFTER                                      05220017
052300        VARYING WS-RETRY-COUNTER FROM 1 BY 1                      05230017
052400        UNTIL   WS-RETRY-COUNTER > WS-RETRY-MAX OR                05240017
052500                SQLCODE = ZERO OR                                 05250017
052600                SQLCODE = +100                                    05260017
052700        EXEC SQL                                                  05270017
052800               DELETE                                             05280017
052900               FROM                                               05290017
053000                    TVNDINV                                       05300017
053100               WHERE PAYT_REQ_SEQ_NBR = :VNDINV-PAYT-REQ-SEQ-NBR  05310017
053200        END-EXEC                                                  05320017
053300                                                                  05330017
053400        EVALUATE TRUE                                             05340017
053500            WHEN SQLCODE = ZERO                                   05350017
053600                 ADD +1 TO WS-VNDINV-DEL-CNT                      05360017
053700            WHEN SQLCODE = +100                                   05370017
053800                 CONTINUE                                         05380017
053900            WHEN SQLCODE = -904                                   05390017
054000            WHEN SQLCODE = -913                                   05400017
054100              CONTINUE                                            05410017
054200            WHEN SQLWARN0 NOT = SPACES                            05420017
054300            WHEN SQLCODE  NOT = ZERO                              05430017
054400              MOVE 'D350-DELETE-TVNDINV          '                05440019
054500                            TO WS-ABEND-PARAGRAPH                 05450017
054600              MOVE 'UNSUCCESSFUL DELETE TVNDINV'                  05460019
054700                            TO WS-ABEND-OPERATION                 05470017
054800              MOVE 'TVNDINV ' TO WS-ABEND-STRUCTURE-1             05480019
054900              MOVE '        ' TO WS-ABEND-STRUCTURE-2             05490017
054910              DISPLAY 'PAYT-REQ-SEQ-NBR = '                       05491020
054920                              VNDINV-PAYT-REQ-SEQ-NBR             05492020
055000              PERFORM Z999-SQL-ERROR                              05500017
055100           END-EVALUATE                                           05510017
055200     END-PERFORM.                                                 05520017
055300                                                                  05530017
055400     IF WS-RETRY-COUNTER > WS-RETRY-MAX                           05540017
055500         MOVE 'D350-DELETE-TVNDINV          '                     05550019
055600                       TO WS-ABEND-PARAGRAPH                      05560017
055700         MOVE 'MAX RETRIES EXCEEDED ON DELETE TVNDINV'            05570019
055800                         TO WS-ABEND-OPERATION                    05580017
055900         PERFORM Z999-SQL-ERROR                                   05590017
056000     END-IF.                                                      05600017
056100                                                                  05610017
056200 D400-DELETE-TMIITEM.                                             05620017
056300                                                                  05630017
056400     PERFORM WITH TEST AFTER                                      05640017
056500        VARYING WS-RETRY-COUNTER FROM 1 BY 1                      05650017
056600        UNTIL   WS-RETRY-COUNTER > WS-RETRY-MAX OR                05660017
056700                SQLCODE = ZERO OR                                 05670017
056800                SQLCODE = +100                                    05680017
056900        EXEC SQL                                                  05690017
057000               DELETE                                             05700017
057100               FROM                                               05710017
057200                    TMIITEM                                       05720017
057300               WHERE PAYT_REQ_SEQ_NBR = :MIITEM-PAYT-REQ-SEQ-NBR  05730017
057400        END-EXEC                                                  05740017
057500                                                                  05750017
057600        EVALUATE TRUE                                             05760017
057700            WHEN SQLCODE = ZERO                                   05770017
057800                 ADD +1 TO WS-MIITEM-DEL-CNT                      05780017
057900            WHEN SQLCODE = +100                                   05790017
058000                 CONTINUE                                         05800017
058100            WHEN SQLCODE = -904                                   05810017
058200            WHEN SQLCODE = -913                                   05820017
058300              CONTINUE                                            05830017
058400            WHEN SQLWARN0 NOT = SPACES                            05840017
058500            WHEN SQLCODE  NOT = ZERO                              05850017
058600              MOVE 'D400-DELETE-TMIITEM          '                05860019
058700                            TO WS-ABEND-PARAGRAPH                 05870017
058800              MOVE 'UNSUCCESSFUL DELETE TMIITEM'                  05880019
058900                            TO WS-ABEND-OPERATION                 05890017
059000              MOVE 'TMIITEM ' TO WS-ABEND-STRUCTURE-1             05900019
059100              MOVE '        ' TO WS-ABEND-STRUCTURE-2             05910017
059110              DISPLAY 'PAYT-REQ-SEQ-NBR = '                       05911020
059120                              MIITEM-PAYT-REQ-SEQ-NBR             05912020
059200              PERFORM Z999-SQL-ERROR                              05920017
059300           END-EVALUATE                                           05930017
059400     END-PERFORM.                                                 05940017
059500                                                                  05950017
059600     IF WS-RETRY-COUNTER > WS-RETRY-MAX                           05960017
059700         MOVE 'D400-DELETE-TMIITEM          '                     05970019
059800                       TO WS-ABEND-PARAGRAPH                      05980017
059900         MOVE 'MAX RETRIES EXCEEDED ON DELETE TMIITEM'            05990019
060000                         TO WS-ABEND-OPERATION                    06000017
060100         PERFORM Z999-SQL-ERROR                                   06010017
060200     END-IF.                                                      06020017
060300                                                                  06030017
060400 D450-DELETE-TPREQIT.                                             06040017
060500                                                                  06050017
060600     PERFORM WITH TEST AFTER                                      06060017
060700        VARYING WS-RETRY-COUNTER FROM 1 BY 1                      06070017
060800        UNTIL   WS-RETRY-COUNTER > WS-RETRY-MAX OR                06080017
060900                SQLCODE = ZERO OR                                 06090017
061000                SQLCODE = +100                                    06100017
061100        EXEC SQL                                                  06110017
061200               DELETE                                             06120017
061300               FROM                                               06130017
061400                    TPREQIT                                       06140017
061500               WHERE PAYT_REQ_SEQ_NBR = :PREQIT-PAYT-REQ-SEQ-NBR  06150017
061600        END-EXEC                                                  06160017
061700                                                                  06170017
061800        EVALUATE TRUE                                             06180017
061900            WHEN SQLCODE = ZERO                                   06190017
062000                 ADD +1 TO WS-PREQIT-DEL-CNT                      06200017
062100            WHEN SQLCODE = +100                                   06210017
062200                 CONTINUE                                         06220017
062300            WHEN SQLCODE = -904                                   06230017
062400            WHEN SQLCODE = -913                                   06240017
062500              CONTINUE                                            06250017
062600            WHEN SQLWARN0 NOT = SPACES                            06260017
062700            WHEN SQLCODE  NOT = ZERO                              06270017
062800              MOVE 'D450-DELETE-TPREQIT          '                06280019
062900                            TO WS-ABEND-PARAGRAPH                 06290017
063000              MOVE 'UNSUCCESSFUL DELETE TPREQIT'                  06300019
063100                            TO WS-ABEND-OPERATION                 06310017
063200              MOVE 'TPREQIT ' TO WS-ABEND-STRUCTURE-1             06320017
063300              MOVE '        ' TO WS-ABEND-STRUCTURE-2             06330017
063310              DISPLAY 'PAYT-REQ-SEQ-NBR = '                       06331020
063320                              PREQIT-PAYT-REQ-SEQ-NBR             06332020
063400              PERFORM Z999-SQL-ERROR                              06340017
063500           END-EVALUATE                                           06350017
063600     END-PERFORM.                                                 06360017
063700                                                                  06370017
063800     IF WS-RETRY-COUNTER > WS-RETRY-MAX                           06380017
063900         MOVE 'D450-DELETE-TPREQIT          '                     06390019
064000                       TO WS-ABEND-PARAGRAPH                      06400017
064100         MOVE 'MAX RETRIES EXCEEDED ON DELETE TPREQIT'            06410019
064200                         TO WS-ABEND-OPERATION                    06420017
064300         PERFORM Z999-SQL-ERROR                                   06430017
064400     END-IF.                                                      06440017
064500                                                                  06450017
068800 D550-DELETE-TMDINVC.                                             06880017
068900                                                                  06890017
069000     PERFORM WITH TEST AFTER                                      06900017
069100        VARYING WS-RETRY-COUNTER FROM 1 BY 1                      06910017
069200        UNTIL   WS-RETRY-COUNTER > WS-RETRY-MAX OR                06920017
069300                SQLCODE = ZERO OR                                 06930017
069400                SQLCODE = +100                                    06940017
069500        EXEC SQL                                                  06950017
069600               DELETE                                             06960017
069700               FROM                                               06970017
069800                    TMDINVC                                       06980017
069900               WHERE PO_NBR   = :MDINVC-PO-NBR                    06990021
069910                 AND INVC_ID  = :MDINVC-INVC-ID                   06991021
070000        END-EXEC                                                  07000017
070100                                                                  07010017
070200        EVALUATE TRUE                                             07020017
070300            WHEN SQLCODE = ZERO                                   07030017
070400                 ADD +1 TO WS-MDINVC-DEL-CNT                      07040017
070500            WHEN SQLCODE = +100                                   07050017
070600                 CONTINUE                                         07060017
070700            WHEN SQLCODE = -904                                   07070017
070800            WHEN SQLCODE = -913                                   07080017
070900              CONTINUE                                            07090017
071000            WHEN SQLWARN0 NOT = SPACES                            07100017
071100            WHEN SQLCODE  NOT = ZERO                              07110017
071200              MOVE 'D550-DELETE-TMDINVC          '                07120019
071300                            TO WS-ABEND-PARAGRAPH                 07130017
071400              MOVE 'UNSUCCESSFUL DELETE TMDINVC'                  07140019
071500                            TO WS-ABEND-OPERATION                 07150017
071600              MOVE 'TMDINVC ' TO WS-ABEND-STRUCTURE-1             07160019
071700              MOVE '        ' TO WS-ABEND-STRUCTURE-2             07170017
071701              DISPLAY 'PO-NBR = ' MDINVC-PO-NBR                   07170121
071702              DISPLAY 'INVC-ID = ' MDINVC-INVC-ID                 07170221
071800              PERFORM Z999-SQL-ERROR                              07180017
071900           END-EVALUATE                                           07190017
072000     END-PERFORM.                                                 07200017
072100                                                                  07210017
072200     IF WS-RETRY-COUNTER > WS-RETRY-MAX                           07220017
072300         MOVE 'D550-DELETE-TMDINVC          '                     07230019
072400                       TO WS-ABEND-PARAGRAPH                      07240017
072500         MOVE 'MAX RETRIES EXCEEDED ON DELETE TMDINVC'            07250019
072600                         TO WS-ABEND-OPERATION                    07260017
072700         PERFORM Z999-SQL-ERROR                                   07270017
072800     END-IF.                                                      07280017
072900                                                                  07290017
073000 D600-DELETE-TEXINVC.                                             07300017
073100                                                                  07310017
073200     PERFORM WITH TEST AFTER                                      07320017
073300        VARYING WS-RETRY-COUNTER FROM 1 BY 1                      07330017
073400        UNTIL   WS-RETRY-COUNTER > WS-RETRY-MAX OR                07340017
073500                SQLCODE = ZERO OR                                 07350017
073600                SQLCODE = +100                                    07360017
073700        EXEC SQL                                                  07370017
073800               DELETE                                             07380017
073900               FROM                                               07390017
074000                    TEXINVC                                       07400017
074100               WHERE PO_NBR   = :EXINVC-PO-NBR                    07410021
074110                 AND INVC_ID  = :EXINVC-INVC-ID                   07411021
074200        END-EXEC                                                  07420017
074300                                                                  07430017
074400        EVALUATE TRUE                                             07440017
074500            WHEN SQLCODE = ZERO                                   07450017
074600                 ADD +1 TO WS-EXINVC-DEL-CNT                      07460017
074700            WHEN SQLCODE = +100                                   07470017
074800                 CONTINUE                                         07480017
074900            WHEN SQLCODE = -904                                   07490017
075000            WHEN SQLCODE = -913                                   07500017
075100              CONTINUE                                            07510017
075200            WHEN SQLWARN0 NOT = SPACES                            07520017
075300            WHEN SQLCODE  NOT = ZERO                              07530017
075400              MOVE 'D600-DELETE-TEXINVC          '                07540019
075500                            TO WS-ABEND-PARAGRAPH                 07550017
075600              MOVE 'UNSUCCESSFUL DELETE TEXINVC'                  07560019
075700                            TO WS-ABEND-OPERATION                 07570017
075800              MOVE 'TEXINVC ' TO WS-ABEND-STRUCTURE-1             07580017
075900              MOVE '        ' TO WS-ABEND-STRUCTURE-2             07590017
075901              DISPLAY 'PO-NBR = ' EXINVC-PO-NBR                   07590121
075902              DISPLAY 'INVC-ID = ' EXINVC-INVC-ID                 07590221
076000              PERFORM Z999-SQL-ERROR                              07600017
076100           END-EVALUATE                                           07610017
076200     END-PERFORM.                                                 07620017
076300                                                                  07630017
076400     IF WS-RETRY-COUNTER > WS-RETRY-MAX                           07640017
076500         MOVE 'D600-DELETE-TEXINVC          '                     07650019
076600                       TO WS-ABEND-PARAGRAPH                      07660017
076700         MOVE 'MAX RETRIES EXCEEDED ON DELETE TEXINVC'            07670019
076800                         TO WS-ABEND-OPERATION                    07680017
076900         PERFORM Z999-SQL-ERROR                                   07690017
077000     END-IF.                                                      07700017
077100                                                                  07710017
077200 R100-READ-INVOIC.                                                07720017
077300                                                                  07730017
077400     READ TDELETE-FILE INTO AP067-RECORD                          07740017
077500          AT END SET WS-END-OF-INPUT TO TRUE.                     07750017
077600                                                                  07760017
077700     IF NOT WS-END-OF-INPUT                                       07770017
077800        ADD 1 TO WS-INPUT-REC-CNT.                                07780017
077900                                                                  07790017
078300***************************************************************** 07830017
078400*     PROCESS DB2 ABENDS                                          07840017
078500***************************************************************** 07850017
078510 Z999-SQL-ERROR.                                                  07851022
078600                                                                  07860022
078700     DISPLAY '*** DB2 ERROR '.                                    07870017
078800     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 07880017
078900     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               07890017
079000     DISPLAY '*** OPERATION = ' WS-ABEND-OPERATION.               07900017
079100     DISPLAY '*** TABLE 1   = ' WS-ABEND-STRUCTURE-1.             07910017
079200     IF WS-ABEND-STRUCTURE-2 > SPACES                             07920017
079300         DISPLAY '*** TABLE 2   = ' WS-ABEND-STRUCTURE-2.         07930017
079400                                                                  07940017
079500     MOVE +4013                    TO ABEND-CODE.                 07950017
079600                                                                  07960017
079700     COPY DPPD004.                                                07970017
079800     CALL 'ILBOABN0' USING ABEND-CODE.                            07980017
079900                                                                  07990017
