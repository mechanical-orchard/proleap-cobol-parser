000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     APKUT032.                                        00020000
000300 AUTHOR.         JEAN KURK.                                       00030000
000400 DATE-WRITTEN.   10/26/2022.                                      00040000
000500 DATE-COMPILED.                                                   00050000
000600*----------------------------------------------------------------*00060000
000700*    CREATE DETAIL FILE OF SEPHORA NON-INVOICED RECEIPTS         *00070000
000900*                                                                *00090000
001000*    SELECTION OF ALL SEPHORA ENTRIES ON THE NON-INVOICED        *00101000
001000*    RECEIPTS TABLE THAT ARE UNMATCHED AS OF THE RUN DATE.       *00101100
001200*    DOLLARS ARE SUMMED BY VENDOR/DEPT/PO/CREATE DATE.           *00103000
001300*                                                                *00106000
001400* INPUT:                                                         *00107000
001500*  1. AP NONINVOICED RECEIPTS TABLE      (TNINREC)               *00108000
001600*  2. LOGISTICS PO HEADER TABLE          (TPURCHS)               *00109000
001600*  3. RECEIVER TABLE                     (TRECEIV)               *00109109
001600*  4. RECEIPT DISTRIBUTION TABLE         (TRECDIS)               *00109209
001600*  5. PO ITEM TABLE                      (TPURITM)               *00109309
001700*  6. EXTERNAL ENTITY ID TABLE           (TEXTENT)               *00110009
001710*  7. VENDOR CAPABILITIES - VND_VNT_CPBL (VNT00001)              *00121009
001710*  8. MERCHANDISE AREA                   (TMDSEAR)               *00122009
001800*                                                                *00123000
001900* OUTPUT:                                                        *00124000
002000*  1. UNUSED NON-INVOICED RECEIPTS FILE FOR SEPHORA              *00125000
002100*                                                                *00126000
002300*----------------------------------------------------------------*00127000
002400*                                                                *00128000
002500* CHANGE LOG:                                                    *00129000
002600* DATE  10/26/2022                                               *00130000
002610*     CHANGE MADE: INITIAL VERSION.                              *00140000
002620*     MADE BY: JEAN KURK               WR/IR #: CHG0277408       *00150000
002630*                                                                *00160000
002700*----------------------------------------------------------------*00170000
002800                                                                  00180001
002900 ENVIRONMENT DIVISION.                                            00190000
003000 CONFIGURATION SECTION.                                           00200000
003100 SOURCE-COMPUTER.    IBM-3090.                                    00210000
003200 OBJECT-COMPUTER.    IBM-3090.                                    00220000
003300                                                                  00230000
003400 INPUT-OUTPUT SECTION.                                            00240000
003500 FILE-CONTROL.                                                    00250000
003600     SELECT UNUSED-NIR-RPT-FILE ASSIGN TO UT-S-OUT01.             00260000
003700                                                                  00270001
003800 DATA DIVISION.                                                   00280000
003900 FILE SECTION.                                                    00290000
004000                                                                  00300000
004100 FD  UNUSED-NIR-RPT-FILE                                          00310000
004200     RECORDING MODE IS F                                          00320000
004300     LABEL RECORDS ARE STANDARD.                                  00330000
004600 01  UNUSED-NIR-RPT-REC               PIC X(70).                  00340013
004800                                                                  00350000
004900                                                                  00360001
005000 WORKING-STORAGE SECTION.                                         00370000
005100                                                                  00380000
005200 01  PV-PROGRAM-VARIABLES.                                        00390000
005300     05  FILLER                  PIC  X(30)  VALUE                00400000
005400         '** BEGINING OF APKUT032 W/S **'.                        00410000
005500     05  PV-CURRENT-PARAGRAPH    PIC  X(35).                      00420000
005600     05  PV-PROGRAM-NAME         PIC  X(08)  VALUE 'APKUT032'.    00430000
005610     05  HOLD-ENT-ID             PIC S9(09)  VALUE 0.             00440000
091000     05  DK-PO-NBR                    PIC S9(09) VALUE +0         00462000
091100                                                 COMP.            00463000
091000     05  DK-PO-LNE-NBR                PIC S9(09) VALUE +0         00464000
091100                                                 COMP.            00465000
005620     05  HEADER-REC              PIC X(54) VALUE                  00466000
031000           'PO,STORE,SKU,DEPT,QTY,COST,VENDOR,RECVD DT'.          00467005
006600                                                                  00468000
006700 01  PS-PROGRAM-SWITCHES.                                         00469000
006800     05  PS-OUT-OF-VENDORS-SW        PIC X(01) VALUE 'M'.         00470000
006900         88  OUT-OF-VENDORS                    VALUE 'O'.         00480000
007000         88  MORE-VENDORS                      VALUE 'M'.         00490000
007200                                                                  00500000
007300 01  PC-PROGRAM-COUNTERS.                                         00510000
008000     05  PC-WRITE-COUNT          PIC S9(09)  VALUE 0              00520000
008100                                             COMP-3.              00530000
008400     05  PC-UNUSED-NIR-COUNT     PIC S9(05)  VALUE ZERO           00540000
008500                                             COMP-3.              00550000
013100                                                                  00560001
013200*----------------------------------------------------------------*00570000
013300*  COMMUNICATIONS AREA2 FOR DB2                                  *00580000
013400*----------------------------------------------------------------*00590000
013500     COPY SQLCA2.                                                 00600000
013700                                                                  00620000
013800     EXEC SQL                                                     00630000
013900          INCLUDE SQLCA                                           00640000
014000     END-EXEC.                                                    00650000
014100                                                                  00660001
014200*----------------------------------------------------------------*00670000
014300*  ACCOUNTS PAYABLE NON-INVOICED RECEIPTS TABLE                  *00680000
014400*----------------------------------------------------------------*00690000
014500     EXEC SQL                                                     00700000
014600          INCLUDE TNINREC                                         00710000
014700     END-EXEC.                                                    00720000
014800                                                                  00730001
014810*----------------------------------------------------------------*00740000
014820*  PURCHASE ORDER HEADER TABLE                                   *00750000
014830*----------------------------------------------------------------*00760000
014840     EXEC SQL                                                     00770000
014850          INCLUDE TPURCHS                                         00780000
014860     END-EXEC.                                                    00790000
014870                                                                  00800001
014810*----------------------------------------------------------------*00801001
014820*  RECEIVER TABLE                                                *00802001
014830*----------------------------------------------------------------*00803001
014840     EXEC SQL                                                     00804001
014850          INCLUDE TRECEIV                                         00805001
014860     END-EXEC.                                                    00806001
014870                                                                  00807001
014810*----------------------------------------------------------------*00807103
014820*  RECEIPT DISTRIBUTION TABLE                                    *00807203
014830*----------------------------------------------------------------*00807303
014840     EXEC SQL                                                     00807403
014850          INCLUDE TRECDIS                                         00807503
014860     END-EXEC.                                                    00807603
014870                                                                  00808001
014810*----------------------------------------------------------------*00809001
014820*  PURCHASE ORDER ITEM TABLE                                     *00809101
014830*----------------------------------------------------------------*00809201
014840     EXEC SQL                                                     00810000
014850          INCLUDE TPURITM                                         00820000
014860     END-EXEC.                                                    00821000
014870                                                                  00822001
015600*----------------------------------------------------------------*00830000
015700*  EXTERNAL ENTITY ID TABLE                                      *00840000
015800*----------------------------------------------------------------*00850000
015900     EXEC SQL                                                     00860000
016000          INCLUDE TEXTENT                                         00870000
016100     END-EXEC.                                                    00880000
016200                                                                  00890001
015600*----------------------------------------------------------------*00900000
015700*  VENDOR CAPABILITIES - VNT_VND_CPBL                            *00910000
015800*----------------------------------------------------------------*00920000
015900     EXEC SQL                                                     00930000
016000          INCLUDE VNT00001                                        00940000
016100     END-EXEC.                                                    00950000
016200                                                                  00960001
015600*----------------------------------------------------------------*00970000
015700*  MERCHANDISE AREA                                              *00980000
015800*----------------------------------------------------------------*00990000
015900     EXEC SQL                                                     01000000
016000          INCLUDE TMDSEAR                                         01010000
016100     END-EXEC.                                                    01020000
016200                                                                  01030001
066700*--------------------------------------------------------------*  01040000
066800* COPYBOOK FOR SEPHORA LOGIC                                   *  01050000
066900*--------------------------------------------------------------*  01060000
067000     COPY APWS021.                                                01070000
067100                                                                  01080000
030900 01  OUTPUT-STRUCTURE.                                            01090000
031000     05  OUT-PO-NBR                  PIC 9(9).                    01100000
031000     05  OUT-DELIM1                  PIC X(1).                    01110000
031000     05  OUT-STR-NBR                 PIC 9(4).                    01120000
031000     05  OUT-DELIM2                  PIC X(1).                    01130000
031000     05  OUT-SKU-NBR                 PIC 9(9).                    01140000
031000     05  OUT-DELIM3                  PIC X(1).                    01150000
031000     05  OUT-DEPT-NBR                PIC 9(3).                    01151000
031000     05  OUT-DELIM4                  PIC X(1).                    01152001
031000     05  OUT-QTY-VRFD                PIC 9(5).                    01153000
031000     05  OUT-DELIM5                  PIC X(1).                    01154001
031000     05  OUT-1ST-COST                PIC 9(5).999.                01155000
031000     05  OUT-DELIM6                  PIC X(1).                    01156001
031000     05  OUT-VENDOR                  PIC X(9).                    01157000
031000     05  OUT-DELIM7                  PIC X(1).                    01157101
031000     05  OUT-REC-DTE                 PIC X(10).                   01157201
067100                                                                  01158000
016300*----------------------------------------------------------------*01159000
016400*   UNUSED_NIR_CSR GETS ALL UNMATCHED ROWS ON THE TNINREC TABLE  *01160000
016500*----------------------------------------------------------------*01170000
016600     EXEC SQL                                                     01180000
016700       DECLARE UNUSED_NIR_CSR CURSOR FOR                          01190000
016800         SELECT                                                   01200000
016900                B.DEPT_NBR                                        01210000
017000              , B.PO_NBR                                          01220000
017000              , A.PO_LNE_NBR                                      01230000
017000              , B.ENT_ID                                          01240000
017300              , A.UNT_COST_AMT                                    01250000
017300              , A.NON_INVC_UNT_QTY                                01260000
017400              , A.STR_NBR                                         01270000
017400              , C.DUN_NBR                                         01280000
017500           FROM TNINREC A                                         01290000
017600              , TPURCHS B                                         01300000
017600              , TEXTENT C                                         01310000
017900          WHERE A.PO_NBR         = B.PO_NBR                       01320000
018000            AND B.VER_STATUS_CDE = 'A'                            01330000
018100            AND A.STATUS_CDE     = ' '                            01340000
018100            AND B.ENT_ID         = C.ENT_ID                       01350000
018250       ORDER BY B.ENT_ID                                          01360000
018270              , B.DEPT_NBR                                        01370000
018280              , B.PO_NBR                                          01380000
018280              , A.PO_LNE_NBR                                      01390000
018300     END-EXEC.                                                    01400000
018400                                                                  01410001
018500*----------------------------------------------------------------*01420000
018600*  ABEND DATA AREAS                                              *01430000
018700*----------------------------------------------------------------*01440000
018800 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          01450000
018900                                             COMP SYNC.           01460000
019000     88  AC-BAD-DATA                         VALUE +4003.         01470000
019100     88  AC-DB2-ERROR                        VALUE +4013.         01480000
019300                                                                  01490000
019400 01  ABEND-AREAS.                                                 01500000
019500     05  AA-ABEND-LIT            PIC  X(40)  VALUE                01510000
019600             '*****       ABEND'.                                 01520000
019700     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                01530000
019800             '*****   PROGRAM: APKUT032'.                         01540000
019900     05  AA-PARAGRAPH-LIT.                                        01550000
020000         10  FILLER              PIC  X(17)  VALUE                01560000
020100             '***** PARAGRAPH: '.                                 01570000
020200         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        01580000
020300     05  AA-MESSAGE-LINE.                                         01590000
020400         10  FILLER              PIC  X(06)  VALUE '*****'.       01600000
020500         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        01610000
020600     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                01620000
020700             '*****    DB2 ERROR'.                                01630000
020800     05  AA-DB2-OPERATION-LIT.                                    01640000
020900         10  FILLER              PIC  X(17)  VALUE                01650000
021000             '***** OPERATION: '.                                 01660000
021100         10  AA-DB2-OPERATION.                                    01670000
021200             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        01680000
021300             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        01690000
021400     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        01700000
021500     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        01710000
021600     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        01720000
021900                                                                  01740000
022000                                                                  01750000
022100     COPY DPWS004.                                                01760000
022200 01  FILLER                      PIC  X(25)  VALUE                01770000
022300     '** END OF APKUT032 W/S **'.                                 01780000
022400                                                                  01790000
022400                                                                  01791000
022500 PROCEDURE DIVISION.                                              01800000
022600 A100-MAIN.                                                       01810000
022700                                                                  01820000
022800     MOVE 'A100-MAIN' TO PV-CURRENT-PARAGRAPH.                    01830000
022900                                                                  01840000
023000     PERFORM B100-INITIALIZE.                                     01850000
023100                                                                  01860000
023200     PERFORM B200-CREATE-FILE                                     01870000
023300         UNTIL OUT-OF-VENDORS.                                    01880000
023400                                                                  01890000
023500     PERFORM B300-END-PROGRAM.                                    01900000
023600                                                                  01910000
023700     GOBACK.                                                      01920000
023800                                                                  01930001
023900*----------------------------------------------------------------*01940000
024000*    INITIALIZATION PROCESSING                                   *01950000
024100*    CALLED FROM A100-MAIN                                       *01960000
024200*----------------------------------------------------------------*01970000
024300 B100-INITIALIZE.                                                 01980000
024400                                                                  01990000
024500     MOVE 'B100-INITIALIZE' TO PV-CURRENT-PARAGRAPH.              02000000
024600                                                                  02010000
024700     OPEN OUTPUT UNUSED-NIR-RPT-FILE.                             02020000
038100     WRITE UNUSED-NIR-RPT-REC FROM HEADER-REC.                    02030000
024800                                                                  02040000
024900     INITIALIZE DCLTNINREC                                        02050000
025000                DCLTPURCHS                                        02060000
025010                DCLTEXTENT                                        02070000
025100                DCLTMDSEAR                                        02090000
025100                DCLVNT00001.                                      02100000
025200                                                                  02110000
129500*    GET SEPHORA DATA                                             02120000
129500     MOVE PV-PROGRAM-NAME      TO SA-PROGRAM-NAME.                02130000
129500     PERFORM S100-GET-SEPHORA-DEPT.                               02140000
026320                                                                  02150000
026400     PERFORM Y100-OPEN-UNUSED-NIR-CSR.                            02160000
026500     PERFORM R100-FETCH-UNUSED-NIR.                               02170000
026600                                                                  02180001
026700*----------------------------------------------------------------*02190000
026800*    MOVES DATA FROM THE DB2 TABLE AREAS TO THE REPORT.          *02200000
026900*    CALLED FROM A100-MAIN                                       *02210000
027000*----------------------------------------------------------------*02220000
027100 B200-CREATE-FILE.                                                02230000
027200                                                                  02240000
027300     MOVE 'B200-CREATE-FILE'          TO PV-CURRENT-PARAGRAPH.    02250001
027200                                                                  02260000
027300     IF PURCHS-ENT-ID NOT = HOLD-ENT-ID                           02270000
026522         MOVE PURCHS-ENT-ID           TO HOLD-ENT-ID              02280001
027400         MOVE PURCHS-ENT-ID           TO PV-ENT-ID                02290001
027400         MOVE PURCHS-DEPT-NBR         TO PV-DEPT-NBR              02300001
027400         PERFORM S500-CHECK-FOR-SEPHORA                           02310000
027400     END-IF.                                                      02320000
027400                                                                  02330000
216700     IF PS-SEPHORA-ALL                                            02340000
031000         MOVE PURCHS-PO-NBR            TO DK-PO-NBR               02350001
031000         MOVE NINREC-PO-LNE-NBR        TO DK-PO-LNE-NBR           02360001
043000         PERFORM R600-GET-SKU                                     02370000
043000         PERFORM R700-GET-RECV-DTE                                02371001
046600                                                                  02380000
031000         MOVE PURCHS-PO-NBR            TO OUT-PO-NBR              02381001
031000         MOVE ','                      TO OUT-DELIM1              02381101
031000         MOVE ','                      TO OUT-DELIM2              02381201
031000         MOVE ','                      TO OUT-DELIM3              02381301
031000         MOVE ','                      TO OUT-DELIM4              02381401
031000         MOVE ','                      TO OUT-DELIM5              02381501
031000         MOVE ','                      TO OUT-DELIM6              02381601
031000         MOVE ','                      TO OUT-DELIM7              02381701
031000         MOVE PURITM-RMS-PO-SKU-NBR    TO OUT-SKU-NBR             02381906
031000         MOVE NINREC-STR-NBR           TO OUT-STR-NBR             02382006
031000         MOVE PURCHS-DEPT-NBR          TO OUT-DEPT-NBR            02382106
028000         MOVE NINREC-UNT-COST-AMT      TO OUT-1ST-COST            02382206
031000         MOVE NINREC-NON-INVC-UNT-QTY  TO OUT-QTY-VRFD            02383000
031000         MOVE EXTENT-DUN-NBR           TO OUT-VENDOR              02384000
031000         MOVE RECEIV-REC-TMST (1:10)   TO OUT-REC-DTE             02384101
027300                                                                  02385000
028200         PERFORM W100-WRITE-UNUSED-NIR-FILE                       02386000
027300     END-IF.                                                      02387000
028500     PERFORM R100-FETCH-UNUSED-NIR.                               02388000
028600                                                                  02389001
028700*----------------------------------------------------------------*02390000
028800*    ENDING PROCESSING: DISPLAYS COUNT OF VENDORS AND CLOSES     *02400000
028900*    THE CURSOR AND FILES.                                       *02410000
029000*    CALLED FROM A100-MAIN                                       *02420000
029100*----------------------------------------------------------------*02430000
029200 B300-END-PROGRAM.                                                02440000
029300                                                                  02450000
029400     MOVE 'B300-END-PROGRAM' TO PV-CURRENT-PARAGRAPH.             02460000
029500                                                                  02470000
029600     DISPLAY 'VENDORS PROCESSED = ' PC-UNUSED-NIR-COUNT.          02480000
029600     DISPLAY 'RECORDS ON FILE   = ' PC-WRITE-COUNT.               02490000
029700                                                                  02500000
029810     PERFORM Y110-CLOSE-UNUSED-NIR-CSR.                           02510000
029900                                                                  02520000
030000     CLOSE UNUSED-NIR-RPT-FILE.                                   02530000
030100                                                                  02540001
030200*----------------------------------------------------------------*02550000
030300*    FETCH THE UNUSED NON-INVOICED RECEIPTS                       02560001
030600*----------------------------------------------------------------*02590000
030700 R100-FETCH-UNUSED-NIR.                                           02600000
030800                                                                  02610000
030900     MOVE 'R100-FETCH-UNUSED-NIR' TO PV-CURRENT-PARAGRAPH.        02620000
031000                                                                  02630000
031700     EXEC SQL                                                     02640000
031800         FETCH UNUSED_NIR_CSR                                     02650000
031900         INTO                                                     02660000
032200             :PURCHS-DEPT-NBR                                     02670000
032300            ,:PURCHS-PO-NBR                                       02680000
032300            ,:NINREC-PO-LNE-NBR                                   02690000
032300            ,:PURCHS-ENT-ID                                       02700000
032401            ,:NINREC-UNT-COST-AMT                                 02710000
032401            ,:NINREC-NON-INVC-UNT-QTY                             02720000
032410            ,:NINREC-STR-NBR                                      02730000
032410            ,:EXTENT-DUN-NBR                                      02740000
032500     END-EXEC.                                                    02750008
032600                                                                  02760000
032700     EVALUATE TRUE                                                02770000
032800         WHEN SQLCODE = ZERO                                      02780000
032810              ADD 1 TO PC-UNUSED-NIR-COUNT                        02790000
032900         WHEN SQLCODE = +100                                      02800000
033000              SET OUT-OF-VENDORS TO TRUE                          02810000
033400         WHEN SQLWARN0 NOT = SPACES                               02820000
033500         WHEN SQLCODE  NOT = ZERO                                 02830000
033600             MOVE PV-CURRENT-PARAGRAPH TO AA-PARAGRAPH-NAME       02840000
033800             MOVE 'UNSUCCESSFUL FETCH WITH UNUSED_NIR_CSR'        02850000
034000                                 TO AA-DB2-OPERATION              02860000
034100             MOVE 'TNINREC'      TO AA-DB2-TABLE-1                02870000
034200             MOVE 'TPURCHS'      TO AA-DB2-TABLE-2                02880000
034300             MOVE 'TEXTENT'      TO AA-DB2-TABLE-3                02890000
034600             PERFORM Z998-DB2-ABEND                               02910000
034700     END-EVALUATE.                                                02920000
036900                                                                  02930001
049900                                                                  02940000
030200*----------------------------------------------------------------*02941001
030300*    FETCH THE SKU FOR THE PO/LINE                                02942001
030600*----------------------------------------------------------------*02943001
116500 R600-GET-SKU.                                                    02950000
116600     EXEC SQL                                                     02960000
116700         SELECT P.RMS_PO_SKU_NBR                                  02970000
117000           INTO :PURITM-RMS-PO-SKU-NBR                            02980000
117300           FROM TPURITM P                                         02990000
117600          WHERE P.PO_NBR       = :DK-PO-NBR                       03000003
117800            AND P.PO_LNE_NBR   = :DK-PO-LNE-NBR                   03010000
118400     END-EXEC.                                                    03020000
118500                                                                  03030000
118600     EVALUATE TRUE                                                03040000
118700         WHEN SQLCODE = ZERO                                      03050000
118900         WHEN SQLCODE = -811                                      03060000
119000             CONTINUE                                             03070000
119200         WHEN SQLCODE = +100                                      03080000
119300             MOVE ZERO             TO PURITM-RMS-PO-SKU-NBR       03090017
119400         WHEN OTHER                                               03100000
119700             MOVE 'R600-GET-SKU'                                  03120000
119800                                           TO AA-PARAGRAPH-NAME   03130000
119900             MOVE 'UNSUCCESSFUL SELECT'    TO AA-DB2-OPERATION    03140000
120000             MOVE 'TPURITM'                TO AA-DB2-TABLE-1      03150000
120300             PERFORM Z998-DB2-ABEND                               03160000
120400     END-EVALUATE.                                                03170000
120400                                                                  03170101
030200*----------------------------------------------------------------*03170201
030300*    FETCH THE RECEIVED DATE FOR THE PO/LINE                      03170301
030600*----------------------------------------------------------------*03170401
116500 R700-GET-RECV-DTE.                                               03170501
116600     EXEC SQL                                                     03170601
116700         SELECT DISTINCT(REC_TMST)                                03170707
117000           INTO :RECEIV-REC-TMST                                  03170801
255500          FROM TRECDIS RD                                         03171403
255600              ,TRECEIV RV                                         03171503
255700          WHERE RV.ORD_NBR        = :DK-PO-NBR                    03171603
255800           AND  RV.ORD_NBR        = RD.ORD_NBR                    03171703
255900           AND  RV.REC_SEQ_NBR    = :DK-PO-LNE-NBR                03171807
256200           AND  RD.VER_STATUS_CDE = 'A'                           03172103
256300           AND  RV.VER_STATUS_CDE = 'A'                           03172203
256400           AND  RV.REC_SEQ_NBR    = RD.REC_SEQ_NBR                03172303
256500           AND  RV.STATUS_CDE     = 'VE'                          03172403
118400     END-EXEC.                                                    03172501
118500                                                                  03172601
118600     EVALUATE TRUE                                                03172701
118700         WHEN SQLCODE = ZERO                                      03172801
118900         WHEN SQLCODE = -811                                      03172901
119000             CONTINUE                                             03173001
119200         WHEN SQLCODE = +100                                      03173101
119300            MOVE SPACES           TO RECEIV-REC-TMST              03173215
119400         WHEN OTHER                                               03173301
119700             MOVE 'R700-GET-RECV-DTE'                             03173501
119800                                           TO AA-PARAGRAPH-NAME   03173601
119900             MOVE 'UNSUCCESSFUL SELECT'    TO AA-DB2-OPERATION    03173701
120000             MOVE 'TPURITM'                TO AA-DB2-TABLE-1      03173801
120300             PERFORM Z998-DB2-ABEND                               03173901
120400     END-EVALUATE.                                                03174001
037000*----------------------------------------------------------------*03174101
037100*    WRITES THE VENDOR SPECIFICATION RECORDS                     *03174201
037200*----------------------------------------------------------------*03174300
037300 W100-WRITE-UNUSED-NIR-FILE.                                      03174400
037400                                                                  03175000
037500     MOVE 'W100-WRITE-UNUSED-NIR-FILE' TO PV-CURRENT-PARAGRAPH.   03176000
037600                                                                  03177000
038000                                                                  03178000
038100     WRITE UNUSED-NIR-RPT-REC FROM OUTPUT-STRUCTURE.              03179000
038200     ADD 1  TO PC-WRITE-COUNT.                                    03180000
038300                                                                  03190000
040419                                                                  03200000
040420*----------------------------------------------------------------*03210000
040500*    OPENS THE VENDOR SPECIFICATION CURSOR.                      *03220000
040600*    CALLED FROM B100-INITIALIZE                                 *03230000
040700*----------------------------------------------------------------*03240000
040800 Y100-OPEN-UNUSED-NIR-CSR.                                        03250000
040900                                                                  03260000
041000     MOVE 'Y100-OPEN-UNUSED-NIR-CSR' TO PV-CURRENT-PARAGRAPH.     03270000
041100                                                                  03280000
041800     EXEC SQL                                                     03290000
041900         OPEN UNUSED_NIR_CSR                                      03300000
042000     END-EXEC.                                                    03310000
042100                                                                  03320000
042200     EVALUATE TRUE                                                03330000
042300         WHEN SQLCODE = ZERO                                      03340000
042400         WHEN SQLCODE = -904                                      03350000
042500         WHEN SQLCODE = -913                                      03360000
042600             CONTINUE                                             03370000
042700                                                                  03380000
042800                 WHEN SQLWARN0 NOT = SPACES                       03390000
042900         WHEN SQLCODE  NOT = ZERO                                 03400000
043000         MOVE PV-CURRENT-PARAGRAPH                                03410000
043100                             TO AA-PARAGRAPH-NAME                 03420000
043200         MOVE 'UNSUCCESSFUL OPEN ON UNUSED_NIR_CSR'               03430000
043300                             TO AA-DB2-OPERATION                  03440000
043400         MOVE 'TPAYREQ'      TO AA-DB2-TABLE-1                    03450000
043500         MOVE 'TINVOIC'      TO AA-DB2-TABLE-2                    03460000
043600         MOVE SPACES         TO AA-DB2-TABLE-3                    03470000
043900         PERFORM Z998-DB2-ABEND                                   03490000
044000     END-EVALUATE.                                                03500000
045600                                                                  03510000
045700*----------------------------------------------------------------*03520000
045800*    CLOSES THE VENDOR SPECIFICATION CURSOR.                     *03530000
045900*    CALLED FROM B300-END-PROGRAM                                *03540000
046000*----------------------------------------------------------------*03550000
046100 Y110-CLOSE-UNUSED-NIR-CSR.                                       03560000
046200                                                                  03570000
046300     MOVE 'Y110-CLOSE-UNUSED-NIR-CSR' TO PV-CURRENT-PARAGRAPH.    03580000
046400                                                                  03590000
047100     EXEC SQL                                                     03600000
047200         CLOSE UNUSED_NIR_CSR                                     03610000
047300     END-EXEC.                                                    03620000
047400                                                                  03630000
047500     EVALUATE TRUE                                                03640000
047600         WHEN SQLCODE = ZERO                                      03650000
047700         WHEN SQLCODE = -904                                      03660000
047800         WHEN SQLCODE = -913                                      03670000
047900             CONTINUE                                             03680000
048000                                                                  03690000
048100         WHEN SQLWARN0 NOT = SPACES                               03700000
048200         WHEN SQLCODE  NOT = ZERO                                 03710000
048300             MOVE PV-CURRENT-PARAGRAPH                            03720000
048400                                 TO AA-PARAGRAPH-NAME             03730000
048500             MOVE 'UNSUCCESSFUL CLOSE ON UNUSED_NIR_CSR'          03740000
048600                                 TO AA-DB2-OPERATION              03750000
048700             MOVE 'TPAYREQ'      TO AA-DB2-TABLE-1                03760000
048800             MOVE 'TINVOIC'      TO AA-DB2-TABLE-2                03770000
048900             MOVE SPACES         TO AA-DB2-TABLE-3                03780000
049200             PERFORM Z998-DB2-ABEND                               03800000
049300     END-EVALUATE.                                                03810000
050800                                                                  03820001
050900*----------------------------------------------------------------*03830000
051000*    ABEND ROUTINE FOR DB2 ERRORS                                *03840000
051100*----------------------------------------------------------------*03850000
051200 Z998-DB2-ABEND.                                                  03860000
051300                                                                  03870000
051400     CLOSE UNUSED-NIR-RPT-FILE.                                   03880000
051500     DISPLAY AA-ABEND-LIT.                                        03890000
051600     DISPLAY AA-DB2-ERROR-LIT.                                    03900000
051700     DISPLAY AA-PROGRAM-LIT.                                      03910000
051800     DISPLAY AA-PARAGRAPH-LIT.                                    03920000
051900     DISPLAY AA-DB2-OPERATION-LIT.                                03930000
052000     DISPLAY AA-DB2-TABLE-1.                                      03940000
052100     DISPLAY AA-DB2-TABLE-2.                                      03950000
052200     DISPLAY AA-DB2-TABLE-3.                                      03960000
052400     SET AC-DB2-ERROR TO TRUE.                                    03980000
052500                                                                  03990000
052600     COPY DPPD004.                                                04000000
052700                                                                  04010000
052800     CALL 'ILBOABN0' USING ABEND-CODE.                            04020000
052900                                                                  04030001
066700*--------------------------------------------------------------*  04040000
066800* COPYBOOK FOR SEPHORA PROCESSES                               *  04050000
066900*--------------------------------------------------------------*  04060000
067000     COPY APPD021.                                                04070000
067100                                                                  04080000
