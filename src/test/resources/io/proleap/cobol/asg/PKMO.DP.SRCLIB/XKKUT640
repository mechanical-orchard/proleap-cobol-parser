      ******************************************************************00010000
       IDENTIFICATION DIVISION.                                         00020000
      ******************************************************************00030000
                                                                        00040000
       PROGRAM-ID.      XKKUT640.                                       00050000
       AUTHOR.          TOM BOYD.                                       00060000
       INSTALLATION.    KOHLS DEPARTMENT STORES.                        00070000
       DATE-WRITTEN.    AUGUST 2005.                                    00080000
       DATE-COMPILED.                                                   00090000
                                                                        00100000
      ******************************************************************00110000
      * THIS PROGRAM WILL TRUNCATE ORACLE XK TABLES PASSED IN.          00120000
      ******************************************************************00121000
      **  HISTORY LOG:                                                 *00122000
      ******************************************************************00123000
      * DATE:         08/22/2005                                       *00124000
      * WR/IR#:       WR28048                                          *00125000
      * PROGRAMMER:   TOM BOYD                                         *00126000
      * DESCRIPTION:  INITIAL CREATION.                                *00127000
      ******************************************************************00128000
      * DATE:         07/30/2018                                       *00128620
      * WR/IR#:       CHG0205458                                       *00128724
      * PROGRAMMER:   COGNIZANT                                        *00128820
      * DESCRIPTION:  ORACLE LOGON STANDARDS PROGRAM CHANGE            *00128921
      ******************************************************************00129020
                                                                        00129120
      ******************************************************************00130000
       ENVIRONMENT DIVISION.                                            00140000
      ******************************************************************00150000
                                                                        00160000
       CONFIGURATION SECTION.                                           00170000
                                                                        00180000
       SOURCE-COMPUTER. IBM-3090.                                       00190000
       OBJECT-COMPUTER. IBM-3090.                                       00200000
                                                                        00210000
       INPUT-OUTPUT SECTION.                                            00220000
                                                                        00230000
       FILE-CONTROL.                                                    00240000
           SELECT TABLE-FILE                                            00250000
                  ASSIGN                    TO INP01.                   00260000
                                                                        00270000
070941     SELECT ORACLE-LOGON-FILE                                     00271014
070941            ASSIGN                    TO ORALOGON.                00272014
                                                                        00279101
      ******************************************************************00280000
       DATA DIVISION.                                                   00290000
      ******************************************************************00300000
                                                                        00310000
       FILE SECTION.                                                    00320000
       FD  TABLE-FILE                                                   00330000
           RECORDING MODE F                                             00340000
           BLOCK CONTAINS 0 RECORDS                                     00350000
           LABEL RECORDS ARE OMITTED                                    00360000
           DATA RECORD IS DEPT-RECORD.                                  00370000
       01  TABLE-RECORD                     PIC X(80).                  00380000
                                                                        00390000
070941 FD  ORACLE-LOGON-FILE                                            00391014
070941     RECORDING MODE IS F                                          00392014
070941     LABEL RECORDS ARE STANDARD                                   00393014
070941     BLOCK CONTAINS 0 RECORDS                                     00394014
070941     RECORD CONTAINS 80 CHARACTERS                                00395014
070941     DATA RECORDS IS OL-ORACLE-LOGON-RECORD.                      00396014
070941 01  OL-ORACLE-LOGON-RECORD           PIC X(80).                  00397019
       WORKING-STORAGE SECTION.                                         00400000
                                                                        00410000
      ******************************************************************00420000
      * PC PROGRAM CONSTANTS                                            00430000
      ******************************************************************00440000
       01  PC-PROGRAM-CONSTANTS.                                        00450000
           05  PC-CURRENT-PROGRAM-NAME      PIC X(08)      VALUE        00460000
                                                           'XKKUT640'.  00470000
                                                                        00480000
      ******************************************************************00490000
      * PV PROGRAM VARIABLES                                            00500000
      ******************************************************************00510000
       01  PV-PROGRAM-VARIABLES.                                        00520000
           05  PV-TABLE-NAME                PIC X(30) VALUE SPACES.     00530000
           05  PV-SQL-CODE                  PIC 9(09) VALUE 0.          00540000
           05  PV-PARAGRAPH-NAME            PIC X(40) VALUE SPACES.     00550000
           05  PV-OPERATION-MSG             PIC X(60)  VALUE SPACES.    00560000
           05  PV-OPERATION-MSG-1           PIC X(40) VALUE SPACES.     00570000
           05  PV-OPERATION-MSG-2           PIC X(40) VALUE SPACES.     00580000
           05  PV-CPU-TIME                  PIC  9(08) VALUE 0.         00590000
           05  PV-CURRENT-TIME              PIC X(08) VALUE SPACES.     00600000
           05  PV-RUN-DATE                  PIC X(10) VALUE SPACES.     00610000
           05  PV-TABLE                     PIC X(35) VALUE ZEROES.     00620000
070941     05  PV-ORACLE-USERID-LEN         PIC S9(4) VALUE ZEROS       00632017
070941                                                 COMP SYNC.       00633014
070941     05  PV-ORACLE-PASSWORD-LEN       PIC S9(4) VALUE ZEROS       00634017
070941                                                 COMP SYNC.       00635014
                                                                        00639303
       01  CC-CONTROL-CARD-TBL-REC.                                     00640000
           05  CC-TABLE                       PIC X(35) VALUE ZEROES.   00650000
           05  FILLER                         PIC X(45) VALUE SPACES.   00660000
                                                                        00670000
      ******************************************************************00680000
      * PS PROGRAM SWITCHES                                            *00690000
      ******************************************************************00700000
       01  PS-PROGRAM-SWITCHES.                                         00710000
           05  PS-END-OF-TABLE-FILE-SW      PIC X(01)  VALUE 'N'.       00711000
               88  PS-END-OF-TABLE-FILE                VALUE 'Y'.       00712000
               88  PS-NOT-END-OF-TABLE-FILE            VALUE 'N'.       00713000
070941     05  PS-END-OF-LOGON-FILE-SW      PIC X(01)  VALUE 'N'.       00713117
070941         88  PS-END-OF-LOGON-FILE                VALUE 'Y'.       00713215
070941     05  PS-ORA-SRC-CTL-DONE-SW       PIC X(01)  VALUE 'N'.       00713317
070941         88  PS-ORA-SRC-EMPTY                    VALUE 'Y'.       00713414
                                                                        00714000
      ******************************************************************00715000
      * PA PROGRAM ACCUMULATORS                                        *00716000
      ******************************************************************00717000
       01  PA-PROGRAM-ACCUMULATORS.                                     00718000
           05  PA-RECS-WRITTEN               PIC S9(13) COMP-3 VALUE 0. 00719000
           05  PA-READ-COUNTER               PIC S9(11) COMP-3 VALUE 0. 00720000
                                                                        00730000
      ******************************************************************00740000
      * AC ABEND CODES                                                 *00750000
      ******************************************************************00760000
                                                                        00770000
       01  ABEND-CODE                       PIC S9(04)   COMP VALUE +0. 00780000
           88  ABEND-4001-WRITE-ERROR                    VALUE +4001.   00790000
           88  ABEND-4002-READ-ERROR                     VALUE +4002.   00800000
           88  ABEND-4003-CTRL-CARD-ERROR                VALUE +4003.   00810000
           88  ABEND-4004-TABLE-ERROR                    VALUE +4004.   00820000
           88  ABEND-4005-OPEN-ERROR                     VALUE +4005.   00830000
           88  ABEND-4006-CLOSE-ERROR                    VALUE +4006.   00840000
           88  ABEND-4007-SEQUENCE-ERROR                 VALUE +4007.   00850000
           88  ABEND-4008-DATA-ERROR                     VALUE +4008.   00860000
           88  ABEND-4009-KEY-DATA-ERROR                 VALUE +4009.   00870000
           88  ABEND-4013-DB2-ERROR                      VALUE +4013.   00880000
           88  ABEND-4014-ORACLE-LOGON-ERROR             VALUE +4014.   00890000
           88  ABEND-4019-DATE-ROUTINE-ERROR             VALUE +4019.   00900000
           88  ABEND-4444-FORCED-ABEND                   VALUE +4444.   00910000
                                                                        00920000
070941 01  CC-ORACLE-CONNECTION.                                        00921015
070941     05  CC-ORACLE-USERID             PIC X(40).                  00922015
070941         88 CC-AUTO-LOGON                         VALUE '/'.      00923015
070941     05  CC-ORACLE-PASSWORD           PIC X(40).                  00924015
                                                                        00925003
      *----------------------------------------------------------       00930000
      *                      O  R  A  C  L  E                           00940000
      *==========================================================       00950000
      *                                                                 00960000
      * ORACLE DECLARE SECTION                                          00970000
      * ORACLE USED AND RETURNED VARIABLES                              00980000
      *                                                                 00990000
      *----------------------------------------------------------       01000000
           EXEC SQL BEGIN DECLARE SECTION END-EXEC.                     01010000
                                                                        01020000
      *----------------------------------------------------------       01030000
      * ORACLE LOGON WORKING STORAGE COPYBOOK                           01040000
      *----------------------------------------------------------       01050000
                                                                        01060000
       01  PC-ENT01-TYPE-CDE                PIC X(02)  VALUE '01'.      01070000
       01  PV-ORACLE-ID                     PIC X(1)   VALUE '/'.       01080000
                                                                        01090000
       01  USERNAME                         PIC X(10)  VARYING.         01100000
       01  PASSWD                           PIC X(10)  VARYING.         01110000
                                                                        01120000
       01  ORACLE-RETURN                    PIC X(200) VALUE SPACES.    01130000
                                                                        01140000
           EXEC SQL END DECLARE SECTION END-EXEC.                       01150000
           EXEC SQL INCLUDE SQLCACOB    END-EXEC.                       01160000
                                                                        01170000
       EJECT                                                            01180000
                                                                        01190000
       PROCEDURE DIVISION.                                              01200000
                                                                        01210000
      ******************************************************************01220000
      * MAIN PROCESSING                                                 01230000
      ******************************************************************01240000
       A100-PROGRAM-MAINLINE.                                           01250000
                                                                        01260000
           PERFORM B100-INITIALIZE.                                     01270000
                                                                        01280000
           PERFORM B200-READ-TABLE-FILE.                                01290000
           PERFORM C100-CONTROL                                         01300000
             UNTIL PS-END-OF-TABLE-FILE.                                01310000
                                                                        01320000
           DISPLAY ' '.                                                 01330000
           DISPLAY 'ALL RECORDS SUCCESSFULLY TRUNCATED'.                01340000
           DISPLAY ' '.                                                 01350000
                                                                        01360000
           PERFORM B900-EOJ-ROUTINE.                                    01370000
                                                                        01380000
           GOBACK.                                                      01390000
                                                                        01400000
      ******************************************************************01410000
      * OPEN FILE                                                       01420000
      ******************************************************************01430000
       B100-INITIALIZE.                                                 01440000
                                                                        01450000
           OPEN INPUT TABLE-FILE.                                       01460000
070941     PERFORM B110-ORACLE-SETUP.                                   01460114
                                                                        01470708
070941 B110-ORACLE-SETUP.                                               01470814
070941     OPEN INPUT ORACLE-LOGON-FILE.                                01471014
070941     PERFORM B120-READ-ORACLE-LOGON.                              01473014
070941                                                                  01474014
070941     CLOSE ORACLE-LOGON-FILE.                                     01475014
070941                                                                  01476014
070941     IF ((PS-END-OF-LOGON-FILE)                                   01477014
070941             OR (CC-ORACLE-CONNECTION = SPACES))                  01478014
070941         DISPLAY '** ABEND **'                                    01479014
070941         DISPLAY PC-CURRENT-PROGRAM-NAME                          01479114
070941                 ' - ORACLE LOGON CONTROL CARD '                  01479214
070941                   'NOT PROVIDED'                                 01479314
070941         SET PS-ORA-SRC-EMPTY TO TRUE                             01479414
070941         CALL 'ILBOABN0' USING ABEND-CODE                         01479514
070941     END-IF.                                                      01479614
070941                                                                  01479714
070941     IF CC-AUTO-LOGON                                             01479814
070941         DISPLAY PC-CURRENT-PROGRAM-NAME                          01479914
070941                ' - AUTO LOGON TO ORACLE'                         01480014
070941         EXEC SQL                                                 01480114
070941              CONNECT :USERNAME                                   01480214
070941         END-EXEC                                                 01480314
070941     ELSE                                                         01480414
070941         INITIALIZE PV-ORACLE-USERID-LEN                          01480514
070941                    PV-ORACLE-PASSWORD-LEN                        01480614
070941         INSPECT CC-ORACLE-USERID                                 01480714
070941             TALLYING PV-ORACLE-USERID-LEN                        01480814
070941          FOR CHARACTERS BEFORE INITIAL SPACE                     01480914
070941      INSPECT CC-ORACLE-PASSWORD                                  01481014
070941          TALLYING PV-ORACLE-PASSWORD-LEN                         01481114
070941          FOR CHARACTERS BEFORE INITIAL SPACE                     01481214
070941      MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO           01481314
070941                USERNAME-ARR                                      01481414
070941      MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                   01481514
070941      MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO       01481614
070941                PASSWD-ARR                                        01481714
070941      MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                   01481814
070941      DISPLAY PC-CURRENT-PROGRAM-NAME                             01481914
070941             ' - LOGON TO ORACLE AS USER '                        01482014
070941                USERNAME-ARR                                      01482114
070941      EXEC SQL                                                    01482214
070941        CONNECT :USERNAME IDENTIFIED BY :PASSWD                   01482314
070941      END-EXEC                                                    01482414
070941      INITIALIZE CC-ORACLE-PASSWORD                               01482514
070941                 PASSWD                                           01482614
070941      END-IF.                                                     01482714
070941                                                                  01482814
070941     IF (SQLCODE NOT = 0)                                         01482914
070941         DISPLAY PV-PARAGRAPH-NAME                                01483014
070941         DISPLAY PC-CURRENT-PROGRAM-NAME                          01483114
070941               ' - ERROR LOGGING ON TO ORACLE'                    01483214
070941         PERFORM 9900-ORACLE-ABEND                                01483323
070941     END-IF.                                                      01483514
070941                                                                  01483614
070941******************************************************************01483714
070941* NEEDS TO BE IN FOR NOW TIL KURT FIXES CURSOR SHARING BUG        01483814
070941* OTHERWISE GET AN ORACLE ERROR (IE: 3113).                       01483914
070941******************************************************************01484014
070941     EXEC SQL                                                     01484114
070941      ALTER SESSION                                               01484214
070941            SET CURSOR_SHARING = 'EXACT'                          01484314
070941     END-EXEC.                                                    01484414
070941                                                                  01484514
070941                                                                  01484614
070941***************************************************************** 01484714
070941*  B120-READ-ORACLE-LOGON.                                      * 01484814
070941* ==> PROCESSES:                                                * 01484914
070941*   - READ ORCALE CONTROL CARD                                  * 01485014
070941* ==> PERFORMED FROM:  B110-ORACLE-SETUP                        * 01485114
070941***************************************************************** 01485214
070941 B120-READ-ORACLE-LOGON.                                          01485314
070941                                                                  01485414
070941     READ ORACLE-LOGON-FILE                                       01485514
070941         INTO CC-ORACLE-CONNECTION                                01485614
070941         AT END                                                   01485714
070941             SET PS-END-OF-LOGON-FILE TO TRUE                     01485814
070941     END-READ.                                                    01485914
070941                                                                  01486014
070941*    PERFORM PM700-A000-ORACLE-SETUP.                             01487018
                                                                        01490000
      ******************************************************************01500000
      * B200-READ-TABLE-FILE.                                           01510000
      *     READS THE TABLE NAME FOR THE RECORD THAT SHOULD BE TRUNCATED01520000
      ******************************************************************01530000
       B200-READ-TABLE-FILE.                                            01540000
                                                                        01550000
           READ TABLE-FILE INTO CC-CONTROL-CARD-TBL-REC                 01560000
                AT END SET PS-END-OF-TABLE-FILE TO TRUE.                01570000
                                                                        01580000
           MOVE CC-TABLE TO PV-TABLE.                                   01590000
                                                                        01600000
           IF PS-NOT-END-OF-TABLE-FILE                                  01610000
              PERFORM 8000-GET-CURRENT-TIME                             01620000
              DISPLAY 'TRUNCATING TABLE: ' PV-TABLE                     01630000
           END-IF.                                                      01640000
                                                                        01650000
      *B200-EXIT.                                                       01660000
       EJECT.                                                           01670000
                                                                        01680000
      *--------------------------------------------------------------   01690000
      * THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION THAT      01700000
      * LOGS ON TO ORACLE.                                              01710000
      *---------------------------------------------------------------  01720000
070941*    COPY XKPD700.                                                01730018
                                                                        01740000
      ******************************************************************01750000
      * NEEDS TO BE IN FOR NOW TIL KURT FIXES CURSOR SHARING BUG        01760000
      * OTHERWISE I GET A ORA-3113 ERROR                                01770000
      ******************************************************************01780000
      *    EXEC SQL                                                     01790022
      *     ALTER SESSION                                               01800022
      *           SET CURSOR_SHARING = 'EXACT'                          01810022
      *     ALTER SESSION                                               01820022
      *           SET OPTIMIZER_INDEX_COST_ADJ =  5                     01830022
      *    END-EXEC.                                                    01840022
                                                                        01850000
      ******************************************************************01860000
      * CLEAN UP                                                        01870000
      ******************************************************************01880000
       B900-EOJ-ROUTINE.                                                01890000
                                                                        01900000
           CLOSE TABLE-FILE.                                            01910000
                                                                        01920000
                                                                        01930000
      ******************************************************************01940000
      * CONTROL PROCESSING BASED ON DEPARTMENT NUMBERS.                 01950000
      ******************************************************************01960000
       C100-CONTROL.                                                    01970000
                                                                        01980000
           PERFORM D100-TRUNCATE-TABLE.                                 01990000
           PERFORM B200-READ-TABLE-FILE.                                02000000
                                                                        02010000
      ******************************************************************02020000
      * TRUNCATE RECORD                                                 02030000
      ******************************************************************02040000
       D100-TRUNCATE-TABLE.                                             02050000
                                                                        02060000
           EXEC SQL EXECUTE                                             02070000
             BEGIN                                                      02080000
               XKSP_TRUNC_TABLE(:PV-TABLE);                             02090000
             END;                                                       02100000
           END-EXEC.                                                    02110000
                                                                        02120000
           EVALUATE TRUE                                                02130000
             WHEN SQLCODE = ZERO                                        02140000
                 DISPLAY 'FINISHED TRUNCATING : ' PV-TABLE              02150000
             WHEN OTHER                                                 02160000
                 MOVE SQLCODE                    TO PV-SQL-CODE         02170000
                 MOVE PV-TABLE                   TO PV-TABLE-NAME       02180000
                 MOVE 'D100-TRUNCATE-TABLE' TO PV-PARAGRAPH-NAME        02190000
                 PERFORM 9900-ORACLE-ABEND                              02200000
           END-EVALUATE.                                                02210000
                                                                        02220000
      *D100 END                                                         02230000
                                                                        02240000
      ******************************************************************02250000
       8000-GET-CURRENT-TIME.                                           02260000
      ******************************************************************02270000
                                                                        02280000
            MOVE SPACES TO PV-CURRENT-TIME.                             02290000
                                                                        02300000
           EXEC SQL                                                     02310000
              SELECT                                                    02320000
                 TO_CHAR(SYSDATE,'HH24:MI:SS')                          02330000
              INTO :PV-CURRENT-TIME                                     02340000
              FROM DUAL                                                 02350000
            END-EXEC.                                                   02360000
                                                                        02370000
           EVALUATE TRUE                                                02380000
             WHEN SQLCODE = ZERO                                        02390000
                 DISPLAY 'CURRENT TIME: ' PV-CURRENT-TIME               02400000
             WHEN OTHER                                                 02410000
                 MOVE SQLCODE                    TO PV-SQL-CODE         02411000
                 MOVE 'DUAL'                      TO PV-TABLE-NAME      02412000
                 MOVE '8000-GET-CURRENT-TIME   ' TO PV-PARAGRAPH-NAME   02413000
                 PERFORM 9900-ORACLE-ABEND                              02413100
           END-EVALUATE.                                                02413200
                                                                        02413300
      *-----------------------------------------------------------      02413400
      * Z100-ABEND                                                      02413500
      *  - PERFORM AN ABEND THAT OCCURED RELATED TO ORACLE              02413600
      *  - CALLED BY PEPD70B!                                           02413700
      *-----------------------------------------------------------      02413800
       Z100-ABEND.                                                      02413900
                                                                        02414000
           DISPLAY '                       '.                           02415000
           DISPLAY '** ABEND **       ** = SQLERROR'.                   02416000
           DISPLAY '** PROGRAM        ** = ' PC-CURRENT-PROGRAM-NAME.   02417000
           DISPLAY '** SQLCODE        ** = ' SQLCODE.                   02418000
           DISPLAY '** ABEND CODE     ** = ' ABEND-CODE.                02419000
           DISPLAY '** SQLERRM        ** = ' SQLERRM.                   02420000
           DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  02430000
           DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                02440000
           DISPLAY '** PARAGRAPH      ** = ' PV-PARAGRAPH-NAME.         02450000
           DISPLAY '** TABLE          ** = ' PV-TABLE-NAME.             02460000
           DISPLAY '** OPERATION      ** = ' PV-OPERATION-MSG.          02470000
           DISPLAY '                       '.                           02480000
                                                                        02490000
           CALL 'ILBOABN0' USING ABEND-CODE.                            02500000
                                                                        02510000
      *----------------------------------------------------------       02520000
      * 9900-ORACLE-ABEND.                                              02530000
      *     PERFORM AN ABEND THAT OCCURED RELATED TO ORACLE.            02540000
      *----------------------------------------------------------       02550000
       9900-ORACLE-ABEND.                                               02560000
                                                                        02570000
           DISPLAY '                       '.                           02580000
           DISPLAY '** ABEND **       ** = SQLERROR'.                   02590000
           DISPLAY '** PROGRAM        ** = ' PC-CURRENT-PROGRAM-NAME.   02600000
           DISPLAY '** SQLCODE        ** = ' PV-SQL-CODE.               02610000
           DISPLAY '** ABEND CODE     ** = ' ABEND-CODE.                02620000
           DISPLAY '** SQLERRM        ** = ' SQLERRM.                   02630000
           DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  02640000
           DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                02650000
           DISPLAY '** PARAGRAPH      ** = ' PV-PARAGRAPH-NAME.         02660000
           DISPLAY '** TABLE          ** = ' PV-TABLE-NAME.             02670000
           DISPLAY '** OPERATION      ** = ' PV-OPERATION-MSG.          02680000
           DISPLAY '                       '.                           02690000
                                                                        02700000
           CALL 'ILBOABN0' USING ABEND-CODE.                            02710000
                                                                        02720000
      *9900-EXIT.                                                       02730000
