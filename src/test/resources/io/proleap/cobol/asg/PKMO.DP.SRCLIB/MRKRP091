000100 ID  DIVISION.                                                    00010009
000200 PROGRAM-ID.         MRKRP091.                                    00020009
000300 AUTHOR.             LINDA GRIESBACH.                             00030009
000400 INSTALLATION.       KOHL'S CORPORATION.                          00040009
000500 DATE-WRITTEN.       DECEMBER 1998.                               00050009
000600 DATE-COMPILED.                                                   00060009
000700                                                                  00070000
000800***************************************************************** 00080009
000900*    THE PURPOSE OF THIS PROGRAM IS TO PRODUCE THE SKU/STORE    * 00090099
001000*    SERVICE LEVEL REPORT.                                      * 00100099
001100***************************************************************** 00110009
001200*                                                               * 00120099
001300*  CHANGED 01/13/00 BY LINDA FRIESS             PITS# 336984    * 00130099
001400*    EXPANDED FIELDS FOR ONHAND, ONORDER, AND CSTOCK QUANTITIES * 00140099
001500*                                                               * 00150099
001600***************************************************************** 00160099
001700*                                                               * 00170099
001800*  CHANGED 02/29/00 BY T BAGWELL                PITS# 999999    * 00180099
001900*    EXPANDED FIELDS FOR ONHAND, ONORDER, AND CSTOCK QUANTITIES * 00190099
002000*                                                               * 00200099
002100***************************************************************** 00210099
002200*                                                               * 00220099
002300*  CHANGED 03/15/00 BY T BAGWELL                PITS# 999999    * 00230099
002400*    MODIFY THE QUERIES THAT GET STORE COUNTS TO INCLUDE ONLY   * 00240099
002500*    ACTIVE INFOREM SKUS (FT_CDE <> 'X')                        * 00250099
002600***************************************************************** 00260099
002700*                                                               * 00270099
002800*  CHANGED 03/30/01 BY DAVID COLOMBO            WR# 21599       * 00280099
002900*    MODIFIED DATABASE CALLS SO THEY DO NOT INCLUDE THE         * 00290099
003000*    E-COMMERCE STORE.                                          * 00300099
003100***************************************************************** 00310099
003110*  CHANGED 04/17/02 BY DON TOMLINSON                            * 00311099
003120*    NI SKU MR PHASE 4 CHANGES - TSKXREF ADDED. MRRD031 CHANGED.* 00312099
003130*    ADDED ISWS006 COPYBOOK TO HANDLE DIFFERENT FORMATS / SIZES * 00313099
003131*    IN FIELDS.  SQL CHANGED FOR WHERE STATEMENTS TO REFERENCE  * 00313199
003132*    DCLGEN FIELDS INSTEAD OF PROGRAM VARAIABLES IN WORKING     * 00313299
003133*    STORAGE.                                                   * 00313399
003100***************************************************************** 00313499
003110*  06/10/04 BY BOB FORD - STORE NUMBER EXPANSION - WR#26363     * 00313599
003000*             CHANGED PROGRAM TO HANDLE 5-DIGIT STORE NUMBERS   * 00313699
003000*       FOR STORE NUMBER EXPANSION.  CHANGED COPYBOOK MRRD031,  * 00313799
003000*       WORK FIELDS, REPLACED TSTROOO WITH XMT_LOC, AND CHANGED * 00313899
003000*       ALL DB2 READS TO USE NUMERIC STORE NUMBERS.  CHANGED    * 00313999
003000*       REPORT TO SHOW 5-DIGIT STORE NUMBERS.                   * 00314099
003140***************************************************************** 00315099
003200                                                                  00320000
003300 ENVIRONMENT DIVISION.                                            00330009
003400 CONFIGURATION SECTION.                                           00340009
003500 SOURCE-COMPUTER.        IBM-370.                                 00350009
003600 OBJECT-COMPUTER.        IBM-370.                                 00360009
003700 INPUT-OUTPUT SECTION.                                            00370009
003800 FILE-CONTROL.                                                    00380009
003900     SELECT BELOW-PCT-FILE                                        00390009
004000         ASSIGN TO INP01.                                         00400009
004100                                                                  00410001
004200     SELECT BELOW-PCT-RPT                                         00420018
004300         ASSIGN TO RPT01.                                         00430009
004400                                                                  00440009
004500 DATA DIVISION.                                                   00450009
004600 FILE SECTION.                                                    00460009
004700 FD  BELOW-PCT-FILE                                               00470001
004800     RECORDING MODE IS F                                          00480001
004900     LABEL RECORDS ARE STANDARD                                   00490001
005000     RECORD CONTAINS 164 CHARACTERS                               00500099
005100     BLOCK  CONTAINS  0 RECORDS                                   00510049
005200     DATA RECORD IS BELOW-PCT-RCD.                                00520048
005300 01  BELOW-PCT-RCD                  PIC X(164).                   00530099
005400                                                                  00540001
005500 FD  BELOW-PCT-RPT                                                00550001
005600     RECORDING MODE IS F                                          00560001
005700     LABEL RECORDS ARE STANDARD                                   00570001
005800     RECORD CONTAINS 132 CHARACTERS                               00580001
005900     BLOCK  CONTAINS  0 RECORDS.                                  00590002
006000 01  PRINT-LINE                     PIC X(132).                   00600001
006100                                                                  00610001
006200 WORKING-STORAGE SECTION.                                         00620001
006300                                                                  00630000
006400 01  SWITCHES.                                                    00640000
006500     05  BELOW-PCT-SW               PIC X(1)    VALUE 'N'.        00650001
006600         88  BELOW-PCT-EOF                      VALUE 'Y'.        00660001
006700         88  BELOW-PCT-NOT-EOF                  VALUE 'N'.        00670001
006800     05  FIRST-TIME-SW              PIC X(1)    VALUE 'Y'.        00680022
006900         88  FIRST-TIME                         VALUE 'Y'.        00690022
007000         88  NOT-FIRST-TIME                     VALUE 'N'.        00700022
007100     05  ITEM-ONHAND-SW             PIC X(1)    VALUE 'N'.        00710005
007200         88  ITEM-ONHAND-EOF                    VALUE 'Y'.        00720005
007300         88  ITEM-ONHAND-NOT-EOF                VALUE 'N'.        00730005
007400     05  ITEM-ONORDER-SW            PIC X(1)    VALUE 'N'.        00740006
007500         88  ITEM-ONORDER-EOF                   VALUE 'Y'.        00750006
007600         88  ITEM-ONORDER-NOT-EOF               VALUE 'N'.        00760006
007700     05  SIZE-DESC-SW               PIC X(1)    VALUE 'N'.        00770046
007800         88  SIZE-DESC-EOF                      VALUE 'Y'.        00780046
007900         88  SIZE-DESC-NOT-EOF                  VALUE 'N'.        00790046
008000     05  ITEM-COUNTER-STOCK-SW      PIC X(1)    VALUE 'N'.        00800046
008100         88  ITEM-COUNTER-STOCK-EOF             VALUE 'Y'.        00810046
008200         88  ITEM-COUNTER-STOCK-NOT-EOF         VALUE 'N'.        00820046
008300     05  STORE-ONHAND-SW            PIC X(1)    VALUE 'N'.        00830005
008400         88  STORE-ONHAND-EOF                   VALUE 'Y'.        00840005
008500         88  STORE-ONHAND-NOT-EOF               VALUE 'N'.        00850005
008600     05  STORE-ONORDER-SW           PIC X(1)    VALUE 'N'.        00860006
008700         88  STORE-ONORDER-EOF                  VALUE 'Y'.        00870006
008800         88  STORE-ONORDER-NOT-EOF              VALUE 'N'.        00880006
008900     05  STORE-COUNTER-STOCK-SW     PIC X(1)    VALUE 'N'.        00890009
009000         88  STORE-COUNTER-STOCK-EOF            VALUE 'Y'.        00900009
009100         88  STORE-COUNTER-STOCK-NOT-EOF        VALUE 'N'.        00910009
009200     05  CLEANUP-PREV-SW            PIC X(1)    VALUE 'N'.        00920081
009300         88  CLEANUP-PREV                       VALUE 'Y'.        00930081
009400         88  DO-NOT-CLEANUP-PREV                VALUE 'N'.        00940081
009500     05  GROUP-CHG-1-SW             PIC X(1)    VALUE 'N'.        00950080
009600         88  GROUP-CHG-1                        VALUE 'Y'.        00960080
009700         88  NOT-GROUP-CHG-1                    VALUE 'N'.        00970080
009800     05  GROUP-CHG-2-SW             PIC X(1)    VALUE 'N'.        00980080
009900         88  GROUP-CHG-2                        VALUE 'Y'.        00990080
010000         88  NOT-GROUP-CHG-2                    VALUE 'N'.        01000080
010100     05  BUYER-DEPT-CHG-1-SW        PIC X(1)    VALUE 'N'.        01010099
010200         88  BUYER-DEPT-CHG-1                   VALUE 'Y'.        01020099
010300         88  NOT-BUYER-DEPT-CHG-1               VALUE 'N'.        01030099
010400     05  BUYER-DEPT-CHG-2-SW        PIC X(1)    VALUE 'N'.        01040099
010500         88  BUYER-DEPT-CHG-2                   VALUE 'Y'.        01050099
010600         88  NOT-BUYER-DEPT-CHG-2               VALUE 'N'.        01060099
010700     05  PRT-CTRL-SW                PIC X(1)    VALUE SPACE.      01070078
010800         88  PRT-ITEMS                          VALUE '1'.        01080009
010900         88  PRT-STORES                         VALUE '2'.        01090009
011000     05  CURR-RCD-SW                PIC X(1)    VALUE SPACE.      01100009
011100         88  CURR-RCD-ITEM                      VALUE '1'.        01110009
011200         88  CURR-RCD-STORE                     VALUE '2'.        01120009
011300     05  PREV-RCD-SW                PIC X(1)    VALUE SPACE.      01130009
011400         88  PREV-RCD-ITEM                      VALUE '1'.        01140009
011500         88  PREV-RCD-STORE                     VALUE '2'.        01150009
011600                                                                  01160000
011700 01  CONSTANTS.                                                   01170005
011800     05  PC-MRKRP091                PIC X(8)    VALUE 'MRKRP091'. 01180005
011900     05  PC-END-OF-RPT.                                           01190099
012000         10  FILLER                 PIC X(55)   VALUE SPACES.     01200099
012100         10  FILLER                 PIC X(21)   VALUE             01210099
012200                                    '**  END OF REPORT  **'.      01220099
012300         10  FILLER                 PIC X(56)   VALUE SPACES.     01230099
012400                                                                  01240005
012500 01  VARIABLES.                                                   01250005
012600     05  CPU-DATE.                                                01260009
012700         10  CPU-YY                 PIC 9(2).                     01270009
012800         10  CPU-MM                 PIC 9(2).                     01280009
012900         10  CPU-DD                 PIC 9(2).                     01290009
013000     05  CPU-TIME.                                                01300009
013100         10  CPU-HOUR               PIC X(2).                     01310009
013200         10  CPU-MINUTE             PIC X(2).                     01320009
013300     05  PV-WORK-YEAR.                                            01330059
013400         10  PV-WORK-YEAR-CC        PIC 9(2).                     01340061
013500         10  PV-WORK-YEAR-YY        PIC 9(2).                     01350061
013600     05  PV-PAGE-NBR                PIC S9(5)   COMP-3.           01360099
013700     05  PV-ITEM-NBR                PIC S9(15)  COMP-3.           01370099
013800     05  PV-STORE-NBR               PIC S9(5)   COMP.             01380099
013900     05  PV-CLASS-NBR.                                            01390099
014000         10  PV-CLASS-NBR-1         PIC X(1).                     01400099
014100         10  PV-CLASS-NBR-2         PIC X(1).                     01410099
014200     05  PV-LONG-SIZE-DESC          PIC X(20).                    01420046
014300     05  PV-ITEM-ONHAND             PIC S9(7)   COMP-3.           01430099
014400     05  PV-ITEM-ONORDER            PIC S9(7)   COMP-3.           01440099
014500     05  PV-ITEM-COUNTER-STOCK      PIC S9(9)   COMP-3.           01450099
014600     05  PV-STORE-ONHAND            PIC S9(7)   COMP-3.           01460099
014700     05  PV-STORE-ONORDER           PIC S9(7)   COMP-3.           01470099
014800     05  PV-STORE-COUNTER-STOCK     PIC S9(9)   COMP-3.           01480099
014900     05  PV-ITEM-ONHAND-X           PIC S9(5).                    01490099
015000     05  PV-ITEM-ONORDER-X          PIC S9(5).                    01500099
015100     05  PV-ITEM-COUNTER-STOCK-X    PIC S9(5).                    01510099
015200     05  PV-STORE-ONHAND-X          PIC S9(5).                    01520099
015300     05  PV-STORE-ONORDER-X         PIC S9(5).                    01530099
015400     05  PV-STORE-COUNTER-STOCK-X   PIC S9(5).                    01540099
015500     05  PV-PARA-NAME               PIC X(30).                    01550099
015600     05  ABEND-CODE                 PIC S9(4)   VALUE 0           01560009
015700                                                COMP SYNC.        01570009
015800     05  PREV-BUSINESS-GROUP        PIC X(3).                     01580051
015900     05  PREV-BUSINESS-GROUP-DESC   PIC X(25).                    01590089
016000     05  PREV-DEPT-NBR              PIC X(3).                     01600051
016100     05  PREV-CLASS-NBR             PIC X(2).                     01610051
016200     05  PREV-VENDOR-STYLE          PIC X(20).                    01620051
016300     05  PREV-SKU-DESC              PIC X(25).                    01630089
016400     05  PREV-COLOR-DESC            PIC X(20).                    01640089
016500     05  PREV-BUYER-NBR             PIC X(3).                     01650078
016600                                                                  01660064
016700 01  PV-NULL-INDICATORS.                                          01670013
016800     05  PV-ITEM-ONHAND-IND         PIC S9(4)   VALUE 0           01680013
016900                                                COMP SYNC.        01690013
017000     05  PV-STORE-ONHAND-IND        PIC S9(4)   VALUE 0           01700013
017100                                                COMP SYNC.        01710013
017200     05  PV-ITEM-ONORDER-IND        PIC S9(4)   VALUE 0           01720013
017300                                                COMP SYNC.        01730013
017400     05  PV-STORE-ONORDER-IND       PIC S9(4)   VALUE 0           01740013
017500                                                COMP SYNC.        01750013
017600     05  PV-ITEM-COUNTER-STOCK-IND  PIC S9(4)   VALUE 0           01760013
017700                                                COMP SYNC.        01770013
017800     05  PV-STORE-COUNTER-STOCK-IND PIC S9(4)   VALUE 0           01780013
017900                                                COMP SYNC.        01790013
018000                                                                  01800013
018100 01  SUBSCRIPTS.                                                  01810013
018200     05  SQL-SUB                    PIC S9(4)   VALUE 0           01820013
018300                                                COMP SYNC.        01830000
018400     05  SUB-1                      PIC S9(3)   VALUE 0           01840022
018500                                                COMP-3.           01850022
018600     05  SUB-2                      PIC S9(3)   VALUE 0           01860022
018700                                                COMP-3.           01870022
018800     05  SUB-3                      PIC S9(3)   VALUE 0           01880022
018900                                                COMP-3.           01890022
019000     05  SUB-4                      PIC S9(3)   VALUE 0           01900068
019100                                                COMP-3.           01910068
019200                                                                  01920009
019300 01  CONSTANTS.                                                   01930000
019400     05  MAX-RETRIES                PIC S9(3)   VALUE +3          01940000
019500                                                COMP-3.           01950009
019600 01  PRINT-CONTROL.                                               01960006
019700     05  LINE-COUNT                 PIC S9(3)   VALUE +66         01970095
019800                                                COMP-3.           01980006
019900     05  SPACE-CONTROL              PIC S9(3)   COMP-3.           01990006
020000     05  LINES-ON-PAGE              PIC S9(3)   VALUE +65         02000095
020100                                                COMP-3.           02010006
020200                                                                  02020009
020300     COPY MRRD031.                                                02030009
020400                                                                  02040009
020500     COPY DPWS132.                                                02050009
020600                                                                  02060009
020700 01  RPT-HEAD-1.                                                  02070006
020800     05  FILLER                     PIC X(2)    VALUE SPACES.     02080006
020900     05  FILLER                     PIC X(6)    VALUE 'BUYER:'.   02090006
021000     05  FILLER                     PIC X(2)    VALUE SPACES.     02100006
021100     05  RPT-HEAD-BUYER-NBR         PIC 9(3).                     02110006
021200     05  FILLER                     PIC X(2)    VALUE SPACES.     02120006
021300     05  RPT-HEAD-BUYER-NAME        PIC X(32).                    02130032
021400     05  FILLER                     PIC X(4)    VALUE SPACES.     02140063
021500     05  FILLER                     PIC X(9)    VALUE             02150009
021600                                                'SKU/STORE'.      02160009
021700     05  FILLER                     PIC X(1)    VALUE SPACE.      02170009
021800     05  FILLER                     PIC X(7)    VALUE 'SERVICE'.  02180009
021900     05  FILLER                     PIC X(1)    VALUE SPACE.      02190009
022000     05  FILLER                     PIC X(5)    VALUE 'LEVEL'.    02200009
022100     05  FILLER                     PIC X(1)    VALUE SPACE.      02210009
022200     05  FILLER                     PIC X(6)    VALUE 'REPORT'.   02220009
022300     05  FILLER                     PIC X(52)   VALUE SPACES.     02230063
022400                                                                  02240006
022500 01  DEPT-CLASS-HEAD-1.                                           02250007
022600     05  FILLER                     PIC X(2)    VALUE SPACES.     02260007
022700     05  FILLER                     PIC X(5)    VALUE 'DEPT:'.    02270007
022800     05  FILLER                     PIC X(2)    VALUE SPACES.     02280007
022900     05  DEPT-CLASS-1-DEPT          PIC Z(3).                     02290099
023000     05  FILLER                     PIC X(3)    VALUE SPACES.     02300007
023100     05  FILLER                     PIC X(8)    VALUE 'BUSINESS'. 02310007
023200     05  FILLER                     PIC X(1)    VALUE SPACE.      02320007
023300     05  FILLER                     PIC X(6)    VALUE 'GROUP:'.   02330027
023400     05  FILLER                     PIC X(2)    VALUE SPACES.     02340007
023500     05  DEPT-CLASS-1-BUS-GRP       PIC X(3).                     02350007
023600     05  FILLER                     PIC X(2)    VALUE SPACES.     02360007
023700     05  DEPT-CLASS-1-BUS-GRP-DESC  PIC X(25).                    02370032
023800     05  FILLER                     PIC X(71)   VALUE SPACES.     02380050
023900                                                                  02390007
024000 01  DEPT-CLASS-HEAD-2.                                           02400007
024100     05  FILLER                     PIC X(2)    VALUE SPACES.     02410007
024200     05  FILLER                     PIC X(3)    VALUE 'MAJ'.      02420007
024300     05  FILLER                     PIC X(1)    VALUE SPACE.      02430007
024400     05  FILLER                     PIC X(4)    VALUE 'CLS:'.     02440007
024500     05  FILLER                     PIC X(2)    VALUE SPACES.     02450007
024600     05  DEPT-CLASS-2-MAJ-CLS       PIC X(1).                     02460007
024700     05  FILLER                     PIC X(9)    VALUE SPACES.     02470007
024800     05  FILLER                     PIC X(3)    VALUE 'SUB'.      02480007
024900     05  FILLER                     PIC X(1)    VALUE SPACE.      02490007
025000     05  FILLER                     PIC X(4)    VALUE 'CLS:'.     02500007
025100     05  FILLER                     PIC X(2)    VALUE SPACES.     02510007
025200     05  DEPT-CLASS-2-SUB-CLS       PIC X(1).                     02520007
025300     05  FILLER                     PIC X(100)  VALUE SPACES.     02530050
025400                                                                  02540007
025500 01  DEPT-CLASS-HEAD-3.                                           02550007
025600     05  FILLER                     PIC X(2)    VALUE SPACES.     02560007
025700     05  FILLER                     PIC X(6)    VALUE 'STYLE:'.   02570007
025800     05  FILLER                     PIC X(2)    VALUE SPACES.     02580007
025900     05  DEPT-CLASS-3-STYLE         PIC X(20).                    02590050
026000     05  FILLER                     PIC X(5)    VALUE SPACES.     02600007
026100     05  FILLER                     PIC X(12)   VALUE             02610007
026200                                                'DESCRIPTION:'.   02620007
026300     05  FILLER                     PIC X(2)    VALUE SPACES.     02630007
026400     05  DEPT-CLASS-3-DESC          PIC X(25).                    02640050
026500     05  FILLER                     PIC X(3)    VALUE SPACES.     02650007
026600     05  FILLER                     PIC X(6)    VALUE 'COLOR:'.   02660007
026700     05  FILLER                     PIC X(2)    VALUE SPACES.     02670007
026800     05  DEPT-CLASS-3-COLOR         PIC X(20).                    02680007
026900     05  FILLER                     PIC X(28)   VALUE SPACES.     02690050
027000                                                                  02700099
027100 01  ITEM-COL-1.                                                  02710099
027200     05  FILLER                     PIC X(9)    VALUE SPACES.     02720099
027300     05  FILLER                     PIC X(4)    VALUE 'SIZE'.     02730099
027400     05  FILLER                     PIC X(11)   VALUE SPACES.     02740099
027500     05  FILLER                     PIC X(3)    VALUE 'SVC'.      02750099
027600     05  FILLER                     PIC X(22)   VALUE SPACES.     02760099
027700                                                                  02770099
027800 01  ITEM-COL-2.                                                  02780099
027900     05  FILLER                     PIC X(8)    VALUE 'SKU'.      02790099
028000     05  FILLER                     PIC X(1)    VALUE SPACES.     02800099
028100     05  FILLER                     PIC X(11)   VALUE             02810099
028200                                                'DESCRIPTION'.    02820099
028300     05  FILLER                     PIC X(4)    VALUE SPACES.     02830099
028400     05  FILLER                     PIC X(4)    VALUE 'LVL%'.     02840099
028500     05  FILLER                     PIC X(2)    VALUE SPACES.     02850099
028600     05  FILLER                     PIC X(2)    VALUE 'OH'.       02860099
028700     05  FILLER                     PIC X(4)    VALUE SPACES.     02870099
028800     05  FILLER                     PIC X(2)    VALUE 'OO'.       02880099
028900     05  FILLER                     PIC X(4)    VALUE SPACES.     02890099
029000     05  FILLER                     PIC X(2)    VALUE 'CS'.       02900099
029100     05  FILLER                     PIC X(5)    VALUE SPACES.     02910099
029200                                                                  02920099
029300 01  STORE-COL-1.                                                 02930099
029400     05  FILLER                     PIC X(5)    VALUE 'STORE'.    02940099
029500     05  FILLER                     PIC X(2)    VALUE SPACES.     02950099
029600     05  FILLER                     PIC X(3)    VALUE 'SVC'.      02960099
029700     05  FILLER                     PIC X(22)   VALUE SPACES.     02970099
029800                                                                  02980099
029900 01  STORE-COL-2.                                                 02990099
030000     05  FILLER                     PIC X(3)    VALUE 'NBR'.      03000099
030100     05  FILLER                     PIC X(4)    VALUE SPACES.     03010099
030200     05  FILLER                     PIC X(4)    VALUE 'LVL%'.     03020099
030300     05  FILLER                     PIC X(2)    VALUE SPACES.     03030099
030400     05  FILLER                     PIC X(2)    VALUE 'OH'.       03040099
030500     05  FILLER                     PIC X(4)    VALUE SPACES.     03050099
030600     05  FILLER                     PIC X(2)    VALUE 'OO'.       03060099
030700     05  FILLER                     PIC X(4)    VALUE SPACES.     03070099
030800     05  FILLER                     PIC X(2)    VALUE 'CS'.       03080099
030900     05  FILLER                     PIC X(5)    VALUE SPACES.     03090099
031000                                                                  03100007
031100 01  ITEM-COL-HEAD-1.                                             03110009
031200     05  ITEM-COL-HEAD-1-X          OCCURS 3 TIMES.               03120009
031300         10  FILLER                 PIC X(44)   VALUE SPACES.     03130067
031400                                                                  03140064
031500 01  ITEM-COL-HEAD-2.                                             03150064
031600     05  ITEM-COL-HEAD-2-X          OCCURS 3 TIMES.               03160064
031700         10  FILLER                 PIC X(44)   VALUE SPACES.     03170067
031800                                                                  03180064
031900 01  STORE-COL-HEAD-1.                                            03190064
032000     05  STORE-COL-HEAD-1-X         OCCURS 4 TIMES.               03200064
032100         10  FILLER                 PIC X(32)   VALUE SPACES.     03210071
032200                                                                  03220064
032300 01  STORE-COL-HEAD-2.                                            03230064
032400     05  STORE-COL-HEAD-2-X         OCCURS 4 TIMES.               03240064
032500         10  FILLER                 PIC X(32)   VALUE SPACES.     03250071
032600                                                                  03260064
032700 01  ITEM-DETAIL.                                                 03270064
032800     05  ITEM-DETAIL-X              OCCURS 5 TIMES.               03280066
032900         10  ITEM-DETAIL-GRP        OCCURS 3 TIMES.               03290064
033000             15  ITEM-DETAIL-SKU    PIC Z(8).                     03300099
033100             15  FILLER             PIC X(1)    VALUE SPACES.     03310064
033200             15  ITEM-DETAIL-DESC   PIC X(15).                    03320064
033300*            15  FILLER             PIC X(1)    VALUE SPACES.     03330099
033400             15  ITEM-DETAIL-SVC-PCT                              03340064
033500                                    PIC ZZ9.                      03350099
033600             15  ITEM-DETAIL-SVC-PCT-X REDEFINES                  03360064
033700                 ITEM-DETAIL-SVC-PCT                              03370064
033800                                    PIC X(3).                     03380099
033900             15  FILLER             PIC X(2)    VALUE SPACES.     03390099
034000             15  ITEM-DETAIL-OH     PIC ----9.                    03400099
034100             15  ITEM-DETAIL-OH-X REDEFINES                       03410064
034200                 ITEM-DETAIL-OH     PIC X(5).                     03420099
034300             15  FILLER             PIC X(1)    VALUE SPACE.      03430099
034400             15  ITEM-DETAIL-OO     PIC ----9.                    03440099
034500             15  ITEM-DETAIL-OO-X REDEFINES                       03450064
034600                 ITEM-DETAIL-OO     PIC X(5).                     03460099
034700             15  FILLER             PIC X(1)    VALUE SPACES.     03470099
034800             15  ITEM-DETAIL-CS     PIC ----9.                    03480099
034900             15  ITEM-DETAIL-CS-X REDEFINES                       03490064
035000                 ITEM-DETAIL-CS     PIC X(5).                     03500099
035100             15  FILLER             PIC X(1)    VALUE SPACES.     03510064
035200             15  ITEM-DETAIL-SEP    PIC X(1).                     03520067
035300             15  FILLER             PIC X(1)    VALUE SPACES.     03530067
035400                                                                  03540064
035500 01  STORE-DETAIL.                                                03550064
035600     05  STORE-DETAIL-X             OCCURS 5 TIMES.               03560064
035700         10  STORE-DETAIL-GRP       OCCURS 4 TIMES.               03570064
035800             15  STORE-DETAIL-STORE.                              03580099
035900                 20  STORE-DETAIL-STORE-NBR                       03590099
035900                                    PIC ZZZZ9.                    03591099
036000             15  FILLER             PIC X(2)    VALUE SPACES.     03600099
036100             15  STORE-DETAIL-SVC-PCT                             03610064
036200                                    PIC ZZ9.                      03620099
036300             15  STORE-DETAIL-SVC-PCT-X REDEFINES                 03630064
036400                 STORE-DETAIL-SVC-PCT                             03640064
036500                                    PIC X(3).                     03650099
036600             15  FILLER             PIC X(2)    VALUE SPACES.     03660099
036700             15  STORE-DETAIL-OH    PIC ----9.                    03670099
036800             15  STORE-DETAIL-OH-X REDEFINES                      03680064
036900                 STORE-DETAIL-OH    PIC X(5).                     03690099
037000             15  FILLER             PIC X(1)    VALUE SPACES.     03700099
037100             15  STORE-DETAIL-OO    PIC ----9.                    03710099
037200             15  STORE-DETAIL-OO-X REDEFINES                      03720064
037300                 STORE-DETAIL-OO    PIC X(5).                     03730099
037400             15  FILLER             PIC X(1)    VALUE SPACES.     03740099
037500             15  STORE-DETAIL-CS    PIC ----9.                    03750099
037600             15  STORE-DETAIL-CS-X REDEFINES                      03760064
037700                 STORE-DETAIL-CS    PIC X(5).                     03770099
037800             15  FILLER             PIC X(1)    VALUE SPACE.      03780064
037900             15  STORE-DETAIL-SEP   PIC X(1).                     03790067
038000             15  FILLER             PIC X(1)    VALUE SPACE.      03800067
038100                                                                  03810064
038110******************************************************************03811099
038120*    NI SKU WORK AREA FIELDS                                      03812099
038130******************************************************************03813099
038140     COPY ISWS006.                                                03814099
038150******************************************************************03815099
038160                                                                  03816099
038200     EXEC SQL                                                     03820099
038300         INCLUDE TSKXREF                                          03830099
038400     END-EXEC.                                                    03840099
038500                                                                  03850099
038510     EXEC SQL                                                     03851099
038520         INCLUDE TSKST                                            03852099
038530     END-EXEC.                                                    03853099
038540                                                                  03854099
038600     EXEC SQL                                                     03860099
038700         INCLUDE TSK                                              03870099
038800     END-EXEC.                                                    03880099
038900                                                                  03890099
039000     EXEC SQL                                                     03900099
039100         INCLUDE TSKSTOO                                          03910099
039200     END-EXEC.                                                    03920099
039300                                                                  03930099
039400     EXEC SQL                                                     03940099
039500         INCLUDE TMRITST                                          03950099
039600     END-EXEC.                                                    03960099
039700                                                                  03970099
039800     EXEC SQL                                                     03980099
039900         INCLUDE XMT00001                                         03990099
040000     END-EXEC.                                                    04000099
040100                                                                  04010099
040200*   DB2 COMMUNICATION AREA                                        04020099
040300     EXEC SQL                                                     04030099
040400        INCLUDE SQLCA                                             04040099
040500     END-EXEC.                                                    04050099
040600                                                                  04060099
040700*   DB2 COMMUNICATION AREA2                                       04070099
040800     COPY SQLCA2.                                                 04080099
040900                                                                  04090099
041000                                                                  04100099
041100 PROCEDURE DIVISION.                                              04110099
041200 M000-MAINLINE.                                                   04120099
041300                                                                  04130000
041400     PERFORM A100-INITIALIZATION.                                 04140099
041500                                                                  04150000
041600     PERFORM B100-PROD-BELOW-PCT-RPT                              04160094
041700        THRU B100-EXIT                                            04170099
041800        UNTIL BELOW-PCT-EOF.                                      04180005
041900                                                                  04190000
042000     PERFORM G100-CLOSE-UP.                                       04200099
042100                                                                  04210000
042200 M000-EXIT.                                                       04220094
042300     EXIT.                                                        04230000
042400     STOP RUN.                                                    04240000
042500                                                                  04250000
042600                                                                  04260000
042700 A100-INITIALIZATION.                                             04270094
042800                                                                  04280000
042900     OPEN INPUT  BELOW-PCT-FILE                                   04290005
043000          OUTPUT BELOW-PCT-RPT.                                   04300004
043100                                                                  04310000
043200     ACCEPT CPU-DATE FROM DATE.                                   04320005
043300     MOVE CPU-MM     TO DP132-RUN-MONTH.                          04330005
043400     MOVE CPU-DD     TO DP132-RUN-DAY.                            04340005
043500     MOVE CPU-YY     TO PV-WORK-YEAR-YY.                          04350059
043600     IF CPU-YY > 80                                               04360059
043700         MOVE 19 TO PV-WORK-YEAR-CC                               04370059
043800     ELSE                                                         04380059
043900         MOVE 20 TO PV-WORK-YEAR-CC                               04390099
044000     END-IF.                                                      04400099
044100     MOVE PV-WORK-YEAR  TO DP132-RUN-YEAR.                        04410059
044200                                                                  04420059
044300     ACCEPT CPU-TIME FROM TIME.                                   04430005
044400     MOVE CPU-HOUR   TO DP132-RUN-HOUR.                           04440005
044500     MOVE CPU-MINUTE TO DP132-RUN-MINUTE.                         04450005
044600                                                                  04460005
044700     MOVE PC-MRKRP091 TO DP132-PROGRAM-NAME.                      04470005
044800     MOVE 1 TO DP132-REPORT-NUMBER                                04480005
044900               PV-PAGE-NBR.                                       04490019
045000                                                                  04500099
045100     PERFORM U100-RESET-FOR-NEXT-RCD.                             04510099
045200                                                                  04520099
045300 A100-EXIT.                                                       04530094
045400     EXIT.                                                        04540000
045500                                                                  04550000
045600                                                                  04560000
045700 B100-PROD-BELOW-PCT-RPT.                                         04570094
045800                                                                  04580000
045900     PERFORM B110-READ-INPUT-FILE                                 04590099
046000        THRU B110-EXIT.                                           04600099
046100                                                                  04610000
046200     IF BELOW-PCT-EOF                                             04620004
046300         SET CLEANUP-PREV TO TRUE                                 04630099
046400     ELSE                                                         04640099
046500         IF MR031-ITEM-NBR > ZEROS                                04650099
046600             PERFORM C100-PROD-ITEM-SECT                          04660099
046700         ELSE                                                     04670099
046800             PERFORM D100-PROD-STORE-SECT                         04680099
046900         END-IF                                                   04690099
047000     END-IF.                                                      04700099
047100                                                                  04710099
047200     PERFORM E100-FORMAT-RPT.                                     04720099
047300                                                                  04730009
047400 B100-EXIT.                                                       04740094
047500     EXIT.                                                        04750000
047600                                                                  04760000
047700                                                                  04770000
047800 B110-READ-INPUT-FILE.                                            04780094
047900                                                                  04790004
048000     READ BELOW-PCT-FILE                                          04800004
048100         INTO MR031-SERVICE-LEVEL-EXT-RECORD                      04810004
048200             AT END                                               04820004
048300                 SET BELOW-PCT-EOF TO TRUE                        04830009
048400                 GO TO B110-EXIT.                                 04840094
048500                                                                  04850016
048600     IF FIRST-TIME                                                04860050
048700         MOVE MR031-BUSINESS-GROUP TO PREV-BUSINESS-GROUP         04870080
048800                                      DEPT-CLASS-1-BUS-GRP        04880080
048900         MOVE MR031-BUSINESS-GROUP-DESC                           04890080
049000                                   TO DEPT-CLASS-1-BUS-GRP-DESC   04900080
049100         MOVE MR031-DEPT-NBR       TO PREV-DEPT-NBR               04910080
049110                                      NI-DEPT-X-3                 04911099
049200         MOVE NI-DEPT-9-3          TO DEPT-CLASS-1-DEPT           04920099
049300         MOVE MR031-CLASS-NBR      TO PREV-CLASS-NBR              04930080
049400                                      PV-CLASS-NBR                04940080
049500         MOVE PV-CLASS-NBR-1       TO DEPT-CLASS-2-MAJ-CLS        04950080
049600         MOVE PV-CLASS-NBR-2       TO DEPT-CLASS-2-SUB-CLS        04960080
049700         MOVE MR031-VENDOR-STYLE   TO PREV-VENDOR-STYLE           04970080
049800                                      DEPT-CLASS-3-STYLE          04980080
049900         MOVE MR031-SKU-DESC       TO PREV-SKU-DESC               04990098
050000                                      DEPT-CLASS-3-DESC           05000098
050100         MOVE MR031-COLOR-DESC     TO PREV-COLOR-DESC             05010098
050200                                      DEPT-CLASS-3-COLOR          05020098
050300         MOVE MR031-BUYER-NBR      TO PREV-BUYER-NBR              05030098
050400                                      RPT-HEAD-BUYER-NBR          05040098
050500         MOVE MR031-BUYER-NAME     TO RPT-HEAD-BUYER-NAME         05050099
050600     END-IF.                                                      05060099
050700                                                                  05070080
050800     IF FIRST-TIME                                                05080080
050900         NEXT SENTENCE                                            05090080
051000     ELSE                                                         05100080
051100         IF CURR-RCD-ITEM                                         05110080
051200             SET PREV-RCD-ITEM  TO TRUE                           05120080
051300         ELSE                                                     05130080
051400             SET PREV-RCD-STORE TO TRUE                           05140099
051500         END-IF                                                   05150099
051600     END-IF.                                                      05160099
051700                                                                  05170080
051800     IF MR031-ITEM-NBR > ZEROS                                    05180080
051900         SET CURR-RCD-ITEM  TO TRUE                               05190080
052000     ELSE                                                         05200080
052100         SET CURR-RCD-STORE TO TRUE                               05210099
052200     END-IF.                                                      05220099
052300                                                                  05230009
052400     IF FIRST-TIME                                                05240051
052500         SET NOT-FIRST-TIME TO TRUE                               05250080
052600         GO TO B110-EXIT                                          05260099
052700     END-IF.                                                      05270099
052800**                                                                05280099
052900**  THE COMMENTED OUT LOGIC BELOW WORKED PROPERLY WHEN PAGE       05290099
053000**  BREAKS WERE BEING DONE ON BUYER CHANGES.  DUE TO INFOPAC      05300099
053100**  LIMITATIONS, THE LOGIC NEEDED TO BE CHANGED TO BREAK ON       05310099
053200**  BUYER AND DEPT CHANGES.  THE TESTING OF THE CHANGES WAS       05320099
053300**  LIMITED.  IN CASE THE CHANGES DO NOT WORK CORRECTLY, THE      05330099
053400**  OLD LOGIC WAS LEFT TO PROVIDE A STARTING POINT.               05340099
053500**                                                                05350099
053600     IF MR031-BUYER-NBR NOT = PREV-BUYER-NBR                      05360099
053700       OR MR031-DEPT-NBR NOT = PREV-DEPT-NBR                      05370099
053800         IF GROUP-CHG-2                                           05380099
053900             MOVE PREV-BUSINESS-GROUP TO DEPT-CLASS-1-BUS-GRP     05390099
054000             MOVE PREV-BUSINESS-GROUP-DESC                        05400099
054100                                   TO DEPT-CLASS-1-BUS-GRP-DESC   05410099
054200*            MOVE PREV-DEPT-NBR    TO DEPT-CLASS-1-DEPT           05420099
054300             MOVE PREV-CLASS-NBR   TO PV-CLASS-NBR                05430099
054400             MOVE PV-CLASS-NBR-1   TO DEPT-CLASS-2-MAJ-CLS        05440099
054500             MOVE PV-CLASS-NBR-2   TO DEPT-CLASS-2-SUB-CLS        05450099
054600             MOVE PREV-VENDOR-STYLE TO DEPT-CLASS-3-STYLE         05460099
054700             MOVE PREV-SKU-DESC    TO DEPT-CLASS-3-DESC           05470099
054800             MOVE PREV-COLOR-DESC  TO DEPT-CLASS-3-COLOR          05480099
054900         END-IF                                                   05490099
055000         MOVE MR031-BUYER-NBR      TO PREV-BUYER-NBR              05500099
055100         MOVE MR031-BUSINESS-GROUP TO PREV-BUSINESS-GROUP         05510099
055200         MOVE MR031-BUSINESS-GROUP-DESC                           05520099
055300                                   TO PREV-BUSINESS-GROUP-DESC    05530099
055400         MOVE MR031-DEPT-NBR       TO PREV-DEPT-NBR               05540099
055500         MOVE MR031-CLASS-NBR      TO PREV-CLASS-NBR              05550099
055600         MOVE MR031-VENDOR-STYLE   TO PREV-VENDOR-STYLE           05560099
055700         MOVE MR031-SKU-DESC       TO PREV-SKU-DESC               05570099
055800         MOVE MR031-COLOR-DESC     TO PREV-COLOR-DESC             05580099
055900         SET BUYER-DEPT-CHG-1 TO TRUE                             05590099
056000         GO TO B110-EXIT                                          05600099
056100     END-IF.                                                      05610099
056200                                                                  05620099
056300     IF (MR031-BUSINESS-GROUP NOT = PREV-BUSINESS-GROUP           05630099
056400*      OR MR031-DEPT-NBR NOT = PREV-DEPT-NBR                      05640099
056500       OR MR031-CLASS-NBR NOT = PREV-CLASS-NBR                    05650099
056600       OR MR031-VENDOR-STYLE NOT = PREV-VENDOR-STYLE              05660099
056700       OR MR031-SKU-DESC NOT = PREV-SKU-DESC                      05670099
056800       OR MR031-COLOR-DESC NOT = PREV-COLOR-DESC)                 05680099
056900                                                                  05690099
057000         IF (PREV-BUSINESS-GROUP NOT = DEPT-CLASS-1-BUS-GRP       05700099
057100*          OR PREV-DEPT-NBR NOT = DEPT-CLASS-1-DEPT               05710099
057200           OR PREV-CLASS-NBR NOT = PV-CLASS-NBR                   05720099
057300           OR PREV-VENDOR-STYLE NOT = DEPT-CLASS-3-STYLE          05730099
057400           OR PREV-SKU-DESC NOT = DEPT-CLASS-3-DESC               05740099
057500           OR PREV-COLOR-DESC NOT = DEPT-CLASS-3-COLOR)           05750099
057600             MOVE PREV-BUSINESS-GROUP  TO DEPT-CLASS-1-BUS-GRP    05760099
057700             MOVE PREV-BUSINESS-GROUP-DESC                        05770099
057800                                   TO DEPT-CLASS-1-BUS-GRP-DESC   05780099
057900*            MOVE PREV-DEPT-NBR        TO DEPT-CLASS-1-DEPT       05790099
058000             MOVE PREV-CLASS-NBR       TO PV-CLASS-NBR            05800099
058100             MOVE PV-CLASS-NBR-1       TO DEPT-CLASS-2-MAJ-CLS    05810099
058200             MOVE PV-CLASS-NBR-2       TO DEPT-CLASS-2-SUB-CLS    05820099
058300             MOVE PREV-VENDOR-STYLE    TO DEPT-CLASS-3-STYLE      05830099
058400             MOVE PREV-SKU-DESC        TO DEPT-CLASS-3-DESC       05840099
058500             MOVE PREV-COLOR-DESC      TO DEPT-CLASS-3-COLOR      05850099
058600             MOVE MR031-BUSINESS-GROUP TO PREV-BUSINESS-GROUP     05860099
058700             MOVE MR031-BUSINESS-GROUP-DESC                       05870099
058800                                       TO PREV-BUSINESS-GROUP-DESC05880099
058900*            MOVE MR031-DEPT-NBR       TO PREV-DEPT-NBR           05890099
059000             MOVE MR031-CLASS-NBR      TO PREV-CLASS-NBR          05900099
059100             MOVE MR031-VENDOR-STYLE   TO PREV-VENDOR-STYLE       05910099
059200             MOVE MR031-SKU-DESC       TO PREV-SKU-DESC           05920099
059300             MOVE MR031-COLOR-DESC     TO PREV-COLOR-DESC         05930099
059400             SET GROUP-CHG-1           TO TRUE                    05940099
059500             GO TO B110-EXIT                                      05950099
059600         ELSE                                                     05960099
059700             MOVE MR031-BUSINESS-GROUP TO PREV-BUSINESS-GROUP     05970099
059800             MOVE MR031-BUSINESS-GROUP-DESC                       05980099
059900                                       TO PREV-BUSINESS-GROUP-DESC05990099
060000*            MOVE MR031-DEPT-NBR       TO PREV-DEPT-NBR           06000099
060100             MOVE MR031-CLASS-NBR      TO PREV-CLASS-NBR          06010099
060200             MOVE MR031-VENDOR-STYLE   TO PREV-VENDOR-STYLE       06020099
060300             MOVE MR031-SKU-DESC       TO PREV-SKU-DESC           06030099
060400             MOVE MR031-COLOR-DESC     TO PREV-COLOR-DESC         06040099
060500             SET GROUP-CHG-1           TO TRUE                    06050099
060600             GO TO B110-EXIT                                      06060099
060700         END-IF                                                   06070099
060800     END-IF.                                                      06080099
060900                                                                  06090099
061000     IF PREV-RCD-ITEM AND CURR-RCD-STORE                          06100099
061100         SET CLEANUP-PREV TO TRUE                                 06110099
061200     END-IF.                                                      06120099
061300                                                                  06130099
061400 B110-EXIT.                                                       06140099
061500     EXIT.                                                        06150099
061600                                                                  06160099
061700                                                                  06170099
061800 C100-PROD-ITEM-SECT.                                             06180099
061900                                                                  06190099
062000     MOVE MR031-ITEM-NBR     TO PV-ITEM-NBR.                      06200099
062100     SET ITEM-ONHAND-NOT-EOF TO TRUE.                             06210099
062200                                                                  06220099
062300     PERFORM C110-SELECT-ITEM-ONHAND.                             06230099
062400                                                                  06240099
062500     IF ITEM-ONHAND-EOF                                           06250099
062600       OR PV-ITEM-ONHAND-IND < 0                                  06260099
062700         MOVE ZERO TO PV-ITEM-ONHAND                              06270099
062800     END-IF.                                                      06280099
062900                                                                  06290099
063000     SET ITEM-ONORDER-NOT-EOF TO TRUE.                            06300099
063100                                                                  06310099
063200     PERFORM C120-SELECT-ITEM-ONORDER.                            06320099
063300                                                                  06330099
063400     IF ITEM-ONORDER-EOF                                          06340099
063500       OR PV-ITEM-ONORDER-IND < 0                                 06350099
063600         MOVE ZERO TO PV-ITEM-ONORDER                             06360099
063700     END-IF.                                                      06370099
063800                                                                  06380099
063900     SET SIZE-DESC-NOT-EOF TO TRUE.                               06390099
064000                                                                  06400099
064100     PERFORM C125-SELECT-SIZE-DESC.                               06410099
064200                                                                  06420099
064300     IF SIZE-DESC-EOF                                             06430099
064400         MOVE SPACES TO PV-LONG-SIZE-DESC                         06440099
064500     END-IF.                                                      06450099
064600                                                                  06460099
064700     SET ITEM-COUNTER-STOCK-NOT-EOF TO TRUE.                      06470099
064800                                                                  06480099
064900     PERFORM C130-SELECT-ITEM-COUNTER-ST.                         06490099
065000                                                                  06500099
065100     IF ITEM-COUNTER-STOCK-EOF                                    06510099
065200       OR PV-ITEM-COUNTER-STOCK-IND < 0                           06520099
065300         MOVE ZERO TO PV-ITEM-COUNTER-STOCK                       06530099
065400     END-IF.                                                      06540099
065500                                                                  06550099
065600 C100-EXIT.                                                       06560099
065700     EXIT.                                                        06570099
065800                                                                  06580099
065900                                                                  06590099
066000 C110-SELECT-ITEM-ONHAND.                                         06600099
066100                                                                  06610099
066200     PERFORM                                                      06620099
066300         WITH TEST AFTER                                          06630099
066400         VARYING SQL-SUB                                          06640099
066500         FROM 1 BY 1                                              06650099
066600         UNTIL SQL-SUB > MAX-RETRIES                              06660099
066700            OR SQLCODE = ZERO                                     06670099
066800            OR SQLCODE = +100                                     06680099
066900         EXEC SQL                                                 06690099
067000             SELECT SUM(ONHAND_QTY)                               06700099
067100             INTO  :PV-ITEM-ONHAND:PV-ITEM-ONHAND-IND             06710099
067200             FROM TSKST A                                         06720099
067300                 ,TMRITST B                                       06730099
067400                 ,XMT_LOC C                                       06740099
067500             WHERE A.ITEM_NMBR  = :PV-ITEM-NBR                    06750099
067600               AND A.ITEM_NMBR  = B.ITEM_NBR                      06760099
067700               AND A.LOC_NBR    = B.STR_NBR                       06770099
067800               AND A.LOC_NBR   <> 0                               06780099
067900               AND B.FT_CDE    <> 'X'                             06790099
068000               AND C.LOC_NBR    = B.STR_NBR                       06800099
068100               AND C.E_BUS_IND  = 'N'                             06810099
068200         END-EXEC                                                 06820099
068300         EVALUATE TRUE                                            06830099
068400             WHEN SQLCODE = ZERO                                  06840099
068500             WHEN SQLCODE = -904                                  06850099
068600             WHEN SQLCODE = -913                                  06860099
068700                 CONTINUE                                         06870099
068800             WHEN SQLCODE = +100                                  06880099
068900                 SET ITEM-ONHAND-EOF TO TRUE                      06890099
069000             WHEN SQLWARN0 NOT = SPACES                           06900099
069100             WHEN SQLCODE  NOT = ZERO                             06910099
069200                  INITIALIZE PV-PARA-NAME                         06920099
069300                  MOVE 'C110-SELECT-ITEM-ONHAND' TO PV-PARA-NAME  06930099
069400                  PERFORM U998-SQL-ERROR                          06940099
069500         END-EVALUATE                                             06950099
069600     END-PERFORM.                                                 06960099
069700                                                                  06970099
069800 C110-EXIT.                                                       06980099
069900     EXIT.                                                        06990099
070000                                                                  07000099
070100                                                                  07010099
070200 C120-SELECT-ITEM-ONORDER.                                        07020099
070300                                                                  07030099
070310     MOVE PV-ITEM-NBR          TO SKXREF-ITM-NBR.                 07031099
070312                                                                  07031299
070400     PERFORM                                                      07040099
070500         WITH TEST AFTER                                          07050099
070600         VARYING SQL-SUB                                          07060099
070700         FROM 1 BY 1                                              07070099
070800         UNTIL SQL-SUB > MAX-RETRIES                              07080099
070900            OR SQLCODE = ZERO                                     07090099
071000            OR SQLCODE = +100                                     07100099
071100         EXEC SQL                                                 07110099
071200             SELECT SUM(A.ONORD_UNT_QTY)                          07120099
071300             INTO  :PV-ITEM-ONORDER:PV-ITEM-ONORDER-IND           07130099
071400             FROM TSKSTOO A,                                      07140099
071600                  TMRITST C,                                      07160099
071700                  XMT_LOC D,                                      07170099
071710                  TSKXREF E                                       07171099
071715             WHERE E.ITM_NBR    = :SKXREF-ITM-NBR                 07171599
071716               AND E.ITM_NBR    = C.ITEM_NBR                      07171699
071717               AND E.ITM_NBR    = A.ITM_NBR                       07171799
071718               AND A.STR_NBR    = D.LOC_NBR                       07171899
071719               AND C.STR_NBR    = D.LOC_NBR                       07171999
072700               AND A.STR_NBR   <> 0                               07270099
072800               AND C.FT_CDE    <> 'X'                             07280099
073000               AND D.E_BUS_IND  = 'N'                             07300099
073100         END-EXEC                                                 07310099
073200         EVALUATE TRUE                                            07320099
073300             WHEN SQLCODE = ZERO                                  07330099
073400             WHEN SQLCODE = -904                                  07340099
073500             WHEN SQLCODE = -913                                  07350099
073600                 CONTINUE                                         07360099
073700             WHEN SQLCODE = +100                                  07370099
073800                 SET ITEM-ONORDER-EOF TO TRUE                     07380099
073900             WHEN SQLWARN0 NOT = SPACES                           07390099
074000             WHEN SQLCODE  NOT = ZERO                             07400099
074100                  INITIALIZE PV-PARA-NAME                         07410099
074200                  MOVE 'C120-SELECT-ITEM-ONORDER' TO PV-PARA-NAME 07420099
074300                  PERFORM U998-SQL-ERROR                          07430099
074400         END-EVALUATE                                             07440099
074500     END-PERFORM.                                                 07450099
074600                                                                  07460099
074700 C120-EXIT.                                                       07470099
074800     EXIT.                                                        07480099
074900                                                                  07490099
075000                                                                  07500099
075100 C125-SELECT-SIZE-DESC.                                           07510099
075260                                                                  07526099
075270     MOVE PV-ITEM-NBR          TO TSK-ITEM-NMBR.                  07527099
075280                                                                  07528099
075300     PERFORM                                                      07530099
075400         WITH TEST AFTER                                          07540099
075500         VARYING SQL-SUB                                          07550099
075600         FROM 1 BY 1                                              07560099
075700         UNTIL SQL-SUB > MAX-RETRIES                              07570099
075800            OR SQLCODE = ZERO                                     07580099
075900            OR SQLCODE = +100                                     07590099
076000         EXEC SQL                                                 07600099
076100             SELECT LONG_SIZE_DESC                                07610099
076200             INTO  :PV-LONG-SIZE-DESC                             07620099
076300             FROM TSK                                             07630099
076600             WHERE ITEM_NMBR = :TSK-ITEM-NMBR                     07660099
076700         END-EXEC                                                 07670099
076800         EVALUATE TRUE                                            07680099
076900             WHEN SQLCODE = ZERO                                  07690099
077000             WHEN SQLCODE = -904                                  07700099
077100             WHEN SQLCODE = -913                                  07710099
077200                 CONTINUE                                         07720099
077300             WHEN SQLCODE = +100                                  07730099
077400                 SET SIZE-DESC-EOF TO TRUE                        07740099
077500             WHEN SQLWARN0 NOT = SPACES                           07750099
077600             WHEN SQLCODE  NOT = ZERO                             07760099
077700                  INITIALIZE PV-PARA-NAME                         07770099
077800                  MOVE 'C125-SELECT-SIZE-DESC' TO PV-PARA-NAME    07780099
077900                  PERFORM U998-SQL-ERROR                          07790099
078000         END-EVALUATE                                             07800099
078100     END-PERFORM.                                                 07810099
078200                                                                  07820099
078300 C125-EXIT.                                                       07830099
078400     EXIT.                                                        07840099
078500                                                                  07850099
078600                                                                  07860099
078700 C130-SELECT-ITEM-COUNTER-ST.                                     07870099
078800                                                                  07880099
078900     PERFORM                                                      07890099
079000        WITH TEST AFTER                                           07900099
079100        VARYING SQL-SUB                                           07910099
079200        FROM 1 BY 1                                               07920099
079300        UNTIL SQL-SUB > MAX-RETRIES                               07930099
079400           OR SQLCODE = ZERO                                      07940099
079500           OR SQLCODE = +100                                      07950099
079600        EXEC SQL                                                  07960099
079700            SELECT SUM(A.CSTOCK_QTY)                              07970099
079800            INTO  :PV-ITEM-COUNTER-STOCK:PV-ITEM-COUNTER-STOCK-IND07980099
079900            FROM  TMRITST A                                       07990099
080000                 ,XMT_LOC B                                       08000099
080100            WHERE A.ITEM_NBR  = :PV-ITEM-NBR                      08010099
080200              AND A.STR_NBR  <> 0                                 08020099
080300              AND B.LOC_NBR   = A.STR_NBR                         08030099
080400              AND B.E_BUS_IND = 'N'                               08040099
080500         END-EXEC                                                 08050099
080600         EVALUATE TRUE                                            08060099
080700            WHEN SQLCODE = ZERO                                   08070099
080800            WHEN SQLCODE = -904                                   08080099
080900            WHEN SQLCODE = -913                                   08090099
081000                CONTINUE                                          08100099
081100            WHEN SQLCODE = +100                                   08110099
081200                SET ITEM-COUNTER-STOCK-EOF TO TRUE                08120099
081300            WHEN SQLWARN0 NOT = SPACES                            08130099
081400            WHEN SQLCODE  NOT = ZERO                              08140099
081500                 INITIALIZE PV-PARA-NAME                          08150099
081600                 MOVE 'C130-SELECT-ITEM-COUNTER-ST'               08160099
081700                                      TO PV-PARA-NAME             08170099
081800                 PERFORM U998-SQL-ERROR                           08180099
081900         END-EVALUATE                                             08190099
082000     END-PERFORM.                                                 08200099
082100                                                                  08210099
082200 C130-EXIT.                                                       08220099
082300     EXIT.                                                        08230099
082400                                                                  08240099
082500                                                                  08250099
082600 D100-PROD-STORE-SECT.                                            08260099
082700                                                                  08270099
082800     MOVE MR031-STORE-NBR     TO PV-STORE-NBR.                    08280099
082900     SET STORE-ONHAND-NOT-EOF TO TRUE.                            08290099
083000                                                                  08300099
083100     PERFORM D110-SELECT-STORE-ONHAND.                            08310099
083200                                                                  08320099
083300     IF STORE-ONHAND-EOF                                          08330099
083400       OR PV-STORE-ONHAND-IND < 0                                 08340099
083500         MOVE ZERO TO PV-STORE-ONHAND                             08350099
083600     END-IF.                                                      08360099
083700                                                                  08370099
083800     SET STORE-ONORDER-NOT-EOF TO TRUE.                           08380099
083900                                                                  08390099
084000     PERFORM D120-SELECT-STORE-ONORDER.                           08400099
084100                                                                  08410099
084200     IF STORE-ONORDER-EOF                                         08420099
084300       OR PV-STORE-ONORDER-IND < 0                                08430099
084400         MOVE ZERO TO PV-STORE-ONORDER                            08440099
084500     END-IF.                                                      08450099
084600                                                                  08460099
084700     SET STORE-COUNTER-STOCK-NOT-EOF TO TRUE.                     08470099
084800                                                                  08480099
084900     PERFORM D130-SELECT-STORE-COUNTER-ST.                        08490099
085000                                                                  08500099
085100     IF STORE-COUNTER-STOCK-EOF                                   08510099
085200       OR PV-STORE-COUNTER-STOCK-IND < 0                          08520099
085300         MOVE ZERO TO PV-STORE-COUNTER-STOCK                      08530099
085400     END-IF.                                                      08540099
085500                                                                  08550099
085600 D100-EXIT.                                                       08560099
085700     EXIT.                                                        08570099
085800                                                                  08580099
085900                                                                  08590099
086000 D110-SELECT-STORE-ONHAND.                                        08600099
086100                                                                  08610099
086110     MOVE MR031-DEPT-NBR       TO NI-DEPT-X-3.                    08611099
086120     MOVE NI-DEPT-9-3          TO SKXREF-DEPT.                    08612099
086130     MOVE MR031-CLASS-NBR      TO NI-SUB-CLASS-X-2.               08613099
086140     MOVE NI-SUB-CLASS-9-2     TO SKXREF-SUBCLASS.                08614099
086141                                                                  08614199
086142     MOVE MR031-VENDOR-STYLE   TO TSK-LONG-VENDOR-STYLE.          08614299
086143     MOVE MR031-COLOR-DESC     TO TSK-LONG-COLOR-DESC.            08614399
086144     MOVE MR031-STORE-NBR      TO TSKST-LOC-NBR.                  08614499
086150                                                                  08615099
086200     PERFORM                                                      08620099
086300         WITH TEST AFTER                                          08630099
086400         VARYING SQL-SUB                                          08640099
086500         FROM 1 BY 1                                              08650099
086600         UNTIL SQL-SUB > MAX-RETRIES                              08660099
086700            OR SQLCODE = ZERO                                     08670099
086800            OR SQLCODE = +100                                     08680099
086900         EXEC SQL                                                 08690099
087000             SELECT SUM(A.ONHAND_QTY)                             08700099
087100             INTO  :PV-STORE-ONHAND:PV-STORE-ONHAND-IND           08710099
087200             FROM TSKST A,                                        08720099
087300                  TSK B,                                          08730099
087310                  TSKXREF C                                       08731099
087400             WHERE C.DEPT              = :SKXREF-DEPT             08740099
087500               AND C.SUBCLASS          = :SKXREF-SUBCLASS         08750099
087600               AND A.ITEM_NMBR         = B.ITEM_NMBR              08760099
087610               AND A.ITEM_NMBR         = C.ITM_NBR                08761099
087700               AND B.LONG_VENDOR_STYLE = :TSK-LONG-VENDOR-STYLE   08770099
087800               AND B.LONG_COLOR_DESC   = :TSK-LONG-COLOR-DESC     08780099
087900               AND A.LOC_NBR           = :TSKST-LOC-NBR           08790099
088000         END-EXEC                                                 08800099
088100         EVALUATE TRUE                                            08810099
088200             WHEN SQLCODE = ZERO                                  08820099
088300             WHEN SQLCODE = -904                                  08830099
088400             WHEN SQLCODE = -913                                  08840099
088500                 CONTINUE                                         08850099
088600             WHEN SQLCODE = +100                                  08860099
088700                 SET STORE-ONHAND-EOF TO TRUE                     08870099
088800             WHEN SQLWARN0 NOT = SPACES                           08880099
088900             WHEN SQLCODE  NOT = ZERO                             08890099
089000                  INITIALIZE PV-PARA-NAME                         08900099
089100                  MOVE 'D110-SELECT-STORE-ONHAND' TO PV-PARA-NAME 08910099
089200                  PERFORM U998-SQL-ERROR                          08920099
089300         END-EVALUATE                                             08930099
089400     END-PERFORM.                                                 08940099
089500                                                                  08950099
089600 D110-EXIT.                                                       08960099
089700     EXIT.                                                        08970099
089800                                                                  08980099
089900                                                                  08990099
090000 D120-SELECT-STORE-ONORDER.                                       09000099
090003                                                                  09000399
090010     MOVE MR031-DEPT-NBR       TO NI-DEPT-X-3.                    09001099
090020     MOVE NI-DEPT-9-3          TO SKXREF-DEPT.                    09002099
090021                                                                  09002199
090030     MOVE MR031-CLASS-NBR      TO NI-SUB-CLASS-X-2.               09003099
090040     MOVE NI-SUB-CLASS-9-2     TO SKXREF-SUBCLASS.                09004099
090041                                                                  09004199
090060     MOVE MR031-VENDOR-STYLE   TO TSK-LONG-VENDOR-STYLE.          09006099
090070     MOVE MR031-COLOR-DESC     TO TSK-LONG-COLOR-DESC.            09007099
090080     MOVE PV-STORE-NBR         TO SKSTOO-STR-NBR.                 09008099
090100                                                                  09010099
090200     PERFORM                                                      09020099
090300         WITH TEST AFTER                                          09030099
090400         VARYING SQL-SUB                                          09040099
090500         FROM 1 BY 1                                              09050099
090600         UNTIL SQL-SUB > MAX-RETRIES                              09060099
090700            OR SQLCODE = ZERO                                     09070099
090800            OR SQLCODE = +100                                     09080099
090900         EXEC SQL                                                 09090099
091000             SELECT SUM(A.ONORD_UNT_QTY)                          09100099
091100             INTO  :PV-STORE-ONORDER:PV-STORE-ONORDER-IND         09110099
091200             FROM TSKSTOO A,                                      09120099
091300                  TSK B,                                          09130099
091310                  TSKXREF C                                       09131099
091400             WHERE C.DEPT       = :SKXREF-DEPT                    09140099
091600               AND C.SUBCLASS   = :SKXREF-SUBCLASS                09160099
091800               AND C.ITM_NBR    = B.ITEM_NMBR                     09180099
091810               AND C.ITM_NBR    = A.ITM_NBR                       09181099
091900               AND B.LONG_VENDOR_STYLE = :TSK-LONG-VENDOR-STYLE   09190099
092000               AND B.LONG_COLOR_DESC   = :TSK-LONG-COLOR-DESC     09200099
092100               AND A.STR_NBR           = :SKSTOO-STR-NBR          09210099
092200         END-EXEC                                                 09220099
092300         EVALUATE TRUE                                            09230099
092400             WHEN SQLCODE = ZERO                                  09240099
092500             WHEN SQLCODE = -904                                  09250099
092600             WHEN SQLCODE = -913                                  09260099
092700                 CONTINUE                                         09270099
092800             WHEN SQLCODE = +100                                  09280099
092900                 SET STORE-ONORDER-EOF TO TRUE                    09290099
093000             WHEN SQLWARN0 NOT = SPACES                           09300099
093100             WHEN SQLCODE  NOT = ZERO                             09310099
093200                  INITIALIZE PV-PARA-NAME                         09320099
093300                  MOVE 'D120-SELECT-STORE-ONORDER'                09330099
093400                                          TO PV-PARA-NAME         09340099
093500                  PERFORM U998-SQL-ERROR                          09350099
093600         END-EVALUATE                                             09360099
093700     END-PERFORM.                                                 09370099
093800                                                                  09380099
093900 D120-EXIT.                                                       09390099
094000     EXIT.                                                        09400099
094100                                                                  09410099
094200                                                                  09420099
094300 D130-SELECT-STORE-COUNTER-ST.                                    09430099
094400                                                                  09440099
094410     MOVE MR031-DEPT-NBR       TO NI-DEPT-X-3.                    09441099
094420     MOVE NI-DEPT-9-3          TO SKXREF-DEPT.                    09442099
094430     MOVE MR031-CLASS-NBR      TO NI-SUB-CLASS-X-2.               09443099
094440     MOVE NI-SUB-CLASS-9-2     TO SKXREF-SUBCLASS.                09444099
094451                                                                  09445199
094452     MOVE MR031-VENDOR-STYLE   TO TSK-LONG-VENDOR-STYLE.          09445299
094453     MOVE MR031-COLOR-DESC     TO TSK-LONG-COLOR-DESC.            09445399
094454     MOVE MR031-STORE-NBR      TO MRITST-STR-NBR.                 09445499
094460                                                                  09446099
094500     PERFORM                                                      09450099
094600        WITH TEST AFTER                                           09460099
094700        VARYING SQL-SUB                                           09470099
094800        FROM 1 BY 1                                               09480099
094900        UNTIL SQL-SUB > MAX-RETRIES                               09490099
095000           OR SQLCODE = ZERO                                      09500099
095100           OR SQLCODE = +100                                      09510099
095200        EXEC SQL                                                  09520099
095300          SELECT SUM(A.CSTOCK_QTY)                                09530099
095400          INTO  :PV-STORE-COUNTER-STOCK:PV-STORE-COUNTER-STOCK-IND09540099
095500          FROM  TMRITST A,                                        09550099
095600                TSK B,                                            09560099
095610                TSKXREF C                                         09561099
095700          WHERE C.DEPT              = :SKXREF-DEPT                09570099
095800            AND C.SUBCLASS          = :SKXREF-SUBCLASS            09580099
096200            AND C.ITM_NBR           = A.ITEM_NBR                  09620099
096210            AND C.ITM_NBR           = B.ITEM_NMBR                 09621099
096220            AND B.LONG_VENDOR_STYLE = :TSK-LONG-VENDOR-STYLE      09622099
096230            AND B.LONG_COLOR_DESC   = :TSK-LONG-COLOR-DESC        09623099
096240            AND A.STR_NBR           = :MRITST-STR-NBR             09624099
096300        END-EXEC                                                  09630099
096400        EVALUATE TRUE                                             09640099
096500            WHEN SQLCODE = ZERO                                   09650099
096600            WHEN SQLCODE = -904                                   09660099
096700            WHEN SQLCODE = -913                                   09670099
096800               CONTINUE                                           09680099
096900            WHEN SQLCODE = +100                                   09690099
097000               SET STORE-COUNTER-STOCK-EOF TO TRUE                09700099
097100            WHEN SQLWARN0 NOT = SPACES                            09710099
097200            WHEN SQLCODE  NOT = ZERO                              09720099
097300               INITIALIZE PV-PARA-NAME                            09730099
097400               MOVE 'D130-SELECT-STORE-COUNTER-ST'                09740099
097500                                        TO PV-PARA-NAME           09750099
097600               PERFORM U998-SQL-ERROR                             09760099
097700        END-EVALUATE                                              09770099
097800     END-PERFORM.                                                 09780099
097900                                                                  09790099
098000 D130-EXIT.                                                       09800099
098100     EXIT.                                                        09810099
098200                                                                  09820099
098300                                                                  09830099
098400 E100-FORMAT-RPT.                                                 09840099
098500                                                                  09850099
098600     IF BUYER-DEPT-CHG-1                                          09860099
098700       OR GROUP-CHG-1                                             09870099
098800       OR CLEANUP-PREV                                            09880099
098900       OR ((PREV-RCD-ITEM AND CURR-RCD-ITEM)                      09890099
099000           AND (SUB-1 > 4 AND SUB-2 > 2))                         09900099
099100       OR ((PREV-RCD-STORE AND CURR-RCD-STORE)                    09910099
099200           AND (SUB-1 > 4 AND SUB-2 > 3))                         09920099
099300           PERFORM F100-PRINT-RPT                                 09930099
099400           PERFORM U100-RESET-FOR-NEXT-RCD                        09940099
099500     END-IF.                                                      09950099
099600                                                                  09960099
099700     PERFORM E120-MOVE-DATA.                                      09970099
099800                                                                  09980099
099900     SET DO-NOT-CLEANUP-PREV TO TRUE.                             09990099
100000                                                                  10000099
100100 E100-EXIT.                                                       10010099
100200     EXIT.                                                        10020099
100300                                                                  10030099
100400                                                                  10040099
100500 E120-MOVE-DATA.                                                  10050099
100600                                                                  10060099
100700     IF MR031-ITEM-NBR > ZEROS                                    10070099
100800         IF SUB-1 = 0                                             10080099
100900             MOVE 1 TO SUB-1                                      10090099
101000                       SUB-2                                      10100099
101100         ELSE                                                     10110099
101200             IF SUB-1 < 5                                         10120099
101300                 ADD 1 TO SUB-1                                   10130099
101400             ELSE                                                 10140099
101500                 MOVE 1 TO SUB-1                                  10150099
101600                 ADD 1  TO SUB-2                                  10160099
101700             END-IF                                               10170099
101800         END-IF                                                   10180099
101900         MOVE MR031-SKU                                           10190099
101910                      TO NI-SKU                                   10191099
101920         MOVE NI-SKU-9                                            10192099
102000                      TO ITEM-DETAIL-SKU (SUB-1, SUB-2)           10200099
102100         MOVE PV-LONG-SIZE-DESC                                   10210099
102200                      TO ITEM-DETAIL-DESC (SUB-1, SUB-2)          10220099
102300         MOVE MR031-SERVICE-LEVEL-PCT                             10230099
102400                      TO ITEM-DETAIL-SVC-PCT (SUB-1, SUB-2)       10240099
102500         MOVE PV-ITEM-ONHAND TO PV-ITEM-ONHAND-X                  10250099
102600         MOVE PV-ITEM-ONHAND-X                                    10260099
102700                      TO ITEM-DETAIL-OH (SUB-1, SUB-2)            10270099
102800         MOVE PV-ITEM-ONORDER TO PV-ITEM-ONORDER-X                10280099
102900         MOVE PV-ITEM-ONORDER-X                                   10290099
103000                      TO ITEM-DETAIL-OO (SUB-1, SUB-2)            10300099
103100         MOVE PV-ITEM-COUNTER-STOCK TO PV-ITEM-COUNTER-STOCK-X    10310099
103200         MOVE PV-ITEM-COUNTER-STOCK-X                             10320099
103300                      TO ITEM-DETAIL-CS (SUB-1, SUB-2)            10330099
103400     END-IF.                                                      10340099
103500                                                                  10350099
103600     IF MR031-STORE     > SPACES                                  10360099
103700         IF SUB-1 = 0                                             10370099
103800             MOVE 1 TO SUB-1                                      10380099
103900                       SUB-2                                      10390099
104000         ELSE                                                     10400099
104100             IF SUB-1 < 5                                         10410099
104200                 ADD 1 TO SUB-1                                   10420099
104300             ELSE                                                 10430099
104400                 MOVE 1 TO SUB-1                                  10440099
104500                 ADD 1  TO SUB-2                                  10450099
104600             END-IF                                               10460099
104700         END-IF                                                   10470099
104800         MOVE MR031-STORE-NBR                                     10480099
104900                      TO STORE-DETAIL-STORE-NBR (SUB-1, SUB-2)    10490099
105000         MOVE MR031-SERVICE-LEVEL-PCT                             10500099
105100                      TO STORE-DETAIL-SVC-PCT (SUB-1, SUB-2)      10510099
105200         MOVE PV-STORE-ONHAND TO PV-STORE-ONHAND-X                10520099
105300         MOVE PV-STORE-ONHAND-X                                   10530099
105400                      TO STORE-DETAIL-OH (SUB-1, SUB-2)           10540099
105500         MOVE PV-STORE-ONORDER TO PV-STORE-ONORDER-X              10550099
105600         MOVE PV-STORE-ONORDER-X                                  10560099
105700                      TO STORE-DETAIL-OO (SUB-1, SUB-2)           10570099
105800         MOVE PV-STORE-COUNTER-STOCK TO PV-STORE-COUNTER-STOCK-X  10580099
105900         MOVE PV-STORE-COUNTER-STOCK-X                            10590099
106000                      TO STORE-DETAIL-CS (SUB-1, SUB-2)           10600099
106100     END-IF.                                                      10610099
106200                                                                  10620099
106300 E120-EXIT.                                                       10630099
106400     EXIT.                                                        10640099
106500                                                                  10650099
106600                                                                  10660099
106700 F100-PRINT-RPT.                                                  10670099
106800                                                                  10680099
106900     IF (LINE-COUNT + 13) > LINES-ON-PAGE                         10690099
107000       OR BUYER-DEPT-CHG-2                                        10700099
107100         PERFORM F110-PRINT-RPT-TITLE                             10710099
107200         PERFORM F120-PRINT-DEPT-CLASS-HEAD                       10720099
107300         SET NOT-BUYER-DEPT-CHG-2 TO TRUE                         10730099
107400         IF GROUP-CHG-2 AND NOT GROUP-CHG-1                       10740099
107500             SET NOT-GROUP-CHG-2 TO TRUE                          10750099
107600         END-IF                                                   10760099
107700     ELSE                                                         10770099
107800         IF (GROUP-CHG-1 AND GROUP-CHG-2)                         10780099
107900           OR GROUP-CHG-2                                         10790099
108000             PERFORM F120-PRINT-DEPT-CLASS-HEAD                   10800099
108100             SET NOT-GROUP-CHG-2 TO TRUE                          10810099
108200         ELSE                                                     10820099
108300             NEXT SENTENCE                                        10830099
108400         END-IF                                                   10840099
108500     END-IF.                                                      10850099
108600                                                                  10860099
108700     PERFORM F130-PRINT-ITEM-OR-STORE-HEAD.                       10870099
108800                                                                  10880099
108900     PERFORM F140-PRINT-DETAIL-LINE.                              10890099
109000                                                                  10900099
109100     IF BELOW-PCT-EOF                                             10910099
109200         WRITE PRINT-LINE                                         10920099
109300             FROM PC-END-OF-RPT                                   10930099
109400                 AFTER ADVANCING SPACE-CONTROL                    10940099
109500     END-IF.                                                      10950099
109600                                                                  10960099
109700     IF BUYER-DEPT-CHG-1                                          10970099
109800         SET BUYER-DEPT-CHG-2 TO TRUE                             10980099
109900         SET NOT-BUYER-DEPT-CHG-1 TO TRUE                         10990099
110000     END-IF.                                                      11000099
110100                                                                  11010099
110200     IF GROUP-CHG-1                                               11020099
110300         SET GROUP-CHG-2     TO TRUE                              11030099
110400         SET NOT-GROUP-CHG-1 TO TRUE                              11040099
110500     END-IF.                                                      11050099
110600                                                                  11060099
110700 F100-EXIT.                                                       11070099
110800     EXIT.                                                        11080099
110900                                                                  11090099
111000                                                                  11100099
111100 F110-PRINT-RPT-TITLE.                                            11110099
111200                                                                  11120099
111300     MOVE PV-PAGE-NBR TO DP132-PAGE-NUMBER.                       11130099
111400                                                                  11140099
111500     WRITE PRINT-LINE                                             11150099
111600         FROM DP132-STANDRD-HEADER-132-COLS                       11160099
111700             AFTER ADVANCING PAGE.                                11170099
111800                                                                  11180099
111900     ADD 1 TO PV-PAGE-NBR.                                        11190099
112000                                                                  11200099
112100     MOVE 1 TO LINE-COUNT                                         11210099
112200               SPACE-CONTROL.                                     11220099
112300                                                                  11230099
112400     IF BUYER-DEPT-CHG-2                                          11240099
112500         MOVE MR031-BUYER-NBR     TO RPT-HEAD-BUYER-NBR           11250099
112600         MOVE MR031-BUYER-NAME    TO RPT-HEAD-BUYER-NAME          11260099
112700         MOVE MR031-DEPT-NBR      TO NI-DEPT-X-3                  11270099
112710         MOVE NI-DEPT-9-3         TO DEPT-CLASS-1-DEPT            11271099
112800     END-IF.                                                      11280099
112900                                                                  11290099
113000     WRITE PRINT-LINE                                             11300099
113100         FROM RPT-HEAD-1                                          11310099
113200             AFTER ADVANCING SPACE-CONTROL.                       11320099
113300                                                                  11330099
113400     ADD SPACE-CONTROL TO LINE-COUNT.                             11340099
113500                                                                  11350099
113600 F110-EXIT.                                                       11360099
113700     EXIT.                                                        11370099
113800                                                                  11380099
113900                                                                  11390099
114000 F120-PRINT-DEPT-CLASS-HEAD.                                      11400099
114100                                                                  11410099
114200     IF GROUP-CHG-2 OR BUYER-DEPT-CHG-2                           11420099
114300         IF GROUP-CHG-1 OR BUYER-DEPT-CHG-1                       11430099
114400             NEXT SENTENCE                                        11440099
114500         ELSE                                                     11450099
114600             MOVE MR031-BUSINESS-GROUP TO DEPT-CLASS-1-BUS-GRP    11460099
114700             MOVE MR031-BUSINESS-GROUP-DESC                       11470099
114800                                   TO DEPT-CLASS-1-BUS-GRP-DESC   11480099
114900*            MOVE MR031-DEPT-NBR       TO DEPT-CLASS-1-DEPT       11490099
115000             MOVE MR031-CLASS-NBR      TO PV-CLASS-NBR            11500099
115100             MOVE PV-CLASS-NBR-1       TO DEPT-CLASS-2-MAJ-CLS    11510099
115200             MOVE PV-CLASS-NBR-2       TO DEPT-CLASS-2-SUB-CLS    11520099
115300             MOVE MR031-VENDOR-STYLE   TO DEPT-CLASS-3-STYLE      11530099
115400             MOVE MR031-SKU-DESC       TO DEPT-CLASS-3-DESC       11540099
115500             MOVE MR031-COLOR-DESC     TO DEPT-CLASS-3-COLOR      11550099
115600         END-IF                                                   11560099
115700     END-IF.                                                      11570099
115800                                                                  11580099
115900     MOVE 2 TO SPACE-CONTROL.                                     11590099
116000                                                                  11600099
116100     WRITE PRINT-LINE                                             11610099
116200         FROM DEPT-CLASS-HEAD-1                                   11620099
116300             AFTER ADVANCING SPACE-CONTROL.                       11630099
116400                                                                  11640099
116500     ADD SPACE-CONTROL TO LINE-COUNT.                             11650099
116600     MOVE 1            TO SPACE-CONTROL.                          11660099
116700                                                                  11670099
116800     WRITE PRINT-LINE                                             11680099
116900         FROM DEPT-CLASS-HEAD-2                                   11690099
117000             AFTER ADVANCING SPACE-CONTROL.                       11700099
117100                                                                  11710099
117200     ADD SPACE-CONTROL TO LINE-COUNT.                             11720099
117300                                                                  11730099
117400     WRITE PRINT-LINE                                             11740099
117500         FROM DEPT-CLASS-HEAD-3                                   11750099
117600             AFTER ADVANCING SPACE-CONTROL.                       11760099
117700                                                                  11770099
117800     ADD SPACE-CONTROL TO LINE-COUNT.                             11780099
117900                                                                  11790099
118000 F120-EXIT.                                                       11800099
118100     EXIT.                                                        11810099
118200                                                                  11820099
118300                                                                  11830099
118400 F130-PRINT-ITEM-OR-STORE-HEAD.                                   11840099
118500                                                                  11850099
118600     IF PREV-RCD-ITEM                                             11860099
118700         PERFORM F131-SETUP-ITEM-HEAD                             11870099
118800     ELSE                                                         11880099
118900         PERFORM F132-SETUP-STORE-HEAD                            11890099
119000     END-IF.                                                      11900099
119100                                                                  11910099
119200     MOVE 2 TO SPACE-CONTROL.                                     11920099
119300                                                                  11930099
119400     IF PREV-RCD-ITEM                                             11940099
119500         WRITE PRINT-LINE                                         11950099
119600             FROM ITEM-COL-HEAD-1                                 11960099
119700                 AFTER ADVANCING SPACE-CONTROL                    11970099
119800     ELSE                                                         11980099
119900         WRITE PRINT-LINE                                         11990099
120000             FROM STORE-COL-HEAD-1                                12000099
120100                 AFTER ADVANCING SPACE-CONTROL                    12010099
120200     END-IF.                                                      12020099
120300                                                                  12030099
120400     ADD SPACE-CONTROL TO LINE-COUNT.                             12040099
120500     MOVE 1            TO SPACE-CONTROL.                          12050099
120600                                                                  12060099
120700     IF PREV-RCD-ITEM                                             12070099
120800         WRITE PRINT-LINE                                         12080099
120900             FROM ITEM-COL-HEAD-2                                 12090099
121000                 AFTER ADVANCING SPACE-CONTROL                    12100099
121100     ELSE                                                         12110099
121200         WRITE PRINT-LINE                                         12120099
121300             FROM STORE-COL-HEAD-2                                12130099
121400                 AFTER ADVANCING SPACE-CONTROL                    12140099
121500     END-IF.                                                      12150099
121600                                                                  12160099
121700     ADD SPACE-CONTROL TO LINE-COUNT.                             12170099
121800                                                                  12180099
121900 F130-EXIT.                                                       12190099
122000     EXIT.                                                        12200099
122100                                                                  12210099
122200                                                                  12220099
122300 F131-SETUP-ITEM-HEAD.                                            12230099
122400                                                                  12240099
122500     MOVE ITEM-COL-1 TO ITEM-COL-HEAD-1-X (1).                    12250099
122600     MOVE ITEM-COL-2 TO ITEM-COL-HEAD-2-X (1).                    12260099
122700     IF ITEM-DETAIL-SKU (1, 2) > SPACES                           12270099
122800         PERFORM VARYING SUB-4 FROM 1 BY 1                        12280099
122900             UNTIL SUB-4 > 5                                      12290099
123000                 MOVE '|' TO ITEM-DETAIL-SEP (SUB-4, 1)           12300099
123100         END-PERFORM                                              12310099
123200         MOVE ITEM-COL-1 TO ITEM-COL-HEAD-1-X (2)                 12320099
123300         MOVE ITEM-COL-2 TO ITEM-COL-HEAD-2-X (2)                 12330099
123400     END-IF.                                                      12340099
123500                                                                  12350099
123600     IF ITEM-DETAIL-SKU (1, 3) > SPACES                           12360099
123700         PERFORM VARYING SUB-4 FROM 1 BY 1                        12370099
123800             UNTIL SUB-4 > 5                                      12380099
123900                 MOVE '|' TO ITEM-DETAIL-SEP (SUB-4, 2)           12390099
124000         END-PERFORM                                              12400099
124100         MOVE ITEM-COL-1 TO ITEM-COL-HEAD-1-X (3)                 12410099
124200         MOVE ITEM-COL-2 TO ITEM-COL-HEAD-2-X (3)                 12420099
124300     END-IF.                                                      12430099
124400                                                                  12440099
124500 F131-EXIT.                                                       12450099
124600     EXIT.                                                        12460099
124700                                                                  12470099
124800                                                                  12480099
124900 F132-SETUP-STORE-HEAD.                                           12490099
125000                                                                  12500099
125100     MOVE STORE-COL-1 TO STORE-COL-HEAD-1-X (1).                  12510099
125200     MOVE STORE-COL-2 TO STORE-COL-HEAD-2-X (1).                  12520099
125300     IF STORE-DETAIL-STORE     (1, 2) > SPACES                    12530099
125400         PERFORM VARYING SUB-4 FROM 1 BY 1                        12540099
125500             UNTIL SUB-4 > 5                                      12550099
125600                 MOVE '|' TO STORE-DETAIL-SEP (SUB-4, 1)          12560099
125700         END-PERFORM                                              12570099
125800         MOVE STORE-COL-1 TO STORE-COL-HEAD-1-X (2)               12580099
125900         MOVE STORE-COL-2 TO STORE-COL-HEAD-2-X (2)               12590099
126000     END-IF.                                                      12600099
126100                                                                  12610099
126200     IF STORE-DETAIL-STORE     (1, 3) > SPACES                    12620099
126300         PERFORM VARYING SUB-4 FROM 1 BY 1                        12630099
126400             UNTIL SUB-4 > 5                                      12640099
126500                 MOVE '|' TO STORE-DETAIL-SEP (SUB-4, 2)          12650099
126600         END-PERFORM                                              12660099
126700         MOVE STORE-COL-1 TO STORE-COL-HEAD-1-X (3)               12670099
126800         MOVE STORE-COL-2 TO STORE-COL-HEAD-2-X (3)               12680099
126900     END-IF.                                                      12690099
127000                                                                  12700099
127100     IF STORE-DETAIL-STORE     (1, 4) > SPACES                    12710099
127200         PERFORM VARYING SUB-4 FROM 1 BY 1                        12720099
127300             UNTIL SUB-4 > 5                                      12730099
127400                 MOVE '|' TO STORE-DETAIL-SEP (SUB-4, 3)          12740099
127500         END-PERFORM                                              12750099
127600         MOVE STORE-COL-1 TO STORE-COL-HEAD-1-X (4)               12760099
127700         MOVE STORE-COL-2 TO STORE-COL-HEAD-2-X (4)               12770099
127800     END-IF.                                                      12780099
127900                                                                  12790099
128000 F132-EXIT.                                                       12800099
128100     EXIT.                                                        12810099
128200                                                                  12820099
128300                                                                  12830099
128400 F140-PRINT-DETAIL-LINE.                                          12840099
128500                                                                  12850099
128600     MOVE 2 TO SPACE-CONTROL.                                     12860099
128700                                                                  12870099
128800     IF PREV-RCD-ITEM                                             12880099
128900         PERFORM VARYING SUB-3 FROM 1 BY 1                        12890099
129000            UNTIL SUB-3 > 5                                       12900099
129100            WRITE PRINT-LINE FROM ITEM-DETAIL-X (SUB-3)           12910099
129200                AFTER ADVANCING SPACE-CONTROL                     12920099
129300            ADD SPACE-CONTROL TO LINE-COUNT                       12930099
129400            MOVE 1            TO SPACE-CONTROL                    12940099
129500         END-PERFORM                                              12950099
129600     ELSE                                                         12960099
129700         PERFORM VARYING SUB-3 FROM 1 BY 1                        12970099
129800            UNTIL SUB-3 > 5                                       12980099
129900            WRITE PRINT-LINE FROM STORE-DETAIL-X (SUB-3)          12990099
130000                AFTER ADVANCING SPACE-CONTROL                     13000099
130100            ADD SPACE-CONTROL TO LINE-COUNT                       13010099
130200            MOVE 1            TO SPACE-CONTROL                    13020099
130300         END-PERFORM                                              13030099
130400     END-IF.                                                      13040099
130500                                                                  13050099
130600 F140-EXIT.                                                       13060099
130700     EXIT.                                                        13070099
130800                                                                  13080099
130900                                                                  13090099
131000 G100-CLOSE-UP.                                                   13100099
131100                                                                  13110099
131200     CLOSE BELOW-PCT-FILE                                         13120099
131300           BELOW-PCT-RPT.                                         13130099
131400                                                                  13140099
131500 G100-EXIT.                                                       13150099
131600     EXIT.                                                        13160099
131700                                                                  13170099
131800                                                                  13180099
131900 U100-RESET-FOR-NEXT-RCD.                                         13190099
132000                                                                  13200099
132100     IF PREV-RCD-ITEM                                             13210099
132200       OR FIRST-TIME                                              13220099
132300         PERFORM VARYING SUB-1 FROM 1 BY 1                        13230099
132400             UNTIL SUB-1 > 5                                      13240099
132500             PERFORM VARYING SUB-2 FROM 1 BY 1                    13250099
132600                 UNTIL SUB-2 > 3                                  13260099
132610                 MOVE ZERO   TO ITEM-DETAIL-SKU  (SUB-1, SUB-2)   13261099
132800                 MOVE SPACES TO ITEM-DETAIL-DESC (SUB-1, SUB-2)   13280099
132900                                ITEM-DETAIL-SVC-PCT-X             13290099
133000                                                 (SUB-1, SUB-2)   13300099
133100                                ITEM-DETAIL-OH-X (SUB-1, SUB-2)   13310099
133200                                ITEM-DETAIL-OO-X (SUB-1, SUB-2)   13320099
133300                                ITEM-DETAIL-CS-X (SUB-1, SUB-2)   13330099
133400                                ITEM-DETAIL-SEP  (SUB-1, SUB-2)   13340099
133500             END-PERFORM                                          13350099
133600         END-PERFORM                                              13360099
133700         PERFORM VARYING SUB-1 FROM 1 BY 1                        13370099
133800             UNTIL SUB-1 > 3                                      13380099
133900                 MOVE SPACES TO ITEM-COL-HEAD-1-X (SUB-1)         13390099
134000                 MOVE SPACES TO ITEM-COL-HEAD-2-X (SUB-1)         13400099
134100         END-PERFORM                                              13410099
134200     END-IF.                                                      13420099
134300                                                                  13430099
134400     IF PREV-RCD-STORE                                            13440099
134500       OR FIRST-TIME                                              13450099
134600         PERFORM VARYING SUB-1 FROM 1 BY 1                        13460099
134700             UNTIL SUB-1 > 5                                      13470099
134800             PERFORM VARYING SUB-2 FROM 1 BY 1                    13480099
134900                 UNTIL SUB-2 > 4                                  13490099
135000                 MOVE SPACES TO STORE-DETAIL-STORE                13500099
135100                                                 (SUB-1, SUB-2)   13510099
135200                                STORE-DETAIL-SVC-PCT-X            13520099
135300                                                 (SUB-1, SUB-2)   13530099
135400                                STORE-DETAIL-OH-X                 13540099
135500                                                 (SUB-1, SUB-2)   13550099
135600                                STORE-DETAIL-OO-X                 13560099
135700                                                 (SUB-1, SUB-2)   13570099
135800                                STORE-DETAIL-CS-X                 13580099
135900                                                 (SUB-1, SUB-2)   13590099
136000                                STORE-DETAIL-SEP (SUB-1, SUB-2)   13600099
136100             END-PERFORM                                          13610099
136200         END-PERFORM                                              13620099
136300         PERFORM VARYING SUB-1 FROM 1 BY 1                        13630099
136400             UNTIL SUB-1 > 4                                      13640099
136500                 MOVE SPACES TO STORE-COL-HEAD-1-X (SUB-1)        13650099
136600                 MOVE SPACES TO STORE-COL-HEAD-2-X (SUB-1)        13660099
136700         END-PERFORM                                              13670099
136800     END-IF.                                                      13680099
136900                                                                  13690099
137000     MOVE 0 TO SUB-1                                              13700099
137100               SUB-2.                                             13710099
137200                                                                  13720099
137300 U100-EXIT.                                                       13730099
137400     EXIT.                                                        13740099
137500                                                                  13750099
137600                                                                  13760099
137700 U998-SQL-ERROR.                                                  13770099
137800                                                                  13780099
137900     MOVE SQLCODE    TO SQLCODE2.                                 13790099
138000     MOVE SQLERRD(3) TO SQLERRD3.                                 13800099
138100     DISPLAY '** ABEND **       ** = SQLWARNING'.                 13810099
138200     DISPLAY '** PROGRAM        ** = MRKRP091'.                   13820099
138300     DISPLAY '** PARAGRAPH NAME ** = ' PV-PARA-NAME.              13830099
138400     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  13840099
138500     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  13850099
138600     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   13860099
138700     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  13870099
138800                                                                  13880099
138900     MOVE 4013 TO ABEND-CODE.                                     13890099
139000     CALL 'ILBOABN0' USING ABEND-CODE.                            13900099
