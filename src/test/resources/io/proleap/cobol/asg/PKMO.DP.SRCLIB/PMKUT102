      *----------------------------------------------------------       00010013
       IDENTIFICATION DIVISION.                                         00020013
      *----------------------------------------------------------       00030013
       PROGRAM-ID.             PMKUT102.                                00040013
       AUTHOR.                 ALEXIS KEIKER                            00050013
       INSTALLATION.           KOHLS DEPARTMENT STORES.                 00060013
       DATE-WRITTEN.           AUGUST 2003.                             00070013
       DATE-COMPILED.                                                   00080013
      *----------------------------------------------------------       00090013
      *          PMKUT102 - PRICING EXCEPTION REPORT EXTRACT            00100013
      *----------------------------------------------------------       00110013
      *  THIS PROGRAM EXTRACTS PRICING INFORMATION FOR AN               00120013
      *  AD EVENT AND WRITES IT OUT TO A FILE.  THIS PROGRAM            00130013
      *  TAKES IN AN AD EVENT FILE AND USES A CURSOR TO FETCH           00140013
      *  ALL THE PROMO ITEMS ASSOCIATED WITH THIS AD EVENT.             00150013
      *  IT THEN LOADS THE PROMO ITEM ID'S TO A TEMPORARY               00160013
      *  WORKING STORAGE TABLE WITH AN INDICATOR TELLING IF IT          00170013
      *  BELONGS TO AN ADVERTISED OR UNADVERTISED PROMOTION.            00180013
      *  AFTER THIS IS DONE IT USES THIS TEMPORARY WORKING              00190013
      *  STORAGE CURSOR TO FETCH ONE PROMO ITEM ID AND ALL IT'S         00200013
      *  PRICING INFORMATION.  IT WILL THEN WRITE OUT EACH RECORD       00210013
      *  TO A FILE BASED ON WHAT STORES ARE CONTAINED IN THE            00220013
      *  CONTROL CARD.  IT WILL ALSO GET ALL THE EXCLUSIONS FOR         00230013
      *  THE PRICING INVOLVED AND WRITE THAT OUT TO THE FILE ALSO.      00240013
      *----------------------------------------------------------       00250013
      * HISTORY LOG:                                                    00260013
      *----------------------------------------------------------       00270013
      * DATE:        01/09/2004                                         00280013
      * WR/IR#:      WR25854                                            00290013
      * PROGRAMMER:  COLLEEN CUMMINGS                                   00300013
      * DESCRIPTION: CHANGED AD EVENT FILE TO 80 LENGTH TO ALLOW IT     00310013
      * TO BE A CONTROL CARD.  CHANGED TO PULL GP-PCT FOR NEW BOGO.     00320013
      *----------------------------------------------------------       00330013
      * DATE:        02/19/2004                                         00340013
      * WR/IR#:      P000634331                                         00350013
      * PROGRAMMER:  ALEXIS KEIKER                                      00360013
      * DESCRIPTION: FIXED THE LOGIC FOR NONREUSABLE ADHOCS.            00370013
      *----------------------------------------------------------       00380013
      * DATE:        02/19/2004                                         00390013
      * WR/IR#:      P000634331                                         00400013
      * PROGRAMMER:  COLLEEN CUMMINGS                                   00410013
      * DESCRIPTION: ADDED DISPLAYS - ABEND IN 5200.                    00420013
      *----------------------------------------------------------       00430013
      * DATE:        03/01/2004                                         00440013
      * WR/IR#:      P000637536                                         00450013
      * PROGRAMMER:  COLLEEN CUMMINGS                                   00460013
      * DESCRIPTION: ADDED CURSOR SHARING EXACT FOR ORACLE BUG.         00470013
      *----------------------------------------------------------       00480013
      * DATE:        01/03/2005                                         00490013
      * WR/IR#:      P000724034                                         00500013
      * PROGRAMMER:  COLLEEN CUMMINGS                                   00510013
      * DESCRIPTION: LOOK AT PROMO ITEM DATE/TIME INSTEAD OF            00520013
      *              PROMOTION DATE/TIME FOR UNADVERTISED PROMO ITEMS.  00530013
      *----------------------------------------------------------       00540013
      * DATE:        11/15/2005                                         00550013
      * WR/IR#:      P000822731                                         00560013
      * PROGRAMMER:  TOM BOYD                                           00570013
      * DESCRIPTION: PROCCESS BY PROMO ID INSTEAD OF BY AD EVENT ID.    00580013
      *----------------------------------------------------------       00590013
      * DATE:        05/20/2011                                         00600014
      * WR/IR#:      P000000007832                                      00610013
      * PROGRAMMER:  RAMYA KAVERI                                       00620013
      * DESCRIPTION: PERFORMANCE TUNING.                                00630013
      *----------------------------------------------------------       00640013
      * DATE:        09/29/2016                                         00641021
      * WR/IR#:      PRB0061122                                         00642021
      * PROGRAMMER:  Cognizant                                          00643021
      * DESCRIPTION: TO SEND CORRECT MDSE HIERARCHY CODE TO             00644021
      *              PMK069 TO PMK073 JOBS SO THAT PMK411U WILL         00644121
      *              UPDATE CORRECT PROMO PRICE WHICH WILL RESOLVE      00644221
      *              ISSUES IN MAIN VS NON MAIN AND BOGO OVERLAP        00644321
      *              REPORTS.                                           00644421
      *----------------------------------------------------------       00644528
      * DATE:        07/30/2018                                         00644728
      * WR/IR#:      CHG0204126                                         00644828
      * PROGRAMMER:  COGNIZANT                                          00644928
      * DESCRIPTION: ORACLE LOGON STANDARDS PROGRAM CHANGE              00645028
      *----------------------------------------------------------       00647028
       ENVIRONMENT DIVISION.                                            00650013
      *----------------------------------------------------------       00660013
       CONFIGURATION SECTION.                                           00670013
       SOURCE-COMPUTER. IBM-3090.                                       00680013
       OBJECT-COMPUTER. IBM-3090.                                       00690013
                                                                        00700013
       INPUT-OUTPUT SECTION.                                            00710013
                                                                        00720013
       FILE-CONTROL.                                                    00730013
                                                                        00740013
           SELECT CONTROL-CARD-FILE-STR                                 00750013
                  ASSIGN TO INP01.                                      00760013
                                                                        00770013
TB1115*    SELECT AD-EVENT-FILE                                         00780013
TB1115     SELECT PROMO-FILE                                            00790013
                  ASSIGN TO INP02.                                      00800013
                                                                        00800122
070941     SELECT ORACLE-LOGON-FILE                                     00801022
070941            ASSIGN TO ORALOGON.                                   00802022
                                                                        00810013
           SELECT EXCPT-PRICG-EXT-FILE                                  00820013
                  ASSIGN TO OUT01.                                      00830013
                                                                        00840013
      *----------------------------------------------------------       00850013
       DATA DIVISION.                                                   00860013
      *----------------------------------------------------------       00870013
       FILE SECTION.                                                    00880013
                                                                        00890013
       FD  CONTROL-CARD-FILE-STR                                        00900013
           RECORDING MODE F                                             00910013
           BLOCK CONTAINS 0 RECORDS                                     00920013
           LABEL RECORDS ARE OMITTED                                    00930013
           DATA RECORD IS CONTROL-CARD-REC-STR.                         00940013
       01  CONTROL-CARD-REC-STR             PIC X(80).                  00950013
                                                                        00960013
TB1115 FD  PROMO-FILE                                                   00970013
           RECORDING MODE F                                             00980013
           BLOCK CONTAINS 0 RECORDS                                     00990013
           LABEL RECORDS ARE OMITTED                                    01000013
TB1115     DATA RECORD IS PROMO-ID-RECORD.                              01010013
TB1115 01  PROMO-ID-RECORD                  PIC X(80).                  01020013
                                                                        01020122
070941 FD  ORACLE-LOGON-FILE                                            01021022
070941     RECORDING MODE IS F                                          01022022
070941     LABEL RECORDS ARE STANDARD                                   01023022
070941     BLOCK CONTAINS 0 RECORDS                                     01024022
070941     RECORD CONTAINS 80 CHARACTERS                                01025022
070941     DATA RECORDS IS OL-ORACLE-LOGON-RECORD.                      01026022
070941 01  OL-ORACLE-LOGON-RECORD           PIC X(80).                  01027022
                                                                        01030013
       FD  EXCPT-PRICG-EXT-FILE                                         01040013
           RECORDING MODE F                                             01050013
           BLOCK CONTAINS 0 RECORDS                                     01060013
           LABEL RECORDS ARE OMITTED                                    01070013
           DATA RECORD IS EXCPT-PRICG-EXT-REC.                          01080013
       01  EXCPT-PRICG-EXT-REC              PIC X(154).                 01090013
                                                                        01100013
       WORKING-STORAGE SECTION.                                         01110013
      *----------------------------------------------------------       01120013
      * ABEND- ABEND VARIABLES                                          01130013
      *----------------------------------------------------------       01140013
       01  ABEND-CODE                       PIC S9(04) COMP VALUE +0.   01150013
           88  ABEND-4001-WRITE-ERROR                  VALUE +4001.     01160013
           88  ABEND-4002-READ-ERROR                   VALUE +4002.     01170013
           88  ABEND-4003-CTRL-CARD-ERROR              VALUE +4003.     01180013
           88  ABEND-4004-TABLE-ERROR                  VALUE +4004.     01190013
           88  ABEND-4005-OPEN-ERROR                   VALUE +4005.     01200013
           88  ABEND-4006-CLOSE-ERROR                  VALUE +4006.     01210013
           88  ABEND-4007-SEQUENCE-ERROR               VALUE +4007.     01220013
           88  ABEND-4008-DATA-ERROR                   VALUE +4008.     01230013
           88  ABEND-4009-KEY-DATA-ERROR               VALUE +4009.     01240013
           88  ABEND-4013-SQL-ERROR                    VALUE +4013.     01250013
           88  ABEND-4014-ORACLE-LOGON-ERROR           VALUE +4014.     01260013
           88  ABEND-4019-DATE-ROUTINE-ERROR           VALUE +4019.     01270013
           88  ABEND-4444-FORCED-ABEND                 VALUE +4444.     01280013
                                                                        01290013
      *----------------------------------------------------------       01300013
      * CC- CONTROL CARD                                                01310013
      *----------------------------------------------------------       01320013
       01  CC-PROMO-ID-REC.                                             01330013
           05  CC-PROMO-ID                    PIC 9(10) VALUE 0.        01340013
           05  FILLER                         PIC X(70) VALUE SPACES.   01350013
       01  CC-CONTROL-CARD-REC-STR.                                     01360013
           05  CC-STR-NBR                     PIC 9(04) VALUE 0.        01370013
           05  FILLER                         PIC X(76) VALUE SPACES.   01380013
                                                                        01390013
      *----------------------------------------------------------       01400013
      * PS- PROGRAM SWITCHES                                            01410013
      *----------------------------------------------------------       01420013
       01  PS-PROGRAM-SWITCHES.                                         01430013
070941     05  PS-END-OF-LOGON-FILE-SW      PIC X(01)  VALUE 'N'.       01431027
070941         88  PS-END-OF-LOGON-FILE                VALUE 'Y'.       01432022
070941     05  PS-ORA-SRC-CTL-DONE-SW       PIC X(01)  VALUE 'N'.       01433027
070941         88  PS-ORA-SRC-EMPTY                    VALUE 'Y'.       01434022
           05  PS-CONTROL-CARD-STR-SW       PIC X(01)  VALUE 'N'.       01440013
               88  PS-END-OF-CC-FILE-STR               VALUE 'Y'.       01450013
               88  PS-NOT-END-OF-CC-FILE-STR           VALUE 'N'.       01460013
           05  PS-END-OF-PROMO-FILE-SW      PIC X(01)  VALUE 'N'.       01470013
               88  PS-END-OF-PROMO-FILE                VALUE 'Y'.       01480013
               88  PS-NOT-END-OF-PROMO-FILE            VALUE 'N'.       01490013
           05  PS-END-OF-ADPRCG-CSR-SW      PIC X(01)  VALUE 'N'.       01500013
               88  PS-END-OF-ADPRCG-CSR                VALUE 'Y'.       01510013
               88  PS-NOT-END-OF-ADPRCG-CSR            VALUE 'N'.       01520013
           05  PS-END-OF-UNADPRCG-CSR-SW    PIC X(01)  VALUE 'N'.       01530013
               88  PS-END-OF-UNADPRCG-CSR              VALUE 'Y'.       01540013
               88  PS-NOT-END-OF-UNADPRCG-CSR          VALUE 'N'.       01550013
           05  PS-END-OF-EXCL-CSR-SW        PIC X(01)  VALUE 'N'.       01560013
               88  PS-END-OF-EXCL-CSR                  VALUE 'Y'.       01570013
               88  PS-NOT-END-OF-EXCL-CSR              VALUE 'N'.       01580013
           05  PS-END-OF-READHC-CSR-SW      PIC X(01)  VALUE 'N'.       01590013
               88  PS-END-OF-READHC-CSR                VALUE 'Y'.       01600013
               88  PS-NOT-END-OF-READHC-CSR            VALUE 'N'.       01610013
           05  PS-END-OF-ADHCSTR-CSR-SW     PIC X(01)  VALUE 'N'.       01620013
               88  PS-END-OF-ADHCSTR-CSR               VALUE 'Y'.       01630013
               88  PS-NOT-END-OF-ADHCSTR-CSR           VALUE 'N'.       01640013
           05  PS-KIND-OF-GP-PRC-SW         PIC X(01)  VALUE 'S'.       01650013
               88  PS-JUST-GP-PRC                      VALUE 'G'.       01660013
               88  PS-SMP-GP-PRC                       VALUE 'A'.       01670013
               88  PS-JUST-SMP-PRC                     VALUE 'S'.       01680013
           05  PS-END-OF-UNAD-STR-CSR-SW    PIC X(01)  VALUE 'N'.       01690013
               88  PS-END-OF-UNAD-STR-CSR              VALUE 'Y'.       01700013
               88  PS-NOT-END-UNAD-STR-CSR             VALUE 'N'.       01710013
           05  PS-END-OF-ADSTRP-CSR-SW      PIC X(01)  VALUE 'N'.       01720013
               88  PS-END-OF-ADSTRP-CSR                VALUE 'Y'.       01730013
               88  PS-NOT-END-OF-ADSTRP-CSR            VALUE 'N'.       01740013
                                                                        01750013
070941 01  CC-ORACLE-CONNECTION.                                        01751022
070941     05  CC-ORACLE-USERID             PIC X(40).                  01752022
070941         88 CC-AUTO-LOGON                        VALUE '/'.       01753022
070941     05  CC-ORACLE-PASSWORD           PIC X(40).                  01754022
                                                                        01755022
      *----------------------------------------------------------       01760013
      * PC- PROGRAM CONSTANTS                                           01770013
      *----------------------------------------------------------       01780013
       01  PC-PROGRAM-CONSTANTS.                                        01790013
070941*    05  PC-CURRENT-PROGRAM-NAME      PIC X(08)  VALUE            01800027
070941     05  PC-AUTO-LOGON                PIC X(1)   VALUE '/'.       01801022
           05  PC-PROGRAM-NAME              PIC X(08)  VALUE            01802022
                                                      'PMKUT102'.       01810013
                                                                        01820013
      *----------------------------------------------------------       01830013
      * PV- PROGRAM VARIABLES                                           01840013
      *----------------------------------------------------------       01850013
       01  PV-PROGRAM-VARIABLES.                                        01860013
070941     05  PV-ORACLE-USERID-LEN         PIC S9(4)  VALUE ZEROS      01861026
070941                                                 COMP SYNC.       01862022
070941     05  PV-ORACLE-PASSWORD-LEN       PIC S9(4)  VALUE ZEROS      01863026
070941                                                 COMP SYNC.       01864022
070941     05  PC-AUTO-LOGON                PIC X(01)  VALUE '/'.       01865026
           05  PV-TABLE-NAME                PIC X(30)  VALUE SPACES.    01870013
           05  PV-SQL-CODE                  PIC 9(09)  VALUE 0.         01880013
           05  PV-OPERATION-MSG             PIC X(60)  VALUE SPACES.    01890013
           05  PV-OPERATION-MSG-1           PIC X(40)  VALUE SPACES.    01900013
           05  PV-PARAGRAPH-NAME            PIC X(30)  VALUE SPACES.    01910013
           05  PV-SAVE-VAR                  PIC X(10)  VALUE SPACES.    01920013
           05  PV-SYS-DATE                  PIC X(21)  VALUE SPACES.    01930013
           05  PV-SAVE-NUM                  PIC 9(02)  VALUE 0.         01940013
           05  PV-SAVE-MDSE-SELN-ID         PIC S9(10) VALUE +0         01950013
                                            COMP-3.                     01960013
           05  PV-SAVE-MDSE-PRICG-ID        PIC S9(10) VALUE +0         01970013
                                            COMP-3.                     01980013
           05  PV-PROMO-ITM-ID              PIC S9(10) VALUE +0         01990013
                                            COMP-3.                     02000013
           05  PV-GP-PROMO-INTFC-ID         PIC S9(10) VALUE +0         02010013
                                            COMP-3.                     02020013
           05  PV-GP-PRICG-TYP-CDE          PIC X(03)  VALUE SPACES.    02030013
           05  PV-GROUP-QTY                 PIC S9(05) VALUE +0         02040013
                                            COMP-3.                     02050013
           05  PV-GROUP-AMT                 PIC S9(07)V9(02) COMP-3     02060013
                                                       VALUE +0.        02070013
           05  PV-GROUP-PCT                 PIC S9(03)V9(03) COMP-3     02080013
                                                       VALUE +0.        02090013
           05  PV-HOST-STRS.                                            02100013
               10  PV-HOST-STR-1            PIC S9(04) VALUE +0         02110013
                                            COMP-3.                     02120013
               10  PV-HOST-STR-2            PIC S9(04) VALUE +0         02130013
                                            COMP-3.                     02140013
               10  PV-HOST-STR-3            PIC S9(04) VALUE +0         02150013
                                            COMP-3.                     02160013
               10  PV-HOST-STR-4            PIC S9(04) VALUE +0         02170013
                                            COMP-3.                     02180013
               10  PV-HOST-STR-5            PIC S9(04) VALUE +0         02190013
                                            COMP-3.                     02200013
               10  PV-HOST-STR-6            PIC S9(04) VALUE +0         02210013
                                            COMP-3.                     02220013
               10  PV-HOST-STR-7            PIC S9(04) VALUE +0         02230013
                                            COMP-3.                     02240013
               10  PV-HOST-STR-8            PIC S9(04) VALUE +0         02250013
                                            COMP-3.                     02260013
               10  PV-HOST-STR-9            PIC S9(04) VALUE +0         02270013
                                            COMP-3.                     02280013
               10  PV-HOST-STR-10           PIC S9(04) VALUE +0         02290013
                                            COMP-3.                     02300013
                                                                        02310013
           05  PV-NULL-IND.                                             02320013
               10  PV-INTFC-NULL            PIC S9(4) VALUE +0 COMP.    02330013
               10  PV-GP-INTFC-NULL         PIC S9(4) VALUE +0 COMP.    02340013
               10  PV-ITM-DESC-NULL         PIC S9(4) VALUE +0 COMP.    02350013
               10  PV-DEPT-NULL             PIC S9(4) VALUE +0 COMP.    02360013
               10  PV-MAJ-CL-NULL           PIC S9(4) VALUE +0 COMP.    02370013
               10  PV-SUB-CL-NULL           PIC S9(4) VALUE +0 COMP.    02380013
               10  PV-STYLE-NULL            PIC S9(4) VALUE +0 COMP.    02390013
               10  PV-SKU-NBR-NULL          PIC S9(4) VALUE +0 COMP.    02400013
               10  PV-PRICG-TYP-NULL        PIC S9(4) VALUE +0 COMP.    02410013
               10  PV-PRICG-AMT-NULL        PIC S9(4) VALUE +0 COMP.    02420013
               10  PV-ADHC-STR-GP-NULL      PIC S9(4) VALUE +0 COMP.    02430013
               10  PV-RUSBL-NULL            PIC S9(4) VALUE +0 COMP.    02440013
               10  PV-GP-PRICG-TYP-NULL     PIC S9(4) VALUE +0 COMP.    02450013
               10  PV-GP-QTY-NULL           PIC S9(4) VALUE +0 COMP.    02460013
               10  PV-GP-AMT-NULL           PIC S9(4) VALUE +0 COMP.    02470013
               10  PV-GP-PCT-NULL           PIC S9(4) VALUE +0 COMP.    02480013
               10  PV-MDSE-HIER-NULL        PIC S9(4) VALUE +0 COMP.    02490013
               10  PV-ADHC-STR-NULL         PIC S9(4) VALUE +0 COMP.    02500013
               10  PV-EFF-STR-NULL          PIC S9(4) VALUE +0 COMP.    02510013
               10  PV-TEMP1-NULL            PIC S9(4) VALUE +0 COMP.    02520013
               10  PV-TEMP2-NULL            PIC S9(4) VALUE +0 COMP.    02530013
               10  PV-TEMP3-NULL            PIC S9(4) VALUE +0 COMP.    02540013
               10  PV-TEMP4-NULL            PIC S9(4) VALUE +0 COMP.    02550013
               10  PV-TEMP5-NULL            PIC S9(4) VALUE +0 COMP.    02560013
               10  PV-TEMP6-NULL            PIC S9(4) VALUE +0 COMP.    02570013
               10  PV-TEMP-TXT-NULL         PIC S9(4) VALUE +0 COMP.    02580013
                                                                        02590013
       01  PV-SELECT-VARIABLES.                                         02600013
           05  PV-AD-EVNT-ID                PIC S9(10) VALUE +0         02610013
                                            COMP-3.                     02620013
           05  PV-PROMO-ID                  PIC S9(10) VALUE +0         02630013
                                            COMP-3.                     02640013
           05  PV-REG-PROMO-TYP-CDE         PIC X(02)  VALUE SPACES.    02650013
           05  PV-PROMO-DEPT-NBR            PIC S9(04) VALUE +0         02660013
                                            COMP-3.                     02670013
           05  PV-PROMO-STRT-TMST           PIC X(19)  VALUE SPACES.    02680013
           05  PV-PROMO-END-TMST            PIC X(19)  VALUE SPACES.    02690013
           05  PV-PRCG-STRT-TMST            PIC X(19)  VALUE SPACES.    02700013
           05  PV-PRCG-END-TMST             PIC X(19)  VALUE SPACES.    02710013
           05  PV-MDSE-SELN-ID              PIC S9(10) VALUE +0         02720013
                                            COMP-3.                     02730013
           05  PV-PROMO-INTFC-ID            PIC S9(10) VALUE +0         02740013
                                            COMP-3.                     02750013
           05  PV-MDSE-SELN-DESC            PIC X(20)  VALUE SPACES.    02760013
           05  PV-DEPT-NBR                  PIC S9(04) VALUE +0         02770013
                                            COMP-3.                     02780013
           05  PV-MDSE-HIER-CDE             PIC X(03)  VALUE SPACES.    02790013
           05  PV-MDSE-SELN-LNE-ID          PIC S9(10) VALUE +0         02800013
                                            COMP-3.                     02810013
           05  PV-MAJ-CL-NBR                PIC S9(04) VALUE +0         02820013
                                            COMP-3.                     02830013
           05  PV-SUB-CL-NBR                PIC S9(04) VALUE +0         02840013
                                            COMP-3.                     02850013
           05  PV-VS-ID                     PIC S9(09) VALUE +0         02860013
                                            COMP-3.                     02870013
           05  PV-SKU-NBR                   PIC S9(08) VALUE +0         02880013
                                            COMP-3.                     02890013
           05  PV-MDSE-LNE-PRICG-ID         PIC S9(10) VALUE +0         02900013
                                            COMP-3.                     02910013
           05  PV-PRICG-TYP-CDE             PIC X(03)  VALUE SPACES.    02920013
           05  PV-PRICG-AMT                 PIC S9(07)V9(03) COMP-3     02930013
                                                       VALUE +0.        02940013
           05  PV-STR-SELN-ID               PIC S9(10)  VALUE +0        02950013
                                            COMP-3.                     02960013
           05  PV-EFF-STR-GP-ID             PIC S9(10)  VALUE +0        02970013
                                            COMP-3.                     02980013
           05  PV-STR-SELN-TYP-CDE          PIC X(01)  VALUE SPACES.    02990013
           05  PV-ADHC-STR-GP-ID            PIC S9(10)  VALUE +0        03000013
                                            COMP-3.                     03010013
           05  PV-STR-GP-ID                 PIC S9(04)  VALUE +0        03020013
                                            COMP-3.                     03030013
           05  PV-STR-GP-TYP-CDE            PIC S9(04)  VALUE +0        03040013
                                            COMP-3.                     03050013
           05  PV-STR-GP-NM                 PIC X(30)  VALUE SPACES.    03060013
           05  PV-RUSBL-IND                 PIC X(01)  VALUE SPACES.    03070013
           05  PV-MDSE-LNE-EXCLN-ID         PIC S9(10) VALUE +0         03080013
                                            COMP-3.                     03090013
           05  PV-STR-NBR-UN-A              PIC S9(04)  VALUE +0        03100013
                                            COMP-3.                     03110013
           05  PV-EFF-STR-GP-ID-UN-A        PIC S9(10)  VALUE +0        03120013
                                            COMP-3.                     03130013
           05  PV-STR-SELN-TYP-CDE-UN-A     PIC X(01)  VALUE SPACES.    03140013
           05  PV-STR-SELN-ID-UN-A          PIC S9(10)  VALUE +0        03150013
                                            COMP-3.                     03160013
           05  PREV-SEL-ID                  PIC S9(10)  VALUE +0        03170013
                                            COMP-3.                     03180013
           05  PV-STR-SELN-ID-UN-P          PIC S9(10)  VALUE +0        03190013
                                            COMP-3.                     03200013
           05  PV-STR-NBR-UN-P              PIC S9(04)  VALUE +0        03210013
                                            COMP-3.                     03220013
           05  PV-EFF-STR-GP-ID-UN-P        PIC S9(10)  VALUE +0        03230013
                                            COMP-3.                     03240013
           05  PV-STR-SELN-TYP-CDE-UN-P     PIC X(01)  VALUE SPACES.    03250013
           05  PV-STR-SELN-ID-AD-P          PIC S9(10)  VALUE +0        03260013
                                            COMP-3.                     03270013
           05  PV-STR-NBR-AD-P              PIC S9(04)  VALUE +0        03280013
                                            COMP-3.                     03290013
           05  PV-EFF-STR-GP-ID-AD-P        PIC S9(10)  VALUE +0        03300013
                                            COMP-3.                     03310013
           05  PV-STR-SELN-TYP-CDE-AD-P     PIC X(01)  VALUE SPACES.    03320013
           05  PV-STR-SELN-ID-AD-A          PIC S9(10)  VALUE +0        03330013
                                            COMP-3.                     03340013
           05  PV-STR-NBR-AD-A              PIC S9(04)  VALUE +0        03350013
                                            COMP-3.                     03360013
           05  PV-EFF-STR-GP-ID-AD-A        PIC S9(10)  VALUE +0        03370013
                                            COMP-3.                     03380013
           05  PV-STR-SELN-TYP-CDE-AD-A     PIC X(01)  VALUE SPACES.    03390013
                                                                        03400013
      *----------------------------------------------------------       03410013
      * PA- PROGRAM ACCUMULATORS                                        03420013
      *----------------------------------------------------------       03430013
       01  PA-PROGRAM-ACCUMULATORS.                                     03440013
           05  PA-RECS-WRITTEN              PIC 9(09) VALUE ZEROES.     03450013
           05  PA-MERCH-CNT                 PIC 9(09) VALUE ZEROES.     03460013
           05  PA-EXCL-CNT                  PIC 9(09) VALUE ZEROES.     03470013
           05  PA-KEEP-TRACK                PIC 9(09) VALUE ZEROES.     03480013
           05  PA-CNT-STRS                  PIC 9(09) VALUE ZEROES.     03490013
                                                                        03500013
      *------------------------------------------------------------     03510013
      * ARRAYS                                                          03520013
      *------------------------------------------------------------     03530013
       01  STORE-DETAILS-UN-P.                                          03540013
           03 STR-SEL-ID OCCURS 9999 TIMES INDEXED BY SEL-INDEX.        03550013
              05 STR-NBR PIC S9(04) COMP-3 VALUE +0 OCCURS 20 TIMES     03560013
                                        INDEXED BY STR-INDEX.           03570013
                                                                        03580013
       01  STORE-DETAILS-UN-A.                                          03590013
           03 STR-SEL-ID-A OCCURS 9999 TIMES INDEXED BY SEA-INDEX.      03600013
              05 STR-NBR-A PIC S9(04) COMP-3 VALUE +0 OCCURS 20 TIMES   03610013
                                        INDEXED BY STR-INDEX-UA.        03620013
                                                                        03630013
       01  STORE-DETAILS-AD-P.                                          03640013
           03 STR-SEL-ID-AD-P OCCURS 9999 TIMES INDEXED BY SEL-INDEX-P. 03650013
              05 STR-NBR-AD-P PIC S9(04) COMP-3 VALUE +0 OCCURS 20 TIMES03660013
                                        INDEXED BY STR-INDEX-P.         03670013
                                                                        03680013
       01  STORE-DETAILS-AD-A.                                          03690013
           03 STR-SEL-ID-AD-A OCCURS 9999 TIMES INDEXED BY SEA-INDEX-A. 03700013
              05 STR-NBR-AD-A PIC S9(04) COMP-3 VALUE +0 OCCURS 20 TIMES03710013
                                        INDEXED BY STR-INDEX-A.         03720013
                                                                        03730013
      *----------------------------------------------------------       03740013
      * COPYBOOK FOR THE PRICING RECORD EXTRACT - OUTPUT                03750013
      *----------------------------------------------------------       03760013
           COPY PMRD106.                                                03770013
                                                                        03780013
      *----------------------------------------------------------       03790013
      *                      O  R  A  C  L  E                           03800013
      *==========================================================       03810013
      *                                                                 03820013
      * ORACLE DECLARE SECTION                                          03830013
      * ORACLE USED AND RETURNED VARIABLES                              03840013
      *                                                                 03850013
      *----------------------------------------------------------       03860013
           EXEC SQL BEGIN DECLARE SECTION END-EXEC.                     03870013
                                                                        03880013
      *----------------------------------------------------------       03890013
      * ORACLE LOGON WORKING STORAGE COPYBOOK                           03900013
      *----------------------------------------------------------       03910013
                                                                        03920013
       01  PC-ENT01-TYPE-CDE                PIC X(02)  VALUE '01'.      03930013
       01  PV-ORACLE-ID                     PIC X(1)   VALUE '/'.       03940013
                                                                        03950013
       01  USERNAME                         PIC X(10)  VARYING.         03960013
       01  PASSWD                           PIC X(10)  VARYING.         03970013
                                                                        03980013
       01  ORACLE-RETURN                    PIC X(200) VALUE SPACES.    03990013
                                                                        04000013
           EXEC SQL END DECLARE SECTION END-EXEC.                       04010013
           EXEC SQL INCLUDE SQLCACOB    END-EXEC.                       04020013
                                                                        04030013
       EJECT                                                            04040013
                                                                        04050013
      *----------------------------------------------------------       04060013
       PROCEDURE DIVISION.                                              04070013
      *----------------------------------------------------------       04080013
       0000-MAINLINE.                                                   04090013
                                                                        04100013
           PERFORM 1000-INITIALIZATION.                                 04110013
                                                                        04120013
           IF NOT PS-END-OF-PROMO-FILE                                  04130013
              PERFORM 2000-PROCESS-STORE-INFO                           04140013
              PERFORM 3000-PROCESS-AD-PMITM-TEMP-CSR                    04150013
              MOVE ZEROES           TO PV-SAVE-MDSE-PRICG-ID            04160013
                                       PV-SAVE-MDSE-SELN-ID             04170013
              PERFORM 6000-PROCESS-UNADITM-TEMP-CSR                     04180013
           END-IF.                                                      04190013
                                                                        04200013
           PERFORM 9999-WRAPUP.                                         04210013
                                                                        04220013
           GOBACK.                                                      04230013
                                                                        04240013
      *0000-EXIT.                                                       04250013
       EJECT.                                                           04260013
                                                                        04270013
      *----------------------------------------------------------       04280013
      * 1000-INITIALIZATION.                                            04290013
      *     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS      04300013
      *     FILES, READS CONTROL CARD, AND PROCESSES ANY CONTROL        04310013
      *     CARD PARAMETERS IT MAY NEED TO USE TO FETCH PROMO           04320013
      *     ITEMS FROM THE CURSOR.                                      04330013
      *----------------------------------------------------------       04340013
       1000-INITIALIZATION.                                             04350013
                                                                        04360013
           INITIALIZE PM106-EXCPT-PRCG-EXT                              04370013
                      PV-SELECT-VARIABLES.                              04380013
                                                                        04380122
070941     DISPLAY 'ORACLE FILE OPEN'.                                  04381022
070941     OPEN INPUT ORACLE-LOGON-FILE.                                04382022
070941                                                                  04383022
070941     DISPLAY 'ORACLE FILE READ'.                                  04384022
070941     PERFORM 8500-READ-ORACLE-LOGON.                              04385022
070941                                                                  04386022
070941     DISPLAY 'ORACLE FILE CLOSE'.                                 04387022
070941     CLOSE ORACLE-LOGON-FILE.                                     04388022
070941                                                                  04389022
070941     IF ((PS-END-OF-LOGON-FILE)                                   04389122
070941             OR (CC-ORACLE-CONNECTION = SPACES))                  04389222
070941         DISPLAY '** ABEND **'                                    04389322
070941         DISPLAY PC-PROGRAM-NAME ' - ORACLE LOGON CONTROL CARD '  04389422
070941                   'NOT PROVIDED'                                 04389522
070941         SET PS-ORA-SRC-EMPTY TO TRUE                             04389622
070941         CALL 'ILBOABN0' USING ABEND-CODE                         04389722
070941     END-IF.                                                      04389822
070941                                                                  04389922
070941     IF CC-AUTO-LOGON                                             04390022
070941         DISPLAY PC-PROGRAM-NAME ' - AUTO LOGON TO ORACLE'        04390122
070941         EXEC SQL                                                 04390222
070941              CONNECT :USERNAME                                   04390322
070941         END-EXEC                                                 04390422
070941     ELSE                                                         04390522
070941         INITIALIZE PV-ORACLE-USERID-LEN                          04390622
070941                    PV-ORACLE-PASSWORD-LEN                        04390722
070941         INSPECT CC-ORACLE-USERID                                 04390822
070941             TALLYING PV-ORACLE-USERID-LEN                        04390922
070941          FOR CHARACTERS BEFORE INITIAL SPACE                     04391022
070941      INSPECT CC-ORACLE-PASSWORD                                  04391122
070941          TALLYING PV-ORACLE-PASSWORD-LEN                         04391222
070941          FOR CHARACTERS BEFORE INITIAL SPACE                     04391322
070941      MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO           04391422
070941                USERNAME-ARR                                      04391522
070941      MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                   04391622
070941      MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO       04391722
070941                PASSWD-ARR                                        04391822
070941      MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                   04391922
070941      DISPLAY PC-PROGRAM-NAME ' - LOGON TO ORACLE AS USER '       04392022
070941                USERNAME-ARR                                      04392122
070941      EXEC SQL                                                    04392222
070941        CONNECT :USERNAME IDENTIFIED BY :PASSWD                   04392322
070941      END-EXEC                                                    04392422
070941      INITIALIZE CC-ORACLE-PASSWORD                               04392522
070941                 PASSWD                                           04392622
070941      END-IF.                                                     04392722
070941                                                                  04392822
070941     IF (SQLCODE NOT = 0)                                         04392922
070941         DISPLAY PV-PARAGRAPH-NAME                                04393022
070941         DISPLAY PC-PROGRAM-NAME ' - ERROR LOGGING ON TO ORACLE'  04393122
070941         PERFORM 9900-ORACLE-ABEND                                04393222
070941     END-IF.                                                      04393322
                                                                        04394013
           OPEN INPUT  CONTROL-CARD-FILE-STR                            04400013
                       PROMO-FILE                                       04410013
                OUTPUT EXCPT-PRICG-EXT-FILE.                            04420013
                                                                        04430013
           PERFORM 1100-READ-PROMO-FILE.                                04440013
                                                                        04450013
           IF PS-END-OF-PROMO-FILE                                      04460013
              DISPLAY 'NO PROMO ID TO PROCESS'                          04470013
           ELSE                                                         04480013
TB1115*       MOVE CC-AD-EVENT-ID TO PV-AD-EVNT-ID                      04490013
              MOVE CC-PROMO-ID TO PV-PROMO-ID                           04500013
                                                                        04510013
              INITIALIZE PV-HOST-STRS                                   04520013
              PERFORM 1200-READ-CONTROL-FILE-STR                        04530013
                      UNTIL PS-END-OF-CC-FILE-STR                       04540013
                                                                        04550013
070941*       PERFORM PM700-A000-ORACLE-SETUP                           04560027
                                                                        04570013
              PERFORM 1310-DECLARE-AD-RMS-STORE-CSR                     04580013
              PERFORM 1320-DECLARE-AD-ADH-STORE-CSR                     04590013
              PERFORM 1330-DECLARE-UNAD-RMS-STR-CSR                     04600013
              PERFORM 1340-DECLARE-UNAD-ADH-STR-CSR                     04610013
              PERFORM 1350-DECLARE-AD-PRICG-CSR                         04620013
              PERFORM 1360-DECLARE-UNAD-PRICG-CSR                       04630013
              PERFORM 1370-DECLARE-EXCL-CSR                             04640013
           END-IF.                                                      04650013
                                                                        04660013
      *1000-EXIT.                                                       04670013
       EJECT.                                                           04680013
                                                                        04690013
      *---------------------------------------------------------------  04700013
      * 1100-READ-PROMO-FILE.                                           04710013
      *     READS THE CONTROL CARD THAT CONTAINS THE AD EVENT ID.       04720013
      *---------------------------------------------------------------  04730013
       1100-READ-PROMO-FILE.                                            04740013
                                                                        04750013
           READ PROMO-FILE INTO CC-PROMO-ID-REC                         04760013
                AT END SET PS-END-OF-PROMO-FILE TO TRUE.                04770013
                                                                        04780013
           DISPLAY ' '.                                                 04790013
           DISPLAY '*********************************************'.     04800013
           DISPLAY 'PROGRAM NAME: ' PC-PROGRAM-NAME.                    04810022
           DISPLAY '*********************************************'.     04820013
           DISPLAY 'PROMO ID: '  CC-PROMO-ID.                           04830013
                                                                        04840013
      *1100-EXIT.                                                       04850013
       EJECT.                                                           04860013
                                                                        04870013
      *---------------------------------------------------------------  04880013
      * 1200-READ-CONTROL-FILE-STR.                                     04890013
      *     READS THE CONTROL CARD THAT CONTAINS SAMPLE STORES FOR      04900013
      *     THE PRICING RECORDS.                                        04910013
      *---------------------------------------------------------------  04920013
       1200-READ-CONTROL-FILE-STR.                                      04930013
                                                                        04940013
           READ CONTROL-CARD-FILE-STR INTO CC-CONTROL-CARD-REC-STR      04950013
                AT END SET PS-END-OF-CC-FILE-STR TO TRUE.               04960013
                                                                        04970013
           ADD 1                TO PA-CNT-STRS.                         04980013
                                                                        04990013
           EVALUATE TRUE                                                05000013
             WHEN PA-CNT-STRS = 1                                       05010013
                  IF PS-END-OF-CC-FILE-STR                              05020013
                     MOVE '1200-READ-CONTROL-FILE-STR'                  05030013
                                                 TO PV-PARAGRAPH-NAME   05040013
                     MOVE 'CONTROL CARD IS EMPTY'                       05050013
                                                 TO PV-OPERATION-MSG-1  05060013
                     SET ABEND-4003-CTRL-CARD-ERROR  TO TRUE            05070013
                     PERFORM 9800-ABEND                                 05080013
                  ELSE                                                  05090013
                     MOVE CC-STR-NBR             TO PV-HOST-STR-1       05100013
                     DISPLAY 'SAMPLE STORE 1: ' CC-STR-NBR              05110013
                  END-IF                                                05120013
             WHEN PA-CNT-STRS = 2                                       05130013
                  IF PS-END-OF-CC-FILE-STR                              05140013
                     CONTINUE                                           05150013
                  ELSE                                                  05160013
                     MOVE CC-STR-NBR             TO PV-HOST-STR-2       05170013
                     DISPLAY 'SAMPLE STORE 2: ' CC-STR-NBR              05180013
                  END-IF                                                05190013
             WHEN PA-CNT-STRS = 3                                       05200013
                  IF PS-END-OF-CC-FILE-STR                              05210013
                     CONTINUE                                           05220013
                  ELSE                                                  05230013
                     MOVE CC-STR-NBR             TO PV-HOST-STR-3       05240013
                     DISPLAY 'SAMPLE STORE 3: ' CC-STR-NBR              05250013
                  END-IF                                                05260013
             WHEN PA-CNT-STRS = 4                                       05270013
                  IF PS-END-OF-CC-FILE-STR                              05280013
                     CONTINUE                                           05290013
                  ELSE                                                  05300013
                     MOVE CC-STR-NBR             TO PV-HOST-STR-4       05310013
                     DISPLAY 'SAMPLE STORE 4: ' CC-STR-NBR              05320013
                  END-IF                                                05330013
             WHEN PA-CNT-STRS = 5                                       05340013
                  IF PS-END-OF-CC-FILE-STR                              05350013
                     CONTINUE                                           05360013
                  ELSE                                                  05370013
                     MOVE CC-STR-NBR             TO PV-HOST-STR-5       05380013
                     DISPLAY 'SAMPLE STORE 5: ' CC-STR-NBR              05390013
                  END-IF                                                05400013
             WHEN PA-CNT-STRS = 6                                       05410013
                  IF PS-END-OF-CC-FILE-STR                              05420013
                     CONTINUE                                           05430013
                  ELSE                                                  05440013
                     MOVE CC-STR-NBR             TO PV-HOST-STR-6       05450013
                     DISPLAY 'SAMPLE STORE 6: ' CC-STR-NBR              05460013
                  END-IF                                                05470013
             WHEN PA-CNT-STRS = 7                                       05480013
                  IF PS-END-OF-CC-FILE-STR                              05490013
                     CONTINUE                                           05500013
                  ELSE                                                  05510013
                     MOVE CC-STR-NBR             TO PV-HOST-STR-7       05520013
                     DISPLAY 'SAMPLE STORE 7: ' CC-STR-NBR              05530013
                  END-IF                                                05540013
             WHEN PA-CNT-STRS = 8                                       05550013
                  IF PS-END-OF-CC-FILE-STR                              05560013
                     CONTINUE                                           05570013
                  ELSE                                                  05580013
                     MOVE CC-STR-NBR             TO PV-HOST-STR-8       05590013
                     DISPLAY 'SAMPLE STORE 8: ' CC-STR-NBR              05600013
                  END-IF                                                05610013
             WHEN PA-CNT-STRS = 9                                       05620013
                  IF PS-END-OF-CC-FILE-STR                              05630013
                     CONTINUE                                           05640013
                  ELSE                                                  05650013
                     MOVE CC-STR-NBR             TO PV-HOST-STR-9       05660013
                     DISPLAY 'SAMPLE STORE 9: ' CC-STR-NBR              05670013
                  END-IF                                                05680013
             WHEN PA-CNT-STRS = 10                                      05690013
                  IF PS-END-OF-CC-FILE-STR                              05700013
                     CONTINUE                                           05710013
                  ELSE                                                  05720013
                     MOVE CC-STR-NBR             TO PV-HOST-STR-10      05730013
                     DISPLAY 'SAMPLE STORE 10: ' CC-STR-NBR             05740013
                  END-IF                                                05750013
           END-EVALUATE.                                                05760013
                                                                        05770013
      *1200-EXIT.                                                       05780013
       EJECT.                                                           05790013
                                                                        05800013
      *--------------------------------------------------------------   05810013
      * THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION THAT      05820013
      * LOGS ON TO ORACLE.                                              05830013
      *---------------------------------------------------------------  05840013
070941*    COPY PMPD700.                                                05850027
                                                                        05860013
      ******************************************************************05870013
      * NEEDS TO BE IN FOR NOW TIL KURT FIXES CURSOR SHARING BUG        05880013
      * OTHERWISE I GET A ORA-3113 ERROR                                05890013
      ******************************************************************05900013
           EXEC SQL                                                     05910013
            ALTER SESSION                                               05920013
                  SET CURSOR_SHARING = 'EXACT'                          05930013
           END-EXEC.                                                    05940013
                                                                        05950013
      *---------------------------------------------------------------  05960013
      *1310-DECLARE-AD-RMS-STORE-CSR.                                   05970013
      *    DECLARE THE ADVERTISED STORE CURSOR FOR TYPE CODE = 'P'.     05980013
      *---------------------------------------------------------------  05990013
       1310-DECLARE-AD-RMS-STORE-CSR.                                   06000013
                                                                        06010013
           EXEC SQL                                                     06020013
                DECLARE ADVSTOREP CURSOR FOR                            06030013
                  SELECT                                                06040013
                        STR_GP_DET.STR_SELN_TYP_CDE                     06050013
                       ,STR_GP_DET.STR_SELN_ID                          06060013
                       ,C.STR_NBR                                       06070013
                   FROM (SELECT                                         06080013
                         A.PROMO_DFLT_STRT_TMST                         06090013
                         ,J.EFF_STR_GP_ID                               06100013
                         ,J.STR_SELN_TYP_CDE                            06110013
                         ,J.STR_SELN_ID                                 06120013
                         ,J.ADHC_STR_GP_ID                              06130013
                   FROM PMV_PROMO_DIM A                                 06140013
                       ,PMT_PROMO_PRIC_VER G                            06150013
                       ,PMT_PROMO_PRT_VER H                             06160013
                       ,PMT_STR_SELN J                                  06170013
                   WHERE A.PROMO_ID = :PV-PROMO-ID                      06180013
                     AND G.PRMY_PROMO_ID = A.PROMO_ID                   06190013
                     AND G.PROMO_PRIC_VER_ID = H.PROMO_PRIC_VER_ID      06200013
                     AND J.STR_SELN_ID = H.STR_SELN_ID                  06210013
                     AND J.STR_SELN_TYP_CDE='P'                         06220013
                     AND G.STAT_CDE='S'                                 06230013
                     AND H.STAT_CDE=G.STAT_CDE                          06240013
                      ) STR_GP_DET                                      06250013
                        ,XKT_STR_GP_DTE A                               06260013
                        ,XKT_STR_GP B                                   06270013
                        ,XKT_STR_GP_MBSHP C                             06280013
                   WHERE  A.EFF_STR_GP_ID  = STR_GP_DET.EFF_STR_GP_ID   06290013
                     AND  A.STR_GP_ID  = B.STR_GP_ID                    06300013
                     AND  A.STR_GP_TYP_CDE = B.STR_GP_TYP_CDE           06310013
                     AND  B.STR_GP_ID      = C.STR_GP_ID                06320013
                     AND  B.STR_GP_TYP_CDE = C.STR_GP_TYP_CDE           06330013
             AND  A.EFF_BEG_DTE   <= STR_GP_DET.PROMO_DFLT_STRT_TMST    06340013
             AND (A.EFF_END_DTE   >= STR_GP_DET.PROMO_DFLT_STRT_TMST    06350013
                    OR A.EFF_END_DTE IS NULL)                           06360013
              AND  C.EFF_BEG_DTE   <= STR_GP_DET.PROMO_DFLT_STRT_TMST   06370013
              AND (C.EFF_END_DTE   >= STR_GP_DET.PROMO_DFLT_STRT_TMST   06380013
                     OR C.EFF_END_DTE IS NULL)                          06390013
                     AND  C.STR_NBR       IN (:PV-HOST-STR-1,           06400013
                                              :PV-HOST-STR-2,           06410013
                                              :PV-HOST-STR-3,           06420013
                                              :PV-HOST-STR-4,           06430013
                                              :PV-HOST-STR-5,           06440013
                                              :PV-HOST-STR-6,           06450013
                                              :PV-HOST-STR-7,           06460013
                                              :PV-HOST-STR-8,           06470013
                                              :PV-HOST-STR-9,           06480013
                                              :PV-HOST-STR-10)          06490013
               ORDER BY STR_GP_DET.STR_SELN_ID,C.STR_NBR                06500013
           END-EXEC.                                                    06510013
      *1310-EXIT.                                                       06520013
       EJECT.                                                           06530013
                                                                        06540013
      *---------------------------------------------------------------  06550013
      * 1320-DECLARE-AD-ADH-STORE-CSR.                                  06560013
      *    DECLARE THE ADVERTISED STORE CURSOR FOR TYPE CODE = 'A'.     06570013
      *---------------------------------------------------------------  06580013
       1320-DECLARE-AD-ADH-STORE-CSR.                                   06590013
                                                                        06600013
           EXEC SQL                                                     06610013
                DECLARE ADVSTOREA CURSOR FOR                            06620013
                  SELECT                                                06630013
                       STR_SELN_TYP_CDE                                 06640013
                      ,STR_SELN_ID                                      06650013
                      ,STR_NBR                                          06660013
                  FROM (                                                06670013
                    SELECT                                              06680013
                         STR_GP_DET.ADHC_STR_GP_ID STR_GP_ID            06690013
                        ,STR_GP_DET.STR_SELN_TYP_CDE                    06700013
                        ,STR_GP_DET.STR_SELN_ID                         06710013
                        ,C.STR_NBR                                      06720013
                    FROM (SELECT                                        06730013
                            A.PROMO_DFLT_STRT_TMST                      06740013
                           ,J.EFF_STR_GP_ID                             06750013
                           ,J.STR_SELN_TYP_CDE                          06760013
                           ,K.RUSBL_IND                                 06770013
                           ,J.STR_SELN_ID                               06780013
                           ,J.ADHC_STR_GP_ID                            06790013
                    FROM PMV_PROMO_DIM A                                06800013
                        ,PMT_PROMO_PRIC_VER G                           06810013
                        ,PMT_PROMO_PRT_VER H                            06820013
                        ,PMT_STR_SELN J                                 06830013
                        ,PMT_ADHC_STR_GP K                              06840013
                    WHERE A.PROMO_ID = :PV-PROMO-ID                     06850013
                      AND G.PRMY_PROMO_ID =A.PROMO_ID                   06860013
                      AND G.PROMO_PRIC_VER_ID = H.PROMO_PRIC_VER_ID     06870013
                      AND J.STR_SELN_ID = H.STR_SELN_ID                 06880013
                      AND J.STR_SELN_TYP_CDE='A'                        06890013
                      AND G.STAT_CDE='S'                                06900013
                      AND H.STAT_CDE=G.STAT_CDE                         06910013
                      AND K.ADHC_STR_GP_ID=J.ADHC_STR_GP_ID             06920013
                      AND K.STAT_CDE = 'S') STR_GP_DET                  06930013
                                   ,XKT_STR_GP_DTE A                    06940013
                                   ,XKT_STR_GP B                        06950013
                                   ,XKT_STR_GP_MBSHP C                  06960013
                                   ,PMT_ADHC_STR_GP_XREF D              06970013
                    WHERE STR_GP_DET.RUSBL_IND='Y'                      06980013
                      AND A.EFF_STR_GP_ID  = D.EFF_STR_GP_ID            06990013
                      AND D.ADHC_STR_GP_ID =STR_GP_DET.ADHC_STR_GP_ID   07000013
                      AND A.STR_GP_ID      = B.STR_GP_ID                07010013
                      AND  A.STR_GP_TYP_CDE = B.STR_GP_TYP_CDE          07020013
                      AND  B.STR_GP_ID      = C.STR_GP_ID               07030013
                      AND  B.STR_GP_TYP_CDE = C.STR_GP_TYP_CDE          07040013
              AND  A.EFF_BEG_DTE   <= STR_GP_DET.PROMO_DFLT_STRT_TMST   07050013
               AND (A.EFF_END_DTE   >= STR_GP_DET.PROMO_DFLT_STRT_TMST  07060013
                      OR A.EFF_END_DTE IS NULL)                         07070013
              AND  C.EFF_BEG_DTE   <= STR_GP_DET.PROMO_DFLT_STRT_TMST   07080013
              AND (C.EFF_END_DTE   >= STR_GP_DET.PROMO_DFLT_STRT_TMST   07090013
                           OR C.EFF_END_DTE IS NULL)                    07100013
                      AND  C.STR_NBR       IN (:PV-HOST-STR-1,          07110013
                                              :PV-HOST-STR-2,           07120013
                                              :PV-HOST-STR-3,           07130013
                                              :PV-HOST-STR-4,           07140013
                                              :PV-HOST-STR-5,           07150013
                                              :PV-HOST-STR-6,           07160013
                                              :PV-HOST-STR-7,           07170013
                                              :PV-HOST-STR-8,           07180013
                                              :PV-HOST-STR-9,           07190013
                                              :PV-HOST-STR-10)          07200013
                          AND D.STAT_CDE = 'S')                         07210013
                UNION                                                   07220013
                     SELECT                                             07230013
                          STR_GP_DET.STR_SELN_TYP_CDE                   07240013
                         ,STR_GP_DET.STR_SELN_ID                        07250013
                         ,STR_NBR                                       07260013
                     FROM (SELECT                                       07270013
                                A.PROMO_DFLT_STRT_TMST                  07280013
                               ,J.EFF_STR_GP_ID                         07290013
                               ,J.STR_SELN_TYP_CDE                      07300013
                               ,K.RUSBL_IND                             07310013
                               ,j.STR_SELN_ID                           07320013
                               ,J.ADHC_STR_GP_ID                        07330013
                     FROM PMV_PROMO_DIM A                               07340013
                         ,PMT_PROMO_PRIC_VER G                          07350013
                         ,PMT_PROMO_PRT_VER H                           07360013
                         ,PMT_STR_SELN J                                07370013
                         ,PMT_ADHC_STR_GP K                             07380013
                     WHERE A.PROMO_ID = :PV-PROMO-ID                    07390013
                       AND G.PRMY_PROMO_ID =A.PROMO_ID                  07400013
                       AND G.PROMO_PRIC_VER_ID = H.PROMO_PRIC_VER_ID    07410013
                       AND J.STR_SELN_ID = H.STR_SELN_ID                07420013
                       AND J.STR_SELN_TYP_CDE='A'                       07430013
                       AND G.STAT_CDE='S'                               07440013
                       AND H.STAT_CDE=G.STAT_CDE                        07450013
                       AND K.STAT_CDE = G.STAT_CDE                      07460013
                      AND K.ADHC_STR_GP_ID=J.ADHC_STR_GP_ID) STR_GP_DET 07470013
                                    ,PMT_PROMO_INTFC_ADHC_STR A         07480013
                     WHERE STR_GP_DET.RUSBL_IND <>'Y'                   07490013
                       AND A.ADHC_STR_GP_ID = STR_GP_DET.ADHC_STR_GP_ID 07500013
                  AND  EFF_STRT_TMST <= STR_GP_DET.PROMO_DFLT_STRT_TMST 07510013
                  AND (EFF_END_TMST  >= STR_GP_DET.PROMO_DFLT_STRT_TMST 07520013
                             OR EFF_END_TMST IS NULL)                   07530013
                       AND A.STAT_CDE       = 'S'                       07540013
                       AND A.STR_NBR IN (:PV-HOST-STR-1,                07550013
                                        :PV-HOST-STR-2,                 07560013
                                        :PV-HOST-STR-3,                 07570013
                                        :PV-HOST-STR-4,                 07580013
                                        :PV-HOST-STR-5,                 07590013
                                        :PV-HOST-STR-6,                 07600013
                                        :PV-HOST-STR-7,                 07610013
                                        :PV-HOST-STR-8,                 07620013
                                        :PV-HOST-STR-9,                 07630013
                                        :PV-HOST-STR-10)                07640013
               ORDER BY STR_SELN_ID,STR_NBR                             07650013
           END-EXEC.                                                    07660013
                                                                        07670013
      *1320-EXIT.                                                       07680013
       EJECT.                                                           07690013
                                                                        07700013
      *---------------------------------------------------------------  07710013
      * 1330-DECLARE-UNAD-RMS-STR-CSR.                                  07720013
      *     DECLARE THE UNADVERTISED STORE CURSOR FOR TYPE CODE = 'P'.  07730013
      *---------------------------------------------------------------  07740013
       1330-DECLARE-UNAD-RMS-STR-CSR.                                   07750013
                                                                        07760013
           EXEC SQL                                                     07770013
                DECLARE UNADVSTOREP CURSOR FOR                          07780013
                  SELECT                                                07790013
                        STR_GP_DET.STR_SELN_TYP_CDE                     07800013
                       ,STR_GP_DET.STR_SELN_ID                          07810013
                       ,C.STR_NBR                                       07820013
                  FROM (SELECT                                          07830013
                             G.EFF_STR_GP_ID                            07840013
                            ,G.STR_SELN_TYP_CDE                         07850013
                            ,G.STR_SELN_ID                              07860013
                            ,G.ADHC_STR_GP_ID                           07870013
                        FROM PMT_STR_SELN G                             07880013
                        WHERE G.STR_SELN_TYP_CDE='P'                    07890013
                                     ) STR_GP_DET                       07900013
                                      ,XKT_STR_GP_DTE A                 07910013
                                      ,XKT_STR_GP B                     07920013
                                      ,XKT_STR_GP_MBSHP C               07930013
                   WHERE  A.EFF_STR_GP_ID  = STR_GP_DET.EFF_STR_GP_ID   07940013
                     AND  A.STR_GP_ID      = B.STR_GP_ID                07950013
                     AND  A.STR_GP_TYP_CDE = B.STR_GP_TYP_CDE           07960013
                     AND  B.STR_GP_ID      = C.STR_GP_ID                07970013
                     AND  B.STR_GP_TYP_CDE = C.STR_GP_TYP_CDE           07980013
              AND A.EFF_BEG_DTE   <= (SELECT PROMO_DFLT_STRT_TMST FROM  07990013
                      PMV_PROMO_DIM A WHERE A.PROMO_ID = :PV-PROMO-ID)  08000013
              AND (A.EFF_END_DTE   >= (SELECT PROMO_DFLT_STRT_TMST FROM 08010013
                      PMV_PROMO_DIM A WHERE A.PROMO_ID = :PV-PROMO-ID)  08020013
                            OR A.EFF_END_DTE IS NULL)                   08030013
              AND  C.EFF_BEG_DTE   <= (SELECT PROMO_DFLT_STRT_TMST FROM 08040013
                      PMV_PROMO_DIM A WHERE A.PROMO_ID = :PV-PROMO-ID)  08050013
              AND (C.EFF_END_DTE   >= (SELECT PROMO_DFLT_STRT_TMST FROM 08060013
                      PMV_PROMO_DIM A WHERE A.PROMO_ID = :PV-PROMO-ID)  08070013
                            OR C.EFF_END_DTE IS NULL)                   08080013
                     AND  C.STR_NBR       IN (:PV-HOST-STR-1,           08090013
                                              :PV-HOST-STR-2,           08100013
                                              :PV-HOST-STR-3,           08110013
                                              :PV-HOST-STR-4,           08120013
                                              :PV-HOST-STR-5,           08130013
                                              :PV-HOST-STR-6,           08140013
                                              :PV-HOST-STR-7,           08150013
                                              :PV-HOST-STR-8,           08160013
                                              :PV-HOST-STR-9,           08170013
                                              :PV-HOST-STR-10)          08180013
               ORDER BY STR_GP_DET.STR_SELN_ID,C.STR_NBR                08190013
           END-EXEC.                                                    08200013
                                                                        08210013
      *1330-EXIT.                                                       08220013
       EJECT.                                                           08230013
                                                                        08240013
      *---------------------------------------------------------------  08250013
      * 1340-DECLARE-UNAD-ADH-STR-CSR.                                  08260013
      *     DECLARE THE UNADVERTISED STORE CURSOR FOR TYPE CODE = 'A'.  08270013
      *---------------------------------------------------------------  08280013
       1340-DECLARE-UNAD-ADH-STR-CSR.                                   08290013
                                                                        08300013
           EXEC SQL                                                     08310013
                DECLARE UNADVSTOREA CURSOR FOR                          08320013
                  SELECT                                                08330013
                       STR_SELN_TYP_CDE                                 08340013
                      ,STR_SELN_ID                                      08350013
                      ,STR_NBR                                          08360013
                  FROM (SELECT                                          08370013
                             STR_GP_DET.ADHC_STR_GP_ID STR_GP_ID        08380013
                            ,STR_GP_DET.STR_SELN_TYP_CDE                08390013
                            ,STR_GP_DET.STR_SELN_ID                     08400013
                            ,C.STR_NBR                                  08410013
                        FROM (SELECT                                    08420013
                                   G.EFF_STR_GP_ID                      08430013
                                  ,G.STR_SELN_TYP_CDE                   08440013
                                  ,G.STR_SELN_ID                        08450013
                                  ,G.ADHC_STR_GP_ID                     08460013
                               FROM PMT_STR_SELN G                      08470013
                                   ,PMT_ADHC_STR_GP K                   08480013
                       WHERE G.STR_SELN_TYP_CDE='A'                     08490013
                         AND K.ADHC_STR_GP_ID=G.ADHC_STR_GP_ID          08500013
                         AND K.RUSBL_IND='Y'                            08510013
                         AND K.STAT_CDE = 'S'                           08520013
                                ) STR_GP_DET                            08530013
                                 ,XKT_STR_GP_DTE A                      08540013
                                 ,XKT_STR_GP B                          08550013
                                 ,XKT_STR_GP_MBSHP C                    08560013
                                 ,PMT_ADHC_STR_GP_XREF D                08570013
                         WHERE A.EFF_STR_GP_ID  = D.EFF_STR_GP_ID       08580013
                        AND D.ADHC_STR_GP_ID =STR_GP_DET.ADHC_STR_GP_ID 08590013
                           AND A.STR_GP_ID      = B.STR_GP_ID           08600013
                           AND  A.STR_GP_TYP_CDE = B.STR_GP_TYP_CDE     08610013
                           AND  B.STR_GP_ID      = C.STR_GP_ID          08620013
                           AND  B.STR_GP_TYP_CDE = C.STR_GP_TYP_CDE     08630013
              AND A.EFF_BEG_DTE   <= (SELECT PROMO_DFLT_STRT_TMST FROM  08640013
                  PMV_PROMO_DIM A WHERE A.PROMO_ID = :PV-PROMO-ID)      08650013
             AND (A.EFF_END_DTE   >= (SELECT PROMO_DFLT_STRT_TMST FROM  08660013
                  PMV_PROMO_DIM A WHERE A.PROMO_ID = :PV-PROMO-ID)      08670013
                            OR A.EFF_END_DTE IS NULL)                   08680013
         AND  C.EFF_BEG_DTE   <= (SELECT PROMO_DFLT_STRT_TMST FROM      08690013
                  PMV_PROMO_DIM A WHERE A.PROMO_ID = :PV-PROMO-ID)      08700013
         AND (C.EFF_END_DTE   >= (SELECT PROMO_DFLT_STRT_TMST FROM      08710013
                  PMV_PROMO_DIM A WHERE A.PROMO_ID = :PV-PROMO-ID)      08720013
                            OR C.EFF_END_DTE IS NULL)                   08730013
                     AND  C.STR_NBR       IN (:PV-HOST-STR-1,           08740013
                                              :PV-HOST-STR-2,           08750013
                                              :PV-HOST-STR-3,           08760013
                                              :PV-HOST-STR-4,           08770013
                                              :PV-HOST-STR-5,           08780013
                                              :PV-HOST-STR-6,           08790013
                                              :PV-HOST-STR-7,           08800013
                                              :PV-HOST-STR-8,           08810013
                                              :PV-HOST-STR-9,           08820013
                                              :PV-HOST-STR-10)          08830013
                          AND D.STAT_CDE = 'S')                         08840013
            UNION                                                       08850013
                SELECT                                                  08860013
                     STR_GP_DET.STR_SELN_TYP_CDE                        08870013
                    ,STR_GP_DET.STR_SELN_ID                             08880013
                    ,STR_NBR                                            08890013
                FROM (SELECT                                            08900013
                           G.EFF_STR_GP_ID                              08910013
                          ,G.STR_SELN_TYP_CDE                           08920013
                          ,G.STR_SELN_ID                                08930013
                          ,G.ADHC_STR_GP_ID                             08940013
                      FROM PMT_STR_SELN G                               08950013
                          ,PMT_ADHC_STR_GP K                            08960013
                      WHERE G.STR_SELN_TYP_CDE='A'                      08970013
                      AND K.ADHC_STR_GP_ID=G.ADHC_STR_GP_ID             08980013
                      AND K.RUSBL_IND <> 'Y'                            08990013
                      AND K.STAT_CDE = 'S'                              09000013
                           ) STR_GP_DET                                 09010013
                            ,PMT_PROMO_INTFC_ADHC_STR A                 09020013
                    WHERE A.ADHC_STR_GP_ID = STR_GP_DET.ADHC_STR_GP_ID  09030013
                AND EFF_STRT_TMST <= (SELECT PROMO_DFLT_STRT_TMST FROM  09040013
                    PMV_PROMO_DIM A WHERE A.PROMO_ID = :PV-PROMO-ID)    09050013
                AND (EFF_END_TMST  >= (SELECT PROMO_DFLT_STRT_TMST FROM 09060013
                    PMV_PROMO_DIM A WHERE A.PROMO_ID = :PV-PROMO-ID)    09070013
                                OR EFF_END_TMST IS NULL)                09080013
                     AND A.STAT_CDE       = 'S'                         09090013
                     AND A.STR_NBR  IN (:PV-HOST-STR-1,                 09100013
                                       :PV-HOST-STR-2,                  09110013
                                       :PV-HOST-STR-3,                  09120013
                                       :PV-HOST-STR-4,                  09130013
                                       :PV-HOST-STR-5,                  09140013
                                       :PV-HOST-STR-6,                  09150013
                                       :PV-HOST-STR-7,                  09160013
                                       :PV-HOST-STR-8,                  09170013
                                       :PV-HOST-STR-9,                  09180013
                                       :PV-HOST-STR-10)                 09190013
                     ORDER BY STR_SELN_ID,STR_NBR                       09200013
           END-EXEC.                                                    09210013
                                                                        09220013
      *1340-EXIT.                                                       09230013
       EJECT.                                                           09240013
                                                                        09250013
      *---------------------------------------------------------------  09260013
      * 1350-DECLARE-AD-PRICG-CSR.                                      09270013
      *      DECLARE THE ADVERTISED PROMOTION PRICING CURSOR.           09280013
      *---------------------------------------------------------------  09290013
       1350-DECLARE-AD-PRICG-CSR.                                       09300013
                                                                        09310013
           EXEC SQL                                                     09320013
                DECLARE ADPRICGCSR CURSOR FOR                           09330013
                  SELECT /*+ FIRST_ROWS(1) */                           09340013
                          A.PROMO_ID                                    09350013
                         ,A.AD_EVNT_ID                                  09360013
                         ,A.PROMO_DFLT_STRT_TMST                        09370013
                         ,B.DEPT_NBR                                    09380013
                         ,C.MDSE_SELN_ID                                09390013
                         ,C.MDSE_HIER_CDE                               09400013
                         ,D.MDSE_SELN_LNE_ID                            09410013
                         ,D.DEPT_NBR                                    09420013
                         ,D.MAJ_CL_NBR                                  09430013
                         ,D.SUB_CL_NBR                                  09440013
                         ,D.VS_ID                                       09450013
                         ,D.SKU_NBR                                     09460013
                         ,E.MDSE_LNE_PRICG_ID                           09470013
                         ,E.PRICG_TYP_CDE                               09480013
                         ,E.PRICG_AMT                                   09490013
                         ,E.SIMP_PROMO_INTFC_ID                         09500013
                         ,TO_CHAR(I.VER_STRT_TMST,                      09510013
                          'YYYY-MM-DD HH24:MI:SS')                      09520013
                         ,TO_CHAR(I.VER_END_TMST,                       09530013
                          'YYYY-MM-DD HH24:MI:SS')                      09540013
                         ,J.EFF_STR_GP_ID                               09550013
                         ,J.STR_SELN_TYP_CDE                            09560013
                         ,J.ADHC_STR_GP_ID                              09570013
                         ,j.STR_SELN_ID                                 09580013
                         ,k.PRICG_TYP_CDE gp_pricg_typ_cde              09590013
                         ,k.GP_QTY                                      09600013
                         ,k.GP_AMT                                      09610013
                         ,k.GP_PCT                                      09620013
                         ,k.GP_PROMO_INTFC_ID                           09630013
                         ,temp1.PROMO_ITM_ID                            09640013
                 FROM  PMT_PROMO_ITM B                                  09650013
                      ,PMV_PROMO_DIM A                                  09660013
                      ,PMT_MDSE_SELN C                                  09670013
                      ,PMT_MDSE_SELN_LNE D                              09680013
                      ,PMT_MDSE_LNE_PRICG E                             09690013
                      ,PMT_MDSE_LNE_PRICG_ASSN F                        09700013
                      ,PMT_PROMO_PRIC_VER G                             09710013
                      ,PMT_PROMO_PRT_VER H                              09720013
                      ,PMT_PROMO_PRT_VER_RLT I                          09730013
                      ,PMT_STR_SELN J                                   09740013
                ,( SELECT  B.PROMO_ITM_ID                               09750013
                     FROM  PMV_PROMO_DIM A                              09760013
                          ,PMT_PROMO_ITM B                              09770013
                    WHERE  A.PROMO_ID          = B.PROMO_ID             09780013
                      AND  A.PROMO_ID          = :PV-PROMO-ID           09790013
                      AND  A.REG_PROMO_TYP_CDE = 'A'                    09800013
                      AND  A.PROMO_STAT_CDE    = 'S'                    09810013
                      AND  B.STAT_CDE          = 'S'  ) temp1           09820013
                    ,(                                                  09830013
       SELECT A.MDSE_LNE_PRICG_ID,A.MDSE_LNE_GP_PRIC_ID,B.PRICG_TYP_CDE,09840013
              B.GP_QTY,B.GP_AMT,B.GP_PCT,B.GP_PROMO_INTFC_ID            09850013
         FROM PMT_MDSE_LNE_GP_PRIC A,PMT_GP_PRIC B                      09860013
         WHERE                                                          09870013
               B.STAT_CDE='S'                                           09880013
           AND A.STAT_CDE= B.STAT_CDE                                   09890013
           AND A.GP_PRIC_ID = B.GP_PRIC_ID)K                            09900013
               WHERE  B.PROMO_ITM_ID      = C.PROMO_ITM_ID              09910013
                 AND  C.MDSE_SELN_ID      = D.MDSE_SELN_ID              09920013
                 AND  D.MDSE_SELN_LNE_ID  = E.MDSE_SELN_LNE_ID          09930013
                 AND  E.MDSE_LNE_PRICG_ID = F.MDSE_LNE_PRICG_ID         09940013
                 AND  F.STR_SELN_ID       = H.STR_SELN_ID               09950013
                 AND  G.PRMY_PROMO_ID     = A.PROMO_ID                  09960013
                 AND  G.PROMO_PRIC_VER_ID = H.PROMO_PRIC_VER_ID         09970013
                 AND  H.PROMO_PRT_VER_ID  = I.PROMO_PRT_VER_ID          09980013
                 AND  F.STR_SELN_ID       = J.STR_SELN_ID               09990013
                 AND  B.PROMO_ITM_ID      = temp1.PROMO_ITM_ID          10000013
                 AND  A.REG_PROMO_TYP_CDE = 'A'                         10010013
                 AND  B.PROMO_ID          = A.PROMO_ID                  10020013
                 AND  C.STAT_CDE          = 'S'                         10030013
                 AND  D.STAT_CDE          = 'S'                         10040013
                 AND  E.STAT_CDE          = 'S'                         10050013
                 AND  F.STAT_CDE          = 'S'                         10060013
                 AND  G.STAT_CDE          = 'S'                         10070013
                 AND  H.STAT_CDE          = 'S'                         10080013
                 AND  I.STAT_CDE          = 'S'                         10090013
                 AND  E.MDSE_LNE_PRICG_ID = k.MDSE_LNE_PRICG_ID(+)      10100013
            ORDER BY C.MDSE_SELN_ID,                                    10110013
                     D.MDSE_SELN_LNE_ID,E.MDSE_LNE_PRICG_ID             10120013
           END-EXEC.                                                    10130013
                                                                        10140013
      *1350-EXIT.                                                       10150013
       EJECT.                                                           10160013
                                                                        10170013
      *---------------------------------------------------------------  10180013
      * 1360-DECLARE-UNAD-PRICG-CSR.                                    10190013
      *     DECLARE THE UNADVERTISED PROMOTION PRICING CURSOR.          10200013
      *---------------------------------------------------------------  10210013
       1360-DECLARE-UNAD-PRICG-CSR.                                     10220013
                                                                        10230013
           EXEC SQL                                                     10240013
                DECLARE UNADPRICGCSR CURSOR FOR                         10250013
                  SELECT /*+ FIRST_ROWS(1) */                           10260013
                          A.PROMO_ID                                    10270013
                         ,A.AD_EVNT_ID                                  10280013
                         ,A.PROMO_DFLT_STRT_TMST                        10290013
                         ,TO_CHAR(H.PROMO_ITM_STRT_TMST,                10300013
                           'YYYY-MM-DD HH24:MI:SS')                     10310013
                         ,TO_CHAR(H.PROMO_ITM_END_TMST,                 10320013
                           'YYYY-MM-DD HH24:MI:SS')                     10330013
                         ,B.DEPT_NBR                                    10340013
                         ,C.MDSE_SELN_ID                                10350013
                         ,C.MDSE_HIER_CDE                               10360013
                         ,D.MDSE_SELN_LNE_ID                            10370013
                         ,D.DEPT_NBR                                    10380013
                         ,D.MAJ_CL_NBR                                  10390013
                         ,D.SUB_CL_NBR                                  10400013
                         ,D.VS_ID                                       10410013
                         ,D.SKU_NBR                                     10420013
                         ,E.MDSE_LNE_PRICG_ID                           10430013
                         ,E.PRICG_TYP_CDE                               10440013
                         ,E.PRICG_AMT                                   10450013
                         ,E.SIMP_PROMO_INTFC_ID                         10460013
                         ,G.EFF_STR_GP_ID                               10470013
                         ,G.STR_SELN_TYP_CDE                            10480013
                         ,G.ADHC_STR_GP_ID                              10490013
                         ,G.STR_SELN_ID                                 10500013
                         ,K.PRICG_TYP_CDE GP_PRICG_TYP_CDE              10510013
                         ,K.GP_QTY                                      10520013
                         ,K.GP_AMT                                      10530013
                         ,K.GP_PCT                                      10540013
                         ,K.GP_PROMO_INTFC_ID                           10550013
                         ,TEMP1.PROMO_ITM_ID                            10560013
               FROM  PMT_PROMO_ITM B                                    10570013
                    ,PMV_PROMO_DIM A                                    10580013
                    ,PMT_MDSE_SELN C                                    10590013
                    ,PMT_MDSE_SELN_LNE D                                10600013
                    ,PMT_MDSE_LNE_PRICG E                               10610013
                    ,PMT_MDSE_LNE_PRICG_ASSN F                          10620013
                    ,PMT_STR_SELN G                                     10630013
                    ,PMT_PROMO_ITM_ASSN H                               10640013
               ,( SELECT  B.PROMO_ITM_ID                                10650013
                    FROM  PMV_PROMO_DIM A                               10660013
                         ,PMT_PROMO_ITM B                               10670013
                    WHERE  A.PROMO_ID        = B.PROMO_ID               10680013
                      AND  A.PROMO_ID          = :PV-PROMO-ID           10690013
                      AND  A.REG_PROMO_TYP_CDE = 'U'                    10700013
                      AND  A.PROMO_STAT_CDE    = 'S'                    10710013
                      AND  B.STAT_CDE          = 'S'  ) temp1           10720013
                     ,(SELECT A.MDSE_LNE_PRICG_ID                       10730013
                     ,A.MDSE_LNE_GP_PRIC_ID                             10740013
                     ,B.PRICG_TYP_CDE                                   10750013
                     ,B.GP_QTY                                          10760013
                     ,B.GP_AMT                                          10770013
                     ,B.GP_PCT                                          10780013
                     ,B.GP_PROMO_INTFC_ID                               10790013
                   FROM PMT_MDSE_LNE_GP_PRIC A                          10800013
                       ,PMT_GP_PRIC B                                   10810013
                   WHERE B.STAT_CDE='S'                                 10820013
                     AND A.STAT_CDE= B.STAT_CDE                         10830013
                     AND A.GP_PRIC_ID = B.GP_PRIC_ID)K                  10840013
                   WHERE B.PROMO_ITM_ID      = C.PROMO_ITM_ID           10850013
                     AND C.MDSE_SELN_ID      = D.MDSE_SELN_ID           10860013
                     AND D.MDSE_SELN_LNE_ID  = E.MDSE_SELN_LNE_ID       10870013
                     AND E.MDSE_LNE_PRICG_ID = F.MDSE_LNE_PRICG_ID      10880013
                     AND F.STR_SELN_ID       = G.STR_SELN_ID            10890013
                     AND F.STR_SELN_ID       = H.STR_SELN_ID            10900013
                     AND B.PROMO_ITM_ID      = H.PROMO_ITM_ID           10910013
                     AND B.PROMO_ITM_ID      = temp1.PROMO_ITM_ID       10920013
                     AND A.REG_PROMO_TYP_CDE = 'U'                      10930013
                     AND B.PROMO_ID          = A.PROMO_ID               10940013
                     AND C.STAT_CDE          = 'S'                      10950013
                     AND D.STAT_CDE          = 'S'                      10960013
                     AND E.STAT_CDE          = 'S'                      10970013
                     AND F.STAT_CDE          = 'S'                      10980013
                     AND E.MDSE_LNE_PRICG_ID = K.MDSE_LNE_PRICG_ID(+)   10990013
            ORDER BY C.MDSE_SELN_ID,                                    11000013
                     D.MDSE_SELN_LNE_ID,E.MDSE_LNE_PRICG_ID             11010013
           END-EXEC.                                                    11020013
                                                                        11030013
      *1360-EXIT.                                                       11040013
       EJECT.                                                           11050013
                                                                        11060013
      *---------------------------------------------------------------  11070013
      * 1370-DECLARE-EXCL-CSR.                                          11080013
      *     DECLARE THE EXCLUSION CURSOR.                               11090013
      *---------------------------------------------------------------  11100013
       1370-DECLARE-EXCL-CSR.                                           11110013
                                                                        11120013
           EXEC SQL                                                     11130013
                DECLARE EXCLCSR CURSOR FOR                              11140013
                  SELECT  MDSE_SELN_LNE_EXCLN_ID                        11150013
                         ,MAJ_CL_NBR                                    11160013
                         ,MDSE_HIER_CDE                                 11170013
                         ,SUB_CL_NBR                                    11180013
                         ,VS_ID                                         11190013
                         ,SKU_NBR                                       11200013
                   FROM  PMT_MDSE_SELN_LNE_EXCLN                        11210013
                   WHERE  MDSE_SELN_LNE_ID = :PV-MDSE-SELN-LNE-ID       11220013
                     AND  STAT_CDE         = 'S'                        11230013
           END-EXEC.                                                    11240013
                                                                        11250013
      *1370-EXIT.                                                       11260013
       EJECT.                                                           11270013
                                                                        11280013
      *------------------------------------------------------------     11290013
      * 2000-PROCESS-STORE-INFO.                                        11300013
      *     FETCHES ALL THE RECORDS FOR STORE GROUPS FOR ADVERTISED     11310013
      *     AND UNADVERTISED AND MOVED TO THE CORRESPONDING ARRAYS.     11320013
      *------------------------------------------------------------     11330013
       2000-PROCESS-STORE-INFO.                                         11340013
                                                                        11350013
           PERFORM 2110-OPEN-AD-RMS-STR-CSR                             11360013
           PERFORM 2120-FETCH-AD-RMS-STR-CSR                            11370013
           PERFORM 2130-PROCESS-AD-RMS-STR-CSR                          11380013
                   UNTIL PS-END-OF-ADSTRP-CSR                           11390013
           PERFORM 2140-CLOSE-AD-RMS-STR-CSR                            11400013
                                                                        11410013
           INITIALIZE PREV-SEL-ID.                                      11420013
                                                                        11430013
           PERFORM 2210-OPEN-AD-ADHC-STR-CSR                            11440013
           PERFORM 2220-FETCH-AD-ADHC-STR-CSR                           11450013
           PERFORM 2230-PROCESS-AD-REA-STR-CSR                          11460013
                   UNTIL PS-END-OF-ADHCSTR-CSR                          11470013
           PERFORM 2240-CLOSE-AD-ADHC-STR-CSR                           11480013
                                                                        11490013
           INITIALIZE PREV-SEL-ID.                                      11500013
                                                                        11510013
           PERFORM 2310-OPEN-UNAD-RMS-STR-CSR                           11520013
           PERFORM 2320-FETCH-UNAD-RMS-STR-CSR                          11530013
           PERFORM 2330-PROCESS-UND-RMS-STR-CSR                         11540013
                   UNTIL PS-END-OF-UNAD-STR-CSR                         11550013
           PERFORM 2340-CLOSE-UNAD-RMS-STR-CSR                          11560013
                                                                        11570013
           INITIALIZE PREV-SEL-ID.                                      11580013
                                                                        11590013
           PERFORM 2410-OPEN-UN-ADHC-STR-CSR                            11600013
           PERFORM 2420-FETCH-UN-ADHC-STR-CSR                           11610013
           PERFORM 2430-PROCESS-UND-REA-STR-CSR                         11620013
                   UNTIL PS-END-OF-READHC-CSR                           11630013
           PERFORM 2440-CLOSE-UN-ADHC-STR-CSR.                          11640013
                                                                        11650013
      *2000-EXIT.                                                       11660013
       EJECT.                                                           11670013
                                                                        11680013
      *----------------------------------------------------------       11690013
      * 2110-OPEN-AD-RMS-STR-CSR.                                       11700013
      *     OPENS THE ADVERTISED OF TYPE CODE = P STORE CURSOR.         11710013
      *----------------------------------------------------------       11720013
       2110-OPEN-AD-RMS-STR-CSR.                                        11730013
                                                                        11740013
           EXEC SQL                                                     11750013
                 OPEN ADVSTOREP                                         11760013
           END-EXEC.                                                    11770013
                                                                        11780013
           IF SQLCODE = ZEROES                                          11790013
              SET PS-NOT-END-OF-ADSTRP-CSR    TO TRUE                   11800013
           ELSE                                                         11810013
              SET ABEND-4013-SQL-ERROR TO TRUE                          11820013
              MOVE SQLCODE             TO PV-SQL-CODE                   11830013
              MOVE '2110-OPEN-AD-RMS-STR-CSR'                           11840013
                                       TO PV-PARAGRAPH-NAME             11850013
              MOVE 'OPEN ERROR ON ADVSTOREP'                            11860013
                                       TO PV-OPERATION-MSG              11870013
              PERFORM 9900-ORACLE-ABEND                                 11880013
           END-IF.                                                      11890013
                                                                        11900013
      *2110-EXIT.                                                       11910013
       EJECT.                                                           11920013
                                                                        11930013
      *----------------------------------------------------------       11940013
      * 2120-FETCH-AD-RMS-STR-CSR.                                      11950013
      *     FETCHES THE ADVERTISED STORE CURSOR.                        11960013
      *----------------------------------------------------------       11970013
       2120-FETCH-AD-RMS-STR-CSR.                                       11980013
                                                                        11990013
           EXEC SQL                                                     12000013
               FETCH ADVSTOREP                                          12010013
                 INTO :PV-STR-SELN-TYP-CDE-AD-P                         12020013
                     ,:PV-STR-SELN-ID-AD-P                              12030013
                     ,:PV-STR-NBR-AD-P                                  12040013
           END-EXEC.                                                    12050013
                                                                        12060013
           IF SQLCODE = ZERO                                            12070013
              CONTINUE                                                  12080013
           ELSE                                                         12090013
              IF SQLCODE = 1403                                         12100013
                 SET PS-END-OF-ADSTRP-CSR TO TRUE                       12110013
              ELSE                                                      12120013
                 MOVE SQLCODE      TO PV-SQL-CODE                       12130013
                 SET ABEND-4013-SQL-ERROR TO TRUE                       12140013
                 MOVE '2120-FETCH-AD-RMS-STR-CSR'                       12150013
                                    TO PV-PARAGRAPH-NAME                12160013
                 MOVE 'FETCH ERROR ON ADVSTOREP'                        12170013
                                    TO PV-OPERATION-MSG                 12180013
                 PERFORM 9900-ORACLE-ABEND                              12190013
              END-IF                                                    12200013
           END-IF.                                                      12210013
                                                                        12220013
      *2120-EXIT.                                                       12230013
       EJECT.                                                           12240013
                                                                        12250013
      *----------------------------------------------------------       12260013
      * 2130-PROCESS-AD-RMS-STR-CSR.                                    12270013
      *     LOADS THE STORE DETAILS OF TYPE CODE = P INTO AN ARRAY      12280013
      *     FOR ADVERTISED PROMO ITEMS.                                 12290013
      *----------------------------------------------------------       12300013
       2130-PROCESS-AD-RMS-STR-CSR.                                     12310013
                                                                        12320013
           IF PREV-SEL-ID = PV-STR-SELN-ID-AD-P                         12330013
              SET STR-INDEX-P UP BY 1                                   12340013
              MOVE PV-STR-NBR-AD-P TO                                   12350013
                        STR-NBR-AD-P(SEL-INDEX-P,STR-INDEX-P)           12360013
           ELSE                                                         12370013
              SET STR-INDEX-P TO 1                                      12380013
              SET SEL-INDEX-P TO PV-STR-SELN-ID-AD-P                    12390013
              MOVE PV-STR-NBR-AD-P TO                                   12400013
                         STR-NBR-AD-P(SEL-INDEX-P,STR-INDEX-P)          12410013
              MOVE PV-STR-SELN-ID-AD-P TO PREV-SEL-ID                   12420013
            END-IF.                                                     12430013
            PERFORM 2120-FETCH-AD-RMS-STR-CSR.                          12440013
                                                                        12450013
      *2130-EXIT.                                                       12460013
       EJECT.                                                           12470013
                                                                        12480013
      *----------------------------------------------------------       12490013
      * 2140-CLOSE-AD-RMS-STR-CSR.                                      12500013
      *     CLOSE THE ADVERTISED STORE CURSOR OF TYPE CODE = P.         12510013
      *----------------------------------------------------------       12520013
       2140-CLOSE-AD-RMS-STR-CSR.                                       12530013
                                                                        12540013
           EXEC SQL                                                     12550013
                CLOSE ADVSTOREP                                         12560013
           END-EXEC.                                                    12570013
                                                                        12580013
           IF SQLCODE = ZERO                                            12590013
              CONTINUE                                                  12600013
           ELSE                                                         12610013
              MOVE SQLCODE     TO PV-SQL-CODE                           12620013
              SET ABEND-4013-SQL-ERROR TO TRUE                          12630013
              MOVE '2140-CLOSE-AD-RMS-STR-CSR'                          12640013
                              TO PV-PARAGRAPH-NAME                      12650013
              MOVE 'CLOSE ERROR ON ADVSTOREP'                           12660013
                              TO PV-OPERATION-MSG                       12670013
              PERFORM 9900-ORACLE-ABEND                                 12680013
           END-IF.                                                      12690013
                                                                        12700013
      *2140-EXIT.                                                       12710013
       EJECT.                                                           12720013
                                                                        12730013
      *----------------------------------------------------------       12740013
      * 2210-OPEN-AD-ADHC-STR-CSR.                                      12750013
      *     OPENS THE ADVERTISED STORE CURSOR FOR READHC.               12760013
      *----------------------------------------------------------       12770013
       2210-OPEN-AD-ADHC-STR-CSR.                                       12780013
                                                                        12790013
           EXEC SQL                                                     12800013
                 OPEN ADVSTOREA                                         12810013
           END-EXEC.                                                    12820013
                                                                        12830013
           IF SQLCODE = ZEROES                                          12840013
              SET PS-NOT-END-OF-ADHCSTR-CSR TO TRUE                     12850013
           ELSE                                                         12860013
              SET ABEND-4013-SQL-ERROR TO TRUE                          12870013
              MOVE SQLCODE             TO PV-SQL-CODE                   12880013
              MOVE '2210-OPEN-AD-ADHC-STR-CSR'                          12890013
                                      TO PV-PARAGRAPH-NAME              12900013
              MOVE 'OPEN ERROR ON ADVSTOREA'                            12910013
                                      TO PV-OPERATION-MSG               12920013
              PERFORM 9900-ORACLE-ABEND                                 12930013
           END-IF.                                                      12940013
                                                                        12950013
      *2210-EXIT.                                                       12960013
       EJECT.                                                           12970013
                                                                        12980013
      *----------------------------------------------------------       12990013
      * 2220-FETCH-AD-ADHC-STR-CSR.                                     13000013
      *     FETCHES THE ADVERTISED STORE CURSOR OF TYPE CODE = A.       13010013
      *----------------------------------------------------------       13020013
       2220-FETCH-AD-ADHC-STR-CSR.                                      13030013
                                                                        13040013
           EXEC SQL                                                     13050013
               FETCH ADVSTOREA                                          13060013
                 INTO :PV-STR-SELN-TYP-CDE-AD-A                         13070013
                     ,:PV-STR-SELN-ID-AD-A                              13080013
                     ,:PV-STR-NBR-AD-A                                  13090013
           END-EXEC.                                                    13100013
                                                                        13110013
           IF SQLCODE = ZERO                                            13120013
              CONTINUE                                                  13130013
           ELSE                                                         13140013
              IF SQLCODE = 1403                                         13150013
                 SET PS-END-OF-ADHCSTR-CSR TO TRUE                      13160013
              ELSE                                                      13170013
                 MOVE SQLCODE      TO PV-SQL-CODE                       13180013
                 SET ABEND-4013-SQL-ERROR TO TRUE                       13190013
                 MOVE '2220-FETCH-AD-ADHC-STR-CSR'                      13200013
                                   TO PV-PARAGRAPH-NAME                 13210013
                 MOVE 'FETCH ERROR ON ADVSTOREA'                        13220013
                                   TO PV-OPERATION-MSG                  13230013
                 PERFORM 9900-ORACLE-ABEND                              13240013
              END-IF                                                    13250013
           END-IF.                                                      13260013
                                                                        13270013
      *2220-EXIT.                                                       13280013
       EJECT.                                                           13290013
                                                                        13300013
      *----------------------------------------------------------       13310013
      * 2230-PROCESS-AD-REA-STR-CSR.                                    13320013
      *     LOADS THE STORE DETAILS OF TYPE CODE = A INTO AN ARRAY      13330013
      *     FOR ADVERTISED PROMO ITEMS.                                 13340013
      *-----------------------------------------------------------      13350013
       2230-PROCESS-AD-REA-STR-CSR.                                     13360013
                                                                        13370013
           IF PREV-SEL-ID = PV-STR-SELN-ID-AD-A                         13380013
              SET STR-INDEX-A UP BY 1                                   13390013
              MOVE PV-STR-NBR-AD-A TO                                   13400013
                          STR-NBR-AD-A(SEA-INDEX-A,STR-INDEX-A)         13410013
           ELSE                                                         13420013
              SET STR-INDEX-A TO 1                                      13430013
              SET SEA-INDEX-A TO PV-STR-SELN-ID-AD-A                    13440013
              MOVE PV-STR-NBR-AD-A TO                                   13450013
                          STR-NBR-AD-A(SEA-INDEX-A,STR-INDEX-A)         13460013
              MOVE PV-STR-SELN-ID-AD-A TO PREV-SEL-ID                   13470013
           END-IF.                                                      13480013
           PERFORM 2220-FETCH-AD-ADHC-STR-CSR.                          13490013
                                                                        13500013
      *2230-EXIT.                                                       13510013
       EJECT.                                                           13520013
                                                                        13530013
      *----------------------------------------------------------       13540013
      * 2240-CLOSE-AD-ADHC-STR-CSR.                                     13550013
      *     CLOSE THE ADVERTISED STORE CURSOR OF TYPE CODE = A.         13560013
      *----------------------------------------------------------       13570013
       2240-CLOSE-AD-ADHC-STR-CSR.                                      13580013
                                                                        13590013
           EXEC SQL                                                     13600013
                CLOSE ADVSTOREA                                         13610013
           END-EXEC.                                                    13620013
                                                                        13630013
           IF SQLCODE = ZERO                                            13640013
              CONTINUE                                                  13650013
           ELSE                                                         13660013
              MOVE SQLCODE     TO PV-SQL-CODE                           13670013
              SET ABEND-4013-SQL-ERROR TO TRUE                          13680013
              MOVE '2240-CLOSE-AD-ADHC-STR-CSR'                         13690013
                                TO PV-PARAGRAPH-NAME                    13700013
              MOVE 'CLOSE ERROR ON ADVSTOREA'                           13710013
                                TO PV-OPERATION-MSG                     13720013
              PERFORM 9900-ORACLE-ABEND                                 13730013
           END-IF.                                                      13740013
                                                                        13750013
      *2240-EXIT.                                                       13760013
       EJECT.                                                           13770013
                                                                        13780013
      *----------------------------------------------------------       13790013
      * 2310-OPEN-UNAD-RMS-STR-CSR.                                     13800013
      *     OPENS THE UNADVERTISED STORE CURSOR OF TYPE CODE = P.       13810013
      *----------------------------------------------------------       13820013
       2310-OPEN-UNAD-RMS-STR-CSR.                                      13830013
                                                                        13840013
           EXEC SQL                                                     13850013
                 OPEN UNADVSTOREP                                       13860013
           END-EXEC.                                                    13870013
                                                                        13880013
           IF SQLCODE = ZEROES                                          13890013
              SET PS-NOT-END-UNAD-STR-CSR    TO TRUE                    13900013
           ELSE                                                         13910013
              SET ABEND-4013-SQL-ERROR TO TRUE                          13920013
              MOVE SQLCODE             TO PV-SQL-CODE                   13930013
              MOVE '2310-OPEN-UNAD-RMS-STR-CSR'                         13940013
                                 TO PV-PARAGRAPH-NAME                   13950013
              MOVE 'OPEN ERROR ON UNADVSTOREP'                          13960013
                                 TO PV-OPERATION-MSG                    13970013
              PERFORM 9900-ORACLE-ABEND                                 13980013
           END-IF.                                                      13990013
                                                                        14000013
      *2310-EXIT.                                                       14010013
       EJECT.                                                           14020013
                                                                        14030013
      *----------------------------------------------------------       14040013
      * 2320-FETCH-UNAD-RMS-STR-CSR.                                    14050013
      *     FETCHES THE UNADVERTISED STORE CURSOR.                      14060013
      *----------------------------------------------------------       14070013
       2320-FETCH-UNAD-RMS-STR-CSR.                                     14080013
                                                                        14090013
           EXEC SQL                                                     14100013
               FETCH UNADVSTOREP                                        14110013
                 INTO :PV-STR-SELN-TYP-CDE-UN-P                         14120013
                     ,:PV-STR-SELN-ID-UN-P                              14130013
                     ,:PV-STR-NBR-UN-P                                  14140013
           END-EXEC.                                                    14150013
                                                                        14160013
           IF SQLCODE = ZERO                                            14170013
              CONTINUE                                                  14180013
           ELSE                                                         14190013
              IF SQLCODE = 1403                                         14200013
                 SET PS-END-OF-UNAD-STR-CSR TO TRUE                     14210013
              ELSE                                                      14220013
                 MOVE SQLCODE      TO PV-SQL-CODE                       14230013
                 SET ABEND-4013-SQL-ERROR TO TRUE                       14240013
                 MOVE '2320-FETCH-UNAD-RMS-STR-CSR'                     14250013
                                   TO PV-PARAGRAPH-NAME                 14260013
                 MOVE 'FETCH ERROR ON UNADVSTOREP'                      14270013
                                   TO PV-OPERATION-MSG                  14280013
                 PERFORM 9900-ORACLE-ABEND                              14290013
              END-IF                                                    14300013
            END-IF.                                                     14310013
                                                                        14320013
      *2320-EXIT.                                                       14330013
       EJECT.                                                           14340013
                                                                        14350013
      *----------------------------------------------------------       14360013
      * 2330-PROCESS-UND-RMS-STR-CSR.                                   14370013
      *     LOADS THE STORE DETAILS OF TYPE CODE = P INTO AN ARRAY      14380013
      *     FOR UNADVERTISED PROMO ITEMS.                               14390013
      *----------------------------------------------------------       14400013
       2330-PROCESS-UND-RMS-STR-CSR.                                    14410013
                                                                        14420013
           IF PREV-SEL-ID = PV-STR-SELN-ID-UN-P                         14430013
              SET STR-INDEX UP BY 1                                     14440013
              MOVE PV-STR-NBR-UN-P TO STR-NBR(SEL-INDEX,STR-INDEX)      14450013
           ELSE                                                         14460013
              SET STR-INDEX TO 1                                        14470013
              SET SEL-INDEX TO PV-STR-SELN-ID-UN-P                      14480013
              MOVE PV-STR-NBR-UN-P TO STR-NBR(SEL-INDEX,STR-INDEX)      14490013
              MOVE PV-STR-SELN-ID-UN-P TO PREV-SEL-ID                   14500013
           END-IF.                                                      14510013
           PERFORM 2320-FETCH-UNAD-RMS-STR-CSR.                         14520013
                                                                        14530013
      *2330-EXIT.                                                       14540013
       EJECT.                                                           14550013
                                                                        14560013
      *----------------------------------------------------------       14570013
      * 2340-CLOSE-UNAD-RMS-STR-CSR.                                    14580013
      *     CLOSE THE UNADVERTISED STORE CURSOR OF TYPE CODE = P.       14590013
      *----------------------------------------------------------       14600013
       2340-CLOSE-UNAD-RMS-STR-CSR.                                     14610013
                                                                        14620013
           EXEC SQL                                                     14630013
                CLOSE UNADVSTOREP                                       14640013
           END-EXEC.                                                    14650013
                                                                        14660013
           IF SQLCODE = ZERO                                            14670013
              CONTINUE                                                  14680013
           ELSE                                                         14690013
              MOVE SQLCODE     TO PV-SQL-CODE                           14700013
              SET ABEND-4013-SQL-ERROR TO TRUE                          14710013
              MOVE '2340-CLOSE-UNAD-RMS-STR-CSR'                        14720013
                               TO PV-PARAGRAPH-NAME                     14730013
              MOVE 'CLOSE ERROR ON UNADVSTOREP'                         14740013
                               TO PV-OPERATION-MSG                      14750013
              PERFORM 9900-ORACLE-ABEND                                 14760013
           END-IF.                                                      14770013
                                                                        14780013
      *2340-EXIT.                                                       14790013
       EJECT.                                                           14800013
                                                                        14810013
      *-----------------------------------------------------------      14820013
      * 2410-OPEN-UN-ADHC-STR-CSR.                                      14830013
      *     OPENS THE UNADVERTISED STORE CURSOR OF TYPE CODE = A.       14840013
      *-----------------------------------------------------------      14850013
       2410-OPEN-UN-ADHC-STR-CSR.                                       14860013
                                                                        14870013
           EXEC SQL                                                     14880013
                 OPEN UNADVSTOREA                                       14890013
           END-EXEC.                                                    14900013
                                                                        14910013
           IF SQLCODE = ZEROES                                          14920013
              SET PS-NOT-END-OF-READHC-CSR TO TRUE                      14930013
           ELSE                                                         14940013
              SET ABEND-4013-SQL-ERROR TO TRUE                          14950013
              MOVE SQLCODE             TO PV-SQL-CODE                   14960013
              MOVE '2410-OPEN-UN-ADHC-STR-CSR'                          14970013
                                 TO PV-PARAGRAPH-NAME                   14980013
              MOVE 'OPEN ERROR ON UNADVSTOREA'                          14990013
                                 TO PV-OPERATION-MSG                    15000013
              PERFORM 9900-ORACLE-ABEND                                 15010013
           END-IF.                                                      15020013
                                                                        15030013
      *2410-EXIT.                                                       15040013
       EJECT.                                                           15050013
                                                                        15060013
      *-----------------------------------------------------------      15070013
      * 2420-FETCH-UN-ADHC-STR-CSR.                                     15080013
      *     FETCHES THE UNADVERTISED STORE CURSOR OF TYPE CODE = A.     15090013
      *-----------------------------------------------------------      15100013
       2420-FETCH-UN-ADHC-STR-CSR.                                      15110013
                                                                        15120013
           EXEC SQL                                                     15130013
               FETCH UNADVSTOREA                                        15140013
                 INTO :PV-STR-SELN-TYP-CDE-UN-A                         15150013
                     ,:PV-STR-SELN-ID-UN-A                              15160013
                     ,:PV-STR-NBR-UN-A                                  15170013
           END-EXEC.                                                    15180013
                                                                        15190013
           IF SQLCODE = ZERO                                            15200013
              CONTINUE                                                  15210013
           ELSE                                                         15220013
              IF SQLCODE = 1403                                         15230013
                 SET PS-END-OF-READHC-CSR TO TRUE                       15240013
              ELSE                                                      15250013
                 MOVE SQLCODE      TO PV-SQL-CODE                       15260013
                 SET ABEND-4013-SQL-ERROR TO TRUE                       15270013
                 MOVE '2420-FETCH-UN-ADHC-STR-CSR'                      15280013
                                   TO PV-PARAGRAPH-NAME                 15290013
                 MOVE 'FETCH ERROR ON UNADVSTOREA'                      15300013
                                     TO PV-OPERATION-MSG                15310013
                 PERFORM 9900-ORACLE-ABEND                              15320013
              END-IF                                                    15330013
           END-IF.                                                      15340013
                                                                        15350013
      *2420-EXIT.                                                       15360013
       EJECT.                                                           15370013
                                                                        15380013
      *----------------------------------------------------------       15390013
      * 2430-PROCESS-UND-REA-STR-CSR.                                   15400013
      *     LOADS THE STORE DETAILS OF TYPE CODE = A INTO AN ARRAY      15410013
      *     FOR UNADVERTISED PROMO ITEMS.                               15420013
      *----------------------------------------------------------       15430013
       2430-PROCESS-UND-REA-STR-CSR.                                    15440013
                                                                        15450013
           IF PREV-SEL-ID = PV-STR-SELN-ID-UN-A                         15460013
              SET STR-INDEX UP BY 1                                     15470013
              MOVE PV-STR-NBR-UN-A TO STR-NBR-A(SEA-INDEX,STR-INDEX)    15480013
           ELSE                                                         15490013
              SET STR-INDEX TO 1                                        15500013
              SET SEA-INDEX TO PV-STR-SELN-ID-UN-A                      15510013
              MOVE PV-STR-NBR-UN-A TO STR-NBR-A(SEA-INDEX,STR-INDEX)    15520013
              MOVE PV-STR-SELN-ID-UN-A TO PREV-SEL-ID                   15530013
           END-IF                                                       15540013
           PERFORM 2420-FETCH-UN-ADHC-STR-CSR.                          15550013
                                                                        15560013
      *2430-EXIT.                                                       15570013
       EJECT.                                                           15580013
                                                                        15590013
      *----------------------------------------------------------       15600013
      * 2440-CLOSE-UN-ADHC-STR-CSR.                                     15610013
      *     CLOSE THE UNADVERTISED STORE CURSOR OF TYPE CODE = A.       15620013
      *----------------------------------------------------------       15630013
       2440-CLOSE-UN-ADHC-STR-CSR.                                      15640013
                                                                        15650013
           EXEC SQL                                                     15660013
                CLOSE UNADVSTOREA                                       15670013
           END-EXEC.                                                    15680013
                                                                        15690013
           IF SQLCODE = ZERO                                            15700013
              CONTINUE                                                  15710013
           ELSE                                                         15720013
              MOVE SQLCODE     TO PV-SQL-CODE                           15730013
              SET ABEND-4013-SQL-ERROR TO TRUE                          15740013
              MOVE '2440-CLOSE-UN-ADHC-STR-CSR'                         15750013
                               TO PV-PARAGRAPH-NAME                     15760013
              MOVE 'CLOSE ERROR ON UNADVSTOREA'                         15770013
                               TO PV-OPERATION-MSG                      15780013
              PERFORM 9900-ORACLE-ABEND                                 15790013
           END-IF.                                                      15800013
                                                                        15810013
      *2440-EXIT.                                                       15820013
       EJECT.                                                           15830013
                                                                        15840013
      *----------------------------------------------------------       15850013
      * 3000-PROCESS-AD-PMITM-TEMP-CSR.                                 15860013
      *     FETCHES THE ADVERTISED PRICING CURSOR. SELECTS ANY          15870013
      *     ADDITIONAL INFORMATION NEEDED TO WRITE OUT THE RECORDS.     15880013
      *----------------------------------------------------------       15890013
       3000-PROCESS-AD-PMITM-TEMP-CSR.                                  15900013
                                                                        15910013
           PERFORM 3110-OPEN-AD-PRICG-CSR.                              15920013
           PERFORM 3120-FETCH-AD-PRICG-CSR.                             15930013
           PERFORM 3100-PROCESS-AD-PRICG-CSR                            15940013
                   UNTIL PS-END-OF-ADPRCG-CSR.                          15950013
           PERFORM 3130-CLOSE-AD-PRICG-CSR.                             15960013
                                                                        15970013
                                                                        15980013
      *3000-EXIT.                                                       15990013
       EJECT.                                                           16000013
                                                                        16010013
      *----------------------------------------------------------       16020013
      * 3100-PROCESS-AD-PRICG-CSR.                                      16030013
      *     FETCHES THE PRICING INFORMATION AND WRITES OUT ANY RECORDS  16040013
      *     BASED ON THE INFORMATION FOUND.  SELECTS ANY ADDITIONAL     16050013
      *     INFORMATION NEEDED TO WRITE OUT THE RECORDS.                16060013
      *----------------------------------------------------------       16070013
       3100-PROCESS-AD-PRICG-CSR.                                       16080013
                                                                        16090013
           IF PV-MDSE-LNE-PRICG-ID NOT = PV-SAVE-MDSE-PRICG-ID          16100013
              MOVE PV-MDSE-LNE-PRICG-ID TO PV-SAVE-MDSE-PRICG-ID        16110013
           END-IF.                                                      16120013
                                                                        16130013
           IF PV-PRICG-TYP-NULL < 0                                     16140013
              MOVE PV-GP-PRICG-TYP-CDE   TO PV-PRICG-TYP-CDE            16150013
              MOVE PV-GP-PROMO-INTFC-ID  TO PV-PROMO-INTFC-ID           16160013
              SET PS-JUST-GP-PRC         TO TRUE                        16170013
           ELSE                                                         16180013
              IF PV-PRICG-TYP-NULL >= 0 and PV-GP-PRICG-TYP-NULL >= 0   16190013
                 SET PS-SMP-GP-PRC       TO TRUE                        16200013
              ELSE                                                      16210013
                 SET PS-JUST-SMP-PRC     TO TRUE                        16220013
              END-IF                                                    16230013
           END-IF.                                                      16240013
           PERFORM 4000-POPULATE-PROMO-ITM-REC.                         16250013
                                                                        16260013
           IF PV-STR-SELN-TYP-CDE = 'A'                                 16270013
              SET SEA-INDEX-A TO PV-STR-SELN-ID                         16280013
              SET STR-INDEX-A TO 1                                      16290013
              PERFORM 5000-MATCH-STORE-TABLE-AD-A UNTIL                 16300013
                   STR-NBR-AD-A(SEA-INDEX-A,STR-INDEX-A) = ZEROES OR    16310013
                                          STR-INDEX-A > 20              16320013
           ELSE                                                         16330013
              SET SEL-INDEX-P TO PV-STR-SELN-ID                         16340013
              SET STR-INDEX-P TO 1                                      16350013
              PERFORM 5100-MATCH-STORE-TABLE-AD-P UNTIL                 16360013
                    STR-NBR-AD-P(SEL-INDEX-P,STR-INDEX-P) = ZEROES OR   16370013
                                          STR-INDEX-P > 20              16380013
           END-IF                                                       16390013
                                                                        16400013
           IF PV-MDSE-SELN-LNE-ID NOT = PV-SAVE-MDSE-SELN-ID            16410013
              PERFORM 6110-OPEN-EXCL-CSR                                16420013
              PERFORM 6120-FETCH-EXCL-CSR                               16430013
              PERFORM 6130-PROCESS-EXCL-CSR                             16440013
                      UNTIL PS-END-OF-EXCL-CSR                          16450013
              PERFORM 6140-CLOSE-EXCL-CSR                               16460013
              MOVE PV-MDSE-SELN-LNE-ID TO PV-SAVE-MDSE-SELN-ID          16470013
           END-IF.                                                      16480013
                                                                        16490013
           INITIALIZE PV-SELECT-VARIABLES.                              16500013
           PERFORM 3120-FETCH-AD-PRICG-CSR.                             16510013
                                                                        16520013
      *3100-EXIT.                                                       16530013
       EJECT.                                                           16540013
                                                                        16550013
      *----------------------------------------------------------       16560013
      * 3110-OPEN-AD-PRICG-CSR.                                         16570013
      *     OPENS THE ADVERTISED PRICING CURSOR.                        16580013
      *----------------------------------------------------------       16590013
       3110-OPEN-AD-PRICG-CSR.                                          16600013
                                                                        16610013
           EXEC SQL                                                     16620013
                 OPEN ADPRICGCSR                                        16630013
           END-EXEC.                                                    16640013
                                                                        16650013
           IF SQLCODE = ZEROES                                          16660013
              SET PS-NOT-END-OF-ADPRCG-CSR    TO TRUE                   16670013
           ELSE                                                         16680013
              SET ABEND-4013-SQL-ERROR TO TRUE                          16690013
              MOVE SQLCODE             TO PV-SQL-CODE                   16700013
              MOVE '3110-OPEN-AD-PRICG-CSR'                             16710013
                                 TO PV-PARAGRAPH-NAME                   16720013
              MOVE 'OPEN ERROR ON ADPRICGCSR'                           16730013
                                 TO PV-OPERATION-MSG                    16740013
              PERFORM 9900-ORACLE-ABEND                                 16750013
           END-IF.                                                      16760013
                                                                        16770013
      *3110-EXIT.                                                       16780013
       EJECT.                                                           16790013
                                                                        16800013
      *----------------------------------------------------------       16810013
      * 3120-FETCH-AD-PRICG-CSR.                                        16820013
      *     FETCHES THE ADVERTISED PRICING CURSOR.                      16830013
      *----------------------------------------------------------       16840013
       3120-FETCH-AD-PRICG-CSR.                                         16850013
                                                                        16860013
           EXEC SQL                                                     16870013
               FETCH ADPRICGCSR                                         16880013
                 INTO :PV-PROMO-ID                                      16890013
                     ,:PV-AD-EVNT-ID                                    16900013
                     ,:PV-PROMO-STRT-TMST                               16910013
                     ,:PV-PROMO-DEPT-NBR                                16920013
                     ,:PV-MDSE-SELN-ID                                  16930013
                     ,:PV-MDSE-HIER-CDE                                 16940013
                     ,:PV-MDSE-SELN-LNE-ID                              16950013
                     ,:PV-DEPT-NBR   :PV-DEPT-NULL                      16960013
                     ,:PV-MAJ-CL-NBR :PV-MAJ-CL-NULL                    16970013
                     ,:PV-SUB-CL-NBR :PV-SUB-CL-NULL                    16980013
                     ,:PV-VS-ID      :PV-STYLE-NULL                     16990013
                     ,:PV-SKU-NBR    :PV-SKU-NBR-NULL                   17000013
                     ,:PV-MDSE-LNE-PRICG-ID                             17010013
                     ,:PV-PRICG-TYP-CDE :PV-PRICG-TYP-NULL              17020013
                     ,:PV-PRICG-AMT     :PV-PRICG-AMT-NULL              17030013
                     ,:PV-PROMO-INTFC-ID :PV-INTFC-NULL                 17040013
                     ,:PV-PRCG-STRT-TMST                                17050013
                     ,:PV-PRCG-END-TMST                                 17060013
                     ,:PV-EFF-STR-GP-ID  :PV-EFF-STR-NULL               17070013
                     ,:PV-STR-SELN-TYP-CDE                              17080013
                     ,:PV-ADHC-STR-GP-ID :PV-ADHC-STR-NULL              17090013
                     ,:PV-STR-SELN-ID                                   17100013
                     ,:PV-GP-PRICG-TYP-CDE :PV-GP-PRICG-TYP-NULL        17110013
                     ,:PV-GROUP-QTY :PV-GP-QTY-NULL                     17120013
                     ,:PV-GROUP-AMT :PV-GP-AMT-NULL                     17130013
                     ,:PV-GROUP-PCT :PV-GP-PCT-NULL                     17140013
                     ,:PV-GP-PROMO-INTFC-ID :PV-GP-INTFC-NULL           17150013
                     ,:PV-PROMO-ITM-ID                                  17160013
           END-EXEC.                                                    17170013
                                                                        17180013
           IF SQLCODE = ZERO                                            17190013
              ADD 1 TO PA-MERCH-CNT                                     17200013
           ELSE                                                         17210013
              IF SQLCODE = 1403                                         17220013
                 SET PS-END-OF-ADPRCG-CSR TO TRUE                       17230013
              ELSE                                                      17240013
                 MOVE SQLCODE      TO PV-SQL-CODE                       17250013
                 SET ABEND-4013-SQL-ERROR TO TRUE                       17260013
                 MOVE '3120-FETCH-AD-PRICG-CSR'                         17270013
                                   TO PV-PARAGRAPH-NAME                 17280013
                 MOVE 'FETCH ERROR ON ADPRICGCSR'                       17290013
                                   TO PV-OPERATION-MSG                  17300013
                 PERFORM 9900-ORACLE-ABEND                              17310013
              END-IF                                                    17320013
           END-IF.                                                      17330013
                                                                        17340013
      *3120-EXIT.                                                       17350013
       EJECT.                                                           17360013
                                                                        17370013
      *----------------------------------------------------------       17380013
      * 3130-CLOSE-AD-PRICG-CSR.                                        17390013
      *     CLOSE THE ADVERTISED PRICING CURSOR.                        17400013
      *----------------------------------------------------------       17410013
       3130-CLOSE-AD-PRICG-CSR.                                         17420013
                                                                        17430013
           EXEC SQL                                                     17440013
                CLOSE ADPRICGCSR                                        17450013
           END-EXEC.                                                    17460013
                                                                        17470013
           IF SQLCODE = ZERO                                            17480013
              CONTINUE                                                  17490013
           ELSE                                                         17500013
              MOVE SQLCODE     TO PV-SQL-CODE                           17510013
              SET ABEND-4013-SQL-ERROR TO TRUE                          17520013
              MOVE '3130-CLOSE-AD-PRICG-CSR'                            17530013
                               TO PV-PARAGRAPH-NAME                     17540013
              MOVE 'CLOSE ERROR ON ADPRICGCSR'                          17550013
                               TO PV-OPERATION-MSG                      17560013
              PERFORM 9900-ORACLE-ABEND                                 17570013
           END-IF.                                                      17580013
                                                                        17590013
      *3130-EXIT.                                                       17600013
       EJECT.                                                           17610013
                                                                        17620013
      *----------------------------------------------------------       17630013
      * 4000-POPULATE-PROMO-ITM-REC.                                    17640013
      *     POPULATES THE PRICING RECORD.                               17650013
      *----------------------------------------------------------       17660013
       4000-POPULATE-PROMO-ITM-REC.                                     17670013
                                                                        17680013
           INITIALIZE PM106-EXCPT-PRCG-EXT.                             17690013
           MOVE 1                        TO PM106-REC-TYP-CDE.          17700013
           MOVE PV-AD-EVNT-ID            TO PM106-AD-EVNT-ID.           17710013
061122     IF PV-SKU-NBR NOT EQUAL TO ZEROS                             17711021
061122        MOVE 'SKU' TO PV-MDSE-HIER-CDE                            17713021
061122     ELSE                                                         17714021
061122        IF PV-VS-ID NOT EQUAL TO ZEROS                            17715021
061122           MOVE 'STY' TO PV-MDSE-HIER-CDE                         17716021
061122        ELSE                                                      17717021
061122           IF PV-SUB-CL-NBR NOT EQUAL TO ZEROS                    17718021
061122              MOVE 'SCL' TO PV-MDSE-HIER-CDE                      17719021
061122           ELSE                                                   17719121
061122              IF PV-MAJ-CL-NBR NOT EQUAL TO ZEROS                 17719221
061122                 MOVE 'MCL' TO PV-MDSE-HIER-CDE                   17719321
061122              ELSE                                                17719421
061122                 MOVE 'DPT' TO PV-MDSE-HIER-CDE                   17719521
061122              END-IF                                              17719621
061122            END-IF                                                17719721
061122          END-IF                                                  17719821
061122        END-IF.                                                   17719921
           MOVE PV-MDSE-HIER-CDE         TO PM106-MDSE-HIER-CDE.        17720019
           MOVE PV-PROMO-ID              TO PM106-PROMO-ID.             17730013
           MOVE PV-PROMO-ITM-ID          TO PM106-PROMO-ITM-ID.         17740013
           MOVE PV-MDSE-SELN-ID          TO PM106-MDSE-SELN-ID.         17750013
           MOVE PV-MDSE-SELN-LNE-ID      TO PM106-MDSE-SELN-LNE-ID.     17760013
           MOVE PV-PROMO-DEPT-NBR        TO PM106-DEPT-NBR.             17770013
           MOVE PV-MAJ-CL-NBR            TO PM106-MAJ-CL-NBR.           17780013
           MOVE PV-SUB-CL-NBR            TO PM106-SUB-CL-NBR.           17790013
           MOVE PV-VS-ID                 TO PM106-VS-ID.                17800013
           MOVE PV-SKU-NBR               TO PM106-SKU-NBR.              17810013
           MOVE PV-PRICG-TYP-CDE         TO PM106-PRICG-TYP-CDE.        17820013
           MOVE PV-PRCG-STRT-TMST        TO PM106-STRT-TMST.            17830013
           MOVE PV-PRCG-END-TMST         TO PM106-END-TMST.             17840013
           MOVE PV-PROMO-INTFC-ID        TO PM106-PROMO-INTFC-ID.       17850013
                                                                        17860013
           IF PV-PRICG-TYP-CDE = 'SPO' OR 'CPO' OR 'SRP' OR 'SPP'       17870013
              MOVE PV-PRICG-AMT          TO PM106-PRICG-AMT             17880013
              MOVE ZEROES                TO PM106-GROUP-QTY             17890013
           ELSE                                                         17900013
              IF PV-PRICG-TYP-CDE = 'GAO' OR 'GBL' OR 'GBD' OR 'GBP'    17910013
                 IF PV-PRICG-TYP-CDE = 'GBP'                            17920013
                     MOVE PV-GROUP-PCT        TO PM106-PRICG-AMT        17930013
                 ELSE                                                   17940013
                     MOVE PV-GROUP-AMT        TO PM106-PRICG-AMT        17950013
                 END-IF                                                 17960013
                 MOVE PV-GROUP-QTY       TO PM106-GROUP-QTY             17970013
              END-IF                                                    17980013
           END-IF.                                                      17990013
                                                                        18000013
      *4000-EXIT.                                                       18010013
       EJECT.                                                           18020013
                                                                        18030013
      ***********************************************************       18040013
      * 5000-MATCH-STORE-TABLE-AD-A.                                    18050013
      * MOVE THE STORE NUMBER'S OF THE CORRESPONDING STR-SEL-ID.        18060013
      ***********************************************************       18070013
       5000-MATCH-STORE-TABLE-AD-A.                                     18080013
                                                                        18090013
           IF STR-NBR-AD-A(SEA-INDEX-A,STR-INDEX-A) > 0                 18100013
              MOVE STR-NBR-AD-A(SEA-INDEX-A,STR-INDEX-A) TO             18110013
                                       PM106-STR-NBR                    18120013
              PERFORM 8000-PROCESS-STR-INFO                             18130013
           END-IF.                                                      18140013
           SET STR-INDEX-A UP BY 1.                                     18150013
                                                                        18160013
      *5000-EXIT.                                                       18170013
       EJECT.                                                           18180013
                                                                        18190013
      ***********************************************************       18200013
      * 5100-MATCH-STORE-TABLE-AD-P.                                    18210013
      * MOVE THE STORE NUMBER'S OF THE CORRESPONDING STR-SEL-ID.        18220013
      ***********************************************************       18230013
       5100-MATCH-STORE-TABLE-AD-P.                                     18240013
                                                                        18250013
           IF STR-NBR-AD-P(SEL-INDEX-P,STR-INDEX-P) > 0                 18260013
              MOVE STR-NBR-AD-P(SEL-INDEX-P,STR-INDEX-P) TO             18270013
                                     PM106-STR-NBR                      18280013
              PERFORM 8000-PROCESS-STR-INFO                             18290013
           END-IF.                                                      18300013
           SET STR-INDEX-P UP BY 1.                                     18310013
                                                                        18320013
      *5100-EXIT.                                                       18330013
       EJECT.                                                           18340013
                                                                        18350013
      *----------------------------------------------------------       18360013
      * 6000-PROCESS-UNADITM-TEMP-CSR.                                  18370013
      *     FETCHES THE UNADVERTISED PROMO ITEM TEMP CURSOR.            18380013
      *----------------------------------------------------------       18390013
       6000-PROCESS-UNADITM-TEMP-CSR.                                   18400013
                                                                        18410013
           PERFORM 6010-OPEN-UNAD-PRICG-CSR.                            18420013
           PERFORM 6020-FETCH-UNAD-PRICG-CSR.                           18430013
           PERFORM 6030-PROCESS-UNAD-PRICG-CSR                          18440013
                   UNTIL PS-END-OF-UNADPRCG-CSR.                        18450013
           PERFORM 6040-CLOSE-UNAD-PRICG-CSR.                           18460013
                                                                        18470013
      *6000-EXIT.                                                       18480013
       EJECT.                                                           18490013
                                                                        18500013
      *----------------------------------------------------------       18510013
      * 6010-OPEN-UNAD-PRICG-CSR.                                       18520013
      *     OPENS THE UADVERTISED PRICING CURSOR.                       18530013
      *----------------------------------------------------------       18540013
       6010-OPEN-UNAD-PRICG-CSR.                                        18550013
                                                                        18560013
           EXEC SQL                                                     18570013
                 OPEN UNADPRICGCSR                                      18580013
           END-EXEC.                                                    18590013
                                                                        18600013
           IF SQLCODE = ZEROES                                          18610013
              SET PS-NOT-END-OF-UNADPRCG-CSR TO TRUE                    18620013
           ELSE                                                         18630013
              SET ABEND-4013-SQL-ERROR TO TRUE                          18640013
              MOVE SQLCODE             TO PV-SQL-CODE                   18650013
              MOVE '6010-OPEN-UNAD-PRICING-CSR '                        18660013
                                 TO PV-PARAGRAPH-NAME                   18670013
              MOVE 'OPEN ERROR ON UNADPRICGCSR'                         18680013
                                 TO PV-OPERATION-MSG                    18690013
              PERFORM 9900-ORACLE-ABEND                                 18700013
           END-IF.                                                      18710013
                                                                        18720013
      *6010-EXIT.                                                       18730013
       EJECT.                                                           18740013
                                                                        18750013
      *----------------------------------------------------------       18760013
      * 6020-FETCH-UNAD-PRICG-CSR.                                      18770013
      *     FETCHES THE UNADVERTISED PRICING CURSOR.                    18780013
      *----------------------------------------------------------       18790013
       6020-FETCH-UNAD-PRICG-CSR.                                       18800013
                                                                        18810013
           EXEC SQL                                                     18820013
               FETCH UNADPRICGCSR                                       18830013
                 INTO :PV-PROMO-ID                                      18840013
                     ,:PV-AD-EVNT-ID                                    18850013
                     ,:PV-PROMO-STRT-TMST                               18860013
                     ,:PV-PRCG-STRT-TMST                                18870013
                     ,:PV-PRCG-END-TMST                                 18880013
                     ,:PV-PROMO-DEPT-NBR                                18890013
                     ,:PV-MDSE-SELN-ID                                  18900013
                     ,:PV-MDSE-HIER-CDE                                 18910013
                     ,:PV-MDSE-SELN-LNE-ID                              18920013
                     ,:PV-DEPT-NBR   :PV-DEPT-NULL                      18930013
                     ,:PV-MAJ-CL-NBR :PV-MAJ-CL-NULL                    18940013
                     ,:PV-SUB-CL-NBR :PV-SUB-CL-NULL                    18950013
                     ,:PV-VS-ID      :PV-STYLE-NULL                     18960013
                     ,:PV-SKU-NBR    :PV-SKU-NBR-NULL                   18970013
                     ,:PV-MDSE-LNE-PRICG-ID                             18980013
                     ,:PV-PRICG-TYP-CDE :PV-PRICG-TYP-NULL              18990013
                     ,:PV-PRICG-AMT     :PV-PRICG-AMT-NULL              19000013
                     ,:PV-PROMO-INTFC-ID :PV-INTFC-NULL                 19010013
                     ,:PV-EFF-STR-GP-ID  :PV-EFF-STR-NULL               19020013
                     ,:PV-STR-SELN-TYP-CDE                              19030013
                     ,:PV-ADHC-STR-GP-ID :PV-ADHC-STR-NULL              19040013
                     ,:PV-STR-SELN-ID                                   19050013
                     ,:PV-GP-PRICG-TYP-CDE :PV-GP-PRICG-TYP-NULL        19060013
                     ,:PV-GROUP-QTY :PV-GP-QTY-NULL                     19070013
                     ,:PV-GROUP-AMT :PV-GP-AMT-NULL                     19080013
                     ,:PV-GROUP-PCT :PV-GP-PCT-NULL                     19090013
                     ,:PV-GP-PROMO-INTFC-ID :PV-GP-INTFC-NULL           19100013
                     ,:PV-PROMO-ITM-ID                                  19110013
           END-EXEC.                                                    19120013
                                                                        19130013
           IF SQLCODE = ZERO                                            19140013
              ADD 1 TO PA-MERCH-CNT                                     19150013
           ELSE                                                         19160013
              IF SQLCODE = 1403                                         19170013
                 SET PS-END-OF-UNADPRCG-CSR TO TRUE                     19180013
              ELSE                                                      19190013
                 MOVE SQLCODE      TO PV-SQL-CODE                       19200013
                 SET ABEND-4013-SQL-ERROR TO TRUE                       19210013
                 MOVE '6020-FETCH-UNAD-PRICG-CSR'                       19220013
                                   TO PV-PARAGRAPH-NAME                 19230013
                 MOVE 'FETCH ERROR ON UNADPRICGCSR'                     19240013
                                   TO PV-OPERATION-MSG                  19250013
                 PERFORM 9900-ORACLE-ABEND                              19260013
              END-IF                                                    19270013
           END-IF.                                                      19280013
                                                                        19290013
      *6020-EXIT.                                                       19300013
       EJECT.                                                           19310013
                                                                        19320013
      *----------------------------------------------------------       19330013
      * 6030-PROCESS-UNAD-PRICG-CSR.                                    19340013
      *     FETCHES THE UNADVERTISED PRICING CURSOR AND WRITES OUT      19350013
      *     RECORDS BASED ON THE INFORMATION FOUND.  SELECTS ANY        19360013
      *     ADDITIONAL INFORMATION NEEDED TO WRITE OUT THE RECORDS.     19370013
      *----------------------------------------------------------       19380013
       6030-PROCESS-UNAD-PRICG-CSR.                                     19390013
                                                                        19400013
           IF PV-MDSE-LNE-PRICG-ID NOT = PV-SAVE-MDSE-PRICG-ID          19410013
              MOVE PV-MDSE-LNE-PRICG-ID TO PV-SAVE-MDSE-PRICG-ID        19420013
           END-IF.                                                      19430013
                                                                        19440013
           IF PV-PRICG-TYP-NULL < 0                                     19450013
              MOVE PV-GP-PRICG-TYP-CDE   TO PV-PRICG-TYP-CDE            19460013
              MOVE PV-GP-PROMO-INTFC-ID  TO PV-PROMO-INTFC-ID           19470013
              SET PS-JUST-GP-PRC         TO TRUE                        19480013
           ELSE                                                         19490013
              IF PV-PRICG-TYP-NULL >= 0 and PV-GP-PRICG-TYP-NULL >= 0   19500013
                 SET PS-SMP-GP-PRC       TO TRUE                        19510013
              ELSE                                                      19520013
                 SET PS-JUST-SMP-PRC     TO TRUE                        19530013
              END-IF                                                    19540013
           END-IF.                                                      19550013
           PERFORM 4000-POPULATE-PROMO-ITM-REC.                         19560013
                                                                        19570013
           IF PV-STR-SELN-TYP-CDE = 'P'                                 19580013
              SET STR-INDEX TO 1                                        19590013
              SET SEL-INDEX TO PV-STR-SELN-ID                           19600013
              PERFORM 7000-MATCH-STORE-TABLE-UNA-P UNTIL                19610013
                      STR-NBR(SEL-INDEX,STR-INDEX) = ZEROES OR          19620013
                                        STR-INDEX > 20                  19630013
           ELSE                                                         19640013
              SET STR-INDEX-UA TO 1                                     19650013
              SET SEA-INDEX TO PV-STR-SELN-ID                           19660013
              PERFORM 7100-MATCH-STORE-TABLE-UNA-A UNTIL                19670013
                      STR-NBR-A(SEA-INDEX,STR-INDEX-UA) = ZEROES OR     19680013
                                          STR-INDEX-UA > 20             19690013
           END-IF                                                       19700013
                                                                        19710013
           IF PV-MDSE-SELN-LNE-ID NOT = PV-SAVE-MDSE-SELN-ID            19720013
              PERFORM 6110-OPEN-EXCL-CSR                                19730013
              PERFORM 6120-FETCH-EXCL-CSR                               19740013
              PERFORM 6130-PROCESS-EXCL-CSR                             19750013
                      UNTIL PS-END-OF-EXCL-CSR                          19760013
              PERFORM 6140-CLOSE-EXCL-CSR                               19770013
              MOVE PV-MDSE-SELN-LNE-ID TO PV-SAVE-MDSE-SELN-ID          19780013
           END-IF.                                                      19790013
                                                                        19800013
           INITIALIZE PV-SELECT-VARIABLES.                              19810013
           PERFORM 6020-FETCH-UNAD-PRICG-CSR.                           19820013
                                                                        19830013
      *6030-EXIT.                                                       19840013
       EJECT.                                                           19850013
                                                                        19860013
      *----------------------------------------------------------       19870013
      * 6040-CLOSE-UNAD-PRICG-CSR.                                      19880013
      *     CLOSE THE UNADVERTISED PRICING CURSOR.                      19890013
      *----------------------------------------------------------       19900013
       6040-CLOSE-UNAD-PRICG-CSR.                                       19910013
                                                                        19920013
           EXEC SQL                                                     19930013
                CLOSE UNADPRICGCSR                                      19940013
           END-EXEC.                                                    19950013
                                                                        19960013
           IF SQLCODE = ZERO                                            19970013
              CONTINUE                                                  19980013
           ELSE                                                         19990013
              MOVE SQLCODE     TO PV-SQL-CODE                           20000013
              SET ABEND-4013-SQL-ERROR TO TRUE                          20010013
              MOVE '6040-CLOSE-UNAD-PRICG-CSR'                          20020013
                                  TO PV-PARAGRAPH-NAME                  20030013
              MOVE 'CLOSE ERROR ON UNADPRICGCSR'                        20040013
                                  TO PV-OPERATION-MSG                   20050013
              PERFORM 9900-ORACLE-ABEND                                 20060013
           END-IF.                                                      20070013
                                                                        20080013
      *6040-EXIT.                                                       20090013
       EJECT.                                                           20100013
                                                                        20110013
      *----------------------------------------------------------       20120013
      * 6110-OPEN-EXCL-CSR.                                             20130013
      *     OPENS THE EXCLUSION CURSOR.                                 20140013
      *----------------------------------------------------------       20150013
       6110-OPEN-EXCL-CSR.                                              20160013
                                                                        20170013
           EXEC SQL                                                     20180013
                 OPEN EXCLCSR                                           20190013
           END-EXEC.                                                    20200013
                                                                        20210013
           IF SQLCODE = ZEROES                                          20220013
              SET PS-NOT-END-OF-EXCL-CSR TO TRUE                        20230013
           ELSE                                                         20240013
              SET ABEND-4013-SQL-ERROR TO TRUE                          20250013
              MOVE SQLCODE             TO PV-SQL-CODE                   20260013
              MOVE '6110-OPEN-EXCL-CSR'                                 20270013
                                  TO PV-PARAGRAPH-NAME                  20280013
              MOVE 'OPEN ERROR ON EXCLCSR'                              20290013
                                  TO PV-OPERATION-MSG                   20300013
              PERFORM 9900-ORACLE-ABEND                                 20310013
           END-IF.                                                      20320013
                                                                        20330013
      *6110-EXIT.                                                       20340013
       EJECT.                                                           20350013
                                                                        20360013
      *----------------------------------------------------------       20370013
      * 6120-FETCH-EXCL-CSR.                                            20380013
      *     FETCHES THE EXCLUSION CURSOR.                               20390013
      *----------------------------------------------------------       20400013
       6120-FETCH-EXCL-CSR.                                             20410013
                                                                        20420013
           EXEC SQL                                                     20430013
               FETCH EXCLCSR                                            20440013
                INTO  :PV-MDSE-LNE-EXCLN-ID                             20450013
                     ,:PV-MAJ-CL-NBR :PV-MAJ-CL-NULL                    20460013
                     ,:PV-MDSE-HIER-CDE :PV-MDSE-HIER-NULL              20470013
                     ,:PV-SUB-CL-NBR :PV-SUB-CL-NULL                    20480013
                     ,:PV-VS-ID :PV-STYLE-NULL                          20490013
                     ,:PV-SKU-NBR :PV-SKU-NBR-NULL                      20500013
           END-EXEC.                                                    20510013
                                                                        20520013
           IF SQLCODE = ZERO                                            20530013
              ADD 1 TO PA-EXCL-CNT                                      20540013
           ELSE                                                         20550013
              IF SQLCODE = 1403                                         20560013
                 SET PS-END-OF-EXCL-CSR TO TRUE                         20570013
              ELSE                                                      20580013
                 MOVE SQLCODE      TO PV-SQL-CODE                       20590013
                 SET ABEND-4013-SQL-ERROR TO TRUE                       20600013
                 MOVE '6120-FETCH-EXCL-CSR'                             20610013
                                   TO PV-PARAGRAPH-NAME                 20620013
                 MOVE 'FETCH ERROR ON EXCLCSR'                          20630013
                                   TO PV-OPERATION-MSG                  20640013
                 PERFORM 9900-ORACLE-ABEND                              20650013
              END-IF                                                    20660013
           END-IF.                                                      20670013
                                                                        20680013
      *6120-EXIT.                                                       20690013
       EJECT.                                                           20700013
                                                                        20710013
      *----------------------------------------------------------       20720013
      * 6130-PROCESS-EXCL-CSR.                                          20730013
      *     FETCHES THE EXCLUSION CURSOR AND WRITES OUT ANY RECORDS     20740013
      *     BASED ON THE INFORMATION FOUND.                             20750013
      *----------------------------------------------------------       20760013
       6130-PROCESS-EXCL-CSR.                                           20770013
                                                                        20780013
           PERFORM 7200-POPULATE-EXCLUSION-REC.                         20790013
           IF PS-SMP-GP-PRC                                             20800013
              MOVE PV-PROMO-INTFC-ID       TO PM106-PROMO-INTFC-ID      20810013
           END-IF.                                                      20820013
           PERFORM 9000-WRITE-PROMO-ITM-REC.                            20830013
                                                                        20840013
           IF PS-SMP-GP-PRC                                             20850013
              MOVE PV-GP-PROMO-INTFC-ID    TO PM106-PROMO-INTFC-ID      20860013
              PERFORM 9000-WRITE-PROMO-ITM-REC                          20870013
           END-IF.                                                      20880013
                                                                        20890013
           MOVE ZEROES                  TO PV-MAJ-CL-NBR                20900013
                                           PV-SUB-CL-NBR                20910013
                                           PV-VS-ID                     20920013
                                           PV-SKU-NBR.                  20930013
           MOVE SPACES                  TO PV-MDSE-HIER-CDE.            20940013
                                                                        20950013
           PERFORM 6120-FETCH-EXCL-CSR.                                 20960013
                                                                        20970013
      *6130-EXIT.                                                       20980013
       EJECT.                                                           20990013
                                                                        21000013
      *----------------------------------------------------------       21010013
      * 6140-CLOSE-EXCL-CSR.                                            21020013
      *     CLOSE THE EXCLUSION CURSOR.                                 21030013
      *----------------------------------------------------------       21040013
       6140-CLOSE-EXCL-CSR.                                             21050013
                                                                        21060013
           EXEC SQL                                                     21070013
                CLOSE EXCLCSR                                           21080013
           END-EXEC.                                                    21090013
                                                                        21100013
           IF SQLCODE = ZERO                                            21110013
              CONTINUE                                                  21120013
           ELSE                                                         21130013
              MOVE SQLCODE     TO PV-SQL-CODE                           21140013
              SET ABEND-4013-SQL-ERROR TO TRUE                          21150013
              MOVE '6140-CLOSE-EXCL-CSR'                                21160013
                               TO PV-PARAGRAPH-NAME                     21170013
              MOVE 'CLOSE ERROR ON EXCLCSR'                             21180013
                               TO PV-OPERATION-MSG                      21190013
              PERFORM 9900-ORACLE-ABEND                                 21200013
           END-IF.                                                      21210013
                                                                        21220013
      *6140-EXIT.                                                       21230013
       EJECT.                                                           21240013
                                                                        21250013
      ***********************************************************       21260013
      * 7000-MATCH-STORE-TABLE-UNA-P.                                   21270013
      * MOVE THE STORE NUMBER'S OF THE CORRESPONDING STR-SEL-ID.        21280013
      ***********************************************************       21290013
       7000-MATCH-STORE-TABLE-UNA-P.                                    21300013
                                                                        21310013
           IF STR-NBR(SEL-INDEX,STR-INDEX) > 0                          21320013
              MOVE STR-NBR(SEL-INDEX,STR-INDEX) TO PM106-STR-NBR        21330013
              PERFORM 8000-PROCESS-STR-INFO                             21340013
           END-IF.                                                      21350013
           SET STR-INDEX UP BY 1.                                       21360013
                                                                        21370013
      *7000-EXIT.                                                       21380013
       EJECT.                                                           21390013
                                                                        21400013
      ***********************************************************       21410013
      * 7100-MATCH-STORE-TABLE-UNA-A.                                   21420013
      * MOVE THE STORE NUMBER'S OF THE CORRESPONDING STR-SEL-ID.        21430013
      ***********************************************************       21440013
       7100-MATCH-STORE-TABLE-UNA-A.                                    21450013
                                                                        21460013
           IF STR-NBR-A(SEA-INDEX,STR-INDEX-UA) > 0                     21470013
              MOVE STR-NBR-A(SEA-INDEX,STR-INDEX-UA) TO PM106-STR-NBR   21480013
              PERFORM 8000-PROCESS-STR-INFO                             21490013
           END-IF.                                                      21500013
           SET STR-INDEX-UA UP BY 1.                                    21510013
                                                                        21520013
      *7100-EXIT.                                                       21530013
       EJECT.                                                           21540013
                                                                        21550013
      *----------------------------------------------------------       21560013
      * 7200-POPULATE-EXCLUSION-REC.                                    21570013
      *     POPULATES THE EXCLUSION PRICING RECORD.                     21580013
      *----------------------------------------------------------       21590013
       7200-POPULATE-EXCLUSION-REC.                                     21600013
                                                                        21610013
           MOVE 0                        TO PM106-REC-TYP-CDE.          21620013
061122     IF PV-SKU-NBR NOT EQUAL TO ZEROS                             21620121
061122        MOVE 'SKU' TO PV-MDSE-HIER-CDE                            21620221
061122     ELSE                                                         21620321
061122        IF PV-VS-ID NOT EQUAL TO ZEROS                            21620421
061122           MOVE 'STY' TO PV-MDSE-HIER-CDE                         21620521
061122        ELSE                                                      21620621
061122           IF PV-SUB-CL-NBR NOT EQUAL TO ZEROS                    21620721
061122              MOVE 'SCL' TO PV-MDSE-HIER-CDE                      21620821
061122           ELSE                                                   21620921
061122              IF PV-MAJ-CL-NBR NOT EQUAL TO ZEROS                 21621021
061122                 MOVE 'MCL' TO PV-MDSE-HIER-CDE                   21621121
061122              ELSE                                                21621221
061122                 MOVE 'DPT' TO PV-MDSE-HIER-CDE                   21621321
061122              END-IF                                              21621421
061122            END-IF                                                21621521
061122          END-IF                                                  21621621
061122        END-IF.                                                   21621721
           MOVE PV-MDSE-HIER-CDE         TO PM106-MDSE-HIER-CDE.        21621820
           MOVE PV-PROMO-DEPT-NBR        TO PM106-DEPT-NBR.             21640013
           MOVE PV-MAJ-CL-NBR            TO PM106-MAJ-CL-NBR.           21650013
           MOVE PV-SUB-CL-NBR            TO PM106-SUB-CL-NBR.           21660013
           MOVE PV-VS-ID                 TO PM106-VS-ID.                21670013
           MOVE PV-SKU-NBR               TO PM106-SKU-NBR.              21680013
                                                                        21690013
           MOVE ZEROES                   TO PM106-PRICG-AMT             21700013
                                            PM106-GROUP-QTY             21710013
                                            PM106-STR-NBR.              21720013
                                                                        21730013
           MOVE SPACES                   TO PM106-PRICG-TYP-CDE.        21740013
                                                                        21750013
      *7200-EXIT.                                                       21760013
       EJECT.                                                           21770013
                                                                        21780013
      ***********************************************************       21790013
      * 8000-PROCESS-STR-INFO.                                          21800013
      *     GETS ALL THE DETAILS AND WRITES A RECORD INTO OUTPUT        21810013
      *     DATASET.                                                    21820013
      ***********************************************************       21830013
       8000-PROCESS-STR-INFO.                                           21840013
                                                                        21850013
           IF PS-SMP-GP-PRC                                             21860013
              MOVE ZEROES                 TO PM106-GROUP-QTY            21870013
              MOVE PV-PRICG-TYP-CDE       TO PM106-PRICG-TYP-CDE        21880013
              MOVE PV-PRICG-AMT           TO PM106-PRICG-AMT            21890013
              MOVE PV-PROMO-INTFC-ID      TO PM106-PROMO-INTFC-ID       21900013
           END-IF.                                                      21910013
           PERFORM 9000-WRITE-PROMO-ITM-REC.                            21920013
                                                                        21930013
           IF PS-SMP-GP-PRC                                             21940013
              IF PV-GP-PRICG-TYP-CDE = 'GBP'                            21950013
                  MOVE PV-GROUP-PCT        TO PM106-PRICG-AMT           21960013
              ELSE                                                      21970013
                  MOVE PV-GROUP-AMT        TO PM106-PRICG-AMT           21980013
              END-IF                                                    21990013
              MOVE PV-GROUP-QTY            TO PM106-GROUP-QTY           22000013
              MOVE PV-GP-PRICG-TYP-CDE     TO PM106-PRICG-TYP-CDE       22010013
              MOVE PV-GP-PROMO-INTFC-ID    TO PM106-PROMO-INTFC-ID      22020013
              PERFORM 9000-WRITE-PROMO-ITM-REC                          22030013
           END-IF.                                                      22040013
                                                                        22050013
      *8000-EXIT.                                                       22060013
       EJECT.                                                           22070013
                                                                        22080013
070941****************************************************************  22081022
070941** READ THE ORACLE LOGON CONTROL CARD.                        **  22082022
070941****************************************************************  22083022
070941 8500-READ-ORACLE-LOGON.                                          22084022
070941                                                                  22085022
070941     READ ORACLE-LOGON-FILE                                       22086022
070941         INTO CC-ORACLE-CONNECTION                                22087022
070941         AT END                                                   22088022
070941             SET PS-END-OF-LOGON-FILE TO TRUE                     22089022
070941     END-READ.                                                    22089122
                                                                        22089222
      *----------------------------------------------------------       22090013
      * 9000-WRITE-PROMO-ITM-REC.                                       22100013
      *     WRITES THE PRICING RECORD TO THE SUMMARY FILE.              22110013
      *----------------------------------------------------------       22120013
       9000-WRITE-PROMO-ITM-REC.                                        22130013
                                                                        22140013
           WRITE EXCPT-PRICG-EXT-REC                                    22150013
               FROM PM106-EXCPT-PRCG-EXT.                               22160013
                                                                        22170013
           ADD 1 TO PA-RECS-WRITTEN                                     22180013
                    PA-KEEP-TRACK.                                      22190013
           IF PA-KEEP-TRACK = 10000                                     22200013
              MOVE 0 TO PA-KEEP-TRACK                                   22210013
              DISPLAY PA-RECS-WRITTEN                                   22220013
              PERFORM 9100-FIND-SYSDATE                                 22230013
              DISPLAY 'TIMESTAMP: ' PV-SYS-DATE                         22240013
           END-IF.                                                      22250013
                                                                        22260013
      *9000-EXIT.                                                       22270013
       EJECT.                                                           22280013
                                                                        22290013
      *-----------------------------------------------------------      22300013
      * 9100-FIND-SYSDATE:                                              22310013
      * ==> PROCESSES:                                                  22320013
      *  - SINCE NO TABLE IS ACTUALLY USED WE USE THE DUAL TABLE        22330013
      *  - FIND THE CURRENT DATE AND TIME                               22340013
      * ==> SQLCODE:                                                    22350013
      *  - 0 = A ROW WAS FOUND.                                         22360013
      * ==> PERFORMED FROM: A100-MAINLINE                               22370013
      *-----------------------------------------------------------      22380013
       9100-FIND-SYSDATE.                                               22390013
           EXEC SQL                                                     22400013
               SELECT                                                   22410013
                   SYSDATE                                              22420013
               INTO :PV-SYS-DATE                                        22430013
               FROM                                                     22440013
                   DUAL                                                 22450013
           END-EXEC.                                                    22460013
                                                                        22470013
           EVALUATE TRUE                                                22480013
             WHEN SQLCODE = ZERO                                        22490013
                 CONTINUE                                               22500013
             WHEN OTHER                                                 22510013
               MOVE SQLCODE               TO PV-SQL-CODE                22520013
               MOVE 'DUAL'                TO PV-TABLE-NAME              22530013
               MOVE 'C100-FIND-SYSDATE'   TO PV-PARAGRAPH-NAME          22540013
               PERFORM 9900-ORACLE-ABEND                                22550013
           END-EVALUATE.                                                22560013
                                                                        22570013
      *9100-EXIT.                                                       22580013
       EJECT.                                                           22590013
                                                                        22600013
      *----------------------------------------------------------       22610013
      * 9800-ABEND.                                                     22620013
      *     PERFORMS A NON-SQL-ABEND.                                   22630013
      *----------------------------------------------------------       22640013
       9800-ABEND.                                                      22650013
                                                                        22660013
           DISPLAY '** ABEND           **'.                             22670013
070941*    DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  22680027
           DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          22681022
           DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        22690013
           DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG.         22700013
           DISPLAY '**                 ** = ' PV-OPERATION-MSG-1.       22710013
                                                                        22720013
           CALL 'ILBOABN0' USING ABEND-CODE.                            22730013
                                                                        22740013
      *9800-EXIT.                                                       22750013
       EJECT.                                                           22760013
                                                                        22770013
      *----------------------------------------------------------       22780013
      * 9900-ORACLE-ABEND.                                              22790013
      *     PERFORM AN ABEND THAT OCCURED RELATED TO ORACLE.            22800013
      *----------------------------------------------------------       22810013
       9900-ORACLE-ABEND.                                               22820013
                                                                        22830013
           DISPLAY '                       '.                           22840013
           DISPLAY '** ABEND **       ** = SQLERROR'.                   22850013
070941*    DISPLAY '** PROGRAM        ** = ' PC-CURRENT-PROGRAM-NAME.   22860027
           DISPLAY '** PROGRAM        ** = ' PC-PROGRAM-NAME.           22861022
           DISPLAY '** SQLCODE        ** = ' PV-SQL-CODE.               22870013
           DISPLAY '** ABEND CODE     ** = ' ABEND-CODE.                22880013
           DISPLAY '** SQLERRM        ** = ' SQLERRM.                   22890013
           DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  22900013
           DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                22910013
           DISPLAY '** PARAGRAPH      ** = ' PV-PARAGRAPH-NAME.         22920013
           DISPLAY '** TABLE          ** = ' PV-TABLE-NAME.             22930013
           DISPLAY '** OPERATION      ** = ' PV-OPERATION-MSG.          22940013
           DISPLAY '                       '.                           22950013
                                                                        22960013
           CALL 'ILBOABN0' USING ABEND-CODE.                            22970013
                                                                        22980013
      *9900-EXIT.                                                       22990013
       EJECT.                                                           23000013
                                                                        23010013
      *----------------------------------------------------------       23240013
      * 9999-WRAPUP.                                                    23250013
      *     END OF PROGRAM ROUTINE.  CLOSES ALL FILES AND DISPLAYS      23260013
      *     ANY DATA FROM THE PROGRAM.                                  23270013
      *----------------------------------------------------------       23280013
       9999-WRAPUP.                                                     23290013
                                                                        23300013
           CLOSE CONTROL-CARD-FILE-STR                                  23310013
                 PROMO-FILE                                             23320013
                 EXCPT-PRICG-EXT-FILE.                                  23330013
                                                                        23340013
           DISPLAY 'NUMBER OF PRICING RECS FETCHED: ' PA-MERCH-CNT.     23350013
           DISPLAY 'NUMBER OF EXCLUSION RECS FETCHED: ' PA-EXCL-CNT.    23360013
           DISPLAY 'NUMBER OF RECS WRITTEN: ' PA-RECS-WRITTEN.          23370013
           DISPLAY '*********************************************'.     23380013
                                                                        23390013
      *9999-EXIT.                                                       23400013
       EJECT.                                                           23410013
                                                                        23420013
