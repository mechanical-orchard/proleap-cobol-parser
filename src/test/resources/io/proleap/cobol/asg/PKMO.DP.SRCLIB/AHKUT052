000300 IDENTIFICATION DIVISION.                                         00030001
000400 PROGRAM-ID.    AHKUT052.                                         00040001
000500 AUTHOR.        PATRICK BURKE.                                    00050001
000600 INSTALLATION.  KOHLS.                                            00060001
000700 DATE-WRITTEN   MAY, 2000.                                        00070001
000800 DATE-COMPILED.                                                   00080001
000900                                                                  00090001
001000* ************************************************************** *00100001
001100* * AHKUT052.  "ARCHIVE HISTORY" PROJECT.  EXTRACT PROGRAM.    * *00110001
001200* *                                                            * *00120001
001300* * PURPOSE:                                                   * *00130001
001400* * THIS PROGRAM CREATES AN EXTRACT FILE FROM: TWRKORD.        * *00140001
001500* * THIS EXTRACT FILE CONSISTS OF ROWS ELIGIBLE TO BE:         * *00150001
001600* * 1) LOADED TO THE "ARCHIVE/HISTORY" VERSIONS OF THE TABLES. * *00160001
001700* * 2) DELETED FROM THE OPERATIONAL VERSIONS OF THE TABLES.    * *00170001
001800* *                                                            * *00180001
001900* * PROCESSING OVERVIEW:                                       * *00190001
002000* * THIS PROGRAM READS A "DRIVER" FILE. FOR EACH RECORD READ,  * *00200001
002100* * 1) INCREMENT COUNT OF RECORDS READ.                        * *00210001
002200* * 2) ATTEMPT TO FIND RELATED ROW(S) ON THE TABLE.            * *00220001
002300* *    2.A) IF NO MATCH(ES):                                   * *00230001
002400* *         2.A.1) PROCESSING CONTINUES                        * *00240001
002500* *         2.A.2) DO NOT PERFORM ERROR/REPORTING ROUTINES;    * *00250001
002600* *                THIS SYSTEM DOES NOT CLEANSE DATA NOR REPORT* *00260001
002700* *                ON UNCLEAN DATA.  IT SIMPLY MIGRATES        * *00270001
002800* *                CONDITIONS OCCURRING IN OPERATIONAL         * *00280001
002900* *                TABLES OVER TO THE ARCHIVE/HISTORY TABLES.  * *00290001
003000* *    2.B) IF MATCH(ES):                                      * *00300001
003100* *         2.B.1) INCREMENT COUNT OF ROW(S) FOUND.            * *00310001
003200* *         2.B.2) WRITE THESE ROW(S) TO THE EXTRACT FILE.     * *00320001
003300* *         2.B.3) INCREMENT COUNT OF RECORDS WRITTEN.         * *00330001
003400* *         2.B.4) DO NOT REMOVE THE ROW(S) FROM THE TABLE     * *00340001
003500* *                AT THIS TIME.  THEY WILL BE REMOVED IN OTHER* *00350001
003600* *                PROCESSING, AFTER HAVING BEEN LOADED TO THE * *00360001
003700* *                ARCHIVE/HISTORY TABLE.                      * *00370001
003800* * 3) EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT     * *00380001
003900* *    RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST   * *00390001
004000* *    WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.   * *00400001
004100* ************************************************************** *00410001
004200 ENVIRONMENT DIVISION.                                            00420001
004300 CONFIGURATION SECTION.                                           00430001
004400 SOURCE-COMPUTER.        IBM-3090.                                00440001
004500 OBJECT-COMPUTER.        IBM-3090.                                00450001
004600                                                                  00460001
004700 INPUT-OUTPUT SECTION.                                            00470001
004800 FILE-CONTROL.                                                    00480001
004900                                                                  00490001
005000     SELECT IN-DRIVER-FILE                ASSIGN TO IN01.         00500001
005100     SELECT OUT-EXTRACT-FILE              ASSIGN TO OUT01.        00510001
005200                                                                  00520001
005300******************************************************************00530001
005400 DATA DIVISION.                                                   00540001
005500 FILE SECTION.                                                    00550001
005600                                                                  00560001
005700 FD  IN-DRIVER-FILE                                               00570001
005800     RECORDING MODE IS F                                          00580001
005900     LABEL RECORDS ARE STANDARD                                   00590001
006000     BLOCK CONTAINS 0 RECORDS.                                    00600001
006100 01  IN-DRIVER-RECORD                PIC  X(004).                 00610001
006200                                                                  00620001
006300**** TWRKORD:                                                     00630001
006400 FD  OUT-EXTRACT-FILE                                             00640001
006500     RECORDING MODE IS F                                          00650001
006600     LABEL RECORDS ARE STANDARD                                   00660001
006700     BLOCK CONTAINS 0 RECORDS.                                    00670001
006800 01  OUT-EXTRACT-RECORD              PIC  X(093).                 00680005
006900                                                                  00690001
007000                                                                  00700001
007100                                                                  00710001
007200 WORKING-STORAGE SECTION.                                         00720001
007300                                                                  00730001
007400 01  PC-PROGRAM-CONSTANTS.                                        00740001
007500     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'AHKUT052'.  00750001
007600     05  PC-PGM-PROGRESS-DESC.                                    00760001
007700         10  PC-BEGINNING            PIC X(09) VALUE 'BEGINNING'. 00770001
007800         10  PC-CONTINUING           PIC X(10) VALUE              00780001
007900                                               'CONTINUING'.      00790001
008000         10  PC-ENDING               PIC X(06) VALUE 'ENDING'.    00800001
008100         10  PC-ABENDING             PIC X(08) VALUE 'ABENDING'.  00810001
008200     05  PC-ABEND-INFO.                                           00820001
008300         10  PC-ABEND                PIC X(11) VALUE              00830001
008400                                               '** ABEND **'.     00840001
008500         10  PC-ABEND-MSG-PARA       PIC X(15) VALUE              00850001
008600                                               '- PARA       : '. 00860001
008700         10  PC-ABEND-MSG-DISPLAY-PARA                            00870001
008800                                     PIC X(15) VALUE              00880001
008900                                               '  CALLED PARA: '. 00890001
009000         10  PC-ABEND-MSG-NUMBER     PIC X(15) VALUE              00900001
009100                                               '  FOR ABEND# : '. 00910001
009200         10  PC-ABEND-MSG-DESC       PIC X(15) VALUE              00920001
009300                                               '- ERROR IS   : '. 00930001
009400         10  PC-ABEND-MSG-INDENT-15  PIC X(15) VALUE SPACES.      00940001
009500         10  PC-ABEND-MSG-ACTION     PIC X(15) VALUE              00950001
009600                                               '- ACTION     : '. 00960001
009700     05  PC-HOW-OFTEN-TO-DISPLAY     PIC 9(9)  VALUE 5000.        00970001
009800                                                                  00980001
009900 01  PS-PROGRAM-SWITCHES.                                         00990001
010000     05  PS-IN-DRIVER-EOF-SW         PIC X(01) VALUE 'N'.         01000001
010100         88  PS-IN-DRIVER-EOF                  VALUE 'Y'.         01010001
010200         88  PS-IN-DRIVER-NOT-EOF              VALUE 'N'.         01020001
010300     05  PS-CURSOR-HAS-DATA-SW       PIC X(01) VALUE 'N'.         01030001
010400         88  PS-CURSOR-HAS-DATA                VALUE 'Y'.         01040001
010500         88  PS-CURSOR-HAS-NO-DATA             VALUE 'N'.         01050001
010600     05  PS-TABLE-LOOP-DONE-SW       PIC X(01) VALUE 'N'.         01060001
010700         88  PS-TABLE-LOOP-DONE                VALUE 'Y'.         01070001
010800         88  PS-TABLE-LOOP-NOT-DONE            VALUE 'N'.         01080001
010900                                                                  01090001
011000 01  PV-PROGRAM-VARIABLES.                                        01100001
011100     05  PV-PO-NBR-COMP              PIC S9(9) VALUE 0 COMP.      01110001
011200     05  PV-PO-NBR-NUM               PIC  9(9) VALUE 0.           01120001
011300     05  PV-IN-DRIVER-RECS-READ-CNT  PIC  9(9) VALUE 0.           01130001
011400     05  PV-RECS-WITH-MATCHES-CNT    PIC  9(9) VALUE 0.           01140001
011500     05  PV-TABLE-ROW-SELECT-CNT     PIC  9(9) VALUE 0.           01150001
011600     05  PV-EXTRACT-WRITTEN-CNT      PIC  9(9) VALUE 0.           01160001
011700                                                                  01170001
011800     05  PV-PARAGRAPH-NAME           PIC X(30) VALUE SPACES.      01180001
011900     05  PV-DB2-OPERATION-MSG-1      PIC X(79) VALUE SPACES.      01190001
012000     05  PV-DB2-TABLE-NAME           PIC X(18) VALUE SPACES.      01200001
012100     05  PV-DISPLAY-NTH-MULTIPLE     PIC 9(9)  VALUE 0.           01210001
012200     05  PV-DISPLAY-NTH-REMAINDER    PIC 9(9)  VALUE 0.           01220001
012300     05  PV-SQLCODE                  PIC +999  VALUE ZERO.        01230001
012400                                                                  01240001
012500     05  PV-TMST                     PIC X(26) VALUE SPACES.      01250001
012600     05  PV-TIMESTAMP-DETAIL                                      01260001
012700         REDEFINES                                                01270001
012800         PV-TMST.                                                 01280001
012900         10  PV-TIMESTAMP-19.                                     01290001
013000             15  PV-TMS-DATE.                                     01300001
013100                 20  PV-TMS-YEAR.                                 01310001
013200                     25  PV-TMS-CC   PIC X(02).                   01320001
013300                     25  PV-TMS-YY   PIC X(02).                   01330001
013400                 20  FILLER          PIC X(01).                   01340001
013500                 20  PV-TMS-MONTH    PIC X(02).                   01350001
013600                 20  FILLER          PIC X(01).                   01360001
013700                 20  PV-TMS-DAY      PIC X(02).                   01370001
013800             15  FILLER              PIC X(01).                   01380001
013900             15  PV-TMS-HOUR         PIC X(02).                   01390001
014000             15  FILLER              PIC X(01).                   01400001
014100             15  PV-TMS-MINUTE       PIC X(02).                   01410001
014200             15  FILLER              PIC X(01).                   01420001
014300             15  PV-TMS-SECOND       PIC X(02).                   01430001
014400         10  FILLER                  PIC X(01).                   01440001
014500         10  PV-TMS-MSECOND          PIC X(06).                   01450001
014600                                                                  01460001
014700 01  DM-DISPLAY-MESSAGE.                                          01470001
014800     05  DM-01-10.                                                01480001
014900         10  DM-PROGRAM              PIC X(08) VALUE SPACE.       01490001
015000         10  FILLER                  PIC X(02) VALUE ': '.        01500001
015100     05  DM-11-80.                                                01510001
015200         10  FILLER                  PIC X(37) VALUE              01520001
015300                        'SELECT ROWS MATCHING PO DRIVER FILE, '.  01530001
015400         10  FILLER                  PIC X(30) VALUE              01540001
015500                        'CREATING TWRKORD EXTRACT FILE.'.         01550001
015600         10  FILLER                  PIC X(01) VALUE SPACE.       01560001
015700         10  FILLER                  PIC X(01) VALUE ALL '*'.     01570001
015800     05  DM-81-120.                                               01580001
015900         10  FILLER                  PIC X(40) VALUE ALL '*'.     01590001
016000                                                                  01600001
016100 01  DP-DISPLAY-PROGRESS-MSG.                                     01610001
016200     05  DP-PROGRAM                  PIC X(08) VALUE SPACE.       01620001
016300     05  FILLER                      PIC X(02) VALUE SPACE.       01630001
016400     05  DP-STATUS-DESCRIPTION       PIC X(10) VALUE SPACE.       01640001
016500     05  FILLER                      PIC X(04) VALUE ' AT '.      01650001
016600     05  DP-TIMESTAMP-19             PIC X(19) VALUE SPACE.       01660001
016700     05  FILLER                      PIC X(03) VALUE '.  '.       01670001
016800     05  FILLER                      PIC X(03) VALUE              01680001
016900                                         'IN:'.                   01690001
017000     05  DP-IN-CNT                   PIC ZZZ,ZZZ,ZZ9              01700001
017100                                               VALUE ZERO.        01710001
017200     05  FILLER                      PIC X(02) VALUE ', '.        01720001
017300*    05  FILLER                      PIC X(16) VALUE              01730001
017400*                                        'DRIVER W/ROW(S):'.      01740001
017500*    05  DP-MATCHES-FOUND-CNT        PIC ZZZ,ZZZ,ZZ9              01750001
017600*                                              VALUE ZERO.        01760001
017700*    05  FILLER                      PIC X(02) VALUE ', '.        01770001
017800     05  FILLER                      PIC X(14) VALUE              01780001
017900                                         'ROWS SELECTED:'.        01790001
018000     05  DP-ROWS-SELECTED-CNT        PIC ZZZ,ZZZ,ZZ9              01800001
018100                                               VALUE ZERO.        01810001
018200     05  FILLER                      PIC X(02) VALUE ', '.        01820001
018300     05  FILLER                      PIC X(04) VALUE              01830001
018400                                         'OUT:'.                  01840001
018500     05  DP-OUT-CNT                  PIC ZZZ,ZZZ,ZZ9              01850001
018600                                               VALUE ZERO.        01860001
018700     05  FILLER                      PIC X(01) VALUE '.'.         01870001
018800                                                                  01880001
018900 01  ABEND-CODE                      PIC S9(04)                   01890001
019000                                               VALUE ZEROES       01900001
019100                                               COMP SYNC.         01910001
019200                                                                  01920001
019300*---------------------------------------------------------------* 01930001
019400*  DB2 FORMATTED MESSAGE AREA                                     01940001
019500*---------------------------------------------------------------* 01950001
019600     COPY DPWS004.                                                01960001
019700                                                                  01970001
019800                                                                  01980001
019900*---------------------------------------------------------------* 01990001
020000*  AHRD002  - RECORD LAYOUT FOR PO DRIVER FILE, INPUT.          * 02000001
020100*---------------------------------------------------------------* 02010001
020200     COPY AHRD002.                                                02020001
020300                                                                  02030001
020400                                                                  02040001
020500*---------------------------------------------------------------* 02050001
020600*    DB2 AREA FOR TWRKORD                                       * 02060001
020700*---------------------------------------------------------------* 02070001
020800     EXEC SQL                                                     02080001
020900          INCLUDE TWRKORD                                         02090001
021000     END-EXEC.                                                    02100001
021100                                                                  02110001
021200*---------------------------------------------------------------* 02120001
021300*    DB2 AREA FOR COMMUNICATIONS                                * 02130001
021400*---------------------------------------------------------------* 02140001
021500     EXEC SQL                                                     02150001
021600          INCLUDE SQLCA                                           02160001
021700     END-EXEC.                                                    02170001
021800                                                                  02180001
021900*---------------------------------------------------------------* 02190001
022000*    DEFINE CURSOR FOR TWRKORD :                                * 02200001
022100*    PULL ALL AVAILABLE COLUMNS, SO EXTRACT FILE WILL CONTAIN   * 02210001
022200*    ALL DATA TO POPULATE "ARCHIVE HISTORY" COPY OF THIS TABLE. * 02220001
022300*---------------------------------------------------------------* 02230001
022400     EXEC SQL                                                     02240001
022500          DECLARE TABLE-CURSOR CURSOR FOR                         02250001
022600           SELECT ORD_NBR                                         02260001
022700                 ,RCVR_SEQ_NBR                                    02270001
022800                 ,ORD_LNE_NBR                                     02280001
022900                 ,WORK_ORD_SEQ_NBR                                02290001
023000                 ,OPER_UNT_ID                                     02300001
023100                 ,FCLTY_ID                                        02310001
023200                 ,CRE_TMST                                        02320001
023300                 ,VER_STATUS_CDE                                  02330001
023310                 ,CRE_UID_ID                                      02331001
023320                 ,EXPTED_CART_CNT                                 02332001
023330                 ,ACTL_CART_CNT                                   02333001
023340                 ,EXPTED_ITM_CNT                                  02334001
023350                 ,ACTL_ITM_CNT                                    02335001
023360                 ,STAT_CDE                                        02336001
023370                 ,WORK_ORD_DISTR_IND                              02337004
023380                 ,OPER_SET_ID                                     02338001
023390                 ,INST_CART_CNT                                   02339001
023391                 ,INST_LNE_LOC_CDE                                02339101
023392                 ,INST_PRC_AREA_ID                                02339201
023393                 ,WO_INSTR_SEL_IND                                02339301
023394                 ,INST_ITM_CNT                                    02339401
023400           FROM   TWRKORD                                         02340001
023500          WHERE  (ORD_NBR = :PV-PO-NBR-COMP)                      02350001
023600*      ORDER BY                                                   02360001
023700            FOR  FETCH ONLY                                       02370001
023800           WITH  UR                                               02380001
023900     END-EXEC.                                                    02390001
024000                                                                  02400001
024100                                                                  02410001
024200 PROCEDURE DIVISION.                                              02420001
024300********************                                              02430001
024400                                                                  02440001
024500 0000-PROGRAM-MAINLINE.                                           02450001
024600                                                                  02460001
024700     PERFORM 1000-INITIALIZE.                                     02470001
024800                                                                  02480001
024900     SET PS-IN-DRIVER-NOT-EOF TO TRUE.                            02490001
025000     PERFORM 2000-PROCESS-DRIVER-FILE                             02500001
025100         UNTIL PS-IN-DRIVER-EOF.                                  02510001
025200                                                                  02520001
025300     PERFORM 6000-EOJ-ROUTINE.                                    02530001
025400     STOP RUN.                                                    02540001
025500                                                                  02550001
025600                                                                  02560001
025700* ************************************************************** *02570001
025800* * INITIALIZATIONS                                            * *02580001
025900* ************************************************************** *02590001
026000 1000-INITIALIZE.                                                 02600001
026100                                                                  02610001
026200     MOVE PC-CURRENT-PROGRAM-NAME TO DM-PROGRAM.                  02620001
026300     DISPLAY DM-DISPLAY-MESSAGE.                                  02630001
026400                                                                  02640001
026500     MOVE PC-BEGINNING              TO DP-STATUS-DESCRIPTION.     02650001
026600     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02660001
026700                                                                  02670001
026800     PERFORM 9000-OPEN-IN-DRIVER-FILE.                            02680001
026900     PERFORM 9700-OPEN-OUT-EXTRACT-FILE.                          02690001
027000                                                                  02700001
027100                                                                  02710001
027200* ************************************************************** *02720001
027300* * 1) GET NEXT RECORD FROM DRIVER FILE, AND                   * *02730001
027400* *    1A- POPULATE KEY (WHERE CLAUSE) FOR TABLE CURSOR        * *02740001
027500* *    1B- OPEN TABLE CURSOR                                   * *02750001
027600* *    1C- LOOP THRU TABLE CURSOR TO EXTRACT ALL               * *02760001
027700* *        ROWS FOR THIS INPUT DRIVER RECORD                   * *02770001
027800* *    2) FOR EACH ROW,                                        * *02780001
027900* *       2A- INCREMENT COUNTS                                 * *02790001
028000* *       2B- WRITE EXTRACT RECORD                             * *02800001
028100* *    1D- CLOSE TABLE CURSOR                                  * *02810001
028200* ************************************************************** *02820001
028300 2000-PROCESS-DRIVER-FILE.                                        02830001
028400                                                                  02840001
028500     PERFORM 9050-READ-IN-DRIVER-FILE.                            02850001
028600     IF PS-IN-DRIVER-EOF                                          02860001
028700         CONTINUE                                                 02870001
028800     ELSE                                                         02880001
028900         MOVE AH002-PO-NBR TO         PV-PO-NBR-COMP              02890001
029000                                      PV-PO-NBR-NUM               02900001
029100         PERFORM 2100-CHECK-PGM-PROGRESS                          02910001
029200         SET PS-TABLE-LOOP-NOT-DONE   TO TRUE                     02920001
029300         SET PS-CURSOR-HAS-NO-DATA    TO TRUE                     02930001
029400         PERFORM 9100-OPEN-TABLE-CURSOR                           02940001
029500         PERFORM 3000-EXTRACT-ROWS-FROM-TABLE                     02950001
029600             UNTIL PS-TABLE-LOOP-DONE                             02960001
029700         PERFORM 9190-CLOSE-TABLE-CURSOR                          02970001
029800     END-IF.                                                      02980001
029900                                                                  02990001
030000                                                                  03000001
030100* ************************************************************** *03010001
030200* *    EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT     * *03020001
030300* *    RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST   * *03030001
030400* *    WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.   * *03040001
030500* ************************************************************** *03050001
030600 2100-CHECK-PGM-PROGRESS.                                         03060001
030700     DIVIDE    PV-IN-DRIVER-RECS-READ-CNT                         03070001
030800         BY        PC-HOW-OFTEN-TO-DISPLAY                        03080001
030900         GIVING    PV-DISPLAY-NTH-MULTIPLE                        03090001
031000         REMAINDER PV-DISPLAY-NTH-REMAINDER.                      03100001
031100                                                                  03110001
031200     IF PV-DISPLAY-NTH-REMAINDER = ZERO                           03120001
031300         MOVE PC-CONTINUING         TO DP-STATUS-DESCRIPTION      03130001
031400         PERFORM 6200-DISPLAY-PGM-PROGRESS                        03140001
031500     END-IF.                                                      03150001
031600                                                                  03160001
031700                                                                  03170001
031800* ************************************************************** *03180001
031900* * EXTRACT ROWS FROM TABLE, FOR THE CURRENT DRIVER RECORD     * *03190001
032000* ************************************************************** *03200001
032100 3000-EXTRACT-ROWS-FROM-TABLE.                                    03210001
032200     INITIALIZE DCLTWRKORD.                                       03220001
032300     PERFORM 9150-FETCH-TABLE-CURSOR.                             03230001
032400     IF PS-TABLE-LOOP-DONE                                        03240001
032500         CONTINUE                                                 03250001
032600     ELSE                                                         03260001
032700         PERFORM 9750-WRITE-EXTRACT-RECORD                        03270001
032800     END-IF.                                                      03280001
032900                                                                  03290001
033000                                                                  03300001
033100* ************************************************************** *03310001
033200* * DISPLAY END OF RUN MESSAGE, CLOSE THE OUTPUT FILES         * *03320001
033300* ************************************************************** *03330001
033400 6000-EOJ-ROUTINE.                                                03340001
033500                                                                  03350001
033600     PERFORM 9090-CLOSE-IN-DRIVER-FILE.                           03360001
033700     PERFORM 9790-CLOSE-OUT-EXTRACT-FILE.                         03370001
033800                                                                  03380001
033900     MOVE PC-ENDING                 TO DP-STATUS-DESCRIPTION.     03390001
034000     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           03400001
034100                                                                  03410001
034200                                                                  03420001
034300* ************************************************************** *03430001
034400* * DISPLAY PROGRAM PROGRESS.                                  * *03440001
034500* ************************************************************** *03450001
034600 6200-DISPLAY-PGM-PROGRESS.                                       03460001
034700                                                                  03470001
034800     EXEC SQL                                                     03480001
034900          SET :PV-TMST = CURRENT TIMESTAMP                        03490001
035000     END-EXEC.                                                    03500001
035100                                                                  03510001
035200     MOVE PC-CURRENT-PROGRAM-NAME   TO DP-PROGRAM.                03520001
035300     MOVE PV-TIMESTAMP-19           TO DP-TIMESTAMP-19.           03530001
035400     MOVE PV-IN-DRIVER-RECS-READ-CNT                              03540001
035500                                    TO DP-IN-CNT.                 03550001
035600*    MOVE PV-RECS-WITH-MATCHES-CNT  TO DP-MATCHES-FOUND-CNT.      03560001
035700     MOVE PV-TABLE-ROW-SELECT-CNT   TO DP-ROWS-SELECTED-CNT.      03570001
035800     MOVE PV-EXTRACT-WRITTEN-CNT    TO DP-OUT-CNT.                03580001
035900                                                                  03590001
036000     DISPLAY DP-DISPLAY-PROGRESS-MSG.                             03600001
036100                                                                  03610001
036200                                                                  03620001
036300* ************************************************************** *03630001
036400* * FILE AND DB2 TABLE ACCESS PARAGRAPHS.                      * *03640001
036500* * 90XX- INPUT:  DRIVER FILE                                  * *03650001
036600* * 91XX- INPUT:  TABLE CURSOR                                 * *03660001
036700* * 97XX- OUTPUT: TABLE EXTRACT                                * *03670001
036800* ************************************************************** *03680001
036900                                                                  03690001
037000* ************************************************************** *03700001
037100* * OPEN  INPUT DRIVER FILE                                    * *03710001
037200* ************************************************************** *03720001
037300 9000-OPEN-IN-DRIVER-FILE.                                        03730001
037400     OPEN  INPUT  IN-DRIVER-FILE.                                 03740001
037500                                                                  03750001
037600                                                                  03760001
037700* ************************************************************** *03770001
037800* * READ  INPUT DRIVER FILE OF ELIGIBLE DATA TO EXTRACT        * *03780001
037900* ************************************************************** *03790001
038000 9050-READ-IN-DRIVER-FILE.                                        03800001
038100     READ IN-DRIVER-FILE                                          03810001
038200          INTO AH002-DRIVER-RECORD-LAYOUT                         03820001
038300          AT END                                                  03830001
038400              SET PS-IN-DRIVER-EOF TO TRUE.                       03840001
038500                                                                  03850001
038600     IF PS-IN-DRIVER-EOF                                          03860001
038700         CONTINUE                                                 03870001
038800     ELSE                                                         03880001
038900         ADD +1 TO PV-IN-DRIVER-RECS-READ-CNT                     03890001
039000     END-IF.                                                      03900001
039100                                                                  03910001
039200                                                                  03920001
039300* ************************************************************** *03930001
039400* * CLOSE INPUT DRIVER FILE                                    * *03940001
039500* ************************************************************** *03950001
039600 9090-CLOSE-IN-DRIVER-FILE.                                       03960001
039700     CLOSE IN-DRIVER-FILE.                                        03970001
039800                                                                  03980001
039900                                                                  03990001
040000* ************************************************************** *04000001
040100* * OPEN  TABLE CURSOR                                         * *04010001
040200* ************************************************************** *04020001
040300 9100-OPEN-TABLE-CURSOR.                                          04030001
040400     EXEC SQL                                                     04040001
040500          OPEN TABLE-CURSOR                                       04050001
040600     END-EXEC.                                                    04060001
040700                                                                  04070001
040800     EVALUATE TRUE                                                04080001
040900         WHEN SQLCODE = ZERO                                      04090001
041000              ADD +1 TO PV-RECS-WITH-MATCHES-CNT                  04100001
041100              SET PS-CURSOR-HAS-DATA TO TRUE                      04110001
041200         WHEN SQLCODE = +100                                      04120001
041300              SET PS-TABLE-LOOP-DONE TO TRUE                      04130001
041400         WHEN SQLWARN0 NOT EQUAL SPACE                            04140001
041500         WHEN SQLCODE  NOT EQUAL ZERO                             04150001
041600              MOVE '9100-OPEN-TABLE-CURSOR'                       04160001
041700                                 TO PV-PARAGRAPH-NAME             04170001
041800              MOVE 'OPEN TABLE CURSOR'                            04180001
041900                                 TO PV-DB2-OPERATION-MSG-1        04190001
042000              MOVE 'TWRKORD'     TO PV-DB2-TABLE-NAME             04200001
042100              PERFORM 9999-DB2-ABEND                              04210001
042200     END-EVALUATE.                                                04220001
042300                                                                  04230001
042400                                                                  04240001
042500* ************************************************************** *04250001
042600* * FETCH TABLE CURSOR                                         * *04260001
042700* ************************************************************** *04270001
042800 9150-FETCH-TABLE-CURSOR.                                         04280001
042900     EXEC SQL                                                     04290001
043000         FETCH TABLE-CURSOR                                       04300001
043100          INTO  :WRKORD-ORD-NBR                                   04310001
043200               ,:WRKORD-RCVR-SEQ-NBR                              04320001
043300               ,:WRKORD-ORD-LNE-NBR                               04330001
043400               ,:WRKORD-WORK-ORD-SEQ-NBR                          04340001
043500               ,:WRKORD-OPER-UNT-ID                               04350001
043600               ,:WRKORD-FCLTY-ID                                  04360001
043700               ,:WRKORD-CRE-TMST                                  04370001
043800               ,:WRKORD-VER-STATUS-CDE                            04380001
043810               ,:WRKORD-CRE-UID-ID                                04381001
043820               ,:WRKORD-EXPTED-CART-CNT                           04382001
043830               ,:WRKORD-ACTL-CART-CNT                             04383001
043840               ,:WRKORD-EXPTED-ITM-CNT                            04384001
043850               ,:WRKORD-ACTL-ITM-CNT                              04385001
043860               ,:WRKORD-STAT-CDE                                  04386001
043870               ,:WRKORD-WORK-ORD-DISTR-IND                        04387001
043880               ,:WRKORD-OPER-SET-ID                               04388001
043890               ,:WRKORD-INST-CART-CNT                             04389001
043891               ,:WRKORD-INST-LNE-LOC-CDE                          04389101
043900               ,:WRKORD-INST-PRC-AREA-ID                          04390001
043910               ,:WRKORD-WO-INSTR-SEL-IND                          04391001
043920               ,:WRKORD-INST-ITM-CNT                              04392001
044000     END-EXEC.                                                    04400001
044100                                                                  04410001
044200     EVALUATE TRUE                                                04420001
044300         WHEN SQLCODE = ZERO                                      04430001
044400              ADD +1                 TO PV-TABLE-ROW-SELECT-CNT   04440001
044500              SET PS-CURSOR-HAS-DATA TO TRUE                      04450001
044600         WHEN SQLCODE = +100                                      04460001
044700              SET PS-TABLE-LOOP-DONE TO TRUE                      04470001
044800         WHEN SQLWARN0 NOT EQUAL SPACE                            04480001
044900         WHEN SQLCODE NOT EQUAL ZERO                              04490001
045000              MOVE '9150-FETCH-TABLE-CURSOR'                      04500001
045100                                 TO PV-PARAGRAPH-NAME             04510001
045200              MOVE 'FETCH TABLE CURSOR'                           04520001
045300                                 TO PV-DB2-OPERATION-MSG-1        04530001
045400              MOVE 'TWRKORD'     TO PV-DB2-TABLE-NAME             04540001
045500              PERFORM 9999-DB2-ABEND                              04550001
045600     END-EVALUATE.                                                04560001
045700                                                                  04570001
045800                                                                  04580001
045900* ************************************************************** *04590001
046000* * CLOSE TABLE CURSOR                                         * *04600001
046100* ************************************************************** *04610001
046200 9190-CLOSE-TABLE-CURSOR.                                         04620001
046300     EXEC SQL                                                     04630001
046400          CLOSE TABLE-CURSOR                                      04640001
046500     END-EXEC.                                                    04650001
046600                                                                  04660001
046700     EVALUATE TRUE                                                04670001
046800         WHEN SQLCODE = ZERO                                      04680001
046900              CONTINUE                                            04690001
047000         WHEN SQLWARN0 NOT EQUAL SPACE                            04700001
047100         WHEN SQLCODE NOT EQUAL ZERO                              04710001
047200              MOVE '9190-CLOSE-TABLE-CURSOR'                      04720001
047300                                 TO PV-PARAGRAPH-NAME             04730001
047400              MOVE 'CLOSE TABLE CURSOR'                           04740001
047500                                 TO PV-DB2-OPERATION-MSG-1        04750001
047600              MOVE 'TWRKORD'     TO PV-DB2-TABLE-NAME             04760001
047700              PERFORM 9999-DB2-ABEND                              04770001
047800     END-EVALUATE.                                                04780001
047900                                                                  04790001
048000                                                                  04800001
048100* ************************************************************** *04810001
048200* * OPEN OUTPUT EXTRACT FILE                                   * *04820001
048300* ************************************************************** *04830001
048400 9700-OPEN-OUT-EXTRACT-FILE.                                      04840001
048500     OPEN OUTPUT OUT-EXTRACT-FILE.                                04850001
048600                                                                  04860001
048700                                                                  04870001
048800* ************************************************************** *04880001
048900* * WRITE A RECORD TO THE TABLE EXTRACT FILE                   * *04890001
049000* ************************************************************** *04900001
049100 9750-WRITE-EXTRACT-RECORD.                                       04910001
049200     WRITE  OUT-EXTRACT-RECORD  FROM  DCLTWRKORD.                 04920001
049300     ADD +1 TO PV-EXTRACT-WRITTEN-CNT.                            04930001
049400                                                                  04940001
049500                                                                  04950001
049600* ************************************************************** *04960001
049700* * CLOSE OUTPUT EXTRACT FILE                                  * *04970001
049800* ************************************************************** *04980001
049900 9790-CLOSE-OUT-EXTRACT-FILE.                                     04990001
050000     CLOSE OUT-EXTRACT-FILE.                                      05000001
050100                                                                  05010001
050200                                                                  05020001
050300* ************************************************************** *05030001
050400* * DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT *05040001
050500* * AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN          * *05050001
050600* * SQL ERROR OR WARNING CODE OCCURS.                          * *05060001
050700* ************************************************************** *05070001
050800 9999-DB2-ABEND.                                                  05080001
050900                                                                  05090001
051000     DISPLAY PC-CURRENT-PROGRAM-NAME                              05100001
051100             ' 9999-DB2-ABEND'.                                   05110001
051200     DISPLAY PC-CURRENT-PROGRAM-NAME                              05120001
051300             ' ** ABEND           **'.                            05130001
051400     DISPLAY PC-CURRENT-PROGRAM-NAME                              05140001
051500             ' ** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.       05150001
051600     DISPLAY PC-CURRENT-PROGRAM-NAME                              05160001
051700             ' ** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME.       05170001
051800     DISPLAY PC-CURRENT-PROGRAM-NAME                              05180001
051900             ' ** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.  05190001
052000                                                                  05200001
052100     DISPLAY PC-CURRENT-PROGRAM-NAME                              05210001
052200             ' ** SQLCODE         ** = ' SQLCODE.                 05220001
052300     MOVE SQLCODE TO PV-SQLCODE.                                  05230001
052400     DISPLAY PC-CURRENT-PROGRAM-NAME                              05240001
052500             ' ** PV-SQLCODE      ** = ' PV-SQLCODE '.'.          05250001
052600                                                                  05260001
052700     DISPLAY PC-CURRENT-PROGRAM-NAME                              05270001
052800             ' ** SQLWARN0        ** = ' SQLWARN0 '.'.            05280001
052900                                                                  05290001
053000                                                                  05300001
053100*----------------------------------------------------------------*05310001
053200* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *05320001
053300* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *05330001
053400* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *05340001
053500* FORMAT.                                                        *05350001
053600*----------------------------------------------------------------*05360001
053700     COPY DPPD004.                                                05370001
053800                                                                  05380001
053900     MOVE PC-ABENDING               TO DP-STATUS-DESCRIPTION.     05390001
054000     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           05400001
054100     PERFORM 9090-CLOSE-IN-DRIVER-FILE.                           05410001
054200     PERFORM 9790-CLOSE-OUT-EXTRACT-FILE.                         05420001
054300                                                                  05430001
054400*----------------------------------------------------------------*05440001
054500* CALL ABEND                                                     *05450001
054600*----------------------------------------------------------------*05460001
054700     MOVE +4013                  TO ABEND-CODE.                   05470001
054800     CALL 'ILBOABN0' USING ABEND-CODE.                            05480001
054900*                                                                 05490001
