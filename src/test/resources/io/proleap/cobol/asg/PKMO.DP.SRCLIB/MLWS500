      ******************************************************************        
      * THIS WORKING-STORAGE INCLUDE IS USED IN CONJUNCTION WITH                
      * PROCEDURE DIVISION INCLUDE MLPD500.                                     
      ******************************************************************        
                                                                                
       01  ML500-PC-PROGRAM-CONSTANTS.                                          
           05  ML500-PC-MAX                PIC 9(06)  VALUE 436000.             
           05  ML500-PC-TOTAL              PIC S9(05) COMP-3                    
                                                      VALUE ZEROS.              
           05  ML500-PC-MAX-RETRIES        PIC S9(04) VALUE +3                  
                                                           COMP SYNC.           
                                                                                
       01  ML500-PE-PGM-ERROR-MESSAGES.                                         
           05  ML500-PE-MSG-01             PIC X(50)  VALUE                     
                'OPEN MLT-PARTN CURSOR ERROR                     '.             
           05  ML500-PE-MSG-02             PIC X(50)  VALUE                     
                'FETCH MLT-PARTN CURSOR ERROR                    '.             
           05  ML500-PE-MSG-03             PIC X(50)  VALUE                     
                'CLOSE MLT-PARTN CURSOR ERROR                    '.             
           05  ML500-PE-MSG-04             PIC X(50)  VALUE                     
                'INSERT MLT-PARTN-BAL ERROR                      '.             
           05  ML500-PE-MSG-05             PIC X(50)  VALUE                     
                'PROGRAM ABENDED WHILE TRYING TO PERFORM A COMMIT'.             
           05  ML500-PE-MSG-06             PIC X(50)  VALUE                     
                'SELECT MLT-PARTN-BAL ERROR                      '.             
                                                                                
       01  ML500-PS-PROGRAM-SWITCHES.                                           
                                                                                
           05  ML500-PS-MLT-PARTN-DONE-SW   PIC X     VALUE 'N'.                
               88  ML500-PARTN-PROCESS-COMPLETE       VALUE 'Y'.                
                                                                                
           05  ML500-PS-PARTN-FOUND-SW      PIC X     VALUE 'N'.                
               88  ML500-PARTN-FOUND                  VALUE 'Y'.                
               88  ML500-PARTN-NOT-FOUND              VALUE 'N'.                
                                                                                
           05  ML500-PS-BAL-ROW-INSERTED-SW PIC X     VALUE 'N'.                
               88  ML500-BAL-ROW-INSERTED             VALUE 'Y'.                
               88  ML500-BAL-ROW-NOT-INSERTED         VALUE 'N'.                
                                                                                
       01  ML500-PV-PROGRAM-VARIABLES.                                          
                                                                                
           05  ML500-PV-PARTN-NBR           PIC S9(4)  COMP                     
                                                       VALUE ZEROS.             
           05  ML500-PV-DEPT-GP-CDE         PIC X(01)  VALUE SPACE.             
           05  ML500-PV-SQL-SUB             PIC 9(03)  VALUE ZERO.              
           05  ML500-PV-BAL-ROW-INSERTED    PIC S9(11) COMP VALUE ZERO.         
           05  ML500-PV-BAL-ROW-RECHECK     PIC S9(11) COMP VALUE ZERO.         
           05  ML500-PV-REQ-FSCL-BEG-DTE    PIC X(10)  VALUE SPACES.            
           05  ML500-PV-REQ-FSCL-END-DTE    PIC X(10)  VALUE SPACES.            
           05  ML500-PV-FUTURE-END-DTE      PIC X(10)  VALUE SPACES.            
                                                                                
      * TABLE TO CONTAIN INFORMATION ON THE PARTITIONS.                         
       01  ML500-PV-PARTN-NDX               PIC S9(05) COMP-3                   
                                                       VALUE ZEROS.             
       01  ML500-WS-PARTN-TBL.                                                  
           05  ML500-WS-PARTN-TBL-ELEMENTS  OCCURS 436000 TIMES.                
               10  ML500-WS-TM-LVL-CDE      PIC X(01)  VALUE SPACE.             
               10  ML500-WS-FSCL-DTE        PIC X(10)  VALUE SPACES.            
               10  ML500-WS-DEPT-NBR        PIC S9(4)V COMP-3                   
                                                       VALUE ZEROS.             
               10  ML500-WS-PARTN-NBR       PIC S9(4) COMP                      
                                                       VALUE ZEROS.             
               10  ML500-WS-DEPT-GP-CDE     PIC X(01) VALUE SPACE.              
                                                                                
      * THE FOLLOWING FIELDS MUST BE FILLED IN PRIOR TO EXECUTING THE           
      * CODE IN INCLUDE MLPD500.                                                
       01  ML500-INPUT-FIELDS.                                                  
           05  ML500-PV-DEPT-NBR           PIC S9(4)V COMP-3                    
                                                      VALUE ZEROS.              
           05  ML500-PV-FSCL-END-DTE       PIC X(10).                           
           05  ML500-PV-TM-LVL-CDE         PIC X(01)  VALUE SPACE.              
                                                                                
       01  ML500-OUTPUT-FIELDS.                                                 
           05  ML500-PV-DEPT-GP-CDE-OUT    PIC X(01) VALUE SPACE.               
           05  ML500-PV-PARTN-NBR-OUT      PIC S9(4) COMP                       
                                                      VALUE ZEROS.              
           05  ML500-PV-PARAGRAPH-NAME     PIC X(30)  VALUE SPACES.             
           05  ML500-PV-OPERATION-ATTEMPTED   PIC X(40)  VALUE SPACES.          
                                                                                
      ************************************************************              
      *  M/L DETAIL TABLE PARTITION BALANCING TABLE                             
      ************************************************************              
           EXEC SQL                                                             
               INCLUDE MLT00002                                                 
           END-EXEC.                                                            
      *                                                                         
      ************************************************************              
      *  M/L DETAIL TABLE PARTITION CONTROL TABLE                               
      ************************************************************              
           EXEC SQL                                                             
               INCLUDE MLT00003                                                 
           END-EXEC.                                                            
      *                                                                         
                                                                                
      ************************************************************              
      * PARTITION CURSOR.                                                       
      ************************************************************              
           EXEC SQL                                                             
               DECLARE MLT_PARTN_CURSOR CURSOR FOR                              
                 SELECT A.TBL_TM_LVL_CDE, A.FSCL_DTE, B.DEPT_NBR                
                        ,A.PARTN_NBR, A.DEPT_GP_CDE                             
                 FROM MLT_PARTN_CNTL A                                          
                     ,MLT_PARTN_BAL  B                                          
                 WHERE A.TBL_TM_LVL_CDE = B.TBL_TM_LVL_CDE                      
                   AND A.DEPT_GP_CDE = B.DEPT_GP_CDE                            
                   AND A.FSCL_DTE BETWEEN :ML500-PV-REQ-FSCL-BEG-DTE            
                                      AND :ML500-PV-REQ-FSCL-END-DTE            
                   AND A.FSCL_DTE BETWEEN                                       
                       B.EFF_BEG_DTE AND                                        
                           COALESCE(B.EFF_END_DTE, '9999-12-31')                
                   AND :ML500-PV-REQ-FSCL-END-DTE BETWEEN                       
                       B.EFF_BEG_DTE AND                                        
                           COALESCE(B.EFF_END_DTE, '9999-12-31')                
                 ORDER BY 1,2,3,4                                               
                 WITH UR                                                        
                 FOR FETCH ONLY                                                 
           END-EXEC.                                                            
                                                                                
