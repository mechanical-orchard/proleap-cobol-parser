00010 *-----------------------*                                         00010116
00020  IDENTIFICATION DIVISION.                                         00010216
00030 *-----------------------*                                         00010316
00040  PROGRAM-ID.    TRKCS160.                                         00010417
00050  AUTHOR.        NIRMAL KUMAR.                                     00010516
00060  INSTALLATION.  KOHLS DEPARTMENT STORES.                          00010616
00070  DATE-WRITTEN.  04/98.                                            00010783
00080  DATE-COMPILED.                                                   00010816
00090 *----------------------------------------------------------------*00010916
00100 *   Y160 - IMPORT PO TRACKING CTIT SPEC.                         *00011017
00110 *                                                                *00011116
00120 *   THIS PROGRAM ALLOWS THE USER ENTER DATA TO BE USED BY        *00011217
00130 *   SUBSEQUENT PROGRAMS TO CREATE A LIST OR TO BRING UP A        *00011317
00140 *   SUMMARY. ALL OTHER EDITS ARE DONE IN THE DESTINATION PROGRAMS*00011417
00160 *   WHEN THE 'GO-TO' TYPE FUNCTION IS USED.                      *00011617
00160 *   (LOCAL-FUNC-01 THRU LOCAL-FUNC-12, WITH DISPOSITION 'G')     *00011784
00170 *----------------------------------------------------------------*00011816
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697         00012089
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00012189
263697* MAKING THE CALL DYNAMIC VS STATIC.                              00012289
263697*---------------------------------------------------------------* 00012389
CICS  * CHANGED  1/12/2023    BY JIM HUNTER      WR: CHG0278495         00012490
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00012590
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00012690
CICS  *-----------------------------------------------------------------00012790
00180                                                                   00012816
00210  ENVIRONMENT DIVISION.                                            00012916
00220                                                                   00013016
00250  DATA DIVISION.                                                   00013116
00260                                                                   00013216
00280  WORKING-STORAGE SECTION.                                         00013316
00290                                                                   00013416
00290  01  DK-DB2-KEY.                                                  00013522
00290      05  DK-PO-NBR                 PIC S9(09) COMP.               00013651
00290 *                                                                 00013763
00300  01  PC-PROGRAM-CONSTANTS.                                        00013816
00310      05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'TR160A  '. 00013917
00320      05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'TRKM160 '. 00014017
00330      05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'TRKCS160'. 00014117
00330      05  PC-MAX-RETRIES            PIC S9(04)  VALUE  +3          00014261
00330                                                COMP.              00014361
00340      05  PC-TSYMSG-NUMBERS.                                       00014416
00350          10  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.      00014516
00350          10  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.      00014618
00380 *                                                                 00014716
00390  01  PS-PROGRAM-SWITCHES.                                         00014816
00400      05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        00014916
00410          88  PS-ERROR                          VALUE  'Y'.        00015016
00420          88  PS-NO-ERROR                       VALUE  'N'.        00015116
00430 *                                                                 00015216
00390  01  PV-PROGRAM-VARIABLES.                                        00016061
00420      05  PV-RETRY-COUNTER          PIC S9(04)  VALUE +0           00017061
00390                                                COMP SYNC.         00018061
00400 *                                                                 00019061
00430  01  PM-PROGRAM-MESSAGES.                                         00068016
00430      05  PM-ABEND-INFO-A.                                         00068116
00430          10  FILLER                PIC X(15)   VALUE              00068216
00430                                    'DP020-SRC-AID: '.             00068316
00430          10  PM-A-SRC-AID          PIC X(02)   VALUE  SPACE.      00068416
00430          10  FILLER                PIC X(19)   VALUE              00068516
00430                                    '. DP020-FK-ACTION: '.         00068616
00430          10  PM-A-FK-ACTION        PIC X(01)   VALUE  SPACE.      00068716
00431          10  FILLER                PIC X(22)   VALUE              00068816
00431                                    '. DP020-FK-DISPN-IND: '.      00068916
00431          10  PM-A-FK-DISPN         PIC X(01)   VALUE  SPACE.      00069016
00431          10  FILLER                PIC X(01)   VALUE '.'.         00069116
00431          10  FILLER                PIC X(19)   VALUE SPACE.       00069216
00432                                                                   00069416
00440 *----------------------------------------------------------------*00069516
00450 *    MAP LAYOUT                                                  *00069616
00460 *----------------------------------------------------------------*00069716
00470                                                                   00069816
00480      COPY TRKM160.                                                00069918
00610                                                                   00070016
00490  EJECT                                                            00070116
00500 *----------------------------------------------------------------*00070216
00510 *    ATTRIBUTE SETTINGS COPYBOOK.                                *00070316
00520 *----------------------------------------------------------------*00070416
00530                                                                   00070516
00540      COPY DPWS015.                                                00070616
00550                                                                   00070716
00610  EJECT                                                            00070816
00560 *----------------------------------------------------------------*00070916
00570 *    FUNCTION KEYS COPYBOOK                                      *00071016
00580 *----------------------------------------------------------------*00071116
00590                                                                   00071216
00600      COPY DPWS016.                                                00071316
00590                                                                   00071416
00610  EJECT                                                            00071516
00680 *----------------------------------------------------------------*00071618
00680 *  THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT     *00071718
00680 *  SUB-ROUTINE (DPKUT100).                                       *00071818
00680 *----------------------------------------------------------------*00071918
00590                                                                   00072018
00680      COPY DPWS010I.                                               00072118
00590                                                                   00072218
00680  EJECT                                                            00072318
00680 *----------------------------------------------------------------*00072416
00690 *  THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS             *00072516
00700 *  ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                     *00072616
00710 *----------------------------------------------------------------*00072716
00590                                                                   00072816
00720      COPY DPWS030.                                                00072916
CICS       COPY DPWS930.                                                00073090
00590                                                                   00073116
00730  EJECT                                                            00073216
00740 *----------------------------------------------------------------*00073316
00750 *    STANDARD COMMAREA.                                          *00073416
00760 *----------------------------------------------------------------*00073516
00770                                                                   00073616
00780      COPY DPWS020.                                                00073716
00790      05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                00073816
00800                                                                   00073916
00810 *----------------------------------------------------------------*00074016
00820 *    INTER-APPLICATION COMMAREA.                                 *00074116
00830 *----------------------------------------------------------------*00074216
00840                                                                   00074316
00850          10  INTER-APPL-COMM-AREA PIC X(200).                     00074416
00860      COPY TRWS105.                                                00074579
00840                                                                   00074616
00870 *----------------------------------------------------------------*00074716
00880 *    SPECIFIC COMMMAREA FOR TRKCS160.                            *00074819
00890 *----------------------------------------------------------------*00074916
00840                                                                   00075016
00900          10  ASC-SPECIFIC-COMMAREA.                               00075116
00910              15  ASC-KEY.                                         00075233
00910                  20 ASC-KEY-PO-NBR           PIC S9(09) COMP.     00075351
00840                                                                   00075466
00910              15  ASC-PO-NBR                  PIC  X(09).          00075565
00910              15  ASC-PO-NBR-N REDEFINES ASC-PO-NBR                00075665
00910                                              PIC S9(09) COMP.     00075765
00910              15  ASC-VND-NME                 PIC  X(30).          00075918
00840                                                                   00076066
00910              15  ASC-KEY-EDIT-SW             PIC  X(01).          00076140
00910                  88 ASC-KEY-EDITED           VALUE  'Y'.          00076240
00910                  88 ASC-KEY-NOT-EDITED       VALUE  'N'.          00076340
00840                                                                   00076416
00970  EJECT                                                            00076516
00980 *----------------------------------------------------------------*00076616
00990 *    ABEND PROCESSING COPYBOOK.                                  *00076716
01000 *----------------------------------------------------------------*00076816
01010                                                                   00076916
01020      COPY DPWS013.                                                00077016
01040                                                                   00077116
01050  EJECT                                                            00078016
00355 *---------------------------------------------------------------* 00079321
00356 *    DB2 AREA FOR TPURCHS                                       * 00079421
00357 *---------------------------------------------------------------* 00079521
00358      EXEC SQL                                                     00079621
00359           INCLUDE TPURCHS                                         00079721
00360      END-EXEC.                                                    00079821
00355 *---------------------------------------------------------------* 00079921
00356 *    DB2 AREA FOR TENTNME                                       * 00080021
00357 *---------------------------------------------------------------* 00080121
00358      EXEC SQL                                                     00080221
00359           INCLUDE TENTNME                                         00080321
00360      END-EXEC.                                                    00080421
00361 *---------------------------------------------------------------* 00080521
00362 *    DB2 AREA FOR COMMUNICATIONS                                * 00080621
00363 *---------------------------------------------------------------* 00080721
00364      EXEC SQL                                                     00080821
00365           INCLUDE SQLCA                                           00080921
00366      END-EXEC.                                                    00081021
00363 *---------------------------------------------------------------* 00081121
01070                                                                   00081285
01060  LINKAGE SECTION.                                                 00081316
01070                                                                   00081416
01080  01  DFHCOMMAREA.                                                 00081516
01090      05  FILLER                         OCCURS  1 TO 4072 TIMES   00081616
01100                                         DEPENDING ON EIBCALEN.    00081716
01110          10  FILLER                     PIC X.                    00081816
01130                                                                   00081916
01130 *---------------------------------------------------------------* 00082016
01140  PROCEDURE DIVISION.                                              00082116
01150 *---------------------------------------------------------------* 00082216
01160 *  THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM.  * 00082316
01170 *  THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API   * 00082416
01180 *  MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.             * 00082516
01190 *                                                               * 00082616
01200 *  THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE   * 00082716
01210 *  LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.        * 00082816
01220 *---------------------------------------------------------------* 00082916
01230  0000-MAIN-MODULE.                                                00083016
01130                                                                   00083116
01240      INITIALIZE DP030-CICS-API-FIELDS.                            00083216
01250      MOVE +1                       TO DP030-NUMBER-OF-MAPS.       00083316
01260      MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          00083416
01270      MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         00083516
01280      SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       00083616
01290      MOVE LENGTH OF TR160AI        TO DP030-MAP-LENGTH (1).       00083719
01300      MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     00083816
01310      PERFORM 0001-CALL-CICS-ARCH-API.                             00083916
01320 *                                                                 00084016
01330      PERFORM 1000-CONTROL-PROCESSING                              00084116
01340 *                                                                 00084216
01350      MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     00084316
01360      PERFORM 0001-CALL-CICS-ARCH-API.                             00084416
01130                                                                   00084516
01370 *---------------------------------------------------------------* 00084616
01370 *    CALL THE ARCHITECTURE API.                                 * 00084716
01370 *---------------------------------------------------------------* 00084816
01380  0001-CALL-CICS-ARCH-API.                                         00084916
01370                                                                   00085016
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      00085290
01400                            DFHCOMMAREA                            00085316
01410                            DP030-CICS-API-FIELDS                  00085416
01420                            DP020-STANDARD-COMMAREA                00085516
01430                            TR160AI.                               00085619
01440 *                                                                 00085716
01450      IF  DP030-RC-CALL-SUCCESSFUL  OR                             00085816
01460          DP030-RC-APPL-ERROR                                      00085916
01460          CONTINUE                                                 00086016
01470      ELSE                                                         00086116
01480          SET DP013-NO-ROLLBACK                                    00086216
01490              DP013-XCTL-DISPLAY-RESTART                           00086316
01500              DP013-CICS-ABEND      TO TRUE                        00086416
01510          MOVE 'BEFORE 0000-MAIN-MODULE'                           00086516
01520                                    TO DP013-PARAGRAPH             00086616
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O00086990
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      00087090
01550          MOVE DP030-RETURN-CODE                                   00087116
01560                                    TO DP013-MESSAGE-TEXT (3)      00087216
01570          PERFORM DP013-0000-PROCESS-ABEND                         00087316
01580      END-IF.                                                      00087416
01580                                                                   00087516
01590  EJECT                                                            00087616
01600 *----------------------------------------------------------------*00087716
01610 *    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *00087816
01620 *    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *00087916
01630 *----------------------------------------------------------------*00088016
01650  1000-CONTROL-PROCESSING.                                         00088116
01660                                                                   00088216
01670      EVALUATE TRUE                                                00088316
01680          WHEN DP020-NEXT-ACT-INITIAL                              00088416
01690              INITIALIZE ASC-SPECIFIC-COMMAREA                     00088516
01700              PERFORM 4000-BUILD-INITIAL-PANEL                     00088616
01710                                                                   00088716
01720          WHEN DP020-NEXT-ACT-READ-MAP                             00088816
01730              PERFORM 2000-FKEY-PROCESSING                         00088916
01740                                                                   00089016
01750          WHEN DP020-NEXT-ACT-RETURN                               00089116
01760              MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   00089233
02030              PERFORM 3300-SELECT-VENDOR-NAME                      00089333
01760              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 00089416
01780                                                                   00089516
01790          WHEN OTHER                                               00089616
01800              SET DP013-LOGIC-ABEND                                00089716
01810                  DP013-NO-ROLLBACK TO TRUE                        00089816
01820              MOVE '1000-CONTROL-PROCESSING'                       00089916
01830                                    TO  DP013-PARAGRAPH            00090016
01840              MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   00090116
01850                                    TO  DP013-MESSAGE-TEXT(1)      00090216
01860              MOVE DP020-NEXT-APPL-ACTIVITY                        00090316
01870                                    TO DP013-MESSAGE-TEXT(2)       00090416
01880              PERFORM DP013-0000-PROCESS-ABEND                     00090516
01890      END-EVALUATE.                                                00090616
01900                                                                   00090716
01590  EJECT                                                            00090816
01910 *----------------------------------------------------------------*00090916
01920 * FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*00091016
01930 * SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*00091116
01940 * EDITS.                                                         *00091216
01950 *----------------------------------------------------------------*00091316
01970  2000-FKEY-PROCESSING.                                            00091416
01980                                                                   00091516
01990      EVALUATE TRUE                                                00091616
02010          WHEN DP020-SRC-AID = DP016-CLEAR                         00091916
02020              PERFORM 3000-EDIT-DATA-IN-COMMAREA                   00092016
02030              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 00092116
02040                                                                   00092216
02050          WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     00092316
02060              INITIALIZE ASC-SPECIFIC-COMMAREA                     00092416
02070              PERFORM 4000-BUILD-INITIAL-PANEL                     00092516
02080              PERFORM 3200-RESET-ATTRIBUTES                        00092616
02090                                                                   00092716
02100          WHEN OTHER                                               00092816
02110              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 00093344
02120              PERFORM 3000-EDIT-DATA-IN-COMMAREA                   00093475
02130              IF  PS-NO-ERROR                                      00093916
02140                  SET DP030-CONTINUE-GO TO TRUE                    00094016
02150                  PERFORM 2100-CHECK-FUNCTION-KEY                  00094116
02160              ELSE                                                 00094216
00723                  MOVE DP015-UNP-ALP-BRT-OFF                       00094376
00724                                              TO APONBRA           00094476
00731                  MOVE DP015-RED              TO APONBRC           00094576
00738                  MOVE DP015-REVERSE          TO APONBRH           00094676
00745                  MOVE -1                     TO APONBRL           00094776
00752                  SET DP030-SET-CURSOR-APPL-1 TO TRUE              00094876
03560                  MOVE SPACES                 TO AVNDNMEO          00094976
02170                  SET DP030-OVERRIDE-GO       TO TRUE              00095076
02180              END-IF                                               00095116
02190      END-EVALUATE.                                                00095216
01980                                                                   00095316
01980  EJECT                                                            00095416
02200 *----------------------------------------------------------------*00095516
02210 *  ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED      *00095616
02220 *  FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED  *00095716
02230 *  FROM THE CICS ARCHITECTURE API.                               *00095816
02240 *----------------------------------------------------------------*00095916
02250  2100-CHECK-FUNCTION-KEY.                                         00096016
02290                                                                   00096116
02260      EVALUATE TRUE                                                00096216
02271          WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 00096316
02271          WHEN DP020-FK-DISPN-GO (DP020-SRC-AID)                   00096416
02280              PERFORM 2110-PREPARE-INTER-APPL-COMM                 00096616
02290                                                                   00096716
02300          WHEN DP020-SRC-AID = DP016-ENTER                         00096816
01760              MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   00096934
02030              PERFORM 3300-SELECT-VENDOR-NAME                      00097029
02030              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 00097129
02320                                                                   00097216
02330          WHEN OTHER                                               00097316
02340              SET DP013-NO-ROLLBACK                                00097416
02350                  DP013-XCTL-DISPLAY-RESTART                       00097516
02360                  DP013-CICS-ABEND  TO TRUE                        00097616
02370              MOVE '2100-CHECK-FUNCTION-KEY'                       00097716
02380                                    TO DP013-PARAGRAPH             00097816
02390              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      00097916
02400                                    TO DP013-MESSAGE-TEXT (1)      00098016
02401              MOVE 'OR CODE MISSING FROM THIS PROGRAM TO PROCESS:' 00098116
02402                                    TO DP013-MESSAGE-TEXT (2)      00098216
02402              MOVE DP020-SRC-AID    TO PM-A-SRC-AID                00098316
02402              MOVE DP020-FK-ACTION (DP020-SRC-AID)                 00098416
02402                                    TO PM-A-FK-ACTION              00098516
02402              MOVE DP020-FK-DISPN-IND (DP020-SRC-AID)              00098616
02402                                    TO PM-A-FK-DISPN               00098716
02403              MOVE PM-ABEND-INFO-A  TO DP013-MESSAGE-TEXT (3)      00098816
02407              MOVE 'REVIEW PFKEYS SETUP FOR THIS MNEMONIC.'        00098916
02408                                    TO DP013-MESSAGE-TEXT (4)      00099016
02410              PERFORM DP013-0000-PROCESS-ABEND                     00099116
02420      END-EVALUATE.                                                00099216
02320                                                                   00099316
02320  EJECT                                                            00099416
02430 *----------------------------------------------------------------*00099516
02440 *  MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE    *00099616
02450 *  INTER-APPLICATION COMMAREA.                                   *00099716
02460 *----------------------------------------------------------------*00099816
02470  2110-PREPARE-INTER-APPL-COMM.                                    00099916
02320                                                                   00100016
 0663 ***  INITIALIZE TR105-INTER-APPL-COMMAREA                         00100288
 0663      MOVE LOW-VALUES TO TR105-INTER-APPL-COMMAREA                 00100388
02490      MOVE ASC-KEY-PO-NBR           TO TR105-PO-NBR.               00100488
02320                                                                   00100588
02530  EJECT                                                            00100688
02540 *----------------------------------------------------------------*00100788
02550 * MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*00100888
02560 * THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *00100988
02570 * APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *00101088
02580 *----------------------------------------------------------------*00101188
02600  2200-MOVE-SCREEN-TO-COMMAREA.                                    00101288
02590                                                                   00101388
02590      EVALUATE TRUE                                                00101488
02590          WHEN APONBRL = ZERO                                      00101588
02640               IF APONBRF = DP015-ERASE-EOF                        00101688
02650                   MOVE SPACES           TO ASC-PO-NBR             00101788
02660               ELSE                                                00101888
02130                   IF  ASC-KEY-EDITED                              00101988
02620                       MOVE ASC-KEY-PO-NBR   TO ASC-PO-NBR         00102088
02660                   END-IF                                          00102188
02660               END-IF                                              00102288
02590                                                                   00102388
02610          WHEN APONBRL > ZERO                                      00102488
02620               MOVE APONBRI              TO ASC-PO-NBR             00102588
02130               SET ASC-KEY-EDITED        TO TRUE                   00102688
02590      END-EVALUATE.                                                00103078
02590                                                                   00103271
02530  EJECT                                                            00104716
02920 *----------------------------------------------------------------*00104816
02930 * ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *00104916
02940 * CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *00105016
02950 * A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*00105116
02960 * IN THE DESTINATION PROGRAM, NOT HERE.                          *00105216
02970 *----------------------------------------------------------------*00105316
02990  3000-EDIT-DATA-IN-COMMAREA.                                      00105416
02980                                                                   00105516
03000      PERFORM 3200-RESET-ATTRIBUTES.                               00105616
03010 *--- TSYMSG-007-REQUIRED ENTRY                                    00105786
00717      IF ASC-PO-NBR = SPACES                                       00105850
00720          SET PS-ERROR                                             00105918
00721              DP020-MSG-FATAL   TO TRUE                            00106018
00722          MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER                00106118
03220      ELSE                                                         00106918
03010 *------- TSYMSG-008-MUST BE NUMERIC                               00107086
03020          MOVE ASC-PO-NBR           TO DP010I-UNEDITED-FIELD       00107118
03030          MOVE LENGTH OF ASC-PO-NBR TO DP010I-MAXIMUM-DIGITS       00107218
03040          MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     00107318
03050          SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  00107418
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                         00107689
263697              USING DP010I-NUMERIC-EDIT-AREA                      00107789
03070          IF  DP010I-ERROR-DETECTED                                00107818
03080              SET PS-ERROR                                         00107918
03090                  DP020-MSG-FATAL   TO TRUE                        00108018
03100              MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            00108118
03170          ELSE                                                     00108720
03180              MOVE DP010I-NUMERIC-FIELD                            00108820
03200                                    TO ASC-PO-NBR-N                00108950
03200                                       ASC-KEY-PO-NBR              00109059
03210          END-IF                                                   00109118
03220      END-IF.                                                      00109218
03230                                                                   00109316
03230  EJECT                                                            00109416
03300 *----------------------------------------------------------------*00109516
03310 *  MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE  *00109616
03320 *  MAP.                                                          *00109716
03330 *----------------------------------------------------------------*00109816
03340  3200-RESET-ATTRIBUTES.                                           00109916
03470                                                                   00110016
03350      MOVE DP015-UNP-ALP-NOR-OFF    TO APONBRA.                    00110118
03390      MOVE DP015-GREEN              TO APONBRC.                    00110277
03430      MOVE DP015-UNDERLINE          TO APONBRH.                    00110377
03470                                                                   00110416
03470  EJECT                                                            00110516
03480 *----------------------------------------------------------------*00110620
03470 *  SELECT VENDOR NAME FROM TPURCHS,TENTNME                       *00110761
03480 *----------------------------------------------------------------*00110816
03470  3300-SELECT-VENDOR-NAME.                                         00110920
03470                                                                   00111022
00334      PERFORM                                                      00113661
00335          WITH TEST AFTER                                          00113761
00336          VARYING PV-RETRY-COUNTER                                 00113861
00337          FROM 1 BY 1                                              00113961
00338          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               00114061
00339              OR (SQLCODE = ZERO)                                  00114161
00340              OR (SQLCODE = +100))                                 00114261
03470                                                                   00114384
03470          EXEC SQL                                                 00114461
03470               SELECT DISTINCT                                     00114561
03470                      A.ENT_NAME_DESC                              00114661
03470               INTO   :ENTNME-ENT-NAME-DESC                        00114761
03470               FROM   TENTNME  A,                                  00114861
03470                      TPURCHS  B                                   00114961
03470               WHERE  B.PO_NBR       = :DK-PO-NBR                  00115061
03470               AND    A.ENT_ID       = B.ENT_ID                    00115161
03470               AND    VER_STATUS_CDE = 'A'                         00116061
03470               AND    A.TYPE_CDE     = '01'                        00117061
03470          END-EXEC                                                 00117161
00376                                                                   00117261
00376          EVALUATE TRUE                                            00117861
00379              WHEN SQLCODE = -904                                  00118161
00380              WHEN SQLCODE = -913                                  00118261
00381                  CONTINUE                                         00118361
00377              WHEN SQLCODE = ZERO                                  00118461
03480                   MOVE ENTNME-ENT-NAME-DESC TO ASC-VND-NME        00118561
00378              WHEN SQLCODE = +100                                  00118661
03560                   MOVE SPACES               TO ASC-VND-NME        00118761
00382              WHEN SQLWARN0 NOT = SPACES                           00118861
00383              WHEN SQLCODE < ZERO                                  00118961
00384              WHEN SQLCODE > ZERO                                  00119061
00385                  MOVE '3300-SELECT-VENDOR-NAME'                   00119161
00386                                    TO DP013-PARAGRAPH             00119261
00387                  MOVE 'SQL ERROR SELECTING VENDOR NAME'           00119361
00388                                    TO DP013-MESSAGE-TEXT (1)      00119461
00389                  MOVE SQLCA        TO DP013-SQLCA                 00119561
00390                  MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (1)    00119661
00391                  SET DP013-DB2-ABEND                              00119761
00392                      DP013-XCTL-DISPLAY-RESTART TO TRUE           00119861
00393                  PERFORM DP013-0000-PROCESS-ABEND                 00119961
00394          END-EVALUATE                                             00120061
00395      END-PERFORM.                                                 00120161
00396 *                                                                 00120261
00397      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        00120361
00398          MOVE '3300-SELECT-VENDOR-NAME'                           00120461
00398                                    TO DP013-PARAGRAPH             00120561
00399          MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT VENDO00120661
00400 -             'R NAME'             TO DP013-MESSAGE-TEXT (1)      00120761
00401          MOVE SQLCA                TO DP013-SQLCA                 00120861
00402          MOVE 'TPURCHS '           TO DP013-DB2-TABLE-NAME (1)    00120961
00403          SET DP013-DB2-ABEND                                      00121061
00404              DP013-XCTL-DISPLAY-RESTART                           00121161
00405                                    TO TRUE                        00121261
00406          PERFORM DP013-0000-PROCESS-ABEND                         00121361
00407      END-IF.                                                      00121461
03480                                                                   00123222
03480  EJECT                                                            00123361
03480 *----------------------------------------------------------------*00123420
03490 *  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *00123516
03500 *  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *00123616
03510 *  IT HERE.                                                      *00123716
03520 *----------------------------------------------------------------*00123816
03530  4000-BUILD-INITIAL-PANEL.                                        00123916
03560                                                                   00124016
03560      MOVE ZEROS                    TO APONBRO.                    00124163
03560      MOVE SPACES                   TO AVNDNMEO.                   00124318
03540      SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       00124416
03550      MOVE -1                       TO APONBRL.                    00124518
03560                                                                   00124616
03650  EJECT                                                            00124716
03570 *----------------------------------------------------------------*00124816
03580 *    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *00124916
03590 *----------------------------------------------------------------*00125016
03600  4400-MOVE-COMMAREA-TO-SCREEN.                                    00125116
03560                                                                   00125216
03610      MOVE ASC-PO-NBR-N             TO APONBRO                     00125350
03610                                       ASC-KEY-PO-NBR.             00125433
03610      MOVE ASC-VND-NME              TO AVNDNMEO.                   00125526
00388      MOVE -1                       TO APONBRL.                    00125618
00389      SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       00125712
03560                                                                   00125816
03650  EJECT                                                            00125916
03660 *----------------------------------------------------------------*00126016
03670 *    ABEND PROCESSOR MODULE                                      *00126116
03680 *----------------------------------------------------------------*00126216
03690                                                                   00127016
03700      COPY DPPD013.                                                00130016
