000100 IDENTIFICATION DIVISION.                                         00010005
000200 PROGRAM-ID.     APKUT061.                                        00020005
000300 AUTHOR.         COGNIZANT.                                       00030005
000400 DATE-WRITTEN.   MARCH 2019.                                      00040005
000500 DATE-COMPILED.                                                   00050005
000600***************************************************************** 00060005
000700*  THIS PROGRAM IS TO FORMAT THE LEGACY INVOICE STATUS UPDATE   * 00070005
000800*  RECORDS FROM THE ORACLE LEGACY PAYMENT EXTRACT FILE.         * 00080005
000900*                                                               * 00090005
001000* INPUT:                                                        * 00100005
001100*  1. LEGACY AP PAYMENT EXTRACT                   (APRD083)     * 00110005
001200*                                                               * 00120005
001300* OUTPUT:                                                       * 00130005
001400*  1. LEGACY INVOICE STATUS UPDATES               (APRD066)     * 00140005
001500*                                                               * 00150005
001600***************************************************************** 00160005
001700* CHANGE LOG:                                                   * 00170005
001800*                                                               * 00180005
001900* 03/04/19  NEW PROGRAM AS PART OF PEOPLESOFT ERP MIGRATION.    * 00190005
002000*   CHANGED BY COGNIZANT.                     WR# CHG0220043    * 00200005
002100*                                                               * 00210005
001900* 05/11/21  PROCESS P01 (SEPHORA PRE-PAID) THE SAME AS M01      * 00211009
002000*   CHANGED BY JEAN KURK                      WR# CHG0256545    * 00212008
002100*                                                               * 00213008
002200***************************************************************** 00220005
002300                                                                  00230005
002400 ENVIRONMENT DIVISION.                                            00240005
002500 CONFIGURATION SECTION.                                           00250005
002600 SOURCE-COMPUTER.    IBM-3090.                                    00260005
002700 OBJECT-COMPUTER.    IBM-3090.                                    00270005
002800                                                                  00280005
002900 INPUT-OUTPUT SECTION.                                            00290005
003000 FILE-CONTROL.                                                    00300005
003100     SELECT PAYMENT-DETAIL-FILE           ASSIGN TO UT-S-INP01.   00310006
003200     SELECT INVOICE-UPDATE-FILE           ASSIGN TO UT-S-OUT01.   00320006
003300                                                                  00330005
003400 DATA DIVISION.                                                   00340005
003500 FILE SECTION.                                                    00350005
003600                                                                  00360005
003700 FD  PAYMENT-DETAIL-FILE                                          00370006
003800     RECORDING MODE IS F                                          00380005
003900     LABEL RECORDS ARE STANDARD                                   00390005
004000     BLOCK CONTAINS 0 RECORDS                                     00400005
004100     DATA RECORD IS PAYMENT-DETAIL-REC.                           00410006
004200 01  PAYMENT-DETAIL-REC             PIC X(222).                   00420006
004300                                                                  00430005
004400 FD  INVOICE-UPDATE-FILE                                          00440006
004500     RECORDING MODE IS F                                          00450005
004600     LABEL RECORDS ARE STANDARD                                   00460005
004700     BLOCK CONTAINS 0 RECORDS                                     00470005
004800     DATA RECORD IS INVOICE-UPDATE-REC.                           00480006
004900 01  INVOICE-UPDATE-REC             PIC  X(075).                  00490006
005000                                                                  00500005
005100 WORKING-STORAGE SECTION.                                         00510005
005200                                                                  00520005
005300 01  EOF-SW                      PIC  X         VALUE 'N'.        00530005
005400     88  IN-EOF                                 VALUE 'Y'.        00540005
005500                                                                  00550005
005600 01  PV-COUNTERS.                                                 00560005
005700     05  PV-INPUT-COUNT          PIC  9(07)     COMP-3.           00570005
005800     05  PV-OUTPUT-COUNT         PIC  9(07)     COMP-3.           00580005
005900                                                                  00590005
006000*----------------------------------------------------------------*00600005
006100*  LEGACY AP PAYMENT EXTRACT FILE (INPUT).                       *00610005
006200*----------------------------------------------------------------*00620005
006300     COPY APRD083.                                                00630005
006400                                                                  00640005
006500*----------------------------------------------------------------*00650005
006600*  LEGACY INVOICE STATUS UPDATE FILE.                            *00660005
006700*----------------------------------------------------------------*00670005
006800     COPY APRD066.                                                00680005
006900                                                                  00690005
007000 PROCEDURE DIVISION.                                              00700005
007100*----------------------------------------------------------------*00710005
007200*    MAIN DRIVER PARAGRAPH.                                      *00720005
007300*----------------------------------------------------------------*00730005
007400 A100-MAIN.                                                       00740005
007500                                                                  00750005
007600     PERFORM B100-INITIALIZE.                                     00760005
007700                                                                  00770005
007800     PERFORM B200-PROCESS                                         00780005
007900         UNTIL IN-EOF.                                            00790005
008000                                                                  00800005
008100     PERFORM B300-TERMINATION.                                    00810005
008200                                                                  00820005
008300     GOBACK.                                                      00830005
008400 EJECT                                                            00840005
008500*----------------------------------------------------------------*00850005
008600*    INITIALIZATION PROCESSING.                                  *00860005
008700*----------------------------------------------------------------*00870005
008800 B100-INITIALIZE.                                                 00880005
008900                                                                  00890005
009000     OPEN INPUT  PAYMENT-DETAIL-FILE                              00900006
009100          OUTPUT INVOICE-UPDATE-FILE.                             00910006
009200                                                                  00920005
009300     INITIALIZE  AP066-RECORD.                                    00930005
009400                                                                  00940005
009500     PERFORM R100-READ-INPUT.                                     00950005
009600                                                                  00960005
009700*----------------------------------------------------------------*00970005
009800*    FORMAT THE INPUT RECORD TO THE OUTPUT RECORD LAYOUT.        *00980005
009900*    WRITE OUT THE OUTPUT RECORD IN OUTPUT FILE.                 *00990005
010000*    READ THE NEXT INPUT RECORD.                                 *01000005
010100*----------------------------------------------------------------*01010005
010200 B200-PROCESS.                                                    01020005
010300                                                                  01030005
010400     EVALUATE AP083-INVC-SRC                                      01040005
010500         WHEN 'M01'                                               01050005
010600         WHEN 'I01'                                               01060005
010700         WHEN 'I70'                                               01070005
010700         WHEN 'P01'                                               01071008
010800              MOVE AP083-PO-NBR         TO AP066-PO-NBR           01080005
010900              MOVE AP083-DOC-NBR        TO AP066-DOC-NBR          01090005
011000              MOVE AP083-PAYMENT-ID-REF TO AP066-CHECK-NBR        01100005
011100              IF AP083-INVC-SRC = 'I70'                           01110005
011200                 MOVE 'EI'              TO AP066-DOC-TYPE         01120005
011300              ELSE                                                01130005
011400                 MOVE 'MI'              TO AP066-DOC-TYPE         01140005
011500              END-IF                                              01150005
011600                                                                  01160005
011700              PERFORM W100-WRITE-OUTPUT                           01170005
011800         WHEN OTHER                                               01180005
011900              CONTINUE                                            01190005
012000     END-EVALUATE.                                                01200005
012100                                                                  01210005
012200     INITIALIZE AP066-RECORD.                                     01220005
012300                                                                  01230005
012400     PERFORM R100-READ-INPUT.                                     01240005
012500                                                                  01250005
012600*----------------------------------------------------------------*01260005
012700*    END OF PROGRAM PROCESSING.                                  *01270005
012800*----------------------------------------------------------------*01280005
012900 B300-TERMINATION.                                                01290005
013000     DISPLAY '**********************************************'.    01300005
013100     DISPLAY '**         APKUT061 RECORD COUNTS           **'.    01310005
013200     DISPLAY '**********************************************'.    01320005
013300     DISPLAY 'RECORDS READ        = ' PV-INPUT-COUNT.             01330005
013400     DISPLAY 'UPDATE RECORDS WRITTEN = ' PV-OUTPUT-COUNT.         01340007
013500     DISPLAY '**********************************************'.    01350005
013600                                                                  01360005
013700     CLOSE PAYMENT-DETAIL-FILE                                    01370006
013800           INVOICE-UPDATE-FILE.                                   01380006
013900                                                                  01390005
014000*----------------------------------------------------------------*01400005
014100*    READ THE INPUT FILE.                                        *01410005
014200*----------------------------------------------------------------*01420005
014300 R100-READ-INPUT.                                                 01430005
014400                                                                  01440005
014500     INITIALIZE AP083-RECORD.                                     01450005
014600                                                                  01460005
014700     READ PAYMENT-DETAIL-FILE INTO AP083-RECORD                   01470006
014800       AT END                                                     01480005
014900          SET IN-EOF             TO TRUE.                         01490005
015000                                                                  01500005
015100     IF EOF-SW = 'N'                                              01510005
015200        ADD 1                    TO PV-INPUT-COUNT                01520005
015300     END-IF.                                                      01530005
015400                                                                  01540005
015500*----------------------------------------------------------------*01550005
015600*    WRITE THE FORMATED RECORD TO THE OUTPUT FILE.               *01560005
015700*----------------------------------------------------------------*01570005
015800 W100-WRITE-OUTPUT.                                               01580005
015900                                                                  01590005
016000     WRITE INVOICE-UPDATE-REC    FROM AP066-RECORD.               01600006
016100                                                                  01610005
016200     ADD 1 TO PV-OUTPUT-COUNT.                                    01620005
