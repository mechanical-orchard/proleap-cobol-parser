000100 IDENTIFICATION DIVISION.                                         00010000
000200******************************************************************00020000
000300*  ADD TRANSACTION NUMBER TO LM FILE                              00030001
000310*  PROGRAM WILL READ IN A FILE LM LABOR FILE AND FILE THAT        00031018
000320*  CONTIANS THE LAST USED TRANSACTION NUMBER. PROGRAM WILL ADD +1 00032018
000330*  TO THE TRANSACTION NUMBER AND ADD THE INCREMENTAL NUMBER TO    00033018
000340*  EACH LM RECORD.                                                00034018
000400******************************************************************00040000
000500                                                                  00050000
000600 PROGRAM-ID.        DLKUT034.                                     00060001
000700 AUTHOR.            GERMAN BANDA.                                 00070000
000800 INSTALLATION.      KOHLS.                                        00080000
000900 DATE-WRITTEN       MAY 2015.                                     00090000
001000 DATE-COMPILED.                                                   00100000
001100***************************************************************** 00110000
001200***************************************************************** 00120000
001300                                                                  00130000
001400 ENVIRONMENT DIVISION.                                            00140000
001500 CONFIGURATION SECTION.                                           00150000
001600 SOURCE-COMPUTER.   IBM-3090.                                     00160000
001700 OBJECT-COMPUTER.   IBM-3090.                                     00170000
001800 INPUT-OUTPUT SECTION.                                            00180000
001900                                                                  00190000
002000 FILE-CONTROL.                                                    00200000
002100     SELECT LABOR-UPDATE-FILE                                     00210001
002200         ASSIGN TO INP01.                                         00220000
002210     SELECT TRANS-NUMBER-FILE-IN                                  00221002
002220         ASSIGN TO INP02.                                         00222002
002300     SELECT EDITED-UPDATE-FILE                                    00230000
002400         ASSIGN TO OUT01.                                         00240000
002410     SELECT TRANS-NUMBER-FILE-OUT                                 00241002
002420         ASSIGN TO OUT02.                                         00242002
002500                                                                  00250000
002600 DATA DIVISION.                                                   00260000
002700 FILE SECTION.                                                    00270000
002800 FD  LABOR-UPDATE-FILE                                            00280001
002900     RECORDING MODE IS F                                          00290000
003000     DATA RECORD IS LABOR-UPDATE-RECORD.                          00300001
003100                                                                  00310000
003200 01  LABOR-UPDATE-RECORD               PIC X(512).                00320001
003300                                                                  00330000
003310 FD  TRANS-NUMBER-FILE-IN                                         00331002
003320     RECORDING MODE IS F                                          00332002
003330     DATA RECORD IS TRANS-NUMBER-RECORD-IN.                       00333007
003340                                                                  00334002
003350 01  TRANS-NUMBER-RECORD-IN            PIC X(30).                 00335012
003360                                                                  00336002
003400 FD  EDITED-UPDATE-FILE                                           00340000
003500     RECORDING MODE IS F                                          00350000
003600     DATA RECORD IS EDITED-UPDATE-RECORD.                         00360000
003700                                                                  00370000
003800 01  EDITED-UPDATE-RECORD              PIC X(512).                00380001
003801                                                                  00380102
003810 FD  TRANS-NUMBER-FILE-OUT                                        00381002
003820     RECORDING MODE IS F                                          00382002
003830     DATA RECORD IS TRANS-NUMBER-RECORD-OUT.                      00383007
003840                                                                  00384002
003850 01  TRANS-NUMBER-RECORD-OUT           PIC X(30).                 00385012
003900/                                                                 00390000
004000 WORKING-STORAGE SECTION.                                         00400000
004100                                                                  00410000
004200 01  ABEND-CODE                       PIC S9(04)  COMP SYNC       00420000
004300                                                    VALUE ZERO.   00430000
004400 01  PS-PROGRAM-SWITCHES.                                         00440000
004500     05  PS-EOF-UPDFILE-SW             PIC X(01) VALUE 'N'.       00450000
004600         88  PS-EOF-UPDFILE                        VALUE 'Y'.     00460000
004700     05  PS-EOF-TRANS-SW               PIC X(01) VALUE 'N'.       00470002
004800         88  PS-EOF-TRAN-FILE                      VALUE 'Y'.     00480002
005600     05  PS-KRPRPM-FOUND-SW            PIC X(01) VALUE 'N'.       00560000
005700         88  PS-KRPRPM-FOUND                       VALUE 'Y'.     00570000
005800         88  PS-KRPRPM-NOT-FOUND                   VALUE 'N'.     00580000
005900     05  PS-GOOD-RECORD-SW             PIC X(01) VALUE 'N'.       00590000
006000         88  PS-GOOD-RECORD                        VALUE 'Y'.     00600000
006100         88  PS-NOT-GOOD-RECORD                    VALUE 'N'.     00610000
006200                                                                  00620000
006300 01  PC-PROGRAM-CONSTANTS.                                        00630000
006400     05  PC-DEFAULT-TMST              PIC  X(26)  VALUE           00640000
006500         '9999-09-09-09.09.09.999999'.                            00650000
006510     05  PC-MAX-TRANS-NBR             PIC  9(09)  VALUE 999999999.00651002
006600                                                                  00660000
006700 01  PV-PROGRAM-VARIABLES.                                        00670000
006800     05  PV-PO-NBR                    PIC S9(9) COMP VALUE ZERO.  00680000
006900     05  PV-PO-LNE-NBR                PIC S9(9) COMP VALUE ZERO.  00690000
007000     05  PV-UPC-NBR                   PIC S9(15) COMP VALUE ZERO. 00700000
007100     05  PV-CARTON-NBR             PIC S9(18)V COMP-3 VALUE ZERO. 00710000
007200     05  PV-CURRENT-TMST              PIC X(26) VALUE SPACES.     00720000
007300                                                                  00730000
007400     05  PV-NUM-DTE                   PIC 9(08) VALUE ZERO.       00740000
007500     05  PV-PURCHS-NUM-DTE            PIC 9(08) VALUE ZERO.       00750000
007600                                                                  00760000
007700     05  PV-FORMAT-TMST.                                          00770000
007800         10  PV-FORMAT-TMST-DTE.                                  00780000
007900             15  PV-FORMAT-TMST-DTE-CY  PIC X(04)  VALUE SPACES.  00790000
008000             15  PV-FORMAT-TMST-DTE-D1  PIC X(01)  VALUE '-'.     00800000
008100             15  PV-FORMAT-TMST-DTE-MM  PIC X(02)  VALUE SPACES.  00810000
008200             15  PV-FORMAT-TMST-DTE-D2  PIC X(01)  VALUE '-'.     00820000
008300             15  PV-FORMAT-TMST-DTE-DD  PIC X(02)  VALUE SPACES.  00830000
008400             15  PV-FORMAT-TMST-DTE-D3  PIC X(01)  VALUE '-'.     00840000
008500         10  PV-FORMAT-TMST-TM.                                   00850000
008600             15  PV-FORMAT-TMST-TM-HH   PIC X(02)  VALUE SPACES.  00860000
008700             15  PV-FORMAT-TMST-TM-D1   PIC X(01)  VALUE '.'.     00870000
008800             15  PV-FORMAT-TMST-TM-MM   PIC X(02)  VALUE SPACES.  00880000
008900             15  PV-FORMAT-TMST-TM-D2   PIC X(10)  VALUE          00890000
009000                                                     '.00.000000'.00900000
009100     05  PV-REFORMAT-TMST.                                        00910000
009200         10  PV-REFORMAT-TMST-DTE.                                00920000
009300             15  PV-REFORMAT-TMST-DTE-CY  PIC 9(04).              00930000
009400             15  PV-REFORMAT-TMST-DTE-MM  PIC 9(02).              00940000
009500             15  PV-REFORMAT-TMST-DTE-DD  PIC 9(02).              00950000
009600         10  PV-REFORMAT-TMST-TM.                                 00960000
009700             15  PV-REFORMAT-TMST-TM-HH   PIC 9(02).              00970000
009800             15  PV-REFORMAT-TMST-TM-MM   PIC 9(02).              00980000
009810     05  PV-ABEND-CODE                    PIC S9(04) VALUE ZERO   00981002
009820                                                   COMP SYNC.     00982002
009900                                                                  00990000
010000 01  PV-COUNTERS.                                                 01000000
010100     05  PV-TOTAL-INPUT-READ          PIC S9(17) COMP-3           01010000
010200                                                VALUE ZERO.       01020000
010300     05  PV-UPDATES-WRITTEN           PIC S9(17) COMP-3           01030000
010400                                                VALUE ZERO.       01040000
010501     05  PV-TRANSACTION-COUNTER-RFMT.                             01050114
010502         10 PV-TRANSACTION-COUNTER   PIC 9(09).                   01050214
010503         10 FILLER                   PIC X(21).                   01050314
010504*                                                                 01050402
010510 01  PV-TRANSACTION-RECORD.                                       01051005
010520     05  PV-TRANSACTION-SEQ-NBR       PIC  X(30).                 01052012
010700/                                                                 01070000
010800******************************************************************01080001
010900*  COPYBOOK DLRD016 (EVENT OUTPUT FILE LAYOUT)                    01090002
011000******************************************************************01100001
011010     COPY DLRD016.                                                01101002
011020*                                                                 01102001
011100/                                                                 01110000
012500                                                                  01250000
014500/                                                                 01450000
014600 PROCEDURE DIVISION.                                              01460000
014700                                                                  01470000
014800 0000-PROGRAM-MAINLINE.                                           01480000
014900                                                                  01490000
015000     PERFORM 1000-INITIALIZE.                                     01500000
015100                                                                  01510000
015200     PERFORM 2000-PROCESS-UPDATE-FILE                             01520000
015300         UNTIL PS-EOF-UPDFILE                                     01530000
015400                                                                  01540000
015500     PERFORM 9000-EOJ-ROUTINE.                                    01550000
015600                                                                  01560000
015700     GOBACK.                                                      01570000
015800/                                                                 01580000
015900 1000-INITIALIZE.                                                 01590000
016000                                                                  01600000
016100     OPEN INPUT  LABOR-UPDATE-FILE                                01610001
016110                 TRANS-NUMBER-FILE-IN                             01611010
016200          OUTPUT EDITED-UPDATE-FILE                               01620002
016210                 TRANS-NUMBER-FILE-OUT.                           01621010
016300                                                                  01630000
016400     PERFORM 8000-READ-UPD-FILE                                   01640002
016410     PERFORM 8100-READ-TRANS-FILE                                 01641019
016500     IF PS-EOF-UPDFILE                                            01650000
016600         DISPLAY 'UPDATE FILE INP01 IS EMPTY'                     01660000
016610     END-IF                                                       01661019
016630     IF PS-EOF-TRAN-FILE                                          01663019
016631        DISPLAY 'UPDATE FILE INP02 IS EMPTY'                      01663119
016632     END-IF.                                                      01663221
016633                                                                  01663319
016800/                                                                 01680000
016900 2000-PROCESS-UPDATE-FILE.                                        01690000
017000                                                                  01700000
017100     EVALUATE TRUE                                                01710003
017200       WHEN DL016-WMS0102-REC-TYP                                 01720003
017210            MOVE PV-TRANSACTION-COUNTER TO DL016-WMS0102-TRANS-NBR01721003
017300       WHEN DL016-JOB0100-REC-TYP                                 01730003
017310            MOVE PV-TRANSACTION-COUNTER TO DL016-JOB0100-TRANS-NBR01731003
017400       WHEN DL016-EMP0101-REC-TYP                                 01740003
017410            MOVE PV-TRANSACTION-COUNTER TO DL016-EMP0101-TRANS-NBR01741003
017500     END-EVALUATE.                                                01750003
017501                                                                  01750103
017510     PERFORM 8200-WRITE-UPDATE-RECORD.                            01751003
017520                                                                  01752003
017530                                                                  01753003
017600     PERFORM 8000-READ-UPD-FILE.                                  01760005
021600/                                                                 02160000
036100/                                                                 03610000
039502 8000-READ-UPD-FILE.                                              03950202
039503                                                                  03950302
039510     READ LABOR-UPDATE-FILE                                       03951002
039520          INTO DL016-KEY-DATA-RECORD                              03952002
039530     AT END                                                       03953002
039540         SET PS-EOF-UPDFILE           TO TRUE                     03954002
039550     NOT AT END                                                   03955002
039560         ADD 1                        TO PV-TOTAL-INPUT-READ      03956002
039570     END-READ.                                                    03957002
039600                                                                  03960000
039610 8100-READ-TRANS-FILE.                                            03961002
039620     READ TRANS-NUMBER-FILE-IN                                    03962011
039630          INTO PV-TRANSACTION-RECORD                              03963002
039634                                                                  03963402
039640     AT END                                                       03964002
039650         SET PS-EOF-TRAN-FILE         TO TRUE                     03965002
039660     NOT AT END                                                   03966002
039661       MOVE PV-TRANSACTION-SEQ-NBR TO PV-TRANSACTION-COUNTER-RFMT 03966114
039662                                                                  03966213
039663       DISPLAY 'START TRANSACTION NUMBER:' PV-TRANSACTION-COUNTER 03966313
039670       IF  PV-TRANSACTION-COUNTER = PC-MAX-TRANS-NBR              03967006
039671           MOVE +1 TO PV-TRANSACTION-COUNTER                      03967106
039672       ELSE                                                       03967206
039673           ADD +1 TO PV-TRANSACTION-COUNTER                       03967306
039674       END-IF                                                     03967406
039680     END-READ.                                                    03968002
039690                                                                  03969002
039700/                                                                 03970000
039800 8200-WRITE-UPDATE-RECORD.                                        03980002
039900     WRITE EDITED-UPDATE-RECORD                                   03990000
040000         FROM DL016-KEY-DATA-RECORD                               04000002
040100     ADD 1                            TO PV-UPDATES-WRITTEN.      04010000
040200                                                                  04020000
040210     IF  PV-TRANSACTION-COUNTER = PC-MAX-TRANS-NBR                04021005
040220         MOVE +1 TO PV-TRANSACTION-COUNTER                        04022005
040230     ELSE                                                         04023003
040240         ADD +1 TO PV-TRANSACTION-COUNTER                         04024005
040250     END-IF.                                                      04025003
040270                                                                  04027003
040300/                                                                 04030000
040310 8300-WRITE-TRANS-RECORD.                                         04031002
040320     WRITE TRANS-NUMBER-RECORD-OUT                                04032002
040330         FROM PV-TRANSACTION-RECORD.                              04033005
040350                                                                  04035002
040360/                                                                 04036002
040400 9000-EOJ-ROUTINE.                                                04040000
040500                                                                  04050000
040520     MOVE PV-TRANSACTION-COUNTER TO PV-TRANSACTION-SEQ-NBR        04052005
040591     PERFORM 8300-WRITE-TRANS-RECORD                              04059103
040592     DISPLAY 'ENDING TRANSACTION NUMBER:' PV-TRANSACTION-COUNTER. 04059203
040593                                                                  04059303
040600     CLOSE LABOR-UPDATE-FILE                                      04060001
040610           TRANS-NUMBER-FILE-IN                                   04061015
040620           EDITED-UPDATE-FILE                                     04062015
040630           TRANS-NUMBER-FILE-OUT.                                 04063015
040800                                                                  04080000
040900     DISPLAY '**********************************'.                04090000
041000     DISPLAY '** DLKUT034 SUMMARY **'.                            04100003
041100     DISPLAY 'TOTAL INPUT RECS       = ' PV-TOTAL-INPUT-READ.     04110000
041200     DISPLAY 'TOTAL RECS WRITTEN     = ' PV-UPDATES-WRITTEN.      04120000
041400     DISPLAY '**********************************'.                04140000
041500                                                                  04150000
041600/                                                                 04160000
