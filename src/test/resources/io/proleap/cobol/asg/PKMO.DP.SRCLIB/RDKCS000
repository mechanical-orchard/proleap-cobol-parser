000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.                RDKCS000.                             00050000
000600 AUTHOR.                    DORIE CALLIES.                        00060000
000700 INSTALLATION.              KOHLS DEPARTMENT STORES.              00070000
000800 DATE-WRITTEN.              10-02-91.                             00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*               CICS PROGRAM - RDKCS000 - U000                   *00120000
001300*                                                                *00130000
001400*      CASH REFUND AUTHORIZATION SYSTEM - MAIN MENU              *00140000
001500*                                                                *00150000
001600*                                                                *00160000
001700******************************************************************00170000
001710* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00171001
001720*            - CHANGE CALL OF DPKUT100 TO                       * 00172001
001730*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00173001
001740*              MAKING THE CALL DYNAMIC VS STATIC                * 00174001
001750*                                                               * 00175001
001760*---------------------------------------------------------------* 00176001
001800 ENVIRONMENT DIVISION.                                            00180000
001900******************************************************************00190000
002000******************************************************************00200000
002100 DATA DIVISION.                                                   00210000
002200******************************************************************00220000
002300 WORKING-STORAGE SECTION.                                         00230000
002400*                                                                 00240000
002500*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 00250000
002600*                                                                 00260000
002700     COPY DPWS010I.                                               00270000
002800*                                                                 00280000
002900*  STANDARD ATTENTION IDENTIFIER LIST                             00290000
003000*                                                                 00300000
003100     COPY DFHAID.                                                 00310000
003200/                                                                 00320000
003300*                                                                 00330000
003400*  KOHLS ATTRIBUTE LIST                                           00340000
003500*                                                                 00350000
003600     COPY DPWS015.                                                00360000
003700/                                                                 00370000
003800*                                                                 00380000
003900*    COPY BOOK FOR THE CICSAUTH SUBROUTINE                        00390000
004000*                                                                 00400000
004100     COPY DPWS008.                                                00410000
004200/                                                                 00420000
004300*                                                                 00430000
004400*  DSECT FOR THE RDKM000 MAPSET.                                  00440000
004500*                                                                 00450000
004600     COPY RDKM000.                                                00460000
004700/                                                                 00470000
004800     COPY RDRD000I.                                               00480000
004900     05  CA-COMM-FOR-RDKCS000.                                    00490000
005000         10  CA-FUNCTION-X           PIC  X(02).                  00500000
005100         10  CA-FUNCTION REDEFINES CA-FUNCTION-X                  00510000
005200                                     PIC  9(02).                  00520000
005300             88  CA-VALID-FUNCTION               VALUE 1 THRU 9.  00530000
005400/                                                                 00540000
005500*                                                                 00550000
005600*  CASH REFUND AUTHORIZATION PROCESSOR ERROR TEMPORARY STORAGE    00560000
005700*  QUEUE RECORD LAYOUT.                                           00570000
005800*                                                                 00580000
005900     COPY RDRD009I.                                               00590000
006000/                                                                 00600000
006100 01  PC-PROGRAM-CONSTANTS.                                        00610000
006200     05  PC-PROGRAM-NAME             PIC  X(08)  VALUE 'RDKCS000'.00620000
006300     05  PC-CHECK-ERRORS-PROG        PIC  X(08)  VALUE 'RDKCS020'.00630000
006400     05  PC-ERROR-SUMMARY-ITEM       PIC S9(04)  VALUE +1         00640000
006500                                                 COMP SYNC.       00650000
006600     05  PC-RETURN-LENGTH            PIC S9(04)  COMP             00660000
006700                                                 VALUE +107.      00670000
006800     05  PC-XCTL-LENGTH              PIC S9(04)  COMP             00680000
006900                                                 VALUE +105.      00690000
007000     05  PC-MSG-LENGTH               PIC S9(04)  VALUE +56        00700000
007100                                                 COMP SYNC.       00710000
007200     05  PC-EOF-KEYED-COMP           PIC S9(04)  VALUE +128       00720000
007300                                                 COMP SYNC.       00730000
007400     05  FILLER  REDEFINES  PC-EOF-KEYED-COMP.                    00740000
007500         10  FILLER                  PIC  X(01).                  00750000
007600         10  PC-EOF-KEYED            PIC  X(01).                  00760000
007700                                                                  00770000
007800                                                                  00780000
007900 01  PM-PGM-MSG-DATA.                                             00790000
008000     05  FILLER                      PIC  X(52)  VALUE            00800000
008100         '                                                    '.  00810000
008200     05  FILLER                      PIC  X(52)  VALUE            00820000
008300         'ERROR - INVALID SELECTION                           '.  00830000
008400     05  FILLER                      PIC  X(52)  VALUE            00840000
008500         'ERROR - INVALID PF REQUEST                          '.  00850000
008600     05  FILLER                      PIC  X(52)  VALUE            00860000
008700         'STOP!! SCREEN READ FAILED.  CONTACT SYSTEMS!!       '.  00870000
008800     05  FILLER                      PIC  X(52)  VALUE            00880000
008900         'STOP!! PRGRAM ID ERROR.  CONTACT SYSTEMS!!          '.  00890000
009000     05  FILLER                      PIC  X(52)  VALUE            00900000
009100         'NOT AUTHORIZED FOR SELECTED FUNCTION!!              '.  00910000
009200     05  FILLER                      PIC  X(52)  VALUE            00920000
009300         'BAD LINK TO RACF PROGRAM  -  NOTIFY DP              '.  00930000
009400 01  PM-PGM-MSG-TABLE  REDEFINES  PM-PGM-MSG-DATA.                00940000
009500     05  PM-PGM-MSG                  OCCURS 7 TIMES               00950000
009600                                     INDEXED BY PM-INDX           00960000
009700                                     PIC  X(52).                  00970000
009800                                                                  00980000
009900 01  PM-CICSAUTH-MESSAGE.                                         00990000
010000     05  FILLER                      PIC  X(36)  VALUE            01000000
010100         'INVALID RETURN CODE FROM CICSAUTH - '.                  01010000
010200     05  PM-CM-RETURN-CODE           PIC  9(04).                  01020000
010300*                                                                 01030000
010400 01  PN-PROGRAM-NAMES.                                            01040000
010500     05  PN-VALUES.                                               01050000
010600         10  FILLER                  PIC  X(08)  VALUE 'RDKCS001'.01060000
010700         10  FILLER                  PIC  X(08)  VALUE 'RDKCS002'.01070000
010800         10  FILLER                  PIC  X(08)  VALUE 'RDKCS003'.01080000
010900         10  FILLER                  PIC  X(08)  VALUE 'RDKCS004'.01090000
011000         10  FILLER                  PIC  X(08)  VALUE 'RDKCS006'.01100000
011100         10  FILLER                  PIC  X(08)  VALUE 'RDKCS007'.01110000
011200         10  FILLER                  PIC  X(08)  VALUE 'RDKCS005'.01120000
011300         10  FILLER                  PIC  X(08)  VALUE 'RDKCS008'.01130000
011400         10  FILLER                  PIC  X(08)  VALUE 'RDKCS011'.01140000
011500     05  PN-PROGRAMS REDEFINES PN-VALUES                          01150000
011600                                     PIC  X(08)  OCCURS 9.        01160000
011700                                                                  01170000
011800 01  PS-PROGRAM-SWITCHES.                                         01180000
011900     05  PS-MAPFAIL-ERROR-IND        PIC  X(01)  VALUE 'N'.       01190000
012000         88  PS-NO-MAPFAIL                       VALUE 'N'.       01200000
012100         88  PS-MAPFAIL                          VALUE 'Y'.       01210000
012200     05  PS-FIELD-ERROR              PIC  X(01)  VALUE 'N'.       01220000
012300         88  PS-NO-ERROR                         VALUE 'N'.       01230000
012400         88  PS-ERROR                            VALUE 'Y'.       01240000
012500     05  PS-ACCESS-IND               PIC  X(01)  VALUE 'N'.       01250000
012600         88  PS-NO-ACCESS                        VALUE 'N'.       01260000
012700         88  PS-ACCESS                           VALUE 'Y'.       01270000
012800     05  PS-START-IND                PIC  X(01)  VALUE 'N'.       01280000
012900         88  PS-NO-START                         VALUE 'N'.       01290000
013000         88  PS-START                            VALUE 'Y'.       01300000
013100                                                                  01310000
013200 01  PT-PROGRAM-TRANSIDS.                                         01320000
013300     05  PT-VALUES.                                               01330000
013400         10  FILLER                  PIC  X(04)  VALUE 'U001'.    01340000
013500         10  FILLER                  PIC  X(04)  VALUE 'U002'.    01350000
013600         10  FILLER                  PIC  X(04)  VALUE 'U003'.    01360000
013700         10  FILLER                  PIC  X(04)  VALUE 'U004'.    01370000
013800         10  FILLER                  PIC  X(04)  VALUE 'U006'.    01380000
013900         10  FILLER                  PIC  X(04)  VALUE 'U007'.    01390000
014000         10  FILLER                  PIC  X(04)  VALUE 'U005'.    01400000
014100         10  FILLER                  PIC  X(04)  VALUE 'U008'.    01410000
014200         10  FILLER                  PIC  X(04)  VALUE 'U011'.    01420000
014300                                                                  01430000
014400     05  PT-TRANSID  REDEFINES  PT-VALUES                         01440000
014500                                     PIC  X(04)  OCCURS 9.        01450000
014600                                                                  01460000
014700 01  PV-PROGRAM-VARIABLES.                                        01470000
014800     05  PV-RESP                     PIC S9(04)  COMP             01480000
014900                                                 VALUE ZERO.      01490000
015000     05  PV-XCTL-PROGRAM             PIC  X(08)  VALUE SPACES.    01500000
015100     05  PV-CICS-RESPONSE            PIC S9(09)  VALUE ZERO       01510000
015200                                                 COMP SYNC.       01520000
015300                                                                  01530000
015400 01  ST-SYSTEM-TIME-AREA.                                         01540000
015500     05  ST-ABSTIME                  PIC S9(18)  VALUE ZERO       01550000
015600                                                 COMP SYNC.       01560000
015700     05  ST-TIME-EDIT.                                            01570000
015800         10  ST-TIME-HHMM            PIC  X(05)  VALUE SPACES.    01580000
015900         10  FILLER                  PIC  X(03)  VALUE SPACES.    01590000
016000/                                                                 01600000
016100******************************************************************01610000
016200 LINKAGE SECTION.                                                 01620000
016300******************************************************************01630000
016400 01  DFHCOMMAREA                     PIC  X(107).                 01640000
016500/                                                                 01650000
016600******************************************************************01660000
016700 PROCEDURE DIVISION.                                              01670000
016800******************************************************************01680000
016900                                                                  01690000
017000                                                                  01700000
017100 0000-MAINLINE.                                                   01710000
017200******************************************************************01720000
017300*       MAIN MODULE.  EVALUATES PF KEYS HIT TO DETERMINE          01730000
017400*          PROCESSING.  SEND MAP AND THEN RETURN TO ITS OWN       01740000
017500*          TRANS-ID.                                              01750000
017600******************************************************************01760000
017700     SET PM-INDX                     TO 1.                        01770000
017800                                                                  01780000
017900     MOVE DFHCOMMAREA                TO RD000I-COMMUNICATION-AREA.01790000
018000     IF  EIBCALEN = 0                                             01800000
018100         INITIALIZE RD000I-DRIVER-LCNSE-NMBR                      01810000
018200                    RD000I-HISTORY-KEY                            01820000
018300                    RD000I-LAST-NAME                              01830000
018400                    RD000I-ADDRESS-LINE1                          01840000
018500         SET RD000I-INITIALIZE-SCREEN                             01850000
018600                                     TO TRUE                      01860000
018700     END-IF.                                                      01870000
018800                                                                  01880000
018900     EVALUATE TRUE                                                01890000
019000         WHEN EIBAID = DFHPF4                                     01900000
019100              PERFORM 9200-RETURN-TO-CICS                         01910000
019200         WHEN RD000I-INITIALIZE-SCREEN                            01920000
019300         WHEN EIBAID = DFHCLEAR                                   01930000
019400              PERFORM 1000-SEND-INITIAL-MAP                       01940000
019500         WHEN EIBAID = DFHENTER                                   01950000
019600              PERFORM 2000-PROCESS-FUNCTION                       01960000
019700         WHEN OTHER                                               01970000
019800              SET PM-INDX            TO 3                         01980000
019900              SET PS-ERROR           TO TRUE                      01990000
020000              MOVE -1                TO FUNCTL                    02000000
020100     END-EVALUATE.                                                02010000
020200                                                                  02020000
020300     EVALUATE TRUE                                                02030000
020400         WHEN PS-START                                            02040000
020500              CONTINUE                                            02050000
020600         WHEN PS-ERROR                                            02060000
020700              PERFORM 8200-SEND-DATA-ONLY                         02070000
020800         WHEN PS-NO-ERROR                                         02080000
020900              PERFORM 8100-SEND-MAP                               02090000
021000         WHEN ANY                                                 02100000
021100              PERFORM 8100-SEND-MAP                               02110000
021200     END-EVALUATE.                                                02120000
021300                                                                  02130000
021400     EXEC CICS                                                    02140000
021500         RETURN                                                   02150000
021600             TRANSID('U000')                                      02160000
021700             COMMAREA(RD000I-COMMUNICATION-AREA)                  02170000
021800             LENGTH(PC-RETURN-LENGTH)                             02180000
021900     END-EXEC.                                                    02190000
022000                                                                  02200000
022100     GOBACK.                                                      02210000
022200/                                                                 02220000
022300 1000-SEND-INITIAL-MAP.                                           02230000
022400******************************************************************02240000
022500*  INITIALIZE SCREEN FIELDS AND SEND THE INITIAL MAP.            *02250000
022600******************************************************************02260000
022700     MOVE LOW-VALUES                 TO RD000AI.                  02270000
022800     SET PM-INDX                     TO 1.                        02280000
022900                                                                  02290000
023000     MOVE -1                         TO FUNCTL.                   02300000
023100                                                                  02310000
023200     SET RD000I-PROCESS-SCREEN       TO TRUE.                     02320000
023300     PERFORM 3000-CHECK-ERRORS.                                   02330000
023400/                                                                 02340000
023500 2000-PROCESS-FUNCTION.                                           02350000
023600******************************************************************02360000
023700*  RECEIVE MAP AND DETERMINE IF FUNCTION FIELD IS ENTERED.       *02370000
023800******************************************************************02380000
023900     SET PS-NO-ERROR                 TO TRUE.                     02390000
024000                                                                  02400000
024100     EXEC CICS                                                    02410000
024200         RECEIVE                                                  02420000
024300             MAP('RD000A')                                        02430000
024400             MAPSET('RDKM000')                                    02440000
024500             RESP(PV-RESP)                                        02450000
024600     END-EXEC.                                                    02460000
024700                                                                  02470000
024800*****                                                             02480000
024900*    EDIT FUNCTION                                                02490000
025000*****                                                             02500000
025100     EVALUATE TRUE                                                02510000
025200         WHEN PV-RESP NOT = DFHRESP(NORMAL)                       02520000
025300              SET PS-ERROR           TO TRUE                      02530000
025400              SET PM-INDX            TO 4                         02540000
025500         WHEN FUNCTL > 0                                          02550000
025600              PERFORM 2100-EDIT-FUNCTION                          02560000
025700         WHEN FUNCTL = 0                                          02570000
025800         WHEN FUNCTA = PC-EOF-KEYED                               02580000
025900              MOVE SPACES            TO CA-FUNCTION-X             02590000
026000              MOVE DP015-REVERSE     TO FUNCTH                    02600000
026100              MOVE DP015-RED         TO FUNCTC                    02610000
026200              MOVE -1                TO FUNCTL                    02620000
026300              SET PM-INDX            TO 2                         02630000
026400              SET PS-ERROR           TO TRUE                      02640000
026500     END-EVALUATE.                                                02650000
026600                                                                  02660000
026700***  ADDED IF-CA-FUNCTION = 09      WR3119                        02670000
026800***  BAB 3/95                                                     02680000
026900     IF  PS-NO-ERROR                                              02690000
027000         SET PS-NO-ACCESS            TO TRUE                      02700000
027100         PERFORM 8400-CHECK-RACF                                  02710000
027200         IF  PS-ACCESS                                            02720000
027300             IF  CA-FUNCTION = 09                                 02730000
027400                 SET RD000I-RDKCS011-START TO TRUE                02740000
027500                 PERFORM 9450-START-PROGRAM                       02750000
027600             ELSE                                                 02760000
027700                 PERFORM 9400-XCTL-PROGRAM                        02770000
027800             END-IF                                               02780000
027900         ELSE                                                     02790000
028000             SET PS-ERROR            TO TRUE                      02800000
028100         END-IF                                                   02810000
028200     ELSE                                                         02820000
028300         PERFORM 3000-CHECK-ERRORS                                02830000
028400     END-IF.                                                      02840000
028500                                                                  02850000
028600                                                                  02860000
028700 2100-EDIT-FUNCTION.                                              02870000
028800******************************************************************02880000
028900*  EDIT THE FUNCTION FIELD                                       *02890000
029000******************************************************************02900000
029100     MOVE FUNCTI                     TO DP010I-UNEDITED-FIELD     02910000
029200                                        CA-FUNCTION-X.            02920000
029300     MOVE 2                          TO DP010I-MAXIMUM-DIGITS.    02930000
029400     MOVE 0                          TO DP010I-MAXIMUM-DECIMALS.  02940000
029500     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     02950000
029610     CALL DP010I-NUMERIC-EDIT-ROUTINE                             02961000
029620                         USING DP010I-NUMERIC-EDIT-AREA           02962000
029700                                                                  02970000
029800     IF  DP010I-ERROR-DETECTED                                    02980000
029900         MOVE DP015-REVERSE          TO FUNCTH                    02990000
030000         MOVE DP015-RED              TO FUNCTC                    03000000
030100         SET PM-INDX                 TO 2                         03010000
030200         SET PS-ERROR                TO TRUE                      03020000
030300     ELSE                                                         03030000
030400         MOVE DP010I-NUMERIC-FIELD   TO CA-FUNCTION               03040000
030500         IF  NOT CA-VALID-FUNCTION                                03050000
030600             MOVE DP015-REVERSE      TO FUNCTH                    03060000
030700             MOVE DP015-RED          TO FUNCTC                    03070000
030800             SET PM-INDX             TO 2                         03080000
030900             SET PS-ERROR            TO TRUE                      03090000
031000         END-IF                                                   03100000
031100     END-IF.                                                      03110000
031200/                                                                 03120000
031300 3000-CHECK-ERRORS.                                               03130000
031400     EXEC CICS                                                    03140000
031500         READQ TS                                                 03150000
031600             QUEUE(RD009I-QUEUE-NAME)                             03160000
031700             INTO(RD009I-REF-PROCESSOR-ERROR-RCD)                 03170000
031800             LENGTH(RD009I-QUEUE-LENGTH)                          03180000
031900             ITEM(PC-ERROR-SUMMARY-ITEM)                          03190000
032000             RESP(PV-RESP)                                        03200000
032100     END-EXEC.                                                    03210000
032200                                                                  03220000
032300                                                                  03230000
032400     IF  ((PV-RESP = DFHRESP(NORMAL))                             03240000
032500             AND (RD009I-ERROR-SUMMARY-RCD-TYPE)                  03250000
032600             AND (RD009I-UNRESOLVED-ERROR-COUNT NUMERIC)          03260000
032700             AND (RD009I-UNRESOLVED-ERROR-COUNT > ZERO))          03270000
032800         MOVE 'CASH REFUND PROCESSOR ERRORS'                      03280000
032900                                     TO ACPERRO                   03290000
033000     ELSE                                                         03300000
033100         INITIALIZE ACPERRO                                       03310000
033200     END-IF.                                                      03320000
033300/                                                                 03330000
033400 8100-SEND-MAP.                                                   03340000
033500******************************************************************03350000
033600*  SEND ENTIRE MAP                                               *03360000
033700******************************************************************03370000
033800     IF  PS-ERROR                                                 03380000
033900          MOVE DP015-RED             TO AMSGC                     03390000
034000     END-IF.                                                      03400000
034100                                                                  03410000
034200     MOVE -1                         TO FUNCTL.                   03420000
034300     MOVE PM-PGM-MSG (PM-INDX)       TO AMSGO.                    03430000
034400     PERFORM 8300-UPDATE-SCREEN-HEADER.                           03440000
034500                                                                  03450000
034600     EXEC CICS                                                    03460000
034700         SEND                                                     03470000
034800             MAP('RD000A')                                        03480000
034900             MAPSET('RDKM000')                                    03490000
035000             ERASE                                                03500000
035100             CURSOR                                               03510000
035200             FORMFEED                                             03520000
035300             FREEKB                                               03530000
035400     END-EXEC.                                                    03540000
035500                                                                  03550000
035600                                                                  03560000
035700 8200-SEND-DATA-ONLY.                                             03570000
035800******************************************************************03580000
035900*  SEND DATA PORTION OF THE MAP THAT HAS BEEN CHANGED            *03590000
036000******************************************************************03600000
036100     IF  PS-ERROR                                                 03610000
036200          MOVE DP015-RED             TO AMSGC                     03620000
036300     END-IF.                                                      03630000
036400                                                                  03640000
036500     MOVE -1                         TO FUNCTL.                   03650000
036600     MOVE PM-PGM-MSG (PM-INDX)       TO AMSGO.                    03660000
036700     PERFORM 8300-UPDATE-SCREEN-HEADER.                           03670000
036800                                                                  03680000
036900     EXEC CICS                                                    03690000
037000         SEND                                                     03700000
037100             MAP('RD000A')                                        03710000
037200             MAPSET('RDKM000')                                    03720000
037300             CURSOR                                               03730000
037400             DATAONLY                                             03740000
037500             FORMFEED                                             03750000
037600             FREEKB                                               03760000
037700     END-EXEC.                                                    03770000
037800                                                                  03780000
037900                                                                  03790000
038000 8300-UPDATE-SCREEN-HEADER.                                       03800000
038100******************************************************************03810000
038200*  FILL IN THE SCREEN HEADER WITH THE DATE, TIME, AND TERMINAL   *03820000
038300*  NUMBER.                                                       *03830000
038400******************************************************************03840000
038500     EXEC CICS                                                    03850000
038600         ASKTIME                                                  03860000
038700         ABSTIME(ST-ABSTIME)                                      03870000
038800     END-EXEC.                                                    03880000
038900                                                                  03890000
039000     EXEC CICS                                                    03900000
039100         FORMATTIME                                               03910000
039200         ABSTIME(ST-ABSTIME)                                      03920000
039300         MMDDYY(ADATEO)                                           03930000
039400         DATESEP                                                  03940000
039500         TIME(ST-TIME-EDIT)                                       03950000
039600         TIMESEP                                                  03960000
039700     END-EXEC.                                                    03970000
039800                                                                  03980000
039900     MOVE ST-TIME-HHMM               TO ATIMEO.                   03990000
040000     MOVE 'Z'                        TO ATIMEA.                   04000000
040100     MOVE 'Z'                        TO ADATEA.                   04010000
040200     MOVE EIBTRMID                   TO ATERMO.                   04020000
040300/                                                                 04030000
040400 8400-CHECK-RACF.                                                 04040000
040500******************************************************************04050000
040600*  CHECK ACCESS AUTHORITY OF USER                                *04060000
040700******************************************************************04070000
040800     SET DP008-RSRC-TYPE-TRAN        TO TRUE.                     04080000
040900     SET DP008-ACCESS-TYPE-USE       TO TRUE.                     04090000
041000     MOVE PT-TRANSID (CA-FUNCTION)   TO DP008-RESOURCE-NAME.      04100000
041100                                                                  04110000
041200     EXEC CICS                                                    04120000
041300          LINK PROGRAM  (DP008-SECURITY-SUBROUTINE)               04130000
041400               COMMAREA (DP008-SECURITY-COMMAREA)                 04140000
041500               LENGTH   (DP008-SECURITY-COMMAREA-LENGTH)          04150000
041600               RESP     (PV-CICS-RESPONSE)                        04160000
041700     END-EXEC.                                                    04170000
041800                                                                  04180000
041900     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)                       04190000
042000         IF  DP008-CALL-SUCCESSFUL                                04200000
042100             IF  DP008-ACCESS-ALLOWED                             04210000
042200                 SET PS-ACCESS       TO TRUE                      04220000
042300             ELSE                                                 04230000
042400                 SET PM-INDX         TO 6                         04240000
042500             END-IF                                               04250000
042600         ELSE                                                     04260000
042700             SET PM-INDX             TO 1                         04270000
042800             MOVE DP008-ERROR-CODE   TO PM-CM-RETURN-CODE         04280000
042900             MOVE PM-CICSAUTH-MESSAGE                             04290000
043000                                     TO PM-PGM-MSG (1)            04300000
043100         END-IF                                                   04310000
043200     ELSE                                                         04320000
043300         SET PM-INDX                 TO 7                         04330000
043400     END-IF.                                                      04340000
043500                                                                  04350000
043600/                                                                 04360000
043700 9200-RETURN-TO-CICS.                                             04370000
043800******************************************************************04380000
043900*  EXIT PROGRAM AND RETURN TO CICS                               *04390000
044000******************************************************************04400000
044100     EXEC CICS                                                    04410000
044200         START                                                    04420000
044300              TRANSID ('MENU')                                    04430000
044400              TERMID  (EIBTRMID)                                  04440000
044500     END-EXEC.                                                    04450000
044600                                                                  04460000
044700     EXEC CICS                                                    04470000
044800         RETURN                                                   04480000
044900     END-EXEC.                                                    04490000
045000                                                                  04500000
045100                                                                  04510000
045200 9400-XCTL-PROGRAM.                                               04520000
045300******************************************************************04530000
045400*  EXIT PROGRAM TRANSFER TO THE APPROPIATE PROGRAM DEPENDING     *04540000
045500*       ON FUNCTION ENTERED                                      *04550000
045600******************************************************************04560000
045700     MOVE PC-PROGRAM-NAME            TO RD000I-LAST-PROGRAM.      04570000
045800     SET RD000I-INITIALIZE-SCREEN    TO TRUE.                     04580000
045900     MOVE PN-PROGRAMS (CA-FUNCTION)  TO PV-XCTL-PROGRAM.          04590000
046000                                                                  04600000
046100     EXEC CICS                                                    04610000
046200         SYNCPOINT                                                04620000
046300     END-EXEC.                                                    04630000
046400                                                                  04640000
046500     EVALUATE TRUE                                                04650000
046600         WHEN PV-XCTL-PROGRAM = PC-CHECK-ERRORS-PROG              04660000
046700              SET PS-START           TO TRUE                      04670000
046800              EXEC CICS                                           04680000
046900                  START                                           04690000
047000                    TRANSID('U008')                               04700000
047100                    TERMID(EIBTRMID)                              04710000
047200                    FROM(RD000I-COMMUNICATION-AREA)               04720000
047300                    LENGTH(PC-XCTL-LENGTH)                        04730000
047400              END-EXEC                                            04740000
047500         WHEN ANY                                                 04750000
047600              EXEC CICS                                           04760000
047700                  XCTL                                            04770000
047800                  PROGRAM(PV-XCTL-PROGRAM)                        04780000
047900                  COMMAREA(RD000I-COMMUNICATION-AREA)             04790000
048000                  LENGTH(PC-XCTL-LENGTH)                          04800000
048100              END-EXEC                                            04810000
048200     END-EVALUATE.                                                04820000
048300                                                                  04830000
048400                                                                  04840000
048500     IF  PV-RESP NOT = DFHRESP(NORMAL)                            04850000
048600         PERFORM 9800-ID-ERROR                                    04860000
048700     END-IF.                                                      04870000
048800                                                                  04880000
048900                                                                  04890000
049000 9450-START-PROGRAM.                                              04900000
049100******************************************************************04910000
049200*  EXIT PROGRAM TRANSFER TO PGM RDKCS011                         *04920000
049300*  FUNCTION 09                                                   *04930000
049400*  ADDED PER WR 3119                                             *04940000
049500******************************************************************04950000
049600                                                                  04960000
049700     MOVE PC-PROGRAM-NAME            TO RD000I-LAST-PROGRAM.      04970000
049800     SET RD000I-INITIALIZE-SCREEN    TO TRUE.                     04980000
049900     MOVE PN-PROGRAMS (CA-FUNCTION)  TO PV-XCTL-PROGRAM.          04990000
050000                                                                  05000000
050100     EXEC CICS                                                    05010000
050200         SYNCPOINT                                                05020000
050300     END-EXEC.                                                    05030000
050400                                                                  05040000
050500     SET PS-START           TO TRUE.                              05050000
050600     EXEC CICS                                                    05060000
050700         START                                                    05070000
050800           TRANSID('U011')                                        05080000
050900           TERMID(EIBTRMID)                                       05090000
051000           FROM(RD000I-COMMUNICATION-AREA)                        05100000
051100           LENGTH(PC-XCTL-LENGTH)                                 05110000
051200     END-EXEC.                                                    05120000
051300                                                                  05130000
051400                                                                  05140000
051500     IF  PV-RESP NOT = DFHRESP(NORMAL)                            05150000
051600         PERFORM 9800-ID-ERROR                                    05160000
051700     END-IF.                                                      05170000
051800                                                                  05180000
051900                                                                  05190000
052000 9800-ID-ERROR.                                                   05200000
052100******************************************************************05210000
052200*  SEND UNFORMATTED MESSAGE WHEN TRANS-ID THIS PROGRAM IS        *05220000
052300*       X-CONTROLLING TO IS NOT DEFINED.  THEN EXIT TO CICS.     *05230000
052400******************************************************************05240000
052500     SET PM-INDX                     TO 5.                        05250000
052600                                                                  05260000
052700     EXEC CICS                                                    05270000
052800         SEND                                                     05280000
052900         FROM(PM-PGM-MSG(PM-INDX))                                05290000
053000         LENGTH(PC-MSG-LENGTH)                                    05300000
053100         ERASE                                                    05310000
053200     END-EXEC.                                                    05320000
053300                                                                  05330000
053400     EXEC CICS                                                    05340000
053500         RETURN                                                   05350000
053600     END-EXEC.                                                    05360000
