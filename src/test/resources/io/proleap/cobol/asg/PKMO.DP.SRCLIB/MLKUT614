000100 IDENTIFICATION DIVISION.                                         00010099
000200 PROGRAM-ID.    MLKUT614.                                         00020099
000300 AUTHOR.        ERIN SEARL.                                       00030099
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040099
000500 DATE-WRITTEN.  08-09-04.                                         00050099
000600 DATE-COMPILED.                                                   00060099
000700******************************************************************00070099
000800*                                                                 00080099
000900* MLKUT614 - CREATE THE DATA INTEGRITY EXTRACT FILE FOR           00090099
001000*            MLT_WKLY_SUM.                                        00100099
001010*                                                                 00101099
001014* THIS PROGRAM WILL TAKE THE SORTED MLT_WKLY_SUM FILE AND FORMAT  00101499
001015* THE DATA TO DATA INTEGRITY EXTRACT COPYBOOK MLRD111 AND CREATE  00101599
001016* DATA INTEGRITY EXTRACT FILE.                                    00101699
001070*                                                                 00107099
001080*CHANGE HISTORY:                                                  00108099
001090* WR/PROJ DATE       PGMR        DESCRIPTION OF CHANGES           00109099
001100* ------- ---------- ----------- -------------------------------- 00110099
001200* WR21764 11-26-2004 ROD JANSSEN MERCH LEDGER DETAIL LEDGER TBLS  00120099
R28582* 28582   02-08-2007 ROD JANSSEN DI ISSUE WITH WEEKLY TABLES....  00121099
001300******************************************************************00130099
001400                                                                  00140099
001500 ENVIRONMENT DIVISION.                                            00150099
001600 CONFIGURATION SECTION.                                           00160099
001700 SOURCE-COMPUTER.        IBM-3090.                                00170099
001800 OBJECT-COMPUTER.        IBM-3090.                                00180099
001900 INPUT-OUTPUT SECTION.                                            00190099
002000 FILE-CONTROL.                                                    00200099
002100                                                                  00210099
002200     SELECT DATA-INTEGRITY-CTL-FILE                               00220099
002300         ASSIGN TO INP01.                                         00230099
002400                                                                  00240099
002200     SELECT DATA-INTEGRITY-DATE-FILE                              00241099
002300         ASSIGN TO INP02.                                         00242099
002400                                                                  00243099
002500     SELECT DATA-INTEGRITY-EXTR-FILE                              00250099
002600         ASSIGN TO OUT01.                                         00260099
002700                                                                  00270099
002800 DATA DIVISION.                                                   00280099
002900 FILE SECTION.                                                    00290099
003000                                                                  00300099
003100 FD  DATA-INTEGRITY-CTL-FILE                                      00310099
003200     LABEL RECORDS ARE STANDARD                                   00320099
003300     RECORDING MODE IS F                                          00330099
003400     BLOCK CONTAINS 0 RECORDS.                                    00340099
003500 01  DATA-INTEGRITY-CTL-REC      PIC X(349).                      00350099
003600                                                                  00360099
003100 FD  DATA-INTEGRITY-DATE-FILE                                     00360199
003200     LABEL RECORDS ARE STANDARD                                   00360299
003300     RECORDING MODE IS F                                          00360399
003400     BLOCK CONTAINS 0 RECORDS.                                    00360499
003500 01  DATA-INTEGRITY-DATE-REC     PIC X(80).                       00360599
003600                                                                  00360699
003700 FD  DATA-INTEGRITY-EXTR-FILE                                     00370099
003800     RECORDING MODE IS F                                          00380099
003900     LABEL RECORDS ARE STANDARD                                   00390099
004000     BLOCK CONTAINS 0 RECORDS.                                    00400099
004100                                                                  00410099
004200 01  DATA-INTEGRITY-EXTR-REC     PIC X(120).                      00420099
004300                                                                  00430099
004400******************************************************************00440099
004500 WORKING-STORAGE SECTION.                                         00450099
004600******************************************************************00460099
004700                                                                  00470099
004800 01  PS-PROGRAM-SWITCHES.                                         00480099
004810     05  PS-END-OF-INPUT-SW      PIC X       VALUE 'N'.           00481099
004820         88  PS-END-OF-INPUT                 VALUE 'Y'.           00482099
004830         88  PS-END-OF-INPUT-NO              VALUE 'N'.           00483099
004810     05  PS-END-OF-DATE-FILE-SW  PIC X       VALUE 'N'.           00484099
004820         88  PS-END-OF-DATE-FILE             VALUE 'Y'.           00485099
004830         88  PS-END-OF-DATE-FILE-NO          VALUE 'N'.           00486099
004900     05  PS-MLT00005-DONE        PIC X       VALUE 'N'.           00490099
005000         88  PS-MLT00005-IS-DONE             VALUE 'Y'.           00500099
005100         88  PS-MLT00005-IS-NOT-DONE         VALUE 'N'.           00510099
005200                                                                  00520099
005300 01  PV-PROGRAM-VARIABLES.                                        00530099
R28582     05  PV-PREV-FSCL-MN-END-DTE PIC X(10) VALUE SPACE.           00531099
R28582     05  PV-PREV-DEPT-NBR        PIC S9(4)V COMP-3 VALUE ZEROS.   00532099
005400     05  PV-OPN-MONTH-FIRST-WEEK PIC X(10).                       00540099
005500     05  PV-DEPT-NBR             PIC 9(03)  VALUE ZEROS.          00550099
005600     05  PV-MAJ-CL-NBR           PIC 9(02)  VALUE ZEROS.          00560099
005700     05  PV-SUB-CL-NBR           PIC 9(02)  VALUE ZEROS.          00570099
005800     05  PV-LOC-NBR              PIC 9(04)  VALUE ZEROS.          00580099
005900     05  PV-FSCL-DTE             PIC X(10).                       00590099
005910     05  PV-FSCL-MN-END-DTE      PIC X(10).                       00591099
006000     05  PV-FSCL-MN-NBR          PIC X(02).                       00600099
006100     05  PV-PARTN-NBR            PIC S9(4)V COMP.                 00610099
006200                                                                  00620099
006210     05  PV-DKEY-NBR.                                             00621099
006230         10  PV-DKEY-WK-NBR      PIC X(02).                       00623099
006240         10  PV-DKEY-MN-NBR      PIC X(02).                       00624099
006250         10  FILLER              PIC X(11).                       00625099
006260                                                                  00626099
006300 01  PA-PROGRAM-ACCUMULATORS.                                     00630099
006301     05  PA-INPUT-FILES           PIC S9(13) VALUE ZEROS.         00630199
006310     05  PA-MLT00005-ROWS-FETCHED PIC S9(13) VALUE ZEROS.         00631099
006320     05  PA-TDTATTR-ROWS-SELECTED PIC S9(13) VALUE ZEROS.         00632099
006330     05  PA-OUTPUT-RECS-WRITTEN   PIC S9(13) VALUE ZEROS.         00633099
006340                                                                  00634099
006350 01  PC-PROGRAM-CONSTANTS.                                        00635099
006360     05  PC-MAX-TBL-ROWS         PIC S9(03)  VALUE +120.          00636099
006360     05  PC-Y                    PIC X       VALUE 'Y'.           00636199
006370                                                                  00637099
006380 01  TABLE-FOR-MONTH-DATA.                                        00638099
006390     05  TABLE-WEEKEND-ENTRIES   OCCURS 450 TIMES                 00639099
006400                                 INDEXED BY MTH-IDX.              00640099
006410         10  TBL-FSCL-DTE        PIC X(10).                       00641099
006420         10  TBL-MONTHEND-DTE    PIC X(10).                       00642099
006430         10  TBL-MONTHEND-NBR    PIC X(02).                       00643099
006440                                                                  00644099
006450 01  CD-COUNTER-DISPLAY.                                          00645099
006460     05  CD-COUNT-HOLD1          PIC Z,ZZZ,ZZZ,ZZZ,ZZ9.           00646099
006470                                                                  00647099
006480 01 ABEND-AREAS.                                                  00648099
006490     05 ABEND-CODE               PIC S9(04)  VALUE ZEROS          00649099
006500                                             COMP SYNC.           00650099
006600         88  AC-BAD-DATA                     VALUE +4003.         00660099
006700         88  AC-DB2-ERROR                    VALUE +4013.         00670099
006800     05  AA-ABEND-LIT            PIC X(40)   VALUE                00680099
006900             '*****       ABEND'.                                 00690099
007000     05  AA-PROGRAM-LIT          PIC X(40)   VALUE                00700099
007100             '*****   PROGRAM: MLKUT614'.                         00710099
007200     05  AA-PARAGRAPH-LIT.                                        00720099
007300         10  FILLER              PIC X(17)   VALUE                00730099
007400             '***** PARAGRAPH: '.                                 00740099
007500         10  AA-PARAGRAPH-NAME   PIC X(35)   VALUE SPACES.        00750099
007600     05  AA-MESSAGE-LINE.                                         00760099
007700         10  FILLER              PIC X(06)   VALUE '*****'.       00770099
007800         10  AA-MESSAGE          PIC X(127)  VALUE SPACES.        00780099
007900     05  AA-DB2-ERROR-LIT        PIC X(40)   VALUE                00790099
008000             '*****    DB2 ERROR'.                                00800099
008100     05  AA-DB2-OPERATION-LIT.                                    00810099
008200         10  FILLER              PIC X(17)   VALUE                00820099
008300             '***** OPERATION: '.                                 00830099
008400         10  AA-DB2-OPERATION.                                    00840099
008500             15  AA-DB2-OP-1     PIC X(25)   VALUE SPACES.        00850099
008600             15  AA-DB2-OP-2     PIC X(25)   VALUE SPACES.        00860099
008700     05  AA-DB2-TABLE-1          PIC X(08)   VALUE SPACES.        00870099
008800     05  AA-DB2-TABLE-2          PIC X(08)   VALUE SPACES.        00880099
008900     05  AA-DB2-TABLE-3          PIC X(08)   VALUE SPACES.        00890099
009000     05  AA-DB2-TABLE-4          PIC X(08)   VALUE SPACES.        00900099
009100                                                                  00910099
009200 EJECT                                                            00920099
009300                                                                  00930099
009400*** DATA INTEGRITY CONTROL CARD                                   00940099
009500     COPY MLRD110.                                                00950099
009600                                                                  00960099
009800*** DATA INTEGRITY MLT_WKLY_SUM EXTRACT FILE                      00980099
009900     COPY MLRD111.                                                00990099
010000                                                                  01000099
010100 EJECT                                                            01010099
010200                                                                  01020099
010300******************************************************************01030099
010400*  DB2 ERROR MESSAGES FORMAT AREA.                                01040099
010500******************************************************************01050099
010600     COPY DPWS004.                                                01060099
010700                                                                  01070099
010800******************************************************************01080099
010900*  DB2 ERRORS                                                     01090099
011000******************************************************************01100099
011100     COPY SQLCA2.                                                 01110099
011200                                                                  01120099
011300******************************************************************01130099
011400*  DB2 COMMUNICATION AREA                                         01140099
011500******************************************************************01150099
011600     EXEC SQL                                                     01160099
011700          INCLUDE SQLCA                                           01170099
011800     END-EXEC.                                                    01180099
011900                                                                  01190099
012000******************************************************************01200099
012100*  M/L DETAIL TABLE - PARTITION BALANCING TABLE                   01210099
012200******************************************************************01220099
012300     EXEC SQL                                                     01230099
012400         INCLUDE MLT00002                                         01240099
012410     END-EXEC.                                                    01241099
012420*                                                                 01242099
012430******************************************************************01243099
012440*  M/L DETAIL TABLE - PARTITION CONTROL TABLE                     01244099
012450******************************************************************01245099
012460     EXEC SQL                                                     01246099
012470         INCLUDE MLT00003                                         01247099
012480     END-EXEC.                                                    01248099
012490*                                                                 01249099
012500******************************************************************01250099
012600*  DB2 MLT_WKLY_SUM TABLE LAYOUT                                  01260099
012700******************************************************************01270099
012800     EXEC SQL                                                     01280099
012900          INCLUDE MLT00005                                        01290099
013000     END-EXEC.                                                    01300099
013100*                                                                 01310099
013200******************************************************************01320099
013210*  DB2 TDTATTR TABLE LAYOUT                                       01321099
013220******************************************************************01322099
013230     EXEC SQL                                                     01323099
013231          INCLUDE TDTATTR                                         01323199
013232     END-EXEC.                                                    01323299
013233                                                                  01323399
015710 EJECT                                                            01571099
015730******************************************************************01573099
015740 PROCEDURE DIVISION.                                              01574099
015750******************************************************************01575099
015760                                                                  01576099
015770******************************************************************01577099
015780 0000-MAINLINE-MLKUT614.                                          01578099
015790******************************************************************01579099
015800*                                                                 01580099
015900     PERFORM 1000-INITIALIZATION.                                 01590099
016000                                                                  01600099
016100     PERFORM 2000-MAIN-PROCESS.                                   01610099
016200                                                                  01620099
016300     PERFORM 8000-EOJ.                                            01630099
016400                                                                  01640099
016500     STOP RUN.                                                    01650099
016600                                                                  01660099
016700 EJECT                                                            01670099
016800                                                                  01680099
016900******************************************************************01690099
017000 1000-INITIALIZATION.                                             01700099
017100******************************************************************01710099
017200*                                                                 01720099
017300     OPEN INPUT  DATA-INTEGRITY-CTL-FILE                          01730099
017300                 DATA-INTEGRITY-DATE-FILE.                        01731099
017400     OPEN OUTPUT DATA-INTEGRITY-EXTR-FILE.                        01740099
017500                                                                  01750099
017600     PERFORM 4000-READ-INPUT-FILE.                                01760099
017600     PERFORM 4100-READ-DATE-FILE.                                 01761099
017700                                                                  01770099
018200*    MOVE ZEROS TO MLT00005-PARTN-NBR.                            01820099
018300*    MOVE ZEROS TO MLT00005-DEPT-NBR.                             01830099
018400*    MOVE ZEROS TO MLT00005-MAJ-CL-NBR.                           01840099
018500*    MOVE ZEROS TO MLT00005-SUB-CL-NBR.                           01850099
018600*    MOVE ZEROS TO MLT00005-LOC-NBR.                              01860099
018700                                                                  01870099
018800     INITIALIZE PA-PROGRAM-ACCUMULATORS.                          01880099
018900     INITIALIZE PV-PROGRAM-VARIABLES.                             01890099
019000     INITIALIZE TABLE-FOR-MONTH-DATA.                             01900099
019100                                                                  01910099
019210*                                                                 01921099
019220 EJECT                                                            01922099
019230                                                                  01923099
019240******************************************************************01924099
019250 2000-MAIN-PROCESS.                                               01925099
019260******************************************************************01926099
019270*                                                                 01927099
019500     PERFORM                                                      01950099
019600       UNTIL PS-END-OF-INPUT                                      01960099
019700         PERFORM 2100-GET-MONTH-DATA                              01970099
019800         PERFORM 5000-WRITE-EXTRACT                               01980099
019900         PERFORM 4000-READ-INPUT-FILE                             01990099
020000         ADD  1           TO PA-INPUT-FILES                       02000099
020100     END-PERFORM.                                                 02010099
020300                                                                  02030099
020400 EJECT                                                            02040099
020500                                                                  02050099
020600******************************************************************02060099
020700 2100-GET-MONTH-DATA.                                             02070099
020800******************************************************************02080099
020900                                                                  02090099
021000     SET MTH-IDX                 TO 1.                            02100099
021100     SEARCH TABLE-WEEKEND-ENTRIES                                 02110099
021200         AT END                                                   02120099
021210             PERFORM 7400-SELECT-TDTATTR                          02121099
021220             ADD 1               TO PA-TDTATTR-ROWS-SELECTED      02122099
021230             MOVE MLT00005-FSCL-WK-END-DTE                        02123099
021240                                 TO PV-FSCL-DTE                   02124099
021241             MOVE DTATTR-FSCL-MN-END-DTE                          02124199
021242                                 TO PV-FSCL-MN-END-DTE            02124299
021250             MOVE DTATTR-FSCL-MN-NBR                              02125099
021260                                 TO PV-FSCL-MN-NBR                02126099
021270             IF PA-TDTATTR-ROWS-SELECTED > PC-MAX-TBL-ROWS        02127099
021280                 CONTINUE                                         02128099
021290             ELSE                                                 02129099
021300                 SET MTH-IDX     TO PA-TDTATTR-ROWS-SELECTED      02130099
021303                 MOVE MLT00005-FSCL-WK-END-DTE                    02130399
021304                                 TO TBL-FSCL-DTE     (MTH-IDX)    02130499
021305                 MOVE DTATTR-FSCL-MN-END-DTE                      02130599
021306                                 TO TBL-MONTHEND-DTE (MTH-IDX)    02130699
021307                 MOVE DTATTR-FSCL-MN-NBR                          02130799
021308                                 TO TBL-MONTHEND-NBR (MTH-IDX)    02130899
021309             END-IF                                               02130999
021311         WHEN TBL-FSCL-DTE  (MTH-IDX) = MLT00005-FSCL-WK-END-DTE  02131199
021312             MOVE TBL-MONTHEND-DTE (MTH-IDX)                      02131299
021313                                 TO PV-FSCL-MN-END-DTE            02131399
021314             MOVE TBL-MONTHEND-NBR (MTH-IDX)                      02131499
021315                                 TO PV-FSCL-MN-NBR                02131599
021316     END-SEARCH.                                                  02131699
021317                                                                  02131799
021318 EJECT                                                            02131899
021319                                                                  02131999
021320******************************************************************02132099
021321 4000-READ-INPUT-FILE.                                            02132199
021322******************************************************************02132299
021323*                                                                 02132399
021330     READ DATA-INTEGRITY-CTL-FILE                                 02133099
021340       INTO DCLMLT00005                                           02134099
021350         AT END                                                   02135099
021360             SET PS-END-OF-INPUT    TO TRUE.                      02136099
021700                                                                  02170099
021320******************************************************************02171099
021321 4100-READ-DATE-FILE.                                             02172099
021322******************************************************************02173099
021323*                                                                 02174099
021330     READ DATA-INTEGRITY-DATE-FILE                                02175099
021340       INTO ML110-DATA-INTEGRITY-CC-REC                           02176099
021350         AT END                                                   02177099
021360             MOVE PC-Y        TO PS-END-OF-DATE-FILE-SW.          02178099
021700                                                                  02179099
021800 EJECT                                                            02180099
021900                                                                  02190099
022000******************************************************************02200099
022100 5000-WRITE-EXTRACT.                                              02210099
022200******************************************************************02220099
022300*                                                                 02230099
022400     MOVE PV-FSCL-MN-END-DTE       TO ML111-FSCL-MN-END-DTE.      02240099
022500     MOVE PV-FSCL-MN-NBR           TO ML111-FSCL-MN-NBR.          02250099
022600     MOVE MLT00005-DEPT-NBR        TO PV-DEPT-NBR.                02260099
022700     MOVE PV-DEPT-NBR              TO ML111-DEPT-NBR.             02270099
022800     MOVE MLT00005-MAJ-CL-NBR      TO PV-MAJ-CL-NBR.              02280099
022900     MOVE PV-MAJ-CL-NBR            TO ML111-MAJ-CL-NBR.           02290099
023000     MOVE MLT00005-SUB-CL-NBR      TO PV-SUB-CL-NBR.              02300099
023100     MOVE PV-SUB-CL-NBR            TO ML111-SUB-CL-NBR.           02310099
023200     MOVE MLT00005-LOC-NBR         TO PV-LOC-NBR.                 02320099
023300     MOVE PV-LOC-NBR               TO ML111-STR-NBR.              02330099
023400                                                                  02340099
023500     COMPUTE ML111-SLS-RTL-AMT  = MLT00005-SLS-REG-RTL-AMT        02350099
023600                                + MLT00005-SLS-PROMO-RTL-AMT      02360099
023700                                + MLT00005-SLS-PROCLR-RTL-AMT     02370099
023800                                + MLT00005-SLS-CLR-RTL-AMT        02380099
023900                                + MLT00005-SLS-OTH-RTL-AMT.       02390099
024000     COMPUTE ML111-MKDN-RTL-AMT = MLT00005-MKDN-PLU-RTL-AMT       02400099
024010                                + MLT00005-MKDN-RGST-RTL-AMT      02401099
024020                                + MLT00005-MKDN-UMTCH-RTL-AMT     02402099
024030                                + MLT00005-MKDN-BYR-RTL-AMT       02403099
024040                                + MLT00005-MKDN-STR-RTL-AMT.      02404099
024050     MOVE MLT00005-MKUP-RTL-AMT     TO ML111-MKUP-RTL-AMT.        02405099
024060     MOVE MLT00005-XFER-IN-RTL-AMT  TO ML111-XFER-IN-RTL-AMT.     02406099
024070     MOVE MLT00005-XFER-OUT-RTL-AMT TO ML111-XFER-OUT-RTL-AMT.    02407099
024080     MOVE MLT00005-RCPT-RTL-AMT     TO ML111-RCPT-RTL-AMT.        02408099
024090     MOVE MLT00005-RCPT-NET-COST-AMT                              02409099
024100                                    TO ML111-RCPT-NET-COST-AMT.   02410099
024200     MOVE MLT00005-PADJ-RTL-AMT     TO ML111-PADJ-RTL-AMT.        02420099
024300     MOVE MLT00005-PADJ-NET-COST-AMT                              02430099
024400                                    TO ML111-PADJ-NET-COST-AMT.   02440099
024500     MOVE MLT00005-INV-ADJ-RTL-AMT  TO ML111-INV-ADJ-RTL-AMT.     02450099
024600     MOVE MLT00005-SHNK-RTL-AMT     TO ML111-SHNK-RTL-AMT.        02460099
R28582                                                                  02460199
R28582*    ENDING INVENTORY IS ONLY FILLED IN ON THE RECORD FOR THE     02460299
R28582*    FIRST (MOST RECENT) FISCAL WEEK IN THE FISCAL MONTH.         02460399
R28582*    (THE FISCAL WEEKS ARE PROCESSED IN DESCENDING SEQUENCE.)     02460499
R28582     IF  PV-FSCL-MN-END-DTE      = PV-PREV-FSCL-MN-END-DTE        02460599
R28582     AND MLT00005-DEPT-NBR       = PV-PREV-DEPT-NBR               02460699
R28582         MOVE ZEROS                  TO ML111-END-INV-RTL-AMT     02460799
R28582     ELSE                                                         02460899
R28582         MOVE MLT00005-END-INV-RTL-AMT TO ML111-END-INV-RTL-AMT   02460999
R28582         MOVE PV-FSCL-MN-END-DTE     TO PV-PREV-FSCL-MN-END-DTE   02461099
R28582         MOVE MLT00005-DEPT-NBR      TO PV-PREV-DEPT-NBR          02461199
R28582     END-IF.                                                      02461299
R28582                                                                  02461399
R28582*    IF MLT00005-FSCL-WK-END-DTE = ML110-END-DTE                  02462099
R28582*        MOVE MLT00005-END-INV-RTL-AMT                            02470099
R28582*                                   TO ML111-END-INV-RTL-AMT      02470199
R28582*    ELSE                                                         02470299
R28582*        MOVE ZERO                  TO ML111-END-INV-RTL-AMT      02470399
R28582*    END-IF.                                                      02470499
R28582*                                                                 02470599
024730     MOVE MLT00005-ML-LO-MDSE-LVL-ID TO ML111-DKEY-NBR.           02473099
024800                                                                  02480099
024900     WRITE DATA-INTEGRITY-EXTR-REC                                02490099
025000         FROM ML111-DATA-INTEGRITY-EXTR-REC.                      02500099
025100     ADD 1                         TO PA-OUTPUT-RECS-WRITTEN.     02510099
025200                                                                  02520099
025300 EJECT                                                            02530099
025400                                                                  02540099
031200******************************************************************03120099
031300 7400-SELECT-TDTATTR.                                             03130099
031400******************************************************************03140099
031500*                                                                 03150099
031610     MOVE MLT00005-FSCL-WK-END-DTE TO PV-FSCL-DTE.                03161099
031700                                                                  03170099
031800     EXEC SQL                                                     03180099
031900         SELECT DISTINCT                                          03190099
031910                FSCL_MN_NBR                                       03191099
032000               ,FSCL_MN_END_DTE                                   03200099
032100               ,FSCL_WK_NBR                                       03210099
032200               ,FSCL_WK_END_DTE                                   03220099
032300         INTO  :DTATTR-FSCL-MN-NBR                                03230099
032400              ,:DTATTR-FSCL-MN-END-DTE                            03240099
032410              ,:DTATTR-FSCL-WK-NBR                                03241099
032420              ,:DTATTR-FSCL-WK-END-DTE                            03242099
032430         FROM  MLT_PARTN_CNTL A                                   03243099
032440               ,TDTATTR B                                         03244099
032450         WHERE A.FSCL_DTE = :PV-FSCL-DTE                          03245099
032451           AND A.FSCL_DTE = B.KY_DTE                              03245199
032470           AND A.TBL_TM_LVL_CDE = 'W'                             03247099
032500         WITH UR                                                  03250099
032501     END-EXEC.                                                    03250199
032502                                                                  03250299
032503     EVALUATE TRUE                                                03250399
032504         WHEN SQLCODE = 0                                         03250499
032505             CONTINUE                                             03250599
032506         WHEN OTHER                                               03250699
032507             MOVE '7400-SELECT-TDTATTR'                           03250799
032508                                 TO AA-PARAGRAPH-NAME             03250899
032509             MOVE 'TDTATTR ROW NOT FOUND'                         03250999
032510                                 TO AA-MESSAGE                    03251099
032511             MOVE 'SELECT'       TO AA-DB2-OPERATION              03251199
032512             PERFORM Z998-SQL-ERROR                               03251299
032513     END-EVALUATE.                                                03251399
032514                                                                  03251499
032515 EJECT                                                            03251599
032516                                                                  03251699
032517******************************************************************03251799
032518 8000-EOJ.                                                        03251899
032519******************************************************************03251999
032520*                                                                 03252099
032530     DISPLAY ' '.                                                 03253099
032540     DISPLAY '  PROGRAM MLKUT614 PROCESSING SUMMARY'.             03254099
032550     DISPLAY '  -----------------------------------'.             03255099
032560     DISPLAY ' '.                                                 03256099
032570*                                                                 03257099
032700     MOVE PA-OUTPUT-RECS-WRITTEN TO CD-COUNT-HOLD1.               03270099
032800     DISPLAY 'EXTRACT RECORDS WRITTEN =   ' CD-COUNT-HOLD1.       03280099
032900*                                                                 03290099
033000     DISPLAY ' '.                                                 03300099
033100                                                                  03310099
033200     CLOSE DATA-INTEGRITY-CTL-FILE.                               03320099
033200     CLOSE DATA-INTEGRITY-DATE-FILE.                              03321099
033300     CLOSE DATA-INTEGRITY-EXTR-FILE.                              03330099
033400                                                                  03340099
033500 EJECT                                                            03350099
033600                                                                  03360099
033700******************************************************************03370099
033800 Z990-COMMON-ABEND-ROUTINE.                                       03380099
033900******************************************************************03390099
034000*                                                                 03400099
034100     DISPLAY AA-ABEND-LIT.                                        03410099
034200     DISPLAY AA-PROGRAM-LIT.                                      03420099
034300     DISPLAY AA-PARAGRAPH-LIT.                                    03430099
034400     DISPLAY AA-MESSAGE-LINE.                                     03440099
034500     DISPLAY ABEND-CODE.                                          03450099
034600                                                                  03460099
034700     CALL 'ILBOABN0' USING ABEND-CODE.                            03470099
034800                                                                  03480099
034900 EJECT                                                            03490099
035000                                                                  03500099
035100******************************************************************03510099
035200 Z998-SQL-ERROR.                                                  03520099
035300******************************************************************03530099
035400*                                                                 03540099
035500     CLOSE DATA-INTEGRITY-CTL-FILE                                03550099
035600           DATA-INTEGRITY-EXTR-FILE.                              03560099
035700                                                                  03570099
035800     DISPLAY AA-ABEND-LIT.                                        03580099
035900     DISPLAY AA-DB2-ERROR-LIT.                                    03590099
036000     DISPLAY AA-PROGRAM-LIT.                                      03600099
036100     DISPLAY AA-PARAGRAPH-LIT.                                    03610099
036200     DISPLAY AA-MESSAGE-LINE.                                     03620099
036300     DISPLAY AA-DB2-OPERATION-LIT.                                03630099
036400     SET AC-DB2-ERROR TO TRUE.                                    03640099
036500     MOVE +4013                  TO ABEND-CODE.                   03650099
036600                                                                  03660099
036700     COPY DPPD004.                                                03670099
036800     CALL 'ILBOABN0' USING ABEND-CODE.                            03680099
036900                                                                  03690099
