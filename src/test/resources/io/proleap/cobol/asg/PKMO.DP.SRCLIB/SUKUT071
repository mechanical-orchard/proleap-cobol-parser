000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400                                                                  00040001
000500 PROGRAM-ID.             SUKUT071.                                00050001
000600 AUTHOR.                 LYNN MCADAMS.                            00060001
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070001
000800 DATE-WRITTEN            JULY, 2002.                              00080001
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100*----------------------------------------------------------------*00110001
001200* THIS PROGRAM WILL CREATE 2 OUTPUT EXTRACT FILES AT THE PO,     *00120001
001300* RECEIVER, LINE LEVEL FROM THE PREVIOUS DAY NOT VERIFIED/       *00130010
001400* NOT COMPLETED EXTRACT CREATED IN SUKUT070.  ONE FILE WILL      *00140010
001500* CONTAIN PO, RCVR LINES WITH A VERIFIED/COMPLETED STATUS.       *00150010
001600* THE SECOND FILE WILL CONTAIN PO, RCVR LINES NOT VERIFIED/      *00160010
001700* NOT COMPLETE.  THE INPUT AND OUTPUT LAYOUT FOR THE FILES       *00170010
001800* IS SURD036.                                                    *00180011
001900*----------------------------------------------------------------*00190001
002000                                                                  00200001
002100***************************************************************** 00210001
002200 ENVIRONMENT DIVISION.                                            00220001
002300***************************************************************** 00230001
002400 INPUT-OUTPUT SECTION.                                            00240001
002500                                                                  00250001
002600 FILE-CONTROL.                                                    00260001
002700                                                                  00270001
002800     SELECT PO-FILE       ASSIGN TO INP01.                        00280003
002900     SELECT EXTRACT-FILE1 ASSIGN TO OUT01.                        00290002
003000     SELECT EXTRACT-FILE2 ASSIGN TO OUT02.                        00300001
003100                                                                  00310001
003200***************************************************************** 00320001
003300 DATA DIVISION.                                                   00330001
003400***************************************************************** 00340001
003500 FILE SECTION.                                                    00350001
003600*                                                                 00360001
003700*                                                                 00370001
003800 FD  PO-FILE                                                      00380003
003900     RECORDING MODE IS F                                          00390001
004000     LABEL RECORDS ARE STANDARD                                   00400001
004100     BLOCK CONTAINS 0 RECORDS.                                    00410001
004200 01  PO-RECORD                   PIC X(300).                      00420020
004300*                                                                 00430001
004400 FD  EXTRACT-FILE1                                                00440002
004500     RECORDING MODE IS F                                          00450002
004600     LABEL RECORDS ARE STANDARD                                   00460002
004700     BLOCK CONTAINS 0 RECORDS.                                    00470002
004800 01  EXTRACT-RECORD1             PIC X(300).                      00480020
004900*                                                                 00490002
005000 FD  EXTRACT-FILE2                                                00500002
005100     RECORDING MODE IS F                                          00510002
005200     LABEL RECORDS ARE STANDARD                                   00520002
005300     BLOCK CONTAINS 0 RECORDS.                                    00530002
005400 01  EXTRACT-RECORD2             PIC X(300).                      00540020
005500*                                                                 00550002
005600***************************************************************** 00560002
005700 WORKING-STORAGE SECTION.                                         00570002
005800                                                                  00580002
005900 01  PS-PROGRAM-SWITCHES.                                         00590002
006000     05  PS-END-OF-PO-SW              PIC X(01)  VALUE 'N'.       00600003
006100         88  PS-END-OF-PO-FILE                   VALUE 'Y'.       00610003
006200         88  PS-NOT-END-OF-PO-FILE               VALUE 'N'.       00620003
006300     05  PS-MANIFEST-DC-SW            PIC X(01)  VALUE 'N'.       00630024
006400         88  PS-MANIFEST-DC-FOUND                VALUE 'Y'.       00640024
006500         88  PS-MANIFEST-DC-NOT-FND              VALUE 'N'.       00650024
006600*                                                                 00660002
006700 01  PV-PROGRAM-VARIABLES.                                        00670002
006800     05 PV-EXTRACT-DTE                PIC X(10).                  00680002
006900*                                                                 00690002
007000     05 PV-CRE-DATE-TMST              PIC X(10).                  00700002
007100     05 PV-CRE-TIME-TMST              PIC X(8).                   00710002
007200*                                                                 00720002
007300     05  PV-SQLCODE                   PIC 9(9)   VALUE ZERO.      00730002
007400*                                                                 00740002
007500     05  PV-READ-COUNT               PIC S9(07)  VALUE ZERO       00750061
007600                                                 COMP-3.          00760017
007700     05  PV-WRITE-EXTR1-COUNT         PIC S9(09) VALUE ZERO       00770061
007800                                                  COMP SYNC.      00780017
007900     05  PV-WRITE-EXTR2-COUNT         PIC S9(09) VALUE ZERO       00790061
008000                                                  COMP SYNC.      00800058
008100     05  PV-DISPLAY-READ-CNT          PIC ZZZ,ZZZ,ZZ9.            00810061
008200     05  PV-DISPLAY-WRITE-CNT1        PIC ZZZ,ZZZ,ZZ9.            00820061
008300     05  PV-DISPLAY-WRITE-CNT2        PIC ZZZ,ZZZ,ZZ9.            00830061
008400     05  PV-DISPLAY-PO-NBR               PIC 999999999-.          00840077
008500     05  PV-DISPLAY-PO-LINE-NBR          PIC 999999999-.          00850077
008600     05  PV-DISPLAY-RCVR-SEQ-NBR         PIC 999999999-.          00860077
008700*                                                                 00870061
008800     05  PV-DB2-CURRENT-TIMESTAMP     PIC  X(26) VALUE SPACES.    00880060
008900     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACES.    00890056
009000     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(30) VALUE SPACES.    00900056
009100     05  PV-DB2-TABLE-NAME            PIC  X(08) VALUE SPACES.    00910080
009200     05  PV-DB2-TABLE-NAME1           PIC  X(08) VALUE SPACES.    00920080
009300     05  PV-DB2-FUNCTION             PIC X(30) VALUE SPACE.       00930081
009400                                                                  00940056
009500 01  DK-DB-KEYS.                                                  00950056
009600     05  DK-OPER-UNT-ID              PIC S9(04) COMP.             00960056
009700     05  DK-PO-NBR                   PIC S9(09) COMP.             00970056
009800     05  DK-REC-SEQ-NBR              PIC S9(09) COMP.             00980056
009900     05  DK-LINE-NBR                 PIC S9(09) COMP.             00990056
010000                                                                  01000056
010100 01  DN-DB2-NULL-INDICATORS.                                      01010056
010200     05  DN-VEH-NBR                   PIC S9(04) COMP VALUE +0.   01020056
010300                                                                  01030056
010400 01 PC-PROGRAM-CONSTANTS.                                         01040056
010500     05 PC-PROGRAM-NAME              PIC X(08)  VALUE 'SUKUT071'. 01050056
010600     05 PC-DEFAULT-TMST              PIC X(26)                    01060056
010700             VALUE '9999-09-09-09.09.09.999999'.                  01070056
010800                                                                  01080056
010900                                                                  01090056
011000 01  PV-ABEND-FIELDS.                                             01100056
011100     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         01110056
011200                                                 COMP SYNC.       01120056
011300     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'SUKUT071'.01130056
011400     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01140056
011500     05  PV-ABEND-OPERATION           PIC  X(51) VALUE SPACES.    01150056
011600     05  PV-ABEND-OPERATION1          PIC  X(51) VALUE SPACES.    01160078
011700     05  PV-ABEND-OPERATION2          PIC  X(51) VALUE SPACES.    01170078
011800     05  PV-ABEND-OPERATION3          PIC  X(51) VALUE SPACES.    01180078
011900******************************************************************01190056
012000*  USED FOR DB2 ERROR MESSAGE BUILDING                            01200056
012100******************************************************************01210056
012200     COPY DPWS004.                                                01220083
012300                                                                  01230056
012400******************************************************************01240056
012500*   DB2 SQL COMMUNICATION AREA                                    01250056
012600******************************************************************01260056
012700     EXEC SQL                                                     01270056
012800          INCLUDE SQLCA                                           01280056
012900     END-EXEC.                                                    01290056
013000*DB2 AREA FOR COMMUNICATIONS AREA2                                01300080
013100     COPY SQLCA2.                                                 01310083
013200                                                                  01320056
013300******************************************************************01330056
013400*   DB2 DCLGEN FOR PO-PURCHASE TABLE                              01340056
013500******************************************************************01350056
013600     EXEC SQL                                                     01360056
013700          INCLUDE TPURCHS                                         01370056
013800     END-EXEC.                                                    01380056
013900                                                                  01390056
014000******************************************************************01400056
014100*   DB2 DCLGEN FOR RC-RECEIPT ITEM TABLE                          01410056
014200******************************************************************01420056
014300     EXEC SQL                                                     01430056
014400          INCLUDE TRECITM                                         01440056
014500     END-EXEC.                                                    01450056
014600                                                                  01460056
014700******************************************************************01470056
014800*   DB2 DCLGEN FOR RC-RECEIVER TABLE                              01480056
014900******************************************************************01490056
015000     EXEC SQL                                                     01500056
015100          INCLUDE TRECEIV                                         01510056
015200     END-EXEC.                                                    01520056
015300                                                                  01530056
015400******************************************************************01540056
015500*   DB2 DCLGEN FOR DC-DISTRIBUTION TRANSACTION HEADER TABLE       01550056
015600******************************************************************01560056
015700     EXEC SQL                                                     01570056
015800          INCLUDE TDISTHD                                         01580056
015900     END-EXEC.                                                    01590056
016000                                                                  01600056
016100******************************************************************01610056
016200*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE PARM TABLE TO     01620056
016300*   CHECK IF DC IS MANIFESTING                                    01630056
016400******************************************************************01640056
016500     EXEC SQL                                                     01650056
016600          INCLUDE TKRPRPM                                         01660056
016700     END-EXEC.                                                    01670056
016800                                                                  01680056
016900******************************************************************01690056
017000*   DB2 DCLGEN FOR PC-WORK ORDER INSTRUCTION TABLE                01700056
017100******************************************************************01710056
017200     EXEC SQL                                                     01720056
017300          INCLUDE TWKORIN                                         01730056
017400     END-EXEC.                                                    01740056
017500                                                                  01750056
017600                                                                  01760056
017700***********************************************************       01770056
017800*  RECORD LAYOUT FOR THE CARTON EXCEPTION EXTRACT FILE            01780056
017900***********************************************************       01790056
018000     COPY SURD036.                                                01800083
018100                                                                  01810056
018200 EJECT                                                            01820056
018300***********************************************************       01830056
018400 PROCEDURE DIVISION.                                              01840056
018500***********************************************************       01850056
018600*    DISPLAY '***BEGINNING SUKUT071***'.                          01860056
018700                                                                  01870056
018800     PERFORM 1000-INITIALIZE.                                     01880059
018900                                                                  01890056
019000     PERFORM 2000-PROCESS-PO-FILE                                 01900056
019100         UNTIL PS-END-OF-PO-FILE.                                 01910056
019200                                                                  01920056
019300     MOVE PV-READ-COUNT           TO PV-DISPLAY-READ-CNT.         01930066
019400     DISPLAY 'TOTAL RECORDS READ    '   PV-DISPLAY-READ-CNT.      01940066
019500                                                                  01950068
019600     MOVE PV-WRITE-EXTR1-COUNT    TO PV-DISPLAY-WRITE-CNT1.       01960066
019700     DISPLAY 'TOTAL VERIFIED RECS WRITTEN ' PV-DISPLAY-WRITE-CNT1.01970068
019800                                                                  01980068
019900     MOVE PV-WRITE-EXTR2-COUNT    TO PV-DISPLAY-WRITE-CNT2.       01990066
020000     DISPLAY 'TOTAL NOT VE RECS WRITTEN   ' PV-DISPLAY-WRITE-CNT2.02000068
020100*DISPLAY READ TOTAL SHOULD EQUAL WRITE TOTAL                      02010061
020200                                                                  02020056
020300     CLOSE PO-FILE                                                02030056
020400           EXTRACT-FILE1                                          02040056
020500           EXTRACT-FILE2.                                         02050056
020600                                                                  02060056
020700                                                                  02070056
020800     GOBACK.                                                      02080056
020900                                                                  02090056
021000                                                                  02100056
021100******************************************************************02110056
021200*  DO FIRST TIME PROGRAM INITIALIZE TASKS.                        02120065
021300******************************************************************02130056
021400 1000-INITIALIZE.                                                 02140059
021500     OPEN INPUT  PO-FILE                                          02150056
021600          OUTPUT EXTRACT-FILE1                                    02160056
021700          OUTPUT EXTRACT-FILE2.                                   02170056
021800                                                                  02180056
021900     INITIALIZE SU036-RECORD.                                     02190076
022000                                                                  02200076
022100*FIRST READ                                                       02210056
022200     PERFORM 7100-READ-PO-FILE.                                   02220056
022300                                                                  02230056
022400     IF PS-END-OF-PO-FILE                                         02240056
022500         DISPLAY '** PO FILE IS EMPTY **'                         02250060
022600     ELSE                                                         02260056
022700         MOVE SU036-PO-NUMBER TO DK-PO-NBR                        02270056
022800     END-IF.                                                      02280056
022900                                                                  02290056
023000                                                                  02300056
023100***************************************************************** 02310056
023200 2000-PROCESS-PO-FILE.                                            02320056
023300***************************************************************** 02330056
023400     MOVE '2000-PROCESS-EXTRACTS   ' TO PV-ABEND-PARAGRAPH.       02340056
023500                                                                  02350056
023600*NEXT READ                                                        02360056
023700     PERFORM 7100-READ-PO-FILE                                    02370056
023800                                                                  02380070
023900     IF PS-END-OF-PO-FILE                                         02390056
024000          CONTINUE                                                02400056
024100     ELSE                                                         02410056
024200         MOVE SU036-PO-NUMBER TO DK-PO-NBR                        02420056
024300     END-IF.                                                      02430056
024400                                                                  02440056
024500                                                                  02450056
024600***************************************************************** 02460056
024700*CHECK TO SEE IF CARTON WAS CREATED AT MANIFESTING DC             02470056
024800 2150-CHECK-IF-MFST-DC.                                           02480056
024900***************************************************************** 02490056
025000     MOVE SU036-OPER-UNT-ID  TO DK-OPER-UNT-ID.                   02500056
025100                                                                  02510056
025200     EXEC SQL                                                     02520056
025300          SELECT FUNC_END_TMST                                    02530056
025400               , FUNC_TXT                                         02540056
025500          INTO  :KRPRPM-FUNC-END-TMST                             02550056
025600               ,:KRPRPM-FUNC-TXT                                  02560056
025700          FROM   TKRPRPM                                          02570056
025800          WHERE  SYS_PRC_FUNC_CDE  = 'DCMFST'                     02580056
025900            AND  LOC_ID            = :DK-OPER-UNT-ID              02590056
026000            AND  INTFC_SYS_CDE     = 'KHL'                        02600056
026100            AND  FUNC_PRC_STAT_CDE = 'AC'                         02610056
026200            AND  FUNC_TXT          = 'Y'                          02620056
026300            WITH UR                                               02630067
026400     END-EXEC.                                                    02640056
026500                                                                  02650056
026600     EVALUATE TRUE                                                02660056
026700         WHEN SQLCODE = ZERO                                      02670056
026800             SET PS-MANIFEST-DC-FOUND  TO TRUE                    02680056
026900         WHEN SQLCODE = +100                                      02690056
027000             SET PS-MANIFEST-DC-NOT-FND TO TRUE                   02700056
027100         WHEN SQLWARN0 NOT = SPACES                               02710056
027200         WHEN SQLCODE < ZERO                                      02720056
027300         WHEN SQLCODE > ZERO                                      02730056
027400             MOVE '2150-CHECK-IF-MFST-DC'                         02740056
027500                 TO PV-PARAGRAPH-NAME                             02750056
027600             MOVE 'SELECT OF TKRPRPM TABLE'                       02760056
027700                 TO PV-DB2-OPERATION-ATTEMPTED                    02770056
027800             PERFORM Z999-SQL-ABEND                               02780056
027900     END-EVALUATE.                                                02790056
028000                                                                  02800056
028100                                                                  02810056
028200***************************************************************** 02820056
028300 2200-LOAD-EXTRACT-RECORD.                                        02830056
028400***************************************************************** 02840056
028500     MOVE '2200-LOAD-EXTRACT-RCD   ' TO PV-ABEND-PARAGRAPH.       02850056
028600                                                                  02860056
028700     MOVE RECITM-STATUS-CDE        TO SU036-LINE-STATUS.          02870056
028800     MOVE PURCHS-SEASET-SHRT-NM    TO SU036-SEASONAL-NAME.        02880056
028900                                                                  02890056
029000     IF RECITM-STATUS-CDE = 'VE'                                  02900063
029100       MOVE RECITM-VERFYD-TMST                                    02910063
029200            TO SU036-TMST-LINE-VERIFIED                           02920063
029300     ELSE                                                         02930063
029400       MOVE WKORIN-STOP-TMST                                      02940063
029500            TO SU036-TMST-LINE-VERIFIED                           02950063
029600     END-IF.                                                      02960063
029700                                                                  02970056
029800     MOVE DISTHD-FCSE-CNFRMN-TMST  TO SU036-TMST-LINE-CONFIRMED.  02980056
029900     MOVE DISTHD-RSLTS-RCVD-TMST   TO SU036-TMST-LINE-P2L-UPLD.   02990056
030000     MOVE PV-DB2-CURRENT-TIMESTAMP TO SU036-TMST-CREATED.         03000056
030100                                                                  03010056
030200                                                                  03020056
030300***************************************************************** 03030056
030400*GET STATUS CODE FOR PO LINES                                     03040056
030500 2300-SELECT-TRECITM.                                             03050056
030600***************************************************************** 03060056
030700     MOVE SU036-OPER-UNT-ID     TO DK-OPER-UNT-ID                 03070056
030800     MOVE SU036-PO-NUMBER       TO DK-PO-NBR                      03080056
030900     MOVE SU036-REC-SEQ-NBR     TO DK-REC-SEQ-NBR                 03090056
031000     MOVE SU036-LINE-NBR        TO DK-LINE-NBR                    03100056
031100                                                                  03110056
031200     EXEC SQL                                                     03120056
031300          SELECT ORD_NBR                                          03130056
031400               , ORD_LNE_NBR                                      03140056
031500               , REC_SEQ_NBR                                      03150056
031600               , STATUS_CDE                                       03160056
031700               , VERFYD_TMST                                      03170056
031800            INTO  :RECITM-ORD-NBR                                 03180056
031900                 ,:RECITM-ORD-LNE-NBR                             03190056
032000                 ,:RECITM-REC-SEQ-NBR                             03200056
032100                 ,:RECITM-STATUS-CDE                              03210056
032200                 ,:RECITM-VERFYD-TMST                             03220056
032300            FROM TRECITM                                          03230056
032400           WHERE OPER_UNT_ID    = :DK-OPER-UNT-ID                 03240056
032500             AND ORD_NBR        = :DK-PO-NBR                      03250056
032600             AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                 03260056
032700             AND ORD_LNE_NBR    = :DK-LINE-NBR                    03270056
032800             AND VER_STATUS_CDE = 'A'                             03280056
032900             WITH UR                                              03290067
033000     END-EXEC.                                                    03300056
033100                                                                  03310056
033200     EVALUATE TRUE                                                03320056
033300         WHEN SQLCODE = +0                                        03330056
033400              IF RECITM-STATUS-CDE = 'IP'                         03340056
033500                 PERFORM 2350-SELECT-TRECEIV                      03350056
033600              ELSE                                                03360056
033700                 PERFORM 2360-SELECT-TPURCHS                      03370056
033800                 PERFORM 2370-SELECT-TDISTHD                      03380056
033900                 PERFORM 2200-LOAD-EXTRACT-RECORD                 03390056
034000                 ADD +1 TO PV-WRITE-EXTR1-COUNT                   03400061
034100                 PERFORM 8000-WRITE-EXTRACT1                      03410056
034200              END-IF                                              03420056
034300         WHEN SQLCODE = +100                                      03430056
034400              CONTINUE                                            03440056
034500         WHEN SQLWARN0 NOT = SPACE                                03450056
034600         WHEN SQLCODE  NOT = +0                                   03460056
034700              MOVE '2300-SELECT-TRECITM'                          03470056
034800                                   TO PV-ABEND-PARAGRAPH          03480056
034900              MOVE 'ATTEMPTING TO SELECT TRECITM'                 03490056
035000                                   TO PV-ABEND-OPERATION          03500056
035100              MOVE RECITM-ORD-NBR      TO PV-DISPLAY-PO-NBR       03510082
035200              STRING 'PO NBR: '         DELIMITED BY SIZE         03520082
035300                  PV-DISPLAY-PO-NBR     DELIMITED BY SIZE         03530082
035400                            INTO PV-ABEND-OPERATION1              03540082
035500              MOVE RECITM-REC-SEQ-NBR                             03550082
035600                              TO PV-DISPLAY-RCVR-SEQ-NBR          03560077
035700              STRING 'RECV SEQ: '       DELIMITED BY SIZE         03570077
035800                  PV-DISPLAY-RCVR-SEQ-NBR                         03580077
035900                                        DELIMITED BY SIZE         03590077
036000                            INTO PV-ABEND-OPERATION2              03600077
036100              MOVE RECITM-ORD-LNE-NBR  TO PV-DISPLAY-PO-LINE-NBR  03610082
036200              STRING 'PO LINE NBR: '    DELIMITED BY SIZE         03620077
036300                 PV-DISPLAY-PO-LINE-NBR DELIMITED BY SIZE         03630077
036400                            INTO PV-ABEND-OPERATION3              03640077
036500              PERFORM Z999-SQL-ABEND                              03650056
036600     END-EVALUATE.                                                03660056
036700                                                                  03670056
036800***************************************************************** 03680056
036900*IF TRECITM-STATUS-CDE = 'IP' GET TRECEIV-STATUS-CODE             03690056
037000 2350-SELECT-TRECEIV.                                             03700056
037100***************************************************************** 03710056
037200     EXEC SQL                                                     03720056
037300          SELECT STATUS_CDE                                       03730056
037400               , VERFYD_TMST                                      03740056
037500            INTO  :RECEIV-STATUS-CDE                              03750056
037600               ,  :RECEIV-VERFYD-TMST                             03760056
037700            FROM TRECEIV                                          03770056
037800           WHERE ORD_NBR     = :DK-PO-NBR                         03780056
037900             AND REC_SEQ_NBR = :DK-REC-SEQ-NBR                    03790056
038000             WITH UR                                              03800067
038100     END-EXEC.                                                    03810056
038200                                                                  03820056
038300     EVALUATE TRUE                                                03830056
038400         WHEN SQLCODE = +0                                        03840056
038500              IF RECEIV-STATUS-CDE NOT = 'CM'                     03850056
038600                 IF PS-NOT-END-OF-PO-FILE AND                     03860056
038700                    PS-MANIFEST-DC-FOUND                          03870056
038800                    PERFORM 2200-LOAD-EXTRACT-RECORD              03880056
038900                    ADD +1 TO PV-WRITE-EXTR2-COUNT                03890061
039000                    PERFORM 8100-WRITE-EXTRACT2                   03900056
039100                 END-IF                                           03910056
039200              ELSE                                                03920056
039300                 PERFORM 2355-SELECT-TWKORIN                      03930056
039400                 PERFORM 2360-SELECT-TPURCHS                      03940056
039500                 PERFORM 2370-SELECT-TDISTHD                      03950056
039600                 PERFORM 2200-LOAD-EXTRACT-RECORD                 03960056
039700                 ADD +1 TO PV-WRITE-EXTR1-COUNT                   03970061
039800                 PERFORM 8000-WRITE-EXTRACT1                      03980056
039900              END-IF                                              03990056
040000         WHEN SQLCODE = +100                                      04000056
040100              CONTINUE                                            04010056
040200         WHEN SQLWARN0 NOT = SPACE                                04020056
040300         WHEN SQLCODE  NOT = +0                                   04030056
040400              MOVE '2350-SELECT-TRECEIV'                          04040056
040500                                   TO PV-ABEND-PARAGRAPH          04050056
040600              MOVE 'ATTEMPTING TO SELECT TRECEIV'                 04060056
040700                                   TO PV-ABEND-OPERATION          04070056
040800              MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR       04080082
040900              STRING 'PO NBR: '         DELIMITED BY SIZE         04090082
041000                  PV-DISPLAY-PO-NBR     DELIMITED BY SIZE         04100082
041100                            INTO PV-ABEND-OPERATION1              04110082
041200              MOVE DK-REC-SEQ-NBR                                 04120082
041300                              TO PV-DISPLAY-RCVR-SEQ-NBR          04130077
041400              STRING 'RECV SEQ: '       DELIMITED BY SIZE         04140077
041500                  PV-DISPLAY-RCVR-SEQ-NBR                         04150077
041600                                        DELIMITED BY SIZE         04160077
041700                            INTO PV-ABEND-OPERATION2              04170077
041800              PERFORM Z999-SQL-ABEND                              04180056
041900     END-EVALUATE.                                                04190056
042000                                                                  04200056
042100***************************************************************** 04210056
042200 2355-SELECT-TWKORIN.                                             04220056
042300***************************************************************** 04230056
042400     EXEC SQL                                                     04240056
042500        SELECT A.STOP_TMST                                        04250056
042600        INTO  :WKORIN-STOP-TMST                                   04260056
042700        FROM   TWKORIN A                                          04270056
042800        WHERE  A.ORD_NBR          = :DK-PO-NBR                    04280056
042900          AND  A.RCVR_SEQ_NBR     = :DK-REC-SEQ-NBR               04290056
043000          AND  A.ORD_LNE_NBR      = 0                             04300056
043100          AND  A.VER_STATUS_CDE   = 'A'                           04310056
043200          AND  A.STOP_TMST IN                                     04320056
043300            (SELECT MAX(C.STOP_TMST)                              04330056
043400              FROM TWKORIN C                                      04340056
043500            WHERE C.ORD_NBR      = :DK-PO-NBR                     04350056
043600              AND C.RCVR_SEQ_NBR = :DK-REC-SEQ-NBR                04360056
043700              AND C.ORD_LNE_NBR  = 0                              04370056
043800              AND C.VER_STATUS_CDE   = 'A'                        04380056
043900              AND STOP_TMST NOT IN ('9999-09-09-09.09.09.000000') 04390056
044000              AND STOP_TMST NOT IN ('9999-09-09-09.09.09.999999'))04400056
044100              WITH UR                                             04410067
044200     END-EXEC.                                                    04420056
044300                                                                  04430056
044400     EVALUATE TRUE                                                04440056
044500         WHEN SQLCODE = +0                                        04450056
044600         WHEN SQLCODE = +100                                      04460056
044700              CONTINUE                                            04470063
044800         WHEN SQLWARN0 NOT = SPACE                                04480056
044900         WHEN SQLCODE  NOT = +0                                   04490056
045000              MOVE '2355-SELECT-TWKORIN'                          04500056
045100                                   TO PV-ABEND-PARAGRAPH          04510056
045200              MOVE 'ATTEMPTING TO SELECT TWKORIN'                 04520056
045300                                   TO PV-ABEND-OPERATION          04530056
045400              MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR       04540082
045500              STRING 'PO NBR: '         DELIMITED BY SIZE         04550082
045600                  PV-DISPLAY-PO-NBR     DELIMITED BY SIZE         04560082
045700                            INTO PV-ABEND-OPERATION1              04570082
045800              MOVE DK-REC-SEQ-NBR                                 04580082
045900                              TO PV-DISPLAY-RCVR-SEQ-NBR          04590077
046000              STRING 'RECV SEQ: '       DELIMITED BY SIZE         04600077
046100                  PV-DISPLAY-RCVR-SEQ-NBR                         04610077
046200                                        DELIMITED BY SIZE         04620077
046300                            INTO PV-ABEND-OPERATION2              04630077
046400              PERFORM Z999-SQL-ABEND                              04640056
046500     END-EVALUATE.                                                04650056
046600                                                                  04660056
046700***************************************************************** 04670056
046800*GET SEASONAL SHORT NAME                                          04680056
046900 2360-SELECT-TPURCHS.                                             04690056
047000***************************************************************** 04700056
047100     EXEC SQL                                                     04710056
047200          SELECT SEASET_SHRT_NM                                   04720056
047300            INTO  :PURCHS-SEASET-SHRT-NM                          04730056
047400            FROM TPURCHS                                          04740056
047500           WHERE PO_NBR          = :DK-PO-NBR                     04750056
047600             AND VER_STATUS_CDE  = 'A'                            04760056
047700             WITH UR                                              04770067
047800     END-EXEC.                                                    04780056
047900                                                                  04790056
048000     EVALUATE TRUE                                                04800056
048100         WHEN SQLCODE = +0                                        04810056
048200              CONTINUE                                            04820056
048300         WHEN SQLCODE = +100                                      04830056
048400              CONTINUE                                            04840056
048500         WHEN SQLWARN0 NOT = SPACE                                04850056
048600         WHEN SQLCODE  NOT = +0                                   04860056
048700              MOVE '2360-SELECT-TPURCHS'                          04870056
048800                                   TO PV-ABEND-PARAGRAPH          04880056
048900              MOVE 'ATTEMPTING TO SELECT TPURCHS'                 04890056
049000                                   TO PV-ABEND-OPERATION          04900056
049100              MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR       04910082
049200              STRING 'PO NBR: '         DELIMITED BY SIZE         04920082
049300                  PV-DISPLAY-PO-NBR     DELIMITED BY SIZE         04930082
049400                            INTO PV-ABEND-OPERATION1              04940082
049500              PERFORM Z999-SQL-ABEND                              04950056
049600     END-EVALUATE.                                                04960056
049700                                                                  04970056
049800***************************************************************** 04980056
049900*GET DATES                                                        04990056
050000 2370-SELECT-TDISTHD.                                             05000056
050100***************************************************************** 05010056
050200     EXEC SQL                                                     05020056
050300          SELECT P2L_CART_CNT                                     05030056
050400               , RSLTS_RCVD_TMST                                  05040056
050500               , FCSE_CNFRMN_TMST                                 05050056
050600            INTO  :DISTHD-P2L-CART-CNT                            05060056
050700               ,  :DISTHD-RSLTS-RCVD-TMST                         05070056
050800               ,  :DISTHD-FCSE-CNFRMN-TMST                        05080056
050900            FROM TDISTHD                                          05090056
051000           WHERE ORD_NBR      = :DK-PO-NBR                        05100056
051100             AND RCVR_SEQ_NBR = :DK-REC-SEQ-NBR                   05110056
051200             AND ORD_LNE_NBR  = :DK-LINE-NBR                      05120056
051300             WITH UR                                              05130067
051400     END-EXEC.                                                    05140056
051500                                                                  05150056
051600     EVALUATE TRUE                                                05160056
051700         WHEN SQLCODE = +0                                        05170056
051800              IF DISTHD-P2L-CART-CNT > 0                          05180056
051900                 CONTINUE                                         05190056
052000              END-IF                                              05200056
052100                                                                  05210056
052200              IF DISTHD-P2L-CART-CNT = 0                          05220056
052300                 MOVE PC-DEFAULT-TMST TO DISTHD-RSLTS-RCVD-TMST   05230056
052400              END-IF                                              05240056
052500         WHEN SQLCODE = +100                                      05250056
052600              CONTINUE                                            05260056
052700         WHEN SQLWARN0 NOT = SPACE                                05270056
052800         WHEN SQLCODE  NOT = +0                                   05280056
052900              MOVE '2370-SELECT-TDISTHD'                          05290056
053000                                   TO PV-ABEND-PARAGRAPH          05300056
053100              MOVE 'ATTEMPTING TO SELECT TDISTHD'                 05310056
053200                                   TO PV-ABEND-OPERATION          05320056
053300              MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR       05330082
053400              STRING 'PO NBR: '         DELIMITED BY SIZE         05340082
053500                  PV-DISPLAY-PO-NBR     DELIMITED BY SIZE         05350082
053600                            INTO PV-ABEND-OPERATION1              05360082
053700              MOVE DK-REC-SEQ-NBR                                 05370082
053800                              TO PV-DISPLAY-RCVR-SEQ-NBR          05380077
053900              STRING 'RECV SEQ: '       DELIMITED BY SIZE         05390077
054000                  PV-DISPLAY-RCVR-SEQ-NBR                         05400077
054100                                        DELIMITED BY SIZE         05410077
054200                            INTO PV-ABEND-OPERATION2              05420077
054300              MOVE DK-LINE-NBR         TO PV-DISPLAY-PO-LINE-NBR  05430082
054400              STRING 'PO LINE NBR: '    DELIMITED BY SIZE         05440077
054500                 PV-DISPLAY-PO-LINE-NBR DELIMITED BY SIZE         05450077
054600                            INTO PV-ABEND-OPERATION3              05460077
054700              PERFORM Z999-SQL-ABEND                              05470056
054800     END-EVALUATE.                                                05480056
054900                                                                  05490056
055000                                                                  05500056
055100***************************************************************** 05510056
055200 7100-READ-PO-FILE.                                               05520056
055300******************************************************************05530056
055400                                                                  05540056
055500     READ PO-FILE  INTO SU036-RECORD                              05550056
055600        AT END                                                    05560056
055700           SET PS-END-OF-PO-FILE TO TRUE                          05570056
055800        NOT AT END                                                05580056
055900           PERFORM 2150-CHECK-IF-MFST-DC                          05590056
056000           IF PS-MANIFEST-DC-FOUND                                05600056
056100              ADD +1 TO PV-READ-COUNT                             05610061
056200              PERFORM 2300-SELECT-TRECITM                         05620056
056300           ELSE                                                   05630056
056400              CONTINUE                                            05640056
056500           END-IF                                                 05650056
056600     END-READ.                                                    05660056
056700                                                                  05670056
056800                                                                  05680056
056900***************************************************************** 05690056
057000 8000-WRITE-EXTRACT1.                                             05700056
057100***************************************************************** 05710056
057200     WRITE EXTRACT-RECORD1                                        05720056
057300       FROM SU036-RECORD.                                         05730056
057400     INITIALIZE SU036-RECORD.                                     05740075
057500                                                                  05750056
057600***************************************************************** 05760056
057700 8100-WRITE-EXTRACT2.                                             05770056
057800***************************************************************** 05780056
057900     WRITE EXTRACT-RECORD2                                        05790056
058000       FROM SU036-RECORD.                                         05800056
058100     INITIALIZE SU036-RECORD.                                     05810075
058200                                                                  05820056
058300                                                                  05830056
058400***************************************************************** 05840056
058500 Z999-SQL-ABEND.                                                  05850056
058600***************************************************************** 05860056
058700     MOVE SQLCODE                     TO SQLCODE2.                05870080
058800     MOVE SQLERRD(3)                  TO SQLERRD3.                05880080
058900                                                                  05890080
059000     DISPLAY '** ABEND **         ** = SQLERROR'.                 05900080
059100     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                05910080
059200     DISPLAY '** PO NUMBER ** = ' PV-DISPLAY-PO-NBR.              05920080
059300     DISPLAY '** RECEIVER  ** = ' PV-DISPLAY-RCVR-SEQ-NBR.        05930080
059400     DISPLAY '** PO LNE NBR** = ' PV-DISPLAY-PO-LINE-NBR.         05940080
059500                                                                  05950080
059600                                                                  05960080
059700     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             05970080
059800     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                05980080
059900     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME.              05990080
060000     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME1.             06000080
060100     DISPLAY '** SQLCODE          ** = ' SQLCODE2.                06010080
060200     DISPLAY '** ROWS PROCESSED   ** = ' SQLERRD3.                06020080
060300     DISPLAY '** SQLERRM          ** = ' SQLERRM.                 06030080
060400     DISPLAY '** SQLERRMC         ** = ' SQLERRMC.                06040080
060500                                                                  06050056
060600                                                                  06060056
060700     MOVE +4013                  TO PV-ABEND-CODE.                06070056
060800     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         06080056
