000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    XSKUP060.                                         00020000
000300 AUTHOR.        BARB ERTL.                                        00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  11/29/2002.                                       00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800**       PRICE ZONE GROUP MESSAGE TO POPULATE XST_STR_GP_TYP      00080002
000900******************************************************************00090000
001000**THIS IS A CALLED MODULE FOR LOCATION TABLES.  THIS PROGRAM      00100000
001100**     WILL PERFORM UPDATES/INSERTS/DELETES FOR THE               00110000
001200**     XST_STR_GP_TYP TABLE.  IT DOES THE FOLLOWING WITH          00120000
001300**     THESE RETURN CODES:                                        00130000
001400**     0000 - END PROGRAM                                         00140000
001500**    -0530 - END PROGRAM                                         00150000
001600**    -0803 - END PROGRAM                                         00160000
001700**    -0911 - RETRY INSERT UP TO 5 TIMES AND THEN END PROGRAM     00170000
001800******************************************************************00180000
001900 ENVIRONMENT DIVISION.                                            00190000
002000 CONFIGURATION SECTION.                                           00200000
002100 SOURCE-COMPUTER.  IBM-3090.                                      00210000
002200 OBJECT-COMPUTER.  IBM-3090.                                      00220000
002300 DATA DIVISION.                                                   00230000
002400                                                                  00240000
002500 WORKING-STORAGE SECTION.                                         00250000
002600******************************************************************00260000
002700**PROGRAM SWITCHES                                                00270000
002800******************************************************************00280000
002900 01  PS-PROGRAM-SWITCHES.                                         00290000
003000     05  PS-PROCESS-CONTINUE-SW      PIC X(01)  VALUE 'Y'.        00300000
003100         88  PS-PROCESS-CONTINUE                VALUE 'Y'.        00310000
003200         88  PS-PROCESS-COMPLETE                VALUE 'N'.        00320000
003300******************************************************************00330000
003400**PROGRAM CONSTANTS                                               00340000
003500******************************************************************00350000
003600 01  PC-PROGRAM-CONSTANTS.                                        00360000
003700     05  PC-RETRY-MAX                PIC 9(01)  VALUE 5.          00370000
003800******************************************************************00380000
003900**PROGRAM VARIABLES                                               00390000
004000******************************************************************00400000
004100 01  PV-PROGRAM-VARIABLES.                                        00410000
004200     05  PV-RETRY-COUNTER            PIC 9(01)  VALUE ZEROS.      00420000
004300     05  PV-RETURN-CODE              PIC S9(04) VALUE 0.          00430000
004400     05  PV-STR-GP-IND               PIC X(01)  VALUE SPACES.     00440000
004500******************************************************************00450000
004600**COPYBOOKS                                                       00460000
004700******************************************************************00470000
004800***DB2 MESSAGE AREA                                               00480000
004900     COPY SQLCA2.                                                 00490005
005000***MESSAGE COPYBOOK                                               00500000
005100     COPY HORD100.                                                00510005
005200******************************************************************00520000
005300**TABLE INCLUSIONS                                                00530000
005400******************************************************************00540000
005500***DB2 COMMUNICATIONS AREA                                        00550000
005600     EXEC SQL                                                     00560000
005700          INCLUDE SQLCA                                           00570000
005800     END-EXEC.                                                    00580000
005900* ------------------------------------------------------------- * 00590000
006000*  SQL AND COBOL DECLARATIONS FOR STORE GROUP TYPE TABLE          00600000
006100*  XST_STR_GP_TYP                                                 00610000
006200* ------------------------------------------------------------- * 00620000
006300     EXEC SQL                                                     00630000
006400         INCLUDE XST00021                                         00640000
006500     END-EXEC.                                                    00650000
006600                                                                  00660000
006700* ------------------------------------------------------------- * 00670000
006800*  SQL AND COBOL DECLARATIONS FOR STORE GROUP TABLE               00680000
006900*  XST_STR_GP                                                     00690000
007000* ------------------------------------------------------------- * 00700000
007100     EXEC SQL                                                     00710000
007200         INCLUDE XST00022                                         00720000
007300     END-EXEC.                                                    00730000
007400                                                                  00740000
007500 LINKAGE SECTION.                                                 00750000
007600******************************************************************00760000
007700**LINKAGE VARIABLES                                               00770000
007800******************************************************************00780000
007900 01  LV-LINKAGE-VARIABLES.                                        00790000
008000     05  LV-HORD100-RECORD               PIC X(500).              00800000
008100     05  LV-RETURN-CODE                  PIC S9(04).              00810000
008200                                                                  00820000
008300 PROCEDURE DIVISION USING LV-LINKAGE-VARIABLES.                   00830000
008400******************************************************************00840000
008500 0000-MAINLINE.                                                   00850000
008600                                                                  00860000
008700      PERFORM 1000-INITIALIZATION.                                00870000
008800      PERFORM 2000-PROCESS-MESSAGE                                00880000
008900              UNTIL PS-PROCESS-COMPLETE.                          00890000
009000      PERFORM 9999-WRAPUP.                                        00900000
009100                                                                  00910000
009200***************************************************************** 00920000
009300**INITIALIZATION AREA - ALL MOVES TO UPDATE/INSERT                00930000
009400***************************************************************** 00940000
009500 1000-INITIALIZATION.                                             00950000
009600                                                                  00960000
009700     INITIALIZE PV-RETRY-COUNTER                                  00970000
009800                PV-RETURN-CODE                                    00980000
009900                PV-STR-GP-IND.                                    00990000
010000                                                                  01000000
010100     SET PS-PROCESS-CONTINUE         TO TRUE.                     01010000
010200                                                                  01020000
010300     MOVE LV-HORD100-RECORD          TO HORD100-RECORD.           01030000
010400                                                                  01040000
010500     MOVE HO100-PZG-STR-GP-TYP-CDE   TO XST00021-STR-GP-TYP-CDE.  01050000
010600     MOVE HO100-PZG-STR-GP-CTG-NM    TO XST00021-STR-GP-TYP-NM.   01060004
010700***************************************************************** 01070000
010800**MAIN PROGRAM LOGIC - READS ACTION TYPE ON HORD100 RECORD        01080000
010900***************************************************************** 01090000
011000 2000-PROCESS-MESSAGE.                                            01100000
011100                                                                  01110000
011200     EVALUATE TRUE                                                01120000
011300        WHEN HO100-ACTN-TYP-INSERT                                01130000
011400             PERFORM 2100-INSERT-DATA                             01140000
011500        WHEN HO100-ACTN-TYP-UPDATE                                01150000
011600             PERFORM 2200-UPDATE-DATA                             01160000
011700                                                                  01170000
011800        WHEN HO100-ACTN-TYP-DELETE                                01180000
011900             PERFORM 2400-CHECK-STR-GP                            01190000
012000             IF PS-PROCESS-CONTINUE                               01200000
012100                 PERFORM 2300-DELETE-DATA                         01210000
012200             END-IF                                               01220000
012300     END-EVALUATE.                                                01230000
012400                                                                  01240000
012500     MOVE SQLCODE TO PV-RETURN-CODE.                              01250000
012600                                                                  01260000
012700***************************************************************** 01270000
012800**INSERT ACTION TYPE                                              01280000
012900***************************************************************** 01290000
013000 2100-INSERT-DATA.                                                01300000
013100                                                                  01310000
013200     PERFORM                                                      01320003
013300         WITH TEST AFTER                                          01330003
013400         VARYING PV-RETRY-COUNTER                                 01340003
013500         FROM 1 BY 1                                              01350003
013600         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    01360003
013700            OR SQLCODE = 0                                        01370003
013800            OR PS-PROCESS-COMPLETE                                01380003
013900                                                                  01390003
014000         EXEC SQL                                                 01400003
014100             INSERT INTO XST_STR_GP_TYP                           01410003
014200                 (STR_GP_TYP_CDE                                  01420003
014300                , STR_GP_TYP_NM)                                  01430004
014400             VALUES (: XST00021-STR-GP-TYP-CDE                    01440003
014500                   , : XST00021-STR-GP-TYP-NM)                    01450004
014600         END-EXEC                                                 01460003
014700                                                                  01470000
014800         EVALUATE TRUE                                            01480003
014900             WHEN SQLCODE = -911                                  01490003
015000             WHEN SQLCODE = -913                                  01500003
015100             WHEN SQLCODE = 0                                     01510003
015200                 CONTINUE                                         01520003
015300             WHEN SQLWARN0 NOT = SPACE                            01530003
015400             WHEN SQLCODE NOT =  ZERO                             01540003
015500                 SET PS-PROCESS-COMPLETE TO TRUE                  01550003
015600         END-EVALUATE                                             01560003
015700     END-PERFORM.                                                 01570003
015800                                                                  01580003
015900     EVALUATE TRUE                                                01590000
016000        WHEN SQLCODE = -913                                       01600000
016100        WHEN SQLCODE = -911                                       01610000
016200             IF  PV-RETRY-COUNTER >= PC-RETRY-MAX                 01620000
016300                 SET PS-PROCESS-COMPLETE TO TRUE                  01630000
016400             ELSE                                                 01640000
016500                 ADD +1                  TO PV-RETRY-COUNTER      01650000
016600             END-IF                                               01660000
016700        WHEN OTHER                                                01670000
016800             SET PS-PROCESS-COMPLETE     TO TRUE                  01680000
016900     END-EVALUATE.                                                01690000
017000                                                                  01700000
017100******************************************************************01710000
017200**UPDATE ACTION TYPE                                              01720000
017300******************************************************************01730000
017400 2200-UPDATE-DATA.                                                01740000
017500                                                                  01750000
017600     PERFORM                                                      01760003
017700         WITH TEST AFTER                                          01770003
017800         VARYING PV-RETRY-COUNTER                                 01780003
017900         FROM 1 BY 1                                              01790003
018000         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    01800003
018100            OR SQLCODE = 0                                        01810003
018200            OR PS-PROCESS-COMPLETE                                01820003
018300                                                                  01830003
018400         EXEC SQL                                                 01840003
018500             UPDATE XST_STR_GP_TYP                                01850003
018600                SET STR_GP_TYP_NM = : XST00021-STR-GP-TYP-NM      01860004
018700              WHERE STR_GP_TYP_CDE = : XST00021-STR-GP-TYP-CDE    01870003
018800         END-EXEC                                                 01880003
018900                                                                  01890000
019000         EVALUATE TRUE                                            01900003
019100             WHEN SQLCODE = -911                                  01910003
019200             WHEN SQLCODE = -913                                  01920003
019300             WHEN SQLCODE = 0                                     01930003
019400                 CONTINUE                                         01940003
019500             WHEN SQLWARN0 NOT = SPACE                            01950003
019600             WHEN SQLCODE NOT =  ZERO                             01960003
019700                 SET PS-PROCESS-COMPLETE TO TRUE                  01970003
019800         END-EVALUATE                                             01980003
019900     END-PERFORM.                                                 01990003
020000                                                                  02000003
020100     EVALUATE TRUE                                                02010000
020200        WHEN SQLCODE = -911                                       02020000
020300             IF  PV-RETRY-COUNTER >= PC-RETRY-MAX                 02030000
020400                 SET PS-PROCESS-COMPLETE TO TRUE                  02040000
020500             ELSE                                                 02050000
020600                 ADD +1                  TO PV-RETRY-COUNTER      02060000
020700             END-IF                                               02070000
020800        WHEN OTHER                                                02080000
020900             SET PS-PROCESS-COMPLETE     TO TRUE                  02090000
021000     END-EVALUATE.                                                02100000
021100                                                                  02110000
021200******************************************************************02120000
021300**DELETE TYPE ACTION                                              02130000
021400******************************************************************02140000
021500 2300-DELETE-DATA.                                                02150000
021600                                                                  02160000
021700     PERFORM                                                      02170003
021800         WITH TEST AFTER                                          02180003
021900         VARYING PV-RETRY-COUNTER                                 02190003
022000         FROM 1 BY 1                                              02200003
022100         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    02210003
022200            OR SQLCODE = 0                                        02220003
022300            OR PS-PROCESS-COMPLETE                                02230003
022400                                                                  02240003
022500         EXEC SQL                                                 02250003
022600             DELETE FROM XST_STR_GP_TYP                           02260003
022700             WHERE STR_GP_TYP_CDE = : XST00021-STR-GP-TYP-CDE     02270003
022800         END-EXEC                                                 02280003
022900                                                                  02290000
023000         EVALUATE TRUE                                            02300003
023100             WHEN SQLCODE = -911                                  02310003
023200             WHEN SQLCODE = -913                                  02320003
023300             WHEN SQLCODE = 0                                     02330003
023400                 CONTINUE                                         02340003
023500             WHEN SQLWARN0 NOT = SPACE                            02350003
023600             WHEN SQLCODE NOT =  ZERO                             02360003
023700                 SET PS-PROCESS-COMPLETE TO TRUE                  02370003
023800         END-EVALUATE                                             02380003
023900     END-PERFORM.                                                 02390003
024000                                                                  02400003
024100     EVALUATE TRUE                                                02410000
024200        WHEN SQLCODE = -911                                       02420000
024300        WHEN SQLCODE = -913                                       02430000
024400             IF  PV-RETRY-COUNTER >= PC-RETRY-MAX                 02440000
024500                 SET PS-PROCESS-COMPLETE TO TRUE                  02450000
024600             ELSE                                                 02460000
024700                 ADD +1                  TO PV-RETRY-COUNTER      02470000
024800             END-IF                                               02480000
024900        WHEN OTHER                                                02490000
025000             SET PS-PROCESS-COMPLETE     TO TRUE                  02500000
025100     END-EVALUATE.                                                02510000
025200                                                                  02520000
025300* ------------------------------------------------------------- * 02530000
025400* READ XST_STR_GP TO BE SURE STR_GP_TYP IS NOT BEING USED BEFORE  02540000
025500*  DELETING THE ROW ON THE STR_GP_TYP TABLE.                      02550000
025600* ------------------------------------------------------------- * 02560000
025700 2400-CHECK-STR-GP.                                               02570000
025800                                                                  02580000
025900     EXEC SQL                                                     02590000
026000       SELECT 'Y'                                                 02600000
026100         INTO :PV-STR-GP-IND                                      02610000
026200         FROM XST_STR_GP                                          02620001
026300        WHERE  STR_GP_TYP_CDE = :XST00021-STR-GP-TYP-CDE          02630000
026400     END-EXEC                                                     02640000
026500                                                                  02650000
026600     EVALUATE TRUE                                                02660000
026700        WHEN SQLCODE = -911                                       02670000
026800        WHEN SQLCODE = -913                                       02680000
026900             IF  PV-RETRY-COUNTER >= PC-RETRY-MAX                 02690000
027000                 SET PS-PROCESS-COMPLETE TO TRUE                  02700000
027100             ELSE                                                 02710000
027200                 ADD +1                  TO PV-RETRY-COUNTER      02720000
027300             END-IF                                               02730000
027400        WHEN SQLCODE = +100                                       02740000
027500             CONTINUE                                             02750000
027600        WHEN SQLCODE = ZERO                                       02760000
027700             DISPLAY 'STR-GP-TYP ' HO100-PZG-STR-GP-TYP-CDE       02770000
027800             ' IN USE'                                            02780000
027900        WHEN OTHER                                                02790000
028000             SET PS-PROCESS-COMPLETE     TO TRUE                  02800000
028100     END-EVALUATE.                                                02810000
028200                                                                  02820000
028300******************************************************************02830000
028400**PASS SQLCODE TO CALLING AND EXIT PROGRAM                        02840000
028500******************************************************************02850000
028600 9999-WRAPUP.                                                     02860000
028700                                                                  02870000
028800     MOVE PV-RETURN-CODE TO LV-RETURN-CODE.                       02880000
028900                                                                  02890000
029000     EXIT PROGRAM.                                                02900000
