       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    INKUT206.                                         00020000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00030000
       DATE-WRITTEN.  01/29/2001.                                       00040000
       DATE-COMPILED.                                                   00050000
                                                                        00060000
      ***************************************************************** 00070000
      *PURPOSE:  THE PROGRAM READS A GENERIC SORTED INVENTORY ESTIMATED 00080000
      *        SHORTAGE FILE AND CONVERTS IT TO A .CSV, FORMAT. THE FILE00090000
      *        IS THEN PASSED TO THE LOSS CONTROL DEPARTMENT.           00100000
      *                                                                 00100100
W26600* WR/PROJ DATE       PROGAMMER    DESCRIPTION OF CHANGES          00100300
W26600* ------- ---------- ------------ --------------------------      00100400
W26600* W26600  04/01/2004 M.JOHNSON    STORE EXPANSION                 00100500
W20445* W20445  09-01-2004 ROD JANSSEN  DETAILED INVNENTORY ADJUSTMENT  00100600
W26006* W26006  02-24-2005 ERIN SEARL   REMOVE REFERENCES TO OBSOLETE   00100700
W26006*                                 STORE TABLE.                    00100800
 28545* W28545  08-10-2006 B. GRAHAM    FIX BAD TABLE NAME DISPLAY      00100901
 28545*                                 TO TINVPAR                      00101000
      ***************************************************************** 00110000
                                                                        00120000
       ENVIRONMENT DIVISION.                                            00130000
       CONFIGURATION SECTION.                                           00140000
       SOURCE-COMPUTER. IBM-3090.                                       00150000
       OBJECT-COMPUTER. IBM-3090.                                       00160000
       INPUT-OUTPUT SECTION.                                            00170000
       FILE-CONTROL.                                                    00180000
                                                                        00190000
           SELECT INPUT-FILE                                            00200000
               ASSIGN TO INP01.                                         00210000
                                                                        00220000
           SELECT OUTPUT-CSV-FILE                                       00230000
               ASSIGN TO OUT01.                                         00240000
                                                                        00250000
       DATA DIVISION.                                                   00260000
       FILE SECTION.                                                    00270000
                                                                        00280000
       FD  INPUT-FILE                                                   00290000
           LABEL RECORDS ARE STANDARD                                   00300000
           RECORDING MODE IS F                                          00310000
           DATA RECORD IS INPUT-RECORD.                                 00330000
                                                                        00340000
       01  INPUT-RECORD.                                                00350000
           05  IR-CODE.                                                 00360000
               10  IR-STORE-NMBR-ALPHA  PIC X(02)     VALUE SPACES.     00370000
               10  IR-THIRD-BYTE        PIC X(01)     VALUE SPACE.      00380000
           05  IR-DESCRIPTION           PIC X(20)     VALUE SPACES.     00390000
W26600     05  IR-BOOK-INV-RTL-AMT      PIC S9(13)V99 COMP-3 VALUE ZERO.00400000
W26600     05  IR-SLS-BSE-RTL-AMT       PIC S9(13)V99 COMP-3 VALUE ZERO.00410000
W26600     05  IR-SHNK-RTL-AMT          PIC S9(13)V99 COMP-3 VALUE ZERO.00420000
W26600     05  IR-TOTAL-BOOK-RTL-AMT    PIC S9(13)V99 COMP-3 VALUE ZERO.00430000
W26600     05  IR-PHY-INV-RTL-AMT       PIC S9(13)V99 COMP-3 VALUE ZERO.00440000
W26600     05  IR-SHORTAGE-RTL-AMT      PIC S9(13)V99 COMP-3 VALUE ZERO.00450000
W26600     05  IR-ESTIMATED-INV-ADJ-AMT PIC S9(13)V99 COMP-3 VALUE ZERO.00460000
W26600     05  FILLER                   PIC X(01).                      00461000
                                                                        00470000
       FD  OUTPUT-CSV-FILE                                              00480000
           LABEL RECORDS ARE STANDARD                                   00490000
           RECORDING MODE IS F                                          00500000
W26600*    RECORD CONTAINS 156 CHARACTERS                               00510000
           DATA RECORD IS OUTPUT-CSV-RECORD.                            00520000
                                                                        00530000
       01  OUTPUT-CSV-RECORD        PIC X(156).                         00540000
                                                                        00550000
      /**************************************************************** 00560000
       WORKING-STORAGE SECTION.                                         00570000
      ***************************************************************** 00580000
                                                                        00590000
       01  ABEND-CODE                  PIC S9(4) COMP SYNC VALUE ZERO.  00591000
                                                                        00593000
       01  PC-PROGRAM-CONSTANTS.                                        00600000
           05  PC-DPT                  PIC X(03) VALUE 'DPT'.           00610000
           05  PC-COMPANY              PIC X(02) VALUE '03'.            00620000
           05  PC-SUB                  PIC S9(05) COMP-3 VALUE ZEROS.   00630000
           05  PRIME-DC-SUB            PIC S9(05) COMP-3 VALUE ZEROS.   00640000
           05  STORE-SUB               PIC S9(05) COMP-3 VALUE ZEROS.   00650000
                                                                        00660000
       01  PS-PROGRAM-SWITCHES.                                         00670000
           05  PS-END-OF-DATA-SW           PIC X(01) VALUE 'N'.         00680000
               88  PS-END-OF-DATA                    VALUE 'Y'.         00690000
           05  PS-END-OF-XMTLOC-CURSOR-IND PIC X(01) VALUE 'N'.         00691000
               88  PS-END-OF-XMTLOC-CURSOR           VALUE 'Y'.         00693000
                                                                        00700000
       01  PV-PROGRAM-VARIABLES.                                        00710000
           05  PV-RECS-READ            PIC S9(9) COMP-3 VALUE ZEROS.    00720000
           05  PV-RECS-WRITTEN         PIC S9(9) COMP-3 VALUE ZEROS.    00730000
           05  PV-WORK-AMOUNT.                                          00740000
               10  PV-SIGN             PIC X(01).                       00750000
               10  PV-WA-DOLLARS       PIC 9(13).                       00760000
               10  PV-DECIMAL          PIC X(01).                       00770000
               10  PV-WA-CENTS         PIC 99.                          00780000
           05  PV-COMPUTE-AMOUNT       PIC S9(11)V99 COMP-3 VALUE ZEROS.00790000
           05  PV-EDIT-AMOUNT          PIC 9(13)V99.                    00800000
           05  FILLER REDEFINES PV-EDIT-AMOUNT.                         00810000
               10  PV-EDT-DOLLARS      PIC 9(13).                       00820000
               10  PV-EDT-CENTS        PIC 99.                          00830000
           05  PV-BK-INV-RTL-AMT-ACC   PIC S9(11)V99 COMP-3 VALUE ZEROS.00840000
           05  PV-SLS-BSE-RTL-AMT-ACC  PIC S9(11)V99 COMP-3 VALUE ZEROS.00850000
           05  PV-SHNK-RTL-AMT-ACC     PIC S9(11)V99 COMP-3 VALUE ZEROS.00860000
           05  PV-TOT-BOOK-RTL-AMT-ACC PIC S9(11)V99 COMP-3 VALUE ZEROS.00870000
           05  PV-PHY-INV-RTL-AMT-ACC  PIC S9(11)V99 COMP-3 VALUE ZEROS.00880000
           05  PV-SHRT-RTL-AMT-ACC     PIC S9(11)V99 COMP-3 VALUE ZEROS.00890000
           05  PV-EST-INV-ADJ-AMT-ACC  PIC S9(11)V99 COMP-3 VALUE ZEROS.00900000
           05  PV-STORE-NMBR-ALPHA     PIC X(02).                       00910000
           05  PV-STORE-NMBR-NUM REDEFINES                              00920000
               PV-STORE-NMBR-ALPHA     PIC S9(04) COMP.                 00930000
           05  PV-STORE-NMBR-EDIT      PIC 9(04).                       00931000
           05  FILLER REDEFINES PV-STORE-NMBR-EDIT.                     00931100
               10  PV-STORE-NMBR-EDIT-P1 PIC X(01).                     00932000
               10  PV-STORE-NMBR-EDIT-P2 PIC X(03).                     00933000
           05  PV-PARAGRAPH-NAME       PIC X(30)    VALUE SPACES.       00940000
           05  PV-DB2-OPERATION-ATTEMPTED                               00950000
                                       PIC X(30)    VALUE SPACES.       00951000
           05  PV-CURRENT-DATE.                                         00951100
W26600         10  PV-CD-CCYY.                                          00951200
W26600             15  PV-CD-CC        PIC 9(02)    VALUE ZERO.         00951300
W26600             15  PV-CD-YY        PIC 9(02)    VALUE ZERO.         00951400
               10  PV-CD-MM            PIC 9(02)    VALUE ZERO.         00951500
               10  PV-CD-DD            PIC 9(02)    VALUE ZERO.         00951600
           05  PV-CURRENT-DATE-DB2.                                     00952000
W26600         10  PV-CD-DB2-CCYY.                                      00952100
W26600             15  PV-CD-DB2-CC    PIC 9(02)    VALUE ZERO.         00953000
W26600             15  PV-CD-DB2-YY    PIC 9(02)    VALUE ZERO.         00954000
               10  FILLER              PIC X(01)    VALUE '-'.          00955000
               10  PV-CD-DB2-MM        PIC 9(02)    VALUE ZERO.         00956000
               10  FILLER              PIC X(01)    VALUE '-'.          00957000
               10  PV-CD-DB2-DD        PIC 9(02)    VALUE ZERO.         00958000
W26600     05  PV-EDIT-NMBR            PIC 9(04)    VALUE ZEROS.        00959000
W26600     05  PV-EDIT-LOC-NBR-ALPHA REDEFINES PV-EDIT-NMBR.            00959100
W26600         10  PV-EDIT-BYTE1       PIC X(01).                       00959200
W26600         10  PV-EDIT-DC-NBR-ALPHA                                 00959300
W26600                                 PIC X(03).                       00959400
                                                                        00960000
       01  PV-OUTPUT-CSV-RECORD.                                        00970000
W26600     05  PV-ER-CODE           PIC X(4)  VALUE '9999'.             00980000
           05  FILLER               PIC X     VALUE ','.                00990000
           05  PV-ER-DESCRIPTION    PIC X(20) VALUE ALL 'X'.            01000000
           05  FILLER               PIC X     VALUE ','.                01010000
           05  PV-BOOK-INV-RTL-AMT  PIC X(17) VALUE '00000000000000.00'.01020000
           05  FILLER               PIC X     VALUE ','.                01030000
           05  PV-SLS-BSE-RTL-AMT   PIC X(17) VALUE '00000000000000.00'.01040000
           05  FILLER               PIC X     VALUE ','.                01050000
           05  PV-SHNK-RTL-AMT      PIC X(17) VALUE '00000000000000.00'.01060000
           05  FILLER               PIC X     VALUE ','.                01061000
           05  PV-EST-INV-ADJ-AMT   PIC X(17) VALUE '00000000000000.00'.01062000
           05  FILLER               PIC X     VALUE ','.                01070000
           05  PV-TOT-BOOK-RTL-AMT  PIC X(17) VALUE '00000000000000.00'.01080000
           05  FILLER               PIC X     VALUE ','.                01090000
           05  PV-PHY-INV-RTL-AMT   PIC X(17) VALUE '00000000000000.00'.01100000
           05  FILLER               PIC X     VALUE ','.                01110000
           05  PV-SHORTAGE-RTL-AMT  PIC X(17) VALUE '00000000000000.00'.01120000
           05  FILLER               PIC X     VALUE ','.                01150000
W26600     05  PV-PRIME-DC          PIC X(04) VALUE ALL 'XXXX'.         01160000
                                                                        01170000
       01  WS-STORE-TABLE.                                              01180000
           05  WS-TABLE OCCURS 9999 TIMES.                              01190000
W26600         10  TBL-STORE-NMBR          PIC X(4).                    01200000
               10  TBL-CHAR5-NAME.                                      01210000
                   15 FILLER               PIC X(2).                    01220000
                   15 TBL-NAME-DASH        PIC X(1).                    01230000
                   15 TBL-CHAR2-NAME       PIC X(2).                    01240000
               10  FILLER REDEFINES TBL-CHAR5-NAME.                     01250000
                   15 FILLER               PIC X(2).                    01260000
                   15 TBL-CHAR2-NAME-OTH   PIC X(2).                    01270000
                   15 FILLER               PIC X(1).                    01280000
W26600         10  TBL-DC-NMBR             PIC X(4).                    01290000
                                                                        01300000
      ******************************************************************01310000
      *  DB2 ERROR MESSAGES FORMAT AREA.                                01320000
      ******************************************************************01330000
           COPY DPWS004.                                                01340000
                                                                        01350000
      ******************************************************************01360000
      *  USED FOR DB2 ERRORS                                            01370000
      ******************************************************************01380000
           EXEC SQL                                                     01390000
               INCLUDE SQLCA                                            01400000
           END-EXEC.                                                    01410000
                                                                        01420000
W26600******************************************************************01492000
W26600*  LAYOUT USED FOR XMT LOC (STORE) TABLE                          01493000
W26600******************************************************************01494000
W26600     EXEC SQL                                                     01495000
W26600         INCLUDE XMT00001                                         01496000
W26600     END-EXEC.                                                    01497000
                                                                        01498000
                                                                        01499000
W26600******************************************************************01499100
W26600*  LAYOUT USED FOR ???? TABLE                                     01499200
W26600******************************************************************01499300
W26600     EXEC SQL                                                     01499400
W26600         INCLUDE XMT00002                                         01499500
W26600     END-EXEC.                                                    01499600
                                                                        01499700
      ******************************************************************01500000
      *  SQL DB2 XMTLOC CURSOR DECLARATION                              01510000
      ******************************************************************01520000
W26600     EXEC SQL                                                     01530000
W26600       DECLARE XMTLOC_CSR CURSOR FOR                              01531000
W26600          SELECT X.LOC_NBR,                                       01540000
W26600                 X.LOC_5_ABBR_NM,                                 01550000
W26600                 X.CLO_DTE,                                       01560000
W26600                 DC_ASGMNT.DC_NBR,                                01570000
W26600                 DC_ASGMNT.PO_STRT_DTE                            01580000
W26600          FROM XMT_LOC X,                                         01590000
W26600          (SELECT A.LOC_NBR, A.DC_NBR, TEMP.PO_STRT_DTE           01600000
W26600              FROM XMT_DC_LOC_ASGMT A,                            01610000
W26600              (SELECT B.LOC_NBR, MAX(B.PO_STRT_DTE) AS PO_STRT_DTE01620000
W26600              FROM XMT_DC_LOC_ASGMT B                             01630000
W26600              GROUP BY B.LOC_NBR) TEMP                            01640000
W26600              WHERE A.LOC_NBR = TEMP.LOC_NBR                      01650000
W26600              AND A.PO_STRT_DTE = TEMP.PO_STRT_DTE) DC_ASGMNT     01651000
W26600          WHERE X.LOC_NBR = DC_ASGMNT.LOC_NBR                     01652000
W26600          AND X.LOC_TYP_CDE <> 'OP'                               01653000
W26600          ORDER BY LOC_NBR                                        01660000
W26600     END-EXEC.                                                    01660100
                                                                        01661000
      ***************************************************************** 01680000
      *FLOW:  SEQUENTIALLY READ THE "SORTED" INVENTORY  SHORTAGE FILE   01690000
      *     UNTIL END OF FILE. FORMAT EACH ROW INTO A TEXT BASED FORMAT.01700000
      *     THE SIGN IS PLACED IN COLUMN ONE FOR EACH NUMERIC FIELD.    01710000
      *     ALSO, PROVIDE A DECIMAL POSTION. WRITE A RECORD.            01720000
      *                                                                 01730000
      *       TOTAL ARE MAINTAINED FOR ALL NUMERIC COLUMNS. AT EOF,     01740000
      *     CREATE A TOTAL LINE FROM THE EXTRACT.                       01750000
      *                                                                 01760000
      ******************************************************************01770000
      ******************************************************************01780000
       PROCEDURE DIVISION.                                              01790000
      ******************************************************************01800000
                                                                        01810000
       0000-MAINLINE-INKUT206.                                          01820000
                                                                        01830000
           PERFORM 1000-INITIALIZATION                                  01840000
              THRU 1000-INITIALIZATION-EXIT.                            01850000
                                                                        01860000
           PERFORM 2000-MAIN-PROCESS                                    01870000
              THRU 2000-MAIN-PROCESS-EXIT                               01880000
                UNTIL PS-END-OF-DATA.                                   01890000
                                                                        01900000
           PERFORM 9900-EOJ-TASKS                                       01910000
              THRU 9900-EOJ-TASKS-EXIT.                                 01920000
                                                                        01930000
       9999-EXIT-PROGRAM.                                               01940000
           STOP RUN.                                                    01950000
                                                                        01960000
      /*****************************************************************01970000
      * 1000-INITIALIZATION....                                         01980000
      ******************************************************************01990000
       1000-INITIALIZATION.                                             02000000
                                                                        02010000
           OPEN INPUT  INPUT-FILE                                       02020000
                OUTPUT OUTPUT-CSV-FILE.                                 02030000
                                                                        02040000
           INITIALIZE INPUT-RECORD                                      02050000
                      WS-STORE-TABLE                                    02060000
                      OUTPUT-CSV-RECORD.                                02070000
                                                                        02080000
W26600     ACCEPT PV-CURRENT-DATE FROM DATE YYYYMMDD.                   02081000
W26600     MOVE PV-CD-CCYY TO PV-CD-DB2-CCYY.                           02082000
           MOVE PV-CD-MM TO PV-CD-DB2-MM.                               02083000
           MOVE PV-CD-DD TO PV-CD-DB2-DD.                               02084000
                                                                        02089100
           DISPLAY 'CURRENT DATE: ' PV-CURRENT-DATE-DB2                 02089200
           MOVE ZEROS          TO PV-RECS-READ                          02090000
                                  PV-RECS-WRITTEN.                      02100000
           MOVE 'N'            TO PS-END-OF-DATA-SW.                    02110000
                                                                        02120000
           PERFORM 9100-OPEN-CURSOR                                     02130000
              THRU 9100-OPEN-CURSOR-EXIT.                               02140000
                                                                        02150000
           PERFORM 3100-PROCESS-XMTLOC-CSR                              02160000
              THRU 3100-PROCESS-XMTLOC-CSR-EXIT.                        02170000
                                                                        02180000
           PERFORM 9200-CLOSE-CURSOR                                    02190000
              THRU 9200-CLOSE-CURSOR-EXIT.                              02200000
                                                                        02210000
       1000-INITIALIZATION-EXIT.                                        02220000
           EXIT.                                                        02230000
                                                                        02240000
      /*****************************************************************02250000
      * 2000-MAIN PROCESS LOOP.                                         02260000
      ******************************************************************02270000
       2000-MAIN-PROCESS.                                               02280000
                                                                        02290000
           PERFORM 9000-READ-INPUT-FILE                                 02300000
              THRU 9000-READ-INPUT-FILE-EXIT.                           02310000
           IF PS-END-OF-DATA                                            02320000
               GO TO 2000-MAIN-PROCESS-EXIT.                            02330000
                                                                        02340000
           ADD 1                    TO PV-RECS-READ.                    02350000
                                                                        02360000
      *** FORMAT THE .CSV FILE...                                       02370000
                                                                        02380000
           IF IR-THIRD-BYTE IS EQUAL TO SPACE                           02390000
               MOVE IR-STORE-NMBR-ALPHA   TO PV-STORE-NMBR-ALPHA        02400000
               MOVE PV-STORE-NMBR-NUM     TO PV-STORE-NMBR-EDIT         02401000
               MOVE PV-STORE-NMBR-EDIT-P2 TO PV-ER-CODE                 02402000
           ELSE                                                         02420000
               MOVE IR-CODE             TO PV-ER-CODE.                  02430000
                                                                        02440000
           MOVE IR-DESCRIPTION      TO PV-ER-DESCRIPTION.               02450000
                                                                        02460000
      *** FORMAT THE BOOKED INVENTORY RETAIL AMOUNT.                    02470000
                                                                        02480000
           MOVE IR-BOOK-INV-RTL-AMT TO PV-COMPUTE-AMOUNT                02490000
                                          PV-EDIT-AMOUNT.               02500000
                                                                        02510000
           IF PV-COMPUTE-AMOUNT IS LESS THAN ZERO                       02520000
               MOVE '-'             TO PV-SIGN                          02530000
           ELSE                                                         02540000
               MOVE '0'             TO PV-SIGN                          02550000
           END-IF.                                                      02560000
                                                                        02570000
           MOVE PV-EDT-DOLLARS      TO PV-WA-DOLLARS.                   02580000
           MOVE '.'                 TO PV-DECIMAL.                      02590000
           MOVE PV-EDT-CENTS        TO PV-WA-CENTS.                     02600000
           MOVE PV-WORK-AMOUNT      TO PV-BOOK-INV-RTL-AMT.             02610000
                                                                        02620000
           ADD IR-BOOK-INV-RTL-AMT TO PV-BK-INV-RTL-AMT-ACC.            02630000
                                                                        02640000
      *** FORMAT THE SALES BASE RETAIL AMOUNT.....                      02650000
                                                                        02660000
           MOVE IR-SLS-BSE-RTL-AMT TO PV-COMPUTE-AMOUNT                 02670000
                                         PV-EDIT-AMOUNT.                02680000
                                                                        02690000
           IF PV-COMPUTE-AMOUNT IS LESS THAN ZERO                       02700000
               MOVE '-'             TO PV-SIGN                          02710000
           ELSE                                                         02720000
               MOVE '0'             TO PV-SIGN                          02730000
           END-IF.                                                      02740000
                                                                        02750000
           MOVE PV-EDT-DOLLARS      TO PV-WA-DOLLARS.                   02760000
           MOVE '.'                 TO PV-DECIMAL.                      02770000
           MOVE PV-EDT-CENTS        TO PV-WA-CENTS.                     02780000
           MOVE PV-WORK-AMOUNT      TO PV-SLS-BSE-RTL-AMT.              02790000
                                                                        02800000
           ADD IR-SLS-BSE-RTL-AMT TO PV-SLS-BSE-RTL-AMT-ACC.            02810000
                                                                        02820000
      *** FORMAT THE SHRINK RETAIL AMOUNT.....                          02830000
                                                                        02840000
           MOVE IR-SHNK-RTL-AMT     TO PV-COMPUTE-AMOUNT                02850000
                                       PV-EDIT-AMOUNT.                  02860000
                                                                        02870000
           IF PV-COMPUTE-AMOUNT IS LESS THAN ZERO                       02880000
               MOVE '-'             TO PV-SIGN                          02890000
           ELSE                                                         02900000
               MOVE '0'             TO PV-SIGN                          02910000
           END-IF.                                                      02920000
                                                                        02930000
           MOVE PV-EDT-DOLLARS      TO PV-WA-DOLLARS.                   02940000
           MOVE '.'                 TO PV-DECIMAL.                      02950000
           MOVE PV-EDT-CENTS        TO PV-WA-CENTS.                     02960000
           MOVE PV-WORK-AMOUNT      TO PV-SHNK-RTL-AMT.                 02970000
                                                                        02980000
           ADD IR-SHNK-RTL-AMT      TO PV-SHNK-RTL-AMT-ACC.             02990000
                                                                        03000000
      *** FORMAT THE TOTAL BOOK RETAIL AMOUNT.....                      03010000
                                                                        03020000
           MOVE IR-TOTAL-BOOK-RTL-AMT TO PV-COMPUTE-AMOUNT              03030000
                                       PV-EDIT-AMOUNT.                  03040000
                                                                        03050000
           IF PV-COMPUTE-AMOUNT IS LESS THAN ZERO                       03060000
               MOVE '-'             TO PV-SIGN                          03070000
           ELSE                                                         03080000
               MOVE '0'             TO PV-SIGN                          03090000
           END-IF.                                                      03100000
                                                                        03110000
           MOVE PV-EDT-DOLLARS      TO PV-WA-DOLLARS.                   03120000
           MOVE '.'                 TO PV-DECIMAL.                      03130000
           MOVE PV-EDT-CENTS        TO PV-WA-CENTS.                     03140000
           MOVE PV-WORK-AMOUNT      TO PV-TOT-BOOK-RTL-AMT.             03150000
                                                                        03160000
           ADD IR-TOTAL-BOOK-RTL-AMT                                    03170000
                                    TO PV-TOT-BOOK-RTL-AMT-ACC.         03180000
                                                                        03190000
      *** FORMAT THE PHYSICAL INVENTORY RETAIL AMOUNT....               03200000
                                                                        03210000
           MOVE IR-PHY-INV-RTL-AMT TO PV-COMPUTE-AMOUNT                 03220000
                                         PV-EDIT-AMOUNT.                03230000
                                                                        03240000
           IF PV-COMPUTE-AMOUNT IS LESS THAN ZERO                       03250000
               MOVE '-'             TO PV-SIGN                          03260000
           ELSE                                                         03270000
               MOVE '0'             TO PV-SIGN                          03280000
           END-IF.                                                      03290000
                                                                        03300000
           MOVE PV-EDT-DOLLARS      TO PV-WA-DOLLARS.                   03310000
           MOVE '.'                 TO PV-DECIMAL.                      03320000
           MOVE PV-EDT-CENTS        TO PV-WA-CENTS.                     03330000
           MOVE PV-WORK-AMOUNT      TO PV-PHY-INV-RTL-AMT.              03340000
                                                                        03350000
           ADD IR-PHY-INV-RTL-AMT TO PV-PHY-INV-RTL-AMT-ACC.            03360000
                                                                        03370000
      *** FORMAT THE SHORTAGE RETAIL AMOUNT....                         03380000
                                                                        03390000
           MOVE IR-SHORTAGE-RTL-AMT TO PV-COMPUTE-AMOUNT                03400000
                                          PV-EDIT-AMOUNT.               03410000
                                                                        03420000
           IF PV-COMPUTE-AMOUNT IS LESS THAN ZERO                       03430000
               MOVE '-'             TO PV-SIGN                          03440000
           ELSE                                                         03450000
               MOVE '0'             TO PV-SIGN                          03460000
           END-IF.                                                      03470000
                                                                        03480000
           MOVE PV-EDT-DOLLARS      TO PV-WA-DOLLARS.                   03490000
           MOVE '.'                 TO PV-DECIMAL.                      03500000
           MOVE PV-EDT-CENTS        TO PV-WA-CENTS.                     03510000
           MOVE PV-WORK-AMOUNT      TO PV-SHORTAGE-RTL-AMT.             03520000
                                                                        03530000
           ADD IR-SHORTAGE-RTL-AMT  TO PV-SHRT-RTL-AMT-ACC.             03540000
                                                                        03550000
      *** FORMAT THE ESTIMATED INVENTORY ADJUSTMENT AMOUNT....          03560000
                                                                        03570000
           MOVE IR-ESTIMATED-INV-ADJ-AMT TO PV-COMPUTE-AMOUNT           03580000
                                               PV-EDIT-AMOUNT.          03590000
                                                                        03600000
           IF PV-COMPUTE-AMOUNT IS LESS THAN ZERO                       03610000
               MOVE '-'             TO PV-SIGN                          03620000
           ELSE                                                         03630000
               MOVE '0'             TO PV-SIGN                          03640000
           END-IF.                                                      03650000
                                                                        03660000
           MOVE PV-EDT-DOLLARS      TO PV-WA-DOLLARS.                   03670000
           MOVE '.'                 TO PV-DECIMAL.                      03680000
           MOVE PV-EDT-CENTS        TO PV-WA-CENTS.                     03690000
           MOVE PV-WORK-AMOUNT      TO PV-EST-INV-ADJ-AMT.              03700000
                                                                        03710000
           ADD IR-ESTIMATED-INV-ADJ-AMT                                 03720000
                                    TO PV-EST-INV-ADJ-AMT-ACC.          03730000
                                                                        03740000
      *** FORMAT THE PRIMARY DC LOCATION, ONLY IF WE ARE DEALING WITH   03750000
      *** A STORE....                                                   03760000
                                                                        03770000
           IF IR-THIRD-BYTE IS EQUAL TO SPACE                           03771000
               PERFORM 3000-GET-PRIMARY-DC                              03780000
                  THRU 3000-GET-PRIMARY-DC-EXIT                         03790000
           ELSE                                                         03791000
               MOVE SPACE           TO PV-PRIME-DC.                     03792000
                                                                        03800000
      *** WRITE THE RECORD....                                          03810000
                                                                        03820000
           WRITE OUTPUT-CSV-RECORD  FROM PV-OUTPUT-CSV-RECORD.          03830000
           ADD 1                    TO PV-RECS-WRITTEN.                 03840000
                                                                        03850000
       2000-MAIN-PROCESS-EXIT.                                          03860000
           EXIT.                                                        03870000
                                                                        03880000
      /*****************************************************************03890000
      * 3000-GET THE PRIMARY DC FOR THE STORE.....                      03900000
      ******************************************************************03910000
       3000-GET-PRIMARY-DC.                                             03920000
                                                                        03930000
           MOVE IR-STORE-NMBR-ALPHA TO PV-STORE-NMBR-ALPHA.             03931000
           MOVE PV-STORE-NMBR-NUM   TO STORE-SUB.                       03932000
                                                                        03933000
           IF TBL-STORE-NMBR(STORE-SUB) IS EQUAL TO SPACES              03960000
               MOVE 'NA' TO PV-PRIME-DC                                 03970000
           ELSE                                                         03980000
           IF TBL-DC-NMBR(STORE-SUB) IS NUMERIC                         03990000
               MOVE TBL-DC-NMBR(STORE-SUB) TO PRIME-DC-SUB              04000000
               IF TBL-NAME-DASH(PRIME-DC-SUB) IS EQUAL TO '-'           04010000
                   MOVE TBL-CHAR2-NAME(PRIME-DC-SUB) TO PV-PRIME-DC     04020000
               ELSE                                                     04040000
                   MOVE TBL-CHAR2-NAME-OTH(PRIME-DC-SUB) TO PV-PRIME-DC 04050000
               END-IF                                                   04070000
           ELSE                                                         04080000
               MOVE 'NA' TO PV-PRIME-DC                                 04090000
           END-IF.                                                      04100000
                                                                        04140000
       3000-GET-PRIMARY-DC-EXIT.                                        04150000
           EXIT.                                                        04160000
                                                                        04170000
      /*****************************************************************04180000
      * 3100-PROCESS THE STORE TABLE CURSOR, LOAD STORE DC INFORMATION. 04190000
      ******************************************************************04200000
       3100-PROCESS-XMTLOC-CSR.                                         04210000
                                                                        04220000
           PERFORM 9300-FETCH-XMTLOC-TABLE                              04230000
              THRU 9300-FETCH-XMTLOC-TABLE-EXIT.                        04240000
                                                                        04250000
           PERFORM 3200-LOAD-WS-STORE-TABLE                             04260000
              THRU 3200-LOAD-WS-STORE-TABLE-EXIT                        04261000
                  UNTIL PS-END-OF-XMTLOC-CURSOR.                        04270000
                                                                        04290000
       3100-PROCESS-XMTLOC-CSR-EXIT.                                    04291000
           EXIT.                                                        04291100
                                                                        04292000
      ******************************************************************04300000
      *  LOAD THE STORE DATA INTO THE WORKING STORAGE TABLE             04310000
      *  WHEN DETERMINE WHICH DC TO USES (DC1 OR DC2), MUST LOCK        04320000
      *  AT THE PO-START-DATE.                                          04330000
      ******************************************************************04340000
       3200-LOAD-WS-STORE-TABLE.                                        04360000
                                                                        04361000
W26600     MOVE XMT00001-LOC-NBR        TO PC-SUB.                      04370000
W26600     MOVE XMT00001-LOC-NBR        TO TBL-STORE-NMBR(PC-SUB).      04390000
W26600     MOVE XMT00001-LOC-5-ABBR-NM  TO TBL-CHAR5-NAME(PC-SUB).      04400000
                                                                        04410000
W26600     IF XMT00002-DC-NBR > ZERO                                    04420000
W26600         IF PV-CURRENT-DATE-DB2 > XMT00002-PO-STRT-DTE            04430000
W26600             MOVE XMT00002-DC-NBR     TO TBL-DC-NMBR(PC-SUB)      04460000
W26600         ELSE                                                     04520000
W26600             DISPLAY '************************************'       04530000
W26600             DISPLAY 'FOR STORE ' XMT00001-LOC-NBR                04540000
W26600             DISPLAY 'STRT DTE ' XMT00002-PO-STRT-DTE             04550000
W26600             DISPLAY 'CLOSED DATE ' XMT00001-CLO-DTE              04590000
W26600             DISPLAY '************************************'       04600000
W26600             MOVE SPACE               TO TBL-DC-NMBR(PC-SUB)      04610000
W26600         END-IF                                                   04620000
W26600     ELSE                                                         04640000
W26600         MOVE XMT00002-DC-NBR         TO TBL-DC-NMBR(PC-SUB)      04650000
W26600     END-IF.                                                      04660000
                                                                        04670000
           PERFORM 9300-FETCH-XMTLOC-TABLE                              04671000
              THRU 9300-FETCH-XMTLOC-TABLE-EXIT.                        04672000
                                                                        04680000
       3200-LOAD-WS-STORE-TABLE-EXIT.                                   04690000
           EXIT.                                                        04700000
                                                                        04710000
      /*****************************************************************04720000
      * 8000-GENERATE A TOTAL LINE FOR THE .CSV FILE.                   04730000
      ******************************************************************04740000
       8000-GEN-TOTAL-LINE.                                             04750000
                                                                        04760000
           ADD 1                    TO PV-RECS-READ.                    04770000
                                                                        04780000
      *** FORMAT THE .CSV FILE...                                       04790000
                                                                        04800000
           MOVE SPACES                 TO PV-ER-CODE.                   04810000
           MOVE 'COMPANY TOTALS:'      TO PV-ER-DESCRIPTION.            04820000
                                                                        04830000
      *** FORMAT THE BOOKED INVENTORY RETAIL AMOUNT.                    04840000
                                                                        04850000
           MOVE PV-BK-INV-RTL-AMT-ACC TO PV-COMPUTE-AMOUNT              04860000
                                         PV-EDIT-AMOUNT.                04870000
                                                                        04880000
           IF PV-COMPUTE-AMOUNT IS LESS THAN ZERO                       04890000
               MOVE '-'             TO PV-SIGN                          04900000
           ELSE                                                         04910000
               MOVE '0'             TO PV-SIGN                          04920000
           END-IF.                                                      04930000
                                                                        04940000
           MOVE PV-EDT-DOLLARS      TO PV-WA-DOLLARS.                   04950000
           MOVE '.'                 TO PV-DECIMAL.                      04960000
           MOVE PV-EDT-CENTS        TO PV-WA-CENTS.                     04970000
           MOVE PV-WORK-AMOUNT      TO PV-BOOK-INV-RTL-AMT.             04980000
                                                                        04990000
      *** FORMAT THE SALES BASE RETAIL AMOUNT.....                      05000000
                                                                        05010000
           MOVE PV-SLS-BSE-RTL-AMT-ACC TO PV-COMPUTE-AMOUNT             05020000
                                          PV-EDIT-AMOUNT.               05030000
                                                                        05040000
           IF PV-COMPUTE-AMOUNT IS LESS THAN ZERO                       05050000
               MOVE '-'             TO PV-SIGN                          05060000
           ELSE                                                         05070000
               MOVE '0'             TO PV-SIGN                          05080000
           END-IF.                                                      05090000
                                                                        05100000
           MOVE PV-EDT-DOLLARS      TO PV-WA-DOLLARS.                   05110000
           MOVE '.'                 TO PV-DECIMAL.                      05120000
           MOVE PV-EDT-CENTS        TO PV-WA-CENTS.                     05130000
           MOVE PV-WORK-AMOUNT      TO PV-SLS-BSE-RTL-AMT.              05140000
                                                                        05150000
      *** FORMAT THE SHRINK RETAIL AMOUNT.....                          05160000
                                                                        05170000
           MOVE PV-SHNK-RTL-AMT-ACC TO PV-COMPUTE-AMOUNT                05180000
                                       PV-EDIT-AMOUNT.                  05190000
                                                                        05200000
           IF PV-COMPUTE-AMOUNT IS LESS THAN ZERO                       05210000
               MOVE '-'             TO PV-SIGN                          05220000
           ELSE                                                         05230000
               MOVE '0'             TO PV-SIGN                          05240000
           END-IF.                                                      05250000
                                                                        05260000
           MOVE PV-EDT-DOLLARS      TO PV-WA-DOLLARS.                   05270000
           MOVE '.'                 TO PV-DECIMAL.                      05280000
           MOVE PV-EDT-CENTS        TO PV-WA-CENTS.                     05290000
           MOVE PV-WORK-AMOUNT      TO PV-SHNK-RTL-AMT.                 05300000
                                                                        05310000
      *** FORMAT THE TOTAL BOOK RETAIL AMOUNT.....                      05320000
                                                                        05330000
           MOVE PV-TOT-BOOK-RTL-AMT-ACC TO PV-COMPUTE-AMOUNT            05340000
                                           PV-EDIT-AMOUNT.              05350000
                                                                        05360000
           IF PV-COMPUTE-AMOUNT IS LESS THAN ZERO                       05370000
               MOVE '-'             TO PV-SIGN                          05380000
           ELSE                                                         05390000
               MOVE '0'             TO PV-SIGN                          05400000
           END-IF.                                                      05410000
                                                                        05420000
           MOVE PV-EDT-DOLLARS      TO PV-WA-DOLLARS.                   05430000
           MOVE '.'                 TO PV-DECIMAL.                      05440000
           MOVE PV-EDT-CENTS        TO PV-WA-CENTS.                     05450000
           MOVE PV-WORK-AMOUNT      TO PV-TOT-BOOK-RTL-AMT.             05460000
                                                                        05470000
      *** FORMAT THE PHYSICAL INVENTORY RETAIL AMOUNT....               05480000
                                                                        05490000
           MOVE PV-PHY-INV-RTL-AMT-ACC  TO PV-COMPUTE-AMOUNT            05500000
                                           PV-EDIT-AMOUNT.              05510000
                                                                        05520000
           IF PV-COMPUTE-AMOUNT IS LESS THAN ZERO                       05530000
               MOVE '-'             TO PV-SIGN                          05540000
           ELSE                                                         05550000
               MOVE '0'             TO PV-SIGN                          05560000
           END-IF.                                                      05570000
                                                                        05580000
           MOVE PV-EDT-DOLLARS      TO PV-WA-DOLLARS.                   05590000
           MOVE '.'                 TO PV-DECIMAL.                      05600000
           MOVE PV-EDT-CENTS        TO PV-WA-CENTS.                     05610000
           MOVE PV-WORK-AMOUNT      TO PV-PHY-INV-RTL-AMT.              05620000
                                                                        05630000
      *** FORMAT THE SHORTAGE RETAIL AMOUNT....                         05640000
                                                                        05650000
           MOVE  PV-SHRT-RTL-AMT-ACC TO PV-COMPUTE-AMOUNT               05660000
                                        PV-EDIT-AMOUNT.                 05670000
                                                                        05680000
           IF PV-COMPUTE-AMOUNT IS LESS THAN ZERO                       05690000
               MOVE '-'             TO PV-SIGN                          05700000
           ELSE                                                         05710000
               MOVE '0'             TO PV-SIGN                          05720000
           END-IF.                                                      05730000
                                                                        05740000
           MOVE PV-EDT-DOLLARS      TO PV-WA-DOLLARS.                   05750000
           MOVE '.'                 TO PV-DECIMAL.                      05760000
           MOVE PV-EDT-CENTS        TO PV-WA-CENTS.                     05770000
           MOVE PV-WORK-AMOUNT      TO PV-SHORTAGE-RTL-AMT.             05780000
                                                                        05790000
      *** FORMAT THE ESTIMATED INVENTORY ADJUSTMENT AMOUNT....          05800000
                                                                        05810000
           MOVE PV-EST-INV-ADJ-AMT-ACC TO PV-COMPUTE-AMOUNT             05820000
                                          PV-EDIT-AMOUNT.               05830000
                                                                        05840000
           IF PV-COMPUTE-AMOUNT IS LESS THAN ZERO                       05850000
               MOVE '-'             TO PV-SIGN                          05860000
           ELSE                                                         05870000
               MOVE '0'             TO PV-SIGN                          05880000
           END-IF.                                                      05890000
                                                                        05900000
           MOVE PV-EDT-DOLLARS      TO PV-WA-DOLLARS.                   05910000
           MOVE '.'                 TO PV-DECIMAL.                      05920000
           MOVE PV-EDT-CENTS        TO PV-WA-CENTS.                     05930000
           MOVE PV-WORK-AMOUNT      TO PV-EST-INV-ADJ-AMT.              05940000
                                                                        05950000
      *** WRITE THE RECORD....                                          05960000
                                                                        05970000
           MOVE SPACES              TO PV-PRIME-DC.                     05971000
                                                                        05972000
           WRITE OUTPUT-CSV-RECORD  FROM PV-OUTPUT-CSV-RECORD.          05980000
           ADD 1                    TO PV-RECS-WRITTEN.                 05990000
                                                                        06000000
       8000-GEN-TOTAL-LINE-EXIT.                                        06010000
           EXIT.                                                        06020000
                                                                        06030000
      /*****************************************************************06040000
      * 9000-READ THE SORTED INVENTORY SHORTAGES FILE.                  06050000
      ******************************************************************06060000
       9000-READ-INPUT-FILE.                                            06070000
                                                                        06080000
           READ INPUT-FILE NEXT                                         06090000
               AT END  MOVE 'Y' TO PS-END-OF-DATA-SW.                   06100000
                                                                        06110000
       9000-READ-INPUT-FILE-EXIT.                                       06120000
           EXIT.                                                        06130000
                                                                        06140000
      ******************************************************************06150000
      * 9100-OPEN THE STORE TABLE CURSOR.                               06160000
      ******************************************************************06170000
       9100-OPEN-CURSOR.                                                06180000
                                                                        06190000
           EXEC SQL                                                     06200000
               OPEN XMTLOC_CSR                                          06210000
           END-EXEC.                                                    06220000
                                                                        06230000
           EVALUATE SQLCODE                                             06240000
               WHEN +0                                                  06250000
                   CONTINUE                                             06260000
               WHEN OTHER                                               06270000
                   MOVE 'OPEN XMTLOC CURSOR' TO                         06280000
                       PV-DB2-OPERATION-ATTEMPTED                       06290000
                   PERFORM 9999-SQL-ABEND                               06300000
           END-EVALUATE.                                                06310000
                                                                        06320000
       9100-OPEN-CURSOR-EXIT.                                           06330000
           EXIT.                                                        06340000
                                                                        06350000
      ******************************************************************06360000
      * 9100-CLOSE THE STORE TABLE CURSOR.                              06370000
      ******************************************************************06380000
       9200-CLOSE-CURSOR.                                               06390000
                                                                        06400000
           EXEC SQL                                                     06410000
               CLOSE XMTLOC_CSR                                         06420000
           END-EXEC.                                                    06430000
                                                                        06440000
           EVALUATE SQLCODE                                             06450000
               WHEN +0                                                  06460000
                   CONTINUE                                             06470000
               WHEN OTHER                                               06480000
28545              MOVE 'CLOSE XMTLOC  CURSOR' TO                       06490000
                       PV-DB2-OPERATION-ATTEMPTED                       06500000
                   PERFORM 9999-SQL-ABEND                               06510000
           END-EVALUATE.                                                06520000
                                                                        06530000
       9200-CLOSE-CURSOR-EXIT.                                          06540000
           EXIT.                                                        06550000
                                                                        06560000
      ******************************************************************06570000
      * 9300-FETCH A STORE TABLE CURSOR ROW.                            06580000
      ******************************************************************06590000
       9300-FETCH-XMTLOC-TABLE.                                         06610000
                                                                        06620000
W26600     EXEC SQL                                                     06630000
W26600         FETCH XMTLOC_CSR                                         06640000
W26600         INTO :XMT00001-LOC-NBR,                                  06650000
W26600              :XMT00001-LOC-5-ABBR-NM,                            06660000
W26600              :XMT00001-CLO-DTE,                                  06670000
W26600              :XMT00002-DC-NBR,                                   06680000
W26600              :XMT00002-PO-STRT-DTE                               06690000
W26600     END-EXEC.                                                    06740000
                                                                        06741000
           EVALUATE SQLCODE                                             06760000
               WHEN +0                                                  06770000
                   CONTINUE                                             06780000
               WHEN +100                                                06790000
                   SET PS-END-OF-XMTLOC-CURSOR TO TRUE                  06800000
               WHEN OTHER                                               06810000
                   MOVE '9300-FETCH-XMTLOC-TABLE'                       06820000
                       TO PV-PARAGRAPH-NAME                             06830000
                   MOVE 'FETCH XMTLOC RECORD' TO                        06840000
                       PV-DB2-OPERATION-ATTEMPTED                       06850000
                   PERFORM 9999-SQL-ABEND                               06860000
           END-EVALUATE.                                                06870000
                                                                        06880000
       9300-FETCH-XMTLOC-TABLE-EXIT.                                    06881000
           EXIT.                                                        06881100
                                                                        06882000
      ******************************************************************06890000
      * 9900-END OF JOB TASKS.                                          06900000
      ******************************************************************06910000
       9900-EOJ-TASKS.                                                  06920000
                                                                        06930000
           PERFORM 8000-GEN-TOTAL-LINE                                  06940000
              THRU 8000-GEN-TOTAL-LINE-EXIT.                            06950000
                                                                        06960000
           DISPLAY SPACES.                                              06970000
           DISPLAY '*--------------------------------------------*'.    06980000
           DISPLAY '*                                            *'.    06990000
           DISPLAY '*         **INKUT206 COUNTS**                *'.    07000000
           DISPLAY '* '                                                 07010000
                   PV-RECS-READ                                         07020000
                   ' SHORTAGE RECORDS READ            *'.               07030000
           DISPLAY '* '                                                 07040000
                   PV-RECS-WRITTEN                                      07050000
                   ' RECORDS WRITTEN TO .CSV FILE     *'.               07060000
           DISPLAY '*                                            *'.    07070000
           DISPLAY '*--------------------------------------------*'.    07080000
                                                                        07090000
           CLOSE INPUT-FILE                                             07100000
                 OUTPUT-CSV-FILE.                                       07110000
                                                                        07120000
       9900-EOJ-TASKS-EXIT.                                             07130000
           EXIT.                                                        07140000
                                                                        07150000
      ******************************************************************07160000
      * 9999-SQL-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      07170000
      * EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 07180000
      ******************************************************************07190000
       9999-SQL-ABEND.                                                  07200000
                                                                        07210000
           DISPLAY '** ABEND     **'.                                   07220000
           DISPLAY '** PROGRAM   ** = INKUT206'.                        07230000
           DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              07240000
           DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     07250000
                                                                        07260000
      ******************************************************************07270000
      * THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    07280000
      * MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         07290000
      * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     07300000
      * FORMAT.                                                         07310000
      ******************************************************************07320000
           COPY DPPD004.                                                07330000
                                                                        07340000
           MOVE +4013 TO ABEND-CODE.                                    07350000
           CALL 'ILBOABN0' USING ABEND-CODE.                            07360000
                                                                        07370000
