      *-----------------------*                                         00010000
       IDENTIFICATION DIVISION.                                         00020000
      *-----------------------*                                         00030000
       PROGRAM-ID.    TFKCS439.                                         00040000
       AUTHOR.        JACK KRAMER.                                      00050000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
       DATE-WRITTEN.  APRIL 1997.                                       00070000
       DATE-COMPILED.                                                   00080000
                                                                        00090000
      *---------------------------------------------------------------* 00100000
      *    P439 - TRANSFER LINE REVERSAL COMMENTS INWUIRY.            * 00110000
      *                                                               * 00120000
      *    THIS PROGRAM DISPLAYS COMMENTS FOR AUTOMATIC OR MANUAL     * 00130000
      *    REVERSALS OF POSTING ADJUSTMENTS.                          * 00140000
      *                                                               * 00150000
      *---------------------------------------------------------------* 00160000
      ***************************************************************** 00161000
100404**DATE:10/04/2004 CHANGED BY: RAY GRAF                            00162000
100404*      EXPAND STORE NUMBER. MAKE DOMAIN COMPLIANT.                00163000
      ***************************************************************** 00164000
SR3403**DATE:02/29/2012 CHANGED BY: JALAJ KUMAR                         00165000
SR3403*      EXPAND AMOUNT FIELD FROM 4 DIGIT TO 5 DIGITS               00166000
      ***************************************************************** 00167000
CICS  * CHANGED 11/17/2022    BY JIM HUNTER      WR: CHG0278345         00168001
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00169001
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00169101
CICS  *-----------------------------------------------------------------00169201
       EJECT                                                            00170000
       ENVIRONMENT DIVISION.                                            00180000
                                                                        00190000
       DATA DIVISION.                                                   00200000
                                                                        00210000
       WORKING-STORAGE SECTION.                                         00220000
                                                                        00230000
       01  DK-DB2-KEYS.                                                 00240000
           05  DK-XFER-DKEY-ID                PIC S9(09)  COMP.         00250000
           05  DK-XFER-LNE-NBR                PIC S9(04)  COMP.         00260000
           05  DK-PSTG-SEQ-NBR                PIC S9(04)  COMP.         00270000
           05  DK-STORE-NBR                   PIC S9(04)  COMP.         00280000
                                                                        00290000
       01  PC-PROGRAM-CONSTANTS.                                        00300000
           05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00310000
                                                          'TF439A  '.   00320000
           05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00330000
                                                          'TFKM439 '.   00340000
           05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00350000
                                                          'TFKCS439'.   00360000
           05  PC-DISPLAY-FORMAT              PIC  X(01)  VALUE '1'.    00370000
           05  PC-COMPLETE-CODE               PIC  X(02)  VALUE 'CM'.   00380000
           05  PC-MANUAL-REVERSAL             PIC  X(02)  VALUE 'MR'.   00390000
           05  PC-AUTO-REVERSAL               PIC  X(02)  VALUE 'AR'.   00400000
           05  PC-ADJUSTMENT                  PIC  X(02)  VALUE 'AD'.   00410000
           05  PC-PRICE-ONLY                  PIC  X(02)  VALUE 'ML'.   00420000
           05  PC-POSITIVE-LITERAL            PIC  X(09)  VALUE         00430000
               '-POSITIVE'.                                             00440000
           05  PC-POSITIVE-RECEIPT            PIC  X(02)  VALUE 'PR'.   00450000
           05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +8      00460000
                                                          COMP SYNC.    00470000
           05  PC-COMMENT-LENGTH              PIC S9(04)  VALUE +316    00480000
                                                          COMP SYNC.    00490000
           05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3      00500000
                                                           COMP-3.      00510000
                                                                        00520000
       01  PC-TSYMSG-NUMBERS.                                           00530000
           05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.  00540000
                                                                        00550000
       01  PS-PROGRAM-SUBSCRIPTS.                                       00560000
           05  PS-SUB                         PIC S9(04)   VALUE +0     00570000
                                                           COMP SYNC.   00580000
                                                                        00590000
       01  PS-PROGRAM-SWITCHES.                                         00600000
           05  PS-ERROR-SW                    PIC X(01)    VALUE 'Y'.   00610000
               88  PS-NO-ERROR                             VALUE 'Y'.   00620000
               88  PS-ERROR                                VALUE 'N'.   00630000
           05  PS-COMMAREA-SW                 PIC X(01)    VALUE 'N'.   00640000
               88  PS-COMMAREA-VALID                       VALUE 'Y'.   00650000
               88  PS-COMMAREA-NOT-VALID                   VALUE 'N'.   00660000
           05  PS-LIST-END-SW                 PIC X(01)    VALUE 'N'.   00670000
               88  PS-LIST-END                             VALUE 'Y'.   00680000
               88  PS-NO-LIST-END                          VALUE 'N'.   00690000
           EJECT                                                        00700000
       01  VF-VARCHAR-FIELDS.                                           00710000
           05  VF-VARCHAR-SW                  PIC X(01)  VALUE ' '.     00720000
               88  VF-VARCHAR-BEGIN                      VALUE 'B'.     00730000
               88  VF-VARCHAR-END                        VALUE 'E'.     00740000
           05  VF-VARCHAR-WORK-FIELD.                                   00750000
               10  VF-VARCHAR                 OCCURS 320 TIMES          00760000
                                              INDEXED BY VF-IND         00770000
                                              PIC X.                    00780000
       01  PV-PROGRAM-VARIABLES.                                        00790000
           05  PV-SPACE-COUNTER               PIC S9(04)  VALUE +0      00800000
                                                          COMP SYNC.    00810000
           05  PV-SUB                         PIC S9(04)  VALUE +0      00820000
                                                          COMP SYNC.    00830000
           05  PV-ITEM                        PIC S9(04)  VALUE +0      00840000
                                                          COMP SYNC.    00850000
           05  PV-CICS-RESP                   PIC S9(04)   VALUE +0     00860000
                                                           COMP SYNC.   00870000
           05  PV-RETRY-COUNTER               PIC S9(4)    COMP.        00880000
           05  PV-XFER-NBR.                                             00890000
100404*        10  PV-XFER-FROM-STORE         PIC X(03).                00900000
100404         10  PV-XFER-FROM-STORE         PIC X(04).                00901000
               10                             PIC X   VALUE '-'.        00910000
               10  PV-XFER-SEQ-NBR            PIC X(06).                00920000
           05  PV-DATE.                                                 00930000
               10  PV-MONTH                   PIC X(02).                00940000
               10                             PIC X(01)  VALUE '/'.     00950000
               10  PV-DAY                     PIC X(02).                00960000
               10                             PIC X(01)  VALUE '/'.     00970000
               10  PV-YEAR                    PIC X(04).                00980000
       EJECT                                                            00990000
      *---------------------------------------------------------------* 01000000
      *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 01010001
      *---------------------------------------------------------------* 01020000
                                                                        01030000
           COPY DPWS030.                                                01040000
CICS       COPY DPWS930.                                                01041001
       EJECT                                                            01050000
      *---------------------------------------------------------------* 01060000
      *    STANDARD COMMAREA.                                         * 01070000
      *---------------------------------------------------------------* 01080000
                                                                        01090000
           COPY DPWS020.                                                01100000
           05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01110000
                                                                        01120000
      *---------------------------------------------------------------* 01130000
      *    INTER-APPLICATION COMMAREA.                                * 01140000
      *---------------------------------------------------------------* 01150000
                                                                        01160000
               10  INTER-APPL-COMM-AREA       PIC X(200).               01170000
           COPY TFWS003.                                                01180000
      *---------------------------------------------------------------* 01190000
      *    SPECIFIC COMMMAREA FOR DPKCS040.                           * 01200000
      *---------------------------------------------------------------* 01210000
               10  ASC-SPECIFIC-COMMAREA.                               01220000
                   15  ASC-XFER-DKEY-ID                    PIC S9(09)   01230000
                                                           COMP.        01240000
                   15  ASC-XFER-LNE-NBR                    PIC S9(04)   01250000
                                                           COMP.        01260000
                   15  ASC-XFER-SEQ-NBR                    PIC 9(06).   01270000
100404*            15  ASC-FR-STR-NBR                      PIC 9(03).   01280000
100404             15  ASC-FR-STR-NBR                      PIC 9(04).   01281000
                   15  ASC-FR-STR-NAM                      PIC X(10).   01290000
100404*            15  ASC-TO-STR-NBR                      PIC 9(03).   01300000
100404             15  ASC-TO-STR-NBR                      PIC 9(04).   01301000
                   15  ASC-TO-STR-NAM                      PIC X(10).   01310000
100404*            15  ASC-RC-STR-NBR                      PIC 9(03).   01320000
100404             15  ASC-RC-STR-NBR                      PIC 9(04).   01321000
                   15  ASC-RC-STR-NAM                      PIC X(10).   01330000
                   15  ASC-NBR-OF-POSTING-LINES            PIC 9(03).   01340000
                   15  ASC-USERID                          PIC X(08).   01350000
                   15  ASC-ITEM-ARRAY.                                  01360000
                       20  ASC-ITEM-ENTRIES OCCURS 8 TIMES.             01370000
                           25  ASC-DATE.                                01380000
                               30  ASC-DTE-YEAR        PIC X(04).       01390000
                               30                      PIC X(01).       01400000
                               30  ASC-DTE-MONTH       PIC X(02).       01410000
                               30                      PIC X(01).       01420000
                               30  ASC-DTE-DAY         PIC X(02).       01430000
100404*                    25  ASC-DTL-FR-NBR          PIC 9(03).       01440000
100404                     25  ASC-DTL-FR-NBR          PIC 9(04).       01441000
                           25  ASC-DTL-FR-NAM-10       PIC X(10).       01450000
                           25  ASC-DTL-FR-NAM-5        PIC X(05).       01460000
100404*                    25  ASC-DTL-TO-NBR          PIC 9(03).       01470000
100404                     25  ASC-DTL-TO-NBR          PIC 9(04).       01471000
                           25  ASC-DTL-TO-NAM-10       PIC X(10).       01480000
                           25  ASC-DTL-TO-NAM-5        PIC X(05).       01490000
                           25  ASC-DTL-FR-QTY          PIC S9(04)       01500000
                                                           COMP-3.      01510000
                           25  ASC-DTL-PRICE           PIC S9(07)V99    01520000
                                                           COMP-3.      01530000
                           25  ASC-DTL-FR-EXT          PIC S9(07)V99    01540000
                                                           COMP-3.      01550000
                           25  ASC-REASON-CDE          PIC X(02).       01560000
100404*                    25  ASC-REASON              PIC X(23).       01570000
SR3403                     25  ASC-REASON              PIC X(18).       01572000
                           25  ASC-PSTG-SEQ-NBR        PIC S9(04)       01580000
                                                           COMP-3.      01590000
                                                                        01600000
                   15  ASC-COMMENT-ARRAY.                               01610000
                       20  ASC-COMMENT OCCURS 4 TIMES  PIC X(79).       01620000
                   15  ASC-SEL-QUEUE-IN-NAME.                           01630000
                       20  ASC-SEL-IN-TERM-ID              PIC  X(04).  01640000
                       20  ASC-SEL-IN-TASK-NUMBER          PIC S9(05)   01650000
                                                                COMP-3. 01660000
                       20  ASC-SEL-IN-SEQ                  PIC  9(01).  01670000
                   15  ASC-SEL-SUB                         PIC S9(04)   01680000
                                                               COMP.    01690000
                   15  ASC-SEL-ITEM                        PIC S9(04)   01700000
                                                               COMP.    01710000
                   15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   01720000
                                                               COMP-3.  01730000
                                                                        01740000
           EJECT                                                        01750000
      *---------------------------------------------------------------* 01760000
      *  RECORD LAYOUT FOR THE TRANSFER SELECTION TEMP STORAGE QUEUE. * 01770000
      *---------------------------------------------------------------* 01780000
      *   TFWS004 - IS THE INPUT TEMP STORAGE LAYOUT WHEN COMING FROM * 01790000
      *             THE LINE DETAIL PROGRAM FOR COMMENTS INQUIRY.     * 01800000
      *---------------------------------------------------------------* 01810000
                                                                        01820000
           COPY TFWS004.                                                01830000
                                                                        01840000
           EJECT                                                        01850000
      *---------------------------------------------------------------* 01860000
      *    ABEND PROCESSING COPYBOOK.                                 * 01870000
      *---------------------------------------------------------------* 01880000
                                                                        01890000
           COPY DPWS013.                                                01900000
                                                                        01910000
           EJECT                                                        01920000
      *---------------------------------------------------------------* 01930000
      *    ATTRIBUTE SETTINGS COPYBOOK.                               * 01940000
      *---------------------------------------------------------------* 01950000
                                                                        01960000
           COPY DPWS015.                                                01970000
                                                                        01980000
      *---------------------------------------------------------------* 01990000
      *    FUNCTION KEYS COPYBOOK.                                    * 02000000
      *---------------------------------------------------------------* 02010000
                                                                        02020000
           COPY DPWS016.                                                02030000
                                                                        02040000
      *---------------------------------------------------------------* 02050000
      *    NUMERIC EDIT LAYOUT.                                       * 02060000
      *---------------------------------------------------------------* 02070000
                                                                        02080000
           COPY DPWS010I.                                               02090000
                                                                        02100000
      *---------------------------------------------------------------* 02110000
      *    MAP LAYOUT                                                 * 02120000
      *---------------------------------------------------------------* 02130000
                                                                        02140000
           COPY TFKM439.                                                02150000
                                                                        02160000
       01  MR-MAP-REDEFINITION       REDEFINES  TF439AO.                02170000
           05  FILLER                PIC X(12).                         02180000
                                                                        02190000
           05  MR-XFER-NBR-L         PIC S9(04) COMP.                   02200000
           05  MR-XFER-NBR-A         PIC  X(01).                        02210000
           05  MR-XFER-NBR-C         PIC  X(01).                        02220000
           05  MR-XFER-NBR-H         PIC  X(01).                        02230000
100404*    05  MR-XFER-NBR           PIC  X(10).                        02240000
100404     05  MR-XFER-NBR           PIC  X(11).                        02241000
                                                                        02250000
           05  MR-FR-STR-NBR-L       PIC S9(04) COMP.                   02260000
           05  MR-FR-STR-NBR-A       PIC  X(01).                        02270000
           05  MR-FR-STR-NBR-C       PIC  X(01).                        02280000
           05  MR-FR-STR-NBR-H       PIC  X(01).                        02290000
100404*    05  MR-FR-STR-NBR         PIC  X(03).                        02300000
100404     05  MR-FR-STR-NBR         PIC  X(04).                        02301000
                                                                        02310000
           05  MR-FR-STR-NAM-L       PIC S9(04) COMP.                   02320000
           05  MR-FR-STR-NAM-A       PIC  X(01).                        02330000
           05  MR-FR-STR-NAM-C       PIC  X(01).                        02340000
           05  MR-FR-STR-NAM-H       PIC  X(01).                        02350000
           05  MR-FR-STR-NAM         PIC  X(10).                        02360000
                                                                        02370000
           05  MR-TO-STR-NBR-L       PIC S9(04) COMP.                   02380000
           05  MR-TO-STR-NBR-A       PIC  X(01).                        02390000
           05  MR-TO-STR-NBR-C       PIC  X(01).                        02400000
           05  MR-TO-STR-NBR-H       PIC  X(01).                        02410000
100404*    05  MR-TO-STR-NBR         PIC  X(03).                        02420000
100404     05  MR-TO-STR-NBR         PIC  X(04).                        02421000
                                                                        02430000
           05  MR-TO-STR-NAM-L       PIC S9(04) COMP.                   02440000
           05  MR-TO-STR-NAM-A       PIC  X(01).                        02450000
           05  MR-TO-STR-NAM-C       PIC  X(01).                        02460000
           05  MR-TO-STR-NAM-H       PIC  X(01).                        02470000
           05  MR-TO-STR-NAM         PIC  X(10).                        02480000
                                                                        02490000
           05  MR-RC-STR-NBR-L       PIC S9(04) COMP.                   02500000
           05  MR-RC-STR-NBR-A       PIC  X(01).                        02510000
           05  MR-RC-STR-NBR-C       PIC  X(01).                        02520000
           05  MR-RC-STR-NBR-H       PIC  X(01).                        02530000
100404*    05  MR-RC-STR-NBR         PIC  X(03).                        02540000
100404     05  MR-RC-STR-NBR         PIC  X(04).                        02541000
                                                                        02550000
           05  MR-RC-STR-NAM-L       PIC S9(04) COMP.                   02560000
           05  MR-RC-STR-NAM-A       PIC  X(01).                        02570000
           05  MR-RC-STR-NAM-C       PIC  X(01).                        02580000
           05  MR-RC-STR-NAM-H       PIC  X(01).                        02590000
           05  MR-RC-STR-NAM         PIC  X(10).                        02600000
                                                                        02610000
           05  MR-SCROLL-AREA OCCURS 8 TIMES.                           02620000
               10  MR-DATE-L         PIC S9(04) COMP.                   02630000
               10  MR-DATE-A         PIC  X(01).                        02640000
               10  MR-DATE-C         PIC  X(01).                        02650000
               10  MR-DATE-H         PIC  X(01).                        02660000
               10  MR-DATE           PIC  X(10).                        02670000
      *                                                                 02680000
               10  MR-DTL-FR-NBR-L   PIC S9(04) COMP.                   02690000
               10  MR-DTL-FR-NBR-A   PIC  X(01).                        02700000
               10  MR-DTL-FR-NBR-C   PIC  X(01).                        02710000
               10  MR-DTL-FR-NBR-H   PIC  X(01).                        02720000
100404*        10  MR-DTL-FR-NBR     PIC  ZZZ.                          02730000
100404         10  MR-DTL-FR-NBR     PIC  ZZZZ.                         02731000
      *                                                                 02740000
               10  MR-DTL-FR-NAM-L   PIC S9(04) COMP.                   02750000
               10  MR-DTL-FR-NAM-A   PIC  X(01).                        02760000
               10  MR-DTL-FR-NAM-C   PIC  X(01).                        02770000
               10  MR-DTL-FR-NAM-H   PIC  X(01).                        02780000
               10  MR-DTL-FR-NAM     PIC  X(05).                        02790000
      *                                                                 02800000
               10  MR-DTL-TO-NBR-L   PIC S9(04) COMP.                   02810000
               10  MR-DTL-TO-NBR-A   PIC  X(01).                        02820000
               10  MR-DTL-TO-NBR-C   PIC  X(01).                        02830000
               10  MR-DTL-TO-NBR-H   PIC  X(01).                        02840000
100404*        10  MR-DTL-TO-NBR     PIC  ZZZ.                          02850000
100404         10  MR-DTL-TO-NBR     PIC  ZZZZ.                         02851000
      *                                                                 02860000
               10  MR-DTL-TO-NAM-L   PIC S9(04) COMP.                   02870000
               10  MR-DTL-TO-NAM-A   PIC  X(01).                        02880000
               10  MR-DTL-TO-NAM-C   PIC  X(01).                        02890000
               10  MR-DTL-TO-NAM-H   PIC  X(01).                        02900000
               10  MR-DTL-TO-NAM     PIC  X(05).                        02910000
      *                                                                 02920000
               10  MR-DTL-FR-QTY-L   PIC S9(04) COMP.                   02930000
               10  MR-DTL-FR-QTY-A   PIC  X(01).                        02940000
               10  MR-DTL-FR-QTY-C   PIC  X(01).                        02950000
               10  MR-DTL-FR-QTY-H   PIC  X(01).                        02960000
               10  MR-DTL-FR-QTY.                                       02970000
                   15  MR-DTL-FR-QTY-N  PIC  ZZZ.                       02980000
      *                                                                 02990000
               10  MR-DTL-FR-PRC-L   PIC S9(04) COMP.                   03000000
               10  MR-DTL-FR-PRC-A   PIC  X(01).                        03010000
               10  MR-DTL-FR-PRC-C   PIC  X(01).                        03020000
               10  MR-DTL-FR-PRC-H   PIC  X(01).                        03030000
               10  MR-DTL-FR-PRC.                                       03040000
SR3403             15  MR-DTL-FR-PRC-N  PIC  ZZZZZ.ZZ.                  03051000
      *                                                                 03060000
               10  MR-DTL-FR-EXT-L   PIC S9(04) COMP.                   03070000
               10  MR-DTL-FR-EXT-A   PIC  X(01).                        03080000
               10  MR-DTL-FR-EXT-C   PIC  X(01).                        03090000
               10  MR-DTL-FR-EXT-H   PIC  X(01).                        03100000
               10  MR-DTL-FR-EXT.                                       03110000
                   15  MR-DTL-FR-EXT-N   PIC  ZZZZZZ.ZZ.                03120000
      *                                                                 03130000
               10  MR-REASON-L       PIC S9(04) COMP.                   03140000
               10  MR-REASON-A       PIC  X(01).                        03150000
               10  MR-REASON-C       PIC  X(01).                        03160000
               10  MR-REASON-H       PIC  X(01).                        03170000
100404*        10  MR-REASON         PIC  X(23).                        03180000
SR3403         10  MR-REASON         PIC  X(18).                        03182000
                                                                        03190000
           05  MR-USERID-L           PIC S9(04) COMP.                   03200000
           05  MR-USERID-A           PIC  X(01).                        03210000
           05  MR-USERID-C           PIC  X(01).                        03220000
           05  MR-USERID-H           PIC  X(01).                        03230000
           05  MR-USERID             PIC  X(08).                        03240000
                                                                        03250000
           05  MR-COMMENTS-AREA OCCURS 4 TIMES.                         03260000
               10  MR-COMMENT-L      PIC S9(04) COMP.                   03270000
               10  MR-COMMENT-A      PIC  X(01).                        03280000
               10  MR-COMMENT-C      PIC  X(01).                        03290000
               10  MR-COMMENT-H      PIC  X(01).                        03300000
               10  MR-COMMENT        PIC  X(79).                        03310000
      *                                                                 03320000
       EJECT                                                            03330000
      *---------------------------------------------------------------* 03340000
      *    DB2 AREA FOR TTFAJRS (TRANSFER ADJUSTMENT REASON CODE TABLE) 03350000
      *---------------------------------------------------------------* 03360000
           EXEC SQL                                                     03370000
                INCLUDE TTFAJRS                                         03380000
           END-EXEC.                                                    03390000
      *---------------------------------------------------------------* 03400000
      *    DB2 AREA FOR TTFITPS (TRANSFER ITEM POSTING TABLE)         * 03410000
      *---------------------------------------------------------------* 03420000
           EXEC SQL                                                     03430000
                INCLUDE TTFITPS                                         03440000
           END-EXEC.                                                    03450000
      *---------------------------------------------------------------* 03460000
      *    DB2 AREA FOR XST_LOC TABLE                                 * 03470000
      *---------------------------------------------------------------* 03480000
           EXEC SQL                                                     03490000
                INCLUDE XST00001                                        03500000
           END-EXEC.                                                    03510000
      *---------------------------------------------------------------* 03520000
      *    DB2 AREA FOR COMMUNICATIONS                                * 03530000
      *---------------------------------------------------------------* 03540000
           EXEC SQL                                                     03550000
                INCLUDE SQLCA                                           03560000
           END-EXEC.                                                    03570000
                                                                        03580000
       EJECT                                                            03590000
       LINKAGE SECTION.                                                 03600000
                                                                        03610000
       01  DFHCOMMAREA.                                                 03620000
           05  FILLER                         OCCURS  1 TO 4072 TIMES   03630000
                                              DEPENDING ON EIBCALEN.    03640000
               10  FILLER                     PIC X.                    03650000
                                                                        03660000
       EJECT                                                            03670000
       PROCEDURE DIVISION.                                              03680000
                                                                        03690000
       0000-MAIN-MODULE.                                                03700000
                                                                        03710000
           INITIALIZE DP030-CICS-API-FIELDS.                            03720000
           MOVE +1                      TO DP030-NUMBER-OF-MAPS.        03730000
           MOVE PC-CURRENT-MAPSET-NAME  TO DP030-MAPSET-NAME.           03740000
           MOVE PC-CURRENT-MAP-NAME     TO DP030-MAP-NAME (1).          03750000
           SET DP030-RECEIVE-APPL-MAP   TO TRUE.                        03760000
           MOVE LENGTH OF TF439AI       TO DP030-MAP-LENGTH (1).        03770000
           MOVE 'PROGRAM ENTRY CALL'    TO DP013-MESSAGE-TEXT (1).      03780000
           PERFORM 0001-CALL-CICS-ARCH-API.                             03790000
                                                                        03800000
           PERFORM 1000-CONTROL-PROCESSING.                             03810000
                                                                        03820000
           MOVE 'PROGRAM EXIT CALL'     TO DP013-MESSAGE-TEXT (1).      03830000
           PERFORM 0001-CALL-CICS-ARCH-API.                             03840000
                                                                        03850000
      *----------------------------------------------------------------*03860000
      *   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *03870000
      *   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *03880000
      *----------------------------------------------------------------*03890000
                                                                        03900000
       0001-CALL-CICS-ARCH-API.                                         03910000
                                                                        03920000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03930001
                                          DFHCOMMAREA                   03940001
                                          DP030-CICS-API-FIELDS         03950001
                                          DP020-STANDARD-COMMAREA       03960001
                                          TF439AI.                      03970001
                                                                        03980000
           IF  DP030-RC-CALL-SUCCESSFUL                                 03990000
               CONTINUE                                                 04000000
           ELSE                                                         04010000
               SET DP013-NO-ROLLBACK TO TRUE                            04020000
               SET DP013-XCTL-DISPLAY-RESTART TO TRUE                   04030000
               SET DP013-CICS-ABEND TO TRUE                             04040000
               MOVE 'BEFORE 0000-MAIN-MODULE' TO DP013-PARAGRAPH        04050000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04051001
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04052001
               MOVE DP030-RETURN-CODE                                   04080000
                                     TO DP013-MESSAGE-TEXT (3)          04090000
               PERFORM DP013-0000-PROCESS-ABEND                         04100000
           END-IF.                                                      04110000
                                                                        04120000
      *----------------------------------------------------------------*04130000
      * PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04140000
      * COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04150000
      *                                                                *04160000
      *----------------------------------------------------------------*04170000
                                                                        04180000
       1000-CONTROL-PROCESSING.                                         04190000
                                                                        04200000
           EVALUATE TRUE                                                04210000
               WHEN DP020-NEXT-ACT-INITIAL                              04220000
                   INITIALIZE ASC-SPECIFIC-COMMAREA                     04230000
                   PERFORM 1100-PROCESS-INTER-APPL-COMM                 04240000
      ***-----$TEMPLATE NOTE$-------------------------------------------04250000
      *** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,04260000
      *** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  04270000
      *** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.04280000
      ***---------------------------------------------------------------04290000
                   IF  PS-COMMAREA-NOT-VALID                            04300000
      ***              MOVE PC-TSYMSG-99901                             04310000
      ***                            TO  DP020-MSG-NUMBER               04320000
      ***              SET DP020-MSG-FATAL                              04330000
      ***                            TO  TRUE                           04340000
                       SET DP020-NEXT-ACT-APPL-ERROR                    04350000
                                     TO  TRUE                           04360000
                   ELSE                                                 04370000
                       PERFORM 4100-READ-POSTINGS                       04380000
                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             04390000
                   END-IF                                               04400000
                                                                        04410000
               WHEN DP020-NEXT-ACT-READ-MAP                             04420000
                   PERFORM 2000-PROCESS-PANEL                           04430000
                                                                        04440000
               WHEN DP020-NEXT-ACT-RETURN                               04450000
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04460000
                                                                        04470000
               WHEN OTHER                                               04480000
                   SET DP013-LOGIC-ABEND TO TRUE                        04490000
                   SET DP013-NO-ROLLBACK TO TRUE                        04500000
                   MOVE '1000-CONTROL-PROCESSING'                       04510000
                                     TO  DP013-PARAGRAPH                04520000
                   MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    04530000
                                     TO  DP013-MESSAGE-TEXT(1)          04540000
                   PERFORM DP013-0000-PROCESS-ABEND                     04550000
           END-EVALUATE.                                                04560000
                                                                        04570000
       EJECT                                                            04580000
      *----------------------------------------------------------------*04590000
      * DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA.      *04600000
      *----------------------------------------------------------------*04610000
                                                                        04620000
       1100-PROCESS-INTER-APPL-COMM.                                    04630000
                                                                        04640000
           SET PS-COMMAREA-VALID     TO TRUE.                           04650000
           MOVE TF003-NUMBER-OF-TS-ITEMS                                04660000
                                     TO ASC-NUMBER-OF-TS-ITEMS          04670000
           MOVE TF003-SEL-QUEUE-NAME                                    04680000
                                     TO ASC-SEL-QUEUE-IN-NAME           04690000
           MOVE TF003-XFER-DKEY-ID   TO ASC-XFER-DKEY-ID                04700000
                                        DK-XFER-DKEY-ID                 04710000
           MOVE TF003-XFER-LNE-NBR   TO ASC-XFER-LNE-NBR                04720000
                                        DK-XFER-LNE-NBR                 04730000
           MOVE TF003-XFER-SEQ-NBR   TO ASC-XFER-SEQ-NBR                04740000
           MOVE TF003-FR-STR-NBR     TO ASC-FR-STR-NBR                  04750000
           MOVE TF003-FR-STR-NAM     TO ASC-FR-STR-NAM                  04760000
           MOVE TF003-TO-STR-NBR     TO ASC-TO-STR-NBR                  04770000
           MOVE TF003-TO-STR-NAM     TO ASC-TO-STR-NAM                  04780000
           MOVE TF003-RC-STR-NBR     TO ASC-RC-STR-NBR                  04790000
           MOVE TF003-RC-STR-NAM     TO ASC-RC-STR-NAM                  04800000
           PERFORM 1120-PREPARE-LIST-ENTRY                              04810000
           PERFORM 5000-READ-COMMENTS.                                  04820000
                                                                        04830000
      *----------------------------------------------------------------*04840000
      *    GET READY TO START AT THE FIRST ITEM ON THE LIST.           *04850000
      *----------------------------------------------------------------*04860000
                                                                        04870000
       1120-PREPARE-LIST-ENTRY.                                         04880000
                                                                        04890000
           MOVE TF004-MAX-ITEMS TO ASC-SEL-SUB.                         04900000
           MOVE ZERO            TO ASC-SEL-ITEM.                        04910000
           PERFORM 2140-GET-NEXT-LINE.                                  04920000
       EJECT                                                            04930000
      *----------------------------------------------------------------*04940000
      *    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED *04950000
      *    ON WHAT FUNCTION KEY WAS SELECTED.                          *04960000
      *----------------------------------------------------------------*04970000
                                                                        04980000
       2000-PROCESS-PANEL.                                              04990000
                                                                        05000000
           EVALUATE TRUE                                                05010000
                                                                        05020000
               WHEN DP020-SRC-AID = DP016-CLEAR                         05030000
               WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05040000
               WHEN DP020-SRC-AID = DP016-ENTER                         05050000
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05060000
                                                                        05070000
               WHEN OTHER                                               05080000
                   SET DP013-NO-ROLLBACK                                05090000
                       DP013-XCTL-DISPLAY-RESTART                       05100000
                       DP013-CICS-ABEND  TO TRUE                        05110000
                   MOVE '2000-PROCESS-PANEL'                            05120000
                                         TO DP013-PARAGRAPH             05130000
                   MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05140000
                                         TO DP013-MESSAGE-TEXT (1)      05150000
                   PERFORM DP013-0000-PROCESS-ABEND                     05160000
           END-EVALUATE.                                                05170000
       EJECT                                                            05180000
      *----------------------------------------------------------------*05190000
      *    GET THE NEXT LINE NBR IF A LIST OF LINE NBRS IS BEING      * 05200000
      *    PROCESSED.                                                  *05210000
      *----------------------------------------------------------------*05220000
                                                                        05230000
       2140-GET-NEXT-LINE.                                              05240000
                                                                        05250000
           ADD +1                       TO ASC-SEL-SUB.                 05260000
           IF  ASC-SEL-SUB > TF004-MAX-ITEMS                            05270000
               ADD +1                   TO ASC-SEL-ITEM                 05280000
               MOVE +1                  TO ASC-SEL-SUB                  05290000
           END-IF.                                                      05300000
           IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                05310000
               PERFORM 9100-READ-SEL-QUEUE-IN                           05320000
               IF  TF004-ITEM (ASC-SEL-SUB) > ZERO                      05330000
                   MOVE 1               TO ASC-NBR-OF-POSTING-LINES     05340000
                   MOVE TF004-POSTING-SEQ-NBR (ASC-SEL-SUB)             05350000
                                        TO ASC-PSTG-SEQ-NBR (1)         05360000
                   SET TF004-INQ (ASC-SEL-SUB) TO TRUE                  05370000
                   PERFORM 9200-REWRITE-SEL-QUEUE-IN                    05380000
               ELSE                                                     05390000
                   SUBTRACT +1 FROM ASC-SEL-SUB                         05400000
                   MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             05410000
                   SET DP020-MSG-INFORMATIONAL TO TRUE                  05420000
               END-IF                                                   05430000
           ELSE                                                         05440000
               SUBTRACT +1 FROM ASC-SEL-ITEM                            05450000
               MOVE TF004-MAX-ITEMS     TO ASC-SEL-SUB                  05460000
               MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             05470000
               SET DP020-MSG-INFORMATIONAL TO TRUE                      05480000
           END-IF.                                                      05490000
                                                                        05500000
      *----------------------------------------------------------------*05510000
      *    READ THE POSTING DATA                                       *05520000
      *----------------------------------------------------------------*05530000
                                                                        05540000
       4100-READ-POSTINGS.                                              05550000
                                                                        05560000
           PERFORM 4200-READ-TTFITPS                                    05570000
               VARYING PV-ITEM                                          05580000
               FROM 1 BY 1                                              05590000
               UNTIL PV-ITEM > ASC-NBR-OF-POSTING-LINES.                05600000
                                                                        05610000
      *----------------------------------------------------------------*05620000
      *    READ THE POSTING DATA                                       *05630000
      *----------------------------------------------------------------*05640000
                                                                        05650000
       4200-READ-TTFITPS.                                               05660000
                                                                        05670000
           MOVE ASC-PSTG-SEQ-NBR (PV-ITEM)    TO DK-PSTG-SEQ-NBR.       05680000
           PERFORM                                                      05690000
               WITH TEST AFTER                                          05700000
               VARYING PV-RETRY-COUNTER                                 05710000
               FROM 1 BY 1                                              05720000
               UNTIL PV-RETRY-COUNTER GREATER THAN PC-MAX-RETRIES       05730000
                  OR SQLCODE = 0                                        05740000
                  OR SQLCODE = +100                                     05750000
                                                                        05760000
               EXEC SQL                                                 05770000
                  SELECT                                                05780000
                      I.ADJ_RSN_CDE                                     05790000
                    , ITM_PSTG_PRPD_TMST                                05800000
                    , FRM_PSTG_STR_NBR                                  05810000
                    , TO_PSTG_STR_NBR                                   05820000
                    , ITM_RTL_PRCE_AMT                                  05830000
                    , ITM_QTY                                           05840000
                    , ADJ_RSN_DESC                                      05850000
                  INTO                                                  05860000
                      :TFITPS-ADJ-RSN-CDE                               05870000
                    , :TFITPS-ITM-PSTG-PRPD-TMST                        05880000
                    , :TFITPS-FRM-PSTG-STR-NBR                          05890000
                    , :TFITPS-TO-PSTG-STR-NBR                           05900000
                    , :TFITPS-ITM-RTL-PRCE-AMT                          05910000
                    , :TFITPS-ITM-QTY                                   05920000
                    , :TFAJRS-ADJ-RSN-DESC                              05930000
                  FROM                                                  05940000
                      TTFITPS I                                         05950000
                     ,TTFAJRS A                                         05960000
                  WHERE                                                 05970000
                      XFER_DKEY_ID   = :DK-XFER-DKEY-ID     AND         05980000
                      XFER_LNE_NBR   = :DK-XFER-LNE-NBR     AND         05990000
                      PSTG_SEQ_NBR   = :DK-PSTG-SEQ-NBR     AND         06000000
                      A.ADJ_RSN_CDE  = I.ADJ_RSN_CDE                    06010000
               END-EXEC                                                 06020000
                                                                        06030000
               EVALUATE TRUE                                            06040000
                   WHEN SQLCODE = ZERO                                  06050000
                   WHEN SQLCODE = +100                                  06060000
                   WHEN SQLCODE = -904                                  06070000
                   WHEN SQLCODE = -913                                  06080000
                        CONTINUE                                        06090000
                   WHEN OTHER                                           06100000
                        MOVE '4200-READ-TTFITPS'                        06120000
                                     TO  DP013-PARAGRAPH                06130000
                        MOVE 'READ TRANSFER POSTING DATA'               06140000
                                     TO  DP013-MESSAGE-TEXT (1)         06150000
                        MOVE SQLCA   TO  DP013-SQLCA                    06160000
                        MOVE 'TTFITPS'    TO DP013-DB2-TABLE-NAME (1)   06170000
                        SET DP013-DB2-ABEND                             06180000
                                     TO  TRUE                           06190000
                        PERFORM DP013-0000-PROCESS-ABEND                06200000
               END-EVALUATE                                             06210000
           END-PERFORM.                                                 06220000
                                                                        06230000
           IF  PV-RETRY-COUNTER GREATER THAN PC-MAX-RETRIES             06240000
               MOVE '4200-READ-TTFITPS'                                 06250000
                                     TO  DP013-PARAGRAPH                06260000
               MOVE 'MAX RETRIES EXCEEDED FOR READ TTFITPS'             06270000
                                     TO  DP013-MESSAGE-TEXT (1)         06280000
               MOVE SQLCA            TO  DP013-SQLCA                    06290000
               MOVE 'TTFITPS'        TO DP013-DB2-TABLE-NAME (1)        06300000
               SET DP013-DB2-ABEND   TO  TRUE                           06310000
               PERFORM DP013-0000-PROCESS-ABEND                         06320000
           END-IF.                                                      06330000
                                                                        06340000
           IF  SQLCODE = ZERO                                           06350000
                   MOVE TFITPS-ITM-PSTG-PRPD-TMST                       06360000
                                     TO  ASC-DATE (PV-ITEM)             06370000
                   MOVE TFITPS-FRM-PSTG-STR-NBR                         06380000
                                     TO  DK-STORE-NBR                   06390000
                                         ASC-DTL-FR-NBR (PV-ITEM)       06400000
                   PERFORM 5550-READ-XST-LOC                            06410000
                   MOVE XST00001-LOC-5-ABBR-NM                          06420000
                                     TO  ASC-DTL-FR-NAM-5 (PV-ITEM)     06430000
                   MOVE TFITPS-TO-PSTG-STR-NBR                          06440000
                                     TO  DK-STORE-NBR                   06450000
                                         ASC-DTL-TO-NBR (PV-ITEM)       06460000
                   PERFORM 5550-READ-XST-LOC                            06470000
                   MOVE XST00001-LOC-5-ABBR-NM                          06480000
                                     TO  ASC-DTL-TO-NAM-5 (PV-ITEM)     06490000
                   MOVE TFITPS-ITM-RTL-PRCE-AMT                         06500000
                                     TO  ASC-DTL-PRICE (PV-ITEM)        06510000
                   MOVE TFITPS-ITM-QTY                                  06520000
                                     TO  ASC-DTL-FR-QTY (PV-ITEM)       06530000
                   MOVE TFITPS-ADJ-RSN-CDE                              06540000
                                     TO  ASC-REASON-CDE (PV-ITEM)       06550000
                   EVALUATE TFITPS-ADJ-RSN-CDE                          06560000
                     WHEN PC-COMPLETE-CODE                              06570000
                       STRING TFAJRS-ADJ-RSN-DESC DELIMITED BY '  '     06580000
                       PC-POSITIVE-LITERAL        DELIMITED BY SIZE     06590000
                                     INTO ASC-REASON (PV-ITEM)          06600000
                     WHEN OTHER                                         06610000
                         MOVE TFAJRS-ADJ-RSN-DESC                       06620000
                                     TO  ASC-REASON (PV-ITEM)           06630000
                   END-EVALUATE                                         06640000
                   COMPUTE ASC-DTL-FR-EXT (PV-ITEM) =                   06650000
                      (ASC-DTL-PRICE    (PV-ITEM)   *                   06660000
                       ASC-DTL-FR-QTY   (PV-ITEM))                      06670000
           END-IF.                                                      06680000
       EJECT                                                            06690000
      *----------------------------------------------------------------*06700000
      *    FORMAT THE MAP AND DETERMINE THE CURSOR POSITION.           *06710000
      *----------------------------------------------------------------*06720000
                                                                        06730000
       4400-MOVE-COMMAREA-TO-SCREEN.                                    06740000
                                                                        06750000
           MOVE ASC-FR-STR-NBR         TO PV-XFER-FROM-STORE            06760000
                                          MR-FR-STR-NBR.                06770000
           MOVE ASC-XFER-SEQ-NBR       TO PV-XFER-SEQ-NBR.              06780000
           MOVE PV-XFER-NBR            TO MR-XFER-NBR.                  06790000
           MOVE ASC-FR-STR-NAM         TO MR-FR-STR-NAM.                06800000
           MOVE ASC-TO-STR-NBR         TO MR-TO-STR-NBR.                06810000
           MOVE ASC-TO-STR-NAM         TO MR-TO-STR-NAM.                06820000
           MOVE ASC-RC-STR-NBR         TO MR-RC-STR-NBR.                06830000
           MOVE ASC-RC-STR-NAM         TO MR-RC-STR-NAM.                06840000
           MOVE ASC-USERID             TO MR-USERID.                    06850000
           PERFORM                                                      06860000
               VARYING PV-SUB                                           06870000
               FROM 1 BY 1                                              06880000
               UNTIL PV-SUB > 4                                         06890000
               MOVE ASC-COMMENT (PV-SUB) TO MR-COMMENT (PV-SUB)         06900000
           END-PERFORM.                                                 06910000
           PERFORM                                                      06920000
             VARYING                                                    06930000
               PV-ITEM FROM 1 BY 1                                      06940000
               UNTIL PV-ITEM > PC-ITEMS-PER-PANEL                       06950000
                   IF ASC-DTE-YEAR (PV-ITEM) > SPACES                   06960000
                       MOVE ASC-DTE-YEAR (PV-ITEM)                      06970000
                                       TO PV-YEAR                       06980000
                       MOVE ASC-DTE-MONTH (PV-ITEM)                     06990000
                                       TO PV-MONTH                      07000000
                       MOVE ASC-DTE-DAY  (PV-ITEM)                      07010000
                                       TO PV-DAY                        07020000
                       MOVE PV-DATE        TO MR-DATE   (PV-ITEM)       07030000
                   END-IF                                               07040000
                   MOVE ASC-DTL-FR-NBR     (PV-ITEM)                    07050000
                                       TO MR-DTL-FR-NBR    (PV-ITEM)    07060000
                   MOVE ASC-DTL-FR-NAM-5   (PV-ITEM)                    07070000
                                       TO MR-DTL-FR-NAM    (PV-ITEM)    07080000
                   MOVE ASC-DTL-FR-QTY     (PV-ITEM)                    07090000
                                       TO MR-DTL-FR-QTY-N  (PV-ITEM)    07100000
                   MOVE ASC-DTL-PRICE      (PV-ITEM)                    07110000
                                       TO MR-DTL-FR-PRC-N  (PV-ITEM)    07120000
                   MOVE ASC-DTL-FR-EXT     (PV-ITEM)                    07130000
                                       TO MR-DTL-FR-EXT-N  (PV-ITEM)    07140000
                   MOVE ASC-REASON         (PV-ITEM)                    07150000
                                       TO MR-REASON        (PV-ITEM)    07160000
                   MOVE ASC-DTL-TO-NBR     (PV-ITEM)                    07170000
                                       TO MR-DTL-TO-NBR    (PV-ITEM)    07180000
                   MOVE ASC-DTL-TO-NAM-5   (PV-ITEM)                    07190000
                                       TO MR-DTL-TO-NAM    (PV-ITEM)    07200000
           END-PERFORM.                                                 07210000
       EJECT                                                            07220000
      *----------------------------------------------------------------*07230000
      *    READ THE COMMENTS TO BE DISPLAYED                           *07240000
      *----------------------------------------------------------------*07250000
                                                                        07260000
       5000-READ-COMMENTS.                                              07270000
                                                                        07280000
           MOVE ASC-PSTG-SEQ-NBR (1)          TO DK-PSTG-SEQ-NBR.       07290000
           PERFORM                                                      07300000
               WITH TEST AFTER                                          07310000
               VARYING PV-RETRY-COUNTER                                 07320000
               FROM 1 BY 1                                              07330000
               UNTIL PV-RETRY-COUNTER GREATER THAN PC-MAX-RETRIES       07340000
                  OR SQLCODE = 0                                        07350000
                  OR SQLCODE = +100                                     07360000
                                                                        07370000
               EXEC SQL                                                 07380000
                  SELECT                                                07390000
                      ADJ_BY_USR_ID                                     07400000
                     ,ADJ_CMNT_TXT                                      07410000
                  INTO                                                  07420000
                      :TFITPS-ADJ-BY-USR-ID                             07430000
                     ,:TFITPS-ADJ-CMNT-TXT                              07440000
                  FROM                                                  07450000
                      TTFITPS P                                         07460000
                  WHERE                                                 07470000
                      XFER_DKEY_ID   = :DK-XFER-DKEY-ID     AND         07480000
                      XFER_LNE_NBR   = :DK-XFER-LNE-NBR     AND         07490000
                      PSTG_SEQ_NBR   = :DK-PSTG-SEQ-NBR                 07500000
               END-EXEC                                                 07510000
                                                                        07520000
               EVALUATE TRUE                                            07530000
                   WHEN SQLCODE = ZERO                                  07540000
                       MOVE TFITPS-ADJ-CMNT-TXT-TEXT                    07550000
                                                 TO ASC-COMMENT-ARRAY   07560000
                       MOVE TFITPS-ADJ-BY-USR-ID TO ASC-USERID          07570000
                   WHEN SQLCODE = +100                                  07580000
                   WHEN SQLCODE = -904                                  07590000
                   WHEN SQLCODE = -913                                  07600000
                        CONTINUE                                        07610000
                   WHEN OTHER                                           07620000
                        MOVE '5000-READ-COMMENTS'                       07640000
                                     TO  DP013-PARAGRAPH                07650000
                        MOVE 'READ TRANSFER POSTING DATA'               07660000
                                     TO  DP013-MESSAGE-TEXT (1)         07670000
                        MOVE SQLCA   TO  DP013-SQLCA                    07680000
                        MOVE 'TTFITPS'    TO DP013-DB2-TABLE-NAME (1)   07690000
                        SET DP013-DB2-ABEND                             07700000
                                     TO  TRUE                           07710000
                        PERFORM DP013-0000-PROCESS-ABEND                07720000
               END-EVALUATE                                             07730000
           END-PERFORM.                                                 07740000
                                                                        07750000
           IF  PV-RETRY-COUNTER GREATER THAN PC-MAX-RETRIES             07760000
               MOVE '5000-READ-COMMENTS'                                07770000
                                     TO  DP013-PARAGRAPH                07780000
               MOVE 'MAX RETRIES EXCEEDED FOR READ TTFITPS'             07790000
                                     TO  DP013-MESSAGE-TEXT (1)         07800000
               MOVE SQLCA            TO  DP013-SQLCA                    07810000
               MOVE 'TTFITPS'        TO DP013-DB2-TABLE-NAME (1)        07820000
               SET DP013-DB2-ABEND   TO  TRUE                           07830000
               PERFORM DP013-0000-PROCESS-ABEND                         07840000
           END-IF.                                                      07850000
      *----------------------------------------------------------------*07860000
      *  GET THE 05 CHARACTER ABBREVIATED STORE NAME.                  *07870000
      *----------------------------------------------------------------*07880000
       5550-READ-XST-LOC.                                               07890000
           PERFORM WITH TEST AFTER                                      07900000
               VARYING PV-RETRY-COUNTER                                 07910000
               FROM 1 BY 1                                              07920000
               UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES)                07930000
                    OR SQLCODE = ZERO                                   07940000
                    OR SQLCODE = +100                                   07950000
               EXEC SQL                                                 07960000
                   SELECT LOC_5_ABBR_NM                                 07970000
                       INTO :XST00001-LOC-5-ABBR-NM                     07980000
                       FROM XST_LOC                                     07990000
                       WHERE (LOC_NBR  = :DK-STORE-NBR)                 08000000
               END-EXEC                                                 08010000
               EVALUATE TRUE                                            08020000
                   WHEN SQLCODE = -904                                  08030000
                   WHEN SQLCODE = -913                                  08040000
                   WHEN SQLCODE = +100                                  08050000
                       MOVE '?????'       TO XST00001-LOC-5-ABBR-NM     08060000
                   WHEN SQLCODE = ZERO                                  08070000
                       CONTINUE                                         08080000
                   WHEN OTHER                                           08090000
                       MOVE '5550-READ-XST-LOC'                         08120000
                                         TO DP013-PARAGRAPH             08130000
                       MOVE 'SELECT A ROW FROM XST_LOC'                 08140000
                                         TO DP013-MESSAGE-TEXT (1)      08150000
                       MOVE SQLCA        TO DP013-SQLCA                 08160000
                       MOVE 'XST_LOC'    TO DP013-DB2-TABLE-NAME (1)    08170000
                       SET DP013-DB2-ABEND                              08180000
                           DP013-XCTL-DISPLAY-RESTART                   08190000
                                         TO TRUE                        08200000
                       PERFORM DP013-0000-PROCESS-ABEND                 08210000
               END-EVALUATE                                             08220000
           END-PERFORM.                                                 08230000
                                                                        08240000
      *                                                                 08250000
           IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08260000
               MOVE '5550-READ-XST-LOC'                                 08270000
                                         TO DP013-PARAGRAPH             08280000
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     08290000
                                         TO DP013-MESSAGE-TEXT (1)      08300000
               MOVE 'A ROW FROM XST_LOC' TO DP013-MESSAGE-TEXT (2)      08310000
               MOVE SQLCA                TO DP013-SQLCA                 08320000
               MOVE 'XST_LOC'            TO DP013-DB2-TABLE-NAME (1)    08330000
               SET DP013-DB2-ABEND                                      08340000
                   DP013-XCTL-DISPLAY-RESTART                           08350000
                                         TO TRUE                        08360000
               PERFORM DP013-0000-PROCESS-ABEND                         08370000
           END-IF.                                                      08380000
       EJECT                                                            08390000
      *----------------------------------------------------------------*08400000
      * READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *08410000
      *----------------------------------------------------------------*08420000
                                                                        08430000
       9100-READ-SEL-QUEUE-IN.                                          08440000
           EXEC CICS                                                    08450000
               READQ TS                                                 08460000
                   QUEUE (ASC-SEL-QUEUE-IN-NAME)                        08470000
                   INTO  (TF004-TRANSFER-SEL-REC)                       08480000
                   ITEM  (ASC-SEL-ITEM)                                 08490000
                   RESP  (PV-CICS-RESP)                                 08500000
           END-EXEC.                                                    08510000
                                                                        08520000
           IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       08530000
               CONTINUE                                                 08540000
           ELSE                                                         08550000
               SET DP013-LOGIC-ABEND                                    08560000
                   DP013-NO-ROLLBACK     TO TRUE                        08570000
               MOVE '9100-READ-SEL-QUEUE-IN'                            08580000
                                         TO DP013-PARAGRAPH             08590000
               MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   08600000
                                         TO DP013-MESSAGE-TEXT (1)      08610000
               PERFORM DP013-0000-PROCESS-ABEND                         08620000
           END-IF.                                                      08630000
      *----------------------------------------------------------------*08640000
      * UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *08650000
      *----------------------------------------------------------------*08660000
       9200-REWRITE-SEL-QUEUE-IN.                                       08670000
           EXEC CICS                                                    08680000
                WRITEQ TS                                               08690000
                    QUEUE  (ASC-SEL-QUEUE-IN-NAME)                      08700000
                    FROM   (TF004-TRANSFER-SEL-REC)                     08710000
                    ITEM   (ASC-SEL-ITEM)                               08720000
                    RESP   (PV-CICS-RESP)                               08730000
                    REWRITE                                             08740000
           END-EXEC.                                                    08750000
                                                                        08760000
           IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   08770000
               SET DP013-CICS-ABEND                                     08780000
                   DP013-NO-ROLLBACK     TO TRUE                        08790000
               MOVE '9200-REWRITE-SEL-QUEUE-IN'                         08800000
                                         TO DP013-PARAGRAPH             08810000
               MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   08820000
                                         TO DP013-MESSAGE-TEXT (1)      08830000
               PERFORM DP013-0000-PROCESS-ABEND                         08840000
           END-IF.                                                      08850000
                                                                        08860000
       EJECT                                                            08870000
      *----------------------------------------------------------------*08880000
      *    ABEND PROCESSOR MODULE                                      *08890000
      *----------------------------------------------------------------*08900000
                                                                        08910000
           COPY DPPD013.                                                08920000
