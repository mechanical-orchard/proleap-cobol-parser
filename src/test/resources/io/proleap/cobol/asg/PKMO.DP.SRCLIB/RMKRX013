/* REXX */                                                                      
/* RMKRX013 - Prepare candidate recipient extract from the Infopac    */        
/*      Summary XREF file.  Set the title, address and default        */        
/*      printer locations for the distribution types with specific    */        
/*      requirements.                                                 */        
/**********************************************************************/        
ARG IPACRGN                                                                     
INFOPAC_REGION = STRIP(IPACRGN)                                                 
UPPER INFOPAC_REGION                                                            
/**********************************************************************/        
/* Set values for constants.                                          */        
/**********************************************************************/        
CURRPGM = ' RMKRX013 - '                                                        
SUMXREF_FILE_END_OF_FILE = 'Y'                                                  
SUMXREF_FILE_NOT_END_OF_FILE = 'N'                                              
INFOPAC_SECURE_REGION = 'IPACS'                                                 
NORMAL_ACCESS = 'Y'                                                             
GLOBAL_ACCESS = 'G'                                                             
XREF_TYPE_DIST_MANAGER = 'DISTMGR'                                              
XREF_TYPE_DIST_LP_MANAGER = 'DISTLPM'                                           
XREF_TYPE_DIST_ADMIN = 'DISTADM'                                                
XREF_TYPE_STORE_MANAGER = 'STORMGR'                                             
XREF_TYPE_STORE_LP_MANAGER = 'STORLPM'                                          
XREF_TYPE_STORE_ASM_AA = 'AA     '                                              
XREF_TYPE_STORE_ASM_CFH = 'CFH    '                                             
XREF_TYPE_STORE_ASM_PERSOPS = 'PERS/OP'                                         
XREF_TYPE_STORE_ADMIN = 'STRADM'                                                
XREF_TYPE_ANALYST = 'ANALYST'                                                   
XREF_TYPE_GMM = 'GMM____'                                                       
XREF_TYPE_DMM = 'DMM____'                                                       
XREF_TYPE_BUYER = 'BUYER__'                                                     
NO_DEFAULT_PRINTER = '        '                                                 
DEFAULT_PRINT_JCL = 'ARCHPRNT  '                                                
DEFAULT_SEQUENCE = ' '                                                          
MERCHANT_SEQUENCE_PREFIX = '5'                                                  
STORE_PRINTER_PREFIX = 'S0'                                                     
STORE_PRINTER_SUFFIX = '61'                                                     
STORE_NUMBER_UNDER_1000 = '0'                                                   
STORE_USERID_PFX_UNDER_1000 = 'TKST'                                            
STORE_USERID_PFX_OVER_1000 = 'TKS'                                              
NO_RECIPIENT_NAME = '                              '                            
                                                                                
/**********************************************************************/        
/* Initialize local variables.                                        */        
/**********************************************************************/        
SUMXREF_FILE_EOF = SUMXREF_FILE_NOT_END_OF_FILE                                 
                                                                                
/**********************************************************************/        
/* Program mainline.                                                  */        
/**********************************************************************/        
SAY CURRPGM 'INFOPAC REGION =' INFOPAC_REGION                                   
CALL READ_SUM_XREF_RECORD                                                       
DO WHILE (SUMXREF_FILE_EOF = SUMXREF_FILE_NOT_END_OF_FILE)                      
    PARSE PULL INP01_RECORD                                                     
    SUMXREF_USERID = SUBSTR(INP01_RECORD,20,8)                                  
    SUMXREF_XREF_TYPE = SUBSTR(INP01_RECORD,1,7)                                
    SUMXREF_XREF_KEY = SUBSTR(INP01_RECORD,10,10)                               
    SUMXREF_XREF_STORE_KEY = SUBSTR(INP01_RECORD,40,18)                         
    SUMXREF_RECIPIENT_NAME = SUBSTR(INP01_RECORD,60,30)                         
    RECIP_RECIPIENT_ID = LEFT(SUMXREF_USERID,10)                                
    RECIP_RECIPIENT_NAME = SUBSTR(INP01_RECORD,151,30)                          
    IF (RECIP_RECIPIENT_NAME = NO_RECIPIENT_NAME) THEN                          
        RECIP_RECIPIENT_NAME = SUMXREF_RECIPIENT_NAME                           
    IF (INFOPAC_REGION = INFOPAC_SECURE_REGION) THEN                            
        RECIP_ACCESS_CODE = NORMAL_ACCESS                                       
    ELSE                                                                        
        RECIP_ACCESS_CODE = GLOBAL_ACCESS                                       
    RECIP_JCL_ID = DEFAULT_PRINT_JCL                                            
    IF (SUMXREF_XREF_TYPE = XREF_TYPE_GMM) THEN DO                              
        IF (INFOPAC_REGION ^= INFOPAC_SECURE_REGION) THEN DO                    
            RECIP_RECIPIENT_TITLE = ,                                           
                      'EXEC VP GMM ' || SUMXREF_XREF_KEY                        
            RECIP_RECIPIENT_TITLE = LEFT(RECIP_RECIPIENT_TITLE,35)              
            RECIP_RECIPIENT_ADDR_LINE_1 = LEFT(DEFAULT_SEQUENCE,35)             
            RECIP_RECIPIENT_PRINTER_ID = NO_DEFAULT_PRINTER                     
            CALL WRITE_XREF_RECIP_RECORD                                        
        END                                                                     
    END                                                                         
    IF (SUMXREF_XREF_TYPE = XREF_TYPE_DMM) THEN DO                              
        IF (INFOPAC_REGION ^= INFOPAC_SECURE_REGION) THEN DO                    
            RECIP_RECIPIENT_TITLE = ,                                           
                      'SENIOR VP DMM ' || SUMXREF_XREF_KEY                      
            RECIP_RECIPIENT_TITLE = LEFT(RECIP_RECIPIENT_TITLE,35)              
            RECIP_RECIPIENT_ADDR_LINE_1 = LEFT(DEFAULT_SEQUENCE,35)             
            RECIP_RECIPIENT_PRINTER_ID = NO_DEFAULT_PRINTER                     
            CALL WRITE_XREF_RECIP_RECORD                                        
        END                                                                     
    END                                                                         
    IF (SUMXREF_XREF_TYPE = XREF_TYPE_BUYER) THEN DO                            
        IF (INFOPAC_REGION ^= INFOPAC_SECURE_REGION) THEN DO                    
            RECIP_RECIPIENT_TITLE = ,                                           
                      'BUYER ' || SUMXREF_XREF_KEY                              
            RECIP_RECIPIENT_TITLE = LEFT(RECIP_RECIPIENT_TITLE,35)              
            RECIP_RECIPIENT_ADDR_LINE_1 = ,                                     
                      MERCHANT_SEQUENCE_PREFIX ||,                              
                      SUBSTR(SUMXREF_XREF_KEY,1,3)                              
            RECIP_RECIPIENT_ADDR_LINE_1 = ,                                     
                      LEFT(RECIP_RECIPIENT_ADDR_LINE_1,35)                      
            RECIP_RECIPIENT_PRINTER_ID = NO_DEFAULT_PRINTER                     
            CALL WRITE_XREF_RECIP_RECORD                                        
        END                                                                     
    END                                                                         
    IF (SUMXREF_XREF_TYPE = XREF_TYPE_ANALYST) THEN DO                          
        IF (INFOPAC_REGION ^= INFOPAC_SECURE_REGION) THEN DO                    
            RECIP_RECIPIENT_TITLE = ,                                           
                      'ANALYST ' || SUMXREF_XREF_KEY                            
            RECIP_RECIPIENT_TITLE = LEFT(RECIP_RECIPIENT_TITLE,35)              
            RECIP_RECIPIENT_ADDR_LINE_1 = ,                                     
                      MERCHANT_SEQUENCE_PREFIX ||,                              
                      SUBSTR(SUMXREF_XREF_KEY,1,3)                              
            RECIP_RECIPIENT_ADDR_LINE_1 = ,                                     
                      LEFT(RECIP_RECIPIENT_ADDR_LINE_1,35)                      
            RECIP_RECIPIENT_PRINTER_ID = NO_DEFAULT_PRINTER                     
            CALL WRITE_XREF_RECIP_RECORD                                        
        END                                                                     
    END                                                                         
    IF (SUMXREF_XREF_TYPE = XREF_TYPE_DIST_MANAGER) THEN DO                     
        RECIP_RECIPIENT_TITLE = ,                                               
                  'DISTRICT ' || SUBSTR(SUMXREF_XREF_KEY,1,4) ||,               
                  ' MANAGER'                                                    
        RECIP_RECIPIENT_TITLE = LEFT(RECIP_RECIPIENT_TITLE,35)                  
        RECIP_RECIPIENT_ADDR_LINE_1 = ,                                         
                  LEFT(SUMXREF_XREF_STORE_KEY,35)                               
        RECIP_RECIPIENT_PRINTER_ID = STORE_PRINTER_PREFIX ||,                   
                  SUBSTR(SUMXREF_XREF_STORE_KEY,1,4) ||,                        
                  STORE_PRINTER_SUFFIX                                          
        CALL WRITE_XREF_RECIP_RECORD                                            
    END                                                                         
    IF (SUMXREF_XREF_TYPE = XREF_TYPE_DIST_LP_MANAGER) THEN DO                  
        RECIP_RECIPIENT_TITLE = ,                                               
                  'DISTRICT ' || SUBSTR(SUMXREF_XREF_KEY,1,4) ||,               
                  ' LP MANAGER'                                                 
        RECIP_RECIPIENT_TITLE = LEFT(RECIP_RECIPIENT_TITLE,35)                  
        RECIP_RECIPIENT_ADDR_LINE_1 = ,                                         
                  LEFT(SUMXREF_XREF_STORE_KEY,35)                               
        RECIP_RECIPIENT_PRINTER_ID = STORE_PRINTER_PREFIX ||,                   
                  SUBSTR(SUMXREF_XREF_STORE_KEY,1,4) ||,                        
                  STORE_PRINTER_SUFFIX                                          
        CALL WRITE_XREF_RECIP_RECORD                                            
    END                                                                         
    IF (SUMXREF_XREF_TYPE = XREF_TYPE_STORE_MANAGER) THEN DO                    
        RECIP_RECIPIENT_TITLE = ,                                               
                  'STORE MGR ' || SUBSTR(SUMXREF_XREF_KEY,1,4) ||,              
                  ' ' || SUMXREF_XREF_STORE_KEY                                 
        RECIP_RECIPIENT_TITLE = LEFT(RECIP_RECIPIENT_TITLE,35)                  
        RECIP_RECIPIENT_ADDR_LINE_1 = ,                                         
                  LEFT(SUMXREF_XREF_KEY,35)                                     
        RECIP_RECIPIENT_PRINTER_ID = STORE_PRINTER_PREFIX ||,                   
                  SUBSTR(SUMXREF_XREF_KEY,1,4) ||,                              
                  STORE_PRINTER_SUFFIX                                          
        RECIP_ACCESS_CODE = NORMAL_ACCESS                                       
        CALL WRITE_XREF_RECIP_RECORD                                            
/*                                                                    */        
/* Generate the generic store id record off the store manager record  */        
/*                                                                    */        
        IF (SUBSTR(SUMXREF_XREF_KEY,1,1) = STORE_NUMBER_UNDER_1000) THEN        
            RECIP_RECIPIENT_ID = STORE_USERID_PFX_UNDER_1000 ||,                
                      SUBSTR(SUMXREF_XREF_KEY,2,3)                              
        ELSE                                                                    
            RECIP_RECIPIENT_ID = STORE_USERID_PFX_OVER_1000 ||,                 
                      SUBSTR(SUMXREF_XREF_KEY,1,4)                              
        RECIP_RECIPIENT_ID = LEFT(RECIP_RECIPIENT_ID,10)                        
        RECIP_RECIPIENT_TITLE = LEFT(SUMXREF_XREF_STORE_KEY,35)                 
        RECIP_ACCESS_CODE = NORMAL_ACCESS                                       
        CALL WRITE_XREF_RECIP_RECORD                                            
    END                                                                         
    IF (SUMXREF_XREF_TYPE = XREF_TYPE_STORE_LP_MANAGER) THEN DO                 
        RECIP_RECIPIENT_TITLE = ,                                               
                  'STORE LP MGR ' || SUBSTR(SUMXREF_XREF_KEY,1,4) ||,           
                  ' ' || SUMXREF_XREF_STORE_KEY                                 
        RECIP_RECIPIENT_TITLE = LEFT(RECIP_RECIPIENT_TITLE,35)                  
        RECIP_RECIPIENT_ADDR_LINE_1 = ,                                         
                  LEFT(SUMXREF_XREF_KEY,35)                                     
        RECIP_RECIPIENT_PRINTER_ID = STORE_PRINTER_PREFIX ||,                   
                  SUBSTR(SUMXREF_XREF_KEY,1,4) ||,                              
                  STORE_PRINTER_SUFFIX                                          
        CALL WRITE_XREF_RECIP_RECORD                                            
    END                                                                         
    IF (SUMXREF_XREF_TYPE = XREF_TYPE_STORE_ASM_AA) THEN DO                     
        RECIP_RECIPIENT_TITLE = ,                                               
                  'STORE ASM AA ' || SUBSTR(SUMXREF_XREF_KEY,1,4) ||,           
                  ' ' || SUMXREF_XREF_STORE_KEY                                 
        RECIP_RECIPIENT_TITLE = LEFT(RECIP_RECIPIENT_TITLE,35)                  
        RECIP_RECIPIENT_ADDR_LINE_1 = ,                                         
                  LEFT(SUMXREF_XREF_KEY,35)                                     
        RECIP_RECIPIENT_PRINTER_ID = STORE_PRINTER_PREFIX ||,                   
                  SUBSTR(SUMXREF_XREF_KEY,1,4) ||,                              
                  STORE_PRINTER_SUFFIX                                          
        RECIP_ACCESS_CODE = NORMAL_ACCESS                                       
        CALL WRITE_XREF_RECIP_RECORD                                            
    END                                                                         
    IF (SUMXREF_XREF_TYPE = XREF_TYPE_STORE_ASM_CFH) THEN DO                    
        RECIP_RECIPIENT_TITLE = ,                                               
                  'STORE ASM CFH' || SUBSTR(SUMXREF_XREF_KEY,1,4) ||,           
                  ' ' || SUMXREF_XREF_STORE_KEY                                 
        RECIP_RECIPIENT_TITLE = LEFT(RECIP_RECIPIENT_TITLE,35)                  
        RECIP_RECIPIENT_ADDR_LINE_1 = ,                                         
                  LEFT(SUMXREF_XREF_KEY,35)                                     
        RECIP_RECIPIENT_PRINTER_ID = STORE_PRINTER_PREFIX ||,                   
                  SUBSTR(SUMXREF_XREF_KEY,1,4) ||,                              
                  STORE_PRINTER_SUFFIX                                          
        RECIP_ACCESS_CODE = NORMAL_ACCESS                                       
        CALL WRITE_XREF_RECIP_RECORD                                            
    END                                                                         
    IF (SUMXREF_XREF_TYPE = XREF_TYPE_STORE_ASM_PERSOPS) THEN DO                
        RECIP_RECIPIENT_TITLE = ,                                               
                  'STORE ASM PO ' || SUBSTR(SUMXREF_XREF_KEY,1,4) ||,           
                  ' ' || SUMXREF_XREF_STORE_KEY                                 
        RECIP_RECIPIENT_TITLE = LEFT(RECIP_RECIPIENT_TITLE,35)                  
        RECIP_RECIPIENT_ADDR_LINE_1 = ,                                         
                  LEFT(SUMXREF_XREF_KEY,35)                                     
        RECIP_RECIPIENT_PRINTER_ID = STORE_PRINTER_PREFIX ||,                   
                  SUBSTR(SUMXREF_XREF_KEY,1,4) ||,                              
                  STORE_PRINTER_SUFFIX                                          
        RECIP_ACCESS_CODE = NORMAL_ACCESS                                       
        CALL WRITE_XREF_RECIP_RECORD                                            
    END                                                                         
    IF (SUMXREF_XREF_TYPE = XREF_TYPE_STORE_ADMIN) THEN DO                      
        RECIP_RECIPIENT_TITLE = ,                                               
                  'STORE ADMIN ' || SUBSTR(SUMXREF_XREF_KEY,1,4)                
        RECIP_RECIPIENT_TITLE = LEFT(RECIP_RECIPIENT_TITLE,35)                  
        RECIP_RECIPIENT_ADDR_LINE_1 = ,                                         
                  LEFT(SUMXREF_XREF_KEY,35)                                     
        RECIP_RECIPIENT_PRINTER_ID = STORE_PRINTER_PREFIX ||,                   
                  SUBSTR(SUMXREF_XREF_KEY,1,4) ||,                              
                  STORE_PRINTER_SUFFIX                                          
        RECIP_ACCESS_CODE = NORMAL_ACCESS                                       
        CALL WRITE_XREF_RECIP_RECORD                                            
    END                                                                         
/*  IF (SUMXREF_XREF_TYPE = XREF_TYPE_DIST_ADMIN) THEN DO           */          
/*      RECIP_RECIPIENT_TITLE = ,                                   */          
/*                'DIST ADMIN ' || SUBSTR(SUMXREF_XREF_KEY,1,4)     */          
/*      RECIP_RECIPIENT_TITLE = LEFT(RECIP_RECIPIENT_TITLE,35)      */          
/*      RECIP_RECIPIENT_ADDR_LINE_1 = ,                             */          
/*                LEFT(SUMXREF_XREF_KEY,35)                         */          
/*      RECIP_RECIPIENT_PRINTER_ID = STORE_PRINTER_PREFIX ||,       */          
/*                SUBSTR(SUMXREF_XREF_KEY,1,4) ||,                  */          
/*                STORE_PRINTER_SUFFIX                              */          
/*      RECIP_ACCESS_CODE = NORMAL_ACCESS                           */          
/*      CALL WRITE_XREF_RECIP_RECORD                                */          
/*  END                                                             */          
    CALL READ_SUM_XREF_RECORD                                                   
END                                                                             
                                                                                
"EXECIO 0 DISKR INP01 (FINIS"                                                   
"EXECIO 0 DISKR OUT01 (FINIS"                                                   
EXIT 0                                                                          
/* ----------------------------------------------------------------- */         
/* Subroutines                                                       */         
/* ----------------------------------------------------------------- */         
/* ----------------------------------------------------------------- */         
/* READ_SUM_XREF_RECORD                                              */         
/*                                                                   */         
/* Read an Infopac summary XREF record.                              */         
/* ----------------------------------------------------------------- */         
READ_SUM_XREF_RECORD:                                                           
    "EXECIO 1 DISKR INP01"              /* read one record           */         
    IF RC = 2 THEN                                                              
        SUMXREF_FILE_EOF = SUMXREF_FILE_END_OF_FILE                             
    RETURN                                                                      
/* ----------------------------------------------------------------- */         
/* WRITE_XREF_RECIP_RECORD                                           */         
/*                                                                   */         
/* Write an Infopac XREF Recipient record.                           */         
/* ----------------------------------------------------------------- */         
WRITE_XREF_RECIP_RECORD:                                                        
    XREF_RECIP_RECORD = RECIP_RECIPIENT_ID ||,                                  
              RECIP_RECIPIENT_NAME ||,                                          
              RECIP_RECIPIENT_TITLE ||,                                         
              RECIP_RECIPIENT_ADDR_LINE_1 ||,                                   
              RECIP_RECIPIENT_PRINTER_ID ||,                                    
              RECIP_ACCESS_CODE ||,                                             
              RECIP_JCL_ID                                                      
    OUT01_RECORD = LEFT(XREF_RECIP_RECORD,150)                                  
    PUSH OUT01_RECORD                                                           
    "EXECIO 1 DISKW OUT01"                                                      
    RETURN                                                                      
