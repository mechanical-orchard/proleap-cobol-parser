00001 *-----------------------*                                         05/02/95
00002  IDENTIFICATION DIVISION.                                         VLKRE036
00003 *-----------------------*                                            LV002
00004  PROGRAM-ID.    VLKCS517.                                         VLKCS036
00005  AUTHOR.        MIKE WALTERS.                                     VLKCS036
00006  INSTALLATION.  KOHLS DEPARTMENT STORES.                          VLKCS036
00007  DATE-WRITTEN.  11-01-96.                                         VLKCS036
00008  DATE-COMPILED.                                                   VLKCS036
00009                                                                   VLKCS036
00010 *---------------------------------------------------------------* VLKCS036
00011 *    V517 - SHIPMENT LIST PROGRAM.                              * VLKCS036
00012 *                                                               * VLKCS036
00013 *    THIS PROGRAM GENERATES A LIST OF SHIPMENTS DEPENDING ON THE* VLKCS036
00014 *    CRITERIA SPECIFIED IN THE PREVIOUS SCREEN.                 * VLKCS036
00015 *    FROM THE LIST, THE USER CAN UPDATE OR DELETE EXISTING      * VLKCS036
00016 *    SHIPMENTS.                                                 * VLKCS036
00019 *                                                               * VLKCS036
00020 *---------------------------------------------------------------* VLKCS036
263627* CHANGED 11/05/2021    BY JIM HUNTER      WR: CHG0263627                 
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263627* MAKING THE CALL DYNAMIC VS STATIC.                                      
263627*---------------------------------------------------------------*         
CICS  * CHANGED 11/14/2022    BY JIM HUNTER      WR: CHG0278236                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *****************************************************************         
00021  EJECT                                                            VLKCS036
00022  ENVIRONMENT DIVISION.                                            VLKCS036
00023                                                                   VLKCS036
00024  DATA DIVISION.                                                   VLKCS036
00025                                                                   VLKCS036
00026  WORKING-STORAGE SECTION.                                         VLKCS036
00027                                                                   VLKCS036
00028  01  DK-DB2-KEYS.                                                 VLKCS036
00264      05  DK-DATE-LIMIT                   PIC X(10).                     36
00266      05  DK-SCAC                         PIC X(04).                     36
00267      05  DK-SHIPT-GRP-ID                 PIC S9(09) COMP.               36
00037                                                                   VLKCS036
00038  01  PC-PROGRAM-CONSTANTS.                                        VLKCS036
00039      05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         VLKCS036
00040                                                     'VL517A  '.   VLKCS036
00041      05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         VLKCS036
00042                                                     'VLKM517 '.   VLKCS036
00043      05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         VLKCS036
00044                                                     'VLKCS517'.   VLKCS036
00045      05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      VLKCS036
00046      05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      VLKCS036
00047      05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    VLKCS036
00048      05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +15     VLKCS036
00049                                                     COMP SYNC.    VLKCS036
00050      05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      VLKCS036
00051                                                     COMP SYNC.    VLKCS036
00052      05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         VLKCS036
00053                                                     +1000000      VLKCS036
00054                                                     COMP-3.       VLKCS036
00055      05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      VLKCS036
00056                                                     COMP SYNC.    VLKCS036
00057      05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       VLKCS036
00058                                                     COMP-3.       VLKCS036
00059      05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    VLKCS036
00060      05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  VLKCS036
00061      05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  VLKCS036
00062      05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  VLKCS036
00063      05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  VLKCS036
00064 *                                                                 VLKCS036
00065      05  PC-TSYMSG-NUMBERS.                                       VLKCS036
00066          10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  VLKCS036
00067          10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  VLKCS036
00068          10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  VLKCS036
00069          10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  VLKCS036
00070          10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  VLKCS036
00071          10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  VLKCS036
00072          10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  VLKCS036
00073          10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  VLKCS036
00074          10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  VLKCS036
00075          10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  VLKCS036
00076          10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  VLKCS036
00077          10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  VLKCS036
00078          10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  VLKCS036
00079          10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  VLKCS036
00080 *                                                                 VLKCS036
00081  01  PS-PROGRAM-SWITCHES.                                         VLKCS036
00082      05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    VLKCS036
00083          88  PS-NO-ERROR                            VALUE 'Y'.    VLKCS036
00084          88  PS-ERROR                               VALUE 'N'.    VLKCS036
00085      05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    VLKCS036
00086          88  PS-COMMAREA-VALID                      VALUE 'Y'.    VLKCS036
00087          88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    VLKCS036
00088      05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    VLKCS036
00089          88  PS-DONE                                VALUE 'Y'.    VLKCS036
00090          88  PS-NOT-DONE                            VALUE 'N'.    VLKCS036
00091 *                                                                 VLKCS036
00092  01  PV-PROGRAM-VARIABLES.                                        VLKCS036
00093      05  PV-SUB                         PIC S9(04)  VALUE +0      VLKCS036
00094                                                     COMP SYNC.    VLKCS036
00095      05  PV-REMAINDER                   PIC S9(04)  VALUE +0      VLKCS036
00096                                                     COMP SYNC.    VLKCS036
00097      05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      VLKCS036
00098                                                     COMP-3.       VLKCS036
00099      05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      VLKCS036
00100                                                     COMP-3.       VLKCS036
00101      05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      VLKCS036
00102                                                     COMP-3.       VLKCS036
00103      05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      VLKCS036
00104                                                     COMP-3.       VLKCS036
00105      05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      VLKCS036
00106                                                     COMP-3.       VLKCS036
00107      05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      VLKCS036
00108                                                     COMP-3.       VLKCS036
00109      05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      VLKCS036
00110                                                     COMP-3.       VLKCS036
00111      05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      VLKCS036
00112                                                     COMP SYNC.    VLKCS036
00113      05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      VLKCS036
00114                                                     COMP SYNC.    VLKCS036
00115      05  PV-ITEM                        PIC S9(04)  VALUE +0      VLKCS036
00116                                                     COMP SYNC.    VLKCS036
00117      05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      VLKCS036
00118                                                     COMP SYNC.    VLKCS036
00119      05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      VLKCS036
00120                                                     COMP SYNC.    VLKCS036
00121      05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      VLKCS036
00122                                                     COMP SYNC.    VLKCS036
00123      05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      VLKCS036
00124                                                     COMP SYNC.    VLKCS036
00125      05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      VLKCS036
00126                                                     COMP SYNC.    VLKCS036
00127      05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      VLKCS036
00128                                                     COMP SYNC.    VLKCS036
00129      05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      VLKCS036
00130                                                     COMP SYNC.    VLKCS036
00131      05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      VLKCS036
00132                                                     COMP SYNC.    VLKCS036
00133      05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      VLKCS036
00134                                                     COMP SYNC.    VLKCS036
00135      05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      VLKCS036
00136                                                     COMP SYNC.    VLKCS036
00137      05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      VLKCS036
00138                                                     COMP SYNC.    VLKCS036
00139      05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      VLKCS036
00140                                                     COMP SYNC.    VLKCS036
00141      05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      VLKCS036
00142                                                     COMP SYNC.    VLKCS036
00143 ******************************************************************VLKCS036
00144 **  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **VLKCS036
00145 **  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **VLKCS036
00146 **  APPLICATION-SPECIFIC COMMAREA.                              **VLKCS036
00147 ******************************************************************VLKCS036
00148  01  LQW-LIST-QUEUE-WORK-AREA.                                    VLKCS036
00149      05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  VLKCS036
           05  LQW-ITEM-ENTRIES               OCCURS 15 TIMES           VLKCS036
00151                                         INDEXED BY LQW-IDX.             36
00152          10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       VLKCS036
00279          10  LQW-DETAIL-DISPLAY-SW      PIC  X(01).                     36
00280              88  LQW-DETAIL-DISP                    VALUE 'Y'.          36
00280              88  LQW-DETAIL-DISP-NO-SELECT          VALUE 'S'.          36
00284              88  LQW-NO-DETAIL-DISP                 VALUE 'N'.          36
00153          10  LQW-TEMP-SELECTED-SW       PIC  X(01).               VLKCS036
00154          10  LQW-SELECTED-SW            PIC  X(01).               VLKCS036
00155              88  LQW-SELECT                         VALUE 'S'.    VLKCS036
00156              88  LQW-DESELECT                       VALUE ' '.    VLKCS036
00157          10  LQW-ACTION                 PIC  X(03).               VLKCS036
00190          10  LQW-SCAC                   PIC  X(04).                     36
00190          10  LQW-CARRIER-SHIPT-NBR      PIC  X(18).                     36
00190          10  LQW-SHIPT-GRP-ID           PIC S9(09) COMP.                36
00190          10  LQW-SHIP-DATE              PIC  X(10).                     36
00190          10  LQW-PO-NUMBER              PIC  9(08).                     36
00190          10  LQW-VND-NAME               PIC  X(20).                     36
00162                                                                   VLKCS036
00163      EJECT                                                        VLKCS036
00171 *---------------------------------------------------------------* VLKCS036
00172 *    MAP LAYOUT                                                 * VLKCS036
00173 *---------------------------------------------------------------* VLKCS036
00174                                                                   VLKCS036
00175      COPY VLKM517.                                                VLKCS036
00176 *                                                                 VLKCS036
00177  01  MR-OCCURS-LAYOUT                   REDEFINES  VL517AO.       VLKCS036
00178      05  FILLER                         PIC X(42).                VLKCS036
00179      05  MR-SCROLL-AREA                 OCCURS 15 TIMES.          VLKCS036
00180          10  MR-SELECTL                 PIC S9(04) COMP.          VLKCS036
00181          10  MR-SELECTA                 PIC  X(01).               VLKCS036
00182          10  MR-SELECTC                 PIC  X(01).               VLKCS036
00183          10  MR-SELECTH                 PIC  X(01).               VLKCS036
00184          10  MR-SELECTI                 PIC  X(01).               VLKCS036
00185                                                                   VLKCS036
00186          10  MR-ACTIONL                 PIC S9(04) COMP.          VLKCS036
00187          10  MR-ACTIONA                 PIC  X(01).               VLKCS036
00188          10  MR-ACTIONC                 PIC  X(01).               VLKCS036
00189          10  MR-ACTIONH                 PIC  X(01).               VLKCS036
00190          10  MR-ACTION                  PIC  X(03).               VLKCS036
00191                                                                   VLKCS036
00186          10  MR-SCACL                   PIC S9(04) COMP.          VLKCS036
00187          10  MR-SCACA                   PIC  X(01).               VLKCS036
00188          10  MR-SCACC                   PIC  X(01).               VLKCS036
00189          10  MR-SCACH                   PIC  X(01).               VLKCS036
00190          10  MR-SCAC                    PIC  X(04).               VLKCS036
00191                                                                   VLKCS036
00186          10  MR-SHIP-NBRL               PIC S9(04) COMP.          VLKCS036
00187          10  MR-SHIP-NBRA               PIC  X(01).               VLKCS036
00188          10  MR-SHIP-NBRC               PIC  X(01).               VLKCS036
00189          10  MR-SHIP-NBRH               PIC  X(01).               VLKCS036
00190          10  MR-CARRIER-SHIPT-NBR       PIC  X(18).               VLKCS036
00191                                                                   VLKCS036
00186          10  MR-SHIP-DATEL              PIC S9(04) COMP.          VLKCS036
00187          10  MR-SHIP-DATEA              PIC  X(01).               VLKCS036
00188          10  MR-SHIP-DATEC              PIC  X(01).               VLKCS036
00189          10  MR-SHIP-DATEH              PIC  X(01).               VLKCS036
00190          10  MR-SHIPT-DATE              PIC  X(10).               VLKCS036
00191                                                                   VLKCS036
00186          10  MR-PO-NUMBERL              PIC S9(04) COMP.          VLKCS036
00187          10  MR-PO-NUMBERA              PIC  X(01).               VLKCS036
00188          10  MR-PO-NUMBERC              PIC  X(01).               VLKCS036
00189          10  MR-PO-NUMBERH              PIC  X(01).               VLKCS036
00190          10  MR-PO-NUMBER.                                        VLKCS036
                   15  MR-PO-NUMBER-N         PIC  9(08).               VLKCS036
00191                                                                   VLKCS036
00186          10  MR-VND-NAMEL               PIC S9(04) COMP.          VLKCS036
00187          10  MR-VND-NAMEA               PIC  X(01).               VLKCS036
00188          10  MR-VND-NAMEC               PIC  X(01).               VLKCS036
00189          10  MR-VND-NAMEH               PIC  X(01).               VLKCS036
00190          10  MR-VND-NAME                PIC  X(20).               VLKCS036
00191                                                                   VLKCS036
00191                                                                   VLKCS036
00216      EJECT                                                        VLKCS036
00217 *---------------------------------------------------------------* VLKCS036
00218 *    ATTRIBUTE SETTINGS COPYBOOK.                               * VLKCS036
00219 *---------------------------------------------------------------* VLKCS036
00221      COPY DPWS015.                                                VLKCS036
00220                                                                   VLKCS036
00223 *---------------------------------------------------------------* VLKCS036
00224 *    FUNCTION KEYS COPYBOOK.                                    * VLKCS036
00225 *---------------------------------------------------------------* VLKCS036
00227      COPY DPWS016.                                                VLKCS036
00228                                                                   VLKCS036
00229 *---------------------------------------------------------------* VLKCS036
00230 *    NUMERIC EDIT LAYOUT.                                       * VLKCS036
00231 *---------------------------------------------------------------* VLKCS036
00233      COPY DPWS010I.                                               VLKCS036
                                                                                
00229 *---------------------------------------------------------------* VLKCS036
00230 *    TEMP STORAGE QUEUE LAYOUT FOR THE SELECTED ITEMS           * VLKCS036
00231 *---------------------------------------------------------------* VLKCS036
00232                                                                   VLKCS036
00233      COPY VLWS012.                                                VLKCS036
00220                                                                   VLKCS036
00234  EJECT                                                            VLKCS036
00235 *---------------------------------------------------------------* VLKCS036
00236 *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * VLKCS036
00237 *---------------------------------------------------------------* VLKCS036
00238                                                                   VLKCS036
00239      COPY DPWS030.                                                VLKCS036
CICS       COPY DPWS930.                                                VLKCS036
00240  EJECT                                                            VLKCS036
00241 *---------------------------------------------------------------* VLKCS036
00242 *    STANDARD COMMAREA.                                         * VLKCS036
00243 *---------------------------------------------------------------* VLKCS036
00244                                                                   VLKCS036
00245      COPY DPWS020.                                                VLKCS036
00246      05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                VLKCS036
00247                                                                   VLKCS036
00248 *---------------------------------------------------------------* VLKCS036
00249 * INTER-APPLICATION COMMAREA.                                   * VLKCS036
00250 *   VLWS011 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * VLKCS036
00251 *             SPEC SCREEN.                                      * VLKCS036
00252 *   VLWS011 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * VLKCS036
00253 *             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * VLKCS036
00254 *---------------------------------------------------------------* VLKCS036
00255                                                                   VLKCS036
00256          10  INTER-APPL-COMM-AREA       PIC X(200).               VLKCS036
00257      COPY VLWS011.                                                VLKCS036
00259 *---------------------------------------------------------------* VLKCS036
00260 *  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * VLKCS036
00261 *---------------------------------------------------------------* VLKCS036
00262          10  ASC-SPECIFIC-COMMAREA.                               VLKCS036
00263              15  ASC-LIST-KEYS.                                   VLKCS036
00264                  20  ASC-KEY-DATE-LIMIT              PIC X(10).   VLKCS036
00266                  20  ASC-KEY-SCAC-CODE               PIC X(04).         36
00267                  20  ASC-KEY-SHIPT-GRP-ID            PIC S9(09)   VLKCS036
                                                           COMP.                
00269              15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                VLKCS036
00270                  20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  VLKCS036
00271                      88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   VLKCS036
00272                      88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   VLKCS036
00273                                                                   VLKCS036
00274                  20  ASC-ITEM-ARRAY.                              VLKCS036
00275                      25  ASC-ITEM-ENTRIES OCCURS 15 TIMES.        VLKCS036
00276                          30  ASC-LIST-ITEM-NUMBER                 VLKCS036
00277                                                      PIC S9(09)   VLKCS036
00278                                                      COMP-3.      VLKCS036
00279                          30  ASC-DETAIL-DISPLAY-SW   PIC  X(01).  VLKCS036
00280                              88  ASC-DETAIL-DISP     VALUE 'Y'.   VLKCS036
00280                              88  ASC-DETAIL-DISP-NO-SELECT        VLKCS036
00280                                                      VALUE 'S'.   VLKCS036
00284                              88  ASC-NO-DETAIL-DISP  VALUE 'N'.   VLKCS036
00279                          30  ASC-TEMP-SELECTED-SW    PIC  X(01).  VLKCS036
00280                              88  ASC-VALID-SELECT    VALUE ' '    VLKCS036
00281                                                            'S'    VLKCS036
00282                                                            'B'    VLKCS036
00283                                                            'E'.   VLKCS036
00284                              88  ASC-TEMP-NO-SELECT  VALUE ' '.   VLKCS036
00285                              88  ASC-TEMP-SELECT     VALUE 'S'.   VLKCS036
00286                              88  ASC-TEMP-BEGIN      VALUE 'B'.   VLKCS036
00287                              88  ASC-TEMP-END        VALUE 'E'.   VLKCS036
00288                          30  ASC-SELECTED-SW         PIC  X(01).  VLKCS036
00289                              88  ASC-NO-SELECT       VALUE ' '.   VLKCS036
00290                              88  ASC-SELECT          VALUE 'S'.   VLKCS036
00291                              88  ASC-BEGIN           VALUE 'B'.   VLKCS036
00292                              88  ASC-END             VALUE 'E'.   VLKCS036
00293                          30  ASC-ACTION              PIC X(03).   VLKCS036
00190                          30  ASC-SCAC                PIC X(04).         36
00190                          30  ASC-CARRIER-SHIPT-NBR   PIC X(18).         36
00190                          30  ASC-SHIPT-GRP-ID        PIC S9(9)            
                                                               COMP.            
00190                          30  ASC-SHIPT-DATE          PIC X(10).         36
00190                          30  ASC-PO-NUMBER           PIC 9(08).         36
00190                          30  ASC-VND-NAME            PIC X(20).         36
00299                                                                   VLKCS036
00300              15  ASC-BLK-SUB                         PIC S9(04)   VLKCS036
00301                                                           COMP    VLKCS036
00302                                                           SYNC.   VLKCS036
00303              15  ASC-ITEM-SUB                        PIC S9(04)   VLKCS036
00304                                                           COMP    VLKCS036
00305                                                           SYNC.   VLKCS036
00190              15  ASC-SAVE-SHIPT-GRP-ID               PIC S9(9)            
                                                               COMP.            
00190              15  ASC-SAVE-SHIPT-NBR                  PIC S9(9)            
                                                               COMP.            
00306              15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   VLKCS036
00307                                                           COMP-3. VLKCS036
00308              15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   VLKCS036
00309                                                           COMP-3. VLKCS036
00310              15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   VLKCS036
00311                                                           COMP-3. VLKCS036
00312              15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   VLKCS036
00313                                                           COMP-3. VLKCS036
00314              15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   VLKCS036
00315                                                           COMP-3. VLKCS036
00316              15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   VLKCS036
00317                                                           COMP    VLKCS036
00318                                                           SYNC.   VLKCS036
00319              15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   VLKCS036
00320                                                           COMP-3. VLKCS036
00321              15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   VLKCS036
00322                                                           COMP-3. VLKCS036
00323              15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  VLKCS036
00324                  88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   VLKCS036
00325                  88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   VLKCS036
00326              15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  VLKCS036
00327                  88  ASC-UPDATE-TSQ                  VALUE 'Y'.   VLKCS036
00328                  88  ASC-NO-TSQ-UPDATE               VALUE ' '.   VLKCS036
00329              15  ASC-LIST-QUEUE-NAME.                             VLKCS036
00330                  20  ASC-LIST-TERM-ID                PIC  X(04).  VLKCS036
00331                  20  ASC-LIST-TASK-NUMBER            PIC S9(05)   VLKCS036
00332                                                           COMP-3. VLKCS036
00333                  20  ASC-LIST-SEQ                    PIC  9(01).  VLKCS036
00334              15  ASC-SEL-QUEUE-NAME.                              VLKCS036
00335                  20  ASC-SEL-TERM-ID                 PIC  X(04).  VLKCS036
00336                  20  ASC-SEL-TASK-NUMBER             PIC S9(05)   VLKCS036
00337                                                           COMP-3. VLKCS036
00338                  20  ASC-SEL-SEQ                     PIC  9(01).  VLKCS036
00339                                                                   VLKCS036
00340              15  ASC-CURSOR-SW                       PIC  X(01).  VLKCS036
00341                  88  ASC-NO-CURSOR                   VALUE 'Z'.   VLKCS036
00342                  88  ASC-SHIP-CURSOR                 VALUE 'S'.   VLKCS036
00343                  88  ASC-DATE-CURSOR                 VALUE 'N'.   VLKCS036
00344                  88  ASC-SCAC-CURSOR                 VALUE 'T'.   VLKCS036
00345              15  ASC-START-ITEM-REQUEST.                          VLKCS036
00346                  20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  VLKCS036
00347      EJECT                                                        VLKCS036
00348 *---------------------------------------------------------------* VLKCS036
00349 *    ABEND PROCESSING COPYBOOK.                                 * VLKCS036
00350 *---------------------------------------------------------------* VLKCS036
00351                                                                   VLKCS036
00352      COPY DPWS013.                                                VLKCS036
00353                                                                   VLKCS036
00354  EJECT                                                            VLKCS036
00355 *---------------------------------------------------------------* VLKCS036
00356 *    DB2 AREA FOR THE PRETICKET REQUEST HEADER TABLE            * VLKCS036
00357 *---------------------------------------------------------------* VLKCS036
00358      EXEC SQL                                                     VLKCS036
00359           INCLUDE TPTKREQ                                         VLKCS036
00360      END-EXEC.                                                    VLKCS036
00355 *---------------------------------------------------------------* VLKCS036
00356 *    DB2 AREA FOR THE PRETICKET SHIPMENT ASSOCIATION TABLE      * VLKCS036
00357 *---------------------------------------------------------------* VLKCS036
00358      EXEC SQL                                                     VLKCS036
00359           INCLUDE TREQSHP                                         VLKCS036
00360      END-EXEC.                                                    VLKCS036
00355 *---------------------------------------------------------------* VLKCS036
00356 *    DB2 AREA FOR THE PRETICKET SHIPMENT TABLE                          36
00357 *---------------------------------------------------------------* VLKCS036
00358      EXEC SQL                                                     VLKCS036
00359           INCLUDE TPTKSHP                                         VLKCS036
00360      END-EXEC.                                                    VLKCS036
00355 *---------------------------------------------------------------* VLKCS036
00356 *    DB2 AREA FOR THE EXTERNAL ENTERPRISE NAME TABLE            *       36
00357 *---------------------------------------------------------------* VLKCS036
00358      EXEC SQL                                                     VLKCS036
00359           INCLUDE TENTNME                                         VLKCS036
00360      END-EXEC.                                                    VLKCS036
00361 *---------------------------------------------------------------* VLKCS036
00362 *    DB2 AREA FOR COMMUNICATIONS                                * VLKCS036
00363 *---------------------------------------------------------------* VLKCS036
00364      EXEC SQL                                                     VLKCS036
00365           INCLUDE SQLCA                                           VLKCS036
00366      END-EXEC.                                                    VLKCS036
00367                                                                   VLKCS036
00368 *---------------------------------------------------------------* VLKCS036
00369 *    SHIPMENT CURSOR - WHEN THE SHIPPING NUMBER (AND THEREFORE  * VLKCS036
00369 *        THE SHIPTMENT GROUP ID) WAS SUPPLIED                   * VLKCS036
00370 *---------------------------------------------------------------* VLKCS036
00372      EXEC SQL                                                     VLKCS036
00373          DECLARE SHIP_CURSOR CURSOR                                     36
               FOR SELECT                                                       
                         D.SHIPT_GRP_ID                                         
                       , A.SCAC_CDE                                             
                       , A.CARR_SHIPT_ID                                        
                       , A.SHIPT_DTE                                            
                       , A.SHIPT_NBR                                            
                       , B.PO_NBR                                               
                       , C.ENT_NAME_DESC                                        
                  FROM TPTKSHP A                                                
                     , TPTKREQ B                                                
                     , TENTNME C                                                
                     , TREQSHP D                                                
                  WHERE D.SHIPT_NBR = A.SHIPT_NBR                               
                    AND D.PO_REQ_NBR = B.PO_REQ_NBR                             
                    AND B.ENT_ID       = C.ENT_ID                               
                    AND C.TYPE_CDE = '01'                                       
                    AND D.SHIPT_GRP_ID = :DK-SHIPT-GRP-ID                       
                    ORDER BY 1,3,6                                              
00385      END-EXEC.                                                    VLKCS036
00386                                                                   VLKCS036
00367                                                                   VLKCS036
00368 *---------------------------------------------------------------* VLKCS036
00369 *    DATE CURSOR - WHEN ONLY THE DATE LIMIT WAS SUPPLIED        * VLKCS036
00370 *---------------------------------------------------------------* VLKCS036
00372      EXEC SQL                                                     VLKCS036
00373          DECLARE DATE_CURSOR CURSOR                                     36
               FOR SELECT                                                       
                         D.SHIPT_GRP_ID                                         
                       , A.SCAC_CDE                                             
                       , A.CARR_SHIPT_ID                                        
                       , A.SHIPT_DTE                                            
                       , A.SHIPT_NBR                                            
                       , B.PO_NBR                                               
                       , C.ENT_NAME_DESC                                        
                  FROM TPTKSHP A                                                
                     , TPTKREQ B                                                
                     , TENTNME C                                                
                     , TREQSHP D                                                
                  WHERE D.SHIPT_NBR = A.SHIPT_NBR                               
                    AND D.PO_REQ_NBR = B.PO_REQ_NBR                             
                    AND B.ENT_ID       = C.ENT_ID                               
                    AND C.TYPE_CDE = '01'                                       
                    AND D.SHIPT_GRP_ID IN                                       
                        (SELECT Y.SHIPT_GRP_ID                                  
                         FROM TREQSHP Y                                         
                            , TPTKSHP Z                                         
                         WHERE Z.SHIPT_DTE >= :DK-DATE-LIMIT                    
                           AND Y.SHIPT_NBR  = Z.SHIPT_NBR)                      
                    ORDER BY 1,3,6                                              
00385      END-EXEC.                                                    VLKCS036
00386                                                                   VLKCS036
00367                                                                   VLKCS036
00368 *---------------------------------------------------------------* VLKCS036
00369 *    CARRIER CURSOR - WHEN THE SCAC CODE WAS SUPPLIED           * VLKCS036
00370 *---------------------------------------------------------------* VLKCS036
00372      EXEC SQL                                                     VLKCS036
00373          DECLARE SCAC_CURSOR CURSOR                                     36
               FOR SELECT                                                       
                         D.SHIPT_GRP_ID                                         
                       , A.SCAC_CDE                                             
                       , A.CARR_SHIPT_ID                                        
                       , A.SHIPT_DTE                                            
                       , A.SHIPT_NBR                                            
                       , B.PO_NBR                                               
                       , C.ENT_NAME_DESC                                        
                  FROM TPTKSHP A                                                
                     , TPTKREQ B                                                
                     , TENTNME C                                                
                     , TREQSHP D                                                
                  WHERE D.SHIPT_NBR = A.SHIPT_NBR                               
                    AND D.PO_REQ_NBR = B.PO_REQ_NBR                             
                    AND B.ENT_ID       = C.ENT_ID                               
                    AND C.TYPE_CDE = '01'                                       
                    AND D.SHIPT_GRP_ID IN                                       
                        (SELECT Y.SHIPT_GRP_ID                                  
                         FROM TREQSHP Y                                         
                            , TPTKSHP Z                                         
                         WHERE Z.SHIPT_DTE >= :DK-DATE-LIMIT                    
                           AND Z.SCAC_CDE   = :DK-SCAC                          
                           AND Y.SHIPT_NBR  = Z.SHIPT_NBR)                      
                    ORDER BY 1,3,6                                              
00385      END-EXEC.                                                    VLKCS036
00386                                                                   VLKCS036
00431                                                                   VLKCS036
00432  EJECT                                                            VLKCS036
00433  LINKAGE SECTION.                                                 VLKCS036
00434                                                                   VLKCS036
00435  01  DFHCOMMAREA.                                                 VLKCS036
00436      05  FILLER                         OCCURS  1 TO 4072 TIMES   VLKCS036
00437                                         DEPENDING ON EIBCALEN.    VLKCS036
00438          10  FILLER                     PIC X.                    VLKCS036
00439                                                                   VLKCS036
00440  EJECT                                                            VLKCS036
00441  PROCEDURE DIVISION.                                              VLKCS036
00442 ******************************************************************VLKCS036
00443 **  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **VLKCS036
00444 **  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **VLKCS036
00445 **  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **VLKCS036
00446 ******************************************************************VLKCS036
00447  0000-MAIN-MODULE.                                                VLKCS036
00448      INITIALIZE DP030-CICS-API-FIELDS.                            VLKCS036
00449      MOVE +1                       TO DP030-NUMBER-OF-MAPS.       VLKCS036
00450      MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          VLKCS036
00451      MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         VLKCS036
00452      SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       VLKCS036
00453      MOVE LENGTH OF VL517AI        TO DP030-MAP-LENGTH (1).       VLKCS036
00454      MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     VLKCS036
00455      PERFORM 0001-CALL-CICS-ARCH-API.                             VLKCS036
00456 *                                                                 VLKCS036
00457      PERFORM 1000-CONTROL-PROCESSING                              VLKCS036
00458 *                                                                 VLKCS036
00459      MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     VLKCS036
00460      PERFORM 0001-CALL-CICS-ARCH-API.                             VLKCS036
00461                                                                   VLKCS036
00462 ******************************************************************VLKCS036
00463 **  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **VLKCS036
00464 **  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **VLKCS036
00465 ******************************************************************VLKCS036
00466  0001-CALL-CICS-ARCH-API.                                         VLKCS036
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
00468                                     DFHCOMMAREA                           
00469                                     DP030-CICS-API-FIELDS                 
00470                                     DP020-STANDARD-COMMAREA               
00471                                     VL517AI.                              
00472 *                                                                 VLKCS036
00473      IF  DP030-RC-CALL-SUCCESSFUL                                 VLKCS036
00474          CONTINUE                                                 VLKCS036
00475      ELSE                                                         VLKCS036
00476          SET DP013-NO-ROLLBACK                                    VLKCS036
00477              DP013-XCTL-DISPLAY-RESTART                           VLKCS036
00478              DP013-CICS-ABEND      TO TRUE                        VLKCS036
00479          MOVE '0001-CALL-CICS-ARCH-API'                           VLKCS036
00480                                    TO DP013-PARAGRAPH             VLKCS036
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
00483          MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      VLKCS036
00484          PERFORM DP013-0000-PROCESS-ABEND                         VLKCS036
00485      END-IF.                                                      VLKCS036
00486 *----------------------------------------------------------------*VLKCS036
00487 * PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *VLKCS036
00488 * COURSE OF ACTION IS FOR THIS TRANSACTION.                      *VLKCS036
00489 *                                                                *VLKCS036
00490 * NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *VLKCS036
00491 *  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *VLKCS036
00492 *  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *VLKCS036
00493 *  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *VLKCS036
00494 *----------------------------------------------------------------*VLKCS036
00495                                                                   VLKCS036
00496  1000-CONTROL-PROCESSING.                                         VLKCS036
00497                                                                   VLKCS036
00498      EVALUATE TRUE                                                VLKCS036
00499          WHEN DP020-NEXT-ACT-INITIAL                              VLKCS036
00500              INITIALIZE ASC-SPECIFIC-COMMAREA                     VLKCS036
00501              MOVE EIBTRMID         TO ASC-LIST-TERM-ID            VLKCS036
00502                                       ASC-SEL-TERM-ID             VLKCS036
00503              MOVE DP020-SRC-TASK-NUMBER                           VLKCS036
00504                                    TO ASC-LIST-TASK-NUMBER        VLKCS036
00505                                       ASC-SEL-TASK-NUMBER         VLKCS036
00506              MOVE PC-LIST-QUEUE-SEQ                               VLKCS036
00507                                    TO ASC-LIST-SEQ                VLKCS036
00508              MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 VLKCS036
00509              PERFORM 1100-PROCESS-INTER-APPL-COMM                 VLKCS036
00510 ***-----$TEMPLATE NOTE$-------------------------------------------VLKCS036
00511 *** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,VLKCS036
00512 *** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  VLKCS036
00513 *** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.VLKCS036
00514 ***---------------------------------------------------------------VLKCS036
00515              IF  PS-COMMAREA-NOT-VALID                            VLKCS036
00516 ***              MOVE PC-TSYMSG-99901                             VLKCS036
00517 ***                                TO DP020-MSG-NUMBER            VLKCS036
00518 ***              SET DP020-MSG-FATAL                              VLKCS036
00519 ***                                TO TRUE                        VLKCS036
00520                  SET DP020-NEXT-ACT-APPL-ERROR                    VLKCS036
00521                                    TO TRUE                        VLKCS036
00522              ELSE                                                 VLKCS036
00523                  PERFORM 4000-BUILD-INITIAL-PANEL                 VLKCS036
00524              END-IF                                               VLKCS036
00525                                                                   VLKCS036
00526          WHEN DP020-NEXT-ACT-READ-MAP                             VLKCS036
00527              MOVE ASC-ITEM-AT-TOP-OF-PANEL                        VLKCS036
00528                                    TO PV-TOP-ITEM                 VLKCS036
00529              PERFORM 2000-PROCESS-PANEL                           VLKCS036
00530                                                                   VLKCS036
00531          WHEN DP020-NEXT-ACT-RETURN                               VLKCS036
00532              MOVE ASC-ITEM-AT-TOP-OF-PANEL                        VLKCS036
00533                                    TO PV-TOP-ITEM                 VLKCS036
00534              MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    VLKCS036
00535              PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 VLKCS036
00536              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VLKCS036
00537              PERFORM 3000-EDIT-DATA-IN-COMMAREA                      CL**2
00538                                                                   VLKCS036
00539          WHEN OTHER                                               VLKCS036
00540              SET DP013-LOGIC-ABEND TO TRUE                        VLKCS036
00541              SET DP013-NO-ROLLBACK TO TRUE                        VLKCS036
00542              MOVE '1000-CONTROL-PROCESSING'                       VLKCS036
00543                                    TO DP013-PARAGRAPH             VLKCS036
00544              MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    VLKCS036
00545                                    TO DP013-MESSAGE-TEXT(1)       VLKCS036
00546              PERFORM DP013-0000-PROCESS-ABEND                     VLKCS036
00547      END-EVALUATE.                                                VLKCS036
00548                                                                   VLKCS036
00549  EJECT                                                            VLKCS036
00550 *----------------------------------------------------------------*VLKCS036
00551 * DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *VLKCS036
00552 * IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *VLKCS036
00553 *----------------------------------------------------------------*VLKCS036
00554                                                                   VLKCS036
00555  1100-PROCESS-INTER-APPL-COMM.                                    VLKCS036
00556                                                                   VLKCS036
00557      SET PS-COMMAREA-VALID         TO TRUE.                       VLKCS036
00558      MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     VLKCS036
                                                                                
00559      IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          VLKCS036
00560          MOVE VL011-DATE-LIMIT     TO ASC-KEY-DATE-LIMIT          VLKCS036
00560                                       DK-DATE-LIMIT                     36
00563          MOVE VL011-SCAC-CODE      TO ASC-KEY-SCAC-CODE           VLKCS036
00563                                       DK-SCAC                           36
00566          MOVE VL011-SHIPT-GRP-ID   TO ASC-KEY-SHIPT-GRP-ID        VLKCS036
00566                                       DK-SHIPT-GRP-ID             VLKCS036
           ELSE                                                                 
               SET PS-COMMAREA-NOT-VALID TO TRUE                                
00576      END-IF.                                                      VLKCS036
00577                                                                   VLKCS036
00578  EJECT                                                            VLKCS036
00579 *----------------------------------------------------------------*VLKCS036
00580 * DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *VLKCS036
00581 * ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *VLKCS036
00582 * USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *VLKCS036
00583 * OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *VLKCS036
00584 * FUNCTION KEYS CAN GET THIS FAR.                                *VLKCS036
00585 *----------------------------------------------------------------*VLKCS036
00586                                                                   VLKCS036
00587  2000-PROCESS-PANEL.                                              VLKCS036
00588      EVALUATE TRUE                                                VLKCS036
00589          WHEN DP020-SRC-AID = DP016-CLEAR                         VLKCS036
00590              MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    VLKCS036
00591              PERFORM 3000-EDIT-DATA-IN-COMMAREA                   VLKCS036
00592              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VLKCS036
00593                                                                   VLKCS036
00594          WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    VLKCS036
00560              MOVE ASC-KEY-DATE-LIMIT                                    36
00560                                    TO DK-DATE-LIMIT               PKCS0 36
00563              MOVE ASC-KEY-SCAC-CODE                                     36
00563                                    TO DK-SCAC                           36
00566              MOVE ASC-KEY-SHIPT-GRP-ID                                  36
00566                                    TO DK-SHIPT-GRP-ID             VLKCS036
00603              PERFORM 2050-DELETE-LIST-QUEUE                       VLKCS036
00604              PERFORM 4000-BUILD-INITIAL-PANEL                     VLKCS036
00605                                                                   VLKCS036
00606          WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    VLKCS036
00607              PERFORM 2140-DESELECT-ALL-ITEMS                      VLKCS036
00608              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VLKCS036
00609                                                                   VLKCS036
00610          WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  VLKCS036
00611              PERFORM 2150-SELECT-ALL-ITEMS                        VLKCS036
00612              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VLKCS036
00613                                                                   VLKCS036
00614          WHEN OTHER                                               VLKCS036
00615              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 VLKCS036
00616              PERFORM 3000-EDIT-DATA-IN-COMMAREA                   VLKCS036
00617              IF  PS-NO-ERROR                                      VLKCS036
00618                  SET DP030-CONTINUE-GO                            VLKCS036
00619                                  TO TRUE                          VLKCS036
00620                  PERFORM 2100-CHECK-FUNCTION-KEY                  VLKCS036
00621              ELSE                                                 VLKCS036
00622                  SET DP030-OVERRIDE-GO                            VLKCS036
00623                                  TO TRUE                          VLKCS036
00624              END-IF                                               VLKCS036
00625      END-EVALUATE.                                                VLKCS036
00626  EJECT                                                            VLKCS036
00627 *----------------------------------------------------------------*VLKCS036
00628 *  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *VLKCS036
00629 *----------------------------------------------------------------*VLKCS036
00630  2050-DELETE-LIST-QUEUE.                                          VLKCS036
00631                                                                   VLKCS036
00632      EXEC CICS                                                    VLKCS036
00633          DELETEQ TS                                               VLKCS036
00634              QUEUE (ASC-LIST-QUEUE-NAME)                          VLKCS036
00635              RESP  (PV-CICS-RESP)                                 VLKCS036
00636      END-EXEC.                                                    VLKCS036
00637                                                                   VLKCS036
00638      IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       VLKCS036
00639         (PV-CICS-RESP = DFHRESP(QIDERR))                          VLKCS036
00640          CONTINUE                                                 VLKCS036
00641      ELSE                                                         VLKCS036
00642          SET DP013-CICS-ABEND      TO TRUE                        VLKCS036
00643          SET DP013-NO-ROLLBACK     TO TRUE                        VLKCS036
00644                                                                   VLKCS036
00645          MOVE '2050-DELETE-LIST-QUEUE'                            VLKCS036
00646                                    TO DP013-PARAGRAPH             VLKCS036
00647          MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    VLKCS036
00648                                    TO DP013-MESSAGE-TEXT (1)      VLKCS036
00649          PERFORM DP013-0000-PROCESS-ABEND                         VLKCS036
00650      END-IF.                                                      VLKCS036
00651                                                                   VLKCS036
00652      MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  VLKCS036
00653  EJECT                                                            VLKCS036
00654 *----------------------------------------------------------------*VLKCS036
00655 * ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*VLKCS036
00656 * NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *VLKCS036
00657 * CICS ARCHITECTURE API.                                         *VLKCS036
00658 *----------------------------------------------------------------*VLKCS036
00659  2100-CHECK-FUNCTION-KEY.                                         VLKCS036
00660      EVALUATE TRUE                                                VLKCS036
00661          WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              VLKCS036
00661          WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              VLKCS036
00662              IF  ASC-NUMBER-OF-SELECTED-ITEMS = +1                VLKCS036
00663                  INITIALIZE VL011-INTER-APPL-COMMAREA             VLKCS036
00664                  MOVE ASC-NUMBER-OF-SELECTED-ITEMS                DPKCS036
00665                                 TO VL011-NUMBER-OF-SELECTED-ITEMS DPKCS036
00666                  PERFORM 5000-PREPARE-SEL-QUEUE                   VLKCS036
00667              ELSE                                                 VLKCS036
00668                  SET DP030-OVERRIDE-GO                            VLKCS036
00669                                    TO TRUE                        VLKCS036
00670                  MOVE PC-TSYMSG-00057                             VLKCS036
00671                                    TO DP020-MSG-NUMBER            VLKCS036
00672                  SET DP020-MSG-WARNING                            VLKCS036
00673                                    TO TRUE                        VLKCS036
00674              END-IF                                               VLKCS036
00675                                                                   VLKCS036
00676          WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  VLKCS036
00677              MOVE +1               TO PV-TOP-ITEM                 VLKCS036
00678              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VLKCS036
00679                                                                   VLKCS036
00680          WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   VLKCS036
00681              PERFORM 2110-BROWSE-BACKWARD                         VLKCS036
00682              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VLKCS036
00683                                                                   VLKCS036
00684          WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   VLKCS036
00685              PERFORM 2120-BROWSE-FORWARD                          VLKCS036
00686              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VLKCS036
00687                                                                   VLKCS036
00688          WHEN DP020-SRC-AID = DP016-ENTER                         VLKCS036
00689              PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   VLKCS036
00690              IF  PS-ERROR                                         VLKCS036
00691                  CONTINUE                                         VLKCS036
00692              ELSE                                                 VLKCS036
00693                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             VLKCS036
00694              END-IF                                               VLKCS036
00695                                                                   VLKCS036
00696          WHEN OTHER                                               VLKCS036
00697              SET DP013-NO-ROLLBACK                                VLKCS036
00698                  DP013-XCTL-DISPLAY-RESTART                       VLKCS036
00699                  DP013-CICS-ABEND  TO TRUE                        VLKCS036
00700              MOVE '2100-CHECK-FUNCTION-KEY'                       VLKCS036
00701                                    TO DP013-PARAGRAPH             VLKCS036
00702              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      VLKCS036
00703                                    TO DP013-MESSAGE-TEXT (1)      VLKCS036
00704              PERFORM DP013-0000-PROCESS-ABEND                     VLKCS036
00705      END-EVALUATE.                                                VLKCS036
00706 *                                                                 VLKCS036
00707 *----------------------------------------------------------------*VLKCS036
00708 *    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *VLKCS036
00709 *    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *VLKCS036
00710 *    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *VLKCS036
00711 *    MESSAGE.                                                    *VLKCS036
00712 *----------------------------------------------------------------*VLKCS036
00713                                                                   VLKCS036
00714  2110-BROWSE-BACKWARD.                                            VLKCS036
00715      SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    VLKCS036
00716          GIVING PV-TOP-ITEM.                                      VLKCS036
00717 *                                                                 VLKCS036
00718      IF  ((PV-TOP-ITEM < +1)                                      VLKCS036
00719        OR (PV-TOP-ITEM = +1))                                     VLKCS036
00720          MOVE +1                   TO PV-TOP-ITEM                 VLKCS036
00721 *        -- TOP OF LIST --                                        VLKCS036
00722          MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            VLKCS036
00723          SET DP020-MSG-INFORMATIONAL TO TRUE                      VLKCS036
00724      END-IF.                                                      VLKCS036
00725                                                                   VLKCS036
00726  EJECT                                                            VLKCS036
00727 *----------------------------------------------------------------*VLKCS036
00728 *    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *VLKCS036
00729 *    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *VLKCS036
00730 *    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *VLKCS036
00731 *----------------------------------------------------------------*VLKCS036
00732                                                                   VLKCS036
00733  2120-BROWSE-FORWARD.                                             VLKCS036
00734                                                                   VLKCS036
00735      ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              VLKCS036
00736          GIVING PV-TOP-ITEM.                                      VLKCS036
00737      IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   VLKCS036
00738          MOVE ASC-ITEM-AT-TOP-OF-PANEL                            VLKCS036
00739                                    TO PV-TOP-ITEM                 VLKCS036
00740 *        -- BOTTOM OF LIST --                                     VLKCS036
00741          MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            VLKCS036
00742          SET DP020-MSG-INFORMATIONAL                              VLKCS036
00743                                    TO TRUE                        VLKCS036
00744      ELSE                                                         VLKCS036
00745          COMPUTE PV-BOTTOM-ITEM =                                 VLKCS036
00746              PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 VLKCS036
00747          IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            VLKCS036
00748 *            -- BOTTOM OF LIST --                                 VLKCS036
00749              MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            VLKCS036
00750              SET DP020-MSG-INFORMATIONAL                          VLKCS036
00751                                    TO TRUE                        VLKCS036
00752          END-IF                                                   VLKCS036
00753      END-IF.                                                      VLKCS036
00754  EJECT                                                            VLKCS036
00755 *----------------------------------------------------------------*VLKCS036
00756 *    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *VLKCS036
00757 *    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *VLKCS036
00758 *    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *VLKCS036
00759 *    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *VLKCS036
00760 *    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *VLKCS036
00761 *    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *VLKCS036
00762 *----------------------------------------------------------------*VLKCS036
00763                                                                   VLKCS036
00764  2130-CHECK-FOR-JUMP-BROWSE.                                      VLKCS036
00765      SET PS-NO-ERROR               TO TRUE.                       VLKCS036
00766      IF (ASC-START-ITEM-REQUEST = SPACE)                          VLKCS036
00767          MOVE ASC-ITEM-AT-TOP-OF-PANEL                            VLKCS036
00768                                    TO PV-TOP-ITEM                 VLKCS036
00769      ELSE                                                         VLKCS036
00770          MOVE ASC-START-ITEM-REQUEST                              VLKCS036
00771                                    TO DP010I-UNEDITED-FIELD       VLKCS036
00772          MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       VLKCS036
00773          MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     VLKCS036
00774          SET DP010I-NEGATIVE-NOT-ALLOWED                          VLKCS036
00775                                    TO TRUE                        VLKCS036
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263627              USING DP010I-NUMERIC-EDIT-AREA                              
00777                                                                   VLKCS036
00778          IF  NOT DP010I-ERROR-DETECTED                            VLKCS036
00779              MOVE DP010I-NUMERIC-FIELD                            VLKCS036
00780                                    TO  ASC-START-ITEM-REQUEST-N   VLKCS036
00781              IF  ASC-START-ITEM-REQUEST-N > ZERO                  VLKCS036
00782                  IF  ASC-START-ITEM-REQUEST-N >                   VLKCS036
00783                                           ASC-NUMBER-OF-ITEMS-READVLKCS036
00784                      MOVE SPACE TO ASC-START-ITEM-REQUEST         VLKCS036
00785                      COMPUTE PV-TOP-ITEM =                        VLKCS036
00786                              ASC-NUMBER-OF-ITEMS-READ             VLKCS036
00787                              - PC-ITEMS-PER-PANEL + 1             VLKCS036
00788                      IF  PV-TOP-ITEM < +1                         VLKCS036
00789                          MOVE +1   TO PV-TOP-ITEM                 VLKCS036
00790                          MOVE PC-TSYMSG-00070                     VLKCS036
00791                                    TO DP020-MSG-NUMBER            VLKCS036
00792                          SET DP020-MSG-INFORMATIONAL              VLKCS036
00793                                    TO TRUE                        VLKCS036
00794                      END-IF                                       VLKCS036
00795                  ELSE                                             VLKCS036
00796                      MOVE ASC-START-ITEM-REQUEST-N                VLKCS036
00797                                    TO PV-TOP-ITEM                 VLKCS036
00798                      MOVE SPACE    TO ASC-START-ITEM-REQUEST      VLKCS036
00799                      COMPUTE PV-BOTTOM-ITEM =                     VLKCS036
00800                          PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     VLKCS036
00801                      IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READVLKCS036
00802 *                        -- BOTTOM OF LIST --                     VLKCS036
00803                          MOVE PC-TSYMSG-00070                     VLKCS036
00804                                    TO DP020-MSG-NUMBER            VLKCS036
00805                          SET DP020-MSG-INFORMATIONAL              VLKCS036
00806                                    TO TRUE                        VLKCS036
00807                      END-IF                                       VLKCS036
00808                  END-IF                                           VLKCS036
00809              ELSE                                                 VLKCS036
00810 *                --- VALUE OUT OF RANGE ----                      VLKCS036
00811                  MOVE PC-TSYMSG-00101                             VLKCS036
00812                                    TO DP020-MSG-NUMBER            VLKCS036
00813                  MOVE -1           TO ASTRTITL                    VLKCS036
00814                  SET DP030-SET-CURSOR-APPL-1                      VLKCS036
00815                                    TO TRUE                        VLKCS036
00816                  MOVE DP015-REVERSE                               VLKCS036
00817                                    TO ASTRTITH                    VLKCS036
00818                  MOVE DP015-RED    TO ASTRTITC                    VLKCS036
00819                  MOVE DP015-UNP-NUM-BRT-MDT                       VLKCS036
00820                                    TO ASTRTITA                    VLKCS036
00821                  SET DP020-MSG-FATAL                              VLKCS036
00822                                    TO TRUE                        VLKCS036
00823                  SET PS-ERROR      TO TRUE                        VLKCS036
00824              END-IF                                               VLKCS036
00825                                                                   VLKCS036
00826          ELSE                                                     VLKCS036
00827              MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            VLKCS036
00828              MOVE -1               TO ASTRTITL                    VLKCS036
00829              SET DP030-SET-CURSOR-APPL-1 TO TRUE                  VLKCS036
00830              MOVE DP015-REVERSE    TO ASTRTITH                    VLKCS036
00831              MOVE DP015-RED        TO ASTRTITC                    VLKCS036
00832              MOVE DP015-UNP-NUM-BRT-MDT                           VLKCS036
00833                                    TO ASTRTITA                    VLKCS036
00834              SET DP020-MSG-FATAL   TO TRUE                        VLKCS036
00835              SET PS-ERROR          TO TRUE                        VLKCS036
00836          END-IF                                                   VLKCS036
00837      END-IF.                                                      VLKCS036
00838  EJECT                                                            VLKCS036
00839 *----------------------------------------------------------------*VLKCS036
00840 *    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *VLKCS036
00841 *    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *VLKCS036
00842 *----------------------------------------------------------------*VLKCS036
00843  2140-DESELECT-ALL-ITEMS.                                         VLKCS036
00844      MOVE +1                       TO ASC-BLK-SUB.                VLKCS036
00845                                                                   VLKCS036
00846      PERFORM 2141-CLEAR-SELECTED-INDS                             VLKCS036
00847          VARYING ASC-ITEM-SUB                                     VLKCS036
00848          FROM 1 BY 1                                              VLKCS036
00849          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VLKCS036
00850                                                                   VLKCS036
00851      ADD +1                        TO ASC-BLK-SUB.                VLKCS036
00852                                                                   VLKCS036
00853      PERFORM 2141-CLEAR-SELECTED-INDS                             VLKCS036
00854          VARYING ASC-ITEM-SUB                                     VLKCS036
00855          FROM 1 BY 1                                              VLKCS036
00856          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VLKCS036
00857                                                                   VLKCS036
00858      MOVE ASC-LIST-ITEM-NUMBER(1 1)                               VLKCS036
00859                                    TO PV-LIST-ITEM-NUMBER.        VLKCS036
00860                                                                   VLKCS036
00861      COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            VLKCS036
00862          1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    VLKCS036
00863                                                                   VLKCS036
00864      IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     VLKCS036
00865         (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      VLKCS036
00866          MOVE +1                   TO ASC-BLK-SUB                 VLKCS036
00867                                                                   VLKCS036
00868          PERFORM 5100-WRITE-TEMP-STORAGE                          VLKCS036
00869                                                                   VLKCS036
00870          MOVE +1                   TO PV-BLOCK-NUMBER             VLKCS036
00871                                                                   VLKCS036
00872          COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         VLKCS036
00873              PV-FIRST-BLOCK-IN-ARRAY - 1                          VLKCS036
00874                                                                   VLKCS036
00875          PERFORM                                                  VLKCS036
00876              UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       VLKCS036
00877                                                                   VLKCS036
00878              PERFORM 4410-READ-TEMP-STORAGE                       VLKCS036
00879                                                                   VLKCS036
00880              PERFORM 2141-CLEAR-SELECTED-INDS                     VLKCS036
00881                  VARYING ASC-ITEM-SUB FROM 1 BY 1                 VLKCS036
00882                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VLKCS036
00883                                                                   VLKCS036
00884              PERFORM 5100-WRITE-TEMP-STORAGE                      VLKCS036
00885                                                                   VLKCS036
00886              ADD +1                TO PV-BLOCK-NUMBER             VLKCS036
00887                                                                   VLKCS036
00888          END-PERFORM                                              VLKCS036
00889                                                                   VLKCS036
00890          COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         VLKCS036
00891              PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     VLKCS036
00892                                                                   VLKCS036
00893          PERFORM                                                  VLKCS036
00894              UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       VLKCS036
00895                    ASC-HIGHEST-BLOCK-WRITTEN                      VLKCS036
00896                                                                   VLKCS036
00897              MOVE PV-NEXT-BLOCK-IN-ARRAY                          VLKCS036
00898                                    TO PV-BLOCK-NUMBER             VLKCS036
00899                                                                   VLKCS036
00900              PERFORM 4410-READ-TEMP-STORAGE                       VLKCS036
00901                                                                   VLKCS036
00902              PERFORM 2141-CLEAR-SELECTED-INDS                     VLKCS036
00903                  VARYING ASC-ITEM-SUB                             VLKCS036
00904                  FROM 1 BY 1                                      VLKCS036
00905                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VLKCS036
00906                                                                   VLKCS036
00907              PERFORM 5100-WRITE-TEMP-STORAGE                      VLKCS036
00908                                                                   VLKCS036
00909              ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      VLKCS036
00910                                                                   VLKCS036
00911          END-PERFORM                                              VLKCS036
00912                                                                   VLKCS036
00913          MOVE PV-FIRST-BLOCK-IN-ARRAY                             VLKCS036
00914                                    TO PV-BLOCK-NUMBER             VLKCS036
00915                                                                   VLKCS036
00916          PERFORM 4410-READ-TEMP-STORAGE                           VLKCS036
00917      END-IF.                                                      VLKCS036
00918                                                                   VLKCS036
00919                                                                   VLKCS036
00920      MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. VLKCS036
00921      MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.VLKCS036
00922      MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  VLKCS036
00923                                                                   VLKCS036
00924      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        VLKCS036
00925                                                                   VLKCS036
00926  EJECT                                                            VLKCS036
00927 *----------------------------------------------------------------*VLKCS036
00928 *    MARK EACH ITEM AS BEING NOT SELECTED.                       *VLKCS036
00929 *----------------------------------------------------------------*VLKCS036
00930                                                                   VLKCS036
00931  2141-CLEAR-SELECTED-INDS.                                        VLKCS036
00932                                                                   VLKCS036
00933      IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           VLKCS036
00934              NOT EQUAL ZERO                                       VLKCS036
00935          IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          VLKCS036
00936              SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          VLKCS036
00937                  ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    VLKCS036
00938                  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  VLKCS036
00939                                    TO TRUE                        VLKCS036
00940          END-IF                                                   VLKCS036
00941      END-IF.                                                      VLKCS036
00942                                                                   VLKCS036
00943  EJECT                                                            VLKCS036
00944 *----------------------------------------------------------------*VLKCS036
00945 *  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *VLKCS036
00946 *  FOR ALL ITEMS.                                                *VLKCS036
00947 *----------------------------------------------------------------*VLKCS036
00948                                                                   VLKCS036
00949  2150-SELECT-ALL-ITEMS.                                           VLKCS036
00950                                                                   VLKCS036
01029      MOVE +0            TO ASC-NUMBER-OF-SELECTED-ITEMS.                36
00951      MOVE +1            TO ASC-BLK-SUB.                                 36
00952                                                                   VLKCS036
00953      PERFORM 2151-SET-SELECTED-INDS                               VLKCS036
00954          VARYING ASC-ITEM-SUB                                     VLKCS036
00955          FROM 1 BY 1                                              VLKCS036
00956          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VLKCS036
00957                                                                   VLKCS036
00958      ADD +1                        TO ASC-BLK-SUB.                VLKCS036
00959                                                                   VLKCS036
00960      PERFORM 2151-SET-SELECTED-INDS                               VLKCS036
00961          VARYING ASC-ITEM-SUB                                     VLKCS036
00962          FROM 1 BY 1                                              VLKCS036
00963          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VLKCS036
00964                                                                   VLKCS036
00965      MOVE ASC-LIST-ITEM-NUMBER(1 1)                               VLKCS036
00966                                    TO PV-LIST-ITEM-NUMBER.        VLKCS036
00967                                                                   VLKCS036
00968      COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            VLKCS036
00969          1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    VLKCS036
00970                                                                   VLKCS036
00971      IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     VLKCS036
00972         (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    VLKCS036
00973          MOVE +1                   TO ASC-BLK-SUB                 VLKCS036
00974                                                                   VLKCS036
00975          PERFORM 5100-WRITE-TEMP-STORAGE                          VLKCS036
00976                                                                   VLKCS036
00977          MOVE +1                   TO PV-BLOCK-NUMBER             VLKCS036
00978                                                                   VLKCS036
00979          COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         VLKCS036
00980              PV-FIRST-BLOCK-IN-ARRAY - 1                          VLKCS036
00981                                                                   VLKCS036
00982          PERFORM                                                  VLKCS036
00983              UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       VLKCS036
00984                                                                   VLKCS036
00985              PERFORM 4410-READ-TEMP-STORAGE                       VLKCS036
00986                                                                   VLKCS036
00987              PERFORM 2151-SET-SELECTED-INDS                       VLKCS036
00988                  VARYING ASC-ITEM-SUB                             VLKCS036
00989                  FROM 1 BY 1                                      VLKCS036
00990                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VLKCS036
00991                                                                   VLKCS036
00992              PERFORM 5100-WRITE-TEMP-STORAGE                      VLKCS036
00993                                                                   VLKCS036
00994              ADD +1                TO PV-BLOCK-NUMBER             VLKCS036
00995                                                                   VLKCS036
00996          END-PERFORM                                              VLKCS036
00997                                                                   VLKCS036
00998          COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         VLKCS036
00999              PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     VLKCS036
01000                                                                   VLKCS036
01001          PERFORM                                                  VLKCS036
01002              UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       VLKCS036
01003                    ASC-HIGHEST-BLOCK-WRITTEN                      VLKCS036
01004                                                                   VLKCS036
01005              MOVE PV-NEXT-BLOCK-IN-ARRAY                          VLKCS036
01006                                    TO PV-BLOCK-NUMBER             VLKCS036
01007                                                                   VLKCS036
01008              PERFORM 4410-READ-TEMP-STORAGE                       VLKCS036
01009                                                                   VLKCS036
01010              PERFORM 2151-SET-SELECTED-INDS                       VLKCS036
01011                  VARYING ASC-ITEM-SUB                             VLKCS036
01012                  FROM 1 BY 1                                      VLKCS036
01013                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VLKCS036
01014                                                                   VLKCS036
01015              PERFORM 5100-WRITE-TEMP-STORAGE                      VLKCS036
01016                                                                   VLKCS036
01017              ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      VLKCS036
01018                                                                   VLKCS036
01019          END-PERFORM                                              VLKCS036
01020                                                                   VLKCS036
01021          MOVE PV-FIRST-BLOCK-IN-ARRAY                             VLKCS036
01022                                    TO PV-BLOCK-NUMBER             VLKCS036
01023                                                                   VLKCS036
01024          PERFORM 4410-READ-TEMP-STORAGE                           VLKCS036
01025      END-IF.                                                      VLKCS036
01026                                                                   VLKCS036
01027                                                                   VLKCS036
01030                                                                   VLKCS036
01031      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        VLKCS036
01032                                                                   VLKCS036
01033  EJECT                                                            VLKCS036
01034 *----------------------------------------------------------------*VLKCS036
01035 *    MARK EACH ITEM AS BEING SELECTED.                           *VLKCS036
01036 *----------------------------------------------------------------*VLKCS036
01037                                                                   VLKCS036
01038  2151-SET-SELECTED-INDS.                                          VLKCS036
01039                                                                   VLKCS036
01040      IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           VLKCS036
01041              NOT EQUAL ZERO                                       VLKCS036
           AND ASC-DETAIL-DISP (ASC-BLK-SUB ASC-ITEM-SUB)                       
01042          IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             VLKCS036
01043              SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             VLKCS036
01044                  ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        VLKCS036
01045                  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  VLKCS036
01046                                TO  TRUE                           VLKCS036
01047          END-IF                                                   VLKCS036
               ADD +1                TO ASC-NUMBER-OF-SELECTED-ITEMS            
01048      END-IF.                                                      VLKCS036
01049 ******************************************************************VLKCS036
01050 ** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **VLKCS036
01051 ** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **VLKCS036
01052 ******************************************************************VLKCS036
01053  2200-MOVE-SCREEN-TO-COMMAREA.                                    VLKCS036
01054                                                                   VLKCS036
01055      MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             VLKCS036
01056      MOVE +1                       TO PV-SUB.                     VLKCS036
01057 *                                                                 VLKCS036
01058      PERFORM 3100-SET-SUBSCRIPTS.                                 VLKCS036
01059      IF  ASTRTITL > ZERO                                          VLKCS036
01060          MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          VLKCS036
01061      ELSE                                                         VLKCS036
01062          IF  ASTRTITF = DP015-ERASE-EOF                           VLKCS036
01063              INITIALIZE ASC-START-ITEM-REQUEST                    VLKCS036
01064          END-IF                                                   VLKCS036
01065      END-IF.                                                      VLKCS036
01066      PERFORM 2210-MOVE-LINES-TO-COMMAREA                          VLKCS036
01067          VARYING PV-SUB                                           VLKCS036
01068          FROM 1 BY 1                                              VLKCS036
01069          UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      VLKCS036
01070 ******************************************************************VLKCS036
01071 ** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**VLKCS036
01072 ******************************************************************VLKCS036
01073  2210-MOVE-LINES-TO-COMMAREA.                                     VLKCS036
01074      IF  MR-SELECTL (PV-SUB) > ZERO                               VLKCS036
01075          SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             VLKCS036
01076          MOVE MR-SELECTI (PV-SUB)                                 VLKCS036
01077                                    TO ASC-TEMP-SELECTED-SW        VLKCS036
01078                                  (ASC-BLK-SUB, ASC-ITEM-SUB)      VLKCS036
01079      ELSE                                                         VLKCS036
01080          IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                VLKCS036
01081                  SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     VLKCS036
01082                  MOVE SPACE        TO ASC-TEMP-SELECTED-SW        VLKCS036
01083                                  (ASC-BLK-SUB, ASC-ITEM-SUB)      VLKCS036
01084          END-IF                                                   VLKCS036
01085      END-IF.                                                      VLKCS036
01086      ADD +1                        TO ASC-ITEM-SUB.               VLKCS036
01087      IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        VLKCS036
01088          ADD +1                    TO ASC-BLK-SUB                 VLKCS036
01089          MOVE +1                   TO ASC-ITEM-SUB                VLKCS036
01090      END-IF.                                                      VLKCS036
01091 ******************************************************************VLKCS036
01092 ** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **VLKCS036
01093 ** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **VLKCS036
01094 ******************************************************************VLKCS036
01095  3000-EDIT-DATA-IN-COMMAREA.                                      VLKCS036
01096      SET PS-NO-ERROR               TO TRUE.                       VLKCS036
01097      PERFORM 3200-RESET-ATTRIBUTES.                               VLKCS036
01098      MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     VLKCS036
01099 **                                                                VLKCS036
01100 * CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              VLKCS036
01101 * EDITTING IS DONE FROM THE BOTTOM UP.                            VLKCS036
01102 **                                                                VLKCS036
01103      COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       VLKCS036
01104          ASC-ITEMS-DISPLAYED - 1.                                 VLKCS036
01105      PERFORM 3100-SET-SUBSCRIPTS.                                 VLKCS036
01106      PERFORM 3300-EDIT-SELECTIONS                                 VLKCS036
01107          VARYING PV-SUB                                           VLKCS036
01108          FROM PV-SUB BY -1                                        VLKCS036
01109          UNTIL PV-SUB < +1                                        VLKCS036
01110 *                                                                 VLKCS036
01111      IF  PS-NO-ERROR                                              VLKCS036
01112          PERFORM 3400-CHECK-RANGE-SEQUENCE                        VLKCS036
01113      END-IF.                                                      VLKCS036
01114 *                                                                 VLKCS036
01115      IF  ((PS-NO-ERROR)                                           VLKCS036
01116        AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   VLKCS036
01117        AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    VLKCS036
01118              PERFORM 3500-MARK-RANGE-AS-SELECTED                  VLKCS036
01119      END-IF.                                                      VLKCS036
01120  EJECT                                                            VLKCS036
01121 *----------------------------------------------------------------*VLKCS036
01122 *    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *VLKCS036
01123 *    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*VLKCS036
01124 *    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *VLKCS036
01125 *                                                                *VLKCS036
01126 *    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *VLKCS036
01127 *    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *VLKCS036
01128 *    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *VLKCS036
01129 *    US IN THE 2ND BLOCK OF THE ARRAY.                           *VLKCS036
01130 *----------------------------------------------------------------*VLKCS036
01131                                                                   VLKCS036
01132  3100-SET-SUBSCRIPTS.                                             VLKCS036
01133                                                                   VLKCS036
01134      COMPUTE ASC-ITEM-SUB =                                       VLKCS036
01135          (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        VLKCS036
01136                                                                   VLKCS036
01137      IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         VLKCS036
01138          SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            VLKCS036
01139                                                                   VLKCS036
01140          MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               VLKCS036
01141      ELSE                                                         VLKCS036
01142          MOVE +1                     TO ASC-BLK-SUB               VLKCS036
01143      END-IF.                                                      VLKCS036
01144 ******************************************************************VLKCS036
01145 ** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **VLKCS036
01146 ******************************************************************VLKCS036
01147                                                                   VLKCS036
01148  3200-RESET-ATTRIBUTES.                                           VLKCS036
01149      MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   VLKCS036
01150      MOVE DP015-GREEN              TO ASTRTITC.                   VLKCS036
01151      MOVE DP015-UNDERLINE          TO ASTRTITH.                   VLKCS036
01152 *                                                                 VLKCS036
01153 *    PERFORM                                                      VLKCS036
01154 *        VARYING PV-SUB                                           VLKCS036
01155 *        FROM 1 BY 1                                              VLKCS036
01156 *        UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        VLKCS036
01157 *            MOVE DP015-UNP-ALP-NOR-OFF                           VLKCS036
01158 *                                      TO MR-SELECTA (PV-SUB)     VLKCS036
01159 *            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)     VLKCS036
01160 *            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)     VLKCS036
01161 *    END-PERFORM.                                                 VLKCS036
01162 ******************************************************************VLKCS036
01163 ** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **VLKCS036
01164 ** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **VLKCS036
01165 ** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **VLKCS036
01166 ** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **VLKCS036
01167 ******************************************************************VLKCS036
                                                                                
01168  3300-EDIT-SELECTIONS.                                            VLKCS036
                                                                                
01169      EVALUATE TRUE                                                VLKCS036
01170          WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     VLKCS036
01171              = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         VLKCS036
01172                  CONTINUE                                         VLKCS036
01173          WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         VLKCS036
01174              IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        VLKCS036
01175                  ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   VLKCS036
01176                  MOVE ASC-TEMP-SELECTED-SW                        VLKCS036
01177                                       (ASC-BLK-SUB ASC-ITEM-SUB)  VLKCS036
01178                                 TO ASC-SELECTED-SW                VLKCS036
01179                                       (ASC-BLK-SUB ASC-ITEM-SUB)  VLKCS036
01180              END-IF                                               VLKCS036
01181          WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     VLKCS036
01182                  = SPACE                                          VLKCS036
01183              EVALUATE TRUE                                        VLKCS036
01184                  WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       VLKCS036
01185                      SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMSVLKCS036
01186                      MOVE SPACE TO ASC-SELECTED-SW                VLKCS036
01187                                       (ASC-BLK-SUB ASC-ITEM-SUB)  VLKCS036
01188                  WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        VLKCS036
01189                      MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    VLKCS036
01190                      MOVE SPACE TO ASC-SELECTED-SW                VLKCS036
01191                                       (ASC-BLK-SUB ASC-ITEM-SUB)  VLKCS036
01192                  WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          VLKCS036
01193                      MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      VLKCS036
01194                      MOVE SPACE TO ASC-SELECTED-SW                VLKCS036
01195                                       (ASC-BLK-SUB ASC-ITEM-SUB)  VLKCS036
01196              END-EVALUATE                                         VLKCS036
01197          WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           VLKCS036
01198              IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            VLKCS036
01199                  SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    VLKCS036
01200              END-IF                                               VLKCS036
01201              PERFORM 3310-EDIT-RANGE                              VLKCS036
01202          WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             VLKCS036
01203              IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            VLKCS036
01204                  SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    VLKCS036
01205              END-IF                                               VLKCS036
01206              PERFORM 3310-EDIT-RANGE                              VLKCS036
01207          WHEN OTHER                                               VLKCS036
01208              MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           VLKCS036
01209              SET DP020-MSG-FATAL    TO TRUE                       VLKCS036
01210              MOVE -1                TO MR-SELECTL (PV-SUB)        VLKCS036
01211              SET DP030-SET-CURSOR-APPL-1                          VLKCS036
01212                                     TO TRUE                       VLKCS036
01213              MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        VLKCS036
01214              MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        VLKCS036
01215              SET PS-ERROR TO TRUE                                 VLKCS036
01216              IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            VLKCS036
01217                  SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     VLKCS036
01218                  MOVE SPACE         TO ASC-SELECTED-SW            VLKCS036
01219                                         (ASC-BLK-SUB ASC-ITEM-SUB)VLKCS036
01220              END-IF                                               VLKCS036
01221      END-EVALUATE.                                                VLKCS036
01222                                                                   VLKCS036
01223      SUBTRACT +1             FROM PV-ITEM-IN-USE.                 VLKCS036
01224      SUBTRACT +1 FROM ASC-ITEM-SUB.                               VLKCS036
01225      IF  ASC-ITEM-SUB < 1                                         VLKCS036
01226          SUBTRACT +1 FROM ASC-BLK-SUB                             VLKCS036
01227          MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                VLKCS036
01228      END-IF.                                                      VLKCS036
01229 ******************************************************************VLKCS036
01230 ** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **VLKCS036
01231 ** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **VLKCS036
01232 ** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**VLKCS036
01233 ** THE ENDING.                                                  **VLKCS036
01234 ******************************************************************VLKCS036
01235  3310-EDIT-RANGE.                                                 VLKCS036
01236      IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                VLKCS036
01237          IF  ASC-START-OF-SELECTED-RANGE = ZERO                   VLKCS036
01238              MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)VLKCS036
01239                                    TO ASC-SELECTED-SW             VLKCS036
01240                                         (ASC-BLK-SUB ASC-ITEM-SUB)VLKCS036
01241              MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE VLKCS036
01242          ELSE                                                     VLKCS036
01243              IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     VLKCS036
01244                  CONTINUE                                         VLKCS036
01245              ELSE                                                 VLKCS036
01246 *                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        VLKCS036
01247                  MOVE PC-TSYMSG-00054                             VLKCS036
01248                                    TO DP020-MSG-NUMBER            VLKCS036
01249                  SET DP020-MSG-FATAL                              VLKCS036
01250                                    TO TRUE                        VLKCS036
01251                  MOVE -1           TO MR-SELECTL (PV-SUB)         VLKCS036
01252                  SET DP030-SET-CURSOR-APPL-1                      VLKCS036
01253                                    TO TRUE                        VLKCS036
01254                  MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         VLKCS036
01255                  MOVE DP015-UNDERLINE                             VLKCS036
01256                                    TO MR-SELECTH (PV-SUB)         VLKCS036
01257                  SET PS-ERROR      TO TRUE                        VLKCS036
01258              END-IF                                               VLKCS036
01259          END-IF                                                   VLKCS036
01260      ELSE                                                         VLKCS036
01261          IF  ASC-END-OF-SELECTED-RANGE = ZERO                     VLKCS036
01262              MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) VLKCS036
01263                                    TO ASC-SELECTED-SW             VLKCS036
01264                                      (ASC-BLK-SUB ASC-ITEM-SUB)   VLKCS036
01265              MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   VLKCS036
01266          ELSE                                                     VLKCS036
01267              IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       VLKCS036
01268                  CONTINUE                                         VLKCS036
01269              ELSE                                                 VLKCS036
01270 *                -- ONLY ONE END-OF-RANGE ALLOWED --              VLKCS036
01271                  MOVE PC-TSYMSG-00055                             VLKCS036
01272                                    TO DP020-MSG-NUMBER            VLKCS036
01273                  SET DP020-MSG-FATAL                              VLKCS036
01274                                    TO TRUE                        VLKCS036
01275                  MOVE -1           TO MR-SELECTL (PV-SUB)         VLKCS036
01276                  SET DP030-SET-CURSOR-APPL-1                      VLKCS036
01277                                    TO TRUE                        VLKCS036
01278                  SET PS-ERROR      TO TRUE                        VLKCS036
01279              END-IF                                               VLKCS036
01280          END-IF                                                   VLKCS036
01281      END-IF.                                                      VLKCS036
01282 *                                                                 VLKCS036
01283 ******************************************************************VLKCS036
01284 ** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **VLKCS036
01285 ** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **VLKCS036
01286 ******************************************************************VLKCS036
01287  3400-CHECK-RANGE-SEQUENCE.                                       VLKCS036
01288      IF  ASC-START-OF-SELECTED-RANGE > ZERO                       VLKCS036
01289        AND  ASC-END-OF-SELECTED-RANGE > ZERO                      VLKCS036
01290        AND  ASC-START-OF-SELECTED-RANGE >                         VLKCS036
01291                                          ASC-END-OF-SELECTED-RANGEVLKCS036
01292 *        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                VLKCS036
01293          MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 VLKCS036
01294          SET DP020-MSG-FATAL TO TRUE                              VLKCS036
01295          SET PS-ERROR TO TRUE                                     VLKCS036
01296          PERFORM 3410-POSITION-AT-ERROR                           VLKCS036
01297      END-IF.                                                      VLKCS036
01298 ******************************************************************VLKCS036
01299 ** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **VLKCS036
01300 ** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **VLKCS036
01301 ** SHOULD BE POSITIONED ON A RANGE ERROR.                       **VLKCS036
01302 ******************************************************************VLKCS036
01303  3410-POSITION-AT-ERROR.                                          VLKCS036
01304      SET DP030-SET-CURSOR-APPL-1                                  VLKCS036
01305                                    TO TRUE.                       VLKCS036
01306      COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 VLKCS036
01307                     - PV-TOP-ITEM + 1.                            VLKCS036
01308      IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      VLKCS036
01309          CONTINUE                                                 VLKCS036
01310      ELSE                                                         VLKCS036
01311          MOVE -1                   TO MR-SELECTL (PV-SUB)         VLKCS036
01312          MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         VLKCS036
01313          MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         VLKCS036
01314      END-IF.                                                      VLKCS036
01315 *                                                                 VLKCS036
01316      COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   VLKCS036
01317                     - PV-TOP-ITEM + 1.                            VLKCS036
01318      IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      VLKCS036
01319          CONTINUE                                                 VLKCS036
01320      ELSE                                                         VLKCS036
01321          MOVE -1                   TO MR-SELECTL (PV-SUB)         VLKCS036
01322          MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         VLKCS036
01323          MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         VLKCS036
01324      END-IF.                                                      VLKCS036
01325  EJECT                                                            VLKCS036
01326 *----------------------------------------------------------------*VLKCS036
01327 *    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *VLKCS036
01328 *    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *VLKCS036
01329 *    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *VLKCS036
01330 *----------------------------------------------------------------*VLKCS036
01331                                                                   VLKCS036
01332  3500-MARK-RANGE-AS-SELECTED.                                     VLKCS036
01333      MOVE +1                       TO  ASC-BLK-SUB.               VLKCS036
01334      PERFORM 3510-MARK-SELECTED-INDS                              VLKCS036
01335          VARYING ASC-ITEM-SUB                                     VLKCS036
01336          FROM 1 BY 1                                              VLKCS036
01337          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VLKCS036
01338                                                                   VLKCS036
01339      ADD +1                        TO ASC-BLK-SUB.                VLKCS036
01340      PERFORM 3510-MARK-SELECTED-INDS                              VLKCS036
01341          VARYING ASC-ITEM-SUB                                     VLKCS036
01342          FROM 1 BY 1                                              VLKCS036
01343          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VLKCS036
01344                                                                   VLKCS036
01345      MOVE ASC-LIST-ITEM-NUMBER(1 1)                               VLKCS036
01346                                    TO  PV-LIST-ITEM-NUMBER.       VLKCS036
01347      COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            VLKCS036
01348          1 + ((PV-LIST-ITEM-NUMBER - 1) /                         VLKCS036
01349                PC-ITEMS-PER-PANEL).                               VLKCS036
01350                                                                   VLKCS036
01351      MOVE ASC-START-OF-SELECTED-RANGE                             VLKCS036
01352                                    TO PV-START-OF-SELECTED-RANGE. VLKCS036
01353      COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            VLKCS036
01354          1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  VLKCS036
01355                PC-ITEMS-PER-PANEL).                               VLKCS036
01356                                                                   VLKCS036
01357      MOVE ASC-END-OF-SELECTED-RANGE                               VLKCS036
01358                                    TO  PV-END-OF-SELECTED-RANGE.  VLKCS036
01359      COMPUTE PV-LAST-BLOCK-IN-RANGE =                             VLKCS036
01360          1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    VLKCS036
01361                PC-ITEMS-PER-PANEL).                               VLKCS036
01362      COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             VLKCS036
01363          PV-FIRST-BLOCK-IN-ARRAY + 1.                             VLKCS036
01364                                                                   VLKCS036
01365      IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    VLKCS036
01366         (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        VLKCS036
01367          MOVE +1                   TO ASC-BLK-SUB                 VLKCS036
01368          PERFORM 5100-WRITE-TEMP-STORAGE                          VLKCS036
01369          COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         VLKCS036
01370              PV-FIRST-BLOCK-IN-ARRAY - 1                          VLKCS036
01371                                                                   VLKCS036
01372          PERFORM                                                  VLKCS036
01373              UNTIL PV-FIRST-BLOCK-IN-RANGE >                      VLKCS036
01374                    PV-PREV-BLOCK-IN-ARRAY                         VLKCS036
01375              MOVE PV-FIRST-BLOCK-IN-RANGE                         VLKCS036
01376                                    TO PV-BLOCK-NUMBER             VLKCS036
01377              PERFORM 4410-READ-TEMP-STORAGE                       VLKCS036
01378              PERFORM 3510-MARK-SELECTED-INDS                      VLKCS036
01379                  VARYING ASC-ITEM-SUB                             VLKCS036
01380                  FROM 1 BY 1                                      VLKCS036
01381                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VLKCS036
01382              PERFORM 5100-WRITE-TEMP-STORAGE                      VLKCS036
01383              ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     VLKCS036
01384          END-PERFORM                                              VLKCS036
01385                                                                   VLKCS036
01386          COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         VLKCS036
01387              PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     VLKCS036
01388          PERFORM                                                  VLKCS036
01389              UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       VLKCS036
01390                    PV-LAST-BLOCK-IN-RANGE                         VLKCS036
01391              MOVE PV-NEXT-BLOCK-IN-ARRAY                          VLKCS036
01392                                    TO PV-BLOCK-NUMBER             VLKCS036
01393              PERFORM 4410-READ-TEMP-STORAGE                       VLKCS036
01394              PERFORM 3510-MARK-SELECTED-INDS                      VLKCS036
01395                  VARYING ASC-ITEM-SUB                             VLKCS036
01396                  FROM 1 BY 1                                      VLKCS036
01397                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VLKCS036
01398              PERFORM 5100-WRITE-TEMP-STORAGE                      VLKCS036
01399              ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      VLKCS036
01400          END-PERFORM                                              VLKCS036
01401                                                                   VLKCS036
01402          MOVE PV-FIRST-BLOCK-IN-ARRAY                             VLKCS036
01403                                    TO PV-BLOCK-NUMBER             VLKCS036
01404          PERFORM 4410-READ-TEMP-STORAGE                           VLKCS036
01405      END-IF.                                                      VLKCS036
01406                                                                   VLKCS036
01407      MOVE +0                       TO ASC-START-OF-SELECTED-RANGE VLKCS036
01408                                       ASC-END-OF-SELECTED-RANGE.  VLKCS036
01409                                                                   VLKCS036
01410  EJECT                                                            VLKCS036
01411 *----------------------------------------------------------------*VLKCS036
01412 * SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *VLKCS036
01413 *----------------------------------------------------------------*VLKCS036
01414                                                                   VLKCS036
01415  3510-MARK-SELECTED-INDS.                                         VLKCS036
01416                                                                   VLKCS036
01417      IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         VLKCS036
01418                                 ASC-ITEM-SUB) >                   VLKCS036
01419          ASC-START-OF-SELECTED-RANGE)                             VLKCS036
01420      OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         VLKCS036
01421                                 ASC-ITEM-SUB) =                   VLKCS036
01422          ASC-START-OF-SELECTED-RANGE)                             VLKCS036
01423                                                                   VLKCS036
01424          IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     VLKCS036
01425                                     ASC-ITEM-SUB) <               VLKCS036
01426              ASC-END-OF-SELECTED-RANGE)                           VLKCS036
01427          OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     VLKCS036
01428                                     ASC-ITEM-SUB) =               VLKCS036
01429              ASC-END-OF-SELECTED-RANGE)                           VLKCS036
01430                                                                   VLKCS036
01431              IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          VLKCS036
01432                  SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   VLKCS036
01433                      ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   VLKCS036
01434                                TO TRUE                            VLKCS036
01435                  SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              VLKCS036
01436                                TO TRUE                            VLKCS036
01437                  ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    VLKCS036
01438              END-IF                                               VLKCS036
01439          END-IF                                                   VLKCS036
01440      END-IF.                                                      VLKCS036
01441                                                                   VLKCS036
01442  EJECT                                                            VLKCS036
01443 *----------------------------------------------------------------*VLKCS036
01444 *    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *VLKCS036
01445 *    INITIALIZE ALL COUNTERS AND FLAGS.                          *VLKCS036
01446 *    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *VLKCS036
01447 *    DISPLAY THE PANEL TO USER.                                  *VLKCS036
01448 *----------------------------------------------------------------*VLKCS036
01449                                                                   VLKCS036
01450  4000-BUILD-INITIAL-PANEL.                                        VLKCS036
01451                                                                   VLKCS036
01452      INITIALIZE                  ASC-BLOCK-ENTRIES (1)            VLKCS036
01453                                  ASC-BLOCK-ENTRIES (2).           VLKCS036
01454      MOVE +1                 TO ASC-BLK-SUB.                      VLKCS036
01455      SET ASC-ITEMS-LEFT-ON-DB                                     VLKCS036
01456                              TO TRUE.                             VLKCS036
01457                                                                   VLKCS036
01458      MOVE +0                 TO ASC-ITEM-SUB                      VLKCS036
01459                                 ASC-NUMBER-OF-ITEMS-READ          VLKCS036
01460                                 ASC-NUMBER-OF-SELECTED-ITEMS      VLKCS036
01461                                 ASC-HIGHEST-BLOCK-WRITTEN         VLKCS036
01462                                 ASC-START-OF-SELECTED-RANGE       VLKCS036
01463                                 ASC-END-OF-SELECTED-RANGE         VLKCS036
01464                                 ASC-ITEM-AT-TOP-OF-PANEL.         VLKCS036
01465      PERFORM 4100-PREPARE-CURSOR                                  VLKCS036
01466                                                                   VLKCS036
01467      PERFORM 4010-OPEN-CURSOR.                                    VLKCS036
01468                                                                   VLKCS036
01469      PERFORM 4300-READ-ITEMS-FROM-DB.                             VLKCS036
01470                                                                   VLKCS036
01471      PERFORM 4020-CLOSE-CURSOR.                                   VLKCS036
01472                                                                   VLKCS036
01473      MOVE +1                   TO  PV-TOP-ITEM.                   VLKCS036
01474      IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          VLKCS036
01475          SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    VLKCS036
01476          SET DP020-MSG-FATAL   TO  TRUE                           VLKCS036
01477          MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               VLKCS036
01478      ELSE                                                         VLKCS036
01479          MOVE -1               TO MR-SELECTL (1)                  VLKCS036
01480          SET DP030-SET-CURSOR-APPL-1                              VLKCS036
01481                                TO TRUE                            VLKCS036
01482          PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     VLKCS036
01483      END-IF.                                                      VLKCS036
01484  EJECT                                                            VLKCS036
01485 *----------------------------------------------------------------*VLKCS036
01486 * OPEN THE TMESSAGE CURSOR.                                      *VLKCS036
01487 *   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *VLKCS036
01488 *   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *VLKCS036
01489 *   USER.                                                        *VLKCS036
01490 *----------------------------------------------------------------*VLKCS036
01491                                                                   VLKCS036
01492  4010-OPEN-CURSOR.                                                VLKCS036
01493      PERFORM                                                      VLKCS036
01494          WITH TEST AFTER                                          VLKCS036
01495          VARYING PV-RETRY-COUNTER                                 VLKCS036
01496          FROM 1 BY 1                                              VLKCS036
01497          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               VLKCS036
01498                    OR (SQLCODE = ZERO))                           VLKCS036
01499          EVALUATE TRUE                                            VLKCS036
01500              WHEN ASC-SHIP-CURSOR                                 VLKCS036
01501                  MOVE 'CURSOR:  SHIP_CURSOR'                      VLKCS036
01502                                    TO DP013-MESSAGE-TEXT (2)      VLKCS036
01503                  EXEC SQL                                         VLKCS036
01504                       OPEN SHIP_CURSOR                            VLKCS036
01505                  END-EXEC                                         VLKCS036
01506                                                                   VLKCS036
01507              WHEN ASC-SCAC-CURSOR                                 VLKCS036
01508                  MOVE 'CURSOR:  SCAC_CURSOR'                      VLKCS036
01509                                    TO DP013-MESSAGE-TEXT (2)      VLKCS036
01510                  EXEC SQL                                         VLKCS036
01511                       OPEN SCAC_CURSOR                            VLKCS036
01512                  END-EXEC                                         VLKCS036
01513                                                                   VLKCS036
01514              WHEN ASC-DATE-CURSOR                                 VLKCS036
01515                  MOVE 'CURSOR:  DATE_CURSOR'                      VLKCS036
01516                                    TO DP013-MESSAGE-TEXT (2)      VLKCS036
01517                  EXEC SQL                                         VLKCS036
01518                       OPEN DATE_CURSOR                            VLKCS036
01519                  END-EXEC                                         VLKCS036
01520          END-EVALUATE                                             VLKCS036
01521                                                                   VLKCS036
01522          EVALUATE TRUE                                            VLKCS036
01523              WHEN SQLCODE = ZERO                                  VLKCS036
01524              WHEN SQLCODE = -904                                  VLKCS036
01525              WHEN SQLCODE = -913                                  VLKCS036
01526                  CONTINUE                                         VLKCS036
01527              WHEN SQLWARN0 NOT = SPACES                           VLKCS036
01528              WHEN SQLCODE < ZERO                                  VLKCS036
01529              WHEN SQLCODE > ZERO                                  VLKCS036
01530                  MOVE '4010-OPEN-CURSOR'                          VLKCS036
01531                                    TO DP013-PARAGRAPH             VLKCS036
01532                  MOVE 'OPEN SYSTEM MESSAGE CURSOR - '             VLKCS036
01533                                    TO DP013-MESSAGE-TEXT (1)      VLKCS036
01534                  MOVE SQLCA        TO DP013-SQLCA                 VLKCS036
01535                  MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)    VLKCS036
01536                  SET DP013-DB2-ABEND                              VLKCS036
01537                      DP013-XCTL-DISPLAY-RESTART TO TRUE           VLKCS036
01538                  PERFORM DP013-0000-PROCESS-ABEND                 VLKCS036
01539          END-EVALUATE                                             VLKCS036
01540      END-PERFORM.                                                 VLKCS036
01541 *                                                                 VLKCS036
01542      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        VLKCS036
01543          MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             VLKCS036
01544          MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   VLKCS036
01545                                    TO DP013-MESSAGE-TEXT (1)      VLKCS036
01546          MOVE SQLCA                TO DP013-SQLCA                 VLKCS036
01547          MOVE 'TSYMSG  '           TO DP013-DB2-TABLE-NAME (1)    VLKCS036
01548          SET DP013-DB2-ABEND                                      VLKCS036
01549              DP013-XCTL-DISPLAY-RESTART                           VLKCS036
01550                                    TO TRUE                        VLKCS036
01551          PERFORM DP013-0000-PROCESS-ABEND                         VLKCS036
01552      END-IF.                                                      VLKCS036
01553                                                                   VLKCS036
01554  EJECT                                                            VLKCS036
01555 *----------------------------------------------------------------*VLKCS036
01556 * CLOSE THE TMESSAGE CURSOR.                                     *VLKCS036
01557 *   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *VLKCS036
01558 *   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *VLKCS036
01559 *   USER.                                                        *VLKCS036
01560 *----------------------------------------------------------------*VLKCS036
01561                                                                   VLKCS036
01562  4020-CLOSE-CURSOR.                                               VLKCS036
01563      EVALUATE TRUE                                                VLKCS036
01564          WHEN ASC-SHIP-CURSOR                                     VLKCS036
01565              EXEC SQL                                             VLKCS036
01566                  CLOSE SHIP_CURSOR                                VLKCS036
01567              END-EXEC                                             VLKCS036
01568                                                                   VLKCS036
01569          WHEN ASC-DATE-CURSOR                                     VLKCS036
01570              EXEC SQL                                             VLKCS036
01571                  CLOSE DATE_CURSOR                                VLKCS036
01572              END-EXEC                                             VLKCS036
01573                                                                   VLKCS036
01574          WHEN ASC-SCAC-CURSOR                                     VLKCS036
01575              EXEC SQL                                             VLKCS036
01576                  CLOSE SCAC_CURSOR                                VLKCS036
01577              END-EXEC                                             VLKCS036
01578      END-EVALUATE.                                                VLKCS036
01579 *                                                                 VLKCS036
01580      EVALUATE TRUE                                                VLKCS036
01581          WHEN SQLCODE = ZERO                                      VLKCS036
01582              CONTINUE                                             VLKCS036
01583          WHEN SQLWARN0 NOT = SPACES                               VLKCS036
01584          WHEN SQLCODE < ZERO                                      VLKCS036
01585          WHEN SQLCODE > ZERO                                      VLKCS036
01586              MOVE '4020-CLOSE-CURSOR'                             VLKCS036
01587                                TO DP013-PARAGRAPH                 VLKCS036
01588              MOVE 'CLOSE SYSTEM MESSAGE CURSOR '                  VLKCS036
01589                                TO DP013-MESSAGE-TEXT (1)          VLKCS036
01590              MOVE SQLCA        TO DP013-SQLCA                     VLKCS036
01591              MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        VLKCS036
01592              SET DP013-DB2-ABEND                                  VLKCS036
01593                  DP013-XCTL-DISPLAY-RESTART TO TRUE               VLKCS036
01594              PERFORM DP013-0000-PROCESS-ABEND                     VLKCS036
01595      END-EVALUATE.                                                VLKCS036
01596                                                                   VLKCS036
01597  EJECT                                                            VLKCS036
01598 *----------------------------------------------------------------*VLKCS036
01599 *    SET UP THE HOST VARIABLES.                                  *VLKCS036
01600 *----------------------------------------------------------------*VLKCS036
01601                                                                   VLKCS036
01602  4100-PREPARE-CURSOR.                                             VLKCS036
01603                                                                   VLKCS036
01604      SET ASC-NO-CURSOR         TO TRUE.                           VLKCS036
01605                                                                   VLKCS036
           EVALUATE TRUE                                                        
               WHEN DK-SHIPT-GRP-ID       GREATER THAN ZERO                     
01607              SET ASC-SHIP-CURSOR    TO TRUE                       VLKCS036
               WHEN DK-SCAC               GREATER THAN SPACES                   
01612              SET ASC-SCAC-CURSOR    TO TRUE                       VLKCS036
01647          WHEN OTHER                                               VLKCS036
01648              SET ASC-DATE-CURSOR    TO TRUE                       VLKCS036
01652      END-EVALUATE.                                                VLKCS036
01653                                                                   VLKCS036
01666  EJECT                                                            VLKCS036
01667 *----------------------------------------------------------------*VLKCS036
01668 *    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *VLKCS036
01669 *    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *VLKCS036
01670 *    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *VLKCS036
01671 *    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *VLKCS036
01672 *    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *VLKCS036
01673 *                                                                *VLKCS036
01674 *    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *VLKCS036
01675 *    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *VLKCS036
01676 *    UPON INITIALIZATION.                                        *VLKCS036
01677 *----------------------------------------------------------------*VLKCS036
01678                                                                   VLKCS036
01679  4300-READ-ITEMS-FROM-DB.                                         VLKCS036
01680                                                                   VLKCS036
01681      PERFORM                                                      VLKCS036
01682          VARYING PV-READ-COUNT                                    VLKCS036
01683          FROM 1 BY 1                                              VLKCS036
01684          UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    VLKCS036
01685             OR (ASC-NO-ITEMS-LEFT-ON-DB))                         VLKCS036
01686                                                                   VLKCS036
01687          PERFORM 4310-FETCH                                       VLKCS036
01688                                                                   VLKCS036
01689          IF  ASC-ITEMS-LEFT-ON-DB                                 VLKCS036
01690              IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                VLKCS036
01691                  ADD +1            TO ASC-ITEM-SUB                VLKCS036
01692              ELSE                                                 VLKCS036
01693                  ADD +1            TO ASC-BLK-SUB                 VLKCS036
01694                  MOVE +1           TO ASC-ITEM-SUB                VLKCS036
01695                                                                   VLKCS036
01696                  IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         VLKCS036
01697                      MOVE +1       TO ASC-BLK-SUB                 VLKCS036
01698                      SET ASC-BLOCK-MODIFIED (1)                   VLKCS036
01699                                    TO TRUE                        VLKCS036
01700                      PERFORM 5100-WRITE-TEMP-STORAGE              VLKCS036
01701                      MOVE ASC-BLOCK-ENTRIES                       VLKCS036
01702                                (PC-MAX-BLOCKS-IN-ARRAY)           VLKCS036
01703                                 TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) VLKCS036
01704                      ADD +1        TO ASC-BLK-SUB                 VLKCS036
01705                      INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   VLKCS036
01706                      SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      VLKCS036
01707                                    TO TRUE                        VLKCS036
01708                  END-IF                                           VLKCS036
01709              END-IF                                               VLKCS036
01710              ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    VLKCS036
01711              MOVE ASC-NUMBER-OF-ITEMS-READ                        VLKCS036
01712                                    TO ASC-LIST-ITEM-NUMBER        VLKCS036
01713                                       (ASC-BLK-SUB ASC-ITEM-SUB)  VLKCS036
                   MOVE REQSHP-SHIPT-GRP-ID                                     
                                         TO ASC-SHIPT-GRP-ID                    
 1713                                       (ASC-BLK-SUB ASC-ITEM-SUB)  VLKCS036
01754              MOVE PTKSHP-SCAC-CDE  TO ASC-SCAC                    VLKCS036
 1713                                       (ASC-BLK-SUB ASC-ITEM-SUB)  VLKCS036
                   MOVE PTKSHP-CARR-SHIPT-ID                            VLKCS036
                                         TO ASC-CARRIER-SHIPT-NBR               
 1713                                       (ASC-BLK-SUB ASC-ITEM-SUB)  VLKCS036
                   MOVE PTKSHP-SHIPT-DTE TO ASC-SHIPT-DATE              VLKCS036
 1713                                       (ASC-BLK-SUB ASC-ITEM-SUB)  VLKCS036
                   MOVE PTKREQ-PO-NBR    TO ASC-PO-NUMBER                       
 1713                                       (ASC-BLK-SUB ASC-ITEM-SUB)  VLKCS036
                   MOVE ENTNME-ENT-NAME-DESC                                    
                                         TO ASC-VND-NAME                        
 1713                                       (ASC-BLK-SUB ASC-ITEM-SUB)  VLKCS036
                                                                                
      *            IF THIS IS A COMPLETELY NEW SHIPMENT, DISPLAY EVERYTHING,    
      *            INCLUDING SELECTION FIELD                                    
                   IF REQSHP-SHIPT-GRP-ID = ASC-SAVE-SHIPT-GRP-ID               
                       SET ASC-DETAIL-DISP-NO-SELECT                            
 1713                      (ASC-BLK-SUB ASC-ITEM-SUB)     TO TRUE             36
      *                IF SAME SHIPMENT AND SAME SHIP-ID, DONT DISPLAY DETAIL   
      *                OTHERWISE DISPLAYS DETAIL (EXCEPT FOR SELECTION)         
                       IF PTKSHP-SHIPT-NBR = ASC-SAVE-SHIPT-NBR                 
                           SET ASC-NO-DETAIL-DISP                               
 1713                          (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE             36
                       ELSE                                                     
                           MOVE PTKSHP-SHIPT-NBR                                
                                TO ASC-SAVE-SHIPT-NBR                           
                       END-IF                                                   
                   ELSE                                                         
                       MOVE REQSHP-SHIPT-GRP-ID                                 
                                TO ASC-SAVE-SHIPT-GRP-ID                        
                       MOVE PTKSHP-SHIPT-NBR                                    
                                TO ASC-SAVE-SHIPT-NBR                           
                       SET ASC-DETAIL-DISP                                      
 1713                      (ASC-BLK-SUB ASC-ITEM-SUB)     TO TRUE             36
01725              END-IF                                               VLKCS036
01725          END-IF                                                   VLKCS036
01726      END-PERFORM.                                                 VLKCS036
01727                                                                   VLKCS036
01728      IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          VLKCS036
01729          MOVE +1               TO ASC-BLK-SUB                     VLKCS036
01730          PERFORM 5100-WRITE-TEMP-STORAGE                          VLKCS036
01731          ADD +1                TO ASC-BLK-SUB                     VLKCS036
01732          PERFORM 5100-WRITE-TEMP-STORAGE                          VLKCS036
01733                                                                   VLKCS036
01734          MOVE 1                TO ASC-BLK-SUB                     VLKCS036
01735                                   PV-BLOCK-NUMBER                 VLKCS036
01736          PERFORM 4410-READ-TEMP-STORAGE                           VLKCS036
01737          IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             VLKCS036
01738              MOVE 2            TO ASC-BLK-SUB                     VLKCS036
01739                                   PV-BLOCK-NUMBER                 VLKCS036
01740              PERFORM 4410-READ-TEMP-STORAGE                       VLKCS036
01741          END-IF                                                   VLKCS036
01742      END-IF.                                                      VLKCS036
01743  EJECT                                                            VLKCS036
01744 *----------------------------------------------------------------*VLKCS036
01745 *    FETCH THE MESSAGE CURSOR.                                   *VLKCS036
01746 *----------------------------------------------------------------*VLKCS036
01747                                                                   VLKCS036
01748  4310-FETCH.                                                      VLKCS036
01749                                                                   VLKCS036
01750      EVALUATE TRUE                                                VLKCS036
01751          WHEN ASC-SHIP-CURSOR                                     VLKCS036
01752               EXEC SQL                                            VLKCS036
01753                    FETCH SHIP_CURSOR                              VLKCS036
01754                    INTO  :REQSHP-SHIPT-GRP-ID                     VLKCS036
01755                        , :PTKSHP-SCAC-CDE                         VLKCS036
01756                        , :PTKSHP-CARR-SHIPT-ID                    VLKCS036
01757                        , :PTKSHP-SHIPT-DTE                        VLKCS036
01757                        , :PTKSHP-SHIPT-NBR                        VLKCS036
                             , :PTKREQ-PO-NBR                                   
                             , :ENTNME-ENT-NAME-DESC                            
01758               END-EXEC                                            VLKCS036
01759                                                                   VLKCS036
01760          WHEN ASC-SCAC-CURSOR                                     VLKCS036
01761               EXEC SQL                                            VLKCS036
01762                    FETCH SCAC_CURSOR                              VLKCS036
01754                    INTO  :REQSHP-SHIPT-GRP-ID                     VLKCS036
01755                        , :PTKSHP-SCAC-CDE                         VLKCS036
01756                        , :PTKSHP-CARR-SHIPT-ID                    VLKCS036
01757                        , :PTKSHP-SHIPT-DTE                        VLKCS036
01757                        , :PTKSHP-SHIPT-NBR                        VLKCS036
                             , :PTKREQ-PO-NBR                                   
                             , :ENTNME-ENT-NAME-DESC                            
01768               END-EXEC                                            VLKCS036
01769                                                                   VLKCS036
01770          WHEN ASC-DATE-CURSOR                                     VLKCS036
01771               EXEC SQL                                            VLKCS036
01772                    FETCH DATE_CURSOR                              VLKCS036
01754                    INTO  :REQSHP-SHIPT-GRP-ID                     VLKCS036
01755                        , :PTKSHP-SCAC-CDE                         VLKCS036
01756                        , :PTKSHP-CARR-SHIPT-ID                    VLKCS036
01757                        , :PTKSHP-SHIPT-DTE                        VLKCS036
01757                        , :PTKSHP-SHIPT-NBR                        VLKCS036
                             , :PTKREQ-PO-NBR                                   
                             , :ENTNME-ENT-NAME-DESC                            
01778               END-EXEC                                            VLKCS036
01779      END-EVALUATE.                                                VLKCS036
01780                                                                   VLKCS036
01781      EVALUATE TRUE                                                VLKCS036
01782          WHEN SQLCODE = ZERO                                      VLKCS036
01783          WHEN SQLCODE = +100                                      VLKCS036
01784               CONTINUE                                            VLKCS036
01785          WHEN SQLWARN0 NOT = SPACE                                VLKCS036
01786          WHEN SQLCODE NOT = ZERO                                  VLKCS036
01787               MOVE '4310-FETCH-CURSOR'                            VLKCS036
01788                                TO DP013-PARAGRAPH                 VLKCS036
01789               MOVE 'FETCH MESSAGE CURSOR'                         VLKCS036
01790                                TO DP013-MESSAGE-TEXT (1)          VLKCS036
01791               MOVE SQLCA       TO DP013-SQLCA                     VLKCS036
01792               SET DP013-DB2-ABEND                                 VLKCS036
01793                                TO TRUE                            VLKCS036
01794               PERFORM DP013-0000-PROCESS-ABEND                    VLKCS036
01795      END-EVALUATE.                                                VLKCS036
01796                                                                   VLKCS036
01797      IF  SQLCODE EQUAL +100                                       VLKCS036
01798          SET ASC-NO-ITEMS-LEFT-ON-DB                              VLKCS036
01799                                    TO TRUE                        VLKCS036
01800      END-IF.                                                      VLKCS036
01801                                                                   VLKCS036
01802  EJECT                                                            VLKCS036
01803 *----------------------------------------------------------------*VLKCS036
01804 * MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *VLKCS036
01805 *----------------------------------------------------------------*VLKCS036
01806                                                                   VLKCS036
01807  4400-MOVE-COMMAREA-TO-SCREEN.                                    VLKCS036
01808      IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             VLKCS036
01809          AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          VLKCS036
01810          OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          VLKCS036
01811              MOVE +1    TO ASC-BLK-SUB                            VLKCS036
01812              PERFORM 5100-WRITE-TEMP-STORAGE                      VLKCS036
01813              ADD +1     TO ASC-BLK-SUB                            VLKCS036
01814              PERFORM 5100-WRITE-TEMP-STORAGE                      VLKCS036
01815              DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             VLKCS036
01816                  GIVING PV-BLOCK-NUMBER                           VLKCS036
01817                  REMAINDER PV-REMAINDER                           VLKCS036
01818              IF  PV-REMAINDER > ZERO                              VLKCS036
01819                  ADD +1 TO PV-BLOCK-NUMBER                        VLKCS036
01820              END-IF                                               VLKCS036
01821              MOVE +1    TO ASC-BLK-SUB                            VLKCS036
01822              PERFORM 4410-READ-TEMP-STORAGE                       VLKCS036
01823              ADD +1     TO ASC-BLK-SUB                            VLKCS036
01824                            PV-BLOCK-NUMBER                        VLKCS036
01825              PERFORM 4410-READ-TEMP-STORAGE                       VLKCS036
01826      END-IF.                                                      VLKCS036
01827      MOVE +1            TO ASC-BLK-SUB.                           VLKCS036
01828      COMPUTE ASC-ITEM-SUB =                                       VLKCS036
01829          ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              VLKCS036
01830          + PC-ITEMS-PER-PANEL).                                   VLKCS036
01831 *                                                                 VLKCS036
01832      IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        VLKCS036
01833          ADD +1         TO ASC-BLK-SUB                            VLKCS036
01834          SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            VLKCS036
01835      END-IF.                                                      VLKCS036
01836 *                                                                 VLKCS036
01837      COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           VLKCS036
01838          ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                VLKCS036
01839      PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        VLKCS036
01840      PERFORM 4420-FORMAT-LIST-LINES                               VLKCS036
01841          VARYING PV-SUB                                           VLKCS036
01842          FROM PC-ITEMS-PER-PANEL BY -1                            VLKCS036
01843          UNTIL PV-SUB < +1.                                       VLKCS036
01844 *                                                                 VLKCS036
01845      COMPUTE ASC-ITEMS-DISPLAYED =                                VLKCS036
01846          ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          VLKCS036
01847      MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    VLKCS036
01848                                       ASTRTITO.                   VLKCS036
01849      MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    VLKCS036
01850      MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    VLKCS036
01851      MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            VLKCS036
01852                                    TO ATOTSELO.                   VLKCS036
01853 *                                                                 VLKCS036
01854      IF  DP020-MSG-NUMBER-X = SPACE                               VLKCS036
01855          IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  VLKCS036
01856 *            --- MORE ITEMS TO DISPLAY ----                       VLKCS036
01857              MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            VLKCS036
01858              SET DP020-MSG-INFORMATIONAL TO TRUE                  VLKCS036
01859          END-IF                                                   VLKCS036
01860      END-IF.                                                      VLKCS036
01861 *----------------------------------------------------------------*VLKCS036
01862 *    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *VLKCS036
01863 *----------------------------------------------------------------*VLKCS036
01864                                                                   VLKCS036
01865  4410-READ-TEMP-STORAGE.                                          VLKCS036
01866                                                                   VLKCS036
01867      EXEC CICS                                                    VLKCS036
01868          READQ TS                                                 VLKCS036
01869              QUEUE (ASC-LIST-QUEUE-NAME)                          VLKCS036
01870              INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               VLKCS036
01871              ITEM  (PV-BLOCK-NUMBER)                              VLKCS036
01872              RESP  (PV-CICS-RESP)                                 VLKCS036
01873      END-EXEC.                                                    VLKCS036
01874                                                                   VLKCS036
01875      IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       VLKCS036
01876        OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     VLKCS036
01877          CONTINUE                                                 VLKCS036
01878      ELSE                                                         VLKCS036
01879          SET DP013-CICS-ABEND     TO TRUE                         VLKCS036
01880          SET DP013-NO-ROLLBACK    TO TRUE                         VLKCS036
01881          MOVE '4410-READ-TEMP-STORAGE'                            VLKCS036
01882                                   TO DP013-PARAGRAPH              VLKCS036
01883          MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      VLKCS036
01884                                   TO DP013-MESSAGE-TEXT(1)        VLKCS036
01885          PERFORM DP013-0000-PROCESS-ABEND                         VLKCS036
01886      END-IF.                                                      VLKCS036
01887                                                                   VLKCS036
01888      SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             VLKCS036
01889 *                                                                 VLKCS036
01890      IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         VLKCS036
01891          INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               VLKCS036
01892      END-IF.                                                      VLKCS036
01893  EJECT                                                            VLKCS036
01894 *----------------------------------------------------------------*VLKCS036
01895 *    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *VLKCS036
01896 *----------------------------------------------------------------*VLKCS036
01897                                                                   VLKCS036
01898  4420-FORMAT-LIST-LINES.                                          VLKCS036
01899      IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      VLKCS036
01900          SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                VLKCS036
01901          MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           VLKCS036
01902          MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           VLKCS036
01903          MOVE SPACE              TO MR-SELECTI (PV-SUB)           VLKCS036
01904                                     MR-ACTION (PV-SUB)            VLKCS036
00190                                     MR-SCAC (PV-SUB)              VLKCS036
00190                                     MR-CARRIER-SHIPT-NBR (PV-SUB) VLKCS036
00190                                     MR-SHIPT-DATE (PV-SUB)        VLKCS036
00190                                     MR-PO-NUMBER (PV-SUB)         VLKCS036
00190                                     MR-VND-NAME (PV-SUB)          VLKCS036
01909      ELSE                                                         VLKCS036
01910          IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      VLKCS036
01911                                                    > SPACE        VLKCS036
01912              MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) VLKCS036
01913                                  TO MR-SELECTI (PV-SUB)           VLKCS036
01914          ELSE                                                     VLKCS036
01915              MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      VLKCS036
01916                                  TO MR-SELECTI (PV-SUB)           VLKCS036
01917          END-IF                                                   VLKCS036
01918 *                                                                 VLKCS036
01919          IF  DP030-SET-CURSOR-TRAILER                             VLKCS036
01920              IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)VLKCS036
01921                  > SPACE)                                         VLKCS036
01922                OR (PV-SUB = 1))                                   VLKCS036
01923                 SET DP030-SET-CURSOR-APPL-1 TO TRUE               VLKCS036
01924                 MOVE -1          TO MR-SELECTL (PV-SUB)           VLKCS036
01925              END-IF                                               VLKCS036
01926          END-IF                                                   VLKCS036
01927 *                                                                 VLKCS036
01928          IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           VLKCS036
                   EVALUATE TRUE                                                
                   WHEN ASC-NO-DETAIL-DISP (ASC-BLK-SUB ASC-ITEM-SUB)           
01901                  MOVE DP015-ASK-DRK-OFF                           VLKCS036
                                       TO MR-SELECTA (PV-SUB)           VLKCS036
01902                  MOVE DP015-HL-OFF                                VLKCS036
01902                                  TO MR-SELECTH (PV-SUB)           VLKCS036
01930                  MOVE SPACES     TO MR-SELECTI (PV-SUB)           VLKCS036
01930                                     MR-ACTION (PV-SUB)            VLKCS036
                                          MR-SCAC (PV-SUB)              VLKCS036
                                          MR-CARRIER-SHIPT-NBR (PV-SUB) VLKCS036
00190                                     MR-SHIPT-DATE (PV-SUB)        VLKCS036
                   WHEN ASC-DETAIL-DISP-NO-SELECT                               
                        (ASC-BLK-SUB ASC-ITEM-SUB)                              
01901                  MOVE DP015-ASK-DRK-OFF                           VLKCS036
                                       TO MR-SELECTA (PV-SUB)           VLKCS036
01902                  MOVE DP015-HL-OFF                                VLKCS036
01902                                  TO MR-SELECTH (PV-SUB)           VLKCS036
01930                  MOVE SPACES     TO MR-SELECTI (PV-SUB)           VLKCS036
01929                  MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)       VLKCS036
01930                                  TO MR-ACTION (PV-SUB)            VLKCS036
00190                  MOVE ASC-SCAC (ASC-BLK-SUB ASC-ITEM-SUB)         VLKCS036
                                       TO MR-SCAC (PV-SUB)              VLKCS036
00190                  MOVE ASC-CARRIER-SHIPT-NBR                             36
00190                                (ASC-BLK-SUB ASC-ITEM-SUB)         VLKCS036
                                       TO MR-CARRIER-SHIPT-NBR (PV-SUB) VLKCS036
00190                  MOVE ASC-SHIPT-DATE (ASC-BLK-SUB ASC-ITEM-SUB)         36
00190                                  TO MR-SHIPT-DATE (PV-SUB)        VLKCS036
                   WHEN OTHER                                                   
01901                  MOVE DP015-UNP-ALP-NOR-OFF                       VLKCS036
                                       TO MR-SELECTA (PV-SUB)           VLKCS036
01902                  MOVE DP015-UNDERLINE                             VLKCS036
01902                                  TO MR-SELECTH (PV-SUB)           VLKCS036
01930                  MOVE DP015-GREEN                                 VLKCS036
01902                                  TO MR-SELECTC (PV-SUB)           VLKCS036
01929                  MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)       VLKCS036
01930                                  TO MR-ACTION (PV-SUB)            VLKCS036
00190                  MOVE ASC-SCAC (ASC-BLK-SUB ASC-ITEM-SUB)         VLKCS036
                                       TO MR-SCAC (PV-SUB)              VLKCS036
00190                  MOVE ASC-CARRIER-SHIPT-NBR                             36
00190                                (ASC-BLK-SUB ASC-ITEM-SUB)         VLKCS036
                                       TO MR-CARRIER-SHIPT-NBR (PV-SUB) VLKCS036
00190                  MOVE ASC-SHIPT-DATE (ASC-BLK-SUB ASC-ITEM-SUB)         36
00190                                  TO MR-SHIPT-DATE (PV-SUB)        VLKCS036
                   END-EVALUATE                                                 
00190              MOVE ASC-PO-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)        VLKCS036
00190                                  TO MR-PO-NUMBER-N (PV-SUB)       VLKCS036
00190              MOVE ASC-VND-NAME (ASC-BLK-SUB ASC-ITEM-SUB)         VLKCS036
00190                                  TO MR-VND-NAME (PV-SUB)          VLKCS036
01939          END-IF                                                   VLKCS036
01940      END-IF.                                                      VLKCS036
01941      SUBTRACT +1 FROM ASC-ITEM-SUB                                VLKCS036
01942      IF  ASC-ITEM-SUB < + 1                                       VLKCS036
01943          MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  VLKCS036
01944          MOVE +1                 TO ASC-BLK-SUB                   VLKCS036
01945      END-IF.                                                      VLKCS036
01946 ******************************************************************VLKCS036
01947 ** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **VLKCS036
01948 ** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **VLKCS036
01949 ** ISSUE A WARNING.                                             **VLKCS036
01950 ******************************************************************VLKCS036
01951  4430-CHECK-FOR-BEGIN-AND-END.                                    VLKCS036
01952      IF  ASC-START-OF-SELECTED-RANGE > ZERO                       VLKCS036
01953          IF  ASC-END-OF-SELECTED-RANGE = ZERO                     VLKCS036
01954 *            -- NO END-OF-RANGE SPECFIED ---                      VLKCS036
01955              MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            VLKCS036
01956              SET DP020-MSG-WARNING TO TRUE                        VLKCS036
01957              PERFORM 4431-POSITION-AT-WARNING                     VLKCS036
01958          END-IF                                                   VLKCS036
01959      ELSE                                                         VLKCS036
01960          IF  ASC-END-OF-SELECTED-RANGE > ZERO                     VLKCS036
01961 *            -- NO BEGINNING-OF-RANGE SPECFIED ---                VLKCS036
01962              MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            VLKCS036
01963              SET DP020-MSG-WARNING TO TRUE                        VLKCS036
01964              PERFORM 4431-POSITION-AT-WARNING                     VLKCS036
01965          END-IF                                                   VLKCS036
01966      END-IF.                                                      VLKCS036
01967 ******************************************************************VLKCS036
01968 ** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **VLKCS036
01969 ** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **VLKCS036
01970 ** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **VLKCS036
01971 ** POSITION THE CURSOR THERE.                                   **VLKCS036
01972 ******************************************************************VLKCS036
01973  4431-POSITION-AT-WARNING.                                        VLKCS036
01974      COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 VLKCS036
01975                     - PV-TOP-ITEM + 1.                            VLKCS036
01976      IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      VLKCS036
01977          CONTINUE                                                 VLKCS036
01978      ELSE                                                         VLKCS036
01979          SET DP030-SET-CURSOR-APPL-1                              VLKCS036
01980                                    TO TRUE                        VLKCS036
01981          MOVE -1                   TO MR-SELECTL (PV-SUB)         VLKCS036
01982          MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         VLKCS036
01983          MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         VLKCS036
01984      END-IF.                                                      VLKCS036
01985 *                                                                 VLKCS036
01986      COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   VLKCS036
01987                     - PV-TOP-ITEM + 1.                            VLKCS036
01988      IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      VLKCS036
01989          CONTINUE                                                 VLKCS036
01990      ELSE                                                         VLKCS036
01991          SET DP030-SET-CURSOR-APPL-1                              VLKCS036
01992                                    TO TRUE                        VLKCS036
01993          MOVE -1                   TO MR-SELECTL (PV-SUB)         VLKCS036
01994          MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         VLKCS036
01995          MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         VLKCS036
01996      END-IF.                                                      VLKCS036
01997  EJECT                                                            VLKCS036
01998 *----------------------------------------------------------------*VLKCS036
01999 * PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *VLKCS036
02000 * ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *VLKCS036
02001 * FOR THE SELECTED ITEMS QUEUE.                                  *VLKCS036
02002 *                                                                *VLKCS036
02003 * FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *VLKCS036
02004 * QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *VLKCS036
02005 * THE ARRAY IS FULL.                                             *VLKCS036
02006 *----------------------------------------------------------------*VLKCS036
02007                                                                   VLKCS036
02008  5000-PREPARE-SEL-QUEUE.                                          VLKCS036
02009                                                                   VLKCS036
02010      MOVE +1                   TO  ASC-BLK-SUB.                   VLKCS036
02011      PERFORM 5100-WRITE-TEMP-STORAGE.                             VLKCS036
02012      ADD +1                    TO  ASC-BLK-SUB.                   VLKCS036
02013      PERFORM 5100-WRITE-TEMP-STORAGE.                             VLKCS036
02014                                                                   VLKCS036
02015      MOVE ASC-SEL-QUEUE-NAME   TO  VL011-SEL-QUEUE-NAME.          DPKCS036
02016      PERFORM 6010-DELETE-SEL-QUEUE.                               DPKCS036
02018      SET ASC-UPDATE-TSQ        TO  TRUE.                          VLKCS036
02019                                                                   VLKCS036
02020      SET VL012-IDX             TO  1.                             DPKCS036
02021      MOVE ZERO                 TO VL011-NUMBER-OF-TS-ITEMS.       DPKCS036
02022      INITIALIZE VL012-SELECTED-ITEM-ARRAY.                        DPKCS036
02023                                                                   DPKCS036
02024      PERFORM 5200-FILL-SEL-QUEUE-RECORD                           DPKCS036
02025              VARYING PV-ITEM                                      DPKCS036
02026              FROM 1 BY 1                                          DPKCS036
02027              UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     DPKCS036
02028                                                                   DPKCS036
02029      IF  VL012-IDX > 1                                            DPKCS036
02030          PERFORM 5205-WRITE-SEL-QUEUE                             DPKCS036
02031          ADD +1                TO VL011-NUMBER-OF-TS-ITEMS        DPKCS036
02032      END-IF.                                                      DPKCS036
02033  EJECT                                                            VLKCS036
02034 *----------------------------------------------------------------*VLKCS036
02035 *    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *VLKCS036
02036 *    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *VLKCS036
02037 *----------------------------------------------------------------*VLKCS036
02038                                                                   VLKCS036
02039  5100-WRITE-TEMP-STORAGE.                                         VLKCS036
02040      MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     VLKCS036
02041                                    TO PV-LIST-ITEM-NUMBER.        VLKCS036
02042      COMPUTE PV-BLOCK-NUMBER =                                    VLKCS036
02043          1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    VLKCS036
02044                                                                   VLKCS036
02045      IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             VLKCS036
02046      OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             VLKCS036
02047          IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      VLKCS036
02048              PERFORM 5105-REWRITE-ASC-LISTQ                       VLKCS036
02049          END-IF                                                   VLKCS036
02050      ELSE                                                         VLKCS036
02051          COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       VLKCS036
02052          ASC-HIGHEST-BLOCK-WRITTEN + 1                            VLKCS036
02053          PERFORM 5110-WRITE-ASC-LISTQ                             VLKCS036
02054          ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   VLKCS036
02055      END-IF.                                                      VLKCS036
02056                                                                   VLKCS036
02057      SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             VLKCS036
02058 ******************************************************************VLKCS036
02059 ** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **VLKCS036
02060 ** SPECIFIC COMMAREA.                                           **VLKCS036
02061 ******************************************************************VLKCS036
02062  5105-REWRITE-ASC-LISTQ.                                          VLKCS036
02063      EXEC CICS                                                    VLKCS036
02064          WRITEQ TS                                                VLKCS036
02065              QUEUE (ASC-LIST-QUEUE-NAME)                          VLKCS036
02066              FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               VLKCS036
02067              ITEM  (PV-BLOCK-NUMBER)                              VLKCS036
02068              REWRITE                                              VLKCS036
02069              RESP  (PV-CICS-RESP)                                 VLKCS036
02070      END-EXEC.                                                    VLKCS036
02071                                                                   VLKCS036
02072      IF  PV-CICS-RESP = DFHRESP(NORMAL)                           VLKCS036
02073          CONTINUE                                                 VLKCS036
02074      ELSE                                                         VLKCS036
02075          SET DP013-CICS-ABEND            TO TRUE                  VLKCS036
02076          SET DP013-NO-ROLLBACK           TO TRUE                  VLKCS036
02077          MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       VLKCS036
02078          MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     VLKCS036
02079                                          TO DP013-MESSAGE-TEXT(1) VLKCS036
02080          PERFORM DP013-0000-PROCESS-ABEND                         VLKCS036
02081      END-IF.                                                      VLKCS036
02082                                                                   VLKCS036
02083 ******************************************************************VLKCS036
02084 ** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **VLKCS036
02085 ** SPECIFIC COMMAREA.                                           **VLKCS036
02086 ******************************************************************VLKCS036
02087  5110-WRITE-ASC-LISTQ.                                            VLKCS036
02088      EXEC CICS                                                    VLKCS036
02089          WRITEQ TS                                                VLKCS036
02090              QUEUE (ASC-LIST-QUEUE-NAME)                          VLKCS036
02091              FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               VLKCS036
02092              ITEM  (PV-BLOCK-NUMBER)                              VLKCS036
02093              RESP  (PV-CICS-RESP)                                 VLKCS036
02094      END-EXEC.                                                    VLKCS036
02095      IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      VLKCS036
02096          SET DP013-CICS-ABEND      TO TRUE                        VLKCS036
02097          SET DP013-NO-ROLLBACK     TO TRUE                        VLKCS036
02098          MOVE '5110-WRITE-ASC-LISTQ'                              VLKCS036
02099                                    TO DP013-PARAGRAPH             VLKCS036
02100          MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           VLKCS036
02101                                    TO DP013-MESSAGE-TEXT(1)       VLKCS036
02102          PERFORM DP013-0000-PROCESS-ABEND                         VLKCS036
02103      END-IF.                                                      VLKCS036
02104  EJECT                                                            VLKCS036
02105 *----------------------------------------------------------------*VLKCS036
02106 * READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *VLKCS036
02107 * TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *VLKCS036
02108 *----------------------------------------------------------------*VLKCS036
02109                                                                   VLKCS036
02110  5200-FILL-SEL-QUEUE-RECORD.                                      VLKCS036
02111                                                                   VLKCS036
02112      PERFORM 6112-READ-LIST-QUEUE.                                VLKCS036
                                                                        VLKCS036
02114      IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       VLKCS036
02115          PERFORM                                                  VLKCS036
02116          VARYING LQW-IDX                                          VLKCS036
02117          FROM 1 BY 1                                              VLKCS036
02118          UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            VLKCS036
02119            OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          VLKCS036
02120                                                                   VLKCS036
02121              IF  LQW-SELECT (LQW-IDX)                             VLKCS036
02122                  MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              DPKCS036
02123                              TO VL012-ITEM (VL012-IDX)            DPKCS036
--124                  MOVE LQW-SHIPT-GRP-ID (LQW-IDX)                  VLKCS036
02125                              TO VL012-SHIPT-GRP-ID (VL012-IDX)    VLKCS036
                       MOVE SPACE  TO VL012-ACTION (VL012-IDX)                  
02128                  SET VL012-IDX UP BY 1                            DPKCS036
02129                  IF  VL012-IDX > VL012-MAX-ITEMS                  DPKCS036
02130                      PERFORM 5205-WRITE-SEL-QUEUE                 DPKCS036
02131                      ADD +1        TO VL011-NUMBER-OF-TS-ITEMS    DPKCS036
02132                      INITIALIZE VL012-SELECTED-ITEM-ARRAY         DPKCS036
02133                      SET VL012-IDX TO  1                          DPKCS036
02134                  END-IF                                           DPKCS036
02135              END-IF                                               VLKCS036
02136          END-PERFORM                                              VLKCS036
02137      END-IF.                                                      VLKCS036
02138                                                                   VLKCS036
02138                                                                   DPKCS036
02139 *----------------------------------------------------------------*DPKCS036
02140 *    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *DPKCS036
02141 *----------------------------------------------------------------*DPKCS036
02142                                                                   DPKCS036
02143  5205-WRITE-SEL-QUEUE.                                            DPKCS036
02144                                                                   DPKCS036
02145      MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            DPKCS036
02146                                    TO VL012-SELECTED-ITEMS.       DPKCS036
02147                                                                   DPKCS036
02148      EXEC CICS                                                    DPKCS036
02149           WRITEQ TS                                               DPKCS036
02150               QUEUE (ASC-SEL-QUEUE-NAME)                          DPKCS036
02151               FROM  (VL012-SHIPMENT-SEL-REC)                      DPKCS036
02152               ITEM  (PV-SEL-QUEUE-ITEM)                           DPKCS036
02153               RESP  (PV-CICS-RESP)                                DPKCS036
02154      END-EXEC.                                                    DPKCS036
02155                                                                   DPKCS036
02156      IF  PV-CICS-RESP = DFHRESP (NORMAL)                          DPKCS036
02157          CONTINUE                                                 DPKCS036
02158      ELSE                                                         DPKCS036
02159          SET DP013-CICS-ABEND      TO TRUE                        DPKCS036
02160          SET DP013-NO-ROLLBACK     TO TRUE                        DPKCS036
02161          MOVE '5205-WRITE-SEL-QUEUE'                              DPKCS036
02162                                    TO DP013-PARAGRAPH             DPKCS036
02163          MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          DPKCS036
02164                                    TO DP013-MESSAGE-TEXT(1)       DPKCS036
02165          PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
02166      END-IF.                                                      DPKCS036
02167  EJECT                                                            VLKCS036
02168 ******************************************************************DPKCS036
02169 ** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **DPKCS036
02170 ** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **DPKCS036
02171 ** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **DPKCS036
02172 ** THE USER.                                                    **DPKCS036
02173 ******************************************************************DPKCS036
02174  6000-REFRESH-PANEL-FROM-TEMP.                                    DPKCS036
02175      IF  ASC-UPDATE-TSQ                                           DPKCS036
02176          SET ASC-NO-TSQ-UPDATE TO TRUE                            DPKCS036
02177          MOVE ZERO                 TO PV-SAVE-ITEM                DPKCS036
02178                                       PV-SEL-QUEUE-ITEM           DPKCS036
02179          MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        DPKCS036
02180                                    TO PV-HOLD-SELECTED-ITEMS      DPKCS036
02181          MOVE +1                   TO PV-ITEMS-PROCESSED          DPKCS036
02182          PERFORM 6100-UPDATE-TSQ                                  DPKCS036
02183              UNTIL PV-ITEMS-PROCESSED >                           DPKCS036
02184                                      PV-HOLD-SELECTED-ITEMS       DPKCS036
02185          PERFORM 6010-DELETE-SEL-QUEUE                            DPKCS036
02186          INITIALIZE ASC-BLOCK-ENTRIES (1)                         DPKCS036
02187                     ASC-BLOCK-ENTRIES (2)                         DPKCS036
02188      END-IF.                                                      DPKCS036
02189                                                                   DPKCS036
02190 *----------------------------------------------------------------*DPKCS036
02191 *    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *DPKCS036
02192 *----------------------------------------------------------------*DPKCS036
02193  6010-DELETE-SEL-QUEUE.                                           DPKCS036
02194                                                                   DPKCS036
02195      EXEC CICS                                                    DPKCS036
02196          DELETEQ TS                                               DPKCS036
02197              QUEUE (ASC-SEL-QUEUE-NAME)                           DPKCS036
02198              RESP  (PV-CICS-RESP)                                 DPKCS036
02199      END-EXEC.                                                    DPKCS036
02200 *                                                                 DPKCS036
02201      IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      DPKCS036
02202         (PV-CICS-RESP = DFHRESP(QIDERR)))                         DPKCS036
02203          CONTINUE                                                 DPKCS036
02204      ELSE                                                         DPKCS036
02205          SET DP013-CICS-ABEND TO TRUE                             DPKCS036
02206          SET DP013-NO-ROLLBACK TO TRUE                            DPKCS036
02207          MOVE '6010-DELETE-SEL-QUEUE'                             DPKCS036
02208                         TO DP013-PARAGRAPH                        DPKCS036
02209          MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         DPKCS036
02210                         TO DP013-MESSAGE-TEXT (1)                 DPKCS036
02211          PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
02212      END-IF.                                                      DPKCS036
02213                                                                   DPKCS036
02214 *----------------------------------------------------------------*DPKCS036
02215 *    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *DPKCS036
02216 *    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *DPKCS036
02217 *    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *DPKCS036
02218 *    THE TEMP QUEUE.                                             *DPKCS036
02219 *----------------------------------------------------------------*DPKCS036
02220                                                                   DPKCS036
02221  6100-UPDATE-TSQ.                                                 DPKCS036
02222                                                                   DPKCS036
02223      ADD 1                     TO  PV-SEL-QUEUE-ITEM.             DPKCS036
02224      PERFORM 6105-READ-SEL-QUEUE.                                 DPKCS036
02225      PERFORM                                                      DPKCS036
02226          VARYING VL012-IDX                                        DPKCS036
02227          FROM 1 BY 1                                              DPKCS036
02228          UNTIL ((PV-ITEMS-PROCESSED >                             DPKCS036
02229                               PV-HOLD-SELECTED-ITEMS)             DPKCS036
02230          OR (VL012-IDX GREATER THAN VL012-MAX-ITEMS))             DPKCS036
02231          IF  VL012-ACTION (VL012-IDX) > SPACE                     DPKCS036
02232              PERFORM 6110-PROCESS-ITEMS                           DPKCS036
02233          END-IF                                                   DPKCS036
02234          ADD +1                TO PV-ITEMS-PROCESSED              DPKCS036
02235      END-PERFORM.                                                 DPKCS036
02236      PERFORM 6111-WRITE-LIST-QUEUE.                               DPKCS036
02237 *----------------------------------------------------------------*DPKCS036
02238 *    READ THE LIST QUEUE RECORD.                                 *DPKCS036
02239 *----------------------------------------------------------------*DPKCS036
02240                                                                   DPKCS036
02241  6105-READ-SEL-QUEUE.                                             DPKCS036
02242                                                                   DPKCS036
02243      EXEC CICS                                                    DPKCS036
02244           READQ TS                                                DPKCS036
02245               QUEUE (ASC-SEL-QUEUE-NAME)                          DPKCS036
02246               INTO  (VL012-SHIPMENT-SEL-REC)                      DPKCS036
02247               ITEM  (PV-SEL-QUEUE-ITEM)                           DPKCS036
02248               RESP  (PV-CICS-RESP)                                DPKCS036
02249      END-EXEC.                                                    DPKCS036
02250 *                                                                 DPKCS036
02251      IF  PV-CICS-RESP = DFHRESP (NORMAL)                          DPKCS036
02252          CONTINUE                                                 DPKCS036
02253      ELSE                                                         DPKCS036
02254          SET DP013-CICS-ABEND      TO  TRUE                       DPKCS036
02255          SET DP013-NO-ROLLBACK     TO  TRUE                       DPKCS036
02256          MOVE '6105-READ-SEL-QUEUE'                               DPKCS036
02257                                    TO  DP013-PARAGRAPH            DPKCS036
02258          MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           DPKCS036
02259                                    TO  DP013-MESSAGE-TEXT(1)      DPKCS036
02260          PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
02261      END-IF.                                                      DPKCS036
02262  EJECT                                                            DPKCS036
02263 *----------------------------------------------------------------*DPKCS036
02264 *    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*DPKCS036
02265 *    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*DPKCS036
02266 *    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *DPKCS036
02267 *----------------------------------------------------------------*DPKCS036
02268                                                                   DPKCS036
02269  6110-PROCESS-ITEMS.                                              DPKCS036
02270                                                                   DPKCS036
02271      COMPUTE PV-ITEM = 1 + ((VL012-ITEM (VL012-IDX) - 1)          DPKCS036
02272                      / PC-ITEMS-PER-PANEL).                       DPKCS036
02273                                                                   DPKCS036
02274      IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           DPKCS036
02275          IF  PV-SAVE-ITEM NOT EQUAL ZERO                          DPKCS036
02276              PERFORM 6111-WRITE-LIST-QUEUE                        DPKCS036
02277          END-IF                                                   DPKCS036
02278          MOVE PV-ITEM          TO PV-SAVE-ITEM                    DPKCS036
02279                                                                   DPKCS036
02280          PERFORM 6112-READ-LIST-QUEUE                             DPKCS036
02281          IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               DPKCS036
02282              CONTINUE                                             DPKCS036
02283          END-IF                                                   DPKCS036
02284      END-IF.                                                      DPKCS036
02285                                                                   DPKCS036
02286      COMPUTE PV-SUB = (VL012-ITEM (VL012-IDX)                     DPKCS036
02287                     - LQW-LIST-ITEM-NUMBER (1)) + 1.              DPKCS036
02288      SET LQW-DESELECT (PV-SUB) TO    TRUE                         DPKCS036
02289      MOVE LQW-SELECTED-SW (PV-SUB)                                DPKCS036
02290                                TO LQW-TEMP-SELECTED-SW (PV-SUB).  DPKCS036
02291      EVALUATE TRUE                                                DPKCS036
02292          WHEN VL012-INQ (VL012-IDX)                               DPKCS036
02293               MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             DPKCS036
02294                                                                   DPKCS036
02295          WHEN VL012-UPD (VL012-IDX)                               DPKCS036
02296               MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             DPKCS036
02297                                                                   DPKCS036
02298          WHEN VL012-DEL (VL012-IDX)                               DPKCS036
02299               MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             DPKCS036
02300                                                                   DPKCS036
02301          WHEN VL012-ERR (VL012-IDX)                               DPKCS036
02302               MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             DPKCS036
02303      END-EVALUATE.                                                DPKCS036
02304                                                                   DPKCS036
02305      SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                DPKCS036
02306                                                                   DPKCS036
02307 *----------------------------------------------------------------*DPKCS036
02308 *    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *DPKCS036
02309 *----------------------------------------------------------------*DPKCS036
02310                                                                   DPKCS036
02311  6111-WRITE-LIST-QUEUE.                                           DPKCS036
02312                                                                   DPKCS036
02313      EXEC CICS                                                    DPKCS036
02314          WRITEQ TS                                                DPKCS036
02315              QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
02316              FROM  (LQW-LIST-QUEUE-WORK-AREA)                     DPKCS036
02317              ITEM  (PV-SAVE-ITEM)                                 DPKCS036
02318              REWRITE                                              DPKCS036
02319              RESP  (PV-CICS-RESP)                                 DPKCS036
02320      END-EXEC.                                                    DPKCS036
02321 *                                                                 DPKCS036
02322      IF  PV-CICS-RESP = DFHRESP (NORMAL)                          DPKCS036
02323          CONTINUE                                                 DPKCS036
02324      ELSE                                                         DPKCS036
02325          SET DP013-CICS-ABEND  TO  TRUE                           DPKCS036
02326          SET DP013-NO-ROLLBACK TO  TRUE                           DPKCS036
02327          MOVE '6111-WRITE-LIST-QUEUE'                             DPKCS036
02328                                TO  DP013-PARAGRAPH                DPKCS036
02329          MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  DPKCS036
02330                                TO  DP013-MESSAGE-TEXT(1)          DPKCS036
02331          PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
02332      END-IF.                                                      DPKCS036
02333                                                                   DPKCS036
02334  EJECT                                                            DPKCS036
02335 *----------------------------------------------------------------*DPKCS036
02336 *    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*DPKCS036
02337 *----------------------------------------------------------------*DPKCS036
02338                                                                   DPKCS036
02339  6112-READ-LIST-QUEUE.                                            DPKCS036
02340                                                                   DPKCS036
02341      EXEC CICS                                                    DPKCS036
02342          READQ TS                                                 DPKCS036
02343              QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
02344              INTO  (LQW-LIST-QUEUE-WORK-AREA)                     DPKCS036
02345              ITEM  (PV-ITEM)                                      DPKCS036
02346              RESP  (PV-CICS-RESP)                                 DPKCS036
02347      END-EXEC.                                                    DPKCS036
02348 *                                                                 DPKCS036
02349      IF  PV-CICS-RESP = DFHRESP (NORMAL)                          DPKCS036
02350          CONTINUE                                                 DPKCS036
02351      ELSE                                                         DPKCS036
02352          SET DP013-CICS-ABEND        TO TRUE                      DPKCS036
02353          SET DP013-NO-ROLLBACK       TO TRUE                      DPKCS036
02354          MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           DPKCS036
02355          MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    DPKCS036
02356                                      TO DP013-MESSAGE-TEXT(1)     DPKCS036
02357          PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
02358      END-IF.                                                      DPKCS036
02359                                                                   DPKCS036
02360  EJECT                                                            DPKCS036
02361 *----------------------------------------------------------------*VLKCS036
02362 *    ABEND PROCESSOR MODULE                                      *VLKCS036
02363 *----------------------------------------------------------------*VLKCS036
02364                                                                   VLKCS036
02365      COPY DPPD013.                                                VLKCS036
