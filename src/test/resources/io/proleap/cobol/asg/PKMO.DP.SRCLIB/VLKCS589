000100*-----------------------*                                         06/13/94
000200 IDENTIFICATION DIVISION.                                         POKCS089
000300*-----------------------*                                            LV013
000400 PROGRAM-ID.    VLKCS589.                                         POKCS089
000500 AUTHOR.        MARY SARDINA.                                           03
000600 DATE-WRITTEN.  08/96.                                            POKCS089
000700*---------------------------------------------------------------* POKCS089
000800*    V589 - PRETICKET REQUEST REASON CODE SCREEN                * POKCS089
000900*                                                               * POKCS089
001000*    THIS PROGRAM GENERATES A LIST PF REASON CODES AND          * POKCS089
001100*    DESCRIPTIONS FOR RESUBMITTING A PRETICKET REQUEST          * POKCS089
001200*                                                               * POKCS089
001300*---------------------------------------------------------------* POKCS089
263627* CHANGED 11/05/2021    BY JIM HUNTER      WR: CHG0263627                 
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263627* MAKING THE CALL DYNAMIC VS STATIC.                                      
263627*---------------------------------------------------------------*         
CICS  * CHANGED 11/14/2022    BY JIM HUNTER      WR: CHG0278236                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *****************************************************************         
001400 ENVIRONMENT DIVISION.                                            POKCS089
001500 DATA DIVISION.                                                   POKCS089
001600                                                                  POKCS089
001700 WORKING-STORAGE SECTION.                                         POKCS089
001800                                                                  POKCS089
001900 01  DK-DB2-KEY.                                                  POKCS089
001910     05  DK-PO-REQ-NBR                  PIC S9(09)  VALUE +0      POKCS089
001920                                                    COMP-3.       POKCS089
002000     05  DK-STATUS-CODE                 PIC  X(01)  VALUE SPACES. POKCS089
002100     05  DK-VEND-NAME                   PIC  X(30)  VALUE SPACE.  POKCS089
002200     05  DK-VEND-NAME-BYTE              REDEFINES DK-VEND-NAME    POKCS089
002300                                        OCCURS 30 TIMES           POKCS089
002400                                        PIC  X(01).               POKCS089
002500     05  DK-PRIM-NAME                   PIC  X(30).               POKCS089
002600                                                                  POKCS089
002700 01  PC-PROGRAM-CONSTANTS.                                        POKCS089
002800     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         POKCS089
002900                                                    'VL589A  '.   POKCS089
003000     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         POKCS089
003100                                                    'VLKM589 '.   POKCS089
003200     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         POKCS089
003300                                                    'VLKCS589'.   POKCS089
003400     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      POKCS089
003500     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      POKCS089
003600     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '2'.    POKCS089
003610     05  PC-LIST-FORMAT                 PIC  X(01)  VALUE '1'.    POKCS089
003700     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +12     POKCS089
003800                                                    COMP SYNC.    POKCS089
003900     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      POKCS089
004000                                                    COMP SYNC.    POKCS089
004100     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         POKCS089
004200                                                    +1000000      POKCS089
004300                                                    COMP-3.       POKCS089
004400     05  PC-ITM-NUMBER-LENGTH           PIC S9(04)  VALUE +7      POKCS089
004500                                                    COMP SYNC.    POKCS089
004600     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       POKCS089
004700                                                    COMP-3.       POKCS089
004800     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  POKCS089
004900     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  POKCS089
005000     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  POKCS089
005100     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  POKCS089
005200     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    POKCS089
005300     05  PC-TYPE-CODES.                                           POKCS089
005400         10  PC-PRIMARY                 PIC  X(02)  VALUE '01'.   POKCS089
005500         10  PC-ALIAS                   PIC  X(02)  VALUE '02'.   POKCS089
005600         10  PC-LABEL                   PIC  X(02)  VALUE '03'.   POKCS089
005700         10  PC-SHORTNAME               PIC  X(02)  VALUE '04'.   POKCS089
005800                                                                  POKCS089
005900     05  PC-TSYMSG-NUMBERS.                                       POKCS089
006000         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  POKCS089
006100         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  POKCS089
006200         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  POKCS089
006300         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  POKCS089
006400         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  POKCS089
006500         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  POKCS089
006600         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  POKCS089
006700         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  POKCS089
006800         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  POKCS089
006810         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  POKCS089
006900         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  POKCS089
007000         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  POKCS089
007100         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  POKCS089
007110         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  POKCS089
007200         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  POKCS089
007210         10  PC-TSYMSG-00302            PIC  9(05)  VALUE 00302.  POKCS089
007220         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  POKCS089
007300         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  POKCS089
007400                                                                  POKCS089
007500 01  PS-PROGRAM-SWITCHES.                                         POKCS089
007600     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    POKCS089
007700         88  PS-NO-ERROR                            VALUE 'Y'.    POKCS089
007800         88  PS-ERROR                               VALUE 'N'.    POKCS089
007801     05  PS-NEXT-SCREEN-SW                PIC  X    VALUE 'N'.          79
007802         88  PS-NO-NEXT-SCREEN                      VALUE 'N'.          79
007810         88  PS-NEXT-SCREEN                         VALUE 'Y'.          79
007811     05  PS-RSN-SEL-SW                    PIC  X    VALUE 'N'.          79
007812         88  PS-NO-RSN-SEL-FOUND                    VALUE 'N'.          79
007813         88  PS-RSN-SEL-FOUND                       VALUE 'Y'.          79
007814     05  PS-UPDATE-SW                    PIC  X    VALUE 'N'.           79
007815         88  PS-NO-UPDATES-DONE                     VALUE 'N'.          79
007820         88  PS-UPDATES-DONE                        VALUE 'Y'.          79
007900     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    POKCS089
008000         88  PS-COMMAREA-VALID                      VALUE 'Y'.    POKCS089
008100         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    POKCS089
008200     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    POKCS089
008300         88  PS-DONE                                VALUE 'Y'.    POKCS089
008400         88  PS-NOT-DONE                            VALUE 'N'.    POKCS089
008401     05  PS-LIST-END-SW                 PIC X(01)   VALUE 'N'.      CL* *1
008402         88  PS-LIST-END                            VALUE 'Y'.      CL* *1
008410         88  PS-NO-LIST-END                         VALUE 'N'.      CL* *1
008411     05  PS-RSN-QUEUE-SW                PIC X(01)   VALUE 'N'.      CL* *1
008412         88  PS-RSN-QUEUE-WRITTEN                   VALUE 'Y'.      CL* *1
008413         88  PS-RSN-QUEUE-NOT-WRITTEN               VALUE 'N'.      CL* *1
008500                                                                  POKCS089
008600 01  PL-PROGRAM-LITERALS.                                         POKCS089
008700     05  PL-PRIMARY                     PIC  X(10)  VALUE         POKCS089
008800                                                    'PRIMARY   '. POKCS089
008900     05  PL-ALIAS                       PIC  X(10)  VALUE         POKCS089
009000                                                    'ALIAS     '. POKCS089
009100     05  PL-LABEL                       PIC  X(10)  VALUE         POKCS089
009200                                                    'LABEL     '. POKCS089
009300     05  PL-SHORTNAME                   PIC  X(10)  VALUE         POKCS089
009400                                                    'SHORT NAME'. POKCS089
009500                                                                  POKCS089
009600 01  PV-PROGRAM-VARIABLES.                                        POKCS089
009700     05  PV-SUB                         PIC S9(04)  VALUE +0      POKCS089
009800                                                    COMP SYNC.    POKCS089
009900     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      POKCS089
010000                                                    COMP SYNC.    POKCS089
010100     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      POKCS089
010200                                                    COMP-3.       POKCS089
010300     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      POKCS089
010400                                                    COMP-3.       POKCS089
010500     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      POKCS089
010600                                                    COMP-3.       POKCS089
010700     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      POKCS089
010800                                                    COMP-3.       POKCS089
010900     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      POKCS089
011000                                                    COMP-3.       POKCS089
011100     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      POKCS089
011200                                                    COMP-3.       POKCS089
011300     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      POKCS089
011400                                                    COMP-3.       POKCS089
011500     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      POKCS089
011600                                                    COMP SYNC.    POKCS089
011700     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      POKCS089
011800                                                    COMP SYNC.    POKCS089
011900     05  PV-ITEM                        PIC S9(04)  VALUE +0      POKCS089
012000                                                    COMP SYNC.    POKCS089
012100     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      POKCS089
012200                                                    COMP SYNC.    POKCS089
012300     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      POKCS089
012400                                                    COMP SYNC.    POKCS089
012500     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      POKCS089
012600                                                    COMP SYNC.    POKCS089
012700     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      POKCS089
012800                                                    COMP SYNC.    POKCS089
012900     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      POKCS089
013000                                                    COMP SYNC.    POKCS089
013100     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      POKCS089
013200                                                    COMP SYNC.    POKCS089
013300     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      POKCS089
013400                                                    COMP SYNC.    POKCS089
013500     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      POKCS089
013600                                                    COMP SYNC.    POKCS089
013700     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      POKCS089
013800                                                    COMP SYNC.    POKCS089
013900     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      POKCS089
014000                                                    COMP SYNC.    POKCS089
014100     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      POKCS089
014200                                                    COMP SYNC.    POKCS089
014300     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      POKCS089
014400                                                    COMP SYNC.    POKCS089
014500     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      POKCS089
014600                                                    COMP SYNC.    POKCS089
014700******************************************************************POKCS089
014800**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **POKCS089
014900**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **POKCS089
015000**  APPLICATION-SPECIFIC COMMAREA.                              **POKCS089
015100******************************************************************POKCS089
015200 01  LQW-LIST-QUEUE-WORK-AREA.                                    POKCS089
015300     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  POKCS089
015400     05  LQW-ITEM-ENTRIES               OCCURS 12 TIMES           POKCS089
015500                                        INDEXED BY LQW-IDX.       POKCS089
015600         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       POKCS089
015700         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               POKCS089
015800         10  LQW-SELECTED-SW            PIC  X(01).               POKCS089
015900             88  LQW-SELECT                         VALUE 'S'.    POKCS089
016000             88  LQW-DESELECT                       VALUE ' '.    POKCS089
016200         10  LQW-REQ-RSN-CDE            PIC  X(01).                     88
016210         10  LQW-REQ-REASN-DESC         PIC  X(50).                     *2
016700                                                                  POKCS089
016800*---------------------------------------------------------------* POKCS089
016900*  RECORD LAYOUT FOR THE PRETICKET SELECTION TEMP STORAGE QUEUE.* POKCS089
017000*---------------------------------------------------------------* POKCS089
017100     COPY VLWS008.                                                   CL*13
017200                                                                  POKCS089
017300*---------------------------------------------------------------* POKCS089
017400*    MAP LAYOUT                                                 * POKCS089
017500*---------------------------------------------------------------* POKCS089
017600     COPY VLKM589.                                                POKCS089
017700                                                                  POKCS089
017800 01  MR-OCCURS-LAYOUT                   REDEFINES  VL589AO.       POKCS089
017900     05  FILLER                         PIC X(55).                POKCS089
018000     05  MR-SCROLL-AREA                 OCCURS 12 TIMES.          POKCS089
019200                                                                  POKCS089
019300         10  MR-DESC-L                  PIC S9(04) COMP.             CL**2
019400         10  MR-DESC-A                  PIC  X(01).                  CL**2
019500         10  MR-DESC-C                  PIC  X(01).                  CL**2
019600         10  MR-DESC-H                  PIC  X(01).                  CL**2
019700         10  MR-DESC                    PIC  X(50).                  CL**2
019800                                                                     CL**2
020400                                                                  POKCS089
021600                                                                  POKCS089
021700*---------------------------------------------------------------* POKCS089
021800*    ATTRIBUTE SETTINGS COPYBOOK.                               * POKCS089
021900*---------------------------------------------------------------* POKCS089
022000     COPY DPWS015.                                                POKCS089
022100                                                                  POKCS089
022200*---------------------------------------------------------------* POKCS089
022300*    FUNCTION KEYS COPYBOOK.                                    * POKCS089
022400*---------------------------------------------------------------* POKCS089
022500     COPY DPWS016.                                                POKCS089
022600                                                                  POKCS089
022700*---------------------------------------------------------------* POKCS089
022800*    NUMERIC EDIT LAYOUT.                                       * POKCS089
022900*---------------------------------------------------------------* POKCS089
023000     COPY DPWS010I.                                               POKCS089
023100                                                                  POKCS089
023200*---------------------------------------------------------------* POKCS089
023300*    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * POKCS089
023400*---------------------------------------------------------------* POKCS089
023500     COPY DPWS030.                                                POKCS089
CICS       COPY DPWS930.                                                POKCS089
023600                                                                  POKCS089
023700*---------------------------------------------------------------* POKCS089
023800*    STANDARD COMMAREA.                                         * POKCS089
023900*---------------------------------------------------------------* POKCS089
024000     COPY DPWS020.                                                POKCS089
024100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                POKCS089
024200*---------------------------------------------------------------* POKCS089
024300* INTER-APPLICATION COMMAREA.                                   * POKCS089
024400*   VLWS005 - INPUT FROM PO PRETICKET REQUEST                   * POKCS089
024600*---------------------------------------------------------------* POKCS089
024700         10  INTER-APPL-COMM-AREA       PIC X(200).               POKCS089
024800     COPY VLWS005.                                                   CL*13
025000*---------------------------------------------------------------* POKCS089
025100*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * POKCS089
025200*---------------------------------------------------------------* POKCS089
025300         10  ASC-SPECIFIC-COMMAREA.                               POKCS089
025412             15  ASC-PO-NUMBER                       PIC S9(09)   POKCS089
025413                                                     COMP.                
025414             15  ASC-KEY-RSN-CDE                     PIC X(01).         *1
025800             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                POKCS089
025900                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  POKCS089
026000                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   POKCS089
026100                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   POKCS089
026200                                                                  POKCS089
026300                 20  ASC-ITEM-ARRAY.                              POKCS089
026400                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        POKCS089
026500                         30  ASC-LIST-ITEM-NUMBER                 POKCS089
026600                                                     PIC S9(09)   POKCS089
026700                                                     COMP-3.      POKCS089
026800                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  POKCS089
026900                             88  ASC-VALID-SELECT    VALUE ' '    POKCS089
027000                                                           'S'    POKCS089
027100                                                           'B'    POKCS089
027200                                                           'E'.   POKCS089
027300                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   POKCS089
027400                             88  ASC-TEMP-SELECT     VALUE 'S'.   POKCS089
027500                             88  ASC-TEMP-BEGIN      VALUE 'B'.   POKCS089
027600                             88  ASC-TEMP-END        VALUE 'E'.   POKCS089
027700                         30  ASC-SELECTED-SW         PIC  X(01).  POKCS089
027800                             88  ASC-NO-SELECT       VALUE ' '.   POKCS089
027900                             88  ASC-SELECT          VALUE 'S'.   POKCS089
028000                             88  ASC-BEGIN           VALUE 'B'.   POKCS089
028100                             88  ASC-END             VALUE 'E'.   POKCS089
028200                         30  ASC-REQ-RSN-CDE         PIC  X(01).  POKCS089
028400                         30  ASC-REQ-RSN-DESC        PIC  X(50).     CL**2
028900                                                                        84
029000             15  ASC-BLK-SUB                         PIC S9(04)   POKCS089
029100                                                          COMP    POKCS089
029200                                                          SYNC.   POKCS089
029300             15  ASC-ITEM-SUB                        PIC S9(04)   POKCS089
029400                                                          COMP    POKCS089
029500                                                          SYNC.   POKCS089
029501             15  ASC-SEL-SUB                         PIC S9(04)      CL**1
029502                                                         COMP.       CL**1
029503             15  ASC-SEL-ITEM                        PIC S9(04)      CL**1
029510                                                         COMP.       CL**1
029600             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   POKCS089
029700                                                          COMP-3. POKCS089
029710             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(09)   POKCS089
029720                                                          COMP-3. POKCS089
029800             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   POKCS089
029900                                                          COMP-3. POKCS089
030000             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   POKCS089
030100                                                          COMP-3. POKCS089
030200             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   POKCS089
030300                                                          COMP-3. POKCS089
030400             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   POKCS089
030500                                                          COMP-3. POKCS089
030600             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   POKCS089
030700                                                          COMP    POKCS089
030800                                                          SYNC.   POKCS089
030900             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   POKCS089
031000                                                          COMP-3. POKCS089
031100             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   POKCS089
031200                                                          COMP-3. POKCS089
031300             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  POKCS089
031400                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   POKCS089
031500                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   POKCS089
031600             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  POKCS089
031700                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   POKCS089
031800                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   POKCS089
031900             15  ASC-LIST-QUEUE-NAME.                             POKCS089
032000                 20  ASC-LIST-TERM-ID                PIC  X(04).  POKCS089
032100                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   POKCS089
032200                                                          COMP-3. POKCS089
032300                 20  ASC-LIST-SEQ                    PIC  9(01).  POKCS089
032400             15  ASC-SEL-QUEUE-NAME.                              POKCS089
032500                 20  ASC-SEL-TERM-ID                 PIC  X(04).  POKCS089
032600                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   POKCS089
032700                                                          COMP-3. POKCS089
032800                 20  ASC-SEL-SEQ                     PIC  9(01).  POKCS089
032900                                                                  POKCS089
033000             15  ASC-START-ITEM-REQUEST.                          POKCS089
033100                 20  ASC-START-ITEM-REQUEST-N        PIC  9(07).  POKCS089
033210             15  ASC-HOLD-INTER-APPL                 PIC X(200).          
033300                                                                  POKCS089
033400*---------------------------------------------------------------* POKCS089
033500*    ABEND PROCESSING COPYBOOK.                                 * POKCS089
033600*---------------------------------------------------------------* POKCS089
033700     COPY DPWS013.                                                POKCS089
033800                                                                  POKCS089
033801 EJECT                                                                    
033802*---------------------------------------------------------------*         
033803*    DB2 AREA FOR THE PRETICKET REQUEST REASON CODE DESCRIPTION *         
033804*    TABLE                                                      *         
033805*---------------------------------------------------------------*         
033806     EXEC SQL                                                             
033810          INCLUDE TPTRDSC                                                 
033900     END-EXEC.                                                            
034000 EJECT                                                                    
034100*---------------------------------------------------------------*         
034200*    DB2 AREA FOR THE PRETICKET REASON CODE ASSOCIATION         *         
034300*    TABLE                                                      *         
034400*---------------------------------------------------------------*         
034500     EXEC SQL                                                             
034600          INCLUDE TPTKRSN                                                 
034700     END-EXEC.                                                            
035200                                                                  POKCS089
035300*---------------------------------------------------------------* POKCS089
035400*    DB2 AREA FOR COMMUNICATIONS                                * POKCS089
035500*---------------------------------------------------------------* POKCS089
035600     EXEC SQL                                                     POKCS089
035700          INCLUDE SQLCA                                           POKCS089
035800     END-EXEC.                                                    POKCS089
035900                                                                  POKCS089
036000*---------------------------------------------------------------* POKCS089
036100*    VENDOR CURSOR WHEN VENDOR NAME IS ENTERED                  * POKCS089
036200*---------------------------------------------------------------* POKCS089
036300     EXEC SQL                                                     POKCS089
036400          DECLARE RSNDSC_CSR CURSOR FOR                                 88
036500           SELECT A.REQ_RSN_CDE                                         *2
036510                 ,B.REQ_RSN_DESC                                        *2
037100             FROM TPTKRSN A                                             *2
037110                 ,TPTRDSC B                                             *2
037200            WHERE A.PO_REQ_NBR  = :DK-PO-REQ-NBR                          
037300              AND A.REQ_RSN_CDE = B.REQ_RSN_CDE                           
037600         ORDER BY REQ_RSN_CDE                                           *2
037800     END-EXEC.                                                    POKCS089
037900                                                                  POKCS089
038000 LINKAGE SECTION.                                                 POKCS089
038100                                                                  POKCS089
038200 01  DFHCOMMAREA.                                                 POKCS089
038300     05  FILLER                         OCCURS  1 TO 4072 TIMES   POKCS089
038400                                        DEPENDING ON EIBCALEN.    POKCS089
038500         10  FILLER                     PIC X.                    POKCS089
038600                                                                  POKCS089
038700 PROCEDURE DIVISION.                                              POKCS089
038800                                                                     CL**6
038900     INITIALIZE DP030-CICS-API-FIELDS.                            POKCS089
039000     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       POKCS089
039100     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          POKCS089
039200     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         POKCS089
039300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       POKCS089
039400     MOVE LENGTH OF VL589AI        TO DP030-MAP-LENGTH (1).       POKCS089
039500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     POKCS089
039600                                                                     CL**6
039700     PERFORM 0001-CALL-CICS-ARCH-API.                             POKCS089
039800                                                                  POKCS089
039900     PERFORM 1000-CONTROL-PROCESSING                              POKCS089
040000                                                                  POKCS089
040100     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     POKCS089
040200                                                                     CL**6
040300     PERFORM 0001-CALL-CICS-ARCH-API.                             POKCS089
040400                                                                  POKCS089
040500******************************************************************POKCS089
040600**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **POKCS089
040700**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **POKCS089
040800******************************************************************POKCS089
040900 0001-CALL-CICS-ARCH-API.                                         POKCS089
041000                                                                  POKCS089
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
041200                                    DFHCOMMAREA                           
041300                                    DP030-CICS-API-FIELDS                 
041400                                    DP020-STANDARD-COMMAREA               
041500                                    VL589AI.                              
041600                                                                  POKCS089
041700     IF DP030-RC-CALL-SUCCESSFUL                                     CL**6
041800         CONTINUE                                                 POKCS089
041900     ELSE                                                         POKCS089
042000         SET DP013-NO-ROLLBACK                                    POKCS089
042100             DP013-XCTL-DISPLAY-RESTART                           POKCS089
042200             DP013-CICS-ABEND      TO TRUE                        POKCS089
042300         MOVE '0001-CALL-CICS-ARCH-API'                           POKCS089
042400                                   TO DP013-PARAGRAPH             POKCS089
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
042700         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      POKCS089
042800         PERFORM DP013-0000-PROCESS-ABEND.                        POKCS089
042900                                                                  POKCS089
043000*----------------------------------------------------------------*POKCS089
043100* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *POKCS089
043200* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *POKCS089
043300*----------------------------------------------------------------*POKCS089
043400 1000-CONTROL-PROCESSING.                                         POKCS089
043500                                                                  POKCS089
043600     EVALUATE TRUE                                                POKCS089
043700         WHEN DP020-NEXT-ACT-INITIAL                              POKCS089
043800             INITIALIZE ASC-SPECIFIC-COMMAREA                     POKCS089
043900             MOVE EIBTRMID              TO ASC-LIST-TERM-ID          CL**6
044000                                           ASC-SEL-TERM-ID           CL**6
044100             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER      CL**6
044200                                           ASC-SEL-TASK-NUMBER       CL**6
044300             MOVE PC-LIST-QUEUE-SEQ     TO ASC-LIST-SEQ              CL**6
044400             MOVE PC-SEL-QUEUE-SEQ      TO ASC-SEL-SEQ               CL**6
044500                                                                     CL**6
044600             PERFORM 1100-PROCESS-INTER-APPL-COMM                 POKCS089
044700             MOVE VL005-PO-NUMBER TO ASC-PO-NUMBER                   CL**6
044710             MOVE VL005-PO-REQ-NBR TO DK-PO-REQ-NBR                  CL**6
044800             PERFORM 4000-BUILD-INITIAL-PANEL                           88
044900                                                                  POKCS089
045000         WHEN DP020-NEXT-ACT-READ-MAP                             POKCS089
045100             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM            CL**6
045200                                                                     CL**6
045300             PERFORM 2000-PROCESS-PANEL                           POKCS089
045400                                                                  POKCS089
045501         WHEN DP020-NEXT-ACT-RETURN                                       
045521                MOVE ASC-ITEM-AT-TOP-OF-PANEL                             
045522                                       TO PV-TOP-ITEM                     
045523                MOVE ZERO      TO ASC-ITEM-AT-TOP-OF-PANEL                
045524                PERFORM 6000-REFRESH-PANEL-FROM-TEMP                RCK000
045533                                                                          
045800                                                                     CL**6
046400                                                                  POKCS089
046500         WHEN OTHER                                               POKCS089
046600             SET DP013-LOGIC-ABEND                                   CL**6
046700                 DP013-NO-ROLLBACK TO TRUE                           CL**6
046800             MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH       CL**6
046900             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    POKCS089
047000                                          TO DP013-MESSAGE-TEXT(1)   CL**6
047100             PERFORM DP013-0000-PROCESS-ABEND                     POKCS089
047200     END-EVALUATE.                                                POKCS089
047300                                                                  POKCS089
047400*----------------------------------------------------------------*POKCS089
047500* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *POKCS089
047600* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *POKCS089
047700*----------------------------------------------------------------*POKCS089
047800 1100-PROCESS-INTER-APPL-COMM.                                    POKCS089
047900                                                                  POKCS089
047901     SET PS-COMMAREA-VALID     TO TRUE.                              CL**1
047903     MOVE SPACE                TO ASC-START-ITEM-REQUEST.            CL**1
047904     EVALUATE DP020-INT-APPL-FORMAT-IND                              CL**1
047905*        WHEN PC-CRIT-SPEC-FORMAT                                    CL**1
047906*            IF DP071-MESSAGE-NUMBER > ZERO                          CL**1
047907*                MOVE DP071-MESSAGE-NUMBER                           CL**1
047908*                              TO ASC-KEY-MESSAGE-NUMBER             CL**1
047909*                                 PV-DB2-MESSAGE-NUMBER              CL**1
047910*            ELSE                                                    CL**1
047911*                MOVE PC-TSYMSG-00148                                CL**1
047912*                              TO DP020-MSG-NUMBER                   CL**1
047913*                SET DP020-MSG-FATAL TO TRUE                         CL**1
047914*                SET DP020-NEXT-ACT-APPL-ERROR TO TRUE               CL**1
047915*            END-IF                                                  CL**1
047916         WHEN PC-LIST-FORMAT                                         CL**1
047917*            SET ASC-USE-SELECTION-QUEUE TO TRUE                     CL**1
047918             MOVE VL005-NUMBER-OF-RSN-TS-ITEMS                          *1
047919                               TO ASC-NUMBER-OF-TS-ITEMS             CL**1
047920             MOVE VL005-RSN-QUEUE-NAME                               CL**1
047921                               TO ASC-SEL-QUEUE-NAME                 CL**1
047922             PERFORM 1120-PREPARE-LIST-ENTRY                         CL**1
047923         WHEN OTHER                                                  CL**1
047924             CONTINUE                                                     
047925*            IF  DP020-NAV-KEY-DATA > SPACE                          CL**1
047926*                PERFORM 1110-EDIT-NAV-KEY                           CL**1
047927*            ELSE                                                    CL**1
047928*                MOVE PC-TSYMSG-00148                                CL**1
047929*                              TO DP020-MSG-NUMBER                   CL**1
047930*                SET DP020-MSG-FATAL TO TRUE                         CL**1
047931*                SET DP020-NEXT-ACT-APPL-ERROR TO TRUE               CL**1
047932*            END-IF                                                  CL**1
047940     END-EVALUATE.                                                   CL**1
049301                                                                     CL**1
049302*----------------------------------------------------------------*   CL**1
049303*    EDIT THE KEY ENTERED BY THE USER INTO THE KEY FIELD OF THE  *   CL**1
049304*    COMMAND LINE.  A VALID MESSAGE NUMBER IS THE ONLY KEY       *   CL**1
049305*    ACCEPTED.                                                   *   CL**1
049306*----------------------------------------------------------------*   CL**1
049307                                                                     CL**1
049308*1110-EDIT-NAV-KEY.                                                  CL**1
049309                                                                     CL**1
049310*    MOVE DP020-NAV-KEY-DATA TO DP010I-UNEDITED-FIELD.               CL**1
049311*    MOVE PC-MSG-NUMBER-LENGTH     TO DP010I-MAXIMUM-DIGITS.         CL**1
049312*    MOVE ZERO                TO DP010I-MAXIMUM-DECIMALS.            CL**1
049313*    SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                        CL**1
263627*    CALL DP010I-NUMERIC-EDIT-ROUTINE                                     
263627*         USING DP010I-NUMERIC-EDIT-AREA.                                 
049315*    IF  DP010I-ERROR-DETECTED                                       CL**1
049316*        SET PS-ERROR TO TRUE                                        CL**1
049317*        SET DP020-MSG-FATAL TO TRUE                                 CL**1
049318*        MOVE PC-TSYMSG-00302 TO DP020-MSG-NUMBER                    CL**1
049319*        SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                       CL**1
049320*    ELSE                                                            CL**1
049321*        MOVE DP010I-NUMERIC-FIELD   TO ASC-KEY-MESSAGE-NUMBER       CL**1
049322*                                       PV-DB2-MESSAGE-NUMBER        CL**1
049323*    END-IF.                                                         CL**1
049324                                                                     CL**1
049325                                                                     CL**1
049326 1120-PREPARE-LIST-ENTRY.                                            CL**1
049327                                                                     CL**1
049328     MOVE VL008-MAX-ITEMS TO ASC-SEL-SUB.                            CL**1
049330     MOVE +1              TO ASC-SEL-ITEM.                           CL**1
049331     PERFORM 9100-READ-SEL-QUEUE.                                         
049332     IF PV-CICS-RESP = 0                                                  
049333         SET PS-RSN-SEL-FOUND TO TRUE                                   *1
049334         MOVE  VL005-NUMBER-OF-RSN-CODES                                *8
049336                  TO ASC-NUMBER-OF-SELECTED-ITEMS                         
049337     ELSE                                                                 
049338         SET PS-NO-RSN-SEL-FOUND TO TRUE                                *1
049339         MOVE 0 TO VL005-NUMBER-OF-RSN-CODES                            *8
049340         MOVE 0 TO ASC-NUMBER-OF-SELECTED-ITEMS                           
049341         PERFORM 9200-WRITE-SEL-QUEUE                                   *1
049350     END-IF.                                                              
049400                                                                  POKCS089
049500*----------------------------------------------------------------*POKCS089
049600* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *POKCS089
049700* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *POKCS089
049800* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *POKCS089
049900* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *POKCS089
050000* FUNCTION KEYS CAN GET THIS FAR.                                *POKCS089
050100*----------------------------------------------------------------*POKCS089
050200 2000-PROCESS-PANEL.                                              POKCS089
050300                                                                  POKCS089
050400     EVALUATE TRUE                                                POKCS089
050500         WHEN DP020-SRC-AID = DP016-CLEAR                         POKCS089
050600              MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                  CL**6
050700                                                                     CL**6
050800              PERFORM 3000-EDIT-DATA-IN-COMMAREA                     CL**6
050900                                                                     CL**6
051000              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   CL**6
051100                                                                  POKCS089
051200         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    POKCS089
051210             MOVE +1               TO PV-TOP-ITEM                 POKCS089
051220                                                                     CL**6
051230             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 POKCS089
051240                                                                     CL**6
051250             PERFORM 3200-RESET-ATTRIBUTES                        POKCS089
051300*             PERFORM 2050-DELETE-LIST-QUEUE                         CL**6
051400                                                                     CL**6
051500*             PERFORM 4000-BUILD-INITIAL-PANEL                       CL**6
051600                                                                  POKCS089
051700         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    POKCS089
051800              PERFORM 2140-DESELECT-ALL-ITEMS                        CL**6
051900                                                                     CL**6
052000              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   CL**6
052100                                                                  POKCS089
052200         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  POKCS089
052300              PERFORM 2150-SELECT-ALL-ITEMS                          CL**6
052400                                                                     CL**6
052500              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   CL**6
052600                                                                  POKCS089
052700         WHEN OTHER                                               POKCS089
052800              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                   CL**6
052900                                                                     CL**6
053000              PERFORM 3000-EDIT-DATA-IN-COMMAREA                     CL**6
053100                                                                     CL**6
053200              IF PS-NO-ERROR                                         CL**6
053300                  SET DP030-CONTINUE-GO TO TRUE                      CL**6
053400                                                                     CL**6
053500                  PERFORM 2100-CHECK-FUNCTION-KEY                    CL**6
053600              ELSE                                                   CL**6
053700                  SET DP030-OVERRIDE-GO TO TRUE                      CL**6
053800              END-IF                                                 CL**6
053900     END-EVALUATE.                                                POKCS089
054000                                                                  POKCS089
054100*----------------------------------------------------------------*POKCS089
054200*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *POKCS089
054300*----------------------------------------------------------------*POKCS089
054400 2050-DELETE-LIST-QUEUE.                                          POKCS089
054500                                                                  POKCS089
054600     EXEC CICS                                                    POKCS089
054700         DELETEQ TS                                               POKCS089
054800             QUEUE (ASC-LIST-QUEUE-NAME)                          POKCS089
054900             RESP  (PV-CICS-RESP)                                 POKCS089
055000     END-EXEC.                                                    POKCS089
055100                                                                  POKCS089
055200     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       POKCS089
055300        (PV-CICS-RESP = DFHRESP(QIDERR))                          POKCS089
055400         CONTINUE                                                 POKCS089
055500     ELSE                                                         POKCS089
055600         SET DP013-CICS-ABEND                                        CL**6
055700             DP013-NO-ROLLBACK TO TRUE                               CL**6
055800                                                                  POKCS089
055900         MOVE '2050-DELETE-LIST-QUEUE'                            POKCS089
056000                                   TO DP013-PARAGRAPH             POKCS089
056100         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    POKCS089
056200                                   TO DP013-MESSAGE-TEXT (1)      POKCS089
056300         PERFORM DP013-0000-PROCESS-ABEND                         POKCS089
056400     END-IF.                                                      POKCS089
056500                                                                  POKCS089
056600     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  POKCS089
056700                                                                  POKCS089
056800*----------------------------------------------------------------*POKCS089
056900* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*POKCS089
057000* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *POKCS089
057100* CICS ARCHITECTURE API.                                         *POKCS089
057200*----------------------------------------------------------------*POKCS089
057300 2100-CHECK-FUNCTION-KEY.                                         POKCS089
057400                                                                  POKCS089
057500     EVALUATE TRUE                                                POKCS089
057510* REQUEST ADD KEY WAS PRESSED                                             
057520*        WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)                       
057521*             MOVE ZERO TO ASC-NUMBER-OF-SELECTED-ITEMS                   
057522*             IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                 CL**6
057523*                 INITIALIZE VL005-INTER-APPL-COMMAREA               CL**6
057524*                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                     *6
057525*                               TO VL005-NUMBER-OF-SELECTED-ITEMS POKCS089
057526*                 PERFORM 5000-PREPARE-SEL-QUEUE                     CL**6
057527*                 SET VL005-ADD TO TRUE                                   
057528* REQUEST INCLUDE KEY WAS PRESSED                                         
057529*        WHEN DP020-FK-LOCAL-FUNC-04(DP020-SRC-AID)                       
057530*             MOVE ZERO TO ASC-NUMBER-OF-SELECTED-ITEMS                   
057531*             IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                 CL**6
057532*                 INITIALIZE VL005-INTER-APPL-COMMAREA               CL**6
057533*                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                     *6
057534*                               TO VL005-NUMBER-OF-SELECTED-ITEMS POKCS089
057535*                 PERFORM 5000-PREPARE-SEL-QUEUE                     CL**6
057540* REQUEST UPDATE KEY WAS PRESSED                                          
057550* REQUEST DELETE KEY WAS PRESSED                                          
057600         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)                     84
057610         WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)                     84
057700              IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                 CL**6
057800                  INITIALIZE VL005-INTER-APPL-COMMAREA               CL**6
057900                  MOVE ASC-NUMBER-OF-SELECTED-ITEMS                  CL**6
058000                                TO VL005-NUMBER-OF-SELECTED-ITEMS POKCS089
058100                  PERFORM 5000-PREPARE-SEL-QUEUE                     CL**6
058200              ELSE                                                   CL**6
058300                  SET DP030-OVERRIDE-GO                              CL**6
058400                      DP020-MSG-WARNING TO TRUE                      CL**6
058500                  MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER          CL**6
058600             END-IF                                               POKCS089
058700                                                                  POKCS089
058800         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  POKCS089
058900             MOVE +1               TO PV-TOP-ITEM                 POKCS089
059000                                                                     CL**6
059100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 POKCS089
059200                                                                     CL**6
059300             PERFORM 3200-RESET-ATTRIBUTES                        POKCS089
059400                                                                  POKCS089
059500         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   POKCS089
059600             PERFORM 2110-BROWSE-BACKWARD                         POKCS089
059700                                                                     CL**6
059800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 POKCS089
059900                                                                     CL**6
060000             PERFORM 3200-RESET-ATTRIBUTES                        POKCS089
060100                                                                  POKCS089
060200         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   POKCS089
060300             PERFORM 2120-BROWSE-FORWARD                          POKCS089
060400                                                                     CL**6
060500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 POKCS089
060600                                                                     CL**6
060700             PERFORM 3200-RESET-ATTRIBUTES                        POKCS089
060800                                                                  POKCS015
060810         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)                       
060900*        WHEN DP020-FK-DISPN-RETURN(DP020-SRC-AID)                POKCS015
061400*            IF  ASC-NUMBER-OF-SELECTED-ITEMS > 0                 POKCS015
061800                 PERFORM 5000-PREPARE-SEL-QUEUE                   POKCS015
061900*            ELSE                                                 POKCS015
062000*                SET DP030-OVERRIDE-GO                            POKCS015
062100*                                  TO TRUE                        POKCS015
062200*                MOVE PC-TSYMSG-00047                             POKCS015
062300*                                  TO DP020-MSG-NUMBER            POKCS015
062400*                SET DP020-MSG-FATAL                              POKCS015
062500*                                  TO TRUE                        POKCS015
062600*            END-IF                                               POKCS015
062601                                                                  POKCS015
062602                                                                  POKCS089
062603         WHEN DP020-SRC-AID = DP016-ENTER                         POKCS089
062604*            PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   POKCS089
062605                                                                     CL**6
062606             IF PS-ERROR                                             CL**6
062607                 CONTINUE                                         POKCS089
062608             ELSE                                                 POKCS089
062609                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             POKCS089
062610             END-IF                                               POKCS089
062611                                                                  POKCS089
062612         WHEN OTHER                                               POKCS089
062613             SET DP013-NO-ROLLBACK                                POKCS089
062614                 DP013-XCTL-DISPLAY-RESTART                       POKCS089
062615                 DP013-CICS-ABEND  TO TRUE                        POKCS089
062616             MOVE '2100-CHECK-FUNCTION-KEY'                       POKCS089
062617                                   TO DP013-PARAGRAPH             POKCS089
062618             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      POKCS089
062619                                   TO DP013-MESSAGE-TEXT (1)      POKCS089
062620             PERFORM DP013-0000-PROCESS-ABEND                     POKCS089
062700     END-EVALUATE.                                                POKCS089
062800                                                                  POKCS089
062900*----------------------------------------------------------------*POKCS089
063000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *POKCS089
063100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *POKCS089
063200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *POKCS089
063300*    MESSAGE.                                                    *POKCS089
063400*----------------------------------------------------------------*POKCS089
063500 2110-BROWSE-BACKWARD.                                            POKCS089
063600                                                                  POKCS089
063700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    POKCS089
063800         GIVING PV-TOP-ITEM.                                      POKCS089
063900                                                                  POKCS089
064000     IF  ((PV-TOP-ITEM < +1)                                      POKCS089
064100       OR (PV-TOP-ITEM = +1))                                     POKCS089
064200         MOVE +1                   TO PV-TOP-ITEM                 POKCS089
064300*        -- TOP OF LIST --                                        POKCS089
064400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            POKCS089
064500         SET DP020-MSG-INFORMATIONAL TO TRUE                      POKCS089
064600     END-IF.                                                      POKCS089
064700                                                                  POKCS089
064800*----------------------------------------------------------------*POKCS089
064900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *POKCS089
065000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *POKCS089
065100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *POKCS089
065200*----------------------------------------------------------------*POKCS089
065300 2120-BROWSE-FORWARD.                                             POKCS089
065400                                                                  POKCS089
065500     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              POKCS089
065600         GIVING PV-TOP-ITEM.                                      POKCS089
065700     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   POKCS089
065800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            POKCS089
065900                                   TO PV-TOP-ITEM                 POKCS089
066000*        -- BOTTOM OF LIST --                                     POKCS089
066100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            POKCS089
066200         SET DP020-MSG-INFORMATIONAL                              POKCS089
066300                                   TO TRUE                        POKCS089
066400     ELSE                                                         POKCS089
066500         COMPUTE PV-BOTTOM-ITEM =                                 POKCS089
066600             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 POKCS089
066700         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            POKCS089
066800*            -- BOTTOM OF LIST --                                 POKCS089
066900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            POKCS089
067000             SET DP020-MSG-INFORMATIONAL                          POKCS089
067100                                   TO TRUE                        POKCS089
067200         END-IF                                                   POKCS089
067300     END-IF.                                                      POKCS089
067400                                                                  POKCS089
067500*----------------------------------------------------------------*POKCS089
067600*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *POKCS089
067700*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *POKCS089
067800*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *POKCS089
067900*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *POKCS089
068000*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *POKCS089
068100*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *POKCS089
068200*----------------------------------------------------------------*POKCS089
068300 2130-CHECK-FOR-JUMP-BROWSE.                                      POKCS089
068400                                                                  POKCS089
068500     SET PS-NO-ERROR               TO TRUE.                       POKCS089
068600     IF (ASC-START-ITEM-REQUEST = SPACE)                          POKCS089
068700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            POKCS089
068800                                   TO PV-TOP-ITEM                 POKCS089
068900     ELSE                                                         POKCS089
069000         MOVE ASC-START-ITEM-REQUEST                              POKCS089
069100                                   TO DP010I-UNEDITED-FIELD       POKCS089
069200         MOVE PC-ITM-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       POKCS089
069300         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     POKCS089
069400         SET DP010I-NEGATIVE-NOT-ALLOWED                          POKCS089
069500                                   TO TRUE                        POKCS089
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263627              USING DP010I-NUMERIC-EDIT-AREA                              
069700                                                                  POKCS089
069800         IF  NOT DP010I-ERROR-DETECTED                            POKCS089
069900             MOVE DP010I-NUMERIC-FIELD                            POKCS089
070000                                   TO  ASC-START-ITEM-REQUEST-N   POKCS089
070100             IF  ASC-START-ITEM-REQUEST-N > ZERO                  POKCS089
070200                 IF  ASC-START-ITEM-REQUEST-N >                   POKCS089
070300                                          ASC-NUMBER-OF-ITEMS-READPOKCS089
070400                     MOVE SPACE TO ASC-START-ITEM-REQUEST         POKCS089
070500                     COMPUTE PV-TOP-ITEM =                        POKCS089
070600                             ASC-NUMBER-OF-ITEMS-READ             POKCS089
070700                             - PC-ITEMS-PER-PANEL + 1             POKCS089
070800                     IF  PV-TOP-ITEM < +1                         POKCS089
070900                         MOVE +1   TO PV-TOP-ITEM                 POKCS089
071000                         MOVE PC-TSYMSG-00070                     POKCS089
071100                                   TO DP020-MSG-NUMBER            POKCS089
071200                         SET DP020-MSG-INFORMATIONAL              POKCS089
071300                                   TO TRUE                        POKCS089
071400                     END-IF                                       POKCS089
071500                 ELSE                                             POKCS089
071600                     MOVE ASC-START-ITEM-REQUEST-N                POKCS089
071700                                   TO PV-TOP-ITEM                 POKCS089
071800                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      POKCS089
071900                     COMPUTE PV-BOTTOM-ITEM =                     POKCS089
072000                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     POKCS089
072100                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READPOKCS089
072200*                        -- BOTTOM OF LIST --                     POKCS089
072300                         MOVE PC-TSYMSG-00070                     POKCS089
072400                                   TO DP020-MSG-NUMBER            POKCS089
072500                         SET DP020-MSG-INFORMATIONAL              POKCS089
072600                                   TO TRUE                        POKCS089
072700                     END-IF                                       POKCS089
072800                 END-IF                                           POKCS089
072900             ELSE                                                 POKCS089
072910                CONTINUE                                                  
073000*                --- VALUE OUT OF RANGE ----                      POKCS089
073100                 MOVE PC-TSYMSG-00101                             POKCS089
073200                                   TO DP020-MSG-NUMBER            POKCS089
073300                 MOVE -1           TO ASTRTITL                    POKCS089
073400                 SET DP030-SET-CURSOR-APPL-1                      POKCS089
073500                                   TO TRUE                        POKCS089
073600                 MOVE DP015-REVERSE                               POKCS089
073700                                   TO ASTRTITH                    POKCS089
073800                 MOVE DP015-RED    TO ASTRTITC                    POKCS089
073900                 MOVE DP015-UNP-NUM-BRT-MDT                       POKCS089
074000                                   TO ASTRTITA                    POKCS089
074100                 SET DP020-MSG-FATAL                              POKCS089
074200                                   TO TRUE                        POKCS089
074300                 SET PS-ERROR      TO TRUE                        POKCS089
074400             END-IF                                               POKCS089
074500                                                                  POKCS089
074600         ELSE                                                     POKCS089
074610             CONTINUE                                                     
074700             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            POKCS089
074800             MOVE -1               TO ASTRTITL                    POKCS089
074900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  POKCS089
075000             MOVE DP015-REVERSE    TO ASTRTITH                    POKCS089
075100             MOVE DP015-RED        TO ASTRTITC                    POKCS089
075200             MOVE DP015-UNP-NUM-BRT-MDT                           POKCS089
075300                                   TO ASTRTITA                    POKCS089
075400             SET DP020-MSG-FATAL   TO TRUE                        POKCS089
075500             SET PS-ERROR          TO TRUE                        POKCS089
075600         END-IF                                                   POKCS089
075700     END-IF.                                                      POKCS089
075701                                                                          
075703 2140-GET-NEXT-RSN.                                                     *1
075704                                                                     CL**1
075705*    ADD +1                       TO ASC-SEL-SUB.                    CL**1
075706*    IF  ASC-SEL-SUB > VL008-MAX-ITEMS                               CL**1
075707*        ADD +1                   TO ASC-SEL-ITEM                    CL**1
075708*        MOVE +1                  TO ASC-SEL-SUB                     CL**1
075709*    END-IF.                                                         CL**1
075710*    IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                   CL**1
075716     IF VL008-REQ-RSN-CDE (VL008-IDX) =                                   
075717                        ASC-REQ-RSN-CDE                                   
075718                            (ASC-BLK-SUB ASC-ITEM-SUB)                    
075719          SET ASC-TEMP-SELECT                                             
075720                            (ASC-BLK-SUB ASC-ITEM-SUB)                    
075721              ASC-SELECT    (ASC-BLK-SUB ASC-ITEM-SUB)                    
075722             PS-LIST-END TO TRUE                                          
075723          ADD +1                                                          
075724                    TO ASC-NUMBER-OF-SELECTED-ITEMS                       
075725*                      VL005-NUMBER-OF-RSN-CODES                        *8
075726*     MOVE ASC-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)                  88
075727*             TO ASC-TEMP-SELECTED-SW                                   88
075728*                           (ASC-BLK-SUB ASC-ITEM-SUB)                  88
075729      ELSE                                                                
075730           SET ASC-NO-SELECT                                              
075731                            (ASC-BLK-SUB ASC-ITEM-SUB)                    
075732                       TO TRUE                                            
075733*     MOVE ASC-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)                  88
075734*             TO ASC-TEMP-SELECTED-SW                                   88
075735*                           (ASC-BLK-SUB ASC-ITEM-SUB)                  88
075736      END-IF.                                                             
075737      IF VL008-IDX GREATER THAN VL008-MAX-ITEMS                           
075738              SET PS-LIST-END TO TRUE                                     
075739     END-IF.                                                              
075740     SET VL008-IDX UP BY 1.                                               
075750                                                                     CL**1
075800                                                                  POKCS089
075900*----------------------------------------------------------------*POKCS089
076000*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *POKCS089
076100*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *POKCS089
076200*----------------------------------------------------------------*POKCS089
076300 2140-DESELECT-ALL-ITEMS.                                         POKCS089
076400                                                                  POKCS089
076500     MOVE +1                       TO ASC-BLK-SUB.                POKCS089
076600                                                                  POKCS089
076700     PERFORM 2141-CLEAR-SELECTED-INDS                             POKCS089
076800         VARYING ASC-ITEM-SUB                                     POKCS089
076900         FROM 1 BY 1                                              POKCS089
077000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 POKCS089
077100                                                                  POKCS089
077200     ADD +1                        TO ASC-BLK-SUB.                POKCS089
077300                                                                  POKCS089
077400     PERFORM 2141-CLEAR-SELECTED-INDS                             POKCS089
077500         VARYING ASC-ITEM-SUB                                     POKCS089
077600         FROM 1 BY 1                                              POKCS089
077700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 POKCS089
077800                                                                  POKCS089
077900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               POKCS089
078000                                   TO PV-LIST-ITEM-NUMBER.        POKCS089
078100                                                                  POKCS089
078200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            POKCS089
078300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    POKCS089
078400                                                                  POKCS089
078500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     POKCS089
078600        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      POKCS089
078700         MOVE +1                   TO ASC-BLK-SUB                 POKCS089
078800                                                                  POKCS089
078900         PERFORM 5100-WRITE-TEMP-STORAGE                          POKCS089
079000                                                                  POKCS089
079100         MOVE +1                   TO PV-BLOCK-NUMBER             POKCS089
079200                                                                  POKCS089
079300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         POKCS089
079400             PV-FIRST-BLOCK-IN-ARRAY - 1                          POKCS089
079500                                                                  POKCS089
079600         PERFORM                                                  POKCS089
079700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       POKCS089
079800                                                                  POKCS089
079900             PERFORM 4410-READ-TEMP-STORAGE                       POKCS089
080000                                                                  POKCS089
080100             PERFORM 2141-CLEAR-SELECTED-INDS                     POKCS089
080200                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 POKCS089
080300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          POKCS089
080400                                                                  POKCS089
080500             PERFORM 5100-WRITE-TEMP-STORAGE                      POKCS089
080600                                                                  POKCS089
080700             ADD +1                TO PV-BLOCK-NUMBER             POKCS089
080800                                                                  POKCS089
080900         END-PERFORM                                              POKCS089
081000                                                                  POKCS089
081100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         POKCS089
081200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     POKCS089
081300                                                                  POKCS089
081400         PERFORM                                                  POKCS089
081500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       POKCS089
081600                   ASC-HIGHEST-BLOCK-WRITTEN                      POKCS089
081700                                                                  POKCS089
081800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          POKCS089
081900                                   TO PV-BLOCK-NUMBER             POKCS089
082000                                                                  POKCS089
082100             PERFORM 4410-READ-TEMP-STORAGE                       POKCS089
082200                                                                  POKCS089
082300             PERFORM 2141-CLEAR-SELECTED-INDS                     POKCS089
082400                 VARYING ASC-ITEM-SUB                             POKCS089
082500                 FROM 1 BY 1                                      POKCS089
082600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          POKCS089
082700                                                                  POKCS089
082800             PERFORM 5100-WRITE-TEMP-STORAGE                      POKCS089
082900                                                                  POKCS089
083000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      POKCS089
083100                                                                  POKCS089
083200         END-PERFORM                                              POKCS089
083300                                                                  POKCS089
083400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             POKCS089
083500                                   TO PV-BLOCK-NUMBER             POKCS089
083600                                                                  POKCS089
083700         PERFORM 4410-READ-TEMP-STORAGE                           POKCS089
083800     END-IF.                                                      POKCS089
083900                                                                  POKCS089
084000                                                                  POKCS089
084100     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. POKCS089
084200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.POKCS089
084300     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  POKCS089
084400                                                                  POKCS089
084500     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        POKCS089
084600                                                                  POKCS089
084700*----------------------------------------------------------------*POKCS089
084800*    MARK EACH ITEM AS BEING NOT SELECTED.                       *POKCS089
084900*----------------------------------------------------------------*POKCS089
085000 2141-CLEAR-SELECTED-INDS.                                        POKCS089
085100                                                                  POKCS089
085200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           POKCS089
085300             NOT EQUAL ZERO                                       POKCS089
085400         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          POKCS089
085500             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          POKCS089
085600                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    POKCS089
085700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  POKCS089
085800                                   TO TRUE                        POKCS089
085900         END-IF                                                   POKCS089
086000     END-IF.                                                      POKCS089
086100                                                                  POKCS089
086200*----------------------------------------------------------------*POKCS089
086300*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *POKCS089
086400*  FOR ALL ITEMS.                                                *POKCS089
086500*----------------------------------------------------------------*POKCS089
086600 2150-SELECT-ALL-ITEMS.                                           POKCS089
086700                                                                  POKCS089
086800     MOVE +1                       TO ASC-BLK-SUB.                POKCS089
086900                                                                  POKCS089
087000     PERFORM 2151-SET-SELECTED-INDS                               POKCS089
087100         VARYING ASC-ITEM-SUB                                     POKCS089
087200         FROM 1 BY 1                                              POKCS089
087300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 POKCS089
087400                                                                  POKCS089
087500     ADD +1                        TO ASC-BLK-SUB.                POKCS089
087600                                                                  POKCS089
087700     PERFORM 2151-SET-SELECTED-INDS                               POKCS089
087800         VARYING ASC-ITEM-SUB                                     POKCS089
087900         FROM 1 BY 1                                              POKCS089
088000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 POKCS089
088100                                                                  POKCS089
088200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               POKCS089
088300                                   TO PV-LIST-ITEM-NUMBER.        POKCS089
088400                                                                  POKCS089
088500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            POKCS089
088600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    POKCS089
088700                                                                  POKCS089
088800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     POKCS089
088900        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    POKCS089
089000         MOVE +1                   TO ASC-BLK-SUB                 POKCS089
089100                                                                  POKCS089
089200         PERFORM 5100-WRITE-TEMP-STORAGE                          POKCS089
089300                                                                  POKCS089
089400         MOVE +1                   TO PV-BLOCK-NUMBER             POKCS089
089500                                                                  POKCS089
089600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         POKCS089
089700             PV-FIRST-BLOCK-IN-ARRAY - 1                          POKCS089
089800                                                                  POKCS089
089900         PERFORM                                                  POKCS089
090000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       POKCS089
090100                                                                  POKCS089
090200             PERFORM 4410-READ-TEMP-STORAGE                       POKCS089
090300                                                                  POKCS089
090400             PERFORM 2151-SET-SELECTED-INDS                       POKCS089
090500                 VARYING ASC-ITEM-SUB                             POKCS089
090600                 FROM 1 BY 1                                      POKCS089
090700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          POKCS089
090800                                                                  POKCS089
090900             PERFORM 5100-WRITE-TEMP-STORAGE                      POKCS089
091000                                                                  POKCS089
091100             ADD +1                TO PV-BLOCK-NUMBER             POKCS089
091200                                                                  POKCS089
091300         END-PERFORM                                              POKCS089
091400                                                                  POKCS089
091500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         POKCS089
091600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     POKCS089
091700                                                                  POKCS089
091800         PERFORM                                                  POKCS089
091900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       POKCS089
092000                   ASC-HIGHEST-BLOCK-WRITTEN                      POKCS089
092100                                                                  POKCS089
092200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          POKCS089
092300                                   TO PV-BLOCK-NUMBER             POKCS089
092400                                                                  POKCS089
092500             PERFORM 4410-READ-TEMP-STORAGE                       POKCS089
092600                                                                  POKCS089
092700             PERFORM 2151-SET-SELECTED-INDS                       POKCS089
092800                 VARYING ASC-ITEM-SUB                             POKCS089
092900                 FROM 1 BY 1                                      POKCS089
093000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          POKCS089
093100                                                                  POKCS089
093200             PERFORM 5100-WRITE-TEMP-STORAGE                      POKCS089
093300                                                                  POKCS089
093400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      POKCS089
093500                                                                  POKCS089
093600         END-PERFORM                                              POKCS089
093700                                                                  POKCS089
093800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             POKCS089
093900                                   TO PV-BLOCK-NUMBER             POKCS089
094000                                                                  POKCS089
094100         PERFORM 4410-READ-TEMP-STORAGE                           POKCS089
094200     END-IF.                                                      POKCS089
094300                                                                  POKCS089
094400                                                                  POKCS089
094500     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             POKCS089
094600                       ASC-NUMBER-OF-SELECTED-ITEMS.              POKCS089
094700                                                                  POKCS089
094800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        POKCS089
094900                                                                  POKCS089
095000*----------------------------------------------------------------*POKCS089
095100*    MARK EACH ITEM AS BEING SELECTED.                           *POKCS089
095200*----------------------------------------------------------------*POKCS089
095300 2151-SET-SELECTED-INDS.                                          POKCS089
095400                                                                  POKCS089
095500     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           POKCS089
095600             NOT EQUAL ZERO                                       POKCS089
095700         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             POKCS089
095800             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             POKCS089
095900                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        POKCS089
096000                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  POKCS089
096100                               TO  TRUE                           POKCS089
096200         END-IF                                                   POKCS089
096300     END-IF.                                                      POKCS089
096400                                                                  POKCS089
096500******************************************************************POKCS089
096600** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **POKCS089
096700** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **POKCS089
096800******************************************************************POKCS089
096900 2200-MOVE-SCREEN-TO-COMMAREA.                                    POKCS089
097000                                                                  POKCS089
097100     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             POKCS089
097200     MOVE +1                       TO PV-SUB.                     POKCS089
097300                                                                  POKCS089
097400     PERFORM 3100-SET-SUBSCRIPTS.                                 POKCS089
097500     IF  ASTRTITL > ZERO                                          POKCS089
097600         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          POKCS089
097700     ELSE                                                         POKCS089
097800         IF  ASTRTITF = DP015-ERASE-EOF                           POKCS089
097900             INITIALIZE ASC-START-ITEM-REQUEST                    POKCS089
098000         END-IF                                                   POKCS089
098100     END-IF.                                                      POKCS089
098200     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          POKCS089
098300         VARYING PV-SUB                                           POKCS089
098400         FROM 1 BY 1                                              POKCS089
098500         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      POKCS089
098600                                                                  POKCS089
098700******************************************************************POKCS089
098800** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**POKCS089
098900******************************************************************POKCS089
099000 2210-MOVE-LINES-TO-COMMAREA.                                     POKCS089
099100                                                                  POKCS089
099200*    IF  MR-SELECTL (PV-SUB) > ZERO                               POKCS089
099300*        SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             POKCS089
099400*        MOVE MR-SELECTI (PV-SUB)                                 POKCS089
099500*                                  TO ASC-TEMP-SELECTED-SW        POKCS089
099600*                                (ASC-BLK-SUB, ASC-ITEM-SUB)      POKCS089
099700*    ELSE                                                         POKCS089
099800*        IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                POKCS089
099900*                SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     POKCS089
100000*                MOVE SPACE        TO ASC-TEMP-SELECTED-SW        POKCS089
100100*                                (ASC-BLK-SUB, ASC-ITEM-SUB)      POKCS089
100200*        END-IF                                                   POKCS089
100300*    END-IF.                                                      POKCS089
100400     ADD +1                        TO ASC-ITEM-SUB.               POKCS089
100500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        POKCS089
100600         ADD +1                    TO ASC-BLK-SUB                 POKCS089
100700         MOVE +1                   TO ASC-ITEM-SUB                POKCS089
100800     END-IF.                                                      POKCS089
100900                                                                  POKCS089
101000******************************************************************POKCS089
101100** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **POKCS089
101200** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **POKCS089
101300******************************************************************POKCS089
101400 3000-EDIT-DATA-IN-COMMAREA.                                      POKCS089
101500                                                                  POKCS089
101600     SET PS-NO-ERROR               TO TRUE.                       POKCS089
101700     PERFORM 3200-RESET-ATTRIBUTES.                               POKCS089
101800     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     POKCS089
101900**                                                                POKCS089
102000* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              POKCS089
102100* EDITTING IS DONE FROM THE BOTTOM UP.                            POKCS089
102200**                                                                POKCS089
102300     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       POKCS089
102400         ASC-ITEMS-DISPLAYED - 1.                                 POKCS089
102500     PERFORM 3100-SET-SUBSCRIPTS.                                 POKCS089
102600     PERFORM 3300-EDIT-SELECTIONS                                 POKCS089
102700         VARYING PV-SUB                                           POKCS089
102800         FROM PV-SUB BY -1                                        POKCS089
102900         UNTIL PV-SUB < +1                                        POKCS089
103000                                                                  POKCS089
103100     IF  PS-NO-ERROR                                              POKCS089
103200         PERFORM 3400-CHECK-RANGE-SEQUENCE                        POKCS089
103300     END-IF.                                                      POKCS089
103400                                                                  POKCS089
103500     IF  ((PS-NO-ERROR)                                           POKCS089
103600       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   POKCS089
103700       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    POKCS089
103800             PERFORM 3500-MARK-RANGE-AS-SELECTED                  POKCS089
103900     END-IF.                                                      POKCS089
104000                                                                  POKCS089
104100*----------------------------------------------------------------*POKCS089
104200*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *POKCS089
104300*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*POKCS089
104400*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *POKCS089
104500*                                                                *POKCS089
104600*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *POKCS089
104700*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *POKCS089
104800*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *POKCS089
104900*    US IN THE 2ND BLOCK OF THE ARRAY.                           *POKCS089
105000*----------------------------------------------------------------*POKCS089
105100 3100-SET-SUBSCRIPTS.                                             POKCS089
105200                                                                  POKCS089
105300     COMPUTE ASC-ITEM-SUB =                                       POKCS089
105400         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        POKCS089
105500                                                                  POKCS089
105600     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         POKCS089
105700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            POKCS089
105800                                                                  POKCS089
105900         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               POKCS089
106000     ELSE                                                         POKCS089
106100         MOVE +1                     TO ASC-BLK-SUB               POKCS089
106200     END-IF.                                                      POKCS089
106300                                                                  POKCS089
106400******************************************************************POKCS089
106500** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **POKCS089
106600******************************************************************POKCS089
106700 3200-RESET-ATTRIBUTES.                                           POKCS089
106800                                                                  POKCS089
106900     MOVE DP015-UNP-ALP-NOR-OFF TO ASTRTITA.                      POKCS089
107000     MOVE DP015-GREEN           TO ASTRTITC.                      POKCS089
107100     MOVE DP015-UNDERLINE       TO ASTRTITH.                      POKCS089
107200                                                                  POKCS089
107300*    IF DP020-NEXT-ACT-RETURN OR                                  POKCS089
107400*       DP020-NEXT-ACT-READ-MAP                                   POKCS089
107500*        PERFORM VARYING PV-SUB  FROM 1 BY 1                      POKCS089
107600*                UNTIL   PV-SUB > ASC-ITEMS-DISPLAYED             POKCS089
107700*                 MOVE DP015-UNP-ALP-NOR-OFF                      POKCS089
107800*                                      TO MR-SELECTA (PV-SUB)     POKCS089
107900*                 MOVE DP015-GREEN     TO MR-SELECTC (PV-SUB)     POKCS089
108000*                 MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)     POKCS089
108100*        END-PERFORM                                              POKCS089
108200*    ELSE                                                         POKCS089
108300*        PERFORM VARYING PV-SUB  FROM 1 BY 1                      POKCS089
108400*                UNTIL   PV-SUB > PC-ITEMS-PER-PANEL              POKCS089
108500*                 MOVE DP015-UNP-ALP-NOR-OFF                      POKCS089
108600*                                      TO MR-SELECTA (PV-SUB)     POKCS089
108700*                 MOVE DP015-GREEN     TO MR-SELECTC (PV-SUB)     POKCS089
108800*                 MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)     POKCS089
108900*        END-PERFORM.                                             POKCS089
109000                                                                  POKCS089
109100******************************************************************POKCS089
109200** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **POKCS089
109300** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **POKCS089
109400** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **POKCS089
109500** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **POKCS089
109600******************************************************************POKCS089
109700 3300-EDIT-SELECTIONS.                                            POKCS089
109800                                                                  POKCS089
109900     EVALUATE TRUE                                                POKCS089
110000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     POKCS089
110100             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         POKCS089
110200                 CONTINUE                                         POKCS089
110300         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         POKCS089
110400             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        POKCS089
110500                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   POKCS089
110600                 MOVE ASC-TEMP-SELECTED-SW                        POKCS089
110700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  POKCS089
110800                                TO ASC-SELECTED-SW                POKCS089
110900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  POKCS089
111000             END-IF                                               POKCS089
111100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     POKCS089
111200                 = SPACE                                          POKCS089
111300             EVALUATE TRUE                                        POKCS089
111400                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       POKCS089
111500                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMSPOKCS089
111600                     MOVE SPACE TO ASC-SELECTED-SW                POKCS089
111700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  POKCS089
111800                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        POKCS089
111900                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    POKCS089
112000                     MOVE SPACE TO ASC-SELECTED-SW                POKCS089
112100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  POKCS089
112200                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          POKCS089
112300                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      POKCS089
112400                     MOVE SPACE TO ASC-SELECTED-SW                POKCS089
112500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  POKCS089
112600             END-EVALUATE                                         POKCS089
112700         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           POKCS089
112800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            POKCS089
112900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    POKCS089
113000             END-IF                                               POKCS089
113100             PERFORM 3310-EDIT-RANGE                              POKCS089
113200         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             POKCS089
113300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            POKCS089
113400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    POKCS089
113500             END-IF                                               POKCS089
113600             PERFORM 3310-EDIT-RANGE                              POKCS089
113700         WHEN OTHER                                               POKCS089
113800             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           POKCS089
113900             SET DP020-MSG-FATAL    TO TRUE                       POKCS089
114000*            MOVE -1                TO MR-SELECTL (PV-SUB)        POKCS089
114100             SET DP030-SET-CURSOR-APPL-1                          POKCS089
114200                                    TO TRUE                       POKCS089
114300*            MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        POKCS089
114400*            MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        POKCS089
114500             SET PS-ERROR TO TRUE                                 POKCS089
114600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            POKCS089
114700                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     POKCS089
114800                 MOVE SPACE         TO ASC-SELECTED-SW            POKCS089
114900                                        (ASC-BLK-SUB ASC-ITEM-SUB)POKCS089
115000             END-IF                                               POKCS089
115100     END-EVALUATE.                                                POKCS089
115200                                                                  POKCS089
115300     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 POKCS089
115400     SUBTRACT +1 FROM ASC-ITEM-SUB.                               POKCS089
115500     IF  ASC-ITEM-SUB < 1                                         POKCS089
115600         SUBTRACT +1 FROM ASC-BLK-SUB                             POKCS089
115700         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                POKCS089
115800     END-IF.                                                      POKCS089
115900                                                                  POKCS089
116000******************************************************************POKCS089
116100** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **POKCS089
116200** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **POKCS089
116300** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**POKCS089
116400** THE ENDING.                                                  **POKCS089
116500******************************************************************POKCS089
116600 3310-EDIT-RANGE.                                                 POKCS089
116700                                                                  POKCS089
116800     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                POKCS089
116900         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   POKCS089
117000             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)POKCS089
117100                                   TO ASC-SELECTED-SW             POKCS089
117200                                        (ASC-BLK-SUB ASC-ITEM-SUB)POKCS089
117300             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE POKCS089
117400         ELSE                                                     POKCS089
117500             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     POKCS089
117600                 CONTINUE                                         POKCS089
117700             ELSE                                                 POKCS089
117800*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        POKCS089
117900                 MOVE PC-TSYMSG-00054                             POKCS089
118000                                   TO DP020-MSG-NUMBER            POKCS089
118100                 SET DP020-MSG-FATAL                              POKCS089
118200                                   TO TRUE                        POKCS089
118300*                MOVE -1           TO MR-SELECTL (PV-SUB)         POKCS089
118400                 SET DP030-SET-CURSOR-APPL-1                      POKCS089
118500                                   TO TRUE                        POKCS089
118600*                MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         POKCS089
118700*                MOVE DP015-UNDERLINE                             POKCS089
118800*                                  TO MR-SELECTH (PV-SUB)         POKCS089
118900                 SET PS-ERROR      TO TRUE                        POKCS089
119000             END-IF                                               POKCS089
119100         END-IF                                                   POKCS089
119200     ELSE                                                         POKCS089
119300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     POKCS089
119400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) POKCS089
119500                                   TO ASC-SELECTED-SW             POKCS089
119600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   POKCS089
119700             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   POKCS089
119800         ELSE                                                     POKCS089
119900             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       POKCS089
120000                 CONTINUE                                         POKCS089
120100             ELSE                                                 POKCS089
120200*                -- ONLY ONE END-OF-RANGE ALLOWED --              POKCS089
120300                 MOVE PC-TSYMSG-00055                             POKCS089
120400                                   TO DP020-MSG-NUMBER            POKCS089
120500                 SET DP020-MSG-FATAL                              POKCS089
120600                                   TO TRUE                        POKCS089
120700*                MOVE -1           TO MR-SELECTL (PV-SUB)         POKCS089
120800                 SET DP030-SET-CURSOR-APPL-1                      POKCS089
120900                                   TO TRUE                        POKCS089
121000                 SET PS-ERROR      TO TRUE                        POKCS089
121100             END-IF                                               POKCS089
121200         END-IF                                                   POKCS089
121300     END-IF.                                                      POKCS089
121400                                                                  POKCS089
121500******************************************************************POKCS089
121600** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **POKCS089
121700** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **POKCS089
121800******************************************************************POKCS089
121900 3400-CHECK-RANGE-SEQUENCE.                                       POKCS089
122000                                                                  POKCS089
122100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       POKCS089
122200       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      POKCS089
122300       AND  ASC-START-OF-SELECTED-RANGE >                         POKCS089
122400                                         ASC-END-OF-SELECTED-RANGEPOKCS089
122500*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                POKCS089
122600         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 POKCS089
122700         SET DP020-MSG-FATAL TO TRUE                              POKCS089
122800         SET PS-ERROR TO TRUE                                     POKCS089
122900         PERFORM 3410-POSITION-AT-ERROR                           POKCS089
123000     END-IF.                                                      POKCS089
123100                                                                  POKCS089
123200******************************************************************POKCS089
123300** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **POKCS089
123400** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **POKCS089
123500** SHOULD BE POSITIONED ON A RANGE ERROR.                       **POKCS089
123600******************************************************************POKCS089
123700 3410-POSITION-AT-ERROR.                                          POKCS089
123800                                                                  POKCS089
123900     SET DP030-SET-CURSOR-APPL-1                                  POKCS089
124000                                   TO TRUE.                       POKCS089
124100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 POKCS089
124200                    - PV-TOP-ITEM + 1.                            POKCS089
124300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      POKCS089
124400         CONTINUE                                                 POKCS089
124500*    ELSE                                                         POKCS089
124600*        MOVE -1                   TO MR-SELECTL (PV-SUB)         POKCS089
124700*        MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         POKCS089
124800*        MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         POKCS089
124900     END-IF.                                                      POKCS089
125000                                                                  POKCS089
125100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   POKCS089
125200                    - PV-TOP-ITEM + 1.                            POKCS089
125300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      POKCS089
125400         CONTINUE                                                 POKCS089
125500*    ELSE                                                         POKCS089
125600*        MOVE -1                   TO MR-SELECTL (PV-SUB)         POKCS089
125700*        MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         POKCS089
125800*        MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         POKCS089
125900     END-IF.                                                      POKCS089
126000                                                                  POKCS089
126100*----------------------------------------------------------------*POKCS089
126200*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *POKCS089
126300*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *POKCS089
126400*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *POKCS089
126500*----------------------------------------------------------------*POKCS089
126600 3500-MARK-RANGE-AS-SELECTED.                                     POKCS089
126700                                                                  POKCS089
126800     MOVE +1                       TO  ASC-BLK-SUB.               POKCS089
126900     PERFORM 3510-MARK-SELECTED-INDS                              POKCS089
127000         VARYING ASC-ITEM-SUB                                     POKCS089
127100         FROM 1 BY 1                                              POKCS089
127200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 POKCS089
127300                                                                  POKCS089
127400     ADD +1                        TO ASC-BLK-SUB.                POKCS089
127500     PERFORM 3510-MARK-SELECTED-INDS                              POKCS089
127600         VARYING ASC-ITEM-SUB                                     POKCS089
127700         FROM 1 BY 1                                              POKCS089
127800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 POKCS089
127900                                                                  POKCS089
128000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               POKCS089
128100                                   TO  PV-LIST-ITEM-NUMBER.       POKCS089
128200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            POKCS089
128300         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         POKCS089
128400               PC-ITEMS-PER-PANEL).                               POKCS089
128500                                                                  POKCS089
128600     MOVE ASC-START-OF-SELECTED-RANGE                             POKCS089
128700                                   TO PV-START-OF-SELECTED-RANGE. POKCS089
128800     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            POKCS089
128900         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  POKCS089
129000               PC-ITEMS-PER-PANEL).                               POKCS089
129100                                                                  POKCS089
129200     MOVE ASC-END-OF-SELECTED-RANGE                               POKCS089
129300                                   TO  PV-END-OF-SELECTED-RANGE.  POKCS089
129400     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             POKCS089
129500         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    POKCS089
129600               PC-ITEMS-PER-PANEL).                               POKCS089
129700     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             POKCS089
129800         PV-FIRST-BLOCK-IN-ARRAY + 1.                             POKCS089
129900                                                                  POKCS089
130000     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    POKCS089
130100        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        POKCS089
130200         MOVE +1                   TO ASC-BLK-SUB                 POKCS089
130300         PERFORM 5100-WRITE-TEMP-STORAGE                          POKCS089
130400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         POKCS089
130500             PV-FIRST-BLOCK-IN-ARRAY - 1                          POKCS089
130600                                                                  POKCS089
130700         PERFORM                                                  POKCS089
130800             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      POKCS089
130900                   PV-PREV-BLOCK-IN-ARRAY                         POKCS089
131000             MOVE PV-FIRST-BLOCK-IN-RANGE                         POKCS089
131100                                   TO PV-BLOCK-NUMBER             POKCS089
131200             PERFORM 4410-READ-TEMP-STORAGE                       POKCS089
131300             PERFORM 3510-MARK-SELECTED-INDS                      POKCS089
131400                 VARYING ASC-ITEM-SUB                             POKCS089
131500                 FROM 1 BY 1                                      POKCS089
131600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          POKCS089
131700             PERFORM 5100-WRITE-TEMP-STORAGE                      POKCS089
131800             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     POKCS089
131900         END-PERFORM                                              POKCS089
132000                                                                  POKCS089
132100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         POKCS089
132200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     POKCS089
132300         PERFORM                                                  POKCS089
132400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       POKCS089
132500                   PV-LAST-BLOCK-IN-RANGE                         POKCS089
132600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          POKCS089
132700                                   TO PV-BLOCK-NUMBER             POKCS089
132800             PERFORM 4410-READ-TEMP-STORAGE                       POKCS089
132900             PERFORM 3510-MARK-SELECTED-INDS                      POKCS089
133000                 VARYING ASC-ITEM-SUB                             POKCS089
133100                 FROM 1 BY 1                                      POKCS089
133200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          POKCS089
133300             PERFORM 5100-WRITE-TEMP-STORAGE                      POKCS089
133400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      POKCS089
133500         END-PERFORM                                              POKCS089
133600                                                                  POKCS089
133700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             POKCS089
133800                                   TO PV-BLOCK-NUMBER             POKCS089
133900         PERFORM 4410-READ-TEMP-STORAGE                           POKCS089
134000     END-IF.                                                      POKCS089
134100                                                                  POKCS089
134200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE POKCS089
134300                                      ASC-END-OF-SELECTED-RANGE.  POKCS089
134400                                                                  POKCS089
134500*----------------------------------------------------------------*POKCS089
134600* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *POKCS089
134700*----------------------------------------------------------------*POKCS089
134800 3510-MARK-SELECTED-INDS.                                         POKCS089
134900                                                                  POKCS089
135000     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         POKCS089
135100                                ASC-ITEM-SUB) >                   POKCS089
135200         ASC-START-OF-SELECTED-RANGE)                             POKCS089
135300     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         POKCS089
135400                                ASC-ITEM-SUB) =                   POKCS089
135500         ASC-START-OF-SELECTED-RANGE)                             POKCS089
135600                                                                  POKCS089
135700         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     POKCS089
135800                                    ASC-ITEM-SUB) <               POKCS089
135900             ASC-END-OF-SELECTED-RANGE)                           POKCS089
136000         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     POKCS089
136100                                    ASC-ITEM-SUB) =               POKCS089
136200             ASC-END-OF-SELECTED-RANGE)                           POKCS089
136300                                                                  POKCS089
136400             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          POKCS089
136500                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   POKCS089
136600                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   POKCS089
136700                               TO TRUE                            POKCS089
136800                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              POKCS089
136900                               TO TRUE                            POKCS089
137000                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    POKCS089
137100             END-IF                                               POKCS089
137200         END-IF                                                   POKCS089
137300     END-IF.                                                      POKCS089
137400                                                                  POKCS089
137500*----------------------------------------------------------------*POKCS089
137600*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *POKCS089
137700*    INITIALIZE ALL COUNTERS AND FLAGS.                          *POKCS089
137800*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *POKCS089
137900*    DISPLAY THE PANEL TO USER.                                  *POKCS089
138000*----------------------------------------------------------------*POKCS089
138100 4000-BUILD-INITIAL-PANEL.                                        POKCS089
138200                                                                  POKCS089
138300     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            POKCS089
138400                                 ASC-BLOCK-ENTRIES (2).           POKCS089
138500     MOVE +1                 TO ASC-BLK-SUB.                      POKCS089
138600     SET ASC-ITEMS-LEFT-ON-DB                                     POKCS089
138700                             TO TRUE.                             POKCS089
138800                                                                  POKCS089
138900     MOVE +0                 TO ASC-ITEM-SUB                      POKCS089
139000                                ASC-NUMBER-OF-ITEMS-READ          POKCS089
139100                                ASC-NUMBER-OF-SELECTED-ITEMS      POKCS089
139200                                ASC-HIGHEST-BLOCK-WRITTEN         POKCS089
139300                                ASC-START-OF-SELECTED-RANGE       POKCS089
139400                                ASC-END-OF-SELECTED-RANGE         POKCS089
139500                                ASC-ITEM-AT-TOP-OF-PANEL.         POKCS089
139600                                                                  POKCS089
139700*    PERFORM 4050-PREPARE-CURSOR-KEY                              POKCS089
139800                                                                  POKCS089
139900     PERFORM 4010-OPEN-CURSOR.                                    POKCS089
140000                                                                  POKCS089
140100     PERFORM 4200-READ-ITEMS-FROM-DB.                             POKCS089
140200                                                                  POKCS089
140300     PERFORM 4020-CLOSE-CURSOR.                                   POKCS089
140400                                                                  POKCS089
140500     MOVE +1                   TO  PV-TOP-ITEM.                   POKCS089
140600*    IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          POKCS089
140700*        SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    POKCS089
140800*        SET DP020-MSG-FATAL   TO  TRUE                           POKCS089
140900*        MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               POKCS089
141000*    ELSE                                                         POKCS089
141100*        MOVE -1               TO MR-SELECTL (1).                 POKCS089
141200         SET DP030-SET-CURSOR-APPL-1                              POKCS089
141300                               TO TRUE.                           POKCS089
141400         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                    POKCS089
141500*    END-IF.                                                      POKCS089
141600                                                                  POKCS089
141700*----------------------------------------------------------------*POKCS089
141800* PREPARE THE DB KEY BY REPLACING * WITH %                       *POKCS089
141900*----------------------------------------------------------------*POKCS089
142000*4050-PREPARE-CURSOR-KEY.                                         POKCS089
142100*                                                                 POKCS089
142200*    MOVE ASC-KEY-VEND-NAME    TO DK-VEND-NAME.                   POKCS089
142300*    MOVE ASC-KEY-STATUS-CODE  TO DK-STATUS-CODE.                 POKCS089
142400*    IF DK-VEND-NAME > SPACES                                     POKCS089
142500*        IF DK-VEND-NAME-BYTE (1) = '*'                           POKCS089
142600*            MOVE PC-PERCENT   TO DK-VEND-NAME-BYTE (1)           POKCS089
142700*            INSPECT DK-VEND-NAME                                 POKCS089
142800*                REPLACING FIRST '*' BY PC-PERCENT                POKCS089
142900*        END-IF                                                   POKCS089
143000*        SET PS-NOT-DONE TO TRUE                                  POKCS089
143100*        PERFORM VARYING PV-SUB                                   POKCS089
143200*            FROM LENGTH OF DK-VEND-NAME BY -1                    POKCS089
143300*            UNTIL PV-SUB = 1                                     POKCS089
143400*               OR PS-DONE                                        POKCS089
143500*                IF DK-VEND-NAME-BYTE (PV-SUB) = '*'              POKCS089
143600*                    MOVE PC-PERCENT TO DK-VEND-NAME-BYTE (PV-SUB)POKCS089
143700*                    SET PS-DONE TO TRUE                          POKCS089
143800*                END-IF                                           POKCS089
143900**               IF DK-VEND-NAME-BYTE (PV-SUB) > SPACES           POKCS089
144000*                    SET PS-DONE TO TRUE                          POKCS089
144100*                ELSE                                             POKCS089
144200*                    MOVE PC-PERCENT TO DK-VEND-NAME-BYTE (PV-SUB)POKCS089
144300*                END-IF                                           POKCS089
144400*        END-PERFORM                                              POKCS089
144500*    ELSE                                                         POKCS089
144600*        MOVE ALL '%' TO DK-VEND-NAME.                            POKCS089
144700                                                                  POKCS089
144800*----------------------------------------------------------------*POKCS089
144900* OPEN  THE VENDOR   CURSOR.                                     *POKCS089
145000*----------------------------------------------------------------*POKCS089
145100 4010-OPEN-CURSOR.                                                POKCS089
145200                                                                  POKCS089
145300     PERFORM                                                      POKCS089
145400         WITH TEST AFTER                                          POKCS089
145500         VARYING PV-RETRY-COUNTER                                 POKCS089
145600         FROM 1 BY 1                                              POKCS089
145700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               POKCS089
145800                   OR (SQLCODE = ZERO))                           POKCS089
145900             MOVE 'CURSOR:  RSNDSC_CSR'                                 88
146000                               TO DP013-MESSAGE-TEXT (2)          POKCS089
146100             EXEC SQL                                             POKCS089
146200                  OPEN RSNDSC_CSR                                       88
146300             END-EXEC                                             POKCS089
146400                                                                  POKCS089
146500         EVALUATE TRUE                                            POKCS089
146600             WHEN SQLCODE = ZERO                                  POKCS089
146700             WHEN SQLCODE = -904                                  POKCS089
146800             WHEN SQLCODE = -913                                  POKCS089
146900                 CONTINUE                                         POKCS089
147000             WHEN SQLWARN0 NOT = SPACES                           POKCS089
147100             WHEN SQLCODE < ZERO                                  POKCS089
147200             WHEN SQLCODE > ZERO                                  POKCS089
147300                 MOVE '4010-OPEN-CURSOR'                          POKCS089
147400                                   TO DP013-PARAGRAPH             POKCS089
147500                 MOVE 'OPEN VENDOR CURSOR - '                     POKCS089
147600                                   TO DP013-MESSAGE-TEXT (1)      POKCS089
147700                 MOVE SQLCA        TO DP013-SQLCA                 POKCS089
147800                 MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)    POKCS089
147900                 SET DP013-DB2-ABEND                              POKCS089
148000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           POKCS089
148100                 PERFORM DP013-0000-PROCESS-ABEND                 POKCS089
148200         END-EVALUATE                                             POKCS089
148300     END-PERFORM.                                                 POKCS089
148400                                                                  POKCS089
148500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        POKCS089
148600         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             POKCS089
148700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   POKCS089
148800                                   TO DP013-MESSAGE-TEXT (1)      POKCS089
148900         MOVE SQLCA                TO DP013-SQLCA                 POKCS089
149000         MOVE 'TSYMSG  '           TO DP013-DB2-TABLE-NAME (1)    POKCS089
149100         SET DP013-DB2-ABEND                                      POKCS089
149200             DP013-XCTL-DISPLAY-RESTART                           POKCS089
149300                                   TO TRUE                        POKCS089
149400         PERFORM DP013-0000-PROCESS-ABEND                         POKCS089
149500     END-IF.                                                      POKCS089
149600                                                                  POKCS089
149700*----------------------------------------------------------------*POKCS089
149800*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *POKCS089
149900*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *POKCS089
150000*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *POKCS089
150100*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *POKCS089
150200*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *POKCS089
150300*----------------------------------------------------------------*POKCS089
150400 4200-READ-ITEMS-FROM-DB.                                         POKCS089
150500                                                                  POKCS089
150600     PERFORM VARYING PV-READ-COUNT  FROM 1 BY 1                      CL**3
150700             UNTIL   PV-READ-COUNT > PC-MAX-ITEMS OR                 CL**3
150800                     ASC-NO-ITEMS-LEFT-ON-DB                         CL**3
150900                                                                  POKCS089
151000             PERFORM 4210-FETCH-CURSOR                               CL**3
151100                                                                  POKCS089
151200             IF ASC-ITEMS-LEFT-ON-DB                                 CL**3
151300                IF ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                 CL**3
151400                    CONTINUE                                         CL*10
151500                ELSE                                                 CL**3
151600                    ADD  +1 TO ASC-BLK-SUB                           CL**3
151700                    MOVE +0 TO ASC-ITEM-SUB                          CL**9
151800                    IF ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY          CL**3
151900                        MOVE +1 TO ASC-BLK-SUB                       CL**3
152000                        SET ASC-BLOCK-MODIFIED (1) TO TRUE           CL**3
152100                                                                     CL**3
152200                        PERFORM 5100-WRITE-TEMP-STORAGE              CL**3
152300                                                                     CL**3
152400                        MOVE ASC-BLOCK-ENTRIES                       CL**3
152500                                          (PC-MAX-BLOCKS-IN-ARRAY)   CL**3
152600                                TO ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   CL**3
152700                        ADD +1 TO ASC-BLK-SUB                        CL**3
152800                        INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   CL**3
152900                        SET ASC-BLOCK-NOT-MODIFIED   (ASC-BLK-SUB)   CL**3
153000                                                           TO TRUE   CL**3
153100                    END-IF                                           CL**3
153200                END-IF                                               CL**3
153300                PERFORM 4220-MOVE-DB-ITEMS THRU 4220-EXIT               10
153400             END-IF                                                  CL**3
153500     END-PERFORM.                                                 POKCS089
153600                                                                  POKCS089
153700     IF ASC-NUMBER-OF-ITEMS-READ > ZERO                              CL**3
153800         MOVE +1 TO ASC-BLK-SUB                                      CL**3
153900                                                                     CL**3
154000         PERFORM 5100-WRITE-TEMP-STORAGE                          POKCS089
154100                                                                     CL**3
154200         ADD  +1 TO ASC-BLK-SUB                                      CL**3
154300                                                                     CL**8
154400         PERFORM 5100-WRITE-TEMP-STORAGE                          POKCS089
154500                                                                  POKCS089
154600         MOVE 1  TO ASC-BLK-SUB                                      CL**3
154700                    PV-BLOCK-NUMBER                                  CL**3
154800                                                                     CL**3
154900         PERFORM 4410-READ-TEMP-STORAGE                           POKCS089
155000                                                                     CL**3
155100         IF ASC-HIGHEST-BLOCK-WRITTEN > 1                            CL**3
155200             MOVE 2 TO ASC-BLK-SUB                                   CL**3
155300                       PV-BLOCK-NUMBER                               CL**3
155400                                                                     CL**3
155500             PERFORM 4410-READ-TEMP-STORAGE                       POKCS089
155600         END-IF                                                   POKCS089
155700     END-IF.                                                      POKCS089
155800                                                                  POKCS089
155900 4210-FETCH-CURSOR.                                               POKCS089
156000                                                                  POKCS089
156100     EXEC SQL                                                     POKCS089
156210          FETCH RSNDSC_CSR                                              88
156300          INTO  :PTRDSC-REQ-RSN-CDE                                     *3
156400               ,:PTRDSC-REQ-RSN-DESC                                    *3
156900     END-EXEC                                                     POKCS089
157000                                                                  POKCS089
157100     EVALUATE TRUE                                                POKCS089
157200         WHEN SQLCODE = ZERO                                      POKCS089
157300         WHEN SQLCODE = +100                                      POKCS089
157400              CONTINUE                                            POKCS089
157500         WHEN SQLWARN0 NOT = SPACE                                POKCS089
157600         WHEN SQLCODE NOT = ZERO                                  POKCS089
157700              MOVE '4210-FETCH-CURSOR'                            POKCS089
157800                               TO DP013-PARAGRAPH                 POKCS089
157900              MOVE 'FETCH VENDOR CURSOR'                          POKCS089
158000                               TO DP013-MESSAGE-TEXT (1)          POKCS089
158100              MOVE SQLCA       TO DP013-SQLCA                     POKCS089
158200              SET DP013-DB2-ABEND                                 POKCS089
158300                               TO TRUE                            POKCS089
158400              PERFORM DP013-0000-PROCESS-ABEND                    POKCS089
158500     END-EVALUATE.                                                POKCS089
158600                                                                  POKCS089
158700     IF  SQLCODE EQUAL +100                                       POKCS089
158800         SET ASC-NO-ITEMS-LEFT-ON-DB                              POKCS089
158900                                   TO TRUE                        POKCS089
159000     END-IF.                                                      POKCS089
159100                                                                  POKCS089
159200 4220-MOVE-DB-ITEMS.                                                    10
162100                                                                     CL**3
162200     ADD +1 TO ASC-ITEM-SUB                                          CL**7
162300               ASC-NUMBER-OF-ITEMS-READ.                             CL**7
162400     MOVE ASC-NUMBER-OF-ITEMS-READ TO ASC-LIST-ITEM-NUMBER           CL**3
162500                                       (ASC-BLK-SUB ASC-ITEM-SUB).   CL**3
162810     MOVE PTRDSC-REQ-RSN-CDE TO    ASC-REQ-RSN-CDE                      *3
162900                                       (ASC-BLK-SUB ASC-ITEM-SUB).   CL**3
163020     MOVE PTRDSC-REQ-RSN-DESC  TO ASC-REQ-RSN-DESC                      *2
163100                                       (ASC-BLK-SUB ASC-ITEM-SUB).   CL**3
163110*    IF PS-RSN-SEL-FOUND                                                  
163111*        SET PS-NO-LIST-END TO TRUE                                       
163112*        SET VL008-IDX TO 1                                               
163120*        PERFORM  2140-GET-NEXT-RSN                                       
163121*            UNTIL PS-LIST-END                                            
163130*    ELSE                                                                 
163200*       PERFORM 4030-SELECT-REASON                                        
163300*          IF SQLCODE = 0                                                 
163400*            SET ASC-SELECT                                               
163410*                    (ASC-BLK-SUB ASC-ITEM-SUB)                         *3
163411*                ASC-TEMP-SELECT                                          
163412*                    (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE                 *3
163420             ADD +1                                                       
163430                    TO ASC-NUMBER-OF-SELECTED-ITEMS.                      
163440*                      VL005-NUMBER-OF-RSN-CODES                        *8
163500*       ELSE                                                              
163600*            CONTINUE                                                     
163700*       END-IF                                                            
163710*    END-IF.                                                              
163800 4220-EXIT.                                                          CL**3
163900     EXIT.                                                           CL**3
167400                                                                  POKCS089
167500*----------------------------------------------------------------*POKCS089
167600* CLOSE THE VENDOR   CURSOR.                                     *POKCS089
167700*----------------------------------------------------------------*POKCS089
167800 4020-CLOSE-CURSOR.                                               POKCS089
167900                                                                  POKCS089
168000     EXEC SQL                                                     POKCS089
168100         CLOSE RSNDSC_CSR                                               88
168200     END-EXEC                                                     POKCS089
168300                                                                  POKCS089
168400     EVALUATE TRUE                                                POKCS089
168500         WHEN SQLCODE = ZERO                                      POKCS089
168600             CONTINUE                                             POKCS089
168700         WHEN SQLWARN0 NOT = SPACES                               POKCS089
168800         WHEN SQLCODE < ZERO                                      POKCS089
168900         WHEN SQLCODE > ZERO                                      POKCS089
169000             MOVE '4020-CLOSE-CURSOR'                             POKCS089
169100                               TO DP013-PARAGRAPH                 POKCS089
169200             MOVE 'CLOSE VENDOR CURSOR '                          POKCS089
169300                               TO DP013-MESSAGE-TEXT (1)          POKCS089
169400             MOVE SQLCA        TO DP013-SQLCA                     POKCS089
169500             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        POKCS089
169600             SET DP013-DB2-ABEND                                  POKCS089
169700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               POKCS089
169800             PERFORM DP013-0000-PROCESS-ABEND                     POKCS089
169900     END-EVALUATE.                                                POKCS089
170000                                                                  POKCS089
170001 4030-SELECT-REASON.                                              POKCS089
170002                                                                  RCKCS279
170003     EXEC SQL                                                     RCKCS279
170004         SELECT PO_REQ_NBR                                              79
170005               ,REQ_RSN_CDE                                             79
170006         INTO :PTKRSN-PO-REQ-NBR                                        79
170007             ,:PTKRSN-REQ-RSN-CDE                                       79
170008         FROM  TPTKRSN                                                  79
170009         WHERE PO_REQ_NBR    = :DK-PO-REQ-NBR                           79
170010           AND REQ_RSN_CDE   = :PTRDSC-REQ-RSN-CDE                      *3
170013     END-EXEC                                                     RCKCS279
170014                                                                  RCKCS279
170015     EVALUATE TRUE                                                RCKCS279
170016         WHEN SQLCODE = ZERO                                      RCKCS279
170017             CONTINUE                                                   79
170018         WHEN SQLCODE = +100                                      RCKCS279
170019             CONTINUE                                                   79
170023         WHEN SQLCODE = -904                                      RCKCS279
170024         WHEN SQLCODE = -911                                      RCKCS279
170025         WHEN SQLCODE = -913                                      RCKCS279
170026             PERFORM 9900-SOFT-ABORT                              RCKCS279
170027         WHEN SQLWARN0 NOT = SPACE                                RCKCS279
170028         WHEN SQLCODE < ZERO                                      RCKCS279
170029         WHEN SQLCODE > ZERO                                      RCKCS279
170030             MOVE '4030-SELECT-REASON'                                  79
170031                             TO DP013-PARAGRAPH                   RCKCS279
170032             MOVE 'SELECT ON TPTKRSN'                                   79
170033                             TO DP013-MESSAGE-TEXT (1)            RCKCS279
170034             MOVE SQLCA          TO DP013-SQLCA                   RCKCS279
170035             MOVE 'TTRBNTF'      TO DP013-DB2-TABLE-NAME (1)      RCKCS279
170036             MOVE 'TTRBRSN'      TO DP013-DB2-TABLE-NAME (2)      RCKCS279
170037             SET DP013-DB2-ABEND                                  RCKCS279
170038                 DP013-XCTL-DISPLAY-RESTART                       RCKCS279
170039                             TO TRUE                              RCKCS279
170040              PERFORM DP013-0000-PROCESS-ABEND                    RCKCS279
170041     END-EVALUATE.                                                RCKCS279
170050/                                                                 RCKCS279
170100*----------------------------------------------------------------*POKCS089
170200* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *POKCS089
170300*----------------------------------------------------------------*POKCS089
170400 4400-MOVE-COMMAREA-TO-SCREEN.                                    POKCS089
170500                                                                  POKCS089
170600     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             POKCS089
170700         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          POKCS089
170800         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          POKCS089
170900             MOVE +1    TO ASC-BLK-SUB                            POKCS089
171000             PERFORM 5100-WRITE-TEMP-STORAGE                      POKCS089
171100             ADD +1     TO ASC-BLK-SUB                            POKCS089
171200             PERFORM 5100-WRITE-TEMP-STORAGE                      POKCS089
171300             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             POKCS089
171400                 GIVING PV-BLOCK-NUMBER                           POKCS089
171500                 REMAINDER PV-REMAINDER                           POKCS089
171600             IF  PV-REMAINDER > ZERO                              POKCS089
171700                 ADD +1 TO PV-BLOCK-NUMBER                        POKCS089
171800             END-IF                                               POKCS089
171900             MOVE +1    TO ASC-BLK-SUB                            POKCS089
172000             PERFORM 4410-READ-TEMP-STORAGE                       POKCS089
172100             ADD +1     TO ASC-BLK-SUB                            POKCS089
172200                           PV-BLOCK-NUMBER                        POKCS089
172300             PERFORM 4410-READ-TEMP-STORAGE                       POKCS089
172400     END-IF.                                                      POKCS089
172500     MOVE +1            TO ASC-BLK-SUB.                           POKCS089
172600     COMPUTE ASC-ITEM-SUB =                                       POKCS089
172700         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              POKCS089
172800         + PC-ITEMS-PER-PANEL).                                   POKCS089
172900                                                                  POKCS089
173000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        POKCS089
173100         ADD +1         TO ASC-BLK-SUB                            POKCS089
173200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            POKCS089
173300     END-IF.                                                      POKCS089
173400                                                                  POKCS089
173500     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           POKCS089
173600         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                POKCS089
173700     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        POKCS089
173800     PERFORM 4420-FORMAT-LIST-LINES                               POKCS089
173900         VARYING PV-SUB                                           POKCS089
174000         FROM PC-ITEMS-PER-PANEL BY -1                            POKCS089
174100         UNTIL PV-SUB < +1.                                       POKCS089
174200                                                                  POKCS089
174300     COMPUTE ASC-ITEMS-DISPLAYED =                                POKCS089
174400         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          POKCS089
174500     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL          88
174600                                      ASTRTITO.                   POKCS089
174700     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    POKCS089
174800     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    POKCS089
174900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            POKCS089
175000                                   TO ASELITO.                    POKCS089
175010     MOVE ASC-PO-NUMBER            TO APONBRO.                            
175100                                                                  POKCS089
175200     IF  DP020-MSG-NUMBER-X = SPACE                               POKCS089
175300         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  POKCS089
175400*            --- MORE ITEMS TO DISPLAY ----                       POKCS089
175500             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            POKCS089
175600             SET DP020-MSG-INFORMATIONAL TO TRUE                  POKCS089
175700         END-IF                                                   POKCS089
175800     END-IF.                                                      POKCS089
175900                                                                  POKCS089
176000*----------------------------------------------------------------*POKCS089
176100*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *POKCS089
176200*----------------------------------------------------------------*POKCS089
176300 4410-READ-TEMP-STORAGE.                                          POKCS089
176400                                                                  POKCS089
176500     EXEC CICS                                                    POKCS089
176600         READQ TS                                                 POKCS089
176700             QUEUE (ASC-LIST-QUEUE-NAME)                          POKCS089
176800             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               POKCS089
176900             ITEM  (PV-BLOCK-NUMBER)                              POKCS089
177000             RESP  (PV-CICS-RESP)                                 POKCS089
177100     END-EXEC.                                                    POKCS089
177200                                                                  POKCS089
177300     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       POKCS089
177400       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     POKCS089
177500         CONTINUE                                                 POKCS089
177600     ELSE                                                         POKCS089
177700         SET DP013-CICS-ABEND     TO TRUE                         POKCS089
177800         SET DP013-NO-ROLLBACK    TO TRUE                         POKCS089
177900         MOVE '4410-READ-TEMP-STORAGE'                            POKCS089
178000                                  TO DP013-PARAGRAPH              POKCS089
178100         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      POKCS089
178200                                  TO DP013-MESSAGE-TEXT(1)        POKCS089
178300         PERFORM DP013-0000-PROCESS-ABEND                         POKCS089
178400     END-IF.                                                      POKCS089
178500                                                                  POKCS089
178600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             POKCS089
178700                                                                  POKCS089
178800     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         POKCS089
178900         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               POKCS089
179000     END-IF.                                                      POKCS089
179100                                                                  POKCS089
179200*----------------------------------------------------------------*POKCS089
179300*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *POKCS089
179400*----------------------------------------------------------------*POKCS089
179500 4420-FORMAT-LIST-LINES.                                          POKCS089
179600                                                                  POKCS089
179700     IF ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ          CL**6
179800         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                POKCS089
179900*        MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA   (PV-SUB)            CL**6
180000*        MOVE SPACES             TO MR-SELECTI   (PV-SUB)            CL**6
180200*                                   MR-RSN       (PV-SUB)            CL**6
180300         MOVE SPACES             TO MR-DESC      (PV-SUB)         POKCS089
180600     ELSE                                                         POKCS089
180700*        IF ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)          CL**6
180800*                                                          > SPACE   CL**6
180900*            MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) POKCS089
181000*                                          TO MR-SELECTI (PV-SUB)    CL**6
181100*        ELSE                                                     POKCS089
181200*            MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      POKCS089
181300*                                          TO MR-SELECTI (PV-SUB)    CL**6
181400*        END-IF                                                   POKCS089
181500                                                                  POKCS089
181600*        IF DP030-SET-CURSOR-TRAILER                                 CL**6
181700*            IF ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      CL**6
181800*                                                          > SPACE   CL**6
181900*               OR PV-SUB = 1                                        CL**6
182000*                SET DP030-SET-CURSOR-APPL-1 TO TRUE                 CL**6
182100*                MOVE -1 TO MR-SELECTL (PV-SUB)                      CL**6
182200*            END-IF                                               POKCS089
182300*        END-IF                                                   POKCS089
182400                                                                  POKCS089
182500*        IF PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL               CL**6
182800*            IF ASC-REQ-RSN-CDE   (ASC-BLK-SUB ASC-ITEM-SUB) =          *5
182803*                VL005-REQ-RSN-CDE                                        
182804*                    MOVE 'ADD' TO MR-ACTION (PV-SUB)                     
182805*            ELSE                                                         
182806*                MOVE ASC-ACTION    (ASC-BLK-SUB ASC-ITEM-SUB)          *6
182807*                                            TO MR-ACTION (PV-SUB)   CL**6
182808*            END-IF                                                       
182810*            MOVE ASC-REQ-RSN-CDE (ASC-BLK-SUB ASC-ITEM-SUB)            *5
182900*                                     TO MR-RSN (PV-SUB)                *6
183000             MOVE ASC-REQ-RSN-DESC (ASC-BLK-SUB ASC-ITEM-SUB)           *5
183100                                          TO MR-DESC (PV-SUB)           *6
184400                                                                        84
184500     END-IF.                                                      POKCS089
184600                                                                     CL**6
184700     SUBTRACT +1 FROM ASC-ITEM-SUB.                                  CL**6
184800                                                                     CL**6
184900     IF ASC-ITEM-SUB < + 1                                           CL**6
185000         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  POKCS089
185100         MOVE +1                 TO ASC-BLK-SUB                   POKCS089
185200     END-IF.                                                      POKCS089
185300                                                                  POKCS089
185400******************************************************************POKCS089
185500** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **POKCS089
185600** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **POKCS089
185700** ISSUE A WARNING.                                             **POKCS089
185800******************************************************************POKCS089
185900 4430-CHECK-FOR-BEGIN-AND-END.                                    POKCS089
186000                                                                  POKCS089
186100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       POKCS089
186200         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     POKCS089
186300*            -- NO END-OF-RANGE SPECFIED ---                      POKCS089
186400             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            POKCS089
186500             SET DP020-MSG-WARNING TO TRUE                        POKCS089
186600             PERFORM 4431-POSITION-AT-WARNING                     POKCS089
186700         END-IF                                                   POKCS089
186800     ELSE                                                         POKCS089
186900         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     POKCS089
187000*            -- NO BEGINNING-OF-RANGE SPECFIED ---                POKCS089
187100             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            POKCS089
187200             SET DP020-MSG-WARNING TO TRUE                        POKCS089
187300             PERFORM 4431-POSITION-AT-WARNING                     POKCS089
187400         END-IF                                                   POKCS089
187500     END-IF.                                                      POKCS089
187600                                                                  POKCS089
187700******************************************************************POKCS089
187800** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **POKCS089
187900** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **POKCS089
188000** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **POKCS089
188100** POSITION THE CURSOR THERE.                                   **POKCS089
188200******************************************************************POKCS089
188300 4431-POSITION-AT-WARNING.                                        POKCS089
188400                                                                  POKCS089
188500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 POKCS089
188600                    - PV-TOP-ITEM + 1.                            POKCS089
188700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      POKCS089
188800         CONTINUE                                                 POKCS089
188900     ELSE                                                         POKCS089
189000         SET DP030-SET-CURSOR-APPL-1                              POKCS089
189100                                   TO TRUE                        POKCS089
189200*        MOVE -1                   TO MR-SELECTL (PV-SUB)         POKCS089
189300*        MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         POKCS089
189400*        MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         POKCS089
189500     END-IF.                                                      POKCS089
189600                                                                  POKCS089
189700     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   POKCS089
189800                    - PV-TOP-ITEM + 1.                            POKCS089
189900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      POKCS089
190000         CONTINUE                                                 POKCS089
190100     ELSE                                                         POKCS089
190200         SET DP030-SET-CURSOR-APPL-1                              POKCS089
190300                                   TO TRUE                        POKCS089
190400*        MOVE -1                   TO MR-SELECTL (PV-SUB)         POKCS089
190500*        MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         POKCS089
190600*        MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         POKCS089
190700     END-IF.                                                      POKCS089
190800                                                                  POKCS089
190900*----------------------------------------------------------------*POKCS089
191000* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *POKCS089
191100* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *POKCS089
191200* FOR THE SELECTED ITEMS QUEUE.                                  *POKCS089
191300*                                                                *POKCS089
191400* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *POKCS089
191500* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *POKCS089
191600* THE ARRAY IS FULL.                                             *POKCS089
191700*----------------------------------------------------------------*POKCS089
191800 5000-PREPARE-SEL-QUEUE.                                          POKCS089
191900                                                                  POKCS089
192000     MOVE +1                   TO  ASC-BLK-SUB.                   POKCS089
192100     PERFORM 5100-WRITE-TEMP-STORAGE.                             POKCS089
192200     ADD +1                    TO  ASC-BLK-SUB.                   POKCS089
192300     PERFORM 5100-WRITE-TEMP-STORAGE.                             POKCS089
192400                                                                  POKCS089
192503     MOVE ASC-SEL-QUEUE-NAME   TO                                   *    8
192504                  VL005-RSN-QUEUE-NAME                               CL**1
192505     INITIALIZE VL005-NUMBER-OF-RSN-CODES                                 
192530                                                                          
192600     PERFORM 6010-DELETE-SEL-QUEUE.                               POKCS089
192700                                                                  POKCS089
192800     SET ASC-UPDATE-TSQ        TO  TRUE.                          POKCS089
192900     SET PS-RSN-QUEUE-NOT-WRITTEN  TO TRUE.                       POKCS089
193000     SET VL008-IDX             TO  1.                             POKCS089
193100     MOVE ZERO                 TO VL005-NUMBER-OF-RSN-TS-ITEMS.         88
193200     INITIALIZE VL008-SELECTED-ITEM-ARRAY.                        POKCS089
193300                                                                  POKCS089
193400     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           POKCS089
193500             VARYING PV-ITEM                                      POKCS089
193600             FROM 1 BY 1                                          POKCS089
193700             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     POKCS089
193800                                                                  POKCS089
193900     IF  VL008-IDX > 1                                            POKCS089
194000         PERFORM 5205-WRITE-SEL-QUEUE                             POKCS089
194100         ADD +1                TO VL005-NUMBER-OF-RSN-TS-ITEMS          88
194200     END-IF.                                                      POKCS089
194300                                                                  POKCS089
194310     IF PS-RSN-QUEUE-NOT-WRITTEN                                          
194311         PERFORM 5205-WRITE-SEL-QUEUE                             POKCS089
194320         MOVE 1 TO VL005-NUMBER-OF-RSN-TS-ITEMS                           
194330     END-IF.                                                      POKCS089
194400*----------------------------------------------------------------*POKCS089
194500*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *POKCS089
194600*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *POKCS089
194700*----------------------------------------------------------------*POKCS089
194800 5100-WRITE-TEMP-STORAGE.                                         POKCS089
194900                                                                  POKCS089
195000     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     POKCS089
195100                                   TO PV-LIST-ITEM-NUMBER.        POKCS089
195200     COMPUTE PV-BLOCK-NUMBER =                                    POKCS089
195300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    POKCS089
195400                                                                  POKCS089
195500     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             POKCS089
195600     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             POKCS089
195700         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      POKCS089
195800             PERFORM 5105-REWRITE-ASC-LISTQ                       POKCS089
195900         END-IF                                                   POKCS089
196000     ELSE                                                         POKCS089
196100         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       POKCS089
196200         ASC-HIGHEST-BLOCK-WRITTEN + 1                            POKCS089
196300         PERFORM 5110-WRITE-ASC-LISTQ                             POKCS089
196400         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   POKCS089
196500     END-IF.                                                      POKCS089
196600                                                                  POKCS089
196700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             POKCS089
196800******************************************************************POKCS089
196900** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **POKCS089
197000** SPECIFIC COMMAREA.                                           **POKCS089
197100******************************************************************POKCS089
197200 5105-REWRITE-ASC-LISTQ.                                          POKCS089
197300                                                                  POKCS089
197400     EXEC CICS                                                    POKCS089
197500         WRITEQ TS                                                POKCS089
197600             QUEUE (ASC-LIST-QUEUE-NAME)                          POKCS089
197700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               POKCS089
197800             ITEM  (PV-BLOCK-NUMBER)                              POKCS089
197900             REWRITE                                              POKCS089
198000             RESP  (PV-CICS-RESP)                                 POKCS089
198100     END-EXEC.                                                    POKCS089
198200                                                                  POKCS089
198300     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           POKCS089
198400         CONTINUE                                                 POKCS089
198500     ELSE                                                         POKCS089
198600         SET DP013-CICS-ABEND            TO TRUE                  POKCS089
198700         SET DP013-NO-ROLLBACK           TO TRUE                  POKCS089
198800         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       POKCS089
198900         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     POKCS089
199000                                         TO DP013-MESSAGE-TEXT(1) POKCS089
199100         PERFORM DP013-0000-PROCESS-ABEND                         POKCS089
199200     END-IF.                                                      POKCS089
199300                                                                  POKCS089
199400******************************************************************POKCS089
199500** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **POKCS089
199600** SPECIFIC COMMAREA.                                           **POKCS089
199700******************************************************************POKCS089
199800 5110-WRITE-ASC-LISTQ.                                            POKCS089
199900                                                                  POKCS089
200000     EXEC CICS                                                    POKCS089
200100         WRITEQ TS                                                POKCS089
200200             QUEUE (ASC-LIST-QUEUE-NAME)                          POKCS089
200300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               POKCS089
200400             ITEM  (PV-BLOCK-NUMBER)                              POKCS089
200500             RESP  (PV-CICS-RESP)                                 POKCS089
200600     END-EXEC.                                                    POKCS089
200700     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      POKCS089
200800         SET DP013-CICS-ABEND      TO TRUE                        POKCS089
200900         SET DP013-NO-ROLLBACK     TO TRUE                        POKCS089
201000         MOVE '5110-WRITE-ASC-LISTQ'                              POKCS089
201100                                   TO DP013-PARAGRAPH             POKCS089
201200         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           POKCS089
201300                                   TO DP013-MESSAGE-TEXT(1)       POKCS089
201400         PERFORM DP013-0000-PROCESS-ABEND                         POKCS089
201500     END-IF.                                                      POKCS089
201600                                                                  POKCS089
201700*----------------------------------------------------------------*POKCS089
201800* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *POKCS089
201900* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *POKCS089
202000*----------------------------------------------------------------*POKCS089
202100 5200-FILL-SEL-QUEUE-RECORD.                                      POKCS089
202200                                                                  POKCS089
202300     PERFORM 6112-READ-LIST-QUEUE.                                POKCS089
202400                                                                  POKCS089
202500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       POKCS089
202600         PERFORM                                                  POKCS089
202700         VARYING LQW-IDX                                          POKCS089
202800         FROM 1 BY 1                                              POKCS089
202900         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            POKCS089
203000           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          POKCS089
203100                                                                  POKCS089
203200             IF  LQW-SELECT (LQW-IDX)                             POKCS089
203300                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              POKCS089
203400                                   TO VL008-ITEM (VL008-IDX)      POKCS089
203600                 MOVE LQW-REQ-RSN-CDE       (LQW-IDX)                   84
203610                           TO VL008-REQ-RSN-CDE  (VL008-IDX)            *6
203620                 ADD +1 TO VL005-NUMBER-OF-RSN-CODES                      
203900                 SET VL008-IDX UP BY 1                            POKCS089
204000                 IF  VL008-IDX > VL008-MAX-ITEMS                  POKCS089
204100                     PERFORM 5205-WRITE-SEL-QUEUE                 POKCS089
204200                     ADD +1   TO VL005-NUMBER-OF-RSN-TS-ITEMS           88
204300                     INITIALIZE VL008-SELECTED-ITEM-ARRAY         POKCS089
204400                     SET VL008-IDX TO  1                          POKCS089
204500                 END-IF                                           POKCS089
204600             END-IF                                               POKCS089
204700         END-PERFORM                                              POKCS089
204800     END-IF.                                                      POKCS089
204900                                                                  POKCS089
205000*----------------------------------------------------------------*POKCS089
205100*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *POKCS089
205200*----------------------------------------------------------------*POKCS089
205300 5205-WRITE-SEL-QUEUE.                                            POKCS089
205400                                                                  POKCS089
205500     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            POKCS089
205600                                   TO VL008-SELECTED-ITEMS              88
205620                                      VL005-NUMBER-OF-RSN-CODES.        *2
205700                                                                  POKCS089
205800     EXEC CICS                                                    POKCS089
205900          WRITEQ TS                                               POKCS089
206000              QUEUE (ASC-SEL-QUEUE-NAME)                          POKCS089
206110              FROM  (VL008-REASON-SEL-REC)                              84
206200              ITEM  (PV-SEL-QUEUE-ITEM)                           POKCS089
206300              RESP  (PV-CICS-RESP)                                POKCS089
206400     END-EXEC.                                                    POKCS089
206500                                                                  POKCS089
206600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          POKCS089
206700         SET PS-RSN-QUEUE-WRITTEN  TO TRUE                               1
206800     ELSE                                                         POKCS089
206900         SET DP013-CICS-ABEND      TO TRUE                        POKCS089
207000         SET DP013-NO-ROLLBACK     TO TRUE                        POKCS089
207100         MOVE '5205-WRITE-SEL-QUEUE'                              POKCS089
207200                                   TO DP013-PARAGRAPH             POKCS089
207300         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          POKCS089
207400                                   TO DP013-MESSAGE-TEXT(1)       POKCS089
207500         PERFORM DP013-0000-PROCESS-ABEND                         POKCS089
207600     END-IF.                                                      POKCS089
207700                                                                  POKCS089
207800******************************************************************POKCS089
207900** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **POKCS089
208000** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **POKCS089
208100** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **POKCS089
208200** THE USER.                                                    **POKCS089
208300******************************************************************POKCS089
208400 6000-REFRESH-PANEL-FROM-TEMP.                                    POKCS089
208500                                                                  POKCS089
208600     IF  ASC-UPDATE-TSQ                                           POKCS089
208700         SET ASC-NO-TSQ-UPDATE TO TRUE                            POKCS089
208800         MOVE ZERO                 TO PV-SAVE-ITEM                POKCS089
208900                                      PV-SEL-QUEUE-ITEM           POKCS089
209000         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        POKCS089
209100                                   TO PV-HOLD-SELECTED-ITEMS      POKCS089
209200         PERFORM 6100-UPDATE-TSQ                                  POKCS089
209300             UNTIL PV-ITEMS-PROCESSED >                           POKCS089
209400                                    ASC-NUMBER-OF-SELECTED-ITEMS.       88
209500*        PERFORM 6010-DELETE-SEL-QUEUE                            POKCS089
209600*        INITIALIZE ASC-BLOCK-ENTRIES (1)                         POKCS089
209700*                   ASC-BLOCK-ENTRIES (2).                        POKCS089
209701******ADDED                                                               
209702*        DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 RCK00050
209703*               GIVING PV-BLOCK-NUMBER                            RCK00050
209704*               REMAINDER PV-REMAINDER                            RCK00050
209705*        IF  PV-REMAINDER > ZERO                                  RCK00050
209706*            ADD +1     TO PV-BLOCK-NUMBER                        RCK00050
209707*        END-IF                                                   RCK00050
209708*        MOVE +1        TO ASC-BLK-SUB                            RCK00050
209709*        PERFORM 4410-READ-TEMP-STORAGE                           RCK00050
209710*        ADD +1         TO ASC-BLK-SUB                            RCK00050
209711*                          PV-BLOCK-NUMBER                        RCK00050
209712*        PERFORM 4410-READ-TEMP-STORAGE                           RCK00050
209713*                                                                 RCK00050
209720*    END-IF.                                                      RCK00050
209800                                                                        84
209810******ADDED                                                               
209900                                                                  POKCS089
210000*----------------------------------------------------------------*POKCS089
210100*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *POKCS089
210200*----------------------------------------------------------------*POKCS089
210300 6010-DELETE-SEL-QUEUE.                                           POKCS089
210400                                                                  POKCS089
210500     EXEC CICS                                                    POKCS089
210600         DELETEQ TS                                               POKCS089
210700             QUEUE (ASC-SEL-QUEUE-NAME)                           POKCS089
210800             RESP  (PV-CICS-RESP)                                 POKCS089
210900     END-EXEC.                                                    POKCS089
211000                                                                  POKCS089
211100     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      POKCS089
211200        (PV-CICS-RESP = DFHRESP(QIDERR)))                         POKCS089
211300         CONTINUE                                                 POKCS089
211400     ELSE                                                         POKCS089
211500         SET DP013-CICS-ABEND TO TRUE                             POKCS089
211600         SET DP013-NO-ROLLBACK TO TRUE                            POKCS089
211700         MOVE '6010-DELETE-SEL-QUEUE'                             POKCS089
211800                        TO DP013-PARAGRAPH                        POKCS089
211900         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         POKCS089
212000                        TO DP013-MESSAGE-TEXT (1)                 POKCS089
212100         PERFORM DP013-0000-PROCESS-ABEND                         POKCS089
212200     END-IF.                                                      POKCS089
212300                                                                  POKCS089
212400*----------------------------------------------------------------*POKCS089
212500*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *POKCS089
212600*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *POKCS089
212700*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *POKCS089
212800*    THE TEMP QUEUE.                                             *POKCS089
212900*----------------------------------------------------------------*POKCS089
213000 6100-UPDATE-TSQ.                                                 POKCS089
213100                                                                  POKCS089
213200     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             POKCS089
213300     PERFORM 6105-READ-SEL-QUEUE.                                 POKCS089
213400     PERFORM                                                      POKCS089
213500         VARYING VL008-IDX                                        POKCS089
213600         FROM 1 BY 1                                              POKCS089
213700         UNTIL ((PV-ITEMS-PROCESSED >                             POKCS089
213800                              PV-HOLD-SELECTED-ITEMS)             POKCS089
213900         OR (VL008-IDX GREATER THAN VL008-MAX-ITEMS))             POKCS089
214000         IF  VL008-REQ-RSN-CDE (VL008-IDX) > SPACE                      88
214100             PERFORM 6110-PROCESS-ITEMS                           POKCS089
214200         END-IF                                                   POKCS089
214300         ADD +1                TO PV-ITEMS-PROCESSED              POKCS089
214400     END-PERFORM.                                                 POKCS089
214500                                                                  POKCS089
214600     PERFORM 6111-WRITE-LIST-QUEUE.                               POKCS089
214700                                                                  POKCS089
214800*----------------------------------------------------------------*POKCS089
214900*    READ THE LIST QUEUE RECORD.                                 *POKCS089
215000*----------------------------------------------------------------*POKCS089
215100 6105-READ-SEL-QUEUE.                                             POKCS089
215200                                                                  POKCS089
215300     EXEC CICS                                                    POKCS089
215400          READQ TS                                                POKCS089
215500              QUEUE (ASC-SEL-QUEUE-NAME)                          POKCS089
215600              INTO  (VL008-REASON-SEL-REC)                              84
215700              ITEM  (PV-SEL-QUEUE-ITEM)                           POKCS089
215800              RESP  (PV-CICS-RESP)                                POKCS089
215900     END-EXEC.                                                    POKCS089
216000                                                                  POKCS089
216100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          POKCS089
216200         CONTINUE                                                 POKCS089
216300     ELSE                                                         POKCS089
216400         SET DP013-CICS-ABEND      TO  TRUE                       POKCS089
216500         SET DP013-NO-ROLLBACK     TO  TRUE                       POKCS089
216600         MOVE '6105-READ-SEL-QUEUE'                               POKCS089
216700                                   TO  DP013-PARAGRAPH            POKCS089
216800         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           POKCS089
216900                                   TO  DP013-MESSAGE-TEXT(1)      POKCS089
217000         PERFORM DP013-0000-PROCESS-ABEND                         POKCS089
217100     END-IF.                                                      POKCS089
217200                                                                  POKCS089
217300*----------------------------------------------------------------*POKCS089
217400*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*POKCS089
217500*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*POKCS089
217600*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *POKCS089
217700*----------------------------------------------------------------*POKCS089
217800 6110-PROCESS-ITEMS.                                              POKCS089
217900                                                                  POKCS089
218000     COMPUTE PV-ITEM = 1 + ((VL008-ITEM (VL008-IDX) - 1)          POKCS089
218100                     / PC-ITEMS-PER-PANEL).                       POKCS089
218200                                                                  POKCS089
218300     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           POKCS089
218400         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          POKCS089
218500             PERFORM 6111-WRITE-LIST-QUEUE                        POKCS089
218600         END-IF                                                   POKCS089
218700         MOVE PV-ITEM          TO PV-SAVE-ITEM                    POKCS089
218800                                                                  POKCS089
218900         PERFORM 6112-READ-LIST-QUEUE                             POKCS089
219000         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               POKCS089
219100             CONTINUE                                             POKCS089
219200         END-IF                                                   POKCS089
219300     END-IF.                                                      POKCS089
219400                                                                  POKCS089
219500     COMPUTE PV-SUB = (VL008-ITEM (VL008-IDX)                     POKCS089
219600                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              POKCS089
219700     SET LQW-DESELECT (PV-SUB) TO    TRUE                         POKCS089
219710*    SET LQW-SELECT   (PV-SUB) TO    TRUE                         POKCS089
219800     MOVE LQW-SELECTED-SW (PV-SUB)                                POKCS089
219900                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  POKCS089
220000*    EVALUATE TRUE                                                POKCS089
220100*        WHEN VL006-INQ (VL006-IDX)                               POKCS089
220200*             MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             POKCS089
220300*                                                                 POKCS089
220400*        WHEN VL006-UPD (VL006-IDX)                               POKCS089
220500*             MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             POKCS089
220600*                                                                 POKCS089
220700*        WHEN VL006-DEL (VL006-IDX)                               POKCS089
220800*             MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             POKCS089
220900*                                                                 POKCS089
221000*        WHEN VL006-ERR (VL006-IDX)                               POKCS089
221100*             MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             POKCS089
221200*    END-EVALUATE.                                                POKCS089
221300                                                                  POKCS089
221400     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                POKCS089
221500                                                                  POKCS089
221600*----------------------------------------------------------------*POKCS089
221700*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *POKCS089
221800*----------------------------------------------------------------*POKCS089
221900 6111-WRITE-LIST-QUEUE.                                           POKCS089
222000                                                                  POKCS089
222100     EXEC CICS                                                    POKCS089
222200         WRITEQ TS                                                POKCS089
222300             QUEUE (ASC-LIST-QUEUE-NAME)                          POKCS089
222400             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     POKCS089
222500             ITEM  (PV-SAVE-ITEM)                                 POKCS089
222600             REWRITE                                                      
222700             RESP  (PV-CICS-RESP)                                 POKCS089
222800     END-EXEC.                                                    POKCS089
222900                                                                  POKCS089
223000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          POKCS089
223100         CONTINUE                                                 POKCS089
223200     ELSE                                                         POKCS089
223300         SET DP013-CICS-ABEND  TO  TRUE                           POKCS089
223400         SET DP013-NO-ROLLBACK TO  TRUE                           POKCS089
223500         MOVE '6111-WRITE-LIST-QUEUE'                             POKCS089
223600                               TO  DP013-PARAGRAPH                POKCS089
223700         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  POKCS089
223800                               TO  DP013-MESSAGE-TEXT(1)          POKCS089
223900         PERFORM DP013-0000-PROCESS-ABEND                         POKCS089
224000     END-IF.                                                      POKCS089
224100                                                                  POKCS089
224200*----------------------------------------------------------------*POKCS089
224300*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*POKCS089
224400*----------------------------------------------------------------*POKCS089
224500 6112-READ-LIST-QUEUE.                                            POKCS089
224600                                                                  POKCS089
224700     EXEC CICS                                                    POKCS089
224800         READQ TS                                                 POKCS089
224900             QUEUE (ASC-LIST-QUEUE-NAME)                          POKCS089
225000             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     POKCS089
225100             ITEM  (PV-ITEM)                                      POKCS089
225200             RESP  (PV-CICS-RESP)                                 POKCS089
225300     END-EXEC.                                                    POKCS089
225400                                                                  POKCS089
225500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          POKCS089
225600         CONTINUE                                                 POKCS089
225700     ELSE                                                         POKCS089
225800         SET DP013-CICS-ABEND        TO TRUE                      POKCS089
225900         SET DP013-NO-ROLLBACK       TO TRUE                      POKCS089
226000         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           POKCS089
226100         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    POKCS089
226200                                     TO DP013-MESSAGE-TEXT(1)     POKCS089
226300         PERFORM DP013-0000-PROCESS-ABEND                         POKCS089
226400     END-IF.                                                      POKCS089
226401                                                                     CL**1
226402 9100-READ-SEL-QUEUE.                                                CL**1
226403                                                                     CL**8
226404     EXEC CICS                                                       CL**1
226405         READQ TS                                                    CL**1
226406             QUEUE (ASC-SEL-QUEUE-NAME)                              CL**1
226407             INTO  (VL008-REASON-SEL-REC)                               *1
226408             ITEM  (ASC-SEL-ITEM)                                    CL**1
226409             RESP  (PV-CICS-RESP)                                    CL**1
226410     END-EXEC.                                                       CL**1
226411                                                                     CL**1
226412     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      RCKCS280
226413        (PV-CICS-RESP = DFHRESP(ITEMERR)) OR                            80
226414        (PV-CICS-RESP = DFHRESP(QIDERR)))                         RCKCS280
226415         CONTINUE                                                 RCKCS280
226418     ELSE                                                            CL**1
226419         SET DP013-LOGIC-ABEND                                       CL**1
226420             DP013-NO-ROLLBACK     TO TRUE                           CL**1
226421         MOVE '9100-READ-SEL-QUEUE'                                  CL**1
226422                                   TO DP013-PARAGRAPH                CL**1
226423         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'      CL**1
226424                                   TO DP013-MESSAGE-TEXT (1)         CL**1
226425         PERFORM DP013-0000-PROCESS-ABEND                            CL**1
226426     END-IF.                                                         CL**1
226427                                                                     CL**8
226428*----------------------------------------------------------------*   CL**1
226429* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *   CL**1
226430*----------------------------------------------------------------*   CL**1
226431                                                                     CL**8
226432 9200-WRITE-SEL-QUEUE.                                                  *1
226433                                                                     CL**8
226434     EXEC CICS                                                       CL**1
226435          WRITEQ TS                                                  CL**1
226436              QUEUE  (ASC-SEL-QUEUE-NAME)                            CL**1
226437              FROM   (VL008-REASON-SEL-REC)                             *1
226438              ITEM   (ASC-SEL-ITEM)                                  CL**1
226439              RESP   (PV-CICS-RESP)                                  CL**1
226440              WRITE                                                     *1
226441     END-EXEC.                                                       CL**1
226442                                                                     CL**1
226443     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                      CL**1
226444         SET DP013-CICS-ABEND                                        CL**1
226445             DP013-NO-ROLLBACK     TO TRUE                           CL**1
226446         MOVE '9200-WRITE-SEL-QUEUE'                                    *1
226447                                   TO DP013-PARAGRAPH                CL**1
226448         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'      CL**1
226449                                   TO DP013-MESSAGE-TEXT (1)         CL**1
226450         PERFORM DP013-0000-PROCESS-ABEND                            CL**1
226451     END-IF.                                                         CL**1
226452                                                                     CL**1
226460 EJECT                                                               CL**1
226461******************************************************************RCKCS279
226462*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *RCKCS279
226463*    AND THE ERROR SWITCHES.                                     *RCKCS279
226464******************************************************************RCKCS279
226465 9900-SOFT-ABORT.                                                 RCKCS279
226466     SET PS-ERROR         TO TRUE.                                RCKCS279
226467     SET DP020-MSG-FATAL  TO TRUE.                                RCKCS279
226468     MOVE PC-TSYMSG-00551 TO DP020-MSG-NUMBER.                    RCKCS279
226469     IF PS-NO-NEXT-SCREEN                                         RCKCS279
226470        SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                     RCKCS279
226471     END-IF.                                                      RCKCS279
226472     IF PS-UPDATES-DONE AND SQLCODE = -913                        RCKCS279
226473        PERFORM 9901-BACKUP                                       RCKCS279
226474     END-IF.                                                      RCKCS279
226475     MOVE 'PROGRAM EXIT CALL' TO DP013-MESSAGE-TEXT (1).          RCKCS279
226476     PERFORM 0001-CALL-CICS-ARCH-API.                             RCKCS279
226477                                                                  RCKCS279
226478 9901-BACKUP.                                                     RCKCS279
226479     EXEC CICS SYNCPOINT                                          RCKCS279
226480          ROLLBACK                                                RCKCS279
226481     END-EXEC.                                                    RCKCS279
226490                                                                  RCKCS279
226500                                                                  POKCS089
226600*----------------------------------------------------------------*POKCS089
226700*    ABEND PROCESSOR MODULE                                      *POKCS089
226800*----------------------------------------------------------------*POKCS089
226900     COPY DPPD013.                                                POKCS089
