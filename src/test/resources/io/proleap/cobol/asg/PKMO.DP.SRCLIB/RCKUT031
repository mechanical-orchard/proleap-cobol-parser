000100******************************************************************00010030
000200 IDENTIFICATION DIVISION.                                         00020030
000300 PROGRAM-ID.             RCKUT031.                                00030030
000400 AUTHOR.                 STEPHANIE HERON.                         00040030
000500 INSTALLATION.           KOHLS.                                   00050030
000600 DATE-WRITTEN            DECEMBER 1995.                           00060030
000700 DATE-COMPILED.                                                   00070030
000800                                                                  00080030
000900******************************************************************00090030
001000*   THIS PROGRAM WILL TAKE THE STOREEXT FILE REFORMAT  IT INTO THE00100030
001100*   RCRD010 INCLUDE FORMAT AND SUM THE VERIFIED COUNT BY RECEIVER.00110030
001200*   THE MBS SUBROUTINE IS CALLED TO OBTAIN THE DMM NUMBER, NAME AN00120030
001300*   THE BUYER NUMBER AND NAME.  THE GARMENT ON HANGER AND         00130030
001400*   PRE-TICKET INDICATOR IS OBTAINED FROM THE RECEIVER TABLE.     00140030
001500******************************************************************00150030
001600                                                                  00160030
001700***************************************************************** 00170030
001800*                                                               * 00180030
001900*  CHANGED 10/21/98 BY DAVE MUSKAT - COMPUWARE                  * 00190030
002000*   WR# 4650 CHANGED PROGRAM TO ADD PREPACK INDICATOR, GMM NAME,* 00200030
002100*            GMM NUMBER, AND SE-DATE-VERIFIED-COUNT TO THE      * 00210030
002200*            RCRD010 FILE.  ADDED GMM NAME TO THE LIST OF DATA  * 00220030
002300*            RETURNED FROM THE MBS SUBROUTINE.  ADDED SELECT    * 00230030
002400*            STATEMENTS TO ACCESS PO TABLES TPURCHS AND TPOAGMT * 00240030
002500*            TO DETERMINE TYPE OF PREPACK.                      * 00250030
002600*                                                               * 00260030
002700***************************************************************** 00270030
002800*                                                               * 00280030
002900*  CHANGED 12/19/13 BY JOHN SELWITSCHKA                         * 00290030
003000*   P5207G   MTK PROJECT - PACKAGE CODE CHANGES.                * 00300030
003100*                                                               * 00310030
003200*                                                               * 00320030
003300***************************************************************** 00330030
003400 ENVIRONMENT DIVISION.                                            00340030
003500                                                                  00350030
003600 CONFIGURATION SECTION.                                           00360030
003700                                                                  00370030
003800 SOURCE-COMPUTER.        IBM-3090.                                00380030
003900 OBJECT-COMPUTER.        IBM-3090.                                00390030
004000                                                                  00400030
004100 INPUT-OUTPUT SECTION.                                            00410030
004200                                                                  00420030
004300 FILE-CONTROL.                                                    00430030
004400                                                                  00440030
004500     SELECT STORE-FILE                                            00450030
004600         ASSIGN TO IN01.                                          00460030
004700                                                                  00470030
004800     SELECT RC010-FILE                                            00480030
004900         ASSIGN TO OUT01.                                         00490030
005000                                                                  00500030
005100******************************************************************00510030
005200 DATA DIVISION.                                                   00520030
005300******************************************************************00530030
005400                                                                  00540030
005500 FILE SECTION.                                                    00550030
005600                                                                  00560030
005700 FD  STORE-FILE                                                   00570030
005800     RECORDING MODE IS F                                          00580030
005900     BLOCK CONTAINS 0 RECORDS                                     00590030
006000     LABEL RECORDS ARE STANDARD.                                  00600030
006100                                                                  00610030
006200 01  STORE-RECORD                           PIC X(300).           00620030
006300                                                                  00630030
006400 FD  RC010-FILE                                                   00640030
006500     RECORDING MODE IS F                                          00650030
006600     BLOCK CONTAINS 0 RECORDS                                     00660030
006700     LABEL RECORDS ARE STANDARD.                                  00670030
006800                                                                  00680030
006900 01  RC010-RECORD                            PIC X(150).          00690030
007000                                                                  00700030
007100******************************************************************00710030
007200 WORKING-STORAGE SECTION.                                         00720030
007300******************************************************************00730030
007400                                                                  00740030
007500 01  ABEND-CODE                          PIC S9(04)  VALUE +0     00750030
007600                                                     COMP SYNC.   00760030
007700     COPY STOREEXT.                                               00770030
007800*                                                                 00780030
007900     COPY RCRD010.                                                00790030
008000*                                                                 00800030
008100*                                                                 00810030
008200 EJECT                                                            00820030
008300                                                                  00830030
008400 01  PV-PROGRAM-VARIABLES.                                        00840030
008500     05  PV-PARA                         PIC X(30)   VALUE SPACES.00850030
008600                                                                  00860030
008700     05  PV-PARAGRAPH-NAME               PIC  X(30)  VALUE SPACE. 00870030
008800     05  PV-DB2-OPERATION-ATTEMPTED      PIC  X(30)  VALUE SPACE. 00880030
008900     05  SAVE-DEPT-NBR                   PIC  9(03)  VALUE ZERO.  00890030
009000     05  SAVE-PO-NBR                     PIC  9(09)  VALUE ZERO.  00900031
009100     05  SAVE-REC-SEQ-NBR                PIC  9(05)  VALUE ZERO.  00910030
009200     05  SAVE-DATE-VERIFIED-COUNT        PIC  9(06)  VALUE ZERO.  00920030
009300     05  SAVE-REC-SRC-CDE                PIC  X(01).              00930030
009400         88 SAVE-ORIGINAL-RECEIPT                    VALUE 'R'.   00940030
009500         88 SAVE-ADJUSTMENT                          VALUE 'A'.   00950030
009600     05  PV-VRFYD-CNT                    PIC S9(09)  COMP-3       00960030
009700                                                     VALUE ZEROES.00970030
009800     05  PV-INPUT-CNT                    PIC S9(09)  COMP-3       00980030
009900                                                     VALUE ZEROES.00990030
010000     05  PV-OUTPUT-CNT                   PIC S9(09)  COMP-3       01000030
010100                                                     VALUE ZEROES.01010030
010200     05  PV-SKIP-CNT                     PIC S9(09)  COMP-3       01020030
010300                                                     VALUE ZEROES.01030030
010400     05  PV-CROSS-DOCK-QTY               PIC S9(09)  COMP-3       01040030
010500                                                     VALUE ZEROES.01050030
010600     05  PV-NON-CROSS-DOCK-QTY           PIC S9(09)  COMP-3       01060030
010700                                                     VALUE ZEROES.01070030
010800     05  PV-PBS-COUNT                    PIC S9(09) COMP VALUE +0.01080030
010900     05  PV-PKGNG-CDE                    PIC  X(01)  VALUE SPACE. 01090030
011000                                                                  01100030
011100 01  PROGRAM-SWITCHES.                                            01110030
011200     05  END-OF-INPUT-SW                 PIC X(01)   VALUE 'N'.   01120030
011300         88  END-OF-INPUT                            VALUE 'Y'.   01130030
011400                                                                  01140030
011500     05  END-OF-CURSOR-SW                PIC X(01)   VALUE 'N'.   01150030
011600         88  EOT-STR-CSR                             VALUE 'Y'.   01160030
011700                                                                  01170030
011800     05  INVALID-STR-SW                  PIC X(01)   VALUE 'N'.   01180030
011900         88  INVALID-STR                             VALUE 'Y'.   01190030
012000         88  VALID-STR                               VALUE 'N'.   01200030
012100                                                                  01210030
012200     05  DOCK-QTY-QTY-SW                 PIC X(01)   VALUE 'N'.   01220030
012300         88  DOCK-QTY-FOUND                          VALUE 'Y'.   01230030
012400         88  DOCK-QTY-NOT-FOUND                      VALUE 'N'.   01240030
012500                                                                  01250030
012600 01  DK-DB2-KEYS.                                                 01260030
012700     05  DK-PO-NBR                    PIC S9(09) COMP VALUE +0.   01270030
012800     05  DK-REC-SEQ-NBR               PIC S9(09) COMP VALUE +0.   01280030
012900                                                                  01290030
013000 01  PC-CONSTANTS.                                                01300030
013100     05  PC-SYSTEM-DATE.                                          01310030
013200         10  PC-SYSTEM-YEAR              PIC  9(02)  VALUE ZEROS. 01320030
013300         10  PC-SYSTEM-MONTH             PIC  9(02)  VALUE ZEROS. 01330030
013400         10  PC-SYSTEM-DAY               PIC  9(02)  VALUE ZEROS. 01340030
013500     05 PC-PGM-DPKUT039                  PIC  X(08)               01350030
013600                                         VALUE 'DPKUT039'.        01360030
013700     05 PC-ACTIVE                        PIC  X(01)  VALUE 'A'.   01370030
013800                                                                  01380030
013900 01  VALID-DC-TABLE.                                              01390030
014000     05  VALID-DC-TBL                OCCURS 50 TIMES              01400030
014100                                     INDEXED BY DC-IDX.           01410030
014200         10  DC-STR-NBR              PIC X(04).                   01420030
014300*                                                                 01430030
014400******************************************************************01440030
014500*  WORK FIELDS FOR THE MBS SUBROUTINE                             01450030
014600******************************************************************01460030
014700     COPY DPWS003.                                                01470030
014800*                                                                 01480030
014900     COPY DPWS004.                                                01490030
015000*                                                                 01500030
015100******************************************************************01510030
015200*  DB2 COMMUNICATION AREA.                                        01520030
015300******************************************************************01530030
015400     EXEC SQL                                                     01540030
015500          INCLUDE SQLCA                                           01550030
015600     END-EXEC.                                                    01560030
015700*                                                                 01570030
015800*                                                                 01580030
015900******************************************************************01590030
016000*  DB2 TABLE DB2PDBA.TPURCHS                                      01600030
016100******************************************************************01610030
016200     EXEC SQL                                                     01620030
016300          INCLUDE TPURCHS                                         01630030
016400     END-EXEC.                                                    01640030
016500*                                                                 01650030
016600*                                                                 01660030
016700******************************************************************01670030
016800*  DB2 TABLE DB2PDBA.TPOAGMT                                      01680030
016900******************************************************************01690030
017000     EXEC SQL                                                     01700030
017100          INCLUDE TPOAGMT                                         01710030
017200     END-EXEC.                                                    01720030
017300*                                                                 01730030
017400*                                                                 01740030
017500******************************************************************01750030
017600*  DB2 TABLE DB2PDBA.TRECEIV                                      01760030
017700******************************************************************01770030
017800     EXEC SQL                                                     01780030
017900          INCLUDE TRECEIV                                         01790030
018000     END-EXEC.                                                    01800030
018100*                                                                 01810030
018200*                                                                 01820030
018300******************************************************************01830030
018400*  DB2 TABLE DB2PDBA.XLT_LOC                                      01840030
018500******************************************************************01850030
018600     EXEC SQL                                                     01860030
018700          INCLUDE XLT00010                                        01870030
018800     END-EXEC.                                                    01880030
018900*                                                                 01890030
019000*                                                                 01900030
019100******************************************************************01910030
019200*  DB2 TABLE DB2PDBA.TDISTHD                                      01920030
019300******************************************************************01930030
019400     EXEC SQL                                                     01940030
019500          INCLUDE TDISTHD                                         01950030
019600     END-EXEC.                                                    01960030
019700*                                                                 01970030
019800*                                                                 01980030
019900******************************************************************01990030
020000*  DB2 TABLE DB2PDBA.TDISTDT                                      02000030
020100******************************************************************02010030
020200     EXEC SQL                                                     02020030
020300          INCLUDE TDISTDT                                         02030030
020400     END-EXEC.                                                    02040030
020500*                                                                 02050030
020600*                                                                 02060030
020700     EXEC SQL                                                     02070030
020800       DECLARE STR-CSR CURSOR FOR                                 02080030
020900         SELECT LOC_NBR                                           02090030
021000         FROM   XLT_LOC                                           02100030
021100         WHERE  LOC_TYP_CDE  = 'DC'                               02110030
021200           AND  CLO_DTE = '9999-09-09'                            02120030
021300     END-EXEC.                                                    02130030
021400*                                                                 02140030
021500                                                                  02150030
021600 PROCEDURE DIVISION.                                              02160030
021700******************************************************************02170030
021800*  0000-INITIAL-ROUTINE  -  MAIN LINE OF THE PROGRAM PERFORMS THE 02180030
021900*  INITIALIZATION ROUTINE AND CONTROLS THE PROCESSING OF THE PGM. 02190030
022000******************************************************************02200030
022100 0000-MAINLINE.                                                   02210030
022200                                                                  02220030
022300     PERFORM 0100-HOUSEKEEPING.                                   02230030
022400                                                                  02240030
022500     PERFORM 1000-PROCESS-INPUT-RECORDS                           02250030
022600         UNTIL END-OF-INPUT.                                      02260030
022700                                                                  02270030
022800     PERFORM 7500-DETERMINE-CROSS-DOCK.                           02280030
022900     PERFORM 8000-WRITE-RC010-FILE.                               02290030
023000                                                                  02300030
023100     CLOSE RC010-FILE                                             02310030
023200           STORE-FILE.                                            02320030
023300                                                                  02330030
023400     DISPLAY 'RECORDS READ     -  ' PV-INPUT-CNT.                 02340030
023500     DISPLAY 'RECORDS WRITTEN  -  ' PV-OUTPUT-CNT.                02350030
023600     DISPLAY 'RECORDS SKIPPED  -  ' PV-SKIP-CNT.                  02360030
023700                                                                  02370030
023800     STOP RUN.                                                    02380030
023900/                                                                 02390030
024000 0100-HOUSEKEEPING.                                               02400030
024100                                                                  02410030
024200     OPEN INPUT  STORE-FILE                                       02420030
024300          OUTPUT RC010-FILE.                                      02430030
024400                                                                  02440030
024500     ACCEPT PC-SYSTEM-DATE FROM DATE.                             02450030
024600                                                                  02460030
024700     PERFORM VARYING DC-IDX FROM 1 BY 1 UNTIL DC-IDX > 50         02470030
024800        MOVE SPACES TO DC-STR-NBR (DC-IDX)                        02480030
024900     END-PERFORM.                                                 02490030
025000                                                                  02500030
025100     PERFORM 0200-LOAD-STR-TBL.                                   02510030
025200                                                                  02520030
025300     PERFORM 7000-READ-STORE-FILE.                                02530030
025400                                                                  02540030
025500     MOVE SE-PO                     TO SAVE-PO-NBR                02550030
025600                                       DK-PO-NBR.                 02560030
025700     MOVE SE-REC-SEQ-NBR            TO SAVE-REC-SEQ-NBR           02570030
025800                                       DK-REC-SEQ-NBR.            02580030
025900     MOVE SE-DATE-VERIFIED-COUNT    TO SAVE-DATE-VERIFIED-COUNT.  02590030
026000     MOVE SE-REC-SRC-CDE            TO SAVE-REC-SRC-CDE.          02600030
026100                                                                  02610030
026200     PERFORM 1200-GET-INDICATORS.                                 02620030
026300     PERFORM 1300-GET-PREPACK-DATA.                               02630030
026400     PERFORM 1100-GET-BYR-INFO.                                   02640030
026500                                                                  02650030
026600     MOVE SE-DEPT                   TO SAVE-DEPT-NBR.             02660030
026700                                                                  02670030
026800                                                                  02680030
026900 0200-LOAD-STR-TBL.                                               02690030
027000                                                                  02700030
027100     EXEC SQL                                                     02710030
027200          OPEN STR-CSR                                            02720030
027300     END-EXEC.                                                    02730030
027400                                                                  02740030
027500     EVALUATE TRUE                                                02750030
027600         WHEN SQLCODE = ZERO                                      02760030
027700              CONTINUE                                            02770030
027800                                                                  02780030
027900         WHEN SQLWARN0 NOT EQUAL SPACE                            02790030
028000         WHEN SQLCODE NOT EQUAL ZERO                              02800030
028100              MOVE '0200-LOAD-STR-TBL   '                         02810030
028200                               TO  PV-PARAGRAPH-NAME              02820030
028300              MOVE 'ERROR ON OPEN TO STR-CSR'                     02830030
028400                               TO  PV-DB2-OPERATION-ATTEMPTED     02840030
028500              PERFORM 9100-SQL-ABEND                              02850030
028600     END-EVALUATE.                                                02860030
028700                                                                  02870030
028800     PERFORM 0300-FETCH-CSR.                                      02880030
028900                                                                  02890030
029000     PERFORM VARYING DC-IDX FROM 1  BY 1 UNTIL DC-IDX > 50        02900030
029100        OR EOT-STR-CSR                                            02910030
029200        MOVE XLT00010-LOC-NBR   TO DC-STR-NBR (DC-IDX)            02920030
029300        PERFORM 0300-FETCH-CSR                                    02930030
029400     END-PERFORM.                                                 02940030
029500                                                                  02950030
029600 0300-FETCH-CSR.                                                  02960030
029700                                                                  02970030
029800     EXEC SQL                                                     02980030
029900          FETCH STR-CSR                                           02990030
030000           INTO :XLT00010-LOC-NBR                                 03000030
030100     END-EXEC.                                                    03010030
030200                                                                  03020030
030300     EVALUATE TRUE                                                03030030
030400         WHEN SQLCODE = ZERO                                      03040030
030500              CONTINUE                                            03050030
030600                                                                  03060030
030700         WHEN SQLCODE = +100                                      03070030
030800              SET EOT-STR-CSR TO TRUE                             03080030
030900                                                                  03090030
031000         WHEN SQLWARN0 NOT EQUAL SPACE                            03100030
031100         WHEN SQLCODE NOT EQUAL ZERO                              03110030
031200              MOVE '0300-FETCH-CSR      '                         03120030
031300                               TO  PV-PARAGRAPH-NAME              03130030
031400              MOVE 'ERROR ON FETCH TO STR-CSR'                    03140030
031500                               TO  PV-DB2-OPERATION-ATTEMPTED     03150030
031600              PERFORM 9100-SQL-ABEND                              03160030
031700     END-EVALUATE.                                                03170030
031800                                                                  03180030
031900                                                                  03190030
032000 1000-PROCESS-INPUT-RECORDS.                                      03200030
032100     MOVE '*1000-PROCESS-INPUT-RECORDS.     *' TO PV-PARA.        03210030
032200                                                                  03220030
032300     IF SE-PO          = SAVE-PO-NBR AND                          03230030
032400        SE-REC-SEQ-NBR = SAVE-REC-SEQ-NBR                         03240030
032500        ADD SE-RETAIL-UNITS-MARK       TO PV-VRFYD-CNT            03250030
032600        PERFORM 7000-READ-STORE-FILE                              03260030
032700     ELSE                                                         03270030
032800        PERFORM 7500-DETERMINE-CROSS-DOCK                         03280030
032900        PERFORM 8000-WRITE-RC010-FILE                             03290030
033000                                                                  03300030
033100        INITIALIZE PV-VRFYD-CNT                                   03310030
033200        MOVE SE-PO                    TO SAVE-PO-NBR              03320030
033300                                         DK-PO-NBR                03330030
033400        MOVE SE-REC-SEQ-NBR           TO SAVE-REC-SEQ-NBR         03340030
033500                                         DK-REC-SEQ-NBR           03350030
033600        MOVE SE-DATE-VERIFIED-COUNT   TO SAVE-DATE-VERIFIED-COUNT 03360030
033700        MOVE SE-REC-SRC-CDE           TO SAVE-REC-SRC-CDE         03370030
033800                                                                  03380030
033900        PERFORM 1200-GET-INDICATORS                               03390030
034000        PERFORM 1300-GET-PREPACK-DATA                             03400030
034100        PERFORM 1100-GET-BYR-INFO                                 03410030
034200     END-IF.                                                      03420030
034300/                                                                 03430030
034400 1100-GET-BYR-INFO.                                               03440030
034500                                                                  03450030
034600     IF SE-DEPT  =  SAVE-DEPT-NBR                                 03460030
034700        CONTINUE                                                  03470030
034800     ELSE                                                         03480030
034900        MOVE SE-DEPT                TO SAVE-DEPT-NBR              03490030
035000        INITIALIZE DP003-MBS-SUBROUTINE-FIELDS                    03500030
035100        SET DP003-BYR-LOOKUP-NAME       TO TRUE                   03510030
035200        SET DP003-DMM-LOOKUP-NAME       TO TRUE                   03520030
035300        SET DP003-GMM-LOOKUP-NAME       TO TRUE                   03530030
035400        MOVE 'MP'                       TO DP003-SYSTEM-CODE      03540030
035500        MOVE '03'                       TO DP003-OP-CO-NMBR       03550030
035600        MOVE PC-SYSTEM-DATE             TO DP003-CURRENT-DATE     03560030
035700                                           DP003-EFF-DATE         03570030
035800        MOVE SE-DEPT                    TO DP003-DPT-INPUT        03580030
035900                                                                  03590030
036000        CALL PC-PGM-DPKUT039 USING DP003-MBS-SUBROUTINE-FIELDS    03600030
036100                                                                  03610030
036200        EVALUATE TRUE                                             03620030
036300            WHEN DP003-SUCCESSFUL                                 03630030
036400                CONTINUE                                          03640030
036500            WHEN DP003-BYR-NAME-NOT-FOUND                         03650030
036600                MOVE 'BUYER NOT FOUND'  TO  DP003-BYR-NAME        03660030
036700                MOVE '999'              TO  DP003-BYR-NMBR        03670030
036800            WHEN DP003-DMM-NAME-NOT-FOUND                         03680030
036900                MOVE 'DMM NOT FOUND  '  TO  DP003-DMM-NAME        03690030
037000                MOVE '999'              TO  DP003-DMM-NMBR        03700030
037100            WHEN DP003-DMM-NMBR-NOT-FOUND                         03710030
037200                MOVE 'DMM NOT FOUND  '  TO  DP003-DMM-NAME        03720030
037300                MOVE '999'              TO  DP003-DMM-NMBR        03730030
037400            WHEN DP003-GMM-NAME-NOT-FOUND                         03740030
037500                MOVE 'GMM NOT FOUND  '  TO  DP003-GMM-NAME        03750030
037600                MOVE '999'              TO  DP003-GMM-NMBR        03760030
037700            WHEN DP003-GMM-NMBR-NOT-FOUND                         03770030
037800                MOVE 'GMM NOT FOUND FOR DEPT.'                    03780030
037900                                        TO  DP003-GMM-NAME (1:27) 03790030
038000                MOVE SE-DEPT            TO  DP003-GMM-NAME (29:3) 03800030
038100                MOVE '999'              TO  DP003-GMM-NMBR        03810030
038200            WHEN OTHER                                            03820030
038300                DISPLAY '** ABEND **'                             03830030
038400                DISPLAY '** PROGRAM = RCKUT031 **'                03840030
038500                DISPLAY '** PARAGRAPH = 1100-GET-BYR-INFO **'     03850030
038600                DISPLAY                                           03860030
038700                '** INVALID RETURN CODE FROM DPKUT039 **'         03870030
038800                DISPLAY '** INPUT FIELDS: ' DP003-INPUT-FIELDS    03880030
038900                DISPLAY '**  RETURN DATA: ' DP003-RETURN-DATA     03890030
039000*               IF DP003-BYR-NAME-DB2-ERROR                       03900030
039100                    DISPLAY '** SQLCA: ' DP003-SQLCA              03910030
039200                    DISPLAY '** SQLCODE: ' DP003-SQLCODE          03920030
039300*               END-IF                                            03930030
039400                MOVE +4008 TO ABEND-CODE                          03940030
039500                CALL 'ILBOABN0' USING ABEND-CODE                  03950030
039600        END-EVALUATE                                              03960030
039700     END-IF.                                                      03970030
039800                                                                  03980030
039900 1200-GET-INDICATORS.                                             03990030
040000     EXEC SQL                                                     04000030
040100          SELECT PRE_TKT_IND                                      04010030
040200                ,GOH_IND                                          04020030
040300                ,OPER_UNT_ID                                      04030030
040400                ,FCLTY_ID                                         04040030
040500          INTO   :RECEIV-PRE-TKT-IND                              04050030
040600                ,:RECEIV-GOH-IND                                  04060030
040700                ,:RECEIV-OPER-UNT-ID                              04070030
040800                ,:RECEIV-FCLTY-ID                                 04080030
040900          FROM   TRECEIV                                          04090030
041000          WHERE  ORD_NBR     = :DK-PO-NBR                         04100030
041100            AND  REC_SEQ_NBR = :DK-REC-SEQ-NBR                    04110030
041200            AND  VER_STATUS_CDE = :PC-ACTIVE                      04120030
041300     END-EXEC.                                                    04130030
041400                                                                  04140030
041500     EVALUATE TRUE                                                04150030
041600         WHEN SQLCODE = ZERO                                      04160030
041700              CONTINUE                                            04170030
041800                                                                  04180030
041900         WHEN SQLCODE = +100                                      04190030
042000              MOVE SPACES TO RECEIV-PRE-TKT-IND                   04200030
042100                             RECEIV-GOH-IND                       04210030
042200                                                                  04220030
042300         WHEN SQLWARN0 NOT EQUAL SPACE                            04230030
042400         WHEN SQLCODE NOT EQUAL ZERO                              04240030
042500              MOVE '1200-GET-INDICATORS '                         04250030
042600                               TO  PV-PARAGRAPH-NAME              04260030
042700              MOVE 'SELECT TO TRECEIV  '                          04270030
042800                               TO  PV-DB2-OPERATION-ATTEMPTED     04280030
042900              DISPLAY 'PO NUMBER IS ' DK-PO-NBR                   04290030
043000              'RCVR SEQ NBR IS ' DK-REC-SEQ-NBR                   04300030
043100              PERFORM 9100-SQL-ABEND                              04310030
043200     END-EVALUATE.                                                04320030
043300                                                                  04330030
043400 1300-GET-PREPACK-DATA.                                           04340030
043500                                                                  04350030
043600     INITIALIZE PV-PKGNG-CDE                                      04360030
043700                PV-PBS-COUNT.                                     04370030
043800     PERFORM 1310-SELECT-PKGNG-CDE.                               04380030
043900     IF PV-PKGNG-CDE = SPACE                                      04390030
044000         PERFORM 1320-SELECT-PACK-BY-STORE                        04400030
044100         IF PV-PBS-COUNT > ZERO                                   04410030
044200             MOVE 'P' TO PV-PKGNG-CDE                             04420030
044300         END-IF                                                   04430030
044400     END-IF.                                                      04440030
044500                                                                  04450030
044600 1310-SELECT-PKGNG-CDE.                                           04460030
044700                                                                  04470030
044800     EXEC SQL                                                     04480030
044900          SELECT PKGNG_CDE                                        04490030
045000          INTO  :PURCHS-PKGNG-CDE                                 04500030
045100          FROM   TPURCHS                                          04510030
045200          WHERE  PO_NBR      = :DK-PO-NBR                         04520030
045300            AND  VER_STATUS_CDE = 'A'                             04530030
045400     END-EXEC.                                                    04540030
045500                                                                  04550030
045600     EVALUATE TRUE                                                04560030
045700         WHEN SQLCODE = ZERO                                      04570030
045800              MOVE PURCHS-PKGNG-CDE TO PV-PKGNG-CDE               04580030
045900                                                                  04590030
046000         WHEN SQLCODE = +100                                      04600030
046100              MOVE SPACES TO PV-PKGNG-CDE                         04610030
046200                                                                  04620030
046300         WHEN SQLWARN0 NOT EQUAL SPACE                            04630030
046400         WHEN SQLCODE NOT EQUAL ZERO                              04640030
046500              MOVE '1310-SELECT-PKGNG-CDE '                       04650030
046600                               TO  PV-PARAGRAPH-NAME              04660030
046700              MOVE 'SELECT TO TPURCHS  '                          04670030
046800                               TO  PV-DB2-OPERATION-ATTEMPTED     04680030
046900              DISPLAY 'PO NUMBER IS ' DK-PO-NBR                   04690030
047000              PERFORM 9100-SQL-ABEND                              04700030
047100     END-EVALUATE.                                                04710030
047200                                                                  04720030
047300 1320-SELECT-PACK-BY-STORE.                                       04730030
047400                                                                  04740030
047500     EXEC SQL                                                     04750030
047600          SELECT COUNT(*)                                         04760030
047700          INTO  :PV-PBS-COUNT                                     04770030
047800          FROM   TPURCHS A                                        04780030
047900                ,TPOAGMT B                                        04790030
048000          WHERE  A.PO_NBR         = B.PO_NBR                      04800030
048100            AND  A.VER_STATUS_CDE = B.VER_STATUS_CDE              04810030
048200            AND  A.PO_NBR         = :DK-PO-NBR                    04820030
048300            AND  B.TYP_CDE        = 4                             04830030
048400            AND  B.AGRMT_TYP_ID   = '4'                           04840030
048500            AND  A.VER_STATUS_CDE = 'A'                           04850030
048600     END-EXEC.                                                    04860030
048700                                                                  04870030
048800     EVALUATE TRUE                                                04880030
048900         WHEN SQLCODE = ZERO                                      04890030
049000              CONTINUE                                            04900030
049100                                                                  04910030
049200         WHEN SQLWARN0 NOT EQUAL SPACE                            04920030
049300         WHEN SQLCODE NOT EQUAL ZERO                              04930030
049400              MOVE '1320-SELECT-PACK-BY-STORE '                   04940030
049500                               TO  PV-PARAGRAPH-NAME              04950030
049600              MOVE 'SELECT TO TPURCHS  '                          04960030
049700                               TO  PV-DB2-OPERATION-ATTEMPTED     04970030
049800              DISPLAY 'PO NUMBER IS ' DK-PO-NBR                   04980030
049900              PERFORM 9100-SQL-ABEND                              04990030
050000     END-EVALUATE.                                                05000030
050100                                                                  05010030
050200 7000-READ-STORE-FILE.                                            05020030
050300     READ STORE-FILE INTO STORE-EXTRACT-LINE                      05030030
050400        AT END                                                    05040030
050500           SET END-OF-INPUT    TO TRUE.                           05050030
050600                                                                  05060030
050700     IF END-OF-INPUT                                              05070030
050800        CONTINUE                                                  05080030
050900     ELSE                                                         05090030
051000        ADD +1 TO PV-INPUT-CNT                                    05100030
051100     END-IF.                                                      05110030
051200                                                                  05120030
051300 7500-DETERMINE-CROSS-DOCK.                                       05130030
051400                                                                  05140030
051500     INITIALIZE PV-CROSS-DOCK-QTY                                 05150030
051600                PV-NON-CROSS-DOCK-QTY.                            05160030
051700                                                                  05170030
051800     IF PV-PKGNG-CDE = 'P'                                        05180030
051900        MOVE PV-VRFYD-CNT TO PV-CROSS-DOCK-QTY                    05190030
052000     ELSE                                                         05200030
052100        PERFORM 7600-GET-CROSS-DOCK-QTYS                          05210030
052200                                                                  05220030
052300        IF DOCK-QTY-NOT-FOUND                                     05230030
052400           MOVE PV-VRFYD-CNT TO PV-CROSS-DOCK-QTY                 05240030
052500        ELSE                                                      05250030
052600                                                                  05260030
052700           IF SAVE-ADJUSTMENT                                     05270030
052800              IF DISTDT-FCSE-ACTL-UNT-QTY = +0                    05280030
052900                 MOVE PV-VRFYD-CNT TO PV-NON-CROSS-DOCK-QTY       05290030
053000              ELSE                                                05300030
053100                 MOVE PV-VRFYD-CNT TO PV-CROSS-DOCK-QTY           05310030
053200              END-IF                                              05320030
053300           ELSE                                                   05330030
053400*             ** SAVE-ORIGINAL-RECEIPT **                         05340030
053500              MOVE DISTDT-ACTL-ALLOC-QTY TO PV-NON-CROSS-DOCK-QTY 05350030
053600                                                                  05360030
053700              COMPUTE PV-CROSS-DOCK-QTY = PV-VRFYD-CNT            05370030
053800                                          - PV-NON-CROSS-DOCK-QTY 05380030
053900              END-COMPUTE                                         05390030
054000              IF PV-CROSS-DOCK-QTY < ZERO                         05400030
054100                 MOVE ZERO TO PV-CROSS-DOCK-QTY                   05410030
054200              END-IF                                              05420030
054300           END-IF                                                 05430030
054400        END-IF                                                    05440030
054500     END-IF.                                                      05450030
054600                                                                  05460030
054700                                                                  05470030
054800 7600-GET-CROSS-DOCK-QTYS.                                        05480030
054900                                                                  05490030
055000     MOVE DK-PO-NBR        TO DISTHD-ORD-NBR.                     05500030
055100     MOVE DK-REC-SEQ-NBR   TO DISTHD-RCVR-SEQ-NBR.                05510030
055200                                                                  05520030
055300     EXEC SQL                                                     05530030
055400          SELECT SUM(B.ACTL_ALLOC_QTY)                            05540030
055500                ,SUM(B.FCSE_ACTL_UNT_QTY)                         05550030
055600                ,A.ORD_NBR                                        05560030
055700                ,A.RCVR_SEQ_NBR                                   05570030
055800          INTO  :DISTDT-ACTL-ALLOC-QTY                            05580030
055900               ,:DISTDT-FCSE-ACTL-UNT-QTY                         05590030
056000               ,:DISTHD-ORD-NBR                                   05600030
056100               ,:DISTHD-RCVR-SEQ-NBR                              05610030
056200          FROM   TDISTHD A                                        05620030
056300                ,TDISTDT B                                        05630030
056400          WHERE  A.ORD_NBR        = :DISTHD-ORD-NBR               05640030
056500            AND  A.RCVR_SEQ_NBR   = :DISTHD-RCVR-SEQ-NBR          05650030
056600            AND  A.TOT_CART_CNT > 0                               05660030
056700            AND  A.ORD_NBR        = B.ORD_NBR                     05670030
056800            AND  A.RCVR_SEQ_NBR   = B.RCVR_SEQ_NBR                05680030
056900          GROUP BY                                                05690030
057000                 A.ORD_NBR                                        05700030
057100                ,A.RCVR_SEQ_NBR                                   05710030
057200     END-EXEC.                                                    05720030
057300                                                                  05730030
057400     EVALUATE TRUE                                                05740030
057500         WHEN SQLCODE = ZERO                                      05750030
057600            SET DOCK-QTY-FOUND     TO TRUE                        05760030
057700                                                                  05770030
057800         WHEN SQLCODE = -305                                      05780030
057900         WHEN SQLCODE = +100                                      05790030
058000            MOVE +0 TO DISTDT-ACTL-ALLOC-QTY                      05800030
058100                       DISTDT-FCSE-ACTL-UNT-QTY                   05810030
058200            SET DOCK-QTY-NOT-FOUND TO TRUE                        05820030
058300                                                                  05830030
058400         WHEN SQLWARN0 NOT EQUAL SPACE                            05840030
058500         WHEN SQLCODE NOT EQUAL ZERO                              05850030
058600              MOVE '7600-GET-CROSS-DOCK-QTYS  '                   05860030
058700                               TO  PV-PARAGRAPH-NAME              05870030
058800              MOVE 'SELECT TDISTHD, TDISTDT'                      05880030
058900                               TO  PV-DB2-OPERATION-ATTEMPTED     05890030
059000              DISPLAY 'ORD NUMBER IS ' DK-PO-NBR                  05900030
059100              PERFORM 9100-SQL-ABEND                              05910030
059200     END-EVALUATE.                                                05920030
059300                                                                  05930030
059400                                                                  05940030
059500 8000-WRITE-RC010-FILE.                                           05950030
059600                                                                  05960030
059700     MOVE SPACES                     TO RC010-REC                 05970030
059800     MOVE SAVE-DEPT-NBR              TO RC010-DEPT-NBR            05980030
059900     MOVE SAVE-PO-NBR                TO RC010-PO-NBR              05990030
060000     MOVE SAVE-REC-SEQ-NBR           TO RC010-REC-SEQ-NBR         06000030
060100     MOVE SAVE-DATE-VERIFIED-COUNT   TO RC010-DATE-VERIFIED-COUNT 06010030
060200     MOVE PV-VRFYD-CNT               TO RC010-VRFYD-CNT           06020030
060300     MOVE RECEIV-PRE-TKT-IND         TO RC010-PRE-TKT-IND         06030030
060400     MOVE RECEIV-GOH-IND             TO RC010-GOH-IND             06040030
060500     MOVE RECEIV-OPER-UNT-ID         TO RC010-OPER-UNT-ID.        06050030
060600     MOVE RECEIV-FCLTY-ID            TO RC010-FCLTY-ID.           06060030
060700                                                                  06070030
060800     MOVE PV-PKGNG-CDE               TO RC010-PKGNG-CDE           06080030
060900                                                                  06090030
061000     MOVE DP003-BYR-NMBR             TO RC010-BUYER-NBR.          06100030
061100     MOVE DP003-DMM-NMBR             TO RC010-DMM-NBR.            06110030
061200     MOVE DP003-GMM-NMBR             TO RC010-GMM-NBR.            06120030
061300     MOVE DP003-BYR-NAME             TO RC010-BUYER-NAME.         06130030
061400     MOVE DP003-DMM-NAME             TO RC010-DMM-NAME.           06140030
061500     MOVE DP003-GMM-NAME             TO RC010-GMM-NAME.           06150030
061600                                                                  06160030
061700     MOVE PV-CROSS-DOCK-QTY          TO RC010-CROSS-DOCK-QTY.     06170030
061800     MOVE PV-NON-CROSS-DOCK-QTY      TO RC010-NON-CROSS-DOCK-QTY. 06180030
061900                                                                  06190030
062000     SET DC-IDX TO 1.                                             06200030
062100     SEARCH VALID-DC-TBL VARYING DC-IDX                           06210030
062200      AT END SET INVALID-STR TO TRUE                              06220030
062300      WHEN RC010-OPER-UNT-ID = DC-STR-NBR (DC-IDX)                06230030
062400           NEXT SENTENCE                                          06240030
062500     END-SEARCH.                                                  06250030
062600                                                                  06260030
062700     IF INVALID-STR                                               06270030
062800        SET VALID-STR TO TRUE                                     06280030
062900        ADD +1 TO PV-SKIP-CNT                                     06290030
063000     ELSE                                                         06300030
063100        WRITE RC010-RECORD                                        06310030
063200            FROM RC010-REC                                        06320030
063300        ADD +1 TO PV-OUTPUT-CNT                                   06330030
063400     END-IF.                                                      06340030
063500                                                                  06350030
063600******************************************************************06360030
063700* 9100-SQL-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      06370030
063800* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 06380030
063900******************************************************************06390030
064000 9100-SQL-ABEND.                                                  06400030
064100     DISPLAY '** ABEND     **'.                                   06410030
064200     DISPLAY '** PROGRAM   ** = RCKUT031'.                        06420030
064300     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              06430030
064400     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     06440030
064500                                                                  06450030
064600******************************************************************06460030
064700* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    06470030
064800* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         06480030
064900* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     06490030
065000* FORMAT.                                                         06500030
065100******************************************************************06510030
065200*    COPY DPPD004.                                                06520030
065300     COPY DPPD004.                                                06530030
065400                                                                  06540030
065500     MOVE +4013 TO ABEND-CODE.                                    06550030
065600     CALL 'ILBOABN0' USING ABEND-CODE.                            06560030
065700                                                                  06570030
