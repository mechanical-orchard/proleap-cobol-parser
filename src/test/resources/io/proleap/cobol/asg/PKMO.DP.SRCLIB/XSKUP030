       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    XSKUP030.                                         00020051
       AUTHOR.        KOHLS DEPARTMENT STORES.                          00030000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
       DATE-WRITTEN.  10/07/2002.                                       00050051
       DATE-COMPILED.                                                   00060000
      ******************************************************************00070000
      **       MERCHANDISE HIERARCHY MESSAGE FOR TABLE XST_DEPT         00080051
      ******************************************************************00090024
      **THIS IS A CALLED MODULE FOR SUBCLASS MERCH HIER TABLES.  THIS   00100036
      **     PROGRAM WILL PERFORM UPDATES/INSERTS/DELETES FOR THIS      00110036
      **     TABLE.  IT DOES THE FOLLOWING WITH THESE RETURN CODES:     00120036
      **     0000 - END PROGRAM                                         00130024
      **    -0530 - END PROGRAM                                         00140024
      **    -0803 - COMPARE TIMESTAMPS AND UPDATE IF MESSAGE IS NEWER   00150024
      **    -0911 - RETRY INSERT UP TO 5 TIMES AND THEN END PROGRAM     00160024
      ******************************************************************00170000
      **10/07/2002 CHANGED BY:JULIE SMITH          PROGRAM WRITE        00180051
010103**01/01/2003 CHANGED BY:JULIE SMITH ADDTIONAL TIMESTAMPS          00190056
      ******************************************************************00200062
092404**09/24/2004 CHANGED BY:GAYLE HAUPT  WR27107   FIELDS ADDED:      00210062
092404**     DMA-NBR, STR-ZN-CDE, BYR-NBR, CONT-CLR-EXCLN-IND           00220062
      ******************************************************************00230000
111504**11/15/2004 CHANGED BY:JULIE TEWES  WR27840   INCLUDE            00240063
111504**     XST_DEPT_ATTR TABLE                                        00250063
      ******************************************************************00260063
       ENVIRONMENT DIVISION.                                            00270000
       CONFIGURATION SECTION.                                           00280000
       SOURCE-COMPUTER.  IBM-3090.                                      00290000
       OBJECT-COMPUTER.  IBM-3090.                                      00300000
       DATA DIVISION.                                                   00310000
                                                                        00320017
       WORKING-STORAGE SECTION.                                         00330017
      ******************************************************************00340000
      **PROGRAM SWITCHES                                                00350000
      ******************************************************************00360000
       01  PS-PROGRAM-SWITCHES.                                         00370000
           05  PS-PROCESS-CONTINUE-SW      PIC X(01)  VALUE 'Y'.        00380020
               88  PS-PROCESS-CONTINUE                VALUE 'Y'.        00390018
               88  PS-PROCESS-COMPLETE                VALUE 'N'.        00400018
      ******************************************************************00410000
      **PROGRAM COUNTERS                                                00420018
      ******************************************************************00430000
       01  PC-PROGRAM-COUNTERS.                                         00440018
           05  PC-RETRY-COUNTER            PIC 9(01)  VALUE ZEROS.      00450018
           05  PC-RETRY-COUNTER-2          PIC 9(01)  VALUE ZEROS.      00460019
           05  PC-RETRY-MAX                PIC 9(01)  VALUE 5.          00470024
      ******************************************************************00480018
      **PROGRAM VARIABLES                                               00490018
      ******************************************************************00500018
       01  PV-PROGRAM-VARIABLES.                                        00510018
           05  PV-PARAGRAPH-NAME               PIC X(20)  VALUE SPACES. 00520019
           05  PV-TIME-EVALUATE-INSERT.                                 00530019
               10  PV-TIME-HOUR-IN             PIC  9(02) VALUE ZEROS.  00540019
               10  PV-TIME-MINUTE-IN           PIC  9(02) VALUE ZEROS.  00550019
               10  PV-TIME-SECOND-IN           PIC  9(02) VALUE ZEROS.  00560019
               10  PV-TIME-MICROSEC-IN         PIC  9(06) VALUE ZEROS.  00570019
           05  PV-TIME-EVALUATE-UPDATE.                                 00580019
               10  PV-TIME-HOUR-UP             PIC  9(02) VALUE ZEROS.  00590019
               10  PV-TIME-MINUTE-UP           PIC  9(02) VALUE ZEROS.  00600019
               10  PV-TIME-SECOND-UP           PIC  9(02) VALUE ZEROS.  00610019
               10  PV-TIME-MICROSEC-UP         PIC  9(06) VALUE ZEROS.  00620019
      ******************************************************************00630018
      **TIMESTAMP VARIABLES                                             00640018
      ******************************************************************00650018
       01  SD-TIMESTAMP.                                                00660058
           05  SD-CURR-DTE                     PIC  X(10).              00670018
           05  FILLER                          PIC  X(01) VALUE '-'.    00680058
           05  SD-HOUR                         PIC  9(02).              00690058
           05  FILLER                          PIC  X(01) VALUE '.'.    00700058
           05  SD-MINUTE                       PIC  9(02).              00710058
           05  FILLER                          PIC  X(01) VALUE '.'.    00720058
           05  SD-SECOND                       PIC  9(02).              00730058
           05  FILLER                          PIC  X(01) VALUE '.'.    00740058
           05  SD-MICROSEC                     PIC  9(06).              00750058
      ******************************************************************00760000
      **COPYBOOKS                                                       00770000
      ******************************************************************00780000
      ***DB2 MESSAGE AREA                                               00790000
           COPY SQLCA2.                                                 00800060
      ***MESSAGE COPYBOOK                                               00810018
           COPY HMRD001.                                                00820060
      ******************************************************************00830000
      **TABLE INCLUSIONS                                                00840000
      ******************************************************************00850000
      ***DB2 COMMUNICATIONS AREA                                        00860000
           EXEC SQL                                                     00870000
                INCLUDE SQLCA                                           00880000
           END-EXEC.                                                    00890000
      ***XST_DEPT TABLE                                                 00900052
           EXEC SQL                                                     00910000
                INCLUDE XST00015                                        00920052
           END-EXEC.                                                    00930000
111504***XST_DEPT_ATTR TABLE                                            00940063
111504     EXEC SQL                                                     00950063
111504          INCLUDE XST00082                                        00960064
111504     END-EXEC.                                                    00970063
                                                                        00980000
       LINKAGE SECTION.                                                 00990000
      ******************************************************************01000000
      **LINKAGE VARIABLES                                               01010000
      ******************************************************************01020000
       01  LV-HMRD001-RECORD               PIC X(500).                  01030041
       01  LV-RETURN-CODE                  PIC S9(04).                  01040017
010103 01  LV-CURRENT-TIMESTAMP            PIC X(26).                   01050056
                                                                        01060024
       PROCEDURE DIVISION USING LV-HMRD001-RECORD,                      01070036
                                LV-RETURN-CODE,                         01080056
010103                          LV-CURRENT-TIMESTAMP.                   01090056
      ******************************************************************01100000
       0000-MAINLINE.                                                   01110000
                                                                        01120000
            PERFORM 1000-INITIALIZATION.                                01130000
            PERFORM 2000-PROCESS-MESSAGE                                01140037
                    UNTIL PS-PROCESS-COMPLETE.                          01150018
            PERFORM 9999-WRAPUP.                                        01160000
                                                                        01170000
       EJECT.                                                           01180018
      ***************************************************************** 01190000
      **INITIALIZATION AREA - ALL MOVES TO UPDATE/INSERT                01200024
      ***************************************************************** 01210000
       1000-INITIALIZATION.                                             01220000
                                                                        01230000
           MOVE '1000-INITIALIZATION'      TO PV-PARAGRAPH-NAME.        01240018
                                                                        01250018
           SET PS-PROCESS-CONTINUE         TO TRUE.                     01260020
           INITIALIZE PC-RETRY-COUNTER.                                 01270018
           INITIALIZE SD-TIMESTAMP.                                     01280042
                                                                        01290023
           MOVE LV-HMRD001-RECORD           TO HMRD001-RECORD.          01300045
           MOVE HM001-DEPATTR-DEPT          TO XST00015-DEPT-NBR.       01310052
           MOVE HM001-DEPATTR-BUS-GP-NBR    TO XST00015-BUS-GP-NBR.     01320052
           MOVE HM001-DEPATTR-MDSE-LNE-CDE  TO XST00015-MDSE-LNE-CDE.   01330052
                                                                        01340042
010103     MOVE LV-CURRENT-TIMESTAMP      TO XST00015-LAST-UPD-TMST.    01350056
010103     MOVE HM001-CRE-TMST            TO SD-CURR-DTE.               01360058
010103     MOVE SD-TIMESTAMP              TO XST00015-SOR-LAST-MSG-TMST.01370057
092404     MOVE HM001-DEPATTR-STR-ZN-CDE  TO XST00015-STR-ZN-CDE.       01380060
092404     MOVE HM001-DEPATTR-CONT-CLR-EXCLN                            01390060
092404                                   TO XST00015-CONT-CLR-EXCLN-IND.01400060
           INITIALIZE SD-TIMESTAMP.                                     01410056
                                                                        01420042
       EJECT.                                                           01430038
      ***************************************************************** 01440001
      **MAIN PROGRAM LOGIC - READS ACTION TYPE ON HMRD001 RECORD        01450044
      ***************************************************************** 01460001
       2000-PROCESS-MESSAGE.                                            01470037
                                                                        01480000
           MOVE '2000-PROCESS-MESSAGE' TO PV-PARAGRAPH-NAME.            01490037
                                                                        01500017
           EVALUATE TRUE                                                01510037
              WHEN HM001-ACTN-TYP-INSERT                                01520037
                   PERFORM 2200-UPDATE-DATA                             01530045
              WHEN HM001-ACTN-TYP-UPDATE                                01540037
                   PERFORM 2200-UPDATE-DATA                             01550037
              WHEN HM001-ACTN-TYP-DELETE                                01560037
                   PERFORM 2300-DELETE-DATA                             01570039
           END-EVALUATE.                                                01580037
                                                                        01590037
       EJECT.                                                           01600037
      ***************************************************************** 01610053
      **INSERT ACTION TYPE                                              01620053
      ***************************************************************** 01630053
       2100-INSERT-DATA.                                                01640053
                                                                        01650053
           MOVE '2100-INSERT-DATA'     TO PV-PARAGRAPH-NAME.            01660061
                                                                        01670053
           EXEC SQL                                                     01680053
                INSERT INTO XST_DEPT (DEPT_NBR                          01690053
                                    , BUS_GP_NBR                        01700053
                                    , DEPT_NM                           01710053
                                    , MDSE_LNE_CDE                      01720053
                                    , LAST_UPD_TMST                     01730056
010103                              , SOR_LAST_MSG_TMST                 01740061
092404                              , DMA_NBR                           01750061
092404                              , STR_ZN_CDE                        01760061
092404                              , BYR_NBR                           01770061
092404                              , CONT_CLR_EXCLN_IND)               01780061
                VALUES (:XST00015-DEPT-NBR                              01790053
                      , :XST00015-BUS-GP-NBR                            01800053
                      , 'NOT AVAILABLE'                                 01810056
                      , :XST00015-MDSE-LNE-CDE                          01820053
                      , :XST00015-LAST-UPD-TMST                         01830056
010103                , :XST00015-SOR-LAST-MSG-TMST                     01840061
092404                , 0000                                            01850061
092404                , :XST00015-STR-ZN-CDE                            01860061
092404                , 0000                                            01870061
092404                , :XST00015-CONT-CLR-EXCLN-IND)                   01880061
           END-EXEC.                                                    01890053
                                                                        01900053
           EVALUATE TRUE                                                01910053
      ***SUCCESSFUL PROCESSING                                          01920056
              WHEN SQLCODE = ZEROS                                      01930053
111504             PERFORM 2150-INSERT-ATTR-DATA                        01940063
      ***REFERENTIAL INTEGRITY ISSUES                                   01950056
              WHEN SQLCODE = -530                                       01960053
              WHEN SQLCODE = -532                                       01970056
                   SET PS-PROCESS-COMPLETE   TO TRUE                    01980053
      ***ROW/TABLE LOCK                                                 01990056
              WHEN SQLCODE = -913                                       02000053
              WHEN SQLCODE = -911                                       02010053
                   IF  PC-RETRY-COUNTER >= PC-RETRY-MAX                 02020053
                       SET PS-PROCESS-COMPLETE TO TRUE                  02030053
                   ELSE                                                 02040053
                       ADD +1                  TO PC-RETRY-COUNTER      02050053
                   END-IF                                               02060053
              WHEN OTHER                                                02070053
                   SET PS-PROCESS-COMPLETE     TO TRUE                  02080053
           END-EVALUATE.                                                02090053
                                                                        02100053
       EJECT.                                                           02110053
111504***************************************************************** 02120063
111504**INSERT RECORD INTO XST_DEPT_ATTR                                02130063
111504***************************************************************** 02140063
111504 2150-INSERT-ATTR-DATA.                                           02150063
                                                                        02160063
111504     MOVE '2150-INSERT-ATTR-DATA' TO PV-PARAGRAPH-NAME.           02170063
                                                                        02180063
111504     EXEC SQL                                                     02190063
111504          INSERT INTO XST_DEPT_ATTR                               02200063
111504                              ( DEPT_NBR                          02210063
111504                              , CLOR_DESC_TYP_CDE)                02220063
111504          VALUES (:XST00015-DEPT-NBR                              02230063
111504                ,  'NRF')                                         02240063
111504     END-EXEC.                                                    02250063
                                                                        02260063
111504     EVALUATE TRUE                                                02270063
111504***SUCCESSFUL PROCESSING                                          02280063
111504        WHEN SQLCODE = ZEROS                                      02290063
111504             SET PS-PROCESS-COMPLETE   TO TRUE                    02300063
111504***REFERENTIAL INTEGRITY ISSUES                                   02310063
111504        WHEN SQLCODE = -530                                       02320063
111504        WHEN SQLCODE = -532                                       02330063
111504             SET PS-PROCESS-COMPLETE   TO TRUE                    02340063
111504***ROW/TABLE LOCK                                                 02350063
111504        WHEN SQLCODE = -911                                       02360063
111504        WHEN SQLCODE = -913                                       02370063
111504             IF  PC-RETRY-COUNTER >= PC-RETRY-MAX                 02380063
111504                 SET PS-PROCESS-COMPLETE TO TRUE                  02390063
111504             ELSE                                                 02400063
111504                 ADD +1                  TO PC-RETRY-COUNTER      02410063
111504             END-IF                                               02420063
111504        WHEN OTHER                                                02430063
111504             SET PS-PROCESS-COMPLETE     TO TRUE                  02440063
111504     END-EVALUATE.                                                02450063
                                                                        02460063
111504 EJECT.                                                           02470063
      ******************************************************************02480019
      **UPDATE ACTION TYPE                                              02490044
      ******************************************************************02500019
       2200-UPDATE-DATA.                                                02510019
                                                                        02520019
           MOVE '2200-UPDATE-DATA' TO PV-PARAGRAPH-NAME                 02530019
                                                                        02540019
           EXEC SQL                                                     02550019
              UPDATE XST_DEPT                                           02560052
                  SET  BUS_GP_NBR    = :XST00015-BUS-GP-NBR             02570052
                     , MDSE_LNE_CDE  = :XST00015-MDSE-LNE-CDE           02580052
                     , LAST_UPD_TMST = :XST00015-LAST-UPD-TMST          02590052
                     , SOR_LAST_MSG_TMST = :XST00015-SOR-LAST-MSG-TMST  02600056
092404               , STR_ZN_CDE    = :XST00015-STR-ZN-CDE             02610061
092404               , CONT_CLR_EXCLN_IND                               02620061
092404                               = :XST00015-CONT-CLR-EXCLN-IND     02630061
                  WHERE DEPT_NBR     = :XST00015-DEPT-NBR               02640054
           END-EXEC.                                                    02650019
                                                                        02660019
           EVALUATE TRUE                                                02670020
      ***SUCCESSFUL PROCESSING                                          02680056
              WHEN SQLCODE = ZEROS                                      02690020
                   SET PS-PROCESS-COMPLETE     TO TRUE                  02700019
      ***ROW DOES NOT EXIST                                             02710056
              WHEN SQLCODE = +100                                       02720046
                   PERFORM 2100-INSERT-DATA                             02730046
                           UNTIL PS-PROCESS-COMPLETE                    02740046
      ***ROW/TABLE LOCK                                                 02750056
              WHEN SQLCODE = -911                                       02760020
              WHEN SQLCODE = -913                                       02770055
                   IF  PC-RETRY-COUNTER-2 >= PC-RETRY-MAX               02780035
                       SET PS-PROCESS-COMPLETE TO TRUE                  02790019
                   ELSE                                                 02800019
                       ADD +1                  TO PC-RETRY-COUNTER-2    02810024
                   END-IF                                               02820019
              WHEN OTHER                                                02830019
                   SET PS-PROCESS-COMPLETE     TO TRUE                  02840038
           END-EVALUATE.                                                02850019
                                                                        02860019
       EJECT.                                                           02870019
      ******************************************************************02880039
      **DELETE TYPE ACTION                                              02890044
      ******************************************************************02900039
       2300-DELETE-DATA.                                                02910039
                                                                        02920039
           MOVE '2300-DELETE-DATA' TO PV-PARAGRAPH-NAME                 02930039
                                                                        02940039
           EXEC SQL                                                     02950041
                DELETE FROM XST_DEPT                                    02960052
                WHERE DEPT_NBR   = :XST00015-DEPT-NBR                   02970052
           END-EXEC.                                                    02980041
                                                                        02990041
           EVALUATE TRUE                                                03000041
      ***SUCCESSFUL PROCESSING                                          03010056
              WHEN SQLCODE = ZEROS                                      03020041
                   SET PS-PROCESS-COMPLETE     TO TRUE                  03030041
      ***ROW DOES NOT EXIST                                             03040056
              WHEN SQLCODE = +100                                       03050046
                   SET PS-PROCESS-COMPLETE     TO TRUE                  03060046
              WHEN SQLCODE = -911                                       03070041
              WHEN SQLCODE = -913                                       03080055
                   IF  PC-RETRY-COUNTER-2 >= PC-RETRY-MAX               03090041
                       SET PS-PROCESS-COMPLETE TO TRUE                  03100041
                   ELSE                                                 03110041
                       ADD +1                  TO PC-RETRY-COUNTER-2    03120041
                   END-IF                                               03130041
              WHEN OTHER                                                03140041
                   SET PS-PROCESS-COMPLETE     TO TRUE                  03150041
           END-EVALUATE.                                                03160041
                                                                        03170041
       EJECT.                                                           03180039
      ******************************************************************03190000
      **PASS SQLCODE TO CALLING AND EXIT PROGRAM                        03200024
      ******************************************************************03210000
       9999-WRAPUP.                                                     03220000
                                                                        03230000
           MOVE '9999-WRAPUP' TO PV-PARAGRAPH-NAME                      03240018
                                                                        03250000
           MOVE SQLCODE       TO LV-RETURN-CODE.                        03260018
           DISPLAY 'XSKUP030 - DEPT NBR: ' XST00015-DEPT-NBR            03270052
                            ' WITH RETURN-CODE ' LV-RETURN-CODE.        03280048
           EXIT PROGRAM.                                                03290000
                                                                        03300000
       EJECT.                                                           03310018
