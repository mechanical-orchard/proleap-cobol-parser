000120 IDENTIFICATION DIVISION.                                         00010000
000140 PROGRAM-ID.      WSKUT050.                                       00011000
000150 AUTHOR.          JEAN KURK.                                      00012000
000160 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00013000
000170 DATE-WRITTEN.    07-09-2013.                                     00014000
000180                                                                  00015000
000190***************************************************************** 00016000
000191*           COPY IFSE ERROR QUEUE TO FILE                         00017000
000700****************************************************************  00017161
000800* I M P O R T A N T --- WHEN COMPILING THIS PROGRAM THE MQ SERIES 00017261
000900* SWITCH ON THE 2ND COMPILE SCREEN NEEDS TO BE SET TO 'Y'.        00017361
001000* THIS PROGRAM USES MQSERIES.                                     00017461
000192***************************************************************** 00018000
000199*   OPEN THE MESSAGE OUTPUT SEQUENTIAL FILE.                      00019600
000200*                                                                 00019700
000201*   CONNECT TO THE QUEUE MANAGER.                                 00019800
000202*   IF CONNECTION FAILED THEN                                     00019900
000203*            CALL 9000-DISPLAY-ERROR-MESSAGE AND EXIT             00020000
000204*                                                                 00020100
000205*   OPEN THE SPECIFIED MESSAGE QUEUE (MQOPEN).                    00020200
000206*   IF OPEN FAILED THEN                                           00020300
000207*            DISCONNECT FROM QUEUE MANAGER                        00020400
000208*            CALL 9000-DISPLAY-ERROR-MESSAGE AND EXIT             00020500
000210*                                                                 00020700
000211*   SET THE GET MESSAGE OPTIONS.                                  00020800
000212*            GET MESSAGES FROM QUEUE (MQGET)                      00020900
000213*            IF GET FAILED                                        00021000
000214*                     CALL 9000-DISPLAY-ERROR-MESSAGE             00021100
000215*            ENDIF                                                00021200
000216*                                                                 00021300
000217*   WRITE MESSAGE TO OUTPUT SEQUENTIAL FILE                       00021400
000218*                                                                 00021500
000219*   CLOSE THE MESSAGE QUEUE.                                      00021600
000220*   IF CLOSE FAILED THEN                                          00021700
000221*            CALL 9000-DISPLAY-ERROR-MESSAGE.                     00021800
000222*                                                                 00021900
000223*   DISCONNECT FROM THE QUEUE MANAGER.                            00022000
000224*   IF DISCONNECT FAILED THEN                                     00022100
000225*            CALL 9000-DISPLAY-ERROR-MESSAGE.                     00022200
000226*                                                                 00022300
000227*   CLOSE THE MESSAGE OUTPUT FILE.                                00022400
000230*                                                                 00022700
000231***************************************************************** 00022800
000233 ENVIRONMENT DIVISION.                                            00022900
000235                                                                  00023000
000236 CONFIGURATION SECTION.                                           00023100
000237                                                                  00023200
000238 SOURCE-COMPUTER.       IBM-3090.                                 00023300
000239 OBJECT-COMPUTER.       IBM-3090.                                 00023400
000240                                                                  00023500
000241 INPUT-OUTPUT SECTION.                                            00023600
000242                                                                  00023700
000243 FILE-CONTROL.                                                    00023800
000248     SELECT ERR-EXTRACT                                           00023900
000249            ASSIGN TO OUT01.                                      00024000
000250                                                                  00025000
000252 DATA DIVISION.                                                   00025100
000254 FILE SECTION.                                                    00025200
000255                                                                  00025300
000268 FD  ERR-EXTRACT                                                  00025400
000269     RECORDING MODE F                                             00025555
000269     RECORD CONTAINS 3000 CHARACTERS                              00025655
000270     BLOCK CONTAINS 0 RECORDS                                     00025701
000271     LABEL RECORDS ARE OMITTED.                                   00025801
000272 01  ERR-EXTRACT-RECORD               PIC X(3000).                00025955
000272 01  ERR-EXTRACT-REC-LARGE            PIC X(3000).                00026003
000273                                                                  00026103
000275 WORKING-STORAGE SECTION.                                         00026203
000277                                                                  00027000
000284******************************************************************00028000
000285*  COMMUNICATIONS AREA FOR DB2                                    00028100
000286******************************************************************00028200
000287     EXEC SQL                                                     00028300
000288          INCLUDE SQLCA                                           00028400
000289     END-EXEC.                                                    00028500
000290                                                                  00028600
000291     COPY SQLCA2.                                                 00028700
000292                                                                  00028800
000293******************************************************************00028900
000294*  WORK AREA FOR SQL ERROR ROUTINE 'DSNTIAR'.                     00029000
000295******************************************************************00029100
000296     COPY DPWS004.                                                00029200
000297******************************************************************00029300
000298*  DB2 VIEW DCL - WST_CNSMR_QUE                                   00029460
000300******************************************************************00029600
000301     EXEC SQL                                                     00029700
000302          INCLUDE WSV00006                                        00029860
000303     END-EXEC.                                                    00029900
000304                                                                  00030000
000308 01  WS-VARIABLES.                                                00030400
000309     05  PV-RETRY-COUNTER           PIC S9(04) VALUE +0 COMP SYNC.00030500
000310     05  PC-MAX-RETRIES             PIC S9(03) VALUE +5 COMP-3.   00030600
000311     05  PC-CURRENT-PROGRAM-NAME    PIC X(08)  VALUE 'WSKUT050'.  00030700
000312     05  PV-ERROR-MESSAGE           PIC X(48) VALUE SPACES.       00030800
000314     05  PV-DISPLAY-CNT             PIC Z,ZZZ,ZZ9.                00031107
000314     05  PV-QUEUE-MGR               PIC X(10).                    00031219
000314     05  PV-QUEUE-NAME              PIC X(48).                    00031320
000315                                                                  00031510
000316 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00031610
000317                                                   COMP SYNC.     00031710
000318                                                                  00031810
000319 01  WS-MQCONN               PIC X(8)  VALUE 'CSQBCONN'.          00031910
000320 01  WS-MQOPEN               PIC X(8)  VALUE 'CSQBOPEN'.          00032010
000321 01  WS-MQGET                PIC X(8)  VALUE 'CSQBGET'.           00032110
000322 01  WS-MQCLOSE              PIC X(8)  VALUE 'CSQBCLOS'.          00032210
000323 01  WS-MQDISC               PIC X(8)  VALUE 'CSQBDISC'.          00032310
000324 01  WS-MQCMIT               PIC X(8)  VALUE 'CSQBCOMM'.          00032410
000325 01  WS-MQBACK               PIC X(8)  VALUE 'CSQBBACK'.          00032510
000326                                                                  00032610
000327*    GENERAL WORK FIELDS                                          00032710
000328                                                                  00032810
000329 01  NUMRECS                 PIC 9(9)  VALUE ZEROS.               00032910
000330 01  NUMGETS                 PIC S9(9) BINARY VALUE 0.            00033010
000331 01  NUMPUTS                 PIC 9(9)  VALUE ZEROS.               00033110
000332 01  NUMCMTS                 PIC 9(9)  VALUE ZEROS.               00033210
000333 01  ERROR-MESSAGE           PIC X(48) VALUE SPACES.              00033310
000334 01  PV-PARAGRAPH            PIC X(48) VALUE SPACES.              00033410
000335                                                                  00033510
000336*   PARAMETER VARIABLES                                           00033610
000337                                                                  00033710
000338 01  QM-QMGR-NAME          PIC X(48).                             00033810
000339 01  QNAME                 PIC X(48).                             00033910
000340 01  PADCHAR               PIC X(1) VALUE '*'.                    00034010
000341 01  MSGBUFFER             pic X(999999) VALUE SPACES.            00034143
000341 01  MSGBUFFER_SMALL      pic X(3000) VALUE SPACES.               00034244
000342 01  NUMMSGS               PIC S9(9) BINARY VALUE 1.              00034344
000343 01  MSGLENGTH             PIC S9(9) BINARY.                      00034444
000344 01  DATA-LENGTH           PIC S9(9) BINARY.                      00034544
000345 01  MQCHECK               PIC X(8) VALUE 'MQR2C'.                00034644
000346 01  MQ-REASON-TEXT        PIC X(30) VALUE SPACES.                00034744
000347 01  HOLD-REASON           PIC S9(9) BINARY.                      00034844
000348 01  HOLD-COMPLETION-CODE  PIC S9(9) BINARY.                      00034944
000349                                                                  00035044
000350*    API FIELDS                                                   00035144
000351                                                                  00035244
000352 01  HCONN                   PIC S9(9) BINARY VALUE 0.            00035344
000353 01  GQ-HANDLE               PIC S9(9) BINARY VALUE 0.            00035444
000354 01  OPEN-OPTIONS            PIC S9(9) BINARY.                    00035544
000355 01  COMPLETION-CODE         PIC S9(9) BINARY.                    00035644
000356 01  REASON                  PIC S9(9) BINARY.                    00035744
000357 01  CON-REASON              PIC S9(9) BINARY.                    00035844
000358                                                                  00035944
000359 01  PV-ABEND-VARIABLES.                                          00036044
000360     05  PV-ABEND-CODE              PIC S9(04) VALUE +0 COMP SYNC.00036144
000361     88  ABEND-4001-WRITE-ERROR                      VALUE +4001. 00036244
000362     88  ABEND-4002-READ-ERROR                       VALUE +4002. 00036344
000363     88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003. 00036444
000364     88  ABEND-4004-TABLE-ERROR                      VALUE +4004. 00036544
000365     88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 00036644
000366     88  ABEND-4006-CLOSE-ERROR                      VALUE +4006. 00036744
000367     88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 00036844
000368     88  ABEND-4008-DATA-ERROR                       VALUE +4008. 00036944
000369     88  ABEND-4009-KEY-DATA-ERROR                   VALUE +4009. 00037044
000370     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 00037144
000371     88  ABEND-4019-CAL-SUB-ERROR                    VALUE +4019. 00037244
000372     88  ABEND-4020-MQ-ERROR                         VALUE +4020. 00037344
000373     88  ABEND-4444-FORCED-ABEND                     VALUE +4444. 00037444
000374                                                                  00037544
000375                                                                  00037644
000376 01  PE-MQ-ABEND-VARIABLES.                                       00037744
000377     10  PE-MQ-QMANAGER           PIC X(05) VALUE SPACES.         00037844
000378     10  PE-MQ-QNAME              PIC X(30) VALUE SPACES.         00037944
000379     10  PE-MQ-COMPLETION-CODE    PIC 9(04) VALUE ZEROS.          00038044
000380     10  PE-MQ-REASON-CODE        PIC 9(04) VALUE ZEROS.          00038144
000382                                                                  00038244
000383*   API CONTROL BLOCKS                                            00038344
000384                                                                  00038444
000385 01  MQM-OBJECT-DESCRIPTOR.                                       00038544
000386     COPY CMQODV.                                                 00038644
000387 01  MQM-MESSAGE-DESCRIPTOR.                                      00038744
000388     COPY CMQMDV.                                                 00038844
000389 01  MQM-GET-MESSAGE-OPTIONS.                                     00038944
000390     COPY CMQGMOV.                                                00039044
000391                                                                  00039144
000392*    MQV CONTAINS CONSTANTS (FOR FILLING IN THE CONTROL BLOCKS)   00039244
000393*    AND RETURN CODES (FOR TESTING THE RESULT OF A CALL)          00039344
000394                                                                  00039444
000395 01  MQM-CONSTANTS.                                               00039544
000396     COPY CMQV.                                                   00039644
000397                                                                  00039744
000426* ------------------------------------------------------------- * 00042100
000427 PROCEDURE DIVISION.                                              00042200
000428* ------------------------------------------------------------- * 00042300
000429 0000-MAIN.                                                       00042400
000430                                                                  00042500
000465* -------------------------------------------------------------   00042600
000466*  OPEN OUTPUT MESSAGE SEQUENTIAL FILE                            00042700
000467* -------------------------------------------------------------   00042800
000468                                                                  00042900
000469     OPEN OUTPUT ERR-EXTRACT.                                     00043000
000470                                                                  00044000
000471     INITIALIZE ERR-EXTRACT-RECORD.                               00045000
000472                                                                  00046000
000473     PERFORM 7000-GET-MQ-INFO.                                    00047000
000474                                                                  00047100
000475* -------------------------------------------------------------   00047200
000476*  CONNECT TO THE QUEUE MANAGER                                   00047300
000477* -------------------------------------------------------------   00047400
000478     MOVE PV-QUEUE-MGR  TO QM-QMGR-NAME.                          00047519
000479     CALL WS-MQCONN USING QM-QMGR-NAME                            00047608
000480                         HCONN                                    00047700
000481                         COMPLETION-CODE                          00047800
000482                         REASON.                                  00047900
000483                                                                  00048100
000484* -------------------------------------------------------------   00048200
000485*    IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE              00048300
000486*    AND EXIT                                                     00048400
000487* -------------------------------------------------------------   00048500
000488                                                                  00048600
000489     MOVE REASON TO CON-REASON.                                   00048700
000490     IF (COMPLETION-CODE NOT = MQCC-OK) THEN                      00048800
000491        MOVE 'MQCONN'   TO ERROR-MESSAGE                          00048900
000492        PERFORM 9000-DISPLAY-ERROR-MESSAGE                        00049000
000493        GO TO 4000-END-PROGRAM                                    00049100
000494     END-IF.                                                      00049200
000495     DISPLAY 'MQCONN SUCCESSFUL TO ', QM-QMGR-NAME.               00049308
000496* -------------------------------------------------------------   00049400
000497*    OPEN THE QUEUE FOR INPUT                                     00049500
000498* -------------------------------------------------------------   00049600
000499                                                                  00049700
000500     COMPUTE OPEN-OPTIONS = MQOO-INPUT-SHARED +                   00049819
000501                            MQOO-FAIL-IF-QUIESCING.               00049913
000502     MOVE PV-QUEUE-NAME     TO MQOD-OBJECTNAME.                   00050019
000503     MOVE PV-QUEUE-MGR      TO MQOD-OBJECTQMGRNAME.               00050119
000504                                                                  00050413
000505     CALL WS-MQOPEN USING HCONN                                   00050613
000506                         MQM-OBJECT-DESCRIPTOR                    00050713
000507                         OPEN-OPTIONS                             00050813
000508                         GQ-HANDLE                                00050913
000509                         COMPLETION-CODE                          00051013
000510                         REASON.                                  00051113
000512* -------------------------------------------------------------   00051438
000513*    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE                    00051538
000514*    AND EXIT.                                                    00051638
000515* -------------------------------------------------------------   00051738
000517     IF (COMPLETION-CODE NOT = MQCC-OK) THEN                      00051838
000518        MOVE 'MQOPEN'   TO ERROR-MESSAGE                          00051938
000519        PERFORM 9000-DISPLAY-ERROR-MESSAGE                        00052038
000520        GO TO 3000-DISCONNECT-QMGR                                00052138
000521     END-IF.                                                      00052238
000522     DISPLAY 'MQOPEN SUCCESSFUL'.                                 00052338
000523                                                                  00052438
000524     PERFORM 2000-MQGET-MSG.                                      00052538
000525                                                                  00052838
000526* -------------------------------------------------------------   00052938
000527*    CLOSE THE QUEUE                                              00053038
000528* -------------------------------------------------------------   00053138
000529                                                                  00053238
000530     CALL WS-MQCLOSE USING HCONN                                  00054038
000531                          GQ-HANDLE                               00054138
000532                          MQCO-NONE                               00054238
000533                          COMPLETION-CODE                         00054338
000534                          REASON.                                 00054438
000535     IF (COMPLETION-CODE NOT = MQCC-OK) THEN                      00054838
000536        MOVE 'MQCLOSE'  TO ERROR-MESSAGE                          00054938
000537        PERFORM 9000-DISPLAY-ERROR-MESSAGE                        00055038
000538     ELSE                                                         00055138
000539        DISPLAY 'MQCLOSE SUCCESSFUL'                              00055238
000540     END-IF.                                                      00055338
000541                                                                  00055438
000542     PERFORM 3000-DISCONNECT-QMGR.                                00055638
000543     GO TO 4000-END-PROGRAM.                                      00055838
000544                                                                  00055938
000545* -------------------------------------------------------------   00056038
000546* GET MESSAGES FROM THE QUEUE                                     00056138
000546*    MQGMO-CONVERT - USED TO CONVERT MSGS BETWEEN EBCDIC & ASCII  00056259
000547* -------------------------------------------------------------   00056358
000548 2000-MQGET-MSG.                                                  00056458
000549                                                                  00056538
000550     PERFORM                                                      00056638
000551       UNTIL (COMPLETION-CODE IS EQUAL TO MQCC-FAILED)            00056738
000552         MOVE MQMI-NONE TO MQMD-MSGID                             00056838
000553         MOVE MQCI-NONE TO MQMD-CORRELID                          00056938
000554         MOVE 999999 TO MSGLENGTH                                 00057043
000555         COMPUTE MQGMO-OPTIONS  = MQGMO-SYNCPOINT +               00057138
000556                                  MQGMO-CONVERT +                 00057247
000556                                  MQGMO-WAIT                      00057347
000557                                                                  00057447
000558         CALL WS-MQGET USING HCONN                                00057738
000559                            GQ-HANDLE                             00057838
000560                            MQM-MESSAGE-DESCRIPTOR                00057938
000561                            MQM-GET-MESSAGE-OPTIONS               00058038
000562                            MSGLENGTH                             00058138
000563                            MSGBUFFER                             00058238
000564                            DATA-LENGTH                           00058338
000565                            COMPLETION-CODE                       00058438
000566                            REASON                                00058538
000567                                                                  00058638
000567         MOVE MSGBUFFER(173:3000) TO MSGBUFFER_SMALL              00058757
000568*        IF PUT FAILED THEN DISPLAY ERROR MESSAGE                 00058938
000569*        AND BREAK OUT OF LOOP                                    00059038
000570                                                                  00059138
000571         IF (COMPLETION-CODE NOT = MQCC-OK) THEN                  00059338
000572            MOVE 'MQGET'     TO ERROR-MESSAGE                     00059538
000573            PERFORM 9000-DISPLAY-ERROR-MESSAGE                    00059638
000574         ELSE                                                     00059738
000575            ADD 1 TO NUMRECS                                      00059938
000576                IF NUMRECS > 1000                                 00060138
000577                    PERFORM 3600-MQ-COMMIT                        00060338
000578                    MOVE ZERO TO NUMRECS                          00060538
000579                END-IF                                            00060638
000580            ADD 1 TO NUMGETS                                      00060838
000581            PERFORM 8000-WRITE-EXTRACT-RECORD                     00061038
000582         END-IF                                                   00061138
000583     END-PERFORM.                                                 00061938
                                                                        00062057
000576* DO FINAL COMMIT                                                 00062242
000576     IF NUMRECS > 0                                               00062342
000577         PERFORM 3600-MQ-COMMIT                                   00062442
000577     END-IF.                                                      00062542
000586                                                                  00062642
000587* ------------------------------------------------------------- * 00062742
000588* CLOSE AND DISCONNECT FROM THE MQ QUEUE MANAGER                  00062842
000589* ------------------------------------------------------------- * 00062942
000590 3000-DISCONNECT-QMGR.                                            00063042
000591                                                                  00063142
000592*    DISCONNECT FROM THE QUEUE MANAGER                            00063242
000593                                                                  00063342
000594     IF CON-REASON IS NOT EQUAL TO MQRC-ALREADY-CONNECTED         00063442
000595        CALL WS-MQDISC USING HCONN                                00063542
000596                            COMPLETION-CODE                       00063642
000597                            REASON                                00063742
000598        IF (COMPLETION-CODE NOT = MQCC-OK) THEN                   00063842
000599           MOVE 'MQDISC'   TO ERROR-MESSAGE                       00063942
000600           PERFORM 9000-DISPLAY-ERROR-MESSAGE                     00064042
000601        ELSE                                                      00064142
000602           DISPLAY 'MQDISC SUCCESSFUL'                            00064242
000603        END-IF                                                    00064342
000604     END-IF.                                                      00064442
000605                                                                  00064542
000606*    CLOSE THE MESSAGE EXTRACT OUTPUT FILE.                       00064642
000607                                                                  00064742
000608     CLOSE ERR-EXTRACT.                                           00064842
000609                                                                  00064942
000611******************************************************************00065042
000612*  COMMIT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT        00065142
000613******************************************************************00065242
000614 3600-MQ-COMMIT.                                                  00065342
000615                                                                  00065442
000616     CALL WS-MQCMIT USING HCONN                                   00065542
000617                          COMPLETION-CODE                         00065642
000618                          REASON.                                 00065742
000619                                                                  00065842
000620     IF (COMPLETION-CODE NOT = MQCC-OK)                           00065942
000621         CALL MQCHECK USING REASON                                00066042
000622                               MQ-REASON-TEXT                     00066142
000623        MOVE '3600-COMMIT-MQ'   TO PV-PARAGRAPH                   00066242
000624        MOVE 'MQCMIT ERROR'     TO ERROR-MESSAGE                  00066342
000625        MOVE COMPLETION-CODE    TO HOLD-COMPLETION-CODE           00066442
000626        MOVE REASON             TO HOLD-REASON                    00066542
000627        PERFORM 3700-BACK-OUT-MQ                                  00066642
000628        MOVE HOLD-COMPLETION-CODE TO COMPLETION-CODE              00066742
000629                                        PE-MQ-COMPLETION-CODE     00066842
000630        MOVE HOLD-REASON          TO REASON                       00066942
000631                                        PE-MQ-REASON-CODE         00067042
000632        PERFORM 9200-MQ-ABEND                                     00067142
000633     ELSE                                                         00067242
000634        ADD +1 TO NUMCMTS                                         00067342
000635     END-IF.                                                      00067442
000636                                                                  00067542
000637******************************************************************00067642
000638* BACK OUT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT       00067742
000639******************************************************************00067842
000640 3700-BACK-OUT-MQ.                                                00067942
000641                                                                  00068042
000642     CALL WS-MQBACK USING HCONN                                   00068142
000643                          COMPLETION-CODE                         00068242
000644                          REASON.                                 00068342
000645                                                                  00068442
000646     IF (COMPLETION-CODE NOT = MQCC-OK) THEN                      00068542
000647         CALL MQCHECK USING REASON                                00068642
000648                            MQ-REASON-TEXT                        00068742
000649        MOVE '3700-BACK-OUT-MQ'  TO PV-PARAGRAPH                  00068842
000650        MOVE 'MQBACK ERROR'      TO ERROR-MESSAGE                 00068942
000651        PERFORM 9200-MQ-ABEND                                     00069042
000652     END-IF.                                                      00069142
000653******************************************************************00069242
000654                                                                  00069342
000655* ------------------------------------------------------------- * 00069442
000656* END THE PROGRAM                                                 00069542
000657* ------------------------------------------------------------- * 00069642
000658 4000-END-PROGRAM.                                                00069742
000659                                                                  00069842
000660*    DISPLAY THE NUMBER OF MESSAGES SUCCESSFULLY PUT              00069942
000661*    TO THE QUEUE                                                 00070042
000662                                                                  00070142
000662     MOVE NUMGETS TO PV-DISPLAY-CNT.                              00070242
000663     DISPLAY 'MESSAGES READ FROM QUEUE ' PV-DISPLAY-CNT.          00070342
000662     MOVE NUMPUTS TO PV-DISPLAY-CNT.                              00070442
000664     DISPLAY 'ERR MSGS PUT TO DISK     ' PV-DISPLAY-CNT.          00070542
000662     MOVE NUMCMTS TO PV-DISPLAY-CNT.                              00070642
000665     DISPLAY 'NBR OF COMMITS TAKEN     ' PV-DISPLAY-CNT.          00070742
000666                                                                  00070842
000667     IF NUMPUTS > 0                                               00070942
000668        MOVE 4095 TO RETURN-CODE                                  00071042
000669     END-IF.                                                      00071142
000670                                                                  00071242
000671     STOP RUN.                                                    00071342
000672                                                                  00071442
000673******************************************************************00071542
000674* GETS MQ INFO FROM WSV_CNSMR_QUE                                 00071660
000675******************************************************************00072042
000676 7000-GET-MQ-INFO.                                                00072142
000677                                                                  00072242
000683       EXEC SQL                                                   00072342
000684        SELECT QUE_MGR,                                           00072442
000685               QUE_NM                                             00072542
000686         INTO :PV-QUEUE-MGR                                       00072642
000687             ,:PV-QUEUE-NAME                                      00072742
000688         FROM WSV_CNSMR_QUE                                       00072842
000689        WHERE APPL_FUNC_DESC  = 'QUEUE'                           00072942
000690          AND INTGRTN_TYP_CDE = 'IFSEERRORQ'                      00073042
000691       END-EXEC                                                   00073142
000692                                                                  00073242
000693       EVALUATE TRUE                                              00073342
000694           WHEN SQLCODE = 0                                       00073442
000706             DISPLAY PC-CURRENT-PROGRAM-NAME                      00073542
000707                     ' MQ INFO: ' PV-QUEUE-MGR '  '               00073642
000708                      PV-QUEUE-MGR                                00073742
000727                                                                  00075110
000728           WHEN OTHER                                             00075210
000729             MOVE SQLCODE TO SQLCODE2                             00075310
000730             DISPLAY '******************************************' 00075410
000731             DISPLAY '* ABEND                                   ' 00075510
000732             DISPLAY '* PROGRAM = WSKUT050                      ' 00075610
000733             DISPLAY '* PARAGRAPH = 7000-GET-MQ-INFO'             00075710
000734             DISPLAY '* GETTING MQ INFO FROM WST_ATTR_ELEM      ' 00075810
000735             DISPLAY '** SQLCODE   = ' SQLCODE2                   00075910
000736             DISPLAY '******************************************' 00076010
000737             PERFORM 9100-SQL-ABEND                               00076110
000738       END-EVALUATE.                                              00076210
000740                                                                  00076410
000752* ------------------------------------------------------------- * 00077610
000753* WRITE THE ERROR MESSAGE QUEUE TO A SEQUENTIAL FILE.             00077710
000754* ------------------------------------------------------------- * 00077810
000755 8000-WRITE-EXTRACT-RECORD.                                       00077910
000756* ------------------------------------------------------------- * 00078010
000757*                                                                 00078110
000758     INITIALIZE ERR-EXTRACT-RECORD.                               00078410
000760     WRITE ERR-EXTRACT-RECORD FROM MSGBUFFER_SMALL.               00079255
000761     ADD +1 TO NUMPUTS.                                           00079510
000763* ------------------------------------------------------------- * 00079810
000764* DISPLAY THE VALUES OF A FAILED MQ API COMMAND                   00079910
000765* ------------------------------------------------------------- * 00080010
000766 9000-DISPLAY-ERROR-MESSAGE.                                      00080110
000769     DISPLAY '************************************************'.  00080210
000770     DISPLAY '* ', ERROR-MESSAGE.                                 00080310
000771     DISPLAY '* COMPLETION CODE : ', COMPLETION-CODE.             00080410
000772     DISPLAY '* REASON CODE     : ', REASON.                      00080510
000773     DISPLAY '************************************************'.  00080610
000774*                                                                 00080710
000777******************************************************************00080810
000778* 9100-SQL-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      00080910
000779* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 00081010
000780******************************************************************00081110
000781 9100-SQL-ABEND.                                                  00081210
000782                                                                  00081310
000783* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    00081410
000784* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         00081510
000785* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     00081610
000786* FORMAT                                                          00081710
000787     COPY DPPD004.                                                00081810
000788                                                                  00081910
000789     MOVE +4013 TO ABEND-CODE.                                    00082010
000790     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         00082110
000791                                                                  00082210
000792****************************************************************  00082310
000793** PERFORM MQ-SERIES ABEND PROCESSING                             00082410
000794****************************************************************  00082510
000795 9200-MQ-ABEND.                                                   00082610
000796                                                                  00082710
000797     DISPLAY '**** ABEND *************************************'.  00082810
000798     DISPLAY '** MQSERIES ERROR **'.                              00082910
000799     DISPLAY '** PROGRAM:    ', PC-CURRENT-PROGRAM-NAME.          00083010
000800     DISPLAY '** ABEND CODE: ', PV-ABEND-CODE.                    00083110
000801     DISPLAY '** PARAGRAPH:  ', PV-PARAGRAPH.                     00083210
000802     DISPLAY '** MESSAGE:    ', ERROR-MESSAGE.                    00083310
000803     DISPLAY '** COMP CODE:  ', PE-MQ-COMPLETION-CODE.            00083410
000804     DISPLAY '** RSN CODE:   ', PE-MQ-REASON-CODE.                00083510
000805     DISPLAY '** RSN TEXT:   ', MQ-REASON-TEXT.                   00083610
000806                                                                  00083710
000807     MOVE +4013 TO PV-ABEND-CODE.                                 00083810
000808     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         00083910
000809                                                                  00084010
000810******************************************************************00084110
000811*                       END OF PROGRAM                            00084210
000900******************************************************************00085010
