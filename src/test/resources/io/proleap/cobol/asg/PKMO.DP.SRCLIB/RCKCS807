000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    RCKCS807.                                         00020000
000300 AUTHOR.        JOE LAROSA.                                       00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  09-29-99.                                         00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800*  E807 - PACK TO NON-PACK CONVERSION                             00080000
000900*                                                                 00090000
001000*  THIS IS A CALLED ROUTINE (FROM RECEIVER UPDATE ONLY)           00100000
001100*  WHICH WILL TRANSCRIPT PACKAGING TO 'BULK'.                     00110000
001200*                                                                 00120000
001300*  ASSUMPTIONS: TM500-FIELDS (TMWS500) PASSED FROM RCKCS221       00130000
001400*               FIELDS NEEDED = TM500-OPER-UNT-ID                 00140000
001500*                               TM500-FCLTY-ID                    00150000
001600*                               TM500-PO-NBR                      00160000
001700*                               TM500-REC-SEQ-NBR                 00170000
001800*                                                                 00180000
001900******************************************************************00190000
002000* 03/09/2010 TOM PRIMEAU  WR#38216                                00200000
002100*    HARDCODING CHANGES FOR RC                                    00210000
002200*    REMOVE VARIABLE '05 PC-OPER-UNT-CDE PIC S9(4)VALUE +870 COMP 00220000
002300*       VALUE +870 COMP'.                                         00230000
002400*    ADD '05  PRV-TM500-RETURN-MSG' FIELDS TO WORKING             00240000
002500*       STORAGE TO ACCOMMODATE CALL TO XLKUT071.                  00250000
002600*    ADD MORE PV-PROGRAM-VARIABLES TO WORKING-STORAGE TO          00260000
002700*        ACCOMMODATE CALL TO XLKUT071.                            00270000
002800*    ADD '05  PRV-2O    PIC X(42) VALUE                           00280000
002900*        '2ODB2-ERROR - XLT_LOC OR XLT_DC_LOC_ASGMT '.            00290000
003000*    ADD CALL TO NEW PARAGRAPH 2610-GET-DC AT THE BEGINNING       00300000
003100*        OF 2600-ADD-TRBNTF PARAGRAPH TO CALL XLKUT071.           00310000
003200*    CHANGE CONDITION TO CHECK THE E-BUSINESS INDICATOR           00320000
003300*        INSTEAD OF 'PC-OPER-UNT-CDE', AND CHECK FOR              00330000
003400*        'XL071-LOC-TYP-CDE='DC' IN PARAGRAPH 2600-ADD-TRBNTF.    00340000
003500*    ADD NEW PARAGRAPH 2610-GET-DC TO CALL XLKUT071, LOCATION     00350000
003600*        TABLE, USING OPER-ID AS KEY. CALLED BY PARAGRAPH 2600.   00360000
003700******************************************************************00370000
003800 ENVIRONMENT DIVISION.                                            00380000
003900                                                                  00390000
004000 CONFIGURATION SECTION.                                           00400000
004100 SOURCE-COMPUTER.        IBM-3090.                                00410000
004200 OBJECT-COMPUTER.        IBM-3090.                                00420000
004300                                                                  00430000
004400******************************************************************00440000
004500 DATA DIVISION.                                                   00450000
004600                                                                  00460000
004700 WORKING-STORAGE SECTION.                                         00470000
004800                                                                  00480000
004900 01  PS-PROGRAM-SWITCHES.                                         00490000
005000     05  PS-DONE-SW                   PIC  X    VALUE 'N'.        00500000
005100         88  PS-NOT-DONE                        VALUE 'N'.        00510000
005200         88  PS-DONE                            VALUE 'Y'.        00520000
005300* JAK 05/2007 - ADD SWITCHES                                      00530000
005400     05  PS-ASNS-TO-WMS-SW            PIC X(01) VALUE 'N'.        00540000
005500         88  PS-ASNS-TO-WMS-YES                 VALUE 'Y'.        00550000
005600         88  PS-ASNS-TO-WMS-NO                  VALUE 'N'.        00560000
005700     05  PS-DISTRO-TRBL-SW            PIC X(01) VALUE 'N'.        00570000
005800         88  PS-DISTRO-TRBL-YES                 VALUE 'Y'.        00580000
005900         88  PS-DISTRO-TRBL-NO                  VALUE 'N'.        00590000
006000* JAK 05/2007 - END                                               00600000
006100                                                                  00610000
006200 01  PC-PROGRAM-CONSTANTS.                                        00620000
006300     05  PC-N                         PIC X(01) VALUE 'N'.        00630000
006400     05  PC-Y                         PIC X(01) VALUE 'Y'.        00640000
006500     05  PC-A                         PIC X(01) VALUE 'A'.        00650000
006600     05  PC-I                         PIC X(01) VALUE 'I'.        00660000
006700     05  PC-TRBL-RSN-CDE              PIC S9(4) VALUE +110 COMP.  00670000
006800     05  PC-600                       PIC S9(4) VALUE +600        00680000
006900                                                COMP.             00690000
007000     05  PC-300                       PIC S9(4) VALUE +300        00700000
007100                                                COMP SYNC.        00710000
007200     05  PC-MAX-RETRIES               PIC S9(4) VALUE +3          00720000
007300                                                COMP SYNC.        00730000
007400     05  PC-NULL-TMST                 PIC X(26) VALUE             00740000
007500                                    '0001-01-01-00.00.00.000000'. 00750000
007600                                                                  00760000
007700     05  PC-CURR-PGM-NAME             PIC X(08) VALUE 'RCKCS807'. 00770000
007800     05  PC-RCKCS232                  PIC X(08) VALUE 'RCKCS232'. 00780000
007900     05  PC-RCKCS290                  PIC X(08) VALUE 'RCKCS290'. 00790000
008000     05  PC-TMKCS520                  PIC X(08) VALUE 'TMKCS520'. 00800000
008100     05  PC-TMKCS521                  PIC X(08) VALUE 'TMKCS521'. 00810000
008200* JAK 05/2007 - ADD PROGRAM CONSTANTS                             00820000
008300     05  PC-WMS-CONTROL-MOD           PIC X(8)  VALUE  'WSKCS305'.00830000
008400* JAK 05/2007 - END                                               00840000
008500                                                                  00850000
008600 01  PV-PROGRAM-VARIABLES.                                        00860000
008700     05  PV-SAVED-PREPK-ID            PIC S9(4) VALUE ZERO COMP.  00870000
008800     05  PV-RETRY-COUNTER             PIC S9(4) VALUE ZERO        00880000
008900                                                COMP SYNC.        00890000
009000     05  PV-CICS-RESPONSE             PIC S9(09) VALUE ZEROS      00900000
009100                                                COMP SYNC.        00910000
009200     05  PV-USERID                    PIC  X(8) VALUE SPACES.     00920000
009300                                                                  00930000
009400     05  PV-PO-NBR-PIC9               PIC S9(11) VALUE +0.        00940000
009500     05  PV-REC-SEQ-NBR-PIC9          PIC S9(11) VALUE +0.        00950000
009600     05  PV-PO-LNE-NBR-PIC9           PIC S9(11) VALUE +0.        00960000
009700* JAK 05/2007 - ADD PROGRAM VARIABLES                             00970000
009800     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     00980000
009900                                                     COMP SYNC.   00990000
010000     05  PV-SQL-CNT                     PIC S9(04)   VALUE +0     01000000
010100                                                    COMP.         01010000
010200* JAK 05/2007 - END                                               01020000
010300     05  PV-OP.                                                   01030000
010400         10  PV-OP-N                  PIC 9(4).                   01040000
010500     05  PV-FCLTY.                                                01050000
010600         10  PV-FCLTY-N               PIC 9.                      01060000
010700     05  PV-PO.                                                   01070000
010800         10  PV-PO-N                  PIC 9(8).                   01080000
010900     05  PV-LINE.                                                 01090000
011000         10  PV-LINE-N                PIC 999.                    01100000
011100     05  PV-REC-SEQ-NBR.                                          01110000
011200         10  PV-REC-SEQ-NBR-N         PIC 999.                    01120000
011300*                                                                 01130000
011400 01  PRV-PROGRAM-RETURN-VARIABLES.                                01140000
011500     05  PRV-00                       PIC X(42) VALUE             01150000
011600         '00PROGRAM CALL WAS SUCCESSFUL             '.            01160000
011700     05  PRV-2O                       PIC X(42) VALUE             01170000
011800         '2ODB2-ERROR - XLT_LOC OR XLT_DC_LOC_ASGMT '.            01180000
011900     05  PRV-70                       PIC X(42) VALUE             01190000
012000         '70DB2-ERROR - RECITM-LINE-CSR OPEN        '.            01200000
012100     05  PRV-71                       PIC X(42) VALUE             01210000
012200         '71DB2-ERROR - RECITM-LINE-CSR FETCH       '.            01220000
012300     05  PRV-72                       PIC X(42) VALUE             01230000
012400         '72DB2-ERROR - RECITM-LINE-CSR CLOSE       '.            01240000
012500     05  PRV-73                       PIC X(42) VALUE             01250000
012600         '73DB2-ERROR - RECITM-LINE-CSR UPDATE      '.            01260000
012700     05  PRV-74                       PIC X(42) VALUE             01270000
012800         '74UNSUCCESSFUL CALL TO AUDIT ROUTINE      '.            01280000
012900     05  PRV-75                       PIC X(42) VALUE             01290000
013000         '75UNSUCCESSFUL DELETE ON TRECDIS          '.            01300000
013100     05  PRV-76                       PIC X(42) VALUE             01310000
013200         '76UNSUCCESSFUL PACK DELETE ON TTRBNTF     '.            01320000
013300     05  PRV-76A                      PIC X(42) VALUE             01330000
013400         '76UNSUCCESSFUL LINE DELETE ON TTRBNTF     '.            01340000
013500     05  PRV-77                       PIC X(42) VALUE             01350000
013600         '77UNSUCCESSFUL CALL TO TROUBLE ROUTINE    '.            01360000
013700     05  PRV-78                       PIC X(42) VALUE             01370000
013800         '78DB2-ERROR - PURITM SELECT NOT FOUND     '.            01380000
013900     05  PRV-79                       PIC X(42) VALUE             01390000
014000         '79DB2-ERROR - RECITM LAST TRSCP UPDATE    '.            01400000
014100     05  PRV-TM500-RETURN-MSG.                                    01410000
014200       10  PRV-PGM                  PIC X(3).                     01420000
014300       10  FILLER                   PIC X(1).                     01430000
014400       10  PRV-PARA                 PIC X(4).                     01440000
014500       10  FILLER                   PIC X(1).                     01450000
014600       10  PRV-TBL                  PIC X(7).                     01460000
014700       10  FILLER                   PIC X(1).                     01470000
014800       10  PRV-OP                   PIC X(4).                     01480000
014900       10  FILLER                   PIC X(1).                     01490000
015000       10  PRV-FCLTY                PIC X(1).                     01500000
015100       10  FILLER                   PIC X(1).                     01510000
015200       10  PRV-PO                   PIC X(8).                     01520000
015300       10  FILLER                   PIC X(1).                     01530000
015400       10  PRV-LINE                 PIC X(3).                     01540000
015500       10  FILLER                   PIC X(1).                     01550000
015600       10  PRV-REC-SEQ-NBR          PIC X(3).                     01560000
015700       10  FILLER                   PIC X(1).                     01570000
015800                                                                  01580000
015900******************************************************************01590000
016000     COPY TMWS500.                                                01600000
016100/                                                                 01610000
016200     COPY RCWS031.                                                01620000
016300/                                                                 01630000
016400* JAK 05/2007 - ADD COPYBOOK FOR SHIPPING CONTROL MODULE          01640000
016500     COPY WSWS001.                                                01650000
016600/                                                                 01660000
016700******************************************************************01670000
016800* LOCATION MASTER INFORMATION - CALLED MODULE PARAMETERS          01680000
016900******************************************************************01690000
017000     COPY XLWS071.                                                01700000
017100*                                                                 01710000
017200******************************************************************01720000
017300*    DB2 SQL COMMUNICATION AREA                                   01730000
017400******************************************************************01740000
017500     EXEC SQL                                                     01750000
017600          INCLUDE SQLCA                                           01760000
017700     END-EXEC.                                                    01770000
017800                                                                  01780000
017900******************************************************************01790000
018000*    DB2 DCLGEN FOR TROUBLE NOTIFY TABLE                          01800000
018100******************************************************************01810000
018200     EXEC SQL                                                     01820000
018300          INCLUDE TTRBNTF                                         01830000
018400     END-EXEC.                                                    01840000
018500                                                                  01850000
018600* JAK 05/2007 - ADD TABLES FOR WMS CODE                           01860000
018700******************************************************************01870000
018800*    DB2 DCLGEN FOR PARM TABLE                                    01880000
018900******************************************************************01890000
019000     EXEC SQL                                                     01900000
019100          INCLUDE TKRPRPM                                         01910000
019200     END-EXEC.                                                    01920000
019300                                                                  01930000
019400******************************************************************01940000
019500*    DB2 DCLGEN FOR SHIPMENT TABLE                                01950000
019600******************************************************************01960000
019700     EXEC SQL                                                     01970000
019800          INCLUDE TSHIPMT                                         01980000
019900     END-EXEC.                                                    01990000
020000                                                                  02000000
020100******************************************************************02010000
020200*    DB2 DCLGEN FOR SHIPMENT PO TABLE                             02020000
020300******************************************************************02030000
020400     EXEC SQL                                                     02040000
020500          INCLUDE TSHPTPO                                         02050000
020600     END-EXEC.                                                    02060000
020700                                                                  02070000
020800******************************************************************02080000
020900*    DB2 DCLGEN FOR RECEIVER TABLE                                02090000
021000******************************************************************02100000
021100     EXEC SQL                                                     02110000
021200          INCLUDE TRECEIV                                         02120000
021300     END-EXEC.                                                    02130000
021400                                                                  02140000
021500* JAK 05/2007 - END                                               02150000
021600******************************************************************02160000
021700*    DB2 DCLGEN FOR TROUBLE REASON TABLE                          02170000
021800******************************************************************02180000
021900     EXEC SQL                                                     02190000
022000          INCLUDE TTRBRSN                                         02200000
022100     END-EXEC.                                                    02210000
022200                                                                  02220000
022300******************************************************************02230000
022400*    DB2 DCLGEN FOR ITEM DISPOSITION TABLE                        02240000
022500******************************************************************02250000
022600     EXEC SQL                                                     02260000
022700          INCLUDE TRECDIS                                         02270000
022800     END-EXEC.                                                    02280000
022900                                                                  02290000
023000******************************************************************02300000
023100*    DB2 DCLGEN FOR RECEIVE ITEM TABLE                            02310000
023200******************************************************************02320000
023300     EXEC SQL                                                     02330000
023400          INCLUDE TRECITM                                         02340000
023500     END-EXEC.                                                    02350000
023600                                                                  02360000
023700******************************************************************02370000
023800*    DB2 DCLGEN FOR PURCHASE ITEM TABLE                           02380000
023900******************************************************************02390000
024000     EXEC SQL                                                     02400000
024100          INCLUDE TPURITM                                         02410000
024200     END-EXEC.                                                    02420000
024300                                                                  02430000
024400******************************************************************02440000
024500*    DB2 DCLGEN FOR ODD UNIT TABLE                                02450000
024600******************************************************************02460000
024700     EXEC SQL                                                     02470000
024800          INCLUDE RCT00009                                        02480000
024900     END-EXEC.                                                    02490000
025000                                                                  02500000
025100******************************************************************02510000
025200*    RECITM LINE CURSOR                                           02520000
025300******************************************************************02530000
025400     EXEC SQL                                                     02540000
025500       DECLARE RECITM-LINE-CSR CURSOR WITH HOLD FOR               02550000
025600        SELECT ORD_LNE_NBR                                        02560000
025700             , CASE_PACK_QTY                                      02570000
025800             , PREPK_ID                                           02580000
025900             , PREPK_RATO_QTY                                     02590000
026000             , PREPK_ODD_UNT_QTY                                  02600000
026100             , PREPK_DRV_LNE_CDE                                  02610000
026200             , PKSL_ITM_QTY                                       02620000
026300             , DTL_CK_ITM_QTY                                     02630000
026400          FROM TRECITM                                            02640000
026500         WHERE OPER_UNT_ID    = :TM500-OPER-UNT-ID                02650000
026600           AND FCLTY_ID       = :TM500-FCLTY-ID                   02660000
026700           AND ORD_NBR        = :TM500-PO-NBR                     02670000
026800           AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR                02680000
026900           AND VER_STATUS_CDE = :PC-A                             02690000
027000     END-EXEC.                                                    02700000
027100                                                                  02710000
027200******************************************************************02720000
027300******************************************************************02730000
027400 LINKAGE SECTION.                                                 02740000
027500                                                                  02750000
027600 01  DFHCOMMAREA.                                                 02760000
027700     05  FILLER                       OCCURS 1 TO 600  TIMES      02770000
027800                                      DEPENDING ON EIBCALEN.      02780000
027900         10  FILLER                   PIC X.                      02790000
028000                                                                  02800000
028100                                                                  02810000
028200/                                                                 02820000
028300 PROCEDURE DIVISION.                                              02830000
028400******************************************************************02840000
028500*  THIS PARAGRAPH DRIVES THE PROGRAM LOGIC.                       02850000
028600******************************************************************02860000
028700 0000-MAIN-MODULE.                                                02870000
028800                                                                  02880000
028900     PERFORM 1000-INITIAL-PROCESS.                                02890000
029000                                                                  02900000
029100     PERFORM 2000-MAIN-PROCESS                                    02910000
029200       UNTIL PS-DONE.                                             02920000
029300                                                                  02930000
029400     PERFORM 3200-CLOSE-RECITM-CSR.                               02940000
029500                                                                  02950000
029600*CREATE PO LEVEL BULK RECEIVER NOTIFY TROUBLE                     02960000
029700     PERFORM 2600-ADD-TRBNTF                                      02970000
029800                                                                  02980000
029900     MOVE TM500-FIELDS TO DFHCOMMAREA.                            02990000
030000                                                                  03000000
030100     GOBACK.                                                      03010000
030200                                                                  03020000
030300******************************************************************03030000
030400*  THIS PARAGRAPH SETS INITIAL VALUES FOR THE PROGRAM.            03040000
030500******************************************************************03050000
030600 1000-INITIAL-PROCESS.                                            03060000
030700                                                                  03070000
030800     EXEC CICS                                                    03080000
030900         ASSIGN USERID (PV-USERID)                                03090000
031000                RESP   (PV-CICS-RESPONSE)                         03100000
031100     END-EXEC.                                                    03110000
031200                                                                  03120000
031300     EVALUATE TRUE                                                03130000
031400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03140000
031500             CONTINUE                                             03150000
031600         WHEN OTHER                                               03160000
031700             MOVE PC-CURR-PGM-NAME TO PV-USERID                   03170000
031800     END-EVALUATE.                                                03180000
031900                                                                  03190000
032000     INITIALIZE TM500-FIELDS.                                     03200000
032100                                                                  03210000
032200     SET PS-NOT-DONE TO TRUE.                                     03220000
032300                                                                  03230000
032400     IF EIBCALEN = 0                                              03240000
032500         SET PS-DONE      TO TRUE                                 03250000
032600     ELSE                                                         03260000
032700         MOVE DFHCOMMAREA TO TM500-FIELDS                         03270000
032800         MOVE PRV-00      TO TM500-RETURN-DATA                    03280000
032900     END-IF.                                                      03290000
033000                                                                  03300000
033100     PERFORM 3000-OPEN-RECITM-CSR.                                03310000
033200                                                                  03320000
033300******************************************************************03330000
033400*  THIS PARAGRAPH PERFORMS THE MAIN LOGIC OF THE PROGRAM.         03340000
033500******************************************************************03350000
033600 2000-MAIN-PROCESS.                                               03360000
033700                                                                  03370000
033800     PERFORM 3100-FETCH-RECITM-CSR.                               03380000
033900                                                                  03390000
034000*CALL AUDIT PROGRAM.                                              03400000
034100     IF PS-NOT-DONE                                               03410000
034200         PERFORM 2100-AUDIT-RECITM                                03420000
034300     END-IF.                                                      03430000
034400                                                                  03440000
034500*INITIALIZE PREPACK VALUES.                                       03450000
034600     IF PS-NOT-DONE                                               03460000
034700         PERFORM 2200-UPDATE-RECITM                               03470000
034800     END-IF.                                                      03480000
034900                                                                  03490000
035000*REMOVE STORE DISTRIBUTIONS.                                      03500000
035100     IF PS-NOT-DONE                                               03510000
035200         PERFORM 2300-DELETE-RECDIS                               03520000
035300         PERFORM 2350-DELETE-ODD-UNIT                             03530000
035400     END-IF.                                                      03540000
035500                                                                  03550000
035600*REMOVE PACK TROUBLE.                                             03560000
035700     IF PS-NOT-DONE                                               03570000
035800         PERFORM 2400-DELETE-TRBNTF                               03580000
035900     END-IF.                                                      03590000
036000                                                                  03600000
036100*CALL ALLOCATION (MINI TRANSCRIPTION).                            03610000
036200     IF PS-NOT-DONE                                               03620000
036300         PERFORM 2500-CALL-TMKCS520                               03630000
036400     END-IF.                                                      03640000
036500                                                                  03650000
036600*JAK 05/2007 - ADD CODE FOR WMOS INTERFACE                        03660000
036700     IF TM500-CALL-SUCCESSFUL                                     03670000
036800     OR TM500-DUPLICATE-TROUBLE                                   03680000
036900     OR TM500-DIDNT-ALLOC-DUE-TO-TRBL                             03690000
037000     OR TM500-TTRBNTF-UPDATE-NOT-FND                              03700000
037100     OR TM500-PREPACK-ERROR                                       03710000
037200         PERFORM 4010-SELECT-TRECEIV                              03720000
037300         PERFORM 4000-CHECK-ASNDWN                                03730000
037400         IF PS-ASNS-TO-WMS-YES                                    03740000
037500            AND PS-NOT-DONE                                       03750000
037600             PERFORM 4020-CHECK-TRECDIS                           03760000
037700             IF PS-DISTRO-TRBL-NO                                 03770000
037800                 PERFORM 4030-GET-TRIP-ID                         03780000
037900                 IF PS-NOT-DONE                                   03790000
038000                     PERFORM 4040-CALL-WMS-MODULE                 03800000
038100                 END-IF                                           03810000
038200             END-IF                                               03820000
038300         END-IF                                                   03830000
038400     END-IF.                                                      03840000
038500*JAK 05/2007 - END                                                03850000
038600                                                                  03860000
038700                                                                  03870000
038800******************************************************************03880000
038900*  THIS PARAGRAPH CALLS THE 'AUDIT' ROUTINE.                      03890000
039000******************************************************************03900000
039100 2100-AUDIT-RECITM.                                               03910000
039200                                                                  03920000
039300*SET COMMAREA.                                                    03930000
039400     MOVE 'I'                TO RC031-TABLE-TO-AUDIT.             03940000
039500     MOVE 'B'                TO RC031-AUD-TYP-CDE.                03950000
039600     MOVE 'U'                TO RC031-AUD-FUNC-CDE.               03960000
039700     MOVE TM500-PO-NBR       TO RC031-PO-NBR.                     03970000
039800     MOVE RECITM-ORD-LNE-NBR TO RC031-PO-LNE-NBR.                 03980000
039900     MOVE TM500-REC-SEQ-NBR  TO RC031-REC-SEQ-NBR.                03990000
040000     MOVE TM500-OPER-UNT-ID  TO RC031-OPER-UNT-ID.                04000000
040100     MOVE TM500-FCLTY-ID     TO RC031-FCLTY-ID.                   04010000
040200     MOVE PC-CURR-PGM-NAME   TO RC031-UPD-PGM-ID.                 04020000
040300                                                                  04030000
040400     EXEC CICS                                                    04040000
040500         LINK PROGRAM  (PC-RCKCS290)                              04050000
040600              COMMAREA (RC031-FIELDS)                             04060000
040700              LENGTH   (PC-300)                                   04070000
040800     END-EXEC.                                                    04080000
040900                                                                  04090000
041000     EVALUATE TRUE                                                04100000
041100         WHEN RC031-CALL-SUCCESSFUL                               04110000
041200             CONTINUE                                             04120000
041300                                                                  04130000
041400         WHEN OTHER                                               04140000
041500             SET  PS-DONE       TO TRUE                           04150000
041600             MOVE RC031-SQLCA   TO TM500-SQLCA                    04160000
041700             MOVE RC031-SQLCODE TO TM500-SQLCODE                  04170000
041800             MOVE PRV-74        TO TM500-RETURN-DATA              04180000
041900     END-EVALUATE.                                                04190000
042000                                                                  04200000
042100******************************************************************04210000
042200*  THIS PARAGRAPH UPDATES THE RECITM RECORD.                      04220000
042300******************************************************************04230000
042400 2200-UPDATE-RECITM.                                              04240000
042500                                                                  04250000
042600*RESET FIELDS.                                                    04260000
042700     INITIALIZE RECITM-CASE-PACK-QTY                              04270000
042800                RECITM-PREPK-ID                                   04280000
042900                RECITM-PREPK-RATO-QTY                             04290000
043000                RECITM-PREPK-ODD-UNT-QTY                          04300000
043100                RECITM-PREPK-DRV-LNE-CDE.                         04310000
043200     MOVE PC-NULL-TMST TO RECITM-MKING-APRON-TMST.                04320000
043300                                                                  04330000
043400     PERFORM WITH TEST AFTER                                      04340000
043500       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       04350000
043600         UNTIL SQLCODE = +0                                       04360000
043700            OR PS-DONE                                            04370000
043800            OR PV-RETRY-COUNTER > PC-MAX-RETRIES                  04380000
043900                                                                  04390000
044000         EXEC SQL                                                 04400000
044100           UPDATE TRECITM                                         04410000
044200              SET CASE_PACK_QTY     = :RECITM-CASE-PACK-QTY       04420000
044300                , PREPK_ID          = :RECITM-PREPK-ID            04430000
044400                , PREPK_RATO_QTY    = :RECITM-PREPK-RATO-QTY      04440000
044500                , PREPK_ODD_UNT_QTY = :RECITM-PREPK-ODD-UNT-QTY   04450000
044600                , PREPK_DRV_LNE_CDE = :RECITM-PREPK-DRV-LNE-CDE   04460000
044700            WHERE ORD_NBR      = :TM500-PO-NBR                    04470000
044800              AND ORD_LNE_NBR  = :RECITM-ORD-LNE-NBR              04480000
044900              AND REC_SEQ_NBR  = :TM500-REC-SEQ-NBR               04490000
045000              AND OPER_UNT_ID  = :TM500-OPER-UNT-ID               04500000
045100              AND FCLTY_ID     = :TM500-FCLTY-ID                  04510000
045200         END-EXEC                                                 04520000
045300                                                                  04530000
045400         EVALUATE TRUE                                            04540000
045500             WHEN SQLCODE = +0                                    04550000
045600                 CONTINUE                                         04560000
045700                                                                  04570000
045800             WHEN SQLCODE = -904                                  04580000
045900             WHEN SQLCODE = -911                                  04590000
046000             WHEN SQLCODE = -913                                  04600000
046100                 CONTINUE                                         04610000
046200                                                                  04620000
046300             WHEN OTHER                                           04630000
046400                 SET  PS-DONE TO TRUE                             04640000
046500                 MOVE SQLCA   TO TM500-SQLCA                      04650000
046600                 MOVE SQLCODE TO TM500-SQLCODE                    04660000
046700                 MOVE PRV-73  TO TM500-RETURN-DATA                04670000
046800                                                                  04680000
046900         END-EVALUATE                                             04690000
047000     END-PERFORM.                                                 04700000
047100                                                                  04710000
047200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         04720000
047300         SET  PS-DONE TO TRUE                                     04730000
047400         MOVE SQLCA   TO TM500-SQLCA                              04740000
047500         MOVE SQLCODE TO TM500-SQLCODE                            04750000
047600         MOVE PRV-73  TO TM500-RETURN-DATA                        04760000
047700     END-IF.                                                      04770000
047800                                                                  04780000
047900******************************************************************04790000
048000*  THIS PARAGRAPH DELETES THE RECDIS RECORDS UNDER A RECITM.      04800000
048100******************************************************************04810000
048200 2300-DELETE-RECDIS.                                              04820000
048300                                                                  04830000
048400     EXEC SQL                                                     04840000
048500         DELETE                                                   04850000
048600           FROM TRECDIS                                           04860000
048700          WHERE ORD_NBR        = :TM500-PO-NBR                    04870000
048800            AND ORD_LNE_NBR    = :RECITM-ORD-LNE-NBR              04880000
048900            AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR               04890000
049000            AND OPER_UNT_ID    = :TM500-OPER-UNT-ID               04900000
049100            AND FCLTY_ID       = :TM500-FCLTY-ID                  04910000
049300     END-EXEC.                                                    04930000
049400                                                                  04940000
049500     EVALUATE TRUE                                                04950000
049600         WHEN SQLCODE = ZERO                                      04960000
049700         WHEN SQLCODE = +100                                      04970000
049800             CONTINUE                                             04980000
049900                                                                  04990000
050000         WHEN SQLCODE = -904                                      05000000
050100         WHEN SQLCODE = -911                                      05010000
050200         WHEN SQLCODE = -913                                      05020000
050300             CONTINUE                                             05030000
050400                                                                  05040000
050500         WHEN SQLWARN0 NOT = SPACES                               05050000
050600         WHEN SQLCODE  NOT = ZERO                                 05060000
050700             SET  PS-DONE TO TRUE                                 05070000
050800             MOVE SQLCA   TO TM500-SQLCA                          05080000
050900             MOVE SQLCODE TO TM500-SQLCODE                        05090000
051000             MOVE PRV-75  TO TM500-RETURN-DATA                    05100000
051100     END-EVALUATE.                                                05110000
051200                                                                  05120000
051300 2350-DELETE-ODD-UNIT.                                            05130000
051400                                                                  05140000
051500     EXEC SQL                                                     05150000
051600          DELETE                                                  05160000
051700            FROM RCT_VRFD_ODD_UNT                                 05170000
051800            WHERE PO_NBR         = :TM500-PO-NBR                  05180000
051900              AND PO_LNE_NBR     = :RECITM-ORD-LNE-NBR            05190000
052000              AND RCVR_SEQ_NBR   = :TM500-REC-SEQ-NBR             05200000
052100     END-EXEC.                                                    05210000
052200                                                                  05220000
052300     EVALUATE TRUE                                                05230000
052400         WHEN SQLCODE = ZERO                                      05240000
052500         WHEN SQLCODE = +100                                      05250000
052600              CONTINUE                                            05260000
052700         WHEN SQLCODE = -904                                      05270000
052800         WHEN SQLCODE = -911                                      05280000
052900         WHEN SQLCODE = -913                                      05290000
053000              CONTINUE                                            05300000
053100                                                                  05310000
053200         WHEN SQLWARN0 NOT = SPACES                               05320000
053300         WHEN SQLCODE  NOT = ZERO                                 05330000
053400              MOVE SQLCA   TO TM500-SQLCA                         05340000
053500              MOVE SQLCODE TO TM500-SQLCODE                       05350000
053600              MOVE PRV-75  TO TM500-RETURN-DATA                   05360000
053700     END-EVALUATE.                                                05370000
053800                                                                  05380000
053900                                                                  05390000
054000******************************************************************05400000
054100*  THIS PARAGRAPH DELETES THE TROUBLE RECORDS.                    05410000
054200******************************************************************05420000
054300 2400-DELETE-TRBNTF.                                              05430000
054400                                                                  05440000
054500* * *  FIRST, DELETE PACK TROUBLE                                 05450000
054600     EXEC SQL                                                     05460000
054700         DELETE                                                   05470000
054800           FROM TTRBNTF                                           05480000
054900          WHERE PO_NBR       = :TM500-PO-NBR                      05490000
055000            AND PREPK_ID     = :PV-SAVED-PREPK-ID                 05500000
055100            AND REC_SEQ_NBR  = :TM500-REC-SEQ-NBR                 05510000
055200            AND TRBL_RSN_CDE IN                                   05520000
055300                (SELECT A.TRBL_RSN_CDE                            05530000
055400                   FROM TTRBRSN A                                 05540000
055500                  WHERE TRBL_LVL_IND = 'M')                       05550000
055600     END-EXEC.                                                    05560000
055700                                                                  05570000
055800     EVALUATE TRUE                                                05580000
055900         WHEN SQLCODE = +0                                        05590000
056000         WHEN SQLCODE = +100                                      05600000
056100             CONTINUE                                             05610000
056200                                                                  05620000
056300         WHEN SQLCODE = -904                                      05630000
056400         WHEN SQLCODE = -911                                      05640000
056500         WHEN SQLCODE = -913                                      05650000
056600             CONTINUE                                             05660000
056700                                                                  05670000
056800         WHEN SQLWARN0 NOT = SPACES                               05680000
056900         WHEN SQLCODE < +0                                        05690000
057000         WHEN SQLCODE > +0                                        05700000
057100             SET  PS-DONE TO TRUE                                 05710000
057200             MOVE SQLCA   TO TM500-SQLCA                          05720000
057300             MOVE SQLCODE TO TM500-SQLCODE                        05730000
057400             MOVE PRV-76  TO TM500-RETURN-DATA                    05740000
057500     END-EVALUATE.                                                05750000
057600                                                                  05760000
057700* * *  NEXT, DELETE THE ASSOCIATED LINE TROUBLE                   05770000
057800     IF PS-NOT-DONE                                               05780000
057900         PERFORM 2410-DEL-TRBNTF-LINE-LVL.                        05790000
058000                                                                  05800000
058100 2410-DEL-TRBNTF-LINE-LVL.                                        05810000
058200                                                                  05820000
058300     EXEC SQL                                                     05830000
058400         DELETE                                                   05840000
058500           FROM TTRBNTF                                           05850000
058600          WHERE PO_NBR       = :TM500-PO-NBR                      05860000
058700            AND PO_LNE_NBR   = :RECITM-ORD-LNE-NBR                05870000
058800            AND REC_SEQ_NBR  = :TM500-REC-SEQ-NBR                 05880000
058900            AND PREPK_ID     = 0                                  05890000
059000            AND TRBL_RSN_CDE IN                                   05900000
059100                (SELECT A.TRBL_RSN_CDE                            05910000
059200                   FROM TTRBRSN A                                 05920000
059300                  WHERE TRBL_LVL_IND = 'X')                       05930000
059400     END-EXEC.                                                    05940000
059500                                                                  05950000
059600     EVALUATE TRUE                                                05960000
059700         WHEN SQLCODE = +0                                        05970000
059800         WHEN SQLCODE = +100                                      05980000
059900             CONTINUE                                             05990000
060000                                                                  06000000
060100*        WHEN SQLCODE = -904                                      06010000
060200*        WHEN SQLCODE = -911                                      06020000
060300*        WHEN SQLCODE = -913                                      06030000
060400*            CONTINUE                                             06040000
060500                                                                  06050000
060600         WHEN SQLWARN0 NOT = SPACES                               06060000
060700         WHEN SQLCODE < +0                                        06070000
060800         WHEN SQLCODE > +0                                        06080000
060900             SET  PS-DONE TO TRUE                                 06090000
061000             MOVE SQLCA   TO TM500-SQLCA                          06100000
061100             MOVE SQLCODE TO TM500-SQLCODE                        06110000
061200             MOVE PRV-76A TO TM500-RETURN-DATA                    06120000
061300     END-EVALUATE.                                                06130000
061400                                                                  06140000
061500******************************************************************06150000
061600*  THIS PARAGRAPH CALLS THE 'TRANSCRIPTION' ROUTINE.              06160000
061700******************************************************************06170000
061800 2500-CALL-TMKCS520.                                              06180000
061900                                                                  06190000
062000     SET  TM500-CREATE-AUTO         TO TRUE.                      06200000
062100     SET  TM500-LINE-LEVEL          TO TRUE.                      06210000
062200     SET  TM500-NO-DETAILS          TO TRUE.                      06220000
062300                                                                  06230000
062400     MOVE RECITM-ORD-LNE-NBR        TO TM500-PO-LNE-NBR.          06240000
062500                                                                  06250000
062600     IF RECITM-DTL-CK-ITM-QTY > +0                                06260000
062700         MOVE RECITM-DTL-CK-ITM-QTY TO TM500-UNITS-TO-ALLOC       06270000
062800     ELSE                                                         06280000
062900         MOVE RECITM-PKSL-ITM-QTY   TO TM500-UNITS-TO-ALLOC       06290000
063000     END-IF.                                                      06300000
063100                                                                  06310000
063200     MOVE PC-CURR-PGM-NAME          TO TM500-NOTIF-UID.           06320000
063300                                                                  06330000
063400     PERFORM 2510-GET-PURITM.                                     06340000
063500     IF PS-NOT-DONE                                               06350000
063600         MOVE PURITM-PIC-ITM-IND    TO TM500-AD-SW                06360000
063700                                                                  06370000
063800         EXEC CICS                                                06380000
063900             LINK PROGRAM  (PC-TMKCS520)                          06390000
064000                  COMMAREA (TM500-FIELDS)                         06400000
064100                  LENGTH   (PC-600)                               06410000
064200         END-EXEC                                                 06420000
064300                                                                  06430000
064400         EVALUATE TRUE                                            06440000
064500           WHEN TM500-CALL-SUCCESSFUL                             06450000
064600           WHEN TM500-DUPLICATE-TROUBLE                           06460000
064700           WHEN TM500-TTRBNTF-UPDATE-NOT-FND                      06470000
064800           WHEN TM500-INVALID-PRORATION                           06480000
064900               PERFORM 2520-RECITM-LAST-TRSCP                     06490000
065000           WHEN TM500-DIDNT-ALLOC-DUE-TO-TRBL                     06500000
065100               CONTINUE                                           06510000
065200           WHEN OTHER                                             06520000
065300               SET  PS-DONE TO TRUE                               06530000
065400               MOVE PRV-77  TO TM500-RETURN-DATA                  06540000
065500         END-EVALUATE                                             06550000
065600     END-IF.                                                      06560000
065700                                                                  06570000
065800******************************************************************06580000
065900 2510-GET-PURITM.                                                 06590000
066000                                                                  06600000
066100     INITIALIZE DCLTPURITM.                                       06610000
066200                                                                  06620000
066300     EXEC SQL                                                     06630000
066400         SELECT PIC_ITM_IND                                       06640000
066500           INTO :PURITM-PIC-ITM-IND                               06650000
066600           FROM TPURITM                                           06660000
066700          WHERE PO_NBR         = :TM500-PO-NBR                    06670000
066800            AND APP_PO_LNE_NBR = :RECITM-ORD-LNE-NBR              06680000
066900            AND VER_STATUS_CDE = :PC-A                            06690000
067000     END-EXEC.                                                    06700000
067100                                                                  06710000
067200     IF SQLCODE NOT = +0                                          06720000
067300         SET  PS-DONE TO TRUE                                     06730000
067400         MOVE SQLCA   TO TM500-SQLCA                              06740000
067500         MOVE SQLCODE TO TM500-SQLCODE                            06750000
067600         MOVE PRV-78  TO TM500-RETURN-DATA                        06760000
067700     END-IF.                                                      06770000
067800                                                                  06780000
067900******************************************************************06790000
068000*  THIS PARAGRAPH UPDATES RECITM LAST_TRSCP COLUMNS               06800000
068100******************************************************************06810000
068200 2520-RECITM-LAST-TRSCP.                                          06820000
068300                                                                  06830000
068400     PERFORM WITH TEST AFTER                                      06840000
068500       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       06850000
068600         UNTIL SQLCODE = +0                                       06860000
068700            OR PS-DONE                                            06870000
068800            OR PV-RETRY-COUNTER > PC-MAX-RETRIES                  06880000
068900                                                                  06890000
069000         EXEC SQL                                                 06900000
069100           UPDATE TRECITM                                         06910000
069200              SET LAST_TRSCP_TMST   = CURRENT TIMESTAMP           06920000
069300                , LAST_TRSCP_USR_ID = :PV-USERID                  06930000
069400            WHERE ORD_NBR      = :TM500-PO-NBR                    06940000
069500              AND ORD_LNE_NBR  = :RECITM-ORD-LNE-NBR              06950000
069600              AND REC_SEQ_NBR  = :TM500-REC-SEQ-NBR               06960000
069700              AND OPER_UNT_ID  = :TM500-OPER-UNT-ID               06970000
069800              AND FCLTY_ID     = :TM500-FCLTY-ID                  06980000
069900         END-EXEC                                                 06990000
070000                                                                  07000000
070100         EVALUATE TRUE                                            07010000
070200             WHEN SQLCODE = +0                                    07020000
070300                 CONTINUE                                         07030000
070400                                                                  07040000
070500             WHEN SQLCODE = -904                                  07050000
070600             WHEN SQLCODE = -911                                  07060000
070700             WHEN SQLCODE = -913                                  07070000
070800                 CONTINUE                                         07080000
070900                                                                  07090000
071000             WHEN OTHER                                           07100000
071100                 SET  PS-DONE TO TRUE                             07110000
071200                 MOVE SQLCA   TO TM500-SQLCA                      07120000
071300                 MOVE SQLCODE TO TM500-SQLCODE                    07130000
071400                 MOVE PRV-79  TO TM500-RETURN-DATA                07140000
071500                                                                  07150000
071600         END-EVALUATE                                             07160000
071700     END-PERFORM.                                                 07170000
071800                                                                  07180000
071900     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         07190000
072000         SET  PS-DONE TO TRUE                                     07200000
072100         MOVE SQLCA   TO TM500-SQLCA                              07210000
072200         MOVE SQLCODE TO TM500-SQLCODE                            07220000
072300         MOVE PRV-79  TO TM500-RETURN-DATA                        07230000
072400     END-IF.                                                      07240000
072500                                                                  07250000
072600******************************************************************07260000
072700*  THIS PARAGRAPH CALLS PROGRAM TMKCS521 WHICH INSERTS            07270000
072800*  TROUBLE RECORDS IN TABLE TTRBNTF.                              07280000
072900******************************************************************07290000
073000 2600-ADD-TRBNTF.                                                 07300000
073100                                                                  07310000
073200******************************************************************07320000
073300* BYPASS CREATING TROUBLE (110-PREPACK RCVD AS BULK)              07330000
073400* WHEN THE OPER UNIT ID IS (E-COMMERCE CENTER)                    07340000
073500******************************************************************07350000
073600     PERFORM 2610-GET-DC.                                         07360000
073700     IF XL071-E-BUS-IND = 'Y' AND                                 07370000
073800        XL071-LOC-TYP-CDE = 'DC'                                  07380000
073900         CONTINUE                                                 07390000
074000     ELSE                                                         07400000
074100         SET  TM500-ADD-DETAILS        TO TRUE                    07410000
074200         MOVE 'PREPACK ORDER HAS BEEN RECEIVED AS BULK'           07420000
074300                                   TO TM500-FREEFORM-TEXT         07430000
074400                                                                  07440000
074500         MOVE PC-TRBL-RSN-CDE      TO TM500-TRBL-RSN-CDE          07450000
074600                                                                  07460000
074700         MOVE +0                   TO TM500-PO-LNE-NBR            07470000
074800                                                                  07480000
074900         EXEC CICS                                                07490000
075000              LINK PROGRAM  (PC-TMKCS521)                         07500000
075100                  COMMAREA (TM500-FIELDS)                         07510000
075200                  LENGTH   (PC-600)                               07520000
075300         END-EXEC                                                 07530000
075400                                                                  07540000
075500         EVALUATE TRUE                                            07550000
075600             WHEN TM500-CALL-SUCCESSFUL                           07560000
075700             WHEN TM500-DUPLICATE-TROUBLE                         07570000
075800             WHEN TM500-TTRBNTF-UPDATE-NOT-FND                    07580000
075900             WHEN TM500-TPURCHS-SELECT-NOT-FND                    07590000
076000*???         WHEN TM500-DIDNT-ALLOC-DUE-TO-TRBL                   07600000
076100                 CONTINUE                                         07610000
076200                                                                  07620000
076300             WHEN OTHER                                           07630000
076400                 SET PS-DONE TO TRUE                              07640000
076500         END-EVALUATE                                             07650000
076600     END-IF.                                                      07660000
076700                                                                  07670000
076800     SET  TM500-NO-DETAILS      TO TRUE.                          07680000
076900                                                                  07690000
077000                                                                  07700000
077100 2610-GET-DC.                                                     07710000
077200     INITIALIZE XL071-COMMAREA-REC                                07720000
077300     MOVE TM500-OPER-UNT-ID TO XL071-LOCATION-NUMBER              07730000
077400     CALL XL071-LOCATION-MODULE USING DFHEIBLK                    07740000
077500                                      XL071-COMMAREA              07750000
077600                                      XL071-COMMAREA-REC          07760000
077700     EVALUATE TRUE                                                07770000
077800         WHEN XL071-DC-ASGMT-NOT-FND                              07780000
077900             SET PS-DONE    TO TRUE                               07790000
078000         WHEN OTHER                                               07800000
078100             SET PS-DONE    TO TRUE                               07810000
078200             MOVE XL071-SQLCA                                     07820000
078300                           TO TM500-SQLCA                         07830000
078400             MOVE XL071-SQLCODE                                   07840000
078500                            TO TM500-SQLCODE                      07850000
078600             MOVE PRV-2O    TO TM500-RETURN-DATA                  07860000
078700             MOVE SPACES    TO PRV-TM500-RETURN-MSG               07870000
078800             MOVE '2610'    TO PRV-PARA                           07880000
078900             MOVE XL071-DB2-TABLE                                 07890000
079000                                TO PRV-TBL                        07900000
079100             PERFORM 9999-RETURN-MSG                              07910000
079200     END-EVALUATE.                                                07920000
079300******************************************************************07930000
079400*  THIS PARAGRAPH OPENS THE CURSOR FOR TABLE RECITM.              07940000
079500******************************************************************07950000
079600 3000-OPEN-RECITM-CSR.                                            07960000
079700                                                                  07970000
079800     EXEC SQL                                                     07980000
079900         OPEN RECITM-LINE-CSR                                     07990000
080000     END-EXEC.                                                    08000000
080100                                                                  08010000
080200     IF SQLCODE NOT = +0                                          08020000
080300         SET  PS-DONE TO TRUE                                     08030000
080400         MOVE SQLCA   TO TM500-SQLCA                              08040000
080500         MOVE SQLCODE TO TM500-SQLCODE                            08050000
080600         MOVE PRV-70  TO TM500-RETURN-DATA                        08060000
080700     END-IF.                                                      08070000
080800                                                                  08080000
080900******************************************************************08090000
081000*  THIS PARAGRAPH GETS THE NEXT RECORD FROM TABLE RECITM.         08100000
081100******************************************************************08110000
081200 3100-FETCH-RECITM-CSR.                                           08120000
081300                                                                  08130000
081400     EXEC SQL                                                     08140000
081500          FETCH RECITM-LINE-CSR                                   08150000
081600           INTO :RECITM-ORD-LNE-NBR                               08160000
081700              , :RECITM-CASE-PACK-QTY                             08170000
081800              , :RECITM-PREPK-ID                                  08180000
081900              , :RECITM-PREPK-RATO-QTY                            08190000
082000              , :RECITM-PREPK-ODD-UNT-QTY                         08200000
082100              , :RECITM-PREPK-DRV-LNE-CDE                         08210000
082200              , :RECITM-PKSL-ITM-QTY                              08220000
082300              , :RECITM-DTL-CK-ITM-QTY                            08230000
082400     END-EXEC.                                                    08240000
082500                                                                  08250000
082600     EVALUATE TRUE                                                08260000
082700         WHEN SQLCODE = +0                                        08270000
082800             MOVE RECITM-PREPK-ID TO PV-SAVED-PREPK-ID            08280000
082900                                                                  08290000
083000         WHEN SQLCODE = +100                                      08300000
083100             SET  PS-DONE TO TRUE                                 08310000
083200                                                                  08320000
083300         WHEN OTHER                                               08330000
083400             SET  PS-DONE TO TRUE                                 08340000
083500             MOVE SQLCA   TO TM500-SQLCA                          08350000
083600             MOVE SQLCODE TO TM500-SQLCODE                        08360000
083700             MOVE PRV-71  TO TM500-RETURN-DATA                    08370000
083800     END-EVALUATE.                                                08380000
083900                                                                  08390000
084000******************************************************************08400000
084100*  THIS PARAGRAPH CLOSES THE CURSOR FOR TABLE RECITM.             08410000
084200******************************************************************08420000
084300 3200-CLOSE-RECITM-CSR.                                           08430000
084400                                                                  08440000
084500     EXEC SQL                                                     08450000
084600         CLOSE RECITM-LINE-CSR                                    08460000
084700     END-EXEC.                                                    08470000
084800                                                                  08480000
084900     IF SQLCODE = +100                                            08490000
085000         CONTINUE                                                 08500000
085100     ELSE                                                         08510000
085200         IF SQLCODE NOT = +0                                      08520000
085300             SET  PS-DONE TO TRUE                                 08530000
085400             MOVE SQLCA   TO TM500-SQLCA                          08540000
085500             MOVE SQLCODE TO TM500-SQLCODE                        08550000
085600             MOVE PRV-72  TO TM500-RETURN-DATA                    08560000
085700         END-IF                                                   08570000
085800     END-IF.                                                      08580000
085900                                                                  08590000
086000* JAK 05/2007 - ADD CODE TO CALL SHIPMENT CONTROL MODULE          08600000
086100******************************************************************08610000
086200*  THIS PARAGRAPH CHECKS TO SEE IF THE DC IS DOWNLOADING TO WMS   08620000
086300*  THIS USES THE CURRENT OPER ID FROM TRECEIV, NOT THE ORIG ONE   08630000
086400******************************************************************08640000
086500 4000-CHECK-ASNDWN.                                               08650000
086600                                                                  08660000
086700     MOVE RECEIV-CURR-OPER-UNT-ID TO KRPRPM-LOC-ID.               08670000
086800                                                                  08680000
086900     EXEC SQL                                                     08690000
087000          SELECT   FUNC_TXT                                       08700000
087100            INTO  :KRPRPM-FUNC-TXT                                08710000
087200            FROM                                                  08720000
087300                  TKRPRPM                                         08730000
087400            WHERE                                                 08740000
087500                  LOC_ID            = :KRPRPM-LOC-ID              08750000
087600              AND SYS_PRC_FUNC_CDE  = 'ASNDWN'                    08760000
087700              AND FUNC_PRC_STAT_CDE = 'AC'                        08770000
087800              AND INTFC_SYS_CDE     = 'KHL'                       08780000
087900              AND FUNC_TXT          = 'Y'                         08790000
088000              AND FUNC_BEG_TMST    < CURRENT TIMESTAMP            08800000
088100     END-EXEC.                                                    08810000
088200                                                                  08820000
088300     EVALUATE TRUE                                                08830000
088400         WHEN SQLCODE = ZERO                                      08840000
088500              SET PS-ASNS-TO-WMS-YES    TO TRUE                   08850000
088600         WHEN SQLCODE = +100                                      08860000
088700              SET PS-ASNS-TO-WMS-NO     TO TRUE                   08870000
088800         WHEN SQLWARN0 NOT = SPACES                               08880000
088900         WHEN SQLCODE  NOT = ZERO                                 08890000
089000             SET  PS-DONE TO TRUE                                 08900000
089100             MOVE SQLCA   TO TM500-SQLCA                          08910000
089200             MOVE SQLCODE TO TM500-SQLCODE                        08920000
089300             MOVE PRV-75  TO TM500-RETURN-DATA                    08930000
089400     END-EVALUATE.                                                08940000
089500                                                                  08950000
089600******************************************************************08960000
089700*  THIS PARAGRAPH GETS THE CURRENT OPER UNIT ID                   08970000
089800******************************************************************08980000
089900 4010-SELECT-TRECEIV.                                             08990000
090000                                                                  09000000
090100     MOVE TM500-PO-NBR       TO RECEIV-ORD-NBR.                   09010000
090200     MOVE TM500-REC-SEQ-NBR  TO RECEIV-REC-SEQ-NBR.               09020000
090300                                                                  09030000
090400     EXEC SQL                                                     09040000
090500          SELECT   CURR_OPER_UNT_ID                               09050000
090600            INTO  :RECEIV-CURR-OPER-UNT-ID                        09060000
090700            FROM                                                  09070000
090800                  TRECEIV                                         09080000
090900            WHERE                                                 09090000
091000                  ORD_NBR           = :RECEIV-ORD-NBR             09100000
091100              AND REC_SEQ_NBR       = :RECEIV-REC-SEQ-NBR         09110000
091200              AND VER_STATUS_CDE    = 'A'                         09120000
091300     END-EXEC.                                                    09130000
091400                                                                  09140000
091500     EVALUATE TRUE                                                09150000
091600         WHEN SQLCODE = ZERO                                      09160000
091700         WHEN SQLCODE = -811                                      09170000
091800              CONTINUE                                            09180000
091900         WHEN SQLCODE = +100                                      09190000
092000              MOVE ZERO              TO RECEIV-CURR-OPER-UNT-ID   09200000
092100         WHEN SQLWARN0 NOT = SPACES                               09210000
092200         WHEN SQLCODE  NOT = ZERO                                 09220000
092300             SET  PS-DONE TO TRUE                                 09230000
092400             MOVE SQLCA   TO TM500-SQLCA                          09240000
092500             MOVE SQLCODE TO TM500-SQLCODE                        09250000
092600             MOVE PRV-75  TO TM500-RETURN-DATA                    09260000
092700     END-EVALUATE.                                                09270000
092800                                                                  09280000
092900******************************************************************09290000
093000*  THIS PARAGRAPH CHECKS TO SEE IF THE TRECDIS ROWS EXIST.        09300000
093100******************************************************************09310000
093200 4020-CHECK-TRECDIS.                                              09320000
093300                                                                  09330000
093400     MOVE 0 TO PV-SQL-CNT.                                        09340000
093500                                                                  09350000
093600     EXEC SQL                                                     09360000
093700         SELECT COUNT(*)                                          09370000
093800           INTO :PV-SQL-CNT                                       09380000
093900           FROM TRECDIS                                           09390000
094000          WHERE ORD_NBR        = :TM500-PO-NBR                    09400000
094100            AND ORD_LNE_NBR    = :TM500-PO-LNE-NBR                09410000
094200            AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR               09420000
094300            AND OPER_UNT_ID    = :TM500-OPER-UNT-ID               09430000
094400            AND FCLTY_ID       = :TM500-FCLTY-ID                  09440000
094600     END-EXEC.                                                    09460000
094700                                                                  09470000
094800     EVALUATE TRUE                                                09480000
094900         WHEN SQLCODE = ZERO                                      09490000
095000             IF PV-SQL-CNT = 0                                    09500000
095100                 SET PS-DISTRO-TRBL-YES TO TRUE                   09510000
095200             ELSE                                                 09520000
095300                 SET PS-DISTRO-TRBL-NO  TO TRUE                   09530000
095400             END-IF                                               09540000
095500         WHEN SQLCODE = +100                                      09550000
095600                 SET PS-DISTRO-TRBL-YES TO TRUE                   09560000
095700                                                                  09570000
095800         WHEN SQLCODE = -904                                      09580000
095900         WHEN SQLCODE = -911                                      09590000
096000         WHEN SQLCODE = -913                                      09600000
096100             CONTINUE                                             09610000
096200                                                                  09620000
096300         WHEN SQLWARN0 NOT = SPACES                               09630000
096400         WHEN SQLCODE  NOT = ZERO                                 09640000
096500             SET  PS-DONE TO TRUE                                 09650000
096600             MOVE SQLCA   TO TM500-SQLCA                          09660000
096700             MOVE SQLCODE TO TM500-SQLCODE                        09670000
096800             MOVE PRV-75  TO TM500-RETURN-DATA                    09680000
096900     END-EVALUATE.                                                09690000
097000                                                                  09700000
097100******************************************************************09710000
097200*  THIS PARAGRAPH GETS THE TRIP-ID FROM THE PO/RCVR.              09720000
097300******************************************************************09730000
097400 4030-GET-TRIP-ID.                                                09740000
097500                                                                  09750000
097600     EXEC SQL                                                     09760000
097700         SELECT A.TRIP_ID                                         09770000
097800           INTO :SHIPMT-TRIP-ID                                   09780000
097900           FROM TSHIPMT   A                                       09790000
098000              , TSHPTPO   B                                       09800000
098100          WHERE B.PO_NBR         = :TM500-PO-NBR                  09810000
098200            AND B.REC_SEQ_NBR    = :TM500-REC-SEQ-NBR             09820000
098300            AND A.SHIPT_ID       = B.SHIPT_ID                     09830000
098400            AND B.PRIM_SHIPT_IND = 'Y'                            09840000
098500     END-EXEC.                                                    09850000
098600                                                                  09860000
098700     EVALUATE TRUE                                                09870000
098800         WHEN SQLCODE = ZERO                                      09880000
098900             CONTINUE                                             09890000
099000         WHEN SQLCODE = -904                                      09900000
099100         WHEN SQLCODE = -911                                      09910000
099200         WHEN SQLCODE = -913                                      09920000
099300             CONTINUE                                             09930000
099400                                                                  09940000
099500         WHEN SQLWARN0 NOT = SPACES                               09950000
099600         WHEN SQLCODE  NOT = ZERO                                 09960000
099700             SET  PS-DONE TO TRUE                                 09970000
099800             MOVE SQLCA   TO TM500-SQLCA                          09980000
099900             MOVE SQLCODE TO TM500-SQLCODE                        09990000
100000             MOVE PRV-75  TO TM500-RETURN-DATA                    10000000
100100     END-EVALUATE.                                                10010000
100200                                                                  10020000
100300*----------------------------------------------------------------*10030000
100400* LINK TO WMS VENDOR SHIPMENT CONTROL MODULE (WSKCS305) USING     10040000
100500*  COPYBOOK WSWS001.                                              10050000
100600*----------------------------------------------------------------*10060000
100700 4040-CALL-WMS-MODULE.                                            10070000
100800                                                                  10080000
100900*    IF TM500-CALL-SUCCESSFUL                                     10090000
101000*        SET WS001-INSERT           TO TRUE                       10100000
101100*    ELSE                                                         10110000
101200         SET WS001-PKSLIP-INACTIVE  TO TRUE                       10120000
101300*    END-IF.                                                      10130000
101400     MOVE SHIPMT-TRIP-ID            TO WS001-TRIP-ID.             10140000
101500     MOVE TM500-OPER-UNT-ID         TO WS001-OPER-UNT-ID.         10150000
101600     MOVE PV-USERID                 TO WS001-USER-ID.             10160000
101700     MOVE TM500-PO-NBR              TO WS001-PO-NBR.              10170000
101800     MOVE TM500-PO-LNE-NBR          TO WS001-PO-LNE-NBR.          10180000
101900     MOVE TM500-REC-SEQ-NBR         TO WS001-RCVR-NBR.            10190000
102000     MOVE TM500-PREPK-ID            TO WS001-PREPK-ID.            10200000
102100     MOVE ZEROS                     TO WS001-SKU-NBR.             10210000
102200     MOVE ZEROS                     TO WS001-KOHLS-SHIPT-ID.      10220000
102300     MOVE 'RC'                      TO WS001-SHIPMENT-SOURCE.     10230000
102400     MOVE SPACES                    TO WS001-DTL-ASN-LEVEL-IND.   10240000
102500     MOVE EIBTASKN                  TO WS001-SRC-TASK-NUMBER.     10250000
102600     MOVE PC-CURR-PGM-NAME          TO WS001-CALLING-PROGRAM-NAME.10260000
102700                                                                  10270000
102800     MOVE LENGTH OF WS001-FIELDS    TO PV-COMMAREA-LENGTH.        10280000
102900                                                                  10290000
103000     EXEC CICS                                                    10300000
103100         LINK PROGRAM  (PC-WMS-CONTROL-MOD)                       10310000
103200              COMMAREA (WS001-FIELDS)                             10320000
103300              LENGTH   (PV-COMMAREA-LENGTH)                       10330000
103400     END-EXEC.                                                    10340000
103500                                                                  10350000
103600     EVALUATE TRUE                                                10360000
103700         WHEN WS001-SUCCESSFUL                                    10370000
103800              CONTINUE                                            10380000
103900                                                                  10390000
104000         WHEN OTHER                                               10400000
104100             SET  PS-DONE TO TRUE                                 10410000
104200             MOVE SQLCA   TO TM500-SQLCA                          10420000
104300             MOVE SQLCODE TO TM500-SQLCODE                        10430000
104400             MOVE PRV-75  TO TM500-RETURN-DATA                    10440000
104500                                                                  10450000
104600     END-EVALUATE.                                                10460000
104700                                                                  10470000
104800* JAK 05/2007 - END                                               10480000
104900******************************************************************10490000
105000******************************************************************10500000
105100 9999-RETURN-MSG.                                                 10510000
105200***********************************************************       10520000
105300                                                                  10530000
105400     COMPUTE PV-OP-N = TM500-OPER-UNT-ID * 1.                     10540000
105500     COMPUTE PV-FCLTY-N = TM500-FCLTY-ID * 1.                     10550000
105600     COMPUTE PV-PO-N = TM500-PO-NBR      * 1.                     10560000
105700     COMPUTE PV-LINE-N = TM500-PO-LNE-NBR * 1.                    10570000
105800     COMPUTE PV-REC-SEQ-NBR-N = TM500-REC-SEQ-NBR * 1.            10580000
105900                                                                  10590000
106000     MOVE '807'                 TO PRV-PGM.                       10600000
106100     MOVE PV-OP                 TO PRV-OP.                        10610000
106200     MOVE PV-FCLTY              TO PRV-FCLTY.                     10620000
106300     MOVE PV-PO                 TO PRV-PO.                        10630000
106400     MOVE PV-LINE               TO PRV-LINE.                      10640000
106500     MOVE PV-REC-SEQ-NBR        TO PRV-REC-SEQ-NBR.               10650000
106600                                                                  10660000
106700     MOVE PRV-TM500-RETURN-MSG  TO TM500-RETURN-MSG.              10670000
106800**************** BOTTOM OF DATA ***************************       10680000
