000100*------------------------*                                        00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*------------------------*                                        00030000
000400 PROGRAM-ID.     APKUT048.                                        00040000
000500 AUTHOR.         KEVIN CATLIN.                                    00050000
000600 DATE-WRITTEN.   DECEMBER, 2001.                                  00060000
000700*---------------------------------------------------------------* 00070000
000800*       CREATE EXTRACT OF FREIGHT AND OTHER INVOICE CHARGES     * 00080044
000900*---------------------------------------------------------------* 00090001
001000*    COBOL 2 WITH SQL                                           * 00100002
001100*---------------------------------------------------------------* 00110002
001200*                                                               * 00120002
001300*      THIS PROGRAM CREATES TWO EXTRACT FILES:  1) THE FREIGHT  * 00130002
001400*    EXTRACT FOR FREIGHT ASSIGNED TO AN INVOICE AND 2) THE      * 00140002
001500*    CHARGE EXTRACT FOR CHARGE AMOUNTS >= $500.00 ASSIGNED TO   * 00150030
001600*    AN INVOICE.  THE EXTRACTS ARE PRODUCED WEEKLY, RUN ON      * 00160030
001700*    SATURDAY FOR INVOICES SET UP AS "OPEN TO PAY" DURING THE   * 00170002
001800*    CURRENT WEEK.                                              * 00180002
001900*                                                               * 00190002
002000*---------------------------------------------------------------* 00200002
002100*                                                               * 00210002
002200* DB2 TABLES:                              DCLGENS:             * 00220002
002300*  1. AP-INVOICE TABLE                     (TINVOIC)            * 00230002
002400*  2. AP-MERCHANDISE INVOICE TABLE         (TMDINVC)            * 00240002
002500*  3. AP-ALLOWANCE/CHARGE TABLE            (TALCHRG)            * 00250002
002600*  4. AP-PAYMENT CONTROL TABLE             (TAPCNTL)            * 00260002
002700*  5. PO-PURCHASE TABLE                    (TPURCHS)            * 00270002
002800*  6. PO-PURCHASE ORDER ITEM TABLE         (TPURITM)            * 00280002
002900*  7. RC-RECEIVER TABLE                    (TRECEIV)            * 00290002
003000*  8. RC-RECEIVING DISTRIBUTION TABLE      (TRECDIS)            * 00300002
003100*  9. RC-RECEIVING ITEM TABLE              (TRECITM)            * 00310002
003200* 10. EXTERNAL ENTERPRISE TABLE            (TEXTENT)            * 00320002
003300* 11. EXTERNAL ENTERPRISE NAME TABLE       (TENTNME)            * 00330002
003400*                                                               * 00340002
003500* INPUT:                                                        * 00350002
003600*                                                               * 00360002
003700* OUTPUT:                                   COPYBOOK:           * 00370002
003800*  1. FREIGHT-EXTRACT-FILE                  APRD267             * 00380044
003900*  2. EXTRACT-OVER500-FILE                  APRD267             * 00390044
004000*                                                               * 00400002
004100*---------------------------------------------------------------* 00410002
004200* CHANGE LOG:                                                   * 00420002
004300*   01/08/2002                                                  * 00430002
004400*      INITIAL VERSION.                                         * 00440002
004500*   MADE BY:  KEVIN CATLIN               WR#: 21574             * 00450002
004600*                                                               * 00460002
004700*   06/17/2002                                                  * 00470002
004800*      ARK PO PROJECT PHASE 1.  RECOMPILE FROM PRODUCTION.      * 00480002
004900*   MADE BY: KEVIN CATLIN                WR#: 23500             * 00490002
005000*                                                               * 00500002
005100*   06/20/2002                                                  * 00510002
005200*      ARK PO PROJECT PHASE 1.  REMOVE ALL REFERENCES TO        * 00520002
005300*      TABLE TPAYREQ.                                           * 00530002
005400*   MADE BY: KEVIN CATLIN                WR#: 23500             * 00540002
005500*                                                               * 00550002
005600*   06/27/2002                                                  * 00560002
005700*      COMBINED PROGRAM APKUT265 INTO THIS PROGRAM.  PROGRAM    * 00570002
005800*      WILL NOW CREATE EXTRACTS FOR FREIGHT AND FREIGHT >= $500 * 00580002
005900*      ON AN INVOICE.  ADDED LOGIC TO PROCESS BOTH SITUATIONS   * 00590002
006000*      AND WRITE THEM OUT TO SEPARATE EXTRACT FILES.            * 00600002
006100*   MADE BY: KEVIN CATLIN                WR#: 22902             * 00610002
006200*                                                               * 00620002
006300* 09/09/02 ARK PO PROJECT PHASE 2. REMOVED REFERENCES TO        * 00630004
006400*          THE PAYMENT REQUEST NUMBER IN PARA C100 AND S300.    * 00640012
006500*          PAYMENT REQUEST NUMBER WILL NO LONGER BE USED AND    * 00650002
006600*          WAS REPLACED WITH PO NUMBER AND INVOICE ID IN BOTH   * 00660002
006700*          PARAGRAPHS.                                          * 00670002
006800*  MADE BY: BRIAN HASSLINGER             WR#: 23500             * 00680002
006900*                                                               * 00690007
007000*  10/25/02                                                     * 00700007
007100*     CORRECTED PROBLEM WHERE THE VENDOR RECORD WAS NOT CREATED * 00710007
007200*     FOR THE FREIGHT >= $500 FILE.  MODIFIED C100 AND C200     * 00720007
007300*     PARAGRAPHS.  ADDED D100 PARAGRAPH.                        * 00730007
007400*   MADE BY: KEVIN CATLIN               WR/IR #: PM00503267     * 00740008
007500*                                                               * 00750007
007600*  01/02/03                                                     * 00760043
007700*    CHANGED THE REPORT EXTRACT TO INCLUDE ALL CHARGE CODES     * 00770022
007800*    TOTALING $500 OR MORE ON AN INVOICE.  THIS WAS CHANGED     * 00780022
007900*    FROM JUST EXTRACTING FREIGHT CHARGES.  MAJOR MODIFICATIONS * 00790022
008000*    DONE TO PARAGRAPH C100.  CHANGED PARAGRAPHS C200, C600,    * 00800039
008100*    AND D100.  ADDED PARAGRAPHS C150, T200, X600, AND Y600.    * 00810022
008200*  MADE BY: KEVIN CATLIN               WR/IR #: WR23646         * 00820022
008300*                                                               * 00830022
008400* 02/06/2003                                                    * 00840044
008500*    CHANGE MADE: ARKPO PHASE3 PROJECT.                         * 00850044
008600*    UPDATED THE PGM TITLE TO MATCH THE SPEC TITLE.             * 00860044
008700*    UPDATED PGM COMMENT BLOCK WITH THE FILENAMES. CHANGED COPY * 00870044
008800*    BOOK NAME APRD267I TO APRD267. CHANGED THE AP267I- PREFIXES* 00880044
008900*    TO AP267-. CHANGED PURCHASE-ORDER FIELD NAME TO PO-NBR.    * 00890044
009000*    INCREASED THE FILE SIZE OF THE INPUT AND OUTPUT FILES TO   * 00900044
009100*    255 BYTES.                                                 * 00910044
009200* MADE BY:  MIKE BESKE                          WR#: 23500      * 00920044
009300*                                                               * 00930044
009400* 02/28/2005                                                    * 00940054
009500*    CHANGE MADE: ADDED LOGIC TO THE WHERE CLAUSE OF THE        * 00950054
009600*    CHARGE_CSR TO EXCLUDE ALLOWANCE CHARGE CODES               * 00960054
009700*    (ALW_CHRG_CDE) OF 'HGR' FROM BEING SELECTED.  ALSO ADDED   * 00970054
009800*    LOGIC TO THE PARAGRAPHS C150 AND C200 TO CREATE AN 'A'     * 00980054
009900*    RECORD FOR THOSE INVOICES WITH A CHARGE CODE OF '400' AND  * 00990054
010000*    AN AMOUNT GREATER THAN OR EQUAL TO $500.00.                * 01000054
010100* MADE BY: KRYSTEN LEARY                        WR#: 24656      * 01010054
010200*                                                               * 01020055
010300* 05/09/2005                                                    * 01030060
010400*    CHANGE MADE: E-COMM DIRECT TO CONSUMER PROJECT             * 01040055
010500*    SET CHRG-A-REC-NOT-WRIT TO TRUE IN PARAGRAPHS B100- AND    * 01050099
010600*    C200- SO THAT 'A' RECORDS WOULD BE PROPERLY WRITTEN.       * 01060099
010700*    ADDED THE FIELD HOLD_IND TO THE SELECT OF INVOICE_CSR.     * 01070060
010800*    ALSO ADDED LOGIC TO PARAGRAPH C150- TO WRITE THE INVOICE   * 01080060
010900*    TO THE OUTPUT FILE IF THE PV-TOT-CHRG-AMT IS GREATER THAN  * 01090060
011000*    OR EQUAL TO $500.00, OR THE CHARGE CODE IS EQUAL TO 'CDH'  * 01100060
011100*    AND THE INVOICE IS ON HOLD.  CREATED THE NEW WORKING       * 01110097
011200*    STORAGE FIELD PV-PREV-CHARGE-CODE AND INCLUDED IN          * 01120097
011300*    PARAGRAPH C150- LOGIC SO THAT 'A' RECORDS ARE WRITTEN FOR  * 01130097
011400*    THOSE RECORDS WITH A CHARGE TYPE CODE OF '400'.            * 01140097
011500* MADE BY: KRYSTEN LEARY                        WR#: 28461      * 01150060
011600*                                                               * 01160099
011700* 07/27/2005                                                    * 01170099
011800*    CHANGE MADE: E-COMM DIRECT TO CONSUMER PROJECT             * 01180099
011900*    REMOVED 'DISPLAY' STATEMENTS FROM PROGRAM FOR FINAL MOVE   * 01190099
012000*    TO PRODUCTION.                                             * 01200099
012100* MADE BY: KRYSTEN LEARY                        WR#: 28461      * 01210099
012200*                                                               * 01220099
012300* DATE  03/11/2007                                              * 01230099
012400*     CHANGE MADE: MATCH BY DC PROJECT                          * 01240099
012500*     MODIFIED LOGIC TO ACCOMMODATE DC MATCH LEVEL AS WELL AS   * 01250099
012600*     REPLACING THE CHECK OF STORE NUMBER VALUES WITH CHECK OF  * 01260099
012700*     MATCH LEVEL CODE FOR STORE AND PO.  ADDED DC_NBR AND      * 01270099
012800*     MTCH_LVL_CDE TO INVOICE_CSR.  ADDED A NEW CURSOR ON       * 01280099
012900*     TRECDIS FOR DC MATCH LEVEL.                               * 01290099
013000*     MOD PARAS: C150-, C300-                                   * 01300099
013100*     NEW PARAS: C600-, T300-, X700-, Y700-                     * 01310099
013200*     MADE BY: MIKE BESKE              WR/IR #: WR21578         * 01320099
013300*                                                               * 01330099
013400*---------------------------------------------------------------* 01340044
013500                                                                  01350044
013600*---------------------*                                           01360044
013700 ENVIRONMENT DIVISION.                                            01370044
013800*---------------------*                                           01380044
013900 CONFIGURATION SECTION.                                           01390044
014000 SOURCE-COMPUTER.    IBM-3090.                                    01400044
014100 OBJECT-COMPUTER.    IBM-3090.                                    01410044
014200                                                                  01420044
014300 INPUT-OUTPUT SECTION.                                            01430044
014400 FILE-CONTROL.                                                    01440044
014500                                                                  01450044
014600     SELECT FREIGHT-EXTRACT-FILE   ASSIGN TO OUT01.               01460044
014700     SELECT EXTRACT-OVER500-FILE   ASSIGN TO OUT02.               01470044
014800                                                                  01480044
014900*--------------*                                                  01490044
015000 DATA DIVISION.                                                   01500044
015100*--------------*                                                  01510044
015200 FILE SECTION.                                                    01520044
015300                                                                  01530044
015400 FD  FREIGHT-EXTRACT-FILE                                         01540044
015500     RECORDING MODE IS F                                          01550044
015600     LABEL RECORDS ARE STANDARD                                   01560044
015700     BLOCK CONTAINS 0 RECORDS                                     01570044
015800     DATA RECORD IS FREIGHT-EXTRACT-REC.                          01580044
015900 01  FREIGHT-EXTRACT-REC         PIC  X(255).                     01590044
016000                                                                  01600044
016100 FD  EXTRACT-OVER500-FILE                                         01610044
016200     RECORDING MODE IS F                                          01620044
016300     LABEL RECORDS ARE STANDARD                                   01630044
016400     BLOCK CONTAINS 0 RECORDS                                     01640044
016500     DATA RECORD IS EXTRACT-OVER500-REC.                          01650044
016600 01  EXTRACT-OVER500-REC         PIC  X(255).                     01660044
016700                                                                  01670044
016800 EJECT                                                            01680044
016900                                                                  01690044
017000 WORKING-STORAGE SECTION.                                         01700044
017100                                                                  01710044
017200 01  FILLER                      PIC  X(27)     VALUE             01720044
017300     '** START OF APKUT048 W/S **'.                               01730044
017400                                                                  01740044
017500 01  PROGRAM-CONSTANTS.                                           01750044
017600     05  PC-PROGRAM-NAME         PIC  X(08)     VALUE 'APKUT048'. 01760044
017700                                                                  01770044
017800 01  PV-PROCESS-COUNTERS.                                         01780044
017900     05  PV-INV-CSR-COUNT        PIC  9(08)     VALUE ZEROS.      01790044
018000     05  PV-WRITTEN-COUNT        PIC  9(08)     VALUE ZEROS.      01800044
018100     05  PV-OVER500-COUNT        PIC  9(08)     VALUE ZEROS.      01810044
018200                                                                  01820044
018300 01  PROGRAM-SWITCHES.                                            01830044
018400     05  PS-END-RECEIVER-CSR-SW     PIC  X(01)   VALUE 'N'.       01840044
018500         88  NOT-END-OF-RECEIVE-CSR              VALUE 'N'.       01850044
018600         88  END-OF-RECEIVE-CSR                  VALUE 'Y'.       01860044
018700     05  PS-END-RECITMS-CSR-SW      PIC  X(01)   VALUE 'N'.       01870044
018800         88  NOT-END-OF-RECITM-CSR               VALUE 'N'.       01880044
018900         88  END-OF-RECITM-CSR                   VALUE 'Y'.       01890044
019000     05  PS-END-RECSTR-CSR-SW       PIC  X(01)   VALUE 'N'.       01900044
019100         88  NOT-END-OF-REC-STR-CSR              VALUE 'N'.       01910044
019200         88  END-OF-REC-STR-CSR                  VALUE 'Y'.       01920044
019300     05  PS-END-RECDIS-CSR-SW       PIC  X(01)   VALUE 'N'.       01930044
019400         88  NOT-END-OF-RECDIS-CSR               VALUE 'N'.       01940044
019500         88  END-OF-RECDIS-CSR                   VALUE 'Y'.       01950044
019600     05  PS-END-DC-RECDIS-CSR-SW    PIC  X(01)   VALUE 'N'.       01960099
019700         88  NOT-END-OF-DC-RECDIS-CSR            VALUE 'N'.       01970099
019800         88  END-OF-DC-RECDIS-CSR                VALUE 'Y'.       01980099
019900     05  PS-END-INVC-CSR-SW         PIC  X(01)   VALUE 'N'.       01990044
020000         88  NOT-END-OF-INVC-CSR                 VALUE 'N'.       02000044
020100         88  END-OF-INVC-CSR                     VALUE 'Y'.       02010044
020200     05  PS-CHARGE-CSR-SW           PIC  X(01)   VALUE 'N'.       02020044
020300         88  CHARGE-FOUND                        VALUE 'N'.       02030044
020400         88  END-OF-CHARGE-CSR                   VALUE 'Y'.       02040044
020500     05  PS-RECV-MATCH-CSR-SW       PIC  X(01)   VALUE 'N'.       02050044
020600         88  NO-RECEIVER-MATCH                   VALUE 'N'.       02060044
020700         88  RECEIVER-MATCH                      VALUE 'Y'.       02070044
020800     05  PS-RECD-MATCH-CSR-SW       PIC  X(01)   VALUE 'N'.       02080044
020900         88  NO-RECDIS-MATCH                     VALUE 'N'.       02090044
021000         88  RECDIS-MATCH                        VALUE 'Y'.       02100044
021100     05  PS-DC-RECD-MATCH-CSR-SW    PIC  X(01)   VALUE 'N'.       02110099
021200         88  NO-DC-RECDIS-MATCH                  VALUE 'N'.       02120099
021300         88  DC-RECDIS-MATCH                     VALUE 'Y'.       02130099
021400     05  PS-RECSTR-MATCH-CSR-SW     PIC  X(01)   VALUE 'N'.       02140044
021500         88  NO-REC-STORE-MATCH                  VALUE 'N'.       02150044
021600         88  REC-STORE-MATCH                     VALUE 'Y'.       02160044
021700     05  PS-INVOICE-CSR-OPEN-SW     PIC  X(01)   VALUE 'N'.       02170044
021800         88  INVOICE-CSR-CLOSED                  VALUE 'N'.       02180044
021900         88  INVOICE-CSR-OPEN                    VALUE 'Y'.       02190044
022000     05  PS-FREIGHT-AMT-SW          PIC  X(01)   VALUE 'N'.       02200044
022100         88  FREIGHT-AMT-NOT-FOUND               VALUE 'N'.       02210044
022200         88  FREIGHT-AMT-FOUND                   VALUE 'Y'.       02220044
022300     05  PS-CHRG-VEND-SW            PIC  X(01)   VALUE 'N'.       02230044
022400         88  CHRG-VEND-NOT-CREATED               VALUE 'N'.       02240044
022500         88  CHRG-VEND-CREATED                   VALUE 'Y'.       02250044
022600     05  PS-CHRG500-VEND-SW         PIC  X(01)   VALUE 'N'.       02260044
022700         88  CHRG500-VEND-NOT-CREATED            VALUE 'N'.       02270044
022800         88  CHRG500-VEND-CREATED                VALUE 'Y'.       02280044
022900     05  PS-INVC-REC-SW             PIC  X(01)   VALUE 'N'.       02290044
023000         88  INVC-REC-NOT-WRIT                   VALUE 'N'.       02300044
023100         88  INVC-REC-WRIT                       VALUE 'Y'.       02310044
023200     05  PS-INVC500-REC-SW          PIC  X(01)   VALUE 'N'.       02320044
023300         88  INVC500-REC-NOT-WRIT                VALUE 'N'.       02330044
023400         88  INVC500-REC-WRIT                    VALUE 'Y'.       02340044
023500     05  PS-CHRG-A-REC-SW           PIC  X(01)   VALUE 'N'.       02350049
023600         88  CHRG-A-REC-NOT-WRIT                 VALUE 'N'.       02360049
023700         88  CHRG-A-REC-WRIT                     VALUE 'Y'.       02370049
023800                                                                  02380044
023900 01  HOLD-FIELDS.                                                 02390044
024000     05  HOLD-PO-NBR             PIC S9(09) COMP VALUE ZERO.      02400044
024100                                                                  02410044
024200 01  PROGRAM-VARIABLES.                                           02420044
024300     05  PV-TOT-CHARGE-AMT       PIC S9(11)V99  COMP-3 VALUE 0.   02430044
024400     05  PV-CHARGE-CODE          PIC  X(03)     VALUE SPACES.     02440044
024500     05  PV-PREV-CHARGE-CODE     PIC  X(03)     VALUE SPACES.     02450068
024600     05  PV-FORMAT-DATE.                                          02460044
024700         10  PV-FORMAT-CCYY.                                      02470044
024800             15  PV-FORMAT-CC      PIC  X(02)   VALUE SPACES.     02480044
024900             15  PV-FORMAT-YY      PIC  X(02)   VALUE SPACES.     02490044
025000         10  PV-DASH1              PIC  X(01)   VALUE '-'.        02500044
025100         10  PV-FORMAT-MONTH       PIC  X(02)   VALUE SPACES.     02510044
025200         10  PV-DASH2              PIC  X(01)   VALUE '-'.        02520044
025300         10  PV-FORMAT-DAY         PIC  X(02)   VALUE SPACES.     02530044
025400     05  LAST-FREIGHT-TIMESTAMP.                                  02540044
025500         10  LAST-FREIGHT-DATE   PIC X(10) VALUE SPACES.          02550044
025600         10  LAST-FREIGHT-TIME   PIC X(16) VALUE                  02560044
025700                                 '-23.59.59.999999'.              02570044
025800     05  LAST-FREIGHT-TMST  REDEFINES LAST-FREIGHT-TIMESTAMP      02580044
025900                            PIC X(26).                            02590044
026000     05  CURRENT-RUN-TIMESTAMP.                                   02600044
026100         10  CURRENT-RUN-DATE    PIC X(10) VALUE SPACES.          02610044
026200         10  CURRENT-RUN-TIME    PIC X(16) VALUE                  02620044
026300                                 '-23.59.59.999999'.              02630044
026400     05  CURRENT-RUN-TMST   REDEFINES CURRENT-RUN-TIMESTAMP       02640044
026500                            PIC X(26).                            02650044
026600     05  CLASS-NBR-FMT.                                           02660044
026700         10  CLASS-NBR-FMT-1     PIC X(2)       VALUE SPACES.     02670044
026800         10  CLASS-NBR-FMT-2     PIC X          VALUE SPACES.     02680044
026900     05  CLASS-NBR-FMT-NUM  REDEFINES  CLASS-NBR-FMT PIC 9(3).    02690044
027000     05  CLASS-NBR               PIC 9(2)       VALUE ZEROS.      02700044
027100     05  CLASS-NBR-MAX           PIC 9(2)       VALUE ZEROS.      02710044
027200     05  CLASS-NBR-LIMIT         PIC 9(2)       VALUE 99.         02720044
027300                                                                  02730044
027400 01  CLASS-TABLE.                                                 02740044
027500     05  CLASS-DATA         OCCURS 99 TIMES.                      02750044
027600         10  CLASS-TABLE-ENTRY  PIC 9(3) COMP-3.                  02760044
027700                                                                  02770044
027800                                                                  02780044
027900 EJECT                                                            02790044
028000                                                                  02800044
028100*----------------------------------------------------------------*02810044
028200*    COPYBOOK FOR FREIGHT EXTRACT FILE                            02820044
028300*----------------------------------------------------------------*02830044
028400     COPY APRD267.                                                02840044
028500                                                                  02850044
028600*----------------------------------------------------------------*02860044
028700*    SQL COMMUNICATIONS AREA DCLGEN                               02870044
028800*----------------------------------------------------------------*02880044
028900     EXEC SQL                                                     02890044
029000         INCLUDE SQLCA                                            02900044
029100     END-EXEC.                                                    02910044
029200                                                                  02920044
029300*----------------------------------------------------------------*02930044
029400*    AP-INVOICE TABLE                                             02940044
029500*----------------------------------------------------------------*02950044
029600     EXEC SQL                                                     02960044
029700         INCLUDE TINVOIC                                          02970044
029800     END-EXEC.                                                    02980044
029900                                                                  02990044
030000*----------------------------------------------------------------*03000044
030100*    AP-MERCHANDISE INVOICE TABLE                                 03010044
030200*----------------------------------------------------------------*03020044
030300     EXEC SQL                                                     03030044
030400         INCLUDE TMDINVC                                          03040044
030500     END-EXEC.                                                    03050044
030600                                                                  03060044
030700*----------------------------------------------------------------*03070044
030800*    AP-ALLOWANCE/CHARGE TABLE                                    03080044
030900*----------------------------------------------------------------*03090044
031000     EXEC SQL                                                     03100044
031100         INCLUDE TALCHRG                                          03110044
031200     END-EXEC.                                                    03120044
031300                                                                  03130044
031400*----------------------------------------------------------------*03140044
031500*    AP-PAYMENT CONTROL TABLE                                     03150044
031600*----------------------------------------------------------------*03160044
031700     EXEC SQL                                                     03170044
031800         INCLUDE TAPCNTL                                          03180044
031900     END-EXEC.                                                    03190044
032000                                                                  03200044
032100*----------------------------------------------------------------*03210044
032200*    PO-PURCHASE TABLE                                            03220044
032300*----------------------------------------------------------------*03230044
032400     EXEC SQL                                                     03240044
032500         INCLUDE TPURCHS                                          03250044
032600     END-EXEC.                                                    03260044
032700                                                                  03270044
032800*----------------------------------------------------------------*03280044
032900*    PO-PURCHASE ORDER ITEM TABLE                                 03290044
033000*----------------------------------------------------------------*03300044
033100     EXEC SQL                                                     03310044
033200         INCLUDE TPURITM                                          03320044
033300     END-EXEC.                                                    03330044
033400                                                                  03340044
033500*----------------------------------------------------------------*03350044
033600*    RC-RECEIVER TABLE                                            03360044
033700*----------------------------------------------------------------*03370044
033800     EXEC SQL                                                     03380044
033900         INCLUDE TRECEIV                                          03390044
034000     END-EXEC.                                                    03400044
034100                                                                  03410044
034200*----------------------------------------------------------------*03420044
034300*    RC-RECEIVING DISTRIBUTION TABLE                              03430044
034400*----------------------------------------------------------------*03440044
034500     EXEC SQL                                                     03450044
034600         INCLUDE TRECDIS                                          03460044
034700     END-EXEC.                                                    03470044
034800                                                                  03480044
034900*----------------------------------------------------------------*03490044
035000*    RC-RECEIVING ITEM TABLE                                      03500044
035100*----------------------------------------------------------------*03510044
035200     EXEC SQL                                                     03520044
035300         INCLUDE TRECITM                                          03530044
035400     END-EXEC.                                                    03540044
035500                                                                  03550044
035600*----------------------------------------------------------------*03560044
035700*    EXTERNAL ENTERPRISE TABLE                                    03570044
035800*----------------------------------------------------------------*03580044
035900     EXEC SQL                                                     03590044
036000         INCLUDE TEXTENT                                          03600044
036100     END-EXEC.                                                    03610044
036200                                                                  03620044
036300*----------------------------------------------------------------*03630044
036400*    EXTERNAL ENTERPRISE NAME TABLE                               03640044
036500*----------------------------------------------------------------*03650044
036600     EXEC SQL                                                     03660044
036700         INCLUDE TENTNME                                          03670044
036800     END-EXEC.                                                    03680044
036900                                                                  03690044
037000*----------------------------------------------------------------*03700044
037100*    INVOICE CURSOR FOR INVOICE/PO FETCH                          03710044
037200*----------------------------------------------------------------*03720044
037300     EXEC SQL                                                     03730044
037400         DECLARE INVOICE_CSR CURSOR FOR                           03740044
037500             SELECT  PO_NBR                                       03750044
037600                    ,INVC_ID                                      03760044
037700                    ,INVC_DTE                                     03770044
037800                    ,GRO_COST_AMT                                 03780044
037900                    ,STR_NBR                                      03790044
038000                    ,HOLD_IND                                     03800056
038100                    ,DC_NBR                                       03810099
038200                    ,MTCH_LVL_CDE                                 03820099
038300             FROM    TINVOIC                                      03830099
038400             WHERE   STATUS_CDE       = 'OP'                      03840099
038500             AND     PAYT_RLSE_TMST   > :LAST-FREIGHT-TMST        03850099
038600             AND     PAYT_RLSE_TMST  <= :CURRENT-RUN-TMST         03860099
038700             ORDER BY PO_NBR,                                     03870099
038800                      INVC_ID                                     03880099
038900     END-EXEC.                                                    03890099
039000                                                                  03900099
039100*----------------------------------------------------------------*03910099
039200*    CHARGE CURSOR FOR INVOICE/PO FETCH                           03920099
039300*----------------------------------------------------------------*03930099
039400     EXEC SQL                                                     03940099
039500         DECLARE CHARGE_CSR CURSOR FOR                            03950099
039600          SELECT T.CHARGE_CODE                                    03960099
039700                ,SUM(CASE                                         03970099
039800                     WHEN T.CHARGE_CODE = '400'                   03980099
039900                       THEN (T.CHARGE_AMT) -                      03990099
040000                            (T.CHARGE_AMT * T.FREIGHT_PCT)        04000099
040100                     ELSE                                         04010099
040200                       T.CHARGE_AMT                               04020099
040300                     END)                                         04030099
040400            FROM                                                  04040099
040500            (SELECT TA.ALW_CHRG_CDE                               04050099
040600                   ,(CASE TA.ALW_CHRG_CDE                         04060099
040700                      WHEN 'MSC' THEN 'MSC'                       04070099
040800                      WHEN '400' THEN '400'                       04080099
040900                      WHEN 'FFC' THEN '400'                       04090099
041000                      WHEN 'PAB' THEN '400'                       04100099
041100                      WHEN 'SAB' THEN '400'                       04110099
041200                      WHEN 'PST' THEN '400'                       04120099
041300                      WHEN 'UUC' THEN '400'                       04130099
041400                      WHEN 'INS' THEN 'INS'                       04140099
041500                      WHEN '445' THEN 'INS'                       04150099
041600                      WHEN 'SST' THEN 'SST'                       04160099
041700                      WHEN 'TTL' THEN 'SST'                       04170099
041800                      WHEN 'TTS' THEN 'SST'                       04180099
041900                      WHEN 'HHB' THEN 'HHB'                       04190099
042000                      WHEN '690' THEN '690'                       04200099
042100                      WHEN 'MSG' THEN 'MSG'                       04210099
042200                      WHEN 'PPN' THEN 'PPN'                       04220099
042300                      WHEN 'MRK' THEN 'MRK'                       04230099
042400                      WHEN 'EIC' THEN 'EIC'                       04240099
042500                      WHEN 'LAE' THEN 'LAE'                       04250099
042600                      WHEN 'SGG' THEN 'SGG'                       04260099
042700                      ELSE TA.ALW_CHRG_CDE                        04270099
042800                    END) AS CHARGE_CODE                           04280099
042900                   ,TA.ALW_CHRG_AMT AS CHARGE_AMT                 04290099
043000                   ,MI.VEND_FRGT_PCT AS FREIGHT_PCT               04300099
043100               FROM TALCHRG  TA                                   04310099
043200                   ,TMDINVC  MI                                   04320099
043300              WHERE TA.PO_NBR   = :ALCHRG-PO-NBR                  04330099
043400                AND TA.INVC_ID  = :ALCHRG-INVC-ID                 04340099
043500                AND TA.PO_NBR   =  MI.PO_NBR                      04350099
043600                AND TA.INVC_ID  =  MI.INVC_ID                     04360099
043700                AND TA.ALW_CHRG_CDE <> 'HGR'                      04370099
043800                AND TA.ALW_CHRG_TYP_CDE = 'C') AS T               04380099
043900        GROUP BY T.CHARGE_CODE                                    04390099
044000     END-EXEC.                                                    04400099
044100                                                                  04410099
044200                                                                  04420099
044300*----------------------------------------------------------------*04430099
044400*    RECEIVE CURSOR FOR INVOICE/RECEIVE FETCH - USED FOR PO MATCH 04440099
044500*    LEVEL                                                        04450099
044600*----------------------------------------------------------------*04460099
044700     EXEC SQL                                                     04470099
044800         DECLARE RECEIVE_CSR CURSOR FOR                           04480099
044900             SELECT  ACTL_CART_CNT                                04490099
045000                    ,REC_SEQ_NBR                                  04500099
045100                    ,ORD_NBR                                      04510099
045200             FROM    TRECEIV                                      04520099
045300             WHERE   ORD_NBR        = :INVOIC-PO-NBR              04530099
045400             AND     AP_PRC_DTE     > :APCNTL-LAST-FRGT-DTE       04540099
045500             AND     AP_PRC_DTE    <= :CURRENT-RUN-DATE           04550099
045600             AND     AP_PRC_CDE     = 'J'                         04560099
045700             AND     VER_STATUS_CDE = 'A'                         04570099
045800     END-EXEC.                                                    04580099
045900                                                                  04590099
046000*----------------------------------------------------------------*04600099
046100*    CURSOR FOR PURCHASE ITEM FETCH USED FOR PO MATCH LEVEL       04610099
046200*----------------------------------------------------------------*04620099
046300     EXEC SQL                                                     04630099
046400         DECLARE RECITM_CSR CURSOR FOR                            04640099
046500             SELECT  DISTINCT (A.CL_NBR)                          04650099
046600             FROM    TPURITM A,                                   04660099
046700                     TRECITM B                                    04670099
046800             WHERE   A.PO_NBR         = B.ORD_NBR                 04680099
046900             AND     A.VER_NBR        = B.PO_VER_NBR              04690099
047000             AND     A.APP_PO_LNE_NBR = B.ORD_LNE_NBR             04700099
047100             AND     B.ORD_NBR        = :RECEIV-ORD-NBR           04710099
047200             AND     B.REC_SEQ_NBR    = :RECEIV-REC-SEQ-NBR       04720099
047300     END-EXEC.                                                    04730099
047400                                                                  04740099
047500*----------------------------------------------------------------*04750099
047600*    CURSOR FOR NEXT RECEIVER FETCH - USED FOR STORE & DC MATCH   04760099
047700*    LEVELS                                                       04770099
047800*----------------------------------------------------------------*04780099
047900     EXEC SQL                                                     04790099
048000         DECLARE REC_STORE_CSR CURSOR FOR                         04800099
048100             SELECT  REC_SEQ_NBR                                  04810099
048200                    ,OPER_UNT_ID                                  04820099
048300                    ,FCLTY_ID                                     04830099
048400                    ,ORD_NBR                                      04840099
048500                    ,ACTL_CART_CNT                                04850099
048600             FROM    TRECEIV                                      04860099
048700             WHERE   ORD_NBR        = :INVOIC-PO-NBR              04870099
048800             AND     STATUS_CDE     = 'VE'                        04880099
048900             AND     VER_STATUS_CDE = 'A'                         04890099
049000             AND     FS_POST_TMST   NOT IN                        04900099
049100                                   ('9999-09-09-09.09.09.999999') 04910099
049200     END-EXEC.                                                    04920099
049300                                                                  04930099
049400*----------------------------------------------------------------*04940099
049500*    FETCH NEXT RECEIPT DISTRIBUTION CURSOR FOR RECEIVING         04950099
049600*    USED FOR STORE MATCH LEVEL                                   04960099
049700*----------------------------------------------------------------*04970099
049800     EXEC SQL                                                     04980099
049900         DECLARE RECDIS_CSR CURSOR FOR                            04990099
050000             SELECT  ORD_LNE_NBR                                  05000099
050100             FROM    TRECDIS                                      05010099
050200             WHERE   ORD_NBR        = :RECEIV-ORD-NBR             05020099
050300             AND     REC_SEQ_NBR    = :RECEIV-REC-SEQ-NBR         05030099
050400             AND     VER_STATUS_CDE = 'A'                         05040099
050500             AND     OPER_UNT_ID    = :RECEIV-OPER-UNT-ID         05050099
050600             AND     FCLTY_ID       = :RECEIV-FCLTY-ID            05060099
050700             AND     STR_NBR        = :INVOIC-STR-NBR             05070099
050800             AND     AP_PRC_CDE     = 'J'                         05080099
050900             AND     AP_PRC_DTE     > :APCNTL-LAST-FRGT-DTE       05090099
051000             AND     AP_PRC_DTE    <= :CURRENT-RUN-DATE           05100099
051100     END-EXEC.                                                    05110099
051200                                                                  05120099
051300*----------------------------------------------------------------*05130099
051400*    FETCH NEXT RECEIPT DISTRIBUTION CURSOR FOR RECEIVING         05140099
051500*    USED FOR DC MATCH LEVEL                                      05150099
051600*----------------------------------------------------------------*05160099
051700     EXEC SQL                                                     05170099
051800         DECLARE DC_RECDIS_CSR CURSOR FOR                         05180099
051900             SELECT  ORD_LNE_NBR                                  05190099
052000             FROM    TRECDIS                                      05200099
052100             WHERE   ORD_NBR        = :RECEIV-ORD-NBR             05210099
052200             AND     REC_SEQ_NBR    = :RECEIV-REC-SEQ-NBR         05220099
052300             AND     VER_STATUS_CDE = 'A'                         05230099
052400             AND     OPER_UNT_ID    = :RECEIV-OPER-UNT-ID         05240099
052500             AND     OPER_UNT_ID    = :INVOIC-DC-NBR              05250099
052600             AND     FCLTY_ID       = :RECEIV-FCLTY-ID            05260099
052700             AND     AP_PRC_CDE     = 'J'                         05270099
052800             AND     AP_PRC_DTE     > :APCNTL-LAST-FRGT-DTE       05280099
052900             AND     AP_PRC_DTE    <= :CURRENT-RUN-DATE           05290099
053000     END-EXEC.                                                    05300099
053100                                                                  05310099
053200*----------------------------------------------------------------*05320099
053300*    ABEND DATA AREAS                                             05330099
053400*----------------------------------------------------------------*05340099
053500 01  ABEND-CODE                    PIC S9(4)    VALUE ZEROES      05350099
053600                                   COMP         SYNC.             05360099
053700                                                                  05370099
053800     88  AC-ANY-ERROR                           VALUE  +4001      05380099
053900                                                THRU   +4019.     05390099
054000     88  AC-OPEN-ERROR                          VALUE  +4005.     05400099
054100     88  AC-CLOSE-ERROR                         VALUE  +4006.     05410099
054200     88  AC-INVALID-DATA                        VALUE  +4008.     05420099
054300     88  AC-DB2-ERROR                           VALUE  +4013.     05430099
054400     88  AC-UNSUCCESSFUL-SELECT                 VALUE  +4015.     05440099
054500     88  AC-MAX-RETRIES-EXCEEDED                VALUE  +4016.     05450099
054600                                                                  05460099
054700                                                                  05470099
054800 01  ABEND-AREAS.                                                 05480099
054900     05  AA-ABEND-LIT              PIC  X(40)   VALUE             05490099
055000             '*****       ABEND'.                                 05500099
055100     05  AA-PROGRAM-LIT            PIC  X(40)   VALUE             05510099
055200             '*****   PROGRAM: APKUT048'.                         05520099
055300     05  AA-PARAGRAPH-LIT.                                        05530099
055400         10  FILLER                PIC  X(17)   VALUE             05540099
055500             '***** PARAGRAPH: '.                                 05550099
055600         10  AA-PARAGRAPH-NAME     PIC  X(35)   VALUE SPACES.     05560099
055700     05  AA-MESSAGE-LINE-1.                                       05570099
055800         10  FILLER                PIC  X(06)   VALUE '*****'.    05580099
055900         10  AA-MESSAGE-1          PIC  X(80)   VALUE SPACES.     05590099
056000     05  AA-MESSAGE-LINE-2.                                       05600099
056100         10  FILLER                PIC  X(06)   VALUE '*****'.    05610099
056200         10  AA-MESSAGE-2          PIC  X(80)   VALUE SPACES.     05620099
056300     05  AA-DB2-ERROR-LIT          PIC  X(40)   VALUE             05630099
056400             '*****    DB2 ERROR'.                                05640099
056500     05  AA-DB2-OPERATION-LIT.                                    05650099
056600         10  FILLER                PIC  X(17)   VALUE             05660099
056700             '***** OPERATION: '.                                 05670099
056800         10  AA-DB2-OPERATION.                                    05680099
056900             15  AA-DB2-OP-1       PIC  X(25)   VALUE SPACES.     05690099
057000             15  AA-DB2-OP-2       PIC  X(25)   VALUE SPACES.     05700099
057100     05  AA-DB2-TABLE-1            PIC  X(08)   VALUE SPACES.     05710099
057200     05  AA-DB2-TABLE-2            PIC  X(08)   VALUE SPACES.     05720099
057300                                                                  05730099
057400*----------------------------------------------------------------*05740099
057500*    SQLCA FORMATTED MESSAGE AREA                                 05750099
057600*----------------------------------------------------------------*05760099
057700     COPY DPWS004.                                                05770099
057800                                                                  05780099
057900 01  FILLER                      PIC  X(25)     VALUE             05790099
058000     '** END OF APKUT048 W/S **'.                                 05800099
058100                                                                  05810099
058200*-------------------*                                             05820099
058300 PROCEDURE DIVISION.                                              05830099
058400*-------------------*                                             05840099
058500 A100-MAINLINE.                                                   05850099
058600                                                                  05860099
058700     PERFORM B100-INITIALIZE.                                     05870099
058800                                                                  05880099
058900     PERFORM B200-PROCESS-INVOICE-CURSOR                          05890099
059000       UNTIL END-OF-INVC-CSR.                                     05900099
059100                                                                  05910099
059200     PERFORM B300-END-OF-PROGRAM.                                 05920099
059300                                                                  05930099
059400     GOBACK.                                                      05940099
059500                                                                  05950099
059600                                                                  05960099
059700*----------------------------------------------------------------*05970099
059800*    INITIALIZATION PROCESSING                                   *05980099
059900*    - OPEN FREIGHT AND EXTRACT FILES.                           *05990099
060000*    - INITIALIZE DCLGENS AND SWITCHES.                          *06000099
060100*    - GET LAST FREIGHT DATE FROM TAPCNTL TABLE.                 *06010099
060200*    - OPEN INVOICE CURSOR AND FETCH FIRST RECORD.               *06020099
060300*----------------------------------------------------------------*06030099
060400 B100-INITIALIZE.                                                 06040099
060500                                                                  06050099
060600     DISPLAY '**------  APKUT048  (PROCESSING MSGS)  ------**'.   06060099
060700                                                                  06070099
060800     OPEN  OUTPUT  FREIGHT-EXTRACT-FILE                           06080099
060900                   EXTRACT-OVER500-FILE.                          06090099
061000                                                                  06100099
061100     INITIALIZE DCLTINVOIC                                        06110099
061200                DCLTMDINVC                                        06120099
061300                DCLTALCHRG                                        06130099
061400                DCLTAPCNTL                                        06140099
061500                DCLTPURCHS                                        06150099
061600                DCLTPURITM                                        06160099
061700                DCLTRECEIV                                        06170099
061800                DCLTRECDIS                                        06180099
061900                DCLTRECITM                                        06190099
062000                DCLTEXTENT                                        06200099
062100                DCLTENTNME                                        06210099
062200                PROGRAM-SWITCHES.                                 06220099
062300     SET CHRG-A-REC-NOT-WRIT TO TRUE.                             06230099
062400                                                                  06240099
062500     PERFORM S100-SET-CURRENT-DATE.                               06250099
062600                                                                  06260099
062700     PERFORM S200-GET-FREIGHT-DATE.                               06270099
062800                                                                  06280099
062900     DISPLAY '** CURRENT RUN DATE:  ' CURRENT-RUN-DATE            06290099
063000     DISPLAY '** LAST FREIGHT DATE: ' LAST-FREIGHT-DATE           06300099
063100                                                                  06310099
063200     PERFORM X100-OPEN-INVOICE-CSR.                               06320099
063300     PERFORM S600-FETCH-INVOICE-CSR.                              06330099
063400                                                                  06340099
063500     IF END-OF-INVC-CSR                                           06350099
063600        DISPLAY 'NO RECORDS FOUND WITH INVOICE CURSOR'            06360099
063700     END-IF.                                                      06370099
063800                                                                  06380099
063900                                                                  06390099
064000*----------------------------------------------------------------*06400099
064100*    PROCESS INVOICE CURSOR                                      *06410099
064200*    - CREATE INVOICE RECORDS                                    *06420099
064300*    - FETCH NEXT RECORD                                         *06430099
064400*----------------------------------------------------------------*06440099
064500 B200-PROCESS-INVOICE-CURSOR.                                     06450099
064600                                                                  06460099
064700     PERFORM C100-CREATE-INVOICE-REC.                             06470099
064800                                                                  06480099
064900     PERFORM S600-FETCH-INVOICE-CSR.                              06490099
065000                                                                  06500099
065100                                                                  06510099
065200*----------------------------------------------------------------*06520099
065300*    END OF PROGRAM                                              *06530099
065400*    - CLOSE THE CURSOR, IF OPEN.                                *06540099
065500*    - CLOSE THE FILES.                                          *06550099
065600*----------------------------------------------------------------*06560099
065700 B300-END-OF-PROGRAM.                                             06570099
065800                                                                  06580099
065900     DISPLAY '*************************************************'. 06590099
066000     DISPLAY '*************************************************'. 06600099
066100     DISPLAY '** TOTAL RECORDS READ         = ' PV-INV-CSR-COUNT. 06610099
066200     DISPLAY '*************************************************'. 06620099
066300     DISPLAY '** TOTAL EXTRACT RECS WRITTEN = ' PV-WRITTEN-COUNT. 06630099
066400     DISPLAY '*************************************************'. 06640099
066500     DISPLAY '** TOTAL >= $500 RECS WRITTEN = ' PV-OVER500-COUNT. 06650099
066600     DISPLAY '*************************************************'. 06660099
066700     DISPLAY '**         END OF APKUT048 PROCESSING          **'. 06670099
066800     DISPLAY '*************************************************'. 06680099
066900     DISPLAY ' '                                                  06690099
067000                                                                  06700099
067100     IF INVOICE-CSR-OPEN                                          06710099
067200        PERFORM Y100-CLOSE-INVOICE-CSR                            06720099
067300     END-IF                                                       06730099
067400                                                                  06740099
067500     PERFORM U100-UPDATE-TAPCNTL.                                 06750099
067600                                                                  06760099
067700     CLOSE FREIGHT-EXTRACT-FILE                                   06770099
067800           EXTRACT-OVER500-FILE.                                  06780099
067900                                                                  06790099
068000                                                                  06800099
068100*----------------------------------------------------------------*06810099
068200*    CREATE INVOICE RECORDS                                      *06820099
068300*    - PROCESS CHARGE CURSOR                                     *06830099
068400*    - PROCESS RECEIVERS FOR INVOICE                             *06840099
068500*----------------------------------------------------------------*06850099
068600 C100-CREATE-INVOICE-REC.                                         06860099
068700                                                                  06870099
068800     MOVE INVOIC-PO-NBR        TO ALCHRG-PO-NBR.                  06880099
068900     MOVE INVOIC-INVC-ID       TO ALCHRG-INVC-ID.                 06890099
069000                                                                  06900099
069100     SET CHARGE-FOUND                                             06910099
069200         INVC-REC-NOT-WRIT                                        06920099
069300         INVC500-REC-NOT-WRIT  TO TRUE.                           06930099
069400                                                                  06940099
069500     PERFORM X600-OPEN-CHARGE-CSR.                                06950099
069600     PERFORM C150-PROCESS-INVOICE                                 06960099
069700       UNTIL END-OF-CHARGE-CSR.                                   06970099
069800     PERFORM Y600-CLOSE-CHARGE-CSR.                               06980099
069900                                                                  06990099
070000     IF INVC-REC-WRIT OR INVC500-REC-WRIT                         07000099
070100        PERFORM C300-PROCESS-RECEIVERS                            07010099
070200     END-IF.                                                      07020099
070300                                                                  07030099
070400                                                                  07040099
070500*----------------------------------------------------------------*07050099
070600*    PROCESS INVOICE RECORDS                                     *07060099
070700*    - PROCESS CHARGE CURSOR                                     *07070099
070800*    - PROCESS VENDOR RECORD FOR INVOICE                         *07080099
070900*    - PROCESS INVOICE RECORD FOR INVOICE                        *07090099
071000*----------------------------------------------------------------*07100099
071100 C150-PROCESS-INVOICE.                                            07110099
071200                                                                  07120099
071300     PERFORM T200-FETCH-CHARGE-CSR.                               07130099
071400                                                                  07140099
071500     IF CHARGE-FOUND                                              07150099
071600        IF PV-CHARGE-CODE = '400'                                 07160099
071700           IF PV-TOT-CHARGE-AMT NOT EQUAL ZERO                    07170099
071800              IF INVOIC-PO-NBR EQUAL HOLD-PO-NBR                  07180099
071900                 IF CHRG-VEND-NOT-CREATED                         07190099
072000                    PERFORM C200-CREATE-VENDOR-REC                07200099
072100                 ELSE                                             07210099
072200                    IF PV-TOT-CHARGE-AMT >= 500.00                07220099
072300                       PERFORM C200-CREATE-VENDOR-REC             07230099
072400                    END-IF                                        07240099
072500                 END-IF                                           07250099
072600              ELSE                                                07260099
072700                 SET CHRG-VEND-NOT-CREATED TO TRUE                07270099
072800                 SET CHRG500-VEND-NOT-CREATED TO TRUE             07280099
072900                 SET CHRG-A-REC-NOT-WRIT TO TRUE                  07290099
073000                 PERFORM C200-CREATE-VENDOR-REC                   07300099
073100              END-IF                                              07310099
073200                                                                  07320099
073300              INITIALIZE AP267-A-RECORD                           07330099
073400                         AP267-B-RECORD                           07340099
073500                         AP267-C-RECORD                           07350099
073600                                                                  07360099
073700              MOVE INVOIC-PO-NBR       TO AP267-PO-NBR            07370099
073800              MOVE 'B'                 TO AP267-RECORD-TYPE       07380099
073900              MOVE INVOIC-INVC-ID      TO AP267-INVOICE-NUMBER    07390099
074000              MOVE INVOIC-INVC-DTE     TO PV-FORMAT-DATE          07400099
074100              MOVE PV-FORMAT-YY        TO AP267-INVC-YEAR         07410099
074200              MOVE PV-FORMAT-MONTH     TO AP267-INVC-MONTH        07420099
074300              MOVE PV-FORMAT-DAY       TO AP267-INVC-DAY          07430099
074400              MOVE INVOIC-STR-NBR      TO AP267-STORE-NUMBER      07440099
074500              MOVE INVOIC-DC-NBR       TO AP267-DC-NBR            07450099
074600              MOVE INVOIC-MTCH-LVL-CDE TO AP267-MTCH-LVL-CDE      07460099
074700              MOVE PV-CHARGE-CODE      TO AP267-CHARGE-CODE       07470099
074800              MOVE PV-TOT-CHARGE-AMT   TO AP267-CHARGE-AMT        07480099
074900                                                                  07490099
075000              PERFORM W100-WRITE-FREIGHT-EXTRACT                  07500099
075100                                                                  07510099
075200              SET INVC-REC-WRIT TO TRUE                           07520099
075300                                                                  07530099
075400              IF PV-TOT-CHARGE-AMT >= 500.00                      07540099
075500                 PERFORM W200-WRITE-EXTR500                       07550099
075600                 SET INVC500-REC-WRIT TO TRUE                     07560099
075700              END-IF                                              07570099
075800                                                                  07580099
075900           END-IF                                                 07590099
076000        ELSE                                                      07600099
076100           IF PV-TOT-CHARGE-AMT >= 500.00 OR                      07610099
076200              (PV-CHARGE-CODE = 'CDH' AND INVOIC-HOLD-IND = 'Y')  07620099
076300              IF INVOIC-PO-NBR EQUAL HOLD-PO-NBR                  07630099
076400                 IF CHRG500-VEND-NOT-CREATED                      07640099
076500                    PERFORM D100-CREATE-CHRG500-VEND              07650099
076600                    MOVE PV-CHARGE-CODE TO PV-PREV-CHARGE-CODE    07660099
076700                 END-IF                                           07670099
076800              ELSE                                                07680099
076900                 SET CHRG-VEND-NOT-CREATED TO TRUE                07690099
077000                 SET CHRG500-VEND-NOT-CREATED TO TRUE             07700099
077100                 PERFORM D100-CREATE-CHRG500-VEND                 07710099
077200                 MOVE PV-CHARGE-CODE TO PV-PREV-CHARGE-CODE       07720099
077300              END-IF                                              07730099
077400                                                                  07740099
077500              INITIALIZE AP267-A-RECORD                           07750099
077600                         AP267-B-RECORD                           07760099
077700                         AP267-C-RECORD                           07770099
077800                                                                  07780099
077900              MOVE INVOIC-PO-NBR       TO AP267-PO-NBR            07790099
078000              MOVE 'B'                 TO AP267-RECORD-TYPE       07800099
078100              MOVE INVOIC-INVC-ID      TO AP267-INVOICE-NUMBER    07810099
078200              MOVE INVOIC-INVC-DTE     TO PV-FORMAT-DATE          07820099
078300              MOVE PV-FORMAT-YY        TO AP267-INVC-YEAR         07830099
078400              MOVE PV-FORMAT-MONTH     TO AP267-INVC-MONTH        07840099
078500              MOVE PV-FORMAT-DAY       TO AP267-INVC-DAY          07850099
078600              MOVE INVOIC-STR-NBR      TO AP267-STORE-NUMBER      07860099
078700              MOVE INVOIC-DC-NBR       TO AP267-DC-NBR            07870099
078800              MOVE INVOIC-MTCH-LVL-CDE TO AP267-MTCH-LVL-CDE      07880099
078900              MOVE PV-CHARGE-CODE      TO AP267-CHARGE-CODE       07890099
079000              MOVE PV-TOT-CHARGE-AMT   TO AP267-CHARGE-AMT        07900099
079100                                                                  07910099
079200              PERFORM W200-WRITE-EXTR500                          07920099
079300                                                                  07930099
079400              SET INVC500-REC-WRIT TO TRUE                        07940099
079500                                                                  07950099
079600           END-IF                                                 07960099
079700        END-IF                                                    07970099
079800     END-IF.                                                      07980099
079900                                                                  07990099
080000                                                                  08000099
080100*----------------------------------------------------------------*08010099
080200*    CREATE VENDOR RECORD                                        *08020099
080300*----------------------------------------------------------------*08030099
080400 C200-CREATE-VENDOR-REC.                                          08040099
080500                                                                  08050099
080600     IF CHRG500-VEND-NOT-CREATED OR                               08060099
080700        PV-PREV-CHARGE-CODE NOT EQUAL '400'                       08070099
080800        PERFORM S300-GET-ENT-ID                                   08080099
080900        PERFORM S400-GET-NAME-DESCR                               08090099
081000        SET CHRG-A-REC-NOT-WRIT TO TRUE                           08100099
081100     END-IF                                                       08110099
081200                                                                  08120099
081300     MOVE INVOIC-PO-NBR         TO HOLD-PO-NBR.                   08130099
081400                                                                  08140099
081500     INITIALIZE AP267-A-RECORD                                    08150099
081600                AP267-B-RECORD                                    08160099
081700                AP267-C-RECORD.                                   08170099
081800                                                                  08180099
081900     MOVE INVOIC-PO-NBR         TO AP267-PO-NBR.                  08190099
082000     MOVE 'A'                   TO AP267-RECORD-TYPE.             08200099
082100     MOVE ENTNME-ENT-NAME-DESC  TO AP267-VENDOR-NAME.             08210099
082200     MOVE EXTENT-DUN-NBR        TO AP267-VENDOR-NUMBER.           08220099
082300     MOVE PURCHS-DEPT-NBR       TO AP267-DEPT-NUMBER.             08230099
082400                                                                  08240099
082500     IF CHRG-A-REC-NOT-WRIT                                       08250099
082600        PERFORM W100-WRITE-FREIGHT-EXTRACT                        08260099
082700        SET CHRG-VEND-CREATED TO TRUE                             08270099
082800        SET CHRG-A-REC-WRIT TO TRUE                               08280099
082900     END-IF.                                                      08290099
083000                                                                  08300099
083100     IF CHRG500-VEND-NOT-CREATED AND                              08310099
083200        PV-TOT-CHARGE-AMT >= 500.00                               08320099
083300          PERFORM W200-WRITE-EXTR500                              08330099
083400          SET CHRG500-VEND-CREATED TO TRUE                        08340099
083500     END-IF.                                                      08350099
083600                                                                  08360099
083700                                                                  08370099
083800*----------------------------------------------------------------*08380099
083900*    PROCESS RECEIVERS FOR INVOICE                               *08390099
084000*----------------------------------------------------------------*08400099
084100 C300-PROCESS-RECEIVERS.                                          08410099
084200                                                                  08420099
084300     INITIALIZE CLASS-TABLE.                                      08430099
084400                                                                  08440099
084500     SET NOT-END-OF-RECEIVE-CSR                                   08450099
084600         NOT-END-OF-REC-STR-CSR                                   08460099
084700         NO-RECEIVER-MATCH    TO TRUE.                            08470099
084800                                                                  08480099
084900     IF INVOIC-MTCH-LVL-CDE = 'P'                                 08490099
085000        PERFORM X200-OPEN-RECEIVE-CSR                             08500099
085100        MOVE ZEROES TO CLASS-NBR                                  08510099
085200                       CLASS-NBR-MAX                              08520099
085300        PERFORM C400-CREATE-BULK-RECEIVE                          08530099
085400          UNTIL END-OF-RECEIVE-CSR                                08540099
085500        PERFORM Y200-CLOSE-RECEIVE-CSR                            08550099
085600     ELSE                                                         08560099
085700        IF INVOIC-MTCH-LVL-CDE = 'D'                              08570099
085800           PERFORM X300-OPEN-REC-STORE-CSR                        08580099
085900           MOVE ZEROES TO CLASS-NBR                               08590099
086000                          CLASS-NBR-MAX                           08600099
086100           PERFORM C600-CREATE-DC-RECEIVE                         08610099
086200             UNTIL END-OF-REC-STR-CSR                             08620099
086300           PERFORM Y300-CLOSE-REC-STORE-CSR                       08630099
086400        ELSE                                                      08640099
086500           IF INVOIC-MTCH-LVL-CDE = 'S'                           08650099
086600              PERFORM X300-OPEN-REC-STORE-CSR                     08660099
086700              MOVE ZEROES TO CLASS-NBR                            08670099
086800                             CLASS-NBR-MAX                        08680099
086900              PERFORM C500-CREATE-STR-RECEIVE                     08690099
087000                UNTIL END-OF-REC-STR-CSR                          08700099
087100              PERFORM Y300-CLOSE-REC-STORE-CSR                    08710099
087200           END-IF                                                 08720099
087300        END-IF                                                    08730099
087400     END-IF.                                                      08740099
087500                                                                  08750099
087600                                                                  08760099
087700*----------------------------------------------------------------*08770099
087800*    CREATE BULK RECEIVER                                        *08780099
087900*    - CREATE RECORD                                             *08790099
088000*----------------------------------------------------------------*08800099
088100 C400-CREATE-BULK-RECEIVE.                                        08810099
088200                                                                  08820099
088300     SET NO-RECEIVER-MATCH  TO TRUE.                              08830099
088400                                                                  08840099
088500     PERFORM S700-FETCH-RECEIVE-CSR.                              08850099
088600                                                                  08860099
088700     IF RECEIVER-MATCH                                            08870099
088800         PERFORM X400-OPEN-RECITM-CSR                             08880099
088900         SET NOT-END-OF-RECITM-CSR TO TRUE                        08890099
089000         PERFORM S900-FETCH-RECITM-CSR                            08900099
089100           UNTIL END-OF-RECITM-CSR                                08910099
089200         PERFORM Y400-CLOSE-RECITM-CSR                            08920099
089300         PERFORM D200-CREATE-AP267-RECORD                         08930099
089400     END-IF.                                                      08940099
089500                                                                  08950099
089600                                                                  08960099
089700*----------------------------------------------------------------*08970099
089800*    CREATE STORE RECEIVER                                       *08980099
089900*    - CREATE RECORD                                             *08990099
090000*----------------------------------------------------------------*09000099
090100 C500-CREATE-STR-RECEIVE.                                         09010099
090200                                                                  09020099
090300     SET NO-REC-STORE-MATCH  TO TRUE.                             09030099
090400     SET NO-RECDIS-MATCH     TO TRUE.                             09040099
090500                                                                  09050099
090600     PERFORM S800-FETCH-REC-STORE-CSR.                            09060099
090700                                                                  09070099
090800     IF REC-STORE-MATCH                                           09080099
090900         PERFORM X500-OPEN-RECDIS-CSR                             09090099
091000         SET NOT-END-OF-RECDIS-CSR TO TRUE                        09100099
091100         PERFORM T100-FETCH-RECDIS-CSR                            09110099
091200           UNTIL END-OF-RECDIS-CSR                                09120099
091300         PERFORM Y500-CLOSE-RECDIS-CSR                            09130099
091400         IF RECDIS-MATCH                                          09140099
091500            PERFORM D200-CREATE-AP267-RECORD                      09150099
091600         END-IF                                                   09160099
091700     END-IF.                                                      09170099
091800                                                                  09180099
091900                                                                  09190099
092000*----------------------------------------------------------------*09200099
092100*    CREATE DC RECEIVER                                          *09210099
092200*    - CREATE RECORD                                             *09220099
092300*----------------------------------------------------------------*09230099
092400 C600-CREATE-DC-RECEIVE.                                          09240099
092500                                                                  09250099
092600     SET NO-REC-STORE-MATCH  TO TRUE.                             09260099
092700     SET NO-DC-RECDIS-MATCH  TO TRUE.                             09270099
092800                                                                  09280099
092900     PERFORM S800-FETCH-REC-STORE-CSR.                            09290099
093000                                                                  09300099
093100     IF REC-STORE-MATCH                                           09310099
093200         PERFORM X700-OPEN-DC-RECDIS-CSR                          09320099
093300         SET NOT-END-OF-DC-RECDIS-CSR TO TRUE                     09330099
093400         PERFORM T300-FETCH-DC-RECDIS-CSR                         09340099
093500           UNTIL END-OF-DC-RECDIS-CSR                             09350099
093600         PERFORM Y700-CLOSE-DC-RECDIS-CSR                         09360099
093700         IF DC-RECDIS-MATCH                                       09370099
093800            PERFORM D200-CREATE-AP267-RECORD                      09380099
093900         END-IF                                                   09390099
094000     END-IF.                                                      09400099
094100                                                                  09410099
094200                                                                  09420099
094300*----------------------------------------------------------------*09430099
094400*    CREATE VENDOR RECORD                                        *09440099
094500*----------------------------------------------------------------*09450099
094600 D100-CREATE-CHRG500-VEND.                                        09460099
094700                                                                  09470099
094800     IF CHRG-VEND-NOT-CREATED                                     09480099
094900        PERFORM S300-GET-ENT-ID                                   09490099
095000        PERFORM S400-GET-NAME-DESCR                               09500099
095100     END-IF                                                       09510099
095200                                                                  09520099
095300     MOVE INVOIC-PO-NBR         TO HOLD-PO-NBR.                   09530099
095400                                                                  09540099
095500     INITIALIZE AP267-A-RECORD                                    09550099
095600                AP267-B-RECORD                                    09560099
095700                AP267-C-RECORD.                                   09570099
095800                                                                  09580099
095900     MOVE INVOIC-PO-NBR         TO AP267-PO-NBR.                  09590099
096000     MOVE 'A'                   TO AP267-RECORD-TYPE.             09600099
096100     MOVE ENTNME-ENT-NAME-DESC  TO AP267-VENDOR-NAME.             09610099
096200     MOVE EXTENT-DUN-NBR        TO AP267-VENDOR-NUMBER.           09620099
096300     MOVE PURCHS-DEPT-NBR       TO AP267-DEPT-NUMBER.             09630099
096400     PERFORM W200-WRITE-EXTR500.                                  09640099
096500                                                                  09650099
096600     SET CHRG500-VEND-CREATED TO TRUE.                            09660099
096700                                                                  09670099
096800                                                                  09680099
096900*----------------------------------------------------------------*09690099
097000*    WRITE AP267 RECORD                                          *09700099
097100*----------------------------------------------------------------*09710099
097200 D200-CREATE-AP267-RECORD.                                        09720099
097300                                                                  09730099
097400     INITIALIZE AP267-A-RECORD                                    09740099
097500                AP267-B-RECORD                                    09750099
097600                AP267-C-RECORD.                                   09760099
097700                                                                  09770099
097800     MOVE INVOIC-PO-NBR         TO AP267-PO-NBR.                  09780099
097900     MOVE 'C'                   TO AP267-RECORD-TYPE.             09790099
098000     MOVE RECEIV-REC-SEQ-NBR    TO AP267-RECVR-SEQ-NO.            09800099
098100     MOVE RECEIV-ACTL-CART-CNT  TO AP267-RECVR-CARTONS.           09810099
098200     MOVE CLASS-TABLE           TO AP267-RECVR-CLASS-TABLE.       09820099
098300                                                                  09830099
098400     IF INVC-REC-WRIT                                             09840099
098500        PERFORM W100-WRITE-FREIGHT-EXTRACT                        09850099
098600     END-IF                                                       09860099
098700                                                                  09870099
098800     IF INVC500-REC-WRIT                                          09880099
098900        PERFORM W200-WRITE-EXTR500                                09890099
099000     END-IF.                                                      09900099
099100                                                                  09910099
099200                                                                  09920099
099300*----------------------------------------------------------------*09930099
099400*    LOAD ENTRY INTO INTERNAL CLASS TABLE                        *09940099
099500*----------------------------------------------------------------*09950099
099600 L100-LOAD-CLASS-TABLE.                                           09960099
099700                                                                  09970099
099800     MOVE PURITM-CL-NBR TO CLASS-NBR-FMT-1.                       09980099
099900     MOVE ZERO TO CLASS-NBR-FMT-2.                                09990099
100000                                                                  10000099
100100     PERFORM WITH TEST BEFORE                                     10010099
100200         VARYING CLASS-NBR FROM 1 BY 1                            10020099
100300           UNTIL CLASS-TABLE-ENTRY (CLASS-NBR)                    10030099
100400                 = CLASS-NBR-FMT-NUM                              10040099
100500                 OR CLASS-NBR > CLASS-NBR-MAX                     10050099
100600     END-PERFORM.                                                 10060099
100700                                                                  10070099
100800     IF CLASS-NBR > CLASS-NBR-MAX                                 10080099
100900         IF CLASS-NBR > CLASS-NBR-LIMIT                           10090099
101000             DISPLAY '*** PO NBR = ' RECEIV-ORD-NBR               10100099
101100             DISPLAY '*** SEQ #  = ' RECEIV-REC-SEQ-NBR           10110099
101200             MOVE 'S200-GET-FREIGHT-DATE'                         10120099
101300                                   TO AA-PARAGRAPH-NAME           10130099
101400             MOVE '*** MAX NBR OF CLASS EXCEEDED'                 10140099
101500                                   TO AA-MESSAGE-1                10150099
101600             MOVE '*** NUMBER OF CLASS SHOULD NOT EXCEED 20'      10160099
101700                                   TO AA-MESSAGE-2                10170099
101800             MOVE +4004            TO ABEND-CODE                  10180099
101900             PERFORM Z998-ABEND                                   10190099
102000         ELSE                                                     10200099
102100             MOVE CLASS-NBR-FMT-NUM                               10210099
102200                 TO CLASS-TABLE-ENTRY (CLASS-NBR)                 10220099
102300             ADD 1 TO CLASS-NBR-MAX                               10230099
102400         END-IF                                                   10240099
102500     END-IF.                                                      10250099
102600                                                                  10260099
102700                                                                  10270099
102800*----------------------------------------------------------------*10280099
102900*    SETS CURRENT DATE FOR PROCESSING.                           *10290099
103000*----------------------------------------------------------------*10300099
103100 S100-SET-CURRENT-DATE.                                           10310099
103200                                                                  10320099
103300     EXEC SQL                                                     10330099
103400         SET  :CURRENT-RUN-DATE = CURRENT DATE                    10340099
103500     END-EXEC.                                                    10350099
103600                                                                  10360099
103700     EVALUATE TRUE                                                10370099
103800         WHEN SQLCODE = ZERO                                      10380099
103900            CONTINUE                                              10390099
104000                                                                  10400099
104100         WHEN SQLWARN0 NOT = SPACES                               10410099
104200         WHEN SQLCODE NOT  = ZERO                                 10420099
104300            MOVE 'S100-GET-CURRENT-DATE'                          10430099
104400                                TO AA-PARAGRAPH-NAME              10440099
104500            MOVE 'UNSUCCESSFUL DATE SET'                          10450099
104600                                TO AA-DB2-OPERATION               10460099
104700            MOVE SPACES         TO AA-DB2-TABLE-1                 10470099
104800                                   AA-DB2-TABLE-2                 10480099
104900            PERFORM Z999-DB2-ABEND                                10490099
105000     END-EVALUATE.                                                10500099
105100                                                                  10510099
105200                                                                  10520099
105300*----------------------------------------------------------------*10530099
105400*    GETS LAST FREIGHT DATE FROM TAPCNTL TABLE.                  *10540099
105500*----------------------------------------------------------------*10550099
105600 S200-GET-FREIGHT-DATE.                                           10560099
105700                                                                  10570099
105800     EXEC SQL                                                     10580099
105900         SELECT  LAST_FRGT_DTE                                    10590099
106000           INTO  :APCNTL-LAST-FRGT-DTE                            10600099
106100           FROM  TAPCNTL                                          10610099
106200     END-EXEC.                                                    10620099
106300                                                                  10630099
106400     EVALUATE TRUE                                                10640099
106500         WHEN SQLCODE = ZERO                                      10650099
106600            MOVE APCNTL-LAST-FRGT-DTE TO LAST-FREIGHT-DATE        10660099
106700                                                                  10670099
106800         WHEN SQLWARN0 NOT = SPACES                               10680099
106900         WHEN SQLCODE NOT  = ZERO                                 10690099
107000            MOVE 'S200-GET-FREIGHT-DATE'                          10700099
107100                                TO AA-PARAGRAPH-NAME              10710099
107200            MOVE 'UNSUCCESSFUL SELECT'                            10720099
107300                                TO AA-DB2-OPERATION               10730099
107400            MOVE 'TAPCNTL'      TO AA-DB2-TABLE-1                 10740099
107500            MOVE SPACES         TO AA-DB2-TABLE-2                 10750099
107600            PERFORM Z999-DB2-ABEND                                10760099
107700     END-EVALUATE.                                                10770099
107800                                                                  10780099
107900                                                                  10790099
108000*----------------------------------------------------------------*10800099
108100*    GETS ENT-ID FROM TPURCHS.                                   *10810099
108200*----------------------------------------------------------------*10820099
108300 S300-GET-ENT-ID.                                                 10830099
108400                                                                  10840099
108500     EXEC SQL                                                     10850099
108600         SELECT  DEPT_NBR,                                        10860099
108700                 ENT_ID                                           10870099
108800           INTO  :PURCHS-DEPT-NBR,                                10880099
108900                 :PURCHS-ENT-ID                                   10890099
109000           FROM  TPURCHS                                          10900099
109100          WHERE  PO_NBR         = :INVOIC-PO-NBR                  10910099
109200            AND  VER_STATUS_CDE = 'A'                             10920099
109300     END-EXEC.                                                    10930099
109400                                                                  10940099
109500     EVALUATE TRUE                                                10950099
109600         WHEN SQLCODE = ZERO                                      10960099
109700          CONTINUE                                                10970099
109800         WHEN SQLCODE = +100                                      10980099
109900            MOVE 'VENDOR NOT FOUND' TO ENTNME-ENT-NAME-DESC       10990099
110000            MOVE 999999999 TO EXTENT-DUN-NBR                      11000099
110100            MOVE 999 TO PURCHS-DEPT-NBR                           11010099
110200                                                                  11020099
110300         WHEN SQLWARN0 NOT = SPACES                               11030099
110400         WHEN SQLCODE NOT  = ZERO                                 11040099
110500            MOVE 'S300-GET-ENT-ID'                                11050099
110600                                TO AA-PARAGRAPH-NAME              11060099
110700            MOVE 'UNSUCCESSFUL SELECT'                            11070099
110800                                TO AA-DB2-OPERATION               11080099
110900            MOVE 'TPURCHS'      TO AA-DB2-TABLE-1                 11090099
111000            MOVE SPACES         TO AA-DB2-TABLE-2                 11100099
111100            PERFORM Z999-DB2-ABEND                                11110099
111200     END-EVALUATE.                                                11120099
111300                                                                  11130099
111400                                                                  11140099
111500*----------------------------------------------------------------*11150099
111600*    GETS NAME FROM TEXTENT AND TENTNME TABLES.                  *11160099
111700*----------------------------------------------------------------*11170099
111800 S400-GET-NAME-DESCR.                                             11180099
111900                                                                  11190099
112000     EXEC SQL                                                     11200099
112100         SELECT  A.DUN_NBR,                                       11210099
112200                 B.ENT_NAME_DESC                                  11220099
112300           INTO  :EXTENT-DUN-NBR,                                 11230099
112400                 :ENTNME-ENT-NAME-DESC                            11240099
112500           FROM  TEXTENT A,                                       11250099
112600                 TENTNME B                                        11260099
112700          WHERE  A.ENT_ID   = :PURCHS-ENT-ID                      11270099
112800            AND  A.ENT_ID   = B.ENT_ID                            11280099
112900            AND  B.TYPE_CDE = '01'                                11290099
113000     END-EXEC.                                                    11300099
113100                                                                  11310099
113200     EVALUATE TRUE                                                11320099
113300         WHEN SQLCODE = ZERO                                      11330099
113400           CONTINUE                                               11340099
113500         WHEN SQLCODE = +100                                      11350099
113600            MOVE 'VENDOR NOT FOUND' TO ENTNME-ENT-NAME-DESC       11360099
113700            MOVE 999999999 TO EXTENT-DUN-NBR                      11370099
113800                                                                  11380099
113900         WHEN SQLWARN0 NOT = SPACES                               11390099
114000         WHEN SQLCODE NOT  = ZERO                                 11400099
114100            MOVE 'S400-GET-NAME-DESCR'                            11410099
114200                                TO AA-PARAGRAPH-NAME              11420099
114300            MOVE 'UNSUCCESSFUL SELECT'                            11430099
114400                                TO AA-DB2-OPERATION               11440099
114500            MOVE 'TEXTENT'      TO AA-DB2-TABLE-1                 11450099
114600            MOVE 'TENTNME'      TO AA-DB2-TABLE-2                 11460099
114700            PERFORM Z999-DB2-ABEND                                11470099
114800     END-EVALUATE.                                                11480099
114900                                                                  11490099
115000                                                                  11500099
115100*----------------------------------------------------------------*11510099
115200*    GETS CLASS NUMBER FROM TPURITM AND TRECITM TABLES.          *11520099
115300*----------------------------------------------------------------*11530099
115400 S500-GET-CLASS-NBR.                                              11540099
115500                                                                  11550099
115600     EXEC SQL                                                     11560099
115700         SELECT  A.CL_NBR                                         11570099
115800           INTO  :PURITM-CL-NBR                                   11580099
115900           FROM  TPURITM A,                                       11590099
116000                 TRECITM B                                        11600099
116100          WHERE  B.ORD_NBR        = :RECEIV-ORD-NBR               11610099
116200            AND  B.ORD_LNE_NBR    = :RECDIS-ORD-LNE-NBR           11620099
116300            AND  B.REC_SEQ_NBR    = :RECEIV-REC-SEQ-NBR           11630099
116400            AND  B.OPER_UNT_ID    = :RECEIV-OPER-UNT-ID           11640099
116500            AND  B.FCLTY_ID       = :RECEIV-FCLTY-ID              11650099
116600            AND  B.VER_STATUS_CDE = 'A'                           11660099
116700            AND  A.PO_NBR         = :RECEIV-ORD-NBR               11670099
116800            AND  B.PO_VER_NBR     = A.VER_NBR                     11680099
116900            AND  A.APP_PO_LNE_NBR = :RECDIS-ORD-LNE-NBR           11690099
117000     END-EXEC.                                                    11700099
117100                                                                  11710099
117200     EVALUATE TRUE                                                11720099
117300         WHEN SQLCODE = ZERO                                      11730099
117400            PERFORM L100-LOAD-CLASS-TABLE                         11740099
117500                                                                  11750099
117600         WHEN SQLCODE = +100                                      11760099
117700            CONTINUE                                              11770099
117800                                                                  11780099
117900         WHEN SQLWARN0 NOT = SPACES                               11790099
118000         WHEN SQLCODE NOT  = ZERO                                 11800099
118100            MOVE 'S500-GET-CLASS-NBR'                             11810099
118200                                TO AA-PARAGRAPH-NAME              11820099
118300            MOVE 'UNSUCCESSFUL SELECT'                            11830099
118400                                TO AA-DB2-OPERATION               11840099
118500            MOVE 'TPURITM'      TO AA-DB2-TABLE-1                 11850099
118600            MOVE 'TRECITM'      TO AA-DB2-TABLE-2                 11860099
118700            PERFORM Z999-DB2-ABEND                                11870099
118800     END-EVALUATE.                                                11880099
118900                                                                  11890099
119000                                                                  11900099
119100*---------------------------------------------------------------- 11910099
119200*    FETCH THE INVOICE_CSR CURSOR.                                11920099
119300*---------------------------------------------------------------- 11930099
119400 S600-FETCH-INVOICE-CSR.                                          11940099
119500                                                                  11950099
119600     EXEC SQL                                                     11960099
119700          FETCH  INVOICE_CSR                                      11970099
119800           INTO :INVOIC-PO-NBR                                    11980099
119900               ,:INVOIC-INVC-ID                                   11990099
120000               ,:INVOIC-INVC-DTE                                  12000099
120100               ,:INVOIC-GRO-COST-AMT                              12010099
120200               ,:INVOIC-STR-NBR                                   12020099
120300               ,:INVOIC-HOLD-IND                                  12030099
120400               ,:INVOIC-DC-NBR                                    12040099
120500               ,:INVOIC-MTCH-LVL-CDE                              12050099
120600     END-EXEC.                                                    12060099
120700                                                                  12070099
120800     EVALUATE TRUE                                                12080099
120900         WHEN SQLCODE = ZERO                                      12090099
121000             ADD 1 TO PV-INV-CSR-COUNT                            12100099
121100                                                                  12110099
121200         WHEN SQLCODE = +100                                      12120099
121300             SET END-OF-INVC-CSR TO TRUE                          12130099
121400                                                                  12140099
121500         WHEN SQLWARN0 NOT = SPACES                               12150099
121600         WHEN SQLCODE  NOT = ZERO                                 12160099
121700             MOVE 'S600-FETCH-INVOICE-CSR'                        12170099
121800                                 TO AA-PARAGRAPH-NAME             12180099
121900             MOVE 'UNSUCCESSFUL FETCH FROM INVOICE_CSR'           12190099
122000                                 TO AA-DB2-OPERATION              12200099
122100             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                12210099
122200             MOVE SPACES         TO AA-DB2-TABLE-2                12220099
122300             PERFORM Z999-DB2-ABEND                               12230099
122400     END-EVALUATE.                                                12240099
122500                                                                  12250099
122600                                                                  12260099
122700*---------------------------------------------------------------- 12270099
122800*    FETCH THE RECEIVE_CSR CURSOR.                                12280099
122900*---------------------------------------------------------------- 12290099
123000 S700-FETCH-RECEIVE-CSR.                                          12300099
123100                                                                  12310099
123200     EXEC SQL                                                     12320099
123300         FETCH RECEIVE_CSR                                        12330099
123400             INTO :RECEIV-ACTL-CART-CNT                           12340099
123500                 ,:RECEIV-REC-SEQ-NBR                             12350099
123600                 ,:RECEIV-ORD-NBR                                 12360099
123700     END-EXEC.                                                    12370099
123800                                                                  12380099
123900     EVALUATE TRUE                                                12390099
124000         WHEN SQLCODE = ZERO                                      12400099
124100             SET RECEIVER-MATCH TO TRUE                           12410099
124200                                                                  12420099
124300         WHEN SQLCODE = +100                                      12430099
124400             SET END-OF-RECEIVE-CSR TO TRUE                       12440099
124500                                                                  12450099
124600         WHEN SQLWARN0 NOT = SPACES                               12460099
124700         WHEN SQLCODE  NOT = ZERO                                 12470099
124800             MOVE 'S700-FETCH-RECEIVE-CSR'                        12480099
124900                                 TO AA-PARAGRAPH-NAME             12490099
125000             MOVE 'UNSUCCESSFUL FETCH FROM RECEIVE_CSR'           12500099
125100                                 TO AA-DB2-OPERATION              12510099
125200             MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                12520099
125300             MOVE SPACES         TO AA-DB2-TABLE-2                12530099
125400             PERFORM Z999-DB2-ABEND                               12540099
125500     END-EVALUATE.                                                12550099
125600                                                                  12560099
125700                                                                  12570099
125800*---------------------------------------------------------------- 12580099
125900*    FETCH THE REC_STORE_CSR CURSOR.                              12590099
126000*---------------------------------------------------------------- 12600099
126100 S800-FETCH-REC-STORE-CSR.                                        12610099
126200                                                                  12620099
126300     EXEC SQL                                                     12630099
126400         FETCH REC_STORE_CSR                                      12640099
126500             INTO :RECEIV-REC-SEQ-NBR                             12650099
126600                 ,:RECEIV-OPER-UNT-ID                             12660099
126700                 ,:RECEIV-FCLTY-ID                                12670099
126800                 ,:RECEIV-ORD-NBR                                 12680099
126900                 ,:RECEIV-ACTL-CART-CNT                           12690099
127000     END-EXEC.                                                    12700099
127100                                                                  12710099
127200     EVALUATE TRUE                                                12720099
127300         WHEN SQLCODE = ZERO                                      12730099
127400             SET REC-STORE-MATCH TO TRUE                          12740099
127500                                                                  12750099
127600         WHEN SQLCODE = +100                                      12760099
127700             SET END-OF-REC-STR-CSR TO TRUE                       12770099
127800                                                                  12780099
127900         WHEN SQLWARN0 NOT = SPACES                               12790099
128000         WHEN SQLCODE  NOT = ZERO                                 12800099
128100             MOVE 'S800-FETCH-REC-STORE-CSR'                      12810099
128200                                 TO AA-PARAGRAPH-NAME             12820099
128300             MOVE 'UNSUCCESSFUL FETCH FROM REC_STORE_CSR'         12830099
128400                                 TO AA-DB2-OPERATION              12840099
128500             MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                12850099
128600             MOVE SPACES         TO AA-DB2-TABLE-2                12860099
128700             PERFORM Z999-DB2-ABEND                               12870099
128800     END-EVALUATE.                                                12880099
128900                                                                  12890099
129000                                                                  12900099
129100*---------------------------------------------------------------- 12910099
129200*    FETCH THE RECITM_CSR CURSOR.                                 12920099
129300*---------------------------------------------------------------- 12930099
129400 S900-FETCH-RECITM-CSR.                                           12940099
129500                                                                  12950099
129600     EXEC SQL                                                     12960099
129700         FETCH RECITM_CSR                                         12970099
129800           INTO :PURITM-CL-NBR                                    12980099
129900     END-EXEC.                                                    12990099
130000                                                                  13000099
130100     EVALUATE TRUE                                                13010099
130200         WHEN SQLCODE = ZERO                                      13020099
130300             PERFORM L100-LOAD-CLASS-TABLE                        13030099
130400                                                                  13040099
130500         WHEN SQLCODE = +100                                      13050099
130600             SET END-OF-RECITM-CSR TO TRUE                        13060099
130700                                                                  13070099
130800         WHEN SQLWARN0 NOT = SPACES                               13080099
130900         WHEN SQLCODE  NOT = ZERO                                 13090099
131000             MOVE 'S900-FETCH-RECITM-CSR'                         13100099
131100                                 TO AA-PARAGRAPH-NAME             13110099
131200             MOVE 'UNSUCCESSFUL FETCH FROM RECITM_CSR'            13120099
131300                                 TO AA-DB2-OPERATION              13130099
131400             MOVE 'TPURITM'      TO AA-DB2-TABLE-1                13140099
131500             MOVE 'TRECITM'      TO AA-DB2-TABLE-2                13150099
131600             PERFORM Z999-DB2-ABEND                               13160099
131700     END-EVALUATE.                                                13170099
131800                                                                  13180099
131900                                                                  13190099
132000*---------------------------------------------------------------- 13200099
132100*    FETCH THE RECDIS_CSR CURSOR.                                 13210099
132200*---------------------------------------------------------------- 13220099
132300 T100-FETCH-RECDIS-CSR.                                           13230099
132400                                                                  13240099
132500     EXEC SQL                                                     13250099
132600         FETCH RECDIS_CSR                                         13260099
132700             INTO :RECDIS-ORD-LNE-NBR                             13270099
132800     END-EXEC.                                                    13280099
132900                                                                  13290099
133000     EVALUATE TRUE                                                13300099
133100         WHEN SQLCODE = ZERO                                      13310099
133200             SET RECDIS-MATCH TO TRUE                             13320099
133300             PERFORM S500-GET-CLASS-NBR                           13330099
133400                                                                  13340099
133500         WHEN SQLCODE = +100                                      13350099
133600             SET END-OF-RECDIS-CSR TO TRUE                        13360099
133700                                                                  13370099
133800         WHEN SQLWARN0 NOT = SPACES                               13380099
133900         WHEN SQLCODE  NOT = ZERO                                 13390099
134000             MOVE 'T100-FETCH-RECDIS-CSR'                         13400099
134100                                 TO AA-PARAGRAPH-NAME             13410099
134200             MOVE 'UNSUCCESSFUL FETCH FROM RECDIS_CSR'            13420099
134300                                 TO AA-DB2-OPERATION              13430099
134400             MOVE 'TRECDIS'      TO AA-DB2-TABLE-1                13440099
134500             MOVE SPACES         TO AA-DB2-TABLE-2                13450099
134600             PERFORM Z999-DB2-ABEND                               13460099
134700     END-EVALUATE.                                                13470099
134800                                                                  13480099
134900                                                                  13490099
135000*---------------------------------------------------------------- 13500099
135100*    FETCH THE CHARGE_CSR CURSOR.                                 13510099
135200*---------------------------------------------------------------- 13520099
135300 T200-FETCH-CHARGE-CSR.                                           13530099
135400                                                                  13540099
135500     EXEC SQL                                                     13550099
135600         FETCH CHARGE_CSR                                         13560099
135700             INTO :PV-CHARGE-CODE                                 13570099
135800                 ,:PV-TOT-CHARGE-AMT                              13580099
135900     END-EXEC.                                                    13590099
136000                                                                  13600099
136100     EVALUATE TRUE                                                13610099
136200         WHEN SQLCODE = ZERO                                      13620099
136300             SET CHARGE-FOUND TO TRUE                             13630099
136400                                                                  13640099
136500         WHEN SQLCODE = +100                                      13650099
136600             SET END-OF-CHARGE-CSR TO TRUE                        13660099
136700                                                                  13670099
136800         WHEN SQLWARN0 NOT = SPACES                               13680099
136900         WHEN SQLCODE  NOT = ZERO                                 13690099
137000             MOVE 'T200-FETCH-CHARGE-CSR'                         13700099
137100                                 TO AA-PARAGRAPH-NAME             13710099
137200             MOVE 'UNSUCCESSFUL FETCH FROM CHARGE_CSR'            13720099
137300                                 TO AA-DB2-OPERATION              13730099
137400             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                13740099
137500             MOVE 'TMDINVC'      TO AA-DB2-TABLE-2                13750099
137600             PERFORM Z999-DB2-ABEND                               13760099
137700     END-EVALUATE.                                                13770099
137800                                                                  13780099
137900                                                                  13790099
138000*---------------------------------------------------------------- 13800099
138100*    FETCH THE DC_RECDIS_CSR CURSOR.                              13810099
138200*---------------------------------------------------------------- 13820099
138300 T300-FETCH-DC-RECDIS-CSR.                                        13830099
138400                                                                  13840099
138500     EXEC SQL                                                     13850099
138600         FETCH DC_RECDIS_CSR                                      13860099
138700             INTO :RECDIS-ORD-LNE-NBR                             13870099
138800     END-EXEC.                                                    13880099
138900                                                                  13890099
139000     EVALUATE TRUE                                                13900099
139100         WHEN SQLCODE = ZERO                                      13910099
139200             SET DC-RECDIS-MATCH TO TRUE                          13920099
139300             PERFORM S500-GET-CLASS-NBR                           13930099
139400                                                                  13940099
139500         WHEN SQLCODE = +100                                      13950099
139600             SET END-OF-DC-RECDIS-CSR TO TRUE                     13960099
139700                                                                  13970099
139800         WHEN SQLWARN0 NOT = SPACES                               13980099
139900         WHEN SQLCODE  NOT = ZERO                                 13990099
140000             MOVE 'T300-FETCH-DC-RECDIS-CSR'                      14000099
140100                                 TO AA-PARAGRAPH-NAME             14010099
140200             MOVE 'UNSUCCESSFUL FETCH FROM DC_RECDIS_CSR'         14020099
140300                                 TO AA-DB2-OPERATION              14030099
140400             MOVE 'TRECDIS'      TO AA-DB2-TABLE-1                14040099
140500             MOVE SPACES         TO AA-DB2-TABLE-2                14050099
140600             PERFORM Z999-DB2-ABEND                               14060099
140700     END-EVALUATE.                                                14070099
140800                                                                  14080099
140900                                                                  14090099
141000*----------------------------------------------------------------*14100099
141100*    UPDATES LAST FREIGHT DATE ON TAPCNTL TABLE.                 *14110099
141200*----------------------------------------------------------------*14120099
141300 U100-UPDATE-TAPCNTL.                                             14130099
141400                                                                  14140099
141500     MOVE CURRENT-RUN-DATE TO APCNTL-LAST-FRGT-DTE.               14150099
141600                                                                  14160099
141700     EXEC SQL                                                     14170099
141800         UPDATE  TAPCNTL                                          14180099
141900            SET  LAST_FRGT_DTE = :APCNTL-LAST-FRGT-DTE            14190099
142000     END-EXEC.                                                    14200099
142100                                                                  14210099
142200     EVALUATE TRUE                                                14220099
142300         WHEN SQLCODE = ZERO                                      14230099
142400            CONTINUE                                              14240099
142500                                                                  14250099
142600         WHEN SQLWARN0 NOT = SPACES                               14260099
142700         WHEN SQLCODE NOT  = ZERO                                 14270099
142800            MOVE 'U100-UPDATE-TAPCNTL'                            14280099
142900                                TO AA-PARAGRAPH-NAME              14290099
143000            MOVE 'UNSUCCESSFUL UPDATE'                            14300099
143100                                TO AA-DB2-OPERATION               14310099
143200            MOVE 'TAPCNTL'      TO AA-DB2-TABLE-1                 14320099
143300            MOVE SPACES         TO AA-DB2-TABLE-2                 14330099
143400            PERFORM Z999-DB2-ABEND                                14340099
143500     END-EVALUATE.                                                14350099
143600                                                                  14360099
143700*----------------------------------------------------------------*14370099
143800*    WRITE RECORD TO EXTRACT FILE.                               *14380099
143900*----------------------------------------------------------------*14390099
144000 W100-WRITE-FREIGHT-EXTRACT.                                      14400099
144100                                                                  14410099
144200     WRITE FREIGHT-EXTRACT-REC FROM AP267-INPUT-RECORD.           14420099
144300                                                                  14430099
144400     ADD +1 TO PV-WRITTEN-COUNT.                                  14440099
144500                                                                  14450099
144600                                                                  14460099
144700*----------------------------------------------------------------*14470099
144800*    WRITE RECORD TO EXTRACT FILE.                               *14480099
144900*----------------------------------------------------------------*14490099
145000 W200-WRITE-EXTR500.                                              14500099
145100                                                                  14510099
145200     WRITE EXTRACT-OVER500-REC FROM AP267-INPUT-RECORD.           14520099
145300                                                                  14530099
145400     ADD +1 TO PV-OVER500-COUNT.                                  14540099
145500                                                                  14550099
145600                                                                  14560099
145700*---------------------------------------------------------------- 14570099
145800*    OPEN INVOICE_CSR CURSOR.                                     14580099
145900*---------------------------------------------------------------- 14590099
146000 X100-OPEN-INVOICE-CSR.                                           14600099
146100                                                                  14610099
146200     EXEC SQL                                                     14620099
146300         OPEN INVOICE_CSR                                         14630099
146400     END-EXEC.                                                    14640099
146500                                                                  14650099
146600     EVALUATE TRUE                                                14660099
146700         WHEN SQLCODE = ZERO                                      14670099
146800             SET INVOICE-CSR-OPEN TO TRUE                         14680099
146900                                                                  14690099
147000         WHEN SQLWARN0 NOT = SPACES                               14700099
147100         WHEN SQLCODE  NOT = ZERO                                 14710099
147200             MOVE 'X100-OPEN-INVOICE-CSR'                         14720099
147300                                 TO AA-PARAGRAPH-NAME             14730099
147400             MOVE 'UNSUCCESSFUL OPEN ON INVOICE_CSR'              14740099
147500                                 TO AA-DB2-OPERATION              14750099
147600             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                14760099
147700             MOVE SPACES         TO AA-DB2-TABLE-2                14770099
147800             PERFORM Z999-DB2-ABEND                               14780099
147900     END-EVALUATE.                                                14790099
148000                                                                  14800099
148100                                                                  14810099
148200*---------------------------------------------------------------- 14820099
148300*    OPEN RECEIVE_CSR CURSOR.                                     14830099
148400*---------------------------------------------------------------- 14840099
148500 X200-OPEN-RECEIVE-CSR.                                           14850099
148600                                                                  14860099
148700     EXEC SQL                                                     14870099
148800         OPEN RECEIVE_CSR                                         14880099
148900     END-EXEC.                                                    14890099
149000                                                                  14900099
149100     EVALUATE TRUE                                                14910099
149200         WHEN SQLCODE = ZERO                                      14920099
149300             CONTINUE                                             14930099
149400                                                                  14940099
149500         WHEN SQLWARN0 NOT = SPACES                               14950099
149600         WHEN SQLCODE  NOT = ZERO                                 14960099
149700             MOVE 'X200-OPEN-RECEIVE-CSR'                         14970099
149800                                 TO AA-PARAGRAPH-NAME             14980099
149900             MOVE 'UNSUCCESSFUL OPEN ON RECEIVE_CSR'              14990099
150000                                 TO AA-DB2-OPERATION              15000099
150100             MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                15010099
150200             MOVE SPACES         TO AA-DB2-TABLE-2                15020099
150300             PERFORM Z999-DB2-ABEND                               15030099
150400     END-EVALUATE.                                                15040099
150500                                                                  15050099
150600                                                                  15060099
150700*---------------------------------------------------------------- 15070099
150800*    OPEN REC_STORE_CSR CURSOR.                                   15080099
150900*---------------------------------------------------------------- 15090099
151000 X300-OPEN-REC-STORE-CSR.                                         15100099
151100                                                                  15110099
151200     EXEC SQL                                                     15120099
151300         OPEN REC_STORE_CSR                                       15130099
151400     END-EXEC.                                                    15140099
151500                                                                  15150099
151600     EVALUATE TRUE                                                15160099
151700         WHEN SQLCODE = ZERO                                      15170099
151800             CONTINUE                                             15180099
151900                                                                  15190099
152000         WHEN SQLWARN0 NOT = SPACES                               15200099
152100         WHEN SQLCODE  NOT = ZERO                                 15210099
152200             MOVE 'X300-OPEN-REC-STORE-CSR'                       15220099
152300                                 TO AA-PARAGRAPH-NAME             15230099
152400             MOVE 'UNSUCCESSFUL OPEN ON REC_STORE_CSR'            15240099
152500                                 TO AA-DB2-OPERATION              15250099
152600             MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                15260099
152700             MOVE SPACES         TO AA-DB2-TABLE-2                15270099
152800             PERFORM Z999-DB2-ABEND                               15280099
152900     END-EVALUATE.                                                15290099
153000                                                                  15300099
153100                                                                  15310099
153200*---------------------------------------------------------------- 15320099
153300*    OPEN RECITM_CSR CURSOR.                                      15330099
153400*---------------------------------------------------------------- 15340099
153500 X400-OPEN-RECITM-CSR.                                            15350099
153600                                                                  15360099
153700     EXEC SQL                                                     15370099
153800         OPEN RECITM_CSR                                          15380099
153900     END-EXEC.                                                    15390099
154000                                                                  15400099
154100     EVALUATE TRUE                                                15410099
154200         WHEN SQLCODE = ZERO                                      15420099
154300             CONTINUE                                             15430099
154400                                                                  15440099
154500         WHEN SQLWARN0 NOT = SPACES                               15450099
154600         WHEN SQLCODE  NOT = ZERO                                 15460099
154700             MOVE 'X400-OPEN-RECITM-CSR'                          15470099
154800                                 TO AA-PARAGRAPH-NAME             15480099
154900             MOVE 'UNSUCCESSFUL OPEN ON RECITM_CSR'               15490099
155000                                 TO AA-DB2-OPERATION              15500099
155100             MOVE 'TPURITM'      TO AA-DB2-TABLE-1                15510099
155200             MOVE 'TRECITM'      TO AA-DB2-TABLE-2                15520099
155300             PERFORM Z999-DB2-ABEND                               15530099
155400     END-EVALUATE.                                                15540099
155500                                                                  15550099
155600                                                                  15560099
155700*---------------------------------------------------------------- 15570099
155800*    OPEN RECDIS_CSR CURSOR.                                      15580099
155900*---------------------------------------------------------------- 15590099
156000 X500-OPEN-RECDIS-CSR.                                            15600099
156100                                                                  15610099
156200     EXEC SQL                                                     15620099
156300         OPEN RECDIS_CSR                                          15630099
156400     END-EXEC.                                                    15640099
156500                                                                  15650099
156600     EVALUATE TRUE                                                15660099
156700         WHEN SQLCODE = ZERO                                      15670099
156800             CONTINUE                                             15680099
156900                                                                  15690099
157000         WHEN SQLWARN0 NOT = SPACES                               15700099
157100         WHEN SQLCODE  NOT = ZERO                                 15710099
157200             MOVE 'X500-OPEN-RECDIS-CSR'                          15720099
157300                                 TO AA-PARAGRAPH-NAME             15730099
157400             MOVE 'UNSUCCESSFUL OPEN ON RECDIS_CSR'               15740099
157500                                 TO AA-DB2-OPERATION              15750099
157600             MOVE 'TRECDIS'      TO AA-DB2-TABLE-1                15760099
157700             MOVE SPACES         TO AA-DB2-TABLE-2                15770099
157800             PERFORM Z999-DB2-ABEND                               15780099
157900     END-EVALUATE.                                                15790099
158000                                                                  15800099
158100                                                                  15810099
158200*---------------------------------------------------------------- 15820099
158300*    OPEN CHARGE_CSR CURSOR.                                      15830099
158400*---------------------------------------------------------------- 15840099
158500 X600-OPEN-CHARGE-CSR.                                            15850099
158600                                                                  15860099
158700     EXEC SQL                                                     15870099
158800         OPEN CHARGE_CSR                                          15880099
158900     END-EXEC.                                                    15890099
159000                                                                  15900099
159100     EVALUATE TRUE                                                15910099
159200         WHEN SQLCODE = ZERO                                      15920099
159300             CONTINUE                                             15930099
159400                                                                  15940099
159500         WHEN SQLWARN0 NOT = SPACES                               15950099
159600         WHEN SQLCODE  NOT = ZERO                                 15960099
159700             MOVE 'X600-OPEN-CHARGE-CSR'                          15970099
159800                                 TO AA-PARAGRAPH-NAME             15980099
159900             MOVE 'UNSUCCESSFUL OPEN ON CHARGE_CSR'               15990099
160000                                 TO AA-DB2-OPERATION              16000099
160100             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                16010099
160200             MOVE 'TMDINVC'      TO AA-DB2-TABLE-2                16020099
160300             PERFORM Z999-DB2-ABEND                               16030099
160400     END-EVALUATE.                                                16040099
160500                                                                  16050099
160600                                                                  16060099
160700*---------------------------------------------------------------- 16070099
160800*    OPEN DC_RECDIS_CSR CURSOR.                                   16080099
160900*---------------------------------------------------------------- 16090099
161000 X700-OPEN-DC-RECDIS-CSR.                                         16100099
161100                                                                  16110099
161200     EXEC SQL                                                     16120099
161300         OPEN DC_RECDIS_CSR                                       16130099
161400     END-EXEC.                                                    16140099
161500                                                                  16150099
161600     EVALUATE TRUE                                                16160099
161700         WHEN SQLCODE = ZERO                                      16170099
161800             CONTINUE                                             16180099
161900                                                                  16190099
162000         WHEN SQLWARN0 NOT = SPACES                               16200099
162100         WHEN SQLCODE  NOT = ZERO                                 16210099
162200             MOVE 'X700-OPEN-DC-RECDIS-CSR'                       16220099
162300                                 TO AA-PARAGRAPH-NAME             16230099
162400             MOVE 'UNSUCCESSFUL OPEN ON DC_RECDIS_CSR'            16240099
162500                                 TO AA-DB2-OPERATION              16250099
162600             MOVE 'TRECDIS'      TO AA-DB2-TABLE-1                16260099
162700             MOVE SPACES         TO AA-DB2-TABLE-2                16270099
162800             PERFORM Z999-DB2-ABEND                               16280099
162900     END-EVALUATE.                                                16290099
163000                                                                  16300099
163100                                                                  16310099
163200*---------------------------------------------------------------- 16320099
163300*    CLOSE THE INVOICE_CSR CURSOR.                                16330099
163400*---------------------------------------------------------------- 16340099
163500 Y100-CLOSE-INVOICE-CSR.                                          16350099
163600                                                                  16360099
163700     EXEC SQL                                                     16370099
163800         CLOSE INVOICE_CSR                                        16380099
163900     END-EXEC.                                                    16390099
164000                                                                  16400099
164100     EVALUATE TRUE                                                16410099
164200         WHEN SQLCODE = ZERO                                      16420099
164300             SET INVOICE-CSR-CLOSED TO TRUE                       16430099
164400                                                                  16440099
164500         WHEN SQLWARN0 NOT = SPACES                               16450099
164600         WHEN SQLCODE  NOT = ZERO                                 16460099
164700             MOVE 'Y100-CLOSE-INVOICE-CSR'                        16470099
164800                                 TO AA-PARAGRAPH-NAME             16480099
164900             MOVE 'UNSUCCESSFUL CLOSE ON INVOICE_CSR'             16490099
165000                                 TO AA-DB2-OPERATION              16500099
165100             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                16510099
165200             MOVE SPACES         TO AA-DB2-TABLE-2                16520099
165300             PERFORM Z999-DB2-ABEND                               16530099
165400       END-EVALUATE.                                              16540099
165500                                                                  16550099
165600                                                                  16560099
165700*---------------------------------------------------------------- 16570099
165800*    CLOSE THE RECEIVE_CSR CURSOR.                                16580099
165900*---------------------------------------------------------------- 16590099
166000 Y200-CLOSE-RECEIVE-CSR.                                          16600099
166100                                                                  16610099
166200     EXEC SQL                                                     16620099
166300         CLOSE RECEIVE_CSR                                        16630099
166400     END-EXEC.                                                    16640099
166500                                                                  16650099
166600     EVALUATE TRUE                                                16660099
166700         WHEN SQLCODE = ZERO                                      16670099
166800             CONTINUE                                             16680099
166900                                                                  16690099
167000         WHEN SQLWARN0 NOT = SPACES                               16700099
167100         WHEN SQLCODE  NOT = ZERO                                 16710099
167200             MOVE 'Y200-CLOSE-RECEIVE-CSR'                        16720099
167300                                 TO AA-PARAGRAPH-NAME             16730099
167400             MOVE 'UNSUCCESSFUL CLOSE ON RECEIVE_CSR'             16740099
167500                                 TO AA-DB2-OPERATION              16750099
167600             MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                16760099
167700             MOVE SPACES         TO AA-DB2-TABLE-2                16770099
167800             PERFORM Z999-DB2-ABEND                               16780099
167900       END-EVALUATE.                                              16790099
168000                                                                  16800099
168100                                                                  16810099
168200*---------------------------------------------------------------- 16820099
168300*    CLOSE THE REC_STORE_CSR CURSOR.                              16830099
168400*---------------------------------------------------------------- 16840099
168500 Y300-CLOSE-REC-STORE-CSR.                                        16850099
168600                                                                  16860099
168700     EXEC SQL                                                     16870099
168800         CLOSE REC_STORE_CSR                                      16880099
168900     END-EXEC.                                                    16890099
169000                                                                  16900099
169100     EVALUATE TRUE                                                16910099
169200         WHEN SQLCODE = ZERO                                      16920099
169300             CONTINUE                                             16930099
169400                                                                  16940099
169500         WHEN SQLWARN0 NOT = SPACES                               16950099
169600         WHEN SQLCODE  NOT = ZERO                                 16960099
169700             MOVE 'Y300-CLOSE-REC-STORE-CSR'                      16970099
169800                                 TO AA-PARAGRAPH-NAME             16980099
169900             MOVE 'UNSUCCESSFUL CLOSE ON REC_STORE_CSR'           16990099
170000                                 TO AA-DB2-OPERATION              17000099
170100             MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                17010099
170200             MOVE SPACES         TO AA-DB2-TABLE-2                17020099
170300             PERFORM Z999-DB2-ABEND                               17030099
170400       END-EVALUATE.                                              17040099
170500                                                                  17050099
170600                                                                  17060099
170700*---------------------------------------------------------------- 17070099
170800*    CLOSE THE RECITM_CSR CURSOR.                                 17080099
170900*---------------------------------------------------------------- 17090099
171000 Y400-CLOSE-RECITM-CSR.                                           17100099
171100                                                                  17110099
171200     EXEC SQL                                                     17120099
171300         CLOSE RECITM_CSR                                         17130099
171400     END-EXEC.                                                    17140099
171500                                                                  17150099
171600     EVALUATE TRUE                                                17160099
171700         WHEN SQLCODE = ZERO                                      17170099
171800             CONTINUE                                             17180099
171900                                                                  17190099
172000         WHEN SQLWARN0 NOT = SPACES                               17200099
172100         WHEN SQLCODE  NOT = ZERO                                 17210099
172200             MOVE 'Y400-CLOSE-RECITM-CSR'                         17220099
172300                                 TO AA-PARAGRAPH-NAME             17230099
172400             MOVE 'UNSUCCESSFUL CLOSE ON RECITM_CSR'              17240099
172500                                 TO AA-DB2-OPERATION              17250099
172600             MOVE 'TPURITM'      TO AA-DB2-TABLE-1                17260099
172700             MOVE 'TRECITM'      TO AA-DB2-TABLE-2                17270099
172800             PERFORM Z999-DB2-ABEND                               17280099
172900       END-EVALUATE.                                              17290099
173000                                                                  17300099
173100                                                                  17310099
173200*---------------------------------------------------------------- 17320099
173300*    CLOSE THE RECDIS_CSR CURSOR.                                 17330099
173400*---------------------------------------------------------------- 17340099
173500 Y500-CLOSE-RECDIS-CSR.                                           17350099
173600                                                                  17360099
173700     EXEC SQL                                                     17370099
173800         CLOSE RECDIS_CSR                                         17380099
173900     END-EXEC.                                                    17390099
174000                                                                  17400099
174100     EVALUATE TRUE                                                17410099
174200         WHEN SQLCODE = ZERO                                      17420099
174300             CONTINUE                                             17430099
174400                                                                  17440099
174500         WHEN SQLWARN0 NOT = SPACES                               17450099
174600         WHEN SQLCODE  NOT = ZERO                                 17460099
174700             MOVE 'Y500-CLOSE-RECDIS-CSR'                         17470099
174800                                 TO AA-PARAGRAPH-NAME             17480099
174900             MOVE 'UNSUCCESSFUL CLOSE ON RECDIS_CSR'              17490099
175000                                 TO AA-DB2-OPERATION              17500099
175100             MOVE 'TRECDIS'      TO AA-DB2-TABLE-1                17510099
175200             MOVE SPACES         TO AA-DB2-TABLE-2                17520099
175300             PERFORM Z999-DB2-ABEND                               17530099
175400       END-EVALUATE.                                              17540099
175500                                                                  17550099
175600                                                                  17560099
175700*---------------------------------------------------------------- 17570099
175800*    CLOSE THE CHARGE_CSR CURSOR.                                 17580099
175900*---------------------------------------------------------------- 17590099
176000 Y600-CLOSE-CHARGE-CSR.                                           17600099
176100                                                                  17610099
176200     EXEC SQL                                                     17620099
176300         CLOSE CHARGE_CSR                                         17630099
176400     END-EXEC.                                                    17640099
176500                                                                  17650099
176600     EVALUATE TRUE                                                17660099
176700         WHEN SQLCODE = ZERO                                      17670099
176800             CONTINUE                                             17680099
176900                                                                  17690099
177000         WHEN SQLWARN0 NOT = SPACES                               17700099
177100         WHEN SQLCODE  NOT = ZERO                                 17710099
177200             MOVE 'Y600-CLOSE-CHARGE-CSR'                         17720099
177300                                 TO AA-PARAGRAPH-NAME             17730099
177400             MOVE 'UNSUCCESSFUL CLOSE ON CHARGE_CSR'              17740099
177500                                 TO AA-DB2-OPERATION              17750099
177600             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                17760099
177700             MOVE 'TMDINVC'      TO AA-DB2-TABLE-2                17770099
177800             PERFORM Z999-DB2-ABEND                               17780099
177900       END-EVALUATE.                                              17790099
178000                                                                  17800099
178100                                                                  17810099
178200*---------------------------------------------------------------- 17820099
178300*    CLOSE THE DC_RECDIS_CSR CURSOR.                              17830099
178400*---------------------------------------------------------------- 17840099
178500 Y700-CLOSE-DC-RECDIS-CSR.                                        17850099
178600                                                                  17860099
178700     EXEC SQL                                                     17870099
178800         CLOSE DC_RECDIS_CSR                                      17880099
178900     END-EXEC.                                                    17890099
179000                                                                  17900099
179100     EVALUATE TRUE                                                17910099
179200         WHEN SQLCODE = ZERO                                      17920099
179300             CONTINUE                                             17930099
179400                                                                  17940099
179500         WHEN SQLWARN0 NOT = SPACES                               17950099
179600         WHEN SQLCODE  NOT = ZERO                                 17960099
179700             MOVE 'Y700-CLOSE-DC-RECDIS-CSR'                      17970099
179800                                 TO AA-PARAGRAPH-NAME             17980099
179900             MOVE 'UNSUCCESSFUL CLOSE ON DC_RECDIS_CSR'           17990099
180000                                 TO AA-DB2-OPERATION              18000099
180100             MOVE 'TRECDIS'      TO AA-DB2-TABLE-1                18010099
180200             MOVE SPACES         TO AA-DB2-TABLE-2                18020099
180300             PERFORM Z999-DB2-ABEND                               18030099
180400       END-EVALUATE.                                              18040099
180500                                                                  18050099
180600                                                                  18060099
180700*----------------------------------------------------------------*18070099
180800*    ABEND ROUTINE                                               *18080099
180900*----------------------------------------------------------------*18090099
181000 Z998-ABEND.                                                      18100099
181100                                                                  18110099
181200     CLOSE FREIGHT-EXTRACT-FILE                                   18120099
181300           EXTRACT-OVER500-FILE.                                  18130099
181400                                                                  18140099
181500     DISPLAY AA-ABEND-LIT.                                        18150099
181600     DISPLAY AA-PROGRAM-LIT.                                      18160099
181700     DISPLAY AA-PARAGRAPH-LIT.                                    18170099
181800     DISPLAY AA-MESSAGE-LINE-1.                                   18180099
181900     DISPLAY AA-MESSAGE-LINE-2.                                   18190099
182000                                                                  18200099
182100     CALL 'ILBOABN0' USING ABEND-CODE.                            18210099
182200                                                                  18220099
182300                                                                  18230099
182400*----------------------------------------------------------------*18240099
182500*    DB2 ABEND ROUTINE                                           *18250099
182600*----------------------------------------------------------------*18260099
182700 Z999-DB2-ABEND.                                                  18270099
182800                                                                  18280099
182900     CLOSE FREIGHT-EXTRACT-FILE                                   18290099
183000           EXTRACT-OVER500-FILE.                                  18300099
183100                                                                  18310099
183200     DISPLAY AA-ABEND-LIT.                                        18320099
183300     DISPLAY AA-MESSAGE-LINE-1.                                   18330099
183400     DISPLAY AA-MESSAGE-LINE-2.                                   18340099
183500     DISPLAY AA-DB2-ERROR-LIT.                                    18350099
183600     DISPLAY AA-PROGRAM-LIT.                                      18360099
183700     DISPLAY AA-PARAGRAPH-LIT.                                    18370099
183800     DISPLAY AA-DB2-OPERATION-LIT.                                18380099
183900     DISPLAY AA-DB2-TABLE-1.                                      18390099
184000     DISPLAY AA-DB2-TABLE-2.                                      18400099
184100     SET AC-DB2-ERROR TO TRUE.                                    18410099
184200                                                                  18420099
184300     COPY DPPD004.                                                18430099
184400                                                                  18440099
184500     CALL 'ILBOABN0' USING ABEND-CODE.                            18450099
184600                                                                  18460099
