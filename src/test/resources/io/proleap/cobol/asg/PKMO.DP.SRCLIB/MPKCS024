000100******************************************************************00010060
000200 IDENTIFICATION DIVISION.                                         00020060
000300******************************************************************00030060
000400                                                                  00040060
121313 PROGRAM-ID.             MPKCS024.                                00050060
121313*PROGRAM-ID.             "MPKCS024".                              00050060
000600 AUTHOR.                 WILLIAM B. BURT.                         00060060
000700 INSTALLATION.           KOHLS.                                   00070060
000800 DATE-WRITTEN            APRIL, 1991.                             00080060
000900 DATE-COMPILED.                                                   00090060
001000                                                                  00100060
001100******************************************************************00110060
001200* CERTIFICATION CONTROL PROGRAM.                                  00120060
001300* THIS PROGRAM DISPLAYS A SCREEN ON THE LRT (LASER RADIO TERMINAL)00130060
001400******************************************************************00140060
W3502S* 06/04/13 - JALAJ KUMAR - WR NO.W3502S                                   
W3502S*1)THE EMS LAYER IS USED TO CARRY THE MESSAGES OF INSERT, UPDATES         
W3502S*  AND DELETES TO THE BW SERVICE LAYER.                                   
W3502S*2)7700-INSERT-MDM-UPC CREATES A UPC USING SKU NUMBER AND                 
W3502S*  UPC_TYPE_CDE IN MDM.                                                   
W3502S*  WITH SUCCESFUL UPC CREATION 7800-INSERT-MDM-VND-ASSN CREATES           
W3502S*  VENDORUPC USING NRFCOLORCODE, KOHLSSIZECODE,                           
W3502S*  UPCNUMBER,  NRFSIZECODE, ENTERPRISEIDENTIFIER,                         
W3502S*  VENDORCOLORDESCRIPTION, EDIORDERINDICATOR.                             
W3502S*3)IF VENDOR-UPC CREATION FAILS IN MDM THEN 7900-DELETE-MDM-UPC           
W3502S*  IS CALLED WHICH DELETES THE UPC CREATED.                               
W3502S*4)AFTER THE SUCCESSFUL CREATION OF UPC AND VENDOR-UPC IN                 
W3502S*  MDM 7950-UPDATE-MDM-UPC IS CALLED WHICH UPDATES THE                    
W3502S*  EDI ORDER INDICATOR IN MDM.                                            
121313* 12/13/13 - ROHAN DUA - WR NO.121313                                     
121313* EMS-LAYER WAS CONVERTED TO MQ BRIDGE                                    
001600******************************************************************00160060
001600  CHANGED  02/14/2023    JEAN KURK              CHG0281369       *00160060
001600                 CHANGE CALL OF UPC CHECK DIGIT ROUTINE DYNAMIC  *00160060
001600******************************************************************00160060
001700 ENVIRONMENT DIVISION.                                            00170060
001800******************************************************************00180060
001900                                                                  00190060
002000******************************************************************00200060
002100 DATA DIVISION.                                                   00210060
002200******************************************************************00220060
002300                                                                  00230060
002400******************************************************************00240060
002500 WORKING-STORAGE SECTION.                                         00250060
002600******************************************************************00260060
002700*                                                                 00270060
002800 01  CA-COMMAREA.                                                 00280060
002900     05  CA-COMMON-DATA.                                          00290060
003000         10  CA-TRANSACTION-STATUS       PIC  X(01)  VALUE SPACE. 00300060
003100             88  CA-INITIALIZE-SCREEN                VALUE 'S'.   00310060
003200             88  CA-PROCESS-SCREEN                   VALUE 'R'.   00320060
003300         10  CA-LAST-PROGRAM             PIC  X(08)  VALUE SPACE. 00330060
003400     05  CA-PROGRAM-DATA.                                         00340060
003500         10  CA-ACTION-CODE              PIC  X(02)  VALUE SPACE. 00350060
003600             88  CA-CERTIFICATION-REQUIRED           VALUE '10'.  00360060
003700             88  CA-INSERT-SUCCESSFUL                VALUE '11'.  00370060
003800             88  CA-NO-SCAN                          VALUE '20'.  00380060
003900             88  CA-DECERTIFY-ALL-UPCS-FOR-SKU       VALUE '21'.  00390060
004000             88  CA-SKU-MISMATCH-DECERT-SCANNED      VALUE '30'.  00400060
004100             88  CA-NEW-VENDOR-UPC-LOADED            VALUE '40'.  00410060
004200             88  CA-DANGLING-UPC                     VALUE '50'.  00420060
004300             88  CA-NO-UPC-ON-MERCHANDISE            VALUE '60'.  00430060
004400         10  CA-OPER-UNT-ID              PIC S9(4)   VALUE ZEROS  00440060
004500                                                     COMP.        00450060
004600         10  CA-FCLTY-ID                 PIC S9(4)   VALUE ZEROS  00460060
004700                                                     COMP.        00470060
004800         10  CA-PO-NBR-X                 PIC  X(08)  VALUE SPACE. 00480060
004900         10  CA-PO-NBR  REDEFINES  CA-PO-NBR-X                    00490060
005000                                         PIC  9(08).              00500060
005100         10  CA-REC-SEQ-NBR-X            PIC  X(03)  VALUE SPACE. 00510060
005200         10  CA-REC-SEQ-NBR    REDEFINES  CA-REC-SEQ-NBR-X        00520060
005300                                         PIC  9(03).              00530060
005400         10  CA-LINE-ITEM-NBR-X          PIC  X(04)  VALUE SPACE. 00540060
005500         10  CA-LINE-ITEM-NBR  REDEFINES  CA-LINE-ITEM-NBR-X      00550060
005600                                         PIC  9(04).              00560060
005700** INCREASED CA-SEQ-NBR FROM X(3) TO X(8)                         00570080
005800         10  CA-SKU-NBR.                                          00580080
005900             15  CA-MERCH-DEPT-NBR       PIC  X(03)  VALUE SPACE. 00590080
006000             15  FILLER                  PIC  X(01)  VALUE SPACE. 00600080
006100             15  CA-MERCH-CLASS-NBR      PIC  X(02)  VALUE SPACE. 00610080
006200             15  FILLER                  PIC  X(01)  VALUE SPACE. 00620080
006300             15  CA-SEQ-NBR              PIC  X(08)  VALUE SPACE. 00630080
006400         10  CA-CURRENT-UNIT-RETAIL-AMOUNT                        00640060
006500                                         PIC  9(04)V9(02)         00650060
006600                                                     VALUE ZEROS. 00660060
006700         10  CA-SKU-DESC                 PIC  X(19)  VALUE SPACE. 00670060
006800         10  CA-SIZE-DESC                PIC  X(05)  VALUE SPACE. 00680060
006900         10  CA-COLOR-DESC               PIC  X(04)  VALUE SPACE. 00690060
007000         10  CA-FORMATTED-GROUP-PRICING  PIC  X(10)  VALUE SPACE. 00700060
007100         10  CA-VENDOR-STYLE-CODE        PIC  X(15)  VALUE SPACE. 00710060
007200         10  CA-IN-HOUSE-VENDOR-NAME     PIC  X(19)  VALUE SPACE. 00720060
007300         10  CA-ITEM-NBR                 PIC S9(15)  VALUE ZEROS  00730060
007400                                                     COMP-3.      00740060
007500         10  CA-UPC-NBR-X                PIC  X(13)  VALUE SPACE. 00750060
007600         10  CA-UPC-NBR  REDEFINES  CA-UPC-NBR-X                  00760060
007700                                         PIC  9(13).              00770060
007800         10  CA-UPC-FIRST-12  REDEFINES  CA-UPC-NBR-X.            00780060
007900             15  CA-FIRST-TWELVE-BYTES-OF-UPC                     00790060
008000                                         PIC  9(12).              00800060
008100             15  CA-CHECK-DIGIT          PIC  X(01).              00810060
008200         10  CA-UPC-LAST-12  REDEFINES CA-UPC-NBR-X.              00820060
008300             15  CA-FIRST-DIGIT-COUNTRY-CODE                      00830060
008400                                         PIC  X(01).              00840060
008500             15  CA-LAST-TWELVE-BYTES-OF-UPC                      00850060
008600                                         PIC  9(12).              00860060
008700         10  CA-MISMATCHED-ITEM-NBR      PIC S9(15)  VALUE ZEROS  00870060
008800                                                     COMP-3.      00880060
008900         10  CA-MDSE-PRC-AREA-CDE        PIC  X(06)  VALUE SPACE. 00890060
009000         10  CA-MISMATCHED-UPC-NBR       PIC S9(15)  VALUE ZEROS  00900060
009100                                                     COMP-3.      00910060
009200                                                                  00920060
121313*----------------------------------------------------------------         
121313*   MQ CREDENTIALS                                                        
121313*----------------------------------------------------------------         
121313   01  UP003-MQ-CREDENTIALS.                                              
121313       05  UP003-MQ-USER-ID          PIC X(08) VALUE SPACES.              
121313       05  UP003-MQ-PASSWORD         PIC X(62) VALUE SPACES.              
121313       05  UP003-MQ-ENTERPRISE       PIC X(10) VALUE SPACES.              
121313*----------------------------------------------------------------         
121313*   MQ VARIABLES                                                          
121313*----------------------------------------------------------------         
121313 01 PV-MQ-VARIABLES.                                                      
121313    05  PV-STATUS                    PIC  X(30).                          
121313    05  PV-ACTION                    PIC  X(01)  VALUE SPACES.            
121313    05  PV-MQ-OUT-RESPONSE           PIC  X(2000).                        
121313    05  PV-JOB-NUMBER                PIC  9(10)   VALUE ZERO.             
121313    05  PV-JOB-NUMBER-X              PIC  X(10)   VALUE SPACE.            
121313    05  PV-QUERY-IDENTIFIER          PIC  X(10).                          
121313    05  PV-ROWS-RETURNED             PIC  9(10)   VALUE ZERO.             
121313    05  PV-ROWS-RETURNED-X           PIC  X(10).                          
121313    05  PV-OPER-ATTEMPTED            PIC X(20).                           
121313    05  PV-PARAGRAPH-NAME            PIC X(20).                           
121313    05  PV-UPC-UPC-NBR               PIC 9(15).                           
121313    05  PV-ENT-ID                    PIC 9(09).                           
121313    05  PV-UNT-COST-1ST-AMT          PIC 9(07).9(03).                     
121313    05  PV-LNDD-UCST-AMT             PIC X(10) VALUE SPACES.              
121313    05  PV-UPC-VS-ID                 PIC 9(09).                           
121313    05  PV-UPC-KOHLS-SIZE-CDE        PIC 9(05).                           
121313    05  PV-ABEND-CODE                PIC S9(04) VALUE +1.                 
121313    05  PV-CONTROL-URL               PIC X(50).                           
121313    05  PV-RESPONSE-CODE1            PIC  X(05).                          
121313    05  PV-RESPONSE-CODE2            PIC  X(05).                          
121313                                                                          
121313******************************************************************        
121313*    COPYBOOK FOR MQ VARIABLES.                                           
121313******************************************************************        
121313     COPY UPWS009.                                                        
121313                                                                          
121313******************************************************************        
121313* OBJECT DESCRIPTOR STRUCTURE                                             
121313******************************************************************        
121313 01  MQM-OBJECT-DESCRIPTOR.                                               
121313     COPY CMQODV.                                                         
121313                                                                          
121313******************************************************************        
121313* MESSAGE DESCRIPTOR STRUCTURE                                            
121313******************************************************************        
121313 01  MQM-MESSAGE-DESCRIPTOR.                                              
121313     COPY CMQMDV.                                                         
121313                                                                          
121313******************************************************************        
121313* GET MESSAGE OPTIONS STRUCTURE                                           
121313******************************************************************        
121313 01  MQM-GET-MESSAGE-OPTIONS.                                             
121313     COPY CMQGMOV.                                                        
121313                                                                          
121313******************************************************************        
121313* PUT MESSAGE OPTIONS STRUCTURE                                           
121313******************************************************************        
121313 01  MQM-PUT-MESSAGE-OPTIONS.                                             
121313     COPY CMQPMOV.                                                        
121313                                                                          
121313******************************************************************        
121313* MQV CONTAINS CONSTANTS FOR FILLING IN THE CONTROL BLOCKS                
121313* AND RETURN CODES FOR TESTING THE RESULT OF A CALL.                      
121313******************************************************************        
121313 01  MQM-CONSTANTS.                                                       
121313     COPY CMQV.                                                           
121313                                                                          
121313******************************************************************        
121313* ASPECT AND FILTER COPYBOOK                                              
121313******************************************************************        
121313     COPY UPWS001.                                                        
121313     COPY UPWS004.                                                        
121313                                                                          
121313****************************************************************          
009300 01  PC-PROGRAM-CONSTANTS.                                        00930060
009400     05  PC-TRANID                       PIC  X(04)  VALUE 'M024'.00940060
009500     05  PC-MDSE-PROCESSING-MENU-TRANID  PIC  X(04)  VALUE 'M028'.00950060
009600     05  PC-MAX-RETRIES                  PIC S9(04)  VALUE +3     00960060
009700                                                     COMP SYNC.   00970060
009800     05  PC-ROW-NOT-FOUND                PIC S9(04)  VALUE +100   00980060
009900                                                     COMP SYNC.   00990060
010000     05  PC-COMMAREA-LENGTH              PIC S9(04)  VALUE +166   01000060
010100                                                     COMP SYNC.   01010060
010200     05  PC-COMMAREA-LENGTH2             PIC S9(04)  VALUE +166   01020060
010300                                                     COMP SYNC.   01030060
010400     05  PC-CENTURY-CHECK                PIC S9(04)  VALUE +90    01040060
010500                                                     COMP SYNC.   01050060
010600     05  PC-KOHLS-INTERNAL-UPC-IND       PIC  9(01)  VALUE 4.     01060060
010700     05  PC-USA-COUNTRY-CODE             PIC  9(01)  VALUE 0.     01070060
010800     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        01080060
010900         'MPKCS024'.                                              01090060
011000     05  PC-UPC-CERTIFY-SELECTION-PGM    PIC  X(08)  VALUE        01100060
011100         'MPKCS023'.                                              01110060
011200     05  PC-DB2-DATABASE-ERROR-MSG       PIC  X(19)  VALUE        01120060
011300         'DB2 ACCESS ERROR   '.                                   01130060
011400     05  PC-CICS-ERROR-MSG               PIC  X(19)  VALUE        01140060
011500         'CICS ACCESS ERROR  '.                                   01150060
011600     05  PC-UNRECOGNIZED-PF-KEY-MSG      PIC  X(19)  VALUE        01160060
011700         'UNRECOGNIZED PF KEY'.                                   01170060
011800     05  PC-ENTER-THROUGH-MENU-MSG       PIC  X(19)  VALUE        01180060
011900         'ENTER THROUGH MENU '.                                   01190060
012000     05  PC-TRANS-UNAVAILABLE-MSG        PIC  X(19)  VALUE        01200060
012100         'TRANS NOT AVAILABLE'.                                   01210060
012200     05  PC-UPC-NOT-NUMERIC-MSG          PIC  X(19)  VALUE        01220060
012300         'UPC NOT NUMERIC    '.                                   01230060
012400     05  PC-UPC-NOT-VALID-MSG            PIC  X(19)  VALUE        01240060
012500         'UPC NOT VALID      '.                                   01250060
012600     05  PC-UPC-CERTIFIED-MSG            PIC  X(19)  VALUE        01260060
012700         'UPC CERTIFIED      '.                                   01270060
012800     05  PC-UPCS-DECERTIFIED-MSG         PIC  X(19)  VALUE        01280060
012900         'UPCS DECERTIFIED   '.                                   01290060
013000     05  PC-UPC-DECERTIFIED-MSG          PIC  X(19)  VALUE        01300060
013100         'UPC DECERTIFIED   '.                                    01310060
013200     05  PC-SKU-MISMATCH-LINE1-MSG       PIC  X(19)  VALUE        01320060
013300         'SKU MISMATCH - UPC '.                                   01330060
013400     05  PC-SKU-MISMATCH-LINE2-MSG       PIC  X(19)  VALUE        01340060
013500         'ASSOCIATED WITH SKU'.                                   01350060
013600     05  PC-SKU-MISMATCH-LINE3-MSG.                               01360060
013700         10  FILLER                      PIC  X(01)  VALUE SPACE. 01400060
013800         10  PC-MISMATCHED-SKU           PIC  X(15)  VALUE SPACE. 01390080
013900         10  FILLER                      PIC  X(03)  VALUE SPACE. 01400060
014000     05  PC-SKU-MISMATCH-TUPC-LINE1-MSG  PIC  X(19)  VALUE        01410060
014100         'UPC NOT ASSOCIATED '.                                   01420060
014200     05  PC-SKU-MISMATCH-TUPC-LINE2-MSG.                          01430060
014300         10  FILLER                      PIC  X(09)  VALUE        01440060
014400             'WITH SKU:'.                                         01450060
014500         10  PC-MISMATCHED-SKU-TUPC      PIC  X(15)  VALUE SPACE. 01460080
014600     05  PC-UPC-INVALID-LINE1-MSG        PIC  X(19)  VALUE        01470060
014700         'INVALID UPC -      '.                                   01480060
014800     05  PC-UPC-INVALID-LINE2-MSG        PIC  X(19)  VALUE        01490060
014900         'NOT CERTIFIED      '.                                   01500060
015000     05  PC-DECERT-INVALID-LINE1-MSG     PIC  X(19)  VALUE        01510060
015100         'KOHLS INTERNAL UPC '.                                   01520060
015200     05  PC-DECERT-INVALID-LINE2-MSG     PIC  X(19)  VALUE        01530060
015300         'DECERTIFICATION    '.                                   01540060
015400     05  PC-DECERT-INVALID-LINE3-MSG     PIC  X(19)  VALUE        01550060
015500         'PROCESS NOT VALID  '.                                   01560060
015600     05  PC-INVALID-SKU-MSG              PIC  X(19)  VALUE        01570060
015700         'INVALID SKU        '.                                   01580060
015800     05  PC-UPC-DECERT-NOT-ALLOWED-MSG   PIC  X(19)  VALUE        01590060
015900         'DECERT NOT ALLOWED '.                                   01600060
016000     05  PC-LOWEST-INTERNAL-UPC-NMBR     PIC S9(15)V VALUE        01610060
016100         000400000000000                             COMP-3.      01620060
016200     05  PC-HIGHEST-INTERNAL-UPC-NMBR    PIC S9(15)V VALUE        01630060
016300         000499999999999                             COMP-3.      01640060
016400     05  PC-DEPT-MDSELV-CDE              PIC  X(03)  VALUE 'DPT'. 01650060
016500     05  PC-OPERCO-NBR                   PIC  X(02)  VALUE '03'.  01660060
016600     05  PC-UPC-TYP-CDE-VENDOR           PIC  X      VALUE 'V'.   01670060
016700     05  PC-UPC-TYP-CDE-RENUMBERED       PIC  X      VALUE 'R'.   01680060
016800     05  PC-UPC-SRC-CERT                 PIC  X      VALUE 'C'.   01690060
016900     05  PC-PRIME1                       PIC S9(05)  COMP-3       01700060
017000                                                     VALUE +38543.01710060
017100     05  PC-PRIME2                       PIC S9(05)  COMP-3       01720060
017200                                                     VALUE +58889.01730060
017300     05  PC-ONE-BILLION                  PIC S9(11)  COMP-3       01740060
017400                                                VALUE +1000000000.01750060
W3502S     05  PC-UPC-RPLNMT-IND               PIC X(01) VALUE 'N'.     01740060
W3502S     05  PC-UPC-RPLNMT-IND-Y             PIC X(01) VALUE 'Y'.     01740060
017500*                                                                 01760060
017600 01  PS-PROGRAM-SWITCHES.                                         01770060
017700     05  PS-UPC-FOUND-IND                PIC  X(01)  VALUE 'N'.   01780060
017800         88  PS-UPC-FOUND                            VALUE 'N'.   01790060
017900         88  PS-UPC-NOT-FOUND                        VALUE 'Y'.   01800060
018000     05  PS-UPC-FOUND-ON-TUPC-IND        PIC  X(01)  VALUE 'Y'.   01810060
018100         88  PS-UPC-FOUND-ON-TUPC                    VALUE 'Y'.   01820060
018200         88  PS-UPC-NOT-FOUND-ON-TUPC                VALUE 'N'.   01830060
018300     05  PS-DANGLING-UPC-IND             PIC  X(01)  VALUE 'N'.   01840060
018400         88  PS-NON-DANGLING-UPC                     VALUE 'N'.   01850060
018500         88  PS-DANGLING-UPC                         VALUE 'Y'.   01860060
018600     05  PS-EDIT-ERROR-IND               PIC  X(01)  VALUE 'N'.   01870060
018700         88  PS-NO-EDIT-ERROR                        VALUE 'N'.   01880060
018800         88  PS-EDIT-FAILED                          VALUE 'Y'.   01890060
018900     05  PS-SKU-RENUMBERED-IND           PIC  X(01)  VALUE 'N'.   01900060
019000         88  PS-SKU-NOT-RENUMBERED                   VALUE 'N'.   01910060
019100         88  PS-SKU-RENUMBERED                       VALUE 'Y'.   01920060
019200     05  PS-UPDATE-INTERNAL-UPC-IND      PIC  X(01)  VALUE 'N'.   01930060
019300         88  PS-NO-UPDATE-OF-INTERNAL-UPC            VALUE 'N'.   01940060
019400         88  PS-UPDATE-INTERNAL-UPC                  VALUE 'Y'.   01950060
           05  PS-ON-PK-UPC-IND                PIC S9(01)  COMP-3       01810060
                                                           VALUE ZERO.  01810060
               88  PS-UPC-FOUND-ON-PK-UPC                  VALUE 1.     01820060
               88  PS-UPC-NOT-FOUND-ON-PK-UPC              VALUE ZERO.  01830060
019500*                                                                 01960060
019600 01  PV-PROGRAM-VARIABLES.                                        01970060
019700     05  PV-MESSAGE-AREA                 PIC  X(19)  VALUE SPACE. 01980060
019800     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  01990060
019900                                                     COMP SYNC.   02000060
020000     05  PV-INVALID-CHECK-DIGIT-MSG.                              02010060
020100         10  FILLER                      PIC  X(17)  VALUE        02020060
020200             'CORRECT CKDGT IS '.                                 02030060
020300         10  PV-COMPUTED-UPC-CHECK-DIGIT                          02040060
020400                                         PIC  9(01)  VALUE ZERO.  02050060
020500         10  FILLER                      PIC  X(02)  VALUE SPACE. 02060060
020600     05  PV-UPC-NBR                      PIC S9(15)  VALUE ZEROS  02070060
020700                                                     COMP-3.      02080060
020800     05  PV-UPC-ID                       PIC S9(9)   COMP.        02090060
020900     05  PV-UPC-NBR-BREAKDOWN            PIC  9(13)  VALUE ZEROS. 02100060
021000     05  FILLER REDEFINES PV-UPC-NBR-BREAKDOWN.                   02110060
021100         10  PV-NBR-SYSTEM               PIC  9(02).              02120060
021200         10  FILLER  REDEFINES  PV-NBR-SYSTEM.                    02130060
021300             15  PV-UPC-COUNTRY-CODE     PIC  9(01).              02140060
021400             15  PV-UPC-NBR-SYSTEM-CHAR  PIC  9(01).              02150060
021500         10  PV-UPC-VENDOR-NBR           PIC  9(05).              02160060
021600         10  PV-UPC-ITEM-NBR             PIC  9(05).              02170060
021700         10  PV-UPC-CKDGT                PIC  9(01).              02180060
021800                                                                  02190060
021900     05  PV-INTERNAL-FIELDS.                                      02200060
022000         10  PV-INTERNAL-UPC-ID          PIC S9(9)   COMP.        02210060
022100         10  PV-INTERNAL-UPC-NBR         PIC S9(15)  VALUE ZERO   02220060
022200                                                     COMP-3.      02230060
022300         10  PV-INTERNAL-SUB-CL-MDSEAR-ID                         02240060
022400                                         PIC  S9(6)V COMP-3.      02250060
022500         10  PV-INTERNAL-VS-ID           PIC  S9(9)  COMP.        02260060
022600         10  PV-INTERNAL-KOHLS-SIZE-CDE  PIC  S9(9)  COMP.        02270060
022700         10  PV-INTERNAL-NRF-CLOR-CDE    PIC   X(3).              02280060
022800         10  PV-INTERNAL-GP-CDE          PIC   X(3).              02290060
022900         10  PV-INTERNAL-INNR-PK-QTY     PIC  S9(4)  COMP.        02300060
023000         10  PV-INTERNAL-OUTR-PK-QTY     PIC  S9(4)  COMP.        02310060
023100         10  PV-INTERNAL-SEA-SEQ-NBR     PIC  S9(4)  COMP.        02320060
023200*        10 PV-INTERNAL-PATRN-SEQ-NBR    PIC  S9(4)  COMP.        02330072
023300*        10 PV-INTERNAL-TRND-SEQ-NBR     PIC  S9(4)  COMP.        02340073
023400*        10 PV-INTERNAL-FBRCN-SEQ-NBR    PIC  S9(4)  COMP.        02350073
023500*        10 PV-INTERNAL-FNSH-SEQ-NBR     PIC  S9(4)  COMP.        02360073
023600         10  PV-INTERNAL-INTR-UPC-DESC   PIC   X(30).             02370074
023700                                                                  02380060
023800     05  PV-SELECT-COUNTER               PIC S9(04)  VALUE +0     02390060
023900                                                     COMP SYNC.   02400060
024000     05  PV-DELETE-COUNTER               PIC S9(04)  VALUE +0     02410060
024100                                                     COMP SYNC.   02420060
024200     05  PV-INSERT-COUNTER               PIC S9(04)  VALUE +0     02430060
024300                                                     COMP SYNC.   02440060
024400     05  PV-UPDATE-COUNTER               PIC S9(04)  VALUE +0     02450060
024500                                                     COMP SYNC.   02460060
024600     05  PV-OPEN-COUNTER                 PIC S9(04)  VALUE +0     02470060
024700                                                     COMP SYNC.   02480060
024800     05  PV-CLOSE-COUNTER                PIC S9(04)  VALUE +0     02490060
024900                                                     COMP SYNC.   02500060
025000     05  PV-FETCH-COUNTER                PIC S9(04)  VALUE +0     02510060
025100                                                     COMP SYNC.   02520060
025200     05  PV-CURRENT-DATE                 PIC  9(06)  VALUE ZEROS. 02530060
025300     05  FILLER  REDEFINES  PV-CURRENT-DATE.                      02540060
025400         10  PV-CURRENT-YEAR             PIC  9(02).              02550060
025500         10  PV-CURRENT-MONTH            PIC  9(02).              02560060
025600         10  PV-CURRENT-DAY              PIC  9(02).              02570060
025700     05  PV-CURRENT-TIME                 PIC  9(06)  VALUE ZERO.  02580060
025800     05  PV-CURRENT-DATE-TUPCSKU-X.                               02590060
025900         10  PV-CURRENT-CENTURY-TUPCSKU  PIC  X(02)  VALUE SPACES.02600060
026000         10  PV-CURRENT-YEAR-TUPCSKU     PIC  X(02)  VALUE SPACES.02610060
026100         10  FILLER                      PIC  X(01)  VALUE '-'.   02620060
026200         10  PV-CURRENT-MONTH-TUPCSKU    PIC  X(02)  VALUE SPACES.02630060
026300         10  FILLER                      PIC  X(01)  VALUE '-'.   02640060
026400         10  PV-CURRENT-DAY-TUPCSKU      PIC  X(02)  VALUE SPACES.02650060
026500     05  PV-CURRENT-DATE-TUPCSKU REDEFINES                        02660060
026600             PV-CURRENT-DATE-TUPCSKU-X   PIC  X(10).              02670060
026700     05  PV-DISPLAY-UPC-AND-ITEM-NBR.                             02680060
026800         10  PV-DISPLAY-UPC-NBR          PIC  9(15)  VALUE ZEROS. 02690060
026900         10  FILLER  REDEFINES  PV-DISPLAY-UPC-NBR.               02700060
027000             15  PV-DISPLAY-SKU-NBR      PIC  X(10).              02710060
027100             15  PV-DISPLAY-SPACES       PIC  X(05).              02720060
027200         10  FILLER                      PIC  X(02)  VALUE SPACE. 02730060
027300         10  PV-DISPLAY-ITEM-NBR         PIC  9(15)  VALUE ZEROS. 02740060
027400     05  PV-MISMATCHED-SKU.                                       02750060
027500         15  PV-MISMATCHED-DEPT-NBR      PIC  X(03)  VALUE SPACE. 02760060
027600         15  FILLER                      PIC  X(01)  VALUE SPACE. 02770060
027700         15  PV-MISMATCHED-CLASS-NBR     PIC  X(02)  VALUE SPACE. 02780060
027800         15  FILLER                      PIC  X(01)  VALUE SPACE. 02790060
027900         15  PV-MISMATCHED-SEQ-NBR       PIC  X(08)  VALUE SPACE. 02800060
028000     05  PV-ITEM-NBR                     PIC S9(15)  VALUE ZEROS  02810060
028100                                                     COMP-3.      02820060
028200     05  PV-SCANNED-ITEM-NBR             PIC S9(15)  VALUE ZEROS  02830060
028300                                                     COMP-3.      02840060
028400     05  PV-USER-ID-NBR                  PIC  X(08)  VALUE SPACE. 02850060
028500                                                                  02860060
028600     05  PV-RANDOM-NUMBER                PIC  9(09)   COMP        02870060
028700                                                      VALUE 0.    02880060
028800     05  PV-RANDOM-NUMBER-COMP3          PIC  9(09)   COMP-3      02890060
028900                                                      VALUE 0.    02900060
029000     05  PV-SEED                         PIC S9(09)   COMP        02910060
029100                                                      VALUE +0.   02920060
029200     05  PV-WORK-FIELD                   PIC S9(17)   COMP-3      02930060
029300                                                      VALUE +0.   02940060
029400     05  PV-WORK-FIELD2                  PIC S9(17)   COMP-3      02950060
029500                                                      VALUE +0.   02960060
029600     05  PV-RENUMD-ITEM-NBR              PIC S9(15)   COMP-3      02970060
029700                                                      VALUE +0.   02980060
029800     05  PV-INSERT-ITEM-NBR              PIC S9(15)   COMP-3      02990060
029900                                                      VALUE +0.   03000060
030000     05  PV-CURR-INTERNAL-UPC-NBR        PIC S9(15)   VALUE ZERO  03010060
030100                                                      COMP-3.     03020060
030200     05  PV-CURR-INTERNAL-EDI-ORD-IND    PIC X(01)    VALUE SPACE.03030062
030300                                                                  03040062
030400     05  PV-EDI-ORD-IND                  PIC X(01) VALUE SPACE.   03050062
030500     05  PV-SKU-NBR                      PIC 9(8) VALUE ZEROES.           
030600     05  PV-SKU-ITM-NBR                  PIC S9(15)V COMP-3.      03060080
030700     05  PV-SKU-SKU-NBR                  PIC X(8) VALUE SPACES.   03070080
030800     05  PV-SKU-DEPT-NBR                 PIC X(3) VALUE SPACES.   03080080
030900     05  PV-SKU-SUB-CLASS-NBR            PIC X(2) VALUE SPACES.   03090080
031000     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE.         
031100     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE ZERO   01000060
031200                                                     COMP SYNC.   01010060
031300*                                                                 03100060
031400 01  ST-SYSTEM-TIME-AREA.                                         03110060
031500     05  ST-ABSTIME                      PIC S9(18)  VALUE ZERO   03120060
031600                                                     COMP SYNC.   03130060
031700 01  DK-DB2-KEYS.                                                 03140060
031800     05  DK-PO-NBR                       PIC  S9(9) VALUE ZEROS   03150060
031900                                                    COMP.         03160060
032000     05  DK-REC-SEQ-NBR                  PIC  S9(9) VALUE ZEROS   03170060
032100                                                    COMP.         03180060
032200     05  DK-PO-LNE-NBR                   PIC  S9(9) VALUE ZEROS   03190060
032300                                                    COMP.         03200060
032400                                                                  03210060
032500*                                                                 03220060
032600*  UPC PARAMETER LIST FOR CALLING THE UPC CHECK DIGIT ROUTINE.    03230060
032700*                                                                 03240060
032800     COPY DPWS040I.                                               03250060
032900                                                                  03260060
033000*                                                                 03270060
033100*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 03280060
033200*                                                                 03290060
033300                                                                  03300060
033400     COPY DPWS010I.                                               03310060
W3502S                                                                  03310060
W3502S     COPY DPWS020.                                                03310060
033500                                                                  03320060
033600*                                                                 03330060
033700*  GENEREATED DSECT FOR THE MPKM023 MAPSET                        03340060
033800*                                                                 03350060
033900     COPY MPKM024.                                                03360060
034000                                                                  03370060
034100*                                                                 03380060
034200*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               03390060
034300*                                                                 03400060
034400     COPY DPWS013.                                                03410060
034500                                                                  03420060
034600*                                                                 03430060
034700*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   03440060
034800*                                                                 03450060
034900     COPY DPWS015.                                                03460060
035000                                                                  03470060
035100*                                                                 03430060
035200* COPY BOOK FOR LOGISTICS DOMAIN ITEM ACCESS MODULE  WR # 230ZZ  *        
035300*                                                                 03450060
035400     COPY XLWS001.                                                03460060
035500                                                                  03470060
035600******************************************************************        
035700* HELP SCREEN COMMAREA                                                    
035800******************************************************************        
035900     COPY PCWS192.                                                        
036000******************************************************************        
036100* HELP SCREEN WORK AREA                                                   
036200******************************************************************        
036300     COPY PCWS188.                                                        
036400/                                                                         
036500*                                                                 03480060
036600*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      03490060
036700*                                                                 03500060
036800     COPY DFHAID.                                                 03510060
036900                                                                  03520060
037000*                                                                 03530060
037100*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SKU TABLE.         03540060
037200*                                                                 03550060
037300     EXEC SQL                                                     03560060
037400         INCLUDE TSK                                              03570060
037500     END-EXEC.                                                    03580060
037600                                                                  03590060
037700*                                                                 03600060
037800*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE UPC TO SKU         03610060
037900*  CROSS REFERENCE TABLE.                                         03620060
038000*                                                                 03630060
038100     EXEC SQL                                                     03640060
038200         INCLUDE TUPCSKU                                          03650060
038300     END-EXEC.                                                    03660060
038400                                                                  03670060
W3502S     EXEC SQL                                                     03640060
W3502S         INCLUDE TVNDSTL                                          03650060
W3502S     END-EXEC.                                                    03660060
W3502S                                                                  03670060
038500*                                                                 03680060
038600*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE UPC TABLE.         03690060
038700*                                                                 03700060
038800     EXEC SQL                                                     03710060
038900         INCLUDE TUPC                                             03720060
039000     END-EXEC.                                                    03730060
039100                                                                  03740060
039200*  DCLGEN FOR THE XLT_UPC TABLE                                           
039300     EXEC SQL                                                             
039400         INCLUDE XLT00006                                                 
039500     END-EXEC.                                                            
                                                                                
002400*  DCLGEN FOR THE XLT_PK_UPC TABLE                                        
002500     EXEC SQL                                                     00580006
002600         INCLUDE XLT00009                                         00590006
002700     END-EXEC.                                                    00600006
039600                                                                          
039700*                                                                 03750060
039800*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE UPC CERTIFICATION  03760060
039900*  TABLE.                                                         03770060
040000*                                                                 03780060
040100     EXEC SQL                                                     03790060
040200         INCLUDE TUPCCER                                          03800060
040300     END-EXEC.                                                    03810060
040400                                                                  03820060
040500*                                                                 03830060
040600*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE MERCHANDISE        03840060
040700*  AREA TABLE.                                                    03850060
040800*                                                                 03860060
040900     EXEC SQL                                                     03870060
041000         INCLUDE TMDSEAR                                          03880060
041100     END-EXEC.                                                    03890060
041200                                                                  03900060
041300*                                                                 03910060
041400*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE MERCHANDISE        03920060
041500*  DEPARTMENT TABLE.                                              03930060
041600*                                                                 03940060
041700     EXEC SQL                                                     03950060
041800         INCLUDE TMDSEDP                                          03960060
041900     END-EXEC.                                                    03970060
042000                                                                  03980060
042100*                                                                 03990075
042200*  SKU CROSS-REFERENCE TABLE                                      04000075
042300*                                                                 04010075
042400     EXEC SQL                                                     04020075
042500         INCLUDE TSKXREF                                          04030075
042600     END-EXEC.                                                    04040075
042700                                                                  04050075
W3502S*  TCOLOR TABLE TO FECTH NRF COLOR DESC                           04000075
W3502S     EXEC SQL                                                     03790060
W3502S         INCLUDE TCOLOR                                           03800060
W3502S     END-EXEC.                                                    03810060
040400                                                                  03820060
042800*                                                                 04060060
042900*  COMMUNICATIONS AREA FOR DB2                                    04070060
043000*                                                                 04080060
043100     EXEC SQL                                                     04090060
043200         INCLUDE SQLCA                                            04100060
043300     END-EXEC.                                                    04110060
043400                                                                  04120060
043500*                                                                 04130060
043600*  CURSOR DECLARATION FOR UPDATING THE CERTIFICATION INDICATOR    04140060
043700*  AND DATE WHEN DECERTICATION FOR A SKU IS TO TAKE PLACE.        04150060
043800*                                                                 04160060
043900     EXEC SQL                                                     04170060
044000         DECLARE DECERTIFY_CSR CURSOR FOR                         04180060
044100             SELECT  UPC_NBR,                                     04190060
044200                     CERT_IND,                                    04200060
044300                     CERT_DTE                                     04210060
044400               FROM  TUPCSKU                                      04220060
044500              WHERE  ((ITEM_NBR = :PV-ITEM-NBR)                   04230060
044600                AND   (UPC_NBR NOT BETWEEN                        04240060
044700                           :PC-LOWEST-INTERNAL-UPC-NMBR           04250060
044800                                     AND                          04260060
044900                           :PC-HIGHEST-INTERNAL-UPC-NMBR))        04270060
045000      FOR UPDATE OF  CERT_IND,                                    04280060
045100                     CERT_DTE                                     04290060
045200     END-EXEC.                                                    04300060
045300                                                                  04310060
045400******************************************************************04320060
045500 LINKAGE SECTION.                                                 04330060
045600******************************************************************04340060
045700 01  DFHCOMMAREA                   PIC  X(166).                   04350060
045800                                                                  04360060
045900******************************************************************04370060
046000 PROCEDURE DIVISION.                                              04380060
046100******************************************************************04390060
046200 0000-PROGRAM-MAINLINE.                                           04400060
046300                                                                          
046400     IF EIBTRNID = 'Z278'                                                 
046500         MOVE DFHCOMMAREA            TO PC192-COMMAREA                    
046600         MOVE PC192-HOST-SAVE-AREA   TO CA-COMMAREA                       
046700*        MOVE PC192-HOST-SAVE-MAP    TO MP024AO                           
046800         PERFORM 8000-SEND-MAP                                    04490060
046900     ELSE                                                                 
047000         MOVE DFHCOMMAREA TO CA-COMMAREA                                  
047100     END-IF                                                               
047200                                                                  04420060
047300     EVALUATE TRUE                                                04430060
047400         WHEN EIBCALEN = ZERO                                     04440060
047500             MOVE PC-ENTER-THROUGH-MENU-MSG TO PV-MESSAGE-AREA    04450060
047600             PERFORM 8300-RETURN                                  04460060
047700         WHEN CA-INITIALIZE-SCREEN                                04470060
047800             PERFORM 1000-INITIALIZE                              04480060
047900             PERFORM 8000-SEND-MAP                                04490060
048000             PERFORM 8200-RETURN-TRANID                           04500060
048100         WHEN EIBAID = DFHCLEAR                                   04510060
048200             MOVE CA-SKU-NBR TO ASKUNBRO                          04520060
048300             INITIALIZE CA-UPC-NBR-X                              04530060
048400             PERFORM 8000-SEND-MAP                                04540060
048500             PERFORM 8200-RETURN-TRANID                           04550060
048600         WHEN EIBAID = DFHENTER                                   04560060
048700             PERFORM 2000-PROCESS-SCREEN-FIELDS                   04570060
048800         WHEN EIBAID = DFHPF3                                     04580060
048900             PERFORM 5000-XCTL-TO-CERTIFY-SELECTION               04590060
049000         WHEN EIBAID = DFHPF5                                     04600060
049100             PERFORM 3200-FORMAT-CURRENT-DATE                     04610060
049200             PERFORM 3300-DETERMINE-USER-ID                       04620060
049300             IF CA-MISMATCHED-ITEM-NBR = +0                       04630060
049400                 MOVE PC-UPC-DECERT-NOT-ALLOWED-MSG TO AMSGLN1O   04640060
049500                 MOVE SPACES TO AMSGLN2O                          04650060
049600                                AMSGLN3O                          04660060
049700                                AMSGLN4O                          04670060
049800                 PERFORM 8100-SEND-DATA-ONLY                      04680060
049900                 PERFORM 8200-RETURN-TRANID                       04690060
050000             ELSE                                                 04700060
050100                 PERFORM 4000-DECERTIFY-SKU                       04710060
050200             END-IF                                               04720060
050300         WHEN EIBAID = DFHPF1                                             
050400              PERFORM 1400-HELP-SCREEN                                    
050500         WHEN OTHER                                               04730060
050600             MOVE SPACES                     TO AMSGLN1O          04740060
050700                                                AMSGLN2O          04750060
050800                                                AMSGLN3O          04760060
050900             MOVE PC-UNRECOGNIZED-PF-KEY-MSG TO AMSGLN4O          04770060
051000             PERFORM 8100-SEND-DATA-ONLY                          04780060
051100             PERFORM 8200-RETURN-TRANID                           04790060
051200     END-EVALUATE.                                                04800060
051300                                                                  04810060
W3502S                                                                          
051400     GOBACK.                                                      04820060
051500*                                                                 04830060
051600 1000-INITIALIZE.                                                 04840060
051700     MOVE LOW-VALUES       TO MP024AI.                            04850060
051800     SET CA-PROCESS-SCREEN TO TRUE.                               04860060
051900     MOVE ZERO             TO CA-MISMATCHED-UPC-NBR.              04870060
052000     MOVE CA-SKU-NBR       TO ASKUNBRO.                           04880060
052100*                                                                         
052200 1400-HELP-SCREEN.                                                        
052300     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM              
052400     MOVE 'MPKCS024'                  TO PC192-PROGRAM-NAME               
052500     COPY PCPD188.                                                        
052600     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.              
052700*    PERFORM 2100-RECEIVE-MAP                                     04940060
052800*    MOVE MP024AI                     TO PC192-HOST-SAVE-MAP.             
052900     PERFORM 2200-XCTL-TO-HELP.                                           
053000                                                                          
053100*                                                                 04890060
053200 2000-PROCESS-SCREEN-FIELDS.                                      04900060
053300     MOVE LOW-VALUES      TO MP024AI.                             04910060
053400     SET PS-NO-EDIT-ERROR TO TRUE.                                04920060
053500                                                                  04930060
053600     PERFORM 2100-RECEIVE-MAP.                                    04940060
053700     PERFORM 2300-SET-ATTRIBUTES-TO-DEFAULT.                      04950060
053800     PERFORM 3000-EDIT-SCREEN-FIELDS.                             04960060
053900     PERFORM 3100-VALIDATE-CHECK-DIGIT.                           04970060
054000     PERFORM 3200-FORMAT-CURRENT-DATE.                            04980060
054100     PERFORM 3300-DETERMINE-USER-ID.                              04990060
054200     PERFORM 7000-DETERMINE-UPC-EXISTENCE.                        05000060
054300     PERFORM 3400-PROCESS-UPC.                                    05010060
054400*                                                                 05020060
054500 2100-RECEIVE-MAP.                                                05030060
054600     EXEC CICS                                                    05040060
054700         RECEIVE MAP    ('MP024A')                                05050060
054800                 MAPSET ('MPKM024')                               05060060
054900                 RESP   (PV-CICS-RESPONSE)                        05070060
055000     END-EXEC.                                                    05080060
055100                                                                  05090060
055200     EVALUATE TRUE                                                05100060
055300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05110060
055400             PERFORM 2110-RECEIVE-SCREEN-FIELDS                   05120060
055500         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                05130060
055600             CONTINUE                                             05140060
055700         WHEN OTHER                                               05150060
055800            MOVE '2100-RECEIVE-MAP'                               05160060
055900                TO DP013-PARAGRAPH                                05170060
056000            SET DP013-LOGIC-ABEND TO TRUE                         05180060
056100            MOVE 'UNABLE TO FIND COMMAREA FOR CALLING TRANSACTION'05190060
056200                TO DP013-MESSAGE-TEXT (1)                         05200060
056300            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                05210060
056400     END-EVALUATE.                                                05220060
056500*                                                                 05230060
056600 2110-RECEIVE-SCREEN-FIELDS.                                      05240060
056700     IF  AUPCNBRL > ZERO                                          05250060
056800         MOVE AUPCNBRI TO CA-UPC-NBR-X                            05260060
056900     ELSE                                                         05270060
057000         IF AUPCNBRA = DP015-ERASE-EOF                            05280060
057100             MOVE SPACES TO CA-UPC-NBR-X                          05290060
057200         END-IF                                                   05300060
057300     END-IF.                                                      05310060
057400*                                                                 05320060
057500*                                                                         
057600 2200-XCTL-TO-HELP.                                                       
057700                                                                          
057800     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH.              
057900     SET CA-INITIALIZE-SCREEN         TO TRUE.                            
058000     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA.            
058100                                                                          
058200     EXEC CICS                                                            
058300         XCTL                                                             
058400             PROGRAM   (PV-TRANSFER-PROGRAM)                              
058500             COMMAREA  (PC192-COMMAREA)                                   
058600             LENGTH    (PV-COMMAREA-LENGTH)                               
058700             RESP      (PV-CICS-RESPONSE)                                 
058800     END-EXEC.                                                            
058900                                                                          
059000     EVALUATE TRUE                                                        
059100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                         
059200              CONTINUE                                                    
059300         WHEN OTHER                                               15080060
059400             MOVE '2200-XCTL-TO-HELP'                             15090060
059500                 TO DP013-PARAGRAPH                               15100060
059600             MOVE 'UNABLE TO XCTL TO THE HELP SCREEN'             15110060
059700                 TO DP013-MESSAGE-TEXT (1)                        15120060
059800             MOVE 'SELECTION PROGRAM: '                           15130060
059900                 TO DP013-MESSAGE-TEXT (2)                        15140060
060000             MOVE PV-TRANSFER-PROGRAM                             15150060
060100                 TO DP013-MESSAGE-TEXT (3)                        15160060
060200             SET DP013-CICS-ABEND TO TRUE                         15170060
060300             SET DP013-ROLLBACK   TO TRUE                         15180060
060400             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               15190060
060500             MOVE PC-TRANS-UNAVAILABLE-MSG TO AMSGLN4O            15200060
060600             PERFORM 8100-SEND-DATA-ONLY                          15210060
060700             PERFORM 8200-RETURN-TRANID                           15220060
060800     END-EVALUATE.                                                15230060
060900                                                                          
061000 2300-SET-ATTRIBUTES-TO-DEFAULT.                                  05330060
061100     MOVE DP015-UNP-ALP-NOR-OFF TO AUPCNBRA.                      05340060
061200     MOVE SPACES                TO AMSGLN1O                       05350060
061300                                   AMSGLN2O                       05360060
061400                                   AMSGLN3O                       05370060
061500                                   AMSGLN4O.                      05380060
061600*                                                                 05390060
061700 3000-EDIT-SCREEN-FIELDS.                                         05400060
061800     IF CA-FIRST-DIGIT-COUNTRY-CODE = SPACES                      05410060
061900         IF CA-LAST-TWELVE-BYTES-OF-UPC NUMERIC                   05420060
062000             MOVE CA-LAST-TWELVE-BYTES-OF-UPC TO PV-UPC-NBR       05430060
062100         ELSE                                                     05440060
062200             MOVE DP015-UNP-NUM-BRT-MDT  TO AUPCNBRA              05450060
062300             MOVE PC-UPC-NOT-NUMERIC-MSG TO AMSGLN4O              05460060
062400             SET PS-EDIT-FAILED          TO TRUE                  05470060
062500         END-IF                                                   05480060
062600     ELSE                                                         05490060
062700         IF CA-CHECK-DIGIT = SPACES                               05500060
062800             IF CA-FIRST-TWELVE-BYTES-OF-UPC NUMERIC              05510060
062900                 MOVE CA-FIRST-TWELVE-BYTES-OF-UPC TO PV-UPC-NBR  05520060
063000             ELSE                                                 05530060
063100                 MOVE DP015-UNP-NUM-BRT-MDT  TO AUPCNBRA          05540060
063200                 MOVE PC-UPC-NOT-NUMERIC-MSG TO AMSGLN4O          05550060
063300                 SET PS-EDIT-FAILED          TO TRUE              05560060
063400             END-IF                                               05570060
063500         ELSE                                                     05580060
063600             IF CA-UPC-NBR NOT NUMERIC                            05590060
063700                 MOVE DP015-UNP-NUM-BRT-MDT  TO AUPCNBRA          05600060
063800                 MOVE PC-UPC-NOT-NUMERIC-MSG TO AMSGLN4O          05610060
063900                 SET PS-EDIT-FAILED          TO TRUE              05620060
064000             ELSE                                                 05630060
064100                 MOVE CA-UPC-NBR TO PV-UPC-NBR                    05640060
064200             END-IF                                               05650060
064300         END-IF                                                   05660060
064400     END-IF.                                                      05670060
064500                                                                  05680060
064600     IF PS-EDIT-FAILED                                            05690060
064700         PERFORM 8100-SEND-DATA-ONLY                              05700060
064800         PERFORM 8200-RETURN-TRANID                               05710060
064900     END-IF.                                                      05720060
065000*                                                                 05730060
065100 3100-VALIDATE-CHECK-DIGIT.                                       05740060
065200     INITIALIZE DP040I-UPC-CHECK-DIGIT-PARMS.                     05750060
065300     SET DP040I-COMP-CHECK-DIGIT-OPTION  TO TRUE.                 05760060
065400                                                                  05770060
065500     IF CA-UPC-NBR = ZEROS                                        05780060
065600         SET PS-EDIT-FAILED        TO TRUE                        05790060
065700         MOVE PC-UPC-NOT-VALID-MSG TO AMSGLN4O                    05800060
065800         MOVE -1                   TO AUPCNBRL                    05810060
065900     ELSE                                                         05820060
066000         MOVE PV-UPC-NBR TO DP040I-UPC-CODE                       05830060
066100     END-IF.                                                      05840060
066200                                                                  05850060
066300     CALL DP040I-UPC-CHECK-DIGIT-WO-IUPC                          05860060
066300                     USING DP040I-UPC-CHECK-DIGIT-PARMS.          05860060
066400                                                                  05870060
066500     IF DP040I-COMPUTED-UPC-CHK-DIGIT = DP040I-UPC-CHECK-DIGIT    05880060
066600         CONTINUE                                                 05890060
066700     ELSE                                                         05900060
066800         SET PS-EDIT-FAILED TO TRUE                               05910060
066900         MOVE DP040I-COMPUTED-UPC-CHK-DIGIT                       05920060
067000             TO PV-COMPUTED-UPC-CHECK-DIGIT                       05930060
067100         MOVE DP015-UNP-NUM-BRT-MDT      TO AUPCNBRA              05940060
067200         MOVE PV-INVALID-CHECK-DIGIT-MSG TO AMSGLN4O              05950060
067300         MOVE -1                         TO AUPCNBRL              05960060
067400     END-IF.                                                      05970060
067500                                                                  05980060
067600     IF PS-EDIT-FAILED                                            05990060
067700         PERFORM 8100-SEND-DATA-ONLY                              06000060
067800         PERFORM 8200-RETURN-TRANID                               06010060
067900     END-IF.                                                      06020060
068000*                                                                 06030060
068100 3200-FORMAT-CURRENT-DATE.                                        06040060
068200     EXEC CICS                                                    06050060
068300         ASKTIME                                                  06060060
068400             ABSTIME(ST-ABSTIME)                                  06070060
068500     END-EXEC.                                                    06080060
068600                                                                  06090060
068700     EXEC CICS                                                    06100060
068800         FORMATTIME                                               06110060
068900             ABSTIME  (ST-ABSTIME)                                06120060
069000             YYMMDD   (PV-CURRENT-DATE)                           06130060
069100             TIME     (PV-CURRENT-TIME)                           06140060
069200             RESP     (PV-CICS-RESPONSE)                          06150060
069300     END-EXEC.                                                    06160060
069400                                                                  06170060
069500     EVALUATE TRUE                                                06180060
069600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06190060
069700             CONTINUE                                             06200060
069800         WHEN OTHER                                               06210060
069900             MOVE '3200-FORMAT-CURRENT-DATE' TO DP013-PARAGRAPH   06220060
070000             MOVE 'UNABLE TO FORMAT DATE'                         06230060
070100                 TO DP013-MESSAGE-TEXT (1)                        06240060
070200             SET DP013-CICS-ABEND TO TRUE                         06250060
070300             SET DP013-ROLLBACK   TO TRUE                         06260060
070400             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               06270060
070500             MOVE PC-CICS-ERROR-MSG TO AMSGLN4O                   06280060
070600             PERFORM 8100-SEND-DATA-ONLY                          06290060
070700             PERFORM 8200-RETURN-TRANID                           06300060
070800     END-EVALUATE.                                                06310060
070900                                                                  06320060
071000     IF PV-CURRENT-YEAR > PC-CENTURY-CHECK                        06330060
071100         MOVE 19 TO PV-CURRENT-CENTURY-TUPCSKU                    06340060
071200     ELSE                                                         06350060
071300         MOVE 20 TO PV-CURRENT-CENTURY-TUPCSKU                    06360060
071400     END-IF.                                                      06370060
071500                                                                  06380060
071600     MOVE PV-CURRENT-YEAR  TO PV-CURRENT-YEAR-TUPCSKU.            06390060
071700     MOVE PV-CURRENT-MONTH TO PV-CURRENT-MONTH-TUPCSKU.           06400060
071800     MOVE PV-CURRENT-DAY   TO PV-CURRENT-DAY-TUPCSKU.             06410060
071900*                                                                 06420060
072000 3300-DETERMINE-USER-ID.                                          06430060
072100     EXEC CICS                                                    06440060
072200         ASSIGN USERID  (PV-USER-ID-NBR)                          06450060
072300                RESP    (PV-CICS-RESPONSE)                        06460060
072400     END-EXEC.                                                    06470060
072500                                                                  06480060
072600     EVALUATE TRUE                                                06490060
072700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06500060
072800             CONTINUE                                             06510060
072900         WHEN OTHER                                               06520060
073000             MOVE '3300-DETERMINE-USER-ID' TO DP013-PARAGRAPH     06530060
073100             MOVE 'UNABLE TO ASSIGN USER-ID'                      06540060
073200                 TO DP013-MESSAGE-TEXT (1)                        06550060
073300             SET DP013-CICS-ABEND TO TRUE                         06560060
073400             SET DP013-ROLLBACK   TO TRUE                         06570060
073500             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               06580060
073600             MOVE PC-CICS-ERROR-MSG TO AMSGLN4O                   06590060
073700             PERFORM 8100-SEND-DATA-ONLY                          06600060
073800             PERFORM 8200-RETURN-TRANID                           06610060
073900     END-EVALUATE.                                                06620060
074000*                                                                 06630060
074100 3400-PROCESS-UPC.                                                06640060
074200                                                                  06650060
074300     MOVE '3400-PROCESS-UPC' TO DP013-PARAGRAPH.                  06660060
074400                                                                  06670060
074500     IF PS-UPC-NOT-FOUND                                          06680060
074600         MOVE PV-UPC-NBR TO PV-UPC-NBR-BREAKDOWN                  06690060
074700         IF PV-UPC-COUNTRY-CODE = PC-USA-COUNTRY-CODE             06700060
074800             IF (PV-UPC-NBR-SYSTEM-CHAR                           06710060
074900                     = PC-KOHLS-INTERNAL-UPC-IND                  06720060
075000                     OR                                           06730060
075100                 PV-UPC-ITEM-NBR = ZEROS)                         06740060
075200                 MOVE PC-UPC-INVALID-LINE1-MSG TO AMSGLN1O        06750060
075300                 MOVE PC-UPC-INVALID-LINE2-MSG TO AMSGLN2O        06760060
075400                 PERFORM 8100-SEND-DATA-ONLY                      06770060
075500                 PERFORM 8200-RETURN-TRANID                       06780060
075600             ELSE                                                 06790060
075700* * * GET INFO FROM INTERNAL UPC TO BUILD VENDOR UPC ROW FOR TUPC 06800069
075800                 PERFORM 7110-GET-UPC-FROM-NUM-SKU                17310060
075900                 PERFORM 7150-GET-INTERNAL-FROM-TUPC              06810070
076000                 PERFORM 3600-SAVE-INTERNAL-UPC-DATA              06820070
076100                 PERFORM 7050-GET-SCANNED-UPC-FROM-TUPC           06830070
076200                 IF PS-UPC-FOUND-ON-TUPC                          06840070
170100                     MOVE '7050-GET-SCANNED-UPC-FROM-TUPC'        17730060
170100                                   TO DP013-PARAGRAPH             17730060
076300                     MOVE                                         06850070
076400                        'SELECT INFO FOR THE FOLLOWING UPC: '     06860070
076500                                   TO DP013-MESSAGE-TEXT (1)      06870070
076600                     MOVE PV-UPC-NBR                              06880070
076700                                   TO PV-DISPLAY-UPC-NBR          06890070
076800                     MOVE PV-DISPLAY-UPC-NBR                      06900070
076900                                   TO DP013-MESSAGE-TEXT (2)      06910070
077000                     MOVE 'UPC NOT ON TUPCSKU, BUT ON TUPC  '     06920070
077100                                   TO DP013-MESSAGE-TEXT (3)      06930070
077200                     MOVE SQLCA    TO DP013-SQLCA                 06940070
077300                     MOVE 'TUPC'   TO DP013-DB2-TABLE-NAME (1)    06950070
077400                     SET DP013-DB2-ABEND   TO TRUE                06960070
077500                     SET DP013-NO-ROLLBACK TO TRUE                06970070
077600                     PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG       06980070
077700*                    MOVE PC-DB2-DATABASE-ERROR-MSG               06990070
                           MOVE 'UPC ALREADY EXISTS'                    06990070
077800                                           TO AMSGLN4O            07000070
077900                     PERFORM 8100-SEND-DATA-ONLY                  07010070
078000                     PERFORM 8200-RETURN-TRANID                   07020070
                       ELSE                                                     
                           PERFORM 7060-CHK-XLT-PK-UPC                          
                           IF PS-UPC-FOUND-ON-PK-UPC                            
170100                         MOVE '7060-GET-CHK-XLT-PK-UPC'           17730060
170100                                   TO DP013-PARAGRAPH             17730060
076300                         MOVE                                     06850070
076400                        'SELECT INFO FOR THE FOLLOWING UPC: '     06860070
076500                                   TO DP013-MESSAGE-TEXT (1)      06870070
076600                         MOVE PV-UPC-NBR                          06880070
076700                                   TO PV-DISPLAY-UPC-NBR          06890070
076800                         MOVE PV-DISPLAY-UPC-NBR                  06900070
076900                                   TO DP013-MESSAGE-TEXT (2)      06910070
077000                         MOVE 'UPC FOUND ON XLT_PK_UPC          ' 06920070
077100                                   TO DP013-MESSAGE-TEXT (3)      06930070
077200                         MOVE SQLCA                               06940070
077200                                   TO DP013-SQLCA                 06940070
077300                         MOVE 'XLT_PK_UPC'                        06950070
077300                                   TO DP013-DB2-TABLE-NAME (1)    06950070
077400                         SET DP013-DB2-ABEND   TO TRUE            06960070
077500                         SET DP013-NO-ROLLBACK TO TRUE            06970070
077600                         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG   06980070
                               MOVE 'UPC ALREADY EXISTS'                06990070
077800                                               TO AMSGLN4O        07000070
077900                         PERFORM 8100-SEND-DATA-ONLY              07010070
078000                         PERFORM 8200-RETURN-TRANID               07020070
                           END-IF                                               
078100                 END-IF                                           07030070
078200                 PERFORM 3700-BUILD-TUPC-ROW                      07040070
078300                 PERFORM 7250-INSERT-TUPC-ROW                     07050070
078400                 IF PS-SKU-NOT-RENUMBERED                         07060061
078500                     MOVE CA-ITEM-NBR      TO PV-INSERT-ITEM-NBR  07070061
078600                 ELSE                                             07080061
078700                     PERFORM 7160-GET-ITEM-NBR-FOR-UPC            07090061
078800                     MOVE TUPCSKU-ITEM-NBR TO PV-INSERT-ITEM-NBR  07100061
078900                 END-IF                                           07110061
079000                 MOVE 0 TO CA-MISMATCHED-ITEM-NBR                 07120066
079100                 PERFORM 7200-INSERT-UPC-TUPCSKU                  07130060
079200                                                                  07140060
079300                 IF PS-UPDATE-INTERNAL-UPC                        07150062
079400                     PERFORM 7165-UPDATE-INTERNAL-TUPC            07160069
079500                     PERFORM 7170-UPDATE-INTERNAL-TUPCSKU         07170066
079600                 END-IF                                           07180062
079700                                                                  07190062
079800                 SET CA-CERTIFICATION-REQUIRED TO TRUE            07200060
079900                 PERFORM 7600-DEL-CERT-REQ-ROW-TUPCCER            07210060
080000                                                                  07220060
080100                 MOVE CA-ITEM-NBR TO PV-SCANNED-ITEM-NBR          07230060
080200                 SET CA-INSERT-SUCCESSFUL TO TRUE                 07240060
080300                 PERFORM 7500-INSERT-TUPCCER                      07250060
080400                                                                  07260060
080500                 SET CA-NEW-VENDOR-UPC-LOADED TO TRUE             07270060
080600                 PERFORM 7500-INSERT-TUPCCER                      07280060
W3502S                 PERFORM 7700-INSERT-MDM-UPC                      07280060
W3502S                 IF PS-UPDATE-INTERNAL-UPC                        07150062
W3502S                     PERFORM 7950-UPDATE-MDM-UPC                  07160069
W3502S                 END-IF                                           07180062
W3502S                 PERFORM 9000-DB2-MDM-COMMIT                      07280060
080700             END-IF                                               07290060
080800         ELSE                                                     07300060
080900             IF PV-UPC-ITEM-NBR = ZEROS                           07310060
081000                 MOVE PC-UPC-INVALID-LINE1-MSG TO AMSGLN1O        07320060
081100                 MOVE PC-UPC-INVALID-LINE2-MSG TO AMSGLN2O        07330060
081200                 PERFORM 8100-SEND-DATA-ONLY                      07340060
081300                 PERFORM 8200-RETURN-TRANID                       07350060
081400             ELSE                                                 07360060
081500*                DRS 3/14/05                                              
081600                 PERFORM 7110-GET-UPC-FROM-NUM-SKU                17310060
081700*                DRS 3/14/05                                              
081800                 PERFORM 7150-GET-INTERNAL-FROM-TUPC              07370070
081900                 PERFORM 3600-SAVE-INTERNAL-UPC-DATA              07380070
082000                 PERFORM 7050-GET-SCANNED-UPC-FROM-TUPC           07390070
082100                 IF PS-UPC-FOUND-ON-TUPC                          07400070
170100                     MOVE '7050-GET-SCANNED-UPC-FROM-TUPC'        17730060
170100                                   TO DP013-PARAGRAPH             17730060
082200                     MOVE                                         07410070
082300                        'SELECT INFO FOR THE FOLLOWING UPC: '     07420070
082400                                   TO DP013-MESSAGE-TEXT (1)      07430070
082500                     MOVE PV-UPC-NBR                              07440070
082600                                   TO PV-DISPLAY-UPC-NBR          07450070
082700                     MOVE PV-DISPLAY-UPC-NBR                      07460070
082800                                   TO DP013-MESSAGE-TEXT (2)      07470070
082900                     MOVE 'UPC NOT ON TUPCSKU, BUT ON TUPC  '     07480070
083000                                   TO DP013-MESSAGE-TEXT (3)      07490070
083100                     MOVE SQLCA    TO DP013-SQLCA                 07500070
083200                     MOVE 'TUPC'   TO DP013-DB2-TABLE-NAME (1)    07510070
083300                     SET DP013-DB2-ABEND   TO TRUE                07520070
083400                     SET DP013-NO-ROLLBACK TO TRUE                07530070
083500                     PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG       07540070
083600*                    MOVE PC-DB2-DATABASE-ERROR-MSG               07550070
                           MOVE 'UPC ALREADY EXISTS'                    06990070
083700                                           TO AMSGLN4O            07560070
083800                     PERFORM 8100-SEND-DATA-ONLY                  07570070
083900                     PERFORM 8200-RETURN-TRANID                   07580070
                       ELSE                                                     
                           PERFORM 7060-CHK-XLT-PK-UPC                          
                           IF PS-UPC-FOUND-ON-PK-UPC                            
170100                         MOVE '7060-GET-CHK-XLT-PK-UPC'           17730060
170100                                   TO DP013-PARAGRAPH             17730060
076300                         MOVE                                     06850070
076400                        'SELECT INFO FOR THE FOLLOWING UPC: '     06860070
076500                                   TO DP013-MESSAGE-TEXT (1)      06870070
076600                         MOVE PV-UPC-NBR                          06880070
076700                                   TO PV-DISPLAY-UPC-NBR          06890070
076800                         MOVE PV-DISPLAY-UPC-NBR                  06900070
076900                                   TO DP013-MESSAGE-TEXT (2)      06910070
077000                         MOVE 'UPC FOUND ON XLT_PK_UPC          ' 06920070
077100                                   TO DP013-MESSAGE-TEXT (3)      06930070
077200                         MOVE SQLCA                               06940070
077200                                   TO DP013-SQLCA                 06940070
077300                         MOVE 'XLT_PK_UPC'                        06950070
077300                                   TO DP013-DB2-TABLE-NAME (1)    06950070
077400                         SET DP013-DB2-ABEND   TO TRUE            06960070
077500                         SET DP013-NO-ROLLBACK TO TRUE            06970070
077600                         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG   06980070
                               MOVE 'UPC ALREADY EXISTS'                06990070
077800                                               TO AMSGLN4O        07000070
077900                         PERFORM 8100-SEND-DATA-ONLY              07010070
078000                         PERFORM 8200-RETURN-TRANID               07020070
                           END-IF                                               
084000                 END-IF                                           07590070
084100                 PERFORM 3700-BUILD-TUPC-ROW                      07600070
084200                 PERFORM 7250-INSERT-TUPC-ROW                     07610070
084300                 IF PS-SKU-NOT-RENUMBERED                         07620061
084400                     MOVE CA-ITEM-NBR      TO PV-INSERT-ITEM-NBR  07630061
084500                 ELSE                                             07640061
084600                     PERFORM 7160-GET-ITEM-NBR-FOR-UPC            07650061
084700                     MOVE TUPCSKU-ITEM-NBR TO PV-INSERT-ITEM-NBR  07660061
084800                 END-IF                                           07670061
084900                                                                  07680066
085000                 PERFORM 7200-INSERT-UPC-TUPCSKU                  07690060
085100                                                                  07700062
085200                 IF PS-UPDATE-INTERNAL-UPC                        07710062
085300                     PERFORM 7165-UPDATE-INTERNAL-TUPC            07720069
085400                     PERFORM 7170-UPDATE-INTERNAL-TUPCSKU         07730066
085500                 END-IF                                           07740062
085600                                                                  07750060
085700                 SET CA-CERTIFICATION-REQUIRED TO TRUE            07760060
085800                 PERFORM 7600-DEL-CERT-REQ-ROW-TUPCCER            07770060
085900                                                                  07780060
086000                 MOVE CA-ITEM-NBR TO PV-SCANNED-ITEM-NBR          07790060
086100                 SET CA-INSERT-SUCCESSFUL TO TRUE                 07800060
086200                 PERFORM 7500-INSERT-TUPCCER                      07810060
086300                                                                  07820060
086400                 SET CA-NEW-VENDOR-UPC-LOADED TO TRUE             07830060
086500                 PERFORM 7500-INSERT-TUPCCER                      07840060
W3502S                 PERFORM 7700-INSERT-MDM-UPC                      07280060
W3502S                 IF PS-UPDATE-INTERNAL-UPC                        07150062
W3502S                     PERFORM 7950-UPDATE-MDM-UPC                  07160069
W3502S                 END-IF                                           07180062
W3502S                 PERFORM 9000-DB2-MDM-COMMIT                      07280060
086600             END-IF                                               07850060
086700         END-IF                                                   07860060
086800     END-IF.                                                      08920060
086900                                                                  08930060
087000     MOVE PC-UPC-CERTIFIED-MSG TO AMSGLN1O.                       08940060
087100     PERFORM 8100-SEND-DATA-ONLY.                                 08950060
087200     PERFORM 8200-RETURN-TRANID.                                  08960060
087300*                                                                 08970060
087400                                                                  09140060
087500 3500-GENERATE-RANDOM-NUMBER.                                     09150060
087600                                                                  09160060
087700     PERFORM 3200-FORMAT-CURRENT-DATE.                            09170060
087800     MOVE ST-ABSTIME      TO PV-SEED.                             09180060
087900     COMPUTE PV-WORK-FIELD    =                                   09190060
088000                  ((PV-SEED + PC-PRIME1) * PC-PRIME2).            09200060
088100     DIVIDE PV-WORK-FIELD BY  PC-ONE-BILLION                      09210060
088200                  GIVING PV-WORK-FIELD2                           09220060
088300                  REMAINDER PV-RANDOM-NUMBER.                     09230060
088400                                                                  09240060
088500                                                                  09250060
088600 3600-SAVE-INTERNAL-UPC-DATA.                                     09260060
088700                                                                  09270060
088800     MOVE XL001-UPC-ID         TO PV-INTERNAL-UPC-ID.             09280080
088900     MOVE XL001-UPC-NBR        TO PV-CURR-INTERNAL-UPC-NBR.             60
089000     MOVE UPC-SUB-CL-MDSEAR-ID TO PV-INTERNAL-SUB-CL-MDSEAR-ID.         60
089100     MOVE XL001-VS-ID          TO PV-INTERNAL-VS-ID.                    60
089200     MOVE XL001-KOHLS-SIZE-CDE TO PV-INTERNAL-KOHLS-SIZE-CDE.           60
089300     MOVE XL001-NRF-CLOR-CDE   TO PV-INTERNAL-NRF-CLOR-CDE.             60
089400     MOVE XL001-GP-CDE         TO PV-INTERNAL-GP-CDE.                   60
089500     MOVE XL001-EDI-ORD-IND    TO PV-CURR-INTERNAL-EDI-ORD-IND.         60
089600     MOVE XL001-INNR-PACK-QTY  TO PV-INTERNAL-INNR-PK-QTY.              60
089700     MOVE XL001-OUTR-PACK-QTY  TO PV-INTERNAL-OUTR-PK-QTY.              60
089800     MOVE UPC-SEA-SEQ-NBR      TO PV-INTERNAL-SEA-SEQ-NBR.              60
089900     MOVE XL001-SKU-DESC       TO PV-INTERNAL-INTR-UPC-DESC.      09430074
090000                                                                  09440060
090100                                                                  09450060
090200 3700-BUILD-TUPC-ROW.                                             09460060
090300                                                                  09470060
090400     PERFORM 3500-GENERATE-RANDOM-NUMBER.                         09480060
090500     MOVE PV-RANDOM-NUMBER             TO UPC-UPC-ID.             09490060
090600     MOVE PV-UPC-NBR                   TO UPC-UPC-NBR.            09500060
090700     MOVE PV-INTERNAL-SUB-CL-MDSEAR-ID TO UPC-SUB-CL-MDSEAR-ID.   09510060
090800     MOVE PV-INTERNAL-VS-ID            TO UPC-VS-ID.              09520060
090900     MOVE PV-INTERNAL-UPC-ID           TO UPC-INTR-UPC-ID.        09530060
091000     MOVE PC-UPC-TYP-CDE-VENDOR        TO UPC-UPC-TYP-CDE.        09540060
091100     MOVE PV-INTERNAL-KOHLS-SIZE-CDE   TO UPC-KOHLS-SIZE-CDE.     09550060
091200     MOVE 'N'                          TO UPC-NRF-SIZE-IND.       09560060
091300     MOVE PV-INTERNAL-NRF-CLOR-CDE     TO UPC-NRF-CLOR-CDE.       09570060
091400     MOVE 'N'                          TO UPC-NRF-CLOR-IND.       09580060
091500     MOVE SPACE                        TO UPC-CSTM-CLOR-DESC.     09590060
091600     IF PV-CURR-INTERNAL-EDI-ORD-IND = 'N'                        09600060
091700         MOVE 'N'                          TO UPC-EDI-ORD-IND     09610060
091800                                              PV-EDI-ORD-IND      09620062
091900         SET PS-NO-UPDATE-OF-INTERNAL-UPC  TO TRUE                09630060
092000     ELSE                                                         09640060
092100         MOVE 'Y'                          TO UPC-EDI-ORD-IND     09650060
092200                                              PV-EDI-ORD-IND      09660062
092300         SET PS-UPDATE-INTERNAL-UPC        TO TRUE                09670060
092400     END-IF.                                                      09680060
092500     MOVE 'N'                          TO UPC-PREPK-IND.          09690060
092600     MOVE  PV-INTERNAL-GP-CDE          TO UPC-GP-CDE.             09700060
092700     MOVE 'Y'                          TO UPC-CERTD-IND.          09710060
092800     MOVE 'N'                          TO UPC-RPLNMT-IND.         09720060
092900     MOVE 'N'                          TO UPC-KY-ITM-IND.         09730060
093000     MOVE ZERO                         TO UPC-UNT-COST-1ST-AMT.   09740060
093100     MOVE PC-UPC-SRC-CERT              TO UPC-UPC-SRC-CDE.        09750060
093200     MOVE PV-INTERNAL-INNR-PK-QTY      TO UPC-INNR-PK-QTY.        09760060
093300     MOVE PV-INTERNAL-OUTR-PK-QTY      TO UPC-OUTR-PK-QTY.        09770060
093400     MOVE PV-INTERNAL-SEA-SEQ-NBR      TO UPC-SEA-SEQ-NBR.        09780060
093500     MOVE PV-USER-ID-NBR               TO UPC-CRE-BY-USR-ID       09830060
093600                                          UPC-LAST-UPD-BY-USR-ID. 09840060
093700     MOVE PV-INTERNAL-INTR-UPC-DESC    TO UPC-INTR-UPC-DESC.      09850074
093800                                                                  09860060
093900                                                                  09870060
094000 4000-DECERTIFY-SKU.                                              09880060
094100                                                                  09890060
094200     MOVE '4000-DECERTIFY-SKU' TO DP013-PARAGRAPH.                09900060
094300                                                                  09910060
094400     IF (CA-LAST-TWELVE-BYTES-OF-UPC  NUMERIC  OR                 09920060
094500         CA-FIRST-TWELVE-BYTES-OF-UPC NUMERIC  OR                 09930060
094600         CA-UPC-NBR NUMERIC)                                      09940060
094700                                                                  09950060
094800         EVALUATE TRUE                                            09960060
094900             WHEN CA-FIRST-DIGIT-COUNTRY-CODE = SPACES            09970060
095000                 MOVE CA-LAST-TWELVE-BYTES-OF-UPC  TO PV-UPC-NBR  09980060
095100             WHEN CA-CHECK-DIGIT = SPACES                         09990060
095200                 MOVE CA-FIRST-TWELVE-BYTES-OF-UPC TO PV-UPC-NBR  10000060
095300             WHEN OTHER                                           10010060
095400                 MOVE CA-UPC-NBR TO PV-UPC-NBR                    10020060
095500         END-EVALUATE                                             10030060
095600                                                                  10040060
095700         MOVE PV-UPC-NBR TO PV-UPC-NBR-BREAKDOWN                  10050060
095800         IF PV-UPC-COUNTRY-CODE = PC-USA-COUNTRY-CODE             10060060
095900             IF PV-UPC-NBR-SYSTEM-CHAR                            10070060
096000                     = PC-KOHLS-INTERNAL-UPC-IND                  10080060
096100                 MOVE PC-DECERT-INVALID-LINE1-MSG                 10090060
096200                     TO AMSGLN1O                                  10100060
096300                 MOVE PC-DECERT-INVALID-LINE2-MSG                 10110060
096400                     TO AMSGLN2O                                  10120060
096500                 MOVE PC-DECERT-INVALID-LINE3-MSG                 10130060
096600                     TO AMSGLN3O                                  10140060
096700                 PERFORM 8100-SEND-DATA-ONLY                      10150060
096800                 PERFORM 8200-RETURN-TRANID                       10160060
096900             END-IF                                               10170060
097000         END-IF                                                   10180060
097100                                                                  10190060
097200         PERFORM 4060-DECERTIFY-UPC-ON-TUPC                               
097300         MOVE CA-MISMATCHED-ITEM-NBR TO PV-SCANNED-ITEM-NBR       10240060
097400         PERFORM 4050-DECERTIFY-SCANNED-SKU                       10250060
097500                                                                  10260060
097600         SET CA-CERTIFICATION-REQUIRED TO TRUE                    10270060
097700         PERFORM 7600-DEL-CERT-REQ-ROW-TUPCCER                    10280060
097800                                                                  10290060
097900         SET CA-SKU-MISMATCH-DECERT-SCANNED TO TRUE               10300060
098000         PERFORM 7500-INSERT-TUPCCER                              10310060
098100                                                                  10320060
098200         MOVE PC-UPC-DECERTIFIED-MSG TO AMSGLN1O                  10330060
098300     ELSE                                                         10340060
098400         SET CA-CERTIFICATION-REQUIRED TO TRUE                    10350060
098500         PERFORM 7600-DEL-CERT-REQ-ROW-TUPCCER                    10360060
098600                                                                  10370060
098700         SET CA-NO-SCAN TO TRUE                                   10380060
098800         PERFORM 7500-INSERT-TUPCCER                              10390060
098900                                                                  10400060
099000         PERFORM 7150-GET-INTERNAL-FROM-TUPC                              
099100         MOVE UPC-UPC-ID TO PV-INTERNAL-UPC-ID                            
099200         PERFORM 4070-DECERTIFY-SKU-ON-TUPC                               
099300                                                                  10470060
099400         MOVE CA-ITEM-NBR TO PV-ITEM-NBR                          10480060
099500         PERFORM 4010-OPEN-DECERTIFY-CURSOR                       10490060
099600                                                                  10500060
099700         PERFORM 4030-FETCH-DECERTIFY-CURSOR                      10510060
099800                                                                  10520060
099900         PERFORM 4020-UPDATE-DECERTIFY-CURSOR                     10530060
100000             UNTIL SQLCODE = PC-ROW-NOT-FOUND                     10540060
100100                                                                  10550060
100200         PERFORM 4040-CLOSE-DECERTIFY-CURSOR                      10560060
100300                                                                  10570060
100400         MOVE PC-UPCS-DECERTIFIED-MSG TO AMSGLN1O                 10580060
100500     END-IF.                                                      10590060
100600                                                                  10600060
100700     MOVE SPACES TO AMSGLN2O                                      10610060
100800                    AMSGLN3O                                      10620060
100900                    AMSGLN4O.                                     10630060
101000     PERFORM 8100-SEND-DATA-ONLY.                                 10640060
101100     PERFORM 8200-RETURN-TRANID.                                  10650060
101200*                                                                 10660060
101300 4010-OPEN-DECERTIFY-CURSOR.                                      10670060
101400     PERFORM                                                      10680060
101500         WITH TEST AFTER                                          10690060
101600         VARYING PV-OPEN-COUNTER                                  10700060
101700         FROM 1 BY 1                                              10710060
101800         UNTIL (PV-OPEN-COUNTER > PC-MAX-RETRIES                  10720060
101900                   OR SQLCODE = ZERO                              10730060
102000                   OR SQLCODE = PC-ROW-NOT-FOUND)                 10740060
102100                                                                  10750060
102200         EXEC SQL                                                 10760060
102300             OPEN DECERTIFY_CSR                                   10770060
102400         END-EXEC                                                 10780060
102500                                                                  10790060
102600         EVALUATE TRUE                                            10800060
102700             WHEN SQLCODE = ZERO                                  10810060
102800                 CONTINUE                                         10820060
102900             WHEN SQLWARN0 NOT = SPACES                           10830060
103000             WHEN SQLCODE < ZERO                                  10840060
103100             WHEN SQLCODE > ZERO                                  10850060
103200                 MOVE '4010-OPEN-DECERTIFY-CURSOR'                10860060
103300                     TO DP013-PARAGRAPH                           10870060
103400                 MOVE 'OPEN THE DECERTIFY_CSR'                    10880060
103500                     TO DP013-MESSAGE-TEXT (1)                    10890060
103600                 MOVE SQLCA          TO DP013-SQLCA               10900060
103700                 MOVE 'TUPCSKU'      TO DP013-DB2-TABLE-NAME (1)  10910060
103800                 SET DP013-DB2-ABEND TO TRUE                      10920060
103900                 SET DP013-ROLLBACK  TO TRUE                      10930060
104000                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           10940060
104100                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O       10950060
104200                 PERFORM 8100-SEND-DATA-ONLY                      10960060
104300                 PERFORM 8200-RETURN-TRANID                       10970060
104400         END-EVALUATE                                             10980060
104500     END-PERFORM.                                                 10990060
104600                                                                  11000060
104700     IF PV-OPEN-COUNTER > PC-MAX-RETRIES                          11010060
104800         MOVE '4010-OPEN-DECERTIFY-CURSOR'                        11020060
104900             TO DP013-PARAGRAPH                                   11030060
105000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN'       11040060
105100             TO DP013-MESSAGE-TEXT (1)                            11050060
105200         MOVE 'THE DECERTIFY_CSR'                                 11060060
105300             TO DP013-MESSAGE-TEXT (2)                            11070060
105400         MOVE SQLCA          TO DP013-SQLCA                       11080060
105500         MOVE 'TUPCSKU'      TO DP013-DB2-TABLE-NAME (1)          11090060
105600         SET DP013-DB2-ABEND TO TRUE                              11100060
105700         SET DP013-ROLLBACK  TO TRUE                              11110060
105800         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   11120060
105900         MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O               11130060
106000         PERFORM 8100-SEND-DATA-ONLY                              11140060
106100         PERFORM 8200-RETURN-TRANID                               11150060
106200     END-IF.                                                      11160060
106300*                                                                 11170060
106400 4020-UPDATE-DECERTIFY-CURSOR.                                    11180060
106500     PERFORM                                                      11190060
106600         WITH TEST AFTER                                          11200060
106700         VARYING PV-UPDATE-COUNTER                                11210060
106800         FROM 1 BY 1                                              11220060
106900         UNTIL (PV-UPDATE-COUNTER > PC-MAX-RETRIES                11230060
107000                   OR SQLCODE = ZERO                              11240060
107100                   OR SQLCODE = PC-ROW-NOT-FOUND)                 11250060
107200                                                                  11260060
107300         EXEC SQL                                                 11270060
107400             UPDATE TUPCSKU                                       11280060
107500                SET CERT_IND      = 'N',                          11290060
107600                    CERT_DTE      = :PV-CURRENT-DATE-TUPCSKU      11300060
107700              WHERE CURRENT OF DECERTIFY_CSR                      11310060
107800         END-EXEC                                                 11320060
107900                                                                  11330060
108000         EVALUATE TRUE                                            11340060
108100             WHEN SQLCODE = ZERO                                  11350060
108200                 SET CA-DECERTIFY-ALL-UPCS-FOR-SKU TO TRUE        11360060
108300                 MOVE TUPCSKU-UPC-NBR TO PV-UPC-NBR               11370060
108400                 PERFORM 7500-INSERT-TUPCCER                      11380060
108500             WHEN SQLCODE = -904                                  11390060
108600             WHEN SQLCODE = -913                                  11400060
108700             WHEN SQLCODE = +100                                  11410060
108800                 CONTINUE                                         11420060
108900             WHEN SQLWARN0 NOT = SPACES                           11430060
109000             WHEN SQLCODE < ZERO                                  11440060
109100             WHEN SQLCODE > ZERO                                  11450060
109200                 MOVE '4020-UPDATE-DECERTIFY-CURSOR'              11460060
109300                     TO DP013-PARAGRAPH                           11470060
109400                 MOVE 'UPDATE INFORMATION FOR THE DECERTIFY_CSR'  11480060
109500                     TO DP013-MESSAGE-TEXT (1)                    11490060
109600                 MOVE SQLCA          TO DP013-SQLCA               11500060
109700                 MOVE 'TUPCSKU'      TO DP013-DB2-TABLE-NAME (1)  11510060
109800                 SET DP013-DB2-ABEND TO TRUE                      11520060
109900                 SET DP013-ROLLBACK  TO TRUE                      11530060
110000                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           11540060
110100                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O       11550060
110200                 PERFORM 8100-SEND-DATA-ONLY                      11560060
110300                 PERFORM 8200-RETURN-TRANID                       11570060
110400         END-EVALUATE                                             11580060
110500     END-PERFORM.                                                 11590060
110600                                                                  11600060
110700     IF PV-UPDATE-COUNTER > PC-MAX-RETRIES                        11610060
110800         MOVE '4020-UPDATE-DECERTIFY-CURSOR'                      11620060
110900             TO DP013-PARAGRAPH                                   11630060
111000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE A'   11640060
111100             TO DP013-MESSAGE-TEXT (1)                            11650060
111200         MOVE 'ROW FROM THE DECERTIFY_CSR'                        11660060
111300             TO DP013-MESSAGE-TEXT (2)                            11670060
111400         MOVE SQLCA          TO DP013-SQLCA                       11680060
111500         MOVE 'TUPCSKU'      TO DP013-DB2-TABLE-NAME (1)          11690060
111600         SET DP013-DB2-ABEND TO TRUE                              11700060
111700         SET DP013-ROLLBACK  TO TRUE                              11710060
111800         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   11720060
111900         MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O               11730060
112000         PERFORM 8100-SEND-DATA-ONLY                              11740060
112100         PERFORM 8200-RETURN-TRANID                               11750060
112200     END-IF.                                                      11760060
112300                                                                  11770060
112400     PERFORM 4030-FETCH-DECERTIFY-CURSOR.                         11780060
112500*                                                                 11790060
112600 4030-FETCH-DECERTIFY-CURSOR.                                     11800060
112700     PERFORM                                                      11810060
112800         WITH TEST AFTER                                          11820060
112900         VARYING PV-FETCH-COUNTER                                 11830060
113000         FROM 1 BY 1                                              11840060
113100         UNTIL (PV-FETCH-COUNTER > PC-MAX-RETRIES                 11850060
113200                   OR SQLCODE = ZERO                              11860060
113300                   OR SQLCODE = PC-ROW-NOT-FOUND)                 11870060
113400                                                                  11880060
113500         EXEC SQL                                                 11890060
113600             FETCH DECERTIFY_CSR                                  11900060
113700                INTO :TUPCSKU-UPC-NBR,                            11910060
113800                     :TUPCSKU-CERT-IND,                           11920060
113900                     :TUPCSKU-CERT-DTE                            11930060
114000         END-EXEC                                                 11940060
114100                                                                  11950060
114200         EVALUATE TRUE                                            11960060
114300             WHEN SQLCODE = ZERO                                  11970060
114400             WHEN SQLCODE = -904                                  11980060
114500             WHEN SQLCODE = -913                                  11990060
114600             WHEN SQLCODE = +100                                  12000060
114700                 CONTINUE                                         12010060
114800             WHEN SQLWARN0 NOT = SPACES                           12020060
114900             WHEN SQLCODE < ZERO                                  12030060
115000             WHEN SQLCODE > ZERO                                  12040060
115100                 MOVE '4030-FETCH-DECERTIFY-CURSOR'               12050060
115200                     TO DP013-PARAGRAPH                           12060060
115300                 MOVE 'FETCH INFORMATION FOR THE DECERTIFY_CSR'   12070060
115400                     TO DP013-MESSAGE-TEXT (1)                    12080060
115500                 MOVE SQLCA          TO DP013-SQLCA               12090060
115600                 MOVE 'TUPCSKU'      TO DP013-DB2-TABLE-NAME (1)  12100060
115700                 SET DP013-DB2-ABEND TO TRUE                      12110060
115800                 SET DP013-ROLLBACK  TO TRUE                      12120060
115900                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           12130060
116000                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O       12140060
116100                 PERFORM 8100-SEND-DATA-ONLY                      12150060
116200                 PERFORM 8200-RETURN-TRANID                       12160060
116300         END-EVALUATE                                             12170060
116400     END-PERFORM.                                                 12180060
116500                                                                  12190060
116600     IF PV-FETCH-COUNTER > PC-MAX-RETRIES                         12200060
116700        MOVE '4030-FETCH-DECERTIFY-CURSOR'                        12210060
116800            TO DP013-PARAGRAPH                                    12220060
116900        MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO FETCH A ROW' 12230060
117000            TO DP013-MESSAGE-TEXT (1)                             12240060
117100        MOVE 'FROM THE DECERTIFY_CSR'                             12250060
117200            TO DP013-MESSAGE-TEXT (2)                             12260060
117300        MOVE SQLCA          TO DP013-SQLCA                        12270060
117400        MOVE 'TUPCSKU'      TO DP013-DB2-TABLE-NAME (1)           12280060
117500        SET DP013-DB2-ABEND TO TRUE                               12290060
117600        SET DP013-ROLLBACK  TO TRUE                               12300060
117700        PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                    12310060
117800        MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O                12320060
117900        PERFORM 8100-SEND-DATA-ONLY                               12330060
118000        PERFORM 8200-RETURN-TRANID                                12340060
118100     END-IF.                                                      12350060
118200*                                                                 12360060
118300 4040-CLOSE-DECERTIFY-CURSOR.                                     12370060
118400     PERFORM                                                      12380060
118500         WITH TEST AFTER                                          12390060
118600         VARYING PV-CLOSE-COUNTER                                 12400060
118700         FROM 1 BY 1                                              12410060
118800         UNTIL (PV-CLOSE-COUNTER > PC-MAX-RETRIES                 12420060
118900                   OR SQLCODE = ZERO                              12430060
119000                   OR SQLCODE = PC-ROW-NOT-FOUND)                 12440060
119100                                                                  12450060
119200         EXEC SQL                                                 12460060
119300             CLOSE DECERTIFY_CSR                                  12470060
119400         END-EXEC                                                 12480060
119500                                                                  12490060
119600         EVALUATE TRUE                                            12500060
119700             WHEN SQLCODE = ZERO                                  12510060
119800                 CONTINUE                                         12520060
119900             WHEN SQLWARN0 NOT = SPACES                           12530060
120000             WHEN SQLCODE < ZERO                                  12540060
120100             WHEN SQLCODE > ZERO                                  12550060
120200                 MOVE '4040-CLOSE-DECERTIFY-CURSOR'               12560060
120300                     TO DP013-PARAGRAPH                           12570060
120400                 MOVE 'CLOSE THE DECERTIFY_CSR'                   12580060
120500                     TO DP013-MESSAGE-TEXT (1)                    12590060
120600                 MOVE SQLCA          TO DP013-SQLCA               12600060
120700                 MOVE 'TUPCSKU'      TO DP013-DB2-TABLE-NAME (1)  12610060
120800                 SET DP013-DB2-ABEND TO TRUE                      12620060
120900                 SET DP013-ROLLBACK  TO TRUE                      12630060
121000                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           12640060
121100                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O       12650060
121200                 PERFORM 8100-SEND-DATA-ONLY                      12660060
121300                 PERFORM 8200-RETURN-TRANID                       12670060
121400         END-EVALUATE                                             12680060
121500     END-PERFORM.                                                 12690060
121600                                                                  12700060
121700     IF PV-CLOSE-COUNTER > PC-MAX-RETRIES                         12710060
121800         MOVE '4040-CLOSE-DECERTIFY-CURSOR'                       12720060
121900             TO DP013-PARAGRAPH                                   12730060
122000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO CLOSE'      12740060
122100             TO DP013-MESSAGE-TEXT (1)                            12750060
122200         MOVE 'THE DECERTIFY_CSR'                                 12760060
122300             TO DP013-MESSAGE-TEXT (2)                            12770060
122400         MOVE SQLCA          TO DP013-SQLCA                       12780060
122500         MOVE 'TUPCSKU'      TO DP013-DB2-TABLE-NAME (1)          12790060
122600         SET DP013-DB2-ABEND TO TRUE                              12800060
122700         SET DP013-ROLLBACK  TO TRUE                              12810060
122800         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   12820060
122900         MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O               12830060
123000         PERFORM 8100-SEND-DATA-ONLY                              12840060
123100         PERFORM 8200-RETURN-TRANID                               12850060
123200     END-IF.                                                      12860060
123300*                                                                 12870060
123400 4050-DECERTIFY-SCANNED-SKU.                                      12880060
123500     PERFORM                                                      12890060
123600         WITH TEST AFTER                                          12900060
123700         VARYING PV-UPDATE-COUNTER                                12910060
123800         FROM 1 BY 1                                              12920060
123900         UNTIL (PV-UPDATE-COUNTER > PC-MAX-RETRIES                12930060
124000                   OR SQLCODE = ZERO                              12940060
124100                   OR SQLCODE = PC-ROW-NOT-FOUND)                 12950060
124200                                                                  12960060
124300         EXEC SQL                                                 12970060
124400             UPDATE TUPCSKU                                       12980060
124500                SET PLU_DWNLD_IND = 'N',                          12990060
124600                    CERT_IND = 'N',                               13000060
124700                    CERT_DTE = :PV-CURRENT-DATE-TUPCSKU           13010060
124800              WHERE (ITEM_NBR = :PV-SCANNED-ITEM-NBR              13020060
124900                AND   UPC_NBR = :PV-UPC-NBR)                      13030060
125000         END-EXEC                                                 13040060
125100                                                                  13050060
125200         EVALUATE TRUE                                            13060060
125300             WHEN SQLCODE = ZERO                                  13070060
125400             WHEN SQLCODE = +100                                  13080060
125500             WHEN SQLCODE = -904                                  13090060
125600             WHEN SQLCODE = -913                                  13100060
125700                 CONTINUE                                         13110060
125800             WHEN SQLWARN0 NOT = SPACES                           13120060
125900             WHEN SQLCODE  NOT = ZERO                             13130060
126000                 MOVE '4050-DECERTIFY-SCANNED-SKU'                13140060
126100                     TO DP013-PARAGRAPH                           13150060
126200                 MOVE 'UPDATE INFORMATION FOR THE FOLLOWING'      13160060
126300                     TO DP013-MESSAGE-TEXT (1)                    13170060
126400                 MOVE 'SCANNED ITEM NUMBER: '                     13180060
126500                     TO DP013-MESSAGE-TEXT (2)                    13190060
126600                 MOVE PV-SCANNED-ITEM-NBR                         13200060
126700                     TO DP013-MESSAGE-TEXT (3)                    13210060
126800                 MOVE SQLCA          TO DP013-SQLCA               13220060
126900                 MOVE 'TUPCSKU'      TO DP013-DB2-TABLE-NAME (1)  13230060
127000                 SET DP013-DB2-ABEND TO TRUE                      13240060
127100                 SET DP013-ROLLBACK  TO TRUE                      13250060
127200                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           13260060
127300                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O       13270060
127400                 PERFORM 8100-SEND-DATA-ONLY                      13280060
127500                 PERFORM 8200-RETURN-TRANID                       13290060
127600         END-EVALUATE                                             13300060
127700     END-PERFORM.                                                 13310060
127800                                                                  13320060
127900     IF PV-UPDATE-COUNTER > PC-MAX-RETRIES                        13330060
128000         MOVE '4050-DECERTIFY-SCANNED-SKU'                        13340060
128100             TO DP013-PARAGRAPH                                   13350060
128200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE A'   13360060
128300             TO DP013-MESSAGE-TEXT (1)                            13370060
128400         MOVE 'ROW FOR THE FOLLOWING SCANNED ITEM NUMBER'         13380060
128500             TO DP013-MESSAGE-TEXT (2)                            13390060
128600         MOVE PV-SCANNED-ITEM-NBR                                 13400060
128700             TO DP013-MESSAGE-TEXT (3)                            13410060
128800         MOVE SQLCA          TO DP013-SQLCA                       13420060
128900         MOVE 'TUPCSKU'      TO DP013-DB2-TABLE-NAME (1)          13430060
129000         SET DP013-DB2-ABEND TO TRUE                              13440060
129100         SET DP013-ROLLBACK  TO TRUE                              13450060
129200         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   13460060
129300         MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O               13470060
129400         PERFORM 8100-SEND-DATA-ONLY                              13480060
129500         PERFORM 8200-RETURN-TRANID                               13490060
129600     END-IF.                                                      13500060
129700                                                                  13510060
129800                                                                  13520060
129900******************************************************************13530060
130000* DECERTIFY THE SCANNED VENDOR UPC ON TUPC.                       13540060
130100******************************************************************13550060
130200 4060-DECERTIFY-UPC-ON-TUPC.                                      13560060
130300                                                                  13570060
130400     MOVE '4060-DECERTIFY-UPC-ON-TUPC' TO DP013-PARAGRAPH.        13580060
130500                                                                  13590060
130600     PERFORM                                                      13600060
130700         WITH TEST AFTER                                          13610060
130800         VARYING PV-UPDATE-COUNTER                                13620060
130900         FROM 1 BY 1                                              13630060
131000         UNTIL (PV-UPDATE-COUNTER > PC-MAX-RETRIES                13640060
131100                   OR SQLCODE = ZERO                              13650060
131200                   OR SQLCODE = PC-ROW-NOT-FOUND)                 13660060
131300                                                                  13670060
131400         EXEC SQL                                                 13680060
131500             UPDATE TUPC                                          13690060
131600                 SET CERTD_IND      = 'N'                         13700060
131700                    ,CERTD_DTE      = :PV-CURRENT-DATE-TUPCSKU    13710060
131800                    ,LAST_UPD_BY_USR_ID = :PV-USER-ID-NBR         13720060
131900                    ,LAST_UPD_TMST  = CURRENT TIMESTAMP           13730060
132000             WHERE  UPC_NBR         = :CA-MISMATCHED-UPC-NBR      13740060
132100               AND (EFF_BEG_DTE <= CURRENT DATE                   13750060
132200               AND (EFF_END_DTE IS NULL                           13760060
132300                OR  EFF_END_DTE > CURRENT DATE))                  13770060
132400         END-EXEC                                                 13780060
132500                                                                  13790060
132600         EVALUATE TRUE                                            13800060
132700             WHEN SQLCODE = ZERO                                  13810060
132800                  PERFORM 4061-DECERT-XLTUPC                              
132900             WHEN SQLCODE = +100                                  13820060
133000             WHEN SQLCODE = -904                                  13830060
133100             WHEN SQLCODE = -913                                  13840060
133200                 CONTINUE                                         13850060
133300             WHEN SQLWARN0 NOT = SPACES                           13860060
133400             WHEN SQLCODE NOT = ZERO                              13870060
133500                 MOVE 'UPDATE A ROW ON TUPC FOR THE FOLLOWING'    13880060
133600                     TO DP013-MESSAGE-TEXT (1)                    13890060
133700                 MOVE 'UPC:'                                      13900060
133800                     TO DP013-MESSAGE-TEXT (2)                    13910060
133900                 MOVE CA-MISMATCHED-UPC-NBR                               
134000                                     TO PV-DISPLAY-UPC-NBR                
134100                 MOVE PV-DISPLAY-UPC-NBR                          13930060
134200                                     TO DP013-MESSAGE-TEXT (3)    13940060
134300                 MOVE SQLCA          TO DP013-SQLCA               13950060
134400                 MOVE 'TUPC'         TO DP013-DB2-TABLE-NAME (1)  13960060
134500                 SET DP013-DB2-ABEND TO TRUE                      13970060
134600                 SET DP013-ROLLBACK  TO TRUE                      13980060
134700                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           13990060
134800                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O       14000060
134900                 PERFORM 8100-SEND-DATA-ONLY                      14010060
135000                 PERFORM 8200-RETURN-TRANID                       14020060
135100         END-EVALUATE                                             14030060
135200     END-PERFORM.                                                 14040060
135300                                                                  14050060
135400     IF PV-UPDATE-COUNTER > PC-MAX-RETRIES                        14060060
135500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE A'   14070060
135600                             TO DP013-MESSAGE-TEXT (1)            14080060
135700         MOVE 'ROW ON TUPC FOR THE FOLLOWING UPC:'                14090060
135800                             TO DP013-MESSAGE-TEXT (2)            14100060
135900         MOVE CA-MISMATCHED-UPC-NBR                                       
136000                                     TO PV-DISPLAY-UPC-NBR                
136100         MOVE PV-DISPLAY-UPC-NBR                                  14120060
136200                             TO DP013-MESSAGE-TEXT (3)            14130060
136300         MOVE SQLCA          TO DP013-SQLCA                       14140060
136400         MOVE 'TUPC'         TO DP013-DB2-TABLE-NAME (1)          14150060
136500         SET DP013-DB2-ABEND TO TRUE                              14160060
136600         SET DP013-ROLLBACK  TO TRUE                              14170060
136700         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   14180060
136800         MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O               14190060
136900         PERFORM 8100-SEND-DATA-ONLY                              14200060
137000         PERFORM 8200-RETURN-TRANID                               14210060
137100     END-IF.                                                      14220060
137200                                                                  14230060
137300                                                                  14240060
137400 4061-DECERT-XLTUPC.                                                    60
137500                                                                  13570060
137600     MOVE '4061-DECERT-XLTUPC '        TO DP013-PARAGRAPH.        13580060
137700                                                                  13670060
137800         EXEC SQL                                                 13680060
137900             UPDATE XLT_UPC                                       13690060
138000                 SET CERTD_IND      = 'N'                         13700060
138100                    ,CERTD_DTE      = :PV-CURRENT-DATE-TUPCSKU    13710060
138200             WHERE  UPC_NBR         = :CA-MISMATCHED-UPC-NBR      13740060
138300         END-EXEC                                                 13780060
138400                                                                  13790060
138500         EVALUATE TRUE                                            13800060
138600             WHEN SQLCODE = ZERO                                  13810060
138700             WHEN SQLCODE = +100                                  13820060
138800                 CONTINUE                                         13850060
138900             WHEN SQLWARN0 NOT = SPACES                           13860060
139000             WHEN SQLCODE NOT = ZERO                              13870060
139100                 MOVE                                                     
139200                 'UPDATE A ROW ON XLT_UPC FOR THE FOLLOWING'              
139300                     TO DP013-MESSAGE-TEXT (1)                    13890060
139400                 MOVE 'UPC:'                                      13900060
139500                     TO DP013-MESSAGE-TEXT (2)                    13910060
139600                 MOVE CA-MISMATCHED-UPC-NBR                               
139700                                    TO PV-DISPLAY-UPC-NBR                 
139800                 MOVE PV-DISPLAY-UPC-NBR                          13930060
139900                                     TO DP013-MESSAGE-TEXT (3)    13940060
140000                 MOVE SQLCA          TO DP013-SQLCA               13950060
140100                 MOVE 'XLT_UPC'      TO DP013-DB2-TABLE-NAME (1)  13960060
140200                 SET DP013-DB2-ABEND TO TRUE                      13970060
140300                 SET DP013-ROLLBACK  TO TRUE                      13980060
140400                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           13990060
140500                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O       14000060
140600                 PERFORM 8100-SEND-DATA-ONLY                      14010060
140700                 PERFORM 8200-RETURN-TRANID                       14020060
140800         END-EVALUATE.                                            14030060
140900                                                                  14050060
141000******************************************************************14250060
141100* DECERTIFY ALL ACTIVE VENDOR UPCS ON TUPC FOR THE SKU.           14260060
141200******************************************************************14270060
141300 4070-DECERTIFY-SKU-ON-TUPC.                                      14280060
141400                                                                  14290060
141500     MOVE '4070-DECERTIFY-SKU-ON-TUPC' TO DP013-PARAGRAPH.        14300060
141600                                                                  14310060
141700     PERFORM                                                      14320060
141800         WITH TEST AFTER                                          14330060
141900         VARYING PV-UPDATE-COUNTER                                14340060
142000         FROM 1 BY 1                                              14350060
142100         UNTIL (PV-UPDATE-COUNTER > PC-MAX-RETRIES                14360060
142200                   OR SQLCODE = ZERO                              14370060
142300                   OR PC-ROW-NOT-FOUND)                           14380060
142400                                                                  14390060
142500         EXEC SQL                                                 14400060
142600             UPDATE TUPC                                          14410060
142700                 SET CERTD_IND   = 'N'                            14420060
142800                    ,CERTD_DTE   = :PV-CURRENT-DATE-TUPCSKU       14430060
142900                    ,LAST_UPD_BY_USR_ID = :PV-USER-ID-NBR         14440060
143000                    ,LAST_UPD_TMST = CURRENT TIMESTAMP            14450060
143100             WHERE   INTR_UPC_ID = :PV-INTERNAL-UPC-ID            14460060
143200               AND  (EFF_BEG_DTE <= CURRENT DATE                  14470060
143300               AND  (EFF_END_DTE IS NULL                          14480060
143400                OR   EFF_END_DTE > CURRENT DATE))                 14490060
143500               AND   UPC_TYP_CDE = :PC-UPC-TYP-CDE-VENDOR         14500060
143600         END-EXEC                                                 14510060
143700                                                                  14520060
143800         EVALUATE TRUE                                            14530060
143900             WHEN SQLCODE = ZERO                                  14540060
144000                  PERFORM 4071-DECERT-SKU-ON-XLTUPC                       
144100             WHEN SQLCODE = +100                                  14550060
144200             WHEN SQLCODE = -904                                  14560060
144300             WHEN SQLCODE = -913                                  14570060
144400                 CONTINUE                                         14580060
144500             WHEN SQLWARN0 NOT = SPACES                           14590060
144600             WHEN SQLCODE NOT = ZERO                              14600060
144700                 MOVE 'UPDATE ROWS ON TUPC FOR THE FOLLOWING'     14610060
144800                     TO DP013-MESSAGE-TEXT (1)                    14620060
144900                 MOVE 'SKU:'                                      14630060
145000                     TO DP013-MESSAGE-TEXT (2)                    14640060
145100                 MOVE CA-SKU-NBR     TO DP013-MESSAGE-TEXT (3)    14650060
145200                 MOVE SQLCA          TO DP013-SQLCA               14660060
145300                 MOVE 'TUPC'         TO DP013-DB2-TABLE-NAME (1)  14670060
145400                 SET DP013-DB2-ABEND TO TRUE                      14680060
145500                 SET DP013-ROLLBACK  TO TRUE                      14690060
145600                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           14700060
145700                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O       14710060
145800                 PERFORM 8100-SEND-DATA-ONLY                      14720060
145900                 PERFORM 8200-RETURN-TRANID                       14730060
146000         END-EVALUATE                                             14740060
146100     END-PERFORM.                                                 14750060
146200                                                                  14760060
146300     IF PV-UPDATE-COUNTER > PC-MAX-RETRIES                        14770060
146400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE'     14780060
146500                             TO DP013-MESSAGE-TEXT (1)            14790060
146600         MOVE 'ROWS ON TUPC FOR THE FOLLOWING SKU:'               14800060
146700                             TO DP013-MESSAGE-TEXT (2)            14810060
146800         MOVE CA-SKU-NBR     TO DP013-MESSAGE-TEXT (3)            14820060
146900         MOVE SQLCA          TO DP013-SQLCA                       14830060
147000         MOVE 'TUPC'         TO DP013-DB2-TABLE-NAME (1)          14840060
147100         SET DP013-DB2-ABEND TO TRUE                              14850060
147200         SET DP013-ROLLBACK  TO TRUE                              14860060
147300         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   14870060
147400         MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O               14880060
147500         PERFORM 8100-SEND-DATA-ONLY                              14890060
147600         PERFORM 8200-RETURN-TRANID                               14900060
147700     END-IF.                                                      14910060
147800                                                                  14920060
147900                                                                  14930060
148000 4071-DECERT-SKU-ON-XLTUPC.                                             60
148100                                                                  14290060
148200     MOVE '4071-DECERT-SKU-ON-XLTUPC ' TO DP013-PARAGRAPH.        14300060
148300                                                                  14310060
148400                                                                  14390060
148500         EXEC SQL                                                 14400060
148600             UPDATE XLT_UPC                                       14410060
148700                 SET CERTD_IND   = 'N'                            14420060
148800                    ,CERTD_DTE   = :PV-CURRENT-DATE-TUPCSKU       14430060
148900             WHERE   INTR_UPC_ID = :PV-INTERNAL-UPC-ID            14460060
149000               AND   UPC_TYP_CDE = :PC-UPC-TYP-CDE-VENDOR         14500060
149100         END-EXEC                                                 14510060
149200                                                                  14520060
149300         EVALUATE TRUE                                            14530060
149400             WHEN SQLCODE = ZERO                                  14540060
149500             WHEN SQLCODE = +100                                  14550060
149600             WHEN SQLCODE = -904                                  14560060
149700             WHEN SQLCODE = -913                                  14570060
149800                 CONTINUE                                         14580060
149900             WHEN SQLWARN0 NOT = SPACES                           14590060
150000             WHEN SQLCODE NOT = ZERO                              14600060
150100                 MOVE                                                     
150200                 'UPDATE ROWS ON XLTUPC FOR THE FOLLOWING'                
150300                     TO DP013-MESSAGE-TEXT (1)                    14620060
150400                 MOVE 'INTR UPC ID: '                             14630060
150500                     TO DP013-MESSAGE-TEXT (2)                    14640060
150600                 MOVE PV-INTERNAL-UPC-ID                                  
150700                                     TO PV-DISPLAY-UPC-NBR                
150800                 MOVE PV-DISPLAY-UPC-NBR                                  
150900                                     TO DP013-MESSAGE-TEXT (3)            
151000                 MOVE SQLCA          TO DP013-SQLCA               14660060
151100                 MOVE 'XLT_UPC'      TO DP013-DB2-TABLE-NAME (1)  14670060
151200                 SET DP013-DB2-ABEND TO TRUE                      14680060
151300                 SET DP013-ROLLBACK  TO TRUE                      14690060
151400                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           14700060
151500                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O       14710060
151600                 PERFORM 8100-SEND-DATA-ONLY                      14720060
151700                 PERFORM 8200-RETURN-TRANID                       14730060
151800         END-EVALUATE.                                            14740060
151900                                                                  14760060
152000 5000-XCTL-TO-CERTIFY-SELECTION.                                  14940060
152100     SET CA-INITIALIZE-SCREEN     TO TRUE.                        14950060
152200     MOVE PC-CURRENT-PROGRAM-NAME TO CA-LAST-PROGRAM.             14960060
152300                                                                  14970060
152400     EXEC CICS                                                    14980060
152500         XCTL  PROGRAM   (PC-UPC-CERTIFY-SELECTION-PGM)           14990060
152600               COMMAREA  (CA-COMMAREA)                            15000060
152700               LENGTH    (PC-COMMAREA-LENGTH)                     15010060
152800               RESP      (PV-CICS-RESPONSE)                       15020060
152900     END-EXEC.                                                    15030060
153000                                                                  15040060
153100     EVALUATE TRUE                                                15050060
153200         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 15060060
153300             CONTINUE                                             15070060
153400         WHEN OTHER                                               15080060
153500             MOVE '5000-XCTL-TO-CERTIFY-SELECTION'                15090060
153600                 TO DP013-PARAGRAPH                               15100060
153700             MOVE 'UNABLE TO XCTL TO THE UPC CERTIFICATION'       15110060
153800                 TO DP013-MESSAGE-TEXT (1)                        15120060
153900             MOVE 'SELECTION PROGRAM: '                           15130060
154000                 TO DP013-MESSAGE-TEXT (2)                        15140060
154100             MOVE PC-UPC-CERTIFY-SELECTION-PGM                    15150060
154200                 TO DP013-MESSAGE-TEXT (3)                        15160060
154300             SET DP013-CICS-ABEND TO TRUE                         15170060
154400             SET DP013-ROLLBACK   TO TRUE                         15180060
154500             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               15190060
154600             MOVE PC-TRANS-UNAVAILABLE-MSG TO AMSGLN4O            15200060
154700             PERFORM 8100-SEND-DATA-ONLY                          15210060
154800             PERFORM 8200-RETURN-TRANID                           15220060
154900     END-EVALUATE.                                                15230060
155000*                                                                 15240060
155100 7000-DETERMINE-UPC-EXISTENCE.                                    15250060
155200**                                                                15260080
155300**  KEEP THIS PARAGRAPH IN HERE SINCE WE ARE DETERMINING IF IT'S  15270080
155400**  ON TUPCSKU TO KNOW IF IT HAS TO BE INSERTED OR NOT - SLH      15280080
155500**                                                                15290080
155600     INITIALIZE DCLTUPCSKU.                                       15300060
155700                                                                  15310060
155800     PERFORM                                                      15320060
155900         WITH TEST AFTER                                          15330060
156000         VARYING PV-SELECT-COUNTER                                15340060
156100         FROM 1 BY 1                                              15350060
156200         UNTIL (PV-SELECT-COUNTER > PC-MAX-RETRIES                15360060
156300                   OR SQLCODE = ZERO                              15370060
156400                   OR SQLCODE = PC-ROW-NOT-FOUND)                 15380060
156500                                                                  15390060
156600         EXEC SQL                                                 15400060
156700             SELECT ITEM_NBR,                                     15410060
156800                    CERT_IND,                                     15420060
156900                    CERT_DTE                                      15430060
157000               INTO  :TUPCSKU-ITEM-NBR,                           15440060
157100                     :TUPCSKU-CERT-IND,                           15450060
157200                     :TUPCSKU-CERT-DTE                            15460060
157300               FROM  TUPCSKU                                      15470060
157400               WHERE UPC_NBR = :PV-UPC-NBR                        15480060
157500         END-EXEC                                                 15490060
157600                                                                  15500060
157700         EVALUATE TRUE                                            15510060
157800             WHEN SQLCODE = ZERO                                  15520060
157900             WHEN SQLCODE = -904                                  15530060
158000             WHEN SQLCODE = -913                                  15540060
158100                 CONTINUE                                         15550060
158200             WHEN SQLCODE = +100                                  15560060
158300                 SET PS-UPC-NOT-FOUND TO TRUE                     15570060
158400             WHEN SQLWARN0 NOT = SPACES                           15580060
158500             WHEN SQLCODE < ZERO                                  15590060
158600             WHEN SQLCODE > ZERO                                  15600060
158700                 MOVE '7000-DETERMINE-UPC-EXISTENCE'              15610060
158800                     TO DP013-PARAGRAPH                           15620060
158900                 MOVE 'SELECT INFORMATION FOR THE FOLLOWING UPC: '15630060
159000                     TO DP013-MESSAGE-TEXT (1)                    15640060
159100                 MOVE PV-UPC-NBR                                  15650060
159200                     TO DP013-MESSAGE-TEXT (2)                    15660060
159300                 MOVE SQLCA            TO DP013-SQLCA             15670060
159400                 MOVE 'TUPCSKU'        TO DP013-DB2-TABLE-NAME (1)15680060
159500                 SET DP013-DB2-ABEND   TO TRUE                    15690060
159600                 SET DP013-NO-ROLLBACK TO TRUE                    15700060
159700                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           15710060
159800                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O       15720060
159900                 PERFORM 8100-SEND-DATA-ONLY                      15730060
160000                 PERFORM 8200-RETURN-TRANID                       15740060
160100         END-EVALUATE                                             15750060
160200     END-PERFORM.                                                 15760060
160300                                                                  15770060
160400     IF PV-SELECT-COUNTER > PC-MAX-RETRIES                        15780060
160500         MOVE '7000-DETERMINE-UPC-EXISTENCE'                      15790060
160600             TO DP013-PARAGRAPH                                   15800060
160700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT A'   15810060
160800             TO DP013-MESSAGE-TEXT (1)                            15820060
160900         MOVE 'ROW FROM THE UPC CROSS REFERENCE TABLE FOR THE'    15830060
161000             TO DP013-MESSAGE-TEXT (2)                            15840060
161100         MOVE 'FOLLOWING UPC: '                                   15850060
161200             TO DP013-MESSAGE-TEXT (3)                            15860060
161300         MOVE PV-UPC-NBR                                          15870060
161400             TO DP013-MESSAGE-TEXT (4)                            15880060
161500         MOVE SQLCA            TO DP013-SQLCA                     15890060
161600         MOVE 'TUPCSKU'        TO DP013-DB2-TABLE-NAME (1)        15900060
161700         SET DP013-DB2-ABEND   TO TRUE                            15910060
161800         SET DP013-NO-ROLLBACK TO TRUE                            15920060
161900         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   15930060
162000         MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O               15940060
162100         PERFORM 8100-SEND-DATA-ONLY                              15950060
162200         PERFORM 8200-RETURN-TRANID                               15960060
162300     END-IF.                                                      15970060
162400                                                                  15980060
162500                                                                  15990060
162600 7050-GET-SCANNED-UPC-FROM-TUPC.                                  16000060
162700                                                                  16010060
162800     INITIALIZE XL001-ITEM-COMMAREA.                              17320080
162900     MOVE PV-UPC-NBR           TO XL001-KEY-UPC-NBR.              17330080
163000                                                                  17340080
163100     SET  XL001-BY-UPC-NBR                                        17350080
163200          XL001-SELECT-UPC        TO TRUE.                        17360080
163300                                                                  17370080
163400     CALL XL001-VSM-PGM USING  DFHEIBLK                           17380080
163500                               XL001-COMMAREA                     17390080
163600                               XL001-ITEM-COMMAREA.               17400080
163700                                                                  17410080
163800     EVALUATE TRUE                                                17420080
163900         WHEN XL001-UPC-SQLCODE = ZERO                            17430080
164000              SET PS-UPC-FOUND-ON-TUPC TO TRUE                            
164100              MOVE XL001-UPC-ID TO UPC-UPC-ID                             
164200              MOVE XL001-INTR-UPC-ID TO UPC-INTR-UPC-ID                   
164300*        WHEN XL001-UPC-CONTENTION                                17480080
164400*             CONTINUE                                            17490080
164500         WHEN XL001-UPC-NOT-FOUND                                 17500080
164600              SET PS-UPC-NOT-FOUND-ON-TUPC TO TRUE                      60
164700         WHEN XL001-UPC-SQLCODE > ZERO                            17520080
164800         WHEN XL001-UPC-SQLCODE < ZERO                            17530080
                    MOVE XL001-UPC-SQLCODE                                      
                         TO SQLCODE                                             
164900              MOVE '7050-GET-SCANNED-UPC-FROM-TUPC'               17540080
165000                   TO DP013-PARAGRAPH                             17550080
165100              MOVE 'SELECT THE SKU FOR THE FOLLOWING ITEM NBR:'   17560080
165200                   TO DP013-MESSAGE-TEXT (1)                      17570080
165300              MOVE TUPCSKU-ITEM-NBR                               17580080
165400                   TO DP013-MESSAGE-TEXT (2)                      17590080
165500              MOVE 'XLV_SKU'       TO DP013-DB2-TABLE-NAME (1)    17600080
165600              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              16430060
165700              MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O          16440060
165800              SET DP013-DB2-ABEND  TO TRUE                        17610080
165900     END-EVALUATE.                                                17630080
166000                                                                  17640060
       7060-CHK-XLT-PK-UPC.                                                     
           MOVE ZERO TO PS-ON-PK-UPC-IND                                        
                                                                                
101400     PERFORM                                                      10680060
101500         WITH TEST AFTER                                          10690060
101600         VARYING PV-SELECT-COUNTER                                10700060
101700         FROM 1 BY 1                                              10710060
101800         UNTIL (PV-SELECT-COUNTER > PC-MAX-RETRIES                10720060
101900                   OR SQLCODE = ZERO                              10730060
102000                   OR SQLCODE = PC-ROW-NOT-FOUND)                 10740060
               EXEC SQL                                                         
                   SELECT 1                                                     
                     INTO :PS-ON-PK-UPC-IND                                     
                     FROM XLT_PK_UPC                                            
                    WHERE UPC_NBR  = :PV-UPC-NBR                                
                    FETCH FIRST 1 ROWS ONLY                                     
               END-EXEC                                                         
                                                                                
108000         EVALUATE TRUE                                            11340060
108100             WHEN SQLCODE = ZERO                                  11350060
108500             WHEN SQLCODE = -904                                  11390060
108600             WHEN SQLCODE = -913                                  11400060
108700             WHEN SQLCODE = +100                                  11410060
108800                 CONTINUE                                         11420060
108900             WHEN SQLWARN0 NOT = SPACES                           11430060
109000             WHEN SQLCODE < ZERO                                  11440060
109100             WHEN SQLCODE > ZERO                                  11450060
109200                 MOVE '7060-CHK-XLT-PK-UPC'                       11460060
109300                     TO DP013-PARAGRAPH                           11470060
109400                 MOVE 'UPC EXISTENCE CHECK'                       11480060
109500                     TO DP013-MESSAGE-TEXT (1)                    11490060
109600                 MOVE SQLCA          TO DP013-SQLCA               11500060
109700                 MOVE 'XLT_PK_UPC'   TO DP013-DB2-TABLE-NAME (1)  11510060
109800                 SET DP013-DB2-ABEND TO TRUE                      11520060
109900                 SET DP013-ROLLBACK  TO TRUE                      11530060
110000                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           11540060
110100                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O       11550060
110200                 PERFORM 8100-SEND-DATA-ONLY                      11560060
110300                 PERFORM 8200-RETURN-TRANID                       11570060
110400         END-EVALUATE                                             11580060
110500     END-PERFORM.                                                 11590060
110600                                                                  11600060
110700     IF PV-UPDATE-COUNTER > PC-MAX-RETRIES                        11610060
110800         MOVE '7060-CHK-XLT-PK-UPC'                               11620060
110900             TO DP013-PARAGRAPH                                   11630060
111000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT A'   11640060
111100             TO DP013-MESSAGE-TEXT (1)                            11650060
111200         MOVE 'ROW'                                               11660060
111300             TO DP013-MESSAGE-TEXT (2)                            11670060
111400         MOVE SQLCA          TO DP013-SQLCA                       11680060
111500         MOVE 'XLT_PK_UPC'   TO DP013-DB2-TABLE-NAME (1)          11690060
111600         SET DP013-DB2-ABEND TO TRUE                              11700060
111700         SET DP013-ROLLBACK  TO TRUE                              11710060
111800         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   11720060
111900         MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O               11730060
112000         PERFORM 8100-SEND-DATA-ONLY                              11740060
112100         PERFORM 8200-RETURN-TRANID                               11750060
112200     END-IF.                                                      11760060
                                                                                
166100 7110-GET-UPC-FROM-NUM-SKU.                                       17310060
166200     INITIALIZE XL001-ITEM-COMMAREA.                              17320080
166300     MOVE CA-SEQ-NBR           TO XL001-KEY-SKU                   17330080
166400                                                                  17340080
166500     SET  XL001-BY-NUMERIC-SKU                                    17350080
166600          XL001-SELECT-UPC                                        17360080
166700          XL001-SELECT-SKU                                        17360080
166800          XL001-SELECT-VND-STYL   TO TRUE.                        17360080
166900                                                                  17370080
167000     CALL XL001-VSM-PGM USING  DFHEIBLK                           17380080
167100                               XL001-COMMAREA                     17390080
167200                               XL001-ITEM-COMMAREA.               17400080
167300                                                                  17410080
167400     EVALUATE TRUE                                                17420080
167500         WHEN XL001-UPC-SQLCODE = ZERO                            17430080
167600              MOVE XL001-UPC-NBR TO PV-INTERNAL-UPC-NBR                 80
167700         WHEN XL001-UPC-CONTENTION                                17480080
167800              CONTINUE                                            17490080
167900         WHEN XL001-UPC-SQLCODE > ZERO                            17520080
168000         WHEN XL001-UPC-SQLCODE < ZERO                            17530080
168100              MOVE '7110-GET-UPC-FROM-NUM-SKU'                    17540080
168200                   TO DP013-PARAGRAPH                             17550080
168300              MOVE 'SELECT THE UPC FOR THE FOLLOWING SKU:'        17560080
168400                   TO DP013-MESSAGE-TEXT (1)                      17570080
168500              MOVE CA-SEQ-NBR                                     17580080
168600                   TO DP013-MESSAGE-TEXT (2)                      17590080
168700              MOVE 'XLV_UPC'       TO DP013-DB2-TABLE-NAME (1)    17600080
168800              SET DP013-DB2-ABEND  TO TRUE                        17610080
168900              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              16430060
169000              MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O          16440060
169100     END-EVALUATE.                                                17630080
169200                                                                  17640060
169300******************************************************************17650060
169400* CACULATE THE INTERNAL UPC NUMBER FOR THE SKU AND RETRIEVE THE   17660060
169500* INTERNAL UPC FROM TUPC.  IF IT HAS BEEN RENUMBERED, USE ITS     17670060
169600* INTERNAL UPC ID TO GET THE CURRENT INTERNAL UPC.                17680060
169700******************************************************************17690060
169800 7150-GET-INTERNAL-FROM-TUPC.                                     17700060
169900                                                                  17710060
170000     INITIALIZE DCLTUPC.                                          17720060
170100     MOVE '7150-GET-INTERNAL-FROM-TUPC' TO DP013-PARAGRAPH.       17730060
170200                                                                  17740060
170300                                                                  17930060
170400     MOVE XL001-UPC-NBR TO PV-INTERNAL-UPC-NBR.                           
170500                                                                  17930060
170600     PERFORM                                                      17940060
170700         WITH TEST AFTER                                          17950060
170800         VARYING PV-SELECT-COUNTER                                17960060
170900         FROM 1 BY 1                                              17970060
171000         UNTIL (PV-SELECT-COUNTER > PC-MAX-RETRIES                17980060
171100                   OR SQLCODE = ZERO)                             17990060
171200                                                                  18000060
171300         EXEC SQL                                                 18010060
171400             SELECT UPC_ID                                        18020060
171500                   ,UPC_NBR                                       18030060
171600                   ,SUB_CL_MDSEAR_ID                              18040060
171700                   ,VS_ID                                         18050060
171800                   ,INTR_UPC_ID                                   18060060
171900                   ,UPC_TYP_CDE                                   18070060
172000                   ,KOHLS_SIZE_CDE                                18080060
172100                   ,NRF_CLOR_CDE                                  18090060
172200                   ,EDI_ORD_IND                                   18100060
172300                   ,GP_CDE                                        18110060
172400                   ,INNR_PK_QTY                                   18120060
172500                   ,OUTR_PK_QTY                                   18130060
172600                   ,SEA_SEQ_NBR                                   18140060
172700                   ,INTR_UPC_DESC                                 18190074
172800             INTO  :UPC-UPC-ID                                    18200060
172900                  ,:UPC-UPC-NBR                                   18210060
173000                  ,:UPC-SUB-CL-MDSEAR-ID                          18220060
173100                  ,:UPC-VS-ID                                     18230060
173200                  ,:UPC-INTR-UPC-ID                               18240060
173300                  ,:UPC-UPC-TYP-CDE                               18250060
173400                  ,:UPC-KOHLS-SIZE-CDE                            18260060
173500                  ,:UPC-NRF-CLOR-CDE                              18270060
173600                  ,:UPC-EDI-ORD-IND                               18280060
173700                  ,:UPC-GP-CDE                                    18290060
173800                  ,:UPC-INNR-PK-QTY                               18300060
173900                  ,:UPC-OUTR-PK-QTY                               18310060
174000                  ,:UPC-SEA-SEQ-NBR                               18320060
174100                  ,:UPC-INTR-UPC-DESC                             18370074
174200             FROM   TUPC                                          18380060
174300             WHERE  UPC_NBR     = :PV-INTERNAL-UPC-NBR            18390060
174400               AND (EFF_BEG_DTE <= CURRENT DATE                   18400060
174500               AND (EFF_END_DTE IS NULL                           18410060
174600                OR  EFF_END_DTE > CURRENT DATE))                  18420060
174700         END-EXEC                                                 18430060
174800                                                                  18440060
174900         EVALUATE TRUE                                            18450060
175000             WHEN SQLCODE = ZERO                                  18460060
175100             WHEN SQLCODE = -904                                  18470060
175200             WHEN SQLCODE = -913                                  18480060
175300                 CONTINUE                                         18490060
175400             WHEN SQLWARN0 NOT = SPACES                           18500060
175500             WHEN SQLCODE  NOT = ZERO                             18510060
175600                 MOVE 'SELECT INFORMATION FOR THE FOLLOWING UPC: '18520060
175700                     TO DP013-MESSAGE-TEXT (1)                    18530060
175800                 MOVE PV-INTERNAL-UPC-NBR                         18540060
175900                     TO DP013-MESSAGE-TEXT (2)                    18550060
176000                 MOVE SQLCA            TO DP013-SQLCA             18560060
176100                 MOVE 'TUPC'           TO DP013-DB2-TABLE-NAME (1)18570060
176200                 SET DP013-DB2-ABEND   TO TRUE                    18580060
176300                 SET DP013-NO-ROLLBACK TO TRUE                    18590060
176400                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           18600060
176500                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O       18610060
176600                 PERFORM 8100-SEND-DATA-ONLY                      18620060
176700                 PERFORM 8200-RETURN-TRANID                       18630060
176800         END-EVALUATE                                             18640060
176900     END-PERFORM.                                                 18650060
177000                                                                  18660060
177100     IF PV-SELECT-COUNTER > PC-MAX-RETRIES                        18670060
177200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT A'   18680060
177300                               TO DP013-MESSAGE-TEXT (1)          18690060
177400         MOVE 'ROW FROM THE UPC TABLE FOR THE FOLLOWING UPC: '    18700060
177500                               TO DP013-MESSAGE-TEXT (2)          18710060
177600         MOVE PV-INTERNAL-UPC-NBR                                 18720060
177700                               TO DP013-MESSAGE-TEXT (3)          18730060
177800         MOVE SQLCA            TO DP013-SQLCA                     18740060
177900         MOVE 'TUPC'           TO DP013-DB2-TABLE-NAME (1)        18750060
178000         SET DP013-DB2-ABEND   TO TRUE                            18760060
178100         SET DP013-NO-ROLLBACK TO TRUE                            18770060
178200         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   18780060
178300         MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O               18790060
178400         PERFORM 8100-SEND-DATA-ONLY                              18800060
178500         PERFORM 8200-RETURN-TRANID                               18810060
178600     END-IF.                                                      18820060
178700                                                                  18830060
178800                                                                  19780060
178900******************************************************************19790060
179000* THIS PARAGRAPH IS PERFORMED WHEN A VENDOR UPC IS NOT FOUND IN   19800060
179100* THE SYSTEM AND IT IS FOR A RENUMBERED SKU.  THIS PARAGRAPH      19810060
179200* ACCESSES THE TUPCSKU TABLE USING THE MOST CURRENT INTERNAL UPC  19820060
179300* FOR THE RENUMBERED SKU.  THE SELECT WILL RETURN THE ITEM NUMBER 19830060
179400* TO BE USED TO ACCURATELY INSERT THE VENDOR UPC INTO THE TUPCSKU 19840060
179500* TABLE.                                                          19850060
179600******************************************************************19860060
179700 7160-GET-ITEM-NBR-FOR-UPC.                                       19870060
179800                                                                  19880060
179900     PERFORM                                                      19890060
180000         WITH TEST AFTER                                          19900060
180100         VARYING PV-SELECT-COUNTER                                19910060
180200         FROM 1 BY 1                                              19920060
180300         UNTIL (PV-SELECT-COUNTER > PC-MAX-RETRIES                19930060
180400                   OR SQLCODE = ZERO)                             19940060
180500                                                                  19950060
180600         EXEC SQL                                                 19960060
180700             SELECT  ITEM_NBR                                     19970060
180800             INTO    :TUPCSKU-ITEM-NBR                            19980060
180900             FROM    TUPCSKU                                      19990060
181000             WHERE   UPC_NBR = :PV-CURR-INTERNAL-UPC-NBR          20000060
181100         END-EXEC                                                 20010060
181200                                                                  20020060
181300         EVALUATE TRUE                                            20030060
181400             WHEN SQLCODE = ZERO                                  20040060
181500             WHEN SQLCODE = -904                                  20050060
181600             WHEN SQLCODE = -913                                  20060060
181700                 CONTINUE                                         20070060
181800             WHEN SQLWARN0 NOT = SPACES                           20080060
181900             WHEN SQLCODE  NOT = ZERO                             20090060
182000                 MOVE '7160-GET-ITEM-NBR-FOR-UPC'                 20100060
182100                     TO DP013-PARAGRAPH                           20110060
182200                 MOVE 'SELECT OF TUPCSKU ROW FOR THE '            20120060
182300                     TO DP013-MESSAGE-TEXT (1)                    20130060
182400                 MOVE 'FOLLOWING UPC: '                           20140060
182500                     TO DP013-MESSAGE-TEXT (2)                    20150060
182600                 MOVE PV-CURR-INTERNAL-UPC-NBR                    20160060
182700                     TO DP013-MESSAGE-TEXT (3)                    20170060
182800                 MOVE SQLCA          TO DP013-SQLCA               20180060
182900                 MOVE 'TUPCSKU'      TO DP013-DB2-TABLE-NAME (1)  20190060
183000                 SET DP013-DB2-ABEND TO TRUE                      20200060
183100                 SET DP013-ROLLBACK  TO TRUE                      20210060
183200                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           20220060
183300                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O       20230060
183400                 PERFORM 8100-SEND-DATA-ONLY                      20240060
183500                 PERFORM 8200-RETURN-TRANID                       20250060
183600         END-EVALUATE                                             20260060
183700     END-PERFORM.                                                 20270060
183800                                                                  20280060
183900     IF PV-SELECT-COUNTER > PC-MAX-RETRIES                        20290060
184000         MOVE '7160-GET-ITEM-NBR-FOR-UPC'                         20300067
184100             TO DP013-PARAGRAPH                                   20310060
184200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT A'   20320060
184300             TO DP013-MESSAGE-TEXT (1)                            20330060
184400         MOVE 'ROW TO THE UPC TO SKU CROSS REFERENCE TABLE FOR'   20340060
184500             TO DP013-MESSAGE-TEXT (2)                            20350060
184600         MOVE 'THE FOLLOWING UPC: '                               20360060
184700             TO DP013-MESSAGE-TEXT (3)                            20370060
184800         MOVE PV-CURR-INTERNAL-UPC-NBR                            20380060
184900             TO DP013-MESSAGE-TEXT (4)                            20390060
185000         MOVE SQLCA          TO DP013-SQLCA                       20400060
185100         MOVE 'TUPCSKU'      TO DP013-DB2-TABLE-NAME (1)          20410060
185200         SET DP013-DB2-ABEND TO TRUE                              20420060
185300         SET DP013-ROLLBACK  TO TRUE                              20430060
185400         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   20440060
185500         MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O               20450060
185600         PERFORM 8100-SEND-DATA-ONLY                              20460060
185700         PERFORM 8200-RETURN-TRANID                               20470060
185800     END-IF.                                                      20480060
185900                                                                  20490060
186000******************************************************************20500060
186100* WHEN ADDING A VENDOR UPC, THE INTERNAL UPC FOR THE SKU IS       20510063
186200* CHECKED TO SEE IF IT'S EDI ORDER INDICATOR IS SET TO 'Y'.  IF   20520063
186300* SO, THE VENDOR UPC IS INSERTED WITH AN EDI ORDER INDICATOR SET  20530063
186400* TO 'Y' AND THE INTERNAL UPC EDI ORDER INDICATOR IS UPDATED TO   20540063
186500* 'N'.  THIS IS DONE SO THAT THE VENDOR UPC IS USED FOR EDI       20550063
186600* ORDERING INSTEAD OF THE INTERNAL UPC.                           20560063
186700*                                                                 20570066
186800* THE INTERNAL UPC MUST BE UPDATED ON BOTH THE TUPC AND TUPCSKU   20580066
186900* TABLES.                                                         20590066
187000******************************************************************20600060
187100 7165-UPDATE-INTERNAL-TUPC.                                       20610066
187200                                                                  20620062
187300     PERFORM                                                      20630063
187400         WITH TEST AFTER                                          20640063
187500         VARYING PV-UPDATE-COUNTER                                20650063
187600         FROM 1 BY 1                                              20660063
187700         UNTIL (PV-UPDATE-COUNTER > PC-MAX-RETRIES                20670063
187800                   OR SQLCODE = ZERO)                             20680063
187900                                                                  20690063
188000         EXEC SQL                                                 20700063
188100             UPDATE TUPC                                          20710066
188200                 SET EDI_ORD_IND = 'N'                            20720064
188300             WHERE UPC_NBR = :PV-CURR-INTERNAL-UPC-NBR            20730066
188400         END-EXEC                                                 20740063
188500                                                                  20750063
188600         EVALUATE TRUE                                            20760063
188700             WHEN SQLCODE = ZERO                                  20770063
188800             WHEN SQLCODE = -904                                  20780063
188900             WHEN SQLCODE = -913                                  20790063
189000                 CONTINUE                                         20800063
189100             WHEN SQLWARN0 NOT = SPACES                           20810063
189200             WHEN SQLCODE  NOT = ZERO                             20820063
189300                 MOVE '7165-UPDATE-INTERNAL-TUPC'                 20830066
189400                     TO DP013-PARAGRAPH                           20840063
189500                 MOVE 'UPDATE A ROW FROM THE UPC TABLE'           20850066
189600                     TO DP013-MESSAGE-TEXT (1)                    20860063
189700                 MOVE 'FOR THE FOLLOWING UPC:'                    20870066
189800                     TO DP013-MESSAGE-TEXT (2)                    20880063
189900                 MOVE PV-CURR-INTERNAL-UPC-NBR                    20890066
190000                     TO DP013-MESSAGE-TEXT (3)                    20900063
190100                 MOVE SQLCA          TO DP013-SQLCA               20910063
190200                 MOVE 'TUPC'         TO DP013-DB2-TABLE-NAME (1)  20920066
190300                 SET DP013-DB2-ABEND TO TRUE                      20930063
190400                 SET DP013-ROLLBACK  TO TRUE                      20940063
190500                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           20950063
190600                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O       20960063
190700                 PERFORM 8100-SEND-DATA-ONLY                      20970063
190800                 PERFORM 8200-RETURN-TRANID                       20980063
190900         END-EVALUATE                                             20990063
191000     END-PERFORM.                                                 21000063
191100                                                                  21010063
191200     IF PV-UPDATE-COUNTER > PC-MAX-RETRIES                        21020063
191300         MOVE '7165-UPDATE-INTERNAL-TUPC'                         21030066
191400             TO DP013-PARAGRAPH                                   21040063
191500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE A'   21050063
191600             TO DP013-MESSAGE-TEXT (1)                            21060063
191700         MOVE 'ROW FROM THE UPC TABLE FOR THE FOLLOWING UPC'      21070066
191800             TO DP013-MESSAGE-TEXT (2)                            21080063
191900         MOVE PV-CURR-INTERNAL-UPC-NBR                            21090066
192000             TO DP013-MESSAGE-TEXT (3)                            21100063
192100         MOVE SQLCA          TO DP013-SQLCA                       21110063
192200         MOVE 'TUPC'         TO DP013-DB2-TABLE-NAME (1)          21120066
192300         SET DP013-DB2-ABEND TO TRUE                              21130063
192400         SET DP013-ROLLBACK  TO TRUE                              21140063
192500         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   21150063
192600         MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O               21160063
192700         PERFORM 8100-SEND-DATA-ONLY                              21170063
192800         PERFORM 8200-RETURN-TRANID                               21180063
192900     END-IF.                                                      21190063
193000                                                                  21200066
193100******************************************************************21210066
193200* WHEN ADDING A VENDOR UPC, THE INTERNAL UPC FOR THE SKU IS       21220066
193300* CHECKED TO SEE IF IT'S EDI ORDER INDICATOR IS SET TO 'Y'.  IF   21230066
193400* SO, THE VENDOR UPC IS INSERTED WITH AN EDI ORDER INDICATOR SET  21240066
193500* TO 'Y' AND THE INTERNAL UPC EDI ORDER INDICATOR IS UPDATED TO   21250066
193600* 'N'.  THIS IS DONE SO THAT THE VENDOR UPC IS USED FOR EDI       21260066
193700* ORDERING INSTEAD OF THE INTERNAL UPC.                           21270066
193800*                                                                 21280066
193900* THE INTERNAL UPC MUST BE UPDATED ON BOTH THE TUPC AND TUPCSKU   21290066
194000* TABLES.                                                         21300066
194100******************************************************************21310066
194200 7170-UPDATE-INTERNAL-TUPCSKU.                                    21320068
194300                                                                  21330066
194400     PERFORM                                                      21340066
194500         WITH TEST AFTER                                          21350066
194600         VARYING PV-UPDATE-COUNTER                                21360066
194700         FROM 1 BY 1                                              21370066
194800         UNTIL (PV-UPDATE-COUNTER > PC-MAX-RETRIES                21380066
194900                   OR SQLCODE = ZERO)                             21390066
195000                                                                  21400066
195100         EXEC SQL                                                 21410066
195200             UPDATE TUPCSKU                                       21420066
195300                 SET EDI_ORD_IND = 'N'                            21430066
195400             WHERE UPC_NBR = :PV-CURR-INTERNAL-UPC-NBR            21440066
195500         END-EXEC                                                 21450066
195600                                                                  21460066
195700         EVALUATE TRUE                                            21470066
195800             WHEN SQLCODE = ZERO                                  21480066
195900             WHEN SQLCODE = -904                                  21490066
196000             WHEN SQLCODE = -913                                  21500066
196100                 CONTINUE                                         21510066
196200             WHEN SQLWARN0 NOT = SPACES                           21520066
196300             WHEN SQLCODE  NOT = ZERO                             21530066
196400                 MOVE '7170-UPDATE-INTERNAL-TUPCSKU'              21540066
196500                     TO DP013-PARAGRAPH                           21550066
196600                 MOVE 'UPDATE A ROW FROM THE UPC TO SKU CROSS'    21560066
196700                     TO DP013-MESSAGE-TEXT (1)                    21570066
196800                 MOVE 'REFERENCE TABLE FOR THE FOLLOWING UPC:'    21580066
196900                     TO DP013-MESSAGE-TEXT (2)                    21590066
197000                 MOVE PV-CURR-INTERNAL-UPC-NBR                    21600066
197100                     TO DP013-MESSAGE-TEXT (3)                    21610066
197200                 MOVE SQLCA          TO DP013-SQLCA               21620066
197300                 MOVE 'TUPCSKU'      TO DP013-DB2-TABLE-NAME (1)  21630066
197400                 SET DP013-DB2-ABEND TO TRUE                      21640066
197500                 SET DP013-ROLLBACK  TO TRUE                      21650066
197600                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           21660066
197700                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O       21670066
197800                 PERFORM 8100-SEND-DATA-ONLY                      21680066
197900                 PERFORM 8200-RETURN-TRANID                       21690066
198000         END-EVALUATE                                             21700066
198100     END-PERFORM.                                                 21710066
198200                                                                  21720066
198300     IF PV-UPDATE-COUNTER > PC-MAX-RETRIES                        21730066
198400         MOVE '7170-UPDATE-INTERNAL-TUPCSKU'                      21740066
198500             TO DP013-PARAGRAPH                                   21750066
198600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE A'   21760066
198700             TO DP013-MESSAGE-TEXT (1)                            21770066
198800         MOVE 'ROW FROM THE UPC TO SKU CROSS REFERENCE TABLE FOR' 21780066
198900             TO DP013-MESSAGE-TEXT (2)                            21790066
199000         MOVE 'THE FOLLOWING UPC:'                                21800066
199100             TO DP013-MESSAGE-TEXT (3)                            21810066
199200         MOVE PV-CURR-INTERNAL-UPC-NBR                            21820066
199300             TO DP013-MESSAGE-TEXT (4)                            21830066
199400         MOVE SQLCA          TO DP013-SQLCA                       21840066
199500         MOVE 'TUPCSKU'      TO DP013-DB2-TABLE-NAME (1)          21850066
199600         SET DP013-DB2-ABEND TO TRUE                              21860066
199700         SET DP013-ROLLBACK  TO TRUE                              21870066
199800         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   21880066
199900         MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O               21890066
200000         PERFORM 8100-SEND-DATA-ONLY                              21900066
200100         PERFORM 8200-RETURN-TRANID                               21910066
200200     END-IF.                                                      21920066
200300                                                                  21930066
200400******************************************************************21940063
200500* INSERTS A ROW TO THE UPC CROSS REFERENCE TABLE.  THIS MODULE    21950063
200600* IS EXECUTED FOR TWO CONDITIONS.  ONE IS A DANGLING UPC, THAT IS 21960063
200700* A UPC THAT EXISTS ON THE UPC CROSS REFERENCE TABLE AND DOES NOT 21970063
200800* HAVE A CORRESPONDING ENTRY BY ITEM NUMBER ON THE SKU TABLE.  THE21980063
200900* SECOND IS FOR A UPC THAT IS ENTERED AND HAS NO CORRESPONDING    21990063
201000* ROW ON THE UPC CROSS REFERENCE TABLE.                           22000063
201100******************************************************************22010062
201200 7200-INSERT-UPC-TUPCSKU.                                         22020062
201300     PERFORM                                                      22030060
201400         WITH TEST AFTER                                          22040060
201500         VARYING PV-INSERT-COUNTER                                22050060
201600         FROM 1 BY 1                                              22060060
201700         UNTIL (PV-INSERT-COUNTER > PC-MAX-RETRIES                22070060
201800                   OR SQLCODE = ZERO)                             22080060
201900                                                                  22090060
202000         EXEC SQL                                                 22100060
202100             INSERT INTO TUPCSKU                                  22110060
202200                    (UPC_NBR,                                     22120060
202300                     ITEM_NBR,                                    22130060
202400                     EDI_ORD_IND,                                 22140060
202500                     PLU_DWNLD_IND,                               22150060
202600                     XREF_CRE_DTE,                                22160060
202700                     UPC_DESC,                                    22170060
202800                     CERT_IND,                                    22180060
202900                     CERT_DTE,                                    22190060
203000                     UPC_SRC_IND)                                 22200060
203100             VALUES (:PV-UPC-NBR,                                 22210060
203200                     :PV-INSERT-ITEM-NBR,                         22220060
203300                     :PV-EDI-ORD-IND,                             22230063
203400                     'Y',                                         22240060
203500                     :PV-CURRENT-DATE-TUPCSKU,                    22250060
203600                     :TUPCSKU-UPC-DESC,                           22260060
203700                     'Y',                                         22270060
203800                     :PV-CURRENT-DATE-TUPCSKU,                    22280060
203900                     'C')                                         22290060
204000         END-EXEC                                                 22300060
204100                                                                  22310060
204200         EVALUATE TRUE                                            22320060
204300             WHEN SQLCODE = ZERO                                  22330060
204400             WHEN SQLCODE = -904                                  22340060
204500             WHEN SQLCODE = -913                                  22350060
204600                 CONTINUE                                         22360060
204700             WHEN SQLWARN0 NOT = SPACES                           22370060
204800             WHEN SQLCODE  NOT = ZERO                             22380060
204900                 MOVE '7200-INSERT-UPC-TUPCSKU'                   22390060
205000                     TO DP013-PARAGRAPH                           22400060
205100                 MOVE 'INSERT A ROW TO THE UPC TO SKU CROSS'      22410060
205200                     TO DP013-MESSAGE-TEXT (1)                    22420060
205300                 MOVE 'REFERENCE TABLE FOR THE FOLLOWING UPC'     22430060
205400                     TO DP013-MESSAGE-TEXT (2)                    22440060
205500                 MOVE 'AND ITEM NUMBER: '                         22450060
205600                     TO DP013-MESSAGE-TEXT (3)                    22460060
205700                 MOVE PV-UPC-NBR  TO PV-DISPLAY-UPC-NBR           22470060
205800                 MOVE CA-ITEM-NBR TO PV-DISPLAY-ITEM-NBR          22480060
205900                 MOVE PV-DISPLAY-UPC-AND-ITEM-NBR                 22490060
206000                     TO DP013-MESSAGE-TEXT (4)                    22500060
206100                 MOVE SQLCA          TO DP013-SQLCA               22510060
206200                 MOVE 'TUPCSKU'      TO DP013-DB2-TABLE-NAME (1)  22520060
206300                 SET DP013-DB2-ABEND TO TRUE                      22530060
206400                 SET DP013-ROLLBACK  TO TRUE                      22540060
206500                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           22550060
206600                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O       22560060
206700                 PERFORM 8100-SEND-DATA-ONLY                      22570060
206800                 PERFORM 8200-RETURN-TRANID                       22580060
206900         END-EVALUATE                                             22590060
207000     END-PERFORM.                                                 22600060
207100                                                                  22610060
207200     IF PV-INSERT-COUNTER > PC-MAX-RETRIES                        22620060
207300         MOVE '7200-INSERT-UPC-TUPCSKU'                           22630060
207400             TO DP013-PARAGRAPH                                   22640060
207500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO INSERT A'   22650060
207600             TO DP013-MESSAGE-TEXT (1)                            22660060
207700         MOVE 'ROW TO THE UPC TO SKU CROSS REFERENCE TABLE FOR'   22670060
207800             TO DP013-MESSAGE-TEXT (2)                            22680060
207900         MOVE 'THE FOLLOWING UPC AND ITEM NUMBER: '               22690060
208000             TO DP013-MESSAGE-TEXT (3)                            22700060
208100         MOVE PV-UPC-NBR  TO PV-DISPLAY-UPC-NBR                   22710060
208200         MOVE CA-ITEM-NBR TO PV-DISPLAY-ITEM-NBR                  22720060
208300         MOVE PV-DISPLAY-UPC-AND-ITEM-NBR                         22730060
208400             TO DP013-MESSAGE-TEXT (4)                            22740060
208500         MOVE SQLCA          TO DP013-SQLCA                       22750060
208600         MOVE 'TUPCSKU'      TO DP013-DB2-TABLE-NAME (1)          22760060
208700         SET DP013-DB2-ABEND TO TRUE                              22770060
208800         SET DP013-ROLLBACK  TO TRUE                              22780060
208900         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   22790060
209000         MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O               22800060
209100         PERFORM 8100-SEND-DATA-ONLY                              22810060
209200         PERFORM 8200-RETURN-TRANID                               22820060
209300     END-IF.                                                      22830060
209400                                                                  22840060
209500                                                                  22850060
209600******************************************************************22860060
209700* INSERT A ROW TO THE UPC TABLE (TUPC).                           22870060
209800******************************************************************22880060
209900 7250-INSERT-TUPC-ROW.                                            22890060
210000                                                                  22900060
210100     MOVE  '7250-INSERT-UPC-TUPC' TO DP013-PARAGRAPH.             22910060
210200                                                                  22920060
210300     PERFORM                                                      22930060
210400         WITH TEST AFTER                                          22940060
210500         VARYING PV-INSERT-COUNTER                                22950060
210600         FROM 1 BY 1                                              22960060
210700         UNTIL PV-INSERT-COUNTER > PC-MAX-RETRIES                 22970060
210800            OR SQLCODE = ZERO                                     22980060
210900                                                                  22990060
211000         EXEC SQL                                                 23000060
211100             INSERT INTO TUPC                                     23010060
211200                    (UPC_ID                                       23020060
211300                    ,UPC_NBR                                      23030060
211400                    ,SUB_CL_MDSEAR_ID                             23040060
211500                    ,VS_ID                                        23050060
211600                    ,INTR_UPC_ID                                  23060060
211700                    ,EFF_BEG_DTE                                  23070060
211800                    ,EFF_END_DTE                                  23080060
211900                    ,UPC_TYP_CDE                                  23090060
212000                    ,KOHLS_SIZE_CDE                               23100060
212100                    ,NRF_SIZE_IND                                 23110060
212200                    ,NRF_CLOR_CDE                                 23120060
212300                    ,NRF_CLOR_IND                                 23130060
212400                    ,CSTM_CLOR_DESC                               23140060
212500                    ,EDI_ORD_IND                                  23150060
212600                    ,PREPK_IND                                    23160060
212700                    ,GP_CDE                                       23170060
212800                    ,CERTD_IND                                    23180060
212900                    ,CERTD_DTE                                    23190060
213000                    ,RPLNMT_IND                                   23200060
213100                    ,KY_ITM_IND                                   23210060
213200                    ,UNT_COST_1ST_AMT                             23220060
213300                    ,UPC_SRC_CDE                                  23230060
213400                    ,INNR_PK_QTY                                  23240060
213500                    ,OUTR_PK_QTY                                  23250060
213600                    ,SEA_SEQ_NBR                                  23260060
213700                    ,CRE_BY_USR_ID                                23310060
213800                    ,LAST_UPD_BY_USR_ID                           23320060
213900                    ,LAST_UPD_TMST                                23330074
214000                    ,INTR_UPC_DESC)                               23340074
214100             VALUES (:UPC-UPC-ID                                  23350060
214200                    ,:UPC-UPC-NBR                                 23360060
214300                    ,:UPC-SUB-CL-MDSEAR-ID                        23370060
214400                    ,:UPC-VS-ID                                   23380060
214500                    ,:UPC-INTR-UPC-ID                             23390060
214600                    , CURRENT DATE                                23400060
214700                    , NULL                                        23410060
214800                    ,:UPC-UPC-TYP-CDE                             23420060
214900                    ,:UPC-KOHLS-SIZE-CDE                          23430060
215000                    ,:UPC-NRF-SIZE-IND                            23440060
215100                    ,:UPC-NRF-CLOR-CDE                            23450060
215200                    ,:UPC-NRF-CLOR-IND                            23460060
215300                    ,:UPC-CSTM-CLOR-DESC                          23470060
215400                    ,:UPC-EDI-ORD-IND                             23480060
215500                    ,:UPC-PREPK-IND                               23490060
215600                    ,:UPC-GP-CDE                                  23500060
215700                    ,:UPC-CERTD-IND                               23510060
215800                    , CURRENT DATE                                23520060
215900                    ,:UPC-RPLNMT-IND                              23530060
216000                    ,:UPC-KY-ITM-IND                              23540060
216100                    ,:UPC-UNT-COST-1ST-AMT                        23550060
216200                    ,:UPC-UPC-SRC-CDE                             23560060
216300                    ,:UPC-INNR-PK-QTY                             23570060
216400                    ,:UPC-OUTR-PK-QTY                             23580060
216500                    ,:UPC-SEA-SEQ-NBR                             23590060
216600                    ,:UPC-CRE-BY-USR-ID                           23640060
216700                    ,:UPC-LAST-UPD-BY-USR-ID                      23650060
216800                    , CURRENT TIMESTAMP                           23660074
216900                    ,:UPC-INTR-UPC-DESC)                          23670074
217000         END-EXEC                                                 23680060
217100                                                                  23690060
217200         EVALUATE TRUE                                            23700060
217300             WHEN SQLCODE = ZERO                                  23710060
217400             WHEN SQLCODE = -904                                  23720060
217500             WHEN SQLCODE = -913                                  23730060
217600                 CONTINUE                                         23740060
217700             WHEN SQLCODE = -803                                  23750060
217800                 PERFORM 3500-GENERATE-RANDOM-NUMBER              23760060
217900                 MOVE PV-RANDOM-NUMBER  TO UPC-UPC-ID             23770060
218000             WHEN SQLWARN0 NOT = SPACES                           23780060
218100             WHEN SQLCODE  NOT = ZERO                             23790060
218200                 MOVE 'INSERT A ROW TO THE UPC TABLE FOR THE'     23800060
218300                                     TO DP013-MESSAGE-TEXT (1)    23810060
218400                 MOVE 'FOLLOWING UPC: '                           23820060
218500                                     TO DP013-MESSAGE-TEXT (2)    23830060
218600                 MOVE UPC-UPC-NBR    TO DP013-MESSAGE-TEXT (3)    23840060
218700                 MOVE SQLCA          TO DP013-SQLCA               23850060
218800                 MOVE 'TUPC'         TO DP013-DB2-TABLE-NAME (1)  23860060
218900                 SET DP013-DB2-ABEND TO TRUE                      23870060
219000                 SET DP013-ROLLBACK  TO TRUE                      23880060
219100                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           23890060
219200                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O       23900060
219300                 PERFORM 8100-SEND-DATA-ONLY                      23910060
219400                 PERFORM 8200-RETURN-TRANID                       23920060
219500         END-EVALUATE                                             23930060
219600     END-PERFORM.                                                 23940060
219700                                                                  23950060
219800     IF PV-INSERT-COUNTER > PC-MAX-RETRIES                        23960060
219900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO INSERT A'   23970060
220000                             TO DP013-MESSAGE-TEXT (1)            23980060
220100         MOVE 'ROW TO THE UPC TABLE FOR THE FOLLOWING UPC: '      23990060
220200                             TO DP013-MESSAGE-TEXT (2)            24000060
220300         MOVE UPC-UPC-NBR    TO DP013-MESSAGE-TEXT (3)            24010060
220400         MOVE SQLCA          TO DP013-SQLCA                       24020060
220500         MOVE 'TUPC'         TO DP013-DB2-TABLE-NAME (1)          24030060
220600         SET DP013-DB2-ABEND TO TRUE                              24040060
220700         SET DP013-ROLLBACK  TO TRUE                              24050060
220800         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   24060060
220900         MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O               24070060
221000         PERFORM 8100-SEND-DATA-ONLY                              24080060
221100         PERFORM 8200-RETURN-TRANID                               24090060
221200     END-IF.                                                      24100060
221300                                                                  26060060
221400 7500-INSERT-TUPCCER.                                             26260060
221500     MOVE CA-PO-NBR        TO DK-PO-NBR.                          26270060
221600     MOVE CA-REC-SEQ-NBR   TO DK-REC-SEQ-NBR.                     26280060
221700     MOVE CA-LINE-ITEM-NBR TO DK-PO-LNE-NBR.                      26290060
221800     PERFORM                                                      26300060
221900         WITH TEST AFTER                                          26310060
222000         VARYING PV-INSERT-COUNTER                                26320060
222100         FROM 1 BY 1                                              26330060
222200         UNTIL (PV-INSERT-COUNTER > PC-MAX-RETRIES                26340060
222300                   OR SQLCODE = ZERO)                             26350060
222400                                                                  26360060
222500         EXEC SQL                                                 26370060
222600             INSERT INTO TUPCCER                                  26380060
222700                    (MDSE_LNE_ITM_NBR,                            26390060
222800                     CRE_TMST,                                    26400060
222900                     ACT_CDE,                                     26410060
223000                     OPER_UNT_ID,                                 26420060
223100                     PO_NBR,                                      26430060
223200                     REC_SEQ_NBR,                                 26440060
223300                     PO_LNE_NBR,                                  26450060
223400                     UID_NBR,                                     26460060
223500                     UPC_NBR,                                     26470060
223600                     FUNC_CDE,                                    26480060
223700                     SCAN_ITM_NBR,                                26490060
223800                     MDSE_PRC_AREA_CDE,                           26500060
223900                     REQ_FOR_CERT_CDE)                            26510060
224000             VALUES (:CA-ITEM-NBR,                                26520060
224100                      CURRENT TIMESTAMP,                          26530060
224200                     :CA-ACTION-CODE,                             26540060
224300                     :CA-OPER-UNT-ID,                             26550060
224400                     :DK-PO-NBR,                                  26560060
224500                     :DK-REC-SEQ-NBR,                             26570060
224600                     :DK-PO-LNE-NBR,                              26580060
224700                     :PV-USER-ID-NBR,                             26590060
224800                     :PV-UPC-NBR,                                 26600060
224900                     '1',                                         26610060
225000                     :PV-SCANNED-ITEM-NBR,                        26620060
225100                     :CA-MDSE-PRC-AREA-CDE,                       26630060
225200                     'Y')                                         26640060
225300         END-EXEC                                                 26650060
225400                                                                  26660060
225500         EVALUATE TRUE                                            26670060
225600             WHEN SQLCODE = ZERO                                  26680060
225700             WHEN SQLCODE = -904                                  26690060
225800             WHEN SQLCODE = -913                                  26700060
225900                 CONTINUE                                         26710060
226000             WHEN SQLWARN0 NOT = SPACES                           26720060
226100             WHEN SQLCODE < ZERO                                  26730060
226200             WHEN SQLCODE > ZERO                                  26740060
226300                 MOVE '7500-INSERT-TUPCCER'                       26750060
226400                     TO DP013-PARAGRAPH                           26760060
226500                 MOVE 'INSERT A ROW TO THE UPC CERTIFICATION'     26770060
226600                     TO DP013-MESSAGE-TEXT (1)                    26780060
226700                 MOVE 'TABLE FOR THE FOLLOWING SKU AND'           26790060
226800                     TO DP013-MESSAGE-TEXT (2)                    26800060
226900                 MOVE 'ASSOCIATED ITEM NUMBER: '                  26810060
227000                     TO DP013-MESSAGE-TEXT (3)                    26820060
227100                 MOVE CA-SKU-NBR  TO PV-DISPLAY-SKU-NBR           26830060
227200                 MOVE SPACES      TO PV-DISPLAY-SPACES            26840060
227300                 MOVE CA-ITEM-NBR TO PV-DISPLAY-ITEM-NBR          26850060
227400                 MOVE PV-DISPLAY-UPC-AND-ITEM-NBR                 26860060
227500                     TO DP013-MESSAGE-TEXT (4)                    26870060
227600                 MOVE SQLCA          TO DP013-SQLCA               26880060
227700                 MOVE 'TUPCCER'      TO DP013-DB2-TABLE-NAME (1)  26890060
227800                 SET DP013-DB2-ABEND TO TRUE                      26900060
227900                 SET DP013-ROLLBACK  TO TRUE                      26910060
228000                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           26920060
228100                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O       26930060
228200                 PERFORM 8100-SEND-DATA-ONLY                      26940060
228300                 PERFORM 8200-RETURN-TRANID                       26950060
228400         END-EVALUATE                                             26960060
228500     END-PERFORM.                                                 26970060
228600                                                                  26980060
228700     IF PV-INSERT-COUNTER > PC-MAX-RETRIES                        26990060
228800         MOVE '7500-INSERT-TUPCCER'                               27000060
228900             TO DP013-PARAGRAPH                                   27010060
229000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO INSERT A'   27020060
229100             TO DP013-MESSAGE-TEXT (1)                            27030060
229200         MOVE 'ROW TO THE UPC CERTIFICATION TABLE FOR THE'        27040060
229300             TO DP013-MESSAGE-TEXT (2)                            27050060
229400         MOVE 'FOLLOWING UPC AND ITEM NUMBER: '                   27060060
229500             TO DP013-MESSAGE-TEXT (3)                            27070060
229600         MOVE CA-SKU-NBR  TO PV-DISPLAY-SKU-NBR                   27080060
229700         MOVE SPACES      TO PV-DISPLAY-SPACES                    27090060
229800         MOVE CA-ITEM-NBR TO PV-DISPLAY-ITEM-NBR                  27100060
229900         MOVE PV-DISPLAY-UPC-AND-ITEM-NBR                         27110060
230000             TO DP013-MESSAGE-TEXT (4)                            27120060
230100         MOVE SQLCA          TO DP013-SQLCA                       27130060
230200         MOVE 'TUPCCER'      TO DP013-DB2-TABLE-NAME (1)          27140060
230300         SET DP013-DB2-ABEND TO TRUE                              27150060
230400         SET DP013-ROLLBACK  TO TRUE                              27160060
230500         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   27170060
230600         MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O               27180060
230700         PERFORM 8100-SEND-DATA-ONLY                              27190060
230800         PERFORM 8200-RETURN-TRANID                               27200060
230900     END-IF.                                                      27210060
231000*                                                                 27220060
231100 7600-DEL-CERT-REQ-ROW-TUPCCER.                                   27230060
231200     MOVE CA-PO-NBR        TO DK-PO-NBR.                          27240060
231300     MOVE CA-REC-SEQ-NBR   TO DK-REC-SEQ-NBR.                     27250060
231400     MOVE CA-LINE-ITEM-NBR TO DK-PO-LNE-NBR.                      27260060
231500     PERFORM                                                      27270060
231600         WITH TEST AFTER                                          27280060
231700         VARYING PV-DELETE-COUNTER                                27290060
231800         FROM 1 BY 1                                              27300060
231900         UNTIL (PV-DELETE-COUNTER > PC-MAX-RETRIES                27310060
232000                   OR SQLCODE = ZERO                              27320060
232100                   OR SQLCODE = PC-ROW-NOT-FOUND)                 27330060
232200                                                                  27340060
232300         EXEC SQL                                                 27350060
232400             DELETE FROM TUPCCER                                  27360060
232500              WHERE (PO_NBR     = :DK-PO-NBR                      27370060
232600                AND REC_SEQ_NBR = :DK-REC-SEQ-NBR                 27380060
232700                AND PO_LNE_NBR  = :DK-PO-LNE-NBR                  27390060
232800                AND ACT_CDE     = :CA-ACTION-CODE)                27400060
232900         END-EXEC                                                 27410060
233000                                                                  27420060
233100         EVALUATE TRUE                                            27430060
233200             WHEN SQLCODE = ZERO                                  27440060
233300             WHEN SQLCODE = PC-ROW-NOT-FOUND                      27450060
233400             WHEN SQLCODE = -904                                  27460060
233500             WHEN SQLCODE = -913                                  27470060
233600                 CONTINUE                                         27480060
233700             WHEN SQLWARN0 NOT = SPACES                           27490060
233800             WHEN SQLCODE < ZERO                                  27500060
233900             WHEN SQLCODE > ZERO                                  27510060
234000                 MOVE '7600-DEL-CERT-REQ-ROW-TUPCCER'             27520060
234100                     TO DP013-PARAGRAPH                           27530060
234200                 MOVE 'DELETE A ROW FROM THE UPC CERTIFICATION'   27540060
234300                     TO DP013-MESSAGE-TEXT (1)                    27550060
234400                 MOVE 'TABLE FOR THE FOLLOWING PO NBR AND LINE ITE27560060
234500-                     'M NUMBER: '                                27570060
234600                     TO DP013-MESSAGE-TEXT (2)                    27580060
234700                 MOVE CA-PO-NBR-X                                 27590060
234800                     TO DP013-MESSAGE-TEXT (3)                    27600060
234900                 MOVE CA-LINE-ITEM-NBR-X                          27610060
235000                     TO DP013-MESSAGE-TEXT (4)                    27620060
235100                 MOVE SQLCA          TO DP013-SQLCA               27630060
235200                 MOVE 'TUPCCER'      TO DP013-DB2-TABLE-NAME (1)  27640060
235300                 SET DP013-DB2-ABEND TO TRUE                      27650060
235400                 SET DP013-ROLLBACK  TO TRUE                      27660060
235500                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           27670060
235600                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O       27680060
235700                 PERFORM 8100-SEND-DATA-ONLY                      27690060
235800                 PERFORM 8200-RETURN-TRANID                       27700060
235900         END-EVALUATE                                             27710060
236000     END-PERFORM.                                                 27720060
236100                                                                  27730060
236200     IF PV-DELETE-COUNTER > PC-MAX-RETRIES                        27740060
236300         MOVE '7600-DEL-CERT-REQ-ROW-TUPCCER'                     27750060
236400             TO DP013-PARAGRAPH                                   27760060
236500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO DELETE A ROW27770060
236600-             'FROM THE UPC'                                      27780060
236700             TO DP013-MESSAGE-TEXT (1)                            27790060
236800         MOVE 'CERTIFICATION TABLE FOR THE FOLLOWING PO NBR AND LI27800060
236900-             'NE ITEM NUMBER:'                                   27810060
237000             TO DP013-MESSAGE-TEXT (2)                            27820060
237100         MOVE CA-PO-NBR-X                                         27830060
237200             TO DP013-MESSAGE-TEXT (3)                            27840060
237300         MOVE CA-LINE-ITEM-NBR-X                                  27850060
237400             TO DP013-MESSAGE-TEXT (4)                            27860060
237500         MOVE SQLCA          TO DP013-SQLCA                       27870060
237600         MOVE 'TUPCCER'      TO DP013-DB2-TABLE-NAME (1)          27880060
237700         SET DP013-DB2-ABEND TO TRUE                              27890060
237800         SET DP013-ROLLBACK  TO TRUE                              27900060
237900         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   27910060
238000         MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O               27920060
238100         PERFORM 8100-SEND-DATA-ONLY                              27930060
238200         PERFORM 8200-RETURN-TRANID                               27940060
238300     END-IF.                                                      27950060
238400                                                                  27960060
W3502S 7700-INSERT-MDM-UPC.                                             27230060
W3502S/****************************************************************         
121313        PERFORM M100-ESTABLISH-CONNECTION.                                
121313        INITIALIZE UP003-MQ-USER-ID                                       
121313                   UP003-MQ-PASSWORD                                      
121313                   UP003-MQ-ENTERPRISE                                    
121313        COPY UPPD012.                                                     
121313******************************************************************11980000
121313* SOFT ABEND WITH TRANS UNAVAILABLE DISPLAYED & WRITE IN CICS LOG 11980000
121313******************************************************************11980000
121313        IF UP009-ERROR-FOUND                                      11980000
121313           PERFORM 8400-TRANS-UNAVAILABLE                         11980000
121313        ELSE                                                      11980000
121313           INITIALIZE UP009-MESSAGE-STRING                                
121313                      PV-STATUS                                           
121313                      PV-MQ-OUT-RESPONSE                                  
121313                      PV-ROWS-RETURNED-X                                  
121313                      PV-ROWS-RETURNED                                    
W3502S           ADD  1                     TO PV-JOB-NUMBER                    
W3502S           MOVE UPC-UPC-NBR           TO PV-UPC-UPC-NBR                   
W3502S           MOVE UP001-INSERT          TO PV-ACTION                        
W3502S           MOVE "MPKCS024.1"          TO PV-QUERY-IDENTIFIER              
W3502S           STRING                                                         
W3502S           PV-QUERY-IDENTIFIER                                            
W3502S           DELIMITED BY SIZE                                              
W3502S           UP001-TILDE-SIGN                                               
W3502S           DELIMITED BY SIZE                                              
W3502S           PV-JOB-NUMBER                                                  
W3502S           DELIMITED BY SPACE                                             
W3502S           UP001-TILDE-SIGN                                               
W3502S           DELIMITED BY SIZE                                              
W3502S           PV-ACTION                                                      
W3502S           DELIMITED BY SPACE                                             
W3502S*          UP001-END-OF-QUERY                                             
121313           UP001-TILDE-SIGN                                               
121313           DELIMITED BY SPACE                                             
121313           UP001-IS-EMPTY                                                 
W3502S           DELIMITED BY SPACE                                             
W3502S           UP001-TILDE-SIGN                                               
W3502S           DELIMITED BY SPACE,                                            
W3502S           UP001-USERNAME                                                 
W3502S           DELIMITED BY SPACE,                                            
W3502S           UP001-EQUAL-SIGN                                               
W3502S           DELIMITED BY SPACE,                                            
W3502S           UP003-MQ-USER-ID                                               
W3502S           DELIMITED BY SPACE,                                            
W3502S           UP001-PIPE-SIGN                                                
W3502S           DELIMITED BY SPACE,                                            
W3502S           UP001-PASSWORD                                                 
W3502S           DELIMITED BY SPACE,                                            
W3502S           UP001-EQUAL-SIGN                                               
W3502S           DELIMITED BY SPACE,                                            
W3502S           UP003-MQ-PASSWORD                                              
W3502S           DELIMITED BY SPACE,                                            
W3502S           UP001-PIPE-SIGN                                                
W3502S           DELIMITED BY SPACE,                                            
W3502S           UP001-ENTERPRISE                                               
W3502S           DELIMITED BY SPACE,                                            
W3502S           UP001-EQUAL-SIGN                                               
W3502S           DELIMITED BY SPACE,                                            
W3502S           UP003-MQ-ENTERPRISE                                            
W3502S           DELIMITED BY SPACE                                             
W3502S           UP001-PIPE-SIGN                                                
W3502S           DELIMITED BY SPACE                                             
W3502S           UP001-UPC-UPC-NBR                                              
W3502S           DELIMITED BY SPACE                                             
W3502S           UP001-EQUAL-SIGN                                               
W3502S           DELIMITED BY SIZE                                              
W3502S           PV-UPC-UPC-NBR                                                 
W3502S           DELIMITED BY SIZE                                              
W3502S           UP001-PIPE-SIGN                                                
W3502S           DELIMITED BY SIZE                                              
W3502S           UP001-UPC-SKU-NBR                                              
W3502S           DELIMITED BY SPACE                                             
W3502S           UP001-EQUAL-SIGN                                               
W3502S           DELIMITED BY SPACE                                             
W3502S           CA-SEQ-NBR                                                     
W3502S           DELIMITED BY SIZE                                              
W3502S           UP001-PIPE-SIGN                                                
W3502S           DELIMITED BY SIZE                                              
W3502S           UP001-UPC-UPC-TYP-CDE                                          
W3502S           DELIMITED BY SPACE                                             
W3502S           UP001-EQUAL-SIGN                                               
W3502S           DELIMITED BY SPACE                                             
W3502S           UPC-UPC-TYP-CDE                                                
W3502S           DELIMITED BY SIZE                                              
W3502S           UP001-END-OF-QUERY                                             
W3502S           DELIMITED BY SPACE                                             
121313*       INTO UP003-EMS-IN-QUERY.                                          
121313*****PUT MESSAGE ONTO THE EMS QUEUE AND RECEIVE RESPONSE                  
121313*       PERFORM 2040-PASS-PROPERTIES.                                     
121313*       PERFORM 2050-EMS-QUEUE-PROCESS.                                   
121313*       SET ADDRESS OF LS-RESPONSE TO UP003-EMS-RESPONSE-PTR.             
121313*       MOVE LS-RESPONSE      TO UP003-EMS-OUT-RESP.                      
121313*       UNSTRING UP003-EMS-OUT-RESP DELIMITED BY X"00"                    
121313*          INTO  PV-EMS-OUT-RESP1.                                        
121313*       UNSTRING PV-EMS-OUT-RESP1 DELIMITED BY UP001-TILDE-SIGN           
121313*          INTO  PV-QUERY-IDENTIFIER1,                                    
121313*                PV-JOB-NUMBER1,                                          
121313*                PV-STATUS1.                                              
121313*    MOVE PV-STATUS1 TO  UP003-EMS-RESPONSE.                              
121313*       EVALUATE TRUE                                                     
121313*            WHEN UP003-EMS-SUCCESS                                       
121313*                 PERFORM 1600-DESTROY-RESPONSE                           
121313*                 PERFORM 7750-GET-ENT-ID-TVNDSTL                         
121313*                 PERFORM 7800-INSERT-MDM-VND-ASSN                20070060
121313*            WHEN OTHER                                                   
121313*                MOVE '7700-INSERT-MDM-UPC'                       22390060
121313*                    TO DP013-PARAGRAPH                           22400060
121313*                MOVE 'INSERT TO MDM FAILED IN'                   22410060
121313*                    TO DP013-MESSAGE-TEXT (1)                    22420060
121313*                MOVE 'UPT_UPC REPOSITORY'                        22430060
121313*                    TO DP013-MESSAGE-TEXT (2)                    22440060
121313*                MOVE 'FOR UPC NUMBER: '                          22450060
121313*                    TO DP013-MESSAGE-TEXT (3)                    22460060
121313*                MOVE PV-UPC-UPC-NBR TO PV-DISPLAY-UPC-NBR        22470060
121313*                MOVE PV-DISPLAY-UPC-NBR                          22490060
121313*                    TO DP013-MESSAGE-TEXT (4)                    22500060
121313*                DISPLAY PV-EMS-OUT-RESP1                                 
121313*                MOVE 'UPT_SKU'      TO DP013-DB2-TABLE-NAME (1)  22520060
121313*                PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           22550060
121313*                MOVE 'RETRY REQUIRED'                                    
121313*                                   TO AMSGLN4O                           
121313*                PERFORM 1600-DESTROY-RESPONSE                            
121313*                PERFORM 2100-CLEANUP-EMS-OBJECTS                         
121313           INTO UP009-REQ-MSGBUFFER                                       
121313           PERFORM 2600-PROCESS-MESSAGES                                  
121313******************************************************************11980000
121313* SOFT ABEND WITH TRANS UNAVAILABLE DISPLAYED & WRITE IN CICS LOG 11980000
121313******************************************************************11980000
121313           IF UP009-ERROR-FOUND                                   11980000
121313             PERFORM 8400-TRANS-UNAVAILABLE                       11980000
121313           END-IF                                                         
121313           PERFORM 3200-CHECK-WS-RESPONSE                                 
121313******************************************************************11980000
121313* SOFT ABEND WITH TRANS UNAVAILABLE DISPLAYED & WRITE IN CICS LOG 11980000
121313******************************************************************11980000
121313           IF UP009-ERROR-FOUND                                   11980000
121313             PERFORM 8400-TRANS-UNAVAILABLE                       11980000
121313           END-IF                                                         
121313           UNSTRING UP009-RES-MSGBUFFER     DELIMITED BY X"00" OR         
121313                  UP009-WS-SIGN                                           
121313           INTO     PV-RESPONSE-CODE1,                                    
121313                  PV-RESPONSE-CODE2,                                      
121313                  PV-MQ-OUT-RESPONSE                                      
121313                                                                          
121313           UNSTRING PV-MQ-OUT-RESPONSE      DELIMITED BY                  
121313                    UP001-TILDE-SIGN      OR UP001-PERCENT-SIGN           
121313           INTO     PV-QUERY-IDENTIFIER,                                  
121313                    PV-JOB-NUMBER-X,                                      
121313                    PV-STATUS                                             
121313           MOVE     PV-STATUS          TO   UP009-RESPONSE-TYPE           
121313*****PUT MESSAGE ONTO THE EMS QUEUE AND RECEIVE RESPONSE                  
121313           EVALUATE TRUE                                                  
121313               WHEN UP009-SUCCESS                                         
121313                    PERFORM 7750-GET-ENT-ID-TVNDSTL                       
121313                    PERFORM 7760-GET-CSTM-CLOR-DESC                       
121313                    PERFORM 7800-INSERT-MDM-VND-ASSN                  2007
121313               WHEN OTHER                                                 
121313                   MOVE '7700-INSERT-MDM-UPC'                         2239
121313                       TO DP013-PARAGRAPH                             2240
121313                   MOVE 'INSERT TO MDM FAILED IN'                     2241
121313                       TO DP013-MESSAGE-TEXT (1)                      2242
121313                   MOVE 'UPT_UPC REPOSITORY'                          2243
121313                       TO DP013-MESSAGE-TEXT (2)                      2244
121313                   MOVE 'FOR UPC NUMBER: '                            2245
121313                       TO DP013-MESSAGE-TEXT (3)                      2246
121313                   MOVE PV-UPC-UPC-NBR TO PV-DISPLAY-UPC-NBR          2247
121313                   MOVE PV-DISPLAY-UPC-NBR                            2249
121313                       TO DP013-MESSAGE-TEXT (4)                      2250
121313                   MOVE 'UPT_SKU'      TO DP013-DB2-TABLE-NAME (1)    2252
121313                   SET DP013-ROLLBACK  TO TRUE                    20210060
121313                   PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG             2255
121313                   MOVE 'RETRY REQUIRED'                                  
121313                                      TO AMSGLN4O                         
121313                   PERFORM 3400-CLOSE-MQ-CONNECTION                       
121313                   PERFORM 8100-SEND-DATA-ONLY                    22570060
121313                   PERFORM 8200-RETURN-TRANID                     22580060
W3502S           END-EVALUATE                                                   
W3502S        END-IF.                                                           
W3502S 7750-GET-ENT-ID-TVNDSTL.                                         27230060
W3502S                                                                  27230060
W3502S     MOVE UPC-VS-ID TO PV-UPC-VS-ID.                              27230060
W3502S     PERFORM                                                      19890060
W3502S         WITH TEST AFTER                                          19900060
W3502S         VARYING PV-SELECT-COUNTER                                19910060
W3502S         FROM 1 BY 1                                              19920060
W3502S         UNTIL (PV-SELECT-COUNTER > PC-MAX-RETRIES                19930060
W3502S                   OR SQLCODE = ZERO)                             19940060
W3502S                                                                  19950060
W3502S         EXEC SQL                                                 19960060
W3502S             SELECT  ENT_ID                                       19970060
W3502S             INTO    :VNDSTL-ENT-ID                               19980060
W3502S             FROM    TVNDSTL                                      19990060
W3502S             WHERE   VS_ID = :UPC-VS-ID                           20000060
W3502S         END-EXEC                                                 20010060
W3502S                                                                  20020060
W3502S         EVALUATE TRUE                                            20030060
W3502S             WHEN SQLCODE = ZERO                                  20040060
W3502S                  MOVE VNDSTL-ENT-ID TO PV-ENT-ID                 20070060
W3502S             WHEN SQLWARN0 NOT = SPACES                           20080060
W3502S             WHEN SQLCODE  NOT = ZERO                             20090060
W3502S                 MOVE '7750-GET-ENT-ID-TVNDSTL'                   20100060
W3502S                     TO DP013-PARAGRAPH                           20110060
W3502S                 MOVE 'SELECT OF TVNDSTL ROW FOR THE '            20120060
W3502S                     TO DP013-MESSAGE-TEXT (1)                    20130060
W3502S                 MOVE 'FOLLOWING VS ID: '                         20140060
W3502S                     TO DP013-MESSAGE-TEXT (2)                    20150060
W3502S                 MOVE PV-UPC-VS-ID                                20160060
W3502S                     TO DP013-MESSAGE-TEXT (3)                    20170060
W3502S                 MOVE SQLCA          TO DP013-SQLCA               20180060
W3502S                 MOVE 'TVNDSTL'      TO DP013-DB2-TABLE-NAME (1)  20190060
W3502S                 SET DP013-DB2-ABEND TO TRUE                      20200060
W3502S                 SET DP013-ROLLBACK  TO TRUE                      20210060
W3502S                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           20220060
W3502S                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O       20230060
W3502S                 PERFORM 8100-SEND-DATA-ONLY                      20240060
W3502S                 PERFORM 8200-RETURN-TRANID                       20250060
W3502S         END-EVALUATE                                             20260060
W3502S     END-PERFORM.                                                 20270060
W3502S                                                                  20280060
W3502S     IF PV-SELECT-COUNTER > PC-MAX-RETRIES                        20290060
W3502S         PERFORM 7900-DELETE-MDM-UPC                              20290060
W3502S         MOVE '7750-GET-ENT-ID-TVNDSTL'                           20300067
W3502S             TO DP013-PARAGRAPH                                   20310060
W3502S         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT A'   20320060
W3502S             TO DP013-MESSAGE-TEXT (1)                            20330060
W3502S         MOVE 'ENT ID FROM TVNDSTL TABLE FOR'                     20340060
W3502S             TO DP013-MESSAGE-TEXT (2)                            20350060
W3502S         MOVE 'THE FOLLOWING VS ID: '                             20360060
W3502S             TO DP013-MESSAGE-TEXT (3)                            20370060
W3502S         MOVE PV-UPC-VS-ID                                        20380060
W3502S             TO DP013-MESSAGE-TEXT (4)                            20390060
W3502S         MOVE SQLCA          TO DP013-SQLCA                       20400060
W3502S         MOVE 'TVNDSTL'      TO DP013-DB2-TABLE-NAME (1)          20410060
W3502S         SET DP013-DB2-ABEND TO TRUE                              20420060
W3502S         SET DP013-ROLLBACK  TO TRUE                              20430060
W3502S         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   20440060
W3502S         MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O               20450060
121313*        PERFORM 2100-CLEANUP-EMS-OBJECTS                                 
W3502S         PERFORM 3400-CLOSE-MQ-CONNECTION                                 
W3502S         PERFORM 8100-SEND-DATA-ONLY                              20460060
W3502S         PERFORM 8200-RETURN-TRANID                               20470060
W3502S     END-IF.                                                      20480060
W3502S                                                                          
W3502S 7760-GET-CSTM-CLOR-DESC.                                         27230060
W3502S                                                                  27230060
W3502S     PERFORM                                                      19890060
W3502S         WITH TEST AFTER                                          19900060
W3502S         VARYING PV-SELECT-COUNTER                                19910060
W3502S         FROM 1 BY 1                                              19920060
W3502S         UNTIL (PV-SELECT-COUNTER > PC-MAX-RETRIES                19930060
W3502S                   OR SQLCODE = ZERO)                             19940060
W3502S                                                                  19950060
W3502S         EXEC SQL                                                 19960060
W3502S             SELECT  NRF_CLOR_DESC                                19970060
W3502S             INTO    :COLOR-NRF-CLOR-DESC                         19980060
W3502S             FROM    TCOLOR                                       19990060
W3502S             WHERE   NRF_CLOR_CDE  = :UPC-NRF-CLOR-CDE            20000060
W3502S         END-EXEC                                                 20010060
W3502S                                                                  20020060
W3502S         EVALUATE TRUE                                            20030060
W3502S             WHEN SQLCODE = ZERO                                  20040060
W3502S                  MOVE COLOR-NRF-CLOR-DESC TO UPC-CSTM-CLOR-DESC  20070060
W3502S             WHEN SQLWARN0 NOT = SPACES                           20080060
W3502S             WHEN SQLCODE  NOT = ZERO                             20090060
W3502S                 MOVE '7760-GET-CSTM-CLOR-DESC'                   20100060
W3502S                     TO DP013-PARAGRAPH                           20110060
W3502S                 MOVE 'SELECT OF TCOLOR ROW FOR THE '             20120060
W3502S                     TO DP013-MESSAGE-TEXT (1)                    20130060
W3502S                 MOVE 'FOLLOWING COLOR CODE: '                    20140060
W3502S                     TO DP013-MESSAGE-TEXT (2)                    20150060
W3502S                 MOVE UPC-NRF-CLOR-CDE                            20160060
W3502S                     TO DP013-MESSAGE-TEXT (3)                    20170060
W3502S                 MOVE SQLCA          TO DP013-SQLCA               20180060
W3502S                 MOVE 'TCOLOR'      TO DP013-DB2-TABLE-NAME (1)   20190060
W3502S                 SET DP013-DB2-ABEND TO TRUE                      20200060
W3502S                 SET DP013-ROLLBACK  TO TRUE                      20210060
W3502S                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           20220060
W3502S                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O       20230060
W3502S                 PERFORM 8100-SEND-DATA-ONLY                      20240060
W3502S                 PERFORM 8200-RETURN-TRANID                       20250060
W3502S         END-EVALUATE                                             20260060
W3502S     END-PERFORM.                                                 20270060
W3502S                                                                  20280060
W3502S     IF PV-SELECT-COUNTER > PC-MAX-RETRIES                        20290060
W3502S         PERFORM 7900-DELETE-MDM-UPC                              20290060
W3502S         MOVE '7760-GET-CSTM-CLOR-DESC'                           20300067
W3502S             TO DP013-PARAGRAPH                                   20310060
W3502S         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT A'   20320060
W3502S             TO DP013-MESSAGE-TEXT (1)                            20330060
W3502S         MOVE 'COLOR DESCRIPTION FROM TCOLOR TABLE FOR'           20340060
W3502S             TO DP013-MESSAGE-TEXT (2)                            20350060
W3502S         MOVE 'THE FOLLOWING NRF COLOR CODE:'                     20360060
W3502S             TO DP013-MESSAGE-TEXT (3)                            20370060
W3502S         MOVE UPC-NRF-CLOR-CDE                                    20380060
W3502S             TO DP013-MESSAGE-TEXT (4)                            20390060
W3502S         MOVE SQLCA          TO DP013-SQLCA                       20400060
W3502S         MOVE 'TCOLOR'      TO DP013-DB2-TABLE-NAME (1)           20410060
W3502S         SET DP013-DB2-ABEND TO TRUE                              20420060
W3502S         SET DP013-ROLLBACK  TO TRUE                              20430060
W3502S         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   20440060
W3502S         MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLN4O               20450060
W3502S*        PERFORM 2100-CLEANUP-EMS-OBJECTS                                 
W3502S         PERFORM 3400-CLOSE-MQ-CONNECTION                                 
W3502S         PERFORM 8100-SEND-DATA-ONLY                              20460060
W3502S         PERFORM 8200-RETURN-TRANID                               20470060
W3502S     END-IF.                                                      20480060
W3502S                                                                          
W3502S 7800-INSERT-MDM-VND-ASSN.                                        27230060
W3502S                                                                  27230060
121313*       INITIALIZE UP003-EMS-STRING                                       
121313*                  PV-EMS-OUT-RESP1                                       
121313*                  PV-QUERY-IDENTIFIER                                    
121313*                  PV-QUERY-IDENTIFIER1                                   
121313*                  PV-JOB-NUMBER                                          
121313*                  PV-JOB-NUMBER1                                         
121313*                  PV-STATUS1                                             
121313*                  PV-ACTION                                              
121313*                  PV-ROWS-RETURNED-X.                                    
121313        INITIALIZE UP009-MESSAGE-STRING                                   
121313                   PV-STATUS                                              
121313                   PV-MQ-OUT-RESPONSE                                     
121313                   PV-ROWS-RETURNED-X                                     
121313                   PV-ROWS-RETURNED.                                      
W3502S        ADD  1                     TO PV-JOB-NUMBER.                      
W3502S        MOVE UPC-UNT-COST-1ST-AMT  TO PV-UNT-COST-1ST-AMT.                
W3502S        MOVE UPC-KOHLS-SIZE-CDE    TO PV-UPC-KOHLS-SIZE-CDE.              
W3502S        MOVE UP001-INSERT          TO PV-ACTION.                          
W3502S        MOVE "MPKCS024.2"          TO PV-QUERY-IDENTIFIER.                
W3502S        STRING                                                            
W3502S        PV-QUERY-IDENTIFIER                                               
W3502S        DELIMITED BY SIZE                                                 
W3502S        UP001-TILDE-SIGN                                                  
W3502S        DELIMITED BY SIZE                                                 
W3502S        PV-JOB-NUMBER                                                     
W3502S        DELIMITED BY SPACE                                                
W3502S        UP001-TILDE-SIGN                                                  
W3502S        DELIMITED BY SIZE                                                 
W3502S        PV-ACTION                                                         
W3502S        DELIMITED BY SPACE                                                
W3502S        UP001-TILDE-SIGN                                                  
W3502S        DELIMITED BY SPACE                                                
W3502S*       UP001-END-OF-QUERY                                                
121313        UP001-IS-EMPTY                                                    
121313        DELIMITED BY SPACE                                                
121313        UP001-TILDE-SIGN                                                  
W3502S        DELIMITED BY SPACE,                                               
W3502S        UP001-USERNAME                                                    
W3502S        DELIMITED BY SPACE,                                               
W3502S        UP001-EQUAL-SIGN                                                  
W3502S        DELIMITED BY SPACE,                                               
W3502S        UP003-MQ-USER-ID                                                  
W3502S        DELIMITED BY SPACE,                                               
W3502S        UP001-PIPE-SIGN                                                   
W3502S        DELIMITED BY SPACE,                                               
W3502S        UP001-PASSWORD                                                    
W3502S        DELIMITED BY SPACE,                                               
W3502S        UP001-EQUAL-SIGN                                                  
W3502S        DELIMITED BY SPACE,                                               
W3502S        UP003-MQ-PASSWORD                                                 
W3502S        DELIMITED BY SPACE,                                               
W3502S        UP001-PIPE-SIGN                                                   
W3502S        DELIMITED BY SPACE,                                               
W3502S        UP001-ENTERPRISE                                                  
W3502S        DELIMITED BY SPACE,                                               
W3502S        UP001-EQUAL-SIGN                                                  
W3502S        DELIMITED BY SPACE,                                               
W3502S        UP003-MQ-ENTERPRISE                                               
W3502S        DELIMITED BY SPACE                                                
W3502S        UP001-PIPE-SIGN                                                   
W3502S        DELIMITED BY SPACE,                                               
W3502S        UP001-UPC-VND-ASSN-UPC-NBR                                        
W3502S        DELIMITED BY SPACE                                                
W3502S        UP001-EQUAL-SIGN                                                  
W3502S        DELIMITED BY SIZE                                                 
W3502S        PV-UPC-UPC-NBR                                                    
W3502S        DELIMITED BY SIZE                                                 
W3502S        UP001-PIPE-SIGN                                                   
W3502S        DELIMITED BY SIZE                                                 
W3502S        UP001-UPC-VND-ASSN-ENT-ID                                         
W3502S        DELIMITED BY SPACE                                                
W3502S        UP001-EQUAL-SIGN                                                  
W3502S        DELIMITED BY SPACE                                                
W3502S        PV-ENT-ID                                                         
W3502S        DELIMITED BY SIZE                                                 
W3502S        UP001-PIPE-SIGN                                                   
W3502S        DELIMITED BY SIZE                                                 
W3502S        UP001-UPC-VND-EDI-ORD-IND                                         
W3502S        DELIMITED BY SPACE                                                
W3502S        UP001-EQUAL-SIGN                                                  
W3502S        DELIMITED BY SPACE                                                
W3502S        UPC-EDI-ORD-IND                                                   
W3502S        DELIMITED BY SIZE                                                 
W3502S        UP001-PIPE-SIGN                                                   
W3502S        DELIMITED BY SIZE                                                 
W3502S        UP001-UPC-VND-VND-CLOR-DESC                                       
W3502S        DELIMITED BY SPACE                                                
W3502S        UP001-EQUAL-SIGN                                                  
W3502S        DELIMITED BY SPACE                                                
W3502S        UPC-CSTM-CLOR-DESC                                                
W3502S        DELIMITED BY SIZE                                                 
W3502S        UP001-PIPE-SIGN                                                   
W3502S        DELIMITED BY SIZE                                                 
W3502S        UP001-UPC-NRF-CLOR-CDE                                            
W3502S        DELIMITED BY SPACE                                                
W3502S        UP001-EQUAL-SIGN                                                  
W3502S        DELIMITED BY SPACE                                                
W3502S        UPC-NRF-CLOR-CDE                                                  
W3502S        DELIMITED BY SIZE                                                 
W3502S        UP001-PIPE-SIGN                                                   
W3502S        DELIMITED BY SIZE                                                 
W3502S        UP001-UPC-NRF-SIZE-CDE                                            
W3502S        DELIMITED BY SPACE                                                
W3502S        UP001-EQUAL-SIGN                                                  
W3502S        DELIMITED BY SPACE                                                
W3502S        PV-UPC-KOHLS-SIZE-CDE                                             
W3502S        DELIMITED BY SIZE                                                 
W3502S        UP001-END-OF-QUERY                                                
W3502S        DELIMITED BY SPACE                                                
121313*       INTO UP003-EMS-IN-QUERY.                                          
121313*****PUT MESSAGE ONTO THE EMS QUEUE AND RECEIVE RESPONSE                  
121313*       PERFORM 2040-PASS-PROPERTIES.                                     
121313*       PERFORM 2050-EMS-QUEUE-PROCESS.                                   
121313*       SET ADDRESS OF LS-RESPONSE TO UP003-EMS-RESPONSE-PTR.             
121313*       MOVE LS-RESPONSE      TO UP003-EMS-OUT-RESP.                      
121313*       UNSTRING UP003-EMS-OUT-RESP DELIMITED BY X"00"                    
121313*          INTO  PV-EMS-OUT-RESP1.                                        
121313*       UNSTRING PV-EMS-OUT-RESP1 DELIMITED BY UP001-TILDE-SIGN           
121313*          INTO  PV-QUERY-IDENTIFIER1,                                    
121313*                PV-JOB-NUMBER1,                                          
121313*                PV-STATUS1.                                              
121313*       MOVE PV-STATUS1 TO  UP003-EMS-RESPONSE.                           
121313*       EVALUATE TRUE                                                     
121313*            WHEN UP003-EMS-SUCCESS                                       
121313*                 PERFORM 1600-DESTROY-RESPONSE                           
121313*            WHEN OTHER                                                   
121313*                PERFORM 7900-DELETE-MDM-UPC                      20290060
121313*                MOVE '7800-INSERT-MDM-VND-ASSN'                  22390060
121313*                    TO DP013-PARAGRAPH                           22400060
121313*                MOVE 'INSERT TO MDM FAILED IN'                   22410060
121313*                    TO DP013-MESSAGE-TEXT (1)                    22420060
121313*                MOVE 'UPT_UPC_VND_ASSN REPOSITORY'               22430060
121313*                    TO DP013-MESSAGE-TEXT (2)                    22440060
121313*                MOVE 'FOR UPC NUMBER: '                          22450060
121313*                    TO DP013-MESSAGE-TEXT (3)                    22460060
121313*                MOVE PV-UPC-UPC-NBR TO PV-DISPLAY-UPC-NBR        22470060
121313*                MOVE PV-DISPLAY-UPC-NBR                          22490060
121313*                    TO DP013-MESSAGE-TEXT (4)                    22500060
121313*                DISPLAY PV-EMS-OUT-RESP1                                 
121313*                MOVE 'UPT_UPC_VND_ASSN' TO                               
121313*                          DP013-DB2-TABLE-NAME (1)                       
121313*                PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           22550060
121313*                MOVE 'RETRY REQUIRED'                                    
121313*                                   TO AMSGLN4O                           
121313*                PERFORM 1600-DESTROY-RESPONSE                            
121313*                PERFORM 2100-CLEANUP-EMS-OBJECTS                         
121313*                PERFORM 8100-SEND-DATA-ONLY                      22570060
121313*                PERFORM 8200-RETURN-TRANID                       22580060
121313        INTO UP009-REQ-MSGBUFFER.                                         
121313     PERFORM 2600-PROCESS-MESSAGES.                                       
121313******************************************************************11980000
121313* SOFT ABEND WITH TRANS UNAVAILABLE DISPLAYED & WRITE IN CICS LOG 11980000
121313******************************************************************11980000
121313     IF UP009-ERROR-FOUND                                         11980000
121313        PERFORM 8400-TRANS-UNAVAILABLE                            11980000
121313     END-IF                                                       11980000
121313     PERFORM 3200-CHECK-WS-RESPONSE.                                      
121313******************************************************************11980000
121313* SOFT ABEND WITH TRANS UNAVAILABLE DISPLAYED & WRITE IN CICS LOG 11980000
121313******************************************************************11980000
121313     IF UP009-ERROR-FOUND                                         11980000
121313        PERFORM 8400-TRANS-UNAVAILABLE                            11980000
121313     END-IF                                                       11980000
121313     UNSTRING UP009-RES-MSGBUFFER     DELIMITED BY X"00" OR               
121313              UP009-WS-SIGN                                               
121313     INTO     PV-RESPONSE-CODE1,                                          
121313              PV-RESPONSE-CODE2,                                          
121313              PV-MQ-OUT-RESPONSE.                                         
121313                                                                          
121313     UNSTRING PV-MQ-OUT-RESPONSE      DELIMITED BY                        
121313              UP001-TILDE-SIGN        OR   UP001-PERCENT-SIGN             
121313     INTO     PV-QUERY-IDENTIFIER,                                        
121313              PV-JOB-NUMBER-X,                                            
121313              PV-STATUS.                                                  
121313     MOVE     PV-STATUS               TO   UP009-RESPONSE-TYPE.           
121313        EVALUATE TRUE                                                     
121313             WHEN UP009-SUCCESS                                           
121313                 CONTINUE                                                 
121313             WHEN OTHER                                                   
121313                 PERFORM 7900-DELETE-MDM-UPC                      20290060
121313                 MOVE '7800-INSERT-MDM-VND-ASSN'                  22390060
121313                     TO DP013-PARAGRAPH                           22400060
121313                 MOVE 'INSERT TO MDM FAILED IN'                   22410060
121313                     TO DP013-MESSAGE-TEXT (1)                    22420060
121313                 MOVE 'UPT_UPC_VND_ASSN REPOSITORY'               22430060
121313                     TO DP013-MESSAGE-TEXT (2)                    22440060
121313                 MOVE 'FOR UPC NUMBER: '                          22450060
121313                     TO DP013-MESSAGE-TEXT (3)                    22460060
121313                 MOVE PV-UPC-UPC-NBR TO PV-DISPLAY-UPC-NBR        22470060
121313                 MOVE PV-DISPLAY-UPC-NBR                          22490060
121313                     TO DP013-MESSAGE-TEXT (4)                    22500060
121313                 MOVE 'UPT_UPC_VND_ASSN' TO                               
121313                           DP013-DB2-TABLE-NAME (1)                       
121313                 SET DP013-ROLLBACK  TO TRUE                      20210060
121313                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           22550060
121313                 MOVE 'RETRY REQUIRED'                                    
121313                                    TO AMSGLN4O                           
121313                 PERFORM 3400-CLOSE-MQ-CONNECTION                         
121313                 PERFORM 8100-SEND-DATA-ONLY                      22570060
121313                 PERFORM 8200-RETURN-TRANID                       22580060
121313        END-EVALUATE.                                                     
121313                                                                          
W3502S 7900-DELETE-MDM-UPC.                                             27230060
121313*    INITIALIZE UP003-EMS-STRING                                          
121313*               PV-EMS-OUT-RESP1                                          
121313*               PV-QUERY-IDENTIFIER                                       
121313*               PV-QUERY-IDENTIFIER1                                      
121313*               PV-JOB-NUMBER                                             
121313*               PV-JOB-NUMBER1                                            
121313*               PV-ACTION                                                 
121313*               PV-STATUS1                                                
121313*               PV-ROWS-RETURNED-X.                                       
121313     INITIALIZE UP009-MESSAGE-STRING                                      
121313                PV-STATUS                                                 
121313                PV-MQ-OUT-RESPONSE                                        
121313                PV-ROWS-RETURNED-X                                        
121313                PV-ROWS-RETURNED.                                         
W3502S     MOVE UP001-DELETE        TO PV-ACTION.                               
W3502S     MOVE "MPKCS024.4"        TO PV-QUERY-IDENTIFIER.                     
W3502S     ADD 1   TO PV-JOB-NUMBER.                                            
W3502S     STRING                                                               
W3502S     PV-QUERY-IDENTIFIER                                                  
W3502S     DELIMITED BY SIZE,                                                   
W3502S     UP001-TILDE-SIGN                                                     
W3502S     DELIMITED BY SIZE,                                                   
W3502S     PV-JOB-NUMBER                                                        
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-TILDE-SIGN                                                     
W3502S     DELIMITED BY SIZE,                                                   
W3502S     PV-ACTION                                                            
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-TILDE-SIGN                                                     
W3502S     DELIMITED BY SIZE,                                                   
W3502S*    UP001-END-OF-QUERY                                                   
121313     UP001-IS-EMPTY                                                       
121313     DELIMITED BY SIZE,                                                   
121313     UP001-TILDE-SIGN                                                     
W3502S     DELIMITED BY SIZE,                                                   
W3502S     UP001-USERNAME                                                       
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-EQUAL-SIGN                                                     
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP003-MQ-USER-ID                                                     
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-PIPE-SIGN                                                      
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-PASSWORD                                                       
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-EQUAL-SIGN                                                     
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP003-MQ-PASSWORD                                                    
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-PIPE-SIGN                                                      
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-ENTERPRISE                                                     
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-EQUAL-SIGN                                                     
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP003-MQ-ENTERPRISE                                                  
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-PIPE-SIGN                                                      
W3502S     DELIMITED BY SIZE,                                                   
W3502S     UP001-UPC-UPC-NBR                                                    
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-EQUAL-SIGN                                                     
W3502S     DELIMITED BY SPACE,                                                  
W3502S     PV-UPC-UPC-NBR                                                       
W3502S     DELIMITED BY SIZE,                                                   
W3502S     UP001-END-OF-QUERY                                                   
W3502S     DELIMITED BY SIZE                                                    
121313*    INTO UP003-EMS-IN-QUERY.                                             
121313*****PUT MESSAGE ONTO THE EMS QUEUE AND RECEIVE RESPONSE                  
121313*    PERFORM 2040-PASS-PROPERTIES.                                        
121313*    PERFORM 2050-EMS-QUEUE-PROCESS.                                      
121313*    SET ADDRESS OF LS-RESPONSE TO UP003-EMS-RESPONSE-PTR.                
121313*    UNSTRING LS-RESPONSE  DELIMITED BY X"00"                             
121313*       INTO  PV-EMS-OUT-RESP1.                                           
121313*    UNSTRING PV-EMS-OUT-RESP1 DELIMITED BY UP001-TILDE-SIGN              
121313*             OR UP001-PERCENT-SIGN                                       
121313*       INTO  PV-QUERY-IDENTIFIER1,                                       
121313*             PV-JOB-NUMBER1,                                             
121313*             PV-STATUS1.                                                 
121313*    MOVE PV-STATUS1  TO  UP003-EMS-RESPONSE.                             
121313*    EVALUATE TRUE                                                        
121313*       WHEN UP003-EMS-SUCCESS                                            
121313*            PERFORM 1600-DESTROY-RESPONSE                                
121313*       WHEN OTHER                                                        
121313*                MOVE '7900-DELETE-MDM-UPC'                       22390060
121313*                    TO DP013-PARAGRAPH                           22400060
121313*                MOVE 'DELETE IN MDM FAILED FOR'                  22410060
121313*                    TO DP013-MESSAGE-TEXT (1)                    22420060
121313*                MOVE 'UPT_UPC REPOSITORY'                        22430060
121313*                    TO DP013-MESSAGE-TEXT (2)                    22440060
121313*                MOVE 'FOR UPC NUMBER: '                          22450060
121313*                    TO DP013-MESSAGE-TEXT (3)                    22460060
121313*                MOVE PV-UPC-UPC-NBR TO PV-DISPLAY-UPC-NBR        22470060
121313*                MOVE PV-DISPLAY-UPC-NBR                          22490060
121313*                    TO DP013-MESSAGE-TEXT (4)                    22500060
121313*                DISPLAY PV-EMS-OUT-RESP1                                 
121313*                MOVE 'UPT_UPC' TO                                        
121313*                           DP013-DB2-TABLE-NAME (1)                      
121313*                PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           22550060
121313*                MOVE 'RETRY REQUIRED'                                    
121313*                             TO AMSGLN4O                                 
121313*                PERFORM 1600-DESTROY-RESPONSE                            
121313*                PERFORM 2100-CLEANUP-EMS-OBJECTS                         
121313*                PERFORM 8100-SEND-DATA-ONLY                      22570060
121313*                PERFORM 8200-RETURN-TRANID                       22580060
121313     INTO UP009-REQ-MSGBUFFER.                                            
121313     PERFORM 2600-PROCESS-MESSAGES.                                       
121313******************************************************************11980000
121313* SOFT ABEND WITH TRANS UNAVAILABLE DISPLAYED & WRITE IN CICS LOG 11980000
121313******************************************************************11980000
121313     IF UP009-ERROR-FOUND                                         11980000
121313        PERFORM 8400-TRANS-UNAVAILABLE                            11980000
121313     END-IF                                                       11980000
121313     PERFORM 3200-CHECK-WS-RESPONSE.                                      
121313******************************************************************11980000
121313* SOFT ABEND WITH TRANS UNAVAILABLE DISPLAYED & WRITE IN CICS LOG 11980000
121313******************************************************************11980000
121313     IF UP009-ERROR-FOUND                                         11980000
121313        PERFORM 8400-TRANS-UNAVAILABLE                            11980000
121313     END-IF                                                       11980000
121313     UNSTRING UP009-RES-MSGBUFFER     DELIMITED BY X"00" OR               
121313              UP009-WS-SIGN                                               
121313     INTO     PV-RESPONSE-CODE1,                                          
121313              PV-RESPONSE-CODE2,                                          
121313              PV-MQ-OUT-RESPONSE.                                         
121313                                                                          
121313     UNSTRING PV-MQ-OUT-RESPONSE      DELIMITED BY                        
121313              UP001-TILDE-SIGN        OR   UP001-PERCENT-SIGN             
121313     INTO     PV-QUERY-IDENTIFIER,                                        
121313              PV-JOB-NUMBER-X,                                            
121313              PV-STATUS.                                                  
121313     MOVE     PV-STATUS               TO   UP009-RESPONSE-TYPE.           
121313     EVALUATE TRUE                                                        
121313        WHEN UP009-SUCCESS                                                
121313                 PERFORM 3400-CLOSE-MQ-CONNECTION                         
121313        WHEN OTHER                                                        
121313                 MOVE '7900-DELETE-MDM-UPC'                       22390060
121313                     TO DP013-PARAGRAPH                           22400060
121313                 MOVE 'DELETE IN MDM FAILED FOR'                  22410060
121313                     TO DP013-MESSAGE-TEXT (1)                    22420060
121313                 MOVE 'UPT_UPC REPOSITORY'                        22430060
121313                     TO DP013-MESSAGE-TEXT (2)                    22440060
121313                 MOVE 'FOR UPC NUMBER: '                          22450060
121313                     TO DP013-MESSAGE-TEXT (3)                    22460060
121313                 MOVE PV-UPC-UPC-NBR TO PV-DISPLAY-UPC-NBR        22470060
121313                 MOVE PV-DISPLAY-UPC-NBR                          22490060
121313                     TO DP013-MESSAGE-TEXT (4)                    22500060
121313                 MOVE 'UPT_UPC' TO                                        
121313                            DP013-DB2-TABLE-NAME (1)                      
121313                 SET DP013-ROLLBACK  TO TRUE                      20210060
121313                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           22550060
121313                 MOVE 'RETRY REQUIRED'                                    
121313                              TO AMSGLN4O                                 
121313                 PERFORM 3400-CLOSE-MQ-CONNECTION                         
121313                 PERFORM 8100-SEND-DATA-ONLY                      22570060
121313                 PERFORM 8200-RETURN-TRANID                       22580060
W3502S     END-EVALUATE.                                                        
W3502S                                                                          
W3502S 7950-UPDATE-MDM-UPC.                                             27230060
121313*    INITIALIZE UP003-EMS-STRING                                          
121313*               PV-EMS-OUT-RESP1                                          
121313*               PV-QUERY-IDENTIFIER                                       
121313*               PV-QUERY-IDENTIFIER1                                      
121313*               PV-UPC-UPC-NBR                                            
121313*               PV-JOB-NUMBER                                             
121313*               PV-JOB-NUMBER1                                            
121313*               PV-ACTION                                                 
121313*               PV-STATUS1                                                
121313*               PV-ROWS-RETURNED-X.                                       
121313        INITIALIZE UP009-MESSAGE-STRING                                   
121313                   PV-STATUS                                              
121313                   PV-MQ-OUT-RESPONSE                                     
121313                   PV-ROWS-RETURNED-X                                     
121313                   PV-ROWS-RETURNED.                                      
W3502S     MOVE UP001-UPDATE        TO PV-ACTION.                               
W3502S     MOVE "MPKCS024.3"        TO PV-QUERY-IDENTIFIER.                     
W3502S     ADD 1   TO PV-JOB-NUMBER.                                            
W3502S     MOVE PV-CURR-INTERNAL-UPC-NBR TO PV-UPC-UPC-NBR.                     
W3502S     STRING                                                               
W3502S     PV-QUERY-IDENTIFIER                                                  
W3502S     DELIMITED BY SIZE                                                    
W3502S     UP001-TILDE-SIGN                                                     
W3502S     DELIMITED BY SIZE                                                    
W3502S     PV-JOB-NUMBER                                                        
W3502S     DELIMITED BY SIZE                                                    
W3502S     UP001-TILDE-SIGN                                                     
W3502S     DELIMITED BY SIZE                                                    
W3502S     PV-ACTION                                                            
W3502S     DELIMITED BY SPACE                                                   
W3502S     UP001-TILDE-SIGN                                                     
W3502S     DELIMITED BY SIZE                                                    
W3502S     UP001-UPC-VND-EDI-ORD-IND                                            
W3502S     DELIMITED BY SPACE                                                   
W3502S     UP001-EQUAL-SIGN                                                     
W3502S     DELIMITED BY SIZE                                                    
W3502S     PC-UPC-RPLNMT-IND                                                    
W3502S     DELIMITED BY SPACE                                                   
W3502S     UP001-TILDE-SIGN                                                     
W3502S     DELIMITED BY SIZE                                                    
W3502S     UP001-USERNAME                                                       
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-EQUAL-SIGN                                                     
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP003-MQ-USER-ID                                                     
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-PIPE-SIGN                                                      
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-PASSWORD                                                       
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-EQUAL-SIGN                                                     
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP003-MQ-PASSWORD                                                    
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-PIPE-SIGN                                                      
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-ENTERPRISE                                                     
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-EQUAL-SIGN                                                     
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP003-MQ-ENTERPRISE                                                  
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-PIPE-SIGN                                                      
W3502S     DELIMITED BY SIZE                                                    
W3502S     UP001-UPC-UPC-NBR                                                    
W3502S     DELIMITED BY SPACE                                                   
W3502S     UP001-EQUAL-SIGN                                                     
W3502S     DELIMITED BY SIZE                                                    
W3502S     PV-UPC-UPC-NBR                                                       
W3502S     DELIMITED BY SIZE                                                    
W3502S     UP001-PIPE-SIGN                                                      
W3502S     DELIMITED BY SIZE                                                    
W3502S     UP001-UPC-VND-ASSN-ENT-ID                                            
W3502S     DELIMITED BY SPACE                                                   
W3502S     UP001-EQUAL-SIGN                                                     
W3502S     DELIMITED BY SPACE                                                   
W3502S     PV-ENT-ID                                                            
W3502S     DELIMITED BY SIZE                                                    
W3502S     UP001-END-OF-QUERY                                                   
W3502S     DELIMITED BY SPACE                                                   
121313*    DISPLAY UP003-EMS-IN-QUERY                                           
121313*****PUT MESSAGE ONTO THE EMS QUEUE AND RECEIVE RESPONSE                  
121313*    PERFORM 2040-PASS-PROPERTIES.                                        
121313*    PERFORM 2050-EMS-QUEUE-PROCESS.                                      
121313*    SET ADDRESS OF LS-RESPONSE TO UP003-EMS-RESPONSE-PTR.                
121313*    MOVE LS-RESPONSE      TO UP003-EMS-OUT-RESP.                         
121313*    UNSTRING UP003-EMS-OUT-RESP DELIMITED BY X"00"                       
121313*          INTO  PV-EMS-OUT-RESP1.                                        
121313*    DISPLAY  PV-EMS-OUT-RESP1                                            
121313*    UNSTRING PV-EMS-OUT-RESP1  DELIMITED BY UP001-TILDE-SIGN             
121313*          INTO  PV-QUERY-IDENTIFIER                                      
121313*                PV-JOB-NUMBER1                                           
121313*                PV-STATUS1.                                              
121313*    MOVE PV-STATUS1  TO  UP003-EMS-RESPONSE.                             
121313*    EVALUATE TRUE                                                        
121313*       WHEN UP003-EMS-SUCCESS                                            
121313*            PERFORM 1600-DESTROY-RESPONSE                                
121313*       WHEN OTHER                                                        
121313*                PERFORM 7900-DELETE-MDM-UPC                      20290060
121313*                MOVE '7950-UPDATE-MDM-UPC'                       22390060
121313*                    TO DP013-PARAGRAPH                           22400060
121313*                MOVE 'UPDATE IN MDM FAILED FOR'                  22410060
121313*                    TO DP013-MESSAGE-TEXT (1)                    22420060
121313*                MOVE 'UPT_UPC REPOSITORY'                        22430060
121313*                    TO DP013-MESSAGE-TEXT (2)                    22440060
121313*                MOVE 'FOR UPC NUMBER: '                          22450060
121313*                    TO DP013-MESSAGE-TEXT (3)                    22460060
121313*                MOVE PV-UPC-UPC-NBR TO PV-DISPLAY-UPC-NBR        22470060
121313*                MOVE PV-DISPLAY-UPC-NBR                          22490060
121313*                    TO DP013-MESSAGE-TEXT (4)                    22500060
121313*                DISPLAY PV-EMS-OUT-RESP1                                 
121313*                MOVE 'UPT_UPC' TO                                        
121313*                           DP013-DB2-TABLE-NAME (1)                      
121313*                PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           22550060
121313*                MOVE 'RETRY REQUIRED'                                    
121313*                             TO AMSGLN4O                                 
121313*                PERFORM 1600-DESTROY-RESPONSE                            
121313*                PERFORM 2100-CLEANUP-EMS-OBJECTS                         
121313*                PERFORM 8100-SEND-DATA-ONLY                      22570060
121313*                PERFORM 8200-RETURN-TRANID                       22580060
121313     INTO UP009-REQ-MSGBUFFER.                                            
121313     PERFORM 2600-PROCESS-MESSAGES.                                       
121313******************************************************************11980000
121313* SOFT ABEND WITH TRANS UNAVAILABLE DISPLAYED & WRITE IN CICS LOG 11980000
121313******************************************************************11980000
121313     IF UP009-ERROR-FOUND                                         11980000
121313        PERFORM 8400-TRANS-UNAVAILABLE                            11980000
121313     END-IF                                                       11980000
121313     PERFORM 3200-CHECK-WS-RESPONSE.                                      
121313******************************************************************11980000
121313* SOFT ABEND WITH TRANS UNAVAILABLE DISPLAYED & WRITE IN CICS LOG 11980000
121313******************************************************************11980000
121313     IF UP009-ERROR-FOUND                                         11980000
121313        PERFORM 8400-TRANS-UNAVAILABLE                            11980000
121313     END-IF                                                       11980000
121313     UNSTRING UP009-RES-MSGBUFFER     DELIMITED BY X"00" OR               
121313              UP009-WS-SIGN                                               
121313     INTO     PV-RESPONSE-CODE1,                                          
121313              PV-RESPONSE-CODE2,                                          
121313              PV-MQ-OUT-RESPONSE.                                         
121313                                                                          
121313     UNSTRING PV-MQ-OUT-RESPONSE      DELIMITED BY                        
121313              UP001-TILDE-SIGN        OR   UP001-PERCENT-SIGN             
121313     INTO     PV-QUERY-IDENTIFIER,                                        
121313              PV-JOB-NUMBER-X,                                            
121313              PV-STATUS.                                                  
121313     MOVE     PV-STATUS               TO   UP009-RESPONSE-TYPE.           
121313     EVALUATE TRUE                                                        
121313        WHEN UP009-SUCCESS                                                
121313                 PERFORM 3400-CLOSE-MQ-CONNECTION                         
121313        WHEN OTHER                                                        
121313                 PERFORM 7900-DELETE-MDM-UPC                      20290060
121313                 MOVE '7950-UPDATE-MDM-UPC'                       22390060
121313                     TO DP013-PARAGRAPH                           22400060
121313                 MOVE 'UPDATE IN MDM FAILED FOR'                  22410060
121313                     TO DP013-MESSAGE-TEXT (1)                    22420060
121313                 MOVE 'UPT_UPC REPOSITORY'                        22430060
121313                     TO DP013-MESSAGE-TEXT (2)                    22440060
121313                 MOVE 'FOR UPC NUMBER: '                          22450060
121313                     TO DP013-MESSAGE-TEXT (3)                    22460060
121313                 MOVE PV-UPC-UPC-NBR TO PV-DISPLAY-UPC-NBR        22470060
121313                 MOVE PV-DISPLAY-UPC-NBR                          22490060
121313                     TO DP013-MESSAGE-TEXT (4)                    22500060
121313                 MOVE 'UPT_UPC' TO                                        
121313                            DP013-DB2-TABLE-NAME (1)                      
121313                 SET DP013-ROLLBACK  TO TRUE                      20210060
121313                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           22550060
121313                 MOVE 'RETRY REQUIRED'                                    
121313                              TO AMSGLN4O                                 
121313                 PERFORM 3400-CLOSE-MQ-CONNECTION                         
121313                 PERFORM 8100-SEND-DATA-ONLY                      22570060
121313                 PERFORM 8200-RETURN-TRANID                       22580060
W3502S     END-EVALUATE.                                                        
W3502S                                                                          
W3502S 7980-REVERSE-UPDATE-MDM-UPC.                                     27230060
121313*    INITIALIZE UP003-EMS-STRING                                          
121313*               PV-EMS-OUT-RESP1                                          
121313*               PV-QUERY-IDENTIFIER                                       
121313*               PV-QUERY-IDENTIFIER1                                      
121313*               PV-UPC-UPC-NBR                                            
121313*               PV-JOB-NUMBER                                             
121313*               PV-JOB-NUMBER1                                            
121313*               PV-ACTION                                                 
121313*               PV-STATUS1                                                
121313*               PV-ROWS-RETURNED-X.                                       
121313        INITIALIZE UP009-MESSAGE-STRING                                   
121313                   PV-STATUS                                              
121313                   PV-MQ-OUT-RESPONSE                                     
121313                   PV-ROWS-RETURNED-X                                     
121313                   PV-ROWS-RETURNED.                                      
W3502S     MOVE UP001-UPDATE        TO PV-ACTION.                               
W3502S     MOVE "MPKCS024.3"        TO PV-QUERY-IDENTIFIER.                     
W3502S     ADD 1   TO PV-JOB-NUMBER.                                            
W3502S     MOVE PV-CURR-INTERNAL-UPC-NBR TO PV-UPC-UPC-NBR.                     
W3502S     STRING                                                               
W3502S     PV-QUERY-IDENTIFIER                                                  
W3502S     DELIMITED BY SIZE                                                    
W3502S     UP001-TILDE-SIGN                                                     
W3502S     DELIMITED BY SIZE                                                    
W3502S     PV-JOB-NUMBER                                                        
W3502S     DELIMITED BY SIZE                                                    
W3502S     UP001-TILDE-SIGN                                                     
W3502S     DELIMITED BY SIZE                                                    
W3502S     PV-ACTION                                                            
W3502S     DELIMITED BY SPACE                                                   
W3502S     UP001-TILDE-SIGN                                                     
W3502S     DELIMITED BY SIZE                                                    
W3502S     UP001-USERNAME                                                       
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-EQUAL-SIGN                                                     
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP003-MQ-USER-ID                                                     
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-PIPE-SIGN                                                      
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-PASSWORD                                                       
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-EQUAL-SIGN                                                     
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP003-MQ-PASSWORD                                                    
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-PIPE-SIGN                                                      
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-ENTERPRISE                                                     
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-EQUAL-SIGN                                                     
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP003-MQ-ENTERPRISE                                                  
W3502S     DELIMITED BY SPACE,                                                  
W3502S     UP001-PIPE-SIGN                                                      
W3502S     DELIMITED BY SIZE                                                    
W3502S     UP001-UPC-VND-EDI-ORD-IND                                            
W3502S     DELIMITED BY SPACE                                                   
W3502S     UP001-EQUAL-SIGN                                                     
W3502S     DELIMITED BY SIZE                                                    
W3502S     PC-UPC-RPLNMT-IND-Y                                                  
W3502S     DELIMITED BY SPACE                                                   
W3502S     UP001-TILDE-SIGN                                                     
W3502S     DELIMITED BY SIZE                                                    
W3502S     UP001-UPC-UPC-NBR                                                    
W3502S     DELIMITED BY SPACE                                                   
W3502S     UP001-EQUAL-SIGN                                                     
W3502S     DELIMITED BY SIZE                                                    
W3502S     PV-UPC-UPC-NBR                                                       
W3502S     DELIMITED BY SIZE                                                    
W3502S     UP001-END-OF-QUERY                                                   
W3502S     DELIMITED BY SPACE                                                   
121313*    INTO UP003-EMS-IN-QUERY.                                             
121313*    DISPLAY UP003-EMS-IN-QUERY                                           
121313*****PUT MESSAGE ONTO THE EMS QUEUE AND RECEIVE RESPONSE                  
121313*    PERFORM 2040-PASS-PROPERTIES.                                        
121313*    PERFORM 2050-EMS-QUEUE-PROCESS.                                      
121313*    SET ADDRESS OF LS-RESPONSE TO UP003-EMS-RESPONSE-PTR.                
121313*    MOVE LS-RESPONSE      TO UP003-EMS-OUT-RESP.                         
121313*    UNSTRING UP003-EMS-OUT-RESP DELIMITED BY X"00"                       
121313*          INTO  PV-EMS-OUT-RESP1.                                        
121313*    DISPLAY  PV-EMS-OUT-RESP1                                            
121313*    UNSTRING PV-EMS-OUT-RESP1  DELIMITED BY UP001-TILDE-SIGN             
121313*          INTO  PV-QUERY-IDENTIFIER                                      
121313*                PV-JOB-NUMBER1                                           
121313*                PV-STATUS1.                                              
121313*    MOVE PV-STATUS1  TO  UP003-EMS-RESPONSE.                             
121313*    EVALUATE TRUE                                                        
121313*       WHEN UP003-EMS-SUCCESS                                            
121313*             PERFORM 1600-DESTROY-RESPONSE                               
121313*       WHEN OTHER                                                        
121313*                MOVE '7980-REVERSE-UPDATE-MDM-UPC'               22390060
121313*                    TO DP013-PARAGRAPH                           22400060
121313*                MOVE 'REVERSE UPDATE IN MDM FAILED FOR'          22410060
121313*                    TO DP013-MESSAGE-TEXT (1)                    22420060
121313*                MOVE 'UPT_UPC REPOSITORY'                        22430060
121313*                    TO DP013-MESSAGE-TEXT (2)                    22440060
121313*                MOVE 'FOR UPC NUMBER: '                          22450060
121313*                    TO DP013-MESSAGE-TEXT (3)                    22460060
121313*                MOVE PV-UPC-UPC-NBR TO PV-DISPLAY-UPC-NBR        22470060
121313*                MOVE PV-DISPLAY-UPC-NBR                          22490060
121313*                    TO DP013-MESSAGE-TEXT (4)                    22500060
121313*                MOVE 'UPT_UPC' TO                                        
121313*                           DP013-DB2-TABLE-NAME (1)                      
121313*                PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           22550060
121313*                MOVE 'RETRY REQUIRED'                                    
121313*                             TO AMSGLN4O                                 
121313*                PERFORM 1600-DESTROY-RESPONSE                            
121313*                PERFORM 2100-CLEANUP-EMS-OBJECTS                         
121313*                PERFORM 8100-SEND-DATA-ONLY                      22570060
121313*                PERFORM 8200-RETURN-TRANID                       22580060
121313     INTO UP009-REQ-MSGBUFFER.                                            
121313                                                                          
121313     PERFORM 2600-PROCESS-MESSAGES.                                       
121313******************************************************************11980000
121313* SOFT ABEND WITH TRANS UNAVAILABLE DISPLAYED & WRITE IN CICS LOG 11980000
121313******************************************************************11980000
121313     IF UP009-ERROR-FOUND                                         11980000
121313        PERFORM 8400-TRANS-UNAVAILABLE                            11980000
121313     END-IF                                                       11980000
121313     PERFORM 3200-CHECK-WS-RESPONSE.                                      
121313******************************************************************11980000
121313* SOFT ABEND WITH TRANS UNAVAILABLE DISPLAYED & WRITE IN CICS LOG 11980000
121313******************************************************************11980000
121313     IF UP009-ERROR-FOUND                                         11980000
121313        PERFORM 8400-TRANS-UNAVAILABLE                            11980000
121313     END-IF                                                       11980000
121313     UNSTRING UP009-RES-MSGBUFFER     DELIMITED BY X"00" OR               
121313              UP009-WS-SIGN                                               
121313     INTO     PV-RESPONSE-CODE1,                                          
121313              PV-RESPONSE-CODE2,                                          
121313              PV-MQ-OUT-RESPONSE.                                         
121313                                                                          
121313     UNSTRING PV-MQ-OUT-RESPONSE      DELIMITED BY                        
121313              UP001-TILDE-SIGN        OR   UP001-PERCENT-SIGN             
121313     INTO     PV-QUERY-IDENTIFIER,                                        
121313              PV-JOB-NUMBER-X,                                            
121313              PV-STATUS.                                                  
121313     MOVE     PV-STATUS               TO   UP009-RESPONSE-TYPE.           
121313     EVALUATE TRUE                                                        
121313        WHEN UP009-SUCCESS                                                
121313                 PERFORM 3400-CLOSE-MQ-CONNECTION                         
121313        WHEN OTHER                                                        
121313                 MOVE '7980-REVERSE-UPDATE-MDM-UPC'               22390060
121313                     TO DP013-PARAGRAPH                           22400060
121313                 MOVE 'REVERSE UPDATE IN MDM FAILED FOR'          22410060
121313                     TO DP013-MESSAGE-TEXT (1)                    22420060
121313                 MOVE 'UPT_UPC REPOSITORY'                        22430060
121313                     TO DP013-MESSAGE-TEXT (2)                    22440060
121313                 MOVE 'FOR UPC NUMBER: '                          22450060
121313                     TO DP013-MESSAGE-TEXT (3)                    22460060
121313                 MOVE PV-UPC-UPC-NBR TO PV-DISPLAY-UPC-NBR        22470060
121313                 MOVE PV-DISPLAY-UPC-NBR                          22490060
121313                     TO DP013-MESSAGE-TEXT (4)                    22500060
121313                 MOVE 'UPT_UPC' TO                                        
121313                            DP013-DB2-TABLE-NAME (1)                      
121313                 SET DP013-ROLLBACK  TO TRUE                      20210060
121313                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           22550060
121313                 MOVE 'RETRY REQUIRED'                                    
121313                              TO AMSGLN4O                                 
121313                 PERFORM 3400-CLOSE-MQ-CONNECTION                         
121313                 PERFORM 8100-SEND-DATA-ONLY                      22570060
121313                 PERFORM 8200-RETURN-TRANID                       22580060
W3502S     END-EVALUATE.                                                        
W3502S                                                                          
238500 8000-SEND-MAP.                                                   28670060
238600     EXEC CICS                                                    28680060
238700         SEND MAP       ('MP024A')                                28690060
238800              MAPSET    ('MPKM024')                               28700060
238900              ERASE                                               28710060
239000              RESP      (PV-CICS-RESPONSE)                        28720060
239100     END-EXEC.                                                    28730060
239200                                                                  28740060
239300     EVALUATE TRUE                                                28750060
239400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 28760060
239500             CONTINUE                                             28770060
239600         WHEN OTHER                                               28780060
239700             MOVE '8000-SEND-MAP'      TO DP013-PARAGRAPH         28790060
239800             MOVE 'UNABLE TO SEND MAP' TO DP013-MESSAGE-TEXT (1)  28800060
239900             SET DP013-CICS-ABEND      TO TRUE                    28810060
240000             SET DP013-ROLLBACK        TO TRUE                    28820060
240100             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               28830060
240200     END-EVALUATE.                                                28840060
240300*                                                                 28850060
240400 8100-SEND-DATA-ONLY.                                             28860060
240500     MOVE -1 TO AUPCNBRL.                                         28870060
240600                                                                  28880060
240700     EXEC CICS                                                    28890060
240800         SEND MAP       ('MP024A')                                28900060
240900              MAPSET    ('MPKM024')                               28910060
241000              CURSOR                                              28920060
241100              DATAONLY                                            28930060
241200              RESP      (PV-CICS-RESPONSE)                        28940060
241300     END-EXEC.                                                    28950060
241400                                                                  28960060
241500     EVALUATE TRUE                                                28970060
241600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 28980060
241700             CONTINUE                                             28990060
241800         WHEN OTHER                                               29000060
241900             MOVE '8100-SEND-DATA-ONLY' TO DP013-PARAGRAPH        29010060
242000             MOVE 'UNABLE TO SEND DATA' TO DP013-MESSAGE-TEXT (1) 29020060
242100             SET DP013-CICS-ABEND       TO TRUE                   29030060
242200             SET DP013-ROLLBACK         TO TRUE                   29040060
242300             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               29050060
242400     END-EVALUATE.                                                29060060
242500*                                                                 29070060
242600 8200-RETURN-TRANID.                                              29080060
242700     EXEC CICS                                                    29090060
242800         RETURN TRANSID  (PC-TRANID)                              29100060
242900                COMMAREA (CA-COMMAREA)                            29110060
243000                LENGTH   (PC-COMMAREA-LENGTH2)                    29120060
243100                RESP     (PV-CICS-RESPONSE)                       29130060
243200     END-EXEC.                                                    29140060
243300                                                                  29150060
243400     EVALUATE TRUE                                                29160060
243500         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 29170060
243600             CONTINUE                                             29180060
243700         WHEN OTHER                                               29190060
243800             MOVE '8200-RETURN-TRANIND' TO DP013-PARAGRAPH        29200060
243900             MOVE 'UNABLE TO RETURN TO TRANID'                    29210060
244000                 TO DP013-MESSAGE-TEXT (1)                        29220060
244100             SET DP013-CICS-ABEND       TO TRUE                   29230060
244200             SET DP013-ROLLBACK         TO TRUE                   29240060
244300             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               29250060
244400     END-EVALUATE.                                                29260060
244500*                                                                 29270060
244600 8300-RETURN.                                                     29280060
244700     EXEC CICS                                                    29290060
244800         SEND FROM (PV-MESSAGE-AREA)                              29300060
244900              LENGTH (19)                                         29310060
245000              ERASE                                               29320060
245100     END-EXEC.                                                    29330060
245200                                                                  29340060
245300     EXEC CICS                                                    29350060
245400         RETURN                                                   29360060
245500     END-EXEC.                                                    29370060
121313 8400-TRANS-UNAVAILABLE.                                                  
121313             SET DP013-DB2-ABEND  TO TRUE.                        15180060
121313             SET DP013-ROLLBACK   TO TRUE.                        15180060
121313             MOVE 'INSERT FAILED FOR SKU '                                
121313                            TO DP013-MESSAGE-TEXT (4) (1:22).             
121313             MOVE CA-SEQ-NBR                                              
121313                            TO DP013-MESSAGE-TEXT (4) (23:8).             
121313             MOVE 'AND UPC'                                               
121313                            TO DP013-MESSAGE-TEXT (4) (32:7).             
121313             MOVE PV-UPC-UPC-NBR  TO PV-DISPLAY-UPC-NBR.              2247
121313             MOVE PV-DISPLAY-UPC-NBR                                      
121313                            TO DP013-MESSAGE-TEXT (4) (40: ).             
121313             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG.              11980000
121313             MOVE PC-TRANS-UNAVAILABLE-MSG                                
121313                                          TO AMSGLN4O.                    
121313             PERFORM 3400-CLOSE-MQ-CONNECTION.                            
121313             PERFORM 8100-SEND-DATA-ONLY.                         04680060
121313             PERFORM 8200-RETURN-TRANID.                          04690060
121313                                                                          
245600*                                                                 29380060
W3502S 9000-DB2-MDM-COMMIT.                                                     
W3502S                                                                          
W3502S          EXEC CICS                                                       
W3502S               SYNCPOINT                                                  
W3502S               RESP(PV-CICS-RESPONSE)                                     
W3502S          END-EXEC                                                        
W3502S                                                                          
W3502S          IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                       
W3502S             PERFORM 7900-DELETE-MDM-UPC                          20290060
W3502S             IF PS-UPDATE-INTERNAL-UPC                            20290060
W3502S                PERFORM 7980-REVERSE-UPDATE-MDM-UPC               20290060
W3502S             END-IF                                               20290060
W3502S             MOVE '9000-DB2-MDM-COMMIT'                           15090060
W3502S                 TO DP013-PARAGRAPH                               15100060
W3502S             MOVE 'UNABLE TO COMMIT CHANGES'                      15110060
W3502S                 TO DP013-MESSAGE-TEXT (1)                        15120060
W3502S             MOVE 'ALL CHANGES WILL BE ROLLED BACK'               15130060
W3502S                 TO DP013-MESSAGE-TEXT (2)                        15140060
W3502S             SET DP013-CICS-ABEND TO TRUE                         15170060
W3502S             SET DP013-ROLLBACK   TO TRUE                         15180060
W3502S             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               15190060
W3502S             MOVE 'COMMIT FAILED' TO AMSGLN4O                     15200060
W3502S             PERFORM 8100-SEND-DATA-ONLY                          15210060
W3502S             PERFORM 8200-RETURN-TRANID                           15220060
W3502S          END-IF.                                                         
W3502S                                                                          
245700 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  29390060
245800     MOVE PC-CURRENT-PROGRAM-NAME  TO DP013-PROGRAM.              29400060
245900     MOVE DFHEIBLK                 TO DP013-DFHEIBLK.             29410060
246000     INITIALIZE DP013-SRC-TASK-NUMBER                             29420060
246100                DP013-STACK.                                      29430060
246200     SET DP013-LINK-RETURN TO TRUE.                               29440060
246300                                                                  29450060
246400     EXEC CICS                                                    29460060
246500         LINK                                                     29470060
246600             PROGRAM   (DP013-NAME)                               29480060
246700             COMMAREA  (DP013-PARAMETERS)                         29490060
246800             LENGTH    (DP013-LENGTH)                             29500060
246900     END-EXEC.                                                    29510060
121313******************************************************************        
121313* MQ CONNECTION AND API CALLS COPYBOOK                                    
121313******************************************************************        
121313     COPY UPPD009.                                                        
