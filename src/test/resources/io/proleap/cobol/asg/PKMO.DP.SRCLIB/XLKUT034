000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    XLKUT034.                                         00020000
000300 AUTHOR.        RON KRIER.                                        00030000
000400 INSTALLATION.  KOHLS.                                            00040000
000500 DATE-WRITTEN   MARCH 29, 2003.                                   00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800* ************************************************************** *00080000
000900* * XLKUT034.  "PURCHASE ORDER DOMAIN INTEGRITY"               * *00090000
001000* *                                                            * *00100000
001100* * PURPOSE:                                                   * *00110000
001200* * THIS PROGRAM CREATES AN EXTRACT FILE FROM: TALLPLN.        * *00120000
001300* * THIS EXTRACT FILE CONSISTS OF ROWS ELIGIBLE TO BE TO PART  * *00130000
001400* * OF THE INTEGRITY PROCESS BETWEEN THE RMS PURCHASE ORDER    * *00140000
001500* * SYSTEM AND THE LOGISTICS DOMAIN PURCHASE ORDER TABLES.     * *00150000
001600* *                                                            * *00160000
001700* * PROCESSING OVERVIEW:                                       * *00170000
001800* *   THIS PROGRAM WILL READ THE INPUT DRIVER FILE AND THEN    * *00180000
001900* *   PERFORM A SELECT ON THE TALLPLN TABLE.  DATA RETRIEVED   * *00190000
002000* *   FROM THE SELECT WILL THEN BE WRITTEN TO THE OUTPUT FILE. * *00200000
002100**************************************************************** *00210000
002200 ENVIRONMENT DIVISION.                                            00220000
002300 CONFIGURATION SECTION.                                           00230000
002400 SOURCE-COMPUTER.        IBM-3090.                                00240000
002500 OBJECT-COMPUTER.        IBM-3090.                                00250000
002600                                                                  00260000
002700 INPUT-OUTPUT SECTION.                                            00270000
002800 FILE-CONTROL.                                                    00280000
002900                                                                  00290000
003000     SELECT IN-DRIVER-FILE                ASSIGN TO IN01.         00300000
003100     SELECT OUT-EXTRACT-FILE              ASSIGN TO OUT01.        00310000
003200                                                                  00320000
003300******************************************************************00330000
003400 DATA DIVISION.                                                   00340000
003500 FILE SECTION.                                                    00350000
003600                                                                  00360000
003700 FD  IN-DRIVER-FILE                                               00370000
003800     RECORDING MODE IS F                                          00380000
003900     LABEL RECORDS ARE STANDARD                                   00390000
004000     BLOCK CONTAINS 0 RECORDS.                                    00400000
004100 01  IN-DRIVER-RECORD                PIC  X(030).                 00410000
004200                                                                  00420000
004300**** TALLPLN:                                                     00430000
004400 FD  OUT-EXTRACT-FILE                                             00440000
004500     RECORDING MODE IS F                                          00450000
004600     LABEL RECORDS ARE STANDARD                                   00460000
004700     BLOCK CONTAINS 0 RECORDS.                                    00470000
       01  OUT-EXTRACT-RECORD              PIC  X(106).                 00480000
004900                                                                  00490000
005000                                                                  00500000
005100                                                                  00510000
005200 WORKING-STORAGE SECTION.                                         00520000
005300                                                                  00530000
005400 01  PC-PROGRAM-CONSTANTS.                                        00540000
005500     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'XLKUT034'.  00550000
005600     05  PC-PGM-PROGRESS-DESC.                                    00560000
005700         10  PC-BEGINNING            PIC X(09) VALUE 'BEGINNING'. 00570000
005800         10  PC-CONTINUING           PIC X(10) VALUE              00580000
005900                                               'CONTINUING'.      00590000
006000         10  PC-ENDING               PIC X(06) VALUE 'ENDING'.    00600000
006100         10  PC-ABENDING             PIC X(08) VALUE 'ABENDING'.  00610000
006200     05  PC-ABEND-INFO.                                           00620000
006300         10  PC-ABEND                PIC X(11) VALUE              00630000
006400                                               '** ABEND **'.     00640000
006500         10  PC-ABEND-MSG-PARA       PIC X(15) VALUE              00650000
006600                                               '- PARA       : '. 00660000
006700         10  PC-ABEND-MSG-DISPLAY-PARA                            00670000
006800                                     PIC X(15) VALUE              00680000
006900                                               '  CALLED PARA: '. 00690000
007000         10  PC-ABEND-MSG-NUMBER     PIC X(15) VALUE              00700000
007100                                               '  FOR ABEND# : '. 00710000
007200         10  PC-ABEND-MSG-DESC       PIC X(15) VALUE              00720000
007300                                               '- ERROR IS   : '. 00730000
007400         10  PC-ABEND-MSG-INDENT-15  PIC X(15) VALUE SPACES.      00740000
007500         10  PC-ABEND-MSG-ACTION     PIC X(15) VALUE              00750000
007600                                               '- ACTION     : '. 00760000
007700     05  PC-HOW-OFTEN-TO-DISPLAY     PIC 9(9)  VALUE 5000.        00770000
007800                                                                  00780000
007900 01  PS-PROGRAM-SWITCHES.                                         00790000
008000     05  PS-IN-DRIVER-EOF-SW         PIC X(01) VALUE 'N'.         00800000
008100         88  PS-IN-DRIVER-EOF                  VALUE 'Y'.         00810000
008200         88  PS-IN-DRIVER-NOT-EOF              VALUE 'N'.         00820000
008300     05  PS-CURSOR-HAS-DATA-SW       PIC X(01) VALUE 'N'.         00830000
008400         88  PS-CURSOR-HAS-DATA                VALUE 'Y'.         00840000
008500         88  PS-CURSOR-HAS-NO-DATA             VALUE 'N'.         00850000
008600     05  PS-TABLE-LOOP-DONE-SW       PIC X(01) VALUE 'N'.         00860000
008700         88  PS-TABLE-LOOP-DONE                VALUE 'Y'.         00870000
008800         88  PS-TABLE-LOOP-NOT-DONE            VALUE 'N'.         00880000
008900                                                                  00890000
009000 01  PV-PROGRAM-VARIABLES.                                        00900000
009100     05  PV-PO-NBR-COMP              PIC S9(9) VALUE 0 COMP.      00910000
009200     05  PV-PO-NBR-NUM               PIC  9(9) VALUE 0.           00920000
009300     05  PV-IN-DRIVER-RECS-READ-CNT  PIC  9(9) VALUE 0.           00930000
009400     05  PV-RECS-WITH-MATCHES-CNT    PIC  9(9) VALUE 0.           00940000
009500     05  PV-TABLE-ROW-SELECT-CNT     PIC  9(9) VALUE 0.           00950000
009600     05  PV-EXTRACT-WRITTEN-CNT      PIC  9(9) VALUE 0.           00960000
009700                                                                  00970000
009800     05  PV-PARAGRAPH-NAME           PIC X(30) VALUE SPACES.      00980000
009900     05  PV-DB2-OPERATION-MSG-1      PIC X(79) VALUE SPACES.      00990000
010000     05  PV-DB2-TABLE-NAME           PIC X(18) VALUE SPACES.      01000000
010100     05  PV-DISPLAY-NTH-MULTIPLE     PIC 9(9)  VALUE 0.           01010000
010200     05  PV-DISPLAY-NTH-REMAINDER    PIC 9(9)  VALUE 0.           01020000
010300     05  PV-SQLCODE                  PIC +999  VALUE ZERO.        01030000
010400                                                                  01040000
010500     05  PV-TMST                     PIC X(26) VALUE SPACES.      01050000
010600     05  PV-TIMESTAMP-DETAIL                                      01060000
010700         REDEFINES                                                01070000
010800         PV-TMST.                                                 01080000
010900         10  PV-TIMESTAMP-19.                                     01090000
011000             15  PV-TMS-DATE.                                     01100000
011100                 20  PV-TMS-YEAR.                                 01110000
011200                     25  PV-TMS-CC   PIC X(02).                   01120000
011300                     25  PV-TMS-YY   PIC X(02).                   01130000
011400                 20  FILLER          PIC X(01).                   01140000
011500                 20  PV-TMS-MONTH    PIC X(02).                   01150000
011600                 20  FILLER          PIC X(01).                   01160000
011700                 20  PV-TMS-DAY      PIC X(02).                   01170000
011800             15  FILLER              PIC X(01).                   01180000
011900             15  PV-TMS-HOUR         PIC X(02).                   01190000
012000             15  FILLER              PIC X(01).                   01200000
012100             15  PV-TMS-MINUTE       PIC X(02).                   01210000
012200             15  FILLER              PIC X(01).                   01220000
012300             15  PV-TMS-SECOND       PIC X(02).                   01230000
012400         10  FILLER                  PIC X(01).                   01240000
012500         10  PV-TMS-MSECOND          PIC X(06).                   01250000
012600                                                                  01260000
012700 01  DM-DISPLAY-MESSAGE.                                          01270000
012800     05  DM-01-10.                                                01280000
012900         10  DM-PROGRAM              PIC X(08) VALUE SPACE.       01290000
013000         10  FILLER                  PIC X(02) VALUE ': '.        01300000
013100     05  DM-11-80.                                                01310000
013200         10  FILLER                  PIC X(37) VALUE              01320000
013300                        'SELECT ROWS MATCHING PO DRIVER FILE, '.  01330000
013400         10  FILLER                  PIC X(30) VALUE              01340000
013500                        'CREATING TALLPLN EXTRACT FILE.'.         01350000
013600         10  FILLER                  PIC X(01) VALUE SPACE.       01360000
013700         10  FILLER                  PIC X(01) VALUE ALL '*'.     01370000
013800     05  DM-81-120.                                               01380000
013900         10  FILLER                  PIC X(40) VALUE ALL '*'.     01390000
014000                                                                  01400000
014100 01  DP-DISPLAY-PROGRESS-MSG.                                     01410000
014200     05  DP-PROGRAM                  PIC X(08) VALUE SPACE.       01420000
014300     05  FILLER                      PIC X(02) VALUE SPACE.       01430000
014400     05  DP-STATUS-DESCRIPTION       PIC X(10) VALUE SPACE.       01440000
014500     05  FILLER                      PIC X(04) VALUE ' AT '.      01450000
014600     05  DP-TIMESTAMP-19             PIC X(19) VALUE SPACE.       01460000
014700     05  FILLER                      PIC X(03) VALUE '.  '.       01470000
014800     05  FILLER                      PIC X(03) VALUE              01480000
014900                                         'IN:'.                   01490000
015000     05  DP-IN-CNT                   PIC ZZZ,ZZZ,ZZ9              01500000
015100                                               VALUE ZERO.        01510000
015200     05  FILLER                      PIC X(02) VALUE ', '.        01520000
015300*    05  FILLER                      PIC X(16) VALUE              01530000
015400*                                        'DRIVER W/ROW(S):'.      01540000
015500*    05  DP-MATCHES-FOUND-CNT        PIC ZZZ,ZZZ,ZZ9              01550000
015600*                                              VALUE ZERO.        01560000
015700*    05  FILLER                      PIC X(02) VALUE ', '.        01570000
015800     05  FILLER                      PIC X(14) VALUE              01580000
015900                                         'ROWS SELECTED:'.        01590000
016000     05  DP-ROWS-SELECTED-CNT        PIC ZZZ,ZZZ,ZZ9              01600000
016100                                               VALUE ZERO.        01610000
016200     05  FILLER                      PIC X(02) VALUE ', '.        01620000
016300     05  FILLER                      PIC X(04) VALUE              01630000
016400                                         'OUT:'.                  01640000
016500     05  DP-OUT-CNT                  PIC ZZZ,ZZZ,ZZ9              01650000
016600                                               VALUE ZERO.        01660000
016700     05  FILLER                      PIC X(01) VALUE '.'.         01670000
016800                                                                  01680000
016900 01  ABEND-CODE                      PIC S9(04)                   01690000
017000                                               VALUE ZEROES       01700000
017100                                               COMP SYNC.         01710000
017200                                                                  01720000
017300*---------------------------------------------------------------* 01730000
017400*  DB2 FORMATTED MESSAGE AREA                                     01740000
017500*---------------------------------------------------------------* 01750000
017600     COPY DPWS004.                                                01760000
017700                                                                  01770000
017800                                                                  01780000
017900*---------------------------------------------------------------* 01790000
018000*  XLRD013  - RECORD LAYOUT FOR PO DRIVER FILE, INPUT.          * 01800000
018100*---------------------------------------------------------------* 01810000
018200     COPY XLRD013.                                                01820000
018300                                                                  01830000
018400                                                                  01840000
018500*---------------------------------------------------------------* 01850000
018600*    DB2 AREA FOR TALLPLN                                       * 01860000
018700*---------------------------------------------------------------* 01870000
018800     EXEC SQL                                                     01880000
018900          INCLUDE TALLPLN                                         01890000
019000     END-EXEC.                                                    01900000
019100                                                                  01910000
019200*---------------------------------------------------------------* 01920000
019300*    DB2 AREA FOR COMMUNICATIONS                                * 01930000
019400*---------------------------------------------------------------* 01940000
019500     EXEC SQL                                                     01950000
019600          INCLUDE SQLCA                                           01960000
019700     END-EXEC.                                                    01970000
019800                                                                  01980000
019900*---------------------------------------------------------------* 01990000
020000*    DEFINE CURSOR FOR TALLPLN :                                * 02000000
020100*    PULL ALL AVAILABLE COLUMNS, SO EXTRACT FILE WILL CONTAIN   * 02010000
020200*    ALL DATA TO POPULATE "ARCHIVE HISTORY" COPY OF THIS TABLE. * 02020000
020300*---------------------------------------------------------------* 02030000
020400     EXEC SQL                                                     02040000
020500          DECLARE TABLE-CURSOR CURSOR FOR                         02050000
020600           SELECT PO_NBR                                          02060000
020700                 ,PO_LNE_NBR                                      02070000
020800                 ,PLAN_NBR                                        02080000
020900                 ,CURR_SPLIT_QTY                                  02090000
021000                 ,DEST_NBR                                        02100000
021100                 ,STATUS_CDE                                      02110000
021200                 ,DC_SPLIT_QTY                                    02120000
021300                 ,SPLIT_REQ_ID                                    02130000
021400                 ,SPLIT_CRE_DATE                                  02140000
021500                 ,SPLIT_CRE_ID                                    02150000
021600                 ,SPLIT_UPD_DATE                                  02160000
021700                 ,SPLIT_UPD_ID                                    02170000
021800                 ,DISTRO_REQ_ID                                   02180000
021900                 ,DISTRO_CRE_DATE                                 02190000
022000                 ,DISTRO_CRE_ID                                   02200000
022100                 ,DISTRO_KEY_SEQ_NBR                              02210000
022200                 ,SPLIT_KEY_SEQ_NBR                               02220000
022300                 ,ALOC_PACK_QTY                                   02230000
022400                 ,PK_SIZE_RND_CDE                                 02240000
022500                 ,ALLOC_OUTR_PK_QTY                               02250000
                       ,SHTG_PRRT_OPT_CDE                               02260000
                       ,OVRG_PRRT_OPT_CDE                               02270000
                       ,EXST_SHTG_THRS_IND                              02280000
                       ,DC_SPLT_CNCLD_QTY                               02290000
023300           FROM   TALLPLN                                         02300000
023400          WHERE  (PO_NBR = :PV-PO-NBR-COMP)                       02310000
023500*           AND  STATUS_CDE = 'AC'                                02320000
023600            FOR  FETCH ONLY                                       02330000
023700           WITH  UR                                               02340000
023800     END-EXEC.                                                    02350000
023900                                                                  02360000
024000                                                                  02370000
024100 PROCEDURE DIVISION.                                              02380000
024200********************                                              02390000
024300                                                                  02400000
024400 0000-PROGRAM-MAINLINE.                                           02410000
024500                                                                  02420000
024600     PERFORM 1000-INITIALIZE.                                     02430000
024700                                                                  02440000
024800     SET PS-IN-DRIVER-NOT-EOF TO TRUE.                            02450000
024900     PERFORM 2000-PROCESS-DRIVER-FILE                             02460000
025000         UNTIL PS-IN-DRIVER-EOF.                                  02470000
025100                                                                  02480000
025200     PERFORM 6000-EOJ-ROUTINE.                                    02490000
025300     STOP RUN.                                                    02500000
025400                                                                  02510000
025500                                                                  02520000
025600* ************************************************************** *02530000
025700* * INITIALIZATIONS                                            * *02540000
025800* ************************************************************** *02550000
025900 1000-INITIALIZE.                                                 02560000
026000                                                                  02570000
026100     MOVE PC-CURRENT-PROGRAM-NAME TO DM-PROGRAM.                  02580000
026200     DISPLAY DM-DISPLAY-MESSAGE.                                  02590000
026300                                                                  02600000
026400     MOVE PC-BEGINNING              TO DP-STATUS-DESCRIPTION.     02610000
026500     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02620000
026600                                                                  02630000
026700     PERFORM 9000-OPEN-IN-DRIVER-FILE.                            02640000
026800     PERFORM 9700-OPEN-OUT-EXTRACT-FILE.                          02650000
026900                                                                  02660000
027000                                                                  02670000
027100* ************************************************************** *02680000
027200* * 1) GET NEXT RECORD FROM DRIVER FILE, AND                   * *02690000
027300* *    1A- POPULATE KEY (WHERE CLAUSE) FOR TABLE CURSOR        * *02700000
027400* *    1B- OPEN TABLE CURSOR                                   * *02710000
027500* *    1C- LOOP THRU TABLE CURSOR TO EXTRACT ALL               * *02720000
027600* *        ROWS FOR THIS INPUT DRIVER RECORD                   * *02730000
027700* *    2) FOR EACH ROW,                                        * *02740000
027800* *       2A- INCREMENT COUNTS                                 * *02750000
027900* *       2B- WRITE EXTRACT RECORD                             * *02760000
028000* *    1D- CLOSE TABLE CURSOR                                  * *02770000
028100* ************************************************************** *02780000
028200 2000-PROCESS-DRIVER-FILE.                                        02790000
028300                                                                  02800000
028400     PERFORM 9050-READ-IN-DRIVER-FILE.                            02810000
028500     IF PS-IN-DRIVER-EOF                                          02820000
028600         CONTINUE                                                 02830000
028700     ELSE                                                         02840000
028800         MOVE XL013-PO-NBR TO         PV-PO-NBR-COMP              02850000
028900                                      PV-PO-NBR-NUM               02860000
029000         PERFORM 2100-CHECK-PGM-PROGRESS                          02870000
029100         SET PS-TABLE-LOOP-NOT-DONE   TO TRUE                     02880000
029200         SET PS-CURSOR-HAS-NO-DATA    TO TRUE                     02890000
029300         PERFORM 9100-OPEN-TABLE-CURSOR                           02900000
029400         PERFORM 3000-EXTRACT-ROWS-FROM-TABLE                     02910000
029500             UNTIL PS-TABLE-LOOP-DONE                             02920000
029600         PERFORM 9190-CLOSE-TABLE-CURSOR                          02930000
029700     END-IF.                                                      02940000
029800                                                                  02950000
029900                                                                  02960000
030000* ************************************************************** *02970000
030100* *    EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT     * *02980000
030200* *    RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST   * *02990000
030300* *    WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.   * *03000000
030400* ************************************************************** *03010000
030500 2100-CHECK-PGM-PROGRESS.                                         03020000
030600     DIVIDE    PV-IN-DRIVER-RECS-READ-CNT                         03030000
030700         BY        PC-HOW-OFTEN-TO-DISPLAY                        03040000
030800         GIVING    PV-DISPLAY-NTH-MULTIPLE                        03050000
030900         REMAINDER PV-DISPLAY-NTH-REMAINDER.                      03060000
031000                                                                  03070000
031100     IF PV-DISPLAY-NTH-REMAINDER = ZERO                           03080000
031200         MOVE PC-CONTINUING         TO DP-STATUS-DESCRIPTION      03090000
031300         PERFORM 6200-DISPLAY-PGM-PROGRESS                        03100000
031400     END-IF.                                                      03110000
031500                                                                  03120000
031600                                                                  03130000
031700* ************************************************************** *03140000
031800* * EXTRACT ROWS FROM TABLE, FOR THE CURRENT DRIVER RECORD     * *03150000
031900* ************************************************************** *03160000
032000 3000-EXTRACT-ROWS-FROM-TABLE.                                    03170000
032100     INITIALIZE DCLTALLPLN.                                       03180000
032200     PERFORM 9150-FETCH-TABLE-CURSOR.                             03190000
032300     IF PS-TABLE-LOOP-DONE                                        03200000
032400         CONTINUE                                                 03210000
032500     ELSE                                                         03220000
032600         PERFORM 9750-WRITE-EXTRACT-RECORD                        03230000
032700     END-IF.                                                      03240000
032800                                                                  03250000
032900                                                                  03260000
033000* ************************************************************** *03270000
033100* * DISPLAY END OF RUN MESSAGE, CLOSE THE OUTPUT FILES         * *03280000
033200* ************************************************************** *03290000
033300 6000-EOJ-ROUTINE.                                                03300000
033400                                                                  03310000
033500     PERFORM 9090-CLOSE-IN-DRIVER-FILE.                           03320000
033600     PERFORM 9790-CLOSE-OUT-EXTRACT-FILE.                         03330000
033700                                                                  03340000
033800     MOVE PC-ENDING                 TO DP-STATUS-DESCRIPTION.     03350000
033900     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           03360000
034000                                                                  03370000
034100                                                                  03380000
034200* ************************************************************** *03390000
034300* * DISPLAY PROGRAM PROGRESS.                                  * *03400000
034400* ************************************************************** *03410000
034500 6200-DISPLAY-PGM-PROGRESS.                                       03420000
034600                                                                  03430000
034700     EXEC SQL                                                     03440000
034800          SET :PV-TMST = CURRENT TIMESTAMP                        03450000
034900     END-EXEC.                                                    03460000
035000                                                                  03470000
035100     MOVE PC-CURRENT-PROGRAM-NAME   TO DP-PROGRAM.                03480000
035200     MOVE PV-TIMESTAMP-19           TO DP-TIMESTAMP-19.           03490000
035300     MOVE PV-IN-DRIVER-RECS-READ-CNT                              03500000
035400                                    TO DP-IN-CNT.                 03510000
035500*    MOVE PV-RECS-WITH-MATCHES-CNT  TO DP-MATCHES-FOUND-CNT.      03520000
035600     MOVE PV-TABLE-ROW-SELECT-CNT   TO DP-ROWS-SELECTED-CNT.      03530000
035700     MOVE PV-EXTRACT-WRITTEN-CNT    TO DP-OUT-CNT.                03540000
035800                                                                  03550000
035900     DISPLAY DP-DISPLAY-PROGRESS-MSG.                             03560000
036000                                                                  03570000
036100                                                                  03580000
036200* ************************************************************** *03590000
036300* * FILE AND DB2 TABLE ACCESS PARAGRAPHS.                      * *03600000
036400* * 90XX- INPUT:  DRIVER FILE                                  * *03610000
036500* * 91XX- INPUT:  TABLE CURSOR                                 * *03620000
036600* * 97XX- OUTPUT: TABLE EXTRACT                                * *03630000
036700* ************************************************************** *03640000
036800                                                                  03650000
036900* ************************************************************** *03660000
037000* * OPEN  INPUT DRIVER FILE                                    * *03670000
037100* ************************************************************** *03680000
037200 9000-OPEN-IN-DRIVER-FILE.                                        03690000
037300     OPEN  INPUT  IN-DRIVER-FILE.                                 03700000
037400                                                                  03710000
037500                                                                  03720000
037600* ************************************************************** *03730000
037700* * READ  INPUT DRIVER FILE OF ELIGIBLE DATA TO EXTRACT        * *03740000
037800* ************************************************************** *03750000
037900 9050-READ-IN-DRIVER-FILE.                                        03760000
038000     READ IN-DRIVER-FILE                                          03770000
038100          INTO XL013-DRIVER-RECORD-LAYOUT                         03780000
038200          AT END                                                  03790000
038300              SET PS-IN-DRIVER-EOF TO TRUE.                       03800000
038400                                                                  03810000
038500     IF PS-IN-DRIVER-EOF                                          03820000
038600         CONTINUE                                                 03830000
038700     ELSE                                                         03840000
038800         ADD +1 TO PV-IN-DRIVER-RECS-READ-CNT                     03850000
038900     END-IF.                                                      03860000
039000                                                                  03870000
039100                                                                  03880000
039200* ************************************************************** *03890000
039300* * CLOSE INPUT DRIVER FILE                                    * *03900000
039400* ************************************************************** *03910000
039500 9090-CLOSE-IN-DRIVER-FILE.                                       03920000
039600     CLOSE IN-DRIVER-FILE.                                        03930000
039700                                                                  03940000
039800                                                                  03950000
039900* ************************************************************** *03960000
040000* * OPEN  TABLE CURSOR                                         * *03970000
040100* ************************************************************** *03980000
040200 9100-OPEN-TABLE-CURSOR.                                          03990000
040300     EXEC SQL                                                     04000000
040400          OPEN TABLE-CURSOR                                       04010000
040500     END-EXEC.                                                    04020000
040600                                                                  04030000
040700     EVALUATE TRUE                                                04040000
040800         WHEN SQLCODE = ZERO                                      04050000
040900              ADD +1 TO PV-RECS-WITH-MATCHES-CNT                  04060000
041000              SET PS-CURSOR-HAS-DATA TO TRUE                      04070000
041100         WHEN SQLCODE = +100                                      04080000
041200              SET PS-TABLE-LOOP-DONE TO TRUE                      04090000
041300         WHEN SQLWARN0 NOT EQUAL SPACE                            04100000
041400         WHEN SQLCODE  NOT EQUAL ZERO                             04110000
041500              MOVE '9100-OPEN-TABLE-CURSOR'                       04120000
041600                                 TO PV-PARAGRAPH-NAME             04130000
041700              MOVE 'OPEN TABLE CURSOR'                            04140000
041800                                 TO PV-DB2-OPERATION-MSG-1        04150000
041900              MOVE 'TALLPLN'     TO PV-DB2-TABLE-NAME             04160000
042000              PERFORM 9999-DB2-ABEND                              04170000
042100     END-EVALUATE.                                                04180000
042200                                                                  04190000
042300                                                                  04200000
042400* ************************************************************** *04210000
042500* * FETCH TABLE CURSOR                                         * *04220000
042600* ************************************************************** *04230000
042700 9150-FETCH-TABLE-CURSOR.                                         04240000
042800     EXEC SQL                                                     04250000
042900         FETCH TABLE-CURSOR                                       04260000
043000          INTO  :ALLPLN-PO-NBR                                    04270000
043100               ,:ALLPLN-PO-LNE-NBR                                04280000
043200               ,:ALLPLN-PLAN-NBR                                  04290000
043300               ,:ALLPLN-CURR-SPLIT-QTY                            04300000
043400               ,:ALLPLN-DEST-NBR                                  04310000
043500               ,:ALLPLN-STATUS-CDE                                04320000
043600               ,:ALLPLN-DC-SPLIT-QTY                              04330000
043700               ,:ALLPLN-SPLIT-REQ-ID                              04340000
043800               ,:ALLPLN-SPLIT-CRE-DATE                            04350000
043900               ,:ALLPLN-SPLIT-CRE-ID                              04360000
044000               ,:ALLPLN-SPLIT-UPD-DATE                            04370000
044100               ,:ALLPLN-SPLIT-UPD-ID                              04380000
044200               ,:ALLPLN-DISTRO-REQ-ID                             04390000
044300               ,:ALLPLN-DISTRO-CRE-DATE                           04400000
044400               ,:ALLPLN-DISTRO-CRE-ID                             04410000
044500               ,:ALLPLN-DISTRO-KEY-SEQ-NBR                        04420000
044600               ,:ALLPLN-SPLIT-KEY-SEQ-NBR                         04430000
044700               ,:ALLPLN-ALOC-PACK-QTY                             04440000
044800               ,:ALLPLN-PK-SIZE-RND-CDE                           04450000
044900               ,:ALLPLN-ALLOC-OUTR-PK-QTY                         04460000
                     ,:ALLPLN-SHTG-PRRT-OPT-CDE                         04470000
                     ,:ALLPLN-OVRG-PRRT-OPT-CDE                         04480000
                     ,:ALLPLN-EXST-SHTG-THRS-IND                        04490000
                     ,:ALLPLN-DC-SPLT-CNCLD-QTY                         04500000
045700     END-EXEC.                                                    04510000
045800                                                                  04520000
045900     EVALUATE TRUE                                                04530000
046000         WHEN SQLCODE = ZERO                                      04540000
046100              ADD +1                 TO PV-TABLE-ROW-SELECT-CNT   04550000
046200              SET PS-CURSOR-HAS-DATA TO TRUE                      04560000
046300         WHEN SQLCODE = +100                                      04570000
046400              SET PS-TABLE-LOOP-DONE TO TRUE                      04580000
046500         WHEN SQLWARN0 NOT EQUAL SPACE                            04590000
046600         WHEN SQLCODE NOT EQUAL ZERO                              04600000
046700              MOVE '9150-FETCH-TABLE-CURSOR'                      04610000
046800                                 TO PV-PARAGRAPH-NAME             04620000
046900              MOVE 'FETCH TABLE CURSOR'                           04630000
047000                                 TO PV-DB2-OPERATION-MSG-1        04640000
047100              MOVE 'TALLPLN'     TO PV-DB2-TABLE-NAME             04650000
047200              PERFORM 9999-DB2-ABEND                              04660000
047300     END-EVALUATE.                                                04670000
047400                                                                  04680000
047500                                                                  04690000
047600* ************************************************************** *04700000
047700* * CLOSE TABLE CURSOR                                         * *04710000
047800* ************************************************************** *04720000
047900 9190-CLOSE-TABLE-CURSOR.                                         04730000
048000     EXEC SQL                                                     04740000
048100          CLOSE TABLE-CURSOR                                      04750000
048200     END-EXEC.                                                    04760000
048300                                                                  04770000
048400     EVALUATE TRUE                                                04780000
048500         WHEN SQLCODE = ZERO                                      04790000
048600              CONTINUE                                            04800000
048700         WHEN SQLWARN0 NOT EQUAL SPACE                            04810000
048800         WHEN SQLCODE NOT EQUAL ZERO                              04820000
048900              MOVE '9190-CLOSE-TABLE-CURSOR'                      04830000
049000                                 TO PV-PARAGRAPH-NAME             04840000
049100              MOVE 'CLOSE TABLE CURSOR'                           04850000
049200                                 TO PV-DB2-OPERATION-MSG-1        04860000
049300              MOVE 'TALLPLN'     TO PV-DB2-TABLE-NAME             04870000
049400              PERFORM 9999-DB2-ABEND                              04880000
049500     END-EVALUATE.                                                04890000
049600                                                                  04900000
049700                                                                  04910000
049800* ************************************************************** *04920000
049900* * OPEN OUTPUT EXTRACT FILE                                   * *04930000
050000* ************************************************************** *04940000
050100 9700-OPEN-OUT-EXTRACT-FILE.                                      04950000
050200     OPEN OUTPUT OUT-EXTRACT-FILE.                                04960000
050300                                                                  04970000
050400                                                                  04980000
050500* ************************************************************** *04990000
050600* * WRITE A RECORD TO THE TABLE EXTRACT FILE                   * *05000000
050700* ************************************************************** *05010000
050800 9750-WRITE-EXTRACT-RECORD.                                       05020000
050900     WRITE  OUT-EXTRACT-RECORD  FROM  DCLTALLPLN.                 05030000
051000     ADD +1 TO PV-EXTRACT-WRITTEN-CNT.                            05040000
051100                                                                  05050000
051200                                                                  05060000
051300* ************************************************************** *05070000
051400* * CLOSE OUTPUT EXTRACT FILE                                  * *05080000
051500* ************************************************************** *05090000
051600 9790-CLOSE-OUT-EXTRACT-FILE.                                     05100000
051700     CLOSE OUT-EXTRACT-FILE.                                      05110000
051800                                                                  05120000
051900                                                                  05130000
052000* ************************************************************** *05140000
052100* * DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT *05150000
052200* * AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN          * *05160000
052300* * SQL ERROR OR WARNING CODE OCCURS.                          * *05170000
052400* ************************************************************** *05180000
052500 9999-DB2-ABEND.                                                  05190000
052600                                                                  05200000
052700     DISPLAY PC-CURRENT-PROGRAM-NAME                              05210000
052800             ' 9999-DB2-ABEND'.                                   05220000
052900     DISPLAY PC-CURRENT-PROGRAM-NAME                              05230000
053000             ' ** ABEND           **'.                            05240000
053100     DISPLAY PC-CURRENT-PROGRAM-NAME                              05250000
053200             ' ** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.       05260000
053300     DISPLAY PC-CURRENT-PROGRAM-NAME                              05270000
053400             ' ** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME.       05280000
053500     DISPLAY PC-CURRENT-PROGRAM-NAME                              05290000
053600             ' ** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.  05300000
053700                                                                  05310000
053800     DISPLAY PC-CURRENT-PROGRAM-NAME                              05320000
053900             ' ** SQLCODE         ** = ' SQLCODE.                 05330000
054000     MOVE SQLCODE TO PV-SQLCODE.                                  05340000
054100     DISPLAY PC-CURRENT-PROGRAM-NAME                              05350000
054200             ' ** PV-SQLCODE      ** = ' PV-SQLCODE '.'.          05360000
054300                                                                  05370000
054400     DISPLAY PC-CURRENT-PROGRAM-NAME                              05380000
054500             ' ** SQLWARN0        ** = ' SQLWARN0 '.'.            05390000
054600                                                                  05400000
054400     DISPLAY PC-CURRENT-PROGRAM-NAME                              05410000
054500             ' ** PO NUMBER       ** = ' PV-PO-NBR-NUM '.'.       05420000
054600                                                                  05430000
054700                                                                  05440000
054800*----------------------------------------------------------------*05450000
054900* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *05460000
055000* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *05470000
055100* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *05480000
055200* FORMAT.                                                        *05490000
055300*----------------------------------------------------------------*05500000
055400     COPY DPPD004.                                                05510000
055500                                                                  05520000
055600     MOVE PC-ABENDING               TO DP-STATUS-DESCRIPTION.     05530000
055700     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           05540000
055800     PERFORM 9090-CLOSE-IN-DRIVER-FILE.                           05550000
055900     PERFORM 9790-CLOSE-OUT-EXTRACT-FILE.                         05560000
056000                                                                  05570000
056100*----------------------------------------------------------------*05580000
056200* CALL ABEND                                                     *05590000
056300*----------------------------------------------------------------*05600000
056400     MOVE +4013                  TO ABEND-CODE.                   05610000
056500     CALL 'ILBOABN0' USING ABEND-CODE.                            05620000
056600*                                                                 05630000
