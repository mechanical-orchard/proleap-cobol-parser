000100*-----------------------*                                         00010062
000200 IDENTIFICATION DIVISION.                                         00020062
000300*-----------------------*                                         00030062
000400 PROGRAM-ID.    PEKCS191.                                         00040062
000500 AUTHOR.        AMY REILAND                                       00050062
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060062
000700 DATE-WRITTEN.  07-22-93.                                         00070062
000800 DATE-COMPILED.                                                   00080062
000900*----------------------------------------------------------------*00090062
001000*    Q191 - ADD IN-STORE HEADER                                  *00100062
001100*                                                                *00110062
001200*    THIS PROGRAM ALLOWS THE USER TO ADD A NEW IN-STORE DOCUMENT *00120062
001300*    HEADER.  THE DOCUMENT NUMBER IS PROTECTED AND WILL BE       *00130062
001400*    GENERATED BY THIS PROGRAM.                                  *00140062
001500*    PAGES TO PRINT WILL DEFAULT TO 1, BUT CAN BE MODIFIED.      *00150062
001600*    DEPT/AREA IS A REQUIRED FIELD.  REASON CODE IS OPTIONAL     *00160062
001700*    AND CAN BE ADDED OR UPDATED ON THE UPDATE SCREEN.           *00170062
001800*----------------------------------------------------------------*00180062
001900*    03/25/94 - A. REILAND                                       *00190062
002000*    MODIFIED THE PROGRAM SO THE DOCUMENT IS NOT CREATED WITH    *00200062
002100*    A DELINQUENT STATUS IF IT IS CREATED ON THE LAST FRIDAY OF  *00210062
002200*    THE FISCAL MONTH.  THIS IS BECAUSE THE DOCUMENT IS REALLY   *00220062
002300*    INTENDED FOR THE NEXT MONTH.                                *00230062
002400*----------------------------------------------------------------*00240062
002500*    11/21/94 - A. RECKNAGEL                                     *00250062
002600*    MODIFIED THE PROGRAM SO A TYPE/REASON CODE OF '175' IS NOT  *00260062
002700*    ALLOWED TO BE ADDED.                                        *00270062
002800*----------------------------------------------------------------*00280062
002900* 02/02/95 - TCM -  WR NO. 3289                                  *00290062
003000*    - ADD CODING TO 3000-RESET-ATTRIBUTES AND                   *00300062
003100*      4000-BUILD-INITIAL-PANEL TO PROCESS LOCATION TYPE:        *00310062
003200*        RV - RETURN TO VENDOR                                   *00320062
003300*----------------------------------------------------------------*00330062
003400* 06/26/96 - TCM -  WR NO. 3966                                  *00340062
003500*    - REPLACE PC-LOC-TYPE-HEADQUARTERS, PC-LOC-TYPE-DC,         *00350062
003600*      PC-LOC-TYPE-RV WITH APPROPRIATE PE049-LOCATION-TYPE-CODES *00360062
003700*    - ADD PE049-CENT-STK-LOC-TYP-CDE TO                         *00370062
003800*      3000-EDIT-DATA-IN-COMMAREA AND 4000-BUILD-INITIAL-PANEL   *00380062
003900*      PARAGRAPH PROCESSING                                      *00390062
004000*    - REPLACE ALL "++INCLUDE" REFERENCES WITH "COPY"            *00400062
004100*      REFERENCES, PER STANDARDS                                 *00410062
004200*    NOTE: DEFAULT STORE LOGIN/DP020-LOCATION-TYPE IS BEING      *00420062
004300*          DETERMINED IN DPKCS028 BY DP020-LINE-ADDR AND         *00430062
004400*          DP020-PHYSICAL-UNIT-ADDR.  AT THIS POINT IN TIME ALL  *00440062
004500*          MILWAUKEE DC LOCATIONS (085 - DC, 801 - RV, 802 - CS) *00450062
004600*          HAVE LINE/PHYSICAL UNIT ADDRESS' ASSIGNED TO STR_NBR  *00460062
004700*          - "085", AS ALL FINDLAY LOCATIONS (810 - DC,          *00470062
004800*          811 - RV, 812 - CS) HAVE LINE/PHYSICAL UNIT ADDRESS'  *00480062
004900*          ASSIGNED TO STR_NBR - "810".  SHOULD                  *00490062
005000*          PE049-DISTRB-CNTR-LOC-TYP-CDE CODE EVER BE REMOVED    *00500062
005100*          FROM THIS PROGRAM, WITHOUT AN ASSOCIATED CHANGE IN    *00510062
005200*          THE LINE/PHYSICAL UNIT ASSIGNMENTS, DC DOCUMENT       *00520062
005300*          PRINTING WILL BE AFFECTED (THERE'S A QUESTION WHERE   *00530062
005400*          THESE DOCUMENTS WILL ULTIMATELY PRINT).               *00540062
005500*----------------------------------------------------------------*00550062
005600* 12/03/96 - TCM -  WR NO. 3904                                  *00560062
005700*    - DO NOT ALLOW REASON CODE "65" (RETURN TO VENDOR) PERM     *00570062
005800*      IN-STORE DOCUMENTS TO BE PROCESSED BY THIS PROGRAM        *00580062
005900*----------------------------------------------------------------*00590062
006000* 10/04/2000 - JACK KRAMER   WR 21558                            *00600062
006100*    - REMOVED FISCAL MONTH END DATE LOGIC TO DETERMINE IF A     *00610062
006200*      DOCUMENT SHOULD BE CREATED DELINQUENT.                    *00620062
006300*    - SINCE THIS WAS THE ONLY DATE ROUTINE CALL, I ALSO         *00630062
006400*      REMOVED ALL REFERENCE TO THE DATE ROUTINE.                *00640062
006500*----------------------------------------------------------------*00650062
006600* 12/23/2001 - JACK KRAMER   WR 21963                            *00660062
006700*    - ADDED CODE TO TREAT RF CONTINUED CLEARANCE (112) AS AN    *00670062
006800*      INVALID REASON CODE - CAN NOT BE CREATED MANUALLY         *00680062
006900*----------------------------------------------------------------*00690062
007000* 01/04/05 - TCM -  WR NO. 27559                                 *00700062
007100*    - CHANGED ALL STORE NUMBER LENGTH REFERENCES FROM 3 TO 4    *00710062
007200*      DIGITS IN LENGTH AND ADDED A 4 DIGIT NUMERIC STORE        *00720062
007300*      NUMBER FIELD(S)                                           *00730062
007400*    - EXPANDED THE ENTERABLE PRINTER-ID FROM 4 TO 5 DIGITS      *00740062
007500*    - CHANGED THE FILLER REDEFINES DP020-VARIABLE-COMMAREA      *00750062
007600*      FILLER LENGTH AND THE APPROPRIATE MNEMONIC LENGTH         *00760062
007700*    - REMOVED THE OPERCO_NBR FIELD FROM ALL IN-STORE PERM TABLE *00770062
007800*      CALLS                                                     *00780062
007900*    - ADDED THE NEW REASON CODE ("87") FOR                      *00790062
008000*      "COSMETICS TESTERS ONLY" IN-STORE DOCUMENTS               *00800062
008100*----------------------------------------------------------------*00810062
008200* 02/14/05 - TCM -  WR NO. 27559                                 *00820062
008300*    - REMOVED THE SIGN (S) OFF THE PIC S9(04) FIELDS:           *00830062
008400*      PE056-PRINT-FOR-STORE-NUMBER                              *00840062
008500*      PE056-PRINT-AT-STORE-NUMBER                               *00850062
008600*----------------------------------------------------------------*00860062
008700* 05/04/05 - TCM -  WR NO. 27559                                 *00870062
008800*    - IN 1100-PROCESS-INTER-APPL-COMM CHANGED THE PROGRAM TO    *00880062
008900*      RETURN AN ERROR MESSAGE IF ASC-STORE-NUMBER = ZEROS.  A   *00890062
009000*      "0" STORE NUMBER IN-STORE DOCUMENT IS NOT ALLOWED.        *00900062
009100*----------------------------------------------------------------*00910062
009200* W28543  05-02-2005 ROD JANSSEN MISSED MARKDOWN/MISSED MARKUP    00920062
009300*                                ENHANCEMENTS                     00930062
009400*         **  ADJUST THE PERM INSTORE MAINTENANCE SCREENS TO NOT  00940062
009500*             ADD/UPDATE/CANCEL FUNCTIONALITY FOR INVENTORY       00950062
009600*             MISSED MARKDOWNS. (RECOMPILE THIS MODULE...)        00960062
009700*----------------------------------------------------------------*00970062
009800* 10/26/05 - TCM -  WR NO. 28048                                 *00980062
009900*    - ADDED THE NEW REASON CODE ("89") FOR                      *00990062
010000*      "MARK OUT-OF-STOCK - SALVAGE" IN-STORE DOCUMENTS          *01000062
010100*----------------------------------------------------------------*01010062
010200* 02/12/07 - JMK -  WR #31677                                    *01020062
010300*    - DISABLED STORE MARKDOWN CODES #115 AND #315 BY            *01030062
010400*      COMMENTING OUT VALUE #15 IN COPYBOOK PEWS049 FOR 88 LEVEL *01040062
010500*      PE049-IS-VALID-CREATE-RSN                                 *01050062
010600*----------------------------------------------------------------*01060062
010700* 06/10/19 - JIM ARENDT  - CHG0225519                            *01070062
010800*    - REMOVED CODE THAT WAS LOCKING TABLE TSPCNBR AND ADDED     *01080062
010900*      DOC_UPD_CSR.                                              *01090062
011000*----------------------------------------------------------------*01100062
011010* 09/14/2021 - GERMAN BANDA - CHG0261678                          01101065
011020* DESCRIPTION: CHANGE CALL OF DPKUT100 TO                         01102063
011030*              CALL DP010I-NUMERIC-EDIT-ROUTINE                   01103063
011040*              MAKING THE CALL DYNAMIC VS STATIC                  01104063
011050*---------------------------------------------------------------* 01105063
CICS  *  CHANGED 10/17/2022    BY BARB SCHULTZ    WR: CHG0276658        01110068
CICS  *                                                                 01111066
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL     01112069
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.      01112166
CICS  *-----------------------------------------------------------------01113066
011200                                                                  01120062
011300 ENVIRONMENT DIVISION.                                            01130062
011400                                                                  01140062
011500                                                                  01150062
011600                                                                  01160062
011700 DATA DIVISION.                                                   01170062
011800                                                                  01180062
011900                                                                  01190062
012000 WORKING-STORAGE SECTION.                                         01200062
012100                                                                  01210062
012200 01  DK-DB2-KEYS.                                                 01220062
012300     05  DK-CURRENT-DATE          PIC  X(10)  VALUE SPACE.        01230062
012400     05  DK-DOCUMENT-NUMBER       PIC S9(07)  VALUE +0            01240062
012500                                              COMP-3.             01250062
012600     05  DK-OPERATING-COMPANY     PIC  X(02)  VALUE SPACE.        01260062
012700     05  DK-ORIGIN                PIC S9(04)  VALUE ZEROS         01270062
012800                                              COMP.               01280062
012900     05  DK-STORE-NUMBER          PIC S9(04)  VALUE ZEROS         01290062
013000                                              COMP.               01300062
013100     05  DK-USERID                PIC  X(08)  VALUE SPACE.        01310062
013200*                                                                 01320062
013300 01  PC-PROGRAM-CONSTANTS.                                        01330062
013400     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'PE191A  '.  01340062
013500     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'PEKM191 '.  01350062
013600     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'PEKCS191'.  01360062
013700     05  PC-LOC-HEADQUARTERS      PIC S9(04)  VALUE  0090.        01370062
013800     05  PC-MAX-RETRIES           PIC S9(04)  VALUE +3            01380062
013900                                              COMP.               01390062
014000     05  PC-PAGE-DEFAULT          PIC  9(03)  VALUE 1.            01400062
014100     05  PC-PENDING               PIC  X(07)  VALUE 'PENDING'.    01410062
014200     05  PC-PRINT-COMMAREA-LENGTH PIC S9(04)  VALUE +35           01420062
014300                                              COMP SYNC.          01430062
014400     05  PC-PRINT-TRANSID         PIC  X(04)  VALUE 'Q008'.       01440062
014500                                                                  01450062
014600     05  PC-TSYMSG-NUMBERS.                                       01460062
014700         10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       01470062
014800         10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       01480062
014900         10  PC-TSYMSG-00022      PIC  9(05)  VALUE  00022.       01490062
015000         10  PC-TSYMSG-00074      PIC  9(05)  VALUE  00074.       01500062
015100         10  PC-TSYMSG-00505      PIC  9(05)  VALUE  00505.       01510062
015200         10  PC-TSYMSG-00506      PIC  9(05)  VALUE  00506.       01520062
015300         10  PC-TSYMSG-00507      PIC  9(05)  VALUE  00507.       01530062
015400         10  PC-TSYMSG-00527      PIC  9(05)  VALUE  00527.       01540062
015500         10  PC-TSYMSG-00975      PIC  9(05)  VALUE  00975.       01550062
015600*                                                                 01560062
015700 01  PS-PROGRAM-SWITCHES.                                         01570062
015800     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         01580062
015900         88  PS-ERROR                         VALUE  'Y'.         01590062
016000         88  PS-NO-ERROR                      VALUE  'N'.         01600062
016100     05  PS-RSN-CDE-SW            PIC  X(01)  VALUE  'N'.         01610062
016200         88  PS-VALID-RSN-CDE                 VALUE  'Y'.         01620062
016300         88  PS-INVALID-RSN-CDE               VALUE  'N'.         01630062
016400     05  PS-TYPE-CDE-SW           PIC  X(01)  VALUE  'N'.         01640062
016500         88  PS-VALID-TYPE-CDE                VALUE  'Y'.         01650062
016600         88  PS-INVALID-TYPE-CDE              VALUE  'N'.         01660062
016700     05  PS-PRINTER-ID-ERROR-SW   PIC  X(01)  VALUE  'N'.         01670062
016800         88  PS-PRINTER-ID-ERROR              VALUE  'Y'.         01680062
016900         88  PS-NO-PRINTER-ID-ERROR           VALUE  'N'.         01690062
017000*                                                                 01700062
017100 01  PV-PROGRAM-VARIABLES.                                        01710062
017200     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            01720062
017300                                              COMP SYNC.          01730062
017400     05  PV-CONTROL-NUMBER        PIC S9(03)  VALUE +0            01740062
017500                                              COMP-3.             01750062
017600     05  PV-LOCK-RETRY-COUNTER    PIC S9(04)  VALUE +0            01760062
017700                                              COMP SYNC.          01770062
017800     05  PV-PAGES-OVER-MAX        PIC  9(03)  VALUE 0.            01780062
017900     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            01790062
018000                                              COMP SYNC.          01800062
018100     05  PV-TYPE-REASON-CODE.                                     01810062
018200         10  PV-TYPE-CODE         PIC  9(01)  VALUE 0.            01820062
018300         10  PV-REASON-CODE       PIC  9(02)  VALUE 0.            01830062
018400                                                                  01840062
018500*                                                                 01850062
018600 EJECT                                                            01860062
018700*----------------------------------------------------------------*01870062
018800*    MAP LAYOUT                                                  *01880062
018900*----------------------------------------------------------------*01890062
019000                                                                  01900062
019100     COPY PEKM191.                                                01910062
019200*                                                                 01920062
019300 EJECT                                                            01930062
019400*----------------------------------------------------------------*01940062
019500*    CALLING PARAMETERS FOR DATE TIME MODULE                     *01950062
019600*----------------------------------------------------------------*01960062
019700                                                                  01970062
019800     COPY DPWS017.                                                01980062
019900*                                                                 01990062
020000 EJECT                                                            02000062
020100*----------------------------------------------------------------*02010062
020200*    CALLING PARAMETERS FOR NUMERIC EDIT CHECK MODULE            *02020062
020300*----------------------------------------------------------------*02030062
020400                                                                  02040062
020500     COPY DPWS010I.                                               02050062
020600*                                                                 02060062
020700 EJECT                                                            02070062
020800*----------------------------------------------------------------*02080062
020900*    PERM CONTROL TABLE VALUES                                   *02090062
021000*----------------------------------------------------------------*02100062
021100                                                                  02110062
021200     COPY PEWS048.                                                02120062
021300*                                                                 02130062
021400 EJECT                                                            02140062
021500*----------------------------------------------------------------*02150062
021600*    PERM CONSTANT COPYBOOK                                      *02160062
021700*----------------------------------------------------------------*02170062
021800                                                                  02180062
021900     COPY PEWS049.                                                02190062
022000*                                                                 02200062
022100 EJECT                                                            02210062
022200*----------------------------------------------------------------*02220062
022300*    ATTRIBUTE SETTINGS COPYBOOK.                                *02230062
022400*----------------------------------------------------------------*02240062
022500                                                                  02250062
022600     COPY DPWS015.                                                02260062
022700*                                                                 02270062
022800 EJECT                                                            02280062
022900*----------------------------------------------------------------*02290062
023000*    FUNCTION KEYS COPYBOOK                                      *02300062
023100*----------------------------------------------------------------*02310062
023200                                                                  02320062
023300     COPY DPWS016.                                                02330062
023400*                                                                 02340062
023500 EJECT                                                            02350062
023600*----------------------------------------------------------------*02360062
023700*    ABEND PROCESSING COPYBOOK.                                  *02370062
023800*----------------------------------------------------------------*02380062
023900                                                                  02390062
024000     COPY DPWS013.                                                02400062
024100*                                                                 02410062
024200 EJECT                                                            02420062
024300*----------------------------------------------------------------*02430062
CICS  * PARAMETERS FOR CALLING CICS ARCHITECTURE API.                   02440066
024500*----------------------------------------------------------------*02450062
024600     COPY DPWS030.                                                02460062
CICS       COPY DPWS930.                                                02461066
024700*                                                                 02470062
024800 EJECT                                                            02480062
024900*----------------------------------------------------------------*02490062
025000* TS QUEUE LAYOUT TO PASS INFO TO THE IN-STR DOC PRINT PEKCS008   02500062
025100*----------------------------------------------------------------*02510062
025200 01  DOCUMENT-PRINT-RECORD.                                       02520062
025300     COPY PEWS065.                                                02530062
025400*                                                                 02540062
025500 EJECT                                                            02550062
025600*----------------------------------------------------------------*02560062
025700* APPL SPEC COMMAREA FOR IN-STR PRINT PROGRAM PEKCS008            02570062
025800*----------------------------------------------------------------*02580062
025900     COPY PEWS056.                                                02590062
026000*                                                                 02600062
026100 EJECT                                                            02610062
026200*----------------------------------------------------------------*02620062
026300*    STANDARD COMMAREA.                                           02630062
026400*----------------------------------------------------------------*02640062
026500                                                                  02650062
026600     COPY DPWS020.                                                02660062
026700     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02670062
026800                                                                  02680062
026900*                                                                 02690062
027000 EJECT                                                            02700062
027100*----------------------------------------------------------------*02710062
027200*    INTER-APPLICATION COMMAREA.                                  02720062
027300*----------------------------------------------------------------*02730062
027400                                                                  02740062
027500         10  INTER-APPL-COMMAREA  PIC X(200).                     02750062
027600*----------------------------------------------------------------*02760062
027700*    INTER-APPLICATION COMMAREA PASSED FROM THE CRITERIA SPEC.    02770062
027800*----------------------------------------------------------------*02780062
027900     COPY PEWS064.                                                02790062
028000*                                                                 02800062
028100 EJECT                                                            02810062
028200*----------------------------------------------------------------*02820062
028300*    SPECIFIC COMMMAREA FOR PEKCS191.                             02830062
028400*----------------------------------------------------------------*02840062
028500         10  ASC-SPECIFIC-COMMAREA.                               02850062
028600             15  ASC-STORE-NUMBER            PIC  X(04).          02860062
028700             15  FILLER REDEFINES ASC-STORE-NUMBER.               02870062
028800                 20  ASC-STORE-NUMBER-N      PIC  9(04).          02880062
028900             15  ASC-STORE-NAME              PIC  X(25).          02890062
029000             15  ASC-DOCUMENT-NUMBER.                             02900062
029100                 20  ASC-DOCUMENT-NUMBER-N   PIC  9(07).          02910062
029200             15  ASC-REASON-CODE.                                 02920062
029300                 20  ASC-REASON-CODE-N       PIC  9(03).          02930062
029400             15  ASC-TYPE-DESC               PIC  X(08).          02940062
029500             15  ASC-REASON-DESC             PIC  X(12).          02950062
029600             15  ASC-PAGES-TO-PRINT.                              02960062
029700                 20  ASC-PAGES-TO-PRINT-N    PIC  9(03).          02970062
029800             15  ASC-DEPT-AREA-TEXT          PIC  X(40).          02980062
029900             15  ASC-PRINTER-ID              PIC  X(08).          02990062
030000             15  ASC-STORE-TERMINAL-SW       PIC  X(01).          03000062
030100                 88  ASC-STORE-TERMINAL      VALUE 'Y'.           03010062
030200                 88  ASC-NON-STORE-TERMINAL  VALUE 'N'.           03020062
030300         10  FILLER                          PIC  X(2754).        03030062
030400*                                                                 03040062
030500 EJECT                                                            03050062
030600*----------------------------------------------------------------*03060062
030700*    DB2 AREA FOR TPPCCTL (PERM CONTROL INFORMATION)              03070062
030800*----------------------------------------------------------------*03080062
030900                                                                  03090062
031000     EXEC SQL                                                     03100062
031100          INCLUDE TPPCCTL                                         03110062
031200     END-EXEC.                                                    03120062
031300                                                                  03130062
031400*                                                                 03140062
031500 EJECT                                                            03150062
031600*----------------------------------------------------------------*03160062
031700*    DB2 AREA FOR TSPCNBR (IN-STORE DOCUMENT NUMBER)              03170062
031800*----------------------------------------------------------------*03180062
031900                                                                  03190062
032000     EXEC SQL                                                     03200062
032100          INCLUDE TSPCNBR                                         03210062
032200     END-EXEC.                                                    03220062
032300                                                                  03230062
032400*                                                                 03240062
032500 EJECT                                                            03250062
032600*----------------------------------------------------------------*03260062
032700*    DB2 AREA FOR TSTRPPC (IN-STORE HEADER)                       03270062
032800*----------------------------------------------------------------*03280062
032900     EXEC SQL                                                     03290062
033000          INCLUDE TSTRPPC                                         03300062
033100     END-EXEC.                                                    03310062
033200                                                                  03320062
033300*                                                                 03330062
033400 EJECT                                                            03340062
033500*----------------------------------------------------------------*03350062
033600*    DB2 AREA FOR COMMUNICATIONS                                  03360062
033700*----------------------------------------------------------------*03370062
033800                                                                  03380062
033900     EXEC SQL                                                     03390062
034000          INCLUDE SQLCA                                           03400062
034100     END-EXEC.                                                    03410062
034200                                                                  03420062
034300*----------------------------------------------------------------*03430062
034400* CURSOR DECLARATION FOR UPDATING THE LAST ISSUED DOCUMENT NBR    03440062
034500*----------------------------------------------------------------*03450062
034600     EXEC SQL                                                     03460062
034700        DECLARE DOC_UPD_CSR CURSOR FOR                            03470062
034800           SELECT STR_NEXT_DOC_NBR                                03480062
034900             FROM TSPCNBR                                         03490062
035000         FOR UPDATE OF STR_NEXT_DOC_NBR                           03500062
035100     END-EXEC.                                                    03510062
035200*----------------------------------------------------------------*03520062
035300*                                                                 03530062
035400 EJECT                                                            03540062
035500 LINKAGE SECTION.                                                 03550062
035600                                                                  03560062
035700 01  DFHCOMMAREA.                                                 03570062
035800     05  FILLER                         OCCURS  1 TO 4072 TIMES   03580062
035900                                        DEPENDING ON EIBCALEN.    03590062
036000         10  FILLER                     PIC  X(01).               03600062
036100                                                                  03610062
036200                                                                  03620062
036300 PROCEDURE DIVISION.                                              03630062
036400***************************************************************** 03640062
036500** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 03650062
036600** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 03660062
036700** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 03670062
036800**                                                             ** 03680062
036900** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 03690062
037000** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 03700062
037100***************************************************************** 03710062
037200 0000-MAIN-MODULE.                                                03720062
037300     INITIALIZE DP030-CICS-API-FIELDS.                            03730062
037400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03740062
037500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03750062
037600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03760062
037700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03770062
037800     MOVE LENGTH OF PE191AI        TO DP030-MAP-LENGTH (1).       03780062
037900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03790062
038000     PERFORM 0001-CALL-CICS-ARCH-API.                             03800062
038100*                                                                 03810062
038200     PERFORM 1000-CONTROL-PROCESSING                              03820062
038300*                                                                 03830062
038400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03840062
038500     PERFORM 0001-CALL-CICS-ARCH-API.                             03850062
038600                                                                  03860062
038700 0001-CALL-CICS-ARCH-API.                                         03870062
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03880066
038900                                    DFHCOMMAREA                   03890067
039000                                    DP030-CICS-API-FIELDS         03900067
039100                                    DP020-STANDARD-COMMAREA       03910067
039200                                    PE191AI.                      03920067
039300*                                                                 03930062
039400     IF  DP030-RC-CALL-SUCCESSFUL                                 03940062
039500         CONTINUE                                                 03950062
039600     ELSE                                                         03960062
039700         SET DP013-NO-ROLLBACK                                    03970062
039800             DP013-XCTL-DISPLAY-RESTART                           03980062
039900             DP013-CICS-ABEND      TO TRUE                        03990062
040000         MOVE 'BEFORE 0000-MAIN-MODULE'                           04000062
040100                                   TO DP013-PARAGRAPH             04010062
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04020066
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04030066
040400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04040062
040500         PERFORM DP013-0000-PROCESS-ABEND                         04050062
040600     END-IF.                                                      04060062
040700*                                                                 04070062
040800 EJECT                                                            04080062
040900*----------------------------------------------------------------*04090062
041000*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *04100062
041100*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *04110062
041200*----------------------------------------------------------------*04120062
041300 1000-CONTROL-PROCESSING.                                         04130062
041400     MOVE DP020-OPERATING-COMPANY  TO DK-OPERATING-COMPANY.       04140062
041500     MOVE DP020-USERID             TO DK-USERID.                  04150062
041600     MOVE DP020-LOCATION-NBR       TO DK-ORIGIN.                  04160062
041700     PERFORM DP017-0000-GET-CURR-DATE-TIME.                       04170062
041800     SET DP017-EDITED-YMD-DATE-DASH-1                             04180062
041900         DP017-EDITED-YMD-DATE-DASH-2                             04190062
042000                                   TO TRUE.                       04200062
042100     MOVE DP017-EDITED-DATE-YYYYMMDD                              04210062
042200                                   TO DK-CURRENT-DATE.            04220062
042300     EVALUATE TRUE                                                04230062
042400         WHEN DP020-NEXT-ACT-INITIAL                              04240062
042500             INITIALIZE ASC-SPECIFIC-COMMAREA                     04250062
042600             MOVE SPACES           TO ASC-REASON-CODE             04260062
042700                                      ASC-PAGES-TO-PRINT          04270062
042800             PERFORM 1100-PROCESS-INTER-APPL-COMM                 04280062
042900             IF PS-ERROR                                          04290062
043000                 SET DP020-MSG-FATAL                              04300062
043100                     DP020-NEXT-ACT-APPL-ERROR TO TRUE            04310062
043200             ELSE                                                 04320062
043300                 PERFORM 4000-BUILD-INITIAL-PANEL                 04330062
043400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             04340062
043500             END-IF                                               04350062
043600                                                                  04360062
043700                                                                  04370062
043800         WHEN DP020-NEXT-ACT-READ-MAP                             04380062
043900             PERFORM 2000-PROCESS-PANEL                           04390062
044000                                                                  04400062
044100         WHEN DP020-NEXT-ACT-RETURN                               04410062
044200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04420062
044300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04430062
044400                                                                  04440062
044500         WHEN OTHER                                               04450062
044600             SET DP013-LOGIC-ABEND                                04460062
044700                 DP013-NO-ROLLBACK TO TRUE                        04470062
044800             MOVE '1000-CONTROL-PROCESSING'                       04480062
044900                                   TO DP013-PARAGRAPH             04490062
045000             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   04500062
045100                                   TO DP013-MESSAGE-TEXT(1)       04510062
045200             MOVE DP020-NEXT-APPL-ACTIVITY                        04520062
045300                                   TO DP013-MESSAGE-TEXT(2)       04530062
045400             PERFORM DP013-0000-PROCESS-ABEND                     04540062
045500     END-EVALUATE.                                                04550062
045600*                                                                 04560062
045700 EJECT                                                            04570062
045800*----------------------------------------------------------------*04580062
045900* MOVE THE INTER APPL COMMAREA, PASSED FROM THE CRITERIA SPEC, TO*04590062
046000* THE APPLICATION SPECIFIC COMMAREA.                             *04600062
046100*----------------------------------------------------------------*04610062
046200 1100-PROCESS-INTER-APPL-COMM.                                    04620062
046300                                                                  04630062
046400     MOVE PE064-STORE-NUMBER         TO ASC-STORE-NUMBER-N.       04640062
046500     MOVE PE064-STORE-NAME           TO ASC-STORE-NAME.           04650062
046600     MOVE PE064-DOCUMENT-NUMBER      TO ASC-DOCUMENT-NUMBER.      04660062
046700*                                                                 04670062
046800     IF ASC-STORE-NUMBER = ZEROS                                  04680062
046900         SET PS-ERROR                TO TRUE                      04690062
047000         MOVE PC-TSYMSG-00507        TO DP020-MSG-NUMBER          04700062
047100*   STORE NUMBER REQUIRED FOR REQUESTED FUNCTION                  04710062
047200     ELSE                                                         04720062
047300         MOVE ASC-STORE-NUMBER-N     TO DK-STORE-NUMBER           04730062
047400         IF ASC-DOCUMENT-NUMBER NOT = SPACES                      04740062
047500             SET PS-ERROR            TO TRUE                      04750062
047600             MOVE PC-TSYMSG-00074    TO DP020-MSG-NUMBER          04760062
047700*   DOCUMENT NUMBER SHOULD NOT BE SPECIFIED FOR ADD               04770062
047800         END-IF                                                   04780062
047900     END-IF.                                                      04790062
048000                                                                  04800062
048100*                                                                 04810062
048200 EJECT                                                            04820062
048300*----------------------------------------------------------------*04830062
048400* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*04840062
048500* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*04850062
048600* EDITS.                                                         *04860062
048700*----------------------------------------------------------------*04870062
048800 2000-PROCESS-PANEL.                                              04880062
048900                                                                  04890062
049000     EVALUATE TRUE                                                04900062
049100                                                                  04910062
049200         WHEN DP020-SRC-AID = DP016-CLEAR                         04920062
049300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04930062
049400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04940062
049500                                                                  04950062
049600         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     04960062
049700             MOVE SPACES             TO ASC-DOCUMENT-NUMBER       04970062
049800                                        ASC-REASON-CODE           04980062
049900                                        ASC-REASON-DESC           04990062
050000                                        ASC-TYPE-DESC             05000062
050100                                        ASC-PAGES-TO-PRINT        05010062
050200                                        ASC-DEPT-AREA-TEXT        05020062
050300                                        ASC-PRINTER-ID            05030062
050400             PERFORM 4000-BUILD-INITIAL-PANEL                     05040062
050500             PERFORM 3200-RESET-ATTRIBUTES                        05050062
050600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05060062
050700                                                                  05070062
050800         WHEN OTHER                                               05080062
050900             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05090062
051000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05100062
051100             PERFORM 2100-CHECK-FUNCTION-KEY                      05110062
051200     END-EVALUATE.                                                05120062
051300*                                                                 05130062
051400 EJECT                                                            05140062
051500*----------------------------------------------------------------*05150062
051600*  ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **05160062
051700*  FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **05170062
051800*  FROM THE CICS ARCHITECTURE API.                              **05180062
051900*----------------------------------------------------------------*05190062
052000 2100-CHECK-FUNCTION-KEY.                                         05200062
052100                                                                  05210062
052200     EVALUATE TRUE                                                05220062
052300         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              05230062
052400             IF  PS-NO-ERROR                                      05240062
052500                 PERFORM 4100-UPD-PROCESSING                      05250062
052600                 PERFORM 5000-ADD-IN-STR-DOCUMENT                 05260062
052700                 MOVE ASC-DOCUMENT-NUMBER                         05270062
052800                                      TO DP020-MSG-TEXT           05280062
052900                 MOVE PC-TSYMSG-00506 TO DP020-MSG-NUMBER         05290062
053000                 SET DP020-MSG-INFORMATIONAL                      05300062
053100                                       TO TRUE                    05310062
053200                 MOVE SPACES           TO ASC-DOCUMENT-NUMBER     05320062
053300                                          ASC-REASON-CODE         05330062
053400                                          ASC-REASON-DESC         05340062
053500                                          ASC-TYPE-DESC           05350062
053600                                          ASC-DEPT-AREA-TEXT      05360062
053700                                          ASC-PRINTER-ID          05370062
053800                 PERFORM 4000-BUILD-INITIAL-PANEL                 05380062
053900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05390062
054000                 SET DP030-OVERRIDE-GO TO TRUE                    05400062
054100             ELSE                                                 05410062
054200                 SET DP030-OVERRIDE-GO TO TRUE                    05420062
054300             END-IF                                               05430062
054400                                                                  05440062
054500         WHEN DP020-SRC-AID = DP016-ENTER                         05450062
054600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05460062
054700                                                                  05470062
054800         WHEN OTHER                                               05480062
054900             SET DP013-NO-ROLLBACK                                05490062
055000                 DP013-XCTL-DISPLAY-RESTART                       05500062
055100                 DP013-CICS-ABEND  TO TRUE                        05510062
055200             MOVE '2100-CHECK-FUNCTION-KEY'                       05520062
055300                                   TO DP013-PARAGRAPH             05530062
055400             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05540062
055500                                   TO DP013-MESSAGE-TEXT (1)      05550062
055600             PERFORM DP013-0000-PROCESS-ABEND                     05560062
055700     END-EVALUATE.                                                05570062
055800*                                                                 05580062
055900 EJECT                                                            05590062
056000*----------------------------------------------------------------*05600062
056100*  MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE    *05610062
056200*  INTER-APPLICATION COMMAREA.                                   *05620062
056300*----------------------------------------------------------------*05630062
056400 2110-PREPARE-INTER-APPL-COMM.                                    05640062
056500*                                                                 05650062
056600 EJECT                                                            05660062
056700*----------------------------------------------------------------*05670062
056800* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*05680062
056900* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *05690062
057000* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *05700062
057100*----------------------------------------------------------------*05710062
057200 2200-MOVE-SCREEN-TO-COMMAREA.                                    05720062
057300                                                                  05730062
057400     IF  ARSNL > ZERO                                             05740062
057500         MOVE ARSNI                TO ASC-REASON-CODE             05750062
057600     ELSE                                                         05760062
057700         IF  ARSNF = DP015-ERASE-EOF                              05770062
057800             MOVE SPACE            TO ASC-REASON-CODE             05780062
057900         END-IF                                                   05790062
058000     END-IF.                                                      05800062
058100                                                                  05810062
058200     IF  APAGEL > ZERO                                            05820062
058300         MOVE APAGEI               TO ASC-PAGES-TO-PRINT          05830062
058400     ELSE                                                         05840062
058500         IF  APAGEF = DP015-ERASE-EOF                             05850062
058600             MOVE PC-PAGE-DEFAULT  TO ASC-PAGES-TO-PRINT          05860062
058700         END-IF                                                   05870062
058800     END-IF.                                                      05880062
058900                                                                  05890062
059000     IF  ADPTARL > ZERO                                           05900062
059100         MOVE ADPTARI              TO ASC-DEPT-AREA-TEXT          05910062
059200     ELSE                                                         05920062
059300         IF  ADPTARF = DP015-ERASE-EOF                            05930062
059400             MOVE SPACE            TO ASC-DEPT-AREA-TEXT          05940062
059500         END-IF                                                   05950062
059600     END-IF.                                                      05960062
059700                                                                  05970062
059800     IF  APRTIDL > ZERO                                           05980062
059900         MOVE APRTIDI              TO ASC-PRINTER-ID              05990062
060000     ELSE                                                         06000062
060100         IF  APRTIDF = DP015-ERASE-EOF                            06010062
060200             MOVE SPACE            TO ASC-PRINTER-ID              06020062
060300         END-IF                                                   06030062
060400     END-IF.                                                      06040062
060500                                                                  06050062
060600*                                                                 06060062
060700 EJECT                                                            06070062
060800*----------------------------------------------------------------*06080062
060900* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *06090062
061000* IS FOUND THE CURSOR IS POSITIONED AT THAT FIELD AND AN         *06100062
061100* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *06110062
061200*----------------------------------------------------------------*06120062
061300 3000-EDIT-DATA-IN-COMMAREA.                                      06130062
061400                                                                  06140062
061500     PERFORM 3200-RESET-ATTRIBUTES.                               06150062
061600*                                                                 06160062
061700     SET PS-NO-PRINTER-ID-ERROR TO TRUE.                          06170062
061800     IF (DP020-LOCATION-TYPE = PE049-DISTRB-CNTR-LOC-TYP-CDE OR   06180062
061900         DP020-LOCATION-TYPE = PE049-CENT-STK-LOC-TYP-CDE OR      06190062
062000         DP020-LOCATION-TYPE = PE049-RET-TO-VND-LOC-TYP-CDE)      06200062
062100         IF  ASC-PRINTER-ID = SPACE                               06210062
062200             SET PS-ERROR                                         06220062
062300                 DP020-MSG-FATAL                                  06230062
062400                 DP030-SET-CURSOR-APPL-1                          06240062
062500                 PS-PRINTER-ID-ERROR TO TRUE                      06250062
062600             MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER          06260062
062700*   REQUIRED FIELD                                                06270062
062800             MOVE DP015-UNP-ALP-BRT-OFF                           06280062
062900                                     TO APRTIDA                   06290062
063000             MOVE DP015-RED          TO APRTIDC                   06300062
063100             MOVE DP015-REVERSE      TO APRTIDH                   06310062
063200             MOVE -1                 TO APRTIDL                   06320062
063300         END-IF                                                   06330062
063400     END-IF.                                                      06340062
063500*                                                                 06350062
063600     IF  ASC-DEPT-AREA-TEXT = SPACE                               06360062
063700         SET PS-ERROR                                             06370062
063800             DP020-MSG-FATAL                                      06380062
063900             DP030-SET-CURSOR-APPL-1 TO TRUE                      06390062
064000         MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER          06400062
064100*   REQUIRED FIELD                                                06410062
064200         MOVE DP015-UNP-ALP-BRT-OFF  TO ADPTARA                   06420062
064300         MOVE DP015-RED              TO ADPTARC                   06430062
064400         MOVE DP015-REVERSE          TO ADPTARH                   06440062
064500         MOVE -1                     TO ADPTARL                   06450062
064600     END-IF.                                                      06460062
064700*                                                                 06470062
064800     IF  ASC-PAGES-TO-PRINT > SPACE                               06480062
064900         MOVE ASC-PAGES-TO-PRINT     TO DP010I-UNEDITED-FIELD     06490062
065000         MOVE LENGTH OF ASC-PAGES-TO-PRINT                        06500062
065100                                     TO DP010I-MAXIMUM-DIGITS     06510062
065200         MOVE ZERO                   TO DP010I-MAXIMUM-DECIMALS   06520062
065300         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  06530062
065410         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06541064
065420                         USING DP010I-NUMERIC-EDIT-AREA           06542064
065500         IF DP010I-ERROR-DETECTED                                 06550062
065600             SET PS-ERROR                                         06560062
065700                 DP020-MSG-FATAL                                  06570062
065800                 DP030-SET-CURSOR-APPL-1 TO TRUE                  06580062
065900             MOVE PC-TSYMSG-00008    TO DP020-MSG-NUMBER          06590062
066000*   MUST BE NUMERIC                                               06600062
066100             MOVE DP015-UNP-ALP-BRT-OFF                           06610062
066200                                     TO APAGEA                    06620062
066300             MOVE DP015-RED          TO APAGEC                    06630062
066400             MOVE DP015-REVERSE      TO APAGEH                    06640062
066500             MOVE -1                 TO APAGEL                    06650062
066600         ELSE                                                     06660062
066700             MOVE DP010I-NUMERIC-FIELD                            06670062
066800                                     TO ASC-PAGES-TO-PRINT-N      06680062
066900             IF  ASC-PAGES-TO-PRINT-N = 1                         06690062
067000                 CONTINUE                                         06700062
067100             ELSE                                                 06710062
067200                 IF  ASC-PAGES-TO-PRINT-N = 0                     06720062
067300                     MOVE PC-PAGE-DEFAULT                         06730062
067400                                     TO ASC-PAGES-TO-PRINT-N      06740062
067500                 ELSE                                             06750062
067600                     MOVE PE048-INSTR-PAGES-PER-DOC-NBR           06760062
067700                                     TO PV-CONTROL-NUMBER         06770062
067800                     PERFORM 7000-GET-CONTROL-AMT                 06780062
067900                     MOVE PPCCTL-PARM-AMT TO                      06790062
068000                                     PE048-INSTR-PAGES-PER-DOC-AMT06800062
068100                     IF ASC-PAGES-TO-PRINT-N <=                   06810062
068200                                     PE048-INSTR-PAGES-PER-DOC-AMT06820062
068300                         CONTINUE                                 06830062
068400                     ELSE                                         06840062
068500                         COMPUTE PV-PAGES-OVER-MAX =              06850062
068600                             (ASC-PAGES-TO-PRINT-N -              06860062
068700                              PE048-INSTR-PAGES-PER-DOC-AMT)      06870062
068800                         SET PS-ERROR                             06880062
068900                             DP020-MSG-FATAL                      06890062
069000                             DP030-SET-CURSOR-APPL-1 TO TRUE      06900062
069100                         MOVE PV-PAGES-OVER-MAX                   06910062
069200                                     TO DP020-MSG-TEXT            06920062
069300                         MOVE PC-TSYMSG-00505                     06930062
069400                                     TO DP020-MSG-NUMBER          06940062
069500*   NUMBER OF PAGES OVER THE MAX PAGES PER DOCUMENT               06950062
069600                         MOVE DP015-UNP-ALP-BRT-OFF               06960062
069700                                     TO APAGEA                    06970062
069800                         MOVE DP015-RED                           06980062
069900                                     TO APAGEC                    06990062
070000                         MOVE DP015-REVERSE                       07000062
070100                                     TO APAGEH                    07010062
070200                         MOVE -1     TO APAGEL                    07020062
070300                     END-IF                                       07030062
070400                 END-IF                                           07040062
070500             END-IF                                               07050062
070600         END-IF                                                   07060062
070700     ELSE                                                         07070062
070800         MOVE PC-PAGE-DEFAULT        TO ASC-PAGES-TO-PRINT-N      07080062
070900     END-IF.                                                      07090062
071000*                                                                 07100062
071100     IF  ASC-REASON-CODE > SPACE                                  07110062
071200         MOVE ASC-REASON-CODE        TO DP010I-UNEDITED-FIELD     07120062
071300         MOVE LENGTH OF ASC-REASON-CODE                           07130062
071400                                     TO DP010I-MAXIMUM-DIGITS     07140062
071500         MOVE ZERO                   TO DP010I-MAXIMUM-DECIMALS   07150062
071600         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  07160062
071710         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07171064
071720                         USING DP010I-NUMERIC-EDIT-AREA           07172064
071800         IF DP010I-ERROR-DETECTED                                 07180062
071900             SET PS-ERROR                                         07190062
072000                 DP020-MSG-FATAL                                  07200062
072100                 DP030-SET-CURSOR-APPL-1 TO TRUE                  07210062
072200             MOVE PC-TSYMSG-00008    TO DP020-MSG-NUMBER          07220062
072300*   MUST BE NUMERIC                                               07230062
072400             MOVE DP015-UNP-ALP-BRT-OFF                           07240062
072500                                     TO ARSNA                     07250062
072600             MOVE DP015-RED          TO ARSNC                     07260062
072700             MOVE DP015-REVERSE      TO ARSNH                     07270062
072800             MOVE -1                 TO ARSNL                     07280062
072900         ELSE                                                     07290062
073000             MOVE DP010I-NUMERIC-FIELD                            07300062
073100                                     TO ASC-REASON-CODE-N         07310062
073200             PERFORM  5300-GET-REASON-DESC                        07320062
073300         END-IF                                                   07330062
073400     ELSE                                                         07340062
073500         MOVE ZEROS                  TO PV-TYPE-REASON-CODE       07350062
073600         MOVE SPACES                 TO ASC-REASON-DESC           07360062
073700                                        ASC-TYPE-DESC             07370062
073800     END-IF.                                                      07380062
073900*                                                                 07390062
074000     IF  PS-NO-ERROR                                              07400062
074100         MOVE -1                   TO ARSNL                       07410062
074200         SET DP030-SET-CURSOR-APPL-1                              07420062
074300                                   TO TRUE                        07430062
074400     END-IF.                                                      07440062
074500*                                                                 07450062
074600 EJECT                                                            07460062
074700*----------------------------------------------------------------*07470062
074800* RESET THE ATTRIBUTES ON THE ENTERABLE FIELDS.                  *07480062
074900*----------------------------------------------------------------*07490062
075000 3200-RESET-ATTRIBUTES.                                           07500062
075100                                                                  07510062
075200     MOVE DP015-UNP-NUM-NOR-OFF    TO ARSNA                       07520062
075300                                      APAGEA.                     07530062
075400     MOVE DP015-UNP-ALP-NOR-OFF    TO ADPTARA.                    07540062
075500     MOVE DP015-GREEN              TO ARSNC                       07550062
075600                                      APAGEC                      07560062
075700                                      ADPTARC.                    07570062
075800     MOVE DP015-UNDERLINE          TO ARSNH                       07580062
075900                                      APAGEH                      07590062
076000                                      ADPTARH.                    07600062
076100     IF ASC-NON-STORE-TERMINAL                                    07610062
076200         MOVE DP015-GREEN            TO APRTIDC                   07620062
076300         MOVE DP015-UNDERLINE        TO APRTIDH                   07630062
076400         MOVE DP015-UNP-ALP-NOR-MDT  TO APRTIDA                   07640062
076500     ELSE                                                         07650062
076600         MOVE DP015-BLUE             TO APRTIDC                   07660062
076700         MOVE DP015-HL-OFF           TO APRTIDH                   07670062
076800         MOVE DP015-PRO-BRT-OFF      TO APRTIDA                   07680062
076900     END-IF.                                                      07690062
077000*                                                                 07700062
077100 EJECT                                                            07710062
077200*----------------------------------------------------------------*07720062
077300* POSITION THE CURSOR FOR THE INITIAL PAGE.                      *07730062
077400*----------------------------------------------------------------*07740062
077500 4000-BUILD-INITIAL-PANEL.                                        07750062
077600                                                                  07760062
077700     SET DP030-SET-CURSOR-APPL-1                                  07770062
077800         ASC-STORE-TERMINAL        TO TRUE.                       07780062
077900     MOVE PC-PAGE-DEFAULT          TO ASC-PAGES-TO-PRINT.         07790062
078000     MOVE -1                       TO ARSNL.                      07800062
078100*                                                                 07810062
078200     IF (DP020-LOCATION-TYPE = PE049-HQ-LOC-TYP-CDE OR            07820062
078300         DP020-LOCATION-TYPE = PE049-DISTRB-CNTR-LOC-TYP-CDE OR   07830062
078400         DP020-LOCATION-TYPE = PE049-CENT-STK-LOC-TYP-CDE OR      07840062
078500         DP020-LOCATION-TYPE = PE049-RET-TO-VND-LOC-TYP-CDE)      07850062
078600         MOVE SPACES               TO ASC-PRINTER-ID              07860062
078700         SET ASC-NON-STORE-TERMINAL TO TRUE                       07870062
078800     END-IF.                                                      07880062
078900*                                                                 07890062
079000 EJECT                                                            07900062
079100*----------------------------------------------------------------*07910062
079200* PERFORM THE PROCESSING TO UPDATE THE IN-STORE DOCUMENT NBR     *07920062
079300*                                                                *07930062
079400* RETRIEVE THE IN STORE DOCUMENT NUMBER TABLE TSPCNBR            *07940062
079500*                                                                *07950062
079600* GET THE NEXT AVAILABLE IN-STORE DOCUMENT NUMBER.  THE IN STORE *07960062
079700* DOCUMENTS WILL RANGE FROM 1000000 TO 7999999.                  *07970062
079800*                                                                *07980062
079900* UPDATE THE ROW ON TSPCNBR TABLE.                               *07990062
080000*----------------------------------------------------------------*08000062
080100 4100-UPD-PROCESSING.                                             08010062
080200                                                                  08020062
080300     PERFORM 4110-OPEN-DOC-CURSOR.                                08030062
080400                                                                  08040062
080500     PERFORM 4120-FETCH-UPD-DOC.                                  08050062
080600                                                                  08060062
080700     PERFORM 4130-CLOSE-DOC-CURSOR.                               08070062
080800                                                                  08080062
080900 EJECT                                                            08090062
081000*----------------------------------------------------------------*08100062
081100* OPENS THE DOC_UPD_CSR CURSOR                                   *08110062
081200*----------------------------------------------------------------*08120062
081300 4110-OPEN-DOC-CURSOR.                                            08130062
081400                                                                  08140062
081500     EXEC SQL                                                     08150062
081600         OPEN DOC_UPD_CSR                                         08160062
081700     END-EXEC.                                                    08170062
081800                                                                  08180062
081900     EVALUATE TRUE                                                08190062
082000         WHEN SQLCODE = 0                                         08200062
082100             CONTINUE                                             08210062
082200                                                                  08220062
082300         WHEN OTHER                                               08230062
082400             MOVE '4110-OPEN-DOC-CURSOR'                          08240062
082500                                     TO DP013-PARAGRAPH           08250062
082600             MOVE 'FAILED OPENING CURSOR'                         08260062
082700                                     TO DP013-MESSAGE-TEXT (1)    08270062
082800             MOVE SQLCA              TO DP013-SQLCA               08280062
082900             MOVE 'TSPCNBR'          TO DP013-DB2-TABLE-NAME (1)  08290062
083000             SET DP013-DB2-ABEND                                  08300062
083100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               08310062
083200             PERFORM DP013-0000-PROCESS-ABEND                     08320062
083300     END-EVALUATE.                                                08330062
083400                                                                  08340062
083500*----------------------------------------------------------------*08350062
083600* READS A ROW FROM THE DOC_UPD_CSR AND UPDATES IT                *08360062
083700*----------------------------------------------------------------*08370062
083800 4120-FETCH-UPD-DOC.                                              08380062
083900                                                                  08390062
084000     EXEC SQL                                                     08400062
084100        FETCH DOC_UPD_CSR                                         08410062
084200         INTO :SPCNBR-STR-NEXT-DOC-NBR                            08420062
084300     END-EXEC.                                                    08430062
084400                                                                  08440062
084500     EVALUATE TRUE                                                08450062
084600         WHEN SQLCODE = 0                                         08460062
084700             MOVE SPCNBR-STR-NEXT-DOC-NBR                         08470062
084800                                     TO ASC-DOCUMENT-NUMBER-N     08480062
084900                                        DK-DOCUMENT-NUMBER        08490062
085000             IF SPCNBR-STR-NEXT-DOC-NBR = +7999999                08500062
085100                 MOVE +1000000       TO SPCNBR-STR-NEXT-DOC-NBR   08510062
085200             ELSE                                                 08520062
085300                 ADD +1              TO SPCNBR-STR-NEXT-DOC-NBR   08530062
085400             END-IF                                               08540062
085500*                                                                 08550062
085600             EXEC SQL                                             08560062
085700                 UPDATE TSPCNBR                                   08570062
085800                     SET STR_NEXT_DOC_NBR =                       08580062
085900                                       :SPCNBR-STR-NEXT-DOC-NBR   08590062
086000                  WHERE CURRENT OF DOC_UPD_CSR                    08600062
086100             END-EXEC                                             08610062
086200*                                                                 08620062
086300             EVALUATE TRUE                                        08630062
086400               WHEN SQLCODE = 0                                   08640062
086500                 CONTINUE                                         08650062
086600                                                                  08660062
086700               WHEN OTHER                                         08670062
086800                 MOVE '4120-FETCH-UPD-DOC'                        08680062
086900                                     TO DP013-PARAGRAPH           08690062
087000                 MOVE 'FAILED TO UPDATE DOCUMENT NBR'             08700062
087100                                     TO DP013-MESSAGE-TEXT (1)    08710062
087200                 MOVE SPCNBR-STR-NEXT-DOC-NBR                     08720062
087300                                     TO DP013-MESSAGE-TEXT (2)    08730062
087400                 MOVE SQLCA          TO DP013-SQLCA               08740062
087500                 MOVE 'TSPCNBR'      TO DP013-DB2-TABLE-NAME (1)  08750062
087600                 SET DP013-DB2-ABEND                              08760062
087700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           08770062
087800                 PERFORM DP013-0000-PROCESS-ABEND                 08780062
087900             END-EVALUATE                                         08790062
088000                                                                  08800062
088100     WHEN OTHER                                                   08810062
088200         MOVE '4120-FETCH-UPD-DOC'   TO DP013-PARAGRAPH           08820062
088300         MOVE 'FAILED FETCHING CURSOR'                            08830062
088400                                     TO DP013-MESSAGE-TEXT (1)    08840062
088500         MOVE 'TSPCNBR'              TO DP013-DB2-TABLE-NAME (1)  08850062
088600         MOVE SQLCA                  TO DP013-SQLCA               08860062
088700         SET DP013-DB2-ABEND                                      08870062
088800             DP013-XCTL-DISPLAY-RESTART TO TRUE                   08880062
088900         PERFORM DP013-0000-PROCESS-ABEND                         08890062
089000                                                                  08900062
089100     END-EVALUATE.                                                08910062
089200                                                                  08920062
089300*----------------------------------------------------------------*08930062
089400* CLOSES THE DOC_UPD_CSR CURSOR                                  *08940062
089500*----------------------------------------------------------------*08950062
089600 4130-CLOSE-DOC-CURSOR.                                           08960062
089700                                                                  08970062
089800     EXEC SQL                                                     08980062
089900         CLOSE DOC_UPD_CSR                                        08990062
090000     END-EXEC.                                                    09000062
090100                                                                  09010062
090200     EVALUATE TRUE                                                09020062
090300         WHEN SQLCODE = 0                                         09030062
090400             CONTINUE                                             09040062
090500                                                                  09050062
090600         WHEN OTHER                                               09060062
090700             MOVE '4130-CLOSE-DOC-CURSOR'                         09070062
090800                                     TO DP013-PARAGRAPH           09080062
090900             MOVE 'FAILED CLOSING CURSOR'                         09090062
091000                                     TO DP013-MESSAGE-TEXT (1)    09100062
091100             MOVE SQLCA              TO DP013-SQLCA               09110062
091200             MOVE 'TSPCNBR'          TO DP013-DB2-TABLE-NAME (1)  09120062
091300             SET DP013-DB2-ABEND                                  09130062
091400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09140062
091500             PERFORM DP013-0000-PROCESS-ABEND                     09150062
091600     END-EVALUATE.                                                09160062
091700                                                                  09170062
091800*----------------------------------------------------------------*09180062
091900*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *09190062
092000*----------------------------------------------------------------*09200062
092100 4400-MOVE-COMMAREA-TO-SCREEN.                                    09210062
092200                                                                  09220062
092300     MOVE ASC-STORE-NUMBER           TO ASTRNO.                   09230062
092400     MOVE ASC-STORE-NAME             TO ASTRNMO.                  09240062
092500     MOVE PC-PENDING                 TO ADOCNO.                   09250062
092600     MOVE ASC-REASON-CODE            TO ARSNO.                    09260062
092700     MOVE ASC-TYPE-DESC              TO ATYPDO.                   09270062
092800     MOVE ASC-REASON-DESC            TO ARSNDO.                   09280062
092900     MOVE ASC-PAGES-TO-PRINT         TO APAGEO.                   09290062
093000     MOVE ASC-DEPT-AREA-TEXT         TO ADPTARO.                  09300062
093100     MOVE ASC-PRINTER-ID             TO APRTIDO.                  09310062
093200     IF PS-NO-PRINTER-ID-ERROR                                    09320062
093300         IF ASC-NON-STORE-TERMINAL                                09330062
093400             MOVE DP015-GREEN        TO APRTIDC                   09340062
093500             MOVE DP015-UNDERLINE    TO APRTIDH                   09350062
093600             MOVE DP015-UNP-ALP-NOR-MDT                           09360062
093700                                     TO APRTIDA                   09370062
093800         ELSE                                                     09380062
093900             MOVE DP015-BLUE         TO APRTIDC                   09390062
094000             MOVE DP015-HL-OFF       TO APRTIDH                   09400062
094100             MOVE DP015-PRO-BRT-OFF  TO APRTIDA                   09410062
094200         END-IF                                                   09420062
094300     END-IF.                                                      09430062
094400*                                                                 09440062
094500 EJECT                                                            09450062
094600*----------------------------------------------------------------*09460062
094700* ADD THE IN STORE DOCUMENT NUMBER TO THE TSTRPPC TABLE.         *09470062
094800*----------------------------------------------------------------*09480062
094900 5000-ADD-IN-STR-DOCUMENT.                                        09490062
095000                                                                  09500062
095100     MOVE ASC-STORE-NUMBER-N         TO DK-STORE-NUMBER.          09510062
095200     MOVE DK-STORE-NUMBER            TO STRPPC-DEST-LOC-NBR.      09520062
095300     MOVE DK-DOCUMENT-NUMBER         TO STRPPC-DOC-NBR.           09530062
095400     MOVE PE049-STORE-DOC-TYPE-CDE   TO STRPPC-DOC-TYP-CDE.       09540062
095500     MOVE PV-REASON-CODE             TO STRPPC-RSN-CDE.           09550062
095600     MOVE PV-TYPE-CODE               TO STRPPC-TYP-CDE.           09560062
095700*                                                                 09570062
095800 EJECT                                                            09580062
095900*-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=*09590062
096000*-  LOGIC TO DETERMINE IF THE DOCUMENT IS DELINQUENT WAS REMOVED *09600062
096100*----------------------------------------------------------------*09610062
096200* DETERMINE IF STATUS OF DOCUMENT HEADER IS DELINQUENT AND SET   *09620062
096300* STATUS ACCORDINGLY.                                            *09630062
096400*----------------------------------------------------------------*09640062
096500     MOVE PE049-IS-AVAILABLE-STATUS-CDE                           09650062
096600                                     TO STRPPC-STATUS-CDE.        09660062
096700*-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=*09670062
096800                                                                  09680062
096900     MOVE ASC-DEPT-AREA-TEXT         TO STRPPC-DEPT-AREA-DEST.    09690062
097000     MOVE DK-ORIGIN                  TO STRPPC-ORGN-LOC-NBR.      09700062
097100     MOVE DK-CURRENT-DATE            TO STRPPC-CRE-DTE.           09710062
097200     MOVE DK-USERID                  TO STRPPC-CRE-ID.            09720062
097300     MOVE PE049-DEFAULT-DATE         TO STRPPC-EFF-DTE            09730062
097400                                        STRPPC-CAN-DTE            09740062
097500                                        STRPPC-ENTR-DTE           09750062
097600                                        STRPPC-MGMT-APPRVL-DTE    09760062
097700                                        STRPPC-REJ-DTE            09770062
097800                                        STRPPC-CPL-DTE.           09780062
097900     MOVE SPACES                     TO STRPPC-PR-CHG-CPL-NAME    09790062
098000                                        STRPPC-PREV-STATUS-CDE    09800062
098100                                        STRPPC-CAN-ID             09810062
098200                                        STRPPC-ENTR-ID            09820062
098300                                        STRPPC-MGMT-APPRVL-ID     09830062
098400                                        STRPPC-MGMT-APPRVL-NAME   09840062
098500                                        STRPPC-REJ-ID.            09850062
098600     MOVE '00:00:00'                 TO STRPPC-ENTR-TIME          09860062
098700                                        STRPPC-CPL-TIME.          09870062
098800     MOVE ZERO                       TO STRPPC-TOT-ACT-PR-CHG-AMT.09880062
098900     MOVE ASC-PAGES-TO-PRINT-N       TO STRPPC-PGS-TO-PRT-NBR.    09890062
099000                                                                  09900062
099100     PERFORM 5200-INSERT-IN-STR-DOC-HDR.                          09910062
099200                                                                  09920062
099300     PERFORM 5400-PRINT-DOCUMENT.                                 09930062
099400*                                                                 09940062
099500 EJECT                                                            09950062
099600*----------------------------------------------------------------*09960062
099700* INSERT A ROW INTO THE TSTRPPC TABLE.                           *09970062
099800*----------------------------------------------------------------*09980062
099900 5200-INSERT-IN-STR-DOC-HDR.                                      09990062
100000                                                                  10000062
100100     PERFORM                                                      10010062
100200         WITH TEST AFTER                                          10020062
100300         VARYING PV-RETRY-COUNTER                                 10030062
100400         FROM 1 BY 1                                              10040062
100500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10050062
100600                   OR (SQLCODE = ZERO))                           10060062
100700         EXEC SQL                                                 10070062
100800             INSERT INTO TSTRPPC                                  10080062
100900                (DEST_LOC_NBR,                                    10090062
101000                 DOC_NBR,                                         10100062
101100                 DOC_TYP_CDE,                                     10110062
101200                 EFF_DTE,                                         10120062
101300                 PR_CHG_CPL_NAME,                                 10130062
101400                 RSN_CDE,                                         10140062
101500                 TYP_CDE,                                         10150062
101600                 STATUS_CDE,                                      10160062
101700                 PREV_STATUS_CDE,                                 10170062
101800                 DEPT_AREA_DEST,                                  10180062
101900                 ORGN_LOC_NBR,                                    10190062
102000                 CRE_DTE,                                         10200062
102100                 CRE_ID,                                          10210062
102200                 CAN_DTE,                                         10220062
102300                 CAN_ID,                                          10230062
102400                 ENTR_DTE,                                        10240062
102500                 ENTR_TIME,                                       10250062
102600                 ENTR_ID,                                         10260062
102700                 MGMT_APPRVL_DTE,                                 10270062
102800                 MGMT_APPRVL_ID,                                  10280062
102900                 MGMT_APPRVL_NAME,                                10290062
103000                 REJ_DTE,                                         10300062
103100                 REJ_ID,                                          10310062
103200                 CPL_DTE,                                         10320062
103300                 CPL_TIME,                                        10330062
103400                 TOT_ACT_PR_CHG_AMT,                              10340062
103500                 PGS_TO_PRT_NBR)                                  10350062
103600             VALUES                                               10360062
103700                (:STRPPC-DEST-LOC-NBR,                            10370062
103800                 :STRPPC-DOC-NBR,                                 10380062
103900                 :STRPPC-DOC-TYP-CDE,                             10390062
104000                 :STRPPC-EFF-DTE,                                 10400062
104100                 :STRPPC-PR-CHG-CPL-NAME,                         10410062
104200                 :STRPPC-RSN-CDE,                                 10420062
104300                 :STRPPC-TYP-CDE,                                 10430062
104400                 :STRPPC-STATUS-CDE,                              10440062
104500                 :STRPPC-PREV-STATUS-CDE,                         10450062
104600                 :STRPPC-DEPT-AREA-DEST,                          10460062
104700                 :STRPPC-ORGN-LOC-NBR,                            10470062
104800                 :STRPPC-CRE-DTE,                                 10480062
104900                 :STRPPC-CRE-ID,                                  10490062
105000                 :STRPPC-CAN-DTE,                                 10500062
105100                 :STRPPC-CAN-ID,                                  10510062
105200                 :STRPPC-ENTR-DTE,                                10520062
105300                 :STRPPC-ENTR-TIME,                               10530062
105400                 :STRPPC-ENTR-ID,                                 10540062
105500                 :STRPPC-MGMT-APPRVL-DTE,                         10550062
105600                 :STRPPC-MGMT-APPRVL-ID,                          10560062
105700                 :STRPPC-MGMT-APPRVL-NAME,                        10570062
105800                 :STRPPC-REJ-DTE,                                 10580062
105900                 :STRPPC-REJ-ID,                                  10590062
106000                 :STRPPC-CPL-DTE,                                 10600062
106100                 :STRPPC-CPL-TIME,                                10610062
106200                 :STRPPC-TOT-ACT-PR-CHG-AMT,                      10620062
106300                 :STRPPC-PGS-TO-PRT-NBR)                          10630062
106400         END-EXEC                                                 10640062
106500                                                                  10650062
106600         EVALUATE TRUE                                            10660062
106700             WHEN SQLCODE = ZERO                                  10670062
106800             WHEN SQLCODE = -904                                  10680062
106900             WHEN SQLCODE = -913                                  10690062
107000                 CONTINUE                                         10700062
107100             WHEN SQLWARN0 NOT = SPACES                           10710062
107200             WHEN SQLCODE < ZERO                                  10720062
107300             WHEN SQLCODE > ZERO                                  10730062
107400                 MOVE '5200-INSERT-IN-STR-DOC-HDR'                10740062
107500                                     TO DP013-PARAGRAPH           10750062
107600                 MOVE 'INSERT A ROW INTO THE DOCUMENT HDR TABLE'  10760062
107700                                     TO DP013-MESSAGE-TEXT(1)     10770062
107800                 MOVE SQLCA          TO DP013-SQLCA               10780062
107900                 MOVE 'TSTRPPC'      TO DP013-DB2-TABLE-NAME (1)  10790062
108000                 SET DP013-DB2-ABEND                              10800062
108100                     DP013-XCTL-DISPLAY-RESTART                   10810062
108200                                     TO TRUE                      10820062
108300                 PERFORM DP013-0000-PROCESS-ABEND                 10830062
108400         END-EVALUATE                                             10840062
108500     END-PERFORM.                                                 10850062
108600*                                                                 10860062
108700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10870062
108800         MOVE '5200-INSERT-IN-STR-DOC-HDR'                        10880062
108900                                     TO DP013-PARAGRAPH           10890062
109000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO INSERT A NEW10900062
109100-             ' STORE DOC HDR'       TO DP013-MESSAGE-TEXT (1)    10910062
109200         MOVE SQLCA                  TO DP013-SQLCA               10920062
109300         MOVE 'TSTRPPC'              TO DP013-DB2-TABLE-NAME (1)  10930062
109400         SET DP013-DB2-ABEND                                      10940062
109500             DP013-XCTL-DISPLAY-RESTART                           10950062
109600                                     TO TRUE                      10960062
109700         PERFORM DP013-0000-PROCESS-ABEND                         10970062
109800     END-IF.                                                      10980062
109900*                                                                 10990062
110000 EJECT                                                            11000062
110100*----------------------------------------------------------------*11010062
110200*  DETERMINE THE TYPE AND REASON DESCRIPTION FOR THE REASON CODE *11020062
110300*  ENTERED.                                                      *11030062
110400*----------------------------------------------------------------*11040062
110500 5300-GET-REASON-DESC.                                            11050062
110600                                                                  11060062
110700     MOVE PE049-INSTR-RSN-VALUE-TABLE                             11070062
110800                                     TO PE049-INSTR-RSN-TABLE.    11080062
110900     SET PS-VALID-TYPE-CDE                                        11090062
111000         PS-VALID-RSN-CDE            TO TRUE.                     11100062
111100     MOVE ASC-REASON-CODE-N          TO PV-TYPE-REASON-CODE.      11110062
111200     MOVE PV-TYPE-CODE               TO PE049-WORKING-TYPE-CDE.   11120062
111300     IF PE049-VALID-TYPE-CDE                                      11130062
111400         SET PS-VALID-TYPE-CDE       TO TRUE                      11140062
111500     ELSE                                                         11150062
111600         SET PS-INVALID-TYPE-CDE     TO TRUE                      11160062
111700         SET PS-ERROR                                             11170062
111800             DP020-MSG-FATAL                                      11180062
111900             DP030-SET-CURSOR-APPL-1 TO TRUE                      11190062
112000* TYPE CODE INVALID                                               11200062
112100         MOVE PC-TSYMSG-00527        TO DP020-MSG-NUMBER          11210062
112200         MOVE SPACES                 TO ASC-TYPE-DESC             11220062
112300         MOVE DP015-UNP-ALP-BRT-OFF  TO ARSNA                     11230062
112400         MOVE DP015-RED              TO ARSNC                     11240062
112500         MOVE DP015-REVERSE          TO ARSNH                     11250062
112600         MOVE -1                     TO ARSNL                     11260062
112700     END-IF.                                                      11270062
112800                                                                  11280062
112900     MOVE PV-REASON-CODE             TO                           11290062
113000                                     PE049-WORKING-INSTR-RSN-CDE. 11300062
113100     IF PE049-IS-VALID-CREATE-RSN                                 11310062
113200         SET PS-VALID-RSN-CDE        TO TRUE                      11320062
113300     ELSE                                                         11330062
113400         SET PS-INVALID-RSN-CDE      TO TRUE                      11340062
113500         SET PS-ERROR                                             11350062
113600             DP020-MSG-FATAL                                      11360062
113700             DP030-SET-CURSOR-APPL-1 TO TRUE                      11370062
113800* REASON CODE INVALID                                             11380062
113900         MOVE PC-TSYMSG-00022        TO DP020-MSG-NUMBER          11390062
114000         MOVE SPACES                 TO ASC-REASON-DESC           11400062
114100         MOVE DP015-UNP-ALP-BRT-OFF  TO ARSNA                     11410062
114200         MOVE DP015-RED              TO ARSNC                     11420062
114300         MOVE DP015-REVERSE          TO ARSNH                     11430062
114400         MOVE -1                     TO ARSNL                     11440062
114500     END-IF.                                                      11450062
114600                                                                  11460062
114700     IF (PS-VALID-TYPE-CDE                                        11470062
114800     AND PS-VALID-RSN-CDE)                                        11480062
114900         IF PE049-MARKDOWN AND                                    11490062
115000            PE049-IS-INVENTORY-MISSED-RSN                         11500062
115100             SET PS-INVALID-RSN-CDE                               11510062
115200                 PS-INVALID-TYPE-CDE                              11520062
115300                 DP020-MSG-FATAL                                  11530062
115400                 DP030-SET-CURSOR-APPL-1                          11540062
115500                 PS-ERROR            TO TRUE                      11550062
115600* INVENTORY DOCUMENTS CANNOT BE ADDED OR CANCELLED                11560062
115700             MOVE PC-TSYMSG-00975    TO DP020-MSG-NUMBER          11570062
115800             MOVE SPACES             TO ASC-REASON-DESC           11580062
115900             MOVE DP015-UNP-ALP-BRT-OFF                           11590062
116000                                     TO ARSNA                     11600062
116100             MOVE DP015-RED          TO ARSNC                     11610062
116200             MOVE DP015-REVERSE      TO ARSNH                     11620062
116300             MOVE -1                 TO ARSNL                     11630062
116400         END-IF                                                   11640062
116500     END-IF.                                                      11650062
116600                                                                  11660062
116700     IF (PS-VALID-RSN-CDE                                         11670062
116800     AND PS-VALID-TYPE-CDE)                                       11680062
116900         SET PE049-TYPE-IDX                                       11690062
117000             PE049-RSN-IDX  TO 1                                  11700062
117100         SEARCH PE049-TYPE-CODE-TABLE                             11710062
117200             AT END                                               11720062
117300                 SET PS-INVALID-TYPE-CDE TO TRUE                  11730062
117400                 SET PS-ERROR                                     11740062
117500                     DP020-MSG-FATAL                              11750062
117600                     DP030-SET-CURSOR-APPL-1 TO TRUE              11760062
117700* TYPE CODE INVALID                                               11770062
117800                 MOVE PC-TSYMSG-00527                             11780062
117900                                     TO DP020-MSG-NUMBER          11790062
118000                 MOVE SPACES         TO ASC-TYPE-DESC             11800062
118100                 MOVE DP015-UNP-ALP-BRT-OFF                       11810062
118200                                     TO ARSNA                     11820062
118300                 MOVE DP015-RED      TO ARSNC                     11830062
118400                 MOVE DP015-REVERSE  TO ARSNH                     11840062
118500                 MOVE -1             TO ARSNL                     11850062
118600             WHEN PE049-TYPE-CODE (PE049-TYPE-IDX) =              11860062
118700                                     PV-TYPE-CODE                 11870062
118800                 SET PS-VALID-TYPE-CDE TO TRUE                    11880062
118900                 MOVE PV-TYPE-CODE   TO PE049-WORKING-TYPE-CDE    11890062
119000                 EVALUATE TRUE                                    11900062
119100                     WHEN PE049-MARKDOWN                          11910062
119200                         MOVE PE049-SHORT-MKDN-DESC1              11920062
119300                                     TO ASC-TYPE-DESC             11930062
119400                     WHEN PE049-MARKUP                            11940062
119500                         MOVE PE049-SHORT-MKUP-DESC1              11950062
119600                                     TO ASC-TYPE-DESC             11960062
119700                     WHEN PE049-MARKDOWN-CANCEL                   11970062
119800                         MOVE PE049-SHORT-MKDN-CANCEL-DESC        11980062
119900                                     TO ASC-TYPE-DESC             11990062
120000                     WHEN PE049-MARKUP-CANCEL                     12000062
120100                         MOVE PE049-SHORT-MKUP-CANCEL-DESC        12010062
120200                                     TO ASC-TYPE-DESC             12020062
120300                     WHEN OTHER                                   12030062
120400                         MOVE SPACES TO ASC-TYPE-DESC             12040062
120500                 END-EVALUATE                                     12050062
120600         END-SEARCH                                               12060062
120700                                                                  12070062
120800         IF PS-VALID-TYPE-CDE                                     12080062
120900             SEARCH PE049-REASON-CODE-TABLE                       12090062
121000                 AT END                                           12100062
121100                     SET PS-INVALID-RSN-CDE TO TRUE               12110062
121200                     SET PS-ERROR                                 12120062
121300                         DP020-MSG-FATAL                          12130062
121400                         DP030-SET-CURSOR-APPL-1                  12140062
121500                                     TO TRUE                      12150062
121600* REASON CODE INVALID                                             12160062
121700                     MOVE PC-TSYMSG-00022                         12170062
121800                                     TO DP020-MSG-NUMBER          12180062
121900                     MOVE SPACES     TO ASC-REASON-DESC           12190062
122000                     MOVE DP015-UNP-ALP-BRT-OFF                   12200062
122100                                     TO ARSNA                     12210062
122200                     MOVE DP015-RED  TO ARSNC                     12220062
122300                     MOVE DP015-REVERSE                           12230062
122400                                     TO ARSNH                     12240062
122500                     MOVE -1         TO ARSNL                     12250062
122600                 WHEN PE049-REASON-CODE                           12260062
122700                             (PE049-TYPE-IDX PE049-RSN-IDX)       12270062
122800                                       = PV-REASON-CODE           12280062
122900                     SET PS-VALID-RSN-CDE TO TRUE                 12290062
123000                     MOVE PV-REASON-CODE  TO                      12300062
123100                                       PE049-WORKING-INSTR-RSN-CDE12310062
123200                     EVALUATE TRUE                                12320062
123300                         WHEN PE049-IS-ZERO-OUT-RSN               12330062
123400                             MOVE PE049-IS-SHORT-ZERO-OUT-DESC    12340062
123500                                     TO ASC-REASON-DESC           12350062
123600                         WHEN PE049-IS-CORRECTION-RSN             12360062
123700                             MOVE PE049-IS-SHORT-CORRECTION-DESC  12370062
123800                                     TO ASC-REASON-DESC           12380062
123900                         WHEN PE049-IS-BUYER-GEN-MISSED-RSN       12390062
124000                             MOVE PE049-IS-SHORT-BYR-MISSED-DESC  12400062
124100                                     TO ASC-REASON-DESC           12410062
124200                         WHEN PE049-IS-CUSTOMER-RET-RSN           12420062
124300                             MOVE PE049-IS-SHORT-CUST-RET-DESC    12430062
124400                                     TO ASC-REASON-DESC           12440062
124500                         WHEN PE049-IS-KNOWN-THEFT-RSN            12450062
124600                             MOVE PE049-IS-SHORT-THEFT-DESC       12460062
124700                                     TO ASC-REASON-DESC           12470062
124800                         WHEN PE049-IS-INSTR-DAMAGE-RSN           12480062
124900                             MOVE PE049-IS-SHORT-INSTR-DMG-DESC   12490062
125000                                     TO ASC-REASON-DESC           12500062
125100                         WHEN PE049-IS-COSMETICS-TESTER-RSN       12510062
125200                             MOVE PE049-IS-SHORT-CSMTCS-TST-DESC  12520062
125300                                     TO ASC-REASON-DESC           12530062
125400                         WHEN PE049-IS-MOS-SALVAGE-RSN            12540062
125500                             MOVE PE049-IS-SHORT-MOS-SALVAGE      12550062
125600                                     TO ASC-REASON-DESC           12560062
125700                         WHEN PE049-IS-FINANCIAL-ADJ-RSN          12570062
125800                             MOVE PE049-IS-SHORT-FIN-ADJ-DESC     12580062
125900                                     TO ASC-REASON-DESC           12590062
126000                         WHEN OTHER                               12600062
126100                             MOVE SPACES                          12610062
126200                                     TO ASC-REASON-DESC           12620062
126300                     END-EVALUATE                                 12630062
126400             END-SEARCH                                           12640062
126500         END-IF                                                   12650062
126600     END-IF.                                                      12660062
126700                                                                  12670062
126800*                                                                 12680062
126900 EJECT                                                            12690062
127000*----------------------------------------------------------------*12700062
127100*    START PROGRAM PEKCS008 TO PRINT THE IN-STORE DOCUMENT AT    *12710062
127200*    THE SPECIFIED LOCATION.                                      12720062
127300*----------------------------------------------------------------*12730062
127400 5400-PRINT-DOCUMENT.                                             12740062
127500                                                                  12750062
127600     MOVE DP020-LOCATION-TYPE        TO PE056-PRINT-AT-LOC-TYPE.  12760062
127700     IF DP020-LOCATION-TYPE = PE049-HQ-LOC-TYP-CDE                12770062
127800         MOVE PC-LOC-HEADQUARTERS    TO                           12780062
127900                                     PE056-PRINT-AT-STORE-NUMBER  12790062
128000     ELSE                                                         12800062
128100         MOVE ASC-STORE-NUMBER-N     TO                           12810062
128200                                     PE056-PRINT-AT-STORE-NUMBER  12820062
128300     END-IF.                                                      12830062
128400     MOVE ASC-STORE-NUMBER-N         TO                           12840062
128500                                     PE056-PRINT-FOR-STORE-NUMBER.12850062
128600     SET PE056-INSTR-PRINT           TO TRUE.                     12860062
128700     MOVE ASC-PAGES-TO-PRINT-N       TO PE056-MAX-PAGES-TO-PRINT. 12870062
128800     MOVE ASC-DOCUMENT-NUMBER-N      TO                           12880062
128900                                     PE056-PRINT-DOCUMENT-NUMBER. 12890062
129000     MOVE SPACES                     TO PE056-PRINT-TRANID.       12900062
129100     MOVE ZEROS                      TO PE056-PRINT-TASK          12910062
129200                                        PE056-PRINT-SEQ.          12920062
129300     MOVE ASC-PRINTER-ID             TO PE056-PRINTER-ID.         12930062
129400     EXEC CICS                                                    12940062
129500         START                                                    12950062
129600         TRANSID(PC-PRINT-TRANSID)                                12960062
129700         FROM(PE056-SPECIFIC-COMMAREA)                            12970062
129800         LENGTH(PC-PRINT-COMMAREA-LENGTH)                         12980062
129900         RESP(PV-CICS-RESPONSE)                                   12990062
130000     END-EXEC.                                                    13000062
130100                                                                  13010062
130200     EVALUATE TRUE                                                13020062
130300         WHEN PV-CICS-RESPONSE = DFHRESP(NORMAL)                  13030062
130400             CONTINUE                                             13040062
130500         WHEN OTHER                                               13050062
130600             SET DP013-NO-ROLLBACK                                13060062
130700                 DP013-XCTL-DISPLAY-RESTART                       13070062
130800                 DP013-LOGIC-ABEND TO TRUE                        13080062
130900             MOVE '5400-PRINT-DOCUMENT'                           13090062
131000                                     TO DP013-PARAGRAPH           13100062
131100             MOVE 'START OF PEKCS008 WAS UNSUCCESSFUL'            13110062
131200                                     TO DP013-MESSAGE-TEXT (1)    13120062
131300             MOVE DP020-PHYSICAL-UNIT-ADDR                        13130062
131400                                     TO DP013-MESSAGE-TEXT (2)    13140062
131500             PERFORM DP013-0000-PROCESS-ABEND                     13150062
131600     END-EVALUATE.                                                13160062
131700*                                                                 13170062
131800 EJECT                                                            13180062
131900*----------------------------------------------------------------*13190062
132000*    GET THE CONTROL AMOUNT ASSOCIATED WITH THE CONTROL NUMBER   *13200062
132100*    BEING PASSED.                                               *13210062
132200*----------------------------------------------------------------*13220062
132300 7000-GET-CONTROL-AMT.                                            13230062
132400                                                                  13240062
132500     PERFORM                                                      13250062
132600         WITH TEST AFTER                                          13260062
132700         VARYING PV-RETRY-COUNTER                                 13270062
132800         FROM 1 BY 1                                              13280062
132900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13290062
133000                   OR (SQLCODE = ZERO))                           13300062
133100*                                                                 13310062
133200         EXEC SQL                                                 13320062
133300             SELECT PARM_AMT                                      13330062
133400             INTO   :PPCCTL-PARM-AMT                              13340062
133500             FROM   TPPCCTL                                       13350062
133600             WHERE (OPERCO_NBR = :DK-OPERATING-COMPANY            13360062
133700               AND  PPCCTL_NBR = :PV-CONTROL-NUMBER)              13370062
133800         END-EXEC                                                 13380062
133900                                                                  13390062
134000         EVALUATE TRUE                                            13400062
134100             WHEN SQLCODE = ZERO                                  13410062
134200             WHEN SQLCODE = -904                                  13420062
134300             WHEN SQLCODE = -913                                  13430062
134400                 CONTINUE                                         13440062
134500             WHEN SQLWARN0 NOT = SPACES                           13450062
134600             WHEN SQLCODE < ZERO                                  13460062
134700             WHEN SQLCODE > ZERO                                  13470062
134800                 MOVE '7000-GET-CONTROL-AMT'                      13480062
134900                                   TO DP013-PARAGRAPH             13490062
135000                 MOVE 'SELECT THE CONTROL AMOUNT'                 13500062
135100                                   TO DP013-MESSAGE-TEXT (1)      13510062
135200                 MOVE SQLCA        TO DP013-SQLCA                 13520062
135300                 MOVE 'TPPCCTL'    TO DP013-DB2-TABLE-NAME (1)    13530062
135400                 SET DP013-DB2-ABEND                              13540062
135500                     DP013-XCTL-DISPLAY-RESTART                   13550062
135600                                   TO TRUE                        13560062
135700                 PERFORM DP013-0000-PROCESS-ABEND                 13570062
135800         END-EVALUATE                                             13580062
135900     END-PERFORM.                                                 13590062
136000*                                                                 13600062
136100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13610062
136200         MOVE '7000-GET-CONTROL-AMT'                              13620062
136300                                   TO DP013-PARAGRAPH             13630062
136400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     13640062
136500                                   TO DP013-MESSAGE-TEXT (1)      13650062
136600         MOVE ' CONTROL NUMBER'    TO DP013-MESSAGE-TEXT (2)      13660062
136700         MOVE SQLCA                TO DP013-SQLCA                 13670062
136800         MOVE 'TPPCCTL'            TO DP013-DB2-TABLE-NAME (1)    13680062
136900         SET DP013-DB2-ABEND                                      13690062
137000             DP013-XCTL-DISPLAY-RESTART                           13700062
137100                                   TO TRUE                        13710062
137200         PERFORM DP013-0000-PROCESS-ABEND                         13720062
137300     END-IF.                                                      13730062
137400*                                                                 13740062
137500 EJECT                                                            13750062
137600*----------------------------------------------------------------*13760062
137700*    ABEND PROCESSOR MODULE                                      *13770062
137800*----------------------------------------------------------------*13780062
137900     COPY DPPD013.                                                13790062
138000*----------------------------------------------------------------*13800062
138100*    DATE TIME MODULE                                            *13810062
138200*----------------------------------------------------------------*13820062
138300     COPY DPPD017.                                                13830062
