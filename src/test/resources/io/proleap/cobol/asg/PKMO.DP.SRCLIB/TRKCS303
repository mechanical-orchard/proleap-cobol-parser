000100*-----------------------*                                         03/19/93
000200 IDENTIFICATION DIVISION.                                         DPKCS040
000300*-----------------------*                                            LV067
000400 PROGRAM-ID.    TRKCS303.                                            CL**1
000500 AUTHOR.        MARGARET MORRISON.                                   CL**1
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                             CL**1
000700 DATE-WRITTEN.  FEBRUARY 1999.                                       CL**1
000800 DATE-COMPILED.                                                      CL**1
000900                                                                     CL**1
001000*---------------------------------------------------------------*    CL**1
001100*    Y303 - IMPORTS BOOKING PO HISTORY                          *    CL**1
001200*                                                               *    CL**1
001210*    THIS PROGRAM DISPLAYS THE BOOKING PO HISTORY OF A SELECTED *         
001300*    PURCHASE ORDER, DELIVERY DATE, AND ORIGIN SHIPPED FROM     *    CL**1
001400*    TYPE.   THE COLUMN THAT WAS CHANGED, DATE & TIME OF CHANGE,*    CL**1
001500*    AND THE BEFORE AND AFTER VALUES OF THE COLUMN ARE          *    CL**1
001600*    DISPLAYED.                                                 *    CL**1
001700*                                                               *    CL**1
001800*---------------------------------------------------------------*    CL**1
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697                 
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263697* MAKING THE CALL DYNAMIC VS STATIC.                                      
263697*---------------------------------------------------------------*         
CICS  * CHANGED  1/16/2023    BY JIM HUNTER      WR: CHG0278495                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
001900                                                                     CL**1
002000 ENVIRONMENT DIVISION.                                               CL**1
002100                                                                     CL**1
002200 DATA DIVISION.                                                      CL**1
002300                                                                     CL**1
002400 WORKING-STORAGE SECTION.                                            CL**1
002500                                                                     CL**1
002501 01  DK-DB2-KEYS.                                                         
002505     15  DK-PO-NBR                      PIC  S9(09) COMP                  
002506                                             VALUE ZERO.                  
002507     15  DK-PO-BKG-SEQ-NBR              PIC  S9(04) COMP                  
002508                                             VALUE ZERO.                  
002509     15  DK-DELY-DTE                    PIC  X(10)  VALUE SPACES.         
002510     15  DK-ORGN-SHPD-FROM-TYP          PIC  X(03)  VALUE SPACES.         
002520                                                                          
002600 01  PC-PROGRAM-CONSTANTS.                                           CL**1
002700     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE            CL**1
002800                                                    'TR303A  '.      CL**2
002900     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE            CL**1
003000                                                    'TRKM303 '.      CL**2
003100     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE            CL**1
003200                                                    'TRKCS303'.      CL**2
003300     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.         CL**1
003400     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.         CL**1
003500     05  PC-DTL-QUEUE-SEQ               PIC  9(01)  VALUE 3.         CL**2
003600     05  PC-BOOKING-PO-FORMAT           PIC  X(01)  VALUE '1'.       CL**1
003700     05  PC-LIST-FORMAT                 PIC  X(01)  VALUE '2'.       CL*41
003800     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +12        CL**2
003900                                                    COMP SYNC.       CL**1
004000     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2         CL**1
004100                                                    COMP SYNC.       CL**1
004200     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE            CL**1
004300                                                    +1000000         CL**1
004400                                                    COMP-3.          CL**1
004500     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5         CL**1
004600                                                    COMP SYNC.       CL**1
004700     05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3         CL**1
004800                                                     COMP-3.         CL**1
004810     05  PC-INIT-DATE                   PIC X(10)    VALUE                
004820                                                   '0001-01-01'.          
004830     05  PC-INIT-TIME                   PIC X(05)    VALUE                
004840                                                   '00.00'.               
004850     05  PC-SLASH                       PIC X(01)    VALUE '/'.           
004860     05  PC-COLON                       PIC X(01)    VALUE ':'.           
004900                                                                     CL**8
005000 01  PC-TSYMSG-NUMBERS.                                              CL**1
005100     05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.     CL**1
005200     05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.     CL**1
005300     05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.     CL**1
005400     05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.     CL**1
005500     05  PC-TSYMSG-00101                PIC 9(5)    VALUE 00101.     CL**1
005600     05  PC-TSYMSG-00148                PIC 9(5)    VALUE 00148.     CL*41
005700     05  PC-TSYMSG-00279                PIC 9(5)    VALUE 00279.     CL*66
005800     05  PC-TSYMSG-00302                PIC 9(5)    VALUE 00302.     CL*41
005900                                                                     CL**8
006000 01  PS-PROGRAM-SUBSCRIPTS.                                          CL**1
006100     05  PS-SUB                         PIC S9(04)   VALUE +0        CL**1
006200                                                     COMP SYNC.      CL**1
006300                                                                     CL**1
006400 01  PS-PROGRAM-SWITCHES.                                            CL**1
006500     05  PS-ERROR-SW                    PIC X(01)    VALUE 'Y'.      CL**1
006600         88  PS-NO-ERROR                             VALUE 'Y'.      CL**1
006700         88  PS-ERROR                                VALUE 'N'.      CL**1
006800     05  PS-COMMAREA-SW                 PIC X(01)    VALUE 'N'.      CL**1
006900         88  PS-COMMAREA-VALID                       VALUE 'Y'.      CL**1
007000         88  PS-COMMAREA-NOT-VALID                   VALUE 'N'.      CL**1
007400                                                                     CL**1
007500 01  PV-PROGRAM-VARIABLES.                                           CL**1
007501     05  PV-RETRY-COUNTER               PIC S9(04)   VALUE +0             
007510                                                     COMP SYNC.           
007600     05  PV-REMAINDER                   PIC S9(04)   VALUE +0        CL**1
007700                                                     COMP SYNC.      CL**1
007800     05  PV-READ-COUNT                  PIC S9(09)   VALUE +0        CL**1
007900                                                     COMP-3.         CL**1
008000     05  PV-TOP-ITEM                    PIC S9(09)   VALUE +0        CL**1
008100                                                     COMP-3.         CL**1
008200     05  PV-BOTTOM-ITEM                 PIC S9(09)   VALUE +0        CL*58
008300                                                     COMP-3.         CL*58
008400     05  PV-BLOCK-NUMBER                PIC S9(04)   VALUE +0        CL**1
008500                                                     COMP SYNC.      CL**1
008600     05  PV-CICS-RESP                   PIC S9(04)   VALUE +0        CL**1
008700                                                     COMP SYNC.      CL**1
008800     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)   VALUE +0        CL**1
008900                                                     COMP SYNC.      CL**1
009000     05  PV-LIST-ITEM-NUMBER            PIC S9(04)   VALUE +0        CL**1
009100                                                     COMP SYNC.      CL**1
009200     05  PV-SQL-SUB                     PIC S9(4)    COMP.           CL**1
009300                                                                     CL*42
009400     05  PV-FORMAT-DATE.                                                  
009500         10  PV-FORMAT-MM               PIC XX.                           
009600         10  PV-FORMAT-SLASH1           PIC X        VALUE '/'.           
009700         10  PV-FORMAT-DD               PIC XX.                           
009710         10  PV-FORMAT-SLASH2           PIC X        VALUE '/'.           
009720         10  PV-FORMAT-YY               PIC XX.                           
009730                                                                          
009740     05  PV-FORMAT-TIME.                                                  
009750         10  PV-FORMAT-HOUR             PIC XX.                           
009760         10  PV-FORMAT-COLON            PIC X        VALUE ':'.           
009770         10  PV-FORMAT-MIN              PIC XX.                           
009771                                                                          
009786     05  PV-TMST.                                                         
009787         10  PV-TMST-DATE.                                                
009788             15  PV-TMST-MM            PIC XX.                            
009789             15  PV-TMST-SLASH1        PIC X        VALUE '/'.            
009790             15  PV-TMST-DD            PIC XX.                            
009791             15  PV-TMST-SLASH2        PIC X        VALUE '/'.            
009792             15  PV-TMST-CCYY          PIC X(04).                         
009793             15  FILLER                PIC X(03).                         
009794         10  PV-TMST-TIME.                                                
009795             15  PV-TMST-HOUR          PIC XX.                            
009796             15  PV-TMST-COLON         PIC X        VALUE ':'.            
009797             15  PV-TMST-MIN           PIC XX.                            
009798             15  FILLER                PIC X(12)    VALUE SPACES.         
009799                                                                          
009802     05  PV-HOLD-TMST-UNFORMAT          PIC X(26)    VALUE SPACES.        
009803                                                                          
009804     05  PV-HOLD-BEFORE-VALUE           PIC X(30)    VALUE SPACES.        
009805     05  PV-HOLD-BEFORE-VALUE-V         PIC Z(08)9.99 VALUE ZERO.         
009806     05  PV-HOLD-BEFORE-VALUE-N         PIC Z(08)9    VALUE ZERO.         
009807     05  PV-HOLD-AFTER-VALUE            PIC X(30)    VALUE SPACES.        
009808     05  PV-HOLD-AFTER-VALUE-V          PIC Z(08)9.99 VALUE ZERO.         
009809     05  PV-HOLD-AFTER-VALUE-N          PIC Z(08)9    VALUE ZERO.         
009810     05  PV-HOLD-FIELD-NAME             PIC X(20)    VALUE SPACES.        
009811     05  PV-EXTL-REF-NBR                PIC X(15)    VALUE SPACES.        
009812                                                                          
009813     05  PV-PREVIOUS-VALUES.                                              
009814         10  PV-PREV-CONSLR-SCAC-ID     PIC X(04)    VALUE SPACES.        
009815         10  PV-PREV-IMPRT-TRIP-ID      PIC X(10)    VALUE SPACES.        
009816         10  PV-PREV-DPRTR-TMST         PIC X(26)    VALUE SPACES.        
009817         10  PV-PREV-POE-DELY-TMST      PIC X(26)    VALUE SPACES.        
009818         10  PV-PREV-CARR-SCAC-ID       PIC X(04)    VALUE SPACES.        
009819         10  PV-PREV-FOB-CDE            PIC X(05)    VALUE SPACES.        
009820         10  PV-PREV-IMPRT-VEH-NM       PIC X(25)    VALUE SPACES.        
009821         10  PV-PREV-TRIP-TYP-CDE       PIC X(01)    VALUE SPACES.        
009822         10  PV-PREV-DEST-POE-CDE       PIC X(04)    VALUE SPACES.        
009823         10  PV-PREV-C-O-PROD-CDE       PIC X(03)    VALUE SPACES.        
009824         10  PV-PREV-PROD-FCTRY-NM      PIC X(35)    VALUE SPACES.        
009825         10  PV-PREV-PO-CART-CNT        PIC S9(09)   VALUE +0             
009826                                                     COMP.                
009827         10  PV-PREV-PO-CBMT-QTY        PIC S9(07)V9(2) VALUE +0          
009828                                                        COMP-3.           
009829         10  PV-PREV-PO-WT-KGRM-QTY     PIC S9(09)   VALUE +0             
009830                                                     COMP.                
009831         10  PV-PREV-PO-UNT-QTY         PIC S9(09)   VALUE +0             
009832                                                     COMP.                
009833         10  PV-PREV-PO-EXC-APVL-CDE    PIC X(02)    VALUE SPACES.        
009834         10  PV-PREV-PO-EXC-APVL-USR-ID PIC X(08)    VALUE SPACES.        
009835         10  PV-PREV-PO-EXC-APVL-TMST   PIC X(26)    VALUE SPACES.        
009836         10  PV-PREV-PO-EXC-RSN-DESC    PIC X(30)    VALUE SPACES.        
009837         10  PV-PREV-EST-LBD-NM         PIC X(30)    VALUE SPACES.        
009838         10  PV-PREV-EST-LBD-TMST       PIC X(26)    VALUE SPACES.        
009839         10  PV-PREV-SHIPT-BKG-TMST     PIC X(26)    VALUE SPACES.        
009840         10  PV-PREV-VOY-CHG-RSN-DESC   PIC X(30)    VALUE SPACES.        
009841         10  PV-PREV-DAT-SRC-ENT-ID     PIC S9(09)   VALUE +0             
009850                                                     COMP.                
009852         10  PV-PREV-LAST-UPD-BY-USR-ID PIC X(08)    VALUE SPACES.        
009853         10  PV-PREV-LAST-UPD-TMST      PIC X(26)    VALUE SPACES.        
009860                                                                          
009900*---------------------------------------------------------------*    CL**1
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          *    CL**1
010100*---------------------------------------------------------------*    CL**1
010200                                                                     CL**1
010300     COPY DPWS030.                                                   CL*67
CICS       COPY DPWS930.                                                   CL*67
010400 EJECT                                                               CL**1
010401*---------------------------------------------------------------*         
010402*    NUMERIC EDIT LAYOUT.                                       *         
010403*---------------------------------------------------------------*         
010404                                                                          
010405     COPY DPWS010I.                                                       
010406                                                                          
010410 EJECT                                                                    
010500*---------------------------------------------------------------*    CL**1
010600*    STANDARD COMMAREA.                                         *    CL**1
010700*---------------------------------------------------------------*    CL**1
010800                                                                     CL**1
010900     COPY DPWS020.                                                   CL**1
011000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                   CL**1
011100                                                                     CL**1
011101*---------------------------------------------------------------* 03000099
011102* INTER-APPLICATION COMMAREA.                                   * 03010099
011103*   TRWS117 - IS THE INPUT LAYOUT WHEN COMING FROM THE BOOKING  * 03020099
011104*             ESTIMATES SCREEN.                                 * 03030099
011109*---------------------------------------------------------------* 03060099
011110                                                                  03070099
011111         10  INTER-APPL-COMM-AREA       PIC X(200).               03080099
011112     COPY TRWS117.                                                03090099
011115                                                                  03110099
011116*---------------------------------------------------------------* 03120099
011117*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03130099
011118*---------------------------------------------------------------* 03140099
011120         10  ASC-SPECIFIC-COMMAREA.                               03150099
012300             15  ASC-LIST-KEYS.                                      CL**1
012600                 20  ASC-KEY-PO-NBR                  PIC S9(09)           
012700                                                         COMP.            
012710                 20  ASC-KEY-PO-BKG-SEQ-NBR          PIC S9(04)      CL**1
012720                                                         COMP.       CL**1
012731                 20  ASC-KEY-DELY-DTE                PIC X(10).           
012732                 20  ASC-KEY-ORGN-SHPD-FROM-TYP      PIC X(03).           
012740                                                                          
012800             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                   CL**1
012810                 20  ASC-ITEM-ARRAY.                                      
013100                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.           CL**2
013102                         30  ASC-LIST-ITEM-NUMBER                         
013103                                                     PIC S9(09)           
013104                                                     COMP-3.              
013105                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).          
013106                             88  ASC-VALID-SELECT    VALUE ' '            
013107                                                           'S'            
013108                                                           'B'            
013109                                                           'E'.           
013110                             88  ASC-TEMP-NO-SELECT  VALUE ' '.           
013111                             88  ASC-TEMP-SELECT     VALUE 'S'.           
013112                             88  ASC-TEMP-BEGIN      VALUE 'B'.           
013113                             88  ASC-TEMP-END        VALUE 'E'.           
013114                         30  ASC-SELECTED-SW         PIC  X(01).          
013115                             88  ASC-NO-SELECT       VALUE ' '.           
013116                             88  ASC-SELECT          VALUE 'S'.           
013117                             88  ASC-BEGIN           VALUE 'B'.           
013118                             88  ASC-END             VALUE 'E'.           
013130                         30  ASC-DATA                PIC  X(20).          
013140                         30  ASC-USERID              PIC  X(08).          
013200                         30  ASC-DATE                PIC  X(08).     CL*11
013400                         30  ASC-TIME                PIC  X(05).     CL*18
013410                         30  ASC-VALUE               PIC  X(30).          
013500                                                                     CL**1
013600             15  ASC-BLK-SUB                         PIC S9(04)      CL**1
013700                                                         COMP        CL**1
013800                                                         SYNC.       CL**1
013900             15  ASC-ITEM-SUB                        PIC S9(04)      CL**1
014000                                                         COMP        CL**1
014100                                                         SYNC.       CL**1
014200             15  ASC-SEL-SUB                         PIC S9(04)      CL*41
014300                                                         COMP.       CL*41
014400             15  ASC-SEL-ITEM                        PIC S9(04)      CL*41
014500                                                         COMP.       CL*41
014600             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)      CL**1
014700                                                         COMP-3.     CL**1
014800             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)      CL**1
014900                                                         COMP-3.     CL**1
015000             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)      CL*41
015100                                                         COMP-3.     CL*41
015200             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)      CL**1
015300                                                         COMP-3.     CL**1
015400             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)      CL**1
015500                                                         COMP-3.     CL**1
015600             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)      CL**1
015700                                                         COMP-3.     CL**1
015800             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)      CL**1
015900                                                         COMP        CL**1
016000                                                         SYNC.       CL**1
016100             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)      CL**1
016200                                                         COMP-3.     CL**1
016300             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)      CL**1
016400                                                         COMP-3.     CL**1
016500             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).     CL**1
016600                 88  ASC-ITEMS-LEFT-ON-DB              VALUE 'Y'.    CL**1
016700                 88  ASC-NO-ITEMS-LEFT-ON-DB           VALUE 'N'.    CL**1
016800             15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).     CL*41
016900                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'.    CL*41
018400             15  ASC-DTL-QUEUE-NAME.                                 CL**2
018500                 20  ASC-DTL-TERM-ID                 PIC  X(04).     CL**2
018600                 20  ASC-DTL-TASK-NUMBER             PIC S9(05)      CL**2
018700                                                         COMP-3.     CL**2
018800                 20  ASC-DTL-SEQ                     PIC  9(01).     CL**2
018900                                                                     CL**1
019000             15  ASC-START-ITEM-REQUEST.                             CL**1
019100                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).     CL**1
019200                                                                     CL**1
019300     EJECT                                                           CL**1
020100*---------------------------------------------------------------*    CL**1
020200*    ABEND PROCESSING COPYBOOK.                                 *    CL**1
020300*---------------------------------------------------------------*    CL**1
020400                                                                     CL**1
020500     COPY DPWS013.                                                   CL**1
020600                                                                     CL**1
020700     EJECT                                                           CL**1
020800*---------------------------------------------------------------*    CL**1
020900*    ATTRIBUTE SETTINGS COPYBOOK.                               *    CL**1
021000*---------------------------------------------------------------*    CL**1
021100                                                                     CL**1
021200     COPY DPWS015.                                                   CL**1
021300                                                                     CL**1
021400*---------------------------------------------------------------*    CL**1
021500*    FUNCTION KEYS COPYBOOK.                                    *    CL**1
021600*---------------------------------------------------------------*    CL**1
021700                                                                     CL**1
021800     COPY DPWS016.                                                   CL**1
021900                                                                     CL**1
022600*---------------------------------------------------------------*    CL**1
022700*    MAP LAYOUT                                                 *    CL**1
022800*---------------------------------------------------------------*    CL**1
022900                                                                     CL**1
023000     COPY TRKM303.                                                   CL**1
023100                                                                     CL**8
023200 01  MR-OCCURS-LAYOUT          REDEFINES  TR303AO.                   CL**1
023310** CHG0094517  CHANGED FILLER LENGTH FROM 95 TO 96                   CL**1
023310     05  FILLER                PIC X(96).                            CL**1
023400     05  MR-SCROLL-AREA OCCURS 12 TIMES.                             CL**1
023500         10  MR-DATAL          PIC S9(04) COMP.                      CL**1
023600         10  MR-DATAA          PIC  X(01).                           CL**1
023700         10  MR-DATAC          PIC  X(01).                           CL**1
023800         10  MR-DATAH          PIC  X(01).                           CL**1
023900         10  MR-DATA           PIC  X(20).                           CL**1
023901                                                                          
023902         10  MR-USERIDL        PIC S9(04) COMP.                      CL**1
023903         10  MR-USERIDA        PIC  X(01).                           CL**1
023904         10  MR-USERIDC        PIC  X(01).                           CL**1
023905         10  MR-USERIDH        PIC  X(01).                           CL**1
023906         10  MR-USERID         PIC  X(08).                           CL**1
023907                                                                          
023910         10  MR-DATEL          PIC S9(04) COMP.                      CL**1
023920         10  MR-DATEA          PIC  X(01).                           CL**1
023930         10  MR-DATEC          PIC  X(01).                           CL**1
023940         10  MR-DATEH          PIC  X(01).                           CL**1
023950         10  MR-DATE           PIC  X(08).                           CL**1
023960                                                                          
023970         10  MR-TIMEL          PIC S9(04) COMP.                      CL**1
023980         10  MR-TIMEA          PIC  X(01).                           CL**1
023990         10  MR-TIMEC          PIC  X(01).                           CL**1
023991         10  MR-TIMEH          PIC  X(01).                           CL**1
023992         10  MR-TIME           PIC  X(05).                           CL**1
024000                                                                     CL**1
024020         10  MR-VALUEL         PIC S9(04) COMP.                      CL**1
024030         10  MR-VALUEA         PIC  X(01).                           CL**1
024040         10  MR-VALUEC         PIC  X(01).                           CL**1
024050         10  MR-VALUEH         PIC  X(01).                           CL**1
024060         10  MR-VALUE          PIC  X(30).                           CL**1
024070                                                                     CL**1
024100 EJECT                                                               CL**1
024200*---------------------------------------------------------------*    CL**1
024300*    DB2 AREA FOR BOOKING PURCHASE ORDER TABLE                  *    CL**1
024400*---------------------------------------------------------------*    CL**1
024500     EXEC SQL                                                        CL**1
024600          INCLUDE TIMBKPO                                            CL**1
024700     END-EXEC.                                                       CL**1
024800*---------------------------------------------------------------*    CL**1
024900*    DB2 AREA FOR BOOKING PURCHASE ORDER AUDIT TABLE            *    CL**1
025000*---------------------------------------------------------------*    CL**1
025100     EXEC SQL                                                        CL**1
025200          INCLUDE TAUBKPO                                            CL**1
025300     END-EXEC.                                                       CL**1
025400*---------------------------------------------------------------*    CL**1
025500*    DB2 AREA FOR COMMUNICATIONS                                *    CL**1
025600*---------------------------------------------------------------*    CL**1
025700     EXEC SQL                                                        CL**1
025800          INCLUDE SQLCA                                              CL**1
025900     END-EXEC.                                                       CL**1
026000                                                                     CL**1
026100*---------------------------------------------------------------*    CL**1
026200*    CURSOR TO OBTAIN BOOKING PO HISTORY INFORMATION            *    CL**1
026300*---------------------------------------------------------------*    CL**1
026400                                                                     CL**1
026500     EXEC SQL                                                        CL**1
026600          DECLARE PO-CSR CURSOR                                      CL**1
026700          FOR SELECT                                                      
027010                A.CONSLR_SCAC_ID                                          
027023              , A.IMPRT_TRIP_ID                                           
027024              , A.DPRTR_TMST                                              
027025              , A.POE_DELY_TMST                                           
027026              , A.CARR_SCAC_ID                                            
027027              , A.FOB_CDE                                                 
027028              , A.IMPRT_VEH_NM                                            
027029              , A.TRIP_TYP_CDE                                            
027030              , A.DEST_POE_CDE                                            
027031              , A.C_O_PROD_CDE                                            
027032              , A.PROD_FCTRY_NM                                           
027033              , A.PO_CART_CNT                                             
027034              , A.PO_CBMT_QTY                                             
027035              , A.PO_WT_KGRM_QTY                                          
027036              , A.PO_UNT_QTY                                              
027037              , A.PO_EXC_APVL_CDE                                         
027038              , A.PO_EXC_APVL_USR_ID                                      
027039              , A.PO_EXC_APVL_TMST                                        
027040              , A.PO_EXC_RSN_DESC                                         
027041              , A.EST_LBD_NM                                              
027042              , A.EST_LBD_TMST                                            
027043              , A.SHIPT_BKG_TMST                                          
027044              , A.VOY_CHG_RSN_DESC                                        
027045              , A.DAT_SRC_ENT_ID                                          
027094              , A.LAST_UPD_BY_USR_ID                                      
027095              , A.LAST_UPD_TMST                                           
027100          FROM                                                       CL**1
027200                TAUBKPO  A                                           CL**1
027300          WHERE                                                      CL**1
027310                A.PO_NBR           = :DK-PO-NBR                           
027330            AND A.PO_BKG_SEQ_NBR   = :DK-PO-BKG-SEQ-NBR                   
027340            AND A.ORGN_SHPD_FR_CDE = :DK-ORGN-SHPD-FROM-TYP               
027361            AND DATE(A.PO_BKG_DELY_TMST) = :DK-DELY-DTE                   
027500          ORDER BY                                                   CL**1
027600                A.LAST_UPD_TMST DESC                                 CL**1
027800     END-EXEC.                                                       CL**1
027900                                                                     CL**1
028000 EJECT                                                               CL**1
028100 LINKAGE SECTION.                                                    CL**1
028200                                                                     CL**1
028300 01  DFHCOMMAREA.                                                    CL**1
028400     05  FILLER                         OCCURS  1 TO 4072 TIMES      CL**1
028500                                        DEPENDING ON EIBCALEN.       CL**1
028600         10  FILLER                     PIC X.                       CL**1
028700                                                                     CL**1
028800 EJECT                                                               CL**1
028900 PROCEDURE DIVISION.                                                 CL**1
029000                                                                     CL**1
029100 0000-MAIN-MODULE.                                                   CL**1
029200                                                                     CL**8
029300     INITIALIZE DP030-CICS-API-FIELDS.                               CL**1
029400     MOVE +1                      TO DP030-NUMBER-OF-MAPS.           CL**1
029500     MOVE PC-CURRENT-MAPSET-NAME  TO DP030-MAPSET-NAME.              CL**1
029600     MOVE PC-CURRENT-MAP-NAME     TO DP030-MAP-NAME (1).             CL**1
029700     SET DP030-RECEIVE-APPL-MAP   TO TRUE.                           CL**1
029800     MOVE LENGTH OF TR303AI       TO DP030-MAP-LENGTH (1).           CL**1
029900     MOVE 'PROGRAM ENTRY CALL'    TO DP013-MESSAGE-TEXT (1).         CL**1
030000     PERFORM 0001-CALL-CICS-ARCH-API.                                CL**1
030100                                                                     CL**8
030200     PERFORM 1000-CONTROL-PROCESSING.                                CL**1
030300                                                                     CL**8
030400     MOVE 'PROGRAM EXIT CALL'     TO DP013-MESSAGE-TEXT (1).         CL**1
030500     PERFORM 0001-CALL-CICS-ARCH-API.                                CL**1
030600                                                                     CL**1
030700*----------------------------------------------------------------*   CL*63
030800*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *   CL*63
030900*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *   CL*63
031000*----------------------------------------------------------------*   CL*63
031100                                                                     CL*63
031200 0001-CALL-CICS-ARCH-API.                                            CL**1
031300                                                                     CL**8
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                         CL**1
031500                                    DFHCOMMAREA                           
031600                                    DP030-CICS-API-FIELDS                 
031700                                    DP020-STANDARD-COMMAREA               
031800                                    TR303AI.                              
031900                                                                     CL**8
032000     IF  DP030-RC-CALL-SUCCESSFUL                                    CL**1
032100         CONTINUE                                                    CL**1
032200     ELSE                                                            CL**1
032300         SET DP013-NO-ROLLBACK TO TRUE                               CL**1
032400         SET DP013-XCTL-DISPLAY-RESTART TO TRUE                      CL**1
032500         SET DP013-CICS-ABEND TO TRUE                                CL**1
032600         MOVE 'BEFORE 0000-MAIN-MODULE' TO DP013-PARAGRAPH           CL**1
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O   CL**1
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)         CL**1
032900         MOVE DP030-RETURN-CODE                                      CL**1
033000                               TO DP013-MESSAGE-TEXT (3)             CL**1
033100         PERFORM DP013-0000-PROCESS-ABEND                            CL**1
033200     END-IF.                                                         CL**1
033300                                                                     CL**8
033400*----------------------------------------------------------------*   CL**1
033500* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *   CL**1
033600* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *   CL**1
033700*                                                                *   CL**1
033800* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *   CL**1
033900*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *   CL**1
034000*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *   CL**1
034100*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *   CL**1
034200*----------------------------------------------------------------*   CL**1
034300                                                                     CL**1
034400 1000-CONTROL-PROCESSING.                                            CL**1
034500                                                                     CL**1
034600     EVALUATE TRUE                                                   CL**1
034700         WHEN DP020-NEXT-ACT-INITIAL                                 CL**1
034800             MOVE EIBTRMID          TO ASC-DTL-TERM-ID               CL**2
034900             MOVE DP020-SRC-TASK-NUMBER                              CL**1
035000                                    TO ASC-DTL-TASK-NUMBER           CL**2
035100             MOVE PC-DTL-QUEUE-SEQ  TO ASC-DTL-SEQ                   CL**2
035200             PERFORM 1100-PROCESS-INTER-APPL-COMM                    CL**1
035300***-----$TEMPLATE NOTE$-------------------------------------------   CL**1
035400*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,   CL**1
035500*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO     CL**1
035600*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.   CL**1
035700***---------------------------------------------------------------   CL**1
035800             IF  PS-COMMAREA-NOT-VALID                               CL**1
035900***              MOVE PC-TSYMSG-99901                                CL**1
036000***                            TO  DP020-MSG-NUMBER                  CL**1
036100***              SET DP020-MSG-FATAL                                 CL**1
036200***                            TO  TRUE                              CL**1
036300                 SET DP020-NEXT-ACT-APPL-ERROR                       CL**1
036400                               TO  TRUE                              CL**1
036500             ELSE                                                    CL**1
036600                 PERFORM 2050-DELETE-DETAIL-QUEUE                    CL*56
036700                 PERFORM 4000-BUILD-INITIAL-PANEL                    CL**1
036800             END-IF                                                  CL**1
036900                                                                     CL**1
037000         WHEN DP020-NEXT-ACT-READ-MAP                                CL**1
037100             MOVE ASC-ITEM-AT-TOP-OF-PANEL                           CL**1
037200                               TO PV-TOP-ITEM                        CL**1
037300             PERFORM 2000-PROCESS-PANEL                              CL**1
037400                                                                     CL**1
037500         WHEN DP020-NEXT-ACT-RETURN                                  CL**1
037600             MOVE ASC-ITEM-AT-TOP-OF-PANEL                           CL**1
037700                               TO PV-TOP-ITEM                        CL**1
037800             MOVE ZERO         TO ASC-ITEM-AT-TOP-OF-PANEL           CL**1
037900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**1
038000                                                                     CL**1
038100         WHEN OTHER                                                  CL**1
038200             SET DP013-LOGIC-ABEND TO TRUE                           CL**1
038300             SET DP013-NO-ROLLBACK TO TRUE                           CL**1
038400             MOVE '1000-CONTROL-PROCESSING'                          CL**1
038500                               TO  DP013-PARAGRAPH                   CL**1
038600             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'       CL**1
038700                               TO  DP013-MESSAGE-TEXT(1)             CL**1
038800             PERFORM DP013-0000-PROCESS-ABEND                        CL**1
038900     END-EVALUATE.                                                   CL**1
039000                                                                     CL**1
039100 EJECT                                                               CL**1
039200*----------------------------------------------------------------*   CL**1
039300* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *   CL**1
039400* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *   CL**1
039500*----------------------------------------------------------------*   CL**1
039600                                                                     CL**1
039700 1100-PROCESS-INTER-APPL-COMM.                                       CL**1
039800                                                                     CL**1
039900     SET PS-COMMAREA-VALID     TO TRUE.                              CL**1
040000     INITIALIZE ASC-SPECIFIC-COMMAREA.                               CL**1
040100     MOVE SPACE                TO ASC-START-ITEM-REQUEST.            CL**1
040110                                                                          
040200     EVALUATE DP020-INT-APPL-FORMAT-IND                                   
040300         WHEN PC-BOOKING-PO-FORMAT                                        
040301             MOVE TR117-PO-NBR         TO ASC-KEY-PO-NBR                  
040303                                          DK-PO-NBR                       
040304             MOVE TR117-PO-SEQ-NBR     TO ASC-KEY-PO-BKG-SEQ-NBR          
040310                                          DK-PO-BKG-SEQ-NBR               
040320             MOVE TR117-DELY-DTE       TO ASC-KEY-DELY-DTE                
040330                                          DK-DELY-DTE                     
040340             MOVE TR117-ORGN-SHPD-FR-TYP TO                               
040341                                      ASC-KEY-ORGN-SHPD-FROM-TYP          
040342                                      DK-ORGN-SHPD-FROM-TYP               
042100         WHEN OTHER                                                       
042500             MOVE PC-TSYMSG-00148  TO DP020-MSG-NUMBER                    
042700             SET DP020-MSG-FATAL   TO TRUE                                
042800             SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                        
043000     END-EVALUATE.                                                        
043100                                                                          
046500*----------------------------------------------------------------*   CL**1
046600*    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED *   CL**1
046700*    ON WHAT FUNCTION KEY WAS SELECTED.                          *   CL**1
046800*----------------------------------------------------------------*   CL**1
046900                                                                     CL**1
047000 2000-PROCESS-PANEL.                                                 CL**1
047100                                                                     CL**8
047200     EVALUATE TRUE                                                   CL**1
047300         WHEN DP020-SRC-AID = DP016-CLEAR                            CL**1
047400             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                   CL**1
047500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**1
047600             PERFORM 3200-RESET-ATTRIBUTES                           CL*44
047700                                                                     CL**1
047800         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                       CL**1
048030             MOVE ASC-KEY-PO-NBR         TO DK-PO-NBR                     
048040             MOVE ASC-KEY-PO-BKG-SEQ-NBR TO DK-PO-BKG-SEQ-NBR             
048050             MOVE ASC-KEY-DELY-DTE       TO DK-DELY-DTE                   
048060             MOVE ASC-KEY-ORGN-SHPD-FROM-TYP TO                           
048070                                         DK-ORGN-SHPD-FROM-TYP            
048100             PERFORM 2050-DELETE-DETAIL-QUEUE                        CL*44
048200             PERFORM 4000-BUILD-INITIAL-PANEL                        CL**1
048300             PERFORM 3200-RESET-ATTRIBUTES                           CL*44
051800                                                                     CL**5
051900         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                     CL*11
052000             MOVE +1 TO PV-TOP-ITEM                                  CL*11
052100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL*11
052200             PERFORM 3200-RESET-ATTRIBUTES                           CL*44
052300                                                                     CL*11
052400         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                      CL*11
052500             PERFORM 2110-BROWSE-BACKWARD                            CL*11
052600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL*11
052700             PERFORM 3200-RESET-ATTRIBUTES                           CL*44
052800                                                                     CL*11
052900         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                      CL*11
053000             PERFORM 2120-BROWSE-FORWARD                             CL*11
053100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL*11
053200             PERFORM 3200-RESET-ATTRIBUTES                           CL*44
053300                                                                     CL*11
053400         WHEN DP020-SRC-AID = DP016-ENTER                            CL*11
053500             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                      CL*11
053600             IF  PS-ERROR                                            CL*11
053700                 CONTINUE                                            CL*11
053800             ELSE                                                    CL*11
053900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                CL*11
054000                 PERFORM 3200-RESET-ATTRIBUTES                       CL*44
054100             END-IF                                                  CL*11
054200                                                                     CL*11
054300         WHEN OTHER                                                  CL*11
054400             SET DP013-NO-ROLLBACK TO TRUE                           CL*11
054500             SET DP013-XCTL-DISPLAY-RESTART TO TRUE                  CL*11
054600             SET DP013-CICS-ABEND TO TRUE                            CL*11
054700             MOVE '2000-PROCESS-PANEL' TO DP013-PARAGRAPH            CL*11
054800             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'         CL*11
054900                                   TO DP013-MESSAGE-TEXT (1)         CL*11
055000             PERFORM DP013-0000-PROCESS-ABEND                        CL*11
055100                                                                     CL*11
055200     END-EVALUATE.                                                   CL*11
055300 EJECT                                                               CL**1
055400*----------------------------------------------------------------*   CL**1
055500*    DELETE THE TEMPORARY STORAGE QUEUE.                         *   CL**1
055600*----------------------------------------------------------------*   CL**1
055700                                                                     CL**1
055800 2050-DELETE-DETAIL-QUEUE.                                           CL**6
055900                                                                     CL**1
056000     EXEC CICS                                                       CL**1
056100         DELETEQ TS                                                  CL**1
056200             QUEUE (ASC-DTL-QUEUE-NAME)                              CL**6
056300             RESP  (PV-CICS-RESP)                                    CL**1
056400     END-EXEC.                                                       CL**1
056500                                                                     CL**1
056600     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                          CL**1
056700        (PV-CICS-RESP = DFHRESP(QIDERR))                             CL**1
056800         CONTINUE                                                    CL**1
056900     ELSE                                                            CL**1
057000         SET DP013-CICS-ABEND TO TRUE                                CL**1
057100         SET DP013-NO-ROLLBACK TO TRUE                               CL**1
057200                                                                     CL**1
057300         MOVE '2050-DELETE-DETAIL-QUEUE' TO DP013-PARAGRAPH          CL**6
057400         MOVE 'ERROR TRYING TO DELETE DETAIL TEMP STORAGE QUEUE'     CL**6
057500                        TO DP013-MESSAGE-TEXT (1)                    CL**1
057600         PERFORM DP013-0000-PROCESS-ABEND                            CL**1
057700     END-IF.                                                         CL**1
057800                                                                     CL**1
057900     MOVE +0 TO ASC-HIGHEST-BLOCK-WRITTEN.                           CL**1
058000 EJECT                                                               CL**1
058100*----------------------------------------------------------------*   CL**1
058200*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *   CL**1
058300*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *   CL**1
058400*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *   CL**1
058500*    MESSAGE.                                                    *   CL**1
058600*----------------------------------------------------------------*   CL**1
058700                                                                     CL**1
058800 2110-BROWSE-BACKWARD.                                               CL**1
058900                                                                     CL**8
059000     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL       CL**1
059100         GIVING PV-TOP-ITEM.                                         CL**1
059200                                                                     CL**8
059300     IF  PV-TOP-ITEM < +1                                            CL**1
059400         MOVE +1              TO PV-TOP-ITEM                         CL**1
059500*        -- TOP OF LIST --                                           CL**1
059600         MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER                    CL**1
059700         SET DP020-MSG-INFORMATIONAL TO TRUE                         CL**1
059800     END-IF.                                                         CL**1
059900                                                                     CL**1
060000 EJECT                                                               CL**1
060100                                                                     CL**8
060200*----------------------------------------------------------------*   CL*58
060300*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *   CL*58
060400*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *   CL*58
060500*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *   CL*58
060600*----------------------------------------------------------------*   CL*58
060700                                                                     CL*58
060800 2120-BROWSE-FORWARD.                                                CL*58
060900                                                                     CL*58
061000     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL                 CL*58
061100         GIVING PV-TOP-ITEM.                                         CL*58
061200     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                      CL*58
061300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                               CL*58
061400                                   TO PV-TOP-ITEM                    CL*58
061500*        -- BOTTOM OF LIST --                                        CL*58
061600         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER               CL*58
061700         SET DP020-MSG-INFORMATIONAL                                 CL*58
061800                                   TO TRUE                           CL*58
061900     ELSE                                                            CL*58
062000         COMPUTE PV-BOTTOM-ITEM =                                    CL*58
062100             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                    CL*58
062200         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ               CL*58
062300*            -- BOTTOM OF LIST --                                    CL*58
062400             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER               CL*58
062500             SET DP020-MSG-INFORMATIONAL                             CL*58
062600                                   TO TRUE                           CL*58
062700         END-IF                                                      CL*58
062800     END-IF.                                                         CL*58
062900 EJECT                                                               CL*58
063000*----------------------------------------------------------------*   CL**1
063100*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *   CL**1
063200*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *   CL**1
063300*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *   CL**1
063400*    RATHER THAN HITTING PF8 TO PAGE FORWARD TO THAT POINT.      *   CL**1
063500*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *   CL**1
063600*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *   CL**1
063700*----------------------------------------------------------------*   CL**1
063800                                                                     CL**1
063900 2130-CHECK-FOR-JUMP-BROWSE.                                         CL*58
064000                                                                     CL*58
064100     IF ASTRTITL > ZERO                                              CL*58
064200         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST         CL*58
064300     ELSE                                                            CL*58
064400         IF ASTRTITF = DP015-ERASE-EOF                               CL*58
064500             INITIALIZE ASC-START-ITEM-REQUEST                       CL*58
064600         END-IF                                                      CL*58
064700     END-IF.                                                         CL*58
064800                                                                     CL*58
064900     SET PS-NO-ERROR               TO TRUE.                          CL*58
065000     IF (ASC-START-ITEM-REQUEST = SPACE)                             CL*58
065100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                               CL*58
065200                                   TO PV-TOP-ITEM                    CL*58
065300     ELSE                                                            CL*58
065400         MOVE ASC-START-ITEM-REQUEST                                 CL*58
065500                                   TO DP010I-UNEDITED-FIELD          CL*58
065600         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS          CL*58
065700         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS        CL*58
065800         SET DP010I-NEGATIVE-NOT-ALLOWED                             CL*58
065900                                   TO TRUE                           CL*58
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263697              USING DP010I-NUMERIC-EDIT-AREA                              
066100                                                                     CL*58
066200         IF  NOT DP010I-ERROR-DETECTED                               CL*58
066300             MOVE DP010I-NUMERIC-FIELD                               CL*58
066400                                   TO  ASC-START-ITEM-REQUEST-N      CL*58
066500             IF  ASC-START-ITEM-REQUEST-N > ZERO                     CL*58
066600                 IF  ASC-START-ITEM-REQUEST-N >                      CL*58
066700                                          ASC-NUMBER-OF-ITEMS-READ   CL*58
066800                     MOVE SPACE TO ASC-START-ITEM-REQUEST            CL*58
066900                     COMPUTE PV-TOP-ITEM =                           CL*58
067000                             ASC-NUMBER-OF-ITEMS-READ                CL*58
067100                             - PC-ITEMS-PER-PANEL + 1                CL*58
067200                     IF  PV-TOP-ITEM < +1                            CL*58
067300                         MOVE +1   TO PV-TOP-ITEM                    CL*58
067400                         MOVE PC-TSYMSG-00070                        CL*58
067500                                   TO DP020-MSG-NUMBER               CL*58
067600                         SET DP020-MSG-INFORMATIONAL                 CL*58
067700                                   TO TRUE                           CL*58
067800                     END-IF                                          CL*58
067900                 ELSE                                                CL*58
068000                     MOVE ASC-START-ITEM-REQUEST-N                   CL*58
068100                                   TO PV-TOP-ITEM                    CL*58
068200                     MOVE SPACE    TO ASC-START-ITEM-REQUEST         CL*58
068300                     COMPUTE PV-BOTTOM-ITEM =                        CL*58
068400                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1        CL*58
068500                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ   CL*58
068600*                        -- BOTTOM OF LIST --                        CL*58
068700                         MOVE PC-TSYMSG-00070                        CL*58
068800                                   TO DP020-MSG-NUMBER               CL*58
068900                         SET DP020-MSG-INFORMATIONAL                 CL*58
069000                                   TO TRUE                           CL*58
069100                     END-IF                                          CL*58
069200                 END-IF                                              CL*58
069300             ELSE                                                    CL*58
069400*                --- VALUE OUT OF RANGE ----                         CL*58
069500                 MOVE PC-TSYMSG-00101                                CL*58
069600                                   TO DP020-MSG-NUMBER               CL*58
069700                 MOVE -1           TO ASTRTITL                       CL*58
069800                 SET DP030-SET-CURSOR-APPL-1                         CL*58
069900                                   TO TRUE                           CL*58
070000                 MOVE DP015-REVERSE                                  CL*58
070100                                   TO ASTRTITH                       CL*58
070200                 MOVE DP015-RED    TO ASTRTITC                       CL*58
070300                 MOVE DP015-UNP-NUM-BRT-MDT                          CL*58
070400                                   TO ASTRTITA                       CL*58
070500                 SET DP020-MSG-FATAL                                 CL*58
070600                                   TO TRUE                           CL*58
070700                 SET PS-ERROR      TO TRUE                           CL*58
070800             END-IF                                                  CL*58
070900                                                                     CL*58
071000         ELSE                                                        CL*58
071100             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER               CL*58
071200             MOVE -1               TO ASTRTITL                       CL*58
071300             SET DP030-SET-CURSOR-APPL-1 TO TRUE                     CL*58
071400             MOVE DP015-REVERSE    TO ASTRTITH                       CL*58
071500             MOVE DP015-RED        TO ASTRTITC                       CL*58
071600             MOVE DP015-UNP-NUM-BRT-MDT                              CL*58
071700                                   TO ASTRTITA                       CL*58
071800             SET DP020-MSG-FATAL   TO TRUE                           CL*58
071900             SET PS-ERROR          TO TRUE                           CL*58
072000         END-IF                                                      CL*58
072100     END-IF.                                                         CL*58
072300                                                                     CL**1
072620*----------------------------------------------------------------*   CL**1
072700*    RESET THE MAP FIELD ATTRIBUTES.                             *   CL**1
072900*----------------------------------------------------------------*   CL**1
078900 3200-RESET-ATTRIBUTES.                                              CL**1
079000                                                                     CL**8
079100     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                      CL**1
079200     MOVE DP015-GREEN              TO ASTRTITC.                      CL**1
079300     MOVE DP015-UNDERLINE          TO ASTRTITH.                      CL**1
079400     MOVE -1                       TO ASTRTITL.                      CL*62
079500     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                          CL*62
079600                                                                     CL**8
079900*----------------------------------------------------------------*   CL**1
080000*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *   CL**1
080100*    INITIALIZE ALL COUNTERS AND FLAGS.                          *   CL**1
080200*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *   CL**1
080300*    DISPLAY THE PANEL TO USER.                                  *   CL**1
080400*----------------------------------------------------------------*   CL**1
080500                                                                     CL**1
080600 4000-BUILD-INITIAL-PANEL.                                           CL**1
080700                                                                     CL**1
080800     INITIALIZE                  ASC-BLOCK-ENTRIES (1)               CL**1
080900                                 ASC-BLOCK-ENTRIES (2).              CL**1
081000     MOVE +1                 TO  ASC-BLK-SUB.                        CL**1
081100     SET ASC-ITEMS-LEFT-ON-DB                                        CL**1
081200                             TO  TRUE.                               CL**1
081300                                                                     CL**1
081400     MOVE +0                 TO  ASC-ITEM-SUB                        CL**1
081500                                 ASC-NUMBER-OF-ITEMS-READ            CL**1
081600                                 ASC-NUMBER-OF-SELECTED-ITEMS        CL**1
081700                                 ASC-HIGHEST-BLOCK-WRITTEN           CL**1
081800                                 ASC-START-OF-SELECTED-RANGE         CL**1
081900                                 ASC-END-OF-SELECTED-RANGE           CL**1
082000                                 ASC-ITEM-AT-TOP-OF-PANEL.           CL**1
082100                                                                     CL**1
082410     PERFORM 4030-SELECT-TIMBKPO.                                         
082420                                                                          
082430     PERFORM 4040-MOVE-TIMBKPO-TO-HOLD.                                   
082440                                                                          
082500     PERFORM 4010-OPEN-CURSOR.                                       CL**1
082600                                                                     CL**1
082700     PERFORM 4300-READ-ITEMS-FROM-DB.                                CL**1
082800                                                                     CL**1
082900     PERFORM 4020-CLOSE-CURSOR.                                      CL**1
083000                                                                     CL**1
083100     MOVE +1                 TO  PV-TOP-ITEM.                        CL**1
083200     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                             CL**1
083300         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                       CL**1
083400         SET DP020-MSG-FATAL   TO  TRUE                              CL**1
083410*--------NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED---           
083500         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER                  CL**1
083600     ELSE                                                            CL**1
083700         MOVE -1             TO ASTRTITL                             CL**1
083800         SET DP030-SET-CURSOR-APPL-1 TO TRUE                         CL**1
083900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                        CL**1
084000     END-IF.                                                         CL**1
084100 EJECT                                                               CL**1
084200*----------------------------------------------------------------*   CL**1
084300* OPEN THE PO CURSOR.                                            *   CL*12
084400*----------------------------------------------------------------*   CL**1
084500                                                                     CL**1
084600 4010-OPEN-CURSOR.                                                   CL**1
084700                                                                     CL**1
084800     EXEC SQL                                                        CL*64
084900          OPEN PO-CSR                                                CL*64
085000     END-EXEC.                                                       CL*64
085100                                                                     CL*64
085200     EVALUATE TRUE                                                   CL*64
085300         WHEN SQLCODE = ZERO                                         CL*64
085400              CONTINUE                                               CL*64
085500         WHEN SQLWARN0 NOT EQUAL SPACE                               CL*64
085600         WHEN SQLCODE NOT EQUAL ZERO                                 CL*64
085700              MOVE '4010-OPEN-CURSOR'                                CL*64
085800                           TO  DP013-PARAGRAPH                       CL*64
085900              MOVE 'OPEN PO CURSOR'                                  CL*64
086000                           TO  DP013-MESSAGE-TEXT (1)                CL*64
086100              MOVE SQLCA   TO  DP013-SQLCA                           CL*64
086200              SET DP013-DB2-ABEND                                    CL*64
086300                           TO  TRUE                                  CL*64
086400              PERFORM DP013-0000-PROCESS-ABEND                       CL*64
086500     END-EVALUATE.                                                   CL*64
086600                                                                     CL**1
086700 EJECT                                                               CL**1
086800*----------------------------------------------------------------*   CL**1
086900* CLOSE THE PO CURSOR.                                           *   CL*12
087000*----------------------------------------------------------------*   CL**1
087100                                                                     CL**1
087200 4020-CLOSE-CURSOR.                                                  CL**1
087300                                                                     CL**1
087400     EXEC SQL                                                        CL*64
087500         CLOSE PO-CSR                                                CL*64
087600     END-EXEC.                                                       CL*64
087700                                                                     CL*64
087800     EVALUATE TRUE                                                   CL*64
087900         WHEN SQLCODE = ZERO                                         CL*64
088000              CONTINUE                                               CL*64
088100         WHEN SQLWARN0 NOT EQUAL SPACE                               CL*64
088200         WHEN SQLCODE NOT EQUAL ZERO                                 CL*64
088300              MOVE '4020-CLOSE-CURSOR'                               CL*64
088400                           TO  DP013-PARAGRAPH                       CL*64
088500              MOVE 'CLOSE PO CURSOR'                                 CL*64
088600                           TO  DP013-MESSAGE-TEXT (1)                CL*64
088700              MOVE SQLCA   TO  DP013-SQLCA                           CL*64
088800              SET DP013-DB2-ABEND                                    CL*64
088900                           TO  TRUE                                  CL*64
089000              PERFORM DP013-0000-PROCESS-ABEND                       CL*64
089100     END-EVALUATE.                                                   CL*64
089200                                                                     CL**1
089300 EJECT                                                               CL**1
089302*----------------------------------------------------------------*   CL**1
089305* SELECT A ROW FROM THE BOOKING PURCHASE ORDER TABLE (TIMBKPO).  *        
089307*----------------------------------------------------------------*   CL**1
089308 4030-SELECT-TIMBKPO.                                                     
089309                                                                          
089310     MOVE SPACES TO PV-EXTL-REF-NBR.                                      
089311                                                                          
089312     PERFORM                                                              
089313         WITH TEST AFTER                                                  
089314         VARYING PV-RETRY-COUNTER FROM 1 BY 1                             
089315         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR                    
089316                 SQLCODE = ZERO                     OR                    
089317                 SQLCODE = +100                                           
089318                                                                          
089319         EXEC SQL                                                         
089320             SELECT CONSLR_SCAC_ID                                        
089326                   ,IMPRT_TRIP_ID                                         
089327                   ,DPRTR_TMST                                            
089328                   ,POE_DELY_TMST                                         
089329                   ,CARR_SCAC_ID                                          
089330                   ,FOB_CDE                                               
089331                   ,IMPRT_VEH_NM                                          
089332                   ,TRIP_TYP_CDE                                          
089333                   ,DEST_POE_CDE                                          
089334                   ,C_O_PROD_CDE                                          
089335                   ,PROD_FCTRY_NM                                         
089336                   ,PO_CART_CNT                                           
089337                   ,PO_CBMT_QTY                                           
089338                   ,PO_WT_KGRM_QTY                                        
089339                   ,PO_UNT_QTY                                            
089340                   ,PO_EXC_APVL_CDE                                       
089341                   ,PO_EXC_APVL_USR_ID                                    
089342                   ,PO_EXC_APVL_TMST                                      
089343                   ,PO_EXC_RSN_DESC                                       
089344                   ,EST_LBD_NM                                            
089345                   ,EST_LBD_TMST                                          
089346                   ,SHIPT_BKG_TMST                                        
089347                   ,VOY_CHG_RSN_DESC                                      
089348                   ,DAT_SRC_ENT_ID                                        
089351                   ,LAST_UPD_BY_USR_ID                                    
089352                   ,LAST_UPD_TMST                                         
089353                   ,EXTL_REF_NBR                                          
089403              INTO :IMBKPO-CONSLR-SCAC-ID,                                
089411                   :IMBKPO-IMPRT-TRIP-ID,                                 
089412                   :IMBKPO-DPRTR-TMST,                                    
089413                   :IMBKPO-POE-DELY-TMST,                                 
089414                   :IMBKPO-CARR-SCAC-ID,                                  
089415                   :IMBKPO-FOB-CDE,                                       
089416                   :IMBKPO-IMPRT-VEH-NM,                                  
089417                   :IMBKPO-TRIP-TYP-CDE,                                  
089418                   :IMBKPO-DEST-POE-CDE,                                  
089419                   :IMBKPO-C-O-PROD-CDE,                                  
089420                   :IMBKPO-PROD-FCTRY-NM,                                 
089421                   :IMBKPO-PO-CART-CNT,                                   
089422                   :IMBKPO-PO-CBMT-QTY,                                   
089423                   :IMBKPO-PO-WT-KGRM-QTY,                                
089424                   :IMBKPO-PO-UNT-QTY,                                    
089425                   :IMBKPO-PO-EXC-APVL-CDE,                               
089426                   :IMBKPO-PO-EXC-APVL-USR-ID,                            
089427                   :IMBKPO-PO-EXC-APVL-TMST,                              
089428                   :IMBKPO-PO-EXC-RSN-DESC,                               
089429                   :IMBKPO-EST-LBD-NM,                                    
089430                   :IMBKPO-EST-LBD-TMST,                                  
089431                   :IMBKPO-SHIPT-BKG-TMST,                                
089432                   :IMBKPO-VOY-CHG-RSN-DESC,                              
089433                   :IMBKPO-DAT-SRC-ENT-ID,                                
089436                   :IMBKPO-LAST-UPD-BY-USR-ID,                            
089437                   :IMBKPO-LAST-UPD-TMST,                                 
089438                   :PV-EXTL-REF-NBR                                       
089450                                                                          
089451               FROM TIMBKPO                                               
089452              WHERE PO_NBR           = :DK-PO-NBR                         
089453                AND PO_BKG_SEQ_NBR   = :DK-PO-BKG-SEQ-NBR                 
089454                AND ORGN_SHPD_FR_CDE = :DK-ORGN-SHPD-FROM-TYP             
089455                AND DATE(PO_BKG_DELY_TMST) = :DK-DELY-DTE                 
089458         END-EXEC                                                         
089459                                                                          
089460         EVALUATE TRUE                                            00117861
089461             WHEN SQLCODE = -904                                  00118161
089462             WHEN SQLCODE = -913                                  00118261
089463                 CONTINUE                                         00118361
089464             WHEN SQLCODE = ZERO                                  00118461
089465             WHEN SQLCODE = +100                                  00118661
089466                  CONTINUE                                                
089467             WHEN SQLWARN0 NOT = SPACES                           00118861
089468             WHEN SQLCODE < ZERO                                  00118961
089469             WHEN SQLCODE > ZERO                                  00119061
089470                 MOVE '4030-SELECT-TIMBKPO'                       00119161
089471                                   TO DP013-PARAGRAPH             00119261
089472                 MOVE 'SQL ERROR SELECTING BOOKING PO'            00119361
089473                                   TO DP013-MESSAGE-TEXT (1)      00119461
089474                 MOVE SQLCA        TO DP013-SQLCA                 00119561
089475                 MOVE 'TIMBKPO '   TO DP013-DB2-TABLE-NAME (1)    00119661
089476                 SET DP013-DB2-ABEND                              00119761
089477                     DP013-XCTL-DISPLAY-RESTART TO TRUE           00119861
089478                 PERFORM DP013-0000-PROCESS-ABEND                 00119961
089479         END-EVALUATE                                             00120061
089480     END-PERFORM.                                                 00120161
089481*                                                                 00120261
089482     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        00120361
089483         MOVE '4030-SELECT-TIMBKPO'                               00120461
089484                                   TO DP013-PARAGRAPH             00120561
089485         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  00120661
089486                                   TO DP013-MESSAGE-TEXT (1)      00120761
089487         MOVE SQLCA                TO DP013-SQLCA                 00120861
089488         MOVE 'TIMBKPO '           TO DP013-DB2-TABLE-NAME (1)    00120961
089489         SET DP013-DB2-ABEND                                      00121061
089490             DP013-XCTL-DISPLAY-RESTART                           00121161
089491                                   TO TRUE                        00121261
089492         PERFORM DP013-0000-PROCESS-ABEND                         00121361
089493     END-IF.                                                      00121461
089494                                                                  00123222
089495 EJECT                                                            00123361
089496*----------------------------------------------------------------*   CL**1
089497* MOVE SELECTED TIMBKPO VALUES TO HOLD FIELDS FOR COMPARISON.    *        
089498*----------------------------------------------------------------*   CL**1
089499 4040-MOVE-TIMBKPO-TO-HOLD.                                               
089500                                                                          
089503     MOVE IMBKPO-CONSLR-SCAC-ID     TO PV-PREV-CONSLR-SCAC-ID.            
089504     MOVE IMBKPO-IMPRT-TRIP-ID      TO PV-PREV-IMPRT-TRIP-ID.             
089505     MOVE IMBKPO-DPRTR-TMST         TO PV-PREV-DPRTR-TMST.                
089506     MOVE IMBKPO-POE-DELY-TMST      TO PV-PREV-POE-DELY-TMST.             
089507     MOVE IMBKPO-CARR-SCAC-ID       TO PV-PREV-CARR-SCAC-ID.              
089508     MOVE IMBKPO-FOB-CDE            TO PV-PREV-FOB-CDE.                   
089509     MOVE IMBKPO-IMPRT-VEH-NM       TO PV-PREV-IMPRT-VEH-NM.              
089510     MOVE IMBKPO-TRIP-TYP-CDE       TO PV-PREV-TRIP-TYP-CDE.              
089511     MOVE IMBKPO-DEST-POE-CDE       TO PV-PREV-DEST-POE-CDE.              
089512     MOVE IMBKPO-C-O-PROD-CDE       TO PV-PREV-C-O-PROD-CDE.              
089513     MOVE IMBKPO-PROD-FCTRY-NM      TO PV-PREV-PROD-FCTRY-NM.             
089514     MOVE IMBKPO-PO-CART-CNT        TO PV-PREV-PO-CART-CNT.               
089515     MOVE IMBKPO-PO-CBMT-QTY        TO PV-PREV-PO-CBMT-QTY.               
089516     MOVE IMBKPO-PO-WT-KGRM-QTY     TO PV-PREV-PO-WT-KGRM-QTY.            
089517     MOVE IMBKPO-PO-UNT-QTY         TO PV-PREV-PO-UNT-QTY.                
089518     MOVE IMBKPO-PO-EXC-APVL-CDE    TO PV-PREV-PO-EXC-APVL-CDE.           
089519     MOVE IMBKPO-PO-EXC-APVL-USR-ID TO PV-PREV-PO-EXC-APVL-USR-ID.        
089520     MOVE IMBKPO-PO-EXC-APVL-TMST   TO PV-PREV-PO-EXC-APVL-TMST.          
089521     MOVE IMBKPO-PO-EXC-RSN-DESC    TO PV-PREV-PO-EXC-RSN-DESC.           
089522     MOVE IMBKPO-EST-LBD-NM         TO PV-PREV-EST-LBD-NM.                
089523     MOVE IMBKPO-EST-LBD-TMST       TO PV-PREV-EST-LBD-TMST.              
089524     MOVE IMBKPO-SHIPT-BKG-TMST     TO PV-PREV-SHIPT-BKG-TMST.            
089525     MOVE IMBKPO-VOY-CHG-RSN-DESC   TO PV-PREV-VOY-CHG-RSN-DESC.          
089526     MOVE IMBKPO-DAT-SRC-ENT-ID     TO PV-PREV-DAT-SRC-ENT-ID.            
089539     MOVE IMBKPO-LAST-UPD-BY-USR-ID TO                                    
089540                                    PV-PREV-LAST-UPD-BY-USR-ID.           
089541     MOVE IMBKPO-LAST-UPD-TMST      TO PV-PREV-LAST-UPD-TMST.             
089542                                                                          
089543*----------------------------------------------------------------*   CL**1
089550*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *   CL**1
089600*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *   CL**1
089700*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *   CL**1
089800*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *   CL**1
089900*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *   CL**1
090000*                                                                *   CL**1
090100*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *   CL**1
090200*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *   CL**1
090300*    UPON INITIALIZATION.                                        *   CL**1
090400*----------------------------------------------------------------*   CL**1
090500                                                                     CL**1
090600 4300-READ-ITEMS-FROM-DB.                                            CL**1
090700                                                                     CL**1
092100     PERFORM                                                         CL**1
092200         VARYING PV-READ-COUNT                                       CL**1
092300         FROM 1 BY 1                                                 CL**1
092400         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                       CL**1
092500            OR (ASC-NO-ITEMS-LEFT-ON-DB))                            CL**1
092600                                                                     CL**1
092700         PERFORM 4310-FETCH                                          CL**1
092800                                                                     CL**1
092900         IF  ASC-ITEMS-LEFT-ON-DB                                    CL**1
093010             PERFORM 4330-CHECK-FOR-CHANGES                               
095700         END-IF                                                      CL**1
095800     END-PERFORM.                                                    CL**1
095900                                                                     CL**1
096000     IF ASC-NUMBER-OF-ITEMS-READ > ZERO                                   
096900         MOVE +1                       TO  ASC-BLK-SUB                    
097000         PERFORM 5100-WRITE-TEMP-STORAGE                                  
097100         ADD +1                        TO  ASC-BLK-SUB                    
097200         PERFORM 5100-WRITE-TEMP-STORAGE                                  
097300                                                                          
097400         MOVE 1                        TO  ASC-BLK-SUB                    
097500                                           PV-BLOCK-NUMBER                
097600         PERFORM 4410-READ-TEMP-STORAGE                                   
097700         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1                     
097800              MOVE 2                    TO  ASC-BLK-SUB                   
097900                                            PV-BLOCK-NUMBER               
098000              PERFORM 4410-READ-TEMP-STORAGE                              
098010         END-IF                                                           
098100     END-IF.                                                              
098200 EJECT                                                                    
098300*----------------------------------------------------------------*   CL**1
098400*    FETCH THE PO CURSOR.                                        *   CL*61
098500*----------------------------------------------------------------*   CL**1
098600                                                                     CL**1
098700 4310-FETCH.                                                         CL**1
098800                                                                     CL**1
098900     PERFORM                                                         CL**1
099000         WITH TEST AFTER                                             CL**1
099100         VARYING PV-SQL-SUB                                          CL**1
099200         FROM 1 BY 1                                                 CL**1
099300         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                CL**1
099400            OR SQLCODE = 0                                           CL**1
099500            OR SQLCODE = +100                                        CL**1
099600                                                                     CL**1
099700         EXEC SQL                                                    CL*15
099800              FETCH PO-CSR                                           CL*15
099900              INTO                                                   CL*15
100240                   :AUBKPO-CONSLR-SCAC-ID,                                
100250                   :AUBKPO-IMPRT-TRIP-ID,                                 
100253                   :AUBKPO-DPRTR-TMST,                                    
100254                   :AUBKPO-POE-DELY-TMST,                                 
100255                   :AUBKPO-CARR-SCAC-ID,                                  
100256                   :AUBKPO-FOB-CDE,                                       
100257                   :AUBKPO-IMPRT-VEH-NM,                                  
100258                   :AUBKPO-TRIP-TYP-CDE,                                  
100259                   :AUBKPO-DEST-POE-CDE,                                  
100260                   :AUBKPO-C-O-PROD-CDE,                                  
100261                   :AUBKPO-PROD-FCTRY-NM,                                 
100262                   :AUBKPO-PO-CART-CNT,                                   
100263                   :AUBKPO-PO-CBMT-QTY,                                   
100264                   :AUBKPO-PO-WT-KGRM-QTY,                                
100265                   :AUBKPO-PO-UNT-QTY,                                    
100266                   :AUBKPO-PO-EXC-APVL-CDE,                               
100267                   :AUBKPO-PO-EXC-APVL-USR-ID,                            
100268                   :AUBKPO-PO-EXC-APVL-TMST,                              
100269                   :AUBKPO-PO-EXC-RSN-DESC,                               
100270                   :AUBKPO-EST-LBD-NM,                                    
100271                   :AUBKPO-EST-LBD-TMST,                                  
100272                   :AUBKPO-SHIPT-BKG-TMST,                                
100273                   :AUBKPO-VOY-CHG-RSN-DESC,                              
100274                   :AUBKPO-DAT-SRC-ENT-ID,                                
100275                   :AUBKPO-LAST-UPD-BY-USR-ID,                            
100276                   :AUBKPO-LAST-UPD-TMST                                  
100300         END-EXEC                                                    CL*15
100400                                                                     CL**1
100500         EVALUATE TRUE                                               CL**1
100600             WHEN SQLCODE = ZERO                                     CL**1
100700             WHEN SQLCODE = +100                                     CL**1
100800             WHEN SQLCODE = -904                                     CL**1
100900             WHEN SQLCODE = -913                                     CL**1
101000                  CONTINUE                                           CL**1
101100             WHEN SQLWARN0 NOT EQUAL SPACE                           CL**1
101200             WHEN SQLCODE NOT EQUAL ZERO                             CL**1
101300                  MOVE '4310-FETCH-CURSOR'                           CL**1
101400                               TO  DP013-PARAGRAPH                   CL**1
101500                  MOVE 'FETCH PO CURSOR'                             CL**1
101600                               TO  DP013-MESSAGE-TEXT (1)            CL**1
101700                  MOVE SQLCA   TO  DP013-SQLCA                       CL**1
101800                  SET DP013-DB2-ABEND                                CL**1
101900                               TO  TRUE                              CL**1
102000                  PERFORM DP013-0000-PROCESS-ABEND                   CL**1
102100         END-EVALUATE                                                CL**1
102200     END-PERFORM.                                                    CL**1
102300                                                                     CL**1
102400     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                      CL**1
102500         MOVE '4310-FETCH-CURSOR'                                    CL**1
102600                               TO  DP013-PARAGRAPH                   CL**1
102700         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'                CL**1
102800                               TO  DP013-MESSAGE-TEXT (1)            CL**1
102900         MOVE SQLCA            TO  DP013-SQLCA                       CL**1
103000         SET DP013-DB2-ABEND   TO  TRUE                              CL**1
103100         PERFORM DP013-0000-PROCESS-ABEND                            CL**1
103200     END-IF.                                                         CL**1
103300                                                                     CL**1
103400     IF  SQLCODE EQUAL +100                                          CL**1
103500         SET ASC-NO-ITEMS-LEFT-ON-DB                                 CL**1
103600                               TO  TRUE                              CL**1
103700     END-IF.                                                         CL**1
103800                                                                     CL**1
103900 EJECT                                                               CL**1
104000*----------------------------------------------------------------*   CL*30
104100*    GET THE CORRECT SUBSCRIPTS FOR PLACING THE TEXT LINE.       *   CL*32
104200*----------------------------------------------------------------*   CL*30
104300                                                                     CL*30
104400 4320-GET-SUB.                                                       CL*30
104500                                                                     CL*30
104600     IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                           CL*30
104700         ADD +1            TO  ASC-ITEM-SUB                          CL*30
104800     ELSE                                                            CL*30
104900         ADD +1            TO  ASC-BLK-SUB                           CL*30
105000         MOVE +1           TO  ASC-ITEM-SUB                          CL*30
105100                                                                     CL*30
105200         IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                    CL*30
105300             MOVE +1       TO  ASC-BLK-SUB                           CL*30
105400             PERFORM 5100-WRITE-TEMP-STORAGE                         CL*30
105500             MOVE ASC-BLOCK-ENTRIES                                  CL*30
105600                       (PC-MAX-BLOCKS-IN-ARRAY)                      CL*30
105700             TO   ASC-BLOCK-ENTRIES(ASC-BLK-SUB)                     CL*30
105800             ADD +1        TO  ASC-BLK-SUB                           CL*30
105900             INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)              CL*30
106000         END-IF                                                      CL*30
106100     END-IF.                                                         CL*30
106200                                                                     CL*30
106300     ADD +1            TO ASC-NUMBER-OF-ITEMS-READ.                  CL*30
106400     MOVE ASC-NUMBER-OF-ITEMS-READ TO ASC-LIST-ITEM-NUMBER           CL*33
106500                                      (ASC-BLK-SUB                   CL*33
106600                                       ASC-ITEM-SUB).                CL*50
106610                                                                     CL*33
106620*----------------------------------------------------------------*   CL*30
106630*    COMPARE THE PREVIOUS VALUES TO THE CURRENT TAUBKPO VALUES   *   CL*32
106631*    TO SEE WHAT CHANGES OCCURRED.                               *        
106640*----------------------------------------------------------------*   CL*30
106650 4330-CHECK-FOR-CHANGES.                                             CL*30
106660                                                                     CL*30
106673     IF AUBKPO-CONSLR-SCAC-ID  NOT EQUAL PV-PREV-CONSLR-SCAC-ID           
106674         MOVE PV-PREV-CONSLR-SCAC-ID    TO PV-HOLD-AFTER-VALUE            
106675         MOVE AUBKPO-CONSLR-SCAC-ID     TO PV-HOLD-BEFORE-VALUE           
106676         MOVE 'CONSOLIDATOR SCAC   '    TO PV-HOLD-FIELD-NAME             
106677         PERFORM 4340-PROCESS-CHANGES                                     
106678     END-IF.                                                              
106679                                                                          
106680     IF AUBKPO-IMPRT-TRIP-ID NOT EQUAL PV-PREV-IMPRT-TRIP-ID              
106681         MOVE PV-PREV-IMPRT-TRIP-ID     TO PV-HOLD-AFTER-VALUE            
106682         MOVE AUBKPO-IMPRT-TRIP-ID      TO PV-HOLD-BEFORE-VALUE           
106683         MOVE 'VOYAGE NUMBER       '    TO PV-HOLD-FIELD-NAME             
106684         PERFORM 4340-PROCESS-CHANGES                                     
106685     END-IF.                                                              
106686                                                                          
106687     IF AUBKPO-DPRTR-TMST NOT EQUAL PV-PREV-DPRTR-TMST                    
106689         MOVE PV-PREV-DPRTR-TMST        TO PV-HOLD-TMST-UNFORMAT          
106690         PERFORM 4350-FORMAT-TMST                                         
106691         MOVE PV-TMST                   TO PV-HOLD-AFTER-VALUE            
106692         MOVE AUBKPO-DPRTR-TMST         TO PV-HOLD-TMST-UNFORMAT          
106693         PERFORM 4350-FORMAT-TMST                                         
106694         MOVE PV-TMST                   TO PV-HOLD-BEFORE-VALUE           
106695         MOVE 'ETD                 '    TO PV-HOLD-FIELD-NAME             
106696         PERFORM 4340-PROCESS-CHANGES                                     
106697     END-IF.                                                              
106698                                                                          
106699     IF AUBKPO-POE-DELY-TMST NOT EQUAL PV-PREV-POE-DELY-TMST              
106700         MOVE PV-PREV-POE-DELY-TMST     TO PV-HOLD-TMST-UNFORMAT          
106701         PERFORM 4350-FORMAT-TMST                                         
106702         MOVE PV-TMST                   TO PV-HOLD-AFTER-VALUE            
106703         MOVE AUBKPO-POE-DELY-TMST      TO PV-HOLD-TMST-UNFORMAT          
106704         PERFORM 4350-FORMAT-TMST                                         
106705         MOVE PV-TMST                   TO PV-HOLD-BEFORE-VALUE           
106706         MOVE 'ETA                 '    TO PV-HOLD-FIELD-NAME             
106707         PERFORM 4340-PROCESS-CHANGES                                     
106708     END-IF.                                                              
106709                                                                          
106710     IF AUBKPO-CARR-SCAC-ID NOT EQUAL PV-PREV-CARR-SCAC-ID                
106711         MOVE PV-PREV-CARR-SCAC-ID      TO PV-HOLD-AFTER-VALUE            
106712         MOVE AUBKPO-CARR-SCAC-ID       TO PV-HOLD-BEFORE-VALUE           
106713         MOVE 'CARRIER SCAC        '    TO PV-HOLD-FIELD-NAME             
106714         PERFORM 4340-PROCESS-CHANGES                                     
106715     END-IF.                                                              
106716                                                                          
106717     IF AUBKPO-FOB-CDE NOT EQUAL PV-PREV-FOB-CDE                          
106718         MOVE PV-PREV-FOB-CDE           TO PV-HOLD-AFTER-VALUE            
106719         MOVE AUBKPO-FOB-CDE            TO PV-HOLD-BEFORE-VALUE           
106720         MOVE 'FOB                 '    TO PV-HOLD-FIELD-NAME             
106721         PERFORM 4340-PROCESS-CHANGES                                     
106722     END-IF.                                                              
106723                                                                          
106724     IF AUBKPO-IMPRT-VEH-NM NOT EQUAL PV-PREV-IMPRT-VEH-NM                
106725         MOVE PV-PREV-IMPRT-VEH-NM      TO PV-HOLD-AFTER-VALUE            
106726         MOVE AUBKPO-IMPRT-VEH-NM       TO PV-HOLD-BEFORE-VALUE           
106727         MOVE 'VESSEL NAME         '    TO PV-HOLD-FIELD-NAME             
106728         PERFORM 4340-PROCESS-CHANGES                                     
106729     END-IF.                                                              
106730                                                                          
106731     IF AUBKPO-TRIP-TYP-CDE NOT EQUAL PV-PREV-TRIP-TYP-CDE                
106732         MOVE PV-PREV-TRIP-TYP-CDE      TO PV-HOLD-AFTER-VALUE            
106733         MOVE AUBKPO-TRIP-TYP-CDE       TO PV-HOLD-BEFORE-VALUE           
106734         MOVE 'TRIP TYPE           '    TO PV-HOLD-FIELD-NAME             
106735         PERFORM 4340-PROCESS-CHANGES                                     
106736     END-IF.                                                              
106737                                                                          
106738     IF AUBKPO-DEST-POE-CDE NOT EQUAL PV-PREV-DEST-POE-CDE                
106739         MOVE PV-PREV-DEST-POE-CDE      TO PV-HOLD-AFTER-VALUE            
106740         MOVE AUBKPO-DEST-POE-CDE       TO PV-HOLD-BEFORE-VALUE           
106741         MOVE 'POE CDE             '    TO PV-HOLD-FIELD-NAME             
106742         PERFORM 4340-PROCESS-CHANGES                                     
106743     END-IF.                                                              
106744                                                                          
106745     IF AUBKPO-C-O-PROD-CDE NOT EQUAL PV-PREV-C-O-PROD-CDE                
106746         MOVE PV-PREV-C-O-PROD-CDE      TO PV-HOLD-AFTER-VALUE            
106747         MOVE AUBKPO-C-O-PROD-CDE       TO PV-HOLD-BEFORE-VALUE           
106748         MOVE 'COUNTRY OF PROD CDE '    TO PV-HOLD-FIELD-NAME             
106749         PERFORM 4340-PROCESS-CHANGES                                     
106750     END-IF.                                                              
106751                                                                          
106752     IF AUBKPO-PROD-FCTRY-NM NOT EQUAL PV-PREV-PROD-FCTRY-NM              
106753         MOVE PV-PREV-PROD-FCTRY-NM     TO PV-HOLD-AFTER-VALUE            
106754         MOVE AUBKPO-PROD-FCTRY-NM      TO PV-HOLD-BEFORE-VALUE           
106755         MOVE 'FACTORY NM          '    TO PV-HOLD-FIELD-NAME             
106756         PERFORM 4340-PROCESS-CHANGES                                     
106757     END-IF.                                                              
106758                                                                          
106776     IF AUBKPO-PO-CART-CNT NOT EQUAL PV-PREV-PO-CART-CNT                  
106777         MOVE PV-PREV-PO-CART-CNT       TO PV-HOLD-AFTER-VALUE-N          
106778         MOVE PV-HOLD-AFTER-VALUE-N     TO PV-HOLD-AFTER-VALUE            
106779         MOVE AUBKPO-PO-CART-CNT        TO PV-HOLD-BEFORE-VALUE-N         
106780         MOVE PV-HOLD-BEFORE-VALUE-N    TO PV-HOLD-BEFORE-VALUE           
106781         MOVE 'CTN                 '    TO PV-HOLD-FIELD-NAME             
106782         PERFORM 4340-PROCESS-CHANGES                                     
106783     END-IF.                                                              
106784                                                                          
106785     IF AUBKPO-PO-CBMT-QTY NOT EQUAL PV-PREV-PO-CBMT-QTY                  
106786         MOVE PV-PREV-PO-CBMT-QTY       TO PV-HOLD-AFTER-VALUE-V          
106787         MOVE PV-HOLD-AFTER-VALUE-V     TO PV-HOLD-AFTER-VALUE            
106788         MOVE AUBKPO-PO-CBMT-QTY        TO PV-HOLD-BEFORE-VALUE-V         
106789         MOVE PV-HOLD-BEFORE-VALUE-V    TO PV-HOLD-BEFORE-VALUE           
106790         MOVE 'CBM                 '    TO PV-HOLD-FIELD-NAME             
106791         PERFORM 4340-PROCESS-CHANGES                                     
106792     END-IF.                                                              
106793                                                                          
106794     IF AUBKPO-PO-WT-KGRM-QTY NOT EQUAL PV-PREV-PO-WT-KGRM-QTY            
106795         MOVE PV-PREV-PO-WT-KGRM-QTY    TO PV-HOLD-AFTER-VALUE-N          
106796         MOVE PV-HOLD-AFTER-VALUE-N     TO PV-HOLD-AFTER-VALUE            
106797         MOVE AUBKPO-PO-WT-KGRM-QTY     TO PV-HOLD-BEFORE-VALUE-N         
106798         MOVE PV-HOLD-BEFORE-VALUE-N    TO PV-HOLD-BEFORE-VALUE           
106799         MOVE 'KGS                 '    TO PV-HOLD-FIELD-NAME             
106800         PERFORM 4340-PROCESS-CHANGES                                     
106801     END-IF.                                                              
106802                                                                          
106803     IF AUBKPO-PO-UNT-QTY     NOT EQUAL PV-PREV-PO-UNT-QTY                
106804         MOVE PV-PREV-PO-UNT-QTY        TO PV-HOLD-AFTER-VALUE-N          
106805         MOVE PV-HOLD-AFTER-VALUE-N     TO PV-HOLD-AFTER-VALUE            
106806         MOVE AUBKPO-PO-UNT-QTY         TO PV-HOLD-BEFORE-VALUE-N         
106807         MOVE PV-HOLD-BEFORE-VALUE-N    TO PV-HOLD-BEFORE-VALUE           
106808         MOVE 'UNITS               '    TO PV-HOLD-FIELD-NAME             
106809         PERFORM 4340-PROCESS-CHANGES                                     
106810     END-IF.                                                              
106811                                                                          
106830     IF AUBKPO-PO-EXC-APVL-CDE NOT EQUAL PV-PREV-PO-EXC-APVL-CDE          
106831         MOVE PV-PREV-PO-EXC-APVL-CDE   TO PV-HOLD-AFTER-VALUE            
106832         MOVE AUBKPO-PO-EXC-APVL-CDE    TO PV-HOLD-BEFORE-VALUE           
106833         MOVE 'APPROVAL CDE        '    TO PV-HOLD-FIELD-NAME             
106834         PERFORM 4340-PROCESS-CHANGES                                     
106835     END-IF.                                                              
106836                                                                          
106837     IF AUBKPO-PO-EXC-APVL-USR-ID NOT EQUAL                               
106838                                      PV-PREV-PO-EXC-APVL-USR-ID          
106839         MOVE PV-PREV-PO-EXC-APVL-USR-ID TO PV-HOLD-AFTER-VALUE           
106840         MOVE AUBKPO-PO-EXC-APVL-USR-ID  TO PV-HOLD-BEFORE-VALUE          
106841         MOVE 'APPROVAL USERID     '     TO PV-HOLD-FIELD-NAME            
106842         PERFORM 4340-PROCESS-CHANGES                                     
106843     END-IF.                                                              
106844                                                                          
106845     IF AUBKPO-PO-EXC-APVL-TMST NOT EQUAL PV-PREV-PO-EXC-APVL-TMST        
106846         MOVE PV-PREV-PO-EXC-APVL-TMST  TO PV-HOLD-TMST-UNFORMAT          
106847         PERFORM 4350-FORMAT-TMST                                         
106848         MOVE PV-TMST                   TO PV-HOLD-AFTER-VALUE            
106849         MOVE AUBKPO-PO-EXC-APVL-TMST   TO PV-HOLD-TMST-UNFORMAT          
106850         PERFORM 4350-FORMAT-TMST                                         
106851         MOVE PV-TMST                   TO PV-HOLD-BEFORE-VALUE           
106852         MOVE 'APPROVAL DT         '    TO PV-HOLD-FIELD-NAME             
106853         PERFORM 4340-PROCESS-CHANGES                                     
106854     END-IF.                                                              
106855                                                                          
106856     IF AUBKPO-PO-EXC-RSN-DESC NOT EQUAL PV-PREV-PO-EXC-RSN-DESC          
106858         MOVE PV-PREV-PO-EXC-RSN-DESC   TO PV-HOLD-AFTER-VALUE            
106859         MOVE AUBKPO-PO-EXC-RSN-DESC    TO PV-HOLD-BEFORE-VALUE           
106860         MOVE 'APPROVAL REASON     '    TO PV-HOLD-FIELD-NAME             
106861         PERFORM 4340-PROCESS-CHANGES                                     
106862     END-IF.                                                              
106863                                                                          
106864     IF AUBKPO-EST-LBD-NM NOT EQUAL PV-PREV-EST-LBD-NM                    
106865         MOVE PV-PREV-EST-LBD-NM        TO PV-HOLD-AFTER-VALUE            
106866         MOVE AUBKPO-EST-LBD-NM         TO PV-HOLD-BEFORE-VALUE           
106867         MOVE 'EST LBD NM          '    TO PV-HOLD-FIELD-NAME             
106868         PERFORM 4340-PROCESS-CHANGES                                     
106869     END-IF.                                                              
106870                                                                          
106871     IF AUBKPO-EST-LBD-TMST NOT EQUAL PV-PREV-EST-LBD-TMST                
106872         MOVE PV-PREV-EST-LBD-TMST      TO PV-HOLD-TMST-UNFORMAT          
106873         PERFORM 4350-FORMAT-TMST                                         
106874         MOVE PV-TMST                   TO PV-HOLD-AFTER-VALUE            
106875         MOVE AUBKPO-EST-LBD-TMST       TO PV-HOLD-TMST-UNFORMAT          
106876         PERFORM 4350-FORMAT-TMST                                         
106877         MOVE PV-TMST                   TO PV-HOLD-BEFORE-VALUE           
106878         MOVE 'EST LBD DT          '    TO PV-HOLD-FIELD-NAME             
106879         PERFORM 4340-PROCESS-CHANGES                                     
106880     END-IF.                                                              
106881                                                                          
106882     IF AUBKPO-SHIPT-BKG-TMST NOT EQUAL PV-PREV-SHIPT-BKG-TMST            
106883         MOVE PV-PREV-SHIPT-BKG-TMST    TO PV-HOLD-TMST-UNFORMAT          
106884         PERFORM 4350-FORMAT-TMST                                         
106885         MOVE PV-TMST                   TO PV-HOLD-AFTER-VALUE            
106886         MOVE AUBKPO-SHIPT-BKG-TMST     TO PV-HOLD-TMST-UNFORMAT          
106887         PERFORM 4350-FORMAT-TMST                                         
106888         MOVE PV-TMST                   TO PV-HOLD-BEFORE-VALUE           
106889         MOVE 'BOOKING PLACED DT   '    TO PV-HOLD-FIELD-NAME             
106890         PERFORM 4340-PROCESS-CHANGES                                     
106891     END-IF.                                                              
106892                                                                          
106893     IF AUBKPO-VOY-CHG-RSN-DESC NOT EQUAL PV-PREV-VOY-CHG-RSN-DESC        
106894         MOVE PV-PREV-VOY-CHG-RSN-DESC  TO PV-HOLD-AFTER-VALUE            
106895         MOVE AUBKPO-VOY-CHG-RSN-DESC   TO PV-HOLD-BEFORE-VALUE           
106896         MOVE 'REASON NEW VOYAGE   '    TO PV-HOLD-FIELD-NAME             
106897         PERFORM 4340-PROCESS-CHANGES                                     
106898     END-IF.                                                              
106899                                                                          
106900     IF AUBKPO-DAT-SRC-ENT-ID NOT EQUAL PV-PREV-DAT-SRC-ENT-ID            
106901         MOVE PV-PREV-DAT-SRC-ENT-ID    TO PV-HOLD-AFTER-VALUE-N          
106902         MOVE PV-HOLD-AFTER-VALUE-N     TO PV-HOLD-AFTER-VALUE            
106903         MOVE AUBKPO-DAT-SRC-ENT-ID     TO PV-HOLD-BEFORE-VALUE-N         
106904         MOVE PV-HOLD-BEFORE-VALUE-N    TO PV-HOLD-BEFORE-VALUE           
106905         MOVE 'DATA SOURCE         '    TO PV-HOLD-FIELD-NAME             
106906         PERFORM 4340-PROCESS-CHANGES                                     
106907     END-IF.                                                              
106910                                                                          
106911     PERFORM 4345-MOVE-TAUBKPO-TO-HOLD.                                   
106912                                                                     CL*33
106913*----------------------------------------------------------------*   CL*30
106914*    FORMAT DATE AND TIME FROM LAST UPDATED TIMESTAMP.           *   CL*32
106915*----------------------------------------------------------------*   CL*30
106916 4335-FORMAT-LAST-UPD-TMST.                                          CL*30
106917                                                                     CL*30
106918     IF PV-PREV-LAST-UPD-TMST(1:10) EQUAL PC-INIT-DATE                    
106919         MOVE SPACES                      TO PV-FORMAT-DATE               
106920     ELSE                                                                 
106921         MOVE PV-PREV-LAST-UPD-TMST(9:2)  TO PV-FORMAT-DD                 
106922         MOVE PV-PREV-LAST-UPD-TMST(6:2)  TO PV-FORMAT-MM                 
106923         MOVE PV-PREV-LAST-UPD-TMST(3:2)  TO PV-FORMAT-YY                 
106924         MOVE PC-SLASH                    TO PV-FORMAT-SLASH1             
106925                                             PV-FORMAT-SLASH2             
106926     END-IF.                                                              
106927                                                                          
106928     IF PV-PREV-LAST-UPD-TMST(12:5) EQUAL PC-INIT-TIME                    
106929         MOVE SPACES                      TO PV-FORMAT-TIME               
106930     ELSE                                                                 
106931         MOVE PV-PREV-LAST-UPD-TMST(12:2) TO PV-FORMAT-HOUR               
106932         MOVE PV-PREV-LAST-UPD-TMST(15:2) TO PV-FORMAT-MIN                
106933         MOVE PC-COLON                    TO PV-FORMAT-COLON              
106934     END-IF.                                                              
106935                                                                          
106936*----------------------------------------------------------------*   CL*30
106937*    PROCESS THE CHANGES THAT WERE FOUND FOR THE AUDIT ROW.      *   CL*32
106938*----------------------------------------------------------------*   CL*30
106939 4340-PROCESS-CHANGES.                                               CL*30
106940                                                                     CL*30
106941     PERFORM 4320-GET-SUB.                                                
106942                                                                          
106943     MOVE PV-HOLD-FIELD-NAME   TO ASC-DATA                                
106944                                 (ASC-BLK-SUB ASC-ITEM-SUB).              
106945     MOVE PV-PREV-LAST-UPD-BY-USR-ID TO                                   
106946                                  ASC-USERID                              
106947                                 (ASC-BLK-SUB ASC-ITEM-SUB).              
106948     PERFORM 4335-FORMAT-LAST-UPD-TMST.                                   
106949     MOVE PV-FORMAT-DATE       TO ASC-DATE                                
106950                                 (ASC-BLK-SUB ASC-ITEM-SUB).              
106951     MOVE PV-FORMAT-TIME       TO ASC-TIME                                
106952                                 (ASC-BLK-SUB ASC-ITEM-SUB).              
106953                                                                          
106954     IF PV-HOLD-AFTER-VALUE = SPACES                                      
106955         MOVE 'NO DATA'            TO ASC-VALUE                           
106956                                     (ASC-BLK-SUB ASC-ITEM-SUB)           
106957     ELSE                                                                 
106958         MOVE PV-HOLD-AFTER-VALUE TO ASC-VALUE                            
106959                                    (ASC-BLK-SUB ASC-ITEM-SUB)            
106960     END-IF.                                                              
106961                                                                          
106962     PERFORM 4320-GET-SUB.                                                
106963                                                                          
106964     MOVE SPACES               TO ASC-DATA                                
106965                                 (ASC-BLK-SUB ASC-ITEM-SUB)               
106966                                  ASC-USERID                              
106967                                 (ASC-BLK-SUB ASC-ITEM-SUB)               
106968                                  ASC-DATE                                
106969                                 (ASC-BLK-SUB ASC-ITEM-SUB)               
106970                                  ASC-TIME                                
106971                                 (ASC-BLK-SUB ASC-ITEM-SUB).              
106972                                                                          
106973     IF PV-HOLD-BEFORE-VALUE = SPACES                                     
106974         MOVE 'NO DATA'            TO ASC-VALUE                           
106975                                     (ASC-BLK-SUB ASC-ITEM-SUB)           
106976     ELSE                                                                 
106977         MOVE PV-HOLD-BEFORE-VALUE  TO ASC-VALUE                          
106978                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
106979     END-IF.                                                              
106980                                                                          
106981*----------------------------------------------------------------*   CL**1
106982* MOVE TAUBKPO VALUES TO HOLD FIELDS FOR COMPARISON.             *        
106983*----------------------------------------------------------------*   CL**1
106984 4345-MOVE-TAUBKPO-TO-HOLD.                                               
106985                                                                          
106986     MOVE AUBKPO-CONSLR-SCAC-ID     TO PV-PREV-CONSLR-SCAC-ID.            
106987     MOVE AUBKPO-IMPRT-TRIP-ID      TO PV-PREV-IMPRT-TRIP-ID.             
106988     MOVE AUBKPO-DPRTR-TMST         TO PV-PREV-DPRTR-TMST.                
106989     MOVE AUBKPO-POE-DELY-TMST      TO PV-PREV-POE-DELY-TMST.             
106990     MOVE AUBKPO-CARR-SCAC-ID       TO PV-PREV-CARR-SCAC-ID.              
106991     MOVE AUBKPO-FOB-CDE            TO PV-PREV-FOB-CDE.                   
106992     MOVE AUBKPO-IMPRT-VEH-NM       TO PV-PREV-IMPRT-VEH-NM.              
106993     MOVE AUBKPO-TRIP-TYP-CDE       TO PV-PREV-TRIP-TYP-CDE.              
106994     MOVE AUBKPO-DEST-POE-CDE       TO PV-PREV-DEST-POE-CDE.              
106995     MOVE AUBKPO-C-O-PROD-CDE       TO PV-PREV-C-O-PROD-CDE.              
106996     MOVE AUBKPO-PROD-FCTRY-NM      TO PV-PREV-PROD-FCTRY-NM.             
106997     MOVE AUBKPO-PO-CART-CNT        TO PV-PREV-PO-CART-CNT.               
106998     MOVE AUBKPO-PO-CBMT-QTY        TO PV-PREV-PO-CBMT-QTY.               
106999     MOVE AUBKPO-PO-WT-KGRM-QTY     TO PV-PREV-PO-WT-KGRM-QTY.            
107000     MOVE AUBKPO-PO-UNT-QTY         TO PV-PREV-PO-UNT-QTY.                
107001     MOVE AUBKPO-PO-EXC-APVL-CDE    TO PV-PREV-PO-EXC-APVL-CDE.           
107002     MOVE AUBKPO-PO-EXC-APVL-USR-ID TO PV-PREV-PO-EXC-APVL-USR-ID.        
107003     MOVE AUBKPO-PO-EXC-APVL-TMST   TO PV-PREV-PO-EXC-APVL-TMST.          
107004     MOVE AUBKPO-PO-EXC-RSN-DESC    TO PV-PREV-PO-EXC-RSN-DESC.           
107005     MOVE AUBKPO-EST-LBD-NM         TO PV-PREV-EST-LBD-NM.                
107006     MOVE AUBKPO-EST-LBD-TMST       TO PV-PREV-EST-LBD-TMST.              
107007     MOVE AUBKPO-SHIPT-BKG-TMST     TO PV-PREV-SHIPT-BKG-TMST.            
107008     MOVE AUBKPO-VOY-CHG-RSN-DESC   TO PV-PREV-VOY-CHG-RSN-DESC.          
107009     MOVE AUBKPO-DAT-SRC-ENT-ID     TO PV-PREV-DAT-SRC-ENT-ID.            
107010     MOVE AUBKPO-LAST-UPD-BY-USR-ID TO                                    
107011                                    PV-PREV-LAST-UPD-BY-USR-ID.           
107012     MOVE AUBKPO-LAST-UPD-TMST      TO PV-PREV-LAST-UPD-TMST.             
107013                                                                          
107014*----------------------------------------------------------------*   CL*30
107015*    FORMAT TIMESTAMPS                                           *   CL*32
107016*----------------------------------------------------------------*   CL*30
107017 4350-FORMAT-TMST.                                                   CL*30
107018                                                                     CL*30
107019     IF PV-HOLD-TMST-UNFORMAT(1:10) EQUAL PC-INIT-DATE                    
107020         MOVE SPACES                      TO PV-TMST-DATE                 
107021     ELSE                                                                 
107022         MOVE PV-HOLD-TMST-UNFORMAT(9:2)  TO PV-TMST-DD                   
107023         MOVE PV-HOLD-TMST-UNFORMAT(6:2)  TO PV-TMST-MM                   
107024         MOVE PV-HOLD-TMST-UNFORMAT(1:4)  TO PV-TMST-CCYY                 
107025         MOVE PC-SLASH                    TO PV-TMST-SLASH1               
107026                                             PV-TMST-SLASH2               
107027     END-IF.                                                              
107028                                                                          
107029     IF PV-HOLD-TMST-UNFORMAT(12:5) EQUAL PC-INIT-TIME                    
107030         MOVE SPACES                      TO PV-TMST-TIME                 
107031     ELSE                                                                 
107032         MOVE PV-HOLD-TMST-UNFORMAT(12:2) TO PV-TMST-HOUR                 
107033         MOVE PV-HOLD-TMST-UNFORMAT(15:2) TO PV-TMST-MIN                  
107034         MOVE PC-COLON                    TO PV-TMST-COLON                
107035     END-IF.                                                              
107036                                                                          
107083*----------------------------------------------------------------*   CL**1
107090*    FORMAT THE MAP AND DETERMINE THE CURSOR POSITION.           *   CL**1
107100*----------------------------------------------------------------*   CL**1
107200 4400-MOVE-COMMAREA-TO-SCREEN.                                       CL**1
107300                                                                     CL**8
107500     MOVE ASC-KEY-PO-NBR             TO APONBRO.                     CL*53
107610     MOVE ASC-KEY-ORGN-SHPD-FROM-TYP TO AORGNSHO.                         
107611     MOVE PV-EXTL-REF-NBR            TO AREFNBRO.                         
107612                                                                          
107613     STRING  ASC-KEY-DELY-DTE (6:2) '/'                                   
107614             ASC-KEY-DELY-DTE (9:2) '/'                                   
107615             ASC-KEY-DELY-DTE (3:2)                                       
107616               DELIMITED BY SIZE                                          
107617                  INTO ADELYDTO                                           
107700                                                                     CL*53
107800     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))                CL**1
107900         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))             CL**1
108000         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))             CL**1
108100             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                CL**1
108200                 GIVING PV-BLOCK-NUMBER                              CL**1
108300                 REMAINDER PV-REMAINDER                              CL**1
108400             IF  PV-REMAINDER > ZERO                                 CL**1
108500                 ADD +1 TO PV-BLOCK-NUMBER                           CL**1
108600             END-IF                                                  CL**1
108700             MOVE +1    TO ASC-BLK-SUB                               CL**1
108800             PERFORM 4410-READ-TEMP-STORAGE                          CL**1
108900             ADD +1     TO ASC-BLK-SUB                               CL**1
109000                           PV-BLOCK-NUMBER                           CL**1
109100             PERFORM 4410-READ-TEMP-STORAGE                          CL**1
109200     END-IF.                                                         CL**1
109300     MOVE +1                       TO ASC-BLK-SUB.                   CL**1
109400     COMPUTE ASC-ITEM-SUB =                                          CL**1
109500         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))                 CL**1
109600         + PC-ITEMS-PER-PANEL).                                      CL**1
109700                                                                     CL**8
109800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                           CL**1
109900         ADD +1   TO ASC-BLK-SUB                                     CL**1
110000         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB               CL**1
110100     END-IF.                                                         CL**1
110200                                                                     CL**8
110300     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                              CL**1
110400         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                   CL**1
110500     PERFORM 4420-FORMAT-LIST-LINES                                  CL**1
110600         VARYING PS-SUB                                              CL**1
110700         FROM PC-ITEMS-PER-PANEL BY -1                               CL**1
110800         UNTIL PS-SUB < +1.                                          CL**1
110900                                                                     CL**8
111000     COMPUTE ASC-ITEMS-DISPLAYED =                                   CL**1
111100         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).             CL**1
111200     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL       CL**1
111300                                      ASTRTITO.                      CL**1
111400     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                       CL**1
111500     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                       CL**1
111600                                                                     CL*36
111700     IF  DP020-MSG-NUMBER-X = SPACE                                  CL*65
111800         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ     CL*65
111900*            --- MORE ITEMS TO DISPLAY ----                          CL*65
112000             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER               CL*65
112100             SET DP020-MSG-INFORMATIONAL TO TRUE                     CL*65
112200         END-IF                                                      CL*65
112300     END-IF.                                                         CL*65
112400                                                                     CL*65
112500*----------------------------------------------------------------*   CL**1
112600*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *   CL**1
112700*----------------------------------------------------------------*   CL**1
112800                                                                     CL**1
112900 4410-READ-TEMP-STORAGE.                                             CL**1
113000                                                                     CL**1
113100     EXEC CICS                                                       CL**1
113200         READQ TS                                                    CL**1
113300             QUEUE (ASC-DTL-QUEUE-NAME)                              CL*17
113400             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                  CL**1
113500             ITEM  (PV-BLOCK-NUMBER)                                 CL**1
113600             RESP  (PV-CICS-RESP)                                    CL**1
113700     END-EXEC.                                                       CL**1
113800                                                                     CL**1
113900     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                          CL**1
114000       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                        CL**1
114100         CONTINUE                                                    CL**1
114200     ELSE                                                            CL**1
114300         SET DP013-CICS-ABEND TO  TRUE                               CL**1
114400         SET DP013-NO-ROLLBACK TO  TRUE                              CL**1
114500         MOVE '4410-READ-TEMP-STORAGE'                               CL**1
114600                               TO  DP013-PARAGRAPH                   CL**1
114700         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'         CL**1
114800                               TO  DP013-MESSAGE-TEXT(1)             CL**1
114900         PERFORM DP013-0000-PROCESS-ABEND                            CL**1
115000     END-IF.                                                         CL**1
115100                                                                     CL**1
115200*    SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.                CL*17
115300                                                                     CL**8
115400     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                            CL**1
115500         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)                  CL**1
115600     END-IF.                                                         CL**1
115700 EJECT                                                               CL**1
115800*----------------------------------------------------------------*   CL**1
115900*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *   CL**1
116000*----------------------------------------------------------------*   CL**1
116100                                                                     CL**1
116200 4420-FORMAT-LIST-LINES.                                             CL**1
116300                                                                     CL**8
116400     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ         CL**1
116500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                   CL**1
116600         MOVE SPACES            TO MR-DATA   (PS-SUB)                CL*17
116601                                   MR-USERID (PS-SUB)                     
116610                                   MR-DATE   (PS-SUB)                     
116620                                   MR-TIME   (PS-SUB)                     
116630                                   MR-VALUE  (PS-SUB)                     
116700     ELSE                                                            CL**1
116800         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL              CL**1
116900             MOVE ASC-DATA      (ASC-BLK-SUB ASC-ITEM-SUB)                
117000                                TO MR-DATA (PS-SUB)                       
117001             MOVE ASC-USERID    (ASC-BLK-SUB ASC-ITEM-SUB)                
117002                                TO MR-USERID (PS-SUB)                     
117010             MOVE ASC-DATE      (ASC-BLK-SUB ASC-ITEM-SUB)                
117020                                TO MR-DATE (PS-SUB)                       
117030             MOVE ASC-TIME      (ASC-BLK-SUB ASC-ITEM-SUB)                
117040                                TO MR-TIME (PS-SUB)                       
117050             MOVE ASC-VALUE     (ASC-BLK-SUB ASC-ITEM-SUB)                
117060                                TO MR-VALUE (PS-SUB)                      
117100         END-IF                                                      CL**1
117200     END-IF.                                                         CL**1
117300     SUBTRACT +1 FROM ASC-ITEM-SUB.                                  CL*25
117400     IF  ASC-ITEM-SUB < + 1                                          CL**1
117500         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                     CL**1
117600         MOVE +1                 TO ASC-BLK-SUB                      CL**1
117700     END-IF.                                                         CL**1
117800                                                                     CL**8
117920*----------------------------------------------------------------*   CL**1
118000*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *   CL**1
118100*----------------------------------------------------------------*   CL**1
118200                                                                     CL**1
118300 5100-WRITE-TEMP-STORAGE.                                            CL**1
118400                                                                     CL**8
118500     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                        CL**1
118600                               TO  PV-LIST-ITEM-NUMBER.              CL**1
118700     COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                              CL*23
118800         ASC-HIGHEST-BLOCK-WRITTEN + 1.                              CL*51
118900                                                                     CL*51
119000     EXEC CICS                                                       CL*51
119100         WRITEQ TS                                                   CL*51
119200             QUEUE (ASC-DTL-QUEUE-NAME)                              CL*51
119300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                  CL*51
119400             ITEM  (PV-HIGHEST-BLOCK-WRITTEN)                        CL*51
119500             RESP  (PV-CICS-RESP)                                    CL*51
119600     END-EXEC.                                                       CL*51
119700                                                                     CL*51
119800     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                         CL*51
119900         SET DP013-CICS-ABEND                                        CL*51
120000                       TO  TRUE                                      CL*51
120100         SET DP013-NO-ROLLBACK                                       CL*51
120200                       TO  TRUE                                      CL*51
120300         MOVE '5100-WRITE-TEMP-STORAGE'                              CL*51
120400                       TO  DP013-PARAGRAPH                           CL*51
120500         MOVE 'ATTEMPTING TO WRITE TEMP STORAGE LIST BLOCK'          CL*51
120600                       TO  DP013-MESSAGE-TEXT(1)                     CL*51
120700         PERFORM DP013-0000-PROCESS-ABEND                            CL*51
120800     END-IF.                                                         CL*51
120900     ADD +1            TO  ASC-HIGHEST-BLOCK-WRITTEN.                CL*51
121000                                                                     CL**1
121100 EJECT                                                               CL**1
126000*----------------------------------------------------------------*   CL**1
126100*    ABEND PROCESSOR MODULE                                      *   CL**1
126200*----------------------------------------------------------------*   CL**1
126300                                                                     CL**1
126400     COPY DPPD013.                                                   CL**1
