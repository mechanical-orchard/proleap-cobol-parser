000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.              MLKUT602.                               00030000
000400 AUTHOR.                  DAVE METZGER.                           00040000
000500 INSTALLATION.            KOHLS DEPARTMENT STORES.                00050000
000600 DATE-WRITTEN.            04/15/98.                               00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900******************************************************************00090000
001000*      BUILD EXTRACT FILE FOR VENDOR ANALYSIS REPORTING           00100000
001100*                                                                 00110000
001200* THIS PROGRAM WILL READ A M/L VENDOR ANALYSIS RECORD WHICH       00120000
001300* CONTAINS "THIS" YEAR AND "LAST" YEAR DATA.  FOR EACH RECORD IT  00130000
001400* DETERMINES THE GMM, DMM, AND BUYER NUMBER AND ALSO GETS THE     00140000
001500* CORRECT NAMES FOR THE GMM, DMM, BUYER, DEPT, MAJOR CLASS, AND   00150000
001600* VENDOR......THEN WRITES A NEW OUTPUT RECORD WITH THE ADDITIONAL 00160000
001700* INFORMATION.                                                    00170000
001800*                                                                 00180000
001800*CHANGE HISTORY:                                                  00181061
001800* 06/27/00  DAVE METZGER                WR/ID - 99999             00183061
001800*   ADDED CODE TO JOIN THE TMDSEAR TABLE ON OPERCO NUMBER WHERE   00184061
001800*   APPLICABLE (PARAGRAPHS 8000- AND 8100-)                       00184161
001800* 11/01/2001 ROD JANSSEN                WR/ID - 99999             00184261
001800*   ADJUST VERBIAGE ON SEVERAL JOBLOG DISPLAY STATEMENTS.         00184361
001800*                                                                 00185060
001900******************************************************************00190000
002000                                                                  00200000
002100 ENVIRONMENT DIVISION.                                            00210000
002200                                                                  00220000
002300 CONFIGURATION SECTION.                                           00230000
002400                                                                  00240000
002500 SOURCE-COMPUTER. IBM-3090.                                       00250000
002600 OBJECT-COMPUTER. IBM-3090.                                       00260000
002700                                                                  00270000
002800 INPUT-OUTPUT SECTION.                                            00280000
002900                                                                  00290000
003000 FILE-CONTROL.                                                    00300000
003100                                                                  00310000
003200     SELECT CONTROL-CARD-FILE                                     00320000
003300         ASSIGN TO INP01.                                         00330000
003400                                                                  00340000
003500     SELECT LEDGER-OLD-VA-FILE                                    00350000
003600         ASSIGN TO INP02.                                         00360000
003700                                                                  00370000
003800     SELECT LEDGER-NEW-VA-FILE                                    00380000
003900         ASSIGN TO OUT01.                                         00390000
004000                                                                  00400000
004100 DATA DIVISION.                                                   00410000
004200                                                                  00420000
004300 FILE SECTION.                                                    00430000
004400                                                                  00440000
004500 FD  CONTROL-CARD-FILE                                            00450000
004600     RECORDING MODE IS F                                          00460000
004700     LABEL RECORDS ARE STANDARD                                   00470000
004800     BLOCK CONTAINS 0 RECORDS.                                    00480000
004900 01  CONTROL-CARD-RECORD              PIC X(80).                  00490000
005000                                                                  00500000
005100 FD  LEDGER-OLD-VA-FILE                                           00510000
005200     RECORDING MODE IS F                                          00520000
005300     LABEL RECORDS ARE STANDARD                                   00530000
005400     BLOCK CONTAINS 0 RECORDS.                                    00540000
005500 01  LEDGER-OLD-VA-RECORD             PIC X(660).                 00550055
005600                                                                  00560000
005700 FD  LEDGER-NEW-VA-FILE                                           00570000
005800     RECORDING MODE IS F                                          00580000
005900     LABEL RECORDS ARE STANDARD                                   00590000
006000     BLOCK CONTAINS 0 RECORDS.                                    00600000
006100 01  LEDGER-NEW-VA-RECORD             PIC X(660).                 00610055
006200                                                                  00620000
006300 WORKING-STORAGE SECTION.                                         00630000
006400                                                                  00640000
006500****************************************************************  00650000
006600* RECORD LAYOUT FOR LEDGER EXTRACT DATE RECORD                    00660000
006700****************************************************************  00670000
006800     COPY MLRD114.                                                00680000
006900                                                                  00690000
007000****************************************************************  00700000
007100* RECORD LAYOUT FOR LEDGER/VENDOR ANALYSIS EXTRACT RECORD         00710000
007200****************************************************************  00720000
007300     COPY MLRD202.                                                00730000
007400                                                                  00740000
007500***************************************************************** 00750000
007600*    WORKING STORAGE AREA FOR ROUTINE TO FORMAT NAME              00760000
007700***************************************************************** 00770000
007800     COPY DPWS024.                                                00780000
007900                                                                  00790000
008000****************************************************************  00800000
008100*  ERROR MESSAGE AREA FOR DB2                                     00810000
008200****************************************************************  00820000
008300     COPY DPWS004.                                                00830000
008400                                                                  00840000
008500****************************************************************  00850000
008600* MISC WORKING STORAGE FIELDS                                     00860000
008700****************************************************************  00870000
008800                                                                  00880000
008900 01  PC-PROGRAM-CONSTANTS.                                        00890000
009000     05  PC-OPERCO-NBR                PIC X(02)  VALUE '03'.      00900000
009100     05  PC-MDSELV-GMA                PIC X(03)  VALUE 'GMA'.     00910000
009200     05  PC-MDSELV-DMA                PIC X(03)  VALUE 'DMA'.     00920000
009300     05  PC-MDSELV-DPT                PIC X(03)  VALUE 'DPT'.     00930000
009400     05  PC-MDSELV-MCL                PIC X(03)  VALUE 'MCL'.     00940000
009500     05  PC-RSPLVL-CDE-GMM            PIC X(03)  VALUE 'GMM'.     00950000
009600     05  PC-RSPLVL-CDE-DMM            PIC X(03)  VALUE 'DMM'.     00960000
009700     05  PC-RSPLVL-CDE-BYR            PIC X(03)  VALUE 'BYR'.     00970000
009700     05  PC-UNKNOWN                   PIC X(07)  VALUE 'UNKNOWN'. 00971000
009800                                                                  00980000
009900 01  PS-PROGRAM-SWITCHES.                                         00990000
010000     05  PS-END-OF-CONTROL-CARDS-SW   PIC X      VALUE 'N'.       01000000
010100         88  END-OF-CONTROL-CARDS                VALUE 'Y'.       01010000
010200     05  PS-END-OF-INPUT-SW           PIC X      VALUE 'N'.       01020000
010300         88  END-OF-INPUT                        VALUE 'Y'.       01030000
010400     05  PS-MBS-INFO-FOUND-SW         PIC X      VALUE 'N'.       01040000
010500         88  MBS-INFO-FOUND                      VALUE 'Y'.       01050000
010600         88  MBS-INFO-NOT-FOUND                  VALUE 'N'.       01060000
010700     05  PS-MBS-MAX-DATE-FOUND-SW     PIC X      VALUE 'N'.       01070000
010800         88  MBS-MAX-DATE-FOUND                  VALUE 'Y'.       01080000
010900         88  MBS-MAX-DATE-NOT-FOUND              VALUE 'N'.       01090000
011000     05  PS-MBS-USING-MAX-DATE-SW     PIC X      VALUE 'N'.       01100000
011100         88  MBS-USING-MAX-DATE                  VALUE 'Y'.       01110000
011200         88  MBS-NOT-USING-MAX-DATE              VALUE 'N'.       01120000
011300                                                                  01130000
011400 01  PV-PROGRAM-VARIABLES.                                        01140000
011500     05  PV-DB2-OPER-ATTEMPTED        PIC X(30)  VALUE SPACES.    01150000
011600     05  PV-PARAGRAPH-NAME            PIC X(30)  VALUE SPACES.    01160000
011700     05  PV-MAX-MCL-DATE-NULL-IND     PIC S9(04) VALUE ZEROS      01170052
011800                                                 COMP.            01180000
011700     05  PV-MAX-DEPT-DATE-NULL-IND    PIC S9(04) VALUE ZEROS      01181052
011800                                                 COMP.            01182052
011900     05  PV-EXTRACT-DTE               PIC X(10)  VALUE SPACES.    01190000
012000     05  PV-DEPT-DESC                 PIC X(25)  VALUE SPACES.    01200000
012100     05  PV-MAJ-CL-DESC               PIC X(25)  VALUE SPACES.    01210000
012200     05  PV-GMM-FIR-NAME              PIC X(12)  VALUE SPACES.    01220000
012300     05  PV-GMM-LAST-NAME             PIC X(18)  VALUE SPACES.    01230000
012400     05  PV-DMM-FIR-NAME              PIC X(12)  VALUE SPACES.    01240000
012500     05  PV-DMM-LAST-NAME             PIC X(18)  VALUE SPACES.    01250000
012600     05  PV-BYR-FIR-NAME              PIC X(12)  VALUE SPACES.    01260000
012700     05  PV-BYR-LAST-NAME             PIC X(18)  VALUE SPACES.    01270000
012800     05  PV-VENDOR-NAME               PIC X(30)  VALUE SPACES.    01280000
012900     05  PV-PREV-DEPT-NBR             PIC X(03)  VALUE SPACES.    01290000
013000     05  PV-PREV-MAJ-CL-NBR           PIC X(02)  VALUE SPACES.    01300000
013100     05  PV-INPUT-REC-CNT             PIC 9(11)  VALUE ZEROS      01310000
                                                        COMP-3.         01311000
013200     05  PV-OUTPUT-REC-CNT            PIC 9(11)  VALUE ZEROS      01320000
                                                        COMP-3.         01321000
013200     05  PV-MBS-NOT-FOUND-CNT         PIC 9(11)  VALUE ZEROS      01322000
                                                        COMP-3.         01323000
013300     05  PV-INPUT-REC-CNT-DIS         PIC ZZ,ZZZ,ZZZ,ZZZ.         01330000
013400     05  PV-OUTPUT-REC-CNT-DIS        PIC ZZ,ZZZ,ZZZ,ZZZ.         01340000
013200     05  PV-MBS-NOT-FOUND-CNT-DIS     PIC ZZ,ZZZ,ZZZ,ZZZ.         01341000
013500                                                                  01350000
013600 01  ABEND-CODE                       PIC S9(04) COMP             01360000
013700                                                 VALUE ZERO.      01370000
013800                                                                  01380000
013900****************************************************************  01390000
014000* MERCHANDISE LEDGER CONTROL TABLE                                01400000
014100****************************************************************  01410000
014200     EXEC SQL                                                     01420000
014300         INCLUDE TMLCNTL                                          01430000
014400     END-EXEC.                                                    01440000
014500                                                                  01450000
014600****************************************************************  01460000
014700* DATE ATTRIBUTE TABLE                                            01470000
014800****************************************************************  01480000
014900     EXEC SQL                                                     01490000
015000         INCLUDE TDTATTR                                          01500000
015100     END-EXEC.                                                    01510000
015200                                                                  01520000
015300****************************************************************  01530000
015400* MBS MERCHANDISE AREA TABLE                                      01540000
015500****************************************************************  01550000
015600     EXEC SQL                                                     01560000
015700         INCLUDE TMDSEAR                                          01570000
015800     END-EXEC.                                                    01580000
015900                                                                  01590000
016000****************************************************************  01600000
016100* MBS RESPONSIBILITY LEVEL TABLE                                  01610000
016200****************************************************************  01620000
016300     EXEC SQL                                                     01630000
016400         INCLUDE TRSPBAR                                          01640000
016500     END-EXEC.                                                    01650000
016600                                                                  01660000
017400****************************************************************  01740000
017500* EXTERNAL ENTITY ID TABLE                                        01750000
017600****************************************************************  01760000
017700     EXEC SQL                                                     01770000
017800         INCLUDE TEXTENT                                          01780000
017900     END-EXEC.                                                    01790000
018000                                                                  01800000
018100****************************************************************  01810000
018200* EXTERNAL ENTITY ID NAME TABLE                                   01820000
018300****************************************************************  01830000
018400     EXEC SQL                                                     01840000
018500         INCLUDE TENTNME                                          01850000
018600     END-EXEC.                                                    01860000
018700                                                                  01870000
018800****************************************************************  01880000
018900*  COMMUNICATION AREAS FOR DB2                                    01890000
019000****************************************************************  01900000
019100     EXEC SQL                                                     01910000
019200         INCLUDE SQLCA                                            01920000
019300     END-EXEC.                                                    01930000
019400                                                                  01940000
019500 LINKAGE SECTION.                                                 01950000
019600                                                                  01960000
019700 PROCEDURE DIVISION.                                              01970000
019800                                                                  01980000
019900***************************************************************** 01990000
020000*  MAIN MODULE - BEGINNING OF PGM LOGIC                           02000000
020100***************************************************************** 02010000
020200 1000-MAIN-MODULE.                                                02020000
020300                                                                  02030000
020400     OPEN INPUT  CONTROL-CARD-FILE                                02040000
020500                 LEDGER-OLD-VA-FILE                               02050000
020600          OUTPUT LEDGER-NEW-VA-FILE.                              02060000
020700                                                                  02070000
020800     PERFORM 1100-GET-EXTRACT-DTE.                                02080000
020900                                                                  02090000
021000     PERFORM 7100-READ-OLD-EXTRACT-FILE.                          02100000
021100                                                                  02110000
021200*   INTIALIZE FIRST/LAST NAME LENGTH INFO                         02120000
021300*   FOR NAME FORMATTING ROUTINE                                   02130000
021400     MOVE +30               TO DP024-FLNAME-LENGTH.               02140000
021500                                                                  02150000
021600     PERFORM 2000-BUILD-NEW-EXTRACT-FILE                          02160000
021700         UNTIL END-OF-INPUT.                                      02170000
021800                                                                  02180000
021900     MOVE PV-INPUT-REC-CNT     TO PV-INPUT-REC-CNT-DIS.           02190000
022000     MOVE PV-OUTPUT-REC-CNT    TO PV-OUTPUT-REC-CNT-DIS.          02200000
022000     MOVE PV-MBS-NOT-FOUND-CNT TO PV-MBS-NOT-FOUND-CNT-DIS.       02201000
022100     DISPLAY ' '.                                                 02210000
022200     DISPLAY '***     MLKUT602 RECORD COUNTS     ***'             02220000
022300     DISPLAY '***  RECORDS READ      ' PV-INPUT-REC-CNT-DIS.      02230000
022400     DISPLAY '***  RECORDS WRITTEN   ' PV-OUTPUT-REC-CNT-DIS.     02240000
022100     DISPLAY ' '.                                                 02241000
022400     DISPLAY '***  MBS NOT FOUND CNT ' PV-MBS-NOT-FOUND-CNT-DIS.  02242000
022500                                                                  02250000
022600     CLOSE CONTROL-CARD-FILE                                      02260000
022700           LEDGER-OLD-VA-FILE                                     02270000
022800           LEDGER-NEW-VA-FILE.                                    02280000
022900                                                                  02290000
023000     STOP RUN.                                                    02300000
023100                                                                  02310000
023200***************************************************************** 02320000
023300*  GET CONTROL CARD EXTRACT DATE FOR RETRIEVING MBS DATA          02330000
023400***************************************************************** 02340000
023500 1100-GET-EXTRACT-DTE.                                            02350000
023600                                                                  02360000
023700     PERFORM 7000-READ-CONTROL-CARD-FILE.                         02370000
023800                                                                  02380000
023900     IF END-OF-CONTROL-CARDS OR                                   02390000
024000        ML114-EXTRACT-DTE = SPACES                                02400000
024100         DISPLAY '** ABEND **'                                    02410000
024200         DISPLAY '** PROGRAM MLKUT602 **'                         02420000
024300         DISPLAY '** PARAGRAPH 1100-GET-EXTRACT-DTE'              02430000
024400         DISPLAY '** CONTROL CARD NOT FOUND OR WAS SPACES'        02440000
024500         MOVE +4008 TO ABEND-CODE                                 02450000
024600         PERFORM 9999-ABEND                                       02460000
024700     ELSE                                                         02470000
024800        MOVE ML114-EXTRACT-DTE TO PV-EXTRACT-DTE                  02480000
024900     END-IF.                                                      02490000
025000                                                                  02500000
025100***************************************************************** 02510000
025200*  BUILD NEW EXTRACT FILE WITH THE ADDITIONAL MBS INFO            02520000
025300***************************************************************** 02530000
025400 2000-BUILD-NEW-EXTRACT-FILE.                                     02540000
025500                                                                  02552053
025600     ADD 1 TO PV-INPUT-REC-CNT.                                   02560000
025700     PERFORM 3000-MOVE-DATA-TO-OUTPUT-FILE.                       02570000
025800                                                                  02580000
025900     PERFORM 7200-WRITE-LEDGER-VA-EXTRACT.                        02590000
026000     ADD 1 TO PV-OUTPUT-REC-CNT.                                  02600000
026100                                                                  02610000
026200     INITIALIZE ML202-VENDOR-EXTRACT.                             02620000
026300                                                                  02630000
026400     PERFORM 7100-READ-OLD-EXTRACT-FILE.                          02640000
026500                                                                  02650000
026600***************************************************************** 02660000
026700* BUILD NEW EXTRACT THAT WILL BE USED FOR VENDOR ANALYSIS         02670000
026800* REPORTING                                                       02680000
026900***************************************************************** 02690000
027000 3000-MOVE-DATA-TO-OUTPUT-FILE.                                   02700000
027100                                                                  02710000
027200*    ONLY GET THE MBS FIELDS IF THE DEPT OR MAJ CLASS CHANGED     02720000
027300     IF ML202-DEPT-NBR   = PV-PREV-DEPT-NBR AND                   02730000
027400        ML202-MAJ-CL-NBR = PV-PREV-MAJ-CL-NBR                     02740000
027500        NEXT SENTENCE                                             02750000
027600     ELSE                                                         02760000
027700        PERFORM 3100-GET-MBS-DESCS                                02770000
027800     END-IF.                                                      02780000
027900                                                                  02790000
028000*    MOVE MISC MBS FIELDS TO OUTPUT                               02800000
028100     MOVE PV-DEPT-DESC           TO ML202-NAME-DEPT.              02810000
028200     MOVE PV-MAJ-CL-DESC         TO ML202-NAME-MCL.               02820000
028300     MOVE MDSEAR-GMA-NBR         TO ML202-GMM.                    02830000
028400     MOVE MDSEAR-DMA-NBR         TO ML202-DMM.                    02840000
028500     MOVE MDSEAR-BYR-NBR         TO ML202-BUYER.                  02850000
028600                                                                  02860000
028700*    MOVE THE GMM NAME (GENERAL MERCH MGR) TO OUTPUT              02870000
028800     MOVE PV-GMM-FIR-NAME        TO DP024-FNAME.                  02880000
028900     MOVE PV-GMM-LAST-NAME       TO DP024-LNAME.                  02890000
029000     PERFORM DP024-0000-FORMAT-NAME.                              02900000
029100     MOVE DP024-FLNAME           TO ML202-NAME-GMM.               02910000
029200                                                                  02920000
029300*    MOVE THE DMM NAME (DIVISIONAL MERCH MGR) TO OUTPUT           02930000
029400     MOVE PV-DMM-FIR-NAME        TO DP024-FNAME.                  02940000
029500     MOVE PV-DMM-LAST-NAME       TO DP024-LNAME.                  02950000
029600     PERFORM DP024-0000-FORMAT-NAME.                              02960000
029700     MOVE DP024-FLNAME           TO ML202-NAME-DMM.               02970000
029800                                                                  02980000
029900*    MOVE THE BUYER NAME TO OUTPUT                                02990000
030000     MOVE PV-BYR-FIR-NAME        TO DP024-FNAME.                  03000000
030100     MOVE PV-BYR-LAST-NAME       TO DP024-LNAME.                  03010000
030200     PERFORM DP024-0000-FORMAT-NAME.                              03020000
030300     MOVE DP024-FLNAME           TO ML202-NAME-BUYER.             03030000
030400                                                                  03040000
030500*    MOVE THE VENDOR NAME TO OUTPUT                               03050000
030600     MOVE ML202-ENT-ID           TO ENTNME-ENT-ID.                03060000
030700     PERFORM 8400-GET-VENDOR-NAME.                                03070052
030800     MOVE PV-VENDOR-NAME        TO ML202-NAME-VENDOR.             03080000
030900                                                                  03090000
031000***************************************************************** 03100000
031100* GET THE CORRECT MBS DESCRIPTION/NAME FIELDS                     03110000
031200***************************************************************** 03120000
031300 3100-GET-MBS-DESCS.                                              03130000
031400                                                                  03140000
031500     MOVE ML202-DEPT-NBR    TO MDSEAR-DEPT-NBR                    03150000
031600                               PV-PREV-DEPT-NBR.                  03160000
031700     MOVE ML202-MAJ-CL-NBR  TO MDSEAR-MAJ-CL-NBR                  03170000
031800                               PV-PREV-MAJ-CL-NBR.                03180000
031900     MOVE ML114-EXTRACT-DTE TO PV-EXTRACT-DTE.                    03190000
                                                                        03190151
           IF ML202-MAJ-CL-NBR = SPACES                                 03190251
              PERFORM 3200-GET-DEPT-LVL-MBS                             03190351
           ELSE                                                         03190451
              PERFORM 3300-GET-MCL-LVL-MBS                              03190551
           END-IF.                                                      03190651
031910                                                                  03191000
034700                                                                  03470000
034710***************************************************************** 03471000
034720* GET THE DEPT LEVEL MBS INFORMATION                              03472051
034730***************************************************************** 03473000
034740  3200-GET-DEPT-LVL-MBS.                                          03474051
                                                                        03474151
032000     PERFORM 8100-GET-EFF-MBS-DEPT-INFO.                          03474251
032010                                                                  03474351
032100     IF MBS-INFO-NOT-FOUND                                        03474451
032200        PERFORM 8300-GET-LATEST-MBS-DEPT-DATE                     03474552
032300        IF MBS-MAX-DATE-FOUND                                     03474651
032400           MOVE MDSEAR-END-DTE TO PV-EXTRACT-DTE                  03474751
032500           PERFORM 8100-GET-EFF-MBS-DEPT-INFO                     03474851
032600           IF MBS-INFO-NOT-FOUND                                  03474951
032610              PERFORM 3600-SET-MBS-TO-UNKNOWN                     03475051
033500           END-IF                                                 03475151
033600        ELSE                                                      03475251
033700           PERFORM 3600-SET-MBS-TO-UNKNOWN                        03475351
034500        END-IF                                                    03475451
034600     END-IF.                                                      03475551
                                                                        03475651
034710***************************************************************** 03475751
034720* GET THE MAJOR CLASS LEVEL MBS INFORMATION                       03475851
 34730***************************************************************** 03475951
034740  3300-GET-MCL-LVL-MBS.                                           03476051
                                                                        03476151
032000     PERFORM 8000-GET-EFF-MBS-MCL-INFO.                           03476251
032010                                                                  03476351
032100     IF MBS-INFO-NOT-FOUND                                        03476451
032200        PERFORM 8200-GET-LATEST-MBS-MCL-DATE                      03476552
032300        IF MBS-MAX-DATE-FOUND                                     03476651
032400           MOVE MDSEAR-END-DTE TO PV-EXTRACT-DTE                  03476751
032500           PERFORM 8000-GET-EFF-MBS-MCL-INFO                      03476851
032600           IF MBS-INFO-NOT-FOUND                                  03476951
032610              PERFORM 3600-SET-MBS-TO-UNKNOWN                     03477051
033500           END-IF                                                 03477151
033600        ELSE                                                      03477251
033700           PERFORM 3600-SET-MBS-TO-UNKNOWN                        03477351
034500        END-IF                                                    03477451
034600     END-IF.                                                      03477551
                                                                        03477651
034710***************************************************************** 03477751
034720* SET MBS MBS DESCRIPTION/NAME FIELDS TO "UNKNOWN" SINCE NOTHING  03477851
034721* WAS FOUND FOR THE DEPT/MAJ CLASS BEING PROCESSED.               03477951
034730***************************************************************** 03478051
034740 3600-SET-MBS-TO-UNKNOWN.                                         03478151
034750                                                                  03478251
           ADD 1 TO PV-MBS-NOT-FOUND-CNT.                               03478351
                                                                        03478451
           IF ML202-MAJ-CL-NBR = SPACES                                 03478551
034752        MOVE SPACES         TO PV-MAJ-CL-DESC                     03478651
           ELSE                                                         03478751
034751        MOVE PC-UNKNOWN     TO PV-MAJ-CL-DESC                     03478851
           END-IF.                                                      03478951
                                                                        03479051
034751     MOVE PC-UNKNOWN        TO PV-DEPT-DESC                       03479151
034753                               PV-GMM-FIR-NAME                    03479251
034754                               PV-DMM-FIR-NAME                    03479351
034755                               PV-BYR-FIR-NAME.                   03479451
034756                                                                  03479551
034757     MOVE SPACES            TO PV-GMM-LAST-NAME                   03479651
034758                               PV-DMM-LAST-NAME                   03479751
034759                               PV-BYR-LAST-NAME.                  03479851
034760                                                                  03479900
034800***************************************************************** 03480000
034900* DPPD024 COMBINES SEPARATE FIRST AND LAST NAME FIELDS INTO ONE   03490000
035000* FIRST/LAST NAME FIELD.                                          03500000
035100***************************************************************** 03510000
035200     COPY DPPD024.                                                03520000
035300                                                                  03530000
035400***************************************************************** 03540000
035500* READ THE CONTROL FILE TO GET THE MBS EXTRACT DATE               03550000
035600***************************************************************** 03560000
035700 7000-READ-CONTROL-CARD-FILE.                                     03570000
035800                                                                  03580000
035900     READ CONTROL-CARD-FILE                                       03590000
036000          INTO ML114-LEDGER-EXTRACT-DATE-REC                      03600000
036100          AT END SET END-OF-CONTROL-CARDS TO TRUE.                03610000
036200                                                                  03620000
036300***************************************************************** 03630000
036400* READ OLD EXTRACT SO A NEW EXTRACT WITH MBS INFO CAN BE CREATED  03640000
036500***************************************************************** 03650000
036600 7100-READ-OLD-EXTRACT-FILE.                                      03660000
036700                                                                  03670000
036800     READ LEDGER-OLD-VA-FILE                                      03680000
036900         INTO ML202-VENDOR-EXTRACT                                03690000
037000         AT END SET END-OF-INPUT TO TRUE.                         03700000
037100                                                                  03710000
037200***************************************************************** 03720000
037300*  WRITE NEW EXTRACT WITH THE ADDITIONAL MBS INFO                 03730000
037400***************************************************************** 03740000
037500 7200-WRITE-LEDGER-VA-EXTRACT.                                    03750000
037600                                                                  03760000
037700     WRITE LEDGER-NEW-VA-RECORD                                   03770000
037800         FROM ML202-VENDOR-EXTRACT.                               03780000
037900                                                                  03790000
038000***************************************************************** 03800000
038100* GET THE DIFFERENT LEVELS OF MBS INFO BASED DEPT/MAJCL/EXTR DTE  03810000
038200***************************************************************** 03820000
038300 8000-GET-EFF-MBS-MCL-INFO.                                       03830051
038400                                                                  03840000
038500     EXEC SQL                                                     03850000
038600        SELECT A.GMA_NBR                                          03860000
038700              ,E.WORKER_FIR_NAME                                  03870000
038800              ,E.WORKER_LAST_NAME                                 03880000
038900              ,B.DMA_NBR                                          03890000
039000              ,F.WORKER_FIR_NAME                                  03900000
039100              ,F.WORKER_LAST_NAME                                 03910000
039200              ,C.MDSEAR_DESC                                      03920000
039300              ,C.BYR_NBR                                          03930000
039400              ,G.WORKER_FIR_NAME                                  03940000
039500              ,G.WORKER_LAST_NAME                                 03950000
039600              ,D.MDSEAR_DESC                                      03960000
039700        INTO  :MDSEAR-GMA-NBR                                     03970000
039800             ,:PV-GMM-FIR-NAME                                    03980000
039900             ,:PV-GMM-LAST-NAME                                   03990000
040000             ,:MDSEAR-DMA-NBR                                     04000000
040100             ,:PV-DMM-FIR-NAME                                    04010000
040200             ,:PV-DMM-LAST-NAME                                   04020000
040300             ,:PV-DEPT-DESC                                       04030000
040400             ,:MDSEAR-BYR-NBR                                     04040000
040500             ,:PV-BYR-FIR-NAME                                    04050000
040600             ,:PV-BYR-LAST-NAME                                   04060000
040700             ,:PV-MAJ-CL-DESC                                     04070000
040800         FROM TMDSEAR A                                           04080000
040900             ,TMDSEAR B                                           04090000
041000             ,TMDSEAR C                                           04100000
041100             ,TMDSEAR D                                           04110000
041200             ,TRSPBAR E                                           04120000
041300             ,TRSPBAR F                                           04130000
041400             ,TRSPBAR G                                           04140000
041500        WHERE A.OPERCO_NBR = :PC-OPERCO-NBR                       04150000
041500          AND B.OPERCO_NBR = A.OPERCO_NBR                         04151059
041500          AND C.OPERCO_NBR = A.OPERCO_NBR                         04152059
041500          AND D.OPERCO_NBR = A.OPERCO_NBR                         04153059
041600          AND A.MDSELV_CDE = :PC-MDSELV-GMA                       04160000
041700          AND B.MDSELV_CDE = :PC-MDSELV-DMA                       04170000
041800          AND C.MDSELV_CDE = :PC-MDSELV-DPT                       04180000
041900          AND D.MDSELV_CDE = :PC-MDSELV-MCL                       04190000
042000          AND A.GMA_NBR    = B.GMA_NBR                            04200000
042100          AND B.DMA_NBR    = C.DMA_NBR                            04210000
042200          AND C.DEPT_NBR   = D.DEPT_NBR                           04220000
042300          AND C.DEPT_NBR   = :MDSEAR-DEPT-NBR                     04230000
042400          AND D.MAJ_CL_NBR = :MDSEAR-MAJ-CL-NBR                   04240000
042500          AND :PV-EXTRACT-DTE BETWEEN A.STRT_DTE AND A.END_DTE    04250000
042600          AND :PV-EXTRACT-DTE BETWEEN B.STRT_DTE AND B.END_DTE    04260000
042700          AND :PV-EXTRACT-DTE BETWEEN C.STRT_DTE AND C.END_DTE    04270000
042800          AND :PV-EXTRACT-DTE BETWEEN D.STRT_DTE AND D.END_DTE    04280000
042900                                                                  04290000
043000          AND A.MDSEAR_DKEY = E.MDSEAR_DKEY                       04300000
043100          AND E.RSPLVL_CDE  = :PC-RSPLVL-CDE-GMM                  04310000
043200          AND :PV-EXTRACT-DTE BETWEEN E.WORKER_STRT_DTE AND       04320000
043300                                      E.WORKER_END_DTE            04330000
043400                                                                  04340000
043500          AND B.MDSEAR_DKEY = F.MDSEAR_DKEY                       04350000
043600          AND F.RSPLVL_CDE  = :PC-RSPLVL-CDE-DMM                  04360000
043700          AND :PV-EXTRACT-DTE BETWEEN F.WORKER_STRT_DTE AND       04370000
043800                                      F.WORKER_END_DTE            04380000
043900                                                                  04390000
044000          AND C.MDSEAR_DKEY = G.MDSEAR_DKEY                       04400000
044100          AND G.RSPLVL_CDE  = :PC-RSPLVL-CDE-BYR                  04410000
044200          AND :PV-EXTRACT-DTE BETWEEN G.WORKER_STRT_DTE AND       04420000
044300                                      G.WORKER_END_DTE            04430000
044400     END-EXEC.                                                    04440000
044500                                                                  04450000
044600     EVALUATE TRUE                                                04460000
044700         WHEN SQLCODE = ZERO                                      04470000
044800             SET MBS-INFO-FOUND     TO TRUE                       04480000
044900         WHEN SQLCODE = +100                                      04490000
045000             IF MBS-USING-MAX-DATE                                04500000
045100                DISPLAY ' '                                       04510000
045200                DISPLAY 'MBS INFO NOT FOUND FOR '                 04520000
045300                        'DEPT/MAJ CL ' MDSEAR-DEPT-NBR            04530000
045400                                   '/' MDSEAR-MAJ-CL-NBR          04540000
045500                SET MBS-NOT-USING-MAX-DATE TO TRUE                04550000
045600             END-IF                                               04560000
045700             SET MBS-INFO-NOT-FOUND        TO TRUE                04570000
045800         WHEN OTHER                                               04580000
045900             MOVE '8000-GET-EFF-MBS-MCL-INFO'                     04590051
046000                                    TO PV-PARAGRAPH-NAME          04600000
046100             MOVE 'SELECT ROW FROM TMDSEAR/TRSPBAR'               04610000
046200                                    TO PV-DB2-OPER-ATTEMPTED      04620000
046300             PERFORM 9998-SQL-ABEND                               04630000
046400     END-EVALUATE.                                                04640000
046500                                                                  04650000
038000***************************************************************** 04651051
038100* GET THE DIFFERENT LEVELS OF MBS INFO BASED DEPT/MAJCL/EXTR DTE  04652051
038200***************************************************************** 04653051
038300 8100-GET-EFF-MBS-DEPT-INFO.                                      04654051
038400                                                                  04655051
038500     EXEC SQL                                                     04656051
038600        SELECT A.GMA_NBR                                          04657051
038700              ,E.WORKER_FIR_NAME                                  04658051
038800              ,E.WORKER_LAST_NAME                                 04659051
038900              ,B.DMA_NBR                                          04659151
039000              ,F.WORKER_FIR_NAME                                  04659251
039100              ,F.WORKER_LAST_NAME                                 04659351
039200              ,C.MDSEAR_DESC                                      04659451
039300              ,C.BYR_NBR                                          04659551
039400              ,G.WORKER_FIR_NAME                                  04659651
039500              ,G.WORKER_LAST_NAME                                 04659751
039700        INTO  :MDSEAR-GMA-NBR                                     04659951
039800             ,:PV-GMM-FIR-NAME                                    04660051
039900             ,:PV-GMM-LAST-NAME                                   04660151
040000             ,:MDSEAR-DMA-NBR                                     04660251
040100             ,:PV-DMM-FIR-NAME                                    04660351
040200             ,:PV-DMM-LAST-NAME                                   04660451
040300             ,:PV-DEPT-DESC                                       04660551
040400             ,:MDSEAR-BYR-NBR                                     04660651
040500             ,:PV-BYR-FIR-NAME                                    04660751
040600             ,:PV-BYR-LAST-NAME                                   04660851
040800         FROM TMDSEAR A                                           04661051
040900             ,TMDSEAR B                                           04661151
041000             ,TMDSEAR C                                           04661251
041200             ,TRSPBAR E                                           04661451
041300             ,TRSPBAR F                                           04661551
041400             ,TRSPBAR G                                           04661651
041500        WHERE A.OPERCO_NBR = :PC-OPERCO-NBR                       04661751
041600          AND B.OPERCO_NBR = A.OPERCO_NBR                         04661857
041600          AND C.OPERCO_NBR = A.OPERCO_NBR                         04661957
041600          AND A.MDSELV_CDE = :PC-MDSELV-GMA                       04662058
041700          AND B.MDSELV_CDE = :PC-MDSELV-DMA                       04662157
041800          AND C.MDSELV_CDE = :PC-MDSELV-DPT                       04662257
042000          AND A.GMA_NBR    = B.GMA_NBR                            04662357
042100          AND B.DMA_NBR    = C.DMA_NBR                            04662457
042300          AND C.DEPT_NBR   = :MDSEAR-DEPT-NBR                     04662551
042500          AND :PV-EXTRACT-DTE BETWEEN A.STRT_DTE AND A.END_DTE    04662751
042600          AND :PV-EXTRACT-DTE BETWEEN B.STRT_DTE AND B.END_DTE    04662851
042700          AND :PV-EXTRACT-DTE BETWEEN C.STRT_DTE AND C.END_DTE    04662951
042900                                                                  04663151
043000          AND A.MDSEAR_DKEY = E.MDSEAR_DKEY                       04663251
043100          AND E.RSPLVL_CDE  = :PC-RSPLVL-CDE-GMM                  04663351
043200          AND :PV-EXTRACT-DTE BETWEEN E.WORKER_STRT_DTE AND       04663451
043300                                      E.WORKER_END_DTE            04663551
043400                                                                  04663651
043500          AND B.MDSEAR_DKEY = F.MDSEAR_DKEY                       04663751
043600          AND F.RSPLVL_CDE  = :PC-RSPLVL-CDE-DMM                  04663851
043700          AND :PV-EXTRACT-DTE BETWEEN F.WORKER_STRT_DTE AND       04663951
043800                                      F.WORKER_END_DTE            04664051
043900                                                                  04664151
044000          AND C.MDSEAR_DKEY = G.MDSEAR_DKEY                       04664251
044100          AND G.RSPLVL_CDE  = :PC-RSPLVL-CDE-BYR                  04664351
044200          AND :PV-EXTRACT-DTE BETWEEN G.WORKER_STRT_DTE AND       04664451
044300                                      G.WORKER_END_DTE            04664551
044400     END-EXEC.                                                    04664651
044500                                                                  04664751
044600     EVALUATE TRUE                                                04664851
044700         WHEN SQLCODE = ZERO                                      04664951
044800             SET MBS-INFO-FOUND     TO TRUE                       04665051
044900         WHEN SQLCODE = +100                                      04665151
045000             IF MBS-USING-MAX-DATE                                04665251
045100                DISPLAY ' '                                       04665351
045200                DISPLAY 'MBS INFO NOT FOUND FOR '                 04665451
045300                        'DEPT ' MDSEAR-DEPT-NBR                   04665551
045500                SET MBS-NOT-USING-MAX-DATE TO TRUE                04665751
045600             END-IF                                               04665851
045700             SET MBS-INFO-NOT-FOUND        TO TRUE                04665951
045800         WHEN OTHER                                               04666051
045900             MOVE '8100-GET-EFF-MBS-DEPT-INFO'                    04666151
046000                                    TO PV-PARAGRAPH-NAME          04666251
046100             MOVE 'SELECT ROW FROM TMDSEAR/TRSPBAR'               04666351
046200                                    TO PV-DB2-OPER-ATTEMPTED      04666451
046300             PERFORM 9998-SQL-ABEND                               04666551
046400     END-EVALUATE.                                                04666651
046500                                                                  04666751
046600***************************************************************** 04667051
046700* GET THE MAX MBS DATE FOR THE DEPT/MCL AT THE MCL LEVEL.  ONLY   04670000
046700* DONE WHEN THE MBS INFO CAN NOT BE FOUND FOR EXTRACT DATE RANGE  04671000
046800***************************************************************** 04680000
046900 8200-GET-LATEST-MBS-MCL-DATE.                                    04690052
047000                                                                  04700000
047100     EXEC SQL                                                     04710000
047200         SELECT MAX(END_DTE)                                      04720000
047300           INTO :MDSEAR-END-DTE :PV-MAX-MCL-DATE-NULL-IND         04730052
047400           FROM TMDSEAR                                           04740000
047500          WHERE MDSELV_CDE = :PC-MDSELV-MCL                       04750000
047600            AND DEPT_NBR   = :MDSEAR-DEPT-NBR                     04760000
047700            AND MAJ_CL_NBR = :MDSEAR-MAJ-CL-NBR                   04770000
047800     END-EXEC.                                                    04780000
047900                                                                  04790000
050300     EVALUATE TRUE                                                05030000
050400         WHEN SQLCODE = ZERO                                      05040000
050500*             IF NULL IND IS < 0, MAX END DATE WAS NOT FOUND      05050000
050600              IF PV-MAX-MCL-DATE-NULL-IND < 0                     05060052
050700                 DISPLAY ' '                                      05070000
050800                 DISPLAY 'MBS MAX END DATE NOT FOUND FOR '        05080000
050900                         'DEPT/MAJ CL ' MDSEAR-DEPT-NBR           05090000
051000                                    '/' MDSEAR-MAJ-CL-NBR         05100000
051100                 DISPLAY 'UNKNOWN WILL BE LOADED TO MBS FIELDS'   05110000
051200                 SET MBS-MAX-DATE-NOT-FOUND   TO TRUE             05120000
051300              ELSE                                                05130000
051400                 SET MBS-USING-MAX-DATE       TO TRUE             05140000
051500                 SET MBS-MAX-DATE-FOUND       TO TRUE             05150000
051600              END-IF                                              05160000
052200           WHEN OTHER                                             05220000
052300               MOVE '8200-GET-LATEST-MBS-MCL-DATE'                05230052
052400                                          TO PV-PARAGRAPH-NAME    05240000
052500               MOVE 'SELECT ROW FROM TMDSEAR'                     05250000
052600                                          TO PV-DB2-OPER-ATTEMPTED05260000
052700               PERFORM 9998-SQL-ABEND                             05270000
052800     END-EVALUATE.                                                05280000
052900                                                                  05290000
046600***************************************************************** 05291052
046700* GET THE MAX MBS DATE FOR THE DEPT AT THE DPT LEVEL.  ONLY       05292052
046700* DONE WHEN THE MBS INFO CAN NOT BE FOUND FOR EXTRACT DATE RANGE  05293052
046800***************************************************************** 05294052
046900 8300-GET-LATEST-MBS-DEPT-DATE.                                   05295052
047000                                                                  05296052
047100     EXEC SQL                                                     05297052
047200         SELECT MAX(END_DTE)                                      05298052
047300           INTO :MDSEAR-END-DTE :PV-MAX-DEPT-DATE-NULL-IND        05299052
047400           FROM TMDSEAR                                           05299152
047500          WHERE MDSELV_CDE = :PC-MDSELV-DPT                       05299252
047600            AND DEPT_NBR   = :MDSEAR-DEPT-NBR                     05299352
047800     END-EXEC.                                                    05299552
047900                                                                  05299652
050300     EVALUATE TRUE                                                05299752
050400         WHEN SQLCODE = ZERO                                      05299852
050500*             IF NULL IND IS < 0, MAX END DATE WAS NOT FOUND      05299952
050600              IF PV-MAX-DEPT-DATE-NULL-IND < 0                    05300052
050700                 DISPLAY ' '                                      05300152
050800                 DISPLAY 'MBS MAX END DATE NOT FOUND FOR '        05300252
050900                         'DEPT ' MDSEAR-DEPT-NBR                  05300352
051100                 DISPLAY 'UNKNOWN WILL BE LOADED TO MBS FIELDS'   05300552
051200                 SET MBS-MAX-DATE-NOT-FOUND   TO TRUE             05300652
051300              ELSE                                                05300752
051400                 SET MBS-USING-MAX-DATE       TO TRUE             05300852
051500                 SET MBS-MAX-DATE-FOUND       TO TRUE             05300952
051600              END-IF                                              05301052
052200           WHEN OTHER                                             05301152
052300               MOVE '8300-GET-LATEST-MBS-DEPT-DATE'               05301252
052400                                          TO PV-PARAGRAPH-NAME    05301352
052500               MOVE 'SELECT ROW FROM TMDSEAR'                     05301452
052600                                          TO PV-DB2-OPER-ATTEMPTED05301552
052700               PERFORM 9998-SQL-ABEND                             05301652
052800     END-EVALUATE.                                                05301752
052900                                                                  05301852
053000***************************************************************** 05302052
053100* GET VENDOR NAME (PRIMARY NAME - TYPE CODE = 01)                 05310000
053200***************************************************************** 05320000
053300 8400-GET-VENDOR-NAME.                                            05330052
053400                                                                  05340000
053500     EXEC SQL                                                     05350000
053600         SELECT ENT_NAME_DESC                                     05360000
053700          INTO: ENTNME-ENT-NAME-DESC                              05370000
053800          FROM  TENTNME A                                         05380000
053900               ,TEXTENT B                                         05390000
054000         WHERE A.ENT_ID   = B.ENT_ID                              05400000
054100           AND A.TYPE_CDE = '01'                                  05410000
054200           AND A.ENT_ID   = :ENTNME-ENT-ID                        05420000
054300     END-EXEC.                                                    05430000
054400                                                                  05440000
054500     EVALUATE TRUE                                                05450000
054600         WHEN SQLCODE = 0                                         05460000
054700             MOVE ENTNME-ENT-NAME-DESC   TO PV-VENDOR-NAME        05470000
054800         WHEN SQLCODE = +100                                      05480000
054900             MOVE 'VENDOR NOT FOUND'     TO PV-VENDOR-NAME        05490000
055000         WHEN OTHER                                               05500000
055100             MOVE '8400-GET-VENDOR-NAME' TO PV-DB2-OPER-ATTEMPTED 05510052
055200             PERFORM 9998-SQL-ABEND                               05520000
055300     END-EVALUATE.                                                05530000
055400                                                                  05540000
055500***************************************************************** 05550000
055600* BUILD SQL ABEND INFO                                            05560000
055700***************************************************************** 05570000
055800 9998-SQL-ABEND.                                                  05580000
055900                                                                  05590000
056000     MOVE +4013 TO ABEND-CODE.                                    05600000
056100     DISPLAY ' '.                                                 05610000
056200     DISPLAY '** ABEND **         ** = SQLERROR'.                 05620000
056300     DISPLAY '** PROGRAM          ** = MLKUT602'.                 05630000
056400     DISPLAY '** PARAGRAPH        ** = ' PV-PARAGRAPH-NAME.       05640000
056500     DISPLAY '** OPERATION        ** = ' PV-DB2-OPER-ATTEMPTED.   05650000
056600                                                                  05660000
056700*    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         05670000
056800*    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        05680000
056900     COPY DPPD004.                                                05690000
057000                                                                  05700000
057100     PERFORM 9999-ABEND.                                          05710000
057200                                                                  05720000
057300***************************************************************** 05730000
057400* ABEND PROCESSING                                                05740000
057500***************************************************************** 05750000
057600 9999-ABEND.                                                      05760000
057700                                                                  05770000
057800     CALL 'ILBOABN0'  USING ABEND-CODE.                           05780000
