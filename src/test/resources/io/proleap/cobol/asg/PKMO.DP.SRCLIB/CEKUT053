000100******************************************************************00001000
000200 IDENTIFICATION DIVISION.                                         00002000
000300******************************************************************00003000
000400                                                                  00004000
000500 PROGRAM-ID.             CEKUT053.                                00005000
000600 AUTHOR.                 CHERI PARMLEY.                           00006000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00007000
000800 DATE-WRITTEN            MAY, 2016.                               00008000
000900 DATE-COMPILED.                                                   00009000
001000                                                                  00009100
001100*----------------------------------------------------------------*00009200
001200* THIS PROGRAM WILL CREATE 2 FILES FOR OUTPUT FROM READING       *00009300
001300* THE SORTED CARTON FILE. IT WILL READ THE FILE AND PUT THE      *00009400
001400* CURRENT RECORD IN A 'HOLD' FIELD. READ THE NEXT RECORD.        *00009500
001500* DUPLICATE RECORDS GO TO THE DUP FILE  (ALL DUPLICATES GO TO    *00009600
001500* THAT FILE, NONE OF THE DUPLICATES WOULD GO TO THE GOOD FILE)   *00009700
001600*                                                                *00009800
001700* WHEN DONE WE WILL HAVE TWO FILES - ONE WITH GOOD RECORDS AND   *00009900
001800* THE OTHER WITH DUPLICATE RECORDS.                              *00010000
001800*                                                                *00010100
001800* 01/09/2020  JEAN KURK                                          *00010200
001800*             RENAME FROM WMKUT053 TO CEKUT053                   *00010300
002600*----------------------------------------------------------------*00011000
002700                                                                  00012000
002800***************************************************************** 00013000
002900 ENVIRONMENT DIVISION.                                            00014000
003000***************************************************************** 00015000
003100 INPUT-OUTPUT SECTION.                                            00016000
003200                                                                  00017000
003300 FILE-CONTROL.                                                    00018000
003400                                                                  00019000
003500     SELECT SORTD-CARTON-FILE ASSIGN TO INP01.                    00019100
003600     SELECT EXTRACT-FILE1     ASSIGN TO OUT01.                    00019200
003700     SELECT EXTRACT-FILE2     ASSIGN TO OUT02.                    00019300
003800                                                                  00019400
003900***************************************************************** 00019500
004000 DATA DIVISION.                                                   00019600
004100***************************************************************** 00019700
004200 FILE SECTION.                                                    00019800
004300*                                                                 00019900
004400*                                                                 00020000
004500 FD  SORTD-CARTON-FILE                                            00021000
004600     RECORDING MODE IS F                                          00022000
004700     LABEL RECORDS ARE STANDARD                                   00023000
004800     BLOCK CONTAINS 0 RECORDS.                                    00024000
004900 01  SORTD-CARTON-RECORD         PIC X(91).                       00025000
005000*                                                                 00026000
005100 FD  EXTRACT-FILE1                                                00027000
005200     RECORDING MODE IS F                                          00028000
005300     LABEL RECORDS ARE STANDARD                                   00029000
005400     BLOCK CONTAINS 0 RECORDS.                                    00029100
005500 01  EXTRACT-RECORD1             PIC X(91).                       00029200
005600*                                                                 00029300
005700 FD  EXTRACT-FILE2                                                00029400
005800     RECORDING MODE IS F                                          00029500
005900     LABEL RECORDS ARE STANDARD                                   00029600
006000     BLOCK CONTAINS 0 RECORDS.                                    00029700
006100 01  EXTRACT-RECORD2             PIC X(91).                       00029800
006200*                                                                 00029900
006300***************************************************************** 00030000
006400 WORKING-STORAGE SECTION.                                         00031000
006500                                                                  00032000
006600 01  PS-PROGRAM-SWITCHES.                                         00033000
006700     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         00034000
006800         88  PS-ERROR                         VALUE  'Y'.         00035000
006900         88  PS-WARNING                       VALUE  'W'.         00036000
007000         88  PS-NO-ERROR                      VALUE  'N'.         00037000
007100     05  PS-END-OF-SORTD-CARTON-SW PIC X(01)  VALUE 'N'.          00038000
007200         88  PS-END-OF-SORTD-CART-FILE        VALUE 'Y'.          00039000
007300         88  PS-NOT-END-OF-SORTD-CART-FILE    VALUE 'N'.          00039100
007400     05  PS-WRITE-EXTR1-SW         PIC X(01)  VALUE 'N'.          00039200
007500         88  PS-WRITE-EXTR1                   VALUE 'Y'.          00039300
007600         88  PS-WRITE-EXTR1-DEFAULT           VALUE 'N'.          00039400
007700     05  PS-WRITE-EXTR2-SW         PIC X(01)  VALUE 'N'.          00039500
007800         88  PS-WRITE-EXTR2                   VALUE 'Y'.          00039600
007900         88  PS-WRITE-EXTR2-DEFAULT           VALUE 'N'.          00039700
008000     05  PS-DAY-PARM-SW            PIC X(01)  VALUE 'N'.          00039800
008100         88  PS-DAY-PARM-OK                   VALUE 'Y'.          00039900
008200         88  PS-DAY-PARM-NOT-OK               VALUE 'N'.          00040000
008000     05  PS-LAST-REC-DUP-SW        PIC X(01)  VALUE 'N'.          00041000
               88  PS-LAST-REC-WAS-DUP              VALUE 'Y'.          00042000
               88  PS-LAST-REC-WAS-NOT-DUP          VALUE 'N'.          00043000
           05  PS-EMAIL-SW                  PIC X(01)  VALUE 'N'.       00044000
               88  PS-EMAIL-YES                        VALUE 'Y'.       00045000
               88  PS-EMAIL-NO                         VALUE 'N'.       00046000
008300                                                                  00047000
008400*                                                                 00048000
008500 01  PV-PROGRAM-VARIABLES.                                        00049000
008600     05  PV-HOLD-CONTAINER-ID          PIC  X(20) VALUE SPACE.    00049100
008600     05  PV-HOLD-RECORD                PIC  X(91) VALUE SPACE.    00049200
008600     05  PV-MINUS-P2L-HOURS            PIC  X(26).                00049300
008700     05  PV-DEFAULT-TMST               PIC  X(26) VALUE           00049400
008800            '9999-09-09-09.09.09.999999'.                         00049500
008900     05  PV-DISPLAY-PO-NBR               PIC 999999999-.          00049600
009000     05  PV-DISPLAY-PO-LINE-NBR          PIC 999999999-.          00049700
009100     05  PV-DISPLAY-RCVR-SEQ-NBR         PIC 999999999-.          00049800
009200     05  PV-CURRENT-TIMESTAMP     PIC X(26)   VALUE               00049900
009300                                                 SPACES.          00050000
009400     05  PV-EXTRACT-DTE                PIC X(10).                 00050100
009500                                                                  00050200
009600     05  PV-CRE-DATE-TMST              PIC X(10).                 00050300
009700     05  PV-CRE-TIME-TMST              PIC X(8).                  00050400
009800                                                                  00050500
009900     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(30) VALUE SPACES.    00050600
010000     05  PV-DISPLAY-SQLCODE           PIC -9(05) VALUE ZEROES.    00050700
010100     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    00050800
010200     05  PV-DB2-TABLE-NAME            PIC  X(08) VALUE SPACES.    00050900
010300     05  PV-DB2-TABLE-NAME1           PIC  X(08) VALUE SPACES.    00051000
010400     05  PV-DB2-FUNCTION             PIC X(30) VALUE SPACE.       00052000
010500                                                                  00053000
010600     05  PV-READ-COUNT                PIC S9(09) VALUE ZERO       00054000
010700                                                  COMP SYNC.      00055000
010800     05  PV-WRITE-EXTR1-COUNT         PIC S9(09) VALUE ZERO       00056000
010900                                                  COMP SYNC.      00057000
011000     05  PV-WRITE-EXTR2-COUNT         PIC S9(09) VALUE ZERO       00058000
011100                                                  COMP SYNC.      00059000
011200     05  PV-DISPLAY-READ-CNT          PIC ZZZ,ZZZ,ZZ9.            00059100
011300     05  PV-DISPLAY-WRITE-CNT1        PIC ZZZ,ZZZ,ZZ9.            00059200
011400     05  PV-DISPLAY-WRITE-CNT2        PIC ZZZ,ZZZ,ZZ9.            00059300
011500                                                                  00059400
011600     05  PV-DB2-CURRENT-TIMESTAMP     PIC X(26)  VALUE SPACE.     00059500
011700     05  PV-WORK-TMST.                                            00059600
011800         10  PV-WORK-TMST-1.                                      00059700
011900             15  PV-WK-CCYY           PIC  X(04)  VALUE SPACE.    00059800
012000             15  FILLER               PIC  X(01)  VALUE SPACE.    00059900
012100             15  PV-WK-MO             PIC  X(02)  VALUE SPACE.    00060000
012200             15  FILLER               PIC  X(01)  VALUE SPACE.    00061000
012300             15  PV-WK-DA             PIC  X(02)  VALUE SPACE.    00062000
012400         10  PV-WORK-TMST-2.                                      00063000
012500             15  FILLER               PIC  X(01)  VALUE SPACE.    00064000
012600             15  PV-WK-HH             PIC  X(02)  VALUE SPACE.    00065000
012700             15  FILLER               PIC  X(01)  VALUE SPACE.    00066000
012800             15  PV-WK-MM             PIC  X(02)  VALUE SPACE.    00067000
012900             15  FILLER               PIC  X(01)  VALUE SPACE.    00068000
013000             15  PV-WK-SS             PIC  X(02)  VALUE SPACE.    00069000
013100             15  FILLER               PIC  X(01)  VALUE SPACE.    00069100
013200             15  FILLER               PIC  X(06)  VALUE ZERO.     00069200
013300     05  PV-LK-DTE-ISO.                                           00069300
013400         10  PV-LK-DTE-CCYY           PIC  X(04)  VALUE SPACE.    00069400
013500         10  PV-LK-DTE-MO             PIC  X(02)  VALUE SPACE.    00069500
013600         10  PV-LK-DTE-DD             PIC  X(02)  VALUE SPACE.    00069600
013700     05  PV-FROM-PARAGRAPH        PIC X(35)   VALUE               00069700
013800                                                 SPACES.          00069800
013900     05  PV-INPUT-DATE.                                           00069900
014000         10  PV-INPUT-DATE-MM     PIC 9(2)     VALUE ZEROES.      00070000
014100         10  FILLER               PIC X(1)     VALUE SPACES.      00071000
014200         10  PV-INPUT-DATE-DD     PIC 9(2)     VALUE ZEROES.      00072000
014300         10  FILLER               PIC X(1)     VALUE SPACES.      00073000
014400         10  PV-INPUT-DATE-CCY    PIC 9(4)     VALUE ZEROES.      00074000
014500                                                                  00075000
014600     05  PV-CURR-DATE-JULIAN      PIC X(07).                      00076000
014700     05  PV-CURR-DATE-JULIAN-N REDEFINES                          00077000
014800            PV-CURR-DATE-JULIAN   PIC 9(07).                      00078000
014900                                                                  00079000
015000     05  PV-VFY-DATE-JULIAN       PIC X(07).                      00079100
015100     05  PV-VFY-DATE-JULIAN-N REDEFINES                           00079200
015200            PV-VFY-DATE-JULIAN    PIC 9(07).                      00079300
015300                                                                  00079400
015400     05  PV-RCVD-DATE-JULIAN      PIC X(07).                      00079500
015500     05  PV-RCVD-DATE-JULIAN-N REDEFINES                          00079600
015600            PV-RCVD-DATE-JULIAN   PIC 9(07).                      00079700
015700                                                                  00079800
015800     05  PV-DIFFERENCE            PIC X(07).                      00079900
015900     05  PV-DIFFERENCE-N REDEFINES                                00080000
016000            PV-DIFFERENCE         PIC 9(07).                      00081000
016100     05  PV-VEMFDY-QTY-DAYS       PIC  S9(9) COMP.                00082000
016200     05  PV-P2LHRS-QTY-HRS        PIC  S9(9) COMP.                00083000
016300                                                                  00084000
016400 01  DK-DB-KEYS.                                                  00085000
016500     05  DK-PO-NBR                   PIC S9(09) COMP.             00086000
016600     05  DK-REC-SEQ-NBR              PIC S9(09) COMP.             00087000
016700     05  DK-LINE-NBR                 PIC S9(09) COMP.             00088000
016800     05  DK-OPER-UNT-ID              PIC S9(04) COMP.             00089000
016900                                                                  00089100
017000 01 PC-PROGRAM-CONSTANTS.                                         00089200
017100     05 PC-PROGRAM-NAME              PIC X(08)  VALUE 'CEKUT053'. 00089300
017200     05 PC-DEFAULT-TMST              PIC X(26)                    00089400
017300             VALUE '9999-09-09-09.09.09.999999'.                  00089500
017400     05 PC-0                         PIC X(01)  VALUE '0'.        00089600
017500                                                                  00089700
017600                                                                  00089800
017700 01  PV-ABEND-FIELDS.                                             00089900
017800     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         00090000
017900                                                 COMP SYNC.       00091000
018000     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'CEKUT053'.00092000
018100     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00093000
018200     05  PV-ABEND-OPERATION1          PIC  X(51) VALUE SPACES.    00094000
018300     05  PV-ABEND-OPERATION2          PIC  X(51) VALUE SPACES.    00095000
018400     05  PV-ABEND-OPERATION3          PIC  X(51) VALUE SPACES.    00096000
018500                                                                  00097000
018600******************************************************************00098000
018700*  USED FOR DB2 ERROR MESSAGE BUILDING                            00099000
018800******************************************************************00099100
018900     COPY DPWS004.                                                00099200
019000                                                                  00099300
019100*----------------------------------------------------------------*00099400
019200*    ABEND PROCESSING COPYBOOK.                                  *00099500
019300*----------------------------------------------------------------*00099600
019400                                                                  00099700
019500     COPY DPWS013.                                                00099800
019600*----------------------------------------------------------------*00099900
019700*  WORK AREA PASSED IN CALL TO DPKUT500                          *00100000
019800*----------------------------------------------------------------*00101000
019900     COPY DPWS500.                                                00102000
023800******************************************************************00103000
023900                                                                  00104000
024000                                                                  00105000
024100***********************************************************       00106000
024200*  RECORD LAYOUT FOR THE CARTON EXTRACT FILE                      00107000
024300***********************************************************       00108000
024400     COPY CERD024.                                                00109000
024500                                                                  00110000
024600 EJECT                                                            00120000
024700***********************************************************       00130000
024800 PROCEDURE DIVISION.                                              00131000
024900***********************************************************       00132000
025000     DISPLAY '***BEGINNING CEKUT053***'.                          00133000
011200     DISPLAY ' '.                                                 00133100
025100                                                                  00133200
025200     PERFORM 1000-INITIALIZE.                                     00133300
025300                                                                  00133400
025400     PERFORM 2000-PROCESS-SORTD-CARTON-FILE                       00133500
025500         UNTIL PS-END-OF-SORTD-CART-FILE.                         00133600
025600                                                                  00133700
025700     IF PS-END-OF-SORTD-CART-FILE                                 00133800
025800        PERFORM 2200-LAST-RECORD-CHECK                            00133900
025900     END-IF.                                                      00134000
026000                                                                  00135000
027200     CLOSE SORTD-CARTON-FILE                                      00136000
027300           EXTRACT-FILE1                                          00137000
027400           EXTRACT-FILE2.                                         00138000
027500                                                                  00139000
      *    SET RETURN CODE IF E-MAIL SWITCH IS TRUE.                    00139100
           IF PS-EMAIL-YES                                              00139200
               MOVE 4095 TO RETURN-CODE                                 00139300
           END-IF.                                                      00139400
                                                                        00139500
026100     MOVE PV-READ-COUNT           TO PV-DISPLAY-READ-CNT.         00139600
026200     DISPLAY 'TOTAL RECORDS READ     = '  PV-DISPLAY-READ-CNT.    00139700
026300                                                                  00139800
026400     MOVE PV-WRITE-EXTR1-COUNT    TO PV-DISPLAY-WRITE-CNT1.       00139900
026500     DISPLAY 'TOTAL NON DUPS WRITTEN = '                          00140000
026600                            PV-DISPLAY-WRITE-CNT1.                00140100
026700                                                                  00140200
026800     MOVE PV-WRITE-EXTR2-COUNT    TO PV-DISPLAY-WRITE-CNT2.       00140300
026900     DISPLAY '    TOTAL DUPS WRITTEN = '                          00140400
027000                            PV-DISPLAY-WRITE-CNT2.                00140500
012800     DISPLAY ' '.                                                 00140600
012900     DISPLAY '****  END OF  CEKUT053  ****'.                      00140700
027100                                                                  00140800
027600     GOBACK.                                                      00140900
027700                                                                  00141000
027800                                                                  00142000
027900***********************************************************       00143000
028000*  DO FIRST TIME PROGRAM INITIALIZE TASKS.                        00144000
028100 1000-INITIALIZE.                                                 00145000
028200***********************************************************       00146000
028300     OPEN INPUT  SORTD-CARTON-FILE                                00147000
028400          OUTPUT EXTRACT-FILE1                                    00148000
028500          OUTPUT EXTRACT-FILE2.                                   00149000
028600                                                                  00150000
028700     INITIALIZE CE024-CONTAINER-UPLOAD-RECORD.                    00151000
028800                                                                  00152000
028900*FIRST READ                                                       00153000
029000     PERFORM 7100-READ-SORTD-CARTON-FILE.                         00154000
029100                                                                  00155000
029200     IF PS-END-OF-SORTD-CART-FILE                                 00156000
029300         DISPLAY '** CARTON FILE IS EMPTY **'                     00157000
           END-IF.                                                      00158000
029900                                                                  00159000
           SET PS-EMAIL-NO      TO TRUE.                                00160000
033600                                                                  00170000
033700***************************************************************** 00171000
033800 2000-PROCESS-SORTD-CARTON-FILE.                                  00172000
033900***************************************************************** 00173000
034000     MOVE '2000-PROCESS-SORTD-CARTON-FILE' TO PV-ABEND-PARAGRAPH. 00174000
034100                                                                  00175000
034500     IF PS-END-OF-SORTD-CART-FILE                                 00176000
034600         CONTINUE                                                 00177000
034700     ELSE                                                         00178000
034800         IF CE024-CONTAINER-ID NOT = PV-HOLD-CONTAINER-ID         00179000
                   IF PS-LAST-REC-WAS-DUP                               00180000
037300               PERFORM 8100-WRITE-EXTRACT2                        00181000
029500                MOVE CE024-CONTAINER-ID TO PV-HOLD-CONTAINER-ID   00182000
                      MOVE CE024-CONTAINER-UPLOAD-RECORD TO             00183000
                           PV-HOLD-RECORD                               00184000
                      SET PS-LAST-REC-WAS-NOT-DUP TO TRUE               00185000
                   ELSE                                                 00186000
      *               GOOD FILE                                         00187000
036900                PERFORM 8000-WRITE-EXTRACT1                       00188000
029500                MOVE CE024-CONTAINER-ID TO PV-HOLD-CONTAINER-ID   00189000
                      MOVE CE024-CONTAINER-UPLOAD-RECORD TO             00189100
                           PV-HOLD-RECORD                               00189200
                   END-IF                                               00189300
035200         ELSE                                                     00189400
      *            DUPLICATE FILE                                       00189500
037300             PERFORM 8100-WRITE-EXTRACT2                          00189600
029500             MOVE CE024-CONTAINER-ID TO PV-HOLD-CONTAINER-ID      00189700
                   MOVE CE024-CONTAINER-UPLOAD-RECORD TO PV-HOLD-RECORD 00189800
                   SET PS-LAST-REC-WAS-DUP TO TRUE                      00189900
035400         END-IF                                                   00190000
038200     END-IF.                                                      00200000
038300                                                                  00201000
034200*NEXT READ                                                        00202000
028700     INITIALIZE CE024-CONTAINER-UPLOAD-RECORD.                    00203000
034300     PERFORM 7100-READ-SORTD-CARTON-FILE.                         00203100
038400                                                                  00203200
       2200-LAST-RECORD-CHECK.                                          00203300
075700                                                                  00203400
034800     IF CE024-CONTAINER-ID NOT = PV-HOLD-CONTAINER-ID             00203500
               IF PS-LAST-REC-WAS-DUP                                   00203600
037300           PERFORM 8100-WRITE-EXTRACT2                            00203700
029500           MOVE CE024-CONTAINER-ID TO PV-HOLD-CONTAINER-ID        00203800
                 MOVE CE024-CONTAINER-UPLOAD-RECORD TO                  00203900
                      PV-HOLD-RECORD                                    00204000
                 SET PS-LAST-REC-WAS-NOT-DUP TO TRUE                    00205000
               ELSE                                                     00206000
      *          GOOD FILE                                              00207000
036900           PERFORM 8000-WRITE-EXTRACT1                            00208000
029500           MOVE CE024-CONTAINER-ID TO PV-HOLD-CONTAINER-ID        00209000
                 MOVE CE024-CONTAINER-UPLOAD-RECORD TO                  00210000
                      PV-HOLD-RECORD                                    00220000
              END-IF                                                    00230000
035200     ELSE                                                         00240000
      *       DUPLICATE FILE                                            00250000
037300        PERFORM 8100-WRITE-EXTRACT2                               00260000
029500        MOVE CE024-CONTAINER-ID TO PV-HOLD-CONTAINER-ID           00270000
              MOVE CE024-CONTAINER-UPLOAD-RECORD TO PV-HOLD-RECORD      00280000
              SET PS-LAST-REC-WAS-DUP TO TRUE                           00290000
035400     END-IF.                                                      00300000
075800                                                                  00310000
075900***************************************************************** 00320000
076000 7100-READ-SORTD-CARTON-FILE.                                     00330000
076100******************************************************************00340000
076200     READ SORTD-CARTON-FILE INTO CE024-CONTAINER-UPLOAD-RECORD    00350000
076300        AT END                                                    00360000
076400           SET PS-END-OF-SORTD-CART-FILE TO TRUE                  00370000
076500        NOT AT END                                                00380000
076600           ADD +1 TO PV-READ-COUNT                                00390000
076700           CONTINUE                                               00400000
076800     END-READ.                                                    00401000
076900                                                                  00402000
077000                                                                  00403000
077100******************************************************************00404000
077000*GOOD FILE                                                        00405000
077100******************************************************************00406000
077200 8000-WRITE-EXTRACT1.                                             00407000
077300******************************************************************00408000
           IF PV-HOLD-CONTAINER-ID = SPACES                             00409000
              CONTINUE                                                  00409100
           ELSE                                                         00409200
077400         WRITE EXTRACT-RECORD1                                    00409300
077500           FROM PV-HOLD-RECORD                                    00409400
037200           ADD +1 TO PV-WRITE-EXTR1-COUNT                         00409500
           END-IF.                                                      00409600
077700                                                                  00409700
077100******************************************************************00409800
077000*BAD FILE                                                         00409900
077100******************************************************************00410000
077900 8100-WRITE-EXTRACT2.                                             00410100
078000******************************************************************00410200
           IF PV-HOLD-CONTAINER-ID = SPACES                             00410300
              CONTINUE                                                  00410400
           ELSE                                                         00410500
078100        WRITE EXTRACT-RECORD2                                     00410600
077500          FROM PV-HOLD-RECORD                                     00410700
037200          ADD +1 TO PV-WRITE-EXTR2-COUNT                          00410800
      *       SET SWITCH FOR E-MAIL NOTIFICATION OF ERRORS              00410900
              SET PS-EMAIL-YES       TO TRUE                            00411000
           END-IF.                                                      00412000
078400                                                                  00413000
