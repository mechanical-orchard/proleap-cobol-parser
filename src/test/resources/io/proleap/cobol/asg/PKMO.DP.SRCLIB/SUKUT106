000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.    SUKUT106.                                         00020001
000300 AUTHOR.        DENNIS STEFFEN.                                   00030001
000400 INSTALLATION.  KOHLS.                                            00040001
000500 DATE-WRITTEN   JANUARY 2005.                                     00050001
000600 DATE-COMPILED.                                                   00060001
000700 ENVIRONMENT DIVISION.                                            00070001
000800 CONFIGURATION SECTION.                                           00080001
000900                                                                  00090001
001000 SOURCE-COMPUTER.        IBM-3090.                                00100001
001100 OBJECT-COMPUTER.        IBM-3090.                                00110001
001200                                                                  00120001
001300 INPUT-OUTPUT SECTION.                                            00130001
001400 FILE-CONTROL.                                                    00140001
001500                                                                  00150001
001600     SELECT EMPTY-CARTON-FILE                                     00160001
001700         ASSIGN TO INP01.                                         00170001
001800                                                                  00180001
001900     SELECT CARTON-DETAIL-FILE                                    00190001
002000         ASSIGN TO OUT01.                                         00200001
002100                                                                  00210001
002200     SELECT CARTON-TRIP-FILE                                      00220001
002300         ASSIGN TO OUT02.                                         00230001
002400                                                                  00240001
002500     SELECT STILL-EMPTY-CARTON-FILE                               00250001
002600         ASSIGN TO OUT03.                                         00260001
002700                                                                  00270001
002800 DATA DIVISION.                                                   00280001
002900 FILE SECTION.                                                    00290001
003000                                                                  00300001
003100*    CARRIED OVER FROM PREVIOUS RUN                               00310001
003200 FD  EMPTY-CARTON-FILE                                            00320001
003300     RECORDING MODE IS F                                          00330001
003400     LABEL RECORDS ARE STANDARD                                   00340001
003500     BLOCK CONTAINS 0 RECORDS.                                    00350001
003600 01  EMPTY-CARTON-REC                 PIC X(125).                 00360001
003700                                                                  00370001
003800*    THIS STUFF FLOWS INTO IN-TRANSIT                             00380001
003900 FD  CARTON-DETAIL-FILE                                           00390001
004000     RECORDING MODE IS F                                          00400001
004100     LABEL RECORDS ARE STANDARD                                   00410001
004200     BLOCK CONTAINS 0 RECORDS.                                    00420001
004300 01  CARTON-DETAIL-RECORD             PIC X(100).                 00430001
004400                                                                  00440001
004500                                                                  00450001
004600*    THIS STUFF FLOWS INTO IN-TRANSIT                             00460001
004700 FD  CARTON-TRIP-FILE                                             00470001
004800     RECORDING MODE IS F                                          00480001
004900     LABEL RECORDS ARE STANDARD                                   00490001
005000     BLOCK CONTAINS 0 RECORDS.                                    00500001
005100 01  CARTON-TRIP-RECORD               PIC  X(050).                00510001
005200                                                                  00520001
005300*    CARRY THIS STUFF TO THE NEXT RUN                             00530001
005400 FD  STILL-EMPTY-CARTON-FILE                                      00540001
005500     RECORDING MODE IS F                                          00550001
005600     LABEL RECORDS ARE STANDARD                                   00560001
005700     BLOCK CONTAINS 0 RECORDS.                                    00570001
005800 01  STILL-EMPTY-CARTON-REC           PIC X(125).                 00580001
005900                                                                  00590001
006000 WORKING-STORAGE SECTION.                                         00600001
006100                                                                  00610001
006200 01  PV-EMPTY-CARTON-REC.                                         00620001
006300*    INPUT FILE                                                   00630001
006400     COPY SURD056.                                                00640001
006500*                                                                 00650001
006600*  CARTON OUTPUT FILE LAYOUT                                      00660001
006700     COPY PCRD010.                                                00670001
006800                                                                  00680001
006900*  CARTON TRIP EXTRACT FILE                                       00690001
007000     COPY SURD043.                                                00700001
007100                                                                  00710001
007200*    EMPTY CARTON FILE OUTPUT                                     00720001
007300 01  PV-STILL-EMPTY-CARTON-REC.                                   00730001
007400     COPY SURD056.                                                00740001
007500                                                                  00750001
007600 01  PV-WHEN-COMPILED.                                            00760001
007700     05  PV-COMPILE-DATE          PIC X(08).                      00770001
007800     05  PV-COMPILE-TIME          PIC X(08).                      00780001
007900                                                                  00790001
008000 01  PS-PROGRAM-SWITCHES.                                         00800001
008100     05  PS-END-OF-FILE-SW           PIC  X(01)    VALUE 'N'.     00810001
008200         88  PS-END-OF-FILE                        VALUE 'Y'.     00820001
008300         88  PS-NOT-END-OF-FILE                    VALUE 'N'.     00830001
008400     05  PS-END-OF-CSR-SW            PIC  X(01)    VALUE 'N'.     00840001
008500         88  PS-END-OF-CSR-YES                     VALUE 'Y'.     00850001
008600         88  PS-END-OF-CSR-NO                      VALUE 'N'.     00860001
008700                                                                  00870001
008800 01  DK-KEYS.                                                     00880001
008900     05  DK-SHIPT-UNT-ID              PIC S9(18)V COMP-3          00890001
009000                                                  VALUE ZERO.     00900001
009100     05  DK-OTBND-TRIP-ID             PIC S9(09)  COMP            00910001
009200                                                  VALUE ZERO.     00920001
009300                                                                  00930001
009400 01  PC-PROGRAM-CONSTANTS.                                        00940001
009500     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08) VALUE 'SUKUT106'. 00950001
009600     05  PC-CURRENT-OPERATING-COMPANY PIC  X(02) VALUE '03'.      00960001
009700     05  PC-MAX-RETRIES              PIC S9(04)    VALUE +3       00970001
009800                                                   COMP SYNC.     00980001
009900     05  PC-CURRENT-TIMESTAMP        PIC  X(26)    VALUE SPACES.  00990001
010000     05  PC-DEFAULT-TIMESTAMP         PIC X(26)   VALUE           01000001
010100                                   '9999-09-09-09.09.09.999999'.  01010001
010200                                                                  01020001
010300 01  PV-PROGRAM-VARIABLES.                                        01030001
010310     05  PV-SU-FINCL-POST-TMST       PIC  X(26)    VALUE SPACES.  01031007
010320     05  PV-SU-OTBND_STAT_TMST       PIC  X(26)    VALUE SPACES.  01032019
010400     05  PV-TMST                      PIC X(28) VALUE SPACES.     01040001
010500     05  PV-ITEM-NBR                 PIC  9(15)    VALUE ZERO.    01050001
010600     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  01060001
010700     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01070001
010800     05  PV-CARTON-CDE.                                           01080001
010900         10  FILLER                  PIC X(2)      VALUE '00'.    01090001
011000         10  PV-CARTON-ID            PIC X(18)     VALUE SPACES.  01100001
011100         10  FILLER                  PIC X(2)      VALUE SPACES.  01110001
011200     05  PV-CARTON REDEFINES PV-CARTON-CDE                        01120001
011300                                     PIC X(22).                   01130001
011400     05  PV-PO-NBR                   PIC S9(9) COMP.              01140001
011500     05  PV-RCVR-SEQ-NBR             PIC S9(9) COMP.              01150001
011600     05  PV-STAT-CDE                 PIC X(2) VALUE SPACES.       01160001
011700     05  PV-KOHLS-SML-HOLD           PIC S9(18)V VALUE ZERO       01170001
011800                                                 COMP-3.          01180001
011900     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             01190001
012000     05  PV-DISPLAY-SML              PIC 999999999999999999.      01200001
012100     05  PV-DISPLAY-LINE             PIC X(080) VALUE SPACES.     01210001
012200     05  PV-DISP-CTN                 PIC 9(18) VALUE ZERO.        01220001
012300     05  PV-DISP-TRIP                PIC 9(09) VALUE ZERO.        01230001
012400     05  PV-STAT-TMST                PIC X(26) VALUE SPACES.      01240001
012500                                                                  01250001
012600     05  PV-PREV-KEY.                                             01260001
012700         10  PV-PREV-TRIP             PIC 9(09) VALUE ZERO.       01270001
012800         10  PV-PREV-CTN              PIC 9(18) VALUE ZERO.       01280001
012900     05  PV-CURR-KEY.                                             01290001
013000         10  PV-CURR-TRIP             PIC 9(09) VALUE ZERO.       01300001
013100         10  PV-CURR-CTN              PIC 9(18) VALUE ZERO.       01310001
013200                                                                  01320001
013300 01  PV-COUNTERS COMP-3.                                          01330001
013400     05  PV-READ-COUNT               PIC S9(09) VALUE ZERO.       01340001
013500     05  PV-UPC-COUNT                PIC S9(09) VALUE ZERO.       01350001
013510     05  PV-AGED-RECORD-COUNT        PIC S9(09) VALUE ZERO.       01351003
013600     05  PV-CARTON-COUNT             PIC S9(09) VALUE ZERO.       01360001
013700     05  PV-EMPTY-CARTON-COUNT       PIC S9(09) VALUE ZERO.       01370001
013800     05  PV-DB2-COUNT                PIC S9(09) VALUE ZERO.       01380001
013900     05  PV-CTN-UPC-COUNT            PIC S9(09) VALUE ZERO.       01390001
014000/                                                                 01400001
014100*  DB2 FORMATTED MESSAGE AREA                                     01410001
014200     COPY DPWS004.                                                01420001
014300*                                                                 01430001
014400     EXEC SQL                                                     01440001
014500          INCLUDE SQLCA                                           01450001
014600     END-EXEC.                                                    01460001
014700*                                                                 01470001
014800*     OUTBOUND TRAILER TRIP                                       01480001
014900     EXEC SQL                                                     01490001
015000          INCLUDE TSUOBTR                                         01500001
015100     END-EXEC.                                                    01510001
015200                                                                  01520001
015300*    OUTBOUND TRAILER TRIP STATUS                                 01530001
015400     EXEC SQL                                                     01540001
015500          INCLUDE TSUOBTS                                         01550001
015600     END-EXEC.                                                    01560001
015700                                                                  01570001
015800*    SUT_OTBND_CART CROSS REFERENCE TABLE                         01580001
015900     EXEC SQL                                                     01590001
016000          INCLUDE SUT00024                                        01600001
016100     END-EXEC.                                                    01610001
016200                                                                  01620001
016300*    SUT_OTBND_UPC                                                01630001
016400     EXEC SQL                                                     01640001
016500          INCLUDE SUT00028                                        01650001
016600     END-EXEC.                                                    01660001
016700                                                                  01670001
016800*    SUT_OTBND_VND                                                01680001
016900     EXEC SQL                                                     01690001
017000          INCLUDE SUT00026                                        01700001
017100     END-EXEC.                                                    01710001
017200                                                                  01720001
017300*    PACKSLIPS                                                    01730001
017400     EXEC SQL                                                     01740001
017500          INCLUDE TPKSLIP                                         01750001
017600     END-EXEC.                                                    01760001
017700                                                                  01770002
017800*    XLT_UPC  TABLE                                               01780002
017900     EXEC SQL                                                     01790002
018000          INCLUDE XLT00006                                        01800002
018100     END-EXEC.                                                    01810002
018200                                                                  01820002
018300*    XLT_SKU  TABLE                                               01830002
018400     EXEC SQL                                                     01840002
018500          INCLUDE XLT00003                                        01850002
018600     END-EXEC.                                                    01860002
018700                                                                  01870002
018800*    PARM TABLE                                                   01880003
018900     EXEC SQL                                                     01890003
019000          INCLUDE TKRPRPM                                         01900003
019100     END-EXEC.                                                    01910003
019200                                                                  01920003
019300 01  ABEND-CODE                      PIC S9(04)    VALUE +0       01930003
019400                                                   COMP SYNC.     01940001
019500     EXEC SQL                                                     01950001
019600         DECLARE PO-RCVR-CSR CURSOR FOR                           01960001
019700         SELECT  SUM(U.SHPD_UNT_QTY)                              01970001
019800                ,U.UPC_NBR                                        01980001
019900                ,U.TRN_LNE_NBR                                    01990001
020000                ,U.TRN_NBR                                        02000001
020100                ,U.RCVR_SEQ_NBR                                   02010001
020200                ,U.TRN_TYP_CDE                                    02020001
020300          FROM  SUT_OTBND_CART C                                  02030001
020400             ,  SUT_OTBND_UPC  U                                  02040001
020500             ,  XLT_UPC D                                         02050002
020600             ,  XLT_SKU E                                         02060002
020700         WHERE  C.SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID                02070001
020800           AND  C.SHIPT_UNT_ID  =  U.SHIPT_UNT_ID                 02080001
020900           AND  D.UPC_NBR       =  U.UPC_NBR                      02090002
021000           AND  E.INTR_UPC_ID   =  D.INTR_UPC_ID                  02100002
021100          GROUP BY                                                02110001
021200            U.UPC_NBR                                             02120001
021300          , U.TRN_LNE_NBR                                         02130001
021400          , U.TRN_NBR                                             02140001
021500          , U.RCVR_SEQ_NBR                                        02150001
021600          , U.TRN_TYP_CDE                                         02160001
021700          ORDER BY                                                02170001
021800            U.TRN_NBR                                             02180001
021900          , U.RCVR_SEQ_NBR                                        02190001
022000          WITH UR                                                 02200001
022100     END-EXEC.                                                    02210001
022200                                                                  02220001
022300 PROCEDURE DIVISION.                                              02230001
022400                                                                  02240001
022500     DISPLAY '***** SUKUT106 STARTED *****'.                      02250001
022600                                                                  02260001
022700     PERFORM 1000-INITIALIZE.                                     02270001
022800                                                                  02280001
022900     PERFORM 2000-PROCESS-EMPTY-CTN-FILE                          02290001
023000             UNTIL PS-END-OF-FILE                                 02300001
023100                                                                  02310001
023200     PERFORM 9000-EOJ-ROUTINE.                                    02320001
023300                                                                  02330001
023400     GOBACK.                                                      02340001
023500                                                                  02350001
023600 1000-INITIALIZE.                                                 02360001
023700                                                                  02370001
023800     MOVE WHEN-COMPILED               TO PV-WHEN-COMPILED         02380001
023900                                                                  02390001
024000     DISPLAY SPACES                                               02400001
024100     DISPLAY 'COMPILE DATE: ' PV-COMPILE-DATE                     02410001
024200             ' ' PV-COMPILE-TIME                                  02420001
024300     DISPLAY SPACES                                               02430001
024400                                                                  02440001
024500     INITIALIZE PV-COUNTERS.                                      02450001
024510                                                                  02451003
024520     PERFORM 7300-GET-PARM.                                       02452003
024521     MOVE KRPRPM-FUNC-QTY TO PV-DISPLAY-COUNT.                    02452103
024522     DISPLAY 'KRPRPM-FUNC-QTY IS A VALUE OF:  '                   02452203
024523             PV-DISPLAY-COUNT.                                    02452303
024530     DISPLAY 'SML EMPTY PURGE TIMESTAMP    :  '                   02453003
024540             PC-CURRENT-TIMESTAMP.                                02454003
024600                                                                  02460001
024601     DISPLAY ' '.                                                 02460117
024610     DISPLAY 'NOTE:  IN SML INFO: DISPLAY, STAT&TMST: INFO'       02461021
024620             ' WILL SHOW TRIP_STAT_CDE, OTBND_STAT_TMST'          02462014
024630             ' AND'.                                              02463016
024631     DISPLAY '       FINCL_POST_TMST FROM TSUOBTS IN THAT'        02463117
024640             ' ORDER'.                                            02464014
024641     DISPLAY ' '.                                                 02464117
024650                                                                  02465014
024660     DISPLAY 'NOTE:  FOR SML INFO: DISPLAYS, THIS IS FOR'         02466020
024670             ' SML ENTRIES THAT NOW HAVE CONTENT INFORMATION'.    02467021
024690     DISPLAY '       AND WILL BE PASSED INTO THE JOB FOR'         02469020
024691             ' FURTHER PROCESSING'.                               02469120
024692     DISPLAY ' '.                                                 02469220
024693                                                                  02469320
024695     DISPLAY 'NOTE:  FOR SML: DISPLAYS, THIS IS FOR SML'          02469520
024696             ' ENTRIES THAT HAVE CONTENT INFORMATION BUT WILL'.   02469621
024697     DISPLAY '       NOT BE PROCESSED IN THIS RUN OF THE'         02469720
024698             ' JOB DUE TO THE FINCL_POST_TMST FROM TSUOBTS'       02469820
024699     DISPLAY '       HAVING THE DEFAULT NINES VALUE - THIS'       02469920
024700             ' SML WILL GET PROCESSED IN THE NEXT JOB RUN'        02470020
024701     DISPLAY ' '.                                                 02470120
024702                                                                  02470220
024710     OPEN INPUT  EMPTY-CARTON-FILE                                02471020
024800     OPEN OUTPUT CARTON-DETAIL-FILE                               02480001
024900                 CARTON-TRIP-FILE                                 02490001
025000                 STILL-EMPTY-CARTON-FILE.                         02500001
025100                                                                  02510001
025200     PERFORM 8000-READ-FILE.                                      02520001
025300                                                                  02530001
025400*    MOVE PV-CURR-KEY                 TO PV-PREV-KEY.             02540001
025500                                                                  02550001
025600 2000-PROCESS-EMPTY-CTN-FILE.                                     02560001
025700                                                                  02570001
025800     INITIALIZE PC010-PCT-INTRANSIT-REC                           02580001
025900                SU043-RECORD                                      02590001
026000     MOVE PV-EMPTY-CARTON-REC         TO PV-STILL-EMPTY-CARTON-REC02600001
026100                                                                  02610001
026200* DRS *********  FOR TESTING                                      02620001
026300*    PERFORM 9200-DISPLAY-KEYS                                    02630001
026400                                                                  02640001
027100     IF SU056-PROCESS-TIMESTAMP OF PV-EMPTY-CARTON-REC <          02710001
027200        PC-CURRENT-TIMESTAMP                                      02720007
027300         ADD +1 TO PV-AGED-RECORD-COUNT                           02730003
027400     ELSE                                                         02740001
027500         MOVE SU056-OTBND-TRIP-ID OF PV-EMPTY-CARTON-REC TO       02750007
027600              PC010-TRIP-ID                                       02760007
027700              SU043-OTBND-TRIP-ID                                 02770007
027800         MOVE SU056-STR-NBR OF PV-EMPTY-CARTON-REC TO             02780007
027900              PC010-STR-NBR                                       02790007
028100         MOVE 'SUKUT106'            TO PC010-UPD-USR-ID           02810001
028110                                                                  02811007
028200         MOVE SPACES TO PV-SU-FINCL-POST-TMST                     02820007
028800         PERFORM 3000-RETRIEVE-TRIP                               02880007
029010         IF PV-SU-FINCL-POST-TMST = PC-DEFAULT-TIMESTAMP          02901008
029011            PERFORM 2400-DISPLAY-INFO                             02901109
029012            PERFORM 8200-WRITE-EMPTY-CARTON-REC                   02901207
029030         ELSE                                                     02903007
029100            PERFORM 7000-OPEN-CSR                                 02910007
029200            PERFORM 7010-FETCH-CSR                                02920007
029400            PERFORM 4000-FIND-CARTON-CONTENTS                     02940007
029500                UNTIL PS-END-OF-CSR-YES                           02950007
029900            IF PV-CTN-UPC-COUNT = ZERO                            02990007
030000               PERFORM 8200-WRITE-EMPTY-CARTON-REC                03000007
030100            ELSE                                                  03010007
030200               MOVE SU056-SHIPT-UNT-ID OF PV-EMPTY-CARTON-REC TO  03020007
030300                    PV-DISPLAY-SML                                03030007
030310               MOVE SU056-OTBND-TRIP-ID OF PV-EMPTY-CARTON-REC TO 03031010
030320                    PV-DISP-TRIP                                  03032010
030330                    DK-OTBND-TRIP-ID                              03033010
030340               PERFORM 2200-GET-CURR-TRIP-STATUS                  03034010
030400               DISPLAY 'SML INFO: '                               03040013
030500                       PV-DISPLAY-SML                             03050007
030510                       ' TRIP: '                                  03051012
030520                       PV-DISP-TRIP                               03052010
030530                       ' STAT&TMST: '                             03053013
030540                       SUOBTS-TRIP-STAT-CDE                       03054010
030550                       ' - '                                      03055013
030560                       SUOBTS-OTBND-STAT-TMST                     03056012
030570                       ' - '                                      03057012
030580                       SUOBTS-FINCL-POST-TMST                     03058012
030600            END-IF                                                03060007
030800            PERFORM 7020-CLOSE-CSR                                03080007
030810         END-IF                                                   03081007
030900     END-IF.                                                      03090001
031000                                                                  03100001
031100     PERFORM 8000-READ-FILE.                                      03110001
031200                                                                  03120001
031201 2200-GET-CURR-TRIP-STATUS.                                       03120110
031202                                                                  03120210
031203     EXEC SQL                                                     03120310
031204         SELECT  A.OTBND_STAT_TMST                                03120410
031205              ,  A.FINCL_POST_TMST                                03120510
031206              ,  A.TRIP_STAT_CDE                                  03120610
031207          INTO  :SUOBTS-OTBND-STAT-TMST                           03120710
031208              , :SUOBTS-FINCL-POST-TMST                           03120810
031209              , :SUOBTS-TRIP-STAT-CDE                             03120910
031210          FROM                                                    03121010
031211                TSUOBTS A                                         03121110
031212         WHERE  A.OTBND_TRIP_ID     = :DK-OTBND-TRIP-ID           03121210
031214           AND  A.OTBND_STAT_TMST IN                              03121410
031215                  (SELECT MAX(C.OTBND_STAT_TMST)                  03121510
031216                    FROM TSUOBTS C                                03121610
031217               WHERE A.OTBND_TRIP_ID  =  C.OTBND_TRIP_ID)         03121710
031219           WITH UR                                                03121910
031220     END-EXEC.                                                    03122010
031221                                                                  03122110
031222     EVALUATE TRUE                                                03122210
031223         WHEN SQLCODE = ZERO                                      03122310
031224             CONTINUE                                             03122410
031225         WHEN SQLCODE = +100                                      03122510
031226             MOVE SPACES              TO SUOBTS-OTBND-STAT-TMST   03122610
031227                                         SUOBTS-FINCL-POST-TMST   03122710
031228                                         SUOBTS-TRIP-STAT-CDE     03122810
031229         WHEN SQLWARN0 NOT = SPACES                               03122910
031230         WHEN SQLCODE < ZERO                                      03123010
031231         WHEN SQLCODE > ZERO                                      03123110
031232             MOVE '2200-GET-CURR-TRIP-STATUS' TO                  03123211
031233                  PV-PARAGRAPH-NAME                               03123310
031234             MOVE 'SELECT TSUOBTS ' TO PV-DB2-OPERATION-ATTEMPTED 03123410
031235             PERFORM 9200-DISPLAY-KEYS                            03123510
031236             PERFORM 9100-SQL-ABEND                               03123610
031237     END-EVALUATE.                                                03123710
031238                                                                  03123810
031239 2400-DISPLAY-INFO.                                               03123910
031240                                                                  03124010
031241     MOVE SU056-SHIPT-UNT-ID OF PV-EMPTY-CARTON-REC TO            03124110
031242          PV-DISPLAY-SML.                                         03124210
031243     MOVE DK-OTBND-TRIP-ID TO                                     03124310
031244          PV-DISP-TRIP.                                           03124410
031245     DISPLAY 'SML: '                                              03124510
031246             PV-DISPLAY-SML                                       03124610
031247             ' ON TRIP: '                                         03124710
031248             PV-DISP-TRIP                                         03124810
031249             ' SU ROW FINCL_POST_TMST OF NINES'                   03124918
031250             ' - SU TMST: '                                       03125018
031251             PV-SU-OTBND_STAT_TMST.                               03125119
031260                                                                  03126009
031300 3000-RETRIEVE-TRIP.                                              03130001
031310                                                                  03131005
031400     MOVE SU056-OTBND-TRIP-ID OF PV-EMPTY-CARTON-REC              03140001
031500                                      TO DK-OTBND-TRIP-ID.        03150005
031600                                                                  03160001
031700     IF SU056-EVENT-TMST-DS OF PV-EMPTY-CARTON-REC = SPACES       03170001
031800         MOVE 'DS'                    TO PV-STAT-CDE              03180001
031900         INITIALIZE SUOBTS-OTBND-STAT-TMST                        03190001
031910         INITIALIZE SUOBTS-FINCL-POST-TMST                        03191007
032000         PERFORM 7200-TRIP-TMST                                   03200001
032100         IF SQLCODE = ZERO                                        03210001
032200         MOVE SUOBTS-OTBND-STAT-TMST  TO                          03220001
032300                SU056-EVENT-TMST-DS OF PV-STILL-EMPTY-CARTON-REC  03230001
032400                SU056-EVENT-TMST-DS OF PV-EMPTY-CARTON-REC        03240001
032500         SET SU056-SHIPPED-FROM-DC OF PV-STILL-EMPTY-CARTON-REC   03250001
032600             SU056-SHIPPED-FROM-DC OF PV-EMPTY-CARTON-REC         03260001
032700                                      TO TRUE                     03270001
032800         END-IF                                                   03280001
032900     END-IF.                                                      03290005
033000                                                                  03300001
033100     IF SU056-EVENT-TMST-SU OF PV-EMPTY-CARTON-REC = SPACES       03310001
033200         MOVE 'SU'                    TO PV-STAT-CDE              03320001
033300         INITIALIZE SUOBTS-OTBND-STAT-TMST                        03330001
033310         INITIALIZE SUOBTS-FINCL-POST-TMST                        03331005
033400         PERFORM 7200-TRIP-TMST                                   03340001
033500         IF SQLCODE = ZERO                                        03350001
033501            MOVE SUOBTS-FINCL-POST-TMST TO PV-SU-FINCL-POST-TMST  03350107
033510            IF SUOBTS-FINCL-POST-TMST = PC-DEFAULT-TIMESTAMP      03351005
033520               MOVE SUOBTS-OTBND-STAT-TMST TO                     03352019
033521                    PV-SU-OTBND_STAT_TMST                         03352119
033530               MOVE SPACES            TO SUOBTS-OTBND-STAT-TMST   03353005
033540            ELSE                                                  03354005
033600               MOVE SUOBTS-OTBND-STAT-TMST  TO                    03360005
033700                SU056-EVENT-TMST-SU OF PV-STILL-EMPTY-CARTON-REC  03370001
033800                SU056-EVENT-TMST-SU OF PV-EMPTY-CARTON-REC        03380001
033900               SET SU056-UNLOADED-AT-STORE OF                     03390005
033901                   PV-STILL-EMPTY-CARTON-REC                      03390105
034000                   SU056-UNLOADED-AT-STORE OF                     03400005
034010                   PV-EMPTY-CARTON-REC                            03401005
034100                                      TO TRUE                     03410001
034110            END-IF                                                03411005
034200         END-IF                                                   03420001
034300     END-IF.                                                      03430001
034400                                                                  03440001
034500*    WRITE A CARTON/TRIP RECORD                                   03450001
034600*    IF SU056-SHIPPED-FROM-DC OF PV-EMPTY-CARTON-REC              03460001
034700*        PERFORM 8300-WRITE-TRIP-CTN-REC                          03470001
034800*    END-IF.                                                      03480001
034900                                                                  03490001
035000/                                                                 03500001
035100 4000-FIND-CARTON-CONTENTS.                                       03510001
035200                                                                  03520001
035300     PERFORM 4100-PROCESS-CSR                                     03530001
035400                                                                  03540001
035500     IF PS-END-OF-CSR-YES                                         03550001
035600         CONTINUE                                                 03560001
035700     ELSE                                                         03570001
035800         PERFORM 7010-FETCH-CSR                                   03580001
035900     END-IF.                                                      03590001
036000                                                                  03600001
036100 4100-PROCESS-CSR.                                                03610001
036200                                                                  03620001
036210     MOVE SUT00028-TRN-TYP-CDE TO PC010-OTB-TYP-CDE.              03621004
036220                                                                  03622004
036300     EVALUATE TRUE                                                03630001
036400         WHEN SUT00028-TRN-TYP-CDE = 'CS'                         03640001
036500             CONTINUE                                             03650001
036600                                                                  03660001
036700         WHEN SUT00028-TRN-TYP-CDE = 'FX'                         03670001
036800                                AND SU056-UNLOADED-AT-STORE       03680001
036900                                    OF PV-EMPTY-CARTON-REC        03690001
037000             SET PS-END-OF-CSR-YES    TO TRUE                     03700001
037100                                                                  03710001
037200         WHEN SUT00028-TRN-NBR      = PV-PO-NBR AND               03720001
037300                         SUT00028-RCVR-SEQ-NBR = PV-RCVR-SEQ-NBR  03730001
037400             MOVE SUT00028-RCVR-SEQ-NBR                           03740001
037500                                      TO PC010-RCVR-SEQ-NBR       03750001
037600                                                                  03760001
037700         WHEN SUT00028-TRN-NBR = ZERO                             03770001
037800             MOVE SUT00028-RCVR-SEQ-NBR TO PC010-RCVR-SEQ-NBR     03780001
037900                                                                  03790001
038000                                                                  03800001
038100         WHEN SUT00028-TRN-TYP-CDE = 'FX' AND                     03810001
038200                                            SU056-SHIPPED-FROM-DC 03820001
038300                                       OF PV-EMPTY-CARTON-REC     03830001
038400             MOVE SUT00028-RCVR-SEQ-NBR TO  PC010-RCVR-SEQ-NBR    03840001
038500                                                                  03850001
038600         WHEN SUT00028-RCVR-SEQ-NBR = ZERO                        03860001
038700             PERFORM 7100-GET-REC-SEQ-NBR                         03870001
038800                                                                  03880001
038900         WHEN OTHER                                               03890001
039000             MOVE SUT00028-RCVR-SEQ-NBR TO PC010-RCVR-SEQ-NBR     03900001
039100                                                                  03910001
039200     END-EVALUATE.                                                03920001
039300                                                                  03930001
039400     IF PS-END-OF-CSR-NO AND PC010-UPC-NBR NOT = ZEROES           03940001
039500         EVALUATE TRUE                                            03950001
039600                                                                  03960001
039700             WHEN SU056-SHIPPED-FROM-DC OF PV-EMPTY-CARTON-REC    03970001
039800                AND SU056-NOT-UNLOADED-AT-STORE                   03980001
039900                                     OF PV-EMPTY-CARTON-REC       03990001
040000                 MOVE 'SH'  TO PC010-TRN-TYP-CDE                  04000001
040100                 MOVE SU056-EVENT-TMST-DS                         04010001
040200                             OF PV-EMPTY-CARTON-REC               04020001
040300                                      TO PC010-EVENT-TMST         04030001
040400                                                                  04040001
040500             WHEN SU056-NOT-SHIPPED-FROM-DC                       04050001
040600                                     OF PV-EMPTY-CARTON-REC       04060001
040700                   AND SU056-UNLOADED-AT-STORE                    04070001
040800                                     OF PV-EMPTY-CARTON-REC       04080001
040900                 MOVE 'UN'            TO PC010-TRN-TYP-CDE        04090001
041000                 MOVE SU056-EVENT-TMST-SU                         04100001
041100                                 OF PV-EMPTY-CARTON-REC           04110001
041200                                TO PC010-EVENT-TMST               04120001
041300                                                                  04130001
041400             WHEN SU056-SHIPPED-FROM-DC                           04140001
041500                                     OF PV-EMPTY-CARTON-REC       04150001
041600                  AND SU056-UNLOADED-AT-STORE                     04160001
041700                                     OF PV-EMPTY-CARTON-REC       04170001
041800                         MOVE 'SH'    TO PC010-TRN-TYP-CDE        04180001
041900                         MOVE SU056-EVENT-TMST-DS                 04190001
042000                             OF PV-EMPTY-CARTON-REC               04200001
042100                                      TO PC010-EVENT-TMST         04210001
042200                         PERFORM 8100-WRITE-CTN-DTL               04220001
042300                         MOVE 'UN'    TO PC010-TRN-TYP-CDE        04230001
042400                         MOVE SU056-EVENT-TMST-SU                 04240001
042500                             OF PV-EMPTY-CARTON-REC               04250001
042600                                      TO PC010-EVENT-TMST         04260001
042700         END-EVALUATE                                             04270001
042800                                                                  04280001
042900         EVALUATE TRUE                                            04290001
043000             WHEN SU056-SHIPPED-FROM-DC OF PV-EMPTY-CARTON-REC    04300001
043100                AND SU056-NOT-UNLOADED-AT-STORE                   04310001
043200                                     OF PV-EMPTY-CARTON-REC       04320001
043300                 PERFORM 8100-WRITE-CTN-DTL                       04330001
043400                 PERFORM 8300-WRITE-TRIP-CTN-REC                  04340001
043500                                                                  04350001
043600             WHEN SU056-SHIPPED-FROM-DC OF PV-EMPTY-CARTON-REC    04360001
043700                AND SU056-UNLOADED-AT-STORE                       04370001
043800                                     OF PV-EMPTY-CARTON-REC       04380001
043900                 PERFORM 8100-WRITE-CTN-DTL                       04390001
044000                 PERFORM 8300-WRITE-TRIP-CTN-REC                  04400001
044100                                                                  04410001
044200             WHEN SU056-NOT-SHIPPED-FROM-DC OF PV-EMPTY-CARTON-REC04420001
044300                AND SU056-UNLOADED-AT-STORE                       04430001
044400                                     OF PV-EMPTY-CARTON-REC       04440001
044500                 PERFORM 8100-WRITE-CTN-DTL                       04450001
044600         END-EVALUATE                                             04460001
044700                                                                  04470001
044800     END-IF.                                                      04480001
044900                                                                  04490001
045000                                                                  04500001
045100     MOVE SUT00028-TRN-NBR        TO PV-PO-NBR                    04510001
045200     MOVE SUT00028-RCVR-SEQ-NBR   TO PV-RCVR-SEQ-NBR.             04520001
045300/                                                                 04530001
045400 7000-OPEN-CSR.                                                   04540001
045500     INITIALIZE DCLSUT00028                                       04550001
045600                PV-CTN-UPC-COUNT                                  04560001
045700                                                                  04570001
045800     MOVE SU056-SHIPT-UNT-ID OF PV-EMPTY-CARTON-REC               04580001
045900                                      TO DK-SHIPT-UNT-ID          04590001
046000     MOVE SU056-OTBND-TRIP-ID OF PV-EMPTY-CARTON-REC              04600001
046100                                      TO DK-OTBND-TRIP-ID         04610001
046200                                                                  04620001
046300     EXEC SQL                                                     04630001
046400         OPEN PO-RCVR-CSR                                         04640001
046500     END-EXEC.                                                    04650001
046600                                                                  04660001
046700     EVALUATE TRUE                                                04670001
046800         WHEN SQLCODE = ZERO                                      04680001
046900             SET PS-END-OF-CSR-NO    TO TRUE                      04690001
047000         WHEN SQLWARN0 NOT = SPACES                               04700001
047100         WHEN SQLCODE < ZERO                                      04710001
047200         WHEN SQLCODE > ZERO                                      04720001
047300             MOVE '7000-OPEN-CSR' TO PV-PARAGRAPH-NAME            04730001
047400             MOVE 'SELECT SUT_OTBND_UPC '                         04740001
047500                                    TO PV-DB2-OPERATION-ATTEMPTED 04750001
047600             PERFORM 9200-DISPLAY-KEYS                            04760001
047700             PERFORM 9100-SQL-ABEND                               04770001
047800     END-EVALUATE.                                                04780001
047900                                                                  04790001
048000*----------------------------------------------------------------*04800001
048100* FETCH CURSOR                                                    04810001
048200*----------------------------------------------------------------*04820001
048300 7010-FETCH-CSR.                                                  04830001
048400     EXEC SQL                                                     04840001
048500        FETCH PO-RCVR-CSR                                         04850001
048600         INTO   :SUT00028-SHPD-UNT-QTY                            04860001
048700               ,:SUT00028-UPC-NBR                                 04870001
048800               ,:SUT00028-TRN-LNE-NBR                             04880001
048900               ,:SUT00028-TRN-NBR                                 04890001
049000               ,:SUT00028-RCVR-SEQ-NBR                            04900001
049100               ,:SUT00028-TRN-TYP-CDE                             04910001
049200     END-EXEC.                                                    04920001
049300                                                                  04930001
049400     EVALUATE TRUE                                                04940001
049500         WHEN SQLCODE = ZERO                                      04950001
049600             MOVE SUT00028-SHPD-UNT-QTY                           04960001
049700                                       TO  PC010-IN-TRNST-QTY     04970001
049800             MOVE SUT00028-UPC-NBR     TO  PC010-UPC-NBR          04980001
049900             MOVE SUT00028-TRN-NBR     TO  PC010-PO-NBR           04990001
050000             MOVE SUT00028-TRN-LNE-NBR TO  PC010-TRN-LNE-NBR      05000001
050100             ADD 1                     TO  PV-CTN-UPC-COUNT       05010001
050200         WHEN SQLCODE = +100                                      05020001
050300             MOVE ZEROES               TO  PC010-IN-TRNST-QTY     05030001
050400                                           PC010-UPC-NBR          05040001
050500                                           PC010-PO-NBR           05050001
050600                                           PC010-RCVR-SEQ-NBR     05060001
050700                                           PC010-TRN-LNE-NBR      05070001
050800             SET PS-END-OF-CSR-YES    TO  TRUE                    05080001
050900         WHEN SQLWARN0 NOT = SPACES                               05090001
051000         WHEN SQLCODE < ZERO                                      05100001
051100         WHEN SQLCODE > ZERO                                      05110001
051200             MOVE '7010-FETCH-CSR' TO PV-PARAGRAPH-NAME           05120001
051300             MOVE 'SELECT SUT_OTBND_UPC'                          05130001
051400                                   TO PV-DB2-OPERATION-ATTEMPTED  05140001
051500             PERFORM 9200-DISPLAY-KEYS                            05150001
051600             PERFORM 9100-SQL-ABEND                               05160001
051700     END-EVALUATE.                                                05170001
051800                                                                  05180001
051900 7020-CLOSE-CSR.                                                  05190001
052000     EXEC SQL                                                     05200001
052100        CLOSE PO-RCVR-CSR                                         05210001
052200     END-EXEC.                                                    05220001
052300                                                                  05230001
052400     EVALUATE TRUE                                                05240001
052500         WHEN SQLCODE = ZERO                                      05250001
052600             CONTINUE                                             05260001
052700         WHEN SQLWARN0 NOT = SPACES                               05270001
052800         WHEN SQLCODE < ZERO                                      05280001
052900         WHEN SQLCODE > ZERO                                      05290001
053000             MOVE '7020-CLOSE-CSR'    TO PV-PARAGRAPH-NAME        05300001
053100             MOVE 'CLOSE CURSOR'                                  05310001
053200                                   TO PV-DB2-OPERATION-ATTEMPTED  05320001
053300             PERFORM 9200-DISPLAY-KEYS                            05330001
053400             PERFORM 9100-SQL-ABEND                               05340001
053500     END-EVALUATE.                                                05350001
053600                                                                  05360001
053700 7100-GET-REC-SEQ-NBR.                                            05370001
053800                                                                  05380001
053900     EXEC SQL                                                     05390001
054000         SELECT  B.REC_SEQ_NBR                                    05400001
054100          INTO   :PKSLIP-REC-SEQ-NBR                              05410001
054200          FROM  SUT_OTBND_VND A                                   05420001
054300               ,TPKSLIP B                                         05430001
054400         WHERE  A.SHIPT_UNT_ID  =  :DK-SHIPT-UNT-ID               05440001
054500           AND  A.PO_NBR        =  B.PO_NBR                       05450001
054600           AND  A.PKSL_SEQ_NBR  =  B.SEQ_NBR                      05460001
054700           AND  B.VER_STAT_CDE  =  'A'                            05470001
054800           WITH UR                                                05480001
054900     END-EXEC.                                                    05490001
055000                                                                  05500001
055100     EVALUATE TRUE                                                05510001
055200         WHEN SQLCODE = ZERO                                      05520001
055300             MOVE PKSLIP-REC-SEQ-NBR  TO  PC010-RCVR-SEQ-NBR      05530001
055400                                          SUT00028-RCVR-SEQ-NBR   05540001
055500         WHEN SQLCODE = +100                                      05550001
055600             MOVE ZERO                TO  PC010-RCVR-SEQ-NBR      05560001
055700                                          SUT00028-RCVR-SEQ-NBR   05570001
055800         WHEN SQLWARN0 NOT = SPACES                               05580001
055900         WHEN SQLCODE < ZERO                                      05590001
056000         WHEN SQLCODE > ZERO                                      05600001
056100             MOVE '7100-GET-REC-SEQ-NBR ' TO PV-PARAGRAPH-NAME    05610001
056200             MOVE 'SELECT TPKSLIP ' TO PV-DB2-OPERATION-ATTEMPTED 05620001
056300             PERFORM 9200-DISPLAY-KEYS                            05630001
056400             PERFORM 9100-SQL-ABEND                               05640001
056500     END-EVALUATE.                                                05650001
056600                                                                  05660001
056700******************************************************************05670001
056800*  GET TIMESTAMP FOR TRIP STATUS                                  05680001
056900******************************************************************05690001
057000 7200-TRIP-TMST.                                                  05700001
057100                                                                  05710001
057200     EXEC SQL                                                     05720001
057300         SELECT  A.OTBND_STAT_TMST                                05730001
057310              ,  A.FINCL_POST_TMST                                05731005
057400          INTO  :SUOBTS-OTBND-STAT-TMST                           05740001
057410              , :SUOBTS-FINCL-POST-TMST                           05741005
057500          FROM                                                    05750001
057600                TSUOBTS A                                         05760001
057700         WHERE  A.OTBND_TRIP_ID     = :DK-OTBND-TRIP-ID           05770001
057800           AND  A.TRIP_STAT_CDE     = :PV-STAT-CDE                05780001
057900           AND  A.OTBND_STAT_TMST IN                              05790001
058000                  (SELECT MAX(C.OTBND_STAT_TMST)                  05800001
058100                    FROM TSUOBTS C                                05810001
058200               WHERE A.OTBND_TRIP_ID  =  C.OTBND_TRIP_ID          05820001
058300                  AND  C.TRIP_STAT_CDE = :PV-STAT-CDE)            05830001
058400           WITH UR                                                05840001
058500     END-EXEC.                                                    05850001
058600                                                                  05860001
058700     EVALUATE TRUE                                                05870001
058800         WHEN SQLCODE = ZERO                                      05880001
058900             CONTINUE                                             05890001
059000         WHEN SQLCODE = +100                                      05900001
059100             MOVE SPACES              TO SUOBTS-OTBND-STAT-TMST   05910001
059200         WHEN SQLWARN0 NOT = SPACES                               05920001
059300         WHEN SQLCODE < ZERO                                      05930001
059400         WHEN SQLCODE > ZERO                                      05940001
059500             MOVE '7200-TRIP-TMST'      TO PV-PARAGRAPH-NAME      05950001
059600             MOVE 'SELECT TSUOBTS ' TO PV-DB2-OPERATION-ATTEMPTED 05960001
059700             PERFORM 9200-DISPLAY-KEYS                            05970001
059800             PERFORM 9100-SQL-ABEND                               05980001
059900     END-EVALUATE.                                                05990001
060000                                                                  06000003
060100******************************************************************06010003
060200*  GET PARM VALUE FOR NUMBER OF DAYS FOR PURGING BASED ON AGING   06020003
060300*  FROM THE INPUT WRAP FILE.                                      06030003
060400******************************************************************06040003
060500 7300-GET-PARM.                                                   06050003
060600                                                                  06060003
060700     EXEC SQL                                                     06070003
060800       SELECT CURRENT TIMESTAMP - FUNC_QTY DAYS                   06080003
060810            , FUNC_QTY                                            06081003
060900       INTO  :PC-CURRENT-TIMESTAMP                                06090003
060910          ,  :KRPRPM-FUNC-QTY                                     06091003
061000       FROM TKRPRPM                                               06100003
061100       WHERE LOC_ID             =  90                             06110003
061200         AND INTFC_SYS_CDE      = 'KHL'                           06120003
061300         AND SYS_PRC_FUNC_CDE   = 'SMLEPG'                        06130003
061400         AND FUNC_PRC_STAT_CDE  = 'AC'                            06140003
061500       WITH UR                                                    06150003
061600     END-EXEC.                                                    06160003
061700                                                                  06170003
061800     EVALUATE TRUE                                                06180003
061900         WHEN SQLCODE = ZERO                                      06190003
062000             CONTINUE                                             06200003
062100         WHEN SQLWARN0 NOT = SPACES                               06210003
062200         WHEN SQLCODE < ZERO                                      06220003
062300         WHEN SQLCODE > ZERO                                      06230003
062400             MOVE '7300-GET-PARM '      TO PV-PARAGRAPH-NAME      06240003
062500             MOVE 'SELECT TKRPRPM ' TO PV-DB2-OPERATION-ATTEMPTED 06250003
062600             MOVE 'PARM SMLEPG NOT FOUND ON TKRPRPM' TO           06260003
062700                  PV-DISPLAY-LINE                                 06270003
062800             PERFORM 9100-SQL-ABEND                               06280003
062900     END-EVALUATE.                                                06290003
063000/                                                                 06300003
063100 8000-READ-FILE.                                                  06310003
063200                                                                  06320001
063300     READ EMPTY-CARTON-FILE INTO PV-EMPTY-CARTON-REC              06330001
063400         AT END                                                   06340001
063500             SET PS-END-OF-FILE TO TRUE                           06350001
063600         NOT AT END                                               06360001
063700             MOVE SU056-OTBND-TRIP-ID OF PV-EMPTY-CARTON-REC      06370001
063800                                      TO PV-CURR-TRIP             06380001
063900             MOVE SU056-SHIPT-UNT-ID OF PV-EMPTY-CARTON-REC       06390001
064000                                      TO PV-CURR-CTN              06400001
064100                                                                  06410001
064200         ADD +1 TO PV-READ-COUNT                                  06420001
064300     END-READ.                                                    06430001
064400                                                                  06440001
064500 8100-WRITE-CTN-DTL.                                              06450001
064600*    DISPLAY ' 8100-WRITE-CNT-DTL'                                06460001
064700                                                                  06470001
064800     MOVE SU056-STAT-CDE-DS OF PV-EMPTY-CARTON-REC                06480001
064900                                      TO PC010-STAT-CDE-DS        06490001
065000     MOVE SU056-STAT-CDE-SU OF PV-EMPTY-CARTON-REC                06500001
065100                                      TO PC010-STAT-CDE-SU        06510001
065200     MOVE 'IT'                        TO PC010-TRN-CLSN-CDE       06520001
065300                                                                  06530001
065400***** COMMENT OUT THIS SWITCH.  IT IS NOT POPULATED. 3/2006 DMB **06540001
065500*    IF  SU056-DC-INTRNST OF PV-EMPTY-CARTON-REC                  06550001
065600     IF  SUT00028-TRN-TYP-CDE = 'FX'                              06560001
065700         CONTINUE                                                 06570001
065800     ELSE                                                         06580001
065900         WRITE  CARTON-DETAIL-RECORD                              06590001
066000                FROM PC010-PCT-INTRANSIT-REC                      06600001
066100         ADD    +1   TO PV-UPC-COUNT                              06610001
066200*        END-IF                                                   06620001
066300     END-IF.                                                      06630001
066400                                                                  06640001
066500 8200-WRITE-EMPTY-CARTON-REC.                                     06650001
066600*    DISPLAY ' 8200-WRITE-EMPTY-CARTON-REC'.                      06660001
066700                                                                  06670001
066800     WRITE STILL-EMPTY-CARTON-REC                                 06680001
066900           FROM PV-STILL-EMPTY-CARTON-REC                         06690001
067000     ADD 1                            TO PV-EMPTY-CARTON-COUNT.   06700001
067100                                                                  06710001
067200 8300-WRITE-TRIP-CTN-REC.                                         06720001
067300*    DISPLAY ' 8300-WRITE-TRIP-CTN-REC'                           06730001
067400     MOVE SU056-SHIPT-UNT-ID OF PV-EMPTY-CARTON-REC               06740001
067500                                      TO SU043-SHIPT-UNT-ID       06750001
067600                                         PV-CURR-CTN              06760001
067700     MOVE SU043-OTBND-TRIP-ID         TO PV-CURR-TRIP             06770001
067800                                                                  06780001
067900     IF PV-CURR-KEY NOT = PV-PREV-KEY                             06790001
068000         WRITE CARTON-TRIP-RECORD FROM SU043-RECORD               06800001
068100         ADD +1                       TO PV-CARTON-COUNT          06810001
068200         MOVE PV-CURR-KEY             TO PV-PREV-KEY              06820001
068300     END-IF.                                                      06830001
068400                                                                  06840001
068500     MOVE SU043-OTBND-TRIP-ID         TO PV-CURR-TRIP             06850001
068600     MOVE SU043-SHIPT-UNT-ID          TO PV-CURR-CTN.             06860001
068700/                                                                 06870001
068800******************************************************************06880001
068900*  CLOSE INPUT FILE.  DISPLAY COUNTERS.                           06890001
069000******************************************************************06900001
069100 9000-EOJ-ROUTINE.                                                06910001
069200     CLOSE EMPTY-CARTON-FILE                                      06920001
069300           CARTON-DETAIL-FILE                                     06930001
069400           CARTON-TRIP-FILE                                       06940001
069500           STILL-EMPTY-CARTON-FILE.                               06950001
069600                                                                  06960001
069700     MOVE PV-READ-COUNT               TO PV-DISPLAY-COUNT.        06970001
069800     DISPLAY 'TOTAL RECORDS READ          : '  PV-DISPLAY-COUNT.  06980001
069900     MOVE PV-UPC-COUNT                TO PV-DISPLAY-COUNT.        06990001
070000     DISPLAY 'TOTAL CARTON DETAIL (OUT01) : '  PV-DISPLAY-COUNT.  07000001
070100     MOVE PV-CARTON-COUNT             TO PV-DISPLAY-COUNT.        07010001
070200     DISPLAY 'TOTAL TRIP CARTONS  (OUT02) : '  PV-DISPLAY-COUNT.  07020001
070300                                                                  07030001
070400     MOVE PV-EMPTY-CARTON-COUNT       TO PV-DISPLAY-COUNT.        07040001
070500     DISPLAY 'TOTAL EMPTY CARTONS (OUT03) : '  PV-DISPLAY-COUNT.  07050001
070510     MOVE PV-AGED-RECORD-COUNT        TO PV-DISPLAY-COUNT.        07051003
070520     DISPLAY 'TOTAL AGED RECORDS PURGED   : '  PV-DISPLAY-COUNT.  07052003
070600                                                                  07060001
070700     DISPLAY '*****  SUKUT106 ENDED  *****'.                      07070001
070800                                                                  07080001
070900******************************************************************07090001
071000*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    07100001
071100*  ERROR OR WARNING CODE OCCURS.                                  07110001
071200******************************************************************07120001
071300 9100-SQL-ABEND.                                                  07130001
071400*    DISPLAY '9100-SQL-ABEND'.                                    07140001
071500     DISPLAY '** ABEND     **'.                                   07150001
071600     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        07160001
071700     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              07170001
071800     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     07180001
071900     DISPLAY '** TRIP ID   ** = ' SU056-OTBND-TRIP-ID             07190001
072000                              OF PV-EMPTY-CARTON-REC              07200001
072100                                                                  07210001
072200     COPY DPPD004.                                                07220001
072300                                                                  07230001
072400     MOVE +4013                  TO ABEND-CODE.                   07240001
072500     CALL 'ILBOABN0' USING ABEND-CODE.                            07250001
072600                                                                  07260001
072700 9200-DISPLAY-KEYS.                                               07270001
072800                                                                  07280001
072900     MOVE SPACES                      TO PV-DISPLAY-LINE          07290001
073000     MOVE SU056-SHIPT-UNT-ID OF PV-EMPTY-CARTON-REC               07300001
073100                                      TO PV-DISP-CTN              07310001
073200     MOVE SU056-OTBND-TRIP-ID OF PV-EMPTY-CARTON-REC              07320001
073300                                      TO PV-DISP-TRIP             07330001
073400     STRING                                                       07340001
073500             'CARTON BEING PROCESSED IS ' PV-DISP-CTN             07350001
073600             ' (TRIP = ' PV-DISP-TRIP                             07360001
073700             ')'                                                  07370001
073800                 DELIMITED BY SIZE INTO PV-DISPLAY-LINE           07380001
073900     DISPLAY PV-DISPLAY-LINE.                                     07390001
