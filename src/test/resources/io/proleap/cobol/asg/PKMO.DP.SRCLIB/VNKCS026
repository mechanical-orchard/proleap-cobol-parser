000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    VNKCS026.                                         00040001
000500 AUTHOR.        MIKE BESKE.                                       00050001
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  AUGUST 2003.                                      00070001
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    V026 - VENDOR OFF-INVOICE PROGRAM INQUIRY SCREEN.          * 00110001
001200*                                                               * 00120000
001300*    THIS PROGRAM WILL SHOW THE USER TO INQUIRE ON A LIST OF THE* 00130001
001400*    OFF-INVOICE ALLOWANCE AGREEMENTS (PROGRAM) THAT HAVE BEEN  * 00140001
001500*    CREATED FOR A VENDOR/DEPARTMENT. THE LIST WILL DEFAULT TO  * 00150001
001600*    SHOW ONLY THOSE AGREEMENTS THAT ARE CURRENTLY ACTIVE, BUT  * 00160001
001700*    A PF KEY WILL ALLOW THE USER TO INCLUDE AGREEMENTS OF THIS * 00170001
001800*    TYPE THAT HAVE EXPIRED AS WELL.                            * 00180001
001900*                                                               * 00190000
002000*---------------------------------------------------------------* 00200000
002100*                                                               * 00210074
002200*  DATE  03/16/2004                                             * 00220074
002300*      CHANGE MADE: ADDED 'RO' AS A VALID VALUE FOR POSTING     * 00230074
002400*      FREQUENCY CODE - IT MEANS REPORT ONLY, DO NOT CREATE     * 00240074
002500*      VENDOR DEDUCTIONS.                                       * 00250074
002600*      MADE BY: NANCY EILBES            WR/IR #: WR26677        * 00260074
002700*                                                               * 00270074
002800*  DATE  07/08/2005                                             * 00280075
002900*      CHANGE MADE: OFF-INVOICE CO-OP ADVERTISING ALLOWANCES    * 00290075
003000*      ADDED LOGIC TO PARAGRAPH 4420- TO MOVE THE STRING        * 00300075
003100*      'OFFINVC' TO THE FREQUENCY FIELD WHEN THE FREQUENCY TYPE * 00310075
003200*      IS 'IV'.                                                 * 00320075
003300*      MADE BY: KRYSTEN LEARY           WR/IR #: WR28651        * 00330075
003400*                                                               * 00340075
003500*  DATE  03/20/2006                                             * 00350077
003600*      CHANGE MADE: REMOVED THE NUMEROUS AREAS OF COMMENTED OUT * 00360077
003700*      CODE AS PART OF THE VENDOR ALLOWANCE AUTOMATION.         * 00370077
003800*      MADE BY: MIKE BESKE              WR/IR #: WR30028        * 00380077
003900*                                                               * 00390077
003910*  DATE  09/07/2021                                              *00391078
003920*            - CHANGE CALL OF DPKUT100 TO                       * 00392078
003930*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00393078
003940*              MAKING THE CALL DYNAMIC VS STATIC                * 00394078
003950*      MADE BY: GERMAN BANDA            WR/IR #: CHG0261091      *00395080
003960*                                                               * 00396078
003910*  DATE  01/05/2023                                              *00397081
003920*            - CHANGE CALL OF DPKCS030 TO DYNAMIC               * 00398081
003950*      MADE BY: JEAN KURK               WR/IR #: CHG0277999      *00399281
004000*---------------------------------------------------------------* 00400077
004100 EJECT                                                            00410077
004200 ENVIRONMENT DIVISION.                                            00420077
004300                                                                  00430077
004400 DATA DIVISION.                                                   00440077
004500                                                                  00450077
004600 WORKING-STORAGE SECTION.                                         00460077
004700                                                                  00470077
004800 01  DK-DB2-KEYS.                                                 00480077
004900     05  DK-DEPT-NBR                  PIC  X(03) VALUE SPACES.    00490077
005000     05  DK-VEND-NAME                 PIC  X(30) VALUE SPACES.    00500077
005100     05  DK-DUNS-NUMBER               PIC  X(09).                 00510077
005200     05  DK-INHOUSE-NUMBER            PIC S9(03) VALUE +0         00520077
005300                                                 COMP-3.          00530077
005400     05  DK-ENT-ID                    PIC S9(09) VALUE +0         00540077
005500                                                 COMP.            00550077
005600                                                                  00560077
005700 01  PC-PROGRAM-CONSTANTS.                                        00570077
005800     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00580077
005900                                                    'VN026A  '.   00590077
006000     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00600077
006100                                                    'VNKM026 '.   00610077
006200     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00620077
006300                                                    'VNKCS026'.   00630077
006400     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00640077
006500     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00650077
006600     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00660077
006700     05  PC-INTER-APPL-CODES.                                     00670077
006800         10  PC-INTER-APPL-CRIT-SPEC  PIC X(01)  VALUE '1'.       00680077
006900         10  PC-INTER-APPL-LIST       PIC X(01)  VALUE '2'.       00690077
007000         10  PC-INTER-APPL-BLANK      PIC X(01)  VALUE ' '.       00700077
007100     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +11     00710077
007200                                                    COMP SYNC.    00720077
007300     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00730077
007400                                                    COMP SYNC.    00740077
007500     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00750077
007600                                                    +999999       00760077
007700                                                    COMP-3.       00770077
007800     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00780077
007900                                                    COMP-3.       00790077
008000     05  PC-INQ                         PIC  X(01)  VALUE 'I'.    00800077
008100     05  PC-UPD                         PIC  X(01)  VALUE 'U'.    00810077
008200     05  PC-DEL                         PIC  X(01)  VALUE 'D'.    00820077
008300     05  PC-ERR                         PIC  X(01)  VALUE 'E'.    00830077
008400*                                                                 00840077
008500     05  PC-TSYMSG-NUMBERS.                                       00850077
008600         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00860077
008700         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00870077
008800         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00880077
008900         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00890077
009000         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00900077
009100         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00910077
009200         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00920077
009300         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00930077
009400         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00940077
009500         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00950077
009600         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00960077
009700         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00970077
009800         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  00980077
009900         10  PC-TSYMSG-00174            PIC  9(05)  VALUE 00174.  00990077
010000         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01000077
010100         10  PC-TSYMSG-00308            PIC  9(05)  VALUE 00308.  01010077
010200         10  PC-TSYMSG-00984            PIC  9(05)  VALUE 00984.  01020077
010300         10  PC-TSYMSG-00635            PIC  9(05)  VALUE 00635.  01030077
010400         10  PC-TSYMSG-00636            PIC  9(05)  VALUE 00636.  01040077
010500         10  PC-TSYMSG-01318            PIC  9(05)  VALUE 01318.  01050077
010600         10  PC-TSYMSG-01375            PIC  9(05)  VALUE 01375.  01060077
010700         10  PC-TSYMSG-02521            PIC  9(05)  VALUE 02521.  01070077
010800         10  PC-TSYMSG-02522            PIC  9(05)  VALUE 02522.  01080077
010900         10  PC-TSYMSG-02523            PIC  9(05)  VALUE 02523.  01090077
011000         10  PC-TSYMSG-02524            PIC  9(05)  VALUE 02524.  01100077
011100         10  PC-TSYMSG-02525            PIC  9(05)  VALUE 02525.  01110077
011200         10  PC-TSYMSG-02526            PIC  9(05)  VALUE 02526.  01120077
011300         10  PC-TSYMSG-02585            PIC  9(05)  VALUE 02585.  01130077
011400         10  PC-TSYMSG-02586            PIC  9(05)  VALUE 02586.  01140077
011500         10  PC-TSYMSG-02587            PIC  9(05)  VALUE 02587.  01150077
011600         10  PC-TSYMSG-02645            PIC  9(05)  VALUE 02645.  01160077
011700         10  PC-TSYMSG-02646            PIC  9(05)  VALUE 02646.  01170077
011800         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  01180077
011900*                                                                 01190077
012000 01  PS-PROGRAM-SWITCHES.                                         01200077
012100     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01210077
012200         88  PS-NO-ERROR                            VALUE 'Y'.    01220077
012300         88  PS-ERROR                               VALUE 'N'.    01230077
012400     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01240077
012500         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01250077
012600         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01260077
012700*                                                                 01270077
012800 01  PV-PROGRAM-VARIABLES.                                        01280077
012900     05  PV-SUB                         PIC S9(04)  VALUE +0      01290077
013000                                                    COMP SYNC.    01300077
013100     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01310077
013200                                                    COMP SYNC.    01320077
013300     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01330077
013400                                                    COMP-3.       01340077
013500     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01350077
013600                                                    COMP-3.       01360077
013700     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01370077
013800                                                    COMP-3.       01380077
013900     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01390077
014000                                                    COMP-3.       01400077
014100     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01410077
014200                                                    COMP-3.       01420077
014300     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01430077
014400                                                    COMP-3.       01440077
014500     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01450077
014600                                                    COMP-3.       01460077
014700     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01470077
014800                                                    COMP SYNC.    01480077
014900     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01490077
015000                                                    COMP SYNC.    01500077
015100     05  PV-ITEM                        PIC S9(04)  VALUE +0      01510077
015200                                                    COMP SYNC.    01520077
015300     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01530077
015400                                                    COMP SYNC.    01540077
015500     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01550077
015600                                                    COMP SYNC.    01560077
015700     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01570077
015800                                                    COMP SYNC.    01580077
015900     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01590077
016000                                                    COMP SYNC.    01600077
016100     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01610077
016200                                                    COMP SYNC.    01620077
016300     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01630077
016400                                                    COMP SYNC.    01640077
016500     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01650077
016600                                                    COMP SYNC.    01660077
016700     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01670077
016800                                                    COMP SYNC.    01680077
016900     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01690077
017000                                                    COMP SYNC.    01700077
017100     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01710077
017200                                                    COMP SYNC.    01720077
017300     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01730077
017400                                                    COMP SYNC.    01740077
017500     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01750077
017600                                                    COMP SYNC.    01760077
017700     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01770077
017800                                                    COMP SYNC.    01780077
017900     05  PV-INHOUSE-NBR-X.                                        01790077
018000         10  PV-INHOUSE-NBR             PIC  9(03)  VALUE ZERO.   01800077
018100     05  PV-INHOUSE-NUMBER              PIC S9(03)  VALUE +0      01810077
018200                                                    COMP-3.       01820077
018300     05  PV-EFFDTE                      PIC  X(10).               01830077
018400     05  PV-EFFDTE-RED REDEFINES PV-EFFDTE.                       01840077
018500         10  PV-EFFDTE-CCYY             PIC  9(04).               01850077
018600         10  FILLER                     PIC  X(01).               01860077
018700         10  PV-EFFDTE-MM               PIC  9(02).               01870077
018800         10  FILLER                     PIC  X(01).               01880077
018900         10  PV-EFFDTE-DD               PIC  9(02).               01890077
019000     05  PV-EXPDTE                      PIC  X(10).               01900077
019100     05  PV-EXPDTE-RED REDEFINES PV-EXPDTE.                       01910077
019200         10  PV-EXPDTE-CCYY             PIC  9(04).               01920077
019300         10  FILLER                     PIC  X(01).               01930077
019400         10  PV-EXPDTE-MM               PIC  9(02).               01940077
019500         10  FILLER                     PIC  X(01).               01950077
019600         10  PV-EXPDTE-DD               PIC  9(02).               01960077
019700                                                                  01970077
019800     05  PV-EFFDTE-FMT.                                           01980077
019900         10  PV-EFFDTE-FMTMM            PIC  9(02).               01990077
020000         10  FILLER                     PIC  X(01)  VALUE '/'.    02000077
020100         10  PV-EFFDTE-FMTDD            PIC  9(02).               02010077
020200         10  FILLER                     PIC  X(01)  VALUE '/'.    02020077
020300         10  PV-EFFDTE-FMTCCYY          PIC  9(04).               02030077
020400                                                                  02040077
020500     05  PV-EXPDTE-FMT.                                           02050077
020600         10  PV-EXPDTE-FMTMM            PIC  9(02).               02060077
020700         10  FILLER                     PIC  X(01)  VALUE '/'.    02070077
020800         10  PV-EXPDTE-FMTDD            PIC  9(02).               02080077
020900         10  FILLER                     PIC  X(01)  VALUE '/'.    02090077
021000         10  PV-EXPDTE-FMTCCYY          PIC  9(04).               02100077
021100******************************************************************02110077
021200**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **02120077
021300**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **02130077
021400**  APPLICATION-SPECIFIC COMMAREA.                              **02140077
021500******************************************************************02150077
021600 01  LQW-LIST-QUEUE-WORK-AREA.                                    02160077
021700     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02170077
021800     05  LQW-ITEM-ENTRIES               OCCURS 11 TIMES           02180077
021900                                        INDEXED BY LQW-IDX.       02190077
022000         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02200077
022100         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02210077
022200         10  LQW-SELECTED-SW            PIC  X(01).               02220077
022300             88  LQW-SELECT                         VALUE 'S'.    02230077
022400             88  LQW-DESELECT                       VALUE ' '.    02240077
022500         10  LQW-ENT-ID                 PIC S9(09)                02250077
022600                                             COMP.                02260077
022700         10  LQW-TRANCODE               PIC  X(02).               02270077
022800         10  LQW-PERCENT                PIC  9(02)V99.            02280077
022900         10  LQW-DESCRIPTION            PIC  X(18).               02290077
023000         10  LQW-NET-RTV                PIC  X(01).               02300077
023100         10  LQW-NET-DISC               PIC  X(01).               02310077
023200         10  LQW-FREQUENCY              PIC  X(02).               02320077
023300         10  LQW-EFFDTE-MM              PIC  9(02).               02330077
023400         10  LQW-EFFDTE-DD              PIC  9(02).               02340077
023500         10  LQW-EFFDTE-CCYY            PIC  9(04).               02350077
023600         10  LQW-EXPDTE-MM              PIC  9(02).               02360077
023700         10  LQW-EXPDTE-DD              PIC  9(02).               02370077
023800         10  LQW-EXPDTE-CCYY            PIC  9(04).               02380077
023900                                                                  02390077
024000     EJECT                                                        02400077
024100*---------------------------------------------------------------* 02410077
024200*  RECORD LAYOUT FOR THE PROGRAM SELECTION TEMP STORAGE QUEUE.  * 02420077
024300*---------------------------------------------------------------* 02430077
024400                                                                  02440077
024500     COPY VNWS003.                                                02450077
024600                                                                  02460077
024700     EJECT                                                        02470077
024800*---------------------------------------------------------------* 02480077
024900*    MAP LAYOUT                                                 * 02490077
025000*---------------------------------------------------------------* 02500077
025100                                                                  02510077
025200     COPY VNKM026.                                                02520077
025300*                                                                 02530077
025400 01  MR-OCCURS-LAYOUT                   REDEFINES  VN026AO.       02540077
025500     05  FILLER                         PIC X(17).                02550077
025600     05  MR-DPTNBR                      PIC X(03).                02560077
025700     05  FILLER                         PIC X(05).                02570077
025800     05  MR-VNNAME                      PIC X(30).                02580077
025900     05  FILLER                         PIC X(05).                02590077
026000     05  MR-INHS                        PIC X(03).                02600077
026100     05  FILLER                         PIC X(05).                02610077
026200     05  MR-DUNNBR                      PIC X(09).                02620077
026300     05  FILLER                         PIC X(30).                02630077
026400     05  MR-SCROLL-AREA                 OCCURS 11 TIMES.          02640077
026500         10  MR-SELECTL                 PIC S9(04) COMP.          02650077
026600         10  MR-SELECTA                 PIC  X(01).               02660077
026700         10  MR-SELECTC                 PIC  X(01).               02670077
026800         10  MR-SELECTH                 PIC  X(01).               02680077
026900         10  MR-SELECTI                 PIC  X(01).               02690077
027000                                                                  02700077
027100         10  MR-TRANCODEL               PIC S9(04) COMP.          02710077
027200         10  MR-TRANCODEA               PIC  X(01).               02720077
027300         10  MR-TRANCODEC               PIC  X(01).               02730077
027400         10  MR-TRANCODEH               PIC  X(01).               02740077
027500         10  MR-TRANCODE                PIC  X(02).               02750077
027600                                                                  02760077
027700         10  MR-PERCENTL                PIC S9(04) COMP.          02770077
027800         10  MR-PERCENTA                PIC  X(01).               02780077
027900         10  MR-PERCENTC                PIC  X(01).               02790077
028000         10  MR-PERCENTH                PIC  X(01).               02800077
028100         10  MR-PERCENT                 PIC  ZZ.99.               02810077
028200                                                                  02820077
028300         10  MR-PCTSIGNL                PIC S9(04) COMP.          02830077
028400         10  MR-PCTSIGNA                PIC  X(01).               02840077
028500         10  MR-PCTSIGNC                PIC  X(01).               02850077
028600         10  MR-PCTSIGNH                PIC  X(01).               02860077
028700         10  MR-PCTSIGN                 PIC  X(01).               02870077
028800                                                                  02880077
028900         10  MR-DESCRIPTIONL            PIC S9(04) COMP.          02890077
029000         10  MR-DESCRIPTIONA            PIC  X(01).               02900077
029100         10  MR-DESCRIPTIONC            PIC  X(01).               02910077
029200         10  MR-DESCRIPTIONH            PIC  X(01).               02920077
029300         10  MR-DESCRIPTION             PIC  X(18).               02930077
029400                                                                  02940077
029500         10  MR-NET-RTVL                PIC S9(04) COMP.          02950077
029600         10  MR-NET-RTVA                PIC  X(01).               02960077
029700         10  MR-NET-RTVC                PIC  X(01).               02970077
029800         10  MR-NET-RTVH                PIC  X(01).               02980077
029900         10  MR-NET-RTV                 PIC  X(01).               02990077
030000                                                                  03000077
030100         10  MR-NET-DISCL               PIC S9(04) COMP.          03010077
030200         10  MR-NET-DISCA               PIC  X(01).               03020077
030300         10  MR-NET-DISCC               PIC  X(01).               03030077
030400         10  MR-NET-DISCH               PIC  X(01).               03040077
030500         10  MR-NET-DISC                PIC  X(01).               03050077
030600                                                                  03060077
030700         10  MR-FREQUENCYL              PIC S9(04) COMP.          03070077
030800         10  MR-FREQUENCYA              PIC  X(01).               03080077
030900         10  MR-FREQUENCYC              PIC  X(01).               03090077
031000         10  MR-FREQUENCYH              PIC  X(01).               03100077
031100         10  MR-FREQUENCY               PIC  X(07).               03110077
031200                                                                  03120077
031300         10  MR-EFFDTEL                 PIC S9(04) COMP.          03130077
031400         10  MR-EFFDTEA                 PIC  X(01).               03140077
031500         10  MR-EFFDTEC                 PIC  X(01).               03150077
031600         10  MR-EFFDTEH                 PIC  X(01).               03160077
031700         10  MR-EFFDTE                  PIC  X(10).               03170077
031800                                                                  03180077
031900         10  MR-EXPDTEL                 PIC S9(04) COMP.          03190077
032000         10  MR-EXPDTEA                 PIC  X(01).               03200077
032100         10  MR-EXPDTEC                 PIC  X(01).               03210077
032200         10  MR-EXPDTEH                 PIC  X(01).               03220077
032300         10  MR-EXPDTE                  PIC  X(10).               03230077
032400                                                                  03240077
032500     EJECT                                                        03250077
032600*---------------------------------------------------------------* 03260077
032700*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03270077
032800*---------------------------------------------------------------* 03280077
032900                                                                  03290077
033000     COPY DPWS015.                                                03300077
033100                                                                  03310077
033200*---------------------------------------------------------------* 03320077
033300*    FUNCTION KEYS COPYBOOK.                                    * 03330077
033400*---------------------------------------------------------------* 03340077
033500                                                                  03350077
033600     COPY DPWS016.                                                03360077
033700                                                                  03370077
033800*---------------------------------------------------------------* 03380077
033900*    NUMERIC EDIT LAYOUT.                                       * 03390077
034000*---------------------------------------------------------------* 03400077
034100                                                                  03410077
034200     COPY DPWS010I.                                               03420077
034300 EJECT                                                            03430077
034400*---------------------------------------------------------------* 03440077
034500*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * 03450081
034600*---------------------------------------------------------------* 03460077
034700                                                                  03470077
034800     COPY DPWS030.                                                03480077
034800     COPY DPWS930.                                                03481081
034900 EJECT                                                            03490077
035000*---------------------------------------------------------------* 03500077
035100*    STANDARD COMMAREA.                                         * 03510077
035200*---------------------------------------------------------------* 03520077
035300                                                                  03530077
035400     COPY DPWS020.                                                03540077
035500     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03550077
035600                                                                  03560077
035700*---------------------------------------------------------------* 03570077
035800* INTER-APPLICATION COMMAREA.                                   * 03580077
035900*   VNWS001 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 03590077
036000*             SPEC SCREEN.                                      * 03600077
036100*** VNWS002 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03610077
036200***           THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 03620077
036300*---------------------------------------------------------------* 03630077
036400                                                                  03640077
036500         10  INTER-APPL-COMM-AREA       PIC X(200).               03650077
036600     COPY VNWS001.                                                03660077
036700     COPY VNWS002.                                                03670077
036800*---------------------------------------------------------------* 03680077
036900*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03690077
037000*---------------------------------------------------------------* 03700077
037100         10  ASC-SPECIFIC-COMMAREA.                               03710077
037200             15  ASC-LIST-KEYS.                                   03720077
037300                 20  ASC-KEY-ENT-ID           PIC S9(9) COMP.     03730077
037400                 20  ASC-KEY-DEPT-NBR         PIC X(03).          03740077
037500                 20  ASC-KEY-INHOUSE-NBR      PIC 9(03).          03750077
037600                 20  ASC-KEY-ENT-NAME-DESC    PIC X(30).          03760077
037700                 20  ASC-KEY-DUN-NBR          PIC X(09).          03770077
037800             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03780077
037900                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03790077
038000                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03800077
038100                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03810077
038200                                                                  03820077
038300                 20  ASC-ITEM-ARRAY.                              03830077
038400                     25  ASC-ITEM-ENTRIES OCCURS 11 TIMES.        03840077
038500                         30  ASC-LIST-ITEM-NUMBER                 03850077
038600                                                     PIC S9(09)   03860077
038700                                                     COMP-3.      03870077
038800                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03880077
038900                             88  ASC-VALID-SELECT    VALUE ' '    03890077
039000                                                           'S'.   03900077
039100                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03910077
039200                             88  ASC-TEMP-SELECT     VALUE 'S'.   03920077
039300                         30  ASC-SELECTED-SW         PIC  X(01).  03930077
039400                             88  ASC-NO-SELECT       VALUE ' '.   03940077
039500                             88  ASC-SELECT          VALUE 'S'.   03950077
039600                         30  ASC-ENT-ID              PIC S9(09)   03960077
039700                                                          COMP.   03970077
039800                         30  ASC-TRANCODE            PIC  X(02).  03980077
039900                         30  ASC-PERCENT             PIC 9(02)V99.03990077
040000                         30  ASC-DESCRIPTION         PIC  X(18).  04000077
040100                         30  ASC-NET-RTV             PIC  X(01).  04010077
040200                         30  ASC-NET-DISC            PIC  X(01).  04020077
040300                         30  ASC-FREQUENCY           PIC  X(02).  04030077
040400                         30  ASC-EFFDTE-MM           PIC  9(02).  04040077
040500                         30  ASC-EFFDTE-DD           PIC  9(02).  04050077
040600                         30  ASC-EFFDTE-CCYY         PIC  9(04).  04060077
040700                         30  ASC-EXPDTE-MM           PIC  9(02).  04070077
040800                         30  ASC-EXPDTE-DD           PIC  9(02).  04080077
040900                         30  ASC-EXPDTE-CCYY         PIC  9(04).  04090077
041000                                                                  04100077
041100             15  ASC-BLK-SUB                         PIC S9(04)   04110077
041200                                                          COMP    04120077
041300                                                          SYNC.   04130077
041400             15  ASC-ITEM-SUB                        PIC S9(04)   04140077
041500                                                          COMP    04150077
041600                                                          SYNC.   04160077
041700             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   04170077
041800                                                          COMP-3. 04180077
041900             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   04190077
042000                                                          COMP-3. 04200077
042100             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   04210077
042200                                                          COMP-3. 04220077
042300             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   04230077
042400                                                          COMP-3. 04240077
042500             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   04250077
042600                                                          COMP-3. 04260077
042700             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   04270077
042800                                                          COMP    04280077
042900                                                          SYNC.   04290077
043000             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   04300077
043100                                                          COMP-3. 04310077
043200             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   04320077
043300                                                          COMP-3. 04330077
043400             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  04340077
043500                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   04350077
043600                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   04360077
043700             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  04370077
043800                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   04380077
043900                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   04390077
044000             15  ASC-LIST-QUEUE-NAME.                             04400077
044100                 20  ASC-LIST-TERM-ID                PIC  X(04).  04410077
044200                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   04420077
044300                                                          COMP-3. 04430077
044400                 20  ASC-LIST-SEQ                    PIC  9(01).  04440077
044500             15  ASC-SEL-QUEUE-NAME.                              04450077
044600                 20  ASC-SEL-TERM-ID                 PIC  X(04).  04460077
044700                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   04470077
044800                                                          COMP-3. 04480077
044900                 20  ASC-SEL-SEQ                     PIC  9(01).  04490077
045000                                                                  04500077
045100             15  ASC-START-ITEM-REQUEST.                          04510077
045200                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04520077
045300             15  ASC-SAVE-CURSOR-SW     PIC X(01).                04530077
045400             15  ASC-CURSOR-SW          PIC X(01).                04540077
045500                 88  ASC-NO-CURSOR                 VALUE 'N'.     04550077
045600                 88  ASC-ACTIVE-CURSOR             VALUE 'A'.     04560077
045700                 88  ASC-EXPIRE-CURSOR             VALUE 'E'.     04570077
045800     EJECT                                                        04580077
045900*---------------------------------------------------------------* 04590077
046000*    ABEND PROCESSING COPYBOOK.                                 * 04600077
046100*---------------------------------------------------------------* 04610077
046200                                                                  04620077
046300     COPY DPWS013.                                                04630077
046400                                                                  04640077
046500 EJECT                                                            04650077
046600*---------------------------------------------------------------* 04660077
046700*    DB2 AREA FOR VENDOR AGREEMENT TABLE                        * 04670077
046800*---------------------------------------------------------------* 04680077
046900     EXEC SQL                                                     04690077
047000          INCLUDE TVNDAGR                                         04700077
047100     END-EXEC.                                                    04710077
047200                                                                  04720077
047300*---------------------------------------------------------------* 04730077
047400*    DB2 AREA FOR TRANSACTION CODE TABLE                        * 04740077
047500*---------------------------------------------------------------* 04750077
047600     EXEC SQL                                                     04760077
047700          INCLUDE TTRNCDE                                         04770077
047800     END-EXEC.                                                    04780077
047900                                                                  04790077
048000*---------------------------------------------------------------* 04800077
048100*    DB2 AREA FOR EXTERNAL ENTERPRISE TABLE                     * 04810077
048200*---------------------------------------------------------------* 04820077
048300     EXEC SQL                                                     04830077
048400          INCLUDE TEXTENT                                         04840077
048500     END-EXEC.                                                    04850077
048600                                                                  04860077
048700*---------------------------------------------------------------* 04870077
048800*    DB2 AREA FOR COMMUNICATIONS                                * 04880077
048900*---------------------------------------------------------------* 04890077
049000     EXEC SQL                                                     04900077
049100          INCLUDE SQLCA                                           04910077
049200     END-EXEC.                                                    04920077
049300                                                                  04930077
049400*---------------------------------------------------------------* 04940077
049500*    ACTIVE PROGAM CURSOR                                       * 04950077
049600*---------------------------------------------------------------* 04960077
049700                                                                  04970077
049800     EXEC SQL                                                     04980077
049900          DECLARE ACTIVE-PROGRAM-CSR CURSOR FOR                   04990077
050000          SELECT A.AP_TRN_CDE                                     05000077
050100                ,A.DISCOUNT_PCT                                   05010077
050200                ,A.EFFECTIVE_DATE                                 05020077
050300                ,A.EXPIRATION_DATE                                05030077
050400                ,A.PSTG_FRQ_CDE                                   05040077
050500                ,A.DED_DISC_IND                                   05050077
050600                ,A.DED_RTV_IND                                    05060077
050700                ,B.TRN_SHRT_DESC                                  05070077
050800            FROM TVNDAGR A                                        05080077
050900                ,TTRNCDE B                                        05090077
051000           WHERE A.AP_TRN_CDE     = B.AP_TRN_CDE                  05100077
051100             AND A.AGRMT_TYP_ID   = '6'                           05110077
051200             AND A.TYP_CDE        = 6                             05120077
051300             AND (CURRENT DATE BETWEEN A.EFFECTIVE_DATE AND       05130077
051400                                       A.EXPIRATION_DATE          05140077
051500                  OR A.EFFECTIVE_DATE > CURRENT DATE)             05150077
051600             AND B.EFF_STRT_DTE =                                 05160077
051700                 (SELECT MIN(T.EFF_STRT_DTE)                      05170077
051800                    FROM TTRNCDE T                                05180077
051900                   WHERE T.AP_TRN_CDE  = B.AP_TRN_CDE             05190077
052000                     AND (A.EFFECTIVE_DATE  BETWEEN T.EFF_STRT_DTE05200077
052100                                                AND T.EFF_END_DTE 05210077
052200                      OR  (A.EFFECTIVE_DATE < T.EFF_STRT_DTE AND  05220077
052300                           A.EFFECTIVE_DATE < T.EFF_END_DTE)))    05230077
052400             AND A.ENT_ID         = :DK-ENT-ID                    05240077
052500             AND A.DEPT_NBR       = :DK-DEPT-NBR                  05250077
052600           ORDER BY A.AP_TRN_CDE                                  05260077
052700                   ,A.EFFECTIVE_DATE                              05270077
052800     END-EXEC.                                                    05280077
052900                                                                  05290077
053000*---------------------------------------------------------------* 05300077
053100*    EXPIRED PROGRAM CURSOR                                     * 05310077
053200*---------------------------------------------------------------* 05320077
053300                                                                  05330077
053400     EXEC SQL                                                     05340077
053500          DECLARE EXPIRE-PROGRAM-CSR CURSOR FOR                   05350077
053600          SELECT A.AP_TRN_CDE                                     05360077
053700                ,A.DISCOUNT_PCT                                   05370077
053800                ,A.EFFECTIVE_DATE                                 05380077
053900                ,A.EXPIRATION_DATE                                05390077
054000                ,A.PSTG_FRQ_CDE                                   05400077
054100                ,A.DED_DISC_IND                                   05410077
054200                ,A.DED_RTV_IND                                    05420077
054300                ,B.TRN_SHRT_DESC                                  05430077
054400            FROM TVNDAGR A                                        05440077
054500                ,TTRNCDE B                                        05450077
054600           WHERE A.AP_TRN_CDE      = B.AP_TRN_CDE                 05460077
054700             AND A.AGRMT_TYP_ID    = '6'                          05470077
054800             AND A.TYP_CDE         = 6                            05480077
054900             AND B.EFF_STRT_DTE =                                 05490077
055000                 (SELECT MIN(T.EFF_STRT_DTE)                      05500077
055100                    FROM TTRNCDE T                                05510077
055200                   WHERE T.AP_TRN_CDE  = B.AP_TRN_CDE             05520077
055300                     AND (A.EFFECTIVE_DATE  BETWEEN T.EFF_STRT_DTE05530077
055400                                                 AND T.EFF_END_DTE05540077
055500                    AND (A.EXPIRATION_DATE  BETWEEN T.EFF_STRT_DTE05550077
055600                                                AND T.EFF_END_DTE)05560077
055700                       OR  (A.EFFECTIVE_DATE < T.EFF_STRT_DTE AND 05570077
055800                            A.EFFECTIVE_DATE < T.EFF_END_DTE)))   05580077
055900             AND A.ENT_ID          = :DK-ENT-ID                   05590077
056000             AND A.DEPT_NBR        = :DK-DEPT-NBR                 05600077
056100           ORDER BY A.AP_TRN_CDE ASC                              05610077
056200                   ,A.EXPIRATION_DATE DESC                        05620077
056300                   ,A.EFFECTIVE_DATE ASC                          05630077
056400     END-EXEC.                                                    05640077
056500                                                                  05650077
056600 EJECT                                                            05660077
056700 LINKAGE SECTION.                                                 05670077
056800                                                                  05680077
056900 01  DFHCOMMAREA.                                                 05690077
057000     05  FILLER                         OCCURS  1 TO 4072 TIMES   05700077
057100                                        DEPENDING ON EIBCALEN.    05710077
057200         10  FILLER                     PIC X.                    05720077
057300                                                                  05730077
057400 EJECT                                                            05740077
057500 PROCEDURE DIVISION.                                              05750077
057600******************************************************************05760077
057700**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **05770077
057800**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **05780077
057900**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **05790077
058000******************************************************************05800077
058100 0000-MAIN-MODULE.                                                05810077
058200     INITIALIZE DP030-CICS-API-FIELDS.                            05820077
058300     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05830077
058400     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05840077
058500     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05850077
058600     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05860077
058700     MOVE LENGTH OF VN026AI        TO DP030-MAP-LENGTH (1).       05870077
058800     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05880077
058900     PERFORM 0001-CALL-CICS-ARCH-API.                             05890077
059000*                                                                 05900077
059100     PERFORM 1000-CONTROL-PROCESSING                              05910077
059200*                                                                 05920077
059300     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05930077
059400     PERFORM 0001-CALL-CICS-ARCH-API.                             05940077
059500                                                                  05950077
059600******************************************************************05960077
059700**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **05970077
059800**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **05980077
059900******************************************************************05990077
060000 0001-CALL-CICS-ARCH-API.                                         06000077
060100*    CALL 'DPKCS030' USING DFHEIBLK                               06010081
060100     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      06011081
060200                           DFHCOMMAREA                            06020077
060300                           DP030-CICS-API-FIELDS                  06030077
060400                           DP020-STANDARD-COMMAREA                06040077
060500                           VN026AI.                               06050077
060600*                                                                 06060077
060700     IF  DP030-RC-CALL-SUCCESSFUL                                 06070077
060800         CONTINUE                                                 06080077
060900     ELSE                                                         06090077
061000         SET DP013-NO-ROLLBACK                                    06100077
061100             DP013-XCTL-DISPLAY-RESTART                           06110077
061200             DP013-CICS-ABEND      TO TRUE                        06120077
061300         MOVE '0001-CALL-CICS-ARCH-API'                           06130077
061400                                   TO DP013-PARAGRAPH             06140077
061500*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX06150081
061600*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      06160081
061500         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O06161081
061600-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06162081
061700         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06170077
061800         PERFORM DP013-0000-PROCESS-ABEND                         06180077
061900     END-IF.                                                      06190077
062000*----------------------------------------------------------------*06200077
062100* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *06210077
062200* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *06220077
062300*                                                                *06230077
062400* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *06240077
062500*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *06250077
062600*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *06260077
062700*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *06270077
062800*----------------------------------------------------------------*06280077
062900                                                                  06290077
063000 1000-CONTROL-PROCESSING.                                         06300077
063100                                                                  06310077
063200     EVALUATE TRUE                                                06320077
063300         WHEN DP020-NEXT-ACT-INITIAL                              06330077
063400             INITIALIZE ASC-SPECIFIC-COMMAREA                     06340077
063500             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            06350077
063600                                      ASC-SEL-TERM-ID             06360077
063700             MOVE DP020-SRC-TASK-NUMBER                           06370077
063800                                   TO ASC-LIST-TASK-NUMBER        06380077
063900                                      ASC-SEL-TASK-NUMBER         06390077
064000             MOVE PC-LIST-QUEUE-SEQ                               06400077
064100                                   TO ASC-LIST-SEQ                06410077
064200             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 06420077
064300             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06430077
064400***-----$TEMPLATE NOTE$-------------------------------------------06440077
064500*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,06450077
064600*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  06460077
064700*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.06470077
064800***---------------------------------------------------------------06480077
064900             IF  PS-COMMAREA-NOT-VALID                            06490077
065000                 SET DP020-NEXT-ACT-APPL-ERROR                    06500077
065100                                   TO TRUE                        06510077
065200             ELSE                                                 06520077
065300                 PERFORM 4000-BUILD-INITIAL-PANEL                 06530077
065400             END-IF                                               06540077
065500                                                                  06550077
065600         WHEN DP020-NEXT-ACT-READ-MAP                             06560077
065700             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06570077
065800                                   TO PV-TOP-ITEM                 06580077
065900             PERFORM 2000-PROCESS-PANEL                           06590077
066000                                                                  06600077
066100         WHEN DP020-NEXT-ACT-RETURN                               06610077
066200             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06620077
066300                                   TO PV-TOP-ITEM                 06630077
066400             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06640077
066500             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 06650077
066600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06660077
066700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06670077
066800                                                                  06680077
066900         WHEN OTHER                                               06690077
067000             SET DP013-LOGIC-ABEND TO TRUE                        06700077
067100             SET DP013-NO-ROLLBACK TO TRUE                        06710077
067200             MOVE '1000-CONTROL-PROCESSING'                       06720077
067300                                   TO DP013-PARAGRAPH             06730077
067400             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06740077
067500                                   TO DP013-MESSAGE-TEXT(1)       06750077
067600             PERFORM DP013-0000-PROCESS-ABEND                     06760077
067700     END-EVALUATE.                                                06770077
067800                                                                  06780077
067900 EJECT                                                            06790077
068000*----------------------------------------------------------------*06800077
068100* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06810077
068200* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06820077
068300*----------------------------------------------------------------*06830077
068400                                                                  06840077
068500 1100-PROCESS-INTER-APPL-COMM.                                    06850077
068600                                                                  06860077
068700     SET PS-COMMAREA-VALID         TO TRUE.                       06870077
068800     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06880077
068900     IF  DP020-INT-APPL-FORMAT-IND = PC-INTER-APPL-BLANK          06890077
069000         MOVE VN001-DEPARTMENT-NUMBER TO DK-DEPT-NBR              06900077
069100                                         ASC-KEY-DEPT-NBR         06910077
069200         MOVE VN001-VENDOR-NAME       TO DK-VEND-NAME             06920077
069300                                         ASC-KEY-ENT-NAME-DESC    06930077
069400         MOVE VN001-DUNS-NUMBER       TO DK-DUNS-NUMBER           06940077
069500                                         ASC-KEY-DUN-NBR          06950077
069600         MOVE VN001-INHOUSE-NUMBER    TO PV-INHOUSE-NBR-X         06960077
069700         MOVE PV-INHOUSE-NBR          TO DK-INHOUSE-NUMBER        06970077
069800                                         ASC-KEY-INHOUSE-NBR      06980077
069900         SET ASC-ACTIVE-CURSOR        TO TRUE                     06990077
070000         MOVE ASC-CURSOR-SW           TO ASC-SAVE-CURSOR-SW       07000077
070100         PERFORM 1150-SELECT-ENT-ID                               07010077
070200     END-IF.                                                      07020077
070300                                                                  07030077
070400 EJECT                                                            07040077
070500 1150-SELECT-ENT-ID.                                              07050077
070600                                                                  07060077
070700     PERFORM                                                      07070077
070800         WITH TEST AFTER                                          07080077
070900         VARYING PV-RETRY-COUNTER                                 07090077
071000         FROM 1 BY 1                                              07100077
071100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07110077
071200             OR (SQLCODE = +0)                                    07120077
071300             OR (SQLCODE = +100))                                 07130077
071400                                                                  07140077
071500         EXEC SQL                                                 07150077
071600              SELECT A.ENT_ID                                     07160077
071700                INTO :EXTENT-ENT-ID                               07170077
071800                FROM TEXTENT A                                    07180077
071900               WHERE A.DUN_NBR       = :DK-DUNS-NUMBER            07190077
072000                 AND A.STATUS_CDE    = 'A'                        07200077
072100         END-EXEC                                                 07210077
072200                                                                  07220077
072300         EVALUATE TRUE                                            07230077
072400             WHEN SQLCODE = +0                                    07240077
072500                  MOVE EXTENT-ENT-ID TO ASC-KEY-ENT-ID            07250077
072600                                        DK-ENT-ID                 07260077
072700                                                                  07270077
072800             WHEN SQLCODE = +100                                  07280077
072900                  SET PS-ERROR                                    07290077
073000                      DP020-MSG-FATAL                             07300077
073100                      DP020-NEXT-ACT-APPL-ERROR                   07310077
073200                                     TO TRUE                      07320077
073300                  MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER        07330077
073400                                                                  07340077
073500             WHEN SQLCODE = -904                                  07350077
073600             WHEN SQLCODE = -913                                  07360077
073700                  CONTINUE                                        07370077
073800                                                                  07380077
073900             WHEN SQLWARN0 NOT = SPACES                           07390077
074000             WHEN SQLCODE < +0                                    07400077
074100             WHEN SQLCODE > +0                                    07410077
074200                  MOVE '1150-SELECT-ENT-ID'                       07420077
074300                                  TO DP013-PARAGRAPH              07430077
074400                  MOVE 'UNSUCCESSFUL SELECT ENTERPRIS ID'         07440077
074500                                  TO DP013-MESSAGE-TEXT (1)       07450077
074600                  MOVE SQLCA      TO DP013-SQLCA                  07460077
074700                  MOVE 'TEXTENT ' TO DP013-DB2-TABLE-NAME (1)     07470077
074800                  SET DP013-DB2-ABEND                             07480077
074900                      DP013-XCTL-DISPLAY-RESTART                  07490077
075000                                  TO TRUE                         07500077
075100                  PERFORM DP013-0000-PROCESS-ABEND                07510077
075200         END-EVALUATE                                             07520077
075300     END-PERFORM.                                                 07530077
075400                                                                  07540077
075500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07550077
075600         MOVE '1150-SELECT-ENT-ID'                                07560077
075700                                  TO DP013-PARAGRAPH              07570077
075800         MOVE 'MAX RETRIES EXCEEDED ON SELECT ENTERPRISE ID'      07580077
075900                                  TO DP013-MESSAGE-TEXT (1)       07590077
076000         MOVE SQLCA               TO DP013-SQLCA                  07600077
076100         MOVE 'TEXTENT '          TO DP013-DB2-TABLE-NAME (1)     07610077
076200         SET DP013-DB2-ABEND                                      07620077
076300             DP013-XCTL-DISPLAY-RESTART                           07630077
076400                                  TO TRUE                         07640077
076500         PERFORM DP013-0000-PROCESS-ABEND                         07650077
076600     END-IF.                                                      07660077
076700                                                                  07670077
076800 EJECT                                                            07680077
076900*----------------------------------------------------------------*07690077
077000* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *07700077
077100* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *07710077
077200* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *07720077
077300* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *07730077
077400* FUNCTION KEYS CAN GET THIS FAR.                                *07740077
077500*----------------------------------------------------------------*07750077
077600                                                                  07760077
077700 2000-PROCESS-PANEL.                                              07770077
077800     EVALUATE TRUE                                                07780077
077900         WHEN DP020-SRC-AID = DP016-CLEAR                         07790077
078000             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07800077
078100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07810077
078200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07820077
078300                                                                  07830077
078400         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07840077
078500             MOVE ASC-SAVE-CURSOR-SW    TO ASC-CURSOR-SW          07850077
078600             MOVE ASC-KEY-ENT-ID        TO DK-ENT-ID              07860077
078700             MOVE ASC-KEY-DEPT-NBR      TO DK-DEPT-NBR            07870077
078800             MOVE ASC-KEY-INHOUSE-NBR   TO DK-INHOUSE-NUMBER      07880077
078900             MOVE ASC-KEY-ENT-NAME-DESC TO DK-VEND-NAME           07890077
079000             MOVE ASC-KEY-DUN-NBR       TO DK-DUNS-NUMBER         07900077
079100             PERFORM 2050-DELETE-LIST-QUEUE                       07910077
079200             PERFORM 4000-BUILD-INITIAL-PANEL                     07920077
079300                                                                  07930077
079400         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    07940077
079500             PERFORM 2140-DESELECT-ALL-ITEMS                      07950077
079600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07960077
079700                                                                  07970077
079800         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  07980077
079900             PERFORM 2150-SELECT-ALL-ITEMS                        07990077
080000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08000077
080100                                                                  08010077
080200         WHEN OTHER                                               08020077
080300             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 08030077
080400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08040077
080500             IF  PS-NO-ERROR                                      08050077
080600                 SET DP030-CONTINUE-GO                            08060077
080700                                 TO TRUE                          08070077
080800                 PERFORM 2100-CHECK-FUNCTION-KEY                  08080077
080900             ELSE                                                 08090077
081000                 SET DP030-OVERRIDE-GO                            08100077
081100                                 TO TRUE                          08110077
081200             END-IF                                               08120077
081300     END-EVALUATE.                                                08130077
081400 EJECT                                                            08140077
081500*----------------------------------------------------------------*08150077
081600*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *08160077
081700*----------------------------------------------------------------*08170077
081800 2050-DELETE-LIST-QUEUE.                                          08180077
081900                                                                  08190077
082000     EXEC CICS                                                    08200077
082100         DELETEQ TS                                               08210077
082200             QUEUE (ASC-LIST-QUEUE-NAME)                          08220077
082300             RESP  (PV-CICS-RESP)                                 08230077
082400     END-EXEC.                                                    08240077
082500                                                                  08250077
082600     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       08260077
082700        (PV-CICS-RESP = DFHRESP(QIDERR))                          08270077
082800         CONTINUE                                                 08280077
082900     ELSE                                                         08290077
083000         SET DP013-CICS-ABEND      TO TRUE                        08300077
083100         SET DP013-NO-ROLLBACK     TO TRUE                        08310077
083200                                                                  08320077
083300         MOVE '2050-DELETE-LIST-QUEUE'                            08330077
083400                                   TO DP013-PARAGRAPH             08340077
083500         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    08350077
083600                                   TO DP013-MESSAGE-TEXT (1)      08360077
083700         PERFORM DP013-0000-PROCESS-ABEND                         08370077
083800     END-IF.                                                      08380077
083900                                                                  08390077
084000     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  08400077
084100 EJECT                                                            08410077
084200*----------------------------------------------------------------*08420077
084300* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*08430077
084400* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *08440077
084500* CICS ARCHITECTURE API.                                         *08450077
084600*----------------------------------------------------------------*08460077
084700 2100-CHECK-FUNCTION-KEY.                                         08470077
084800     EVALUATE TRUE                                                08480077
084900         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  08490077
085000             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              08500077
085100                 INITIALIZE VN002-INTER-APPL-COMMAREA             08510077
085200                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                08520077
085300                                TO VN002-NUMBER-OF-SELECTED-ITEMS 08530077
085400                 PERFORM 5000-PREPARE-SEL-QUEUE                   08540077
085500             ELSE                                                 08550077
085600                 SET DP030-OVERRIDE-GO                            08560077
085700                                   TO TRUE                        08570077
085800                 MOVE PC-TSYMSG-00057                             08580077
085900                                   TO DP020-MSG-NUMBER            08590077
086000                 SET DP020-MSG-WARNING                            08600077
086100                                   TO TRUE                        08610077
086200             END-IF                                               08620077
086300                                                                  08630077
086400         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  08640077
086500             MOVE +1               TO PV-TOP-ITEM                 08650077
086600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08660077
086700                                                                  08670077
086800         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   08680077
086900             PERFORM 2110-BROWSE-BACKWARD                         08690077
087000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08700077
087100                                                                  08710077
087200         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   08720077
087300             PERFORM 2120-BROWSE-FORWARD                          08730077
087400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08740077
087500                                                                  08750077
087600         WHEN DP020-SRC-AID = DP016-ENTER                         08760077
087700             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   08770077
087800             IF  PS-ERROR                                         08780077
087900                 CONTINUE                                         08790077
088000             ELSE                                                 08800077
088100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08810077
088200             END-IF                                               08820077
088300                                                                  08830077
088400         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               08840077
088500* THIS IS PF24 AND EXECUTES THE EXPIRED CURSOR                    08850077
088600             PERFORM 2050-DELETE-LIST-QUEUE                       08860077
088700             SET ASC-EXPIRE-CURSOR TO TRUE                        08870077
088800             MOVE ASC-CURSOR-SW         TO ASC-SAVE-CURSOR-SW     08880077
088900             MOVE ASC-KEY-ENT-ID        TO DK-ENT-ID              08890077
089000             MOVE ASC-KEY-DEPT-NBR      TO DK-DEPT-NBR            08900077
089100             MOVE ASC-KEY-INHOUSE-NBR   TO DK-INHOUSE-NUMBER      08910077
089200             MOVE ASC-KEY-ENT-NAME-DESC TO DK-VEND-NAME           08920077
089300             MOVE ASC-KEY-DUN-NBR       TO DK-DUNS-NUMBER         08930077
089400             PERFORM 4000-BUILD-INITIAL-PANEL                     08940077
089500                                                                  08950077
089600         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               08960077
089700* THESE ARE PF13(ADD) AND PF15(UPDATE) THAT TRANSFER TO VNKCS027  08970077
089800             MOVE ASC-KEY-DEPT-NBR      TO VN001-DEPARTMENT-NUMBER08980077
089900             MOVE ASC-KEY-INHOUSE-NBR   TO VN001-INHOUSE-NUMBER   08990077
090000             MOVE ASC-KEY-ENT-NAME-DESC TO VN001-VENDOR-NAME      09000077
090100             MOVE ASC-KEY-DUN-NBR       TO VN001-DUNS-NUMBER      09010077
090200                                                                  09020077
090300         WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)               09030077
090400* THESE ARE PF13(ADD) AND PF15(UPDATE) THAT TRANSFER TO VNKCS027  09040077
090500             MOVE ASC-KEY-DEPT-NBR      TO VN001-DEPARTMENT-NUMBER09050077
090600             MOVE ASC-KEY-INHOUSE-NBR   TO VN001-INHOUSE-NUMBER   09060077
090700             MOVE ASC-KEY-ENT-NAME-DESC TO VN001-VENDOR-NAME      09070077
090800             MOVE ASC-KEY-DUN-NBR       TO VN001-DUNS-NUMBER      09080077
090900                                                                  09090077
091000         WHEN OTHER                                               09100077
091100             SET DP013-NO-ROLLBACK                                09110077
091200                 DP013-XCTL-DISPLAY-RESTART                       09120077
091300                 DP013-CICS-ABEND  TO TRUE                        09130077
091400             MOVE '2100-CHECK-FUNCTION-KEY'                       09140077
091500                                   TO DP013-PARAGRAPH             09150077
091600             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      09160077
091700                                   TO DP013-MESSAGE-TEXT (1)      09170077
091800             PERFORM DP013-0000-PROCESS-ABEND                     09180077
091900     END-EVALUATE.                                                09190077
092000*                                                                 09200077
092100*----------------------------------------------------------------*09210077
092200*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *09220077
092300*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *09230077
092400*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *09240077
092500*    MESSAGE.                                                    *09250077
092600*----------------------------------------------------------------*09260077
092700                                                                  09270077
092800 2110-BROWSE-BACKWARD.                                            09280077
092900     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    09290077
093000         GIVING PV-TOP-ITEM.                                      09300077
093100*                                                                 09310077
093200     IF  ((PV-TOP-ITEM < +1)                                      09320077
093300       OR (PV-TOP-ITEM = +1))                                     09330077
093400         MOVE +1                   TO PV-TOP-ITEM                 09340077
093500*        -- TOP OF LIST --                                        09350077
093600         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            09360077
093700         SET DP020-MSG-INFORMATIONAL TO TRUE                      09370077
093800     END-IF.                                                      09380077
093900                                                                  09390077
094000 EJECT                                                            09400077
094100*----------------------------------------------------------------*09410077
094200*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *09420077
094300*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *09430077
094400*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *09440077
094500*----------------------------------------------------------------*09450077
094600                                                                  09460077
094700 2120-BROWSE-FORWARD.                                             09470077
094800                                                                  09480077
094900     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              09490077
095000         GIVING PV-TOP-ITEM.                                      09500077
095100     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   09510077
095200         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09520077
095300                                   TO PV-TOP-ITEM                 09530077
095400*        -- BOTTOM OF LIST --                                     09540077
095500         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            09550077
095600         SET DP020-MSG-INFORMATIONAL                              09560077
095700                                   TO TRUE                        09570077
095800     ELSE                                                         09580077
095900         COMPUTE PV-BOTTOM-ITEM =                                 09590077
096000             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 09600077
096100         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            09610077
096200*            -- BOTTOM OF LIST --                                 09620077
096300             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            09630077
096400             SET DP020-MSG-INFORMATIONAL                          09640077
096500                                   TO TRUE                        09650077
096600         END-IF                                                   09660077
096700     END-IF.                                                      09670077
096800 EJECT                                                            09680077
096900*----------------------------------------------------------------*09690077
097000*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *09700077
097100*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *09710077
097200*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *09720077
097300*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *09730077
097400*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *09740077
097500*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *09750077
097600*----------------------------------------------------------------*09760077
097700                                                                  09770077
097800 2130-CHECK-FOR-JUMP-BROWSE.                                      09780077
097900     SET PS-NO-ERROR               TO TRUE.                       09790077
098000     IF (ASC-START-ITEM-REQUEST = SPACE)                          09800077
098100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09810077
098200                                   TO PV-TOP-ITEM                 09820077
098300     ELSE                                                         09830077
098400         MOVE ASC-START-ITEM-REQUEST                              09840077
098500                                   TO DP010I-UNEDITED-FIELD       09850077
098600         MOVE +5                   TO DP010I-MAXIMUM-DIGITS       09860077
098700         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     09870077
098800         SET DP010I-NEGATIVE-NOT-ALLOWED                          09880077
098900                                   TO TRUE                        09890077
099010         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09901078
099020                         USING DP010I-NUMERIC-EDIT-AREA           09902078
099030                                                                  09903078
099100                                                                  09910077
099200         IF  NOT DP010I-ERROR-DETECTED                            09920077
099300             MOVE DP010I-NUMERIC-FIELD                            09930077
099400                                   TO  ASC-START-ITEM-REQUEST-N   09940077
099500             IF  ASC-START-ITEM-REQUEST-N > ZERO                  09950077
099600                 IF  ASC-START-ITEM-REQUEST-N >                   09960077
099700                                          ASC-NUMBER-OF-ITEMS-READ09970077
099800                     MOVE SPACE TO ASC-START-ITEM-REQUEST         09980077
099900                     COMPUTE PV-TOP-ITEM =                        09990077
100000                             ASC-NUMBER-OF-ITEMS-READ             10000077
100100                             - PC-ITEMS-PER-PANEL + 1             10010077
100200                     IF  PV-TOP-ITEM < +1                         10020077
100300                         MOVE +1   TO PV-TOP-ITEM                 10030077
100400                         MOVE PC-TSYMSG-00070                     10040077
100500                                   TO DP020-MSG-NUMBER            10050077
100600                         SET DP020-MSG-INFORMATIONAL              10060077
100700                                   TO TRUE                        10070077
100800                     END-IF                                       10080077
100900                 ELSE                                             10090077
101000                     MOVE ASC-START-ITEM-REQUEST-N                10100077
101100                                   TO PV-TOP-ITEM                 10110077
101200                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      10120077
101300                     COMPUTE PV-BOTTOM-ITEM =                     10130077
101400                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     10140077
101500                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ10150077
101600*                        -- BOTTOM OF LIST --                     10160077
101700                         MOVE PC-TSYMSG-00070                     10170077
101800                                   TO DP020-MSG-NUMBER            10180077
101900                         SET DP020-MSG-INFORMATIONAL              10190077
102000                                   TO TRUE                        10200077
102100                     END-IF                                       10210077
102200                 END-IF                                           10220077
102300             ELSE                                                 10230077
102400*                --- VALUE OUT OF RANGE ----                      10240077
102500                 MOVE PC-TSYMSG-00101                             10250077
102600                                   TO DP020-MSG-NUMBER            10260077
102700                 MOVE -1           TO ASTRTITL                    10270077
102800                 SET DP030-SET-CURSOR-APPL-1                      10280077
102900                                   TO TRUE                        10290077
103000                 MOVE DP015-REVERSE                               10300077
103100                                   TO ASTRTITH                    10310077
103200                 MOVE DP015-RED    TO ASTRTITC                    10320077
103300                 MOVE DP015-UNP-NUM-BRT-MDT                       10330077
103400                                   TO ASTRTITA                    10340077
103500                 SET DP020-MSG-FATAL                              10350077
103600                                   TO TRUE                        10360077
103700                 SET PS-ERROR      TO TRUE                        10370077
103800             END-IF                                               10380077
103900                                                                  10390077
104000         ELSE                                                     10400077
104100             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            10410077
104200             MOVE -1               TO ASTRTITL                    10420077
104300             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  10430077
104400             MOVE DP015-REVERSE    TO ASTRTITH                    10440077
104500             MOVE DP015-RED        TO ASTRTITC                    10450077
104600             MOVE DP015-UNP-NUM-BRT-MDT                           10460077
104700                                   TO ASTRTITA                    10470077
104800             SET DP020-MSG-FATAL   TO TRUE                        10480077
104900             SET PS-ERROR          TO TRUE                        10490077
105000         END-IF                                                   10500077
105100     END-IF.                                                      10510077
105200 EJECT                                                            10520077
105300*----------------------------------------------------------------*10530077
105400*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *10540077
105500*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *10550077
105600*----------------------------------------------------------------*10560077
105700 2140-DESELECT-ALL-ITEMS.                                         10570077
105800     MOVE +1                       TO ASC-BLK-SUB.                10580077
105900                                                                  10590077
106000     PERFORM 2141-CLEAR-SELECTED-INDS                             10600077
106100         VARYING ASC-ITEM-SUB                                     10610077
106200         FROM 1 BY 1                                              10620077
106300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10630077
106400                                                                  10640077
106500     ADD +1                        TO ASC-BLK-SUB.                10650077
106600                                                                  10660077
106700     PERFORM 2141-CLEAR-SELECTED-INDS                             10670077
106800         VARYING ASC-ITEM-SUB                                     10680077
106900         FROM 1 BY 1                                              10690077
107000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10700077
107100                                                                  10710077
107200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10720077
107300                                   TO PV-LIST-ITEM-NUMBER.        10730077
107400                                                                  10740077
107500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10750077
107600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10760077
107700                                                                  10770077
107800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10780077
107900        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      10790077
108000         MOVE +1                   TO ASC-BLK-SUB                 10800077
108100                                                                  10810077
108200         PERFORM 5100-WRITE-TEMP-STORAGE                          10820077
108300                                                                  10830077
108400         MOVE +1                   TO PV-BLOCK-NUMBER             10840077
108500                                                                  10850077
108600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10860077
108700             PV-FIRST-BLOCK-IN-ARRAY - 1                          10870077
108800                                                                  10880077
108900         PERFORM                                                  10890077
109000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10900077
109100                                                                  10910077
109200             PERFORM 4410-READ-TEMP-STORAGE                       10920077
109300                                                                  10930077
109400             PERFORM 2141-CLEAR-SELECTED-INDS                     10940077
109500                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 10950077
109600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10960077
109700                                                                  10970077
109800             PERFORM 5100-WRITE-TEMP-STORAGE                      10980077
109900                                                                  10990077
110000             ADD +1                TO PV-BLOCK-NUMBER             11000077
110100                                                                  11010077
110200         END-PERFORM                                              11020077
110300                                                                  11030077
110400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11040077
110500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11050077
110600                                                                  11060077
110700         PERFORM                                                  11070077
110800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11080077
110900                   ASC-HIGHEST-BLOCK-WRITTEN                      11090077
111000                                                                  11100077
111100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11110077
111200                                   TO PV-BLOCK-NUMBER             11120077
111300                                                                  11130077
111400             PERFORM 4410-READ-TEMP-STORAGE                       11140077
111500                                                                  11150077
111600             PERFORM 2141-CLEAR-SELECTED-INDS                     11160077
111700                 VARYING ASC-ITEM-SUB                             11170077
111800                 FROM 1 BY 1                                      11180077
111900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11190077
112000                                                                  11200077
112100             PERFORM 5100-WRITE-TEMP-STORAGE                      11210077
112200                                                                  11220077
112300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11230077
112400                                                                  11240077
112500         END-PERFORM                                              11250077
112600                                                                  11260077
112700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11270077
112800                                   TO PV-BLOCK-NUMBER             11280077
112900                                                                  11290077
113000         PERFORM 4410-READ-TEMP-STORAGE                           11300077
113100     END-IF.                                                      11310077
113200                                                                  11320077
113300                                                                  11330077
113400     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 11340077
113500     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.11350077
113600     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  11360077
113700                                                                  11370077
113800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11380077
113900                                                                  11390077
114000 EJECT                                                            11400077
114100*----------------------------------------------------------------*11410077
114200*    MARK EACH ITEM AS BEING NOT SELECTED.                       *11420077
114300*----------------------------------------------------------------*11430077
114400                                                                  11440077
114500 2141-CLEAR-SELECTED-INDS.                                        11450077
114600                                                                  11460077
114700     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11470077
114800             NOT EQUAL ZERO                                       11480077
114900         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11490077
115000             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11500077
115100                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    11510077
115200                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11520077
115300                                   TO TRUE                        11530077
115400         END-IF                                                   11540077
115500     END-IF.                                                      11550077
115600                                                                  11560077
115700 EJECT                                                            11570077
115800*----------------------------------------------------------------*11580077
115900*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *11590077
116000*  FOR ALL ITEMS.                                                *11600077
116100*----------------------------------------------------------------*11610077
116200                                                                  11620077
116300 2150-SELECT-ALL-ITEMS.                                           11630077
116400                                                                  11640077
116500     MOVE +1                       TO ASC-BLK-SUB.                11650077
116600                                                                  11660077
116700     PERFORM 2151-SET-SELECTED-INDS                               11670077
116800         VARYING ASC-ITEM-SUB                                     11680077
116900         FROM 1 BY 1                                              11690077
117000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11700077
117100                                                                  11710077
117200     ADD +1                        TO ASC-BLK-SUB.                11720077
117300                                                                  11730077
117400     PERFORM 2151-SET-SELECTED-INDS                               11740077
117500         VARYING ASC-ITEM-SUB                                     11750077
117600         FROM 1 BY 1                                              11760077
117700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11770077
117800                                                                  11780077
117900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11790077
118000                                   TO PV-LIST-ITEM-NUMBER.        11800077
118100                                                                  11810077
118200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11820077
118300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11830077
118400                                                                  11840077
118500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11850077
118600        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    11860077
118700         MOVE +1                   TO ASC-BLK-SUB                 11870077
118800                                                                  11880077
118900         PERFORM 5100-WRITE-TEMP-STORAGE                          11890077
119000                                                                  11900077
119100         MOVE +1                   TO PV-BLOCK-NUMBER             11910077
119200                                                                  11920077
119300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11930077
119400             PV-FIRST-BLOCK-IN-ARRAY - 1                          11940077
119500                                                                  11950077
119600         PERFORM                                                  11960077
119700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11970077
119800                                                                  11980077
119900             PERFORM 4410-READ-TEMP-STORAGE                       11990077
120000                                                                  12000077
120100             PERFORM 2151-SET-SELECTED-INDS                       12010077
120200                 VARYING ASC-ITEM-SUB                             12020077
120300                 FROM 1 BY 1                                      12030077
120400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12040077
120500                                                                  12050077
120600             PERFORM 5100-WRITE-TEMP-STORAGE                      12060077
120700                                                                  12070077
120800             ADD +1                TO PV-BLOCK-NUMBER             12080077
120900                                                                  12090077
121000         END-PERFORM                                              12100077
121100                                                                  12110077
121200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12120077
121300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12130077
121400                                                                  12140077
121500         PERFORM                                                  12150077
121600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12160077
121700                   ASC-HIGHEST-BLOCK-WRITTEN                      12170077
121800                                                                  12180077
121900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12190077
122000                                   TO PV-BLOCK-NUMBER             12200077
122100                                                                  12210077
122200             PERFORM 4410-READ-TEMP-STORAGE                       12220077
122300                                                                  12230077
122400             PERFORM 2151-SET-SELECTED-INDS                       12240077
122500                 VARYING ASC-ITEM-SUB                             12250077
122600                 FROM 1 BY 1                                      12260077
122700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12270077
122800                                                                  12280077
122900             PERFORM 5100-WRITE-TEMP-STORAGE                      12290077
123000                                                                  12300077
123100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12310077
123200                                                                  12320077
123300         END-PERFORM                                              12330077
123400                                                                  12340077
123500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12350077
123600                                   TO PV-BLOCK-NUMBER             12360077
123700                                                                  12370077
123800         PERFORM 4410-READ-TEMP-STORAGE                           12380077
123900     END-IF.                                                      12390077
124000                                                                  12400077
124100                                                                  12410077
124200     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             12420077
124300                       ASC-NUMBER-OF-SELECTED-ITEMS.              12430077
124400                                                                  12440077
124500     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12450077
124600                                                                  12460077
124700 EJECT                                                            12470077
124800*----------------------------------------------------------------*12480077
124900*    MARK EACH ITEM AS BEING SELECTED.                           *12490077
125000*----------------------------------------------------------------*12500077
125100                                                                  12510077
125200 2151-SET-SELECTED-INDS.                                          12520077
125300                                                                  12530077
125400     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           12540077
125500             NOT EQUAL ZERO                                       12550077
125600         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12560077
125700             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12570077
125800                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        12580077
125900                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12590077
126000                               TO  TRUE                           12600077
126100         END-IF                                                   12610077
126200     END-IF.                                                      12620077
126300******************************************************************12630077
126400** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **12640077
126500** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **12650077
126600******************************************************************12660077
126700 2200-MOVE-SCREEN-TO-COMMAREA.                                    12670077
126800                                                                  12680077
126900     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             12690077
127000     MOVE +1                       TO PV-SUB.                     12700077
127100*                                                                 12710077
127200     PERFORM 3100-SET-SUBSCRIPTS.                                 12720077
127300     IF  ASTRTITL > ZERO                                          12730077
127400         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          12740077
127500     ELSE                                                         12750077
127600         IF  ASTRTITF = DP015-ERASE-EOF                           12760077
127700             INITIALIZE ASC-START-ITEM-REQUEST                    12770077
127800         END-IF                                                   12780077
127900     END-IF.                                                      12790077
128000     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          12800077
128100         VARYING PV-SUB                                           12810077
128200         FROM 1 BY 1                                              12820077
128300         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      12830077
128400******************************************************************12840077
128500** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**12850077
128600******************************************************************12860077
128700 2210-MOVE-LINES-TO-COMMAREA.                                     12870077
128800     IF  MR-SELECTL (PV-SUB) > ZERO                               12880077
128900         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             12890077
129000         MOVE MR-SELECTI (PV-SUB)                                 12900077
129100                                   TO ASC-TEMP-SELECTED-SW        12910077
129200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12920077
129300     ELSE                                                         12930077
129400         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                12940077
129500                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     12950077
129600                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        12960077
129700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12970077
129800         END-IF                                                   12980077
129900     END-IF.                                                      12990077
130000     ADD +1                        TO ASC-ITEM-SUB.               13000077
130100     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        13010077
130200         ADD +1                    TO ASC-BLK-SUB                 13020077
130300         MOVE +1                   TO ASC-ITEM-SUB                13030077
130400     END-IF.                                                      13040077
130500******************************************************************13050077
130600** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **13060077
130700** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **13070077
130800******************************************************************13080077
130900 3000-EDIT-DATA-IN-COMMAREA.                                      13090077
131000     SET PS-NO-ERROR               TO TRUE.                       13100077
131100     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     13110077
131200**                                                                13120077
131300* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              13130077
131400* EDITTING IS DONE FROM THE BOTTOM UP.                            13140077
131500**                                                                13150077
131600     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       13160077
131700         ASC-ITEMS-DISPLAYED - 1.                                 13170077
131800     PERFORM 3100-SET-SUBSCRIPTS.                                 13180077
131900     PERFORM 3300-EDIT-SELECTIONS                                 13190077
132000         VARYING PV-SUB                                           13200077
132100         FROM PV-SUB BY -1                                        13210077
132200         UNTIL PV-SUB < +1.                                       13220077
132300*                                                                 13230077
132400 EJECT                                                            13240077
132500*----------------------------------------------------------------*13250077
132600*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *13260077
132700*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*13270077
132800*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *13280077
132900*                                                                *13290077
133000*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *13300077
133100*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *13310077
133200*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *13320077
133300*    US IN THE 2ND BLOCK OF THE ARRAY.                           *13330077
133400*----------------------------------------------------------------*13340077
133500                                                                  13350077
133600 3100-SET-SUBSCRIPTS.                                             13360077
133700                                                                  13370077
133800     COMPUTE ASC-ITEM-SUB =                                       13380077
133900         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        13390077
134000                                                                  13400077
134100     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         13410077
134200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            13420077
134300                                                                  13430077
134400         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               13440077
134500     ELSE                                                         13450077
134600         MOVE +1                     TO ASC-BLK-SUB               13460077
134700     END-IF.                                                      13470077
134800******************************************************************13480077
134900** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **13490077
135000******************************************************************13500077
135100                                                                  13510077
135200 3200-RESET-ATTRIBUTES.                                           13520077
135300     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   13530077
135400     MOVE DP015-GREEN              TO ASTRTITC.                   13540077
135500     MOVE DP015-UNDERLINE          TO ASTRTITH.                   13550077
135600*                                                                 13560077
135700     PERFORM                                                      13570077
135800         VARYING PV-SUB                                           13580077
135900         FROM 1 BY 1                                              13590077
136000         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        13600077
136100         MOVE DP015-UNP-ALP-NOR-OFF                               13610077
136200                                   TO MR-SELECTA (PV-SUB)         13620077
136300         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         13630077
136400         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         13640077
136500     END-PERFORM.                                                 13650077
136600******************************************************************13660077
136700** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **13670077
136800** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **13680077
136900** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **13690077
137000** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **13700077
137100******************************************************************13710077
137200 3300-EDIT-SELECTIONS.                                            13720077
137300     EVALUATE TRUE                                                13730077
137400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13740077
137500             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         13750077
137600                 CONTINUE                                         13760077
137700         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         13770077
137800             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        13780077
137900                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   13790077
138000                 MOVE ASC-TEMP-SELECTED-SW                        13800077
138100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13810077
138200                                TO ASC-SELECTED-SW                13820077
138300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13830077
138400             END-IF                                               13840077
138500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13850077
138600                 = SPACE                                          13860077
138700             EVALUATE TRUE                                        13870077
138800                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       13880077
138900                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS13890077
139000                     MOVE SPACE TO ASC-SELECTED-SW                13900077
139100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13910077
139200             END-EVALUATE                                         13920077
139300         WHEN OTHER                                               13930077
139400             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           13940077
139500             SET DP020-MSG-FATAL    TO TRUE                       13950077
139600             MOVE -1                TO ASTRTITL                   13960077
139700             SET DP030-SET-CURSOR-APPL-1                          13970077
139800                                    TO TRUE                       13980077
139900             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        13990077
140000             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        14000077
140100             SET PS-ERROR TO TRUE                                 14010077
140200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14020077
140300                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     14030077
140400                 MOVE SPACE         TO ASC-SELECTED-SW            14040077
140500                                        (ASC-BLK-SUB ASC-ITEM-SUB)14050077
140600             END-IF                                               14060077
140700     END-EVALUATE.                                                14070077
140800                                                                  14080077
140900     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 14090077
141000     SUBTRACT +1 FROM ASC-ITEM-SUB.                               14100077
141100     IF  ASC-ITEM-SUB < 1                                         14110077
141200         SUBTRACT +1 FROM ASC-BLK-SUB                             14120077
141300         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                14130077
141400     END-IF.                                                      14140077
141500                                                                  14150077
141600 EJECT                                                            14160077
141700*----------------------------------------------------------------*14170077
141800*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *14180077
141900*    INITIALIZE ALL COUNTERS AND FLAGS.                          *14190077
142000*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *14200077
142100*    DISPLAY THE PANEL TO USER.                                  *14210077
142200*----------------------------------------------------------------*14220077
142300                                                                  14230077
142400 4000-BUILD-INITIAL-PANEL.                                        14240077
142500                                                                  14250077
142600     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            14260077
142700                                 ASC-BLOCK-ENTRIES (2).           14270077
142800     MOVE +1                 TO ASC-BLK-SUB.                      14280077
142900     SET ASC-ITEMS-LEFT-ON-DB                                     14290077
143000                             TO TRUE.                             14300077
143100                                                                  14310077
143200     MOVE +0                 TO ASC-ITEM-SUB                      14320077
143300                                ASC-NUMBER-OF-ITEMS-READ          14330077
143400                                ASC-NUMBER-OF-SELECTED-ITEMS      14340077
143500                                ASC-HIGHEST-BLOCK-WRITTEN         14350077
143600                                ASC-START-OF-SELECTED-RANGE       14360077
143700                                ASC-END-OF-SELECTED-RANGE         14370077
143800                                ASC-ITEM-AT-TOP-OF-PANEL.         14380077
143900                                                                  14390077
144000     IF ASC-ACTIVE-CURSOR                                         14400077
144100        PERFORM 4010-OPEN-CURSOR                                  14410077
144200     ELSE                                                         14420077
144300        PERFORM 4030-OPEN-CURSOR                                  14430077
144400     END-IF.                                                      14440077
144500                                                                  14450077
144600     PERFORM 4300-READ-ITEMS-FROM-DB                              14460077
144700                                                                  14470077
144800     IF ASC-ACTIVE-CURSOR                                         14480077
144900        PERFORM 4020-CLOSE-CURSOR                                 14490077
145000     ELSE                                                         14500077
145100        PERFORM 4040-CLOSE-CURSOR                                 14510077
145200     END-IF.                                                      14520077
145300                                                                  14530077
145400     MOVE +1                   TO  PV-TOP-ITEM.                   14540077
145500     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          14550077
145600         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    14560077
145700         SET DP020-MSG-FATAL   TO  TRUE                           14570077
145800         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               14580077
145900     ELSE                                                         14590077
146000         MOVE -1               TO ASTRTITL                        14600077
146100         SET DP030-SET-CURSOR-APPL-1                              14610077
146200                               TO TRUE                            14620077
146300         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     14630077
146400     END-IF.                                                      14640077
146500 EJECT                                                            14650077
146600*----------------------------------------------------------------*14660077
146700* OPEN THE ACTIVE PROGRAM CURSOR.                                *14670077
146800*----------------------------------------------------------------*14680077
146900                                                                  14690077
147000 4010-OPEN-CURSOR.                                                14700077
147100     PERFORM                                                      14710077
147200         WITH TEST AFTER                                          14720077
147300         VARYING PV-RETRY-COUNTER                                 14730077
147400         FROM 1 BY 1                                              14740077
147500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14750077
147600                   OR (SQLCODE = ZERO))                           14760077
147700                                                                  14770077
147800         EXEC SQL                                                 14780077
147900              OPEN ACTIVE-PROGRAM-CSR                             14790077
148000         END-EXEC                                                 14800077
148100                                                                  14810077
148200                                                                  14820077
148300         EVALUATE TRUE                                            14830077
148400             WHEN SQLCODE = ZERO                                  14840077
148500             WHEN SQLCODE = -904                                  14850077
148600             WHEN SQLCODE = -913                                  14860077
148700                 CONTINUE                                         14870077
148800             WHEN SQLWARN0 NOT = SPACES                           14880077
148900             WHEN SQLCODE < ZERO                                  14890077
149000             WHEN SQLCODE > ZERO                                  14900077
149100                 MOVE '4010-OPEN-CURSOR'                          14910077
149200                                   TO DP013-PARAGRAPH             14920077
149300                 MOVE 'UNSUCCESSFUL OPEN CURSOR     '             14930077
149400                                   TO DP013-MESSAGE-TEXT (1)      14940077
149500                 MOVE SQLCA        TO DP013-SQLCA                 14950077
149600                 MOVE 'TVNDAGR '   TO DP013-DB2-TABLE-NAME (1)    14960077
149700                 MOVE 'TTRNCDE '   TO DP013-DB2-TABLE-NAME (2)    14970077
149800                 SET DP013-DB2-ABEND                              14980077
149900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           14990077
150000                 PERFORM DP013-0000-PROCESS-ABEND                 15000077
150100         END-EVALUATE                                             15010077
150200     END-PERFORM.                                                 15020077
150300*                                                                 15030077
150400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15040077
150500         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             15050077
150600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   15060077
150700                                   TO DP013-MESSAGE-TEXT (1)      15070077
150800         MOVE SQLCA                TO DP013-SQLCA                 15080077
150900         MOVE 'TVNDAGR '           TO DP013-DB2-TABLE-NAME (1)    15090077
151000         MOVE 'TTRNCDE '           TO DP013-DB2-TABLE-NAME (1)    15100077
151100         SET DP013-DB2-ABEND                                      15110077
151200             DP013-XCTL-DISPLAY-RESTART                           15120077
151300                                   TO TRUE                        15130077
151400         PERFORM DP013-0000-PROCESS-ABEND                         15140077
151500     END-IF.                                                      15150077
151600                                                                  15160077
151700 EJECT                                                            15170077
151800*----------------------------------------------------------------*15180077
151900* CLOSE THE ACTIVE PROGRAM CSR                                   *15190077
152000*----------------------------------------------------------------*15200077
152100                                                                  15210077
152200 4020-CLOSE-CURSOR.                                               15220077
152300     EXEC SQL                                                     15230077
152400         CLOSE ACTIVE-PROGRAM-CSR                                 15240077
152500     END-EXEC.                                                    15250077
152600*                                                                 15260077
152700     EVALUATE TRUE                                                15270077
152800         WHEN SQLCODE = ZERO                                      15280077
152900             CONTINUE                                             15290077
153000         WHEN SQLWARN0 NOT = SPACES                               15300077
153100         WHEN SQLCODE < ZERO                                      15310077
153200         WHEN SQLCODE > ZERO                                      15320077
153300             MOVE '4020-CLOSE-CURSOR'                             15330077
153400                               TO DP013-PARAGRAPH                 15340077
153500             MOVE 'UNSUCCESSFUL CLOSE CURSOR   '                  15350077
153600                               TO DP013-MESSAGE-TEXT (1)          15360077
153700             MOVE SQLCA        TO DP013-SQLCA                     15370077
153800             MOVE 'TVNDAGR '   TO DP013-DB2-TABLE-NAME (1)        15380077
153900             MOVE 'TTRNCDE '   TO DP013-DB2-TABLE-NAME (2)        15390077
154000             SET DP013-DB2-ABEND                                  15400077
154100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15410077
154200             PERFORM DP013-0000-PROCESS-ABEND                     15420077
154300     END-EVALUATE.                                                15430077
154400                                                                  15440077
154500 EJECT                                                            15450077
154600*----------------------------------------------------------------*15460077
154700* OPEN THE EXPIRE PROGRAM CURSOR.                                *15470077
154800*----------------------------------------------------------------*15480077
154900                                                                  15490077
155000 4030-OPEN-CURSOR.                                                15500077
155100     PERFORM                                                      15510077
155200         WITH TEST AFTER                                          15520077
155300         VARYING PV-RETRY-COUNTER                                 15530077
155400         FROM 1 BY 1                                              15540077
155500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15550077
155600                   OR (SQLCODE = ZERO))                           15560077
155700                                                                  15570077
155800         EXEC SQL                                                 15580077
155900              OPEN EXPIRE-PROGRAM-CSR                             15590077
156000         END-EXEC                                                 15600077
156100                                                                  15610077
156200                                                                  15620077
156300         EVALUATE TRUE                                            15630077
156400             WHEN SQLCODE = ZERO                                  15640077
156500             WHEN SQLCODE = -904                                  15650077
156600             WHEN SQLCODE = -913                                  15660077
156700                 CONTINUE                                         15670077
156800             WHEN SQLWARN0 NOT = SPACES                           15680077
156900             WHEN SQLCODE < ZERO                                  15690077
157000             WHEN SQLCODE > ZERO                                  15700077
157100                 MOVE '4030-OPEN-CURSOR'                          15710077
157200                                   TO DP013-PARAGRAPH             15720077
157300                 MOVE 'UNSUCCESSFUL OPEN CURSOR     '             15730077
157400                                   TO DP013-MESSAGE-TEXT (1)      15740077
157500                 MOVE SQLCA        TO DP013-SQLCA                 15750077
157600                 MOVE 'TVNDAGR '   TO DP013-DB2-TABLE-NAME (1)    15760077
157700                 MOVE 'TTRNCDE '   TO DP013-DB2-TABLE-NAME (2)    15770077
157800                 SET DP013-DB2-ABEND                              15780077
157900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15790077
158000                 PERFORM DP013-0000-PROCESS-ABEND                 15800077
158100         END-EVALUATE                                             15810077
158200     END-PERFORM.                                                 15820077
158300*                                                                 15830077
158400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15840077
158500         MOVE '4030-OPEN-CURSOR'   TO DP013-PARAGRAPH             15850077
158600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   15860077
158700                                   TO DP013-MESSAGE-TEXT (1)      15870077
158800         MOVE SQLCA                TO DP013-SQLCA                 15880077
158900         MOVE 'TVNDAGR '           TO DP013-DB2-TABLE-NAME (1)    15890077
159000         MOVE 'TTRNCDE '           TO DP013-DB2-TABLE-NAME (1)    15900077
159100         SET DP013-DB2-ABEND                                      15910077
159200             DP013-XCTL-DISPLAY-RESTART                           15920077
159300                                   TO TRUE                        15930077
159400         PERFORM DP013-0000-PROCESS-ABEND                         15940077
159500     END-IF.                                                      15950077
159600                                                                  15960077
159700 EJECT                                                            15970077
159800*----------------------------------------------------------------*15980077
159900* CLOSE THE EXPIRE PROGRAM CSR                                   *15990077
160000*----------------------------------------------------------------*16000077
160100                                                                  16010077
160200 4040-CLOSE-CURSOR.                                               16020077
160300     EXEC SQL                                                     16030077
160400         CLOSE EXPIRE-PROGRAM-CSR                                 16040077
160500     END-EXEC.                                                    16050077
160600*                                                                 16060077
160700     EVALUATE TRUE                                                16070077
160800         WHEN SQLCODE = ZERO                                      16080077
160900             CONTINUE                                             16090077
161000         WHEN SQLWARN0 NOT = SPACES                               16100077
161100         WHEN SQLCODE < ZERO                                      16110077
161200         WHEN SQLCODE > ZERO                                      16120077
161300             MOVE '4040-CLOSE-CURSOR'                             16130077
161400                               TO DP013-PARAGRAPH                 16140077
161500             MOVE 'UNSUCCESSFUL CLOSE CURSOR   '                  16150077
161600                               TO DP013-MESSAGE-TEXT (1)          16160077
161700             MOVE SQLCA        TO DP013-SQLCA                     16170077
161800             MOVE 'TVNDAGR '   TO DP013-DB2-TABLE-NAME (1)        16180077
161900             MOVE 'TTRNCDE '   TO DP013-DB2-TABLE-NAME (2)        16190077
162000             SET DP013-DB2-ABEND                                  16200077
162100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               16210077
162200             PERFORM DP013-0000-PROCESS-ABEND                     16220077
162300     END-EVALUATE.                                                16230077
162400                                                                  16240077
162500 EJECT                                                            16250077
162600*----------------------------------------------------------------*16260077
162700*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *16270077
162800*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *16280077
162900*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *16290077
163000*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *16300077
163100*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *16310077
163200*                                                                *16320077
163300*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *16330077
163400*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *16340077
163500*    UPON INITIALIZATION.                                        *16350077
163600*----------------------------------------------------------------*16360077
163700                                                                  16370077
163800 4300-READ-ITEMS-FROM-DB.                                         16380077
163900                                                                  16390077
164000     PERFORM                                                      16400077
164100         VARYING PV-READ-COUNT                                    16410077
164200         FROM 1 BY 1                                              16420077
164300         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    16430077
164400            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         16440077
164500                                                                  16450077
164600         IF ASC-ACTIVE-CURSOR                                     16460077
164700             PERFORM 4310-FETCH                                   16470077
164800         ELSE                                                     16480077
164900             PERFORM 4320-FETCH                                   16490077
165000         END-IF                                                   16500077
165100                                                                  16510077
165200         IF  ASC-ITEMS-LEFT-ON-DB                                 16520077
165300             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                16530077
165400                 ADD +1            TO ASC-ITEM-SUB                16540077
165500             ELSE                                                 16550077
165600                 ADD +1            TO ASC-BLK-SUB                 16560077
165700                 MOVE +1           TO ASC-ITEM-SUB                16570077
165800                                                                  16580077
165900                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         16590077
166000                     MOVE +1       TO ASC-BLK-SUB                 16600077
166100                     SET ASC-BLOCK-MODIFIED (1)                   16610077
166200                                   TO TRUE                        16620077
166300                     PERFORM 5100-WRITE-TEMP-STORAGE              16630077
166400                     MOVE ASC-BLOCK-ENTRIES                       16640077
166500                               (PC-MAX-BLOCKS-IN-ARRAY)           16650077
166600                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 16660077
166700                     ADD +1        TO ASC-BLK-SUB                 16670077
166800                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   16680077
166900                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      16690077
167000                                   TO TRUE                        16700077
167100                 END-IF                                           16710077
167200             END-IF                                               16720077
167300             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    16730077
167400             MOVE ASC-NUMBER-OF-ITEMS-READ                        16740077
167500                                   TO ASC-LIST-ITEM-NUMBER        16750077
167600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16760077
167700             MOVE VNDAGR-AP-TRN-CDE TO ASC-TRANCODE               16770077
167800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16780077
167900             COMPUTE ASC-PERCENT (ASC-BLK-SUB ASC-ITEM-SUB) =     16790077
168000                               VNDAGR-DISCOUNT-PCT * 100          16800077
168100             MOVE VNDAGR-EFFECTIVE-DATE  TO PV-EFFDTE             16810077
168200             MOVE PV-EFFDTE-MM           TO ASC-EFFDTE-MM         16820077
168300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16830077
168400             MOVE PV-EFFDTE-DD           TO ASC-EFFDTE-DD         16840077
168500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16850077
168600             MOVE PV-EFFDTE-CCYY         TO ASC-EFFDTE-CCYY       16860077
168700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16870077
168800             MOVE VNDAGR-EXPIRATION-DATE TO PV-EXPDTE             16880077
168900             MOVE PV-EXPDTE-MM           TO ASC-EXPDTE-MM         16890077
169000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16900077
169100             MOVE PV-EXPDTE-DD           TO ASC-EXPDTE-DD         16910077
169200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16920077
169300             MOVE PV-EXPDTE-CCYY         TO ASC-EXPDTE-CCYY       16930077
169400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16940077
169500             MOVE TRNCDE-TRN-SHRT-DESC   TO ASC-DESCRIPTION       16950077
169600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16960077
169700             MOVE VNDAGR-PSTG-FRQ-CDE    TO ASC-FREQUENCY         16970077
169800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16980077
169900             MOVE VNDAGR-DED-DISC-IND    TO ASC-NET-DISC          16990077
170000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17000077
170100             MOVE VNDAGR-DED-RTV-IND     TO ASC-NET-RTV           17010077
170200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17020077
170300         END-IF                                                   17030077
170400     END-PERFORM.                                                 17040077
170500                                                                  17050077
170600     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          17060077
170700         MOVE +1               TO ASC-BLK-SUB                     17070077
170800         PERFORM 5100-WRITE-TEMP-STORAGE                          17080077
170900         ADD +1                TO ASC-BLK-SUB                     17090077
171000         PERFORM 5100-WRITE-TEMP-STORAGE                          17100077
171100                                                                  17110077
171200         MOVE 1                TO ASC-BLK-SUB                     17120077
171300                                  PV-BLOCK-NUMBER                 17130077
171400         PERFORM 4410-READ-TEMP-STORAGE                           17140077
171500         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             17150077
171600             MOVE 2            TO ASC-BLK-SUB                     17160077
171700                                  PV-BLOCK-NUMBER                 17170077
171800             PERFORM 4410-READ-TEMP-STORAGE                       17180077
171900         END-IF                                                   17190077
172000     END-IF.                                                      17200077
172100 EJECT                                                            17210077
172200*----------------------------------------------------------------*17220077
172300*    FETCH THE ACTIVE PROGRAM CSR                                *17230077
172400*----------------------------------------------------------------*17240077
172500                                                                  17250077
172600 4310-FETCH.                                                      17260077
172700                                                                  17270077
172800     EXEC SQL                                                     17280077
172900          FETCH ACTIVE-PROGRAM-CSR                                17290077
173000          INTO  :VNDAGR-AP-TRN-CDE                                17300077
173100              , :VNDAGR-DISCOUNT-PCT                              17310077
173200              , :VNDAGR-EFFECTIVE-DATE                            17320077
173300              , :VNDAGR-EXPIRATION-DATE                           17330077
173400              , :VNDAGR-PSTG-FRQ-CDE                              17340077
173500              , :VNDAGR-DED-DISC-IND                              17350077
173600              , :VNDAGR-DED-RTV-IND                               17360077
173700              , :TRNCDE-TRN-SHRT-DESC                             17370077
173800     END-EXEC.                                                    17380077
173900                                                                  17390077
174000     EVALUATE TRUE                                                17400077
174100         WHEN SQLCODE = ZERO                                      17410077
174200         WHEN SQLCODE = +100                                      17420077
174300              CONTINUE                                            17430077
174400         WHEN SQLWARN0 NOT = SPACE                                17440077
174500         WHEN SQLCODE NOT = ZERO                                  17450077
174600              MOVE '4310-FETCH-CURSOR'                            17460077
174700                               TO DP013-PARAGRAPH                 17470077
174800              MOVE 'FETCH ACTIVE PROGRAM CSR'                     17480077
174900                               TO DP013-MESSAGE-TEXT (1)          17490077
175000              MOVE SQLCA       TO DP013-SQLCA                     17500077
175100              SET DP013-DB2-ABEND                                 17510077
175200                               TO TRUE                            17520077
175300              PERFORM DP013-0000-PROCESS-ABEND                    17530077
175400     END-EVALUATE.                                                17540077
175500                                                                  17550077
175600     IF  SQLCODE EQUAL +100                                       17560077
175700         SET ASC-NO-ITEMS-LEFT-ON-DB                              17570077
175800                                   TO TRUE                        17580077
175900     END-IF.                                                      17590077
176000                                                                  17600077
176100 EJECT                                                            17610077
176200*----------------------------------------------------------------*17620077
176300*    FETCH THE EXPIRE PROGRAM CSR                                *17630077
176400*----------------------------------------------------------------*17640077
176500                                                                  17650077
176600 4320-FETCH.                                                      17660077
176700                                                                  17670077
176800     EXEC SQL                                                     17680077
176900          FETCH EXPIRE-PROGRAM-CSR                                17690077
177000          INTO  :VNDAGR-AP-TRN-CDE                                17700077
177100              , :VNDAGR-DISCOUNT-PCT                              17710077
177200              , :VNDAGR-EFFECTIVE-DATE                            17720077
177300              , :VNDAGR-EXPIRATION-DATE                           17730077
177400              , :VNDAGR-PSTG-FRQ-CDE                              17740077
177500              , :VNDAGR-DED-DISC-IND                              17750077
177600              , :VNDAGR-DED-RTV-IND                               17760077
177700              , :TRNCDE-TRN-SHRT-DESC                             17770077
177800     END-EXEC.                                                    17780077
177900                                                                  17790077
178000     EVALUATE TRUE                                                17800077
178100         WHEN SQLCODE = ZERO                                      17810077
178200         WHEN SQLCODE = +100                                      17820077
178300              CONTINUE                                            17830077
178400         WHEN SQLWARN0 NOT = SPACE                                17840077
178500         WHEN SQLCODE NOT = ZERO                                  17850077
178600              MOVE '4320-FETCH-CURSOR'                            17860077
178700                               TO DP013-PARAGRAPH                 17870077
178800              MOVE 'FETCH EXPIRE PROGRAM CSR'                     17880077
178900                               TO DP013-MESSAGE-TEXT (1)          17890077
179000              MOVE SQLCA       TO DP013-SQLCA                     17900077
179100              SET DP013-DB2-ABEND                                 17910077
179200                               TO TRUE                            17920077
179300              PERFORM DP013-0000-PROCESS-ABEND                    17930077
179400     END-EVALUATE.                                                17940077
179500                                                                  17950077
179600     IF  SQLCODE EQUAL +100                                       17960077
179700         SET ASC-NO-ITEMS-LEFT-ON-DB                              17970077
179800                                   TO TRUE                        17980077
179900     END-IF.                                                      17990077
180000                                                                  18000077
180100 EJECT                                                            18010077
180200*----------------------------------------------------------------*18020077
180300* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *18030077
180400*----------------------------------------------------------------*18040077
180500                                                                  18050077
180600 4400-MOVE-COMMAREA-TO-SCREEN.                                    18060077
180700     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             18070077
180800         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          18080077
180900         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          18090077
181000             MOVE +1    TO ASC-BLK-SUB                            18100077
181100             PERFORM 5100-WRITE-TEMP-STORAGE                      18110077
181200             ADD +1     TO ASC-BLK-SUB                            18120077
181300             PERFORM 5100-WRITE-TEMP-STORAGE                      18130077
181400             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             18140077
181500                 GIVING PV-BLOCK-NUMBER                           18150077
181600                 REMAINDER PV-REMAINDER                           18160077
181700             IF  PV-REMAINDER > ZERO                              18170077
181800                 ADD +1 TO PV-BLOCK-NUMBER                        18180077
181900             END-IF                                               18190077
182000             MOVE +1    TO ASC-BLK-SUB                            18200077
182100             PERFORM 4410-READ-TEMP-STORAGE                       18210077
182200             ADD +1     TO ASC-BLK-SUB                            18220077
182300                           PV-BLOCK-NUMBER                        18230077
182400             PERFORM 4410-READ-TEMP-STORAGE                       18240077
182500     END-IF.                                                      18250077
182600     MOVE +1            TO ASC-BLK-SUB.                           18260077
182700     COMPUTE ASC-ITEM-SUB =                                       18270077
182800         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              18280077
182900         + PC-ITEMS-PER-PANEL).                                   18290077
183000*                                                                 18300077
183100     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        18310077
183200         ADD +1         TO ASC-BLK-SUB                            18320077
183300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            18330077
183400     END-IF.                                                      18340077
183500*                                                                 18350077
183600     MOVE ASC-KEY-DEPT-NBR         TO ADPTNBRO.                   18360077
183700     MOVE ASC-KEY-INHOUSE-NBR      TO AINHSO.                     18370077
183800     MOVE ASC-KEY-ENT-NAME-DESC    TO AVNNAMEO.                   18380077
183900     MOVE ASC-KEY-DUN-NBR          TO ADUNNBRO.                   18390077
184000*                                                                 18400077
184100     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           18410077
184200         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                18420077
184300     PERFORM 4420-FORMAT-LIST-LINES                               18430077
184400         VARYING PV-SUB                                           18440077
184500         FROM PC-ITEMS-PER-PANEL BY -1                            18450077
184600         UNTIL PV-SUB < +1.                                       18460077
184700*                                                                 18470077
184800     COMPUTE ASC-ITEMS-DISPLAYED =                                18480077
184900         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          18490077
185000     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    18500077
185100                                      ASTRTITO.                   18510077
185200     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    18520077
185300     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    18530077
185400                                                                  18540077
185500     IF  DP020-MSG-NUMBER-X = SPACE                               18550077
185600         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  18560077
185700*            --- MORE ITEMS TO DISPLAY ----                       18570077
185800             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            18580077
185900             SET DP020-MSG-INFORMATIONAL TO TRUE                  18590077
186000         END-IF                                                   18600077
186100     END-IF.                                                      18610077
186200*----------------------------------------------------------------*18620077
186300*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *18630077
186400*----------------------------------------------------------------*18640077
186500                                                                  18650077
186600 4410-READ-TEMP-STORAGE.                                          18660077
186700                                                                  18670077
186800     EXEC CICS                                                    18680077
186900         READQ TS                                                 18690077
187000             QUEUE (ASC-LIST-QUEUE-NAME)                          18700077
187100             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               18710077
187200             ITEM  (PV-BLOCK-NUMBER)                              18720077
187300             RESP  (PV-CICS-RESP)                                 18730077
187400     END-EXEC.                                                    18740077
187500                                                                  18750077
187600     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       18760077
187700       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     18770077
187800         CONTINUE                                                 18780077
187900     ELSE                                                         18790077
188000         SET DP013-CICS-ABEND     TO TRUE                         18800077
188100         SET DP013-NO-ROLLBACK    TO TRUE                         18810077
188200         MOVE '4410-READ-TEMP-STORAGE'                            18820077
188300                                  TO DP013-PARAGRAPH              18830077
188400         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      18840077
188500                                  TO DP013-MESSAGE-TEXT(1)        18850077
188600         PERFORM DP013-0000-PROCESS-ABEND                         18860077
188700     END-IF.                                                      18870077
188800                                                                  18880077
188900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             18890077
189000*                                                                 18900077
189100     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         18910077
189200         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               18920077
189300     END-IF.                                                      18930077
189400 EJECT                                                            18940077
189500*----------------------------------------------------------------*18950077
189600*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *18960077
189700*----------------------------------------------------------------*18970077
189800                                                                  18980077
189900 4420-FORMAT-LIST-LINES.                                          18990077
190000     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      19000077
190100         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                19010077
190200         MOVE DP015-PRO-DRK-MDT  TO MR-SELECTA     (PV-SUB)       19020077
190300                                    MR-PERCENTA    (PV-SUB)       19030077
190400                                    MR-EFFDTEA     (PV-SUB)       19040077
190500                                    MR-EXPDTEA     (PV-SUB)       19050077
190600         MOVE DP015-HL-OFF       TO MR-SELECTH     (PV-SUB)       19060077
190700         MOVE SPACE              TO MR-SELECTI     (PV-SUB)       19070077
190800         MOVE ZERO               TO MR-PERCENT     (PV-SUB)       19080077
190900         MOVE SPACE              TO MR-TRANCODE    (PV-SUB)       19090077
191000                                    MR-DESCRIPTION (PV-SUB)       19100077
191100                                    MR-FREQUENCY   (PV-SUB)       19110077
191200                                    MR-NET-DISC    (PV-SUB)       19120077
191300                                    MR-NET-RTV     (PV-SUB)       19130077
191400                                    MR-PCTSIGN     (PV-SUB)       19140077
191500                                    MR-EFFDTE      (PV-SUB)       19150077
191600                                    MR-EXPDTE      (PV-SUB)       19160077
191700     ELSE                                                         19170077
191800* THIS PROGRAM WAS BASED ON A SELECTABLE LIST PROGRAM. THIS       19180077
191900* PROGRAM NEEDS TO BE A NON-SELECTABLE LIST PROGRAM.              19190077
192000* BY MOVING DP015-PRO-DRK-MDT TO MR-SELECTA THE 'S' THAT IS IN    19200077
192100* MR-SELECT WILL NOT BE DISPLAYED ON THE ONLINE SCREEN.  THAT     19210077
192200* WAY THE CODE THAT USES MR-SELECT IN 2210-MOVE-LINES-TO-COMMAREA 19220077
192300* WILL NOT HAVE TO BE CHANGED.                                    19230077
192400         MOVE DP015-PRO-DRK-MDT  TO MR-SELECTA (PV-SUB)           19240077
192500         MOVE 'S'                TO MR-SELECTI(PV-SUB)            19250077
192600                                                                  19260077
192700         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           19270077
192800             MOVE ASC-TRANCODE    (ASC-BLK-SUB ASC-ITEM-SUB)      19280077
192900                                 TO MR-TRANCODE    (PV-SUB)       19290077
193000             MOVE ASC-PERCENT     (ASC-BLK-SUB ASC-ITEM-SUB)      19300077
193100                                 TO MR-PERCENT     (PV-SUB)       19310077
193200             MOVE '%'            TO MR-PCTSIGN     (PV-SUB)       19320077
193300             MOVE ASC-DESCRIPTION (ASC-BLK-SUB ASC-ITEM-SUB)      19330077
193400                                 TO MR-DESCRIPTION (PV-SUB)       19340077
193500             MOVE ASC-NET-RTV     (ASC-BLK-SUB ASC-ITEM-SUB)      19350077
193600                                 TO MR-NET-RTV     (PV-SUB)       19360077
193700             MOVE ASC-NET-DISC    (ASC-BLK-SUB ASC-ITEM-SUB)      19370077
193800                                 TO MR-NET-DISC    (PV-SUB)       19380077
193900             IF ASC-FREQUENCY (ASC-BLK-SUB ASC-ITEM-SUB) = 'FM'   19390077
194000                MOVE 'FSCL MN' TO MR-FREQUENCY (PV-SUB)           19400077
194100             END-IF                                               19410077
194200             IF ASC-FREQUENCY (ASC-BLK-SUB ASC-ITEM-SUB) = 'FQ'   19420077
194300                MOVE 'FSC QTR' TO MR-FREQUENCY (PV-SUB)           19430077
194400             END-IF                                               19440077
194500             IF ASC-FREQUENCY (ASC-BLK-SUB ASC-ITEM-SUB) = 'CQ'   19450077
194600                MOVE 'CAL QTR' TO MR-FREQUENCY (PV-SUB)           19460077
194700             END-IF                                               19470077
194800             IF ASC-FREQUENCY (ASC-BLK-SUB ASC-ITEM-SUB) = 'FS'   19480077
194900                MOVE 'FSCL SA' TO MR-FREQUENCY (PV-SUB)           19490077
195000             END-IF                                               19500077
195100             IF ASC-FREQUENCY (ASC-BLK-SUB ASC-ITEM-SUB) = 'CS'   19510077
195200                MOVE 'CAL SA ' TO MR-FREQUENCY (PV-SUB)           19520077
195300             END-IF                                               19530077
195400             IF ASC-FREQUENCY (ASC-BLK-SUB ASC-ITEM-SUB) = 'FA'   19540077
195500                MOVE 'FSCL YR' TO MR-FREQUENCY (PV-SUB)           19550077
195600             END-IF                                               19560077
195700             IF ASC-FREQUENCY (ASC-BLK-SUB ASC-ITEM-SUB) = 'CA'   19570077
195800                MOVE 'CAL YR ' TO MR-FREQUENCY (PV-SUB)           19580077
195900             END-IF                                               19590077
196000             IF ASC-FREQUENCY (ASC-BLK-SUB ASC-ITEM-SUB) = 'RO'   19600077
196100                MOVE 'RPTONLY' TO MR-FREQUENCY (PV-SUB)           19610077
196200             END-IF                                               19620077
196300             IF ASC-FREQUENCY (ASC-BLK-SUB ASC-ITEM-SUB) = 'IV'   19630077
196400                MOVE 'OFFINVC' TO MR-FREQUENCY (PV-SUB)           19640077
196500             END-IF                                               19650077
196600             MOVE ASC-EFFDTE-MM   (ASC-BLK-SUB ASC-ITEM-SUB)      19660077
196700                                 TO PV-EFFDTE-FMTMM               19670077
196800             MOVE ASC-EFFDTE-DD   (ASC-BLK-SUB ASC-ITEM-SUB)      19680077
196900                                 TO PV-EFFDTE-FMTDD               19690077
197000             MOVE ASC-EFFDTE-CCYY (ASC-BLK-SUB ASC-ITEM-SUB)      19700077
197100                                 TO PV-EFFDTE-FMTCCYY             19710077
197200             MOVE PV-EFFDTE-FMT  TO MR-EFFDTE      (PV-SUB)       19720077
197300             MOVE ASC-EXPDTE-MM   (ASC-BLK-SUB ASC-ITEM-SUB)      19730077
197400                                 TO PV-EXPDTE-FMTMM               19740077
197500             MOVE ASC-EXPDTE-DD   (ASC-BLK-SUB ASC-ITEM-SUB)      19750077
197600                                 TO PV-EXPDTE-FMTDD               19760077
197700             MOVE ASC-EXPDTE-CCYY (ASC-BLK-SUB ASC-ITEM-SUB)      19770077
197800                                 TO PV-EXPDTE-FMTCCYY             19780077
197900             MOVE PV-EXPDTE-FMT  TO MR-EXPDTE      (PV-SUB)       19790077
198000             MOVE DP015-PRO-NOR-MDT                               19800077
198100                                 TO MR-PERCENTA    (PV-SUB)       19810077
198200                                    MR-EFFDTEA     (PV-SUB)       19820077
198300                                    MR-EXPDTEA     (PV-SUB)       19830077
198400         END-IF                                                   19840077
198500     END-IF.                                                      19850077
198600     SUBTRACT +1 FROM ASC-ITEM-SUB.                               19860077
198700     IF  ASC-ITEM-SUB < + 1                                       19870077
198800         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  19880077
198900         MOVE +1                 TO ASC-BLK-SUB                   19890077
199000     END-IF.                                                      19900077
199100 EJECT                                                            19910077
199200*----------------------------------------------------------------*19920077
199300* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *19930077
199400* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *19940077
199500* FOR THE SELECTED ITEMS QUEUE.                                  *19950077
199600*                                                                *19960077
199700* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *19970077
199800* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *19980077
199900* THE ARRAY IS FULL.                                             *19990077
200000*----------------------------------------------------------------*20000077
200100                                                                  20010077
200200 5000-PREPARE-SEL-QUEUE.                                          20020077
200300                                                                  20030077
200400     MOVE +1                   TO  ASC-BLK-SUB.                   20040077
200500     PERFORM 5100-WRITE-TEMP-STORAGE.                             20050077
200600     ADD +1                    TO  ASC-BLK-SUB.                   20060077
200700     PERFORM 5100-WRITE-TEMP-STORAGE.                             20070077
200800                                                                  20080077
200900     MOVE ASC-SEL-QUEUE-NAME   TO  VN002-SEL-QUEUE-NAME.          20090077
201000     PERFORM 6010-DELETE-SEL-QUEUE.                               20100077
201100                                                                  20110077
201200     SET ASC-UPDATE-TSQ        TO  TRUE.                          20120077
201300                                                                  20130077
201400     SET VN003-IDX             TO  1.                             20140077
201500     MOVE ZERO                 TO VN002-NUMBER-OF-TS-ITEMS.       20150077
201600     INITIALIZE VN003-SELECTED-ITEM-ARRAY.                        20160077
201700                                                                  20170077
201800     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           20180077
201900             VARYING PV-ITEM                                      20190077
202000             FROM 1 BY 1                                          20200077
202100             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     20210077
202200                                                                  20220077
202300     IF  VN003-IDX > 1                                            20230077
202400         PERFORM 5205-WRITE-SEL-QUEUE                             20240077
202500         ADD +1                TO VN002-NUMBER-OF-TS-ITEMS        20250077
202600     END-IF.                                                      20260077
202700 EJECT                                                            20270077
202800*----------------------------------------------------------------*20280077
202900*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *20290077
203000*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *20300077
203100*----------------------------------------------------------------*20310077
203200                                                                  20320077
203300 5100-WRITE-TEMP-STORAGE.                                         20330077
203400     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     20340077
203500                                   TO PV-LIST-ITEM-NUMBER.        20350077
203600     COMPUTE PV-BLOCK-NUMBER =                                    20360077
203700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    20370077
203800                                                                  20380077
203900     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             20390077
204000     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             20400077
204100         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      20410077
204200             PERFORM 5105-REWRITE-ASC-LISTQ                       20420077
204300         END-IF                                                   20430077
204400     ELSE                                                         20440077
204500         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       20450077
204600         ASC-HIGHEST-BLOCK-WRITTEN + 1                            20460077
204700         PERFORM 5110-WRITE-ASC-LISTQ                             20470077
204800         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   20480077
204900     END-IF.                                                      20490077
205000                                                                  20500077
205100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             20510077
205200******************************************************************20520077
205300** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **20530077
205400** SPECIFIC COMMAREA.                                           **20540077
205500******************************************************************20550077
205600 5105-REWRITE-ASC-LISTQ.                                          20560077
205700     EXEC CICS                                                    20570077
205800         WRITEQ TS                                                20580077
205900             QUEUE (ASC-LIST-QUEUE-NAME)                          20590077
206000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20600077
206100             ITEM  (PV-BLOCK-NUMBER)                              20610077
206200             REWRITE                                              20620077
206300             RESP  (PV-CICS-RESP)                                 20630077
206400     END-EXEC.                                                    20640077
206500                                                                  20650077
206600     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           20660077
206700         CONTINUE                                                 20670077
206800     ELSE                                                         20680077
206900         SET DP013-CICS-ABEND            TO TRUE                  20690077
207000         SET DP013-NO-ROLLBACK           TO TRUE                  20700077
207100         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       20710077
207200         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     20720077
207300                                         TO DP013-MESSAGE-TEXT(1) 20730077
207400         PERFORM DP013-0000-PROCESS-ABEND                         20740077
207500     END-IF.                                                      20750077
207600                                                                  20760077
207700******************************************************************20770077
207800** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **20780077
207900** SPECIFIC COMMAREA.                                           **20790077
208000******************************************************************20800077
208100 5110-WRITE-ASC-LISTQ.                                            20810077
208200     EXEC CICS                                                    20820077
208300         WRITEQ TS                                                20830077
208400             QUEUE (ASC-LIST-QUEUE-NAME)                          20840077
208500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20850077
208600             ITEM  (PV-BLOCK-NUMBER)                              20860077
208700             RESP  (PV-CICS-RESP)                                 20870077
208800     END-EXEC.                                                    20880077
208900     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      20890077
209000         SET DP013-CICS-ABEND      TO TRUE                        20900077
209100         SET DP013-NO-ROLLBACK     TO TRUE                        20910077
209200         MOVE '5110-WRITE-ASC-LISTQ'                              20920077
209300                                   TO DP013-PARAGRAPH             20930077
209400         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           20940077
209500                                   TO DP013-MESSAGE-TEXT(1)       20950077
209600         PERFORM DP013-0000-PROCESS-ABEND                         20960077
209700     END-IF.                                                      20970077
209800 EJECT                                                            20980077
209900*----------------------------------------------------------------*20990077
210000* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *21000077
210100* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *21010077
210200*----------------------------------------------------------------*21020077
210300                                                                  21030077
210400 5200-FILL-SEL-QUEUE-RECORD.                                      21040077
210500                                                                  21050077
210600     PERFORM 6112-READ-LIST-QUEUE.                                21060077
210700                                                                  21070077
210800     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       21080077
210900         PERFORM                                                  21090077
211000         VARYING LQW-IDX                                          21100077
211100         FROM 1 BY 1                                              21110077
211200         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            21120077
211300           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          21130077
211400                                                                  21140077
211500             IF  LQW-SELECT (LQW-IDX)                             21150077
211600                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              21160077
211700                                   TO VN003-ITEM (VN003-IDX)      21170077
211800                 MOVE LQW-ENT-ID (LQW-IDX)                        21180077
211900                                   TO VN003-ENT-ID    (VN003-IDX) 21190077
212000                 MOVE SPACE        TO VN003-ACTION-SW (VN003-IDX) 21200077
212100                 SET VN003-IDX UP BY 1                            21210077
212200                 IF  VN003-IDX > VN003-MAX-ITEMS                  21220077
212300                     PERFORM 5205-WRITE-SEL-QUEUE                 21230077
212400                     ADD +1        TO VN002-NUMBER-OF-TS-ITEMS    21240077
212500                     INITIALIZE VN003-SELECTED-ITEM-ARRAY         21250077
212600                     SET VN003-IDX TO  1                          21260077
212700                 END-IF                                           21270077
212800             END-IF                                               21280077
212900         END-PERFORM                                              21290077
213000     END-IF.                                                      21300077
213100                                                                  21310077
213200*----------------------------------------------------------------*21320077
213300*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *21330077
213400*----------------------------------------------------------------*21340077
213500                                                                  21350077
213600 5205-WRITE-SEL-QUEUE.                                            21360077
213700                                                                  21370077
213800     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            21380077
213900                                   TO VN003-SELECTED-ITEMS.       21390077
214000                                                                  21400077
214100     EXEC CICS                                                    21410077
214200          WRITEQ TS                                               21420077
214300              QUEUE (ASC-SEL-QUEUE-NAME)                          21430077
214400              FROM  (VN003-VENDOR-SEL-REC)                        21440077
214500              ITEM  (PV-SEL-QUEUE-ITEM)                           21450077
214600              RESP  (PV-CICS-RESP)                                21460077
214700     END-EXEC.                                                    21470077
214800                                                                  21480077
214900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          21490077
215000         CONTINUE                                                 21500077
215100     ELSE                                                         21510077
215200         SET DP013-CICS-ABEND      TO TRUE                        21520077
215300         SET DP013-NO-ROLLBACK     TO TRUE                        21530077
215400         MOVE '5205-WRITE-SEL-QUEUE'                              21540077
215500                                   TO DP013-PARAGRAPH             21550077
215600         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          21560077
215700                                   TO DP013-MESSAGE-TEXT(1)       21570077
215800         PERFORM DP013-0000-PROCESS-ABEND                         21580077
215900     END-IF.                                                      21590077
216000 EJECT                                                            21600077
216100******************************************************************21610077
216200** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **21620077
216300** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **21630077
216400** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **21640077
216500** THE USER.                                                    **21650077
216600******************************************************************21660077
216700 6000-REFRESH-PANEL-FROM-TEMP.                                    21670077
216800     IF  ASC-UPDATE-TSQ                                           21680077
216900         SET ASC-NO-TSQ-UPDATE TO TRUE                            21690077
217000         MOVE ZERO                 TO PV-SAVE-ITEM                21700077
217100                                      PV-SEL-QUEUE-ITEM           21710077
217200         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        21720077
217300                                   TO PV-HOLD-SELECTED-ITEMS      21730077
217400         MOVE +1                   TO PV-ITEMS-PROCESSED          21740077
217500         PERFORM 6100-UPDATE-TSQ                                  21750077
217600             UNTIL PV-ITEMS-PROCESSED >                           21760077
217700                                     PV-HOLD-SELECTED-ITEMS       21770077
217800         PERFORM 6010-DELETE-SEL-QUEUE                            21780077
217900         INITIALIZE ASC-BLOCK-ENTRIES (1)                         21790077
218000                    ASC-BLOCK-ENTRIES (2)                         21800077
218100     END-IF.                                                      21810077
218200                                                                  21820077
218300*----------------------------------------------------------------*21830077
218400*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *21840077
218500*----------------------------------------------------------------*21850077
218600 6010-DELETE-SEL-QUEUE.                                           21860077
218700                                                                  21870077
218800     EXEC CICS                                                    21880077
218900         DELETEQ TS                                               21890077
219000             QUEUE (ASC-SEL-QUEUE-NAME)                           21900077
219100             RESP  (PV-CICS-RESP)                                 21910077
219200     END-EXEC.                                                    21920077
219300*                                                                 21930077
219400     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      21940077
219500        (PV-CICS-RESP = DFHRESP(QIDERR)))                         21950077
219600         CONTINUE                                                 21960077
219700     ELSE                                                         21970077
219800         SET DP013-CICS-ABEND TO TRUE                             21980077
219900         SET DP013-NO-ROLLBACK TO TRUE                            21990077
220000         MOVE '6010-DELETE-SEL-QUEUE'                             22000077
220100                        TO DP013-PARAGRAPH                        22010077
220200         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         22020077
220300                        TO DP013-MESSAGE-TEXT (1)                 22030077
220400         PERFORM DP013-0000-PROCESS-ABEND                         22040077
220500     END-IF.                                                      22050077
220600                                                                  22060077
220700*----------------------------------------------------------------*22070077
220800*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *22080077
220900*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *22090077
221000*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *22100077
221100*    THE TEMP QUEUE.                                             *22110077
221200*----------------------------------------------------------------*22120077
221300                                                                  22130077
221400 6100-UPDATE-TSQ.                                                 22140077
221500                                                                  22150077
221600     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             22160077
221700     PERFORM 6105-READ-SEL-QUEUE.                                 22170077
221800     PERFORM                                                      22180077
221900         VARYING VN003-IDX                                        22190077
222000         FROM 1 BY 1                                              22200077
222100         UNTIL ((PV-ITEMS-PROCESSED >                             22210077
222200                              PV-HOLD-SELECTED-ITEMS)             22220077
222300         OR (VN003-IDX GREATER THAN VN003-MAX-ITEMS))             22230077
222400         IF  VN003-ACTION-SW (VN003-IDX) > SPACE                  22240077
222500             PERFORM 6110-PROCESS-ITEMS                           22250077
222600         END-IF                                                   22260077
222700         ADD +1                TO PV-ITEMS-PROCESSED              22270077
222800     END-PERFORM.                                                 22280077
222900     PERFORM 6111-WRITE-LIST-QUEUE.                               22290077
223000*----------------------------------------------------------------*22300077
223100*    READ THE LIST QUEUE RECORD.                                 *22310077
223200*----------------------------------------------------------------*22320077
223300                                                                  22330077
223400 6105-READ-SEL-QUEUE.                                             22340077
223500                                                                  22350077
223600     EXEC CICS                                                    22360077
223700          READQ TS                                                22370077
223800              QUEUE (ASC-SEL-QUEUE-NAME)                          22380077
223900              INTO  (VN003-VENDOR-SEL-REC)                        22390077
224000              ITEM  (PV-SEL-QUEUE-ITEM)                           22400077
224100              RESP  (PV-CICS-RESP)                                22410077
224200     END-EXEC.                                                    22420077
224300*                                                                 22430077
224400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22440077
224500         CONTINUE                                                 22450077
224600     ELSE                                                         22460077
224700         SET DP013-CICS-ABEND      TO  TRUE                       22470077
224800         SET DP013-NO-ROLLBACK     TO  TRUE                       22480077
224900         MOVE '6105-READ-SEL-QUEUE'                               22490077
225000                                   TO  DP013-PARAGRAPH            22500077
225100         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           22510077
225200                                   TO  DP013-MESSAGE-TEXT(1)      22520077
225300         PERFORM DP013-0000-PROCESS-ABEND                         22530077
225400     END-IF.                                                      22540077
225500 EJECT                                                            22550077
225600*----------------------------------------------------------------*22560077
225700*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*22570077
225800*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*22580077
225900*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *22590077
226000*----------------------------------------------------------------*22600077
226100                                                                  22610077
226200 6110-PROCESS-ITEMS.                                              22620077
226300                                                                  22630077
226400     COMPUTE PV-ITEM = 1 + ((VN003-ITEM (VN003-IDX) - 1)          22640077
226500                     / PC-ITEMS-PER-PANEL).                       22650077
226600                                                                  22660077
226700     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           22670077
226800         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          22680077
226900             PERFORM 6111-WRITE-LIST-QUEUE                        22690077
227000         END-IF                                                   22700077
227100         MOVE PV-ITEM          TO PV-SAVE-ITEM                    22710077
227200                                                                  22720077
227300         PERFORM 6112-READ-LIST-QUEUE                             22730077
227400         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               22740077
227500             CONTINUE                                             22750077
227600         END-IF                                                   22760077
227700     END-IF.                                                      22770077
227800                                                                  22780077
227900     COMPUTE PV-SUB = (VN003-ITEM (VN003-IDX)                     22790077
228000                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              22800077
228100     SET LQW-DESELECT (PV-SUB) TO    TRUE                         22810077
228200     MOVE LQW-SELECTED-SW (PV-SUB)                                22820077
228300                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  22830077
228400                                                                  22840077
228500     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                22850077
228600                                                                  22860077
228700*----------------------------------------------------------------*22870077
228800*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *22880077
228900*----------------------------------------------------------------*22890077
229000                                                                  22900077
229100 6111-WRITE-LIST-QUEUE.                                           22910077
229200                                                                  22920077
229300     EXEC CICS                                                    22930077
229400         WRITEQ TS                                                22940077
229500             QUEUE (ASC-LIST-QUEUE-NAME)                          22950077
229600             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     22960077
229700             ITEM  (PV-SAVE-ITEM)                                 22970077
229800             REWRITE                                              22980077
229900             RESP  (PV-CICS-RESP)                                 22990077
230000     END-EXEC.                                                    23000077
230100*                                                                 23010077
230200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23020077
230300         CONTINUE                                                 23030077
230400     ELSE                                                         23040077
230500         SET DP013-CICS-ABEND  TO  TRUE                           23050077
230600         SET DP013-NO-ROLLBACK TO  TRUE                           23060077
230700         MOVE '6111-WRITE-LIST-QUEUE'                             23070077
230800                               TO  DP013-PARAGRAPH                23080077
230900         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  23090077
231000                               TO  DP013-MESSAGE-TEXT(1)          23100077
231100         PERFORM DP013-0000-PROCESS-ABEND                         23110077
231200     END-IF.                                                      23120077
231300                                                                  23130077
231400 EJECT                                                            23140077
231500*----------------------------------------------------------------*23150077
231600*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*23160077
231700*----------------------------------------------------------------*23170077
231800                                                                  23180077
231900 6112-READ-LIST-QUEUE.                                            23190077
232000                                                                  23200077
232100     EXEC CICS                                                    23210077
232200         READQ TS                                                 23220077
232300             QUEUE (ASC-LIST-QUEUE-NAME)                          23230077
232400             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     23240077
232500             ITEM  (PV-ITEM)                                      23250077
232600             RESP  (PV-CICS-RESP)                                 23260077
232700     END-EXEC.                                                    23270077
232800*                                                                 23280077
232900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23290077
233000         CONTINUE                                                 23300077
233100     ELSE                                                         23310077
233200         SET DP013-CICS-ABEND        TO TRUE                      23320077
233300         SET DP013-NO-ROLLBACK       TO TRUE                      23330077
233400         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           23340077
233500         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    23350077
233600                                     TO DP013-MESSAGE-TEXT(1)     23360077
233700         PERFORM DP013-0000-PROCESS-ABEND                         23370077
233800     END-IF.                                                      23380077
233900                                                                  23390077
234000 EJECT                                                            23400077
234100*----------------------------------------------------------------*23410077
234200*    ABEND PROCESSOR MODULE                                      *23420077
234300*----------------------------------------------------------------*23430077
234400                                                                  23440077
234500     COPY DPPD013.                                                23450077
