000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    XSKUP061.                                         00020000
000300 AUTHOR.        BARB ERTL.                                        00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  11/29/2002.                                       00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800**       PRICE ZONE DATA MESSAGE TO POPULATE XST_STR_GP           00080001
000900******************************************************************00090000
001000**THIS IS A CALLED MODULE FOR LOCATION TABLES.  THIS PROGRAM      00100000
001100**     WILL PERFORM UPDATES/INSERTS/DELETES FOR THE               00110000
001200**     XST_STR_GP_TYP TABLE.  IT DOES THE FOLLOWING WITH          00120000
001300**     THESE RETURN CODES:                                        00130000
001400**     0000 - END PROGRAM                                         00140000
001500**    -0530 - END PROGRAM                                         00150000
001600**    -0803 - END PROGRAM                                         00160000
001700**    -0911 - RETRY INSERT UP TO 5 TIMES AND THEN END PROGRAM     00170000
001800******************************************************************00180000
001900 ENVIRONMENT DIVISION.                                            00190000
002000 CONFIGURATION SECTION.                                           00200000
002100 SOURCE-COMPUTER.  IBM-3090.                                      00210000
002200 OBJECT-COMPUTER.  IBM-3090.                                      00220000
002300 DATA DIVISION.                                                   00230000
002400                                                                  00240000
002500 WORKING-STORAGE SECTION.                                         00250000
002600******************************************************************00260000
002700**PROGRAM SWITCHES                                                00270000
002800******************************************************************00280000
002900 01  PS-PROGRAM-SWITCHES.                                         00290000
003000     05  PS-PROCESS-CONTINUE-SW      PIC X(01)  VALUE 'Y'.        00300000
003100         88  PS-PROCESS-CONTINUE                VALUE 'Y'.        00310000
003200         88  PS-PROCESS-COMPLETE                VALUE 'N'.        00320000
003300******************************************************************00330000
003400**PROGRAM CONSTANTS                                               00340000
003500******************************************************************00350000
003600 01  PC-PROGRAM-CONSTANTS.                                        00360000
003700     05  PC-RETRY-MAX                PIC 9(01)  VALUE 5.          00370000
003800******************************************************************00380000
003900**PROGRAM VARIABLES                                               00390000
004000******************************************************************00400000
004100 01  PV-PROGRAM-VARIABLES.                                        00410000
004200     05  PV-RETRY-COUNTER            PIC 9(01)  VALUE ZEROS.      00420000
004300     05  PV-RETURN-CODE              PIC S9(04) VALUE 0.          00430000
004400     05  PV-STR-GP-IND               PIC X(01)  VALUE SPACES.     00440000
004500******************************************************************00450000
004600**COPYBOOKS                                                       00460000
004700******************************************************************00470000
004800***DB2 MESSAGE AREA                                               00480000
004900     COPY SQLCA2.                                                 00490005
005000***MESSAGE COPYBOOK                                               00500000
005100     COPY HORD100.                                                00510005
005200******************************************************************00520000
005300**TABLE INCLUSIONS                                                00530000
005400******************************************************************00540000
005500***DB2 COMMUNICATIONS AREA                                        00550000
005600     EXEC SQL                                                     00560000
005700          INCLUDE SQLCA                                           00570000
005800     END-EXEC.                                                    00580000
005900* ------------------------------------------------------------- * 00590000
006000*  SQL AND COBOL DECLARATIONS FOR STORE GROUP TABLE               00600000
006100*  XST_STR_GP                                                     00610000
006200* ------------------------------------------------------------- * 00620000
006300     EXEC SQL                                                     00630000
006400         INCLUDE XST00022                                         00640000
006500     END-EXEC.                                                    00650000
006600                                                                  00660000
006700* ------------------------------------------------------------- * 00670001
006800*  SQL AND COBOL DECLARATIONS FOR STORE GROUP MEMBERSHIP TABLE    00680001
006900*  XST_STR_GP_MBSHP                                               00690001
007000* ------------------------------------------------------------- * 00700001
007100     EXEC SQL                                                     00710001
007200         INCLUDE XST00023                                         00720001
007300     END-EXEC.                                                    00730001
007400                                                                  00740001
007500 LINKAGE SECTION.                                                 00750000
007600******************************************************************00760000
007700**LINKAGE VARIABLES                                               00770000
007800******************************************************************00780000
007900 01  LV-LINKAGE-VARIABLES.                                        00790000
008000     05  LV-HORD100-RECORD               PIC X(500).              00800000
008100     05  LV-RETURN-CODE                  PIC S9(04).              00810000
008200                                                                  00820000
008300 PROCEDURE DIVISION USING LV-LINKAGE-VARIABLES.                   00830000
008400******************************************************************00840000
008500 0000-MAINLINE.                                                   00850000
008600                                                                  00860000
008700      PERFORM 1000-INITIALIZATION.                                00870000
008800      PERFORM 2000-PROCESS-MESSAGE                                00880000
008900              UNTIL PS-PROCESS-COMPLETE.                          00890000
009000      PERFORM 9999-WRAPUP.                                        00900000
009100                                                                  00910000
009200***************************************************************** 00920000
009300**INITIALIZATION AREA - ALL MOVES TO UPDATE/INSERT                00930000
009400***************************************************************** 00940000
009500 1000-INITIALIZATION.                                             00950000
009600                                                                  00960000
009700     INITIALIZE PV-RETRY-COUNTER                                  00970000
009800                PV-RETURN-CODE                                    00980000
009900                PV-STR-GP-IND.                                    00990000
010000                                                                  01000000
010100     SET PS-PROCESS-CONTINUE         TO TRUE.                     01010000
010200                                                                  01020000
010300     MOVE LV-HORD100-RECORD          TO HORD100-RECORD.           01030000
010400                                                                  01040000
010500     MOVE HO100-PZ-GROUP-ID          TO XST00022-STR-GP-TYP-CDE.  01050001
010600     MOVE HO100-PZ-ZONE-ID           TO XST00022-STR-GP-ID.       01060001
010700     MOVE HO100-PZ-DESCRIPTION       TO XST00022-STR-GP-NM.       01070001
010800     MOVE SPACES                     TO XST00022-ST-CDE           01080003
010900                                        XST00022-RPT-FLSH-SLS-IND.01090003
011000***************************************************************** 01100000
011100**MAIN PROGRAM LOGIC - READS ACTION TYPE ON HORD100 RECORD        01110000
011200***************************************************************** 01120000
011300 2000-PROCESS-MESSAGE.                                            01130000
011400                                                                  01140000
011500     EVALUATE TRUE                                                01150000
011600        WHEN HO100-ACTN-TYP-INSERT                                01160000
011700             PERFORM 2100-INSERT-DATA                             01170000
011800        WHEN HO100-ACTN-TYP-UPDATE                                01180000
011900             PERFORM 2200-UPDATE-DATA                             01190000
012000        WHEN HO100-ACTN-TYP-DELETE                                01200000
012100             PERFORM 2400-CHECK-STR-GP-MBSHP                      01210001
012200             IF PS-PROCESS-CONTINUE                               01220000
012300                 PERFORM 2300-DELETE-DATA                         01230000
012400             END-IF                                               01240000
012500     END-EVALUATE.                                                01250000
012600                                                                  01260000
012700     IF HO100-ACTN-TYP-DELETE                                     01270006
012800         IF SQLCODE = +100                                        01280006
012900             MOVE ZERO TO PV-RETURN-CODE                          01290006
013000         ELSE                                                     01300006
013100             MOVE SQLCODE TO PV-RETURN-CODE                       01310006
013200         END-IF                                                   01320006
013300     ELSE                                                         01330006
013400         MOVE SQLCODE TO PV-RETURN-CODE                           01340006
013500     END-IF.                                                      01350006
013600                                                                  01360000
013700***************************************************************** 01370000
013800**INSERT ACTION TYPE                                              01380000
013900***************************************************************** 01390000
014000 2100-INSERT-DATA.                                                01400000
014100                                                                  01410000
014200     PERFORM                                                      01420004
014300         WITH TEST AFTER                                          01430004
014400         VARYING PV-RETRY-COUNTER                                 01440004
014500         FROM 1 BY 1                                              01450004
014600         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    01460004
014700            OR SQLCODE = 0                                        01470004
014800            OR PS-PROCESS-COMPLETE                                01480004
014900                                                                  01490004
015000         EXEC SQL                                                 01500004
015100             INSERT INTO XST_STR_GP                               01510004
015200                 (STR_GP_TYP_CDE                                  01520004
015300                , STR_GP_ID                                       01530004
015400                , STR_GP_NM                                       01540004
015500                , ST_CDE                                          01550004
015600                , RPT_FLSH_SLS_IND)                               01560004
015700             VALUES (: XST00022-STR-GP-TYP-CDE                    01570004
015800                   , : XST00022-STR-GP-ID                         01580004
015900                   , : XST00022-STR-GP-NM                         01590004
016000                   , : XST00022-ST-CDE                            01600004
016100                   , : XST00022-RPT-FLSH-SLS-IND)                 01610004
016200         END-EXEC                                                 01620004
016300                                                                  01630000
016400         EVALUATE TRUE                                            01640004
016500             WHEN SQLCODE = -911                                  01650004
016600             WHEN SQLCODE = -913                                  01660004
016700             WHEN SQLCODE = 0                                     01670004
016800                 CONTINUE                                         01680004
016900             WHEN SQLWARN0 NOT = SPACE                            01690004
017000             WHEN SQLCODE NOT =  ZERO                             01700004
017100                 SET PS-PROCESS-COMPLETE TO TRUE                  01710004
017200         END-EVALUATE                                             01720004
017300     END-PERFORM.                                                 01730004
017400                                                                  01740004
017500     EVALUATE TRUE                                                01750000
017600        WHEN SQLCODE = -913                                       01760000
017700        WHEN SQLCODE = -911                                       01770000
017800             IF  PV-RETRY-COUNTER >= PC-RETRY-MAX                 01780000
017900                 SET PS-PROCESS-COMPLETE TO TRUE                  01790000
018000             ELSE                                                 01800000
018100                 ADD +1                  TO PV-RETRY-COUNTER      01810000
018200             END-IF                                               01820000
018300        WHEN OTHER                                                01830000
018400             SET PS-PROCESS-COMPLETE     TO TRUE                  01840000
018500     END-EVALUATE.                                                01850000
018600                                                                  01860000
018700******************************************************************01870000
018800**UPDATE ACTION TYPE                                              01880000
018900******************************************************************01890000
019000 2200-UPDATE-DATA.                                                01900000
019100                                                                  01910000
019200     PERFORM                                                      01920004
019300         WITH TEST AFTER                                          01930004
019400         VARYING PV-RETRY-COUNTER                                 01940004
019500         FROM 1 BY 1                                              01950004
019600         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    01960004
019700            OR SQLCODE = 0                                        01970004
019800            OR PS-PROCESS-COMPLETE                                01980004
019900                                                                  01990004
020000         EXEC SQL                                                 02000004
020100             UPDATE XST_STR_GP                                    02010004
020200                SET STR_GP_NM = : XST00022-STR-GP-NM              02020004
020300              WHERE STR_GP_TYP_CDE = : XST00022-STR-GP-TYP-CDE    02030004
020400                AND STR_GP_ID      = : XST00022-STR-GP-ID         02040004
020500         END-EXEC                                                 02050004
020600                                                                  02060000
020700         EVALUATE TRUE                                            02070004
020800             WHEN SQLCODE = -911                                  02080004
020900             WHEN SQLCODE = -913                                  02090004
021000             WHEN SQLCODE = 0                                     02100004
021100                 CONTINUE                                         02110004
021200             WHEN SQLWARN0 NOT = SPACE                            02120004
021300             WHEN SQLCODE NOT =  ZERO                             02130004
021400                 SET PS-PROCESS-COMPLETE TO TRUE                  02140004
021500         END-EVALUATE                                             02150004
021600     END-PERFORM.                                                 02160004
021700                                                                  02170004
021800     EVALUATE TRUE                                                02180000
021900        WHEN SQLCODE = -911                                       02190000
022000             IF  PV-RETRY-COUNTER >= PC-RETRY-MAX                 02200000
022100                 SET PS-PROCESS-COMPLETE TO TRUE                  02210000
022200             ELSE                                                 02220000
022300                 ADD +1                  TO PV-RETRY-COUNTER      02230000
022400             END-IF                                               02240000
022500        WHEN OTHER                                                02250000
022600             SET PS-PROCESS-COMPLETE     TO TRUE                  02260000
022700     END-EVALUATE.                                                02270000
022800                                                                  02280000
022900******************************************************************02290000
023000**DELETE TYPE ACTION                                              02300000
023100******************************************************************02310000
023200 2300-DELETE-DATA.                                                02320000
023300                                                                  02330000
023400     PERFORM                                                      02340004
023500         WITH TEST AFTER                                          02350004
023600         VARYING PV-RETRY-COUNTER                                 02360004
023700         FROM 1 BY 1                                              02370004
023800         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    02380004
023900            OR SQLCODE = 0                                        02390004
024000            OR PS-PROCESS-COMPLETE                                02400004
024100                                                                  02410004
024200         EXEC SQL                                                 02420004
024300             DELETE FROM XST_STR_GP                               02430004
024400             WHERE STR_GP_TYP_CDE = : XST00022-STR-GP-TYP-CDE     02440004
024500               AND STR_GP_ID      = : XST00022-STR-GP-ID          02450004
024600         END-EXEC                                                 02460004
024700                                                                  02470000
024800         EVALUATE TRUE                                            02480004
024900             WHEN SQLCODE = -911                                  02490004
025000             WHEN SQLCODE = -913                                  02500004
025100             WHEN SQLCODE = 0                                     02510004
025200             WHEN SQLCODE = +100                                  02520005
025300                 CONTINUE                                         02530004
025400             WHEN SQLWARN0 NOT = SPACE                            02540004
025500             WHEN SQLCODE NOT =  ZERO                             02550004
025600                 SET PS-PROCESS-COMPLETE TO TRUE                  02560004
025700         END-EVALUATE                                             02570004
025800     END-PERFORM.                                                 02580004
025900                                                                  02590004
026000     EVALUATE TRUE                                                02600000
026100        WHEN SQLCODE = -911                                       02610000
026200        WHEN SQLCODE = -913                                       02620000
026300             IF  PV-RETRY-COUNTER >= PC-RETRY-MAX                 02630000
026400                 SET PS-PROCESS-COMPLETE TO TRUE                  02640000
026500             ELSE                                                 02650000
026600                 ADD +1                  TO PV-RETRY-COUNTER      02660000
026700             END-IF                                               02670000
026800        WHEN OTHER                                                02680000
026900             SET PS-PROCESS-COMPLETE     TO TRUE                  02690000
027000     END-EVALUATE.                                                02700000
027100                                                                  02710000
027200* ------------------------------------------------------------- * 02720000
027300* READ XST_STR_GP MBSHP TO BE SURE STR_GP_ID IS NOT BEING USED    02730001
027400*  BEFORE DELETING THE ROW ON THE STR_GP TABLE.                   02740001
027500* ------------------------------------------------------------- * 02750000
027600 2400-CHECK-STR-GP-MBSHP.                                         02760002
027700                                                                  02770000
027800     EXEC SQL                                                     02780000
027900       SELECT 'Y'                                                 02790000
028000         INTO :PV-STR-GP-IND                                      02800000
028100         FROM XST_STR_GP_MBSHP                                    02810001
028200        WHERE  STR_GP_TYP_CDE = :XST00022-STR-GP-TYP-CDE          02820001
028300          AND  STR_GP_ID      = :XST00022-STR-GP-ID               02830001
028400     END-EXEC                                                     02840000
028500                                                                  02850000
028600     EVALUATE TRUE                                                02860000
028700        WHEN SQLCODE = -911                                       02870000
028800        WHEN SQLCODE = -913                                       02880000
028900             IF  PV-RETRY-COUNTER >= PC-RETRY-MAX                 02890000
029000                 SET PS-PROCESS-COMPLETE TO TRUE                  02900000
029100             ELSE                                                 02910000
029200                 ADD +1                  TO PV-RETRY-COUNTER      02920000
029300             END-IF                                               02930000
029400        WHEN SQLCODE = +100                                       02940000
029500             CONTINUE                                             02950000
029600        WHEN SQLCODE = ZERO                                       02960000
029700        WHEN SQLCODE = -811                                       02970001
029800             DISPLAY 'STR-GP-TYP-CD/STR-GP-ID '                   02980001
029900             HO100-PZ-GROUP-ID '/' HO100-PZ-ZONE-ID               02990001
030000             ' IN USE'                                            03000000
030100        WHEN OTHER                                                03010000
030200             SET PS-PROCESS-COMPLETE     TO TRUE                  03020000
030300     END-EVALUATE.                                                03030000
030400                                                                  03040000
030500******************************************************************03050000
030600**PASS SQLCODE TO CALLING AND EXIT PROGRAM                        03060000
030700******************************************************************03070000
030800 9999-WRAPUP.                                                     03080000
030900                                                                  03090000
031000     MOVE PV-RETURN-CODE TO LV-RETURN-CODE.                       03100000
031100                                                                  03110000
031200     EXIT PROGRAM.                                                03120000
