      ******************************************************************00010000
       IDENTIFICATION DIVISION.                                         00020000
      ******************************************************************00030000
                                                                        00040000
       PROGRAM-ID.       TFKCS402.                                      00050000
       AUTHOR.           WILLIAM B. BURT.                               00060000
       INSTALLATION.     KOHLS.                                         00070000
       DATE-WRITTEN      AUGUST, 1996.                                  00080000
       DATE-COMPILED.                                                   00090000
                                                                        00100000
      ******************************************************************00110000
      * THIS PROGRAM RECEIVES FROM AND SENDS DATA STREAMS TO A TELXON   00120000
      * PORTABLE TELE-TRANSACTION COMPUTER (PTC).  THE RECEIVED DATA    00130000
      * IS A REQUEST FOR INFORMATION REGARDING A STORE.  THE TRANSMIT   00140000
      * DATA IS THE RESPONSE TO THAT REQUEST.                           00150000
      ******************************************************************00160000
      *  DATE 01/15/01                                                  00170000
      *  ADD CODE FOR 2ND LISTNER                                       00180000
      *  MADE BY: STEVEN NOWAK            WR/IR #:                      00190000
      ******************************************************************00200000
      *  DATE 03/20/01                                                  00210000
      *  ALLOW FOR NON-RETAIL TRANSFERS TO LOCATION 931                 00220000
      *  MADE BY: STEVEN NOWAK            WR/IR #:                      00230000
      ******************************************************************00240000
      *  DATE 11/28/03                                                  00250000
      *  ALLOW FOR MOS AND RTV DEF/DAMAGE TRANSFERS                     00260000
      *  MADE BY: DAVID WELLER            WR/IR #: 25501                00270000
      ******************************************************************00280000
      *  DATE 12/23/03                                                  00290000
      *               *******TEMPORARY CHANGE*******                    00300000
      *  UNTIL FURTHER NOTICE: FINDLAY IS THE ONLY ALLOWABLE 'TO STORE' 00310000
      *  FOR MOS/RTV DAMAGES.  TO SWITCH TO ALTERNATE BUSINESS RULES,   00320000
      *  SIMPLY REMOVE ALL LINES DATED 122303 AND REALIGN CODE.         00330000
      *  MADE BY: CHRIS ALBRIGHT                                        00340000
      ******************************************************************00350000
      *  DATE 05/17/04                                                  00360000
      *  REMOVE STORE OVERRIDES THAT ALLOW TRANSFERS TO SOME CLOSED     00370000
      *  STORES.                                                        00380000
      *  MADE BY: DAVID WELLER                                          00390000
      ******************************************************************00400000
      *  DATE 07/27/04                                                  00410000
      *  ALLOW CLOSED STORE 53 TO RECEIVE TRANSFERS.                    00420000
      *  STORES.                                                        00430000
      *  MADE BY: RAY GRAF                                              00440000
      ******************************************************************00450000
      *  DATE 08/16/04                                                  00460000
      *  NO LONGER ALLOW CLOSED STORE 53 TO RECEIVE TRANSFERS.          00470000
      *  STORES.                                                        00480000
      *  MADE BY: RAY GRAF                                              00490000
      ******************************************************************00500000
      *  DATE 10/04/04                                                  00510000
      *  PUT TRANSFER BLOCK BACK IN PLACE FOR STORE 69.                 00520000
      ******************************************************************00530000
      *  DATE 10/05/04 DAVE WELLER                                      00540000
      *  REPLACE TSTR000 WITH XST_LOC                                   00550000
      *  USE LOC_NBR IN TINVPAR                                         00560000
      ******************************************************************00570000
      *  DATE 01/12/05 DAVE WELLER                                      00580000
      *  REMOVE LOGIC TO ALLOW TRANSFERS TO CLOSED STORES 76 AND 122    00590000
      ******************************************************************00600000
021605*  DATE 02/16/05 DAVE WELLER                                      00610000
021605*  STANDARDIZE USAGE OF TFWS007                                   00620000
021605******************************************************************00630000
051705*  DATE 05/17/05 RAY GRAF                                         00640000
051705*  REMOVE PHYSICAL INVENTORY LOGIC                                00650000
060110******************************************************************00660000
060110*  DATE 06/01/10 JACKIE HELING                                    00661000
060110*  BLOCK CERTAIN LOCATIONS FROM SENDING/RECEIVING TRANSFERS       00662000
060110******************************************************************00663000
033111* WR39649 -  DAVID WELLER - 03/31/2011                            00663100
033111*            MLOF - DO NOT EXCLUDE LOCATIONS 807, 808 AND 809     00663200
033111***************************************************************** 00663300
070111*  DATE 07/01/11                                                  00663400
070111*  ADD LOCATION 804 AND 805                                       00663500
070111*  MADE BY: CHERI PARMLEY           WR/IR #: 40189                00663600
070111******************************************************************00663700
C83065******************************************************************00663801
C83065*   DATE 05/30/2014                                               00663901
C83065*   ADDED WHERE LOC_NBR = C.LOC_NBR IN THE RTV LOCATION QUERY.    00664001
C83065*   THIS IS ADDED TO FETCH THE CORRECT EFF_BEG_DTE FOR A SPECIFIC 00664101
C83065*   DC LOCATION.                                                  00664201
C83065*   FIND FOR THE TAG C83065 TO KNOW THE CHANGES.                  00664301
C83065*   MADE BY: SARVESWARAN N.S.K      WR/IR #: CHG0083065           00664401
C83065******************************************************************00664501
                                                                        00664600
      ******************************************************************00664700
       ENVIRONMENT DIVISION.                                            00664800
      ******************************************************************00665000
                                                                        00666000
      ******************************************************************00667000
       DATA DIVISION.                                                   00668000
      ******************************************************************00669000
                                                                        00670000
      ******************************************************************00680000
       WORKING-STORAGE SECTION.                                         00690000
      ******************************************************************00700000
                                                                        00710000
      *                                                                 00720000
      *  LISTENER QUEUE NAMES                                           00730000
      *                                                                 00740000
           COPY RFWS001.                                                00750000
                                                                        00760000
060110*                                                                 00770000
060110*  LIST OF LOCATION EXCLUSIONS                                    00780000
060110*                                                                 00790000
060110     COPY TFWS010.                                                00800000
                                                                        00810000
      *                                                                 00820000
      *  RECORD LAYOUT BEING TRANSMITTED FROM THE PTC                   00830000
      *                                                                 00840000
           COPY TFRD005.                                                00850000
                                                                        00860000
      *                                                                 00870000
      *  RECORD LAYOUT BEING TRANSMITTED TO THE PTC                     00880000
      *                                                                 00890000
           COPY TFRD006.                                                00900000
                                                                        00910000
      *                                                                 00920000
      *  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                00930000
      *                                                                 00940000
           COPY DPWS013.                                                00950000
                                                                        00960000
      *                                                                 00970000
      *  RECORD LAYOUT FOR SYSTEM MESSAGES FILE USED FOR CICS MESSAGES  00980000
      *                                                                 00990000
           COPY DPRD507I.                                               01000000
                                                                        01010000
      *                                                                 01020000
      *  FORMATS CICS SYSTEM MESSAGES FOR NON-ARCHITECTURE PROGRAMS     01030000
      *                                                                 01040000
           COPY DPWS011.                                                01050000
                                                                        01060000
      *                                                                 01070000
      *  COPY BOOK FOR THE CALENDAR ROUTINE                             01080000
      *                                                                 01090000
           COPY DPWS500.                                                01100000
                                                                        01110000
      *                                                                 01120000
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE LOC TABLE          01130000
      *                                                                 01140000
           EXEC SQL                                                     01150000
               INCLUDE XST00001                                         01160000
           END-EXEC.                                                    01170000
                                                                        01180000
      *                                                                 01190000
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE DC_LOC_ASGMT TABLE 01200000
      *                                                                 01210000
           EXEC SQL                                                     01220000
               INCLUDE XST00020                                         01230000
           END-EXEC.                                                    01240000
                                                                        01250000
070111*                                                                 01260000
070111*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE XST_RTV_LOC_RLTNSHP01270000
070111*                                                                 01280000
070111     EXEC SQL                                                     01290000
070111         INCLUDE XST00135                                         01300000
070111     END-EXEC.                                                    01310000
                                                                        01311000
      *                                                                 01312000
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR TRANSFER CONTROL TABLE 01313000
      *                                                                 01314000
051705*    EXEC SQL                                                     01315000
051705*        INCLUDE TTFCNTL                                          01316000
051705*    END-EXEC.                                                    01317000
                                                                        01318000
      *                                                                 01319000
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR TRANSFER INVENTORY     01320000
      *  PARAMETERS TABLE                                               01330000
      *                                                                 01340000
051705*    EXEC SQL                                                     01350000
051705*        INCLUDE TINVPAR                                          01360000
051705*    END-EXEC.                                                    01370000
                                                                        01380000
      *                                                                 01390000
      *  COMMUNICATIONS AREA FOR DB2                                    01400000
      *                                                                 01410000
           EXEC SQL                                                     01420000
               INCLUDE SQLCA                                            01430000
           END-EXEC.                                                    01440000
                                                                        01450000
       01  WS-MQCONN               PIC X(8)  VALUE 'CSQCCONN'.          01460000
       01  WS-MQOPEN               PIC X(8)  VALUE 'CSQCOPEN'.          01470000
       01  WS-MQINQ                PIC X(8)  VALUE 'CSQCINQ'.           01480000
       01  WS-MQGET                PIC X(8)  VALUE 'CSQCGET'.           01490000
       01  WS-MQPUT1               PIC X(8)  VALUE 'CSQCPUT1'.          01500000
       01  WS-MQPUT                PIC X(8)  VALUE 'CSQCPUT'.           01510000
       01  WS-MQBACK               PIC X(8)  VALUE 'CSQCBACK'.          01520000
       01  WS-MQCMIT               PIC X(8)  VALUE 'CSQCCOMM'.          01530000
       01  WS-MQCLOSE              PIC X(8)  VALUE 'CSQCCLOS'.          01540000
       01  WS-MQDISC               PIC X(8)  VALUE 'CSQCDISC'.          01550000
                                                                        01560000
      *    API CONTROL BLOCKS                                           01570000
                                                                        01580000
       01  MQM-OBJECT-DESCRIPTOR.                                       01590000
           COPY CMQODV.                                                 01600000
       01  MQM-MESSAGE-DESCRIPTOR.                                      01610000
           COPY CMQMDV.                                                 01620000
       01  MQM-GET-MESSAGE-OPTIONS.                                     01630000
           COPY CMQGMOV.                                                01640000
       01  MQM-PUT-MESSAGE-OPTIONS.                                     01650000
           COPY CMQPMOV.                                                01660000
                                                                        01670000
      *    MQV CONTAINS CONSTANTS (FOR FILLING IN THE CONTROL BLOCKS)   01680000
      *    AND RETURN CODES (FOR TESTING THE RESULT OF A CALL)          01690000
                                                                        01700000
       01  MQM-CONSTANTS.                                               01710000
           COPY CMQV.                                                   01720000
      *                                                                 01730000
      **---------------------------------------------------------------*01740000
      **  VARIABLES REQUIRED FOR THE USE OF THE LOG MESSAGE ROUTINE    *01750000
      **  (EPPD000)                                                    *01760000
      **---------------------------------------------------------------*01770000
                                                                        01780000
           COPY EPWS000.                                                01790000
                                                                        01800000
      *                                                                 01810000
       01  DK-DB2-KEYS.                                                 01820000
           05  DK-STR-NBR                      PIC S9(04)  VALUE ZEROS  01830000
                                                           COMP SYNC.   01840000
051705*    05  DK-STORE-NBR-9                  PIC S9(04)  VALUE ZEROS  01850000
051705*                                                    COMP SYNC.   01860000
      *                                                                 01870000
       01  PC-PROGRAM-CONSTANTS.                                        01880000
           05  PC-STORE-69                     PIC  9(04)  VALUE 69.    01890000
           05  PC-STORE-811                    PIC  9(04)  VALUE 811.   01900000
           05  PC-LOCATION-931                 PIC  9(04)  VALUE 931.   01910000
           05  PC-STOCK-BAL-CORP               PIC  X(02)  VALUE '03'.  01920000
           05  PC-STOCK-BAL-STORE              PIC  X(02)  VALUE '04'.  01930000
           05  PC-STOCK-BALANCE-MSG            PIC  X(13)  VALUE        01940000
                                               'STOCK BALANCE'.         01950000
           05  PC-MAX-RETRIES                  PIC S9(03)  VALUE 3      01960000
                                                           COMP-3.      01970000
           05  PC-DEPT-STR                     PIC  X(02)  VALUE 'DS'.  01980000
           05  PC-DAYS-IN-A-WEEK               PIC  9(02)  VALUE  7.    01990000
           05  PC-DEFAULT-CLOSED-DATE          PIC  X(10)  VALUE        02000000
               '9999-09-09'.                                            02010000
           COPY TFWS007.                                                02020000
           05  PC-RTV-TYPE-CODE                PIC  X(02)  VALUE 'RV'.  02030000
           05  PC-STR-TYPE-CODE                PIC  X(02)  VALUE 'DS'.  02040000
           05  PC-DC-TYPE-CODE                 PIC  X(02)  VALUE 'DC'.  02050000
           05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        02060000
               'TFKCS402'.                                              02070000
                                                                        02080000
           05  PC-TSYMSG-NUMBERS.                                       02090000
      *  STORE NUMBER NOT FOUND                                         02100000
               10  PC-TSYMSG-00594             PIC  9(05)  VALUE  00594.02110000
      *  STORE CLOSED                                                   02120000
               10  PC-TSYMSG-00844             PIC  9(05)  VALUE  00844.02130000
      *  RESOURCE IS UNAVAILABLE; PLEASE TRY AGAIN LATER                02140000
               10  PC-TSYMSG-01063             PIC  9(05)  VALUE  01063.02150000
      *  DATA IS UNAVAILABLE; PLEASE CONTACT THE IS HELP DESK           02160000
               10  PC-TSYMSG-01064             PIC  9(05)  VALUE  01064.02170000
      *  'TO STORE' MUST BE A RTV LOCATION                              02180000
               10  PC-TSYMSG-01449             PIC  9(05)  VALUE  01449.02190000
      * LOCATION CANNOT BE CHANGED FOR THIS TRANSFER TYPE               02200000
               10  PC-TSYMSG-03208             PIC  9(05)  VALUE  03208.02210000
      *  'FROM' STORE AND 'TO' STORE CAN NOT BE THE SAME                02220000
               10  PC-TSYMSG-01476             PIC  9(05)  VALUE  01476.02230000
      *  'TO STORE' INVALID                                             02240000
               10  PC-TSYMSG-01479             PIC  9(05)  VALUE  01479.02250000
      * STORE &VAR WILL CLOSE WITHIN 1 WEEK. PLEASE ENTER ANOTHER STORE 02260000
               10  PC-TSYMSG-01521             PIC  9(05)  VALUE  01521.02270000
      * STORE NOT OPEN TO RECEIVE                                       02280000
               10  PC-TSYMSG-01552             PIC  9(05)  VALUE  01552.02290000
      *  CAN'T COMPLETE STOCK BALANCE TRANSFERS UNTIL AFTER INVENTORY   02300000
               10  PC-TSYMSG-02002             PIC  9(05)  VALUE  02002.02310000
060110*  INVALID LOCATION                                               02320000
060110         10  PC-TSYMSG-03685             PIC  9(05)  VALUE  03685.02330000
                                                                        02340000
                                                                        02350000
       01  PH-PROGRAM-HOLD-VARIABLES.                                   02360000
           05  PH-COMPLETION-CODE          PIC  S9(09) BINARY.          02370000
           05  PH-REASON                   PIC  S9(09) BINARY.          02380000
                                                                        02390000
      *                                                                 02400000
       01  PS-PROGRAM-SWITCHES.                                         02410000
           05  PS-MQPUT-SUCCESSFUL-IND         PIC  X(01)  VALUE 'N'.   02420000
               88 PS-MQPUT-SUCCESSFUL                      VALUE 'Y'.   02430000
                                                                        02440000
      *                                                                 02450000
       01  PV-PROGRAM-VARIABLES.                                        02460000
           05  PV-QMGR-NAME            PIC X(04) VALUE SPACES.          02470000
               88  PV-PROD-QMGR-NAME             VALUE 'QKSP'.          02480000
               88  PV-TEST-QMGR-NAME             VALUE 'QKST'.          02490000
               88  PV-QA-QMGR-NAME               VALUE 'QKSQ'.          02500000
           05  PV-QM-NAME              PIC X(48).                       02510000
           05  PV-HCONN                PIC S9(9) BINARY VALUE 0.        02520000
           05  PV-OPEN-OPTIONS         PIC S9(9) BINARY VALUE 0.        02530000
           05  PV-COMPLETION-CODE      PIC S9(9) BINARY VALUE 0.        02540000
           05  PV-REASON               PIC S9(9) BINARY VALUE 0.        02550000
           05  PV-CON-REASON           PIC S9(9) BINARY VALUE 0.        02560000
           05  PV-PQ-HANDLE            PIC S9(9) BINARY VALUE 0.        02570000
           05  PV-FMT-OPEN-OUTPUT-HNDL PIC S9(9) BINARY VALUE 0.        02580000
           05  PV-ERROR-MESSAGE        PIC X(48)  VALUE SPACES.         02590000
           05  PV-DATA-LENGTH          PIC S9(9) BINARY.                02600000
           05  PV-MSGBUFFER            PIC X(1000000) VALUE SPACES.     02610000
                                                                        02620000
           05  PV-ITEM-NBR                     PIC S9(04)  VALUE ZEROS  02630000
                                                           COMP SYNC.   02640000
           05  PV-TSQ-LENGTH                   PIC S9(04)  VALUE ZEROS  02650000
                                                           COMP SYNC.   02660000
           05  PV-TSQ-NAME                     PIC  X(08)  VALUE SPACES.02670000
                                                                        02680000
           05  PV-TCPIPPRQ-RECORD1.                                     02690000
               10  PV-NEXT-RECORD              PIC  9(08)  VALUE ZEROS. 02700000
               10  PV-TOTAL-RECORDS            PIC  9(08)  VALUE ZEROS. 02710000
               10  FILLER                      PIC X(4104) VALUE SPACE. 02720000
           05  PV-TCPIPPRQ-RECORD2.                                     02730000
               10  PV-CURRENT-RECORD           PIC  9(08)  VALUE ZEROS. 02740000
               10  FILLER                      PIC X(4112) VALUE SPACE. 02750000
           05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  02760000
                                                           COMP SYNC.   02770000
           05  PV-STORE-NBR.                                            02780000
               10  PV-STORE-ZERO               PIC  9(01)  VALUE ZEROS. 02790000
               10  PV-STORE-3-NBR              PIC  X(03)  VALUE SPACE. 02800000
           05  PV-CURRENT-DATE.                                         02810000
               10  PV-CURRENT-YEAR             PIC  9(02)  VALUE ZEROS. 02820000
               10  PV-CURRENT-MONTH            PIC  9(02)  VALUE ZEROS. 02830000
               10  PV-CURRENT-DAY              PIC  9(02)  VALUE ZEROS. 02840000
           05  PV-CLOSED-DATE.                                          02850000
               10  PV-CLOSED-CENTURY           PIC  9(02)  VALUE ZEROS. 02860000
               10  PV-CLOSED-YEAR              PIC  9(02)  VALUE ZEROS. 02870000
               10  FILLER                      PIC  X(01)  VALUE SPACE. 02880000
               10  PV-CLOSED-MONTH             PIC  9(02)  VALUE ZEROS. 02890000
               10  FILLER                      PIC  X(01)  VALUE SPACE. 02900000
               10  PV-CLOSED-DAY               PIC  9(02)  VALUE ZEROS. 02910000
           05  PV-GREGORIAN-DATE.                                       02920000
               10  PV-GD-MONTH                 PIC  9(02)  VALUE ZEROS. 02930000
               10  PV-GD-DAY                   PIC  9(02)  VALUE ZEROS. 02940000
               10  PV-GD-YEAR                  PIC  9(02)  VALUE ZEROS. 02950000
           05  PV-DAYS-DIFFERENCE              PIC  9(05)  VALUE ZEROS. 02960000
           05  PV-STR-NBR-X.                                            02970000
               10  PV-STR-NBR-MASK             PIC  ZZZ9   VALUE ZEROS. 02980000
           05  PV-OTR                          PIC S9(04)  COMP         02990000
                                                           VALUE +0.    03000000
           05  PV-DISPLAY-STR-NBR              PIC  9(04)  VALUE ZEROS. 03010000
           05  PV-RETRY-COUNT                  PIC S9(04)  VALUE +0     03020000
                                                           COMP SYNC.   03030000
           05  PV-NULL-IND                     PIC S9(04)  VALUE +0     03040000
                                                           COMP SYNC.   03050000
      *                                                                 03060000
       01  ST-SYSTEM-TIME-DATE-AREA.                                    03070000
           05  ST-ABSTIME                      PIC S9(16)  VALUE +0     03080000
                                                           COMP SYNC.   03090000
           05  ST-SYSTEM-TIME.                                          03100000
               10  ST-HHMMSS-FORMAT            PIC  X(08)  VALUE SPACE. 03110000
               10  FILLER  REDEFINES  ST-HHMMSS-FORMAT.                 03120000
                   15  ST-SYSTEM-HOUR          PIC  X(02).              03130000
                   15  FILLER                  PIC  X(01).              03140000
                   15  ST-SYSTEM-MINUTE        PIC  X(02).              03150000
                   15  FILLER                  PIC  X(01).              03160000
                   15  ST-SYSTEM-SECOND        PIC  X(02).              03170000
           05  SD-SYSTEM-DATE.                                          03180000
               10  SD-MMDDYY-FORMAT            PIC  X(08)  VALUE SPACE. 03190000
               10  FILLER  REDEFINES  SD-MMDDYY-FORMAT.                 03200000
                   15  SD-SYSTEM-MONTH         PIC  X(02).              03210000
                   15  FILLER                  PIC  X(01).              03220000
                   15  SD-SYSTEM-DAY           PIC  X(02).              03230000
                   15  FILLER                  PIC  X(01).              03240000
                   15  SD-SYSTEM-YEAR          PIC  X(02).              03250000
               10  FILLER                      PIC  X(02)  VALUE SPACE. 03260000
           05  FILLER  REDEFINES  SD-SYSTEM-DATE.                       03270000
               10  FILLER                      PIC  X(06).              03280000
               10  SD-SYSTEM-CENTURY-YEAR      PIC  9(04).              03290000
           05  SD-YYYY-FORMAT                  PIC S9(09)  VALUE +0     03300000
                                                           COMP.        03310000
                                                                        03320000
      *                                                                 03330000
      * CURSOR TO DETERMINE IF THE TO STORE IS OPEN TO RECEIVE THE      03340000
      * TRANSFER.                                                       03350000
      *                                                                 03360000
           EXEC SQL                                                     03370000
              DECLARE  OTR_CSR CURSOR FOR                               03380000
               SELECT  DC_NBR                                           03390000
                 FROM  XST_DC_LOC_ASGMT A                               03400000
                     , XST_LOC B                                        03410000
                WHERE  B.LOC_NBR                   = :DK-STR-NBR        03420000
                  AND  A.LOC_NBR                   = B.LOC_NBR          03430000
                  AND  A.EFF_BEG_DTE             <= CURRENT DATE        03440000
             ORDER BY  A.EFF_BEG_DTE DESC                               03450000
           END-EXEC.                                                    03460000
                                                                        03470000
      ******************************************************************03480000
       PROCEDURE DIVISION.                                              03490000
      ******************************************************************03500000
       0000-PROGRAM-MAINLINE.                                           03510000
           INITIALIZE TF006-XFER-TO-PTC-RECORD.                         03520000
                                                                        03530000
           PERFORM 1000-RETRIEVE-TEXT.                                  03540000
                                                                        03550000
           PERFORM 2000-PROCESS-PTC-REQUEST.                            03560000
                                                                        03570000
           GOBACK.                                                      03580000
      *                                                                 03590000
       1000-RETRIEVE-TEXT.                                              03600000
           EXEC CICS                                                    03610000
               RETRIEVE                                                 03620000
                   INTO  (TF005-XFER-FROM-PTC-RECORD)                   03630000
                   RESP  (PV-CICS-RESPONSE)                             03640000
           END-EXEC.                                                    03650000
                                                                        03660000
           EVALUATE TRUE                                                03670000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03680000
                   CONTINUE                                             03690000
               WHEN OTHER                                               03700000
                   MOVE '1000-RETRIEVE-TEXT'                            03710000
                                   TO DP013-PARAGRAPH                   03720000
                   MOVE 'UNABLE TO RECEIVE TEXT'                        03730000
                                   TO DP013-MESSAGE-TEXT (1)            03740000
                   MOVE  TF005-XFER-FROM-PTC-RECORD                     03750000
                                   TO DP013-MESSAGE-TEXT (2)            03760000
                   SET DP013-CICS-ABEND                                 03770000
                       DP013-NO-ROLLBACK                                03780000
                                   TO TRUE                              03790000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      03800000
                   SET DP011-MSG-FATAL                                  03810000
                                   TO TRUE                              03820000
                   MOVE PC-TSYMSG-01064                                 03830000
                                   TO DP011-MSG-NUMBER                  03840000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      03850000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   03860000
           END-EVALUATE.                                                03870000
                                                                        03880000
                                                                        03890000
           MOVE TF005-LISTENER-CODE                                     03900000
                                   TO PV-QUEUE-PARM.                    03910000
                                                                        03920000
           IF  PV-VALID-PARM                                            03930000
               MOVE PV-QUEUE-NAME(PV-QUEUE-PARM-N)                      03940000
                                   TO PV-TSQ-NAME                       03950000
                                                                        03960000
           ELSE                                                         03970000
               MOVE '1000-RETRIEVE-TEXT'                                03980000
                                   TO DP013-PARAGRAPH                   03990000
               MOVE 'INVALID PARM VALUE'                                04000000
                                   TO DP013-MESSAGE-TEXT (1)            04010000
               MOVE 'PARM VALUE = '                                     04020000
                                   TO DP013-MESSAGE-TEXT (2)            04030000
               MOVE TF005-LISTENER-CODE                                 04040000
                                   TO DP013-MESSAGE-TEXT (3)            04050000
                                                                        04060000
               SET DP013-LOGIC-ABEND                                    04070000
                   DP013-NO-ROLLBACK                                    04080000
                                   TO TRUE                              04090000
                                                                        04100000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          04110000
                                                                        04120000
               SET DP011-MSG-FATAL TO TRUE                              04130000
                                                                        04140000
               MOVE PC-TSYMSG-01064                                     04150000
                                   TO DP011-MSG-NUMBER                  04160000
                                                                        04170000
               PERFORM 9000-FMT-ERR-MSG-TO-PTC                          04180000
               PERFORM 8000-SEND-DATA-TO-LISTENER                       04190000
           END-IF.                                                      04200000
                                                                        04210000
                                                                        04220000
      *                                                                 04230000
       2000-PROCESS-PTC-REQUEST.                                        04240000
           PERFORM 7100-FIND-TO-STR.                                    04250000
           IF XST00001-CLO-DTE  =  PC-DEFAULT-CLOSED-DATE               04260000
               CONTINUE                                                 04270000
           ELSE                                                         04280000
               PERFORM 2200-GET-CUR-DATE-TIME                           04290000
               PERFORM 2300-COMPARE-DATES                               04300000
               IF DPG55-DAYS-DIFFERENCE NEGATIVE                        04310000
                   COMPUTE PV-DAYS-DIFFERENCE  =                        04320000
                       DPG55-DAYS-DIFFERENCE  *  -1                     04330000
                   IF PV-DAYS-DIFFERENCE > PC-DAYS-IN-A-WEEK            04340000
                       CONTINUE                                         04350000
                   ELSE                                                 04360000
                      SET  DP011-MSG-FATAL                              04370000
                                   TO  TRUE                             04380000
                      MOVE TF005-TO-STR-NBR                             04390000
                                   TO  PV-STR-NBR-MASK                  04400000
                      MOVE PV-STR-NBR-X                                 04410000
                                   TO  DP011-MSG-TEXT                   04420000
                      MOVE PC-TSYMSG-01521                              04430000
                                   TO  DP011-MSG-NUMBER                 04440000
                      PERFORM 9000-FMT-ERR-MSG-TO-PTC                   04450000
                      PERFORM 8000-SEND-DATA-TO-LISTENER                04460000
                   END-IF                                               04470000
               ELSE                                                     04480000
                   SET  DP011-MSG-FATAL                                 04490000
                                   TO  TRUE                             04500000
                   MOVE PC-TSYMSG-00844                                 04510000
                                   TO  DP011-MSG-NUMBER                 04520000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      04530000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   04540000
               END-IF                                                   04550000
           END-IF.                                                      04560000
                                                                        04570000
021605     IF (TF005-XFER-TYP-CDE-X = TF007-DEFECTIVES-DAMAGES-SORT1    04580000
021605      OR TF005-XFER-TYP-CDE-X = TF007-DEFECTIVES-DAMAGES-SORT2)   04590000
070111         PERFORM 7520-SELECT-RTV-SITE                             04600000
070111         IF TF005-TO-STR-NBR = XST00135-RTV-LOC-NBR               04610000
                   MOVE XST00001-LOC-NM                                 04620000
                                   TO TF006-STR-NAME                    04630000
               ELSE                                                     04640000
                   SET  DP011-MSG-FATAL                                 04650000
                                   TO TRUE                              04660000
                   MOVE PC-TSYMSG-03208                                 04670000
                                   TO DP011-MSG-NUMBER                  04680000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      04690000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   04700000
              END-IF                                                    04710000
           END-IF.                                                      04720000
                                                                        04730000
021605     IF TF005-XFER-TYP-CDE-X = TF007-CALLBACK                     04740000
070111         IF  (TF005-TO-STR-NBR = PC-STORE-811)                    04750000
                   MOVE XST00001-LOC-NM                                 04760000
                                   TO TF006-STR-NAME                    04770000
               ELSE                                                     04780000
                   SET  DP011-MSG-FATAL                                 04790000
                                   TO TRUE                              04800000
                   MOVE PC-TSYMSG-03208                                 04810000
                                   TO DP011-MSG-NUMBER                  04820000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      04830000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   04840000
               END-IF                                                   04850000
           END-IF.                                                      04860000
                                                                        04870000
021605     IF TF005-XFER-TYP-CDE-X = TF007-OFFSITE-STORAGE              04880000
               IF TF005-FROM-STR-NBR  =  TF005-TO-STR-NBR               04890000
                   MOVE XST00001-LOC-NM                                 04900000
                                   TO TF006-STR-NAME                    04910000
               ELSE                                                     04920000
                   SET  DP011-MSG-FATAL                                 04930000
                                   TO TRUE                              04940000
                   MOVE PC-TSYMSG-01479                                 04950000
                                   TO DP011-MSG-NUMBER                  04960000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      04970000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   04980000
               END-IF                                                   04990000
           ELSE                                                         05000000
               IF TF005-FROM-STR-NBR  =  TF005-TO-STR-NBR               05010000
                   SET  DP011-MSG-FATAL                                 05020000
                                   TO TRUE                              05030000
                   MOVE PC-TSYMSG-01476                                 05040000
                                   TO DP011-MSG-NUMBER                  05050000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      05060000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   05070000
               END-IF                                                   05080000
           END-IF.                                                      05090000
                                                                        05100000
021605     IF TF005-XFER-TYP-CDE-X = TF007-NON-RETAIL                   05110000
      *** ALLOW NON-RETAIL TRANSFERS TO LOCATION 931, DS, RV, DC ***    05120000
               IF TF005-TO-STR-NBR = PC-LOCATION-931                    05130000
                       OR XST00001-LOC-TYP-CDE = PC-STR-TYPE-CODE       05140000
                       OR XST00001-LOC-TYP-CDE = PC-RTV-TYPE-CODE       05150000
                       OR XST00001-LOC-TYP-CDE = PC-DC-TYPE-CODE        05160000
                   MOVE XST00001-LOC-NM                                 05170000
                                   TO TF006-STR-NAME                    05180000
               ELSE                                                     05190000
                   SET  DP011-MSG-FATAL                                 05200000
                                   TO TRUE                              05210000
                   MOVE PC-TSYMSG-01479                                 05220000
                                   TO DP011-MSG-NUMBER                  05230000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      05240000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   05250000
               END-IF                                                   05260000
           END-IF.                                                      05270000
                                                                        05280000
060110     MOVE TF005-TO-STR-NBR TO PV-LOC-EXCLUSION                    05290000
060110     IF PV-EXCLUDE                                                05300000
060110         SET  DP011-MSG-FATAL TO TRUE                             05310000
060110         MOVE PC-TSYMSG-01479 TO DP011-MSG-NUMBER                 05320000
060110         PERFORM 9000-FMT-ERR-MSG-TO-PTC                          05330000
060110         PERFORM 8000-SEND-DATA-TO-LISTENER                       05340000
060110     END-IF.                                                      05350000
                                                                        05360000
060110     MOVE TF005-FROM-STR-NBR TO PV-LOC-EXCLUSION                  05370000
060110     IF PV-EXCLUDE                                                05380000
060110         SET  DP011-MSG-FATAL TO TRUE                             05390000
060110         MOVE PC-TSYMSG-03685 TO DP011-MSG-NUMBER                 05400000
060110         PERFORM 9000-FMT-ERR-MSG-TO-PTC                          05410000
060110         PERFORM 8000-SEND-DATA-TO-LISTENER                       05420000
060110     END-IF.                                                      05430000
                                                                        05440000
021605     IF TF005-XFER-TYP-CDE-X = TF007-STOCK-BALANCE-CORPORATE      05450000
021605             OR TF005-XFER-TYP-CDE-X = TF007-STOCK-BALANCE-STORE  05460000
021605             OR TF005-XFER-TYP-CDE-X = TF007-CUSTOMER             05470000
               IF XST00001-LOC-TYP-CDE = PC-STR-TYPE-CODE               05480000
                   MOVE XST00001-LOC-NM                                 05490000
                                   TO TF006-STR-NAME                    05500000
               ELSE                                                     05510000
                   SET  DP011-MSG-FATAL                                 05520000
                                   TO TRUE                              05530000
                   MOVE PC-TSYMSG-01479                                 05540000
                                   TO DP011-MSG-NUMBER                  05550000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      05560000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   05570000
               END-IF                                                   05580000
           END-IF.                                                      05590000
           PERFORM 8000-SEND-DATA-TO-LISTENER.                          05600000
      ****                                                              05610000
      * DETERMINE OPEN TO RECEIVE FOR STORES ONLY                       05620000
      ****                                                              05630000
           IF XST00001-LOC-TYP-CDE = PC-STR-TYPE-CODE                   05640000
               PERFORM 2100-DETERMINE-IS-STR-IS-OTR                     05650000
           END-IF.                                                      05660000
                                                                        05670000
      *                                                                 05680000
       2100-DETERMINE-IS-STR-IS-OTR.                                    05690000
           MOVE TF005-TO-STR-NBR   TO  DK-STR-NBR.                      05700000
                                                                        05710000
           PERFORM 2110-OPEN-OTR-CSR.                                   05720000
           PERFORM 7000-FETCH-OTR-CSR.                                  05730000
                                                                        05740000
           IF PV-OTR  =  +0                                             05750000
               IF (TF005-XFER-TYP-CDE-X NOT =                           05760000
021605                 TF007-DEFECTIVES-DAMAGES-SORT1                   05770000
                        AND                                             05780000
                       TF005-XFER-TYP-CDE-X NOT =                       05790000
021605                 TF007-DEFECTIVES-DAMAGES-SORT2                   05800000
                        AND                                             05810000
                       TF005-XFER-TYP-CDE-X NOT =                       05820000
021605                 TF007-CALLBACK)                                  05830000
                   SET  DP011-MSG-FATAL                                 05840000
                                   TO  TRUE                             05850000
                   MOVE PC-TSYMSG-01552                                 05860000
                                   TO  DP011-MSG-NUMBER                 05870000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      05880000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   05890000
               END-IF                                                   05900000
           END-IF.                                                      05910000
                                                                        05920000
           PERFORM 2120-CLOSE-OTR-CSR.                                  05930000
      *                                                                 05940000
       2110-OPEN-OTR-CSR.                                               05950000
           EXEC SQL                                                     05960000
               OPEN OTR_CSR                                             05970000
           END-EXEC.                                                    05980000
      *                                                                 05990000
           EVALUATE SQLCODE                                             06000000
               WHEN ZERO                                                06010000
                   CONTINUE                                             06020000
               WHEN OTHER                                               06030000
                   MOVE '2110-OPEN-OTR-CSR'                             06040000
                                   TO DP013-PARAGRAPH                   06050000
                   MOVE 'OPEN THE OTR_CSR CURSOR'                       06060000
                                   TO DP013-MESSAGE-TEXT (1)            06070000
                   MOVE DK-STR-NBR TO PV-DISPLAY-STR-NBR                06080000
                   MOVE PV-DISPLAY-STR-NBR                              06090000
                                   TO DP013-MESSAGE-TEXT (2)            06100000
                   MOVE SQLCA      TO DP013-SQLCA                       06110000
                   MOVE 'OTR-CSR'  TO DP013-DB2-TABLE-NAME (1)          06120000
                   SET DP013-DB2-ABEND                                  06130000
                       DP013-NO-ROLLBACK                                06140000
                                   TO TRUE                              06150000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      06160000
                   SET  DP011-MSG-FATAL                                 06170000
                                   TO TRUE                              06180000
                   MOVE PC-TSYMSG-01064                                 06190000
                                   TO DP011-MSG-NUMBER                  06200000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06210000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   06220000
           END-EVALUATE.                                                06230000
      *                                                                 06240000
       2120-CLOSE-OTR-CSR.                                              06250000
           EXEC SQL                                                     06260000
               CLOSE OTR_CSR                                            06270000
           END-EXEC.                                                    06280000
      *                                                                 06290000
           EVALUATE SQLCODE                                             06300000
               WHEN ZERO                                                06310000
                   CONTINUE                                             06320000
               WHEN OTHER                                               06330000
                   MOVE '2120-CLOSE-OTR-CSR'                            06340000
                                   TO DP013-PARAGRAPH                   06350000
                   MOVE 'CLOSE THE OTR_CSR CURSOR'                      06360000
                                   TO DP013-MESSAGE-TEXT (1)            06370000
                   MOVE DK-STR-NBR TO PV-DISPLAY-STR-NBR                06380000
                   MOVE PV-DISPLAY-STR-NBR                              06390000
                                   TO DP013-MESSAGE-TEXT (2)            06400000
                   MOVE SQLCA      TO DP013-SQLCA                       06410000
                   MOVE 'OTR-LOC'  TO DP013-DB2-TABLE-NAME (1)          06420000
                   SET DP013-DB2-ABEND                                  06430000
                       DP013-NO-ROLLBACK                                06440000
                                   TO TRUE                              06450000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      06460000
                   SET  DP011-MSG-FATAL                                 06470000
                                   TO TRUE                              06480000
                   MOVE PC-TSYMSG-01064                                 06490000
                                   TO DP011-MSG-NUMBER                  06500000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06510000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   06520000
           END-EVALUATE.                                                06530000
      *                                                                 06540000
       2200-GET-CUR-DATE-TIME.                                          06550000
           EXEC CICS                                                    06560000
               ASKTIME ABSTIME (ST-ABSTIME)                             06570000
           END-EXEC.                                                    06580000
                                                                        06590000
           EXEC CICS                                                    06600000
               FORMATTIME ABSTIME  (ST-ABSTIME)                         06610000
                          MMDDYY   (SD-MMDDYY-FORMAT)                   06620000
                          DATESEP                                       06630000
                          TIME     (ST-HHMMSS-FORMAT)                   06640000
                          TIMESEP                                       06650000
           END-EXEC.                                                    06660000
                                                                        06670000
           EXEC CICS                                                    06680000
               FORMATTIME ABSTIME  (ST-ABSTIME)                         06690000
                             YEAR  (SD-YYYY-FORMAT)                     06700000
           END-EXEC.                                                    06710000
                                                                        06720000
           MOVE SD-SYSTEM-MONTH    TO  PV-CURRENT-MONTH.                06730000
           MOVE SD-SYSTEM-DAY      TO  PV-CURRENT-DAY.                  06740000
           MOVE SD-SYSTEM-YEAR     TO  PV-CURRENT-YEAR.                 06750000
      *                                                                 06760000
       2300-COMPARE-DATES.                                              06770000
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              06780000
                                                                        06790000
           SET  DPG51-ACTUAL-CALENDAR-ONLY                              06800000
                DPG51-DO-NOT-INCR-DECR-DATE                             06810000
                DPG52-LK-DTE-GREG                                       06820000
                DPG53-LK-CMPR-DTE-GREG                                  06830000
                                   TO  TRUE.                            06840000
                                                                        06850000
           MOVE PV-CURRENT-MONTH   TO  PV-GD-MONTH.                     06860000
           MOVE PV-CURRENT-DAY     TO  PV-GD-DAY.                       06870000
           MOVE PV-CURRENT-YEAR    TO  PV-GD-YEAR.                      06880000
           MOVE PV-GREGORIAN-DATE  TO  DPG52-LK-DATE-INPUT.             06890000
                                                                        06900000
           MOVE XST00001-CLO-DTE   TO  PV-CLOSED-DATE.                  06910000
           MOVE PV-CLOSED-MONTH    TO  PV-GD-MONTH.                     06920000
           MOVE PV-CLOSED-DAY      TO  PV-GD-DAY.                       06930000
           MOVE PV-CLOSED-YEAR     TO  PV-GD-YEAR.                      06940000
           MOVE PV-GREGORIAN-DATE  TO  DPG53-LK-CMPR-DATE-INPUT.        06950000
                                                                        06960000
           CALL DP500-KOHLS-CALENDAR-ROUTINE                            06970000
               USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               06980000
                                                                        06990000
           EVALUATE TRUE                                                07000000
               WHEN DPG54-NO-ERROR                                      07010000
                   CONTINUE                                             07020000
               WHEN OTHER                                               07030000
                   MOVE '2300-COMPARE-DATES' TO DP013-PARAGRAPH         07040000
                   MOVE 'COMPARE THE STORE CLOSING DATE TO THE CURRENT D07050000
      -                 'ATE'      TO DP013-MESSAGE-TEXT (1)            07060000
                   MOVE PV-CURRENT-DATE                                 07070000
                                   TO DP013-MESSAGE-TEXT (2)            07080000
                   MOVE DPG53-LK-CMPR-DATE-INPUT                        07090000
                                   TO DP013-MESSAGE-TEXT (3)            07100000
                   MOVE DPG54-ERROR-MESSAGE                             07110000
                                   TO DP013-MESSAGE-TEXT (4)            07120000
                   SET DP013-OTHER-ABEND                                07130000
                       DP013-NO-ROLLBACK                                07140000
                                   TO TRUE                              07150000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      07160000
                   SET  DP011-MSG-FATAL                                 07170000
                                   TO TRUE                              07180000
                   MOVE PC-TSYMSG-01064                                 07190000
                                   TO DP011-MSG-NUMBER                  07200000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      07210000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   07220000
           END-EVALUATE.                                                07230000
      *                                                                 07240000
       7000-FETCH-OTR-CSR.                                              07250000
      *                                                                 07260000
           EXEC SQL                                                     07270000
               FETCH  OTR_CSR                                           07280000
                INTO  :PV-OTR                                           07290000
           END-EXEC.                                                    07300000
      *                                                                 07310000
           EVALUATE SQLCODE                                             07320000
               WHEN ZERO                                                07330000
                   CONTINUE                                             07340000
               WHEN +100                                                07350000
                   CONTINUE                                             07360000
               WHEN -904                                                07370000
               WHEN -913                                                07380000
                   SET  DP011-MSG-FATAL                                 07390000
                                   TO TRUE                              07400000
                   MOVE PC-TSYMSG-01063                                 07410000
                                   TO DP011-MSG-NUMBER                  07420000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      07430000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   07440000
               WHEN OTHER                                               07450000
                   MOVE '7000-FETCH-OTR-CSR'                            07460000
                                   TO DP013-PARAGRAPH                   07470000
                   MOVE 'FETCH OTR_CSR'                                 07480000
                                   TO DP013-MESSAGE-TEXT (1)            07490000
                   MOVE DK-STR-NBR TO PV-DISPLAY-STR-NBR                07500000
                   MOVE PV-DISPLAY-STR-NBR                              07510000
                                   TO DP013-MESSAGE-TEXT (2)            07520000
                   MOVE SQLCA      TO DP013-SQLCA                       07530000
                   MOVE 'OTR-CSR'  TO DP013-DB2-TABLE-NAME (1)          07540000
                   SET DP013-DB2-ABEND                                  07550000
                       DP013-NO-ROLLBACK                                07560000
                                   TO TRUE                              07570000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      07580000
                   SET  DP011-MSG-FATAL                                 07590000
                                   TO TRUE                              07600000
                   MOVE PC-TSYMSG-01064                                 07610000
                                   TO DP011-MSG-NUMBER                  07620000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      07630000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   07640000
           END-EVALUATE.                                                07650000
      *                                                                 07660000
       7100-FIND-TO-STR.                                                07670000
           INITIALIZE DCLXST00001.                                      07680000
                                                                        07690000
           MOVE TF005-TO-STR-NBR   TO  DK-STR-NBR.                      07700000
                                                                        07710000
           EXEC SQL                                                     07720000
               SELECT  LOC_NM,                                          07730000
                       LOC_TYP_CDE,                                     07740000
                       CLO_DTE                                          07750000
                 INTO  :XST00001-LOC-NM,                                07760000
                       :XST00001-LOC-TYP-CDE,                           07770000
                       :XST00001-CLO-DTE                                07780000
                 FROM  XST_LOC                                          07790000
                WHERE  LOC_NBR      =  :DK-STR-NBR                      07800000
           END-EXEC.                                                    07810000
                                                                        07820000
           EVALUATE SQLCODE                                             07830000
               WHEN ZERO                                                07840000
                   CONTINUE                                             07850000
               WHEN +100                                                07860000
                   SET  DP011-MSG-FATAL                                 07870000
                                   TO TRUE                              07880000
                   MOVE PC-TSYMSG-00594                                 07890000
                                   TO DP011-MSG-NUMBER                  07900000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      07910000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   07920000
               WHEN -904                                                07930000
               WHEN -913                                                07940000
                   SET  DP011-MSG-FATAL                                 07950000
                                   TO TRUE                              07960000
                   MOVE PC-TSYMSG-01063                                 07970000
                                   TO DP011-MSG-NUMBER                  07980000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      07990000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   08000000
               WHEN OTHER                                               08010000
                   MOVE '7100-FIND-TO-STR'                              08020000
                                   TO DP013-PARAGRAPH                   08030000
                   MOVE 'SELECTING DATA FOR STORE: '                    08040000
                                   TO DP013-MESSAGE-TEXT (1)            08050000
                   MOVE DK-STR-NBR TO PV-DISPLAY-STR-NBR                08060000
                   MOVE PV-DISPLAY-STR-NBR                              08070000
                                   TO DP013-MESSAGE-TEXT (2)            08080000
                   MOVE SQLCA      TO DP013-SQLCA                       08090000
                   MOVE 'XST_LOC'  TO DP013-DB2-TABLE-NAME (1)          08100000
                   SET DP013-DB2-ABEND                                  08110000
                       DP013-NO-ROLLBACK                                08120000
                                   TO TRUE                              08130000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      08140000
                   SET  DP011-MSG-FATAL                                 08150000
                                   TO TRUE                              08160000
                   MOVE PC-TSYMSG-01064                                 08170000
                                   TO DP011-MSG-NUMBER                  08180000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      08190000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   08200000
           END-EVALUATE.                                                08210000
      *                                                                 08220000
      *----------------------------------------------------------------*08230000
      *  GET RTV LOCATION FOR DC/LOCATION                              *08240000
      *----------------------------------------------------------------*08250000
070111 7520-SELECT-RTV-SITE.                                            08260000
                                                                        08270000
070111     MOVE TF005-FROM-STR-NBR        TO XST00020-LOC-NBR.          08280000
070111     MOVE TF005-XFER-TYP-CDE-X      TO XST00135-XFER-TYP-CDE.     08290000
                                                                        08300000
070111     EXEC SQL                                                     08310000
070111           SELECT  B.DC_NBR                                       08320000
070111                  ,C.RTV_LOC_NBR                                  08330000
070111             INTO  :XST00020-DC-NBR                               08340000
070111                  ,:XST00135-RTV-LOC-NBR                          08350000
070111             FROM  XST_DC_LOC_ASGMT   B                           08360000
070111                  ,XST_RTV_LOC_RLTNSHP C                          08370000
070111            WHERE  B.LOC_NBR      = :XST00020-LOC-NBR             08380000
070111              AND  B.EFF_BEG_DTE  =                               08390000
070111                        (SELECT MAX(EFF_BEG_DTE)                  08400000
070111                           FROM XST_DC_LOC_ASGMT                  08410000
070111                          WHERE LOC_NBR = B.LOC_NBR)              08420000
070111              AND  B.DC_NBR  = C.LOC_NBR                          08430000
070111              AND  XFER_TYP_CDE = :XST00135-XFER-TYP-CDE          08440000
070111              AND  C.EFF_BEG_DTE  =                               08450000
070111                 (SELECT MAX(EFF_BEG_DTE)                         08460000
C83065                     FROM XST_RTV_LOC_RLTNSHP                     08471001
CRQFIX                     WHERE LOC_NBR = C.LOC_NBR AND                08472003
CRQFIX                           XFER_TYP_CDE = :XST00135-XFER-TYP-CDE) 08473002
070111     END-EXEC                                                     08480000
070111     EVALUATE TRUE                                                08490000
070111         WHEN SQLCODE = ZERO                                      08500000
070111         WHEN SQLCODE = +100                                      08510000
070111             CONTINUE                                             08520000
070111         WHEN SQLCODE = -904                                      08530000
070111         WHEN SQLCODE = -913                                      08540000
070111             SET  DP011-MSG-FATAL                                 08550000
070111                         TO TRUE                                  08560000
070111             MOVE PC-TSYMSG-01063                                 08570000
070111                         TO DP011-MSG-NUMBER                      08580000
070111             PERFORM 9000-FMT-ERR-MSG-TO-PTC                      08590000
070111             PERFORM 8000-SEND-DATA-TO-LISTENER                   08600000
070111         WHEN OTHER                                               08610000
070111             MOVE '7520-SELECT-RTV-SITE'                          08620000
070111                             TO DP013-PARAGRAPH                   08630000
070111             MOVE 'SELECT XST_RTV_LOC_RLTNSHP'                    08640000
070111                             TO DP013-MESSAGE-TEXT (1)            08650000
070111             MOVE TF005-FROM-STR-NBR TO PV-DISPLAY-STR-NBR        08660000
070111             MOVE PV-DISPLAY-STR-NBR                              08670000
070111                             TO DP013-MESSAGE-TEXT (2)            08680000
070111             MOVE SQLCA      TO DP013-SQLCA                       08690000
070111             MOVE 'RLTNSHP'  TO DP013-DB2-TABLE-NAME (1)          08700000
070111             SET DP013-DB2-ABEND                                  08710000
070111                 DP013-NO-ROLLBACK                                08720000
070111                             TO TRUE                              08730000
070111             PERFORM 9999-WRITE-CICS-LOG-MSG                      08740000
070111             SET  DP011-MSG-FATAL                                 08750000
070111                             TO TRUE                              08760000
070111             MOVE PC-TSYMSG-01064                                 08770000
070111                             TO DP011-MSG-NUMBER                  08780000
070111             PERFORM 9000-FMT-ERR-MSG-TO-PTC                      08790000
070111             PERFORM 8000-SEND-DATA-TO-LISTENER                   08800000
070111     END-EVALUATE.                                                08810000
                                                                        08820000
      ******************************************************************08830000
      *  CONNECT TO SOCKET WHICH WAS GIVEN TO US BY THE AL/SYSTEMS PTC  08840000
      *  PROGRAM.  CONNECT THE PATH (SOCKET).                           08850000
      ******************************************************************08860000
       8000-SEND-DATA-TO-LISTENER.                                      08870000
           IF TF005-MQ-INDICATOR-Y                                      08880000
               PERFORM 8500-MQ-SETUP                                    08890000
               PERFORM 8510-MQ-SETUP-REMOTE                             08900000
               PERFORM 8520-PUT-QUEUE                                   08910000
               PERFORM 8600-CLOSE-PUT-Q                                 08920000
               PERFORM 8610-DISCONNECT-QMGR                             08930000
               PERFORM 9100-EXEC-CICS-RETURN                            08940000
           ELSE                                                         08950000
               PERFORM 8110-ENQ-TCPIPPRQ                                08960000
               PERFORM 8120-READQ-TCPIPPRQ-RECORD1                      08970000
               PERFORM 8130-READQ-TCPIPPRQ-RECORD2                      08980000
                                                                        08990000
      *MUST BE HERE                                                     09000000
               PERFORM 8140-REWRITE-TCPIPPRQ-NEXT-REC                   09010000
      *MUST BE HERE                                                     09020000
               ADD 1               TO PV-NEXT-RECORD                    09030000
                                                                        09040000
               IF PV-NEXT-RECORD > PV-TOTAL-RECORDS                     09050000
                   MOVE 3          TO PV-NEXT-RECORD                    09060000
               END-IF                                                   09070000
                                                                        09080000
               PERFORM 8150-REWRITE-TCPIPPRQ-RECORD1                    09090000
               PERFORM 8160-DEQ-TCPIPPRQ                                09100000
                                                                        09110000
               PERFORM 9100-EXEC-CICS-RETURN                            09120000
           END-IF.                                                      09130000
      *                                                                 09140000
      ******************************************************************09150000
       8110-ENQ-TCPIPPRQ.                                               09160000
           EXEC CICS                                                    09170000
               ENQ                                                      09180000
                   RESOURCE  (PV-TSQ-NAME)                              09190000
                   RESP      (PV-CICS-RESPONSE)                         09200000
           END-EXEC.                                                    09210000
                                                                        09220000
           EVALUATE TRUE                                                09230000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 09240000
                   CONTINUE                                             09250000
               WHEN OTHER                                               09260000
                   MOVE '8110-ENQ-TCPIPPRQ'                             09270000
                                   TO DP013-PARAGRAPH                   09280000
                   MOVE 'UNABLE TO ENQ THE FOLLOWING TEMPORARY STORAGE Q09290000
      -                 'UEUE: '                                        09300000
                                   TO DP013-MESSAGE-TEXT (1)            09310000
                   MOVE PV-TSQ-NAME                                     09320000
                                   TO DP013-MESSAGE-TEXT (2)            09330000
                   SET DP013-CICS-ABEND                                 09340000
                       DP013-NO-ROLLBACK                                09350000
                                   TO TRUE                              09360000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      09370000
                   PERFORM 9100-EXEC-CICS-RETURN                        09380000
           END-EVALUATE.                                                09390000
      *                                                                 09400000
      ******************************************************************09410000
       8120-READQ-TCPIPPRQ-RECORD1.                                     09420000
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD1                           09430000
                                   TO PV-TSQ-LENGTH.                    09440000
                                                                        09450000
           EXEC CICS                                                    09460000
               READQ TS                                                 09470000
                   QUEUE   (PV-TSQ-NAME)                                09480000
                   INTO    (PV-TCPIPPRQ-RECORD1)                        09490000
                   LENGTH  (PV-TSQ-LENGTH)                              09500000
                   ITEM    (1)                                          09510000
                   RESP    (PV-CICS-RESPONSE)                           09520000
           END-EXEC.                                                    09530000
                                                                        09540000
           EVALUATE TRUE                                                09550000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 09560000
                   CONTINUE                                             09570000
               WHEN OTHER                                               09580000
                   MOVE '8120-READQ-TCPIPPRQ-RECORD1'                   09590000
                                   TO DP013-PARAGRAPH                   09600000
                   MOVE 'UNABLE TO READ THE FOLLOWING TEMPORARY STORAGE 09610000
      -                 'QUEUE: '                                       09620000
                                   TO DP013-MESSAGE-TEXT (1)            09630000
                   MOVE PV-TSQ-NAME                                     09640000
                                   TO DP013-MESSAGE-TEXT (2)            09650000
                   SET DP013-CICS-ABEND                                 09660000
                       DP013-NO-ROLLBACK                                09670000
                                   TO TRUE                              09680000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      09690000
                   PERFORM 9100-EXEC-CICS-RETURN                        09700000
           END-EVALUATE.                                                09710000
      *                                                                 09720000
      ******************************************************************09730000
       8130-READQ-TCPIPPRQ-RECORD2.                                     09740000
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD2                           09750000
                                   TO PV-TSQ-LENGTH.                    09760000
                                                                        09770000
           EXEC CICS                                                    09780000
               READQ TS                                                 09790000
                   QUEUE   (PV-TSQ-NAME)                                09800000
                   INTO    (PV-TCPIPPRQ-RECORD2)                        09810000
                   LENGTH  (PV-TSQ-LENGTH)                              09820000
                   ITEM    (2)                                          09830000
                   RESP    (PV-CICS-RESPONSE)                           09840000
           END-EXEC.                                                    09850000
                                                                        09860000
           EVALUATE TRUE                                                09870000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 09880000
                   CONTINUE                                             09890000
               WHEN OTHER                                               09900000
                   MOVE '8130-READQ-TCPIPPRQ-RECORD2'                   09910000
                                   TO DP013-PARAGRAPH                   09920000
                   MOVE 'UNABLE TO READ THE FOLLOWING TEMPORARY STORAGE 09930000
      -                 'QUEUE: '                                       09940000
                                   TO DP013-MESSAGE-TEXT (1)            09950000
                   MOVE PV-TSQ-NAME                                     09960000
                                   TO DP013-MESSAGE-TEXT (2)            09970000
                   SET DP013-CICS-ABEND                                 09980000
                       DP013-NO-ROLLBACK                                09990000
                                   TO TRUE                              10000000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      10010000
                   PERFORM 9100-EXEC-CICS-RETURN                        10020000
           END-EVALUATE.                                                10030000
      *                                                                 10040000
      ******************************************************************10050000
       8140-REWRITE-TCPIPPRQ-NEXT-REC.                                  10060000
           MOVE LENGTH OF TF006-XFER-TO-PTC-RECORD                      10070000
                                   TO  TF006-TOT-REC-LENGTH.            10080000
                                                                        10090000
           MOVE TF005-MATCHING-NBR-FIELD                                10100000
                                   TO  TF006-MATCHING-NBR-FIELD.        10110000
           MOVE PV-NEXT-RECORD     TO  PV-ITEM-NBR.                     10120000
                                                                        10130000
           EXEC CICS                                                    10140000
               WRITEQ TS                                                10150000
                   QUEUE   (PV-TSQ-NAME)                                10160000
                   FROM    (TF006-XFER-TO-PTC-RECORD)                   10170000
                   LENGTH  (PV-TSQ-LENGTH)                              10180000
                   ITEM    (PV-ITEM-NBR)                                10190000
                       REWRITE                                          10200000
                   RESP    (PV-CICS-RESPONSE)                           10210000
           END-EXEC.                                                    10220000
                                                                        10230000
           EVALUATE TRUE                                                10240000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 10250000
                   CONTINUE                                             10260000
               WHEN OTHER                                               10270000
                   MOVE '8140-REWRITE-TCPIPPRQ-NEXT-REC'                10280000
                                   TO DP013-PARAGRAPH                   10290000
                   MOVE 'UNABLE TO REWRITE THE FOLLOWING TEMPORARY STORA10300000
      -                 'STORAGE QUEUE: '                               10310000
                                   TO DP013-MESSAGE-TEXT (1)            10320000
                   MOVE PV-TSQ-NAME                                     10330000
                                   TO DP013-MESSAGE-TEXT (2)            10340000
                   SET DP013-CICS-ABEND                                 10350000
                       DP013-NO-ROLLBACK                                10360000
                                   TO TRUE                              10370000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      10380000
                   PERFORM 9100-EXEC-CICS-RETURN                        10390000
           END-EVALUATE.                                                10400000
      *                                                                 10410000
      ******************************************************************10420000
       8150-REWRITE-TCPIPPRQ-RECORD1.                                   10430000
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD1                           10440000
                                   TO PV-TSQ-LENGTH.                    10450000
           MOVE +1                 TO PV-ITEM-NBR.                      10460000
                                                                        10470000
           EXEC CICS                                                    10480000
               WRITEQ TS                                                10490000
                   QUEUE   (PV-TSQ-NAME)                                10500000
                   FROM    (PV-TCPIPPRQ-RECORD1)                        10510000
                   LENGTH  (PV-TSQ-LENGTH)                              10520000
                   ITEM    (PV-ITEM-NBR)                                10530000
                       REWRITE                                          10540000
                   RESP    (PV-CICS-RESPONSE)                           10550000
           END-EXEC.                                                    10560000
                                                                        10570000
           EVALUATE TRUE                                                10580000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 10590000
                   CONTINUE                                             10600000
               WHEN OTHER                                               10610000
                   MOVE '8150-REWRITE-TCPIPPRQ-RECORD1'                 10620000
                                   TO DP013-PARAGRAPH                   10630000
                   MOVE 'UNABLE TO REWRITE A RECORD TO THE FOLLOWING'   10640000
                                   TO DP013-MESSAGE-TEXT (1)            10650000
                   MOVE 'TEMPORARY STORAGE QUEUE: '                     10660000
                                   TO DP013-MESSAGE-TEXT (2)            10670000
                   MOVE PV-TSQ-NAME                                     10680000
                                   TO DP013-MESSAGE-TEXT (3)            10690000
                   MOVE PV-TCPIPPRQ-RECORD1                             10700000
                                   TO DP013-MESSAGE-TEXT (4)            10710000
                   SET DP013-CICS-ABEND                                 10720000
                       DP013-NO-ROLLBACK                                10730000
                                   TO TRUE                              10740000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      10750000
                   PERFORM 9100-EXEC-CICS-RETURN                        10760000
           END-EVALUATE.                                                10770000
      *                                                                 10780000
      ******************************************************************10790000
       8160-DEQ-TCPIPPRQ.                                               10800000
           EXEC CICS                                                    10810000
               DEQ                                                      10820000
                   RESOURCE  (PV-TSQ-NAME)                              10830000
                   RESP      (PV-CICS-RESPONSE)                         10840000
           END-EXEC.                                                    10850000
                                                                        10860000
           EVALUATE TRUE                                                10870000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 10880000
                   CONTINUE                                             10890000
               WHEN OTHER                                               10900000
                   MOVE '8160-DEQ-TCPIPPRQ'                             10910000
                                   TO DP013-PARAGRAPH                   10920000
                   MOVE 'UNABLE TO DEQ THE FOLLOWING TEMPORARY STORAGE Q10930000
      -                 'UEUE: '                                        10940000
                                   TO DP013-MESSAGE-TEXT (1)            10950000
                   MOVE PV-TSQ-NAME                                     10960000
                                   TO DP013-MESSAGE-TEXT (2)            10970000
                   SET DP013-CICS-ABEND                                 10980000
                       DP013-NO-ROLLBACK                                10990000
                                   TO TRUE                              11000000
                 PERFORM 9999-WRITE-CICS-LOG-MSG                        11010000
                 PERFORM 9100-EXEC-CICS-RETURN                          11020000
           END-EVALUATE.                                                11030000
                                                                        11040000
       8500-MQ-SETUP.                                                   11050000
                                                                        11060000
      * DETERMINE THE SYSTEM                                            11070000
                                                                        11080000
           PERFORM EP000-0000-INITIALIZE.                               11090000
           IF EP000-PV-KOHLS-PROD-SYSTEM                                11100000
               SET PV-PROD-QMGR-NAME                                    11110000
                                   TO TRUE                              11120000
           ELSE                                                         11130000
               IF EP000-PV-KOHLS-QA-SYSTEM                              11140000
                   SET PV-QA-QMGR-NAME                                  11150000
                                   TO TRUE                              11160000
               ELSE                                                     11170000
                   SET PV-TEST-QMGR-NAME                                11180000
                                   TO TRUE                              11190000
               END-IF                                                   11200000
           END-IF.                                                      11210000
                                                                        11220000
      ***************************************************************   11230000
      *    CONNECT TO THE QUEUE MANAGER                                 11240000
      ***************************************************************   11250000
                                                                        11260000
           MOVE PV-QMGR-NAME       TO PV-QM-NAME.                       11270000
           CALL WS-MQCONN USING PV-QM-NAME                              11280000
                                PV-HCONN                                11290000
                                PV-COMPLETION-CODE                      11300000
                                PV-REASON.                              11310000
                                                                        11320000
      ***************************************************************   11330000
      *    IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE              11340000
      *    AND EXIT                                                     11350000
      ***************************************************************   11360000
                                                                        11370000
           MOVE PV-REASON          TO PV-CON-REASON.                    11380000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   11390000
               MOVE 'MQCONN ERROR' TO PV-ERROR-MESSAGE                  11400000
               MOVE '8500-MQ-SETUP'                                     11410000
                                   TO DP013-PARAGRAPH                   11420000
               MOVE  PV-ERROR-MESSAGE                                   11430000
                                   TO DP013-MESSAGE-TEXT (1)            11440000
               MOVE  PV-COMPLETION-CODE                                 11450000
                                   TO DP013-MESSAGE-TEXT (2)            11460000
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            11470000
               SET DP013-CICS-ABEND                                     11480000
                   DP013-NO-ROLLBACK                                    11490000
                                   TO TRUE                              11500000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          11510000
               PERFORM 9100-EXEC-CICS-RETURN                            11520000
           END-IF.                                                      11530000
                                                                        11540000
                                                                        11550000
       8510-MQ-SETUP-REMOTE.                                            11560000
      ***************************************************************   11570000
      *    OPEN THE RF.RESPONSE.Q QUEUE FOR OUTPUT.                     11580000
      *    THIS IS A REMOTE QUEUE.                                      11590000
      ***************************************************************   11600000
                                                                        11610000
           COMPUTE PV-OPEN-OPTIONS = MQOO-OUTPUT +                      11620000
                                     MQOO-FAIL-IF-QUIESCING.            11630000
                                                                        11640000
           MOVE TF005-REPLYTOQ     TO MQOD-OBJECTNAME.                  11650000
           MOVE TF005-REPLYTOQMGR  TO MQOD-OBJECTQMGRNAME.              11660000
                                                                        11670000
           CALL WS-MQOPEN USING PV-HCONN                                11680000
                                MQM-OBJECT-DESCRIPTOR                   11690000
                                PV-OPEN-OPTIONS                         11700000
                                PV-PQ-HANDLE                            11710000
                                PV-COMPLETION-CODE                      11720000
                                PV-REASON.                              11730000
                                                                        11740000
      ********************************************************          11750000
      *    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE                    11760000
      *    AND EXIT.                                                    11770000
      ********************************************************          11780000
      *                                                                 11790000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   11800000
               PERFORM 8600-CLOSE-PUT-Q                                 11810000
               PERFORM 8610-DISCONNECT-QMGR                             11820000
               MOVE 'MQOPEN WRITE Q'                                    11830000
                                   TO PV-ERROR-MESSAGE                  11840000
               MOVE '8510-MQ-SETUP-REMOTE'                              11850000
                                   TO DP013-PARAGRAPH                   11860000
               MOVE  PV-ERROR-MESSAGE                                   11870000
                                   TO DP013-MESSAGE-TEXT (1)            11880000
               MOVE  PV-COMPLETION-CODE                                 11890000
                                   TO DP013-MESSAGE-TEXT (2)            11900000
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            11910000
               SET DP013-CICS-ABEND                                     11920000
                   DP013-NO-ROLLBACK                                    11930000
                                   TO TRUE                              11940000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          11950000
               PERFORM 9100-EXEC-CICS-RETURN                            11960000
           END-IF.                                                      11970000
           MOVE PV-PQ-HANDLE       TO PV-FMT-OPEN-OUTPUT-HNDL.          11980000
      *                                                                 11990000
      ******************************************************************12000000
       8520-PUT-QUEUE.                                                  12010000
           MOVE TF005-REPLYTOQMGR  TO MQOD-OBJECTQMGRNAME.              12020000
           MOVE TF005-REPLYTOQ     TO MQOD-OBJECTNAME.                  12030000
           MOVE TF005-MSGID        TO MQMD-CORRELID.                    12040000
           MOVE MQMI-NONE          TO MQMD-MSGID.                       12050000
           MOVE MQFMT-STRING       TO MQMD-FORMAT.                      12060000
           MOVE 5000               TO MQMD-EXPIRY.                      12070000
           MOVE LENGTH OF TF006-XFER-TO-PTC-RECORD                      12080000
                                   TO PV-DATA-LENGTH.                   12090000
           MOVE TF006-XFER-TO-PTC-RECORD                                12100000
                                   TO PV-MSGBUFFER.                     12110000
           MOVE MQPER-PERSISTENT   TO MQMD-PERSISTENCE.                 12120000
                                                                        12130000
           COMPUTE MQPMO-CONTEXT  =  PV-PQ-HANDLE.                      12140000
                                                                        12150000
                                                                        12160000
                                                                        12170000
           CALL WS-MQPUT USING PV-HCONN                                 12180000
                               PV-FMT-OPEN-OUTPUT-HNDL                  12190000
                               MQM-MESSAGE-DESCRIPTOR                   12200000
                               MQM-PUT-MESSAGE-OPTIONS                  12210000
                               PV-DATA-LENGTH                           12220000
                               PV-MSGBUFFER                             12230000
                               PV-COMPLETION-CODE                       12240000
                               PV-REASON.                               12250000
                                                                        12260000
      ***********************************************************       12270000
      *        IF PUT FAILED THEN DISPLAY ERROR MESSAGE                 12280000
      *        AND BREAK OUT OF LOOP                                    12290000
      ***********************************************************       12300000
                                                                        12310000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   12320000
                  MOVE PV-COMPLETION-CODE                               12330000
                                   TO PH-COMPLETION-CODE                12340000
                  MOVE PV-REASON   TO PH-REASON                         12350000
                  PERFORM 8600-CLOSE-PUT-Q                              12360000
                  PERFORM 8610-DISCONNECT-QMGR                          12370000
                  MOVE 'MQPUT ERR' TO PV-ERROR-MESSAGE                  12380000
                  MOVE '8520-PUT-QUEUE'                                 12390000
                                   TO DP013-PARAGRAPH                   12400000
                  MOVE PV-ERROR-MESSAGE                                 12410000
                                   TO DP013-MESSAGE-TEXT (1)            12420000
                  MOVE PH-COMPLETION-CODE                               12430000
                                   TO DP013-MESSAGE-TEXT (2)            12440000
                  MOVE PH-REASON   TO DP013-MESSAGE-TEXT (3)            12450000
                  SET DP013-CICS-ABEND                                  12460000
                      DP013-NO-ROLLBACK                                 12470000
                                   TO TRUE                              12480000
                  PERFORM 9999-WRITE-CICS-LOG-MSG                       12490000
                  PERFORM 9100-EXEC-CICS-RETURN                         12500000
           ELSE                                                         12510000
              SET PS-MQPUT-SUCCESSFUL                                   12520000
                                   TO TRUE                              12530000
           END-IF.                                                      12540000
      *                                                                 12550000
      ******************************************************************12560000
       8600-CLOSE-PUT-Q.                                                12570000
           CALL WS-MQCLOSE USING PV-HCONN                               12580000
                                 PV-PQ-HANDLE                           12590000
                                 MQCO-NONE                              12600000
                                 PV-COMPLETION-CODE                     12610000
                                 PV-REASON.                             12620000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   12630000
               MOVE 'MQCLOSE PQ HANDLE'                                 12640000
                                   TO PV-ERROR-MESSAGE                  12650000
               MOVE '8600-CLOSE-PUT-Q'                                  12660000
                                   TO DP013-PARAGRAPH                   12670000
               MOVE  PV-ERROR-MESSAGE                                   12680000
                                   TO DP013-MESSAGE-TEXT (1)            12690000
               MOVE  PV-COMPLETION-CODE                                 12700000
                                   TO DP013-MESSAGE-TEXT (2)            12710000
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            12720000
               SET DP013-CICS-ABEND                                     12730000
                   DP013-NO-ROLLBACK                                    12740000
                                   TO TRUE                              12750000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          12760000
               PERFORM 9100-EXEC-CICS-RETURN                            12770000
           END-IF.                                                      12780000
      *                                                                 12790000
      ******************************************************************12800000
       8610-DISCONNECT-QMGR.                                            12810000
                                                                        12820000
           IF PV-CON-REASON IS NOT EQUAL                                12830000
                                   TO MQRC-ALREADY-CONNECTED            12840000
              CALL WS-MQDISC USING PV-HCONN                             12850000
                                   PV-COMPLETION-CODE                   12860000
                                   PV-REASON                            12870000
              IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                12880000
                  MOVE 'MQDISC'    TO PV-ERROR-MESSAGE                  12890000
                  MOVE '8610-DISCONNECT'                                12900000
                                   TO DP013-PARAGRAPH                   12910000
                  MOVE PV-ERROR-MESSAGE                                 12920000
                                   TO DP013-MESSAGE-TEXT (1)            12930000
                  MOVE PV-COMPLETION-CODE                               12940000
                                   TO DP013-MESSAGE-TEXT (2)            12950000
                  MOVE PV-REASON   TO DP013-MESSAGE-TEXT (3)            12960000
                  SET DP013-CICS-ABEND                                  12970000
                      DP013-NO-ROLLBACK                                 12980000
                                   TO TRUE                              12990000
                  PERFORM 9999-WRITE-CICS-LOG-MSG                       13000000
                  PERFORM 9100-EXEC-CICS-RETURN                         13010000
              END-IF                                                    13020000
           END-IF.                                                      13030000
                                                                        13040000
      *                                                                 13050000
      ******************************************************************13060000
      *    LINK TO THE MESSAGE FORMAT SUB-ROUTINE FOR NON-CICS          13070000
      *    ARCHITECTURE PROGRAMS.  THIS MESSAGE IS PASSED IN THE DATA   13080000
      *    STREAM BEING SENT BACK TO THE PTC.                           13090000
      ******************************************************************13100000
       9000-FMT-ERR-MSG-TO-PTC.                                         13110000
               PERFORM DP011-0000-FORMAT-MSG-LINES.                     13120000
               MOVE DP011-MSG-LEVEL                                     13130000
                                   TO  TF006-ERR-TYP-IND.               13140000
               MOVE DP011-MSG-TEXT TO  TF006-ERR-MSG.                   13150000
      *                                                                 13160000
       9100-EXEC-CICS-RETURN.                                           13170000
           EXEC CICS                                                    13180000
               RETURN                                                   13190000
           END-EXEC.                                                    13200000
      *                                                                 13210000
       9999-WRITE-CICS-LOG-MSG.                                         13220000
           MOVE PC-CURRENT-PROGRAM-NAME                                 13230000
                                   TO  DP013-PROGRAM.                   13240000
           MOVE DFHEIBLK           TO  DP013-DFHEIBLK.                  13250000
                                                                        13260000
           INITIALIZE DP013-SRC-TASK-NUMBER                             13270000
                      DP013-STACK.                                      13280000
                                                                        13290000
           SET DP013-LINK-RETURN   TO  TRUE.                            13300000
                                                                        13310000
           EXEC CICS                                                    13320000
               LINK                                                     13330000
                   PROGRAM   (DP013-NAME)                               13340000
                   COMMAREA  (DP013-PARAMETERS)                         13350000
                   LENGTH    (DP013-LENGTH)                             13360000
           END-EXEC.                                                    13370000
                                                                        13380000
      *                                                                 13390000
      *    NON-CICS ARCHITECTURE SYSTEM MESSAGE FORMAT MODULE           13400000
      *                                                                 13410000
                                                                        13420000
           COPY DPPD011.                                                13430000
      *                                                                 13440000
      *    NON-CICS ARCHITECTURE ABEND ROUTINE CALL                     13450000
      *                                                                 13460000
                                                                        13470000
           COPY DPPD014.                                                13480000
                                                                        13490000
           COPY EPPD000.                                                13500000
