000100***************************************************************** 00010004
000200 IDENTIFICATION DIVISION.                                         00020004
000300***************************************************************** 00030004
000400                                                                  00040004
000500 PROGRAM-ID.             TCKUT018.                                00050004
000600 AUTHOR.                 COGNIZANT.                               00060004
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070004
000800 DATE-WRITTEN            MARCH 2014.                              00080004
000900 DATE-COMPILED.                                                   00090004
001000                                                                  00100004
001100***************************************************************** 00110004
001200*  THIS PROGRAM CREATE TWO FIXED LENGTH FILE FROM AJB             00120027
001300*  RECONCILIATION FILE. ONE FILE WILL HOLD ALL KCC TRANSACTIONS   00130027
001400*  AND OTHER FILE WILL HOLD TC TRANSACTIONS.                      00140027
001500***************************************************************** 00150004
001600*  03/13/2014 COGNIZANT - INITAL IMPLEMENTATION.                 *00160027
001700******************************************************************00170027
001800 ENVIRONMENT DIVISION.                                            00180004
001900***************************************************************** 00190004
002000                                                                  00200004
002100 CONFIGURATION SECTION.                                           00210004
002200                                                                  00220004
002300 SOURCE-COMPUTER.        IBM-3090.                                00230004
002400                                                                  00240004
002500 OBJECT-COMPUTER.        IBM-3090.                                00250004
002600                                                                  00260004
002700 INPUT-OUTPUT SECTION.                                            00270004
002800                                                                  00280004
002900 FILE-CONTROL.                                                    00290004
003000                                                                  00300004
003100     SELECT AJB-RECON-FILE                                        00310004
003200         ASSIGN TO INP01.                                         00320004
003300                                                                  00330004
003400     SELECT KCC-TRAN-FILE                                         00340004
003500         ASSIGN TO OUT01.                                         00350004
003600                                                                  00360004
003700     SELECT TC-TRAN-FILE                                          00370027
003800         ASSIGN TO OUT02.                                         00380004
003900                                                                  00390004
004000******************************************************************00400004
004100 DATA DIVISION.                                                   00410004
004200******************************************************************00420004
004300                                                                  00430004
004400 FILE SECTION.                                                    00440004
004500                                                                  00450004
004600 FD  AJB-RECON-FILE                                               00460004
004700     RECORDING MODE IS V                                          00470004
004800     BLOCK CONTAINS 0 RECORDS                                     00480004
004900     LABEL RECORDS ARE STANDARD.                                  00490004
005000                                                                  00500004
005100 01  AJB-RECON-RECORD                 PIC X(5000).                00510035
005200                                                                  00520004
005300 FD  KCC-TRAN-FILE                                                00530004
005400     RECORDING MODE IS F                                          00540004
005500     LABEL RECORDS ARE STANDARD                                   00550004
005600     BLOCK CONTAINS 0 RECORDS                                     00560004
005700     RECORD CONTAINS 90 CHARACTERS.                               00570018
005800                                                                  00580004
005900 01  KCC-TRAN-RECORD                  PIC X(90).                  00590017
006000                                                                  00600004
006100 FD  TC-TRAN-FILE                                                 00610004
006200     RECORDING MODE IS F                                          00620004
006300     LABEL RECORDS ARE STANDARD                                   00630004
006400     BLOCK CONTAINS 0 RECORDS                                     00640004
006500     RECORD CONTAINS 90 CHARACTERS.                               00650018
006600                                                                  00660004
006700 01  TC-TRAN-RECORD                   PIC X(90).                  00670017
006800                                                                  00680004
006900******************************************************************00690004
007000 WORKING-STORAGE SECTION.                                         00700004
007100******************************************************************00710004
007200                                                                  00720004
007300 01  ABEND-CODE                       PIC S9(4)   VALUE ZERO      00730004
007400                                              COMP SYNC.          00740004
007500     88  AC-INVLD-DATA-ON-DATASET-ERROR           VALUE +4008.    00750004
007600     88  AC-DB2-ERROR                             VALUE +4013.    00760004
007700                                                                  00770004
007800 01  PS-PROGRAM-SWITCHES.                                         00780004
007900     05  PS-END-OF-INPUT-FILE-SW      PIC X(01)   VALUE 'N'.      00790004
008000         88  PS-END-OF-INPUT-FILE                 VALUE 'Y'.      00800004
008100         88  PS-NOT-END-OF-INPUT-FILE             VALUE 'N'.      00810017
008200                                                                  00820004
008300 01  PC-CONSTANTS.                                                00830004
008400     05  PC-CURRENT-PROGRAM-NAME      PIC  X(08)  VALUE           00840004
008500                                                 'TCKUT018'.      00850004
008600 01  PV-VARIBLES.                                                 00860004
008700     05  PV-AJB-RECON-REC             PIC  X(5000).               00870035
008800     05  PV-SLS-CORR-SEQ-NBR          PIC  X(5).                  00880021
008900     05  PV-INPUT-REC-CNT             PIC  9(11)  VALUE 0 COMP-3. 00890026
008900     05  PV-EMP-DISC-CNT              PIC  9(11)  VALUE 0 COMP-3. 00891032
009000     05  PV-KCC-TRN-REC-CNT           PIC  9(11)  VALUE 0 COMP-3. 00900026
009100     05  PV-TC-TRN-REC-CNT            PIC  9(11)  VALUE 0 COMP-3. 00910026
009200     05  PV-TRAN-AMT                  PIC  9(9) COMP.             00920026
009300     05  PV-TRAN-AMT1                 PIC  9(7)V99 COMP-3.        00930026
009400     05  PV-TRN-DTE.                                              00940022
009500         10  PV-TRN-DTE-YYYY          PIC  X(04).                 00950022
009600         10  FILLER                   PIC  X(01)  VALUE '-'.      00960026
009700         10  PV-TRN-DTE-MM            PIC  X(02).                 00970022
009800         10  FILLER                   PIC  X(01)  VALUE '-'.      00980026
009900         10  PV-TRN-DTE-DD            PIC  X(02).                 00990022
010000                                                                  01000022
010100 01  PV-FIELD-EXTRACT.                                            01010017
010200     05  PV-FIELD-EXTRACT-1           PIC  X(20).                 01020012
010300     05  PV-FIELD-EXTRACT-2           PIC  X(10).                 01030012
010400     05  PV-FIELD-EXTRACT-3           PIC  X(10).                 01040012
010500     05  PV-FIELD-EXTRACT-4           PIC  X(01).                 01050012
010600     05  PV-FIELD-EXTRACT-5           PIC  X(05).                 01060012
010700     05  PV-FIELD-EXTRACT-6           PIC  X(15).                 01070012
010800     05  PV-FIELD-EXTRACT-7           PIC  X(05).                 01080012
010900     05  PV-FIELD-EXTRACT-8           PIC  X(05).                 01090012
011000     05  PV-FIELD-EXTRACT-9           PIC  X(10).                 01100012
011100     05  PV-FIELD-EXTRACT-11          PIC  X(10).                 01110012
011200     05  PV-FIELD-EXTRACT-12          PIC  X(10).                 01120012
011300     05  PV-FIELD-EXTRACT-13          PIC  X(35).                 01130012
011400     05  PV-FIELD-EXTRACT-14          PIC  X(05).                 01140012
011500     05  PV-FIELD-EXTRACT-15          PIC  X(40).                 01150012
011600     05  PV-FIELD-EXTRACT-16          PIC  9(09).                 01160025
011700     05  PV-FIELD-EXTRACT-17          PIC  X(25).                 01170017
011800     05  PV-FIELD-EXTRACT-18          PIC  X(10).                 01180017
011900     05  PV-FIELD-EXTRACT-19          PIC  X(10).                 01190017
012000     05  PV-FIELD-EXTRACT-20          PIC  X(10).                 01200017
012100     05  PV-FIELD-EXTRACT-21          PIC  X(120).                01210017
012200     05  PV-FIELD-EXTRACT-22          PIC  X(10).                 01220017
012300     05  PV-FIELD-EXTRACT-23          PIC  X(10).                 01230017
012400     05  PV-FIELD-EXTRACT-24          PIC  X(10).                 01240017
012500     05  PV-FIELD-EXTRACT-25          PIC  X(10).                 01250017
012600     05  PV-FIELD-EXTRACT-26          PIC  X(10).                 01260017
012700     05  PV-FIELD-EXTRACT-27          PIC  X(01).                 01270017
012800     05  PV-FIELD-EXTRACT-28          PIC  X(10).                 01280017
012900     05  PV-FIELD-EXTRACT-29          PIC  X(10).                 01290017
013000     05  PV-FIELD-EXTRACT-30          PIC  X(10).                 01300017
013100     05  PV-FIELD-EXTRACT-31          PIC  X(05).                 01310017
013200     05  PV-FIELD-EXTRACT-32          PIC  X(20).                 01320017
013300     05  PV-FIELD-EXTRACT-33          PIC  X(10).                 01330017
013400     05  PV-FIELD-EXTRACT-34          PIC  X(60).                 01340017
013500     05  PV-FIELD-EXTRACT-35          PIC  X(10).                 01350017
013600     05  PV-FIELD-EXTRACT-36          PIC  X(10).                 01360017
013700     05  PV-FIELD-EXTRACT-38          PIC  X(10).                 01370017
013800     05  PV-FIELD-EXTRACT-39          PIC  X(10).                 01380017
013900     05  PV-FIELD-EXTRACT-40          PIC  X(10).                 01390017
014000     05  PV-FIELD-EXTRACT-41          PIC  X(10).                 01400017
014100     05  PV-FIELD-EXTRACT-42          PIC  X(10).                 01410017
014200     05  PV-FIELD-EXTRACT-43          PIC  X(100).                01420017
014300     05  PV-FIELD-EXTRACT-44          PIC  X(100).                01430017
014400     05  PV-FIELD-EXTRACT-45          PIC  X(10).                 01440017
014500     05  PV-FIELD-EXTRACT-46          PIC  X(10).                 01450017
014600     05  PV-FIELD-EXTRACT-47          PIC  X(10).                 01460017
014700     05  PV-FIELD-EXTRACT-48          PIC  X(10).                 01470017
014800     05  PV-FIELD-EXTRACT-49          PIC  X(10).                 01480017
014900     05  PV-FIELD-EXTRACT-50.                                     01490017
015000         10  PV-FIELD-EXT-50-MM       PIC  X(02).                 01500017
015100         10  PV-FIELD-EXT-50-DD       PIC  X(02).                 01510017
015200         10  PV-FIELD-EXT-50-YYYY     PIC  X(04).                 01520017
015300                                                                  01530004
015400***************************************************************** 01540004
015500*  KCC AND TC TRANSACTION OUTPUT FILES LAYOUT                     01550017
015600******************************************************************01560004
015700     COPY TCRD022.                                                01570017
015800                                                                  01580004
015900 PROCEDURE DIVISION.                                              01590004
016000                                                                  01600004
016100******************************************************************01610004
016200* 0000-MAINLINE-PARAGRAPH                                         01620004
016300******************************************************************01630004
016400 0000-MAINLINE-PARAGRAPH.                                         01640004
016500                                                                  01650004
016600     PERFORM 1000-INITIALIZE-PROGRAM.                             01660004
016700                                                                  01670004
016800     PERFORM 2000-PROCESS-FILE                                    01680004
016900         UNTIL  PS-END-OF-INPUT-FILE.                             01690017
017000                                                                  01700004
017100     PERFORM 9000-EOJ-ROUTINE.                                    01710005
017200                                                                  01720004
017300     GOBACK.                                                      01730004
017400                                                                  01740004
017500******************************************************************01750004
017600* 1000-INITIALIZE-PROGRAM                                         01760004
017700******************************************************************01770004
017800 1000-INITIALIZE-PROGRAM.                                         01780004
017900                                                                  01790004
018000     OPEN INPUT  AJB-RECON-FILE                                   01800004
018100          OUTPUT KCC-TRAN-FILE                                    01810004
018200                 TC-TRAN-FILE.                                    01820004
018300                                                                  01830004
018400     PERFORM 2100-READ-INPUT-FILE.                                01840029
018500                                                                  01850004
018600******************************************************************01860004
018700* 2000-PROCESS-FILE                                               01870004
018800*     PROCESS THE INPUT FILE CSV RECORD AND CREATE FIXED LENGTH   01880004
018900*     FILES.                                                      01890017
019000******************************************************************01900004
019100 2000-PROCESS-FILE.                                               01910004
019200                                                                  01920004
019300       INITIALIZE  PV-FIELD-EXTRACT                               01930017
019400                   TC022-RECON-RECORD.                            01940017
019500                                                                  01950005
019600       UNSTRING PV-AJB-RECON-REC DELIMITED BY ','                 01960004
019700         INTO PV-FIELD-EXTRACT-1                                  01970005
019800              PV-FIELD-EXTRACT-2                                  01980005
019900              PV-FIELD-EXTRACT-3                                  01990005
020000              PV-FIELD-EXTRACT-4                                  02000005
020100              PV-FIELD-EXTRACT-5                                  02010005
020200              PV-FIELD-EXTRACT-6                                  02020005
020300              PV-FIELD-EXTRACT-7                                  02030005
020400              PV-FIELD-EXTRACT-8                                  02040005
020500              PV-FIELD-EXTRACT-9                                  02050005
020600              TC022-TRANSACTN-TYPE                                02060017
020700              PV-FIELD-EXTRACT-11                                 02070005
020800              PV-FIELD-EXTRACT-12                                 02080005
020900              PV-FIELD-EXTRACT-13                                 02090005
021000              PV-FIELD-EXTRACT-14                                 02100005
021100              PV-FIELD-EXTRACT-15                                 02110005
021200              PV-FIELD-EXTRACT-16                                 02120005
021300              PV-FIELD-EXTRACT-17                                 02130005
021400              PV-FIELD-EXTRACT-18                                 02140005
021500              PV-FIELD-EXTRACT-19                                 02150005
021600              PV-FIELD-EXTRACT-20                                 02160005
021700              PV-FIELD-EXTRACT-21                                 02170005
021800              PV-FIELD-EXTRACT-22                                 02180005
021900              PV-FIELD-EXTRACT-23                                 02190005
022000              PV-FIELD-EXTRACT-24                                 02200005
022100              PV-FIELD-EXTRACT-25                                 02210005
022200              PV-FIELD-EXTRACT-26                                 02220005
022300              PV-FIELD-EXTRACT-27                                 02230005
022400              PV-FIELD-EXTRACT-28                                 02240005
022500              PV-FIELD-EXTRACT-29                                 02250005
022600              PV-FIELD-EXTRACT-30                                 02260005
022700              PV-FIELD-EXTRACT-31                                 02270005
022800              PV-FIELD-EXTRACT-32                                 02280005
022900              PV-FIELD-EXTRACT-33                                 02290005
023000              PV-FIELD-EXTRACT-34                                 02300005
023100              PV-FIELD-EXTRACT-35                                 02310005
023200              PV-FIELD-EXTRACT-36                                 02320005
023300              TC022-AUTH-CDE                                      02330017
023400              PV-FIELD-EXTRACT-38                                 02340005
023500              PV-FIELD-EXTRACT-39                                 02350005
023600              PV-FIELD-EXTRACT-40                                 02360005
023700              PV-FIELD-EXTRACT-41                                 02370005
023800              PV-FIELD-EXTRACT-42                                 02380005
023900              PV-FIELD-EXTRACT-43                                 02390005
024000              PV-FIELD-EXTRACT-44                                 02400005
024100              PV-FIELD-EXTRACT-45                                 02410005
024200              PV-FIELD-EXTRACT-46                                 02420005
024300              PV-FIELD-EXTRACT-47                                 02430005
024400              PV-FIELD-EXTRACT-48                                 02440005
024500              PV-FIELD-EXTRACT-49                                 02450005
024600              PV-FIELD-EXTRACT-50                                 02460017
024700       END-UNSTRING.                                              02470017
024800                                                                  02480004
024900       MOVE PV-FIELD-EXTRACT-16    TO PV-TRAN-AMT.                02490026
025000       COMPUTE PV-TRAN-AMT1 = PV-TRAN-AMT / 100.                  02500026
025100       MOVE PV-TRAN-AMT1           TO TC022-TRANS-AMT.            02510026
025200                                                                  02520024
025300       MOVE PV-FIELD-EXT-50-YYYY   TO PV-TRN-DTE-YYYY.            02530026
025400       MOVE PV-FIELD-EXT-50-MM     TO PV-TRN-DTE-MM.              02540026
025500       MOVE PV-FIELD-EXT-50-DD     TO PV-TRN-DTE-DD.              02550026
025600       MOVE PV-TRN-DTE             TO TC022-TRAN-DATE.            02560026
025700                                                                  02570005
025800* FIELD 34 WILL HAVE ALL KEY FIELDS SEPERATED BY *                02580031
025900                                                                  02590031
026000       UNSTRING PV-FIELD-EXTRACT-34 DELIMITED BY '*' OR SPACE     02600016
026100          INTO TC022-PARTITION-NBR                                02610005
026200               TC022-SLS-DATE                                     02620005
026300               TC022-ORIG-STR-NBR                                 02630005
026400               TC022-RGST-ID                                      02640005
026500               TC022-TRN-NBR                                      02650005
026600               TC022-STRT-TM                                      02660005
026700               PV-SLS-CORR-SEQ-NBR                                02670021
026800               TC022-TNDR-SEQ-NBR                                 02680006
026900               TC022-TNDR-TYP-CDE                                 02690006
027000               TC022-TRANS-TYPE                                   02700017
027100       END-UNSTRING.                                              02710017
027200                                                                  02720005
027300       MOVE PV-SLS-CORR-SEQ-NBR    TO TC022-SLS-CORR-SEQ-NBR.     02730026
027400       IF PV-SLS-CORR-SEQ-NBR(1:1) = '-'                          02740021
027500          COMPUTE TC022-SLS-CORR-SEQ-NBR =                        02750021
027600                  TC022-SLS-CORR-SEQ-NBR * -1                     02760021
027700       END-IF.                                                    02770021
027800                                                                  02780021
027900       IF TC022-TRANS-TYPE = 8155 OR 8165                         02790017
028000          ADD 1            TO   PV-EMP-DISC-CNT                   02800032
028100       ELSE                                                       02810017
028200          IF TC022-TNDR-TYP-CDE = 05 OR 06 OR 07 OR 08            02820017
028300             PERFORM  3000-WRITE-TC-TRAN-FILE                     02830029
028400          ELSE                                                    02840017
028500             PERFORM  4000-WRITE-KCC-TRAN-FILE                    02850029
028600          END-IF                                                  02860017
028700       END-IF.                                                    02870017
028800                                                                  02880005
028900     PERFORM 2100-READ-INPUT-FILE.                                02890029
029000                                                                  02900004
029100******************************************************************02910031
029200* 2100-READ-INPUT-FILE                                            02920030
029300*     READ THE AJB RECONCILIATION FILE                            02930030
029400******************************************************************02940030
029500 2100-READ-INPUT-FILE.                                            02950030
029600                                                                  02960030
029700     READ AJB-RECON-FILE INTO PV-AJB-RECON-REC                    02970030
029800        AT END                                                    02980030
029900           SET PS-END-OF-INPUT-FILE TO TRUE                       02990030
030000     END-READ.                                                    03000030
030100                                                                  03010030
030200     IF PS-NOT-END-OF-INPUT-FILE                                  03020030
030300        ADD +1 TO PV-INPUT-REC-CNT                                03030030
030400     END-IF.                                                      03040030
030500                                                                  03050030
030600******************************************************************03060004
030700* 3000-WRITE-TC-TRAN-FILE                                         03070029
030800*     WRITE TC TRANSACTION FILE FROM COPYBOOK TCRD022             03080017
030900******************************************************************03090004
031000 3000-WRITE-TC-TRAN-FILE.                                         03100029
031100                                                                  03110004
031200     WRITE TC-TRAN-RECORD FROM TC022-RECON-RECORD.                03120007
031300     ADD  +1  TO  PV-TC-TRN-REC-CNT.                              03130017
031400                                                                  03140004
031500******************************************************************03150005
031600* 4000-WRITE-KCC-TRAN-FILE                                        03160029
031700*     WRITE KCC TRANSACTION FILE FROM COPYBOOK TCRD022            03170017
031800******************************************************************03180005
031900 4000-WRITE-KCC-TRAN-FILE.                                        03190029
032000                                                                  03200005
032100     WRITE KCC-TRAN-RECORD  FROM TC022-RECON-RECORD.              03210007
032200     ADD  +1  TO  PV-KCC-TRN-REC-CNT.                             03220017
032300                                                                  03230005
032400******************************************************************03240005
032500*  CLOSE ALL FILES AND DISPLAY PROCESSING COUNTS.                *03250005
032600******************************************************************03260005
032700                                                                  03270005
032800 9000-EOJ-ROUTINE.                                                03280005
032900                                                                  03290005
033000     CLOSE   AJB-RECON-FILE                                       03300005
033100             KCC-TRAN-FILE                                        03310005
033200             TC-TRAN-FILE.                                        03320005
033300                                                                  03330005
033400     DISPLAY 'PROGRAM ' PC-CURRENT-PROGRAM-NAME.                  03340005
033500     DISPLAY 'RECORDS READ ' PV-INPUT-REC-CNT.                    03350005
033600     DISPLAY 'RECORDS WRITTEN IN KCC FILE '                       03360005
033700             PV-KCC-TRN-REC-CNT.                                  03370005
033800     DISPLAY 'RECORDS WRITTEN IN TC FILE '                        03380005
033900             PV-TC-TRN-REC-CNT.                                   03390005
033800     DISPLAY 'EMPLOYEE DISCOUNT RECORDS SKIPPED '                 03391032
033900             PV-EMP-DISC-CNT.                                     03392032
034000                                                                  03400005
034100                                                                  03410005
