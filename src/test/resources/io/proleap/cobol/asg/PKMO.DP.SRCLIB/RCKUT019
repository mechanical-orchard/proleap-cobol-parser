000100******************************************************************00010027
000200 IDENTIFICATION DIVISION.                                         00020019
000300******************************************************************00030006
000400                                                                  00040019
000500 PROGRAM-ID.             RCKUT019.                                00050019
000600 AUTHOR.                 BETH A. BILSKI.                          00060019
000700 INSTALLATION.           KOHLS.                                   00070019
000800 DATE-WRITTEN            OCTOBER 1994.                            00080019
000900 DATE-COMPILED.                                                   00090019
001000                                                                  00100019
001100******************************************************************00110019
001200*   THE PURPOSE OF THIS PROGRAM IS TO READ THE DAILY UNLOAD FILE  00120019
001300*   FROM THE TSTREXT TABLE AND CREATE THE KEYREC AND STORE FILES. 00130019
001400******************************************************************00140019
001500 ENVIRONMENT DIVISION.                                            00150019
001600                                                                  00160019
001700 CONFIGURATION SECTION.                                           00170019
001800                                                                  00180019
001900 SOURCE-COMPUTER.        IBM-3090.                                00190019
002000 OBJECT-COMPUTER.        IBM-3090.                                00200019
002100                                                                  00210019
002200 INPUT-OUTPUT SECTION.                                            00220019
002300                                                                  00230019
002400 FILE-CONTROL.                                                    00240019
002500                                                                  00250019
002600     SELECT TSTREXT-FILE                                          00260019
002700         ASSIGN TO INP01.                                         00270019
002800                                                                  00280019
002900     SELECT STORE-FILE                                            00290019
003000         ASSIGN TO OUT01.                                         00300019
003100                                                                  00310019
003200*    SELECT RPT-FILE                                              00320019
003300*        ASSIGN TO OUT02.                                         00330019
003400                                                                  00340019
003500******    WR # 27201 - START                                      00350066
003600     SELECT VRFD-FILE                                             00360066
003700         ASSIGN TO OUT03.                                         00370066
003800******    WR # 27201 - END                                        00380066
003900******************************************************************00390019
004000 DATA DIVISION.                                                   00400019
004100******************************************************************00410019
004200                                                                  00420019
004300 FILE SECTION.                                                    00430019
004400                                                                  00440036
004500 FD  TSTREXT-FILE                                                 00450019
004600     RECORDING MODE IS F                                          00460019
004700     BLOCK CONTAINS 0 RECORDS                                     00470019
004800     LABEL RECORDS ARE STANDARD.                                  00480019
004900                                                                  00490019
005000 01  TSTREXT-RECORD                          PIC X(189).          00500035
005100                                                                  00510019
005200 FD  STORE-FILE                                                   00520019
005300     RECORDING MODE IS F                                          00530019
005400     BLOCK CONTAINS 0 RECORDS                                     00540019
005500     LABEL RECORDS ARE STANDARD.                                  00550019
005600                                                                  00560019
005700 01  STORE-RECORD                            PIC X(300).          00570070
005800                                                                  00580019
005900*FD  RPT-FILE                                                     00590019
006000*    RECORDING MODE IS F                                          00600019
006100*    BLOCK CONTAINS 0 RECORDS                                     00610019
006200*    LABEL RECORDS ARE STANDARD.                                  00620019
006300*                                                                 00630019
006400*01  RPT-RECORD                              PIC X(100).          00640019
006500                                                                  00650019
006600******    WR # 27201 - START                                      00660066
006700 FD  VRFD-FILE                                                    00670066
006800     RECORDING MODE IS F                                          00680066
006900     BLOCK CONTAINS 0 RECORDS                                     00690066
007000     LABEL RECORDS ARE STANDARD.                                  00700066
007100                                                                  00710066
007200 01  VRFD-RECORD                             PIC X(100).          00720080
007300                                                                  00730066
007400******    WR # 27201 - END                                        00740066
007500******************************************************************00750019
007600 WORKING-STORAGE SECTION.                                         00760019
007700******************************************************************00770019
007800                                                                  00780019
007900 01  ABEND-CODE                          PIC S9(04)  VALUE +0     00790019
008000                                                     COMP SYNC.   00800019
008100     COPY STOREEXT.                                               00810019
008200/                                                                 00820019
008300     COPY RCRD009.                                                00830027
008400/                                                                 00840019
008500     COPY RCRD018.                                                00850027
008600/                                                                 00860019
008700******    WR # 27201 - START                                      00870064
008800     COPY RCRD073.                                                00880066
008900******    WR # 27201 - END                                        00890064
009000/                                                                 00900064
009100******************************************************************00910055
009200* COPYBOOK XLWS001 INCLUDED                  *** WR # 21361      *00920055
009300******************************************************************00930055
009400     COPY XLWS001.                                                00940055
009500******************************************************************00950055
009600* CHANGES MADE FOR WR # 21361 ENDS HERE                          *00960055
009700******************************************************************00970055
009800                                                                  00980055
009900 01  PC-PROGRAM-CONSTANTS.                                        00990055
010000     05  PC-MAX-RETRIES                  PIC S9(04)  VALUE +3     01000055
010100                                                     COMP SYNC.   01010055
010200     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        01020055
010300                                                     'RCKUT019'.  01030055
010400******************************************************************01040055
010500* INCLUDED PROGRAM CONSTANTS PC-000 AND PC-999.      WR # 21361  *01050055
010600******************************************************************01060055
010700     05  PC-000                          PIC X(03) VALUE '000'.   01070055
010800     05  PC-999                          PIC X(03) VALUE '999'.   01080055
010900******************************************************************01090055
011000* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *01100055
011100******************************************************************01110055
011200                                                                  01120055
011300******************************************************************01130055
011400* INCLUDED PROGRAM VARIABLE PV-SN-SEQ-NBR            WR # 21361  *01140055
011500******************************************************************01150055
011600 01  PV-PROGRAM-VARIABLES.                                        01160055
011700     05  PV-STYLE.                                                01170055
011800         10  PV-ZERO1                    PIC X(01)   VALUE ZEROES.01180055
011900         10  PV-SKU-SEQ-NBR              PIC X(03)   VALUE SPACES.01190055
012000         10  PV-ZERO2                    PIC X(01)   VALUE ZEROES.01200055
012100                                                                  01210055
012200     05  PV-PO-NBR                       PIC  9(08)  VALUE ZEROES.01220055
012300     05  PV-SN-SEQ-NBR                   PIC  X(08)  VALUE SPACES.01230055
012400     05  PV-PREV-SE-PO                   PIC  9(08)  VALUE ZEROS. 01240056
012500     05  PV-PREV-SE-REC-SEQ-NBR          PIC  9(09)  VALUE ZEROS. 01250056
012600                                                                  01260056
012700     05  PV-PARAGRAPH-NAME               PIC  X(30)  VALUE SPACES.01270055
012800     05  PV-DB2-OPERATION-MESSAGE-1      PIC  X(79)  VALUE SPACES.01280055
012900     05  PV-DB2-OPERATION-MESSAGE-2      PIC  X(79)  VALUE SPACES.01290055
013000     05  PV-DB2-OPERATION-MESSAGE-3      PIC  X(79)  VALUE SPACES.01300055
013100     05  PV-DB2-OPERATION-MESSAGE-4      PIC  X(79)  VALUE SPACES.01310055
013200     05  PV-DB2-TABLE-NAME-1             PIC  X(18)  VALUE SPACES.01320055
013300     05  PV-DB2-TABLE-NAME-2             PIC  X(18)  VALUE SPACES.01330055
013400     05  PV-DB2-TABLE-NAME-3             PIC  X(18)  VALUE SPACES.01340055
013500     05  PV-ERROR-MESSAGE-1              PIC  X(60)  VALUE SPACES.01350055
013600     05  PV-ERROR-MESSAGE-2              PIC  X(60)  VALUE SPACES.01360055
013700     05  PV-ERROR-MESSAGE-3              PIC  X(60)  VALUE SPACES.01370055
013800     05  PV-DISP-NBR                     PIC  ZZZ,ZZZ,ZZ9.        01380056
013900     05  PV-REC-TYP-CDE                  PIC  X(02)  VALUE SPACES.01390056
014000     05  PV-MAJ-CLASS.                                            01400059
014100         10  PV-MAJ-CLASS-POS-1-2        PIC  9(02)  VALUE ZEROS. 01410061
014200         10  PV-MAJ-CLASS-POS-3          PIC  9(01)  VALUE ZEROS. 01420061
014300     05  PV-DEPT                         PIC  9(03)  VALUE ZEROS. 01430059
014400     05  PV-RC009-DEPT                   PIC  9(03)  VALUE ZEROS. 01440062
014500******    WR # 27201 - START                                      01450064
014600     05 PV-VRFD-UNT-AMT          PIC S9(7)V9(2) COMP-3 VALUE ZERO.01460075
014700     05 PV-VRFD-GP-QTY           PIC S9(9) COMP        VALUE ZERO.01470075
014800     05 PV-VRFD-GP-AMT           PIC S9(7)V9(2) COMP-3 VALUE ZERO.01480099
014900     05 PV-VRFD-LWST-UNT-AMT     PIC S9(7)V9(2) COMP-3 VALUE ZERO.01490075
015000     05 PV-AMT                   PIC S9(7)V9(2) COMP-3 VALUE ZERO.01500099
015100     05 PV-DATE-VERIFIED              PIC X(26) VALUE SPACE.      01510098
015200     05 FILLER REDEFINES PV-DATE-VERIFIED.                        01520098
015300         10  PV-DATE-VERIFIED-CC      PIC 99.                     01530098
015400         10  PV-DATE-VERIFIED-YY      PIC 99.                     01540098
015500         10  PV-DATE-VERIFIED-1ST     PIC X.                      01550098
015600         10  PV-DATE-VERIFIED-MM      PIC 99.                     01560098
015700         10  PV-DATE-VERIFIED-2ND     PIC X.                      01570098
015800         10  PV-DATE-VERIFIED-DD      PIC 99.                     01580098
015900         10  PV-DATE-VERIFIED-3RD     PIC X.                      01590098
016000         10  PV-DATE-TIMESTAMP        PIC X(15).                  01600098
016100******    WR # 27201 - END                                        01610064
016200                                                                  01620055
016300 01  DK-DATABASE-KEYS.                                            01630056
016400     05  DK-PO-NBR                       PIC S9(09)  COMP.        01640056
016500     05  DK-ORD-NBR                      PIC S9(09)  COMP.        01650056
016600     05  DK-REC-SEQ-NBR                  PIC S9(09)  COMP.        01660056
016700                                                                  01670056
016800 01  PV-COUNTERS.                                                 01680055
016900     05  PV-INP01-COUNT               PIC S9(9) COMP-3 VALUE ZERO.01690055
017000     05  PV-OUT01-COUNT               PIC S9(9) COMP-3 VALUE ZERO.01700055
017100     05  PV-OUT02-COUNT               PIC S9(9) COMP-3 VALUE ZERO.01710055
017200******    WR # 27201 - START                                      01720064
017300     05  PV-VRFD-COUNT                PIC S9(9) COMP-3 VALUE ZERO.01730064
017400******    WR # 27201 - END                                        01740064
017500                                                                  01750055
017600 01  PV-CONTROL-VARIABLES.                                        01760055
017700     05  PV-CURR-KEY.                                             01770055
017800         10  PV-CURR-PO-NBR           PIC 9(09) VALUE ZERO.       01780055
017900         10  PV-CURR-LNE-NBR          PIC 9(09) VALUE ZERO.       01790055
018000         10  PV-CURR-REC-SEQ-NBR      PIC 9(09) VALUE ZERO.       01800055
018100     05  PV-PREV-KEY.                                             01810055
018200         10  PV-PREV-PO-NBR           PIC 9(09) VALUE ZERO.       01820055
018300         10  PV-PREV-LNE-NBR          PIC 9(09) VALUE ZERO.       01830055
018400         10  PV-PREV-REC-SEQ-NBR      PIC 9(09) VALUE ZERO.       01840055
018500******************************************************************01850055
018600* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *01860055
018700******************************************************************01870055
018800                                                                  01880055
018900 01  PROGRAM-SWITCHES.                                            01890055
019000     05  END-OF-INPUT-SW                 PIC X(01)   VALUE 'N'.   01900055
019100         88  END-OF-INPUT                            VALUE 'Y'.   01910055
019200******    WR # 27201 - START                                      01920098
019300     05  PS-VRFD-DTE-PRICE-FOUND-SW      PIC X(01)   VALUE 'N'.   01930098
019400         88  PS-VRFD-DTE-PRICE-FOUND                 VALUE 'Y'.   01940098
019500         88  PS-NO-VRFD-DTE-PRICE-FOUND              VALUE 'N'.   01950098
019600     05  PS-EOF-TUPCPLS-RCVR-CSR-SW      PIC  X(01)  VALUE 'N'.   01960098
019700         88  PS-EOF-TUPCPLS-RCVR-CSR                 VALUE 'Y'.   01970098
019800         88  PS-NOT-EOF-TUPCPLS-RCVR-CSR             VALUE 'N'.   01980098
019900     05  PS-GROUP-PRICE-FOUND-SW         PIC X(01)   VALUE 'N'.   01990098
020000         88  PS-GROUP-PRICE-FOUND                    VALUE 'Y'.   02000098
020100         88  PS-NO-GROUP-PRICE-FOUND                 VALUE 'N'.   02010098
020200******    WR # 27201 - END                                        02020098
020210     05  PS-VALID-ITEM-SW                PIC X(01)   VALUE SPACE. 02021099
020220         88  PS-NO-VALID-ITEM-FOUND                  VALUE 'N'.   02022099
020230         88  PS-VALID-ITEM-FOUND                     VALUE 'Y'.   02023099
020300                                                                  02030055
020400******************************************************************02040055
020500*  DB2 FORMATTED MESSAGE AREA                                     02050055
020600******************************************************************02060055
020700     COPY DPWS004.                                                02070055
020800                                                                  02080055
020900******************************************************************02090055
021000*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE PURCHASING TABLE   02100055
021100******************************************************************02110055
021200     EXEC SQL                                                     02120055
021300          INCLUDE TPURCHS                                         02130055
021400     END-EXEC.                                                    02140055
021500                                                                  02150055
021600******************************************************************02160056
021700*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE RECEIVER TABLE     02170056
021800******************************************************************02180056
021900     EXEC SQL                                                     02190056
022000          INCLUDE TRECEIV                                         02200056
022100     END-EXEC.                                                    02210056
022200                                                                  02220056
022300******************************************************************02230055
022400*  COMMUNICATIONS AREA FOR DB2                                    02240055
022500******************************************************************02250055
022600     EXEC SQL                                                     02260055
022700          INCLUDE SQLCA                                           02270055
022800     END-EXEC.                                                    02280055
022900*                                                                 02290055
023000******************************************************************02300055
023100*   TPURITM DCLGEN INCLUDED                      ** WR # 21361   *02310055
023200******************************************************************02320055
023300     EXEC SQL                                                     02330055
023400          INCLUDE TPURITM                                         02340055
023500     END-EXEC.                                                    02350055
023600                                                                  02360055
023700******************************************************************02370055
023800*   TRECITM DCLGEN INCLUDED                      ** WR # 21361   *02380055
023900******************************************************************02390055
024000     EXEC SQL                                                     02400055
024100          INCLUDE TRECITM                                         02410055
024200     END-EXEC.                                                    02420055
024300                                                                  02430055
024400******************************************************************02440055
024500*   CHANGES FOR WR # 21361 ENDS HERE                             *02450055
024600******************************************************************02460055
024700******    WR # 27201 - START                                      02470097
024800******************************************************************02480098
024900*   DB2 DCLGEN FOR UPC PRICING TABLE                              02490098
025000******************************************************************02500098
025100     EXEC SQL                                                     02510098
025200          INCLUDE TUPCPLS                                         02520098
025300     END-EXEC.                                                    02530098
025400                                                                  02540098
025500******************************************************************02550098
025600*   DB2 DCLGEN FOR ITEM GROUP PRICING TABLE                       02560098
025700******************************************************************02570098
025800     EXEC SQL                                                     02580098
025900          INCLUDE TMITGPL                                         02590098
026000     END-EXEC.                                                    02600098
026100                                                                  02610098
026200******************************************************************02620097
026300*  CURSOR AGAINST TUPCPLS AND TRECITM USING RECEIVER AND LINE     02630097
026400******************************************************************02640097
026500                                                                  02650097
026600     EXEC SQL                                                     02660097
026700        DECLARE TUPCPLS-RCVR-CSR CURSOR FOR                       02670097
026800         SELECT  A.UNT_RTL_AMT                                    02680097
026900               , A.EFF_END_TMST                                   02690097
027000               , A.MEITGP_NBR                                     02700097
027100           FROM  TUPCPLS A                                        02710097
027200              ,  TRECITM B                                        02720097
027300          WHERE  B.ORD_NBR     = :PURITM-PO-NBR                   02730099
027400            AND  B.REC_SEQ_NBR = :RECITM-REC-SEQ-NBR              02740099
027500            AND  B.ORD_LNE_NBR = :PURITM-APP-PO-LNE-NBR           02750099
027600            AND  DATE(A.EFF_BEG_TMST) <= :PV-DATE-VERIFIED        02760097
027700            AND (DATE(A.EFF_END_TMST) >= :PV-DATE-VERIFIED        02770097
027800            OR   A.EFF_END_TMST IS NULL)                          02780097
027900            AND  A.ITM_NBR = B.ITM_NBR                            02790097
028000            AND  A.STR_NBR = 0                                    02800097
028100            AND  A.OPERCO_NBR    = '03'                           02810097
028200          ORDER BY A.EFF_END_TMST DESC                            02820097
028300     END-EXEC.                                                    02830097
028400******    WR # 27201 - END                                        02840097
028500*                                                                 02850055
028600 PROCEDURE DIVISION.                                              02860055
028700                                                                  02870055
028800******************************************************************02880055
028900*  0000-INITIAL-ROUTINE  -  MAIN LINE OF THE PROGRAM PERFORMS THE 02890055
029000*  INITIALIZATION ROUTINE AND CONTROLS THE PROCESSING OF THE PGM. 02900055
029100******************************************************************02910055
029200                                                                  02920055
029300 0000-MAINLINE.                                                   02930055
029400                                                                  02940055
029500     PERFORM 0100-HOUSEKEEPING.                                   02950055
029600                                                                  02960055
029700     PERFORM 8000-READ-TSTREXT-FILE                               02970055
029800                                                                  02980055
029900     PERFORM 1000-PROCESS-INPUT-RECORDS                           02990055
030000         UNTIL END-OF-INPUT.                                      03000055
030100                                                                  03010055
030200     CLOSE TSTREXT-FILE                                           03020055
030300*          RPT-FILE                                               03030055
030400           STORE-FILE                                             03040073
030500******    WR # 27201 - START                                      03050073
030600           VRFD-FILE.                                             03060073
030700******    WR # 27201 - END                                        03070073
030800                                                                  03080055
030900     DISPLAY SPACES                                               03090055
031000     MOVE PV-INP01-COUNT              TO PV-DISP-NBR              03100055
031100     DISPLAY 'INP01 RECS READ     = ' PV-DISP-NBR.                03110055
031200     MOVE PV-OUT01-COUNT              TO PV-DISP-NBR              03120055
031300     DISPLAY 'OUT01 RECS WRITTEN  = ' PV-DISP-NBR.                03130055
031400     MOVE PV-OUT02-COUNT              TO PV-DISP-NBR              03140055
031500     DISPLAY 'OUT02 RECS WRITTEN  = ' PV-DISP-NBR.                03150055
031600******    WR # 27201 - START                                      03160064
031700     MOVE PV-VRFD-COUNT               TO PV-DISP-NBR              03170064
031800     DISPLAY 'VRFD RECS WRITTEN   = ' PV-DISP-NBR.                03180064
031900******    WR # 27201 - END                                        03190064
032000                                                                  03200055
032100                                                                  03210055
032200     STOP RUN.                                                    03220055
032300/                                                                 03230055
032400 0100-HOUSEKEEPING.                                               03240055
032500                                                                  03250055
032600     OPEN INPUT  TSTREXT-FILE                                     03260055
032700*         OUTPUT RPT-FILE                                         03270055
032800          OUTPUT STORE-FILE                                       03280073
032900******    WR # 27201 - START                                      03290073
033000          OUTPUT VRFD-FILE.                                       03300073
033100******    WR # 27201 - END                                        03310073
033200                                                                  03320055
033300     INITIALIZE PV-CURR-KEY                                       03330055
033400                PV-PREV-KEY.                                      03340055
033500/                                                                 03350055
033600 1000-PROCESS-INPUT-RECORDS.                                      03360055
033700     MOVE '*1000-PROCESS-INPUT-RECORDS*' TO PV-PARAGRAPH-NAME.    03370055
033800                                                                  03380055
033900     INITIALIZE STORE-EXTRACT-LINE                                03390055
034000                RCRD018-EXTRACT-LINE.                             03400084
034100     MOVE RC009-OP-CO-NBR           TO SE-REGION.                 03410055
034200     MOVE RC009-STR-NBR             TO SE-STORE                   03420056
034300                                       SE-LOC-NBR.                03430056
034400     MOVE RC009-DIV-SEQ-NBR         TO SE-DIVISION-SEQNO.         03440055
034500*    MOVE RC009-DEPT-NBR            TO SE-DEPT.                   03450059
034600     MOVE RC009-RCVR-NBR            TO SE-KEYREC.                 03460055
034700     MOVE RC009-PO-NBR              TO SE-PO                      03470055
034800                                       RC018-PO.                  03480055
034900     MOVE RC009-INVC-NBR            TO SE-INVOICE.                03490055
035000     MOVE RC009-VERIFYD-CT-DTE      TO SE-DATE-VERIFIED-COUNT     03500055
035100                                       RC018-DATE-VERIFIED-COUNT. 03510055
035200     MOVE RC009-REC-DTE             TO SE-DATE-RECEIVED.          03520055
035300*    MOVE RC009-CLASS-NBR           TO SE-CLASS.                  03530059
035400     MOVE RC009-VEND-INHSE-NAME     TO SE-VENDOR-NAME-INHOUSE.    03540055
035500     MOVE RC009-VEND-INHSE-NBR      TO SE-VENDOR-NO-INHOUSE.      03550055
035600     MOVE RC009-VEND-DUNS-DESC      TO SE-VENDOR-NAME-DUNNS.      03560055
035700     MOVE RC009-VEND-DUNS-NBR       TO SE-VENDOR-NO-DUNNS.        03570055
035800     MOVE RC009-SKU-SEQ-NBR         TO PV-SKU-SEQ-NBR.            03580055
035900     MOVE ZEROES                    TO PV-ZERO1                   03590055
036000                                       PV-ZERO2.                  03600055
036100                                                                  03610055
036200     MOVE PV-STYLE                  TO SE-STYLE.                  03620055
036300     MOVE RC009-UNIT-RTL-AMT        TO SE-UNIT-RETAIL.            03630055
036400     MOVE RC009-LOWST-UNIT-RTL-AMT  TO SE-LOWEST-RETAIL.          03640055
036500     MOVE RC009-RTL-UNIT-ORD-QTY    TO SE-RETAIL-UNITS-ORDER.     03650055
036600     MOVE RC009-RTL-UNIT-RCVD-QTY   TO SE-RETAIL-UNITS-RECVD.     03660055
036700     MOVE RC009-RTL-UNIT-MK-QTY     TO SE-RETAIL-UNITS-MARK       03670055
036800                                       RC018-QTY-VRFD.            03680055
036900     MOVE RC009-COST-EXTN-AMT       TO SE-COST-EXTENSION          03690055
037000                                       RC018-COST-EXT-AMT.        03700055
037100     MOVE RC009-RTL-EXTN-AMT        TO SE-RETAIL-EXTENSION        03710055
037200                                       RC018-RETAIL-EXT-VRFD.     03720055
037300     MOVE RC009-PRC-FCLTY-AREA-ID   TO SE-PROCESSING-AREA6        03730055
037400                                       RC018-PROCESSING-AREA6     03740055
037500                                       SE-PROCESSING-AREA.        03750055
037600     MOVE RC009-INVC-RTL-QTY        TO SE-INVOICE-QTY-RETAIL.     03760055
037700     MOVE RC009-CASH-DISC-CDE       TO SE-CASH-DISCOUNT.          03770055
037800     MOVE RC009-DISC-DAYS-CNT       TO SE-DISCOUNT-DAYS.          03780055
037900     MOVE RC009-DISC-TERMS-CDE      TO SE-DISCOUNT-TERMS.         03790055
038000     MOVE RC009-EOM-IND             TO SE-EOM-INDICATOR.          03800055
038100     MOVE RC009-DATING-EXTN-CD      TO SE-EXTEND-DATING.          03810055
038200     MOVE RC009-FRGT-PAYT-CDE       TO SE-FREIGHT.                03820055
038300     MOVE RC009-STR-TYP-CDE         TO SE-RECEIVING-LOCATION      03830055
038400                                       RC018-STR-TYP-CDE.         03840055
038500     MOVE RC009-PO-LNE-NBR          TO SE-POLINENO.               03850055
038600     MOVE RC009-REC-SEQ-NBR         TO SE-REC-SEQ-NBR             03860055
038700                                       RC018-REC-SEQ-NBR.         03870055
038800     MOVE RC009-ADJ-CYC-NBR         TO SE-ADJ-CYC-NBR.            03880055
038900     MOVE RC009-NOTIF-NBR           TO SE-NOTIF-NBR.              03890055
039000     MOVE RC009-REC-SRC-CDE         TO SE-REC-SRC-CDE.            03900055
039100     MOVE RC009-OPER-UNT-ID         TO SE-OPER-UNT-ID             03910055
039200                                       RC018-OPER-UNT-ID.         03920055
039300     MOVE RC009-FCLTY-ID            TO SE-FCLTY-ID                03930055
039400                                       RC018-FCLTY-ID.            03940055
039500     MOVE RC009-CURR-OPER-UNT-ID    TO SE-CURR-OPER-UNT-ID        03950055
039600                                       RC018-CURR-OPER-UNT-ID.    03960055
039700     MOVE RC009-CURR-FCLTY-ID       TO SE-CURR-FCLTY-ID           03970055
039800                                       RC018-CURR-FCLTY-ID.       03980055
039900                                                                  03990055
040000     MOVE RC009-PO-LNE-NBR          TO RC018-PO-LNE-NBR           04000055
040100                                                                  04010055
040200***************************************************************** 04020055
040300*   RETRIEVING VALUE OF ITM NBR                  *** WR # 21361 * 04030055
040400***************************************************************** 04040055
040500     IF PV-CURR-KEY = PV-PREV-KEY                                 04050055
040600         CONTINUE                                                 04060055
040700     ELSE                                                         04070055
040800         MOVE PV-CURR-KEY             TO PV-PREV-KEY              04080055
040900         INITIALIZE DCLTPURITM                                    04090042
041000                    PV-SN-SEQ-NBR                                 04100039
041100******    WR # 27201 - START                                      04110084
041200                    DCLTMITGPL                                    04120099
041300                    DCLTUPCPLS                                    04130099
041400                    RC073-VRFD-REC                                04140084
041500                    PV-VRFD-UNT-AMT                               04150084
041600                    PV-VRFD-GP-QTY                                04160084
041700                    PV-VRFD-GP-AMT                                04170084
041800                    PV-VRFD-LWST-UNT-AMT                          04180084
041900                    PV-AMT                                        04190099
042000         MOVE 20                TO PV-DATE-VERIFIED-CC            04200099
042100         MOVE SE-DV-YY          TO PV-DATE-VERIFIED-YY            04210099
042200         MOVE '-'               TO PV-DATE-VERIFIED-1ST           04220099
042300         MOVE SE-DV-MM          TO PV-DATE-VERIFIED-MM            04230099
042400         MOVE '-'               TO PV-DATE-VERIFIED-2ND           04240099
042500         MOVE SE-DV-DD          TO PV-DATE-VERIFIED-DD            04250099
042600******    WR # 27201 - END                                        04260084
042700         MOVE RC009-PO-NBR      TO PURITM-PO-NBR                  04270040
042800         MOVE RC009-PO-LNE-NBR  TO PURITM-APP-PO-LNE-NBR          04280040
042900         MOVE RC009-REC-SEQ-NBR TO RECITM-REC-SEQ-NBR             04290042
042910         INITIALIZE PS-VALID-ITEM-SW                              04291099
043000         PERFORM 7000-GET-ITEM-NBR                                04300039
043100                                                                  04310038
043200         IF SQLCODE = ZERO                                        04320038
043300             PERFORM 1100-CHECK-DUMMY-SKU                         04330038
043400******    WR # 27201 - START                                      04340074
043500             PERFORM 1300-PROCESS-VRFD-RETAIL                     04350074
043600******    WR # 27201 - END                                        04360074
043700         END-IF                                                   04370055
043800     END-IF.                                                      04380055
043900                                                                  04390055
044000*   THIS CARRIES OVER FROM THE PREVIOUS RECORD UNLESS             04400055
044100*    CHANGED IN THE LOGIC ABOVE                                   04410055
044200     MOVE PV-SN-SEQ-NBR        TO SE-SKU-NBR.                     04420059
044300     MOVE PV-DEPT              TO SE-DEPT.                        04430059
044400     MOVE PV-MAJ-CLASS         TO SE-CLASS.                       04440059
044500******************************************************************04450038
044600*   CHANGE MADE FOR WR# 21361 ENDS HERE                          *04460049
044700******************************************************************04470038
044800                                                                  04480084
044900******    WR # 27201 - START                                      04490084
045000     IF PS-NO-VRFD-DTE-PRICE-FOUND                                04500099
045100         CONTINUE                                                 04510099
045200     ELSE                                                         04520099
045300         MOVE PV-VRFD-UNT-AMT       TO SE-UNIT-RETAIL             04530099
045400         MOVE PV-VRFD-LWST-UNT-AMT  TO SE-LOWEST-RETAIL           04540099
045500         COMPUTE SE-RETAIL-EXTENSION = SE-LOWEST-RETAIL *         04550099
045600                                       SE-RETAIL-UNITS-MARK       04560099
045700     END-IF.                                                      04570099
045800******    WR # 27201 - END                                        04580084
045900                                                                  04590038
046000     IF SE-PO NOT = PV-PO-NBR                                     04600030
046100         MOVE SE-PO TO PV-PO-NBR                                  04610030
046200         PERFORM 1500-FETCH-PO-TYPE-CODE                          04620030
046300     ELSE                                                         04630030
046400         MOVE PURCHS-PO-TYP-CDE TO SE-PO-TYP-CDE                  04640030
046500     END-IF.                                                      04650030
046600                                                                  04660027
046700     IF  SE-PO = PV-PREV-SE-PO                                    04670056
046800     AND SE-REC-SEQ-NBR = PV-PREV-SE-REC-SEQ-NBR                  04680056
046900         MOVE PV-REC-TYP-CDE     TO SE-REC-TYP-CDE                04690056
047000     ELSE                                                         04700056
047100         MOVE SE-PO TO PV-PREV-SE-PO                              04710056
047200         MOVE SE-REC-SEQ-NBR TO PV-PREV-SE-REC-SEQ-NBR            04720056
047300         PERFORM 1600-FETCH-REC-TYPE-CODE                         04730056
047400         MOVE PV-REC-TYP-CDE     TO SE-REC-TYP-CDE                04740056
047500     END-IF.                                                      04750056
047510                                                                  04751099
047520     IF PS-VALID-ITEM-FOUND                                       04752099
047530         MULTIPLY SE-RETAIL-UNITS-MARK                            04753099
047531                                  BY PURITM-PRD-1ST-COST-AMT      04753199
047532                                  GIVING SE-1ST-COST-EXTENSION    04753299
047533****** REMOVED ROUNDING           ROUNDED                         04753399
047534****** DMH 3/13/08                                                04753499
047535     ELSE                                                         04753599
047536         MOVE ZERO         TO SE-1ST-COST-EXTENSION               04753699
047537     END-IF.                                                      04753799
047600                                                                  04760056
047700*  DO NOT PASS ADJUSTMENTS (RC009-REC-SRC-CDE = 'A') TO THE NEW   04770056
047800*  REPORT FILE.                                                   04780056
047900                                                                  04790056
048000*    IF RC009-REC-SRC-CDE = 'A'                                   04800056
048100*        CONTINUE                                                 04810056
048200*    ELSE                                                         04820056
048300*        PERFORM 8600-WRITE-RPT-FILE                              04830056
048400*    END-IF.                                                      04840055
048500                                                                  04850062
048600*  THE FOLLOWING CODE WAS USED IN APRIL OF 2004 BY RON KRIER      04860063
048700*  TO CHECK IF A CHANGE TO GET DEPARTMENT AND CLASS FROM THE      04870063
048800*  XL DOMAIN ITEM TABLE MAY HAVE CAUGHT RECEIPTS FROM THE         04880063
048900*  PREVIOUS NIGHT THAT WOULD HAVE HAD A CHANGE IN DEPARTMENT      04890063
049000*  AND/OR CLASS FROM THE PO TO THE DOMAIN ITEM.  ONLY THE         04900063
049100*  DIFFERENCES WOULD HAVE BEEN WRITTEN TO THE OUTPUT FILE         04910063
049200*  IF THE FOLLOWING CODE IS BEING USED.                           04920063
049300*                                                                 04930063
049400*  NOTE:  THE STAND ALONG PERFORM 7500-WRITE-STORE-FILE.          04940099
049500*         STATEMENT SHOULD BE COMMENTED OUT IF USING THE          04950063
049600*         FOLLOWING MOVE AND IF STATEMENTS FOR TESTING.           04960063
049700*                                                                 04970063
049800*    MOVE RC009-DEPT-NBR  TO PV-RC009-DEPT.                       04980063
049900*    IF  SE-CLASS = RC009-CLASS-NBR                               04990063
050000*    AND SE-DEPT  = PV-RC009-DEPT                                 05000063
050100*        CONTINUE                                                 05010063
050200*    ELSE                                                         05020063
050300*        PERFORM 8500-WRITE-STORE-FILE.                           05030063
050400                                                                  05040063
050500     PERFORM 8500-WRITE-STORE-FILE.                               05050063
050600                                                                  05060063
050700     PERFORM 8000-READ-TSTREXT-FILE.                              05070055
050800/                                                                 05080055
050900******************************************************************05090055
051000*   CHECKING FOR DUMMY SKU                              WR# 21361*05100055
051100******************************************************************05110055
051200 1100-CHECK-DUMMY-SKU.                                            05120055
051300     IF PURITM-ITM-NBR < 0                                        05130055
051400         MOVE '1100-CHECK-DUMMY-SKU'                              05140055
051500                               TO PV-PARAGRAPH-NAME               05150055
051600         MOVE 'ITEM NBR IS LESS THAN ZERO'                        05160055
051700                               TO PV-DB2-OPERATION-MESSAGE-1      05170055
051800         PERFORM 9100-DB2-ABEND                                   05180055
051900     ELSE                                                         05190055
052000        IF PURITM-ITM-NBR = 0                                     05200055
052010          SET PS-NO-VALID-ITEM-FOUND                              05201099
052020                              TO TRUE                             05202099
052100          IF RC009-SKU-SEQ-NBR = PC-000                           05210055
052200            MOVE '00000000'   TO PV-SN-SEQ-NBR                    05220055
052300          ELSE                                                    05230055
052400            IF RC009-SKU-SEQ-NBR = PC-999                         05240055
052500              MOVE '99999999' TO PV-SN-SEQ-NBR                    05250055
052600            ELSE                                                  05260055
052700              MOVE '1100-CHECK-DUMMY-SKU'                         05270055
052800                              TO PV-PARAGRAPH-NAME                05280055
052900              MOVE 'ITEM NUMBER IS NOT VALID'                     05290055
053000                              TO PV-DB2-OPERATION-MESSAGE-1       05300055
053100              PERFORM 9100-DB2-ABEND                              05310055
053200            END-IF                                                05320055
053300          END-IF                                                  05330055
053400        END-IF                                                    05340055
053500     END-IF.                                                      05350055
053600                                                                  05360055
053700     IF PURITM-ITM-NBR > 0 AND                                    05370055
053800      ((RC009-SKU-SEQ-NBR NOT = PC-000) AND                       05380055
053900      (RC009-SKU-SEQ-NBR NOT = PC-999))                           05390055
054000        PERFORM 1200-CALL-XLKUT-DOMAIN-PGM                        05400055
054100     END-IF.                                                      05410055
054200/                                                                 05420055
054300******************************************************************05430055
054400*   XLKUT DOMAIN PGM IS CALLED                          WR# 21361*05440055
054500******************************************************************05450055
054600 1200-CALL-XLKUT-DOMAIN-PGM.                                      05460055
054700     INITIALIZE XL001-ITEM-COMMAREA.                              05470055
054800                                                                  05480055
054900     SET XL001-BY-ITEM                                            05490055
055000         XL001-SELECT-VND-STYL                                    05500060
055100         XL001-SELECT-SKU           TO TRUE.                      05510055
055200                                                                  05520055
055300     MOVE PURITM-ITM-NBR            TO XL001-KEY-ITM-NBR.         05530064
055400                                                                  05540064
055500     CALL XL001-VSM-PGM USING XL001-ITEM-COMMAREA.                05550064
055600                                                                  05560064
055700     MOVE XL001-SKU-SQLCODE         TO SQLCODE.                   05570064
055800                                                                  05580064
055900     EVALUATE TRUE                                                05590064
056000        WHEN SQLCODE = +0                                         05600064
056100             MOVE XL001-SKU-NBR        TO PV-SN-SEQ-NBR           05610064
056200             MOVE XL001-DEPT-NBR       TO PV-DEPT                 05620064
056300             MOVE XL001-SUB-CL-NBR     TO PV-MAJ-CLASS-POS-1-2    05630064
056400        WHEN SQLCODE = +100                                       05640055
056500             DISPLAY 'NO SKU NBR FOR ITM NBR = '                  05650055
056600                     XL001-KEY-ITM-NBR                            05660055
056700        WHEN OTHER                                                05670055
056800             MOVE '1200-CALL-XLKUT' TO PV-PARAGRAPH-NAME          05680055
056900             MOVE 'ATTEMPTING TO FETCH SKU NBR'                   05690055
057000                                    TO PV-DB2-OPERATION-MESSAGE-1 05700055
057100             MOVE 'XLV_SKU'         TO PV-DB2-TABLE-NAME-1        05710055
057200             PERFORM 9100-DB2-ABEND                               05720055
057300     END-EVALUATE.                                                05730055
057400******************************************************************05740055
057500*   CHANGE MADE FOR WR# 21361 ENDS HERE                          *05750055
057600******************************************************************05760055
057700/                                                                 05770055
057800******    WR # 27201 - START                                      05780074
057900 1300-PROCESS-VRFD-RETAIL.                                        05790099
058000                                                                  05800074
058100     PERFORM 1310-SELECT-TUPCPLS.                                 05810099
058200                                                                  05820099
058300     IF PS-NO-VRFD-DTE-PRICE-FOUND                                05830099
058400         CONTINUE                                                 05840099
058500     ELSE                                                         05850099
058600         PERFORM 1370-PROCESS-FOR-GROUP-PRICE                     05860099
058700         MOVE UPCPLS-UNT-RTL-AMT     TO PV-VRFD-UNT-AMT           05870099
058800         MOVE MITGPL-MITGPL-QTY      TO PV-VRFD-GP-QTY            05880099
058900         MOVE MITGPL-GP-AMT          TO PV-VRFD-GP-AMT            05890099
059000         IF PV-AMT = 0                                            05900099
059100             MOVE UPCPLS-UNT-RTL-AMT TO PV-VRFD-LWST-UNT-AMT      05910099
059110             MOVE UPCPLS-UNT-RTL-AMT TO PV-VRFD-GP-AMT            05911099
059130             MOVE 1                  TO PV-VRFD-GP-QTY            05913099
059200         ELSE                                                     05920099
059300             MOVE PV-AMT             TO PV-VRFD-LWST-UNT-AMT      05930099
059400         END-IF                                                   05940099
059500         PERFORM 1400-WRITE-VRFD-RETAIL                           05950099
059600     END-IF.                                                      05960099
059700/                                                                 05970099
059800 1310-SELECT-TUPCPLS.                                             05980099
059900                                                                  05990099
060000     INITIALIZE DCLTUPCPLS.                                       06000096
060100     SET PS-VRFD-DTE-PRICE-FOUND TO TRUE.                         06010099
060200                                                                  06020099
060300     EXEC SQL                                                     06030096
060400       SELECT  A.UNT_RTL_AMT                                      06040096
060500            ,  A.MEITGP_NBR                                       06050096
060600         INTO  :UPCPLS-UNT-RTL-AMT                                06060096
060700            ,  :UPCPLS-MEITGP-NBR                                 06070096
060800         FROM  TUPCPLS A                                          06080096
060900            ,  TRECITM B                                          06090096
061000        WHERE  B.ORD_NBR     = :PURITM-PO-NBR                     06100099
061100          AND  B.REC_SEQ_NBR = :RECITM-REC-SEQ-NBR                06110099
061200          AND  B.ORD_LNE_NBR = :PURITM-APP-PO-LNE-NBR             06120099
061300          AND  DATE(A.EFF_BEG_TMST) <= :PV-DATE-VERIFIED          06130099
061400          AND (DATE(A.EFF_END_TMST) >= :PV-DATE-VERIFIED          06140099
061500          OR   A.EFF_END_TMST IS NULL)                            06150099
061600          AND  A.ITM_NBR = B.ITM_NBR                              06160099
061700          AND  A.STR_NBR = 0                                      06170099
061800          AND  A.OPERCO_NBR    = '03'                             06180099
061900     END-EXEC.                                                    06190099
062000                                                                  06200099
062100     EVALUATE TRUE                                                06210099
062200       WHEN SQLCODE = ZEROS                                       06220099
062300          CONTINUE                                                06230099
062400       WHEN SQLCODE = -811                                        06240096
062500          PERFORM 1320-SELECT-TUPCPLS-RCVR                        06250099
062600       WHEN SQLCODE = +100                                        06260096
062700          SET PS-NO-VRFD-DTE-PRICE-FOUND TO TRUE                  06270099
062800       WHEN OTHER                                                 06280096
062900          MOVE '1310-SELECT-TUPCPLS' TO PV-PARAGRAPH-NAME         06290099
063000          MOVE 'ATTEMPTING TO FETCH UNT RTL '                     06300099
063100                                     TO PV-DB2-OPERATION-MESSAGE-106310099
063200          MOVE 'TUPCPLS'             TO PV-DB2-TABLE-NAME-1       06320099
063300          MOVE 'TRECITM'             TO PV-DB2-TABLE-NAME-2       06330099
063400          PERFORM 9100-DB2-ABEND                                  06340099
063500     END-EVALUATE.                                                06350096
063600/                                                                 06360099
063700 1320-SELECT-TUPCPLS-RCVR.                                        06370099
063800                                                                  06380099
063900     INITIALIZE DCLTUPCPLS.                                       06390096
064000                                                                  06400099
064100     EXEC SQL                                                     06410096
064200       SELECT  A.UNT_RTL_AMT                                      06420096
064300            ,  A.MEITGP_NBR                                       06430096
064400         INTO  :UPCPLS-UNT-RTL-AMT                                06440096
064500            ,  :UPCPLS-MEITGP-NBR                                 06450096
064600         FROM  TUPCPLS A                                          06460096
064700            ,  TRECITM B                                          06470096
064800        WHERE  B.ORD_NBR     = :PURITM-PO-NBR                     06480099
064900          AND  B.REC_SEQ_NBR = :RECITM-REC-SEQ-NBR                06490099
065000          AND  B.ORD_LNE_NBR = :PURITM-APP-PO-LNE-NBR             06500099
065010          AND  B.VER_STATUS_CDE  = 'A'                            06501099
065100          AND  DATE(A.EFF_BEG_TMST) <= :PV-DATE-VERIFIED          06510096
065200          AND  A.EFF_END_TMST IS NULL                             06520096
065300          AND  A.ITM_NBR = B.ITM_NBR                              06530096
065400          AND  A.STR_NBR = 0                                      06540096
065500          AND  A.OPERCO_NBR    = '03'                             06550096
065600     END-EXEC.                                                    06560096
065700                                                                  06570096
065800     EVALUATE TRUE                                                06580096
065900       WHEN SQLCODE = ZEROS                                       06590096
066000           CONTINUE                                               06600096
066100       WHEN SQLCODE = +100                                        06610096
066200           PERFORM 1330-PRCS-UPCPLS-RCVR-CSR                      06620099
066300       WHEN OTHER                                                 06630096
066400           MOVE '1320-SELECT-TUPCPLS-RCVR'                        06640099
066500                                     TO PV-PARAGRAPH-NAME         06650099
066600           MOVE 'ATTEMPTING TO FETCH UNT RTL '                    06660099
066700                                     TO PV-DB2-OPERATION-MESSAGE-106670099
066800           MOVE 'TUPCPLS'            TO PV-DB2-TABLE-NAME-1       06680099
066900           MOVE 'TRECITM'            TO PV-DB2-TABLE-NAME-2       06690099
067000           PERFORM 9100-DB2-ABEND                                 06700099
067100     END-EVALUATE.                                                06710099
067200/                                                                 06720099
067300 1330-PRCS-UPCPLS-RCVR-CSR.                                       06730099
067400                                                                  06740099
067500     SET PS-NOT-EOF-TUPCPLS-RCVR-CSR TO TRUE.                     06750099
067600     PERFORM 1340-OPEN-RCVR-CSR.                                  06760099
067700     PERFORM 1350-FETCH-RCVR-CSR                                  06770099
067800             UNTIL PS-EOF-TUPCPLS-RCVR-CSR.                       06780099
067900     PERFORM 1360-CLOSE-RCVR-CSR.                                 06790099
068000/                                                                 06800099
068100 1340-OPEN-RCVR-CSR.                                              06810099
068200                                                                  06820099
068300     EXEC SQL                                                     06830099
068400         OPEN TUPCPLS-RCVR-CSR                                    06840099
068500     END-EXEC.                                                    06850099
068600                                                                  06860099
068700     EVALUATE TRUE                                                06870099
068800         WHEN SQLCODE = +0                                        06880099
068900              CONTINUE                                            06890099
069000         WHEN OTHER                                               06900099
069100              MOVE '1340-OPEN-RCVR-CSRS'                          06910099
069200                                     TO PV-PARAGRAPH-NAME         06920099
069300              MOVE 'ATTEMPTING TO OPEN CURSOR '                   06930099
069400                                     TO PV-DB2-OPERATION-MESSAGE-106940099
069500              MOVE 'TUPCPLS'         TO PV-DB2-TABLE-NAME-1       06950099
069600              MOVE 'TRECITM'         TO PV-DB2-TABLE-NAME-2       06960099
069700              PERFORM 9100-DB2-ABEND                              06970099
069800     END-EVALUATE.                                                06980099
069900/                                                                 06990099
070000 1350-FETCH-RCVR-CSR.                                             07000099
070100                                                                  07010099
070200     EXEC SQL                                                     07020099
070300          FETCH TUPCPLS-RCVR-CSR                                  07030099
070400           INTO :UPCPLS-UNT-RTL-AMT                               07040099
070500              , :UPCPLS-EFF-END-TMST                              07050099
070600              , :UPCPLS-MEITGP-NBR                                07060099
070700     END-EXEC.                                                    07070099
070800                                                                  07080099
070900     EVALUATE TRUE                                                07090099
071000         WHEN SQLCODE = +0                                        07100099
071100         WHEN SQLCODE = -305                                      07110099
071200              SET PS-EOF-TUPCPLS-RCVR-CSR TO TRUE                 07120099
071300         WHEN OTHER                                               07130099
071400              MOVE '1350-FETCH-RCVR-CSR'                          07140099
071500                                     TO PV-PARAGRAPH-NAME         07150099
071600              MOVE 'ATTEMPTING TO FETCH UNT RTL '                 07160099
071700                                     TO PV-DB2-OPERATION-MESSAGE-107170099
071800              MOVE 'TUPCPLS'         TO PV-DB2-TABLE-NAME-1       07180099
071900              MOVE 'TRECITM'         TO PV-DB2-TABLE-NAME-2       07190099
072000              PERFORM 9100-DB2-ABEND                              07200099
072100     END-EVALUATE.                                                07210099
072200/                                                                 07220099
072300 1360-CLOSE-RCVR-CSR.                                             07230099
072400                                                                  07240099
072500     EXEC SQL                                                     07250099
072600         CLOSE TUPCPLS-RCVR-CSR                                   07260099
072700     END-EXEC.                                                    07270099
072800                                                                  07280099
072900     EVALUATE TRUE                                                07290099
073000         WHEN SQLCODE = +0                                        07300099
073100              CONTINUE                                            07310099
073200         WHEN OTHER                                               07320099
073300              MOVE '1360-CLOSE-RCVR-CSR'                          07330099
073400                                     TO PV-PARAGRAPH-NAME         07340099
073500              MOVE 'ATTEMPTING TO CLOSE CURSOR '                  07350099
073600                                     TO PV-DB2-OPERATION-MESSAGE-107360099
073700              MOVE 'TUPCPLS'         TO PV-DB2-TABLE-NAME-1       07370099
073800              MOVE 'TRECITM'         TO PV-DB2-TABLE-NAME-2       07380099
073900              PERFORM 9100-DB2-ABEND                              07390099
074000     END-EVALUATE.                                                07400099
074100/                                                                 07410099
074200 1370-PROCESS-FOR-GROUP-PRICE.                                    07420099
074300                                                                  07430099
074400     IF UPCPLS-MEITGP-NBR = 0                                     07440099
074500         MOVE ZEROS             TO PV-AMT                         07450099
074600     ELSE                                                         07460099
074700         PERFORM 1380-GET-GROUP-PRICE                             07470099
074800         IF PS-GROUP-PRICE-FOUND                                  07480099
074900             IF MITGPL-MITGPL-QTY > 1                             07490099
075000                 COMPUTE PV-AMT = MITGPL-GP-AMT /                 07500099
075100                                  MITGPL-MITGPL-QTY               07510099
075200             ELSE                                                 07520099
075300                 MOVE ZEROS     TO PV-AMT                         07530099
075400             END-IF                                               07540099
075500         ELSE                                                     07550099
075600             MOVE ZEROS         TO PV-AMT                         07560099
075700         END-IF                                                   07570099
075800     END-IF.                                                      07580099
075900/                                                                 07590099
076000 1380-GET-GROUP-PRICE.                                            07600099
076100                                                                  07610099
076200     INITIALIZE DCLTMITGPL.                                       07620099
076300     SET PS-GROUP-PRICE-FOUND TO TRUE.                            07630099
076400                                                                  07640099
076500     EXEC SQL                                                     07650099
076600       SELECT  A.MITGPL_QTY                                       07660099
076700            ,  A.GP_AMT                                           07670099
076800         INTO  :MITGPL-MITGPL-QTY                                 07680099
076900            ,  :MITGPL-GP-AMT                                     07690099
077000         FROM  TMITGPL A                                          07700099
077100        WHERE  A.OPERCO_NBR = '03'                                07710099
077200          AND  A.MEITGP_NBR = :UPCPLS-MEITGP-NBR                  07720099
077300          AND  A.ADLOC_ID = '   '                                 07730099
077400     END-EXEC.                                                    07740099
077500                                                                  07750099
077600     EVALUATE TRUE                                                07760099
077700       WHEN SQLCODE = ZEROS                                       07770099
077800         CONTINUE                                                 07780099
077900       WHEN SQLCODE = +100                                        07790099
078000         SET PS-NO-GROUP-PRICE-FOUND TO TRUE                      07800099
078100       WHEN OTHER                                                 07810099
078200         MOVE '1380-GET-GROUP-PRICE' TO PV-PARAGRAPH-NAME         07820099
078300         MOVE 'ATTEMPTING TO FETCH GROUP RTL'                     07830099
078400                                     TO PV-DB2-OPERATION-MESSAGE-107840099
078500         MOVE 'TMITGPL'              TO PV-DB2-TABLE-NAME-1       07850099
078600         MOVE 'TMITGPL'              TO PV-DB2-TABLE-NAME-2       07860099
078700         PERFORM 9100-DB2-ABEND                                   07870099
078800     END-EVALUATE.                                                07880099
078900/                                                                 07890099
079000 1400-WRITE-VRFD-RETAIL.                                          07900099
079100                                                                  07910099
079200     IF RC009-REC-SRC-CDE = 'R'                                   07920099
079300         IF PV-VRFD-UNT-AMT      NOT = RC009-UNIT-RTL-AMT     OR  07930099
079400            PV-VRFD-LWST-UNT-AMT NOT = RC009-LOWST-UNIT-RTL-AMT   07940099
079500             MOVE RC009-PO-NBR         TO RC073-ORD-NBR           07950099
079600             MOVE RC009-PO-LNE-NBR     TO RC073-ORD-LNE-NBR       07960099
079700             MOVE RC009-REC-SEQ-NBR    TO RC073-REC-SEQ-NBR       07970099
079800             MOVE RC009-OPER-UNT-ID    TO RC073-OPER-UNT-ID       07980099
079900             MOVE RC009-FCLTY-ID       TO RC073-FCLTY-ID          07990099
080000             MOVE PV-VRFD-UNT-AMT      TO RC073-VRFD-UNT-RTL-AMT  08000099
080100             MOVE PV-VRFD-GP-QTY       TO RC073-VRFD-GP-QTY       08010099
080200             MOVE PV-VRFD-GP-AMT       TO RC073-VRFD-GP-AMT       08020099
080300             PERFORM 8700-WRITE-STORE-FILE                        08030099
080400         END-IF                                                   08040099
080500     END-IF.                                                      08050099
080600/                                                                 08060099
080700******    WR # 27201 - END                                        08070099
080800 1500-FETCH-PO-TYPE-CODE.                                         08080055
080900                                                                  08090055
081000     MOVE PV-PO-NBR TO DK-PO-NBR.                                 08100055
081100                                                                  08110055
081200     EXEC SQL                                                     08120055
081300         SELECT PO_TYP_CDE                                        08130055
081400           INTO :PURCHS-PO-TYP-CDE                                08140055
081500           FROM TPURCHS                                           08150055
081600          WHERE PO_NBR          = :DK-PO-NBR                      08160055
081700            AND VER_STATUS_CDE  = 'A'                             08170055
081800     END-EXEC.                                                    08180055
081900                                                                  08190055
082000     EVALUATE TRUE                                                08200055
082100         WHEN SQLCODE = ZERO                                      08210055
082200         WHEN SQLCODE = -811                                      08220055
082300             MOVE PURCHS-PO-TYP-CDE TO SE-PO-TYP-CDE              08230055
082400                                                                  08240055
082500         WHEN SQLCODE = +100                                      08250055
082600             MOVE '  '              TO SE-PO-TYP-CDE              08260055
082700             CONTINUE                                             08270055
082800                                                                  08280055
082900         WHEN OTHER                                               08290055
083000             MOVE '1500-FETCH-PO-TYPE-CODE' TO PV-PARAGRAPH-NAME  08300055
083100             MOVE 'ATTEMPTING TO FETCH PO TYPE CODE FOR '         08310055
083200                                 TO PV-DB2-OPERATION-MESSAGE-1    08320055
083300             STRING 'PO NUMBER = '           DELIMITED BY SIZE    08330055
083400                    SE-PO                    DELIMITED BY SIZE    08340055
083500                               INTO PV-DB2-OPERATION-MESSAGE-2    08350055
083600             MOVE 'TPURCHS'      TO PV-DB2-TABLE-NAME-1           08360055
083700             PERFORM 9100-DB2-ABEND                               08370055
083800     END-EVALUATE.                                                08380055
083900/                                                                 08390056
084000 1600-FETCH-REC-TYPE-CODE.                                        08400056
084100                                                                  08410056
084200     MOVE PV-PREV-SE-PO          TO DK-ORD-NBR.                   08420056
084300     MOVE PV-PREV-SE-REC-SEQ-NBR TO DK-REC-SEQ-NBR.               08430056
084400                                                                  08440056
084500     EXEC SQL                                                     08450056
084600         SELECT REC_TYP_CDE                                       08460056
084700           INTO :RECEIV-REC-TYP-CDE                               08470056
084800           FROM TRECEIV                                           08480056
084900          WHERE ORD_NBR         = :DK-ORD-NBR                     08490056
085000            AND REC_SEQ_NBR     = :DK-REC-SEQ-NBR                 08500058
085100     END-EXEC.                                                    08510056
085200                                                                  08520056
085300     EVALUATE TRUE                                                08530056
085400         WHEN SQLCODE = ZERO                                      08540056
085500         WHEN SQLCODE = -811                                      08550056
085600             MOVE RECEIV-REC-TYP-CDE TO PV-REC-TYP-CDE            08560056
085700                                                                  08570056
085800         WHEN SQLCODE = +100                                      08580056
085900             MOVE '  '              TO PV-REC-TYP-CDE             08590056
086000             CONTINUE                                             08600056
086100                                                                  08610056
086200         WHEN OTHER                                               08620056
086300             MOVE '1600-FETCH-REC-TYPE-CODE' TO PV-PARAGRAPH-NAME 08630056
086400             MOVE 'ATTEMPTING TO SELECT REC TYPE CODE FOR '       08640056
086500                                 TO PV-DB2-OPERATION-MESSAGE-1    08650056
086600             STRING 'PO NUMBER = '           DELIMITED BY SIZE    08660056
086700                    SE-PO                    DELIMITED BY SIZE    08670056
086800                    ' REC SEQ NUMBER = '     DELIMITED BY SIZE    08680057
086900                    SE-REC-SEQ-NBR           DELIMITED BY SIZE    08690056
087000                               INTO PV-DB2-OPERATION-MESSAGE-2    08700056
087100             MOVE 'TRECEIV'      TO PV-DB2-TABLE-NAME-1           08710056
087200             PERFORM 9100-DB2-ABEND                               08720056
087300     END-EVALUATE.                                                08730056
087400/                                                                 08740056
087500 7000-GET-ITEM-NBR.                                               08750056
087600     EXEC SQL                                                     08760056
087700         SELECT                                                   08770056
087800             A.ITM_NBR                                            08780056
087810            ,A.PRD_1ST_COST_AMT                                   08781099
087900         INTO                                                     08790056
088000             :PURITM-ITM-NBR                                      08800056
088010            ,:PURITM-PRD-1ST-COST-AMT                             08801099
088100         FROM                                                     08810056
088200             TPURITM A                                            08820056
088300           , TRECITM B                                            08830056
088400         WHERE                                                    08840056
088500                 A.PO_NBR         = :PURITM-PO-NBR                08850056
088600             AND A.APP_PO_LNE_NBR = :PURITM-APP-PO-LNE-NBR        08860056
088700             AND B.REC_SEQ_NBR    = :RECITM-REC-SEQ-NBR           08870056
088800             AND B.VER_STATUS_CDE = 'A'                           08880056
088900             AND A.VER_NBR        > 0                             08890056
089000             AND A.PO_NBR         = B.ORD_NBR                     08900056
089100             AND A.APP_PO_LNE_NBR = B.ORD_LNE_NBR                 08910056
089200             AND A.VER_NBR        = B.PO_VER_NBR                  08920056
089300      END-EXEC.                                                   08930056
089400                                                                  08940056
089500     EVALUATE TRUE                                                08950056
089600         WHEN SQLCODE = ZERO                                      08960056
089700*            CONTINUE                                             08970099
089710             SET PS-VALID-ITEM-FOUND                              08971099
089720                                  TO TRUE                         08972099
089800         WHEN SQLCODE = +100                                      08980056
089900              DISPLAY 'NO ROW IN TPURITM FOR PO NBR = '           08990056
090000                      RC009-PO-NBR ' PO LINE NBR = '              09000056
090100                      RC009-PO-LNE-NBR ' REC SEQ NBR = '          09010056
090200                      RC009-REC-SEQ-NBR                           09020056
090210              SET PS-NO-VALID-ITEM-FOUND                          09021099
090220                                  TO TRUE                         09022099
090300         WHEN OTHER                                               09030056
090400              MOVE '7000-GET-ITEM-NBR'                            09040056
090500                                  TO PV-PARAGRAPH-NAME            09050056
090600              MOVE 'ATTEMPTING TO FETCH ITM NBR '                 09060056
090700                                  TO PV-DB2-OPERATION-MESSAGE-1   09070056
090800              MOVE 'TPURITM'      TO PV-DB2-TABLE-NAME-1          09080056
090900              MOVE 'TRECITM'      TO PV-DB2-TABLE-NAME-2          09090056
091000              PERFORM 9100-DB2-ABEND                              09100056
091100     END-EVALUATE.                                                09110056
091200/                                                                 09120056
091300 8000-READ-TSTREXT-FILE.                                          09130056
091400     READ TSTREXT-FILE INTO RC009-REC                             09140056
091500        AT END                                                    09150056
091600           SET END-OF-INPUT    TO TRUE                            09160056
091700         NOT AT END                                               09170055
091800             MOVE RC009-PO-NBR        TO PV-CURR-PO-NBR           09180055
091900             MOVE RC009-PO-LNE-NBR    TO PV-CURR-LNE-NBR          09190055
092000             MOVE RC009-REC-SEQ-NBR   TO PV-CURR-REC-SEQ-NBR      09200055
092100             ADD 1                    TO PV-INP01-COUNT           09210055
092200     END-READ.                                                    09220055
092300                                                                  09230055
092400 8500-WRITE-STORE-FILE.                                           09240055
092500     WRITE STORE-RECORD                                           09250055
092600         FROM STORE-EXTRACT-LINE.                                 09260055
092700     ADD 1                            TO PV-OUT01-COUNT.          09270055
092800                                                                  09280055
092900*8600-WRITE-RPT-FILE.                                             09290055
093000*    WRITE RPT-RECORD                                             09300055
093100*        FROM RCRD018-EXTRACT-LINE.                               09310055
093200*    ADD 1                            TO PV-OUT02-COUNT.          09320055
093300                                                                  09330055
093400******    WR # 27201 - START                                      09340064
093500 8700-WRITE-STORE-FILE.                                           09350064
093600     WRITE VRFD-RECORD                                            09360066
093700         FROM RC073-VRFD-REC.                                     09370073
093800     ADD 1                            TO PV-VRFD-COUNT.           09380064
093900                                                                  09390064
094000******    WR # 27201 - END                                        09400064
094100 9100-DB2-ABEND.                                                  09410055
094200******************************************************************09420055
094300*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    09430055
094400*  ERROR OR WARNING CODE OCCURS.                                  09440055
094500******************************************************************09450055
094600     DISPLAY '9100-DB2-ABEND'.                                    09460055
094700     DISPLAY '** ABEND           **'.                             09470055
094800     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  09480055
094900     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        09490055
095000     DISPLAY '** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME-1.      09500055
095100     DISPLAY '**                 ** = ' PV-DB2-TABLE-NAME-2.      09510055
095200     DISPLAY '**                 ** = ' PV-DB2-TABLE-NAME-3.      09520055
095300     DISPLAY '** OPERATION       ** = ' PV-DB2-OPERATION-MESSAGE-109530055
095400     DISPLAY '**                 ** = ' PV-DB2-OPERATION-MESSAGE-209540055
095500     DISPLAY '**                 ** = ' PV-DB2-OPERATION-MESSAGE-309550055
095600     DISPLAY '**                 ** = ' PV-DB2-OPERATION-MESSAGE-409560055
095700     DISPLAY '**                 ** = '                           09570055
095800                                                                  09580055
095900******************************************************************09590055
096000* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    09600055
096100* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         09610055
096200* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     09620055
096300* FORMAT.                                                         09630055
096400******************************************************************09640055
096500     COPY DPPD004.                                                09650055
096600                                                                  09660055
096700     MOVE +4013      TO ABEND-CODE.                               09670055
096800     CALL 'ILBOABN0' USING ABEND-CODE.                            09680055
096900*                                                                 09690055
097000*                                                                 09700055
