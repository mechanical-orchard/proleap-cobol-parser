       IDENTIFICATION DIVISION.                                                 
C96479 PROGRAM-ID.    ICKUP153.                                                 
       AUTHOR.        R. KELLEN.                                                
       INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
       DATE-WRITTEN.  02/01/2008.                                               
       DATE-COMPILED.                                                           
                                                                                
C96479*****************************************************************         
C96479* ICKUP153 - EXACT COPY OF ICKUP053 PROGRAM.GTT ZERO COUNT CHECK          
C96479* HAS INCLUDED IN ICKUP053 PROGRAM TO FORCE ABEND THE JOB ICK053          
C96479* IF ICK053 DID NOT HAVE ANY DATA TO PROCESS DUE TO GLOBAL TEMP           
C96479* TABLE ISSUE. BUT HOURLY CYCLE JOB ICK057 CANNOT HAVE DATA TO            
C96479* TO PROCESS IN EACH RUN AND GTT ZERO COUNT IS NOT APPLICABLE.            
C96479* HENCE CREATED THE NEW PROGRAM ICKUP153 FOR HOURLY CYCLE USAGE           
C96479* AND REMOVED THE GTT ZERO COUNT CHECK,NOT MODIFIED ANY OTHER             
C96479* LOGIC AS PART OF THIS CHANGE.                                           
C96479*    ANY CHANGES TO ICKUP153 LOGIC MIGHT NEED A CHANGE IN                 
C96479*    ICKUP053 AND ICKUT086 PROGRAM TOO.                                   
C96479*****************************************************************         
      *****************************************************************         
      * ICKUP053 - EXPLODE COUNT/STORE TO COUNT/STORE/SKU LEVEL AND             
      *            SELECT IMMEDIATE COUNTS SPECIFIED AT A SKU LEVEL.            
      *            THIS PROGRAM CAN BE RUN OVER AFTER AN ABEND AS IT            
      *            DOESN'T UPDATE ANYTHING UNTIL ALL PROCESSING IS              
      *            DONE.                                                        
      *            ANY CHANGES TO ICKUP053 LOGIC MIGHT NEED A CHANGE IN         
      *            ICKUT086  PROGRAM TOO.                                       
      *****************************************************************         
      *        THIS PROGRAM WILL READ A FILE OF COUNT/STORE COMBINATIONS        
      *        CREATED IN PROGRAM ICKUP052 AND EXPLODE THEM TO THE SKU          
      *        LEVEL BY USING THE GROUPINGS IN ICT_CNT_LOC_GP,                  
      *        ICT_LOC_GP_ASSN AND ICT_CNT_MDSE_GP TABLES ALONG WITH THE        
      *        HIERARCHIES IN THE XST_VND_STYL TABLE TO DETERMINE THE           
      *        SKUS TO BE USED. THIS PROGRAM WILL ALSO DETERMINE WHICH          
      *        COUNTS HAVE BEEN SELECTED BY THE USERS TO BE PROCESSED           
      *        IMMEDIATELY. THESE ARE SPECIFIED AT A SKU LEVEL, SO,             
      *        THERE ISN'T ANY EXPLOSION NEEDED.                                
      *                                                                         
      *****************************************************************         
      *                                                                         
      *  TABLES UPDATED ARE:                                                    
      *      ICT_CNT_STUP_STAT - IC COUNT SETUP STATUS                          
      *  FILES READ ARE:                                                        
      *      NONE                                                               
      *****************************************************************         
      * 02/02/06 - R KELLEN         -  WR NO. WR30388                           
      *    - NEW PROGRAM.                                                       
      *      THE PROGRAM PROGRAM THAT USES THE IC COUNT SETUP AND XST           
      *      TABLES TO DETERMINE WHICH SKUS ARE TO BE INCLUDED IN               
      *      AN INVENTORY COUNT AND WRITES 2 FILES OF COUNT/LOC/SKU             
      *      COMBINATIONS TO BE PROCESSED. ONE OF THE FILES CONTAINS            
      *      ACTIVE SKUS AND THE OTHER CLEARANCE SKUS.                          
      *****************************************************************         
916792* 08/19/09 - COGNIZANT       -  INC916792                                 
      *    CHANGES ARE MADE TO THE PROGRAM TO HANDLE CLEARANCE ITEMS            
      *    WHEN THE CLEARANCE STATUS INDICATOR IS 25 (MIXED CLEARANCE)          
      *****************************************************************         
851489* 09/18/09 - COGNIZANT        - INC NO. 851489                            
      *      DUE TO 1 MINUTE TIME VARIANCE BETWEEN UNIX BOX AND                 
      *      MAINFRAME, IMMEDIATE COUNTS ARE GETTING SKIPPED DUE TO             
      *      'PRO' TIMESTAMP LESSER THAN THE 'SCH' TIMESTAMP FROM UNIX.         
      *      MODIFIED THE PROGRAM TO ADD 2 MINUTES TO THE LAST UPDATED          
      *      TIMESTAMP, WHEN INSERTING 'PRO' STATUS TO THE                      
      *      ICT_CNT_STUP_STAT TABLE.                                           
      *****************************************************************         
CR9773* 07/27/11 - COGNIZANT       -  CRQ9773                                   
CR9773*    CHANGES ARE MADE TO THE PROGRAM TO IMPROVE THE CPU                   
CR9773*    PERFORMANCE (MODIFIED CNT-GRP-CSR, IMM-CNT-CSR AND                   
CR9773*    MAJ-CLS-CSR CURSORS AND INTRODUCED NEW TEMPORARY TABLE               
CR9773*    SESSION.TESTT).                                                      
CR9773*    PRODUCTION BUG FIX - COUNT RECORDS SHOULD NOT WRITTEN TO             
CR9773*    OUTPUT FILE IF NO ROW FOUND IN 8900- OR 8905- QUERIES.               
      *****************************************************************         
C92330* 09/16/14 - JIM HUNTER      -  CHG0092330                                
C92330*  CHANGING TO EXCLUDE CLEARANCE, DISCONTINUED AND                        
C92330*  NON-RFID SKUS FROM RFID (ICC) COUNTS ONLY.                             
C92330*****************************************************************         
C95753*----------------------------------------------------------               
C95753* DATE:  SEP 08 2014                                                      
C95753* WR/IR#: CHG0095753                                                      
C95753* PROGRAMMER: COGNIZANT                                                   
C95753* DESCRIPTION: DUE TO ISSUE IN GTT, ADDED A COMPARE BETWEEN THE           
C95753*              NO OF ROWS FETCHED BY THE ACTIVE AND THE CLEARANCE         
C95753*              CURSOR IN 3000-EOJ-PROCESSING PARA.                        
C95753*              THESE TWO CURSORS USE THE GTT TABLES. IF THE NO.           
C95753*              OF ROWS FETCHED BY ANY OF THESE TWO CURSORS IS 0           
C95753*              THEN RETURN CODE 4008 WILL BE                              
C95753*              PASSED TO JCL TO ABEND THE JOB.                            
C95753*-----------------------------------------------------------              
C96479* DATE:  OCT 20 2014                                                      
C96479* WR/IR#: CHG0096479                                                      
C96479* PROGRAMMER: COGNIZANT                                                   
C96479* CODING TAG: FIND C96479 FOR THE CHANGES.                                
C96479* DESCRIPTION: ICKUP153 NEW PROGRAM CREATED,EXACT COPY OF                 
C96479* ICKUP053 AND REMOVED THE GTT ZERO COUNT CHECK.                          
C96479*-----------------------------------------------------------              
112269* 05/21/2015 - JIM HUNTER    - CHG0112269                                 
112269*  THIS VERSION OF ICKUP153 WILL REMOVE THE HARD-CODED DEPT               
112269*  LOGIC PREVIOUSLY DONE FOR THE HANDS-FREE PILOT PROJECT.                
112269*  THESE CHANGES REQUIRE THAT THE W2W DEPTS BE ADDED TO THE               
112269*  RIT_RFID_STR_VRFN TABLE.                                               
112269******************************************************************        
115091* 06/10/2015 - JIM HUNTER    - CHG0115091                                 
115091*  THIS VERSION OF ICKUP153 WILL INCLUDE CHANGES MADE TO THE              
115091*  RIT_RFID_STR_VRFN TABLE AND THE ELIMINATION OF THE                     
115091*  RIT_STR_DEPT_VND TABLE.                                                
115091*  VENDOR DATA HAS BEEN COPIED FROM THE RIT_STR_DEPT_VND TABLE            
115091*  TO THE RIT_RFID_STR_VRFN TABLE WITH THE RFID_LVL_CDE =                 
115091*  'VENDOR'.                                                              
115091*  - PARAGRAPH 8332-FIND-DEPT-IN-STORE-TBL DID NOT REQUIRE                
115091*    CHANGES - AS CODED, IT WILL FIND DEPT NUMBERS ON VENDOR ROWS.        
115091*  - PARAGRAPH 8334-FIND-DEPT-IN-VENDOR-TBL WAS DELETED                   
115091******************************************************************        
C17640* DATE:   JUL 22 2015                                                     
C17640* WR/IR#: CHG0117640                                                      
C17640* PROGRAMMER: COGNIZANT                                                   
C17640* DESCRIPTION: MADE CHANGES TO EXCLUDE CLEARANCE AND DISCONTINUED         
C17640*              ITEMS IN THE FOLLOWING CURSORS MAJ-CLS-CSR,                
C17640*              SUB-CLS-CSR, STYLE-CSR AND GP-CDE-CSR                      
C17640*-----------------------------------------------------------              
C17705******************************************************************        
C17705* DATE:   JUL 22 2015                                                     
C17705* WR/IR#: CHG0117705                                                      
C17705* PROGRAMMER: COGNIZANT                                                   
C17705* DESCRIPTION: AS PER KAREN HAAG, EXCLUDING ONLY CLEARANCE ITEMS.         
C17705* ACTIVE AND DISCONTINUED ITEMS SHOULD BE INCLUDED IN THE                 
C17705* INVENTORY COUNT PROCESS.                                                
C17705*-----------------------------------------------------------              
117191* 08/12/2015 - JIM HUNTER    - CHG0117191                                 
117191*            UPDATED CURSOR IMM-CNT-CSR TO EXCLUDE THE RFID               
117191*            'ICC' COUNTS, SINCE RFID COUNTS WILL BE EXPLODED             
117191*            BY THE JAVA APPLICATION.                                     
117191*            CURSOR CNT-GRP-CSR DOES NOT NEED TO BE CHANGED               
117191*            SINCE ICKUP052 IS BEING CHANGED TO BYPASS ICC                
117191*            COUNTS - THEY WILL NO LONGER BE READ IN THIS                 
117191*            PROGRAM AND PASSED THROUGH THE CNT-GRP-CSR CURSOR.           
117191*            AT A LATER DATE A CLEANUP RELEASE WILL BE MADE TO            
117191*            ELIMINATE ALL RFID / ICC REFERENCES IN THIS PROGRAM.         
117191*            THIS IS A PERFORMANCE CHANGE TO REDUCE THE AMOUNT            
117191*            OF PROCESSING PERFORMED FOR RFID COUNTS.                     
117191******************************************************************        
228316* DATE:   JUL 26 2019                                                     
228316* WR/IR#: CHG0228316                                                      
228316* PROGRAMMER: JIM HUNTER                                                  
228316* DESCRIPTION: MAINFRAME REFACTORING - LUW DOES NOT RECOGNIZE THE         
228316*    STOGROUP, PRIQTY, SECQTY, BUFFERPOOL OR CLUSTER PARAMETERS           
228316*    ON THE CREATE INDEX STATEMENT, SO THEY MUST BE REMOVED.              
228316*    DB2 WILL USE DEFAULT VALUES.                                         
228316*****************************************************************         
259021* DATE:   JUL 14 2021                                                     
259021* WR/IR#: CHG0259021                                                      
259021* PROGRAMMER: BARB SCHULTZ                                                
259021* DESCRIPTION: IN PARAGRAPH 1210-CREATE-TEMP-TABLE ADDED                  
259021*    'NOT LOGGED ON ROLLBACK DELETE ROWS' CLAUSE TO THE                   
259021*    DECLARE STATEMENT FOR TEMP TABLE TESTT TO REDUCE THE                 
259021*    NUMBER OF LOG RECORDS TO DB2.                                        
259021*****************************************************************         
RFIDXX* 09/09/2022 - JIM HUNTER    - CHG0274371                                 
RFIDXX*    REMOVED ALL RFID RELATED TABLES, FIELDS, DCLGEN AND LOGIC.           
RFIDXX******************************************************************        
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
       INPUT-OUTPUT SECTION.                                                    
                                                                                
       FILE-CONTROL.                                                            
           SELECT CNT-STORE-EXP-FILE         ASSIGN TO INP01.                   
                                                                                
           SELECT CNT-SKU-EXP-FILE           ASSIGN TO OUT01.                   
                                                                                
                                                                                
      *****************************************************************         
       DATA DIVISION.                                                           
      *****************************************************************         
       FILE SECTION.                                                            
                                                                                
       FD  CNT-STORE-EXP-FILE                                                   
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS                                             
           DATA RECORD IS CNT-STORE-EXP-REC.                                    
       01  CNT-STORE-EXP-REC          PIC  X(32).                               
                                                                                
       FD  CNT-SKU-EXP-FILE                                                     
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS                                             
           DATA RECORD IS CNT-SKU-EXP-REC.                                      
       01  CNT-SKU-EXP-REC        PIC  X(53).                                   
                                                                                
                                                                                
                                                                                
      *                                                                         
       WORKING-STORAGE SECTION.                                                 
      ******************************************************************        
      * PC PROGRAM CONSTANTS                                           *        
      ******************************************************************        
       01  PC-PROGRAM-CONSTANTS.                                                
           05  PC-PROGRAM-NAME                PIC X(08)    VALUE                
C96479                                           'ICKUP153'.                    
           05  PC-MAXIMUM-RETRY-COUNT         PIC S9(04)   VALUE +2             
                                                           COMP SYNC.           
           05  PC-DEFAULT-TMST                PIC X(26)    VALUE                
               '2007-01-01-00.00.00.000000'.                                    
                                                                                
      ******************************************************************        
      * PV PROGRAM VARIABLES                                           *        
      ******************************************************************        
       01  PV-WORK-VARIABLES.                                                   
           05  PV-RETRIES                     PIC S9(04)   VALUE +0             
                                                           COMP.                
           05  PV-PARAGRAPH-NAME              PIC  X(30)   VALUE SPACES.        
           05  PV-COMPLETED-COUNT-FLG         PIC  X       VALUE SPACES.        
           05  PV-DB2-OPERATION-ATTEMPTED     PIC  X(30)   VALUE SPACES.        
           05  PV-SQLCODE-DISPLAY             PIC +(8)9    VALUE ZEROES.00830000
           05  PV-EXTR-PRC-TMST-NI         PIC S9(04)  COMP                     
                                                         VALUE ZERO.            
               88 PV-EXTR-PRC-TMST-IS-NULL VALUE -1.                            
           05  PV-SKU-NBR-NULL-IND         PIC S9(04)  COMP                     
                                                         VALUE ZERO.            
               88 PV-SKU-NBR-IS-NULL       VALUE -1.                            
           05  PV-DEPT-NULL-IND            PIC S9(04)  COMP                CL*15
                                                         VALUE ZERO.       CL*15
               88 PV-DEPT-IS-NULL          VALUE -1.                            
               88 PV-DEPT-IS-NOT-NULL      VALUE 0.                             
           05  PV-MAJ-CL-NULL-IND          PIC S9(04)  COMP                CL*15
                                                         VALUE ZERO.       CL*15
               88 PV-MAJ-CL-IS-NULL        VALUE -1.                            
               88 PV-MAJ-CL-IS-NOT-NULL    VALUE 0.                             
           05  PV-SUB-CL-NULL-IND          PIC S9(04)  COMP                CL*15
                                                         VALUE ZERO.       CL*15
               88 PV-SUB-CL-IS-NULL        VALUE -1.                            
               88 PV-SUB-CL-IS-NOT-NULL    VALUE 0.                             
           05  PV-STYL-ID-NULL-IND         PIC S9(04)  COMP                CL*15
                                                         VALUE ZERO.       CL*15
               88 PV-STYL-ID-IS-NULL       VALUE -1.                            
               88 PV-STYL-ID-IS-NOT-NULL   VALUE 0.                             
           05  PV-GP-CDE-NULL-IND          PIC S9(04)  COMP                CL*15
                                                         VALUE ZERO.       CL*15
               88 PV-GP-CDE-IS-NULL        VALUE -1.                            
               88 PV-GP-CDE-IS-NOT-NULL    VALUE 0.                             
           05  PV-SKU-NULL-IND             PIC S9(04)  COMP                CL*15
                                                         VALUE ZERO.       CL*15
               88 PV-SKU-IS-NULL           VALUE -1.                            
               88 PV-SKU-IS-NOT-NULL       VALUE 0.                             
           05  PV-ORIG-CLR-DTE-NULL-IND    PIC S9(04)  COMP                CL*15
                                                         VALUE ZERO.       CL*15
               88 PV-ORIG-CLR-DTE-IS-NULL  VALUE -1.                            
               88 PV-ORIG-CLR-DTEIS-NOT-NULL VALUE 0.                           
           05  PV-COMMITS-TAKEN            PIC S9(09)  COMP-3              CL*15
                                                         VALUE ZERO.       CL*15
           05  PV-COMMIT-INTERVAL          PIC S9(09)  COMP-3              CL**4
                                                       VALUE +1500.        CL**4
           05  PV-CURRENT-WEEKDAY          PIC 9.                          CL**4
           05  PV-CURRENT-WEEK-NBR         PIC 9.                          CL**4
           05  PV-DECREMENT-1ST            PIC 9.                          CL**4
           05  PV-CURRENT-DATE             PIC X(10).                      CL**4
           05  PV-CURRENT-TMST             PIC X(26).                      CL**4
      *    05  PV-LOCATION-TMST            PIC X(26).                      CL**4
           05  PV-LAST-RUN-TMST            PIC X(26).                      CL**4
           05  PV-LAST-IMM-TMST            PIC X(26).                      CL**4
916792     05  PV-LOC-NBR                  PIC S9(4) COMP VALUE ZEROES.    CL**4
851489     05  PV-CURRENT-TMST-HOLD        PIC X(26).                      CL**4
851489     05  PV-LAST-UPD-TMST-PLUS2      PIC X(26).                      CL**4
      ******************************************************************        
      * PS PROGRAM SWITCHES                                            *        
      ******************************************************************        
       01  PS-PROGRAM-SWITCHES.                                                 
           05  PS-END-OF-INPUT-FILE-SW        PIC  X(01)   VALUE 'N'.           
               88  PS-END-OF-INPUT-FILE                    VALUE 'Y'.           
           05  PS-NO-MORE-COUNT-SKUS-SW       PIC  X(01)   VALUE 'N'.           
               88  PS-NO-MORE-COUNT-SKUS                   VALUE 'Y'.           
               88  PS-MORE-COUNT-SKUS                      VALUE 'N'.           
           05  PS-NO-MORE-IMM-CNT-SW          PIC  X(01)   VALUE 'N'.           
               88  PS-NO-MORE-IMM-CNT                      VALUE 'Y'.           
               88  PS-MORE-IMM-CNT                         VALUE 'N'.           
           05  PS-NO-MORE-MC-SKUS-SW          PIC  X(01)   VALUE 'N'.           
               88  PS-NO-MORE-MC-SKUS                      VALUE 'Y'.           
               88  PS-MORE-MC-SKUS                         VALUE 'N'.           
           05  PS-NO-MORE-SC-SKUS-SW          PIC  X(01)   VALUE 'N'.           
               88  PS-NO-MORE-SC-SKUS                      VALUE 'Y'.           
               88  PS-MORE-SC-SKUS                         VALUE 'N'.           
           05  PS-NO-MORE-STYLE-CSR-SW        PIC  X(01)   VALUE 'N'.           
               88  PS-NO-MORE-STYLE-CSR                    VALUE 'Y'.           
               88  PS-MORE-STYLE-CSR                       VALUE 'N'.           
           05  PS-NO-MORE-GP-CDE-CSR-SW       PIC  X(01)   VALUE 'N'.           
               88  PS-NO-MORE-GP-CDE-CSR                   VALUE 'Y'.           
               88  PS-MORE-GP-CDE-CSR                      VALUE 'N'.           
CR9773     05  PS-SKU-FOUND-SW                PIC  X(01)   VALUE 'N'.           
CR9773         88  PS-SKU-FOUND                            VALUE 'Y'.           
CR9773         88  PS-SKU-NOT-FOUND                        VALUE 'N'.           
           05  PS-PROCESS-STOP-SW             PIC  X(01)   VALUE 'N'.           
               88  PS-PROCESS-STOP                         VALUE 'Y'.           
           05  PS-LAST-RUN-TMST-FOUND-SW      PIC  X(01)   VALUE 'N'.           
               88  PS-LAST-RUN-TMST-FOUND                  VALUE 'Y'.           
           05  PS-LAST-IMM-TMST-FOUND-SW      PIC  X(01)   VALUE 'N'.           
               88  PS-LAST-IMM-TMST-FOUND                  VALUE 'Y'.           
CR9773     05  PS-END-OF-TEMP-CSR-SW          PIC  X(01)   VALUE 'N'.           
CR9773         88  PS-END-OF-TEMP-CSR                      VALUE 'Y'.           
                                                                                
       01  ABEND-CODE                         PIC S9(04)   VALUE +0             
                                                           COMP SYNC.           
                                                                                
       01  DISPLAY-EDITS.                                                       
           05  DI-ACT-CNTR                  PIC  9(09)  VALUE ZEROS.            
           05  DI-CLR-CNTR                  PIC  9(09)  VALUE ZEROS.            
           05  DI-IMMED-CNTR                PIC  9(09)  VALUE ZEROS.            
           05  DI-COMMIT-CNTR               PIC  9(09)  VALUE ZEROS.            
                                                                                
      *                                                                         
      *****************************************************************         
      *    INPUT/OUTPUT COPYBOOKS                                               
      *****************************************************************         
           COPY ICRD052.                                                        
                                                                                
           COPY ICRD053.                                                        
                                                                                
      *****************************************************************         
      *    DB2 COMMUNICATION AREA                                               
      *****************************************************************         
           COPY DPWS004.                                                        
                                                                                
      *****************************************************************         
      *  XST_LOC TABLE                                                          
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE XST00001                                                
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  XST_SKU_LOC TABLE                                                      
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE XST00008                                                
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  XST_SKU TABLE                                                          
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE XST00010                                                
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  XST_VND_STYL  TABLE                                                    
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE XST00013                                                
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  ICT_CNT_LOC_GP TABLE                                                   
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE ICT00014                                                
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  ICT_LOC_GP_ASSN TABLE                                                  
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE ICT00015                                                
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  ICT_CNT_STUP_STAT TABLE                                                
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE ICT00019                                                
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  ICT_CNT_MDSE_GP TABLE                                                  
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE ICT00016                                                
           END-EXEC.                                                            
      *****************************************************************         
      *  ICT_CNT_STUP TABLE                                                     
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE ICT00010                                                
           END-EXEC.                                                            
      *****************************************************************         
      *  ICT_CNT_EXTR_PRC TABLE                                                 
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE ICT00007                                                
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  ICT_LOC_CNT_STAT TABLE                                                 
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE ICT00020                                                
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  ICT_MDSE_GP_ASSN TABLE                                                 
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE ICT00017                                                
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  ICT_CNT_RPET_PARM TABLE                                                
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE ICT00013                                                
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  TDTATTR DATE TABLE                                                     
      *****************************************************************         
           EXEC SQL                                                             
                INCLUDE TDTATTR                                                 
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE SQLCA                                                    
           END-EXEC.                                                            
                                                                                
           COPY SQLCA2.                                                         
                                                                                
      *----------------------------------------------------------------         
      *  USA IC COUNTS CURSOR WILL FETCH COUNT GROUPINGS.                       
      *----------------------------------------------------------------         
           EXEC SQL                                                             
             DECLARE CNT-GRP-CSR CURSOR FOR                                     
             SELECT  B.DEPT_NBR                                                 
                    ,B.MAJ_CL_NBR                                               
                    ,B.SUB_CL_NBR                                               
                    ,B.STYL_ID                                                  
                    ,B.SKU_NBR                                                  
                    ,B.GP_CDE                                                   
C92330              ,D.CNT_TYP_CDE                                              
CR9773     FROM    SESSION.TESTT    T                                           
                  ,ICT_MDSE_GP_ASSN A                                           
                  ,ICT_CNT_MDSE_GP  B                                           
C92330            ,ICT_CNT_STUP     D                                           
           WHERE A.CNT_STUP_ID       = :ICT00017-CNT-STUP-ID                    
             AND B.LAST_ACTN_CDE     = 'A'                                      
             AND B.MDSE_GP_ID        = A.MDSE_GP_ID                             
             AND B.MDSE_GP_ID        = T.MDSE_GP_ID                             
             AND B.LAST_UPD_TMST     = T.MAX_TMST                               
C92330       AND A.CNT_STUP_ID       = D.CNT_STUP_ID                            
           END-EXEC.                                                            
                                                                                
      *----------------------------------------------------------------         
      *  USA IC COUNTS CURSOR WILL FETCH IMMEDIATE AND SKU LEVEL COUNTS         
      *----------------------------------------------------------------         
           EXEC SQL                                                             
             DECLARE IMM-CNT-CSR CURSOR FOR                                     
             SELECT A.LOC_HIER_CDE                                              
                   ,A.LOC_HIER_VAL_NBR                                          
                   ,D.EXCL_MDSE_IND                                             
                   ,D.CNT_STUP_ID                                               
                   ,J.DEPT_NBR                                                  
                   ,J.MAJ_CL_NBR                                                
                   ,J.SUB_CL_NBR                                                
                   ,J.STYL_ID                                                   
                   ,J.SKU_NBR                                                   
                   ,J.GP_CDE                                                    
                   ,J.SKU_NBR                                                   
C92330             ,D.CNT_TYP_CDE                                               
      *** GET CURRENT MDSE GROUP DATA                                           
CR9773       FROM   SESSION.TESTT     T                                         
                   ,ICT_CNT_LOC_GP    A                                         
                   ,ICT_LOC_GP_ASSN   B                                         
                   ,ICT_CNT_STUP_STAT C                                         
                   ,ICT_CNT_STUP      D                                         
                   ,ICT_MDSE_GP_ASSN  I                                         
                   ,ICT_CNT_MDSE_GP   J                                         
             WHERE A.LOC_GP_ID           = B.LOC_GP_ID                          
               AND A.LAST_ACTN_CDE       = 'A'                                  
               AND B.CNT_STUP_ID         = D.CNT_STUP_ID                        
               AND C.CNT_STUP_ID         = D.CNT_STUP_ID                        
               AND I.CNT_STUP_ID         = D.CNT_STUP_ID                        
               AND A.LOC_HIER_CDE        = 'STR'                                
               AND C.CNT_STAT_CDE        = 'SCH'                                
117191         AND D.CNT_TYP_CDE         = 'USA'                                
               AND J.MDSE_GP_ID          = I.MDSE_GP_ID                         
               AND J.MDSE_GP_ID          = T.MDSE_GP_ID                         
               AND J.LAST_UPD_TMST       = T.MAX_TMST                           
      *        AND J.SKU_NBR            IS NOT NULL                             
      *** IN IMMEDIATE CNTS ALL DATES WILL EQUAL CURRENT DATE                   
               AND DATE(C.LAST_UPD_TMST) = CURRENT_DATE                         
               AND D.SUGG_EXEC_DTE       = CURRENT_DATE                         
               AND D.EXEC_WND_STRT_DTE   = CURRENT_DATE                         
               AND D.EXEC_WND_END_DTE    = CURRENT_DATE                         
               AND J.LAST_ACTN_CDE       = 'A'                                  
               AND A.LAST_ACTN_CDE       = 'A'                                  
               AND A.LAST_UPD_TMST       =                                      
      *** GET LATEST ICT_CNT_LOC_GP ROW                                         
               (SELECT MAX(H.LAST_UPD_TMST)                                     
                FROM ICT_CNT_LOC_GP     H                                       
                WHERE H.LOC_GP_ID        = A.LOC_GP_ID                          
                  AND H.LOC_HIER_CDE     = A.LOC_HIER_CDE                       
                  AND H.LOC_HIER_VAL_NBR = A.LOC_HIER_VAL_NBR)                  
      *** GET LATEST ICT_CNT_STUP ROW                                           
               AND D.LAST_UPD_TMST  =                                           
             (SELECT MAX(E.LAST_UPD_TMST)                                       
              FROM ICT_CNT_STUP       E                                         
              WHERE E.CNT_STUP_ID   = C.CNT_STUP_ID)                            
      *** EXCLUDE REPEATING COUNTS                                              
               AND NOT EXISTS                                                   
             (SELECT 'Y'                                                        
              FROM ICT_CNT_RPET_PARM  G                                         
              WHERE G.CNT_STUP_ID   = D.CNT_STUP_ID)                            
      *** EXCLUDE CANCELLED OR PROCESSED COUNTS                                 
               AND NOT EXISTS                                                   
             (SELECT 'Y'                                                        
              FROM ICT_CNT_STUP_STAT  M                                         
              WHERE M.CNT_STUP_ID   = D.CNT_STUP_ID                             
                AND M.CNT_STAT_CDE IN ('PRO','CAN'))                            
           END-EXEC.                                                            
      *----------------------------------------------------------------         
      *  USA IC COUNTS CURSOR WILL FETCH SKUS WITHIN A MAJOR CLASS              
      *----------------------------------------------------------------         
           EXEC SQL                                                             
             DECLARE MAJ-CLS-CSR CURSOR FOR                                     
             SELECT C.SKU_NBR                                                   
                   ,A.UNT_RTL_AMT                                               
                   ,A.LOC_SKU_STAT_CDE                                          
                   ,A.ORIG_CLR_DTE                                              
916792             ,A.LOC_NBR                                                   
             FROM    XST_SKU                 C                                  
                    ,XST_VND_STYL            D                                  
                    ,XST_SKU_LOC             A                                  
             WHERE D.DEPT_NBR       = :XST00013-DEPT-NBR                        
               AND D.MAJ_CL_NBR     = :XST00013-MAJ-CL-NBR                      
               AND C.STYL_ID        = D.STYL_ID                                 
               AND (A.LOC_NBR       = :XST00008-LOC-NBR                         
               AND  A.BEG_TMST     <= CURRENT TIMESTAMP                         
              AND (A.END_TMST      > CURRENT TIMESTAMP                          
               OR  A.END_TMST    IS NULL)                                       
               AND  A.INTR_UPC_ID   = C.INTR_UPC_ID)                            
C17705         AND  A.LOC_SKU_STAT_CDE NOT IN('30')                             
CR9773       UNION ALL                                                          
             SELECT C.SKU_NBR                                                   
                   ,E.UNT_RTL_AMT                                               
                   ,E.LOC_SKU_STAT_CDE                                          
                   ,E.ORIG_CLR_DTE                                              
916792             ,E.LOC_NBR                                                   
             FROM    XST_SKU                 C                                  
                    ,XST_VND_STYL            D                                  
                    ,XST_SKU_LOC             E                                  
             WHERE D.DEPT_NBR       = :XST00013-DEPT-NBR                        
               AND D.MAJ_CL_NBR     = :XST00013-MAJ-CL-NBR                      
               AND C.STYL_ID        = D.STYL_ID                                 
               AND (E.LOC_NBR       = 0                                         
               AND  E.BEG_TMST     <= CURRENT TIMESTAMP                         
               AND (E.END_TMST      > CURRENT TIMESTAMP                         
               OR  E.END_TMST    IS NULL)                                       
               AND  E.INTR_UPC_ID   = C.INTR_UPC_ID)                            
C17705         AND  E.LOC_SKU_STAT_CDE NOT IN('30')                             
               AND NOT EXISTS ( SELECT 1 FROM  XST_SKU_LOC           F          
             WHERE E.INTR_UPC_ID    = F.INTR_UPC_ID                             
               AND  F.LOC_NBR       =  :XST00008-LOC-NBR                        
               AND  F.BEG_TMST     <= CURRENT TIMESTAMP                         
               AND (F.END_TMST      > CURRENT TIMESTAMP                         
                OR  F.END_TMST    IS NULL))                                     
           END-EXEC.                                                            
                                                                                
      *----------------------------------------------------------------         
      *  USA IC COUNTS CURSOR WILL FETCH SKUS WITHIN A SUB CLASS                
      *----------------------------------------------------------------         
           EXEC SQL                                                             
             DECLARE SUB-CLS-CSR CURSOR FOR                                     
             SELECT  C.SKU_NBR                                                  
                    ,A.UNT_RTL_AMT                                              
                    ,A.LOC_SKU_STAT_CDE                                         
                    ,A.ORIG_CLR_DTE                                             
916792              ,A.LOC_NBR                                                  
             FROM    XST_SKU         C                                          
                    ,XST_VND_STYL    D                                          
                    ,XST_SKU_LOC     A                                          
             WHERE D.DEPT_NBR       = :XST00013-DEPT-NBR                        
               AND D.MAJ_CL_NBR     = :XST00013-MAJ-CL-NBR                      
               AND D.SUB_CL_NBR     = :XST00013-SUB-CL-NBR                      
               AND C.STYL_ID        = D.STYL_ID                                 
               AND (A.LOC_NBR       = :XST00008-LOC-NBR                         
               AND  A.BEG_TMST     <= CURRENT TIMESTAMP                         
              AND (A.END_TMST      > CURRENT TIMESTAMP                          
               OR  A.END_TMST    IS NULL)                                       
               AND  A.INTR_UPC_ID   = C.INTR_UPC_ID)                            
C17705         AND  A.LOC_SKU_STAT_CDE NOT IN('30')                             
             UNION                                                              
             SELECT  C.SKU_NBR                                                  
                    ,E.UNT_RTL_AMT                                              
                    ,E.LOC_SKU_STAT_CDE                                         
                    ,E.ORIG_CLR_DTE                                             
916792              ,E.LOC_NBR                                                  
             FROM    XST_SKU         C                                          
                    ,XST_VND_STYL    D                                          
                    ,XST_SKU_LOC     E                                          
             WHERE D.DEPT_NBR       = :XST00013-DEPT-NBR                        
               AND D.MAJ_CL_NBR     = :XST00013-MAJ-CL-NBR                      
               AND D.SUB_CL_NBR     = :XST00013-SUB-CL-NBR                      
               AND C.STYL_ID        = D.STYL_ID                                 
               AND (E.LOC_NBR       = 0                                         
               AND  E.BEG_TMST     <= CURRENT TIMESTAMP                         
              AND (E.END_TMST      > CURRENT TIMESTAMP                          
               OR  E.END_TMST    IS NULL)                                       
              AND  E.INTR_UPC_ID   = C.INTR_UPC_ID)                             
C17705        AND  E.LOC_SKU_STAT_CDE NOT IN('30')                              
              AND NOT EXISTS ( SELECT 1 FROM  XST_SKU_LOC           F           
             WHERE E.INTR_UPC_ID    = F.INTR_UPC_ID                             
               AND  F.LOC_NBR       =  :XST00008-LOC-NBR                        
               AND  F.BEG_TMST     <= CURRENT TIMESTAMP                         
               AND (F.END_TMST      > CURRENT TIMESTAMP                         
                OR  F.END_TMST    IS NULL))                                     
           END-EXEC.                                                            
                                                                                
      *----------------------------------------------------------------         
      *  USA IC COUNTS CURSOR WILL FETCH SKUS WITHIN A STYLE                    
      *----------------------------------------------------------------         
           EXEC SQL                                                             
             DECLARE STYLE-CSR CURSOR FOR                                       
             SELECT  C.SKU_NBR                                                  
                    ,A.UNT_RTL_AMT                                              
                    ,A.LOC_SKU_STAT_CDE                                         
                    ,A.ORIG_CLR_DTE                                             
916792              ,A.LOC_NBR                                                  
             FROM    XST_SKU         C                                          
                    ,XST_SKU_LOC     A                                          
             WHERE C.STYL_ID       = :XST00010-STYL-ID                          
              AND (A.LOC_NBR       = :XST00008-LOC-NBR                          
              AND  A.BEG_TMST     <= CURRENT TIMESTAMP                          
              AND (A.END_TMST      > CURRENT TIMESTAMP                          
               OR  A.END_TMST    IS NULL)                                       
              AND  A.INTR_UPC_ID   = C.INTR_UPC_ID)                             
C17705        AND  A.LOC_SKU_STAT_CDE NOT IN('30')                              
             UNION                                                              
             SELECT  C.SKU_NBR                                                  
                    ,E.UNT_RTL_AMT                                              
                    ,E.LOC_SKU_STAT_CDE                                         
                    ,E.ORIG_CLR_DTE                                             
916792              ,E.LOC_NBR                                                  
             FROM    XST_SKU         C                                          
                    ,XST_SKU_LOC     E                                          
             WHERE C.STYL_ID       = :XST00010-STYL-ID                          
              AND (E.LOC_NBR       = 0                                          
              AND  E.BEG_TMST     <= CURRENT TIMESTAMP                          
              AND (E.END_TMST      > CURRENT TIMESTAMP                          
               OR  E.END_TMST    IS NULL)                                       
              AND  E.INTR_UPC_ID   = C.INTR_UPC_ID)                             
C17705        AND  E.LOC_SKU_STAT_CDE NOT IN('30')                              
              AND NOT EXISTS ( SELECT 1 FROM  XST_SKU_LOC           F           
             WHERE E.INTR_UPC_ID    = F.INTR_UPC_ID                             
               AND  F.LOC_NBR       =  :XST00008-LOC-NBR                        
               AND  F.BEG_TMST     <= CURRENT TIMESTAMP                         
               AND (F.END_TMST      > CURRENT TIMESTAMP                         
                OR  F.END_TMST    IS NULL))                                     
           END-EXEC.                                                            
                                                                                
      *----------------------------------------------------------------         
      *  USA IC COUNTS CURSOR WILL FETCH SKUS WITHIN A GROUP CODE               
      *----------------------------------------------------------------         
           EXEC SQL                                                             
             DECLARE GP-CDE-CSR CURSOR FOR                                      
             SELECT  C.SKU_NBR                                                  
                    ,A.UNT_RTL_AMT                                              
                    ,A.LOC_SKU_STAT_CDE                                         
                    ,A.ORIG_CLR_DTE                                             
916792              ,A.LOC_NBR                                                  
             FROM    XST_SKU         C                                          
                    ,XST_SKU_LOC     A                                          
             WHERE C.GP_CDE        = :XST00010-GP-CDE                           
              AND (A.LOC_NBR       = :XST00008-LOC-NBR                          
              AND  A.BEG_TMST     <= CURRENT TIMESTAMP                          
              AND (A.END_TMST      > CURRENT TIMESTAMP                          
               OR  A.END_TMST    IS NULL)                                       
              AND  A.INTR_UPC_ID   = C.INTR_UPC_ID)                             
C17705        AND  A.LOC_SKU_STAT_CDE NOT IN('30')                              
             UNION                                                              
             SELECT  C.SKU_NBR                                                  
                    ,E.UNT_RTL_AMT                                              
                    ,E.LOC_SKU_STAT_CDE                                         
                    ,E.ORIG_CLR_DTE                                             
916792              ,E.LOC_NBR                                                  
             FROM    XST_SKU         C                                          
                    ,XST_SKU_LOC     E                                          
             WHERE C.GP_CDE        = :XST00010-GP-CDE                           
              AND (E.LOC_NBR       = :XST00008-LOC-NBR                          
              AND  E.BEG_TMST     <= CURRENT TIMESTAMP                          
              AND (E.END_TMST      > CURRENT TIMESTAMP                          
               OR  E.END_TMST    IS NULL)                                       
              AND  E.INTR_UPC_ID   = C.INTR_UPC_ID)                             
C17705        AND  E.LOC_SKU_STAT_CDE NOT IN('30')                              
              AND NOT EXISTS ( SELECT 1 FROM  XST_SKU_LOC           F           
             WHERE E.INTR_UPC_ID    = F.INTR_UPC_ID                             
               AND  F.LOC_NBR       =  :XST00008-LOC-NBR                        
               AND  F.BEG_TMST     <= CURRENT TIMESTAMP                         
               AND (F.END_TMST      > CURRENT TIMESTAMP                         
                OR  F.END_TMST    IS NULL))                                     
           END-EXEC.                                                            
                                                                                
CR9773*----------------------------------------------------------------         
CR9773*  TEST CURSOR WILL FETCH MDSE GROUP ID FOR TEMP TABLE TESTT              
CR9773*----------------------------------------------------------------         
CR9773     EXEC SQL                                                             
CR9773       DECLARE TEMP-CSR CURSOR FOR                                        
CR9773       SELECT MAX(LAST_UPD_TMST) AS MAX_TMST                              
CR9773              ,MDSE_GP_ID                                                 
CR9773       FROM ICT_CNT_MDSE_GP                                               
CR9773       GROUP BY  MDSE_GP_ID                                               
CR9773                ,DEPT_NBR                                                 
CR9773                ,MAJ_CL_NBR                                               
CR9773                ,SUB_CL_NBR                                               
CR9773                ,STYL_ID                                                  
CR9773                ,SKU_NBR                                                  
CR9773                ,GP_CDE                                                   
CR9773                ,SKU_NBR                                                  
CR9773     END-EXEC.                                                            
                                                                                
       PROCEDURE DIVISION.                                                      
      ******************************************************************        
      * 0000-MAIN-MODULE.                                              *        
      *  ==> PROCESSES:                                                *        
      *    - CONTROLS HIGHEST LEVEL FLOW OF PROGRAM                    *        
      ******************************************************************        
       0000-MAIN-MODULE.                                                        
           MOVE '0000-MAIN-MODULE' TO PV-PARAGRAPH-NAME.                        
                                                                                
           PERFORM 1000-INITIALIZATION.                                         
                                                                                
CR9773     PERFORM 1200-TEMP-TABLE-PROCESS                                      
           PERFORM 7000-READ-CNT-STORE-EXP-FL.                                  
           PERFORM 2000-PROCESS-COUNT-SKUS                                      
             UNTIL PS-END-OF-INPUT-FILE.                                        
           DISPLAY 'COUNT/LOC PROCESSING DONE'.                                 
                                                                                
           PERFORM 2200-PROCESS-IMMED-COUNTS.                                   
                                                                                
           PERFORM 3000-EOJ-PROCESSING.                                         
                                                                                
           STOP RUN.                                                            
                                                                                
      ******************************************************************        
      * 1000-INITIALIZATION.                                           *        
      ******************************************************************        
       1000-INITIALIZATION.                                                     
           MOVE '1000-INITIALIZATION ' TO PV-PARAGRAPH-NAME.                    
                                                                                
           PERFORM 8925-SELECT-LAST-IMM-TMST.                                   
           IF PV-EXTR-PRC-TMST-IS-NULL                                          
             MOVE PC-DEFAULT-TMST TO PV-LAST-IMM-TMST                           
           ELSE                                                                 
             MOVE ICT00007-EXTR-PRC-TMST TO PV-LAST-IMM-TMST.                   
           DISPLAY 'LAST IMMEDIATE RUN WAS -  ' PV-LAST-IMM-TMST.               
                                                                                
           OPEN INPUT  CNT-STORE-EXP-FILE                                       
                OUTPUT CNT-SKU-EXP-FILE.                                        
                                                                                
           PERFORM 1100-CALENDAR-DAY-OF-WEEK.                                   
                                                                                
       1100-CALENDAR-DAY-OF-WEEK.                                               
           MOVE '1100-CALENDAR-DAY-OF-WEEK' TO PV-PARAGRAPH-NAME.               
           EXEC SQL                                                             
               SET :PV-CURRENT-DATE = CURRENT DATE                              
           END-EXEC.                                                            
                                                                                
           EXEC SQL                                                             
               SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                         
           END-EXEC.                                                            
                                                                                
CR9773******************************************************************        
CR9773* PROCESSING OF TEMPORARY TABLE                                           
CR9773******************************************************************        
CR9773 1200-TEMP-TABLE-PROCESS.                                                 
CR9773     PERFORM 1210-CREATE-TEMP-TABLE                                       
CR9773     PERFORM 1300-CREATE-INDEX-TABLE                                      
CR9773     PERFORM 1400-OPEN-TEMP-CSR                                           
CR9773     PERFORM 1500-FETCH-TEMP-CSR UNTIL PS-END-OF-TEMP-CSR                 
CR9773     PERFORM 1600-CLOSE-TEMP-CSR                                          
CR9773     .                                                                    
CR9773                                                                          
CR9773******************************************************************        
CR9773* CREATE TEMPORARY TABLE TESTT                                            
CR9773******************************************************************        
CR9773 1210-CREATE-TEMP-TABLE.                                                  
CR9773                                                                          
CR9773     MOVE '1200-CREATE-TEMP-TABLE' TO PV-PARAGRAPH-NAME.                  
CR9773     EXEC SQL                                                             
CR9773       DECLARE GLOBAL TEMPORARY TABLE SESSION.TESTT                       
CR9773         ( MAX_TMST TIMESTAMP NOT NULL,                                   
CR9773           MDSE_GP_ID INTEGER NOT NULL)                                   
CR9773         ON COMMIT PRESERVE ROWS                                          
259021         NOT LOGGED ON ROLLBACK DELETE ROWS                               
CR9773     END-EXEC.                                                            
CR9773                                                                          
CR9773     EVALUATE TRUE                                                        
CR9773       WHEN SQLCODE = 0                                                   
CR9773         CONTINUE                                                         
CR9773       WHEN OTHER                                                         
CR9773         SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 CREATE TEMP TABLE'                          
CR9773                 ' HAD SQLCODE OF ' SQLCODE                               
CR9773         PERFORM 9999-SQL-ABEND                                           
CR9773     END-EVALUATE.                                                        
CR9773                                                                          
CR9773******************************************************************        
CR9773* CREATE INDEX FOR TEMPORARY TABLE TESTT                                  
CR9773******************************************************************        
CR9773 1300-CREATE-INDEX-TABLE.                                                 
CR9773                                                                          
CR9773     MOVE '1300-CREATE-INDEX-TABLE' TO PV-PARAGRAPH-NAME.                 
CR9773     EXEC SQL                                                             
CR9773       CREATE UNIQUE INDEX SESSION.ITESTT0                                
CR9773       ON SESSION.TESTT                                                   
CR9773       (MAX_TMST  ASC,                                                    
CR9773        MDSE_GP_ID  ASC)                                                  
228316**     CLUSTER                                                            
228316**     USING STOGROUP STGM000                                             
228316**      PRIQTY   720                                                      
228316**      SECQTY   720                                                      
228316**      BUFFERPOOL BP2                                                    
CR9773     END-EXEC.                                                            
CR9773                                                                          
CR9773     EVALUATE TRUE                                                        
CR9773       WHEN SQLCODE = 0                                                   
CR9773         CONTINUE                                                         
CR9773       WHEN OTHER                                                         
CR9773         SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 CREATE TEMP INDEX TABLE'                    
CR9773                 ' HAD SQLCODE OF ' SQLCODE                               
CR9773         PERFORM 9999-SQL-ABEND                                           
CR9773     END-EVALUATE.                                                        
CR9773                                                                          
CR9773******************************************************************        
CR9773* OPEN THE TEMP-CSR                                                       
CR9773******************************************************************        
CR9773 1400-OPEN-TEMP-CSR.                                                      
CR9773                                                                          
CR9773     MOVE '1400-OPEN-TEMP-CSR' TO PV-PARAGRAPH-NAME.                      
CR9773                                                                          
CR9773     PERFORM                                                              
CR9773         WITH TEST AFTER                                                  
CR9773         VARYING PV-RETRIES                                               
CR9773         FROM 1 BY 1                                                      
CR9773         UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
CR9773                PS-PROCESS-STOP                    OR                     
CR9773                SQLCODE = 0)                                              
CR9773                                                                          
CR9773           EXEC SQL                                                       
CR9773             OPEN TEMP-CSR                                                
CR9773           END-EXEC                                                       
CR9773                                                                          
CR9773         EVALUATE TRUE                                                    
CR9773           WHEN SQLCODE = -904                                            
CR9773           WHEN SQLCODE = -911                                            
CR9773           WHEN SQLCODE = -913                                            
CR9773               CONTINUE                                                   
CR9773           WHEN SQLCODE = 0                                               
CR9773               CONTINUE                                                   
CR9773           WHEN OTHER                                                     
CR9773               SET PS-PROCESS-STOP TO TRUE                                
CR9773         END-EVALUATE                                                     
CR9773     END-PERFORM.                                                         
CR9773                                                                          
CR9773     IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
CR9773        PS-PROCESS-STOP                                                   
CR9773         SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 OPEN OF TEMP-CSR CURSOR'                    
CR9773                 ' HAD SQLCODE OF ' SQLCODE                               
CR9773         PERFORM 9999-SQL-ABEND                                           
CR9773     END-IF.                                                              
CR9773                                                                          
CR9773******************************************************************        
CR9773* FETCH THE TEMP-CSR                                                      
CR9773******************************************************************        
CR9773 1500-FETCH-TEMP-CSR.                                                     
CR9773                                                                          
CR9773     MOVE '1500-FETCH-TEMP-CSR' TO PV-PARAGRAPH-NAME.                     
CR9773                                                                          
CR9773     PERFORM                                                              
CR9773         WITH TEST AFTER                                                  
CR9773         VARYING PV-RETRIES                                               
CR9773         FROM 1 BY 1                                                      
CR9773         UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
CR9773                PS-PROCESS-STOP                   OR                      
CR9773                SQLCODE = 0                       OR                      
CR9773                SQLCODE = +100)                                           
CR9773                                                                          
CR9773           EXEC SQL                                                       
CR9773              FETCH TEMP-CSR                                              
CR9773              INTO  :ICT00016-LAST-UPD-TMST                               
CR9773                   ,:ICT00016-MDSE-GP-ID                                  
CR9773           END-EXEC                                                       
CR9773                                                                          
CR9773          EVALUATE TRUE                                                   
CR9773              WHEN SQLCODE = -904                                         
CR9773              WHEN SQLCODE = -911                                         
CR9773              WHEN SQLCODE = -913                                         
CR9773                  CONTINUE                                                
CR9773              WHEN SQLCODE = ZERO                                         
CR9773                  PERFORM 1510-INSERT-TESTT-TABLE                         
CR9773              WHEN SQLCODE = +100                                         
CR9773                  SET PS-END-OF-TEMP-CSR     TO TRUE                      
CR9773              WHEN OTHER                                                  
CR9773                  SET PS-PROCESS-STOP        TO TRUE                      
CR9773          END-EVALUATE                                                    
CR9773     END-PERFORM.                                                         
CR9773                                                                          
CR9773     IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
CR9773        PS-PROCESS-STOP                                                   
CR9773         SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 FETCH OF TEMP-CSR CURSOR'                   
CR9773                 ' HAD SQLCODE OF ' SQLCODE                               
CR9773         PERFORM 9999-SQL-ABEND                                           
CR9773     END-IF.                                                              
CR9773                                                                          
CR9773******************************************************************        
CR9773* INSERT RECORD INTO TEMP TABLE TESTT                                     
CR9773******************************************************************        
CR9773 1510-INSERT-TESTT-TABLE.                                                 
CR9773                                                                          
CR9773     MOVE '1510-INSERT-TESTT-TABLE' TO PV-PARAGRAPH-NAME.                 
CR9773                                                                          
CR9773     EXEC SQL                                                             
CR9773       INSERT INTO SESSION.TESTT                                          
CR9773       (MAX_TMST                                                          
CR9773       ,MDSE_GP_ID)                                                       
CR9773       VALUES                                                             
CR9773       (:ICT00016-LAST-UPD-TMST                                           
CR9773       ,:ICT00016-MDSE-GP-ID)                                             
CR9773     END-EXEC.                                                            
CR9773                                                                          
CR9773     EVALUATE TRUE                                                        
CR9773        WHEN SQLCODE = 0                                                  
CR9773            CONTINUE                                                      
CR9773        WHEN OTHER                                                        
CR9773            SET PS-PROCESS-STOP    TO TRUE                                
C96479            DISPLAY '** ICKUP153 INSERT INTO TESTT TABLE'                 
CR9773                    ' HAD SQLCODE OF ' SQLCODE                            
CR9773            PERFORM 9999-SQL-ABEND                                        
CR9773     END-EVALUATE.                                                        
CR9773                                                                          
CR9773******************************************************************        
CR9773* CLOSE THE TEMP-CSR                                                      
CR9773******************************************************************        
CR9773 1600-CLOSE-TEMP-CSR.                                                     
CR9773                                                                          
CR9773     MOVE '1600-CLOSE-TEMP-CSR' TO PV-PARAGRAPH-NAME.                     
CR9773                                                                          
CR9773     PERFORM                                                              
CR9773         WITH TEST AFTER                                                  
CR9773         VARYING PV-RETRIES                                               
CR9773         FROM 1 BY 1                                                      
CR9773         UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
CR9773                PS-PROCESS-STOP                    OR                     
CR9773                SQLCODE = 0)                                              
CR9773                                                                          
CR9773           EXEC SQL                                                       
CR9773              CLOSE TEMP-CSR                                              
CR9773           END-EXEC                                                       
CR9773                                                                          
CR9773          EVALUATE TRUE                                                   
CR9773             WHEN SQLCODE = -904                                          
CR9773             WHEN SQLCODE = -911                                          
CR9773             WHEN SQLCODE = -913                                          
CR9773                 CONTINUE                                                 
CR9773             WHEN SQLCODE = 0                                             
CR9773                 CONTINUE                                                 
CR9773             WHEN OTHER                                                   
CR9773                 SET PS-PROCESS-STOP TO TRUE                              
CR9773          END-EVALUATE                                                    
CR9773     END-PERFORM.                                                         
CR9773                                                                          
CR9773     IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
CR9773        PS-PROCESS-STOP                                                   
CR9773         SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 CLOSE OF TEMP-CSR CURSOR'                   
CR9773                 ' HAD SQLCODE OF ' SQLCODE                               
CR9773         PERFORM 9999-SQL-ABEND                                           
CR9773     END-IF.                                                              
CR9773                                                                          
      ******************************************************************        
      * 2000-PROCESS-COUNT-SKUS.                                       *        
      *  ==> FINDS ALL SKUS FOR EACH COUNT/LOCATION                    *        
      ******************************************************************        
       2000-PROCESS-COUNT-SKUS.                                                 
           MOVE '2000-PROCESS-COUNT-SKUS' TO PV-PARAGRAPH-NAME.                 
           MOVE ICRD052-CNT-STUP-ID TO ICT00015-CNT-STUP-ID                     
                                       ICT00017-CNT-STUP-ID.                    
           SET PS-MORE-COUNT-SKUS TO TRUE.                                      
           PERFORM 8100-OPEN-CNT-GRP.                                           
           PERFORM 8110-FETCH-CNT-GRP.                                          
           PERFORM 2100-PROCESS-SKUS                                            
             UNTIL PS-NO-MORE-COUNT-SKUS.                                       
           PERFORM 8120-CLOSE-CNT-GRP.                                          
           PERFORM 7000-READ-CNT-STORE-EXP-FL.                                  
                                                                                
                                                                                
      ******************************************************************        
      * 2100-PROCESS-SKUS.                                             *        
      *  ==> FINDS ALL SKUS FOR FOR EACH GROUP SPECIFIED FOR A COUNT   *        
      ******************************************************************        
       2100-PROCESS-SKUS.                                                       
           MOVE '2100-PROCESS-SKUS' TO PV-PARAGRAPH-NAME.                       
           MOVE ICRD052-LOC-NBR TO XST00008-LOC-NBR.                            
           IF PV-DEPT-IS-NOT-NULL                                               
             AND PV-MAJ-CL-IS-NOT-NULL                                          
             AND PV-SUB-CL-IS-NULL                                              
               MOVE ICT00016-DEPT-NBR TO XST00013-DEPT-NBR                      
               MOVE ICT00016-MAJ-CL-NBR TO XST00013-MAJ-CL-NBR                  
               SET PS-MORE-MC-SKUS TO TRUE                                      
               PERFORM 8300-OPEN-MAJ-CLS-CSR                                    
               PERFORM 8310-FETCH-MAJ-CLS-CSR                                   
               PERFORM                                                          
                 UNTIL PS-NO-MORE-MC-SKUS                                       
                 PERFORM 2110-CREATE-COUNTS                                     
                 PERFORM 8310-FETCH-MAJ-CLS-CSR                                 
               END-PERFORM                                                      
               PERFORM 8320-CLOSE-MAJ-CLS-CSR                                   
           ELSE                                                                 
           IF PV-DEPT-IS-NOT-NULL                                               
             AND PV-MAJ-CL-IS-NOT-NULL                                          
             AND PV-SUB-CL-IS-NOT-NULL                                          
               MOVE ICT00016-DEPT-NBR TO XST00013-DEPT-NBR                      
               MOVE ICT00016-MAJ-CL-NBR TO XST00013-MAJ-CL-NBR                  
               MOVE ICT00016-SUB-CL-NBR TO XST00013-SUB-CL-NBR                  
               SET PS-MORE-SC-SKUS TO TRUE                                      
               PERFORM 8400-OPEN-SUB-CLS-CSR                                    
               PERFORM 8410-FETCH-SUB-CLS-CSR                                   
               PERFORM                                                          
                 UNTIL PS-NO-MORE-SC-SKUS                                       
                 PERFORM 2110-CREATE-COUNTS                                     
                 PERFORM 8410-FETCH-SUB-CLS-CSR                                 
               END-PERFORM                                                      
               PERFORM 8420-CLOSE-SUB-CLS-CSR                                   
           ELSE                                                                 
           IF  PV-STYL-ID-IS-NOT-NULL                                           
               MOVE ICT00016-STYL-ID  TO XST00010-STYL-ID                       
               SET PS-MORE-STYLE-CSR TO TRUE                                    
               PERFORM 8500-OPEN-STYLE-CSR                                      
               PERFORM 8510-FETCH-STYLE-CSR                                     
               PERFORM                                                          
                 UNTIL PS-NO-MORE-STYLE-CSR                                     
                 PERFORM 2110-CREATE-COUNTS                                     
                 PERFORM 8510-FETCH-STYLE-CSR                                   
               END-PERFORM                                                      
               PERFORM 8520-CLOSE-STYLE-CSR                                     
           ELSE                                                                 
           IF  PV-GP-CDE-IS-NOT-NULL                                            
               MOVE ICT00016-GP-CDE   TO XST00010-GP-CDE                        
               SET PS-MORE-GP-CDE-CSR TO TRUE                                   
               PERFORM 8600-OPEN-GP-CDE-CSR                                     
               PERFORM 8610-FETCH-GP-CDE-CSR                                    
               PERFORM                                                          
                 UNTIL PS-NO-MORE-GP-CDE-CSR                                    
                 PERFORM 2110-CREATE-COUNTS                                     
                 PERFORM 8610-FETCH-GP-CDE-CSR                                  
               END-PERFORM                                                      
               PERFORM 8620-CLOSE-GP-CDE-CSR                                    
           ELSE                                                                 
           IF  PV-SKU-IS-NOT-NULL                                               
             MOVE ICT00016-SKU-NBR   TO XST00010-SKU-NBR                        
             MOVE ICRD052-LOC-NBR    TO XST00008-LOC-NBR                        
             PERFORM 8900-CHECK-FOR-ACTIVE                                      
CR9773       IF PS-SKU-FOUND                                                    
                PERFORM 2110-CREATE-COUNTS                                      
CR9773       END-IF                                                             
           ELSE                                                                 
               DISPLAY 'INVALID MDSE GROUPING - '                               
                        ICRD052-CNT-STUP-ID  ' - '                              
                        ICRD052-LOC-NBR      ' - '                              
                        ICT00016-DEPT-NBR    ' - '                              
                        PV-DEPT-NULL-IND     ' - '                              
                        ICT00016-MAJ-CL-NBR  ' - '                              
                        PV-MAJ-CL-NULL-IND   ' - '                              
                        ICT00016-SUB-CL-NBR  ' - '                              
                        PV-SUB-CL-NULL-IND   ' - '                              
                        ICT00016-STYL-ID     ' - '                              
                        PV-STYL-ID-NULL-IND  ' - '                              
                        ICT00016-SKU-NBR     ' - '                              
                        PV-SKU-NULL-IND      ' - '                              
                        ICT00016-GP-CDE      ' - '                              
                        PV-GP-CDE-NULL-IND   ' - '.                             
           PERFORM 8110-FETCH-CNT-GRP.                                          
                                                                                
      ******************************************************************        
      * 2110-CREATE-COUNTS                                             *        
      *  ==> FORMAT AND WRITE COUNT RECORDS.                           *        
      ******************************************************************        
       2110-CREATE-COUNTS.                                                      
           MOVE '2110-CREATE-COUNTS'   TO PV-PARAGRAPH-NAME.                    
           MOVE ICRD052-LOC-NBR        TO XST00008-LOC-NBR.                     
           MOVE ICRD052-CNT-STUP-ID    TO ICRD053-CNT-STUP-ID.                  
           MOVE ICRD052-RPET-UPD-IND   TO ICRD053-RPET-UPD-IND.                 
           MOVE ICRD052-LOC-NBR        TO ICRD053-LOC-NBR.                      
           MOVE ICRD052-EXEC-DTE       TO ICRD053-EXEC-DTE.                     
           MOVE ICRD052-RPET-CNT-IND   TO ICRD053-RPET-CNT-IND.                 
           MOVE XST00008-UNT-RTL-AMT   TO ICRD053-UNT-RTL-AMT.                  
           MOVE XST00010-SKU-NBR       TO ICRD053-SKU-NBR.                      
           IF  ICRD052-EXCL-MDSE-IND NOT = 'Y'                                  
             OR (ICRD052-EXCL-MDSE-IND = 'Y'                                    
              AND XST00008-UNT-RTL-AMT > .03)                                   
916792       IF XST00008-LOC-SKU-STAT-CDE = '30'                                
916792         ADD 1 TO DI-CLR-CNTR                                             
916792          IF PV-ORIG-CLR-DTE-IS-NULL                                      
916792            MOVE PV-CURRENT-DATE        TO ICRD053-ORIG-CLR-DTE           
916792          ELSE                                                            
916792            MOVE XST00008-ORIG-CLR-DTE  TO ICRD053-ORIG-CLR-DTE           
916792          END-IF                                                          
916792       ELSE                                                               
916792*        MOVE SPACE                    TO ICRD053-ORIG-CLR-DTE            
916792*        ADD 1 TO DI-ACT-CNTR                                             
916792*      END-IF                                                             
916792        IF XST00008-LOC-SKU-STAT-CDE = '25' AND                           
916792                PV-LOC-NBR NOT = 0                                        
916792         ADD 1 TO DI-CLR-CNTR                                             
916792         IF PV-ORIG-CLR-DTE-IS-NULL                                       
916792           MOVE PV-CURRENT-DATE        TO ICRD053-ORIG-CLR-DTE            
916792         ELSE                                                             
916792           MOVE XST00008-ORIG-CLR-DTE  TO ICRD053-ORIG-CLR-DTE            
916792         END-IF                                                           
916792        ELSE                                                              
916792         MOVE SPACE                    TO ICRD053-ORIG-CLR-DTE            
916792         ADD 1 TO DI-ACT-CNTR                                             
916792        END-IF                                                            
916792       END-IF                                                             
916792       MOVE ZEROES TO PV-LOC-NBR                                          
             PERFORM 7010-WRITE-CNT-SKU-EXP-FL                                  
           END-IF.                                                              
                                                                                
      ******************************************************************        
      * 2200-PROCESS-IMMED-COUNTS.                                     *        
      *  ==> FINDS ALL IMMEDIATE COUNT SKUS.                           *        
      ******************************************************************        
       2200-PROCESS-IMMED-COUNTS.                                               
           MOVE '2200-PROCESS-IMMED-COUNTS' TO PV-PARAGRAPH-NAME.               
           MOVE PV-LAST-IMM-TMST  TO ICT00019-LAST-UPD-TMST.                    
           PERFORM 8200-OPEN-IMM-CNT-CSR.                                       
           PERFORM 8210-FETCH-IMM-CNT-CSR.                                      
           PERFORM 2300-CREATE-IMMED-COUNTS                                     
             UNTIL PS-NO-MORE-IMM-CNT.                                          
           PERFORM 8220-CLOSE-IMM-CNT-CSR.                                      
           DISPLAY 'IMMEDIATE COUNT PROCESSING DONE'.                           
                                                                                
      ******************************************************************        
      * 2300-CREATE-IMMED-COUNTS.                                      *        
      *  ==> FINDS ALL SKUS FOR FOR EACH GROUP SPECIFIED FOR A COUNT  *         
      ******************************************************************        
       2300-CREATE-IMMED-COUNTS.                                                
           MOVE '2300-CREATE-IMMED-COUNTS' TO PV-PARAGRAPH-NAME.                
           IF PV-DEPT-IS-NOT-NULL                                               
             AND PV-MAJ-CL-IS-NOT-NULL                                          
             AND PV-SUB-CL-IS-NULL                                              
               MOVE ICT00016-DEPT-NBR TO XST00013-DEPT-NBR                      
               MOVE ICT00016-MAJ-CL-NBR TO XST00013-MAJ-CL-NBR                  
               SET PS-MORE-MC-SKUS TO TRUE                                      
               PERFORM 8300-OPEN-MAJ-CLS-CSR                                    
               PERFORM 8310-FETCH-MAJ-CLS-CSR                                   
               PERFORM                                                          
                 UNTIL PS-NO-MORE-MC-SKUS                                       
                 PERFORM 2310-CREATE-IMM-COUNTS                                 
                 PERFORM 8310-FETCH-MAJ-CLS-CSR                                 
               END-PERFORM                                                      
               PERFORM 8320-CLOSE-MAJ-CLS-CSR                                   
           ELSE                                                                 
           IF PV-DEPT-IS-NOT-NULL                                               
             AND PV-MAJ-CL-IS-NOT-NULL                                          
             AND PV-SUB-CL-IS-NOT-NULL                                          
               MOVE ICT00016-DEPT-NBR TO XST00013-DEPT-NBR                      
               MOVE ICT00016-MAJ-CL-NBR TO XST00013-MAJ-CL-NBR                  
               MOVE ICT00016-SUB-CL-NBR TO XST00013-SUB-CL-NBR                  
               SET PS-MORE-SC-SKUS TO TRUE                                      
               PERFORM 8400-OPEN-SUB-CLS-CSR                                    
               PERFORM 8410-FETCH-SUB-CLS-CSR                                   
               PERFORM                                                          
                 UNTIL PS-NO-MORE-SC-SKUS                                       
                 PERFORM 2310-CREATE-IMM-COUNTS                                 
                 PERFORM 8410-FETCH-SUB-CLS-CSR                                 
               END-PERFORM                                                      
               PERFORM 8420-CLOSE-SUB-CLS-CSR                                   
           ELSE                                                                 
           IF  PV-STYL-ID-IS-NOT-NULL                                           
               MOVE ICT00016-STYL-ID  TO XST00010-STYL-ID                       
               SET PS-MORE-STYLE-CSR TO TRUE                                    
               PERFORM 8500-OPEN-STYLE-CSR                                      
               PERFORM 8510-FETCH-STYLE-CSR                                     
               PERFORM                                                          
                 UNTIL PS-NO-MORE-STYLE-CSR                                     
                 PERFORM 2310-CREATE-IMM-COUNTS                                 
                 PERFORM 8510-FETCH-STYLE-CSR                                   
               END-PERFORM                                                      
               PERFORM 8520-CLOSE-STYLE-CSR                                     
           ELSE                                                                 
           IF  PV-GP-CDE-IS-NOT-NULL                                            
               MOVE ICT00016-STYL-ID  TO XST00010-STYL-ID                       
               SET PS-MORE-GP-CDE-CSR TO TRUE                                   
               PERFORM 8600-OPEN-GP-CDE-CSR                                     
               PERFORM 8610-FETCH-GP-CDE-CSR                                    
               PERFORM                                                          
                 UNTIL PS-NO-MORE-GP-CDE-CSR                                    
                 PERFORM 2310-CREATE-IMM-COUNTS                                 
                 PERFORM 8610-FETCH-GP-CDE-CSR                                  
               END-PERFORM                                                      
               PERFORM 8620-CLOSE-GP-CDE-CSR                                    
           ELSE                                                                 
           IF  PV-SKU-IS-NOT-NULL                                               
             MOVE ICT00016-SKU-NBR   TO XST00010-SKU-NBR                        
             PERFORM 2310-CREATE-IMM-COUNTS                                     
           ELSE                                                                 
               DISPLAY 'INVALID MDSE GROUPING - '                               
                        ICT00010-CNT-STUP-ID ' - '                              
                        ICT00014-LOC-HIER-VAL-NBR '-'                           
                        ICT00016-DEPT-NBR    ' - '                              
                        PV-DEPT-NULL-IND     ' - '                              
                        ICT00016-MAJ-CL-NBR  ' - '                              
                        PV-MAJ-CL-NULL-IND   ' - '                              
                        ICT00016-SUB-CL-NBR  ' - '                              
                        PV-SUB-CL-NULL-IND   ' - '                              
                        ICT00016-STYL-ID     ' - '                              
                        PV-STYL-ID-NULL-IND  ' - '                              
                        ICT00016-SKU-NBR     ' - '                              
                        PV-SKU-NULL-IND      ' - '                              
                        ICT00016-GP-CDE      ' - '                              
                        PV-GP-CDE-NULL-IND   ' - '.                             
           PERFORM 8210-FETCH-IMM-CNT-CSR.                                      
                                                                                
      ******************************************************************        
      * 2310-CREATE-IMM-COUNTS                                         *        
      *  ==> FORMAT AND WRITE COUNT RECORDS.                           *        
      ******************************************************************        
       2310-CREATE-IMM-COUNTS.                                                  
           MOVE '2310-CREATE-IMM-COUNTS. ' TO PV-PARAGRAPH-NAME.                
           MOVE ICT00014-LOC-HIER-VAL-NBR TO XST00008-LOC-NBR.                  
           PERFORM 8900-CHECK-FOR-ACTIVE.                                       
           MOVE ICT00010-CNT-STUP-ID   TO ICRD053-CNT-STUP-ID.                  
           MOVE ICT00014-LOC-HIER-VAL-NBR TO ICRD053-LOC-NBR.                   
           MOVE PV-CURRENT-DATE        TO ICRD053-EXEC-DTE.                     
           MOVE 'N'                    TO ICRD053-RPET-CNT-IND.                 
           MOVE XST00008-UNT-RTL-AMT   TO ICRD053-UNT-RTL-AMT.                  
           MOVE XST00010-SKU-NBR       TO ICRD053-SKU-NBR.                      
           IF  ICRD052-EXCL-MDSE-IND NOT = 'Y'                                  
             OR (ICRD052-EXCL-MDSE-IND = 'Y'                                    
              AND XST00008-UNT-RTL-AMT > .03)                                   
916792       IF XST00008-LOC-SKU-STAT-CDE = '30'                                
916792         ADD 1 TO DI-CLR-CNTR                                             
916792         IF PV-ORIG-CLR-DTE-IS-NULL                                       
916792           MOVE PV-CURRENT-DATE        TO ICRD053-ORIG-CLR-DTE            
916792         ELSE                                                             
916792           MOVE XST00008-ORIG-CLR-DTE  TO ICRD053-ORIG-CLR-DTE            
916792         END-IF                                                           
916792       ELSE                                                               
916792*        MOVE SPACE                    TO ICRD053-ORIG-CLR-DTE            
916792*        ADD 1 TO DI-ACT-CNTR                                             
916792*      END-IF                                                             
916792        IF XST00008-LOC-SKU-STAT-CDE = '25'                               
916792          AND PV-LOC-NBR NOT = 0                                          
916792         ADD 1 TO DI-CLR-CNTR                                             
916792         IF PV-ORIG-CLR-DTE-IS-NULL                                       
916792           MOVE PV-CURRENT-DATE        TO ICRD053-ORIG-CLR-DTE            
916792         ELSE                                                             
916792           MOVE XST00008-ORIG-CLR-DTE  TO ICRD053-ORIG-CLR-DTE            
916792         END-IF                                                           
916792        ELSE                                                              
916792         MOVE SPACE                    TO ICRD053-ORIG-CLR-DTE            
916792         ADD 1 TO DI-ACT-CNTR                                             
916792        END-IF                                                            
916792       END-IF                                                             
916792       MOVE ZEROES TO PV-LOC-NBR                                          
             PERFORM 7010-WRITE-CNT-SKU-EXP-FL                                  
           END-IF.                                                              
           IF ICT00010-CNT-STUP-ID NOT = ICT00019-CNT-STUP-ID                   
             MOVE ICT00010-CNT-STUP-ID   TO ICT00019-CNT-STUP-ID                
851489        PERFORM 8935-READ-STUP-SCH-MAX-ROW                                
851489        IF PV-LAST-UPD-TMST-PLUS2 > PV-CURRENT-TMST                       
851489           MOVE PV-CURRENT-TMST        TO PV-CURRENT-TMST-HOLD            
851489           MOVE PV-LAST-UPD-TMST-PLUS2 TO PV-CURRENT-TMST                 
851489           PERFORM 8930-INSERT-STUP-PRC-ROW                               
851489           MOVE PV-CURRENT-TMST-HOLD   TO PV-CURRENT-TMST                 
851489        ELSE                                                              
                 PERFORM 8930-INSERT-STUP-PRC-ROW                               
851489        END-IF                                                            
851489     END-IF.                                                              
                                                                                
      ******************************************************************        
      * 3000-EOJ-PROCESSING.                                           *        
      *  ==> PROCESSES:                                                *        
      *    - CLOSE FILES                                               *        
      *    - DISPLAYS PROCESSING TOTALS                                *        
      *    - TAKES A FINAL COMMIT                                      *        
      ******************************************************************        
       3000-EOJ-PROCESSING.                                                     
           MOVE '3000-EOJ-PROCESSING' TO PV-PARAGRAPH-NAME.                     
                                                                                
           CLOSE CNT-STORE-EXP-FILE                                             
                 CNT-SKU-EXP-FILE.                                              
                                                                                
           IF PS-LAST-IMM-TMST-FOUND                                            
             PERFORM 8960-UPDATE-LAST-IMM-TMST                                  
           ELSE                                                                 
      * THIS SHOULD ONLY BE USED THE FIRST TIME THIS PGM IS RUN IN PROD         
             PERFORM 8965-INSERT-LAST-IMM-TMST.                                 
           EXEC SQL                                                        CL**5
               COMMIT WORK                                                 CL**5
           END-EXEC.                                                       CL**5
           ADD +1 TO DI-COMMIT-CNTR.                                       CL*16
                                                                                
           PERFORM 9990-DISPLAY-CONTROL-INFO.                                   
                                                                                
                                                                                
      *----------------------------------------------------------               
      * 7000-READ-CNT-STORE-EXP-FL.                                             
      *----------------------------------------------------------               
       7000-READ-CNT-STORE-EXP-FL.                                              
           MOVE '7000-READ-CNT-STORE-EXP-FL' TO PV-PARAGRAPH-NAME.              
           READ CNT-STORE-EXP-FILE                                              
             INTO ICRD052-IC-COUNTS-FILE                                        
           AT END SET PS-END-OF-INPUT-FILE TO TRUE.                             
                                                                                
      *----------------------------------------------------------               
      * 7010-WRITE-CNT-SKU-EXP-FL.                                              
      *----------------------------------------------------------               
       7010-WRITE-CNT-SKU-EXP-FL.                                               
           MOVE '7010-WRITE-CNT-SKU-EXP-FL' TO PV-PARAGRAPH-NAME.               
           WRITE CNT-SKU-EXP-REC                                                
             FROM ICRD053-IC-COUNTS-FILE.                                       
                                                                                
                                                                                
      *8000-SQL-COMMIT.                                                         
      *    MOVE '8000-SQL-COMMIT' TO PV-PARAGRAPH-NAME.                         
      *                                                                         
      *    EXEC SQL                                                        CL**5
      *        COMMIT WORK                                                 CL**5
      *    END-EXEC.                                                       CL**5
      *    ADD +1 TO DI-COMMIT-CNTR.                                       CL*16
      *----------------------------------------------------------               
      * 8100-OPEN-CNT-GRP.                                                      
      *      OPEN THE CURSOR OF COUNT GROUPS.                                   
      *----------------------------------------------------------               
       8100-OPEN-CNT-GRP.                                                       
                                                                                
           MOVE '8100-OPEN-CNT-GRP'  TO PV-PARAGRAPH-NAME.                      
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    OPEN CNT-GRP-CSR                                            
                 END-EXEC                                                       
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 OPEN OF CNT-GRP CURSOR'                     
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8110-FETCH-CNT-GRP.                                                     
      *      FETCH A COUNT GROUP ROW.                                           
      *----------------------------------------------------------               
       8110-FETCH-CNT-GRP.                                                      
                                                                                
           MOVE '8110-FETCH-CNT-GRP'  TO PV-PARAGRAPH-NAME.                     
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                   OR                      
                      SQLCODE = 0                       OR                      
                      SQLCODE = +100)                                           
                                                                                
                 EXEC SQL                                                       
                    FETCH CNT-GRP-CSR                                           
                    INTO  :ICT00016-DEPT-NBR:PV-DEPT-NULL-IND                   
                         ,:ICT00016-MAJ-CL-NBR:PV-MAJ-CL-NULL-IND               
                         ,:ICT00016-SUB-CL-NBR:PV-SUB-CL-NULL-IND               
                         ,:ICT00016-STYL-ID:PV-STYL-ID-NULL-IND                 
                         ,:ICT00016-SKU-NBR:PV-SKU-NBR-NULL-IND                 
                         ,:ICT00016-GP-CDE:PV-GP-CDE-NULL-IND                   
C92330                   ,:ICT00010-CNT-TYP-CDE                                 
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                    WHEN SQLCODE = -904                                         
                    WHEN SQLCODE = -911                                         
                    WHEN SQLCODE = -913                                         
                        CONTINUE                                                
                    WHEN SQLCODE = ZERO                                         
                        CONTINUE                                                
                    WHEN SQLCODE = +100                                         
                        SET PS-NO-MORE-COUNT-SKUS TO TRUE                       
                    WHEN OTHER                                                  
                        SET PS-PROCESS-STOP        TO TRUE                      
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 FETCH OF CNT-GRP CURSOR'                    
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *-------------------------------------------------------------            
      * 8120-CLOSE-CNT-GRP.                                                     
      *      CLOSE THE COUNT GROUP CURSOR.                                      
      *-------------------------------------------------------------            
       8120-CLOSE-CNT-GRP.                                                      
                                                                                
           MOVE '8120-CLOSE-CNT-GRP'  TO PV-PARAGRAPH-NAME.                     
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    CLOSE CNT-GRP-CSR                                           
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 CLOSE OF CNT-GRP CURSOR'                    
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8200-OPEN-IMM-CNT-CSR.                                                  
      *      OPEN THE CURSOR OF IMMEDIATE COUNTS.                               
      *----------------------------------------------------------               
       8200-OPEN-IMM-CNT-CSR.                                                   
                                                                                
           MOVE '8200-OPEN-IMM-CNT-CSR'  TO PV-PARAGRAPH-NAME.                  
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    OPEN IMM-CNT-CSR                                            
                 END-EXEC                                                       
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 OPEN OF IMM-CNT-CSR CURSOR'                 
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8210-FETCH-IMM-CNT-CSR.                                                 
      *      FETCH AN IMMEDIATE COUNT ROW.                                      
      *----------------------------------------------------------               
       8210-FETCH-IMM-CNT-CSR.                                                  
                                                                                
           MOVE '8210-FETCH-IMM-CNT-CSR'  TO PV-PARAGRAPH-NAME.                 
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                   OR                      
                      SQLCODE = 0                       OR                      
                      SQLCODE = +100)                                           
                                                                                
                 EXEC SQL                                                       
                    FETCH IMM-CNT-CSR                                           
                    INTO  :ICT00014-LOC-HIER-CDE                                
                         ,:ICT00014-LOC-HIER-VAL-NBR                            
                         ,:ICT00010-EXCL-MDSE-IND                               
                         ,:ICT00010-CNT-STUP-ID                                 
                         ,:ICT00016-DEPT-NBR:PV-DEPT-NULL-IND                   
                         ,:ICT00016-MAJ-CL-NBR:PV-MAJ-CL-NULL-IND               
                         ,:ICT00016-SUB-CL-NBR:PV-SUB-CL-NULL-IND               
                         ,:ICT00016-STYL-ID:PV-STYL-ID-NULL-IND                 
                         ,:ICT00016-SKU-NBR:PV-SKU-NBR-NULL-IND                 
                         ,:ICT00016-GP-CDE:PV-GP-CDE-NULL-IND                   
                         ,:ICT00016-SKU-NBR:PV-SKU-NULL-IND                     
C92330                   ,:ICT00010-CNT-TYP-CDE                                 
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                    WHEN SQLCODE = -904                                         
                    WHEN SQLCODE = -911                                         
                    WHEN SQLCODE = -913                                         
                        CONTINUE                                                
                    WHEN SQLCODE = ZERO                                         
                        ADD +1 TO DI-IMMED-CNTR                                 
                    WHEN SQLCODE = +100                                         
                        SET PS-NO-MORE-IMM-CNT     TO TRUE                      
                    WHEN OTHER                                                  
                        SET PS-PROCESS-STOP        TO TRUE                      
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 FETCH OF IMM-CNT-CSR CURSOR'                
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *-------------------------------------------------------------            
      * 8220-CLOSE-IMM-CNT-CSR.                                                 
      *      CLOSE THE IMMEDIATE COUNTS CURSOR.                                 
      *-------------------------------------------------------------            
       8220-CLOSE-IMM-CNT-CSR.                                                  
                                                                                
           MOVE '8220-CLOSE-IMM-CNT-CSR'  TO PV-PARAGRAPH-NAME.                 
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    CLOSE IMM-CNT-CSR                                           
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 CLOSE OF IMM-CNT-CSR CURSOR'                
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8300-OPEN-MAJ-CLS-CSR.                                                  
      *      OPEN THE CURSOR OF IMMEDIATE COUNTS.                               
      *----------------------------------------------------------               
       8300-OPEN-MAJ-CLS-CSR.                                                   
                                                                                
           MOVE '8300-OPEN-MAJ-CLS-CSR'  TO PV-PARAGRAPH-NAME.                  
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    OPEN MAJ-CLS-CSR                                            
                 END-EXEC                                                       
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 OPEN OF MAJ-CLS-CSR CURSOR'                 
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8310-FETCH-MAJ-CLS-CSR.                                                 
      *      FETCH AN IMMEDIATE COUNT ROW.                                      
      *----------------------------------------------------------               
       8310-FETCH-MAJ-CLS-CSR.                                                  
                                                                                
           MOVE '8310-FETCH-MAJ-CLS-CSR'  TO PV-PARAGRAPH-NAME.                 
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                   OR                      
                      SQLCODE = 0                       OR                      
                      SQLCODE = +100)                                           
                                                                                
                 EXEC SQL                                                       
                  FETCH MAJ-CLS-CSR                                             
                  INTO  :XST00010-SKU-NBR                                       
                       ,:XST00008-UNT-RTL-AMT                                   
                       ,:XST00008-LOC-SKU-STAT-CDE                              
                       ,:XST00008-ORIG-CLR-DTE:PV-ORIG-CLR-DTE-NULL-IND         
916792                 ,:PV-LOC-NBR                                             
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                    WHEN SQLCODE = -904                                         
                    WHEN SQLCODE = -911                                         
                    WHEN SQLCODE = -913                                         
                        CONTINUE                                                
                    WHEN SQLCODE = ZERO                                         
                        CONTINUE                                                
                    WHEN SQLCODE = +100                                         
                        SET PS-NO-MORE-MC-SKUS    TO TRUE                       
                    WHEN OTHER                                                  
                        SET PS-PROCESS-STOP        TO TRUE                      
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 FETCH OF MAJ-CLS-CSR CURSOR'                
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *-------------------------------------------------------------            
      * 8320-CLOSE-MAJ-CLS-CSR.                                                 
      *      CLOSE THE MAJOR CLASS SKUS CURSOR.                                 
      *-------------------------------------------------------------            
       8320-CLOSE-MAJ-CLS-CSR.                                                  
                                                                                
           MOVE '8320-CLOSE-MAJ-CLS-CSR'  TO PV-PARAGRAPH-NAME.                 
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    CLOSE MAJ-CLS-CSR                                           
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 CLOSE OF MAJ-CLS-CSR CURSOR'                
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      *----------------------------------------------------------               
      * 8400-OPEN-SUB-CLS-CSR.                                                  
      *      OPEN THE CURSOR OF IMMEDIATE COUNTS.                               
      *----------------------------------------------------------               
       8400-OPEN-SUB-CLS-CSR.                                                   
                                                                                
           MOVE '8400-OPEN-SUB-CLS-CSR'  TO PV-PARAGRAPH-NAME.                  
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    OPEN SUB-CLS-CSR                                            
                 END-EXEC                                                       
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 OPEN OF SUB-CLS-CSR CURSOR'                 
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8410-FETCH-SUB-CLS-CSR.                                                 
      *      FETCH AN SUB CLASS SKU ROW.                                        
      *----------------------------------------------------------               
       8410-FETCH-SUB-CLS-CSR.                                                  
                                                                                
           MOVE '8410-FETCH-SUB-CLS-CSR'  TO PV-PARAGRAPH-NAME.                 
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                   OR                      
                      SQLCODE = 0                       OR                      
                      SQLCODE = +100)                                           
                                                                                
                 EXEC SQL                                                       
                  FETCH SUB-CLS-CSR                                             
                  INTO  :XST00010-SKU-NBR                                       
                       ,:XST00008-UNT-RTL-AMT                                   
                       ,:XST00008-LOC-SKU-STAT-CDE                              
                       ,:XST00008-ORIG-CLR-DTE:PV-ORIG-CLR-DTE-NULL-IND         
916792                 ,:PV-LOC-NBR                                             
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                    WHEN SQLCODE = -904                                         
                    WHEN SQLCODE = -911                                         
                    WHEN SQLCODE = -913                                         
                        CONTINUE                                                
                    WHEN SQLCODE = ZERO                                         
                        CONTINUE                                                
                    WHEN SQLCODE = +100                                         
                        SET PS-NO-MORE-SC-SKUS    TO TRUE                       
                    WHEN OTHER                                                  
                        SET PS-PROCESS-STOP        TO TRUE                      
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 FETCH OF SUB-CLS-CSR CURSOR'                
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *-------------------------------------------------------------            
      * 8420-CLOSE-SUB-CLS-CSR.                                                 
      *      CLOSE THE SUB CLASS SKUS CURSOR.                                   
      *-------------------------------------------------------------            
       8420-CLOSE-SUB-CLS-CSR.                                                  
                                                                                
           MOVE '8420-CLOSE-SUB-CLS-CSR'  TO PV-PARAGRAPH-NAME.                 
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    CLOSE SUB-CLS-CSR                                           
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 CLOSE OF SUB-CLS-CSR CURSOR'                
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8500-OPEN-STYLE-CSR.                                                    
      *      OPEN THE CURSOR OF SKUS WITHIN A STYLE.                            
      *----------------------------------------------------------               
       8500-OPEN-STYLE-CSR.                                                     
                                                                                
           MOVE '8500-OPEN-STYLE-CSR'  TO PV-PARAGRAPH-NAME.                    
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    OPEN STYLE-CSR                                              
                 END-EXEC                                                       
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 OPEN OF STYLE-CSR CURSOR'                   
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8510-FETCH-STYLE-CSR.                                                   
      *      FETCH AN STYLE CLASS SKU ROW.                                      
      *----------------------------------------------------------               
       8510-FETCH-STYLE-CSR.                                                    
                                                                                
           MOVE '8510-FETCH-STYLE-CSR'  TO PV-PARAGRAPH-NAME.                   
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                   OR                      
                      SQLCODE = 0                       OR                      
                      SQLCODE = +100)                                           
                                                                                
                 EXEC SQL                                                       
                  FETCH STYLE-CSR                                               
                  INTO  :XST00010-SKU-NBR                                       
                       ,:XST00008-UNT-RTL-AMT                                   
                       ,:XST00008-LOC-SKU-STAT-CDE                              
                       ,:XST00008-ORIG-CLR-DTE:PV-ORIG-CLR-DTE-NULL-IND         
916792                 ,:PV-LOC-NBR                                             
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                    WHEN SQLCODE = -904                                         
                    WHEN SQLCODE = -911                                         
                    WHEN SQLCODE = -913                                         
                        CONTINUE                                                
                    WHEN SQLCODE = ZERO                                         
                        CONTINUE                                                
                    WHEN SQLCODE = +100                                         
                        SET PS-NO-MORE-STYLE-CSR TO TRUE                        
                    WHEN OTHER                                                  
                        SET PS-PROCESS-STOP        TO TRUE                      
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 FETCH OF STYLE-CSR CURSOR'                  
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *-------------------------------------------------------------            
      * 8520-CLOSE-STYLE-CSR.                                                   
      *      CLOSE THE STYLE SKUS CURSOR.                                       
      *-------------------------------------------------------------            
       8520-CLOSE-STYLE-CSR.                                                    
                                                                                
           MOVE '8520-CLOSE-STYLE-CSR'  TO PV-PARAGRAPH-NAME.                   
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    CLOSE STYLE-CSR                                             
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 CLOSE OF STYLE-CSR CURSOR'                  
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8600-OPEN-GP-CDE-CSR.                                                   
      *      OPEN THE CURSOR OF SKUS WITHIN A GROUP CODE.                       
      *----------------------------------------------------------               
       8600-OPEN-GP-CDE-CSR.                                                    
                                                                                
           MOVE '8600-OPEN-GP-CDE-CSR'  TO PV-PARAGRAPH-NAME.                   
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    OPEN GP-CDE-CSR                                             
                 END-EXEC                                                       
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 OPEN OF GP-CDE-CSR CURSOR'                  
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------               
      * 8610-FETCH-GP-CDE-CSR.                                                  
      *      FETCH AN GP-CDE-CSR SKU ROW.                                       
      *----------------------------------------------------------               
       8610-FETCH-GP-CDE-CSR.                                                   
                                                                                
           MOVE '8610-FETCH-GP-CDE-CSR' TO PV-PARAGRAPH-NAME.                   
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                   OR                      
                      SQLCODE = 0                       OR                      
                      SQLCODE = +100)                                           
                                                                                
                 EXEC SQL                                                       
                  FETCH GP-CDE-CSR                                              
                  INTO  :XST00010-SKU-NBR                                       
                       ,:XST00008-UNT-RTL-AMT                                   
                       ,:XST00008-LOC-SKU-STAT-CDE                              
                       ,:XST00008-ORIG-CLR-DTE:PV-ORIG-CLR-DTE-NULL-IND         
916792                 ,:PV-LOC-NBR                                             
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                    WHEN SQLCODE = -904                                         
                    WHEN SQLCODE = -911                                         
                    WHEN SQLCODE = -913                                         
                        CONTINUE                                                
                    WHEN SQLCODE = ZERO                                         
                        CONTINUE                                                
                    WHEN SQLCODE = +100                                         
                        SET PS-NO-MORE-GP-CDE-CSR TO TRUE                       
                    WHEN OTHER                                                  
                        SET PS-PROCESS-STOP        TO TRUE                      
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 FETCH OF GP-CDE-CSR CURSOR'                 
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *-------------------------------------------------------------            
      * 8620-CLOSE-GP-CDE-CSR                                                   
      *      CLOSE THE GP-CDE-CSR CURSOR.                                       
      *-------------------------------------------------------------            
       8620-CLOSE-GP-CDE-CSR.                                                   
                                                                                
           MOVE '8620-CLOSE-GP-CDE-CSR' TO PV-PARAGRAPH-NAME.                   
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRIES                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR              
                      PS-PROCESS-STOP                    OR                     
                      SQLCODE = 0)                                              
                                                                                
                 EXEC SQL                                                       
                    CLOSE GP-CDE-CSR                                            
                 END-EXEC                                                       
                                                                                
                EVALUATE TRUE                                                   
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = -913                                          
                       CONTINUE                                                 
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN OTHER                                                   
                       SET PS-PROCESS-STOP TO TRUE                              
                END-EVALUATE                                                    
           END-PERFORM.                                                         
                                                                                
           IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT OR                      
              PS-PROCESS-STOP                                                   
               SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 CLOSE OF GP-CDE-CSR CURSOR'                 
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      *-------------------------------------------------------------            
      * 8900-CHECK-FOR-ACTIVE.                                                  
      *      CHECK TO SEE IF A SKU IS ACTIVE OR CLEARANCE                       
      *-------------------------------------------------------------            
       8900-CHECK-FOR-ACTIVE.                                                   
           MOVE '8900-CHECK-FOR-ACTIVE' TO PV-PARAGRAPH-NAME.                   
CR9773     SET PS-SKU-NOT-FOUND         TO TRUE                                 
           EXEC SQL                                                             
             SELECT  UNT_RTL_AMT                                                
                    ,LOC_SKU_STAT_CDE                                           
                    ,ORIG_CLR_DTE                                               
916792              ,A.LOC_NBR                                                  
             INTO   :XST00008-UNT-RTL-AMT                                       
                   ,:XST00008-LOC-SKU-STAT-CDE                                  
                   ,:XST00008-ORIG-CLR-DTE:PV-ORIG-CLR-DTE-NULL-IND             
916792             ,:PV-LOC-NBR                                                 
             FROM   XST_SKU_LOC  A                                              
                   ,XST_SKU      B                                              
             WHERE A.LOC_NBR     = :XST00008-LOC-NBR                            
              AND  A.BEG_TMST   <= CURRENT TIMESTAMP                            
              AND (A.END_TMST    > CURRENT TIMESTAMP                            
               OR  A.END_TMST    IS NULL)                                       
              AND  B.SKU_NBR     = :XST00010-SKU-NBR                            
              AND  A.INTR_UPC_ID = B.INTR_UPC_ID                                
           END-EXEC.                                                            
           EVALUATE TRUE                                                        
              WHEN SQLCODE = 0                                                  
CR9773          SET PS-SKU-FOUND       TO TRUE                                  
              WHEN SQLCODE = +100                                               
                PERFORM 8905-CHECK-FOR-ACT-LOC-0                                
              WHEN OTHER                                                        
               SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 CHECK FOR ACT SELECT'                       
                       ' HAD SQLCODE OF ' SQLCODE                               
               DISPLAY 'KEY = ' XST00008-LOC-NBR ' - '                          
                                XST00010-SKU-NBR                                
               PERFORM 9999-SQL-ABEND                                           
           END-EVALUATE.                                                        
                                                                                
      *-------------------------------------------------------------            
      * 8905-CHECK-FOR-ACT-LOC-0                                                
      *      CHECK TO SEE IF A SKU IS ACTIVE OR CLEARANCE                       
      *-------------------------------------------------------------            
       8905-CHECK-FOR-ACT-LOC-0.                                                
           MOVE '8905-CHECK-FOR-ACT-LOC-0' TO PV-PARAGRAPH-NAME.                
           EXEC SQL                                                             
             SELECT  UNT_RTL_AMT                                                
                    ,LOC_SKU_STAT_CDE                                           
                    ,ORIG_CLR_DTE                                               
916792              ,A.LOC_NBR                                                  
             INTO  :XST00008-UNT-RTL-AMT                                        
                  ,:XST00008-LOC-SKU-STAT-CDE                                   
                  ,:XST00008-ORIG-CLR-DTE:PV-ORIG-CLR-DTE-NULL-IND              
916792            ,:PV-LOC-NBR                                                  
             FROM   XST_SKU_LOC   A                                             
                   ,XST_SKU       B                                             
             WHERE A.LOC_NBR     = 0                                            
              AND  A.BEG_TMST   <= CURRENT TIMESTAMP                            
              AND (A.END_TMST    > CURRENT TIMESTAMP                            
               OR  A.END_TMST    IS NULL)                                       
              AND  B.SKU_NBR     = :XST00010-SKU-NBR                            
              AND  A.INTR_UPC_ID = B.INTR_UPC_ID                                
           END-EXEC.                                                            
           EVALUATE TRUE                                                        
              WHEN SQLCODE = 0                                                  
CR9773          SET PS-SKU-FOUND       TO TRUE                                  
              WHEN SQLCODE = +100                                               
                MOVE '99' TO XST00008-LOC-SKU-STAT-CDE                          
                DISPLAY 'STORE/SKU NOT FOUND ' ICRD052-LOC-NBR                  
                                       ' - '   XST00008-LOC-NBR                 
                                       ' - '   XST00010-SKU-NBR                 
              WHEN OTHER                                                        
               SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 CHECK FOR ACT SELECT'                       
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-EVALUATE.                                                        
                                                                                
      *-------------------------------------------------------------            
      * 8925-SELECT-LAST-IMM-TMST.                                              
      *      GET TIMESTAMP OF LAST IMMEDIATE COUNT.                             
      *-------------------------------------------------------------            
       8925-SELECT-LAST-IMM-TMST.                                               
           MOVE '8925-SELECT-LAST-IMM-TMST' TO PV-PARAGRAPH-NAME.               
           EXEC SQL                                                             
             SELECT   EXTR_PRC_DTE                                              
                     ,EXTR_PRC_TMST                                             
               INTO :ICT00007-EXTR-PRC-DTE                                      
                   ,:ICT00007-EXTR-PRC-TMST:PV-EXTR-PRC-TMST-NI                 
               FROM   ICT_CNT_EXTR_PRC    A                                     
               WHERE A. EXTR_PRC_TYP_CDE  = 'IMM'                               
           END-EXEC.                                                            
           EVALUATE TRUE                                                        
              WHEN SQLCODE = 0                                                  
                  SET PS-LAST-IMM-TMST-FOUND TO TRUE                            
              WHEN SQLCODE = +100                                               
               MOVE PC-DEFAULT-TMST TO ICT00007-EXTR-PRC-TMST                   
              WHEN OTHER                                                        
               SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 CHECK LAST RUN TMST'                        
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-EVALUATE.                                                        
                                                                                
      *-------------------------------------------------------------            
      * 8960-UPDATE-LAST-IMM-TMST                                               
      *      UPDATE LAST IMM TIMESTAMP OF TO ICT_CNT_STUP_STAT TABLE            
      *-------------------------------------------------------------            
       8960-UPDATE-LAST-IMM-TMST.                                               
           MOVE '8960-UPDATE-LAST-IMM-TMST' TO PV-PARAGRAPH-NAME.               
           DISPLAY 'ICT00007-EXTR-PRC-DTE B4 UPD ' ICT00007-EXTR-PRC-DTE        
                                                                                
           EXEC SQL                                                             
           UPDATE ICT_CNT_EXTR_PRC                                              
           SET EXTR_PRC_TMST = :PV-CURRENT-TMST                                 
           WHERE EXTR_PRC_TYP_CDE = 'IMM'                                       
             AND EXTR_PRC_DTE     = :ICT00007-EXTR-PRC-DTE                      
           END-EXEC.                                                            
           EVALUATE TRUE                                                        
              WHEN SQLCODE = 0                                                  
                  CONTINUE                                                      
              WHEN OTHER                                                        
               SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 UPDATE LAST IMM TMST'                       
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-EVALUATE.                                                        
      *-------------------------------------------------------------            
      * 8965-INSERT-LAST-IMM-TMST.                                              
      *      INSERT LAST IMM TIMESTAMP OF TO ICT_CNT_STUP_STAT TABLE            
      *-------------------------------------------------------------            
       8965-INSERT-LAST-IMM-TMST.                                               
           MOVE '8965-INSERT-LAST-IMM-TMST' TO PV-PARAGRAPH-NAME.               
           EXEC SQL                                                             
             INSERT INTO ICT_CNT_EXTR_PRC                                       
             (EXTR_PRC_TYP_CDE                                                  
             ,EXTR_PRC_DTE                                                      
             ,EXTR_PRC_TMST)                                                    
             VALUES                                                             
             ('IMM'                                                             
             ,:PV-CURRENT-DATE                                                  
             ,:PV-CURRENT-TMST)                                                 
           END-EXEC.                                                            
           EVALUATE TRUE                                                        
              WHEN SQLCODE = 0                                                  
                  CONTINUE                                                      
              WHEN OTHER                                                        
               SET PS-PROCESS-STOP    TO TRUE                                   
C96479         DISPLAY '** ICKUP153 INSERT LAST RUN TMST'                       
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-EVALUATE.                                                        
                                                                                
      *-------------------------------------------------------------            
      * 8930-INSERT-STUP-PRC-ROW                                                
      *      INSERT SETUP PROCESSED ROW.                                        
      *-------------------------------------------------------------            
       8930-INSERT-STUP-PRC-ROW.                                                
           MOVE '8930-INSERT-STUP-PRC-ROW' TO PV-PARAGRAPH-NAME.                
           EXEC SQL                                                             
             INSERT INTO ICT_CNT_STUP_STAT                                      
             (CNT_STUP_ID                                                       
             ,CNT_STAT_CDE                                                      
             ,LAST_UPD_TMST                                                     
             ,LAST_UPD_USR_ID                                                   
             ,LAST_ACTN_CDE)                                                    
             VALUES                                                             
             (:ICT00019-CNT-STUP-ID                                             
             ,'PRO'                                                             
             ,:PV-CURRENT-TMST                                                  
             ,'SYSTEM'                                                          
             ,'A')                                                              
           END-EXEC.                                                            
           EVALUATE TRUE                                                        
              WHEN SQLCODE = 0                                                  
                  CONTINUE                                                      
              WHEN OTHER                                                        
               SET PS-PROCESS-STOP    TO TRUE                                   
               DISPLAY 'ICT_CNT_STUP_STAT - ' ICT00019-CNT-STUP-ID              
                                     ' - '   ICT00019-CNT-STAT-CDE              
                                     ' - '   PV-CURRENT-TMST                    
C96479         DISPLAY '** ICKUP153 INSERT PROCESSED ROW'                       
                       ' HAD SQLCODE OF ' SQLCODE                               
               PERFORM 9999-SQL-ABEND                                           
           END-EVALUATE.                                                        
                                                                                
851489*-------------------------------------------------------------            
851489* 8935-READ-STUP-SCH-MAX-ROW.                                             
851489*      READ CNT_STUP TABLE TO FETCH THE MAX TIMESTAMP.                    
851489*      THIS SECTION  SECTION IS DUE TO IMMEDIATE COUNTS                   
851489*-------------------------------------------------------------            
851489 8935-READ-STUP-SCH-MAX-ROW.                                              
851489     MOVE '8925-READ-STUP-SCH-MAX-ROW' TO PV-PARAGRAPH-NAME.              
851489     EXEC SQL                                                             
851489       SELECT MAX(LAST_UPD_TMST) + 2 MINUTES                              
851489         INTO :PV-LAST-UPD-TMST-PLUS2                                     
851489         FROM ICT_CNT_STUP_STAT                                           
851489        WHERE CNT_STUP_ID   = :ICT00019-CNT-STUP-ID                       
851489         WITH UR                                                          
851489     END-EXEC.                                                            
851489                                                                          
851489     EVALUATE TRUE                                                        
851489        WHEN SQLCODE = 0                                                  
851489            CONTINUE                                                      
851489        WHEN SQLCODE = +100                                               
851489         MOVE PV-CURRENT-TMST TO PV-LAST-UPD-TMST-PLUS2                   
851489        WHEN SQLCODE = -811                                               
851489         DISPLAY 'DUP ICT_CNT_STUP_STAT - ' ICT00019-CNT-STUP-ID          
851489                                    ' - ' PV-LAST-UPD-TMST-PLUS2          
851489        WHEN OTHER                                                        
851489         SET PS-PROCESS-STOP    TO TRUE                                   
851489         DISPLAY 'ICT_CNT_STUP_STAT - ' ICT00019-CNT-STUP-ID              
851489                                  ' - ' ICT00019-CNT-STAT-CDE             
851489                                  ' - ' PV-LAST-UPD-TMST-PLUS2            
C96479         DISPLAY '** ICKUP153 SELECT SCHEDULED ROW'                       
851489                 ' HAD SQLCODE OF ' SQLCODE                               
851489         PERFORM 9999-SQL-ABEND                                           
851489     END-EVALUATE.                                                        
851489                                                                          
      ******************************************************************        
      * 9990-DISPLAY-CONTROL-INFO.                                     *        
      *  ==> PROCESSES:                                                *        
      *    - DISPLAYS CONTROL INFORMATION AT END OF JOB                *        
      ******************************************************************        
       9990-DISPLAY-CONTROL-INFO.                                               
                                                                                
           DISPLAY '********************************************'.              
C96479     DISPLAY '**** RUN STATISTICS FOR PROGRAM ICKUP153 ***'.              
           DISPLAY '****'.                                                      
           DISPLAY 'ACTIVE COUNTS PROCESSED    :' DI-ACT-CNTR.                  
           DISPLAY 'CLEARRANCE COUNTS PROCESSED:' DI-CLR-CNTR.                  
           DISPLAY 'IMMEDIATE  COUNTS PROCESSED:' DI-IMMED-CNTR.                
           DISPLAY 'COMMITS TAKEN              :' DI-COMMIT-CNTR.               
           DISPLAY '****'.                                                      
           DISPLAY '**** RUN STATS END FOR PROGRAM ICKUP153  ***'.              
           DISPLAY '********************************************'.              
                                                                                
      ******************************************************************        
      * 9999-SQL-ABEND.                                                *        
      *  ==> PROCESSES:                                                *        
      *    - PERFORMS ABENDS AFTER UNEXPECTED SQLCODE                  *        
      ******************************************************************        
       9999-SQL-ABEND.                                                          
                                                                                
           MOVE SQLCODE TO PV-SQLCODE-DISPLAY.                                  
                                                                                
           DISPLAY '** ABEND **'.                                               
C96479     DISPLAY 'ICKUP153 - ABEND'.                                          
           DISPLAY 'PARAGRAPH = ' PV-PARAGRAPH-NAME.                            
           DISPLAY 'OPERATION = ' PV-DB2-OPERATION-ATTEMPTED.                   
           DISPLAY 'SQL CODE  = ' PV-SQLCODE-DISPLAY.                           
           PERFORM 9990-DISPLAY-CONTROL-INFO.                                   
                                                                                
           COPY DPPD004.                                                        
                                                                                
           MOVE +4013 TO ABEND-CODE.                                            
           CALL 'ILBOABN0' USING ABEND-CODE.                                    
                                                                                
