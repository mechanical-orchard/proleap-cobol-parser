000100***************************************************************** 00010030
000200 IDENTIFICATION DIVISION.                                         00020031
000300***************************************************************** 00030031
000400 PROGRAM-ID.    FSKUP013.                                         00040031
000500 AUTHOR.        MARIA KLAMIK.                                     00050031
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060031
000700 DATE-WRITTEN.  06-23-03.                                         00070031
000800 DATE-COMPILED.                                                   00080031
000900                                                                  00090031
001000***************************************************************** 00100031
001100*          FASHION SALES ON-HAND ADJUSTMENT                     * 00110031
001200*                                                               * 00120031
001210*               DB2/MQ STARTED TASK                             * 00121031
001220*                                                               * 00122031
001230*    THIS PROGRAM WILL RETRIEVE ADJUSTMENTS FROM THE            * 00123031
001240*    MESSAGE QUEUE AND UPDATE THE ON-HAND QUANTITIES            * 00124031
001250*    ACCORDINGLY - TSKST.                                       * 00125031
001260*                                                               * 00126031
001270*    THERE ARE THREE TYPES OF ADJUSTMENTS THAT WILL BE          * 00127031
001280*    ON THE QUEUE AND THEY ARE AS FOLLOWS:                      * 00128031
001290*                                                               * 00129031
001300*    RA - RECEIPT ADJUSTMENT                                    * 00130031
001400*    OA - ON-HAND ADJUSTMENT                                    * 00140031
001500*    ST - REPLACEMENT SKU ADJUSTMENT                            * 00150031
001600*                                                               * 00160031
001700*    07/16/2003 - MARIA KLAMIK   WR#23946                       * 00170031
001800*    INITIAL INSTALLTION.                                       * 00180031
001900***************************************************************** 00190031
002000*    05/11/2004 - MARIA KLAMIK   WR#26355                       * 00200031
002100*    STORE NUMBER EXPANSION PROJECT.                            * 00210031
002200*    INCREASE STORE NUMBER TO SMALLINT AND REMOVE ALL LOGIC     * 00220031
002300*    THAT WILL INSERT OR UPDATE THE ON-HAND CUTOFF.             * 00230031
002400***************************************************************** 00240031
002500*    03/31/2005 - MARIA KLAMIK   WR#28420                       * 00250031
002600*    RECOMPILE FOR ISRD001 COPYBOOK CHANGES.                    * 00260031
002700***************************************************************** 00270031
002800 ENVIRONMENT DIVISION.                                            00280031
002900***************************************************************** 00290031
003000                                                                  00300031
003100 CONFIGURATION SECTION.                                           00310031
003110                                                                  00311031
003120 SOURCE-COMPUTER.       IBM-3090.                                 00312031
003130 OBJECT-COMPUTER.       IBM-3090.                                 00313031
003140                                                                  00314031
003150 INPUT-OUTPUT SECTION.                                            00315031
003160                                                                  00316031
003170 FILE-CONTROL.                                                    00317031
003180     SELECT CONTROL-CARD     ASSIGN TO INP01.                     00318031
003190     SELECT CONTROL-CARD-2   ASSIGN TO INP02.                     00319031
003191                                                                  00319131
003192***************************************************************** 00319231
003193 DATA DIVISION.                                                   00319331
003194***************************************************************** 00319431
003195                                                                  00319531
003196 FILE SECTION.                                                    00319631
003197                                                                  00319731
003198 FD  CONTROL-CARD                                                 00319831
003199     RECORDING MODE F                                             00319931
003200     BLOCK CONTAINS 0 RECORDS                                     00320031
003210     LABEL RECORDS ARE OMITTED.                                   00321031
003220 01  CONTROL-CARD-LINE                PIC  X(80).                 00322031
003230                                                                  00323031
003240 FD  CONTROL-CARD-2                                               00324031
003250     RECORDING MODE F                                             00325031
003260     BLOCK CONTAINS 0 RECORDS                                     00326031
003270     LABEL RECORDS ARE OMITTED.                                   00327031
003280 01  CONTROL-CARD-LINE-2              PIC  X(80).                 00328031
003290                                                                  00329031
003300                                                                  00330031
003400 WORKING-STORAGE SECTION.                                         00340031
003500                                                                  00350031
003600***************************************************************** 00360031
003700* PC-PROGRAM CONSTANTS.                                           00370031
003800***************************************************************** 00380031
003900 01  PC-PROGRAM-CONSTANTS.                                        00390031
004000     05  PC-OPERATING-COMPANY           PIC X(02)   VALUE '03'.   00400031
004100     05  PC-PGM-NAME                    PIC X(08)   VALUE         00410031
004200                                                    'FSKUP013'.   00420031
004300     05  PC-MAX-RETRY-CNT               PIC S9(04)    VALUE 3     00430031
004400                                                 COMP SYNC.       00440031
004500     05  PC-MORE-THAN-MAX-RETRY         PIC S9(04)    VALUE 4     00450031
004600                                                 COMP SYNC.       00460031
004700     05  PC-CORP-LOC-NBR                PIC 9(05)  VALUE ZERO.    00470031
004710     05  PC-FIFTY-STARS                 PIC X(50)  VALUE ALL '*'. 00471031
004720     05  PC-END-RUN-MSG                 PIC X(18)  VALUE          00472031
004730                                            'END RUN OF PROGRAM'. 00473031
004740*** MQ SERIES CONSTANTS                                           00474031
004750     05  PC-MQCONN                      PIC X(008)                00475031
004760                                              VALUE 'CSQBCONN'.   00476031
004770     05  PC-MQOPEN                      PIC X(008)                00477031
004780                                              VALUE 'CSQBOPEN'.   00478031
004790     05  PC-MQGET                       PIC X(008)                00479031
004800                                              VALUE 'CSQBGET'.    00480031
004900     05  PC-MQPUT1                      PIC X(008)                00490031
005000                                              VALUE 'CSQBPUT1'.   00500031
005100     05  PC-MQCLOSE                     PIC X(008)                00510031
005200                                              VALUE 'CSQBCLOS'.   00520031
005300     05  PC-MQDISC                      PIC X(008)                00530031
005400                                              VALUE 'CSQBDISC'.   00540031
005500     05  PC-MQCMIT                      PIC X(008)                00550031
005600                                              VALUE 'CSQBCOMM'.   00560031
005700***************************************************************** 00570031
005800*    CONTROL CARD                                                 00580031
005900***************************************************************** 00590031
006000 01  CC-CONTROL-CARD.                                             00600031
006100     05  CC-QMGR-NAME              PIC  X(04).                    00610031
006200     05  FILLER                    PIC  X(76).                    00620031
006300                                                                  00630031
006400***************************************************************** 00640031
006500*    CONTROL CARD-2                                               00650031
006600***************************************************************** 00660031
006700 01  CC-CONTROL-CARD-2.                                           00670031
006800*** THIS IS THE INPUT QUEUE NAME                                  00680031
006900     05  CC-FS-MERCH-ADJ-Q-NAME    PIC  X(20).                    00690031
007000     05  FILLER                    PIC  X(09).                    00700031
007100*** THIS IS THE OUTPUT QUEUE NAME                                 00710031
007200     05  CC-FS-ERROR-Q-NAME        PIC  X(19).                    00720031
007300     05  FILLER                    PIC  X(32).                    00730031
007400                                                                  00740031
007500***************************************************************** 00750031
007600* PV-PROGRAM VARIABLES.                                           00760031
007700***************************************************************** 00770031
007800 01  PV-PROGRAM-VARIABLES.                                        00780031
007900     05  PV-RETRY-COUNTER               PIC S9(04)                00790031
008000                                             VALUE ZERO           00800031
008100                                             COMP SYNC.           00810031
008200     05  PV-LOC-NBR-COMP                PIC S9(4) COMP VALUE 0.   00820031
008300     05  PV-LOC-NBR                     PIC 9(5) VALUE ZERO.      00830031
008700     05  PV-LOC-NBR-HOLD                PIC 9(5) VALUE ZERO.      00870031
008800     05  PV-ITEM-NBR                    PIC  S9(15)V COMP-3       00880031
008900                                              VALUE 0.            00890031
009000     05  PV-QTY-CHANGE                  PIC  S9(07)V COMP-3       00900031
009100                                              VALUE 0.            00910031
009200     05  PV-ONHAND-QTY                  PIC  S9(7)V COMP-3        00920031
009300                                              VALUE 0.            00930031
009400*** MQ SERIES VARIABLES.                                          00940031
009500     05  PV-GET-MESSAGE-BUFFER          PIC  X(500)               00950031
009600                                              VALUE SPACES.       00960031
009700     05  PV-GET-MSG-BUFFER-LENGTH       PIC S9(009)               00970031
009800                                              BINARY              00980031
009900                                              VALUE 500.          00990031
010000     05  PV-GET-DATA-LENGTH             PIC S9(009)               01000031
010100                                              BINARY              01010031
010200                                              VALUE 0.            01020031
010300     05  PV-PUT-MESSAGE-BUFFER          PIC  X(200)               01030031
010400                                           VALUE SPACES.          01040031
010500     05  PV-PUT-MSG-BUFFER-LENGTH       PIC S9(009)               01050031
010600                                              BINARY              01060031
010700                                              VALUE 200.          01070031
010800     05  PV-MESSAGE-LENGTH-IND-X        PIC  X(002).              01080031
010900     05  PV-MESSAGE-LENGTH-IND                                    01090031
011000      REDEFINES PV-MESSAGE-LENGTH-IND-X PIC S9(004)               01100031
011100                                              COMP.               01110031
011200     05  PV-CONNECT-HANDLE              PIC S9(009)               01120031
011300                                              BINARY              01130031
011400                                              VALUE 0.            01140031
011500     05  PV-GETQ-HANDLE                 PIC S9(009)               01150031
011600                                              BINARY              01160031
011700                                              VALUE 0.            01170031
011800     05  PV-OPEN-OPTIONS                PIC S9(009)               01180031
011900                                              BINARY              01190031
012000                                              VALUE 0.            01200031
012100     05  PV-COMPLETION-CODE             PIC S9(009)               01210031
012200                                              BINARY              01220031
012300                                              VALUE 0.            01230031
012400     05  PV-REASON                      PIC S9(009)               01240031
012500                                              BINARY              01250031
012600                                              VALUE 0.            01260031
012700     05  PV-CONNECT-REASON              PIC S9(009)               01270031
012800                                              BINARY              01280031
012900                                              VALUE 0.            01290031
013000     05  PV-DISPLAY-REASON              PIC S9(009)               01300031
013100                                              VALUE 0.            01310031
013200     05  PV-DISPLAY-COMP-CODE           PIC S9(009)               01320031
013300                                              VALUE 0.            01330031
013400***************************************************************** 01340031
013500* PE-ERROR MESSAGE VARIABLES                                      01350031
013600***************************************************************** 01360031
013700 01  PE-PROGRAM-ERROR-MESSAGES.                                   01370031
013800*** MQ CALL ERROR MESSAGES - LENGTH 68 BYTES                      01380031
013900***************************************************************** 01390031
014000     05  PE-MQ-ERROR-MESSAGE.                                     01400031
014100       10  FILLER                       PIC  X(021)               01410031
014200           VALUE '******* ABEND *******'.                         01420031
014300       10  FILLER                       PIC  X(010)               01430031
014400           VALUE 'MQ ERROR: '.                                    01440031
014500       10  PE-MQ-CALL-TYPE              PIC  X(007) VALUE SPACES. 01450031
014600       10  FILLER                       PIC  X(002) VALUE SPACES. 01460031
014700       10  FILLER                       PIC  X(009)               01470031
014800           VALUE 'COMP CDE='.                                     01480031
014900       10  PE-MQ-COMPLETION-CODE        PIC  9(004) VALUE ZEROS.  01490031
015000       10  FILLER                       PIC  X(002) VALUE SPACES. 01500031
015100       10  FILLER                       PIC  X(008)               01510031
015200           VALUE 'RSN CDE='.                                      01520031
015300       10  PE-MQ-REASON-CODE            PIC  9(004) VALUE ZEROS.  01530031
015400       10  FILLER                       PIC  X(001) VALUE SPACES. 01540031
015500***************************************************************** 01550031
015600*** DB2 CALL ERROR MESSAGES - LENGTH 40 BYTES                     01560031
015700     05  PE-DB2-ERROR-MESSAGE.                                    01570031
015800       10  FILLER                       PIC X(016)                01580031
015900           VALUE 'DB2 ERR IN PARA-'.                              01590031
016000       10  PE-DB2-PARA                  PIC X(004) VALUE SPACES.  01600031
016100       10  FILLER                       PIC X(001) VALUE SPACES.  01610031
016200       10  FILLER                       PIC X(009)                01620031
016300           VALUE 'SQLCODE: '.                                     01630031
016400       10  PE-DB2-SQLCODE               PIC X(010) VALUE SPACES.  01640031
016500*** MQ MESSAGE DETAIL ERROR - LENGTH 40 BYTES                     01650031
016600     05  PE-MQ-MSG-DETAIL-1.                                      01660031
016700       10  FILLER                       PIC  X(010)               01670031
016800           VALUE 'PARA 2050-'.                                    01680031
016900       10  FILLER                       PIC  X(030)               01690031
017000           VALUE 'INVALID STORE/WAREHOUSE NUMBER'.                01700031
017100     05  PE-MQ-MSG-DETAIL-2.                                      01710031
017200       10  FILLER                       PIC  X(005)               01720031
017300           VALUE 'PARA '.                                         01730031
017400       10  PE-PARAGRAPH-NBR             PIC  X(005).              01740031
017500       10  FILLER                       PIC  X(030)               01750031
017600           VALUE 'INVALID ADJUSTMENT ACTION CODE'.                01760031
017700                                                                  01770031
017800***************************************************************** 01780031
017900* PA-PROGRAM ACCUMULATORS.                                        01790031
018000***************************************************************** 01800031
018100 01  PA-PROGRAM-ACCUMULATORS.                                     01810031
018200     05  PA-MQ-MSGS                PIC 9(07) VALUE 0.             01820031
018300     05  PA-RA-ADJ                 PIC 9(07) VALUE 0.             01830031
018400     05  PA-OA-ADJ                 PIC 9(07) VALUE 0.             01840031
018500     05  PA-ST-ADJ                 PIC 9(07) VALUE 0.             01850031
018600     05  PA-TSKST-UPD              PIC 9(07) VALUE 0.             01860031
018700     05  PA-TSKST-INS              PIC 9(07) VALUE 0.             01870031
018800                                                                  01880031
018900***************************************************************** 01890031
019000* PS-PROGRAM SWITCHES.                                            01900031
019100***************************************************************** 01910031
019200 01  PS-PROGRAM-SWITCHES.                                         01920031
019300     05  PS-CONTROL-CARD-SW              PIC X(01)   VALUE 'N'.   01930031
019400         88  PS-CONTROL-CARD-END                     VALUE 'Y'.   01940031
019500         88  PS-CONTROL-CARD-START                   VALUE 'N'.   01950031
019600     05  PS-CONTROL-CARD-2-SW            PIC X(01)   VALUE 'N'.   01960031
019700         88  PS-CONTROL-CARD-2-END                   VALUE 'Y'.   01970031
019800         88  PS-CONTROL-CARD-2-START                 VALUE 'N'.   01980031
019900     05  PS-END-OF-QUEUE-SW             PIC  X       VALUE 'N'.   01990031
020000         88  PS-END-OF-QUEUE                         VALUE 'Y'.   02000031
020100     05  PS-ERROR-SW                    PIC X(01)    VALUE 'N'.   02010031
020200         88  PS-NO-ERROR                             VALUE 'N'.   02020031
020300         88  PS-ERROR                                VALUE 'Y'.   02030031
020400     05  PS-TSKST-SW                    PIC X(01)    VALUE 'N'.   02040031
020500         88  PS-UPDATE-TSKST                         VALUE 'U'.   02050031
020600         88  PS-INSERT-TSKST                         VALUE 'I'.   02060031
020700                                                                  02070031
020800***************************************************************** 02080031
020900* MQ SERIES API CONTROL BLOCKS                                    02090031
021000***************************************************************** 02100031
021100 01  MQM-OBJECT-DESCRIPTOR.                                       02110031
021200     COPY CMQODV.                                                 02120031
021300                                                                  02130031
021400 01  MQM-MESSAGE-DESCRIPTOR.                                      02140031
021500     COPY CMQMDV.                                                 02150031
021600                                                                  02160031
021700 01  MQM-GET-MESSAGE-OPTIONS.                                     02170031
021800     COPY CMQGMOV.                                                02180031
021900                                                                  02190031
022000 01  MQM-PUT-MESSAGE-OPTIONS.                                     02200031
022100     COPY CMQPMOV.                                                02210031
022200                                                                  02220031
022300***************************************************************** 02230031
022400* MQV CONTAINS CONSTANTS(FOR FILLING IN THE CONTROL BLOCKS)       02240031
022500* AND RETURN CODES(FOR TESTING THE RESULT OF A CALL)              02250031
022600***************************************************************** 02260031
022700 01  MQM-CONSTANTS.                                               02270031
022800     COPY CMQV.                                                   02280031
022900                                                                  02290031
023000***************************************************************** 02300031
023100*    MQ INPUT COPYBOOK.                                         * 02310031
023200***************************************************************** 02320031
023300     COPY ISRD001.                                                02330031
023400                                                                  02340031
023500***************************************************************** 02350031
023600*    FS OUTPUT ERROR COPYBOOK.                                  * 02360031
023700***************************************************************** 02370031
023800     COPY FSRD013.                                                02380031
023900                                                                  02390031
024000***************************************************************** 02400031
024100*    DB2 AREA FOR TSKST                                         * 02410031
024200***************************************************************** 02420031
024300     EXEC SQL                                                     02430031
024400          INCLUDE TSKST                                           02440031
024500     END-EXEC.                                                    02450031
024600                                                                  02460031
024700***************************************************************** 02470031
024800*    DB2 AREA FOR COMMUNICATIONS                                * 02480031
024900***************************************************************** 02490031
025000     EXEC SQL                                                     02500031
025100          INCLUDE SQLCA                                           02510031
025200     END-EXEC.                                                    02520031
025300                                                                  02530031
025400***************************************************************** 02540031
025500*  EXTENSION TO THE SQL COMMUNICATIONS AREA FOR EDITING           02550031
025600*  SQL CODES FOR DISPLAY                                          02560031
025700***************************************************************** 02570031
025800     COPY SQLCA2.                                                 02580031
025900                                                                  02590031
026000***************************************************************** 02600031
026100*    ABEND CODES THE ARE APPLICATION DEFINED                      02610031
026200***************************************************************** 02620031
026300 01  ABEND-CODE                  PIC S9(4)    VALUE ZEROS         02630031
026400                                              COMP SYNC.          02640031
026500     88  AC-USER-ERROR                        VALUE +4003.        02650031
026600     88  AC-MQ-ERROR                          VALUE +4020.        02660031
026700                                                                  02670031
026800 LINKAGE SECTION.                                                 02680031
026900                                                                  02690031
027000******************************************************************02700031
027100 PROCEDURE DIVISION.                                              02710031
027200******************************************************************02720031
027300* MAINLINE PARAGRAPH                                              02730031
027400******************************************************************02740031
027500 0000-MAIN-MODULE.                                                02750031
027600                                                                  02760031
027700     PERFORM 1000-HOUSEKEEPING.                                   02770031
027800                                                                  02780031
027900     PERFORM 2000-PROCESS-ADJ-REQUEST                             02790031
028000         UNTIL PS-END-OF-QUEUE.                                   02800031
028100                                                                  02810031
028200     PERFORM 9999-EOJ-PROCESSING.                                 02820031
028300                                                                  02830031
028400     STOP RUN.                                                    02840031
028500                                                                  02850031
028600******************************************************************02860031
028700* HOUSEKEEPING ROUTINE.                                          *02870031
028800******************************************************************02880031
028900 1000-HOUSEKEEPING.                                               02890031
029000                                                                  02900031
029100     DISPLAY PC-FIFTY-STARS.                                      02910031
029200     DISPLAY '***** START OF PROGRAM FSKUP013 *****'.             02920031
029300                                                                  02930031
029400     SET PS-CONTROL-CARD-START TO TRUE.                           02940031
029500     SET PS-CONTROL-CARD-2-START TO TRUE.                         02950031
029600                                                                  02960031
029700     OPEN INPUT CONTROL-CARD                                      02970031
029800                CONTROL-CARD-2.                                   02980031
029900                                                                  02990031
030000*  READ THE FIRST CONTROL CARD FOR THE QUEUE MGR NAME.            03000031
030100                                                                  03010031
030200     PERFORM 8000-READ-CONTROL-CARD.                              03020031
030300     IF PS-CONTROL-CARD-END                                       03030031
030400         DISPLAY PC-FIFTY-STARS                                   03040031
030500         DISPLAY PC-PGM-NAME                                      03050031
030600              'CONTROL CARD MISSING - FOR QMGR NAME'              03060031
030700     ELSE                                                         03070031
030800          IF CC-QMGR-NAME > SPACES                                03080031
030900              DISPLAY PC-FIFTY-STARS                              03090031
031000              DISPLAY PC-PGM-NAME                                 03100031
031100                      '- CONTROL CARD FOR QMGR: '                 03110031
031200                      CC-CONTROL-CARD                             03120031
031300          ELSE                                                    03130031
031400              SET PS-CONTROL-CARD-END TO TRUE                     03140031
031410              DISPLAY PC-PGM-NAME                                 03141031
031420                   'INVALID QMGR NAME '                           03142031
031430          END-IF                                                  03143031
031440     END-IF.                                                      03144031
031450                                                                  03145031
031460     CLOSE CONTROL-CARD.                                          03146031
031470                                                                  03147031
031480*  READ THE SECOND CONTROL CARD FOR THE QUEUE NAMES               03148031
031490                                                                  03149031
031491      PERFORM 8010-READ-CONTROL-CARD-2.                           03149131
031492      IF PS-CONTROL-CARD-2-END                                    03149231
031493          DISPLAY PC-PGM-NAME                                     03149331
031494             'CONTROL CARD MISSING - SALES QUEUE NAME '           03149431
031495      ELSE                                                        03149531
031496          IF CC-FS-MERCH-ADJ-Q-NAME > SPACES                      03149631
031497              DISPLAY PC-FIFTY-STARS                              03149731
031498              DISPLAY PC-PGM-NAME                                 03149831
031499                      '- CONTROL CARD FOR Q-NAME: '               03149931
031500                      CC-FS-MERCH-ADJ-Q-NAME                      03150031
031510              DISPLAY PC-FIFTY-STARS                              03151031
031520          ELSE                                                    03152031
031530              SET PS-CONTROL-CARD-2-END TO TRUE                   03153031
031540              DISPLAY PC-PGM-NAME                                 03154031
031550                 'INVALID MERCH ADJUST QUEUE NAME'                03155031
031560          END-IF                                                  03156031
031570          IF CC-FS-ERROR-Q-NAME > SPACES                          03157031
031580              DISPLAY PC-FIFTY-STARS                              03158031
031590              DISPLAY PC-PGM-NAME                                 03159031
031591                      '- CONTROL CARD FOR Q-NAME: '               03159131
031592                      CC-FS-ERROR-Q-NAME                          03159231
031593              DISPLAY PC-FIFTY-STARS                              03159331
031594          ELSE                                                    03159431
031595              SET PS-CONTROL-CARD-2-END TO TRUE                   03159531
031596              DISPLAY PC-PGM-NAME                                 03159631
031597                 'INVALID ERROR QUEUE NAME'                       03159731
031598          END-IF                                                  03159831
031599     END-IF.                                                      03159931
031600                                                                  03160031
031601     CLOSE CONTROL-CARD-2.                                        03160131
031602                                                                  03160231
031603     IF PS-CONTROL-CARD-END                                       03160331
031604        OR PS-CONTROL-CARD-2-END                                  03160431
031605        SET AC-USER-ERROR TO TRUE                                 03160531
031606        CALL 'ILBOABN0' USING ABEND-CODE                          03160631
031607     END-IF.                                                      03160731
031608                                                                  03160831
031609     MOVE 'N' TO PS-END-OF-QUEUE-SW                               03160931
031610                 PS-ERROR-SW.                                     03161031
031620                                                                  03162031
031630     PERFORM 4000-CONNECT-TO-Q-MGR.                               03163031
031640     PERFORM 4100-OPEN-ADJUST-QUEUE.                              03164031
031650     PERFORM 4200-GET-ADJUST-REQUEST.                             03165031
031660                                                                  03166031
031670******************************************************************03167031
031680* THIS PARAGRAPH WILL PROCESS THE ADJUSTMENT REQUESTS.           *03168031
031690* FIRST THE MESSAGE IS CHECKED FOR A VALID STORE NUMBER.         *03169031
031700* THEN THE TYPE OF ADJUSTMENT WILL DETERMINE THE TYPE OF         *03170031
031800* PROCESSING.  THERE ARE CURRENTLY THREE TYPES OF                *03180031
031900* ADJUSTMENTS - ONHAND ADJUSTMENT, RECEIPT ADJUSTMENT AND        *03190031
032000* SKU TRANSFERS.                                                 *03200031
032100* A DB2 COMMIT WILL OCCUR ONCE THE LOGICAL UNIT OF WORK HAS      *03210031
032200* COMPLETED...I.E. AN ADJUSTMENT.                                 03220031
032300******************************************************************03230031
032400 2000-PROCESS-ADJ-REQUEST.                                        03240031
032500                                                                  03250031
032600     MOVE 'N' TO PS-ERROR-SW                                      03260031
032700                 PS-TSKST-SW.                                     03270031
032800                                                                  03280031
032900     PERFORM 2050-CHECK-STR-NBR.                                  03290031
033000                                                                  03300031
033100     IF PS-NO-ERROR                                               03310031
033200        EVALUATE IS001-ADJ-TYP-CDE                                03320031
033300            WHEN 'OA'                                             03330031
033400               ADD +1 TO PA-OA-ADJ                                03340031
033500               PERFORM 2100-PROCESS-ADJ                           03350031
033600            WHEN 'RA'                                             03360031
033700               ADD +1 TO PA-RA-ADJ                                03370031
033800               PERFORM 2100-PROCESS-ADJ                           03380031
033900            WHEN 'ST'                                             03390031
034000               ADD +1 TO PA-ST-ADJ                                03400031
034100               PERFORM 2200-PROCESS-ST-FROM-SKU                   03410031
034200               IF PS-NO-ERROR                                     03420031
034300                  PERFORM 2300-PROCESS-ST-TO-SKU                  03430031
034400               END-IF                                             03440031
034500            WHEN OTHER                                            03450031
034600               CONTINUE                                           03460031
034700        END-EVALUATE                                              03470031
034800     END-IF.                                                      03480031
034900                                                                  03490031
035000     IF PS-NO-ERROR                                               03500031
035100        PERFORM 9990-DB2-COMMIT                                   03510031
035200     END-IF.                                                      03520031
035300                                                                  03530031
035400     PERFORM 4200-GET-ADJUST-REQUEST.                             03540031
035500                                                                  03550031
035600******************************************************************03560031
035700* THIS PARAGRAPH WILL VALIDATE THAT EITHER THE STORE NUMBER OR   *03570031
035800* WAREHOUSE NUMBER HAS A VALUE.  IF BOTH FIELDS ARE SPACES THEN  *03580031
035900* THE MESSAGE WILL BE WRITTEN TO THE ERROR MQ AND THE NEXT MQ    *03590031
036000* GET WILL OCCUR.                                                *03600031
036100******************************************************************03610031
036200 2050-CHECK-STR-NBR.                                              03620031
036300                                                                  03630031
036400     IF IS001-STR-NBR > ZERO                                      03640031
036500        MOVE IS001-STR-NBR TO PV-LOC-NBR                          03650031
036600                              PV-LOC-NBR-HOLD                     03660031
036700     ELSE                                                         03670031
036800        IF IS001-WHSE-NBR > ZERO                                  03680031
036900           MOVE IS001-WHSE-NBR TO PV-LOC-NBR                      03690031
037000                                  PV-LOC-NBR-HOLD                 03700031
037100        ELSE                                                      03710031
037200           SET PS-ERROR TO TRUE                                   03720031
037300           MOVE PE-MQ-MSG-DETAIL-1 TO FS013-ERROR-DESCRIPTION     03730031
037400           PERFORM 5000-FORMAT-ERROR-MESSAGE                      03740031
037500           PERFORM 4400-MQPUT1-ERROR-QUEUE                        03750031
037600        END-IF                                                    03760031
037700     END-IF.                                                      03770031
037800                                                                  03780031
037900******************************************************************03790031
038000* THIS PARAGRAPH PROCESSES 'OA' AND 'RA' ADJUSMENTS.  IT WILL    *03800031
038100* UPDATE TSKST FOR THE SPECIFIC STORE QTY CHANGE.  NEXT, UPDATE  *03810031
038200* THE CORPORATE STORE QTY CHANGE.  NOTE - THE CUTOFF ONHAND QTY  *03820031
038300* IS NOT UPDATED ON THE CORPORATE TSKST ROW.                     *03830031
038400* IF ANY ERRORS OCCURR - WRITE ERROR RECORD TO THE FS ERROR MQ   *03840031
038500* AND READ THE NEXT MQ MESSAGE.                                  *03850031
038600******************************************************************03860031
038700 2100-PROCESS-ADJ.                                                03870031
038800                                                                  03880031
038900     INITIALIZE PV-RETRY-COUNTER                                  03890031
039000                DCLTSKST                                          03900031
039100                PV-ONHAND-QTY                                     03910031
039200                PV-QTY-CHANGE.                                    03920031
039300                                                                  03930031
039400     MOVE IS001-FR-ITM-NBR TO PV-ITEM-NBR.                        03940031
039500     MOVE PV-LOC-NBR TO PV-LOC-NBR-COMP.                          03950031
039600     MOVE 'N' TO PS-TSKST-SW.                                     03960031
039700                                                                  03970031
039800     PERFORM 7100-SELECT-TSKST                                    03980031
039900         WITH TEST AFTER                                          03990031
040000         UNTIL ((SQLCODE = ZERO)                                  04000031
040100                 OR (SQLCODE = +100)                              04010031
040200                 OR (PV-RETRY-COUNTER > PC-MAX-RETRY-CNT)).       04020031
040300                                                                  04030031
040400     EVALUATE TRUE                                                04040031
040500         WHEN SQLCODE = ZERO                                      04050031
040600             SET PS-UPDATE-TSKST TO TRUE                          04060031
040700         WHEN SQLCODE = +100                                      04070031
040800             SET PS-INSERT-TSKST TO TRUE                          04080031
040900         WHEN OTHER                                               04090031
041000             SET PS-ERROR TO TRUE                                 04100031
041100             MOVE '7100' TO PE-DB2-PARA                           04110031
041200             MOVE SQLCODE TO SQLCODE2                             04120031
041300             MOVE SQLCODE2 TO PE-DB2-SQLCODE                      04130031
041400             MOVE PE-DB2-ERROR-MESSAGE TO FS013-ERROR-DESCRIPTION 04140031
041500             PERFORM 5000-FORMAT-ERROR-MESSAGE                    04150031
041600             PERFORM 4400-MQPUT1-ERROR-QUEUE                      04160031
041700     END-EVALUATE.                                                04170031
041800                                                                  04180031
041900     IF PS-NO-ERROR AND PS-UPDATE-TSKST                           04190031
042000        PERFORM 3000-EVAL-TSKST-QTY-CHG                           04200031
042100        IF PS-NO-ERROR                                            04210031
042200           PERFORM 3100-PROCESS-UPDATES                           04220031
042300        END-IF                                                    04230031
042400        IF PS-NO-ERROR                                            04240031
042500           PERFORM 3025-SELECT-TSKST-CORP-INFO                    04250031
042600        END-IF                                                    04260031
042700        IF PS-NO-ERROR                                            04270031
042800           PERFORM 3050-EVAL-TSKST-QTY-CHG-CORP                   04280031
042900        END-IF                                                    04290031
043000        IF PS-NO-ERROR                                            04300031
043100           PERFORM 3100-PROCESS-UPDATES                           04310031
043200        END-IF                                                    04320031
043300     END-IF.                                                      04330031
043400                                                                  04340031
043500     IF PS-NO-ERROR AND PS-INSERT-TSKST                           04350031
043600        PERFORM 3150-EVAL-TSKST-QTY-INSERT                        04360031
043700        IF PS-NO-ERROR                                            04370031
043800           PERFORM 3200-PROCESS-TSKST-INSERT                      04380031
043900        END-IF                                                    04390031
044000        IF PS-NO-ERROR                                            04400031
044100           PERFORM 3025-SELECT-TSKST-CORP-INFO                    04410031
044200        END-IF                                                    04420031
044300        IF PS-NO-ERROR                                            04430031
044400           PERFORM 3050-EVAL-TSKST-QTY-CHG-CORP                   04440031
044500        END-IF                                                    04450031
044600        IF PS-NO-ERROR                                            04460031
044700           PERFORM 3100-PROCESS-UPDATES                           04470031
044800        END-IF                                                    04480031
044900     END-IF.                                                      04490031
045000                                                                  04500031
045100******************************************************************04510031
045200* PROCESS SKU TRANSFER - FROM SKU.  THIS WILL ALWAYS DECREASE    *04520031
045300* THE ONHAND QUANTITY OF THE SPECIFIC STORE AND THE CORPORATE    *04530031
045400* STORE.                                                         *04540031
045500******************************************************************04550031
045600 2200-PROCESS-ST-FROM-SKU.                                        04560031
045700                                                                  04570031
045800     INITIALIZE PV-RETRY-COUNTER                                  04580031
045900                DCLTSKST                                          04590031
046000                PV-ONHAND-QTY                                     04600031
046100                PV-QTY-CHANGE.                                    04610031
046200                                                                  04620031
046300     MOVE IS001-FR-ITM-NBR TO PV-ITEM-NBR.                        04630031
046400     MOVE PV-LOC-NBR TO PV-LOC-NBR-COMP.                          04640031
046500                                                                  04650031
046600     PERFORM 7100-SELECT-TSKST                                    04660031
046700         WITH TEST AFTER                                          04670031
046800         UNTIL ((SQLCODE = ZERO)                                  04680031
046900                 OR (SQLCODE = +100)                              04690031
047000                 OR (PV-RETRY-COUNTER > PC-MAX-RETRY-CNT)).       04700031
047100                                                                  04710031
047200     EVALUATE TRUE                                                04720031
047300         WHEN SQLCODE = ZERO                                      04730031
047400             CONTINUE                                             04740031
047500         WHEN OTHER                                               04750031
047600             SET PS-ERROR TO TRUE                                 04760031
047700             MOVE '7100' TO PE-DB2-PARA                           04770031
047800             MOVE SQLCODE TO SQLCODE2                             04780031
047900             MOVE SQLCODE2 TO PE-DB2-SQLCODE                      04790031
048000             MOVE PE-DB2-ERROR-MESSAGE TO FS013-ERROR-DESCRIPTION 04800031
048100             PERFORM 5000-FORMAT-ERROR-MESSAGE                    04810031
048200             PERFORM 4400-MQPUT1-ERROR-QUEUE                      04820031
048300     END-EVALUATE.                                                04830031
048400                                                                  04840031
048500     IF PS-NO-ERROR                                               04850031
048600        PERFORM 3000-EVAL-TSKST-QTY-CHG                           04860031
048700        IF PS-NO-ERROR                                            04870031
048800           PERFORM 3100-PROCESS-UPDATES                           04880031
048900        END-IF                                                    04890031
049000        IF PS-NO-ERROR                                            04900031
049100           PERFORM 3025-SELECT-TSKST-CORP-INFO                    04910031
049200        END-IF                                                    04920031
049300        IF PS-NO-ERROR                                            04930031
049400           PERFORM 3050-EVAL-TSKST-QTY-CHG-CORP                   04940031
049500        END-IF                                                    04950031
049600        IF PS-NO-ERROR                                            04960031
049700           PERFORM 3100-PROCESS-UPDATES                           04970031
049800        END-IF                                                    04980031
049900     END-IF.                                                      04990031
050000                                                                  05000031
050100******************************************************************05010031
050200* PROCESS SKU TRANSFER - TO SKU.  THIS WILL ALWAYS INCREASE      *05020031
050300* THE ONHAND QUANTITY OF THE SPECIFIC STORE AND THE CORPORATE    *05030031
050400* STORE.  PLEASE NOTE THAT THIS PARAGRAPH WILL CHANGE THE        *05040031
050500* ADJUSTMENT ACTION CODE TO AN 'I' (INCREASE) TO BALANCE THE     *05050031
050600* SKU TRANSFER TRANSACTION.                                      *05060031
050700******************************************************************05070031
050800 2300-PROCESS-ST-TO-SKU.                                          05080031
050900                                                                  05090031
051000     INITIALIZE PV-RETRY-COUNTER                                  05100031
051100                DCLTSKST                                          05110031
051200                PV-ONHAND-QTY                                     05120031
051300                PV-QTY-CHANGE.                                    05130031
051400                                                                  05140031
051500     MOVE IS001-TO-ITM-NBR TO PV-ITEM-NBR.                        05150031
051600     MOVE PV-LOC-NBR-HOLD TO PV-LOC-NBR                           05160031
051700                             PV-LOC-NBR-COMP.                     05170031
051800     MOVE 'N' TO PS-TSKST-SW.                                     05180031
051900                                                                  05190031
052000     MOVE 'I' TO IS001-ADJ-ACTN-CDE.                              05200031
052100                                                                  05210031
052200     PERFORM 7100-SELECT-TSKST                                    05220031
052300         WITH TEST AFTER                                          05230031
052400         UNTIL ((SQLCODE = ZERO)                                  05240031
052500                 OR (SQLCODE = +100)                              05250031
052600                 OR (PV-RETRY-COUNTER > PC-MAX-RETRY-CNT)).       05260031
052700                                                                  05270031
052800     EVALUATE TRUE                                                05280031
052900         WHEN SQLCODE = ZERO                                      05290031
053000             SET PS-UPDATE-TSKST TO TRUE                          05300031
053100         WHEN SQLCODE = +100                                      05310031
053200             SET PS-INSERT-TSKST TO TRUE                          05320031
053300         WHEN OTHER                                               05330031
053400             MOVE '7100' TO PE-DB2-PARA                           05340031
053500             MOVE SQLCODE TO SQLCODE2                             05350031
053600             MOVE SQLCODE2 TO PE-DB2-SQLCODE                      05360031
053700             MOVE PE-DB2-ERROR-MESSAGE TO FS013-ERROR-DESCRIPTION 05370031
053800             PERFORM 9995-DB2-ROLLBACK                            05380031
053900             SET PS-ERROR TO TRUE                                 05390031
054000             PERFORM 5000-FORMAT-ERROR-MESSAGE                    05400031
054100             PERFORM 4400-MQPUT1-ERROR-QUEUE                      05410031
054200     END-EVALUATE.                                                05420031
054300                                                                  05430031
054400     IF PS-NO-ERROR AND PS-UPDATE-TSKST                           05440031
054500        PERFORM 3000-EVAL-TSKST-QTY-CHG                           05450031
054600        IF PS-NO-ERROR                                            05460031
054700           PERFORM 3100-PROCESS-UPDATES                           05470031
054800        END-IF                                                    05480031
054900        IF PS-NO-ERROR                                            05490031
055000           PERFORM 3025-SELECT-TSKST-CORP-INFO                    05500031
055100        END-IF                                                    05510031
055200        IF PS-NO-ERROR                                            05520031
055300           PERFORM 3050-EVAL-TSKST-QTY-CHG-CORP                   05530031
055400        END-IF                                                    05540031
055500        IF PS-NO-ERROR                                            05550031
055600           PERFORM 3100-PROCESS-UPDATES                           05560031
055700        END-IF                                                    05570031
055800     END-IF.                                                      05580031
055900                                                                  05590031
056000     IF PS-NO-ERROR AND PS-INSERT-TSKST                           05600031
056100        PERFORM 3150-EVAL-TSKST-QTY-INSERT                        05610031
056200        IF PS-NO-ERROR                                            05620031
056300           PERFORM 3200-PROCESS-TSKST-INSERT                      05630031
056400        END-IF                                                    05640031
056500        IF PS-NO-ERROR                                            05650031
056600           PERFORM 3025-SELECT-TSKST-CORP-INFO                    05660031
056700        END-IF                                                    05670031
056800        IF PS-NO-ERROR                                            05680031
056900           PERFORM 3050-EVAL-TSKST-QTY-CHG-CORP                   05690031
057000        END-IF                                                    05700031
057100        IF PS-NO-ERROR                                            05710031
057200           PERFORM 3100-PROCESS-UPDATES                           05720031
057300        END-IF                                                    05730031
057400     END-IF.                                                      05740031
057500                                                                  05750031
057600******************************************************************05760031
057700* CALCULATE THE QUANTITY CHANGE BASED ON THE ACTION CODE FOR     *05770031
057800* THE SPECIFIC STORE.                                            *05780031
057900* PLEASE NOTE THAT THE ONLY 'D' AND 'I' ARE VALID FOR 'RA'       *05790031
058000* ADJUSMENTS AND 'ST' SKU TRANSFERS.                             *05800031
058100******************************************************************05810031
058200 3000-EVAL-TSKST-QTY-CHG.                                         05820031
058300                                                                  05830031
058400     MOVE IS001-OH-UNT-ADJ-QTY TO PV-QTY-CHANGE.                  05840031
058500                                                                  05850031
058600     EVALUATE IS001-ADJ-ACTN-CDE                                  05860031
058700         WHEN 'D'                                                 05870031
058800            COMPUTE TSKST-ONHAND-QTY =                            05880031
058900                (TSKST-ONHAND-QTY - PV-QTY-CHANGE)                05890031
059000         WHEN 'I'                                                 05900031
059100            COMPUTE TSKST-ONHAND-QTY =                            05910031
059200                (TSKST-ONHAND-QTY + PV-QTY-CHANGE)                05920031
059300         WHEN 'R'                                                 05930031
059400            MOVE TSKST-ONHAND-QTY TO PV-ONHAND-QTY                05940031
059500            MOVE PV-QTY-CHANGE TO TSKST-ONHAND-QTY                05950031
059600         WHEN OTHER                                               05960031
059700            MOVE '3000-' TO PE-PARAGRAPH-NBR                      05970031
059800            MOVE PE-MQ-MSG-DETAIL-2 TO FS013-ERROR-DESCRIPTION    05980031
059900            PERFORM 9995-DB2-ROLLBACK                             05990031
060000            SET PS-ERROR TO TRUE                                  06000031
060100            PERFORM 5000-FORMAT-ERROR-MESSAGE                     06010031
060200            PERFORM 4400-MQPUT1-ERROR-QUEUE                       06020031
060300     END-EVALUATE.                                                06030031
060400                                                                  06040031
060500******************************************************************06050031
060600* SELECT THE TSKST INFO FOR THE CORPORATE STORE.                 *06060031
060700******************************************************************06070031
060800 3025-SELECT-TSKST-CORP-INFO.                                     06080031
060900                                                                  06090031
061000     INITIALIZE PV-RETRY-COUNTER                                  06100031
061100                DCLTSKST.                                         06110031
061200                                                                  06120031
061300     MOVE PC-CORP-LOC-NBR TO PV-LOC-NBR.                          06130031
061400     MOVE PV-LOC-NBR TO PV-LOC-NBR-COMP.                          06140031
061500                                                                  06150031
061600     PERFORM 7100-SELECT-TSKST                                    06160031
061700         WITH TEST AFTER                                          06170031
061800         UNTIL ((SQLCODE = ZERO)                                  06180031
061900                 OR (SQLCODE = +100)                              06190031
062000                 OR (PV-RETRY-COUNTER > PC-MAX-RETRY-CNT)).       06200031
062100                                                                  06210031
062200     EVALUATE TRUE                                                06220031
062300         WHEN SQLCODE = ZERO                                      06230031
062400             CONTINUE                                             06240031
062500         WHEN OTHER                                               06250031
062600             MOVE '7100' TO PE-DB2-PARA                           06260031
062700             MOVE SQLCODE TO SQLCODE2                             06270031
062800             MOVE SQLCODE2 TO PE-DB2-SQLCODE                      06280031
062900             MOVE PE-DB2-ERROR-MESSAGE TO FS013-ERROR-DESCRIPTION 06290031
062910             PERFORM 9995-DB2-ROLLBACK                            06291031
062920             SET PS-ERROR TO TRUE                                 06292031
062930             PERFORM 5000-FORMAT-ERROR-MESSAGE                    06293031
062940             PERFORM 4400-MQPUT1-ERROR-QUEUE                      06294031
062950     END-EVALUATE.                                                06295031
062960                                                                  06296031
062970******************************************************************06297031
062980* CALCULATE THE QUANTITY CHANGE BASED ON THE ACTION CODE FOR     *06298031
062990* THE CORPORATE STORE.  PLEASE NOTE THAT IN THE CASE OF A        *06299031
063000* REPLACEMENT (R) CODE THE ORIGINAL SPECIFIC STORE'S ONHAND      *06300031
063100* QUANTITY WILL BE SUBTRACTED OUT OF THE CORPORATE'S ONHAND      *06310031
063200* QUANTITY.  THEN, THE NEW SPECIFIC STORE'S ONHAND QUANTITY WILL *06320031
063300* BE ADDED TO THE CORPORATE'S ONHAND QUANTITY.                   *06330031
063400******************************************************************06340031
063500 3050-EVAL-TSKST-QTY-CHG-CORP.                                    06350031
063600                                                                  06360031
063700     MOVE IS001-OH-UNT-ADJ-QTY TO PV-QTY-CHANGE.                  06370031
063800                                                                  06380031
063900     EVALUATE IS001-ADJ-ACTN-CDE                                  06390031
064000         WHEN 'D'                                                 06400031
064100            COMPUTE TSKST-ONHAND-QTY =                            06410031
064200                (TSKST-ONHAND-QTY - PV-QTY-CHANGE)                06420031
064300         WHEN 'I'                                                 06430031
064400            COMPUTE TSKST-ONHAND-QTY =                            06440031
064500                (TSKST-ONHAND-QTY + PV-QTY-CHANGE)                06450031
064600         WHEN 'R'                                                 06460031
064700            COMPUTE TSKST-ONHAND-QTY =                            06470031
064800                (TSKST-ONHAND-QTY - PV-ONHAND-QTY)                06480031
064900            COMPUTE TSKST-ONHAND-QTY =                            06490031
065000                (TSKST-ONHAND-QTY + PV-QTY-CHANGE)                06500031
065100         WHEN OTHER                                               06510031
065200            MOVE '3050-' TO PE-PARAGRAPH-NBR                      06520031
065300            MOVE PE-MQ-MSG-DETAIL-2 TO FS013-ERROR-DESCRIPTION    06530031
065400            PERFORM 9995-DB2-ROLLBACK                             06540031
065500            SET PS-ERROR TO TRUE                                  06550031
065600            PERFORM 5000-FORMAT-ERROR-MESSAGE                     06560031
065700            PERFORM 4400-MQPUT1-ERROR-QUEUE                       06570031
065800     END-EVALUATE.                                                06580031
065900******************************************************************06590031
066000* THIS PARAGRAPH WILL CALL THE TSKST UPDATE PARAGRAPH            *06600031
066100******************************************************************06610031
066200 3100-PROCESS-UPDATES.                                            06620031
066300                                                                  06630031
066400     PERFORM 7200-UPDATE-TSKST                                    06640031
066500         WITH TEST AFTER                                          06650031
066600         UNTIL ((SQLCODE = ZERO)                                  06660031
066700                 OR (PV-RETRY-COUNTER > PC-MAX-RETRY-CNT)).       06670031
066800                                                                  06680031
066900     EVALUATE TRUE                                                06690031
067000         WHEN SQLCODE = ZERO                                      06700031
067100             CONTINUE                                             06710031
067200         WHEN OTHER                                               06720031
067300             MOVE '7200' TO PE-DB2-PARA                           06730031
067400             MOVE SQLCODE TO SQLCODE2                             06740031
067500             MOVE SQLCODE2 TO PE-DB2-SQLCODE                      06750031
067600             MOVE PE-DB2-ERROR-MESSAGE TO FS013-ERROR-DESCRIPTION 06760031
067700             PERFORM 9995-DB2-ROLLBACK                            06770031
067800             SET PS-ERROR TO TRUE                                 06780031
067900             PERFORM 5000-FORMAT-ERROR-MESSAGE                    06790031
068000             PERFORM 4400-MQPUT1-ERROR-QUEUE                      06800031
068100     END-EVALUATE.                                                06810031
068200                                                                  06820031
068300******************************************************************06830031
068400* CALCULATE THE INSERT QUANTITY BASED ON THE ACTION CODE FOR     *06840031
068500* THE CORPORATE STORE.                                           *06850031
068600******************************************************************06860031
068700 3150-EVAL-TSKST-QTY-INSERT.                                      06870031
068800                                                                  06880031
068900     MOVE IS001-OH-UNT-ADJ-QTY TO PV-QTY-CHANGE.                  06890031
069000                                                                  06900031
069100     EVALUATE IS001-ADJ-ACTN-CDE                                  06910031
069200         WHEN 'D'                                                 06920031
069300            COMPUTE PV-QTY-CHANGE =                               06930031
069400                (PV-QTY-CHANGE * -1)                              06940031
069500         WHEN 'I'                                                 06950031
069600         WHEN 'R'                                                 06960031
069700            CONTINUE                                              06970031
069800         WHEN OTHER                                               06980031
069900            MOVE '3150-' TO PE-PARAGRAPH-NBR                      06990031
070000            MOVE PE-MQ-MSG-DETAIL-2 TO FS013-ERROR-DESCRIPTION    07000031
070100            PERFORM 9995-DB2-ROLLBACK                             07010031
070200            SET PS-ERROR TO TRUE                                  07020031
070300            PERFORM 5000-FORMAT-ERROR-MESSAGE                     07030031
070400            PERFORM 4400-MQPUT1-ERROR-QUEUE                       07040031
070500     END-EVALUATE.                                                07050031
070600                                                                  07060031
070700******************************************************************07070031
070800* THIS PARAGRAPH WILL CALL THE TSKST INSERT PARAGRAPH            *07080031
070900******************************************************************07090031
071000 3200-PROCESS-TSKST-INSERT.                                       07100031
071100                                                                  07110031
071200     INITIALIZE PV-RETRY-COUNTER                                  07120031
071300                DCLTSKST.                                         07130031
071400                                                                  07140031
071500     MOVE PV-ITEM-NBR TO TSKST-ITEM-NMBR.                         07150031
071600     MOVE PV-LOC-NBR-HOLD TO PV-LOC-NBR                           07160031
071700                             PV-LOC-NBR-COMP.                     07170031
071800     MOVE PV-LOC-NBR-COMP TO TSKST-LOC-NBR.                       07180031
072000     MOVE PV-QTY-CHANGE TO TSKST-ONHAND-QTY.                      07200031
072100                                                                  07210031
072200     PERFORM 7300-INSERT-TSKST                                    07220031
072300         WITH TEST AFTER                                          07230031
072400         UNTIL ((SQLCODE = ZERO)                                  07240031
072500                 OR (PV-RETRY-COUNTER > PC-MAX-RETRY-CNT)).       07250031
072600                                                                  07260031
072700     EVALUATE TRUE                                                07270031
072800         WHEN SQLCODE = ZERO                                      07280031
072900             CONTINUE                                             07290031
073000         WHEN OTHER                                               07300031
073100             MOVE '7300' TO PE-DB2-PARA                           07310031
073200             MOVE SQLCODE TO SQLCODE2                             07320031
073300             MOVE SQLCODE2 TO PE-DB2-SQLCODE                      07330031
073400             MOVE PE-DB2-ERROR-MESSAGE TO FS013-ERROR-DESCRIPTION 07340031
073410             PERFORM 9995-DB2-ROLLBACK                            07341031
073420             SET PS-ERROR TO TRUE                                 07342031
073430             PERFORM 5000-FORMAT-ERROR-MESSAGE                    07343031
073440             PERFORM 4400-MQPUT1-ERROR-QUEUE                      07344031
073450     END-EVALUATE.                                                07345031
073460                                                                  07346031
073470******************************************************************07347031
073480*    CONNECT TO THE QUEUE MANAGER.                               *07348031
073490******************************************************************07349031
073500 4000-CONNECT-TO-Q-MGR.                                           07350031
073600                                                                  07360031
073700     CALL PC-MQCONN USING CC-QMGR-NAME                            07370031
073800                          PV-CONNECT-HANDLE                       07380031
073900                          PV-COMPLETION-CODE                      07390031
074000                          PV-REASON.                              07400031
074100                                                                  07410031
074200     MOVE PV-REASON TO PV-CONNECT-REASON.                         07420031
074300     IF (PV-COMPLETION-CODE = MQCC-OK)                            07430031
074400        CONTINUE                                                  07440031
074500     ELSE                                                         07450031
074600        MOVE 'MQCONN' TO PE-MQ-CALL-TYPE                          07460031
074700        MOVE PV-COMPLETION-CODE TO PV-DISPLAY-COMP-CODE           07470031
074800        MOVE PV-DISPLAY-COMP-CODE TO PE-MQ-COMPLETION-CODE        07480031
074900        MOVE PV-REASON TO PV-DISPLAY-REASON                       07490031
075000        MOVE PV-DISPLAY-REASON TO PE-MQ-REASON-CODE               07500031
075100        PERFORM 9000-MQ-ERROR                                     07510031
075200     END-IF.                                                      07520031
075300                                                                  07530031
075400******************************************************************07540031
075500*    OPEN THE ADJUSTMENT QUEUE FOR INPUT.                        *07550031
075600******************************************************************07560031
075700 4100-OPEN-ADJUST-QUEUE.                                          07570031
075800                                                                  07580031
075900     COMPUTE PV-OPEN-OPTIONS = MQOO-INPUT-SHARED +                07590031
076000                               MQOO-FAIL-IF-QUIESCING.            07600031
076100                                                                  07610031
076200     MOVE CC-FS-MERCH-ADJ-Q-NAME TO MQOD-OBJECTNAME.              07620031
076300                                                                  07630031
076400     MOVE CC-QMGR-NAME TO MQOD-OBJECTQMGRNAME.                    07640031
076500                                                                  07650031
076600     CALL PC-MQOPEN USING PV-CONNECT-HANDLE                       07660031
076700                          MQM-OBJECT-DESCRIPTOR                   07670031
076800                          PV-OPEN-OPTIONS                         07680031
076900                          PV-GETQ-HANDLE                          07690031
077000                          PV-COMPLETION-CODE                      07700031
077100                          PV-REASON.                              07710031
077200                                                                  07720031
077300     IF (PV-COMPLETION-CODE = MQCC-OK)                            07730031
077400        CONTINUE                                                  07740031
077500     ELSE                                                         07750031
077600        MOVE 'MQOPEN' TO PE-MQ-CALL-TYPE                          07760031
077700        MOVE PV-COMPLETION-CODE TO PV-DISPLAY-COMP-CODE           07770031
077800        MOVE PV-DISPLAY-COMP-CODE TO PE-MQ-COMPLETION-CODE        07780031
077900        MOVE PV-REASON TO PV-DISPLAY-REASON                       07790031
078000        MOVE PV-DISPLAY-REASON TO PE-MQ-REASON-CODE               07800031
078100        PERFORM 4900-DISCONNECT-FROM-Q-MNGR                       07810031
078200        PERFORM 9000-MQ-ERROR                                     07820031
078300     END-IF.                                                      07830031
078400                                                                  07840031
078500******************************************************************07850031
078600*    GET THE ADJUSTMENT MESSAGE FROM THE QUEUE.                  *07860031
078700******************************************************************07870031
078800 4200-GET-ADJUST-REQUEST.                                         07880031
078900                                                                  07890031
079000*** SETUP MQGMO-OPTIONS                                           07900031
079100     COMPUTE MQGMO-OPTIONS = MQGMO-WAIT +                         07910031
079200                             MQGMO-NO-SYNCPOINT +                 07920031
079300                             MQGMO-CONVERT +                      07930031
079400                             MQGMO-FAIL-IF-QUIESCING.             07940031
079500*** PLEASE NOTE THAT THE NO-SYNCPOINT OPTION MEANS THAT ALL       07950031
079600*** READS OF THE QUEUE ARE DESTRUCTIVE.                           07960031
079700                                                                  07970031
079800     MOVE MQWI-UNLIMITED  TO  MQGMO-WAITINTERVAL.                 07980031
079900                                                                  07990031
080000*** THE MESSAGE ID AND CORREL ID ARE BLANKED BEFORE EACH          08000031
080100*** MQGET.                                                        08010031
080200     MOVE SPACES    TO PV-GET-MESSAGE-BUFFER.                     08020031
080300     MOVE MQMI-NONE TO MQMD-MSGID.                                08030031
080400     MOVE MQCI-NONE TO MQMD-CORRELID.                             08040031
080500                                                                  08050031
080600     CALL  PC-MQGET  USING PV-CONNECT-HANDLE                      08060031
080700                           PV-GETQ-HANDLE                         08070031
080800                           MQMD                                   08080031
080900                           MQGMO                                  08090031
081000                           PV-GET-MSG-BUFFER-LENGTH               08100031
081100                           PV-GET-MESSAGE-BUFFER                  08110031
081200                           PV-GET-DATA-LENGTH                     08120031
081300                           PV-COMPLETION-CODE                     08130031
081400                           PV-REASON.                             08140031
081500                                                                  08150031
RONNA ***DISPLAY THE MESSAGE                                            08151033
RONNA      DISPLAY 'AFTER THE MQGET              '                      08152033
RONNA      DISPLAY 'PV-GET-MESSAGE-BUFFER :  '                          08153033
RONNA               PV-GET-MESSAGE-BUFFER                               08154033
081600*** IF GET FAILED, DISPLAY THE ERROR MESSAGE AND TERMINATE        08160031
081700*** THE PROGRAM.                                                  08170031
081800                                                                  08180031
081900     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        08190031
082000       IF (PV-REASON NOT = MQRC-NO-MSG-AVAILABLE)                 08200031
082100         IF PV-REASON = MQRC-TRUNCATED-MSG-FAILED                 08210031
082200            DISPLAY 'INVALID MESSAGE LENGTH - GET MSG TRUNCATED'  08220031
082300         END-IF                                                   08230031
082400         MOVE 'MQGET ' TO PE-MQ-CALL-TYPE                         08240031
082500         MOVE PV-COMPLETION-CODE TO PV-DISPLAY-COMP-CODE          08250031
082600         MOVE PV-DISPLAY-COMP-CODE TO PE-MQ-COMPLETION-CODE       08260031
082700         MOVE PV-REASON TO PV-DISPLAY-REASON                      08270031
082800         MOVE PV-DISPLAY-REASON TO PE-MQ-REASON-CODE              08280031
082900         PERFORM 4900-DISCONNECT-FROM-Q-MNGR                      08290031
083000         PERFORM 9000-MQ-ERROR                                    08300031
083100       END-IF                                                     08310031
083200       SET PS-END-OF-QUEUE TO TRUE                                08320031
083300     END-IF.                                                      08330031
083400*PLEASE NOTE THAT IF THE PROGRAM ABENDS WITH A WARNING - TRUNCATED08340031
083500*MESSAGE.  THE MESSAGE WILL NEED TO BE DELETED BEFORE THE STARTED 08350031
083600*TASK CAN PROCESS AGAIN.                                          08360031
083700                                                                  08370031
083800     ADD +1 TO PA-MQ-MSGS                                         08380031
083900     MOVE PV-GET-MESSAGE-BUFFER TO IS001-MERCH-ADJUST-RECORD.     08390031
084000                                                                  08400031
084100*THE "END RUN OF PROGRAM" MSG WILL SHUT DOWN THIS STARTED TASK.   08410031
084200      IF IS001-MERCH-ADJUST-RECORD (1:18) = PC-END-RUN-MSG        08420031
084300         SET PS-END-OF-QUEUE TO TRUE                              08430031
084400      END-IF.                                                     08440031
084500                                                                  08450031
084600******************************************************************08460031
084700*    CLOSE THE ADJUSTMENT QUEUE.                                 *08470031
084800******************************************************************08480031
084900 4300-CLOSE-ADJUST-QUEUE.                                         08490031
085000                                                                  08500031
085100     CALL PC-MQCLOSE USING PV-CONNECT-HANDLE                      08510031
085200                           PV-GETQ-HANDLE                         08520031
085300                           MQCO-NONE                              08530031
085400                           PV-COMPLETION-CODE                     08540031
085500                           PV-REASON.                             08550031
085600                                                                  08560031
085700**** IF CLOSE FAILS DISPLAY SYSTEM ERROR MESSAGE AND              08570031
085800**** EXIT.  THE OPERATOR WILL BE EXPECTED TO CONTACT THE          08580031
085900**** FS PRIMARY ON-CALL.                                          08590031
086000     IF (PV-COMPLETION-CODE = MQCC-OK)                            08600031
086100        CONTINUE                                                  08610031
086200     ELSE                                                         08620031
086300        MOVE 'MQCLOSE' TO PE-MQ-CALL-TYPE                         08630031
086400        MOVE PV-COMPLETION-CODE TO PV-DISPLAY-COMP-CODE           08640031
086500        MOVE PV-DISPLAY-COMP-CODE TO PE-MQ-COMPLETION-CODE        08650031
086600        MOVE PV-REASON TO PV-DISPLAY-REASON                       08660031
086700        MOVE PV-DISPLAY-REASON TO PE-MQ-REASON-CODE               08670031
086800        PERFORM 4900-DISCONNECT-FROM-Q-MNGR                       08680031
086900        PERFORM 9000-MQ-ERROR                                     08690031
087000     END-IF.                                                      08700031
087100                                                                  08710031
087200                                                                  08720031
087300******************************************************************08730031
087400*   THIS PARAGRAPH WILL PERFORM THE FOLLOWING FUNCTIONS -        *08740031
087500*   OPENS ERROR QUEUE, PUTS MESSAGE TO ERROR QUEUE AND           *08750031
087600*   CLOSES THE ERROR QUEUE.                                      *08760031
087700******************************************************************08770031
087800 4400-MQPUT1-ERROR-QUEUE.                                         08780031
087900                                                                  08790031
088000     COMPUTE MQPMO-OPTIONS = MQPMO-NO-SYNCPOINT                   08800031
088100                           + MQPMO-FAIL-IF-QUIESCING.             08810031
088200                                                                  08820031
088300     MOVE MQOT-Q  TO  MQOD-OBJECTTYPE.                            08830031
088400     MOVE CC-FS-ERROR-Q-NAME TO MQOD-OBJECTNAME.                  08840031
088500     MOVE MQPER-PERSISTENT TO MQMD-PERSISTENCE.                   08850031
088600     MOVE LOW-VALUES  TO  PV-PUT-MESSAGE-BUFFER.                  08860031
088700     MOVE FS013-FS-ERROR-RECORD                                   08870031
088800          TO PV-PUT-MESSAGE-BUFFER.                               08880031
088900                                                                  08890031
089000     CALL PC-MQPUT1 USING PV-CONNECT-HANDLE                       08900031
089100                          MQM-OBJECT-DESCRIPTOR                   08910031
089200                          MQM-MESSAGE-DESCRIPTOR                  08920031
089300                          MQM-PUT-MESSAGE-OPTIONS                 08930031
089400                          PV-PUT-MSG-BUFFER-LENGTH                08940031
089500                          PV-PUT-MESSAGE-BUFFER                   08950031
089600                          PV-COMPLETION-CODE                      08960031
089700                          PV-REASON.                              08970031
089800                                                                  08980031
089900**** IF THE PUT1 FAILS DISPLAY SYSTEM ERROR MESSAGE AND           08990031
090000**** EXIT.  THE OPERATOR WILL BE EXPECTED TO CONTACT THE          09000031
090100**** FS PRIMARY ON-CALL.                                          09010031
090200     IF (PV-COMPLETION-CODE = MQCC-OK)                            09020031
090300        CONTINUE                                                  09030031
090400     ELSE                                                         09040031
090500        MOVE 'MQPUT1' TO PE-MQ-CALL-TYPE                          09050031
090600        MOVE PV-COMPLETION-CODE TO PV-DISPLAY-COMP-CODE           09060031
090700        MOVE PV-DISPLAY-COMP-CODE TO PE-MQ-COMPLETION-CODE        09070031
090800        MOVE PV-REASON TO PV-DISPLAY-REASON                       09080031
090900        MOVE PV-DISPLAY-REASON TO PE-MQ-REASON-CODE               09090031
091000        PERFORM 4300-CLOSE-ADJUST-QUEUE                           09100031
091100        PERFORM 4900-DISCONNECT-FROM-Q-MNGR                       09110031
091200        PERFORM 9000-MQ-ERROR                                     09120031
091300     END-IF.                                                      09130031
091400                                                                  09140031
091500******************************************************************09150031
091600*    DISCONNECT FROM THE QUEUE MANAGER.                          *09160031
091700******************************************************************09170031
091800 4900-DISCONNECT-FROM-Q-MNGR.                                     09180031
091900                                                                  09190031
092000     IF PV-CONNECT-REASON IS NOT EQUAL TO MQRC-ALREADY-CONNECTED  09200031
092100       CALL PC-MQDISC USING PV-CONNECT-HANDLE                     09210031
092200                            PV-COMPLETION-CODE                    09220031
092300                            PV-REASON                             09230031
092400       IF (PV-COMPLETION-CODE = MQCC-OK)                          09240031
092500          CONTINUE                                                09250031
092600       ELSE                                                       09260031
092700         MOVE 'MQDISC' TO PE-MQ-CALL-TYPE                         09270031
092800         MOVE PV-COMPLETION-CODE TO PV-DISPLAY-COMP-CODE          09280031
092900         MOVE PV-DISPLAY-COMP-CODE TO PE-MQ-COMPLETION-CODE       09290031
093000         MOVE PV-REASON      TO PV-DISPLAY-REASON                 09300031
093100         MOVE PV-DISPLAY-REASON TO PE-MQ-REASON-CODE              09310031
093200         PERFORM 9000-MQ-ERROR                                    09320031
093300       END-IF                                                     09330031
093400     END-IF.                                                      09340031
093500                                                                  09350031
093600******************************************************************09360031
093700* FORMAT MQ ERROR MESSAGE.                                       *09370031
093800******************************************************************09380031
093900 5000-FORMAT-ERROR-MESSAGE.                                       09390031
094000                                                                  09400031
094100     MOVE IS001-FR-DEPT-NBR     TO  FS013-FR-DEPT-NBR.            09410031
094200     MOVE IS001-FR-MAJ-CL-NBR   TO  FS013-FR-MAJ-CL-NBR.          09420031
094300     MOVE IS001-FR-SUB-CL-NBR   TO  FS013-FR-SUB-CL-NBR           09430031
094400     MOVE IS001-FR-SKU-NBR      TO  FS013-FR-SKU-NBR.             09440031
094500     MOVE IS001-STR-NBR         TO  FS013-STR-NBR.                09450031
094600     MOVE IS001-WHSE-NBR        TO  FS013-WHSE-NBR.               09460031
094700     MOVE IS001-MDSE-ADJ-ID     TO  FS013-MDSE-ADJ-ID.            09470031
094800     MOVE IS001-ADJ-TYP-CDE     TO  FS013-ADJ-TYP-CDE.            09480031
094900     MOVE IS001-ADJ-ACTN-CDE    TO  FS013-ADJ-ACTN-CDE.           09490031
095000     MOVE IS001-OH-UNT-ADJ-QTY  TO  FS013-OH-UNT-ADJ-QTY.         09500031
095100                                                                  09510031
095200******************************************************************09520031
095300* SELECT TSKST INFO FOR PROCESSING.                              *09530031
095400******************************************************************09540031
095500 7100-SELECT-TSKST.                                               09550031
095600                                                                  09560031
095700     EXEC SQL                                                     09570031
095800          SELECT ONHAND_QTY                                       09580031
095900            INTO :TSKST-ONHAND-QTY                                09590031
096000            FROM TSKST                                            09600031
096100           WHERE ITEM_NMBR     = :PV-ITEM-NBR                     09610031
096200             AND LOC_NBR   = :PV-LOC-NBR-COMP                     09620031
096300     END-EXEC.                                                    09630031
096400                                                                  09640031
096500     EVALUATE TRUE                                                09650031
096600         WHEN SQLCODE = ZERO                                      09660031
096700         WHEN SQLCODE = +100                                      09670031
096800             CONTINUE                                             09680031
096900         WHEN SQLCODE = -911                                      09690031
097000         WHEN SQLCODE = -913                                      09700031
097100             ADD 1 TO PV-RETRY-COUNTER                            09710031
097200         WHEN OTHER                                               09720031
097300             MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-COUNTER      09730031
097400     END-EVALUATE.                                                09740031
097500                                                                  09750031
097600******************************************************************09760031
097700* UPDATE ONHAND AND CUTOFF ONHAND QUANTITY.                      *09770031
097800******************************************************************09780031
097900 7200-UPDATE-TSKST.                                               09790031
098000                                                                  09800031
098100     EXEC SQL                                                     09810031
098200          UPDATE TSKST                                            09820031
098300             SET ONHAND_QTY         = :TSKST-ONHAND-QTY           09830031
098400                ,LAST_UPD_TMST      = CURRENT TIMESTAMP           09840031
098500           WHERE ITEM_NMBR     = :PV-ITEM-NBR                     09850031
098600             AND LOC_NBR  = :PV-LOC-NBR-COMP                      09860031
098700     END-EXEC.                                                    09870031
098800                                                                  09880031
098900     EVALUATE TRUE                                                09890031
099000         WHEN SQLCODE = ZERO                                      09900031
099100             ADD +1 TO PA-TSKST-UPD                               09910031
099200         WHEN SQLCODE = -911                                      09920031
099300         WHEN SQLCODE = -913                                      09930031
099400             ADD 1 TO PV-RETRY-COUNTER                            09940031
099500         WHEN OTHER                                               09950031
099600             MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-COUNTER      09960031
099700     END-EVALUATE.                                                09970031
099800                                                                  09980031
099900******************************************************************09990031
100000* INSERT ROW TO TSKST.                                           *10000031
100100******************************************************************10010031
100200 7300-INSERT-TSKST.                                               10020031
100300                                                                  10030031
100400     EXEC SQL                                                     10040031
100500          INSERT INTO TSKST                                       10050031
100600                 (ITEM_NMBR,                                      10060031
100800                  ONHAND_QTY,                                     10080031
100900                  LOC_NBR,                                        10090031
101000                  LAST_UPD_TMST)                                  10100031
101100          VALUES (:TSKST-ITEM-NMBR,                               10110031
101300                  :TSKST-ONHAND-QTY,                              10130031
101400                  :TSKST-LOC-NBR,                                 10140031
101500                  CURRENT TIMESTAMP)                              10150031
101600     END-EXEC.                                                    10160031
101700                                                                  10170031
101800     EVALUATE TRUE                                                10180031
101900         WHEN SQLCODE = ZERO                                      10190031
102000             ADD +1 TO PA-TSKST-INS                               10200031
102100         WHEN SQLCODE = -911                                      10210031
102200         WHEN SQLCODE = -913                                      10220031
102300             ADD 1 TO PV-RETRY-COUNTER                            10230031
102400         WHEN OTHER                                               10240031
102500             MOVE PC-MORE-THAN-MAX-RETRY TO PV-RETRY-COUNTER      10250031
102600     END-EVALUATE.                                                10260031
102700***************************************************************** 10270031
102800* READ CONTROL CARD TO OBTAIN THE INPUT QUEUE MGR NAME.           10280031
102900***************************************************************** 10290031
103000 8000-READ-CONTROL-CARD.                                          10300031
103100                                                                  10310031
103200      READ CONTROL-CARD INTO CC-CONTROL-CARD                      10320031
103300          AT END                                                  10330031
103400              SET PS-CONTROL-CARD-END TO TRUE.                    10340031
103500                                                                  10350031
103600***************************************************************** 10360031
103700* READ SECOND CONTROL CARD TO OBTAIN THE INPUT/OUTPUT QUEUE NAMES 10370031
103800***************************************************************** 10380031
103900 8010-READ-CONTROL-CARD-2.                                        10390031
104000                                                                  10400031
104100      READ CONTROL-CARD-2 INTO CC-CONTROL-CARD-2                  10410031
104200          AT END                                                  10420031
104300              SET PS-CONTROL-CARD-2-END   TO TRUE.                10430031
104400                                                                  10440031
104500***************************************************************** 10450031
104600* DISPLAY THE VALUES OF A FAILED MQ API COMMAND                   10460031
104700***************************************************************** 10470031
104800 9000-MQ-ERROR.                                                   10480031
104900                                                                  10490031
105000     DISPLAY '************************************************'.  10500031
105100     DISPLAY '**** ABEND *************************************'.  10510031
105200     DISPLAY '************************************************'.  10520031
105300     DISPLAY PE-MQ-ERROR-MESSAGE.                                 10530031
105400     DISPLAY '************************************************'.  10540031
105500     DISPLAY '**** PROGRAM COUNTERS AT TIME OF ABEND *********'.  10550031
105600     DISPLAY '************************************************'.  10560031
105700     DISPLAY '** NUMBER OF MQ MESSAGES: ', PA-MQ-MSGS.            10570031
105800     DISPLAY '** NUMBER OF RA ADJUSTMENTS: ', PA-RA-ADJ.          10580031
105900     DISPLAY '** NUMBER OF OA ADJUSTMENTS: ', PA-OA-ADJ.          10590031
106000     DISPLAY '** NUMBER OF ST ADJUSTMENTS: ', PA-ST-ADJ.          10600031
106100     DISPLAY '** NUMBER OF TSKST UPDATES: ', PA-TSKST-UPD.        10610031
106200     DISPLAY '** NUMBER OF TSKST INSERTS: ', PA-TSKST-INS.        10620031
106300     DISPLAY '************************************************'.  10630031
106400     SET AC-MQ-ERROR TO TRUE.                                     10640031
106500     CALL 'ILBOABN0' USING ABEND-CODE.                            10650031
106600                                                                  10660031
106700***************************************************************** 10670031
106800* PERFORM AN DB2 COMMIT.                                          10680031
106900***************************************************************** 10690031
107000 9990-DB2-COMMIT.                                                 10700031
107100                                                                  10710031
107200     EXEC SQL                                                     10720031
107300         COMMIT                                                   10730031
107400     END-EXEC.                                                    10740031
107500                                                                  10750031
107600***************************************************************** 10760031
107700* PERFORM AN DB2 ROLLBACK.                                        10770031
107800***************************************************************** 10780031
107900 9995-DB2-ROLLBACK.                                               10790031
108000                                                                  10800031
108100     EXEC SQL                                                     10810031
108200         ROLLBACK                                                 10820031
108300     END-EXEC.                                                    10830031
108400                                                                  10840031
108500***************************************************************** 10850031
108600* END OF JOB PROCESSING.                                          10860031
108700***************************************************************** 10870031
108800 9999-EOJ-PROCESSING.                                             10880031
108900                                                                  10890031
109000     PERFORM 4300-CLOSE-ADJUST-QUEUE.                             10900031
109100     PERFORM 4900-DISCONNECT-FROM-Q-MNGR.                         10910031
109200                                                                  10920031
109300     DISPLAY '************************************************'.  10930031
109400     DISPLAY '********  END OF JOB PROGRAM COUNTERS  *********'.  10940031
109500     DISPLAY '************************************************'.  10950031
109600     DISPLAY '** NUMBER OF MQ MESSAGES: ', PA-MQ-MSGS.            10960031
109700     DISPLAY '** NUMBER OF RA ADJUSTMENTS: ', PA-RA-ADJ.          10970031
109800     DISPLAY '** NUMBER OF OA ADJUSTMENTS: ', PA-OA-ADJ.          10980031
109900     DISPLAY '** NUMBER OF ST ADJUSTMENTS: ', PA-ST-ADJ.          10990031
110000     DISPLAY '** NUMBER OF TSKST UPDATES: ', PA-TSKST-UPD.        11000031
110100     DISPLAY '** NUMBER OF TSKST INSERTS: ', PA-TSKST-INS.        11010031
110200     DISPLAY '************************************************'.  11020031
110300                                                                  11030031
