000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     VNKUT104.                                        00020013
000300 AUTHOR.         KRYSTEN LEARY.                                   00030013
000400 DATE-WRITTEN.   MARCH 2005.                                      00040013
000500*************************************************************     00050000
000600*    COBOL 2 WITH SQL.                                      *     00060001
000610*-----------------------------------------------------------*     00061014
000620*   VENDOR CAPABILITIES/VENDOR CAPABILITIES CODE EXTRACTS   *     00062020
000700*-----------------------------------------------------------*     00070013
000710* THE PURPOSE OF THIS PROGRAM IS TO PRODUCE TWO EXTRACT     *     00071020
000720* FILES; ONE WILL CONTAIN INFORMATION FROM THE VENDOR       *     00072020
000730* CAPABILITIES TABLE (VNT_VND_CPBL), WHILE THE OTHER WILL   *     00073020
000740* CONTAIN INFORMATION FROM THE VENDOR CAPABILITIES CODE     *     00074020
000750* TABLE (VNT_VND_CPBL_CDE).  THE DATA WILL BE USED BY       *     00075020
000760* ANYONE THAT IS NOT IN THE VENDOR DOMAIN AND WANTS TO      *     00076020
000770* REPRODUCE THE VENDOR CAPABILITIES OR VENDOR CAPABILITIES  *     00077020
000780* CODE TABLES.                                              *     00078020
001400*************************************************************     00140000
001500*                                                           *     00150000
001600* DB2 TABLES:                                               *     00160000
001700*  1. VENDOR CAPABILITIES TABLE          (VNT_VND_CPBL)     *     00170019
001800*  2. VENDOR CAPABILITIES CODE TABLE     (VNT_VND_CPBL_CDE) *     00180020
001900*                                                           *     00190000
002000* OUTPUT:                                                   *     00200000
002100*  1. VENDOR CAPABILITIES EXTRACT FILE          (VNRD104)   *     00210020
002110*  2. VENDOR CAPABILITIES CODE EXTRACT FILE     (VNRD105)   *     00211020
002200*************************************************************     00220000
002300* CHANGE LOG:                                               *     00230000
002400*                                                           *     00240000
002500* DATE  03/09/2005                                          *     00250013
002600*     CHANGE MADE: E-COMM DIRECT TO CONSUMER PROJECT        *     00260025
002610*     INITIAL VERSION.                                      *     00261026
002700*     MADE BY: KRYSTEN LEARY           WR/IR #: WR28461     *     00270013
002900*************************************************************     00290000
003000                                                                  00300000
003100 ENVIRONMENT DIVISION.                                            00310000
003200                                                                  00320000
003300 INPUT-OUTPUT SECTION.                                            00330000
003400                                                                  00340000
003500 FILE-CONTROL.                                                    00350000
003600     SELECT VNDR-CPBL-EXTRCT-FILE         ASSIGN TO OUT01.        00360021
003610     SELECT VNDR-CPBL-CD-EXTRCT-FILE      ASSIGN TO OUT02.        00361022
003700                                                                  00370000
003800 DATA DIVISION.                                                   00380000
003900                                                                  00390000
004000 FILE SECTION.                                                    00400000
004100 FD  VNDR-CPBL-EXTRCT-FILE                                        00410020
004200     RECORDING MODE IS F                                          00420000
004300     LABEL RECORDS ARE STANDARD                                   00430000
004400     DATA RECORD IS VNDR-CPBL-EXTRCT-REC.                         00440020
004500 01  VNDR-CPBL-EXTRCT-REC         PIC  X(100).                    00450020
004510                                                                  00451020
004600 FD  VNDR-CPBL-CD-EXTRCT-FILE                                     00460022
004610     RECORDING MODE IS F                                          00461020
004620     LABEL RECORDS ARE STANDARD                                   00462020
004630     DATA RECORD IS VNDR-CPBL-CD-EXTRCT-REC.                      00463022
004640 01  VNDR-CPBL-CD-EXTRCT-REC      PIC  X(100).                    00464022
004700                                                                  00470000
004800/                                                                 00480000
004900 WORKING-STORAGE SECTION.                                         00490000
005000                                                                  00500000
005100 01  FILLER                        PIC X(25)  VALUE               00510000
005200                             'WS FOR VNKUT104 BEGINS==>'.         00520013
005300                                                                  00530000
005400 01  WS-RETRY-COUNTER              PIC S9(4)  COMP VALUE ZERO.    00540000
005500 01  WS-RETRY-MAX                  PIC S9(4)  COMP VALUE 3.       00550000
005600                                                                  00560000
005700 01  PS-SWITCH-AREA.                                              00570000
005800     05  WS-END-OF-VNDR-CPBL-SW        PIC X(1)   VALUE 'N'.      00580020
005900         88  WS-END-OF-VNDR-CPBL-CSR              VALUE 'Y'.      00590020
005910     05  WS-END-OF-VNDR-CD-SW          PIC X(1)   VALUE 'N'.      00591022
005920         88  WS-END-OF-VNDR-CD-CSR                VALUE 'Y'.      00592022
006000                                                                  00600000
006100 01  WS-PROGRAM-COUNTERS.                                         00610000
006200     05  WS-VNDR-REC-ROWS-FETCHED      PIC  9(09) VALUE ZEROS.    00620020
006300     05  WS-VNDR-REC-WRITTEN           PIC  9(09) VALUE ZEROS.    00630020
006400     05  WS-VNDR-CD-REC-ROWS-FETCHED   PIC  9(09) VALUE ZEROS.    00640022
006410     05  WS-VNDR-CD-REC-WRITTEN        PIC  9(09) VALUE ZEROS.    00641022
006500                                                                  00650000
006700*---------------------------------------------------------------* 00670000
006800* SQLA MESSAGE MODULE                                           * 00680014
006900*---------------------------------------------------------------* 00690000
007000     COPY DPWS004.                                                00700000
007100                                                                  00710000
007200*---------------------------------------------------------------* 00720000
007300* VENDOR CAPABILITIES COPYBOOK                                  * 00730020
007400*---------------------------------------------------------------* 00740000
007500     COPY VNRD104.                                                00750013
007501                                                                  00750120
007510*---------------------------------------------------------------* 00751020
007520* VENDOR CAPABILITIES CODE COPYBOOK                             * 00752020
007530*---------------------------------------------------------------* 00753020
007540     COPY VNRD105.                                                00754020
007600                                                                  00760000
007700 01  WS-ABEND-FIELDS.                                             00770000
007800     05  WS-ABEND-PROGRAM          PIC X(8)   VALUE 'VNKUT104'.   00780013
007900     05  WS-ABEND-PARAGRAPH        PIC X(50)  VALUE SPACES.       00790000
008000     05  WS-ABEND-OPERATION        PIC X(50)  VALUE SPACES.       00800000
008100     05  WS-ABEND-STRUCTURE-1      PIC X(8)   VALUE SPACES.       00810000
008200     05  WS-ABEND-STRUCTURE-2      PIC X(8)   VALUE SPACES.       00820000
008300     05  WS-ABEND-STATUS           PIC XX     VALUE SPACES.       00830000
008400                                                                  00840000
008500 01  ABEND-CODE                    PIC S9(4)  COMP SYNC           00850000
008600                                              VALUE ZEROS.        00860000
008700     88 AP-TABLE-FULL              VALUE +4004.                   00870000
008800     88 AP-EMPTY-FILE              VALUE +4005.                   00880000
008900     88 AP-DB2-ERROR               VALUE +4013.                   00890000
009000                                                                  00900000
009100*---------------------------------------------------------------* 00910000
009200*  COMMUNICATIONS AREA2 FOR DB2                                 * 00920014
009300*---------------------------------------------------------------* 00930000
009400     COPY SQLCA2.                                                 00940000
009500                                                                  00950000
009600*---------------------------------------------------------------* 00960000
009700* SQL COMMUNICATIONS AREA DCLGEN                                * 00970014
009800*---------------------------------------------------------------* 00980000
009900     EXEC SQL                                                     00990000
010000          INCLUDE SQLCA                                           01000000
010100     END-EXEC.                                                    01010000
010200                                                                  01020000
010300*---------------------------------------------------------------* 01030000
010400* VENDOR CAPABILITIES TABLE                                     * 01040014
010500*---------------------------------------------------------------* 01050000
010600     EXEC SQL                                                     01060000
010700          INCLUDE VNT00001                                        01070015
010800     END-EXEC.                                                    01080000
010900                                                                  01090000
011000*---------------------------------------------------------------* 01100020
011100* VENDOR CAPABILITIES CODE TABLE                                * 01110020
011200*---------------------------------------------------------------* 01120020
011300     EXEC SQL                                                     01130020
011400          INCLUDE VNT00003                                        01140020
011500     END-EXEC.                                                    01150020
011600                                                                  01160020
011800*---------------------------------------------------------------* 01180000
011900*   THIS IS THE CURSOR THAT RETRIEVES THE VENDOR CAPABILITY     * 01190013
012000*   DATA NEEDED FOR THE EXTRACT FILE                            * 01200013
012100*---------------------------------------------------------------* 01210000
012200     EXEC SQL                                                     01220000
012300        DECLARE VNDR_CPBL_CSR CURSOR FOR                          01230020
012400          SELECT ENT_ID                                           01240014
012500                ,VND_CPBL_CDE                                     01250014
012600                ,EFF_BEG_DTE                                      01260014
012700                ,EFF_END_DTE                                      01270014
012800                ,CRE_DTE                                          01280014
012900                ,LAST_UPD_BY_USR_ID                               01290014
013000                ,LAST_UPD_TMST                                    01300017
013400          FROM VNT_VND_CPBL                                       01340014
013500          ORDER BY ENT_ID                                         01350014
013600                  ,VND_CPBL_CDE                                   01360014
013700     END-EXEC.                                                    01370001
013800                                                                  01380001
013810*---------------------------------------------------------------* 01381020
013820*   THIS IS THE CURSOR THAT RETRIEVES THE VENDOR CAPABILITY     * 01382020
013830*   CODE DATA NEEDED FOR THE EXTRACT FILE                       * 01383020
013840*---------------------------------------------------------------* 01384020
013850     EXEC SQL                                                     01385020
013860        DECLARE VNDR_CPBL_CDE_CSR CURSOR FOR                      01386020
013870          SELECT VND_CPBL_CDE                                     01387020
013880                ,VND_CPBL_DESC                                    01388020
013890                ,ACTV_IND                                         01389020
013893                ,LAST_UPD_BY_USR_ID                               01389320
013894                ,LAST_UPD_TMST                                    01389420
013895          FROM VNT_VND_CPBL_CDE                                   01389520
013896          ORDER BY VND_CPBL_CDE                                   01389620
013898     END-EXEC.                                                    01389820
013899                                                                  01389920
013900 01  FILLER                        PIC X(25) VALUE                01390001
014000          '<====WS FOR VNKUT104 ENDS'.                            01400013
014100                                                                  01410001
014200*********************************                                 01420014
014300 PROCEDURE DIVISION.                                              01430001
014400*********************************                                 01440014
014500 A100-MAINLINE.                                                   01450001
014600                                                                  01460001
014700     PERFORM B100-INITIALIZATION.                                 01470001
014800                                                                  01480001
014900     PERFORM B200-CREATE-VNDR-CPBL-EXTRCT                         01490020
014901       UNTIL WS-END-OF-VNDR-CPBL-CSR.                             01490120
014902                                                                  01490220
014910     PERFORM B300-CREAT-VNDR-CPBL-CD-EXTRCT                       01491024
015010       UNTIL WS-END-OF-VNDR-CD-CSR.                               01501022
015100                                                                  01510001
015200     PERFORM B400-END-OF-JOB.                                     01520020
015300                                                                  01530001
015400     GOBACK.                                                      01540001
015500        EJECT                                                     01550001
015600                                                                  01560001
015700*                                                                 01570001
015800***************************************************************** 01580001
015900*  INITIALIZATION PROCESSING                                    * 01590014
016000*  - OPEN EXTRACT FILES                                         * 01600020
016010*  - INITIALIZE DCLGENS                                         * 01601020
016020*  - OPEN VENDOR CAPABILITIES CURSOR AND FETCH FIRST ROW        * 01602014
016100***************************************************************** 01610001
016200*                                                                 01620001
016300 B100-INITIALIZATION.                                             01630001
016400                                                                  01640001
016500     DISPLAY '**********************************'                 01650001
016600     DISPLAY '*   STARTING PROGRAM VNKUT104    *'                 01660013
016700     DISPLAY '**********************************'                 01670001
016800                                                                  01680001
016900     OPEN OUTPUT VNDR-CPBL-EXTRCT-FILE                            01690020
016910                 VNDR-CPBL-CD-EXTRCT-FILE.                        01691022
017000                                                                  01700001
017100     INITIALIZE DCLVNT00001                                       01710020
017110                DCLVNT00003.                                      01711020
017200                                                                  01720001
017300     PERFORM Y100-OPEN-VNDR-CPBL-CSR.                             01730020
017500     PERFORM R100-FETCH-VNDR-CPBL-CSR.                            01750020
017600                                                                  01760001
017700     IF WS-END-OF-VNDR-CPBL-CSR                                   01770020
017800        DISPLAY '**********************************'              01780001
017900        DISPLAY '*      PROGRAM = VNKUT104        *'              01790013
018000        DISPLAY '**********************************'              01800001
018100        DISPLAY '* NO ROWS WERE SELECTED FROM     *'              01810001
018200        DISPLAY '* THE VENDOR CAPABILITIES CURSOR *'              01820014
018300        DISPLAY '**********************************'              01830001
018400     END-IF.                                                      01840001
018401                                                                  01840120
018410     PERFORM Y200-OPEN-VNDR-CPBL-CD-CSR.                          01841022
018420     PERFORM R200-FETCH-VNDR-CPBL-CD-CSR.                         01842022
018430                                                                  01843020
018440     IF WS-END-OF-VNDR-CD-CSR                                     01844022
018450        DISPLAY '**********************************'              01845020
018460        DISPLAY '*      PROGRAM = VNKUT104        *'              01846020
018470        DISPLAY '**********************************'              01847020
018480        DISPLAY '* NO ROWS WERE SELECTED FROM     *'              01848020
018490        DISPLAY '* THE VENDOR CAPABILITIES CODE   *'              01849020
018491        DISPLAY '* CURSOR.                        *'              01849120
018492        DISPLAY '**********************************'              01849220
018493     END-IF.                                                      01849320
018500                                                                  01850001
018600*                                                                 01860001
018700***************************************************************** 01870001
018800*  PROCESS VNDR_CPBL_CRS RESULTS. MOVES RETRIEVED INFORMATION   * 01880020
018900*  TO THE VNRD104 COPYBOOK USED TO WRITE THE OUTPUT FILE        * 01890020
019000***************************************************************** 01900001
019100*                                                                 01910001
019200 B200-CREATE-VNDR-CPBL-EXTRCT.                                    01920020
019300                                                                  01930001
019400     MOVE VNT00001-ENT-ID           TO VN104-ENT-ID.              01940016
019500     MOVE VNT00001-VND-CPBL-CDE     TO VN104-VND-CPBL-CDE.        01950014
019600     MOVE VNT00001-EFF-BEG-DTE      TO VN104-EFF-BEG-DTE.         01960014
019700     MOVE VNT00001-EFF-END-DTE      TO VN104-EFF-END-DTE.         01970014
019800     MOVE VNT00001-CRE-DTE          TO VN104-CRE-DTE.             01980014
020600     MOVE VNT00001-LAST-UPD-BY-USR-ID                             02060014
020610          TO VN104-LAST-UPD-BY-USR-ID.                            02061014
020700     MOVE VNT00001-LAST-UPD-TMST    TO VN104-LAST-UPD-TMST.       02070014
021000                                                                  02100011
021100     PERFORM W100-WRITE-VNDR-EXTRCT-REC.                          02110020
021300     PERFORM R100-FETCH-VNDR-CPBL-CSR.                            02130020
021400                                                                  02140011
021410*                                                                 02141020
021420***************************************************************** 02142020
021430*  PROCESS VNDR_CPBL_CRS RESULTS. MOVES RETRIEVED INFORMATION   * 02143020
021440*  TO THE VNRD104 COPYBOOK USED TO WRITE THE OUTPUT FILE        * 02144020
021450***************************************************************** 02145020
021460*                                                                 02146020
021470 B300-CREAT-VNDR-CPBL-CD-EXTRCT.                                  02147024
021480                                                                  02148020
021491     MOVE VNT00003-VND-CPBL-CDE     TO VN105-VND-CPBL-CDE.        02149120
021492     MOVE VNT00003-VND-CPBL-DESC    TO VN105-VND-CPBL-DESC.       02149220
021493     MOVE VNT00003-ACTV-IND         TO VN105-ACTV-IND.            02149320
021495     MOVE VNT00003-LAST-UPD-BY-USR-ID                             02149520
021496          TO VN105-LAST-UPD-BY-USR-ID.                            02149620
021497     MOVE VNT00003-LAST-UPD-TMST    TO VN105-LAST-UPD-TMST.       02149720
021498                                                                  02149820
021499     PERFORM W200-WRITE-VNDR-CD-EXTRCT-REC.                       02149923
021501     PERFORM R200-FETCH-VNDR-CPBL-CD-CSR.                         02150124
021502                                                                  02150220
021510*                                                                 02151011
021600***************************************************************** 02160011
021700*  END OF PROGRAM PROCESSING.                                   * 02170014
021800***************************************************************** 02180011
021900*                                                                 02190011
022000 B400-END-OF-JOB.                                                 02200020
022100                                                                  02210011
022200     PERFORM Y300-CLOSE-VNDR-CPBL-CSR.                            02220020
022210     PERFORM Y400-CLOSE-VNDR-CPBL-CD-CSR.                         02221022
022300                                                                  02230011
022400     CLOSE VNDR-CPBL-EXTRCT-FILE                                  02240023
022410           VNDR-CPBL-CD-EXTRCT-FILE.                              02241023
022500                                                                  02250011
022600     DISPLAY 'VENDOR ROWS FETCHED = ' WS-VNDR-REC-ROWS-FETCHED.   02260011
022700     DISPLAY 'VENDOR RECORDS WRITTEN = ' WS-VNDR-REC-WRITTEN.     02270011
022800     DISPLAY 'VENDOR CODE ROWS FETCHED = '                        02280020
022900             WS-VNDR-CD-REC-ROWS-FETCHED.                         02290022
022910     DISPLAY 'VENDOR CODE RECORDS WRITTEN = '                     02291020
022920             WS-VNDR-CD-REC-WRITTEN.                              02292022
023000     DISPLAY 'PROGRAM VNKUT104 ENDS NORMALLY '.                   02300013
023100                                                                  02310011
023200*                                                                 02320011
023300***************************************************************** 02330011
023400* FETCH THE VENDOR REFERENCE INFO FROM THE VNDR_CPBL_CSR CURSOR * 02340020
023500***************************************************************** 02350011
023600*                                                                 02360011
023700 R100-FETCH-VNDR-CPBL-CSR.                                        02370020
023800                                                                  02380011
023900     EXEC SQL                                                     02390011
024000         FETCH VNDR_CPBL_CSR                                      02400020
024100          INTO :VNT00001-ENT-ID                                   02410014
024200              ,:VNT00001-VND-CPBL-CDE                             02420014
024300              ,:VNT00001-EFF-BEG-DTE                              02430014
024400              ,:VNT00001-EFF-END-DTE                              02440014
024500              ,:VNT00001-CRE-DTE                                  02450014
024600              ,:VNT00001-LAST-UPD-BY-USR-ID                       02460014
024700              ,:VNT00001-LAST-UPD-TMST                            02470017
025100     END-EXEC.                                                    02510011
025200                                                                  02520011
025300     EVALUATE TRUE                                                02530011
025400         WHEN SQLCODE = ZERO                                      02540011
025500              ADD 1 TO WS-VNDR-REC-ROWS-FETCHED                   02550011
025600         WHEN SQLCODE = +100                                      02560011
025700               SET WS-END-OF-VNDR-CPBL-CSR TO TRUE                02570020
025800         WHEN SQLWARN0 NOT = SPACES                               02580011
025900         WHEN SQLCODE  NOT = ZERO                                 02590011
026000           MOVE 'R100-FETCH-VNDR-CPBL-CSR' TO WS-ABEND-PARAGRAPH  02600020
026200           MOVE 'UNSUCCESSFUL FETCH'       TO WS-ABEND-OPERATION  02620020
026400           MOVE 'VNT00001'               TO WS-ABEND-STRUCTURE-1  02640020
026500           MOVE '       '                TO WS-ABEND-STRUCTURE-2  02650020
026600           PERFORM Z999-SQL-ERROR                                 02660011
026700     END-EVALUATE.                                                02670011
026900                                                                  02690011
027000*                                                                 02700020
027100***************************************************************** 02710020
027200* FETCH THE VENDOR REFERENCE INFO FROM THE VNDR_CPBL_CDE_CSR    * 02720020
027210* CURSOR                                                        * 02721020
027300***************************************************************** 02730020
027400*                                                                 02740020
027500 R200-FETCH-VNDR-CPBL-CD-CSR.                                     02750022
027600                                                                  02760020
027700     EXEC SQL                                                     02770020
027800         FETCH VNDR_CPBL_CDE_CSR                                  02780020
027900          INTO :VNT00003-VND-CPBL-CDE                             02790020
028000              ,:VNT00003-VND-CPBL-DESC                            02800020
028100              ,:VNT00003-ACTV-IND                                 02810020
028400              ,:VNT00003-LAST-UPD-BY-USR-ID                       02840020
028500              ,:VNT00003-LAST-UPD-TMST                            02850020
028600     END-EXEC.                                                    02860020
028700                                                                  02870020
028800     EVALUATE TRUE                                                02880020
028900         WHEN SQLCODE = ZERO                                      02890020
029000              ADD 1 TO WS-VNDR-CD-REC-ROWS-FETCHED                02900022
029100         WHEN SQLCODE = +100                                      02910020
029200               SET WS-END-OF-VNDR-CD-CSR TO TRUE                  02920022
029300         WHEN SQLWARN0 NOT = SPACES                               02930020
029400         WHEN SQLCODE  NOT = ZERO                                 02940020
029500           MOVE 'R200-FETCH-VNDR-CPBL-CD-CSR'                     02950022
029510                                           TO WS-ABEND-PARAGRAPH  02951020
029600           MOVE 'UNSUCCESSFUL FETCH'       TO WS-ABEND-OPERATION  02960020
029700           MOVE 'VNT00003'               TO WS-ABEND-STRUCTURE-1  02970020
029800           MOVE '       '                TO WS-ABEND-STRUCTURE-2  02980020
029900           PERFORM Z999-SQL-ERROR                                 02990020
030000     END-EVALUATE.                                                03000020
030100                                                                  03010020
030500*                                                                 03050011
030600***************************************************************** 03060011
030700* WRITE RETRIEVED INFORMATION TO THE VENDOR CAPABILITIES        * 03070014
030710* EXTRACT RECORD                                                * 03071014
030800***************************************************************** 03080011
030900*                                                                 03090011
031000 W100-WRITE-VNDR-EXTRCT-REC.                                      03100023
031100                                                                  03110011
031200     WRITE VNDR-CPBL-EXTRCT-REC                                   03120023
031210           FROM VN104-CAPABILITY-EXTRACT-RECD.                    03121014
031300                                                                  03130011
031400     ADD 1 TO WS-VNDR-REC-WRITTEN.                                03140011
031500                                                                  03150011
031510*                                                                 03151020
031520***************************************************************** 03152020
031530* WRITE RETRIEVED INFORMATION TO THE VENDOR CAPABILITIES CODE   * 03153020
031540* EXTRACT RECORD                                                * 03154020
031550***************************************************************** 03155020
031560*                                                                 03156020
031570 W200-WRITE-VNDR-CD-EXTRCT-REC.                                   03157022
031580                                                                  03158020
031590     WRITE VNDR-CPBL-CD-EXTRCT-REC                                03159023
031591           FROM VN105-CAPABILITY-CD-EXTRCT-REC.                   03159122
031592                                                                  03159220
031593     ADD 1 TO WS-VNDR-CD-REC-WRITTEN.                             03159322
031594                                                                  03159420
031600*                                                                 03160011
031700***************************************************************** 03170011
031800*  OPEN VENDOR CAPABILITIES CURSOR                              * 03180014
031900***************************************************************** 03190011
032000*                                                                 03200011
032100 Y100-OPEN-VNDR-CPBL-CSR.                                         03210020
032200                                                                  03220011
032300     PERFORM WITH TEST AFTER                                      03230011
032400        VARYING WS-RETRY-COUNTER FROM 1 BY 1                      03240011
032500          UNTIL WS-RETRY-COUNTER > WS-RETRY-MAX                   03250011
032600             OR SQLCODE = ZERO                                    03260011
032700                                                                  03270011
032800         EXEC SQL                                                 03280011
032900            OPEN VNDR_CPBL_CSR                                    03290020
033000         END-EXEC                                                 03300011
033100                                                                  03310011
033200         EVALUATE TRUE                                            03320011
033300             WHEN SQLCODE = ZERO                                  03330011
033400                  CONTINUE                                        03340011
033500             WHEN SQLCODE = -904                                  03350011
033600             WHEN SQLCODE = -913                                  03360011
033700                  CONTINUE                                        03370011
033800             WHEN SQLWARN0 NOT = SPACES                           03380011
033900             WHEN SQLCODE  NOT = ZERO                             03390011
034000                  MOVE 'Y100-OPEN-VNDR-CPBL-CSR'                  03400020
034100                                           TO WS-ABEND-PARAGRAPH  03410011
034200                  MOVE 'UNSUCCESSFUL OPEN' TO WS-ABEND-OPERATION  03420011
034300                  MOVE 'VNT00001'        TO WS-ABEND-STRUCTURE-1  03430016
034400                  MOVE '       '         TO WS-ABEND-STRUCTURE-2  03440014
034500                  PERFORM Z999-SQL-ERROR                          03450011
034600         END-EVALUATE                                             03460011
034700     END-PERFORM.                                                 03470011
034800                                                                  03480011
034900     IF WS-RETRY-COUNTER > WS-RETRY-MAX                           03490011
035000        MOVE 'Y100-OPEN-VNDR-CPBL-CSR '                           03500020
035010              TO WS-ABEND-PARAGRAPH                               03501014
035100        MOVE 'MAX RETRIES EXCEEDED ON OPEN '                      03510020
035110              TO WS-ABEND-OPERATION                               03511014
035200        PERFORM Z999-SQL-ERROR                                    03520014
035300     END-IF.                                                      03530014
035310                                                                  03531014
035320*                                                                 03532020
035330***************************************************************** 03533020
035340*  OPEN VENDOR CAPABILITIES CODE CURSOR                         * 03534020
035350***************************************************************** 03535020
035360*                                                                 03536020
035370 Y200-OPEN-VNDR-CPBL-CD-CSR.                                      03537022
035380                                                                  03538020
035390     PERFORM WITH TEST AFTER                                      03539020
035391        VARYING WS-RETRY-COUNTER FROM 1 BY 1                      03539120
035392          UNTIL WS-RETRY-COUNTER > WS-RETRY-MAX                   03539220
035393             OR SQLCODE = ZERO                                    03539320
035394                                                                  03539420
035395         EXEC SQL                                                 03539520
035396            OPEN VNDR_CPBL_CDE_CSR                                03539620
035397         END-EXEC                                                 03539720
035398                                                                  03539820
035399         EVALUATE TRUE                                            03539920
035400             WHEN SQLCODE = ZERO                                  03540020
035401                  CONTINUE                                        03540120
035402             WHEN SQLCODE = -904                                  03540220
035403             WHEN SQLCODE = -913                                  03540320
035404                  CONTINUE                                        03540420
035405             WHEN SQLWARN0 NOT = SPACES                           03540520
035406             WHEN SQLCODE  NOT = ZERO                             03540620
035407                  MOVE 'Y200-OPEN-VNDR-CPBL-CD-CSR'               03540722
035408                                           TO WS-ABEND-PARAGRAPH  03540820
035409                  MOVE 'UNSUCCESSFUL OPEN' TO WS-ABEND-OPERATION  03540920
035410                  MOVE 'VNT00003'        TO WS-ABEND-STRUCTURE-1  03541020
035411                  MOVE '       '         TO WS-ABEND-STRUCTURE-2  03541120
035412                  PERFORM Z999-SQL-ERROR                          03541220
035413         END-EVALUATE                                             03541320
035414     END-PERFORM.                                                 03541420
035415                                                                  03541520
035416     IF WS-RETRY-COUNTER > WS-RETRY-MAX                           03541620
035417        MOVE 'Y200-OPEN-VNDR-CPBL-CD-CSR'                         03541722
035418              TO WS-ABEND-PARAGRAPH                               03541820
035419        MOVE 'MAX RETRIES EXCEEDED ON OPEN'                       03541920
035420              TO WS-ABEND-OPERATION                               03542020
035421        PERFORM Z999-SQL-ERROR                                    03542120
035422     END-IF.                                                      03542220
035423                                                                  03542320
035430*                                                                 03543011
035500****************************************************************  03550014
035600*  CLOSE VENDOR CAPABILITIES CURSOR                            *  03560014
035700****************************************************************  03570014
035800*                                                                 03580011
035900 Y300-CLOSE-VNDR-CPBL-CSR.                                        03590023
036000                                                                  03600011
036100     EXEC SQL                                                     03610020
036200        CLOSE VNDR_CPBL_CSR                                       03620020
036300     END-EXEC.                                                    03630020
036400                                                                  03640011
036500     EVALUATE TRUE                                                03650020
036600         WHEN SQLCODE = ZERO                                      03660020
036700              CONTINUE                                            03670020
036800         WHEN SQLWARN0 NOT = SPACES                               03680020
036900         WHEN SQLCODE  NOT = ZERO                                 03690020
037000              MOVE 'Y300-CLOSE-VNDR-CBPL-CSR'                     03700023
037100                                         TO WS-ABEND-PARAGRAPH    03710020
037200              MOVE 'UNSUCCESSFUL CLOSE'  TO WS-ABEND-OPERATION    03720020
037300              MOVE 'VNT00001'            TO WS-ABEND-STRUCTURE-1  03730020
037400              MOVE '       '             TO WS-ABEND-STRUCTURE-2  03740020
037500              PERFORM Z999-SQL-ERROR                              03750020
037600     END-EVALUATE.                                                03760020
037700                                                                  03770011
037710*                                                                 03771020
037720****************************************************************  03772020
037730*  CLOSE VENDOR CAPABILITIES CODE CURSOR                       *  03773020
037740****************************************************************  03774020
037750*                                                                 03775020
037760 Y400-CLOSE-VNDR-CPBL-CD-CSR.                                     03776023
037770                                                                  03777020
037780     EXEC SQL                                                     03778020
037790        CLOSE VNDR_CPBL_CDE_CSR                                   03779020
037791     END-EXEC.                                                    03779120
037792                                                                  03779220
037793     EVALUATE TRUE                                                03779320
037794         WHEN SQLCODE = ZERO                                      03779420
037795              CONTINUE                                            03779520
037796         WHEN SQLWARN0 NOT = SPACES                               03779620
037797         WHEN SQLCODE  NOT = ZERO                                 03779720
037798              MOVE 'Y400-CLOSE-VNDR-CBPL-CD-CSR'                  03779823
037799                                         TO WS-ABEND-PARAGRAPH    03779920
037800              MOVE 'UNSUCCESSFUL CLOSE'  TO WS-ABEND-OPERATION    03780020
037801              MOVE 'VNT00003'            TO WS-ABEND-STRUCTURE-1  03780120
037802              MOVE '       '             TO WS-ABEND-STRUCTURE-2  03780220
037803              PERFORM Z999-SQL-ERROR                              03780320
037804     END-EVALUATE.                                                03780420
037805                                                                  03780520
037810*                                                                 03781011
037900***************************************************************** 03790011
038000*  PROCESS DB2 ABENDS.                                          * 03800014
038100***************************************************************** 03810011
038200*                                                                 03820011
038300 Z999-SQL-ERROR.                                                  03830011
038400                                                                  03840011
038500     DISPLAY '*** DB2 ERROR '.                                    03850011
038600     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 03860011
038700     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               03870011
038800     DISPLAY '*** OPERATION = ' WS-ABEND-OPERATION.               03880011
038900     DISPLAY '*** TABLE 1   = ' WS-ABEND-STRUCTURE-1.             03890011
039000     IF WS-ABEND-STRUCTURE-2 > SPACES                             03900011
039100         DISPLAY '*** TABLE 2   = ' WS-ABEND-STRUCTURE-2          03910014
039200     END-IF.                                                      03920014
039300     SET AP-DB2-ERROR              TO TRUE.                       03930011
039400                                                                  03940011
039500     COPY DPPD004.                                                03950011
039600     CALL 'ILBOABN0' USING ABEND-CODE.                            03960011
