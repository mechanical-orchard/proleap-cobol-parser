000100******************************************************************00010012
000200 IDENTIFICATION DIVISION.                                         00020012
000300******************************************************************00030012
000400                                                                  00040012
000500 PROGRAM-ID.                RCKCS285.                             00050012
000600 AUTHOR.                    MICHAEL WALTERS.                      00060012
000700 INSTALLATION.              KOHLS DEPARTMENT STORES.              00070012
000800 DATE-WRITTEN.              09-25-96.                             00080012
000900 DATE-COMPILED.                                                   00090012
001000                                                                  00100012
001100******************************************************************00110012
001200*  CICS PROGRAM - RCKCS285 - E285                                *00120012
001300*                                                                *00130012
001400*       RC-PRETICKET REQUEST PRINT QUEUE                          00140012
001500*                                                                *00150012
001600*  THIS SCREEN WILL CREATE THE ACTUAL PRINT QUEUE USED TO SELECT *00160012
001700*  AND PRINT REQUESTS.                                            00170012
001800******************************************************************00180012
001900*---------------------------------------------------------------* 00190012
002000* CHANGED 11/11/2021    BY JIM HUNTER      WR: CHG0263784         00200012
002100* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00210012
002200* MAKING THE CALL DYNAMIC VS STATIC.                              00220012
002300*---------------------------------------------------------------* 00230012
002400 ENVIRONMENT DIVISION.                                            00240012
002500                                                                  00250012
002600 DATA DIVISION.                                                   00260012
002700                                                                  00270012
002800 WORKING-STORAGE SECTION.                                         00280012
002900                                                                  00290012
003000 01  DK-DB2-KEYS.                                                 00300012
003100     15  DK-REQ-TYPE1                   PIC  X(01).               00310012
003200     15  DK-REQ-TYPE2                   PIC  X(01).               00320012
003300     15  DK-REQ-STAT1                   PIC  X(01).               00330012
003400     15  DK-REQ-STAT2                   PIC  X(01).               00340012
003500                                                                  00350012
003600 01  PS-PROGRAM-CONSTANTS.                                        00360012
003700     05  PC-PO-PRINT-TRANID             PIC  X(4)   VALUE 'V515'. 00370012
003800     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00380012
003900                                                    'RC285A  '.   00390012
004000     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00400012
004100                                                    'RCKM285 '.   00410012
004200     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00420012
004300                                                    'RCKCS285'.   00430012
004400     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00440012
004500     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00450012
004600     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +15     00460012
004700                                                    COMP SYNC.    00470012
004800     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00480012
004900                                                    COMP SYNC.    00490012
005000     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00500012
005100                                                    +1000000      00510012
005200                                                    COMP-3.       00520012
005300     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00530012
005400                                                    COMP SYNC.    00540012
005500     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00550012
005600                                                    COMP-3.       00560012
005700     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00570012
005800     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00580012
005900     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00590012
006000     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00600012
006100     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00610012
006200*                                                                 00620012
006300     05  PC-TSYMSG-NUMBERS.                                       00630012
006400         10  PC-TSYMSG-00004            PIC  9(05)  VALUE 00004.  00640012
006500         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00650012
006600         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00660012
006700         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00670012
006800         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  00680012
006900         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00690012
007000         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00700012
007100         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00710012
007200         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00720012
007300         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00730012
007400         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00740012
007500         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00750012
007600         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.  00760012
007700         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00770012
007800         10  PC-TSYMSG-00098            PIC  9(05)  VALUE 00098.  00780012
007900         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00790012
008000         10  PC-TSYMSG-00118            PIC  9(05)  VALUE 00118.  00800012
008100         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00810012
008200         10  PC-TSYMSG-01383            PIC  9(05)  VALUE 01383.  00820012
008300         10  PC-TSYMSG-01386            PIC  9(05)  VALUE 01386.  00830012
008400         10  PC-TSYMSG-01387            PIC  9(05)  VALUE 01387.  00840012
008500         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00850012
008600*                                                                 00860012
008700 01  PS-PROGRAM-SWITCHES.                                         00870012
008800     05  PS-SELECTED-RECORD-SW          PIC  X(01)  VALUE 'Y'.    00880012
008900         88  PS-SEL-RECORD-FOUND                    VALUE 'Y'.    00890012
009000         88  PS-SEL-RECORD-NOT-FOUND                VALUE 'N'.    00900012
009100     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00910012
009200         88  PS-NO-ERROR                            VALUE 'Y'.    00920012
009300         88  PS-ERROR                               VALUE 'N'.    00930012
009400     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00940012
009500         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00950012
009600         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00960012
009700*                                                                 00970012
009800 01  PV-PROGRAM-VARIABLES.                                        00980012
009900     05  PV-COMMAREA-LENGTH             PIC S9(04) COMP           00990012
010000                                                   VALUE ZERO.    01000012
010100     05  PV-DISPLAY-ABEND-MESSAGE       PIC  X(79) VALUE SPACES.  01010012
010200     05  PV-DISPLAY-COMP1               PIC  9(09) VALUE ZERO.    01020012
010300     05  PV-DISPLAY-COMP2               PIC  9(09) VALUE ZERO.    01030012
010400     05  PV-DISPLAY-COMP3               PIC  9(09) VALUE ZERO.    01040012
010500     05  PV-WORK-DATE.                                            01050012
010600         10  PV-WORK-CC                 PIC XX.                   01060012
010700         10  PV-WORK-YY                 PIC XX.                   01070012
010800         10  FILLER                     PIC X.                    01080012
010900         10  PV-DISPLAY-DATE.                                     01090012
011000             15 PV-WORK-MM              PIC XX.                   01100012
011100             15 FILLER                  PIC X.                    01110012
011200             15 PV-WORK-DD              PIC XX.                   01120012
011300     05  PV-SEL-PO-REQ-NBR              PIC S9(09)  VALUE +0      01130012
011400                                                    COMP SYNC.    01140012
011500     05  PV-SEL-PO-NBR                  PIC S9(09)  VALUE +0      01150012
011600                                                    COMP SYNC.    01160012
011700     05  PV-SEL-RQST-STAT               PIC  X(01)  VALUE SPACE.  01170012
011800     05  PV-SEL-VENDOR-NAME             PIC  X(30)  VALUE SPACE.  01180012
011900     05  PV-REQUEST-TICKET-TOTAL        PIC S9(09)  VALUE +0      01190012
012000                                                    COMP SYNC.    01200012
012100     05  PV-REQUEST-LINE-COUNT          PIC S9(04)  VALUE +0      01210012
012200                                                    COMP SYNC.    01220012
012300     05  PV-SUB                         PIC S9(04)  VALUE +0      01230012
012400                                                    COMP SYNC.    01240012
012500     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01250012
012600                                                    COMP SYNC.    01260012
012700     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01270012
012800                                                    COMP-3.       01280012
012900     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01290012
013000                                                    COMP-3.       01300012
013100     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01310012
013200                                                    COMP-3.       01320012
013300     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01330012
013400                                                    COMP-3.       01340012
013500     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01350012
013600                                                    COMP-3.       01360012
013700     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01370012
013800                                                    COMP-3.       01380012
013900     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01390012
014000                                                    COMP-3.       01400012
014100     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01410012
014200                                                    COMP SYNC.    01420012
014300     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01430012
014400                                                    COMP SYNC.    01440012
014500     05  PV-ITEM                        PIC S9(04)  VALUE +0      01450012
014600                                                    COMP SYNC.    01460012
014700     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01470012
014800                                                    COMP SYNC.    01480012
014900     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01490012
015000                                                    COMP SYNC.    01500012
015100     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01510012
015200                                                    COMP SYNC.    01520012
015300     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01530012
015400                                                    COMP SYNC.    01540012
015500     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01550012
015600                                                    COMP SYNC.    01560012
015700     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01570012
015800                                                    COMP SYNC.    01580012
015900     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01590012
016000                                                    COMP SYNC.    01600012
016100     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01610012
016200                                                    COMP SYNC.    01620012
016300     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01630012
016400                                                    COMP SYNC.    01640012
016500     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01650012
016600                                                    COMP SYNC.    01660012
016700     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01670012
016800                                                    COMP SYNC.    01680012
016900     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01690012
017000                                                    COMP SYNC.    01700012
017100     05  PV-DATE-ISO.                                             01710012
017200         10 PV-DATE-CC                  PIC  X(02).               01720012
017300         10 PV-DATE-YY                  PIC  X(02).               01730012
017400         10 FILLER                      PIC  X(01) VALUE '-'.     01740012
017500         10 PV-DATE-MM                  PIC  X(02).               01750012
017600         10 FILLER                      PIC  X(01) VALUE '-'.     01760012
017700         10 PV-DATE-DD                  PIC  X(02).               01770012
017800     05  PV-DATE-USA.                                             01780012
017900         10 PV-DATE-MM                  PIC  X(02).               01790012
018000         10 FILLER                      PIC  X(01) VALUE '/'.     01800012
018100         10 PV-DATE-DD                  PIC  X(02).               01810012
018200         10 FILLER                      PIC  X(01) VALUE '/'.     01820012
018300         10 PV-DATE-CC                  PIC  X(02).               01830012
018400         10 PV-DATE-YY                  PIC  X(02).               01840012
018500     05  PV-DATE-DISPLAY.                                         01850012
018600         10 PV-DATE-MM                  PIC  X(02).               01860012
018700         10 FILLER                      PIC  X(01) VALUE '/'.     01870012
018800         10 PV-DATE-DD                  PIC  X(02).               01880012
018900         10 FILLER                      PIC  X(01) VALUE '/'.     01890012
019000         10 PV-DATE-YY                  PIC  X(02).               01900012
019100******************************************************************01910012
019200**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01920012
019300**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01930012
019400**  APPLICATION-SPECIFIC COMMAREA.                              **01940012
019500******************************************************************01950012
019600 01  LQW-LIST-QUEUE-WORK-AREA.                                    01960012
019700     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01970012
019800     05  LQW-ITEM-ENTRIES               OCCURS 15 TIMES           01980012
019900                                        INDEXED BY LQW-IDX.       01990012
020000         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02000012
020100         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02010012
020200         10  LQW-SELECTED-SW            PIC  X(01).               02020012
020300             88  LQW-SELECT                         VALUE 'S'.    02030012
020400             88  LQW-DESELECT                       VALUE ' '.    02040012
020500         10  LQW-ACTION                 PIC  X(03).               02050012
020600             88  LQW-INPROCESS           VALUE 'IP '.             02060012
020700             88  LQW-PRINTED             VALUE 'CM '.             02070012
020800         10  LQW-PO-NUMBER              PIC 9(09).                02080012
020900         10  LQW-REQUEST-INFO.                                    02090012
021000             11 LQW-RQST-NBR            PIC S9(09)                02100012
021100                                         COMP.                    02110012
021200             11 LQW-ENT-ID              PIC S9(09)                02120012
021300                                         COMP.                    02130012
021400             11 LQW-DEPT-NBR            PIC X(03).                02140012
021500             11 LQW-RQST-TYPE           PIC X(01).                02150012
021600             11 LQW-RQST-STAT           PIC X(01).                02160012
021700         10  LQW-PRINT-DUE-DATE         PIC X(08).                02170012
021800         10  LQW-VENDOR-NAME            PIC X(30).                02180012
021900         10  LQW-RQSTD-TICKETS          PIC S9(07)                02190012
022000                                         COMP.                    02200012
022100         10  LQW-LINE-COUNT             PIC S9(04)                02210012
022200                                         COMP.                    02220012
022300         10  LQW-TICKET-TYPE            PIC X(09).                02230012
022400         10  LQW-PRIORITY               PIC 9(02).                02240012
022500                                                                  02250012
022600     EJECT                                                        02260012
022700*---------------------------------------------------------------* 02270012
022800*    MAP LAYOUT                                                 * 02280012
022900*---------------------------------------------------------------* 02290012
023000                                                                  02300012
023100     COPY RCKM285.                                                02310012
023200*                                                                 02320012
023300 01  MR-OCCURS-LAYOUT                   REDEFINES  RC285AO.       02330012
023400     05  FILLER                         PIC X(57).                02340012
023500     05  MR-SCROLL-AREA                 OCCURS 15 TIMES.          02350012
023600         10  MR-SELECTL                 PIC S9(04) COMP.          02360012
023700         10  MR-SELECTA                 PIC  X(01).               02370012
023800         10  MR-SELECTC                 PIC  X(01).               02380012
023900         10  MR-SELECTH                 PIC  X(01).               02390012
024000         10  MR-SELECTI                 PIC  X(01).               02400012
024100                                                                  02410012
024200         10  MR-ACTIONL                 PIC S9(04) COMP.          02420012
024300         10  MR-ACTIONA                 PIC  X(01).               02430012
024400         10  MR-ACTIONC                 PIC  X(01).               02440012
024500         10  MR-ACTIONH                 PIC  X(01).               02450012
024600         10  MR-ACTION                  PIC  X(03).               02460012
024700                                                                  02470012
024800         10  FILLER                     PIC  X(03).               02480012
024900         10  MR-PO-NUMBERC              PIC  X(01).               02490012
025000         10  MR-PO-NUMBERH              PIC  X(01).               02500012
025100         10  MR-PO-NUMBER.                                        02510012
025200             15  MR-PO-NUMBER-N         PIC  9(08).               02520012
025300                                                                  02530012
025400         10  FILLER                     PIC  X(03).               02540012
025500         10  MR-PRINT-DUE-DATEC         PIC  X(01).               02550012
025600         10  MR-PRINT-DUE-DATEH         PIC  X(01).               02560012
025700         10  MR-PRINT-DUE-DATE          PIC  X(08).               02570012
025800                                                                  02580012
025900         10  FILLER                     PIC  X(03).               02590012
026000         10  MR-VENDOR-NAMEC            PIC  X(01).               02600012
026100         10  MR-VENDOR-NAMEH            PIC  X(01).               02610012
026200         10  MR-VENDOR-NAME             PIC  X(20).               02620012
026300                                                                  02630012
026400         10  FILLER                     PIC  X(03).               02640012
026500         10  MR-RQSTD-TICKETSC          PIC  X(01).               02650012
026600         10  MR-RQSTD-TICKETSH          PIC  X(01).               02660012
026700         10  MR-RQSTD-TICKETS-X.                                  02670012
026800             15  MR-RQSTD-TICKETS       PIC  ZZZZ,ZZ9.            02680012
026900                                                                  02690012
027000         10  FILLER                     PIC  X(03).               02700012
027100         10  MR-LINE-COUNTC             PIC  X(01).               02710012
027200         10  MR-LINE-COUNTH             PIC  X(01).               02720012
027300         10  MR-LINE-COUNT-X.                                     02730012
027400             15  MR-LINE-COUNT          PIC  Z,ZZ9.               02740012
027500                                                                  02750012
027600         10  FILLER                     PIC  X(03).               02760012
027700         10  MR-TICKET-TYPEC            PIC  X(01).               02770012
027800         10  MR-TICKET-TYPEH            PIC  X(01).               02780012
027900         10  MR-TICKET-TYPE             PIC  X(09).               02790012
028000                                                                  02800012
028100         10  FILLER                     PIC  X(03).               02810012
028200         10  MR-PRIORITYC               PIC  X(01).               02820012
028300         10  MR-PRIORITYH               PIC  X(01).               02830012
028400         10  MR-PRIORITY                PIC  X(02).               02840012
028500                                                                  02850012
028600     EJECT                                                        02860012
028700*---------------------------------------------------------------* 02870012
028800*    COMMAREA FOR PRINTING THE PO.                              * 02880012
028900*---------------------------------------------------------------* 02890012
029000                                                                  02900012
029100     COPY VLWS010.                                                02910012
029200                                                                  02920012
029300*---------------------------------------------------------------* 02930012
029400*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02940012
029500*---------------------------------------------------------------* 02950012
029600                                                                  02960012
029700     COPY DPWS015.                                                02970012
029800                                                                  02980012
029900*---------------------------------------------------------------* 02990012
030000*    FUNCTION KEYS COPYBOOK.                                    * 03000012
030100*---------------------------------------------------------------* 03010012
030200                                                                  03020012
030300     COPY DPWS016.                                                03030012
030400                                                                  03040012
030500*---------------------------------------------------------------* 03050012
030600*    NUMERIC EDIT LAYOUT.                                       * 03060012
030700*---------------------------------------------------------------* 03070012
030800                                                                  03080012
030900     COPY DPWS010I.                                               03090012
031000 EJECT                                                            03100012
031100******************************************************************03110013
031200** THE CALLING PARAMETER LIST (DPWS030/DPWS930) FOR THE CICS    **03120013
031210** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **03121013
031300******************************************************************03130013
031400                                                                  03140012
031500     COPY DPWS030.                                                03150012
031510     COPY DPWS930.                                                03151013
031600 EJECT                                                            03160012
031700*---------------------------------------------------------------* 03170012
031800*    STANDARD COMMAREA.                                         * 03180012
031900*---------------------------------------------------------------* 03190012
032000                                                                  03200012
032100     COPY DPWS020.                                                03210012
032200     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03220012
032300                                                                  03230012
032400*---------------------------------------------------------------* 03240012
032500* INTER-APPLICATION COMMAREA.                                   * 03250012
032600*   RCWS030 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 03260012
032700*             SPEC SCREEN.                                      * 03270012
032800*   PCWS030 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03280012
032900*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 03290012
033000*---------------------------------------------------------------* 03300012
033100                                                                  03310012
033200         10  INTER-APPL-COMM-AREA       PIC X(200).               03320012
033300     COPY RCWS030.                                                03330012
033400*---------------------------------------------------------------* 03340012
033500*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03350012
033600*---------------------------------------------------------------* 03360012
033700         10  ASC-SPECIFIC-COMMAREA.                               03370012
033800             15  ASC-LIST-KEYS.                                   03380012
033900                 20  ASC-KEY-DATE-LIMIT              PIC  X(10).  03390012
034000                 20  ASC-KEY-REQ-STAT                PIC  X(01).  03400012
034100                     88 ASC-ACT-REQ-STAT             VALUE 'A'.   03410012
034200                 20  ASC-KEY-REQ-TYPE                PIC  X(01).  03420012
034300                     88 ASC-BOTH-REQ-TYPE            VALUE 'B'.   03430012
034400             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03440012
034500                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03450012
034600                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03460012
034700                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03470012
034800                                                                  03480012
034900                 20  ASC-ITEM-ARRAY.                              03490012
035000                     25  ASC-ITEM-ENTRIES OCCURS 15 TIMES.        03500012
035100                         30  ASC-LIST-ITEM-NUMBER                 03510012
035200                                                     PIC S9(09)   03520012
035300                                                     COMP-3.      03530012
035400                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03540012
035500                             88  ASC-VALID-SELECT    VALUE ' '    03550012
035600                                                           'S'    03560012
035700                                                           'B'    03570012
035800                                                           'E'.   03580012
035900                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03590012
036000                             88  ASC-TEMP-SELECT     VALUE 'S'.   03600012
036100                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03610012
036200                             88  ASC-TEMP-END        VALUE 'E'.   03620012
036300                         30  ASC-SELECTED-SW         PIC  X(01).  03630012
036400                             88  ASC-NO-SELECT       VALUE ' '.   03640012
036500                             88  ASC-SELECT          VALUE 'S'.   03650012
036600                             88  ASC-BEGIN           VALUE 'B'.   03660012
036700                             88  ASC-END             VALUE 'E'.   03670012
036800                         30  ASC-ACTION              PIC  X(03).  03680012
036900                             88  ASC-INPROCESS       VALUE 'IP '. 03690012
037000                             88  ASC-PRINTED         VALUE 'CM '. 03700012
037100                         30  ASC-PO-NUMBER           PIC  9(09).  03710012
037200                         30  ASC-REQUEST-INFO.                    03720012
037300                             31 ASC-RQST-NBR         PIC S9(09)   03730012
037400                                                         COMP.    03740012
037500                             31 ASC-ENT-ID           PIC S9(09)   03750012
037600                                                         COMP.    03760012
037700                             31 ASC-DEPT-NBR         PIC X(03).   03770012
037800                             31 ASC-RQST-TYPE        PIC X(01).   03780012
037900                             31 ASC-RQST-STAT        PIC X(01).   03790012
038000                         30  ASC-PRINT-DUE-DATE      PIC X(08).   03800012
038100                         30  ASC-VENDOR-NAME         PIC X(30).   03810012
038200                         30  ASC-RQSTD-TICKETS       PIC S9(07)   03820012
038300                                                         COMP.    03830012
038400                         30  ASC-LINE-COUNT          PIC S9(04)   03840012
038500                                                         COMP.    03850012
038600                         30  ASC-TICKET-TYPE         PIC X(09).   03860012
038700                         30  ASC-PRIORITY            PIC 9(02).   03870012
038800                                                                  03880012
038900             15  ASC-BLK-SUB                         PIC S9(04)   03890012
039000                                                          COMP    03900012
039100                                                          SYNC.   03910012
039200             15  ASC-ITEM-SUB                        PIC S9(04)   03920012
039300                                                          COMP    03930012
039400                                                          SYNC.   03940012
039500             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03950012
039600                                                          COMP-3. 03960012
039700             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03970012
039800                                                          COMP-3. 03980012
039900             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03990012
040000                                                          COMP-3. 04000012
040100             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   04010012
040200                                                          COMP-3. 04020012
040300             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   04030012
040400                                                          COMP-3. 04040012
040500             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   04050012
040600                                                          COMP    04060012
040700                                                          SYNC.   04070012
040800             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   04080012
040900                                                          COMP-3. 04090012
041000             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   04100012
041100                                                          COMP-3. 04110012
041200             15  ASC-DELETE-INDICATOR                PIC  X(01).  04120012
041300                 88  ASC-NO-DELETE                   VALUE ' '.   04130012
041400                 88  ASC-DELETE-PENDING              VALUE 'P'.   04140012
041500             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  04150012
041600                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   04160012
041700                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   04170012
041800             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  04180012
041900                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   04190012
042000                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   04200012
042100             15  ASC-LIST-QUEUE-NAME.                             04210012
042200                 20  ASC-LIST-TERM-ID                PIC  X(04).  04220012
042300                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   04230012
042400                                                          COMP-3. 04240012
042500                 20  ASC-LIST-SEQ                    PIC  9(01).  04250012
042600                                                                  04260012
042700             15  ASC-START-ITEM-REQUEST.                          04270012
042800                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04280012
042900     EJECT                                                        04290012
043000*---------------------------------------------------------------* 04300012
043100*    ABEND PROCESSING COPYBOOK.                                 * 04310012
043200*---------------------------------------------------------------* 04320012
043300                                                                  04330012
043400     COPY DPWS013.                                                04340012
043500                                                                  04350012
043600 EJECT                                                            04360012
043700*---------------------------------------------------------------* 04370012
043800*    DB2 AREA FOR TMESSAGE                                      * 04380012
043900*---------------------------------------------------------------* 04390012
044000     EXEC SQL                                                     04400012
044100          INCLUDE TSYMSG                                          04410012
044200     END-EXEC.                                                    04420012
044300*---------------------------------------------------------------* 04430012
044400*    DB2 AREA FOR COMMUNICATIONS                                * 04440012
044500*---------------------------------------------------------------* 04450012
044600     EXEC SQL                                                     04460012
044700          INCLUDE SQLCA                                           04470012
044800     END-EXEC.                                                    04480012
044900                                                                  04490012
045000*---------------------------------------------------------------* 04500012
045100*    DB2 AREA THE PRETICKET REQUEST TABLE                       * 04510012
045200*---------------------------------------------------------------* 04520012
045300     EXEC SQL                                                     04530012
045400          INCLUDE TPTKREQ                                         04540012
045500     END-EXEC.                                                    04550012
045600                                                                  04560012
045700*---------------------------------------------------------------* 04570012
045800*    DB2 AREA THE PRETICKET REQEUST LINE TABLE                  * 04580012
045900*---------------------------------------------------------------* 04590012
046000     EXEC SQL                                                     04600012
046100          INCLUDE TPTKLNE                                         04610012
046200     END-EXEC.                                                    04620012
046300                                                                  04630012
046400*---------------------------------------------------------------* 04640012
046500*    DB2 AREA THE PRETICKET COMMENT TABLE                       * 04650012
046600*---------------------------------------------------------------* 04660012
046700     EXEC SQL                                                     04670012
046800          INCLUDE TPTKCMT                                         04680012
046900     END-EXEC.                                                    04690012
047000                                                                  04700012
047100*---------------------------------------------------------------* 04710012
047200*    DB2 AREA THE PRETICKET REASON CODE ASSOCIATION TABLE       * 04720012
047300*---------------------------------------------------------------* 04730012
047400     EXEC SQL                                                     04740012
047500          INCLUDE TPTKRSN                                         04750012
047600     END-EXEC.                                                    04760012
047700                                                                  04770012
047800*---------------------------------------------------------------* 04780012
047900*    DB2 AREA THE ENTERPRISE NAME TABLE                         * 04790012
048000*---------------------------------------------------------------* 04800012
048100     EXEC SQL                                                     04810012
048200          INCLUDE TENTNME                                         04820012
048300     END-EXEC.                                                    04830012
048400                                                                  04840012
048500*---------------------------------------------------------------* 04850012
048600*    THE PRINT-QUEUE-CURSOR                                     * 04860012
048700*---------------------------------------------------------------* 04870012
048800                                                                  04880012
048900     EXEC SQL                                                     04890012
049000          DECLARE PRINT_QUEUE_CURSOR CURSOR                       04900012
049100          FOR SELECT                                              04910012
049200                A.PO_REQ_NBR                                      04920012
049300              , A.PO_NBR                                          04930012
049400              , A.PRT_BY_DTE                                      04940012
049500              , D.ENT_NAME_DESC                                   04950012
049600              , SUM(B.TKT_QTY)                                    04960012
049700              , COUNT(DISTINCT B.PO_LNE_NBR)                      04970012
049800              , A.PRTY_STAT_CDE                                   04980012
049900              , A.REQ_STAT_CDE                                    04990012
050000          FROM                                                    05000012
050100                TPTKREQ A                                         05010012
050200              , TPTKLNE B                                         05020012
050300              , TENTNME D                                         05030012
050400          WHERE                                                   05040012
050500                A.REQ_STAT_CDE IN (:DK-REQ-STAT1, :DK-REQ-STAT2)  05050012
050600            AND A.PRT_BY_DTE  <= :ASC-KEY-DATE-LIMIT              05060012
050700            AND A.REQ_TYP_CDE IN (:DK-REQ-TYPE1, :DK-REQ-TYPE2)   05070012
050800            AND A.PO_REQ_NBR   = B.PO_REQ_NBR                     05080012
050900            AND A.ENT_ID       = D.ENT_ID                         05090012
051000            AND D.TYPE_CDE     = '01'                             05100012
051100          GROUP BY                                                05110012
051200                A.PO_REQ_NBR                                      05120012
051300              , A.PO_NBR                                          05130012
051400              , A.PRT_BY_DTE                                      05140012
051500              , D.ENT_NAME_DESC                                   05150012
051600              , A.PRTY_STAT_CDE                                   05160012
051700              , A.REQ_STAT_CDE                                    05170012
051800          ORDER BY                                                05180012
051900                A.PRT_BY_DTE, A.PRTY_STAT_CDE, A.PO_NBR           05190012
052000     END-EXEC.                                                    05200012
052100                                                                  05210012
052200                                                                  05220012
052300 EJECT                                                            05230012
052400 LINKAGE SECTION.                                                 05240012
052500                                                                  05250012
052600 01  DFHCOMMAREA.                                                 05260012
052700     05  FILLER                         OCCURS  1 TO 4072 TIMES   05270012
052800                                        DEPENDING ON EIBCALEN.    05280012
052900         10  FILLER                     PIC X.                    05290012
053000                                                                  05300012
053100 EJECT                                                            05310012
053200 PROCEDURE DIVISION.                                              05320012
053300******************************************************************05330012
053400**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **05340012
053500**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **05350012
053600**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **05360012
053700******************************************************************05370012
053800 0000-MAIN-MODULE.                                                05380012
053900     INITIALIZE DP030-CICS-API-FIELDS.                            05390012
054000     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05400012
054100     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05410012
054200     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05420012
054300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05430012
054400     MOVE LENGTH OF RC285AI        TO DP030-MAP-LENGTH (1).       05440012
054500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05450012
054600     PERFORM 0001-CALL-CICS-ARCH-API.                             05460012
054700*                                                                 05470012
054800     PERFORM 1000-CONTROL-PROCESSING                              05480012
054900*                                                                 05490012
055000     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05500012
055100     PERFORM 0001-CALL-CICS-ARCH-API.                             05510012
055200                                                                  05520012
055300******************************************************************05530012
055400**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **05540012
055500**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **05550012
055600******************************************************************05560012
055700 0001-CALL-CICS-ARCH-API.                                         05570012
055810     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05581013
055900                                    DFHCOMMAREA                   05590013
056000                                    DP030-CICS-API-FIELDS         05600013
056100                                    DP020-STANDARD-COMMAREA       05610013
056200                                    RC285AI.                      05620013
056300*                                                                 05630012
056400     IF  DP030-RC-CALL-SUCCESSFUL                                 05640012
056500         CONTINUE                                                 05650012
056600     ELSE                                                         05660012
056700         SET DP013-NO-ROLLBACK                                    05670012
056800             DP013-XCTL-DISPLAY-RESTART                           05680012
056900             DP013-CICS-ABEND      TO TRUE                        05690012
057000         MOVE '0001-CALL-CICS-ARCH-API'                           05700012
057100                                   TO DP013-PARAGRAPH             05710012
057120         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN CODE O05712013
057130-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05713013
057400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05740012
057500         PERFORM DP013-0000-PROCESS-ABEND                         05750012
057600     END-IF.                                                      05760012
057700*----------------------------------------------------------------*05770012
057800* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05780012
057900* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05790012
058000*                                                                *05800012
058100* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05810012
058200*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05820012
058300*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05830012
058400*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05840012
058500*----------------------------------------------------------------*05850012
058600                                                                  05860012
058700 1000-CONTROL-PROCESSING.                                         05870012
058800                                                                  05880012
058900     EVALUATE TRUE                                                05890012
059000         WHEN DP020-NEXT-ACT-INITIAL                              05900012
059100             INITIALIZE ASC-SPECIFIC-COMMAREA                     05910012
059200             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05920012
059300             MOVE DP020-SRC-TASK-NUMBER                           05930012
059400                                   TO ASC-LIST-TASK-NUMBER        05940012
059500             MOVE PC-LIST-QUEUE-SEQ                               05950012
059600                                   TO ASC-LIST-SEQ                05960012
059700             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05970012
059800***-----$TEMPLATE NOTE$-------------------------------------------05980012
059900*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,05990012
060000*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  06000012
060100*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.06010012
060200***---------------------------------------------------------------06020012
060300             IF  PS-COMMAREA-NOT-VALID                            06030012
060400***              MOVE PC-TSYMSG-99901                             06040012
060500***                                TO DP020-MSG-NUMBER            06050012
060600***              SET DP020-MSG-FATAL                              06060012
060700***                                TO TRUE                        06070012
060800                 SET DP020-NEXT-ACT-APPL-ERROR                    06080012
060900                                   TO TRUE                        06090012
061000             ELSE                                                 06100012
061100                 PERFORM 4000-BUILD-INITIAL-PANEL                 06110012
061200             END-IF                                               06120012
061300                                                                  06130012
061400         WHEN DP020-NEXT-ACT-READ-MAP                             06140012
061500             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06150012
061600                                   TO PV-TOP-ITEM                 06160012
061700             PERFORM 2000-PROCESS-PANEL                           06170012
061800                                                                  06180012
061900         WHEN DP020-NEXT-ACT-RETURN                               06190012
062000             PERFORM 2050-DELETE-LIST-QUEUE                       06200012
062100             PERFORM 4000-BUILD-INITIAL-PANEL                     06210012
062200                                                                  06220012
062300         WHEN OTHER                                               06230012
062400             SET DP013-LOGIC-ABEND TO TRUE                        06240012
062500             SET DP013-NO-ROLLBACK TO TRUE                        06250012
062600             MOVE '1000-CONTROL-PROCESSING'                       06260012
062700                                   TO DP013-PARAGRAPH             06270012
062800             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06280012
062900                                   TO DP013-MESSAGE-TEXT(1)       06290012
063000             PERFORM DP013-0000-PROCESS-ABEND                     06300012
063100     END-EVALUATE.                                                06310012
063200                                                                  06320012
063300 EJECT                                                            06330012
063400*----------------------------------------------------------------*06340012
063500* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06350012
063600* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06360012
063700*----------------------------------------------------------------*06370012
063800                                                                  06380012
063900 1100-PROCESS-INTER-APPL-COMM.                                    06390012
064000     SET PS-COMMAREA-VALID        TO TRUE.                        06400012
064100     MOVE RC030-DATE-LIMIT        TO ASC-KEY-DATE-LIMIT.          06410012
064200     MOVE RC030-PRETKT-REQ-STAT   TO ASC-KEY-REQ-STAT.            06420012
064300     MOVE RC030-PRETKT-REQ-TYPE   TO ASC-KEY-REQ-TYPE.            06430012
064400 EJECT                                                            06440012
064500*----------------------------------------------------------------*06450012
064600* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *06460012
064700* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06470012
064800* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06480012
064900* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06490012
065000* FUNCTION KEYS CAN GET THIS FAR.                                *06500012
065100*----------------------------------------------------------------*06510012
065200                                                                  06520012
065300 2000-PROCESS-PANEL.                                              06530012
065400     EVALUATE TRUE                                                06540012
065500         WHEN DP020-SRC-AID = DP016-CLEAR                         06550012
065600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06560012
065700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06570012
065800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06580012
065900                                                                  06590012
066000         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06600012
066100             PERFORM 2050-DELETE-LIST-QUEUE                       06610012
066200             PERFORM 4000-BUILD-INITIAL-PANEL                     06620012
066300                                                                  06630012
066400         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    06640012
066500             PERFORM 2140-DESELECT-ALL-ITEMS                      06650012
066600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06660012
066700                                                                  06670012
066800         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  06680012
066900             PERFORM 2150-SELECT-ALL-ITEMS                        06690012
067000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06700012
067100                                                                  06710012
067200         WHEN OTHER                                               06720012
067300             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06730012
067400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06740012
067500             IF  PS-NO-ERROR                                      06750012
067600                 SET DP030-CONTINUE-GO                            06760012
067700                                 TO TRUE                          06770012
067800                 PERFORM 2100-CHECK-FUNCTION-KEY                  06780012
067900             ELSE                                                 06790012
068000                 SET DP030-OVERRIDE-GO                            06800012
068100                                 TO TRUE                          06810012
068200             END-IF                                               06820012
068300     END-EVALUATE.                                                06830012
068400 EJECT                                                            06840012
068500*----------------------------------------------------------------*06850012
068600*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06860012
068700*----------------------------------------------------------------*06870012
068800 2050-DELETE-LIST-QUEUE.                                          06880012
068900                                                                  06890012
069000     EXEC CICS                                                    06900012
069100         DELETEQ TS                                               06910012
069200             QUEUE (ASC-LIST-QUEUE-NAME)                          06920012
069300             RESP  (PV-CICS-RESP)                                 06930012
069400     END-EXEC.                                                    06940012
069500                                                                  06950012
069600     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06960012
069700        (PV-CICS-RESP = DFHRESP(QIDERR))                          06970012
069800         CONTINUE                                                 06980012
069900     ELSE                                                         06990012
070000         SET DP013-CICS-ABEND      TO TRUE                        07000012
070100         SET DP013-NO-ROLLBACK     TO TRUE                        07010012
070200                                                                  07020012
070300         MOVE '2050-DELETE-LIST-QUEUE'                            07030012
070400                                   TO DP013-PARAGRAPH             07040012
070500         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    07050012
070600                                   TO DP013-MESSAGE-TEXT (1)      07060012
070700         PERFORM DP013-0000-PROCESS-ABEND                         07070012
070800     END-IF.                                                      07080012
070900                                                                  07090012
071000     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  07100012
071100 EJECT                                                            07110012
071200*----------------------------------------------------------------*07120012
071300* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*07130012
071400* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *07140012
071500* CICS ARCHITECTURE API.                                         *07150012
071600*----------------------------------------------------------------*07160012
071700 2100-CHECK-FUNCTION-KEY.                                         07170012
071800     EVALUATE TRUE                                                07180012
071900                                                                  07190012
072000* IF THE "COMPLETE" KEY WAS PRESSED                               07200012
072100         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              07210012
072200             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              07220012
072300                 PERFORM 5300-COMPLETE-SELECTED-ITEMS             07230012
072400             ELSE                                                 07240012
072500                 SET DP030-OVERRIDE-GO                            07250012
072600                     DP020-MSG-FATAL        TO TRUE               07260012
072700                 MOVE PC-TSYMSG-00057       TO DP020-MSG-NUMBER   07270012
072800             END-IF                                               07280012
072900             MOVE +0 TO PV-TOP-ITEM                               07290012
073000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07300012
073100                                                                  07310012
073200* IF THE "PRINT" KEY WAS PRESSED                                  07320012
073300         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              07330012
073400             EVALUATE TRUE                                        07340012
073500             WHEN ASC-NUMBER-OF-SELECTED-ITEMS = +0               07350012
073600                 SET DP030-OVERRIDE-GO    TO TRUE                 07360012
073700                 MOVE PC-TSYMSG-00057     TO DP020-MSG-NUMBER     07370012
073800                 SET DP020-MSG-WARNING    TO TRUE                 07380012
073900                                                                  07390012
074000             WHEN ASC-NUMBER-OF-SELECTED-ITEMS > +1               07400012
074100                 SET DP030-OVERRIDE-GO    TO TRUE                 07410012
074200                 MOVE PC-TSYMSG-00047     TO DP020-MSG-NUMBER     07420012
074300                 SET DP020-MSG-WARNING    TO TRUE                 07430012
074400                                                                  07440012
074500             WHEN OTHER                                           07450012
074600                 PERFORM 5000-FIND-SELECTED-ITEM                  07460012
074700*                THE ORDER CAN ONLY BE PRINTED IF IT IS IN ACTIVE 07470012
074800*                OR INPROCESS STATUS                              07480012
074900                 IF PV-SEL-RQST-STAT = 'I' OR 'A'                 07490012
075000                     INITIALIZE RC030-INTER-APPL-COMMAREA         07500012
075100                     MOVE PV-SEL-PO-REQ-NBR                       07510012
075200                                          TO RC030-SEL-PO-REQ-NBR 07520012
075300                     MOVE PV-SEL-PO-NBR   TO RC030-SEL-PO-NBR     07530012
075400                     MOVE PV-SEL-VENDOR-NAME                      07540012
075500                                          TO RC030-VENDOR-NAME    07550012
075600                 ELSE                                             07560012
075700                     EVALUATE PV-SEL-RQST-STAT                    07570012
075800                     WHEN 'H'                                     07580012
075900                         MOVE 'HOLD'      TO DP020-MSG-TEXT       07590012
076000                     WHEN 'R'                                     07600012
076100                         MOVE 'RUSH'      TO DP020-MSG-TEXT       07610012
076200                     WHEN 'P'                                     07620012
076300                         MOVE 'PRINTED'   TO DP020-MSG-TEXT       07630012
076400                     WHEN 'C'                                     07640012
076500                         MOVE 'CANCELED'  TO DP020-MSG-TEXT       07650012
076600                     END-EVALUATE                                 07660012
076700                     MOVE PC-TSYMSG-01386 TO DP020-MSG-NUMBER     07670012
076800                     SET DP020-MSG-FATAL                          07680012
076900                         DP030-OVERRIDE-GO                        07690012
077000                                          TO TRUE                 07700012
077100                 END-IF                                           07710012
077200             END-EVALUATE                                         07720012
077300                                                                  07730012
077400* IF THE "POPRINT" KEY WAS PRESSED                                07740012
077500         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              07750012
077600             EVALUATE TRUE                                        07760012
077700             WHEN ASC-NUMBER-OF-SELECTED-ITEMS = +0               07770012
077800                 SET DP030-OVERRIDE-GO    TO TRUE                 07780012
077900                 MOVE PC-TSYMSG-00057     TO DP020-MSG-NUMBER     07790012
078000                 SET DP020-MSG-WARNING    TO TRUE                 07800012
078100                                                                  07810012
078200             WHEN ASC-NUMBER-OF-SELECTED-ITEMS > +1               07820012
078300                 SET DP030-OVERRIDE-GO    TO TRUE                 07830012
078400                 MOVE PC-TSYMSG-00047     TO DP020-MSG-NUMBER     07840012
078500                 SET DP020-MSG-WARNING    TO TRUE                 07850012
078600                                                                  07860012
078700             WHEN OTHER                                           07870012
078800                 PERFORM 5000-FIND-SELECTED-ITEM                  07880012
078900                 IF PV-SEL-RQST-STAT = 'C'                        07890012
079000                         MOVE 'CANCELED'  TO DP020-MSG-TEXT       07900012
079100                         MOVE PC-TSYMSG-01386 TO DP020-MSG-NUMBER 07910012
079200                             SET DP020-MSG-FATAL                  07920012
079300                                 DP030-OVERRIDE-GO                07930012
079400                                          TO TRUE                 07940012
079500                                                                  07950012
079600                 ELSE                                             07960012
079700                     INITIALIZE VL010-PO-PRINT-COMMAREA           07970012
079800                     MOVE PV-SEL-PO-NBR  TO VL010-PO-NBR          07980012
079900                     MOVE PV-SEL-PO-REQ-NBR                       07990012
080000                                         TO VL010-PO-REQ-NBR      08000012
080100* AS OF 12/19/96, PRODUCTION PRINTER ID SHOULD BE U4042           08010012
080200                     MOVE 'U4042'        TO VL010-DEST            08020012
080300                     IF DP020-USERID = 'TKMA181'                  08030012
080400                         MOVE 'U4003'    TO VL010-DEST            08040012
080500                     END-IF                                       08050012
080600                                                                  08060012
080700                     MOVE DP020-SRC-TASK-NUMBER                   08070012
080800                                         TO VL010-TASK-ID         08080012
080900                     MOVE LENGTH OF VL010-PO-PRINT-COMMAREA       08090012
081000                                         TO PV-COMMAREA-LENGTH    08100012
081100                     EXEC CICS                                    08110012
081200                         START                                    08120012
081300                             TRANSID (PC-PO-PRINT-TRANID)         08130012
081400                             FROM    (VL010-PO-PRINT-COMMAREA)    08140012
081500                             LENGTH  (PV-COMMAREA-LENGTH)         08150012
081600                             RESP    (PV-CICS-RESP)               08160012
081700                     END-EXEC                                     08170012
081800                                                                  08180012
081900                     EVALUATE TRUE                                08190012
082000                         WHEN PV-CICS-RESP = DFHRESP (NORMAL)     08200012
082100                             MOVE PC-TSYMSG-00098                 08210012
082200                                             TO DP020-MSG-NUMBER  08220012
082300                             SET DP020-MSG-INFORMATIONAL          08230012
082400                                                TO TRUE           08240012
082500                         WHEN OTHER                               08250012
082600                             SET DP013-LOGIC-ABEND                08260012
082700                                 DP013-NO-ROLLBACK                08270012
082800                                         TO TRUE                  08280012
082900                             MOVE '8000-START-PO-PRINT-PGM'       08290012
083000                                         TO DP013-PARAGRAPH       08300012
083100                             MOVE 'START PO-PRINT PROGRAM '       08310012
083200                                         TO DP013-MESSAGE-TEXT(1) 08320012
083300                             PERFORM DP013-0000-PROCESS-ABEND     08330012
083400                     END-EVALUATE                                 08340012
083500                END-IF                                            08350012
083600             END-EVALUATE                                         08360012
083700                                                                  08370012
083800         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  08380012
083900             MOVE +1               TO PV-TOP-ITEM                 08390012
084000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08400012
084100                                                                  08410012
084200         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   08420012
084300             PERFORM 2110-BROWSE-BACKWARD                         08430012
084400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08440012
084500                                                                  08450012
084600         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   08460012
084700             PERFORM 2120-BROWSE-FORWARD                          08470012
084800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08480012
084900                                                                  08490012
085000         WHEN DP020-SRC-AID = DP016-ENTER                         08500012
085100             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   08510012
085200             IF  PS-ERROR                                         08520012
085300                 CONTINUE                                         08530012
085400             ELSE                                                 08540012
085500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08550012
085600             END-IF                                               08560012
085700                                                                  08570012
085800         WHEN OTHER                                               08580012
085900             SET DP013-NO-ROLLBACK                                08590012
086000                 DP013-XCTL-DISPLAY-RESTART                       08600012
086100                 DP013-CICS-ABEND  TO TRUE                        08610012
086200             MOVE '2100-CHECK-FUNCTION-KEY'                       08620012
086300                                   TO DP013-PARAGRAPH             08630012
086400             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08640012
086500                                   TO DP013-MESSAGE-TEXT (1)      08650012
086600             PERFORM DP013-0000-PROCESS-ABEND                     08660012
086700     END-EVALUATE.                                                08670012
086800*                                                                 08680012
086900*----------------------------------------------------------------*08690012
087000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *08700012
087100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *08710012
087200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *08720012
087300*    MESSAGE.                                                    *08730012
087400*----------------------------------------------------------------*08740012
087500                                                                  08750012
087600 2110-BROWSE-BACKWARD.                                            08760012
087700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    08770012
087800         GIVING PV-TOP-ITEM.                                      08780012
087900*                                                                 08790012
088000     IF  ((PV-TOP-ITEM < +1)                                      08800012
088100       OR (PV-TOP-ITEM = +1))                                     08810012
088200         MOVE +1                   TO PV-TOP-ITEM                 08820012
088300*        -- TOP OF LIST --                                        08830012
088400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            08840012
088500         SET DP020-MSG-INFORMATIONAL TO TRUE                      08850012
088600     END-IF.                                                      08860012
088700                                                                  08870012
088800 EJECT                                                            08880012
088900*----------------------------------------------------------------*08890012
089000*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *08900012
089100*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *08910012
089200*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *08920012
089300*----------------------------------------------------------------*08930012
089400                                                                  08940012
089500 2120-BROWSE-FORWARD.                                             08950012
089600                                                                  08960012
089700     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              08970012
089800         GIVING PV-TOP-ITEM.                                      08980012
089900     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   08990012
090000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09000012
090100                                   TO PV-TOP-ITEM                 09010012
090200*        -- BOTTOM OF LIST --                                     09020012
090300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            09030012
090400         SET DP020-MSG-INFORMATIONAL                              09040012
090500                                   TO TRUE                        09050012
090600     ELSE                                                         09060012
090700         COMPUTE PV-BOTTOM-ITEM =                                 09070012
090800             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 09080012
090900         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            09090012
091000*            -- BOTTOM OF LIST --                                 09100012
091100             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            09110012
091200             SET DP020-MSG-INFORMATIONAL                          09120012
091300                                   TO TRUE                        09130012
091400         END-IF                                                   09140012
091500     END-IF.                                                      09150012
091600 EJECT                                                            09160012
091700*----------------------------------------------------------------*09170012
091800*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *09180012
091900*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *09190012
092000*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *09200012
092100*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *09210012
092200*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *09220012
092300*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *09230012
092400*----------------------------------------------------------------*09240012
092500                                                                  09250012
092600 2130-CHECK-FOR-JUMP-BROWSE.                                      09260012
092700     SET PS-NO-ERROR               TO TRUE.                       09270012
092800     IF (ASC-START-ITEM-REQUEST = SPACE)                          09280012
092900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09290012
093000                                   TO PV-TOP-ITEM                 09300012
093100     ELSE                                                         09310012
093200         MOVE ASC-START-ITEM-REQUEST                              09320012
093300                                   TO DP010I-UNEDITED-FIELD       09330012
093400         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       09340012
093500         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     09350012
093600         SET DP010I-NEGATIVE-NOT-ALLOWED                          09360012
093700                                   TO TRUE                        09370012
093800         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09380012
093900              USING DP010I-NUMERIC-EDIT-AREA                      09390012
094000                                                                  09400012
094100         IF  NOT DP010I-ERROR-DETECTED                            09410012
094200             MOVE DP010I-NUMERIC-FIELD                            09420012
094300                                   TO  ASC-START-ITEM-REQUEST-N   09430012
094400             IF  ASC-START-ITEM-REQUEST-N > ZERO                  09440012
094500                 IF  ASC-START-ITEM-REQUEST-N >                   09450012
094600                                          ASC-NUMBER-OF-ITEMS-READ09460012
094700                     MOVE SPACE TO ASC-START-ITEM-REQUEST         09470012
094800                     COMPUTE PV-TOP-ITEM =                        09480012
094900                             ASC-NUMBER-OF-ITEMS-READ             09490012
095000                             - PC-ITEMS-PER-PANEL + 1             09500012
095100                     IF  PV-TOP-ITEM < +1                         09510012
095200                         MOVE +1   TO PV-TOP-ITEM                 09520012
095300                         MOVE PC-TSYMSG-00070                     09530012
095400                                   TO DP020-MSG-NUMBER            09540012
095500                         SET DP020-MSG-INFORMATIONAL              09550012
095600                                   TO TRUE                        09560012
095700                     END-IF                                       09570012
095800                 ELSE                                             09580012
095900                     MOVE ASC-START-ITEM-REQUEST-N                09590012
096000                                   TO PV-TOP-ITEM                 09600012
096100                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      09610012
096200                     COMPUTE PV-BOTTOM-ITEM =                     09620012
096300                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     09630012
096400                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ09640012
096500*                        -- BOTTOM OF LIST --                     09650012
096600                         MOVE PC-TSYMSG-00070                     09660012
096700                                   TO DP020-MSG-NUMBER            09670012
096800                         SET DP020-MSG-INFORMATIONAL              09680012
096900                                   TO TRUE                        09690012
097000                     END-IF                                       09700012
097100                 END-IF                                           09710012
097200             ELSE                                                 09720012
097300*                --- VALUE OUT OF RANGE ----                      09730012
097400                 MOVE PC-TSYMSG-00101                             09740012
097500                                   TO DP020-MSG-NUMBER            09750012
097600                 MOVE -1           TO ASTRTITL                    09760012
097700                 SET DP030-SET-CURSOR-APPL-1                      09770012
097800                                   TO TRUE                        09780012
097900                 MOVE DP015-REVERSE                               09790012
098000                                   TO ASTRTITH                    09800012
098100                 MOVE DP015-RED    TO ASTRTITC                    09810012
098200                 MOVE DP015-UNP-NUM-BRT-MDT                       09820012
098300                                   TO ASTRTITA                    09830012
098400                 SET DP020-MSG-FATAL                              09840012
098500                                   TO TRUE                        09850012
098600                 SET PS-ERROR      TO TRUE                        09860012
098700             END-IF                                               09870012
098800                                                                  09880012
098900         ELSE                                                     09890012
099000             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09900012
099100             MOVE -1               TO ASTRTITL                    09910012
099200             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09920012
099300             MOVE DP015-REVERSE    TO ASTRTITH                    09930012
099400             MOVE DP015-RED        TO ASTRTITC                    09940012
099500             MOVE DP015-UNP-NUM-BRT-MDT                           09950012
099600                                   TO ASTRTITA                    09960012
099700             SET DP020-MSG-FATAL   TO TRUE                        09970012
099800             SET PS-ERROR          TO TRUE                        09980012
099900         END-IF                                                   09990012
100000     END-IF.                                                      10000012
100100 EJECT                                                            10010012
100200*----------------------------------------------------------------*10020012
100300*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *10030012
100400*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *10040012
100500*----------------------------------------------------------------*10050012
100600 2140-DESELECT-ALL-ITEMS.                                         10060012
100700     MOVE +1                       TO ASC-BLK-SUB.                10070012
100800                                                                  10080012
100900     PERFORM 2141-CLEAR-SELECTED-INDS                             10090012
101000         VARYING ASC-ITEM-SUB                                     10100012
101100         FROM 1 BY 1                                              10110012
101200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10120012
101300                                                                  10130012
101400     ADD +1                        TO ASC-BLK-SUB.                10140012
101500                                                                  10150012
101600     PERFORM 2141-CLEAR-SELECTED-INDS                             10160012
101700         VARYING ASC-ITEM-SUB                                     10170012
101800         FROM 1 BY 1                                              10180012
101900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10190012
102000                                                                  10200012
102100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10210012
102200                                   TO PV-LIST-ITEM-NUMBER.        10220012
102300                                                                  10230012
102400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10240012
102500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10250012
102600                                                                  10260012
102700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10270012
102800        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      10280012
102900         MOVE +1                   TO ASC-BLK-SUB                 10290012
103000                                                                  10300012
103100         PERFORM 5100-WRITE-TEMP-STORAGE                          10310012
103200                                                                  10320012
103300         MOVE +1                   TO PV-BLOCK-NUMBER             10330012
103400                                                                  10340012
103500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10350012
103600             PV-FIRST-BLOCK-IN-ARRAY - 1                          10360012
103700                                                                  10370012
103800         PERFORM                                                  10380012
103900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10390012
104000                                                                  10400012
104100             PERFORM 4410-READ-TEMP-STORAGE                       10410012
104200                                                                  10420012
104300             PERFORM 2141-CLEAR-SELECTED-INDS                     10430012
104400                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 10440012
104500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10450012
104600                                                                  10460012
104700             PERFORM 5100-WRITE-TEMP-STORAGE                      10470012
104800                                                                  10480012
104900             ADD +1                TO PV-BLOCK-NUMBER             10490012
105000                                                                  10500012
105100         END-PERFORM                                              10510012
105200                                                                  10520012
105300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10530012
105400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10540012
105500                                                                  10550012
105600         PERFORM                                                  10560012
105700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10570012
105800                   ASC-HIGHEST-BLOCK-WRITTEN                      10580012
105900                                                                  10590012
106000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10600012
106100                                   TO PV-BLOCK-NUMBER             10610012
106200                                                                  10620012
106300             PERFORM 4410-READ-TEMP-STORAGE                       10630012
106400                                                                  10640012
106500             PERFORM 2141-CLEAR-SELECTED-INDS                     10650012
106600                 VARYING ASC-ITEM-SUB                             10660012
106700                 FROM 1 BY 1                                      10670012
106800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10680012
106900                                                                  10690012
107000             PERFORM 5100-WRITE-TEMP-STORAGE                      10700012
107100                                                                  10710012
107200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10720012
107300                                                                  10730012
107400         END-PERFORM                                              10740012
107500                                                                  10750012
107600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10760012
107700                                   TO PV-BLOCK-NUMBER             10770012
107800                                                                  10780012
107900         PERFORM 4410-READ-TEMP-STORAGE                           10790012
108000     END-IF.                                                      10800012
108100                                                                  10810012
108200                                                                  10820012
108300     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 10830012
108400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.10840012
108500     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  10850012
108600                                                                  10860012
108700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10870012
108800                                                                  10880012
108900 EJECT                                                            10890012
109000*----------------------------------------------------------------*10900012
109100*    MARK EACH ITEM AS BEING NOT SELECTED.                       *10910012
109200*----------------------------------------------------------------*10920012
109300                                                                  10930012
109400 2141-CLEAR-SELECTED-INDS.                                        10940012
109500                                                                  10950012
109600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10960012
109700             NOT EQUAL ZERO                                       10970012
109800         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10980012
109900             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10990012
110000                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    11000012
110100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11010012
110200                                   TO TRUE                        11020012
110300         END-IF                                                   11030012
110400     END-IF.                                                      11040012
110500                                                                  11050012
110600 EJECT                                                            11060012
110700*----------------------------------------------------------------*11070012
110800*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *11080012
110900*  FOR ALL ITEMS.                                                *11090012
111000*----------------------------------------------------------------*11100012
111100                                                                  11110012
111200 2150-SELECT-ALL-ITEMS.                                           11120012
111300                                                                  11130012
111400     MOVE +1                       TO ASC-BLK-SUB.                11140012
111500                                                                  11150012
111600     PERFORM 2151-SET-SELECTED-INDS                               11160012
111700         VARYING ASC-ITEM-SUB                                     11170012
111800         FROM 1 BY 1                                              11180012
111900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11190012
112000                                                                  11200012
112100     ADD +1                        TO ASC-BLK-SUB.                11210012
112200                                                                  11220012
112300     PERFORM 2151-SET-SELECTED-INDS                               11230012
112400         VARYING ASC-ITEM-SUB                                     11240012
112500         FROM 1 BY 1                                              11250012
112600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11260012
112700                                                                  11270012
112800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11280012
112900                                   TO PV-LIST-ITEM-NUMBER.        11290012
113000                                                                  11300012
113100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11310012
113200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11320012
113300                                                                  11330012
113400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11340012
113500        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    11350012
113600         MOVE +1                   TO ASC-BLK-SUB                 11360012
113700                                                                  11370012
113800         PERFORM 5100-WRITE-TEMP-STORAGE                          11380012
113900                                                                  11390012
114000         MOVE +1                   TO PV-BLOCK-NUMBER             11400012
114100                                                                  11410012
114200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11420012
114300             PV-FIRST-BLOCK-IN-ARRAY - 1                          11430012
114400                                                                  11440012
114500         PERFORM                                                  11450012
114600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11460012
114700                                                                  11470012
114800             PERFORM 4410-READ-TEMP-STORAGE                       11480012
114900                                                                  11490012
115000             PERFORM 2151-SET-SELECTED-INDS                       11500012
115100                 VARYING ASC-ITEM-SUB                             11510012
115200                 FROM 1 BY 1                                      11520012
115300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11530012
115400                                                                  11540012
115500             PERFORM 5100-WRITE-TEMP-STORAGE                      11550012
115600                                                                  11560012
115700             ADD +1                TO PV-BLOCK-NUMBER             11570012
115800                                                                  11580012
115900         END-PERFORM                                              11590012
116000                                                                  11600012
116100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11610012
116200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11620012
116300                                                                  11630012
116400         PERFORM                                                  11640012
116500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11650012
116600                   ASC-HIGHEST-BLOCK-WRITTEN                      11660012
116700                                                                  11670012
116800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11680012
116900                                   TO PV-BLOCK-NUMBER             11690012
117000                                                                  11700012
117100             PERFORM 4410-READ-TEMP-STORAGE                       11710012
117200                                                                  11720012
117300             PERFORM 2151-SET-SELECTED-INDS                       11730012
117400                 VARYING ASC-ITEM-SUB                             11740012
117500                 FROM 1 BY 1                                      11750012
117600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11760012
117700                                                                  11770012
117800             PERFORM 5100-WRITE-TEMP-STORAGE                      11780012
117900                                                                  11790012
118000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11800012
118100                                                                  11810012
118200         END-PERFORM                                              11820012
118300                                                                  11830012
118400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11840012
118500                                   TO PV-BLOCK-NUMBER             11850012
118600                                                                  11860012
118700         PERFORM 4410-READ-TEMP-STORAGE                           11870012
118800     END-IF.                                                      11880012
118900                                                                  11890012
119000                                                                  11900012
119100     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             11910012
119200                       ASC-NUMBER-OF-SELECTED-ITEMS.              11920012
119300                                                                  11930012
119400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11940012
119500                                                                  11950012
119600 EJECT                                                            11960012
119700*----------------------------------------------------------------*11970012
119800*    MARK EACH ITEM AS BEING SELECTED.                           *11980012
119900*----------------------------------------------------------------*11990012
120000                                                                  12000012
120100 2151-SET-SELECTED-INDS.                                          12010012
120200                                                                  12020012
120300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           12030012
120400             NOT EQUAL ZERO                                       12040012
120500         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12050012
120600             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12060012
120700                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        12070012
120800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12080012
120900                               TO  TRUE                           12090012
121000         END-IF                                                   12100012
121100     END-IF.                                                      12110012
121200******************************************************************12120012
121300** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **12130012
121400** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **12140012
121500******************************************************************12150012
121600 2200-MOVE-SCREEN-TO-COMMAREA.                                    12160012
121700                                                                  12170012
121800     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             12180012
121900     MOVE +1                       TO PV-SUB.                     12190012
122000*                                                                 12200012
122100     PERFORM 3100-SET-SUBSCRIPTS.                                 12210012
122200     IF  ASTRTITL > ZERO                                          12220012
122300         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          12230012
122400     ELSE                                                         12240012
122500         IF  ASTRTITF = DP015-ERASE-EOF                           12250012
122600             INITIALIZE ASC-START-ITEM-REQUEST                    12260012
122700         END-IF                                                   12270012
122800     END-IF.                                                      12280012
122900     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          12290012
123000         VARYING PV-SUB                                           12300012
123100         FROM 1 BY 1                                              12310012
123200         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      12320012
123300******************************************************************12330012
123400** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**12340012
123500******************************************************************12350012
123600 2210-MOVE-LINES-TO-COMMAREA.                                     12360012
123700     IF  MR-SELECTL (PV-SUB) > ZERO                               12370012
123800         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             12380012
123900         MOVE MR-SELECTI (PV-SUB)                                 12390012
124000                                   TO ASC-TEMP-SELECTED-SW        12400012
124100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12410012
124200     ELSE                                                         12420012
124300         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                12430012
124400                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     12440012
124500                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        12450012
124600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12460012
124700         END-IF                                                   12470012
124800     END-IF.                                                      12480012
124900     ADD +1                        TO ASC-ITEM-SUB.               12490012
125000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12500012
125100         ADD +1                    TO ASC-BLK-SUB                 12510012
125200         MOVE +1                   TO ASC-ITEM-SUB                12520012
125300     END-IF.                                                      12530012
125400******************************************************************12540012
125500** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **12550012
125600** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **12560012
125700******************************************************************12570012
125800 3000-EDIT-DATA-IN-COMMAREA.                                      12580012
125900     SET PS-NO-ERROR               TO TRUE.                       12590012
126000     PERFORM 3200-RESET-ATTRIBUTES.                               12600012
126100     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     12610012
126200**                                                                12620012
126300* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              12630012
126400* EDITTING IS DONE FROM THE BOTTOM UP.                            12640012
126500**                                                                12650012
126600     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       12660012
126700         ASC-ITEMS-DISPLAYED - 1.                                 12670012
126800     PERFORM 3100-SET-SUBSCRIPTS.                                 12680012
126900     PERFORM 3300-EDIT-SELECTIONS                                 12690012
127000         VARYING PV-SUB                                           12700012
127100         FROM PV-SUB BY -1                                        12710012
127200         UNTIL PV-SUB < +1                                        12720012
127300*                                                                 12730012
127400     IF  PS-NO-ERROR                                              12740012
127500         PERFORM 3400-CHECK-RANGE-SEQUENCE                        12750012
127600     END-IF.                                                      12760012
127700*                                                                 12770012
127800     IF  ((PS-NO-ERROR)                                           12780012
127900       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   12790012
128000       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    12800012
128100             PERFORM 3500-MARK-RANGE-AS-SELECTED                  12810012
128200     END-IF.                                                      12820012
128300 EJECT                                                            12830012
128400*----------------------------------------------------------------*12840012
128500*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *12850012
128600*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*12860012
128700*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *12870012
128800*                                                                *12880012
128900*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *12890012
129000*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *12900012
129100*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *12910012
129200*    US IN THE 2ND BLOCK OF THE ARRAY.                           *12920012
129300*----------------------------------------------------------------*12930012
129400                                                                  12940012
129500 3100-SET-SUBSCRIPTS.                                             12950012
129600                                                                  12960012
129700     COMPUTE ASC-ITEM-SUB =                                       12970012
129800         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        12980012
129900                                                                  12990012
130000     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         13000012
130100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            13010012
130200                                                                  13020012
130300         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               13030012
130400     ELSE                                                         13040012
130500         MOVE +1                     TO ASC-BLK-SUB               13050012
130600     END-IF.                                                      13060012
130700******************************************************************13070012
130800** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **13080012
130900******************************************************************13090012
131000                                                                  13100012
131100 3200-RESET-ATTRIBUTES.                                           13110012
131200     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   13120012
131300     MOVE DP015-GREEN              TO ASTRTITC.                   13130012
131400     MOVE DP015-UNDERLINE          TO ASTRTITH.                   13140012
131500*                                                                 13150012
131600     PERFORM                                                      13160012
131700         VARYING PV-SUB                                           13170012
131800         FROM 1 BY 1                                              13180012
131900         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        13190012
132000         IF MR-PO-NUMBER (PV-SUB) = SPACES                        13200012
132100             MOVE DP015-ASK-DRK-OFF                               13210012
132200                                   TO MR-SELECTA (PV-SUB)         13220012
132300             MOVE DP015-HL-OFF     TO MR-SELECTH (PV-SUB)         13230012
132400         ELSE                                                     13240012
132500             MOVE DP015-UNP-ALP-NOR-OFF                           13250012
132600                                   TO MR-SELECTA (PV-SUB)         13260012
132700             MOVE DP015-GREEN      TO MR-SELECTC (PV-SUB)         13270012
132800             MOVE DP015-UNDERLINE  TO MR-SELECTH (PV-SUB)         13280012
132900         END-IF                                                   13290012
133000     END-PERFORM.                                                 13300012
133100******************************************************************13310012
133200** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **13320012
133300** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **13330012
133400** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **13340012
133500** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **13350012
133600******************************************************************13360012
133700 3300-EDIT-SELECTIONS.                                            13370012
133800     EVALUATE TRUE                                                13380012
133900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13390012
134000             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         13400012
134100                 CONTINUE                                         13410012
134200         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         13420012
134300             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        13430012
134400                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   13440012
134500                 MOVE ASC-TEMP-SELECTED-SW                        13450012
134600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13460012
134700                                TO ASC-SELECTED-SW                13470012
134800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13480012
134900             END-IF                                               13490012
135000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13500012
135100                 = SPACE                                          13510012
135200             EVALUATE TRUE                                        13520012
135300                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       13530012
135400                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS13540012
135500                     MOVE SPACE TO ASC-SELECTED-SW                13550012
135600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13560012
135700                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        13570012
135800                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    13580012
135900                     MOVE SPACE TO ASC-SELECTED-SW                13590012
136000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13600012
136100                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          13610012
136200                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      13620012
136300                     MOVE SPACE TO ASC-SELECTED-SW                13630012
136400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13640012
136500             END-EVALUATE                                         13650012
136600         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           13660012
136700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13670012
136800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13680012
136900             END-IF                                               13690012
137000             PERFORM 3310-EDIT-RANGE                              13700012
137100         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             13710012
137200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13720012
137300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13730012
137400             END-IF                                               13740012
137500             PERFORM 3310-EDIT-RANGE                              13750012
137600         WHEN OTHER                                               13760012
137700             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           13770012
137800             SET DP020-MSG-FATAL    TO TRUE                       13780012
137900             MOVE -1                TO MR-SELECTL (PV-SUB)        13790012
138000             SET DP030-SET-CURSOR-APPL-1                          13800012
138100                                    TO TRUE                       13810012
138200             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        13820012
138300             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        13830012
138400             SET PS-ERROR TO TRUE                                 13840012
138500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13850012
138600                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     13860012
138700                 MOVE SPACE         TO ASC-SELECTED-SW            13870012
138800                                        (ASC-BLK-SUB ASC-ITEM-SUB)13880012
138900             END-IF                                               13890012
139000     END-EVALUATE.                                                13900012
139100                                                                  13910012
139200     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 13920012
139300     SUBTRACT +1 FROM ASC-ITEM-SUB.                               13930012
139400     IF  ASC-ITEM-SUB < 1                                         13940012
139500         SUBTRACT +1 FROM ASC-BLK-SUB                             13950012
139600         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                13960012
139700     END-IF.                                                      13970012
139800******************************************************************13980012
139900** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **13990012
140000** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **14000012
140100** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**14010012
140200** THE ENDING.                                                  **14020012
140300******************************************************************14030012
140400 3310-EDIT-RANGE.                                                 14040012
140500     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                14050012
140600         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   14060012
140700             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)14070012
140800                                   TO ASC-SELECTED-SW             14080012
140900                                        (ASC-BLK-SUB ASC-ITEM-SUB)14090012
141000             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 14100012
141100         ELSE                                                     14110012
141200             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     14120012
141300                 CONTINUE                                         14130012
141400             ELSE                                                 14140012
141500*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        14150012
141600                 MOVE PC-TSYMSG-00054                             14160012
141700                                   TO DP020-MSG-NUMBER            14170012
141800                 SET DP020-MSG-FATAL                              14180012
141900                                   TO TRUE                        14190012
142000                 MOVE -1           TO MR-SELECTL (PV-SUB)         14200012
142100                 SET DP030-SET-CURSOR-APPL-1                      14210012
142200                                   TO TRUE                        14220012
142300                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         14230012
142400                 MOVE DP015-UNDERLINE                             14240012
142500                                   TO MR-SELECTH (PV-SUB)         14250012
142600                 SET PS-ERROR      TO TRUE                        14260012
142700             END-IF                                               14270012
142800         END-IF                                                   14280012
142900     ELSE                                                         14290012
143000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     14300012
143100             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 14310012
143200                                   TO ASC-SELECTED-SW             14320012
143300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14330012
143400             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   14340012
143500         ELSE                                                     14350012
143600             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       14360012
143700                 CONTINUE                                         14370012
143800             ELSE                                                 14380012
143900*                -- ONLY ONE END-OF-RANGE ALLOWED --              14390012
144000                 MOVE PC-TSYMSG-00055                             14400012
144100                                   TO DP020-MSG-NUMBER            14410012
144200                 SET DP020-MSG-FATAL                              14420012
144300                                   TO TRUE                        14430012
144400                 MOVE -1           TO MR-SELECTL (PV-SUB)         14440012
144500                 SET DP030-SET-CURSOR-APPL-1                      14450012
144600                                   TO TRUE                        14460012
144700                 SET PS-ERROR      TO TRUE                        14470012
144800             END-IF                                               14480012
144900         END-IF                                                   14490012
145000     END-IF.                                                      14500012
145100*                                                                 14510012
145200******************************************************************14520012
145300** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **14530012
145400** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **14540012
145500******************************************************************14550012
145600 3400-CHECK-RANGE-SEQUENCE.                                       14560012
145700     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       14570012
145800       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      14580012
145900       AND  ASC-START-OF-SELECTED-RANGE >                         14590012
146000                                         ASC-END-OF-SELECTED-RANGE14600012
146100*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                14610012
146200         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 14620012
146300         SET DP020-MSG-FATAL TO TRUE                              14630012
146400         SET PS-ERROR TO TRUE                                     14640012
146500         PERFORM 3410-POSITION-AT-ERROR                           14650012
146600     END-IF.                                                      14660012
146700******************************************************************14670012
146800** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **14680012
146900** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **14690012
147000** SHOULD BE POSITIONED ON A RANGE ERROR.                       **14700012
147100******************************************************************14710012
147200 3410-POSITION-AT-ERROR.                                          14720012
147300     SET DP030-SET-CURSOR-APPL-1                                  14730012
147400                                   TO TRUE.                       14740012
147500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 14750012
147600                    - PV-TOP-ITEM + 1.                            14760012
147700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14770012
147800         CONTINUE                                                 14780012
147900     ELSE                                                         14790012
148000         MOVE -1                   TO MR-SELECTL (PV-SUB)         14800012
148100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14810012
148200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14820012
148300     END-IF.                                                      14830012
148400*                                                                 14840012
148500     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   14850012
148600                    - PV-TOP-ITEM + 1.                            14860012
148700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14870012
148800         CONTINUE                                                 14880012
148900     ELSE                                                         14890012
149000         MOVE -1                   TO MR-SELECTL (PV-SUB)         14900012
149100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14910012
149200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14920012
149300     END-IF.                                                      14930012
149400 EJECT                                                            14940012
149500*----------------------------------------------------------------*14950012
149600*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *14960012
149700*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *14970012
149800*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *14980012
149900*----------------------------------------------------------------*14990012
150000                                                                  15000012
150100 3500-MARK-RANGE-AS-SELECTED.                                     15010012
150200     MOVE +1                       TO  ASC-BLK-SUB.               15020012
150300     PERFORM 3510-MARK-SELECTED-INDS                              15030012
150400         VARYING ASC-ITEM-SUB                                     15040012
150500         FROM 1 BY 1                                              15050012
150600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15060012
150700                                                                  15070012
150800     ADD +1                        TO ASC-BLK-SUB.                15080012
150900     PERFORM 3510-MARK-SELECTED-INDS                              15090012
151000         VARYING ASC-ITEM-SUB                                     15100012
151100         FROM 1 BY 1                                              15110012
151200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15120012
151300                                                                  15130012
151400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15140012
151500                                   TO  PV-LIST-ITEM-NUMBER.       15150012
151600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15160012
151700         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         15170012
151800               PC-ITEMS-PER-PANEL).                               15180012
151900                                                                  15190012
152000     MOVE ASC-START-OF-SELECTED-RANGE                             15200012
152100                                   TO PV-START-OF-SELECTED-RANGE. 15210012
152200     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            15220012
152300         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  15230012
152400               PC-ITEMS-PER-PANEL).                               15240012
152500                                                                  15250012
152600     MOVE ASC-END-OF-SELECTED-RANGE                               15260012
152700                                   TO  PV-END-OF-SELECTED-RANGE.  15270012
152800     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             15280012
152900         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    15290012
153000               PC-ITEMS-PER-PANEL).                               15300012
153100     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             15310012
153200         PV-FIRST-BLOCK-IN-ARRAY + 1.                             15320012
153300                                                                  15330012
153400     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    15340012
153500        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        15350012
153600         MOVE +1                   TO ASC-BLK-SUB                 15360012
153700         PERFORM 5100-WRITE-TEMP-STORAGE                          15370012
153800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         15380012
153900             PV-FIRST-BLOCK-IN-ARRAY - 1                          15390012
154000                                                                  15400012
154100         PERFORM                                                  15410012
154200             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      15420012
154300                   PV-PREV-BLOCK-IN-ARRAY                         15430012
154400             MOVE PV-FIRST-BLOCK-IN-RANGE                         15440012
154500                                   TO PV-BLOCK-NUMBER             15450012
154600             PERFORM 4410-READ-TEMP-STORAGE                       15460012
154700             PERFORM 3510-MARK-SELECTED-INDS                      15470012
154800                 VARYING ASC-ITEM-SUB                             15480012
154900                 FROM 1 BY 1                                      15490012
155000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15500012
155100             PERFORM 5100-WRITE-TEMP-STORAGE                      15510012
155200             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     15520012
155300         END-PERFORM                                              15530012
155400                                                                  15540012
155500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15550012
155600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15560012
155700         PERFORM                                                  15570012
155800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15580012
155900                   PV-LAST-BLOCK-IN-RANGE                         15590012
156000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          15600012
156100                                   TO PV-BLOCK-NUMBER             15610012
156200             PERFORM 4410-READ-TEMP-STORAGE                       15620012
156300             PERFORM 3510-MARK-SELECTED-INDS                      15630012
156400                 VARYING ASC-ITEM-SUB                             15640012
156500                 FROM 1 BY 1                                      15650012
156600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15660012
156700             PERFORM 5100-WRITE-TEMP-STORAGE                      15670012
156800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      15680012
156900         END-PERFORM                                              15690012
157000                                                                  15700012
157100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             15710012
157200                                   TO PV-BLOCK-NUMBER             15720012
157300         PERFORM 4410-READ-TEMP-STORAGE                           15730012
157400     END-IF.                                                      15740012
157500                                                                  15750012
157600     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 15760012
157700                                      ASC-END-OF-SELECTED-RANGE.  15770012
157800                                                                  15780012
157900 EJECT                                                            15790012
158000*----------------------------------------------------------------*15800012
158100* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *15810012
158200*----------------------------------------------------------------*15820012
158300                                                                  15830012
158400 3510-MARK-SELECTED-INDS.                                         15840012
158500                                                                  15850012
158600     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15860012
158700                                ASC-ITEM-SUB) >                   15870012
158800         ASC-START-OF-SELECTED-RANGE)                             15880012
158900     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15890012
159000                                ASC-ITEM-SUB) =                   15900012
159100         ASC-START-OF-SELECTED-RANGE)                             15910012
159200                                                                  15920012
159300         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15930012
159400                                    ASC-ITEM-SUB) <               15940012
159500             ASC-END-OF-SELECTED-RANGE)                           15950012
159600         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15960012
159700                                    ASC-ITEM-SUB) =               15970012
159800             ASC-END-OF-SELECTED-RANGE)                           15980012
159900                                                                  15990012
160000             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          16000012
160100                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   16010012
160200                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   16020012
160300                               TO TRUE                            16030012
160400                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              16040012
160500                               TO TRUE                            16050012
160600                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    16060012
160700             END-IF                                               16070012
160800         END-IF                                                   16080012
160900     END-IF.                                                      16090012
161000                                                                  16100012
161100 EJECT                                                            16110012
161200*----------------------------------------------------------------*16120012
161300*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *16130012
161400*    INITIALIZE ALL COUNTERS AND FLAGS.                          *16140012
161500*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *16150012
161600*    DISPLAY THE PANEL TO USER.                                  *16160012
161700*----------------------------------------------------------------*16170012
161800                                                                  16180012
161900 4000-BUILD-INITIAL-PANEL.                                        16190012
162000                                                                  16200012
162100     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            16210012
162200                                 ASC-BLOCK-ENTRIES (2).           16220012
162300     MOVE +1                 TO ASC-BLK-SUB.                      16230012
162400     SET ASC-ITEMS-LEFT-ON-DB                                     16240012
162500                             TO TRUE.                             16250012
162600                                                                  16260012
162700     MOVE +0                 TO ASC-ITEM-SUB                      16270012
162800                                ASC-NUMBER-OF-ITEMS-READ          16280012
162900                                ASC-NUMBER-OF-SELECTED-ITEMS      16290012
163000                                ASC-HIGHEST-BLOCK-WRITTEN         16300012
163100                                ASC-START-OF-SELECTED-RANGE       16310012
163200                                ASC-END-OF-SELECTED-RANGE         16320012
163300                                ASC-ITEM-AT-TOP-OF-PANEL.         16330012
163400                                                                  16340012
163500     PERFORM 4100-PREPARE-CURSOR.                                 16350012
163600                                                                  16360012
163700     PERFORM 4010-OPEN-CURSOR.                                    16370012
163800                                                                  16380012
163900     PERFORM 4300-READ-ITEMS-FROM-DB.                             16390012
164000                                                                  16400012
164100     PERFORM 4020-CLOSE-CURSOR.                                   16410012
164200                                                                  16420012
164300     MOVE +1                   TO  PV-TOP-ITEM.                   16430012
164400     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          16440012
164500         IF DP020-FK-REFRESH (DP020-SRC-AID)                      16450012
164600            CONTINUE                                              16460012
164700         ELSE                                                     16470012
164800             SET DP020-NEXT-ACT-APPL-ERROR                        16480012
164900                               TO  TRUE                           16490012
165000         END-IF                                                   16500012
165100         SET DP020-MSG-FATAL   TO  TRUE                           16510012
165200         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               16520012
165300     ELSE                                                         16530012
165400         MOVE -1               TO MR-SELECTL (1)                  16540012
165500         SET DP030-SET-CURSOR-APPL-1                              16550012
165600                               TO TRUE                            16560012
165700         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     16570012
165800     END-IF.                                                      16580012
165900 EJECT                                                            16590012
166000*----------------------------------------------------------------*16600012
166100* OPEN THE TMESSAGE CURSOR.                                      *16610012
166200*   IN THIS PARTICULAR APPLICATION ONE OF 4 DIFFERENT CURSORS    *16620012
166300*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *16630012
166400*   USER.                                                        *16640012
166500*----------------------------------------------------------------*16650012
166600                                                                  16660012
166700 4010-OPEN-CURSOR.                                                16670012
166800     PERFORM                                                      16680012
166900         WITH TEST AFTER                                          16690012
167000         VARYING PV-RETRY-COUNTER                                 16700012
167100         FROM 1 BY 1                                              16710012
167200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16720012
167300                   OR (SQLCODE = ZERO))                           16730012
167400                                                                  16740012
167500         EXEC SQL                                                 16750012
167600             OPEN PRINT_QUEUE_CURSOR                              16760012
167700         END-EXEC                                                 16770012
167800                                                                  16780012
167900         EVALUATE TRUE                                            16790012
168000             WHEN SQLCODE = ZERO                                  16800012
168100             WHEN SQLCODE = -904                                  16810012
168200             WHEN SQLCODE = -913                                  16820012
168300                 CONTINUE                                         16830012
168400             WHEN SQLWARN0 NOT = SPACES                           16840012
168500             WHEN SQLCODE < ZERO                                  16850012
168600             WHEN SQLCODE > ZERO                                  16860012
168700                 MOVE '4010-OPEN-CURSOR'                          16870012
168800                                   TO DP013-PARAGRAPH             16880012
168900                 MOVE 'OPEN PRINT_QUEUE_CURSOR'                   16890012
169000                                   TO DP013-MESSAGE-TEXT (1)      16900012
169100                 MOVE SQLCA        TO DP013-SQLCA                 16910012
169200                 MOVE 'TPTKREQ '   TO DP013-DB2-TABLE-NAME (1)    16920012
169300                 MOVE 'TPTKLNE '   TO DP013-DB2-TABLE-NAME (2)    16930012
169400                 MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (3)    16940012
169500                 SET DP013-DB2-ABEND                              16950012
169600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           16960012
169700                 PERFORM DP013-0000-PROCESS-ABEND                 16970012
169800         END-EVALUATE                                             16980012
169900     END-PERFORM.                                                 16990012
170000*                                                                 17000012
170100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17010012
170200         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             17020012
170300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   17030012
170400                                   TO DP013-MESSAGE-TEXT (1)      17040012
170500         MOVE SQLCA                TO DP013-SQLCA                 17050012
170600         MOVE 'TPTKREQ '           TO DP013-DB2-TABLE-NAME (1)    17060012
170700         MOVE 'TPTKLNE '           TO DP013-DB2-TABLE-NAME (2)    17070012
170800         MOVE 'TENTNME '           TO DP013-DB2-TABLE-NAME (3)    17080012
170900         SET DP013-DB2-ABEND                                      17090012
171000             DP013-XCTL-DISPLAY-RESTART                           17100012
171100                                   TO TRUE                        17110012
171200         PERFORM DP013-0000-PROCESS-ABEND                         17120012
171300     END-IF.                                                      17130012
171400                                                                  17140012
171500 EJECT                                                            17150012
171600*----------------------------------------------------------------*17160012
171700* CLOSE THE TMESSAGE CURSOR.                                     *17170012
171800*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *17180012
171900*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *17190012
172000*   USER.                                                        *17200012
172100*----------------------------------------------------------------*17210012
172200                                                                  17220012
172300 4020-CLOSE-CURSOR.                                               17230012
172400         EXEC SQL                                                 17240012
172500             CLOSE PRINT_QUEUE_CURSOR                             17250012
172600         END-EXEC                                                 17260012
172700*                                                                 17270012
172800     EVALUATE TRUE                                                17280012
172900         WHEN SQLCODE = ZERO                                      17290012
173000             CONTINUE                                             17300012
173100         WHEN SQLWARN0 NOT = SPACES                               17310012
173200         WHEN SQLCODE < ZERO                                      17320012
173300         WHEN SQLCODE > ZERO                                      17330012
173400             MOVE '4020-CLOSE-CURSOR'                             17340012
173500                               TO DP013-PARAGRAPH                 17350012
173600             MOVE 'CLOSE PRETICKET REQUEST CURSOR'                17360012
173700                               TO DP013-MESSAGE-TEXT (1)          17370012
173800             MOVE SQLCA        TO DP013-SQLCA                     17380012
173900             MOVE 'TPTKREQ '   TO DP013-DB2-TABLE-NAME (1)        17390012
174000             MOVE 'TPTKLNE '   TO DP013-DB2-TABLE-NAME (2)        17400012
174100             MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (3)        17410012
174200             SET DP013-DB2-ABEND                                  17420012
174300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               17430012
174400             PERFORM DP013-0000-PROCESS-ABEND                     17440012
174500     END-EVALUATE.                                                17450012
174600                                                                  17460012
174700 EJECT                                                            17470012
174800*----------------------------------------------------------------*17480012
174900*    SET UP THE HOST VARIABLES.                                  *17490012
175000*----------------------------------------------------------------*17500012
175100                                                                  17510012
175200 4100-PREPARE-CURSOR.                                             17520012
175300                                                                  17530012
175400     IF  ASC-BOTH-REQ-TYPE                                        17540012
175500         MOVE 'P'              TO DK-REQ-TYPE1                    17550012
175600         MOVE 'L'              TO DK-REQ-TYPE2                    17560012
175700     ELSE                                                         17570012
175800         MOVE ASC-KEY-REQ-TYPE TO DK-REQ-TYPE1                    17580012
175900                                  DK-REQ-TYPE2                    17590012
176000     END-IF.                                                      17600012
176100                                                                  17610012
176200     IF  ASC-ACT-REQ-STAT                                         17620012
176300         MOVE 'A'              TO DK-REQ-STAT1                    17630012
176400         MOVE 'I'              TO DK-REQ-STAT2                    17640012
176500     ELSE                                                         17650012
176600         MOVE ASC-KEY-REQ-STAT TO DK-REQ-STAT1                    17660012
176700                                  DK-REQ-STAT2                    17670012
176800     END-IF.                                                      17680012
176900                                                                  17690012
177000 EJECT                                                            17700012
177100*----------------------------------------------------------------*17710012
177200*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *17720012
177300*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *17730012
177400*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *17740012
177500*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *17750012
177600*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *17760012
177700*                                                                *17770012
177800*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *17780012
177900*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *17790012
178000*    UPON INITIALIZATION.                                        *17800012
178100*----------------------------------------------------------------*17810012
178200                                                                  17820012
178300 4300-READ-ITEMS-FROM-DB.                                         17830012
178400                                                                  17840012
178500     PERFORM                                                      17850012
178600         VARYING PV-READ-COUNT                                    17860012
178700         FROM 1 BY 1                                              17870012
178800         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    17880012
178900            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         17890012
179000                                                                  17900012
179100         PERFORM 4310-FETCH                                       17910012
179200                                                                  17920012
179300         IF  ASC-ITEMS-LEFT-ON-DB                                 17930012
179400             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                17940012
179500                 ADD +1            TO ASC-ITEM-SUB                17950012
179600             ELSE                                                 17960012
179700                 ADD +1            TO ASC-BLK-SUB                 17970012
179800                 MOVE +1           TO ASC-ITEM-SUB                17980012
179900                                                                  17990012
180000                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         18000012
180100                     MOVE +1       TO ASC-BLK-SUB                 18010012
180200                     SET ASC-BLOCK-MODIFIED (1)                   18020012
180300                                   TO TRUE                        18030012
180400                     PERFORM 5100-WRITE-TEMP-STORAGE              18040012
180500                     MOVE ASC-BLOCK-ENTRIES                       18050012
180600                               (PC-MAX-BLOCKS-IN-ARRAY)           18060012
180700                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 18070012
180800                     ADD +1        TO ASC-BLK-SUB                 18080012
180900                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   18090012
181000                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      18100012
181100                                   TO TRUE                        18110012
181200                 END-IF                                           18120012
181300             END-IF                                               18130012
181400             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    18140012
181500             MOVE ASC-NUMBER-OF-ITEMS-READ                        18150012
181600                                   TO ASC-LIST-ITEM-NUMBER        18160012
181700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18170012
181800             MOVE PTKREQ-PO-NBR    TO ASC-PO-NUMBER               18180012
181900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18190012
182000             MOVE PTKREQ-PO-REQ-NBR                               18200012
182100                                   TO ASC-RQST-NBR                18210012
182200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18220012
182300             MOVE PTKREQ-REQ-STAT-CDE                             18230012
182400                                   TO ASC-RQST-STAT               18240012
182500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18250012
182600             IF PTKREQ-REQ-STAT-CDE = 'I'                         18260012
182700                SET ASC-INPROCESS (ASC-BLK-SUB ASC-ITEM-SUB)      18270012
182800                    TO TRUE                                       18280012
182900             END-IF                                               18290012
183000                                                                  18300012
183100             MOVE PTKREQ-PRT-BY-DTE                               18310012
183200                                   TO PV-DATE-ISO                 18320012
183300             MOVE CORR PV-DATE-ISO TO PV-DATE-DISPLAY             18330012
183400             MOVE PV-DATE-DISPLAY  TO ASC-PRINT-DUE-DATE          18340012
183500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18350012
183600             MOVE ENTNME-ENT-NAME-DESC                            18360012
183700                                   TO ASC-VENDOR-NAME             18370012
183800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18380012
183900             IF PV-REQUEST-TICKET-TOTAL > 9999999                 18390012
184000                 MOVE '4300-READ-ITEMS-FROM-DB'                   18400012
184100                               TO DP013-PARAGRAPH                 18410012
184200                 MOVE 'TICKET QUANTITY TOO LARGE FOR FIELDS'      18420012
184300                               TO DP013-MESSAGE-TEXT (1)          18430012
184400                 MOVE PTKREQ-PO-NBR                               18440012
184500                               TO PV-DISPLAY-COMP1                18450012
184600                 MOVE PV-REQUEST-TICKET-TOTAL                     18460012
184700                               TO PV-DISPLAY-COMP2                18470012
184800                 STRING 'PO: '          DELIMITED BY SIZE         18480012
184900                        PV-DISPLAY-COMP1                          18490012
185000                                        DELIMITED BY SIZE         18500012
185100                        ' - TICKET QUANTITY: '                    18510012
185200                                        DELIMITED BY SIZE         18520012
185300                        PV-DISPLAY-COMP2                          18530012
185400                                        DELIMITED BY SIZE         18540012
185500                               INTO PV-DISPLAY-ABEND-MESSAGE      18550012
185600                 MOVE PV-DISPLAY-ABEND-MESSAGE                    18560012
185700                               TO DP013-MESSAGE-TEXT (2)          18570012
185800                 MOVE PV-REQUEST-TICKET-TOTAL                     18580012
185900                               TO DP013-MESSAGE-TEXT (3)          18590012
186000                 SET DP013-LOGIC-ABEND                            18600012
186100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           18610012
186200                 PERFORM DP013-0000-PROCESS-ABEND                 18620012
186300             ELSE                                                 18630012
186400                 MOVE PV-REQUEST-TICKET-TOTAL                     18640012
186500                                   TO ASC-RQSTD-TICKETS           18650012
186600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18660012
186700             END-IF                                               18670012
186800                                                                  18680012
186900             IF PV-REQUEST-LINE-COUNT > 9999                      18690012
187000                 MOVE '4300-READ-ITEMS-FROM-DB'                   18700012
187100                               TO DP013-PARAGRAPH                 18710012
187200                 MOVE 'LINE COUNT TOO LARGE FOR FIELDS'           18720012
187300                               TO DP013-MESSAGE-TEXT (1)          18730012
187400                 MOVE PTKREQ-PO-NBR                               18740012
187500                               TO PV-DISPLAY-COMP1                18750012
187600                 MOVE PV-REQUEST-LINE-COUNT                       18760012
187700                               TO PV-DISPLAY-COMP2                18770012
187800                 STRING 'PO: '          DELIMITED BY SIZE         18780012
187900                        PV-DISPLAY-COMP1                          18790012
188000                                        DELIMITED BY SIZE         18800012
188100                        ' - LINE COUNT: '                         18810012
188200                                        DELIMITED BY SIZE         18820012
188300                        PV-DISPLAY-COMP2                          18830012
188400                                        DELIMITED BY SIZE         18840012
188500                               INTO PV-DISPLAY-ABEND-MESSAGE      18850012
188600                 MOVE PV-DISPLAY-ABEND-MESSAGE                    18860012
188700                               TO DP013-MESSAGE-TEXT (2)          18870012
188800                 MOVE PV-REQUEST-LINE-COUNT                       18880012
188900                               TO DP013-MESSAGE-TEXT (3)          18890012
189000                 SET DP013-LOGIC-ABEND                            18900012
189100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           18910012
189200                 PERFORM DP013-0000-PROCESS-ABEND                 18920012
189300             ELSE                                                 18930012
189400                 MOVE PV-REQUEST-LINE-COUNT                       18940012
189500                                   TO ASC-LINE-COUNT              18950012
189600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18960012
189700             END-IF                                               18970012
189800                                                                  18980012
189900             PERFORM 4320-GET-TICKET-TYPE                         18990012
190000             MOVE PTKLNE-TKT-DESC  TO ASC-TICKET-TYPE             19000012
190100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19010012
190200                                                                  19020012
190300             MOVE PTKREQ-PRTY-STAT-CDE                            19030012
190400                                   TO ASC-PRIORITY                19040012
190500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19050012
190600         END-IF                                                   19060012
190700     END-PERFORM.                                                 19070012
190800                                                                  19080012
190900     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          19090012
191000         MOVE +1               TO ASC-BLK-SUB                     19100012
191100         PERFORM 5100-WRITE-TEMP-STORAGE                          19110012
191200         ADD +1                TO ASC-BLK-SUB                     19120012
191300         PERFORM 5100-WRITE-TEMP-STORAGE                          19130012
191400                                                                  19140012
191500         MOVE 1                TO ASC-BLK-SUB                     19150012
191600                                  PV-BLOCK-NUMBER                 19160012
191700         PERFORM 4410-READ-TEMP-STORAGE                           19170012
191800         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             19180012
191900             MOVE 2            TO ASC-BLK-SUB                     19190012
192000                                  PV-BLOCK-NUMBER                 19200012
192100             PERFORM 4410-READ-TEMP-STORAGE                       19210012
192200         END-IF                                                   19220012
192300     END-IF.                                                      19230012
192400 EJECT                                                            19240012
192500*----------------------------------------------------------------*19250012
192600*    FETCH THE MESSAGE CURSOR.                                   *19260012
192700*----------------------------------------------------------------*19270012
192800                                                                  19280012
192900 4310-FETCH.                                                      19290012
193000                                                                  19300012
193100     EXEC SQL                                                     19310012
193200          FETCH PRINT_QUEUE_CURSOR                                19320012
193300          INTO                                                    19330012
193400                :PTKREQ-PO-REQ-NBR                                19340012
193500              , :PTKREQ-PO-NBR                                    19350012
193600              , :PTKREQ-PRT-BY-DTE                                19360012
193700              , :ENTNME-ENT-NAME-DESC                             19370012
193800              , :PV-REQUEST-TICKET-TOTAL                          19380012
193900              , :PV-REQUEST-LINE-COUNT                            19390012
194000              , :PTKREQ-PRTY-STAT-CDE                             19400012
194100              , :PTKREQ-REQ-STAT-CDE                              19410012
194200     END-EXEC                                                     19420012
194300                                                                  19430012
194400     EVALUATE TRUE                                                19440012
194500         WHEN SQLCODE = ZERO                                      19450012
194600         WHEN SQLCODE = +100                                      19460012
194700              CONTINUE                                            19470012
194800         WHEN SQLWARN0 NOT = SPACE                                19480012
194900         WHEN SQLCODE NOT = ZERO                                  19490012
195000              MOVE '4310-FETCH-CURSOR'                            19500012
195100                               TO DP013-PARAGRAPH                 19510012
195200              MOVE 'FETCH PRINT_QUEUE_CURSOR'                     19520012
195300                               TO DP013-MESSAGE-TEXT (1)          19530012
195400              MOVE SQLCA       TO DP013-SQLCA                     19540012
195500              SET DP013-DB2-ABEND                                 19550012
195600                               TO TRUE                            19560012
195700              PERFORM DP013-0000-PROCESS-ABEND                    19570012
195800     END-EVALUATE.                                                19580012
195900                                                                  19590012
196000     IF  SQLCODE EQUAL +100                                       19600012
196100         SET ASC-NO-ITEMS-LEFT-ON-DB                              19610012
196200                                   TO TRUE                        19620012
196300     END-IF.                                                      19630012
196400                                                                  19640012
196500*----------------------------------------------------------------*19650012
196600*    GET THE TICKET TYPE FROM THE REQUEST                        *19660012
196700*----------------------------------------------------------------*19670012
196800                                                                  19680012
196900 4320-GET-TICKET-TYPE.                                            19690012
197000                                                                  19700012
197100     EXEC SQL                                                     19710012
197200          SELECT                                                  19720012
197300                 DISTINCT(TKT_DESC)                               19730012
197400          INTO                                                    19740012
197500                :PTKLNE-TKT-DESC                                  19750012
197600          FROM                                                    19760012
197700                TPTKLNE                                           19770012
197800          WHERE                                                   19780012
197900                PO_REQ_NBR = :PTKREQ-PO-REQ-NBR                   19790012
198000     END-EXEC                                                     19800012
198100                                                                  19810012
198200     EVALUATE TRUE                                                19820012
198300         WHEN SQLCODE = ZERO                                      19830012
198400              CONTINUE                                            19840012
198500         WHEN SQLCODE = -811                                      19850012
198600              MOVE 'MULTIPLE' TO PTKLNE-TKT-DESC                  19860012
198700         WHEN SQLWARN0 NOT = SPACE                                19870012
198800         WHEN SQLCODE NOT = ZERO                                  19880012
198900              MOVE '4320-GET-TICKET-TYPE'                         19890012
199000                               TO DP013-PARAGRAPH                 19900012
199100              MOVE 'SELECT TICKET TYPE FROM REQUEST LINE TABLE'   19910012
199200                               TO DP013-MESSAGE-TEXT (1)          19920012
199300              MOVE SQLCA       TO DP013-SQLCA                     19930012
199400              SET DP013-DB2-ABEND                                 19940012
199500                               TO TRUE                            19950012
199600              PERFORM DP013-0000-PROCESS-ABEND                    19960012
199700     END-EVALUATE.                                                19970012
199800                                                                  19980012
199900     IF  SQLCODE EQUAL +100                                       19990012
200000         SET ASC-NO-ITEMS-LEFT-ON-DB                              20000012
200100                                   TO TRUE                        20010012
200200     END-IF.                                                      20020012
200300                                                                  20030012
200400 EJECT                                                            20040012
200500*----------------------------------------------------------------*20050012
200600* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *20060012
200700*----------------------------------------------------------------*20070012
200800                                                                  20080012
200900 4400-MOVE-COMMAREA-TO-SCREEN.                                    20090012
201000     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             20100012
201100         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          20110012
201200         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          20120012
201300             IF PV-TOP-ITEM = +0                                  20130012
201400                MOVE +0 TO ASC-ITEM-AT-TOP-OF-PANEL               20140012
201500                MOVE +1 TO PV-TOP-ITEM                            20150012
201600             END-IF                                               20160012
201700             MOVE +1    TO ASC-BLK-SUB                            20170012
201800             PERFORM 5100-WRITE-TEMP-STORAGE                      20180012
201900             ADD +1     TO ASC-BLK-SUB                            20190012
202000             PERFORM 5100-WRITE-TEMP-STORAGE                      20200012
202100             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             20210012
202200                 GIVING PV-BLOCK-NUMBER                           20220012
202300                 REMAINDER PV-REMAINDER                           20230012
202400             IF  PV-REMAINDER > ZERO                              20240012
202500                 ADD +1 TO PV-BLOCK-NUMBER                        20250012
202600             END-IF                                               20260012
202700             MOVE +1    TO ASC-BLK-SUB                            20270012
202800             PERFORM 4410-READ-TEMP-STORAGE                       20280012
202900             ADD +1     TO ASC-BLK-SUB                            20290012
203000                           PV-BLOCK-NUMBER                        20300012
203100             PERFORM 4410-READ-TEMP-STORAGE                       20310012
203200     END-IF.                                                      20320012
203300     MOVE +1            TO ASC-BLK-SUB.                           20330012
203400     COMPUTE ASC-ITEM-SUB =                                       20340012
203500         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              20350012
203600         + PC-ITEMS-PER-PANEL).                                   20360012
203700*                                                                 20370012
203800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        20380012
203900         ADD +1         TO ASC-BLK-SUB                            20390012
204000         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            20400012
204100     END-IF.                                                      20410012
204200*                                                                 20420012
204300     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           20430012
204400         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                20440012
204500     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        20450012
204600     PERFORM 4420-FORMAT-LIST-LINES                               20460012
204700         VARYING PV-SUB                                           20470012
204800         FROM PC-ITEMS-PER-PANEL BY -1                            20480012
204900         UNTIL PV-SUB < +1.                                       20490012
205000*                                                                 20500012
205100     COMPUTE ASC-ITEMS-DISPLAYED =                                20510012
205200         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          20520012
205300     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    20530012
205400                                      ASTRTITO.                   20540012
205500     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    20550012
205600     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    20560012
205700     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            20570012
205800                                   TO ASELITO.                    20580012
205900     MOVE ASC-KEY-DATE-LIMIT       TO PV-DATE-ISO.                20590012
206000     MOVE CORR PV-DATE-ISO         TO PV-DATE-USA.                20600012
206100     MOVE PV-DATE-USA              TO ADATEO.                     20610012
206200*                                                                 20620012
206300     IF  DP020-MSG-NUMBER-X = SPACE                               20630012
206400         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  20640012
206500*            --- MORE ITEMS TO DISPLAY ----                       20650012
206600             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            20660012
206700             SET DP020-MSG-INFORMATIONAL TO TRUE                  20670012
206800         END-IF                                                   20680012
206900     END-IF.                                                      20690012
207000*----------------------------------------------------------------*20700012
207100*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *20710012
207200*----------------------------------------------------------------*20720012
207300                                                                  20730012
207400 4410-READ-TEMP-STORAGE.                                          20740012
207500                                                                  20750012
207600     EXEC CICS                                                    20760012
207700         READQ TS                                                 20770012
207800             QUEUE (ASC-LIST-QUEUE-NAME)                          20780012
207900             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20790012
208000             ITEM  (PV-BLOCK-NUMBER)                              20800012
208100             RESP  (PV-CICS-RESP)                                 20810012
208200     END-EXEC.                                                    20820012
208300                                                                  20830012
208400     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       20840012
208500       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     20850012
208600         CONTINUE                                                 20860012
208700     ELSE                                                         20870012
208800         SET DP013-CICS-ABEND     TO TRUE                         20880012
208900         SET DP013-NO-ROLLBACK    TO TRUE                         20890012
209000         MOVE '4410-READ-TEMP-STORAGE'                            20900012
209100                                  TO DP013-PARAGRAPH              20910012
209200         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      20920012
209300                                  TO DP013-MESSAGE-TEXT(1)        20930012
209400         PERFORM DP013-0000-PROCESS-ABEND                         20940012
209500     END-IF.                                                      20950012
209600                                                                  20960012
209700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             20970012
209800*                                                                 20980012
209900     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         20990012
210000         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               21000012
210100     END-IF.                                                      21010012
210200 EJECT                                                            21020012
210300*----------------------------------------------------------------*21030012
210400*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *21040012
210500*----------------------------------------------------------------*21050012
210600                                                                  21060012
210700 4420-FORMAT-LIST-LINES.                                          21070012
210800     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      21080012
210900         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                21090012
211000         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           21100012
211100         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           21110012
211200         MOVE SPACE              TO MR-SELECTI (PV-SUB)           21120012
211300                                    MR-ACTION (PV-SUB)            21130012
211400                                    MR-PO-NUMBER (PV-SUB)         21140012
211500                                    MR-VENDOR-NAME (PV-SUB)       21150012
211600                                    MR-PRINT-DUE-DATE (PV-SUB)    21160012
211700                                    MR-PRIORITY (PV-SUB)          21170012
211800                                    MR-TICKET-TYPE (PV-SUB)       21180012
211900                                    MR-LINE-COUNT-X (PV-SUB)      21190012
212000                                    MR-RQSTD-TICKETS-X (PV-SUB)   21200012
212100                                                                  21210012
212200     ELSE                                                         21220012
212300         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      21230012
212400                                                   > SPACE        21240012
212500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 21250012
212600                                 TO MR-SELECTI (PV-SUB)           21260012
212700         ELSE                                                     21270012
212800             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      21280012
212900                                 TO MR-SELECTI (PV-SUB)           21290012
213000         END-IF                                                   21300012
213100*                                                                 21310012
213200         IF  DP030-SET-CURSOR-TRAILER                             21320012
213300             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)21330012
213400                 > SPACE)                                         21340012
213500               OR (PV-SUB = 1))                                   21350012
213600                SET DP030-SET-CURSOR-APPL-1 TO TRUE               21360012
213700                MOVE -1          TO MR-SELECTL (PV-SUB)           21370012
213800             END-IF                                               21380012
213900         END-IF                                                   21390012
214000*                                                                 21400012
214100         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           21410012
214200             MOVE ASC-PO-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)        21420012
214300                  TO MR-PO-NUMBER-N (PV-SUB)                      21430012
214400             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           21440012
214500                  TO MR-ACTION (PV-SUB)                           21450012
214600             EVALUATE TRUE                                        21460012
214700             WHEN ASC-INPROCESS (ASC-BLK-SUB ASC-ITEM-SUB)        21470012
214800                 MOVE DP015-YELLOW                                21480012
214900                             TO  MR-ACTIONC (PV-SUB)              21490012
215000                                 MR-PO-NUMBERC (PV-SUB)           21500012
215100                                 MR-PRINT-DUE-DATEC (PV-SUB)      21510012
215200                                 MR-VENDOR-NAMEC (PV-SUB)         21520012
215300                                 MR-RQSTD-TICKETSC (PV-SUB)       21530012
215400                                 MR-LINE-COUNTC (PV-SUB)          21540012
215500                                 MR-TICKET-TYPEC (PV-SUB)         21550012
215600                                 MR-PRIORITYC (PV-SUB)            21560012
215700                                                                  21570012
215800             WHEN ASC-PRINTED (ASC-BLK-SUB ASC-ITEM-SUB)          21580012
215900                 MOVE DP015-RED                                   21590012
216000                             TO  MR-ACTIONC (PV-SUB)              21600012
216100                                 MR-PO-NUMBERC (PV-SUB)           21610012
216200                                 MR-PRINT-DUE-DATEC (PV-SUB)      21620012
216300                                 MR-VENDOR-NAMEC (PV-SUB)         21630012
216400                                 MR-RQSTD-TICKETSC (PV-SUB)       21640012
216500                                 MR-LINE-COUNTC (PV-SUB)          21650012
216600                                 MR-TICKET-TYPEC (PV-SUB)         21660012
216700                                 MR-PRIORITYC (PV-SUB)            21670012
216800                                                                  21680012
216900             WHEN OTHER                                           21690012
217000                 MOVE DP015-BLUE                                  21700012
217100                             TO  MR-ACTIONC (PV-SUB)              21710012
217200                                 MR-PO-NUMBERC (PV-SUB)           21720012
217300                                 MR-PRINT-DUE-DATEC (PV-SUB)      21730012
217400                                 MR-VENDOR-NAMEC (PV-SUB)         21740012
217500                                 MR-RQSTD-TICKETSC (PV-SUB)       21750012
217600                                 MR-LINE-COUNTC (PV-SUB)          21760012
217700                                 MR-TICKET-TYPEC (PV-SUB)         21770012
217800                                 MR-PRIORITYC (PV-SUB)            21780012
217900             END-EVALUATE                                         21790012
218000             MOVE ASC-RQSTD-TICKETS (ASC-BLK-SUB ASC-ITEM-SUB)    21800012
218100                  TO  MR-RQSTD-TICKETS (PV-SUB)                   21810012
218200             MOVE ASC-VENDOR-NAME (ASC-BLK-SUB ASC-ITEM-SUB)      21820012
218300                  TO  MR-VENDOR-NAME (PV-SUB)                     21830012
218400             MOVE ASC-PRINT-DUE-DATE (ASC-BLK-SUB ASC-ITEM-SUB)   21840012
218500                  TO  MR-PRINT-DUE-DATE (PV-SUB)                  21850012
218600             MOVE ASC-TICKET-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)      21860012
218700                  TO  MR-TICKET-TYPE (PV-SUB)                     21870012
218800             MOVE ASC-PRIORITY (ASC-BLK-SUB ASC-ITEM-SUB)         21880012
218900                  TO  MR-PRIORITY (PV-SUB)                        21890012
219000             MOVE ASC-LINE-COUNT (ASC-BLK-SUB ASC-ITEM-SUB)       21900012
219100                  TO  MR-LINE-COUNT (PV-SUB)                      21910012
219200                                                                  21920012
219300         END-IF                                                   21930012
219400     END-IF.                                                      21940012
219500     SUBTRACT +1 FROM ASC-ITEM-SUB                                21950012
219600     IF  ASC-ITEM-SUB < + 1                                       21960012
219700         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  21970012
219800         MOVE +1                 TO ASC-BLK-SUB                   21980012
219900     END-IF.                                                      21990012
220000******************************************************************22000012
220100** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **22010012
220200** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **22020012
220300** ISSUE A WARNING.                                             **22030012
220400******************************************************************22040012
220500 4430-CHECK-FOR-BEGIN-AND-END.                                    22050012
220600     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       22060012
220700         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     22070012
220800*            -- NO END-OF-RANGE SPECFIED ---                      22080012
220900             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            22090012
221000             SET DP020-MSG-WARNING TO TRUE                        22100012
221100             PERFORM 4431-POSITION-AT-WARNING                     22110012
221200         END-IF                                                   22120012
221300     ELSE                                                         22130012
221400         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     22140012
221500*            -- NO BEGINNING-OF-RANGE SPECFIED ---                22150012
221600             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            22160012
221700             SET DP020-MSG-WARNING TO TRUE                        22170012
221800             PERFORM 4431-POSITION-AT-WARNING                     22180012
221900         END-IF                                                   22190012
222000     END-IF.                                                      22200012
222100******************************************************************22210012
222200** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **22220012
222300** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **22230012
222400** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **22240012
222500** POSITION THE CURSOR THERE.                                   **22250012
222600******************************************************************22260012
222700 4431-POSITION-AT-WARNING.                                        22270012
222800     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 22280012
222900                    - PV-TOP-ITEM + 1.                            22290012
223000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      22300012
223100         CONTINUE                                                 22310012
223200     ELSE                                                         22320012
223300         SET DP030-SET-CURSOR-APPL-1                              22330012
223400                                   TO TRUE                        22340012
223500         MOVE -1                   TO MR-SELECTL (PV-SUB)         22350012
223600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         22360012
223700         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         22370012
223800     END-IF.                                                      22380012
223900*                                                                 22390012
224000     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   22400012
224100                    - PV-TOP-ITEM + 1.                            22410012
224200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      22420012
224300         CONTINUE                                                 22430012
224400     ELSE                                                         22440012
224500         SET DP030-SET-CURSOR-APPL-1                              22450012
224600                                   TO TRUE                        22460012
224700         MOVE -1                   TO MR-SELECTL (PV-SUB)         22470012
224800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         22480012
224900         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         22490012
225000     END-IF.                                                      22500012
225100*----------------------------------------------------------------*22510012
225200* FIND THE SELECTED ITEM.                                         22520012
225300*----------------------------------------------------------------*22530012
225400                                                                  22540012
225500 5000-FIND-SELECTED-ITEM.                                         22550012
225600                                                                  22560012
225700     MOVE +1                   TO  ASC-BLK-SUB.                   22570012
225800     PERFORM 5100-WRITE-TEMP-STORAGE.                             22580012
225900     ADD +1                    TO  ASC-BLK-SUB.                   22590012
226000     PERFORM 5100-WRITE-TEMP-STORAGE.                             22600012
226100          SET PS-SEL-RECORD-NOT-FOUND TO TRUE                     22610012
226200                                                                  22620012
226300     PERFORM 5200-FIND-SELECTED-RECORD                            22630012
226400             VARYING PV-ITEM                                      22640012
226500             FROM 1 BY 1                                          22650012
226600             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN      22660012
226700                OR PS-SEL-RECORD-FOUND.                           22670012
226800                                                                  22680012
226900 EJECT                                                            22690012
227000*----------------------------------------------------------------*22700012
227100*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *22710012
227200*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *22720012
227300*----------------------------------------------------------------*22730012
227400                                                                  22740012
227500 5100-WRITE-TEMP-STORAGE.                                         22750012
227600     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     22760012
227700                                   TO PV-LIST-ITEM-NUMBER.        22770012
227800     COMPUTE PV-BLOCK-NUMBER =                                    22780012
227900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    22790012
228000                                                                  22800012
228100     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             22810012
228200     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             22820012
228300         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      22830012
228400             PERFORM 5105-REWRITE-ASC-LISTQ                       22840012
228500         END-IF                                                   22850012
228600     ELSE                                                         22860012
228700         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       22870012
228800         ASC-HIGHEST-BLOCK-WRITTEN + 1                            22880012
228900         PERFORM 5110-WRITE-ASC-LISTQ                             22890012
229000         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   22900012
229100     END-IF.                                                      22910012
229200                                                                  22920012
229300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             22930012
229400******************************************************************22940012
229500** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **22950012
229600** SPECIFIC COMMAREA.                                           **22960012
229700******************************************************************22970012
229800 5105-REWRITE-ASC-LISTQ.                                          22980012
229900     EXEC CICS                                                    22990012
230000         WRITEQ TS                                                23000012
230100             QUEUE (ASC-LIST-QUEUE-NAME)                          23010012
230200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23020012
230300             ITEM  (PV-BLOCK-NUMBER)                              23030012
230400             REWRITE                                              23040012
230500             RESP  (PV-CICS-RESP)                                 23050012
230600     END-EXEC.                                                    23060012
230700                                                                  23070012
230800     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           23080012
230900         CONTINUE                                                 23090012
231000     ELSE                                                         23100012
231100         SET DP013-CICS-ABEND            TO TRUE                  23110012
231200         SET DP013-NO-ROLLBACK           TO TRUE                  23120012
231300         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       23130012
231400         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     23140012
231500                                         TO DP013-MESSAGE-TEXT(1) 23150012
231600         PERFORM DP013-0000-PROCESS-ABEND                         23160012
231700     END-IF.                                                      23170012
231800                                                                  23180012
231900******************************************************************23190012
232000** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **23200012
232100** SPECIFIC COMMAREA.                                           **23210012
232200******************************************************************23220012
232300 5110-WRITE-ASC-LISTQ.                                            23230012
232400     EXEC CICS                                                    23240012
232500         WRITEQ TS                                                23250012
232600             QUEUE (ASC-LIST-QUEUE-NAME)                          23260012
232700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23270012
232800             ITEM  (PV-BLOCK-NUMBER)                              23280012
232900             RESP  (PV-CICS-RESP)                                 23290012
233000     END-EXEC.                                                    23300012
233100     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      23310012
233200         SET DP013-CICS-ABEND      TO TRUE                        23320012
233300         SET DP013-NO-ROLLBACK     TO TRUE                        23330012
233400         MOVE '5110-WRITE-ASC-LISTQ'                              23340012
233500                                   TO DP013-PARAGRAPH             23350012
233600         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           23360012
233700                                   TO DP013-MESSAGE-TEXT(1)       23370012
233800         PERFORM DP013-0000-PROCESS-ABEND                         23380012
233900     END-IF.                                                      23390012
234000 EJECT                                                            23400012
234100*----------------------------------------------------------------*23410012
234200* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *23420012
234300* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *23430012
234400*----------------------------------------------------------------*23440012
234500                                                                  23450012
234600 5200-FIND-SELECTED-RECORD.                                       23460012
234700                                                                  23470012
234800     PERFORM 6112-READ-LIST-QUEUE.                                23480012
234900                                                                  23490012
235000     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       23500012
235100         PERFORM                                                  23510012
235200         VARYING LQW-IDX                                          23520012
235300         FROM 1 BY 1                                              23530012
235400         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            23540012
235500           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          23550012
235600           OR  PS-SEL-RECORD-FOUND                                23560012
235700                                                                  23570012
235800             IF  LQW-SELECT (LQW-IDX)                             23580012
235900                 SET PS-SEL-RECORD-FOUND TO TRUE                  23590012
236000                 MOVE LQW-RQST-NBR (LQW-IDX)                      23600012
236100                                   TO PV-SEL-PO-REQ-NBR           23610012
236200                 MOVE LQW-PO-NUMBER (LQW-IDX)                     23620012
236300                                    TO PV-SEL-PO-NBR              23630012
236400                 MOVE LQW-RQST-STAT (LQW-IDX)                     23640012
236500                                    TO PV-SEL-RQST-STAT           23650012
236600                 MOVE LQW-VENDOR-NAME (LQW-IDX)                   23660012
236700                                    TO PV-SEL-VENDOR-NAME         23670012
236800             END-IF                                               23680012
236900         END-PERFORM                                              23690012
237000     END-IF.                                                      23700012
237100                                                                  23710012
237200*----------------------------------------------------------------*23720012
237300* CHANGE EACH SELECTED REQUEST TO BE "COMPLETED"                  23730012
237400*----------------------------------------------------------------*23740012
237500                                                                  23750012
237600 5300-COMPLETE-SELECTED-ITEMS.                                    23760012
237700                                                                  23770012
237800     MOVE +1                   TO  ASC-BLK-SUB.                   23780012
237900     PERFORM 5100-WRITE-TEMP-STORAGE.                             23790012
238000     ADD +1                    TO  ASC-BLK-SUB.                   23800012
238100     PERFORM 5100-WRITE-TEMP-STORAGE.                             23810012
238200                                                                  23820012
238300     PERFORM VARYING PV-ITEM FROM 1 BY 1                          23830012
238400     UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN              23840012
238500                                                                  23850012
238600         PERFORM 6112-READ-LIST-QUEUE                             23860012
238700                                                                  23870012
238800         IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                   23880012
238900             PERFORM VARYING LQW-IDX FROM 1 BY 1                  23890012
239000             UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL        23900012
239100               OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO      23910012
239200                                                                  23920012
239300                 IF  LQW-SELECT (LQW-IDX)                         23930012
239400                     PERFORM 5310-COMPLETE-ITEM                   23940012
239500                 END-IF                                           23950012
239600                                                                  23960012
239700             END-PERFORM                                          23970012
239800             PERFORM 6113-REWRITE-LIST-QUEUE                      23980012
239900         END-IF                                                   23990012
240000     END-PERFORM.                                                 24000012
240100                                                                  24010012
240200*----------------------------------------------------------------*24020012
240300* FIND THE SELECTED ITEM.                                         24030012
240400*----------------------------------------------------------------*24040012
240500                                                                  24050012
240600 5310-COMPLETE-ITEM.                                              24060012
240700                                                                  24070012
240800*    THE ORDER CAN ONLY BE "COMPLETED" IF IT HAS BEEN PRINTED     24080012
240900     IF LQW-RQST-STAT (LQW-IDX) = 'I'                             24090012
241000         PERFORM 5320-UPDATE-REQUEST                              24100012
241100         SET LQW-PRINTED (LQW-IDX) TO TRUE                        24110012
241200         MOVE 'P' TO LQW-RQST-STAT (LQW-IDX)                      24120012
241300         MOVE SPACE TO LQW-SELECTED-SW (LQW-IDX)                  24130012
241400                       LQW-TEMP-SELECTED-SW (LQW-IDX)             24140012
241500         SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS            24150012
241600         IF DP020-MSG-NUMBER-X = SPACES                           24160012
241700             MOVE PC-TSYMSG-01383   TO DP020-MSG-NUMBER           24170012
241800             SET DP020-MSG-INFORMATIONAL                          24180012
241900                                    TO TRUE                       24190012
242000         END-IF                                                   24200012
242100     ELSE                                                         24210012
242200         EVALUATE LQW-RQST-STAT (LQW-IDX)                         24220012
242300         WHEN 'A'                                                 24230012
242400             MOVE 'ACTIVE'      TO DP020-MSG-TEXT                 24240012
242500         WHEN 'H'                                                 24250012
242600             MOVE 'HOLD'        TO DP020-MSG-TEXT                 24260012
242700         WHEN 'R'                                                 24270012
242800             MOVE 'RUSH'        TO DP020-MSG-TEXT                 24280012
242900         WHEN 'P'                                                 24290012
243000             MOVE 'PRINTED'     TO DP020-MSG-TEXT                 24300012
243100         WHEN 'C'                                                 24310012
243200             MOVE 'CANCELED'    TO DP020-MSG-TEXT                 24320012
243300         END-EVALUATE                                             24330012
243400                                                                  24340012
243500         MOVE PC-TSYMSG-01387   TO DP020-MSG-NUMBER               24350012
243600         SET DP020-MSG-FATAL    TO TRUE                           24360012
243700     END-IF.                                                      24370012
243800******************************************************************24380012
243900** UPDATE THE REQUEST TO BE "PRINTED"                           **24390012
244000** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **24400012
244100******************************************************************24410012
244200 5320-UPDATE-REQUEST.                                             24420012
244300                                                                  24430012
244400     MOVE LQW-RQST-NBR (LQW-IDX)       TO PV-SEL-PO-REQ-NBR.      24440012
244500                                                                  24450012
244600     EXEC SQL                                                     24460012
244700         UPDATE TPTKREQ                                           24470012
244800         SET                                                      24480012
244900             REQ_STAT_CDE = 'P'                                   24490012
245000           , ACTL_PRT_DTE = CURRENT DATE                          24500012
245100           , PRT_TM       = CURRENT TIME                          24510012
245200           , PRT_RQSTR_ID = :DP020-USERID                         24520012
245300         WHERE                                                    24530012
245400             PO_REQ_NBR   = :PV-SEL-PO-REQ-NBR                    24540012
245500     END-EXEC.                                                    24550012
245600                                                                  24560012
245700     EVALUATE TRUE                                                24570012
245800         WHEN SQLCODE = ZERO                                      24580012
245900             CONTINUE                                             24590012
246000         WHEN SQLWARN0 NOT = SPACES                               24600012
246100         WHEN SQLCODE < ZERO                                      24610012
246200         WHEN SQLCODE > ZERO                                      24620012
246300             MOVE '5320-UPDATE-REQUEST'                           24630012
246400                               TO DP013-PARAGRAPH                 24640012
246500             MOVE 'UPDATE REQUET TO PRINT STATUS'                 24650012
246600                               TO DP013-MESSAGE-TEXT (1)          24660012
246700             MOVE PV-SEL-PO-REQ-NBR                               24670012
246800                               TO DP013-MESSAGE-TEXT (2)          24680012
246900             MOVE SQLCA        TO DP013-SQLCA                     24690012
247000             MOVE 'TPTKREQ '   TO DP013-DB2-TABLE-NAME (1)        24700012
247100             SET DP013-DB2-ABEND                                  24710012
247200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               24720012
247300             PERFORM DP013-0000-PROCESS-ABEND                     24730012
247400     END-EVALUATE.                                                24740012
247500                                                                  24750012
247600*----------------------------------------------------------------*24760012
247700*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*24770012
247800*----------------------------------------------------------------*24780012
247900                                                                  24790012
248000 6112-READ-LIST-QUEUE.                                            24800012
248100                                                                  24810012
248200     EXEC CICS                                                    24820012
248300         READQ TS                                                 24830012
248400             QUEUE (ASC-LIST-QUEUE-NAME)                          24840012
248500             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     24850012
248600             ITEM  (PV-ITEM)                                      24860012
248700             RESP  (PV-CICS-RESP)                                 24870012
248800     END-EXEC.                                                    24880012
248900*                                                                 24890012
249000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24900012
249100         CONTINUE                                                 24910012
249200     ELSE                                                         24920012
249300         SET DP013-CICS-ABEND        TO TRUE                      24930012
249400         SET DP013-NO-ROLLBACK       TO TRUE                      24940012
249500         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           24950012
249600         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    24960012
249700                                     TO DP013-MESSAGE-TEXT(1)     24970012
249800         PERFORM DP013-0000-PROCESS-ABEND                         24980012
249900     END-IF.                                                      24990012
250000                                                                  25000012
250100******************************************************************25010012
250200** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE WORK AREA       **25020012
250300******************************************************************25030012
250400 6113-REWRITE-LIST-QUEUE.                                         25040012
250500     EXEC CICS                                                    25050012
250600         WRITEQ TS                                                25060012
250700             QUEUE (ASC-LIST-QUEUE-NAME)                          25070012
250800             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     25080012
250900             ITEM  (PV-ITEM)                                      25090012
251000             REWRITE                                              25100012
251100             RESP  (PV-CICS-RESP)                                 25110012
251200     END-EXEC.                                                    25120012
251300                                                                  25130012
251400     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           25140012
251500         CONTINUE                                                 25150012
251600     ELSE                                                         25160012
251700         SET DP013-CICS-ABEND            TO TRUE                  25170012
251800         SET DP013-NO-ROLLBACK           TO TRUE                  25180012
251900         MOVE '61113-REWRITE-LIST-QUEUE' TO DP013-PARAGRAPH       25190012
252000         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     25200012
252100                                         TO DP013-MESSAGE-TEXT(1) 25210012
252200         PERFORM DP013-0000-PROCESS-ABEND                         25220012
252300     END-IF.                                                      25230012
252400                                                                  25240012
252500 EJECT                                                            25250012
252600*----------------------------------------------------------------*25260012
252700*    ABEND PROCESSOR MODULE                                      *25270012
252800*----------------------------------------------------------------*25280012
252900                                                                  25290012
253000     COPY DPPD013.                                                25300012
