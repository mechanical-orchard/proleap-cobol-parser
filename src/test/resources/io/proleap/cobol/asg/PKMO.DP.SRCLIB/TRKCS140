000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    TRKCS140.                                         00020000
000300 AUTHOR.        TOM RUSKA. G&R.                                   00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  05-26-93.                                         00050000
000600 DATE-COMPILED.                                                   00060000
000700*----------------------------------------------------------------*00070000
000800*    Y140 - TRAFFIC FREIGHT BILL CRITERIA                        *00080000
000900*                                                                *00090000
001000*    THIS PROGRAM ALLOWS THE USER TO ENTER DATA TO BE USED BY    *00100000
001100*    SUBSEQUENT PROGRAMS TO CREATE A LIST OR TO BRING UP A       *00110000
001200*    DETAIL SCREEN. ALL OTHER EDITS ARE DONE IN THE DESTINATION  *00120000
001300*    PROGRAMS WHEN THE 'GO-TO' TYPE FUNCTION IS USED..           *00130014
001400*----------------------------------------------------------------*00140000
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697         00142020
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00143020
263697* MAKING THE CALL DYNAMIC VS STATIC.                              00144020
263697*---------------------------------------------------------------* 00145020
CICS  * CHANGED 11/21/2022    BY JIM HUNTER      WR: CHG0278495         00146021
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00147021
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00148021
CICS  *-----------------------------------------------------------------00149021
001500                                                                  00150000
001600 ENVIRONMENT DIVISION.                                            00160000
001700 DATA DIVISION.                                                   00170000
001800/                                                                 00180000
001900 WORKING-STORAGE SECTION.                                         00190000
002000                                                                  00200000
002100 01  PC-PROGRAM-CONSTANTS.                                        00210000
002200     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'TR140A  '. 00220000
002300     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'TRKM140 '. 00230000
002400     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'TRKCS140'. 00240000
002410     05  PC-DPKCS060               PIC  X(08)  VALUE  'DPKCS060'. 00250015
002500     05  PC-ONE                    PIC  X(02)  VALUE  '01'.       00260011
002510     05  PC-OP-CO-NBR              PIC  X(02)  VALUE  '03'.       00270016
002600     05  PC-MAX-RETRIES            PIC  9(01)  VALUE  3.          00280000
002700     05  PC-TSYMSG-NUMBERS.                                       00290000
002800         10  PC-TSYMSG-00005       PIC  9(05)  VALUE  00005.      00300000
002900         10  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.      00310000
003000         10  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.      00320000
003100         10  PC-TSYMSG-00009       PIC  9(05)  VALUE  00009.      00330000
003200         10  PC-TSYMSG-00098       PIC  9(05)  VALUE  00098.      00340000
003300         10  PC-TSYMSG-00148       PIC  9(05)  VALUE  00148.      00350000
003310         10  PC-TSYMSG-00746       PIC  9(05)  VALUE  00746.      00360016
003400                                                                  00370000
003500 01  PV-PROGRAM-VARIABLES.                                        00380000
003600     05  PV-RETRY-COUNTER          PIC  9(03)  VALUE  0           00390000
003700                                               COMP-3.            00400000
003710     05  PV-CICS-RESP              PIC S9(04)  VALUE +0           00410016
003720                                               COMP SYNC.         00420016
003800     05  PV-DB2-COUNT              PIC S9(09)  VALUE +0           00430000
003900                                               COMP-3.            00440000
004000                                                                  00450000
004100 01  PV-TRKCS141-COMMAREA.                                        00460000
004200     05  PV-CA-OWNER-SCAC-ID       PIC X(04).                     00470000
004300     05  PV-CA-PRO-NBR             PIC X(22).                     00480000
004400     05  PV-CA-PRINTER             PIC X(08).                     00490016
004500                                                                  00500000
004600                                                                  00510000
004700 01  PS-PROGRAM-SWITCHES.                                         00520000
004800     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        00530000
004900         88  PS-ERROR                          VALUE  'Y'.        00540000
005000         88  PS-NO-ERROR                       VALUE  'N'.        00550000
005100                                                                  00560000
005200*----------------------------------------------------------------*00570000
005300*    MAP LAYOUT                                                  *00580000
005400*----------------------------------------------------------------*00590000
005500     COPY TRKM140.                                                00600000
005600                                                                  00610000
005700/                                                                 00620000
005701*----------------------------------------------------------------*00630016
005702*    COMMAREA COPYBOOK TO LINK TO DPKCS060 - PRINT DEST VALIDATION00640016
005703*----------------------------------------------------------------*00650016
005704                                                                  00660016
005705     COPY DPWS072.                                                00670016
005706                                                                  00680016
005800*----------------------------------------------------------------*00690000
005900*    ATTRIBUTE SETTINGS COPYBOOK.                                *00700000
006000*----------------------------------------------------------------*00710000
006100     COPY DPWS015.                                                00720000
006200                                                                  00730000
006300/                                                                 00740000
006400*----------------------------------------------------------------*00750000
006500*    FUNCTION KEYS COPYBOOK                                      *00760000
006600*----------------------------------------------------------------*00770000
006700     COPY DPWS016.                                                00780000
006800                                                                  00790000
006900/                                                                 00800000
007000******************************************************************00810000
007100** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **00820000
007200** SUB-ROUTINE (DPKUT100).                                      **00830000
007300******************************************************************00840000
007400     COPY DPWS010I.                                               00850000
007500                                                                  00860000
007600/                                                                 00870000
007700*----------------------------------------------------------------*00880000
007800*  WORK AREA PASSED IN CALL TO DPKUT500                          *00890000
007900*----------------------------------------------------------------*00900000
008000     COPY DPWS500.                                                00910000
008100                                                                  00920000
008200                                                                  00930000
008300*  WORK AREA PASSED IN CALL TO RCKUT023                           00940000
008400*                                                                 00950000
008500     COPY RCWS023.                                                00960000
008600/                                                                 00970000
008700******************************************************************00980000
008800** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS            **00990000
008900** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **01000000
009000******************************************************************01010000
009100     COPY DPWS030.                                                01020000
CICS       COPY DPWS930.                                                01030021
009300/                                                                 01040000
009400***************************************************************** 01050000
009500*    STANDARD COMMAREA.                                           01060000
009600***************************************************************** 01070000
009700                                                                  01080000
009800     COPY DPWS020.                                                01090000
009900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01100000
010000                                                                  01110000
010100***************************************************************** 01120000
010200*    INTER-APPLICATION COMMAREA.                                  01130000
010300***************************************************************** 01140000
010400                                                                  01150000
010500         10  INTER-APPL-COMM-AREA PIC X(200).                     01160000
010600     COPY TRWS013.                                                01170000
010700***************************************************************** 01180000
010800*    SPECIFIC COMMMAREA FOR TRKCS140.                             01190000
010900***************************************************************** 01200000
011000         10  ASC-SPECIFIC-COMMAREA.                               01210000
011100** CHG0094517  CHANGED PO-NBR LENGTH FROM 7 TO 8                  01220019
011100             15  ASC-PO-NBR                  PIC  X(08).          01230019
011200             15  ASC-PO-NBR-N REDEFINES ASC-PO-NBR                01240000
011300                                             PIC  9(08).          01250019
011400             15  ASC-ARRIVAL-DTE-BEG         PIC  X(08).          01260000
011500             15  ASC-ARRIVAL-DTE-BEG-ISO     PIC  X(10).          01270000
011600             15  ASC-ARRIVAL-DTE-END         PIC  X(08).          01280000
011700             15  ASC-ARRIVAL-DTE-END-ISO     PIC  X(10).          01290000
011800             15  ASC-OWNER-SCAC-ID           PIC  X(04).          01300000
011900             15  ASC-PRO-NBR                 PIC  X(22).          01310000
012000             15  ASC-PRINTER-ID-X.                                01320000
012100                 20  ASC-PRINTER-ID          PIC  9(08).          01330016
012200                 20  FILLER REDEFINES ASC-PRINTER-ID.             01340000
012300                     25  ASC-PRINTER-ID-1-1  PIC  X(01).          01350000
012400                     25  ASC-PRINTER-ID-2-8  PIC  X(07).          01360004
012500                     25  ASC-PRINTER-ID-2-8-N REDEFINES           01370004
012600                         ASC-PRINTER-ID-2-8  PIC  9(07).          01380004
012700                                                                  01390000
012800/                                                                 01400000
012900*----------------------------------------------------------------*01410000
013000*    ABEND PROCESSING COPYBOOK.                                  *01420000
013100*----------------------------------------------------------------*01430000
013200     COPY DPWS013.                                                01440000
013300                                                                  01450000
013400/                                                                 01460000
013500*---------------------------------------------------------------* 01470000
013600*    DB2 AREA FOR SHIPMENT TABLE                                * 01480000
013700*---------------------------------------------------------------* 01490000
013800     EXEC SQL                                                     01500000
013900          INCLUDE TSHIPMT                                         01510000
014000     END-EXEC.                                                    01520000
014100                                                                  01530000
014200/                                                                 01540000
014300*---------------------------------------------------------------* 01550000
014400*    DB2 AREA FOR VEHICLE TRIP TABLE                            * 01560000
014500*---------------------------------------------------------------* 01570000
014600     EXEC SQL                                                     01580000
014700          INCLUDE TVHTRIP                                         01590000
014800     END-EXEC.                                                    01600000
014900                                                                  01610000
015000/                                                                 01620000
015100*----------------------------------------------------------------*01630000
015200*    DB2 AREA FOR COMMUNICATIONS                                 *01640000
015300*----------------------------------------------------------------*01650000
015400                                                                  01660000
015500     EXEC SQL                                                     01670000
015600         INCLUDE SQLCA                                            01680000
015700     END-EXEC.                                                    01690000
015800                                                                  01700000
015900/                                                                 01710000
016000 LINKAGE SECTION.                                                 01720000
016100                                                                  01730000
016200 01  DFHCOMMAREA.                                                 01740000
016300     05  FILLER                         OCCURS  1 TO 4072 TIMES   01750000
016400                                        DEPENDING ON EIBCALEN.    01760000
016500         10  FILLER                     PIC X.                    01770000
016600                                                                  01780000
016700/                                                                 01790000
016800 PROCEDURE DIVISION.                                              01800000
016900                                                                  01810000
017000***************************************************************** 01820000
017100** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 01830000
017200** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 01840000
017300** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 01850000
017400**                                                             ** 01860000
017500** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 01870000
017600** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 01880000
017700***************************************************************** 01890000
017800                                                                  01900000
017900 0000-MAIN-MODULE.                                                01910000
018000                                                                  01920000
018100     INITIALIZE DP030-CICS-API-FIELDS.                            01930000
018200     MOVE +1                     TO DP030-NUMBER-OF-MAPS.         01940000
018300     MOVE PC-CURRENT-MAPSET-NAME TO DP030-MAPSET-NAME.            01950000
018400     MOVE PC-CURRENT-MAP-NAME    TO DP030-MAP-NAME (1).           01960000
018500     SET DP030-RECEIVE-APPL-MAP  TO TRUE.                         01970000
018600     MOVE LENGTH OF TR140AI      TO DP030-MAP-LENGTH (1).         01980000
018700     MOVE 'PROGRAM ENTRY CALL'   TO DP013-MESSAGE-TEXT (1).       01990000
018800                                                                  02000000
018900     PERFORM 0001-CALL-CICS-ARCH-API.                             02010000
019000     PERFORM 1000-CONTROL-PROCESSING                              02020000
019100                                                                  02030000
019200     MOVE 'PROGRAM EXIT CALL'    TO DP013-MESSAGE-TEXT (1).       02040000
019300     PERFORM 0001-CALL-CICS-ARCH-API.                             02050000
019400                                                                  02060000
019500                                                                  02070000
019600 0001-CALL-CICS-ARCH-API.                                         02080000
019700                                                                  02090000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02100021
019900                                    DFHCOMMAREA                   02110021
020000                                    DP030-CICS-API-FIELDS         02120021
020100                                    DP020-STANDARD-COMMAREA       02130021
020200                                    TR140AI.                      02140021
020300                                                                  02150000
020400     IF  DP030-RC-CALL-SUCCESSFUL                                 02160000
020500         CONTINUE                                                 02170000
020600     ELSE                                                         02180000
020700         SET DP013-NO-ROLLBACK                                    02190000
020800             DP013-XCTL-DISPLAY-RESTART                           02200000
020900             DP013-CICS-ABEND    TO TRUE                          02210000
021000         MOVE 'BEFORE 0000-MAIN-MODULE'                           02220000
021100                                 TO DP013-PARAGRAPH               02230000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O02240021
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02250021
021400         MOVE DP030-RETURN-CODE  TO DP013-MESSAGE-TEXT (3)        02260000
021500         PERFORM DP013-0000-PROCESS-ABEND                         02270000
021600     END-IF.                                                      02280000
021700                                                                  02290000
021800/                                                                 02300000
021900*----------------------------------------------------------------*02310000
022000*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02320000
022100*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02330000
022200*----------------------------------------------------------------*02340000
022300                                                                  02350000
022400 1000-CONTROL-PROCESSING.                                         02360000
022500                                                                  02370000
022600     EVALUATE TRUE                                                02380000
022700         WHEN DP020-NEXT-ACT-INITIAL                              02390000
022800             INITIALIZE ASC-SPECIFIC-COMMAREA                     02400000
022900             PERFORM 4000-BUILD-INITIAL-PANEL                     02410000
023000                                                                  02420000
023100         WHEN DP020-NEXT-ACT-READ-MAP                             02430000
023200             PERFORM 2000-FKEY-PROCESSING                         02440000
023300                                                                  02450000
023400         WHEN DP020-NEXT-ACT-RETURN                               02460000
023500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02470000
023600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02480000
023700                                                                  02490000
023800         WHEN OTHER                                               02500000
023900             SET DP013-LOGIC-ABEND                                02510000
024000                 DP013-NO-ROLLBACK                                02520000
024100                                 TO TRUE                          02530000
024200             MOVE '1000-CONTROL-PROCESSING'                       02540000
024300                                 TO  DP013-PARAGRAPH              02550000
024400             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   02560000
024500                                 TO  DP013-MESSAGE-TEXT(1)        02570000
024600             MOVE DP020-NEXT-APPL-ACTIVITY                        02580000
024700                                 TO DP013-MESSAGE-TEXT(2)         02590000
024800             PERFORM DP013-0000-PROCESS-ABEND                     02600000
024900     END-EVALUATE.                                                02610000
025000                                                                  02620000
025100/                                                                 02630000
025200*----------------------------------------------------------------*02640000
025300* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*02650000
025400* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*02660000
025500* EDITS.                                                         *02670000
025600*----------------------------------------------------------------*02680000
025700                                                                  02690000
025800 2000-FKEY-PROCESSING.                                            02700000
025900                                                                  02710000
026000     EVALUATE TRUE                                                02720000
026100                                                                  02730000
026200         WHEN DP020-SRC-AID = DP016-CLEAR                         02740000
026300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02750000
026400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02760000
026500                                                                  02770000
026600         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     02780000
026700             INITIALIZE ASC-SPECIFIC-COMMAREA                     02790000
026800             PERFORM 4000-BUILD-INITIAL-PANEL                     02800000
026900             PERFORM 3100-RESET-ATTRIBUTES                        02810000
027000                                                                  02820000
027100         WHEN OTHER                                               02830000
027200             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 02840000
027300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02850000
027400             IF  PS-NO-ERROR                                      02860000
027500                 SET DP030-CONTINUE-GO                            02870000
027600                                 TO TRUE                          02880000
027700                 PERFORM 2100-CHECK-FUNCTION-KEY                  02890000
027800             ELSE                                                 02900000
027900                 SET DP030-OVERRIDE-GO                            02910000
028000                                 TO TRUE                          02920000
028100             END-IF                                               02930000
028200     END-EVALUATE.                                                02940000
028300                                                                  02950000
028400/                                                                 02960000
028500******************************************************************02970000
028600** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **02980000
028700** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **02990000
028800** FROM THE CICS ARCHITECTURE API.                              **03000000
028900******************************************************************03010000
029000                                                                  03020000
029100 2100-CHECK-FUNCTION-KEY.                                         03030000
029200                                                                  03040000
029300     EVALUATE TRUE                                                03050000
029400         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 03060000
029500             PERFORM 2110-PREPARE-INTER-APPL-COMM                 03070000
029600                                                                  03080000
029700         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              03090000
029800             PERFORM 7000-FORMAT-COMMAREA                         03100000
029900             PERFORM 7100-START-TRANID-Y141                       03110000
030000             MOVE PC-TSYMSG-00098                                 03120000
030100                                 TO DP020-MSG-NUMBER              03130000
030200             SET DP030-OVERRIDE-GO                                03140000
030300                 DP020-MSG-INFORMATIONAL                          03150000
030400                                 TO TRUE                          03160000
030500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03170000
030600                                                                  03180000
030700         WHEN DP020-SRC-AID = DP016-ENTER                         03190000
030800             CONTINUE                                             03200000
030900                                                                  03210000
031000         WHEN OTHER                                               03220000
031100             SET DP013-NO-ROLLBACK                                03230000
031200                 DP013-XCTL-DISPLAY-RESTART                       03240000
031300                 DP013-CICS-ABEND                                 03250000
031400                                 TO TRUE                          03260000
031500             MOVE '2100-CHECK-FUNCTION-KEY'                       03270000
031600                                 TO DP013-PARAGRAPH               03280000
031700             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      03290000
031800                                 TO DP013-MESSAGE-TEXT (1)        03300000
031900             PERFORM DP013-0000-PROCESS-ABEND                     03310000
032000     END-EVALUATE.                                                03320000
032100                                                                  03330000
032200/                                                                 03340000
032300******************************************************************03350000
032400** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **03360000
032500** INTER-APPLICATION COMMAREA.                                  **03370000
032600******************************************************************03380000
032700                                                                  03390000
032800 2110-PREPARE-INTER-APPL-COMM.                                    03400000
032900                                                                  03410000
033000     MOVE ASC-PO-NBR              TO TR013-PO-NBR.                03420000
033100     MOVE ASC-ARRIVAL-DTE-BEG-ISO TO TR013-ARRIVAL-DTE-BEG.       03430000
033200     MOVE ASC-ARRIVAL-DTE-END-ISO TO TR013-ARRIVAL-DTE-END.       03440000
033300     MOVE ASC-OWNER-SCAC-ID       TO TR013-OWNER-SCAC-ID.         03450000
033400     MOVE ASC-PRO-NBR             TO TR013-PRO-NBR.               03460000
033500     MOVE ASC-PRINTER-ID-X        TO TR013-PRINTER-ID.            03470000
033600                                                                  03480000
033700/                                                                 03490000
033800*----------------------------------------------------------------*03500000
033900* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*03510000
034000* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *03520000
034100* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *03530000
034200*----------------------------------------------------------------*03540000
034300                                                                  03550000
034400 2200-MOVE-SCREEN-TO-COMMAREA.                                    03560000
034500                                                                  03570000
034600     IF  APONBRL > ZERO                                           03580000
034700         MOVE APONBRI              TO ASC-PO-NBR                  03590000
034800     ELSE                                                         03600000
034900         IF  APONBRF = DP015-ERASE-EOF                            03610000
035000             MOVE SPACE            TO ASC-PO-NBR                  03620000
035100         END-IF                                                   03630000
035200     END-IF.                                                      03640000
035300                                                                  03650000
037000     IF  ASCACL > ZERO                                            03660000
037100         MOVE ASCACI               TO ASC-OWNER-SCAC-ID           03670000
037200     ELSE                                                         03680000
037300         IF  ASCACF = DP015-ERASE-EOF                             03690000
037400             MOVE SPACE            TO ASC-OWNER-SCAC-ID           03700000
037500         END-IF                                                   03710000
037600     END-IF.                                                      03720000
037700                                                                  03730000
037800     IF  APROL > ZERO                                             03740000
037900         MOVE APROI                TO ASC-PRO-NBR                 03750000
038000     ELSE                                                         03760000
038100         IF  APROF = DP015-ERASE-EOF                              03770000
038200             MOVE SPACE            TO ASC-PRO-NBR                 03780000
038300         END-IF                                                   03790000
038400     END-IF.                                                      03800000
038500                                                                  03810000
038600     IF APRINTRL > ZERO                                           03820000
038700         MOVE APRINTRI             TO ASC-PRINTER-ID-X            03830000
038800     ELSE                                                         03840000
038900         IF APRINTRF = DP015-ERASE-EOF                            03850000
039000             MOVE SPACE            TO ASC-PRINTER-ID-X            03860000
039100         END-IF                                                   03870000
039200     END-IF.                                                      03880000
039300                                                                  03890000
039400/                                                                 03900000
039500*----------------------------------------------------------------*03910000
039600* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *03920000
039700* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *03930000
039800* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*03940000
039900* IN THE DESTINATION PROGRAM, NOT HERE.                          *03950000
040000*----------------------------------------------------------------*03960000
040100                                                                  03970000
040200 3000-EDIT-DATA-IN-COMMAREA.                                      03980000
040300                                                                  03990000
040400     PERFORM 3100-RESET-ATTRIBUTES.                               04000000
040500                                                                  04010000
048600     IF  ASC-PO-NBR > SPACES                                      04020000
048700         MOVE ASC-PO-NBR           TO DP010I-UNEDITED-FIELD       04030000
048800         MOVE LENGTH OF ASC-PO-NBR TO DP010I-MAXIMUM-DIGITS       04040000
048900         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     04050000
049000         SET DP010I-NEGATIVE-NOT-ALLOWED                          04060000
049100                                   TO TRUE                        04070000
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                         04081020
263697              USING DP010I-NUMERIC-EDIT-AREA                      04082020
049300         IF  DP010I-ERROR-DETECTED                                04090000
049400             SET PS-ERROR                                         04100000
049500                 DP020-MSG-FATAL   TO TRUE                        04110000
049600             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            04120000
049700             MOVE DP015-UNP-ALP-BRT-OFF                           04130000
049800                                   TO APONBRA                     04140000
049900             MOVE DP015-RED        TO APONBRC                     04150000
050000             MOVE DP015-REVERSE    TO APONBRH                     04160000
050100             MOVE -1               TO APONBRL                     04170000
050200             SET DP030-SET-CURSOR-APPL-1                          04180000
050300                                   TO TRUE                        04190000
050400         ELSE                                                     04200000
050500             MOVE DP010I-NUMERIC-FIELD                            04210000
050600                                   TO ASC-PO-NBR-N                04220000
050700             MOVE ASC-PO-NBR       TO APONBRO                     04230000
050800         END-IF                                                   04240000
050900     END-IF.                                                      04250000
051000                                                                  04260000
051100     IF  ASC-PRO-NBR > SPACE                                      04270000
051200         MOVE ASC-PRO-NBR            TO RC023-FREIGHT-BILL        04280000
051300         CALL RC023-FB-BOL-VEH-FORMAT                             04290000
051400                             USING RC023-FORMAT-DATA-AREA         04300000
051500         MOVE RC023-FREIGHT-BILL     TO ASC-PRO-NBR               04310000
051600     END-IF.                                                      04320000
051700                                                                  04330000
051800     IF  DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                   04340000
051900         IF  ASC-PRO-NBR NOT > SPACE                              04350000
052000             SET PS-ERROR                                         04360000
052100                DP020-MSG-FATAL  TO TRUE                          04370000
052200             MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER             04380000
052300             MOVE DP015-UNP-ALP-BRT-OFF                           04390000
052400                                 TO APROA                         04400000
052500             MOVE DP015-RED      TO APROC                         04410000
052600             MOVE DP015-REVERSE  TO APROH                         04420000
052700             MOVE -1             TO APROL                         04430000
052800             SET DP030-SET-CURSOR-APPL-1                          04440000
052900                                 TO TRUE                          04450000
053000        END-IF                                                    04460000
053100        IF  ASC-OWNER-SCAC-ID NOT > SPACE                         04470000
053200            SET PS-ERROR                                          04480000
053300                DP020-MSG-FATAL  TO TRUE                          04490000
053400            MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER              04500000
053500            MOVE DP015-UNP-ALP-BRT-OFF                            04510000
053600                                 TO ASCACA                        04520000
053700            MOVE DP015-RED       TO ASCACC                        04530000
053800            MOVE DP015-REVERSE   TO ASCACH                        04540000
053900            MOVE -1              TO ASCACL                        04550000
054000            SET DP030-SET-CURSOR-APPL-1                           04560000
054100                                 TO TRUE                          04570000
054200         END-IF                                                   04580000
054300     END-IF.                                                      04590000
054400                                                                  04600000
054500     IF  DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                   04610000
054600         IF  ASC-OWNER-SCAC-ID > SPACE                            04620000
054700         AND ASC-PRO-NBR > SPACE                                  04630000
054800             INITIALIZE PV-DB2-COUNT                              04640000
054900             PERFORM 3200-CHECK-FREIGHT-BILL                      04650000
055000             IF  PV-DB2-COUNT = +0                                04660000
055100                 SET PS-ERROR                                     04670000
055200                     DP020-MSG-FATAL                              04680000
055300                                 TO TRUE                          04690000
055400                 MOVE PC-TSYMSG-00148                             04700000
055500                                 TO DP020-MSG-NUMBER              04710000
055600                 MOVE DP015-UNP-ALP-BRT-OFF                       04720000
055700                                 TO ASCACA                        04730000
055800                                    APROA                         04740000
055900                 MOVE DP015-RED  TO ASCACC                        04750000
056000                                    APROC                         04760000
056100                 MOVE DP015-REVERSE TO ASCACH                     04770000
056200                                       APROH                      04780000
056300                 MOVE -1         TO ASCACL                        04790000
056400                 SET DP030-SET-CURSOR-APPL-1                      04800000
056500                                 TO TRUE                          04810000
056600             END-IF                                               04820000
056700         END-IF                                                   04830000
056800     END-IF.                                                      04840000
056900                                                                  04850000
057000     IF  DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                   04860000
057100         IF  ASC-PRINTER-ID-X = SPACES OR ZEROES                  04870000
057200             SET PS-ERROR                                         04880000
057300                 DP020-MSG-FATAL TO TRUE                          04890000
057400             MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER             04900000
057500             MOVE DP015-UNP-ALP-BRT-OFF                           04910000
057600                                 TO APRINTRA                      04920000
057700             MOVE DP015-RED      TO APRINTRC                      04930000
057800             MOVE DP015-REVERSE  TO APRINTRH                      04940000
057900             MOVE -1             TO APRINTRL                      04950000
058000             SET DP030-SET-CURSOR-APPL-1                          04960000
058100                                 TO TRUE                          04970000
058200         END-IF                                                   04980000
058300         IF  ASC-PRINTER-ID-X = 'XXXXXXXX'                        04990011
058400             CONTINUE                                             05000000
058500         ELSE                                                     05010000
058600             IF  ASC-PRINTER-ID-1-1 = 'U'                         05020000
058700                 PERFORM 3210-EDIT-PRINTER-ID                     05030000
058800             ELSE                                                 05040000
058900                 SET PS-ERROR                                     05050000
059000                     DP020-MSG-FATAL TO TRUE                      05060000
059100                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         05070000
059200                 MOVE DP015-UNP-ALP-BRT-OFF                       05080000
059300                                    TO APRINTRA                   05090000
059400                 MOVE DP015-RED     TO APRINTRC                   05100000
059500                 MOVE DP015-REVERSE TO APRINTRH                   05110000
059600                 MOVE -1            TO APRINTRL                   05120000
059700                 SET DP030-SET-CURSOR-APPL-1                      05130000
059800                                    TO TRUE                       05140000
059900             END-IF                                               05150000
060000         END-IF                                                   05160000
060100     END-IF.                                                      05170000
060200                                                                  05180000
060300     IF  PS-NO-ERROR                                              05190000
060400         MOVE -1                 TO ASCACL                        05200017
060500         SET DP030-SET-CURSOR-APPL-1                              05210000
060600                                 TO TRUE                          05220000
060700     END-IF.                                                      05230000
060800                                                                  05240000
060900/                                                                 05250000
061000*----------------------------------------------------------------*05260000
061100*  MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE  *05270000
061200*  MAP.                                                          *05280000
061300*----------------------------------------------------------------*05290000
061400                                                                  05300000
061500 3100-RESET-ATTRIBUTES.                                           05310000
061600                                                                  05320000
061700     MOVE DP015-UNP-ALP-NOR-OFF    TO APONBRA                     05330000
062000                                      ASCACA                      05340000
062100                                      APROA                       05350000
062200                                      APRINTRA.                   05360000
062300     MOVE DP015-GREEN              TO APONBRC                     05370000
062600                                      ASCACC                      05380000
062700                                      APROC                       05390000
062800                                      APRINTRC.                   05400000
062900     MOVE DP015-UNDERLINE          TO APONBRH                     05410000
063200                                      ASCACH                      05420000
063300                                      APROH                       05430000
063400                                      APRINTRH.                   05440000
063500                                                                  05450000
063600/                                                                 05460000
063700*----------------------------------------------------------------*05470000
063800*  CHECK TO SEE IF FREIGHT BILL INFO EXISTS                      *05480000
063900*----------------------------------------------------------------*05490000
064000                                                                  05500000
064100 3200-CHECK-FREIGHT-BILL.                                         05510000
064200                                                                  05520000
064300     PERFORM                                                      05530000
064400         WITH TEST AFTER                                          05540000
064500         VARYING PV-RETRY-COUNTER                                 05550000
064600         FROM 1 BY 1                                              05560000
064700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05570000
064800                   OR (SQLCODE = +0)                              05580000
064900                   OR (SQLCODE = +100))                           05590000
065000                                                                  05600000
065100         EXEC SQL                                                 05610000
065200            SELECT  COUNT(*)                                      05620000
065300              INTO :PV-DB2-COUNT                                  05630000
065400              FROM  TSHIPMT A                                     05640000
065500                   ,TVHTRIP B                                     05650000
065600              WHERE A.PRO_NBR       = :ASC-PRO-NBR                05660000
065700               AND  B.OWNER_SCAC_ID = :ASC-OWNER-SCAC-ID          05670000
065800               AND  A.TRIP_ID  = B.TRIP_ID                        05680000
065900         END-EXEC                                                 05690000
066000                                                                  05700000
066100         EVALUATE TRUE                                            05710000
066200             WHEN SQLCODE = +0                                    05720000
066300             WHEN SQLCODE = +100                                  05730000
066400             WHEN SQLCODE = -904                                  05740000
066500             WHEN SQLCODE = -913                                  05750000
066600                 CONTINUE                                         05760000
066700             WHEN SQLWARN0 NOT = SPACE                            05770000
066800             WHEN SQLCODE < +0                                    05780000
066900             WHEN SQLCODE > +0                                    05790000
067000                 MOVE '3200-CHECK-FREIGHT-BILL'                   05800000
067100                                 TO DP013-PARAGRAPH               05810000
067200                 MOVE 'SELECT PROOF OF DELIVERY TABLE'            05820000
067300                                 TO DP013-MESSAGE-TEXT (1)        05830000
067400                 MOVE SQLCA      TO DP013-SQLCA                   05840000
067500                 MOVE 'TSHIPMT'  TO DP013-DB2-TABLE-NAME (1)      05850000
067600                 MOVE 'TVHTRIP'  TO DP013-DB2-TABLE-NAME (2)      05860000
067700                 SET DP013-DB2-ABEND                              05870000
067800                                 TO TRUE                          05880000
067900                 SET DP013-XCTL-DISPLAY-RESTART                   05890000
068000                                 TO TRUE                          05900000
068100                 PERFORM DP013-0000-PROCESS-ABEND                 05910000
068200         END-EVALUATE                                             05920000
068300     END-PERFORM.                                                 05930000
068400                                                                  05940000
068500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        05950000
068600         MOVE '3200-CHECK-FREIGHT-BILL'                           05960000
068700                                 TO DP013-PARAGRAPH               05970000
068800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     05980000
068900                                 TO DP013-MESSAGE-TEXT (1)        05990000
069000         MOVE 'FREIGHT BILL INFO      '                           06000000
069100                                 TO DP013-MESSAGE-TEXT (2)        06010000
069200         MOVE SQLCA              TO DP013-SQLCA                   06020000
069300         MOVE 'TSHIPMT'          TO DP013-DB2-TABLE-NAME (1)      06030000
069400         MOVE 'TVHTRIP'          TO DP013-DB2-TABLE-NAME (2)      06040000
069500         SET DP013-DB2-ABEND     TO TRUE                          06050000
069600         SET DP013-XCTL-DISPLAY-RESTART                           06060000
069700                                 TO TRUE                          06070000
069800         PERFORM DP013-0000-PROCESS-ABEND                         06080000
069900     END-IF.                                                      06090000
070000                                                                  06100000
070100/                                                                 06110000
070200*----------------------------------------------------------------*06120000
070300*    CHECK THE PRINTER NUMBER FOR NUMERIC                        *06130000
070400*----------------------------------------------------------------*06140000
070500 3210-EDIT-PRINTER-ID.                                            06150000
070600                                                                  06160000
070601*            VALIDATE USING DPKCS060                              06170004
070602             MOVE ASC-PRINTER-ID-X                                06180004
070603                                     TO DP072-PRINTER-ID          06190004
070604             MOVE 'TRKCS141'         TO DP072-RPT-PGM-NME         06200008
070605             MOVE PC-ONE             TO DP072-RPT-PGM-TYP-ID      06210011
070606             MOVE DP020-OPER-UNT-ID  TO DP072-ORIGIN-OPER-UNT-ID  06220008
070607             MOVE DP020-OPER-UNT-ID  TO DP072-OPER-UNT-ID         06230008
070609             MOVE  1                 TO DP072-ORIGIN-FCLTY-ID     06240012
070610             MOVE  1                 TO DP072-FCLTY-ID            06250012
070612             SET DP072-VALIDATE     TO TRUE                       06260004
070613                                                                  06270004
070614             EXEC CICS                                            06280004
070615                 LINK PROGRAM  (PC-DPKCS060)                      06290004
070616                      COMMAREA (DP072-COMM-AREA)                  06300004
070617                      RESP     (PV-CICS-RESP)                     06310004
070618             END-EXEC                                             06320004
070619                                                                  06330004
070620             EVALUATE TRUE                                        06340004
070621                 WHEN PV-CICS-RESP = DFHRESP (NORMAL)             06350004
070622                     CONTINUE                                     06360004
070623                 WHEN OTHER                                       06370004
070624                       MOVE '3000-EDIT-DATA-IN-COMMAREA'          06380004
070625                                            TO DP013-PARAGRAPH    06390004
070626                       MOVE PV-CICS-RESP                          06400004
070627                            TO DP013-MESSAGE-TEXT(1)              06410004
070628                       MOVE SQLCA           TO DP013-SQLCA        06420004
070629                       SET DP013-LINK-RETURN                      06430004
070630                           DP013-CICS-ABEND                       06440004
070631                           DP013-NO-ROLLBACK TO TRUE              06450004
070632                       PERFORM DP013-0000-PROCESS-ABEND           06460004
070633             END-EVALUATE                                         06470004
070634                                                                  06480004
070635             IF  DP072-PRTR-PRTR-TRK-STAT-CDE = 'A'               06490006
070636                 MOVE ASC-PRINTER-ID-X   TO APRINTRO              06500010
070642             ELSE                                                 06510004
070643                 SET PS-ERROR                                     06520004
070644                     DP020-MSG-FATAL                              06530004
070645                                  TO TRUE                         06540004
070646                 MOVE PC-TSYMSG-00746                             06550004
070647                                  TO DP020-MSG-NUMBER             06560004
070648                 MOVE DP015-UNP-ALP-BRT-MDT                       06570004
070649                                  TO APRINTRA                     06580006
070650                 MOVE DP015-RED   TO APRINTRC                     06590006
070651                 MOVE DP015-REVERSE                               06600004
070652                                  TO APRINTRH                     06610006
070653                 MOVE -1          TO APRINTRL                     06620006
070654                 SET DP030-SET-CURSOR-APPL-1                      06630004
070655                                  TO TRUE                         06640004
070656             END-IF.                                              06650010
073000                                                                  06660000
073100/                                                                 06670000
073200*----------------------------------------------------------------*06680000
073300*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *06690000
073400*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *06700000
073500*  IT HERE.                                                      *06710000
073600*----------------------------------------------------------------*06720000
073700                                                                  06730000
073800 4000-BUILD-INITIAL-PANEL.                                        06740000
073900                                                                  06750000
074000     SET DP030-SET-CURSOR-APPL-1 TO TRUE                          06760000
074100     MOVE -1                     TO ASCACL.                       06770018
074200                                                                  06780000
074300/                                                                 06790000
074400*----------------------------------------------------------------*06800000
074500*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *06810000
074600*----------------------------------------------------------------*06820000
074700                                                                  06830000
074800 4400-MOVE-COMMAREA-TO-SCREEN.                                    06840000
074900                                                                  06850000
075000     MOVE ASC-PO-NBR             TO APONBRO.                      06860000
075300     MOVE ASC-OWNER-SCAC-ID      TO ASCACO.                       06870000
075400     MOVE ASC-PRO-NBR            TO APROO.                        06880000
075500                                                                  06890000
075600     IF ASC-PRINTER-ID-X = '0000'                                 06900000
075700        CONTINUE                                                  06910000
075800     ELSE                                                         06920000
075900        MOVE ASC-PRINTER-ID-X    TO APRINTRO                      06930000
076000     END-IF.                                                      06940000
076100                                                                  06950000
076200/                                                                 06960000
076300*----------------------------------------------------------------*06970000
076400*    START TRANID FOR TRKCS141 (PRINT FREIGHT BILL RECEIVER LIST)*06980000
076500*----------------------------------------------------------------*06990000
076600 7000-FORMAT-COMMAREA.                                            07000000
076700                                                                  07010000
076800     MOVE ASC-OWNER-SCAC-ID      TO PV-CA-OWNER-SCAC-ID.          07020000
076900     MOVE ASC-PRO-NBR            TO PV-CA-PRO-NBR.                07030000
077000     MOVE ASC-PRINTER-ID-X       TO PV-CA-PRINTER.                07040000
077100                                                                  07050000
077200/                                                                 07060000
077300*----------------------------------------------------------------*07070000
077400*    START TRANID FOR TRKCS141 (PRINT FREIGHT BILL RECEIVER LIST)*07080000
077500*----------------------------------------------------------------*07090000
077600 7100-START-TRANID-Y141.                                          07100000
077700                                                                  07110000
077800* ************************************************************** *07120001
077900* * PURGE-ARCHIVE-RETRIEVAL (PAR) PROJECT:                     * *07130001
078000* * CHECK PACKAGE INDICATOR IN DETERMIMING WHICH TRAN ID TO    * *07140001
078100* * START. (MULTIPLE TRAN IDS AND MNEMONICS ASSOCIATED WITH    * *07150001
078200* * THE PROGRAM TO BE STARTED; THESE DETERMINE WHICH SET OF    * *07160001
078300* * DB2 TABLES WILL BE ACCESSED: REGULAR OR ARCHIVED HISTORY.) * *07170001
078400* ************************************************************** *07180001
078500     IF DP020-SRC-DB2-PKG-ARCHIVE                                 07190002
078600         EXEC CICS                                                07200001
078700              START TRANSID ('YB41')                              07210001
078800                   FROM     (PV-TRKCS141-COMMAREA)                07220001
078900                   LENGTH   (34)                                  07230013
079000         END-EXEC                                                 07240001
079100     ELSE                                                         07250001
079200         EXEC CICS                                                07260001
079300              START TRANSID ('Y141')                              07270001
079400                   FROM     (PV-TRKCS141-COMMAREA)                07280001
079500                   LENGTH   (34)                                  07290013
079600         END-EXEC                                                 07300001
079700     END-IF.                                                      07310001
079800                                                                  07320000
079900/                                                                 07330000
080000*----------------------------------------------------------------*07340000
080100*    ABEND PROCESSOR MODULE                                      *07350000
080200*----------------------------------------------------------------*07360000
080300                                                                  07370000
080400     COPY DPPD013.                                                07380000
