000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             TXKUT008.                                00050000
000600 AUTHOR.                 KATHY PRIESTER.                          00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN.           MARCH 2001.                              00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200* THIS PROGRAM GETS THE TAXWARE PRODUCT CODE AND POS DESCRIPTION *00120009
001300* FOR TRANSACTIONS ON THE TAX EXTRACT FILE FROM COSA.            *00130009
001400*                                                                *00140009
001500* THE TAX EXTRACT FILE IS SORTED BY DEPT, MAJ CL, SUB CL, AND    *00150009
001600* SKU NUMBER.                                                    *00160009
001700*                                                                *00170009
001800* THE DEFAULT MAINTENANCE EXTRACT FILE CONTAINS THE DEFAULT      *00180009
001900* TAXWARE PRODUCT CODE FOR EACH DEPT CLASS.  IT IS SORTED BY     *00190009
002000* DEPT, MAJ CL AND SUB CL FOR THIS PROGRAM.  THE SORT INCLUDES   *00200009
002100* ONLY DEFAULT TAXWARE PRODUCT CODE RECORDS.                     *00210009
002200*                                                                *00220009
002300* THE TAXWARE PRODUCT CODE FOR EACH SKU IS SELECTED FROM XST_SKU.*00230009
002400* IF THE SKU IS NOT FOUND ON XST_SKU A RECORD IS WRITTEN TO THE  *00240009
002500* EXCEPTION REPORT.  THE DEFAULT TAXWARE PRODUCT CODE FOR THE    *00250009
002600* DEPT/CL IS USED ON THE OUTPUT FILE FOR A SKU THAT IS NOT FOUND.*00260009
002700*                                                                *00270009
002800******************************************************************00280000
STCFEE* CHANGE #: CHG0160001   JIM HUNTER         DATE:2017-01-30       00290033
STCFEE* --------------------                                            00300033
STCFEE* AS PART OF THE SALES TAX COMPLIANCE PROJECT, THE SALES HUB WILL 00310027
STCFEE* LOAD THE TAXWARE PROD CDE DESC INTO THE COSA TEPITM TABLE.      00320027
STCFEE* TXKUT005 WILL THEN LOAD IT INTO THE TAX RECORDS WHEN THEY ARE   00330027
STCFEE* CREATED.  THIS PROGRAM WILL BE CHANGED TO PULL THE TAX PROD     00340027
STCFEE* CDE DESC FROM THE XST_SKU TABLE ONLY WHEN IT IS SPACES,         00350031
STCFEE* MEANING THAT IT WAS NOT SET IN THE TEPITM TABLE.                00360031
STCFEE******************************************************************00370027
002900******************************************************************00380000
003000 ENVIRONMENT DIVISION.                                            00390000
003100******************************************************************00400000
003200                                                                  00410000
003300 CONFIGURATION SECTION.                                           00420000
003400                                                                  00430000
003500 SOURCE-COMPUTER.    IBM-3090.                                    00440000
003600 OBJECT-COMPUTER.    IBM-3090.                                    00450000
003700                                                                  00460000
003800 INPUT-OUTPUT SECTION.                                            00470000
003900                                                                  00480000
004000 FILE-CONTROL.                                                    00490000
004100                                                                  00500000
004200     SELECT POS-DATE-CARD-FILE                                    00510000
004300         ASSIGN TO INP01.                                         00520000
004400                                                                  00530000
004500     SELECT TAX-EXTRACT-IN-FILE                                   00540000
004600         ASSIGN TO INP02.                                         00550000
004700                                                                  00560000
004800     SELECT DEPT-CL-EXTRACT-FILE                                  00570009
004900         ASSIGN TO INP03.                                         00580009
005000                                                                  00590009
005100     SELECT TAX-EXTRACT-OUT-FILE                                  00600000
005200         ASSIGN TO OUT01.                                         00610000
005300                                                                  00620000
005400     SELECT PROD-CODE-EXCEPT-FILE                                 00630000
005500         ASSIGN TO RPT01.                                         00640000
005600                                                                  00650000
005700******************************************************************00660000
005800 DATA DIVISION.                                                   00670000
005900******************************************************************00680000
006000                                                                  00690000
006100 FILE SECTION.                                                    00700000
006200                                                                  00710000
006300 FD  POS-DATE-CARD-FILE                                           00720000
006400     RECORDING MODE IS F                                          00730000
006500     BLOCK CONTAINS 0 RECORDS                                     00740000
006600     LABEL RECORDS ARE STANDARD.                                  00750000
006700                                                                  00760000
006800 01  POS-DATE-CARD-RECORD     PIC X(80).                          00770009
006900                                                                  00780000
007000                                                                  00790000
007100 FD  TAX-EXTRACT-IN-FILE                                          00800000
007200     RECORDING MODE IS F                                          00810000
007300     LABEL RECORDS ARE STANDARD                                   00820000
007400     BLOCK CONTAINS 0 RECORDS                                     00830000
007500     RECORD CONTAINS 200 CHARACTERS.                              00840000
007600                                                                  00850000
007700 01  TAX-EXTRACT-IN-RECORD    PIC X(200).                         00860000
007800                                                                  00870000
007900 FD  DEPT-CL-EXTRACT-FILE                                         00880009
008000     RECORDING MODE IS F                                          00890009
008100     BLOCK CONTAINS 0 RECORDS                                     00900009
008200     LABEL RECORDS ARE STANDARD.                                  00910009
008300                                                                  00920009
008400 01  DEPT-CL-EXTRACT-RCD      PIC X(109).                         00930009
008500                                                                  00940009
008600 FD  TAX-EXTRACT-OUT-FILE                                         00950000
008700     RECORDING MODE IS F                                          00960000
008800     LABEL RECORDS ARE STANDARD                                   00970000
008900     BLOCK CONTAINS 0 RECORDS                                     00980000
009000     RECORD CONTAINS 200 CHARACTERS.                              00990000
009100                                                                  01000000
009200 01  TAX-EXTRACT-OUT-RECORD   PIC X(200).                         01010000
009300                                                                  01020000
009400 FD  PROD-CODE-EXCEPT-FILE                                        01030000
009500     RECORDING MODE IS F                                          01040000
009600     LABEL RECORDS ARE STANDARD                                   01050000
009700     BLOCK CONTAINS 0 RECORDS                                     01060000
009800     RECORD CONTAINS 200 CHARACTERS.                              01070000
009900                                                                  01080000
010000 01  PROD-CODE-EXCEPT-REC      PIC X(200).                        01090000
010100                                                                  01100000
010200 WORKING-STORAGE SECTION.                                         01110000
010300                                                                  01120000
010400******************************************************************01130000
010500* RECORD LAYOUT FOR INPUT DATE CARD (POS DATE)                    01140000
010600******************************************************************01150000
010700 01  CC-CONTROL-CARD.                                             01160000
010800     05  CC-CONTROL-CARD-DISPLAY.                                 01170000
010900         10  CC-CONTROL-NAME     PIC X(14)    VALUE               01180000
011000                                              'P.O.S. DATE = '.   01190000
011100         10  CC-POS-DATE-MMDDYY.                                  01200000
011200             15  CC-POS-DATE-MM  PIC 9(2)     VALUE ZERO.         01210000
011300             15  CC-POS-DATE-DD  PIC 9(2)     VALUE ZERO.         01220000
011400             15  CC-POS-DATE-YY  PIC 9(2)     VALUE ZERO.         01230000
011500     05  FILLER                  PIC X(60)    VALUE SPACE.        01240000
011600                                                                  01250000
011700 01  PV-RUN-DATE-MMDDYY.                                          01260000
011800     05  PV-RUN-DATE-MM          PIC X(02)    VALUE SPACE.        01270000
011900     05  FILLER                  PIC X(01)    VALUE '/'.          01280000
012000     05  PV-RUN-DATE-DD          PIC X(02)    VALUE SPACE.        01290000
012100     05  FILLER                  PIC X(01)    VALUE '/'.          01300000
012200     05  PV-RUN-DATE-YY          PIC X(02)    VALUE SPACE.        01310000
012300                                                                  01320000
012400 01  PV-DATE-AND-TIME-FIELDS.                                     01330000
012500     05  PV-POS-CCYY-MM-DD           PIC X(10).                   01340000
012600     05  FILLER REDEFINES PV-POS-CCYY-MM-DD.                      01350000
012700         10  PV-POS-CC               PIC X(02).                   01360000
012800         10  PV-POS-YY               PIC X(02).                   01370000
012900         10  FILLER                  PIC X(01).                   01380000
013000         10  PV-POS-MM               PIC X(02).                   01390000
013100         10  FILLER                  PIC X(01).                   01400000
013200         10  PV-POS-DD               PIC X(02).                   01410000
013300     05  PV-CURR-DATE-CCYYMMDD.                                   01420000
013400         10  PV-CURR-DATE-CCYY       PIC  9(04).                  01430000
013500         10  PV-CURR-DATE-MM         PIC  9(02).                  01440000
013600         10  PV-CURR-DATE-DD         PIC  9(02).                  01450000
013700     05  PV-CURR-TIME.                                            01460000
013800         10  PV-CURR-TIME-HH         PIC  9(02)    VALUE ZERO.    01470000
013900         10  PV-CURR-TIME-MM         PIC  9(02)    VALUE ZERO.    01480000
014000         10  PV-CURR-TIME-SSHH       PIC  9(04)    VALUE ZERO.    01490000
014100     05  PV-CD-CCYY-MM-DD.                                        01500000
014200         10  PV-CD-CCYY                PIC X(04).                 01510000
014300         10  FILLER                    PIC X      VALUE '/'.      01520000
014400         10  PV-CD-MM                  PIC X(02).                 01530000
014500         10  FILLER                    PIC X      VALUE '/'.      01540000
014600         10  PV-CD-DD                  PIC X(02).                 01550000
014700     05  PV-DATE                       PIC X(06).                 01560000
016000     05  PV-BEG-CCYY-MM-DD           PIC  X(10)    VALUE SPACE.   01570000
016100     05  PV-END-CCYY-MM-DD           PIC  X(10)    VALUE SPACE.   01580000
016200                                                                  01590000
016300 01  PV-MISC-COUNT-FIELDS            COMP-3.                      01600000
016400     05  PV-PAGE-CNT                 PIC S9(05)    VALUE ZERO.    01610000
016500     05  PV-LINE-CNT                 PIC S9(03)    VALUE ZERO.    01620000
016600     05  PV-EXCEPTION-CNT            PIC S9(09)    VALUE ZERO.    01630018
016700     05  PV-RECORD-CNT               PIC S9(09)    VALUE ZERO.    01640018
016800                                                                  01650000
016900 01  PV-PROGRAM-VARIABLES.                                        01660000
017000     05  PV-PARAGRAPH-NAME       PIC  X(30)        VALUE SPACE.   01670000
017100     05  PV-OPERATION-MSG-1      PIC  X(40)        VALUE SPACE.   01680000
017200     05  PV-OPERATION-MSG-2      PIC  X(40)        VALUE SPACE.   01690000
017300     05  PV-PRINT-RECORD         PIC  X(200)       VALUE SPACE.   01700000
017400     05  PV-DEPT-DESC            PIC  X(25)        VALUE SPACE.   01710000
017500     05  PV-DEPT-NBR             PIC  9(03)        VALUE ZERO.    01720000
017600     05  PV-DEPT-XXX   REDEFINES PV-DEPT-NBR                      01730000
017700                                 PIC  X(03).                      01740000
017800     05  PV-CLASS-DESC           PIC  X(25)        VALUE SPACE.   01750000
017900     05  PV-SUB-CLASS-DESC       PIC  X(25)        VALUE SPACE.   01760000
018000     05  PV-SKU-DESC             PIC  X(25)        VALUE SPACE.   01770000
018100     05  PV-SUB-CL-NBR           PIC  9(03)        VALUE ZERO.    01780000
018200     05  PV-SUB-CL-XXX REDEFINES PV-SUB-CL-NBR                    01790000
018300                                 PIC  X(03).                      01800000
018400     05  FILLER REDEFINES PV-SUB-CL-NBR.                          01810000
018500         10  FILLER              PIC  X(01).                      01820000
018600         10  PV-SUB-CL           PIC  X(02).                      01830009
018700                                                                  01840000
018800     05  PV-SKU-NBR.                                              01850000
018900         10  PV-SKU-FIRST-5DIG   PIC  9(05).                      01860000
019000         10  PV-SKU-LST-3DIGIT   PIC  9(03).                      01870000
019100     05  PV-SKU-NBR-RE REDEFINES PV-SKU-NBR PIC 9(08).            01880000
019200     05  PV-SKU                  PIC S9(08) VALUE ZERO COMP-3.    01890000
019300     05  PV-SKU-X                PIC  X(08) VALUE SPACES.         01900000
019400                                                                  01910000
019500     05  PV-MDSE-ID              PIC S9(15) COMP-3 VALUE ZERO.    01920000
019600     05  PV-TIME-HHMM            PIC 9(04)    VALUE ZERO.         01930000
019700     05  FILLER  REDEFINES  PV-TIME-HHMM.                         01940000
019800         10  PV-TIME-HH          PIC  9(02).                      01950000
019900         10  PV-TIME-MM          PIC  9(02).                      01960000
020000     05  PV-DFLT-TX-PRD-CDE      PIC  X(05)   VALUE SPACES.       01970014
020010     05  PV-TX-PRD-CDE           PIC  X(05)   VALUE SPACES.       01980014
020100     05  PV-DB2-OPERATION        PIC  X(40)   VALUE SPACE.        01990000
020200                                                                  02000000
020300 01  PS-PROGRAM-SWITCHES.                                         02010000
020400     05  PS-END-OF-TAX-EXTRACT-FILE-SW                            02020000
020500                                 PIC X(1)     VALUE 'N'.          02030000
020600         88  PS-NOT-END-OF-TAX-EXTRACT-FILE   VALUE 'N'.          02040000
020700         88  PS-END-OF-TAX-EXTRACT-FILE       VALUE 'Y'.          02050000
020710     05  PS-END-OF-DFLT-MNT-EXTRACT-SW                            02060011
020720                                 PIC X(1)     VALUE 'N'.          02070011
020730         88  PS-NOT-END-OF-DFLT-MNT-EXTRACT   VALUE 'N'.          02080011
020740         88  PS-END-OF-DFLT-MNT-EXTRACT       VALUE 'Y'.          02090011
020800     05  PS-END-OF-CARD-FILE-SW                                   02100000
020900                                 PIC X(1)     VALUE 'N'.          02110000
021000         88  PS-NOT-END-OF-CARD-FILE          VALUE 'N'.          02120000
021100         88  PS-END-OF-CARD-FILE              VALUE 'Y'.          02130000
021110     05  PS-SUB-CLASS-SW         PIC X(1)     VALUE ' '.          02140011
021121         88  PS-SUB-CL-NOT-FOUND              VALUE ' '.          02150011
021130         88  PS-SUB-CL-FOUND                  VALUE 'Y'.          02160011
021140         88  PS-SUB-CL-PASSED                 VALUE 'N'.          02170011
021200                                                                  02180000
021300 01  PC-PROGRAM-CONSTANTS.                                        02190000
021400     05  PC-PROGRAM-NAME         PIC X(8)     VALUE 'TXKUT008'.   02200000
021500     05  PC-REPORT-NUMBER        PIC 9(1)     VALUE 1.            02210000
021600     05  PC-SUBCLASS             PIC X(03)    VALUE 'SCL'.        02220000
021700     05  PC-LINE-LIMIT           PIC S9(04)   VALUE +60.          02230000
021800                                                                  02240000
021900 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      02250000
022000                                                  COMP SYNC.      02260000
022100     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    02270000
022200     88  AC-DB2-ERROR                             VALUE +4013.    02280000
022300                                                                  02290000
022400 01  ABEND-CODE                  PIC S9(4)    VALUE ZERO          02300000
022500                                 COMP SYNC.                       02310000
022600                                                                  02320000
022700 01  CD-CURRENT-DATE.                                             02330000
022800     05  CD-CURRENT-YEAR         PIC 9(2)     VALUE ZERO.         02340000
022900     05  CD-CURRENT-MONTH        PIC 9(2)     VALUE ZERO.         02350000
023000     05  CD-CURRENT-DAY          PIC 9(2)     VALUE ZERO.         02360000
023100                                                                  02370000
023200 01  CT-CURRENT-TIME.                                             02380000
023300     05  CT-CURRENT-HOUR         PIC 9(2)     VALUE ZERO.         02390000
023400     05  CT-CURRENT-MINUTE       PIC 9(2)     VALUE ZERO.         02400000
023500     05  FILLER                  PIC 9(4)     VALUE ZERO.         02410000
023600                                                                  02420000
023700******************************************************************02430000
023800*  HEADING LINES FOR THE PRODUCT CODE EXCEPTION REPORT            02440000
023900******************************************************************02450000
024000                                                                  02460000
024100 01  RH-HEADER1.                                                  02470000
024200     05  FILLER                  PIC X(75)   VALUE SPACE.         02480000
024300     05  FILLER                  PIC X(40)   VALUE                02490000
024400         'ITEMS MISSING TAXWARE PRODUCT CODES FOR '.              02500000
024500     05  PV-PROCESS-MM           PIC X(02).                       02510000
024600     05  FILLER                  PIC X(01) VALUE '/'.             02520000
024700     05  PV-PROCESS-DD           PIC X(02).                       02530000
024800     05  FILLER                  PIC X(01) VALUE '/'.             02540000
024900     05  PV-PROCESS-CC           PIC X(02).                       02550000
025000     05  PV-PROCESS-YY           PIC X(02).                       02560000
025100     05  FILLER                  PIC X(75)   VALUE SPACES.        02570000
025200                                                                  02580000
025300 01  RH-HEADER2.                                                  02590000
025400     05  FILLER               PIC X(05)   VALUE SPACE.            02600000
025500     05  FILLER               PIC X(04)   VALUE 'DEPT'.           02610000
025600     05  FILLER               PIC X(03)   VALUE SPACE.            02620000
025700     05  FILLER               PIC X(08)   VALUE 'SUBCLASS'.       02630000
025800     05  FILLER               PIC X(04)   VALUE SPACE.            02640000
025900     05  FILLER               PIC X(03)   VALUE 'SKU'.            02650000
026000     05  FILLER               PIC X(07)   VALUE SPACE.            02660000
026100     05  FILLER               PIC X(12)   VALUE 'PROPOSED TAX'.   02670000
026200     05  FILLER               PIC X(02)   VALUE SPACE.            02680000
026300     05  FILLER               PIC X(17)   VALUE 'POS DESC FOR'.   02690000
026400     05  FILLER               PIC X(03)   VALUE SPACE.            02700000
026500     05  FILLER               PIC X(25)   VALUE 'DEPARTMENT DESC'.02710000
026600     05  FILLER               PIC X(03)   VALUE SPACE.            02720000
026900     05  FILLER               PIC X(25)   VALUE 'SUB CLASS DESC'. 02730000
027000     05  FILLER               PIC X(03)   VALUE SPACE.            02740000
027100     05  FILLER               PIC X(25)   VALUE 'SKU DESC'.       02750000
027400     05  FILLER               PIC X(51)   VALUE SPACE.            02760011
027500                                                                  02770000
027600 01  RH-HEADER3.                                                  02780000
027700     05  FILLER               PIC X(05)   VALUE SPACE.            02790000
027800     05  FILLER               PIC X(04)   VALUE 'NUM '.           02800000
027900     05  FILLER               PIC X(03)   VALUE SPACE.            02810000
028000     05  FILLER               PIC X(08)   VALUE 'NUMBER  '.       02820000
028100     05  FILLER               PIC X(03)   VALUE SPACE.            02830000
028200     05  FILLER               PIC X(08)   VALUE ' NUMBER '.       02840000
028300     05  FILLER               PIC X(03)   VALUE SPACE.            02850000
028400     05  FILLER               PIC X(12)   VALUE 'PRODUCT CODE'.   02860000
028500     05  FILLER               PIC X(02)   VALUE SPACE.            02870000
028600     05  FILLER               PIC X(17)   VALUE 'DEPT/SUB CLASS'. 02880000
028700     05  FILLER               PIC X(137)  VALUE SPACE.            02890000
028800                                                                  02900000
028900 01  RH-HEADER4.                                                  02910000
029000     05  FILLER               PIC X(05)   VALUE SPACE.            02920000
029100     05  FILLER               PIC X(04)   VALUE '____'.           02930000
029200     05  FILLER               PIC X(03)   VALUE SPACE.            02940000
029300     05  FILLER               PIC X(08)   VALUE '________'.       02950000
029400     05  FILLER               PIC X(03)   VALUE SPACE.            02960000
029500     05  FILLER               PIC X(08)   VALUE '________'.       02970000
029600     05  FILLER               PIC X(03)   VALUE SPACE.            02980000
029700     05  FILLER               PIC X(11)   VALUE '___________'.    02990000
029800     05  FILLER               PIC X(03)   VALUE SPACE.            03000000
029900     05  FILLER               PIC X(17)   VALUE '______________'. 03010000
030000     05  FILLER               PIC X(03)   VALUE SPACE.            03020000
030100     05  FILLER               PIC X(25)   VALUE '_______________'.03030000
030200     05  FILLER               PIC X(03)   VALUE SPACE.            03040000
030500     05  FILLER               PIC X(25)   VALUE '______________'. 03050000
030600     05  FILLER               PIC X(03)   VALUE SPACE.            03060000
030700     05  FILLER               PIC X(25)   VALUE '________'.       03070000
031000     05  FILLER               PIC X(51)   VALUE SPACE.            03080011
031100                                                                  03090000
031200 01  RH1-SPACES.                                                  03100000
031300     05  FILLER                       PIC X(200)   VALUE SPACES.  03110000
031400                                                                  03120000
031500******************************************************************03130000
031600*  DETAIL LINE FOR THE TAX EXEMPT SUMMARY REPORT.                 03140000
031700******************************************************************03150000
031800                                                                  03160000
031900 01  D1-DETAIL-LINE-1.                                            03170000
032000     05  FILLER                  PIC X(05)   VALUE SPACES.        03180000
032100     05  DTL1-DEPT-XXX           PIC X(03)   VALUE SPACES.        03190000
032200     05  FILLER                  PIC X(04)   VALUE SPACES.        03200000
032300     05  DTL1-TSK-SUB-CL         PIC X(02)   VALUE SPACES.        03210000
032400     05  FILLER                  PIC X(09)   VALUE SPACES.        03220000
032500     05  DTL1-SKU-NUMBER         PIC X(08)   VALUE SPACES.        03230000
032600     05  FILLER                  PIC X(03)   VALUE SPACES.        03240000
032700     05  DTL1-DEFAULT-PROD-CODE  PIC X(05)   VALUE SPACES.        03250000
032800     05  FILLER                  PIC X(09)   VALUE SPACES.        03260000
032900     05  DTL1-MDSECL-POS-DESC    PIC X(17)   VALUE SPACES.        03270000
033000     05  FILLER                  PIC X(03)   VALUE SPACES.        03280000
033100     05  DTL1-DEPT-DESC          PIC X(25)   VALUE SPACES.        03290000
033200     05  FILLER                  PIC X(03)   VALUE SPACES.        03300000
033500     05  DTL1-SUB-CLASS-DESC     PIC X(25)   VALUE SPACES.        03310000
033600     05  FILLER                  PIC X(03)   VALUE SPACES.        03320000
033700     05  DTL1-SKU-DESC           PIC X(25)   VALUE SPACES.        03330000
034000     05  FILLER                  PIC X(51)   VALUE SPACES.        03340011
034100                                                                  03350000
034200 01  D2-DETAIL-LINE-2.                                            03360000
034300     05  FILLER                  PIC X(78)   VALUE SPACE.         03370000
034400     05  FILLER                  PIC X(43)   VALUE                03380000
034500         '***************END OF REPORT***************'.           03390000
034600     05  FILLER                  PIC X(79)   VALUE SPACES.        03400000
034700                                                                  03410000
034800***************************************************************** 03420000
034900*  TAX EXTRACT FILE RECORD LAYOUT                                 03430000
035000***************************************************************** 03440000
035100     COPY TXRD006.                                                03450000
035200                                                                  03460000
035300***************************************************************** 03470009
035400*  DEFAULT MAINTENANCE EXTRACT RECORD LAYOUT                      03480009
035500***************************************************************** 03490009
035600     COPY IMRD040.                                                03500009
035700                                                                  03510009
035800******************************************************************03520000
035900*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)             03530000
036000******************************************************************03540000
036100     COPY DPWS500.                                                03550006
036200                                                                  03560000
036300******************************************************************03570000
036400*  TOP OF PAGE HEADING LINE FOR PRINTING A 200 CHARACTER REPORT.  03580000
036500******************************************************************03590000
036600     COPY DPWS200.                                                03600000
036700******************************************************************03610000
036800*                                                                 03620000
036900******************************************************************03630000
037000     COPY DPWS004.                                                03640000
037100                                                                  03650000
037200******************************************************************03660000
037300*   XST_SKU TABLE TO GET SKU DESCRIPTION AND TAXWARE PRODUCT CODE*03670006
037400******************************************************************03680000
037500     EXEC SQL                                                     03690000
037600         INCLUDE XST00010                                         03700008
037700     END-EXEC.                                                    03710000
037800                                                                  03720000
037900******************************************************************03730000
038000*  XST_VND_STYL TABLE                                             03740006
038100******************************************************************03750000
038200     EXEC SQL                                                     03760000
038300         INCLUDE XST00013                                         03770006
038400     END-EXEC.                                                    03780000
038500                                                                  03790000
038600******************************************************************03800000
038700* XST_SUB_CL TABLE CONTAINS POS DESCRIPTION.                      03810006
038800******************************************************************03820000
038900     EXEC SQL                                                     03830000
039000         INCLUDE XST00014                                         03840006
039100     END-EXEC.                                                    03850000
039200                                                                  03860000
039210                                                                  03870013
039220******************************************************************03880013
039230* XST_DEPT                                                        03890013
039240******************************************************************03900013
039250     EXEC SQL                                                     03910013
039260         INCLUDE XST00015                                         03920013
039270     END-EXEC.                                                    03930013
039280                                                                  03940013
039300******************************************************************03950000
039400*  DB2 AREA FOR COMMUNICATIONS                                    03960000
039500******************************************************************03970000
039600     EXEC SQL                                                     03980000
039700         INCLUDE SQLCA                                            03990000
039800     END-EXEC.                                                    04000000
039900                                                                  04010000
040000******************************************************************04020000
040100 PROCEDURE DIVISION.                                              04030000
040200******************************************************************04040000
040300 0000-MAINLINE.                                                   04050000
040400                                                                  04060000
040500     PERFORM 1000-INITIALIZE.                                     04070000
040600                                                                  04080000
040700     PERFORM 8000-HEADER-ROUTINE-1.                               04090000
040800                                                                  04100000
040900     PERFORM 2100-READ-TAX-EXTRACT-FILE.                          04110000
041000                                                                  04120000
041100     PERFORM 2000-PROCESS-TAX-EXTRACT                             04130000
041200        UNTIL PS-END-OF-TAX-EXTRACT-FILE.                         04140000
041300                                                                  04150000
041400     PERFORM 9000-EOJ-ROUTINE.                                    04160000
041500                                                                  04170000
041600     GOBACK.                                                      04180006
041700                                                                  04190000
041800******************************************************************04200000
041900*  SET UP FOR PROGRAM PROCESSING BY OPENING ALL FILES.           *04210000
042000******************************************************************04220000
042100 1000-INITIALIZE.                                                 04230000
042200                                                                  04240000
042300     OPEN INPUT  POS-DATE-CARD-FILE                               04250000
042400                 TAX-EXTRACT-IN-FILE                              04260000
042500                 DEPT-CL-EXTRACT-FILE                             04270010
042600          OUTPUT TAX-EXTRACT-OUT-FILE                             04280000
042700                 PROD-CODE-EXCEPT-FILE.                           04290000
042800                                                                  04300000
042900     MOVE FUNCTION CURRENT-DATE (1:8) TO PV-CURR-DATE-CCYYMMDD.   04310000
043000     MOVE PV-CURR-DATE-CCYY           TO PV-CD-CCYY.              04320000
043100     MOVE PV-CURR-DATE-MM             TO PV-CD-MM.                04330000
043200     MOVE PV-CURR-DATE-DD             TO PV-CD-DD.                04340000
043300     MOVE PV-CD-CCYY-MM-DD            TO PV-DATE.                 04350000
043400                                                                  04360000
043500     READ POS-DATE-CARD-FILE INTO CC-CONTROL-CARD                 04370000
043600        AT END                                                    04380000
043700           SET PS-END-OF-CARD-FILE TO TRUE.                       04390000
043800                                                                  04400000
043900     DISPLAY 'TXKUT008 CONTROL CARD: ' CC-CONTROL-CARD.           04410000
044000                                                                  04420000
044100     CLOSE POS-DATE-CARD-FILE.                                    04430000
044200                                                                  04440000
044300     IF PS-END-OF-CARD-FILE                                       04450000
044400        DISPLAY '** ABEND ** ' PC-PROGRAM-NAME                    04460000
044500        DISPLAY 'DATE CONTROL CARD EMPTY'                         04470000
044600        SET AC-CONTROL-CARD-ERROR TO TRUE                         04480000
044700        CALL 'ILBOABN0' USING ABEND-CODE                          04490000
044800     END-IF.                                                      04500000
044900                                                                  04510000
045000     PERFORM 1115-CONVERT-INPUT-DATE.                             04520000
045100                                                                  04530000
045110     MOVE ZERO   TO XST00015-DEPT-NBR.                            04540015
045200     MOVE SPACES TO XST00014-POS-MDSE-DESC                        04550006
045300                    XST00010-TX-PRD-CDE-DESC.                     04560008
045400                                                                  04570000
045500******************************************************************04580000
045600*     CALL KOHLS CALENDAR ROUTINE:                                04590000
045700*         PASS: CONTROL CARD POS DATE (MMDDYY FORMAT).            04600000
045800*       RETURN: ACTUAL CALENDAR DB2 ISO DATE (CCYY-MM-DD FORMAT). 04610000
045900******************************************************************04620000
046000 1115-CONVERT-INPUT-DATE.                                         04630000
046100                                                                  04640000
046200     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              04650000
046300                                                                  04660000
046400     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   04670000
046500     SET  DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                   04680000
046600     SET  DPG52-LK-DTE-GREG            TO TRUE.                   04690000
046700     MOVE CC-POS-DATE-MMDDYY           TO DPG52-LK-DATE-INPUT.    04700000
046800     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    04710000
046900                                             DPG54 DPG55 DPG56.   04720000
047000     IF DPG54-SEVERE-ERROR                                        04730000
047100            DISPLAY '** ABEND ** ' PC-PROGRAM-NAME                04740000
047200            DISPLAY 'DATE CONTROL CARD INVALID'                   04750000
047300            SET AC-CONTROL-CARD-ERROR TO TRUE                     04760000
047400            CALL 'ILBOABN0' USING ABEND-CODE                      04770000
047500     END-IF.                                                      04780000
047600                                                                  04790000
047700     DISPLAY 'EXECUTION DATE USED = ' DPG55-DB2-ISO-DATE-FMT.     04800000
047800                                                                  04810000
047900     MOVE DPG55-DB2-ISO-DATE-FMT       TO PV-POS-CCYY-MM-DD.      04820000
048000     MOVE PV-POS-MM                    TO PV-RUN-DATE-MM.         04830000
048100     MOVE PV-POS-MM                    TO PV-PROCESS-MM.          04840000
048200     MOVE PV-POS-DD                    TO PV-RUN-DATE-DD.         04850000
048300     MOVE PV-POS-DD                    TO PV-PROCESS-DD.          04860000
048400     MOVE PV-POS-CC                    TO PV-PROCESS-CC.          04870000
048500     MOVE PV-POS-YY                    TO PV-RUN-DATE-YY.         04880000
048600     MOVE PV-POS-YY                    TO PV-PROCESS-YY.          04890000
048700                                                                  04900000
048800******************************************************************04910000
048900*  THIS ROUTINE PROCESSING THE TAX EXTRACT FILES. WHEN THERE IS  *04920008
049000*  A CHANGE IN DEPT CL, GET INFORMATION ABOUT THE DEPT/CLASS.    *04930008
049100*  WHEN THERE IS A CHANGE IN SKU NUMBER, GET THE TAXWARE PRODUCT *04940008
049200*  CODE ASSIGNED TO THE SKU.                                     *04950008
STCFEE*  STARTING IN FEBRUARY OF 2017, POS, POC AND ECOM WILL BE       *04960032
STCFEE*  COLLECTING THE TAXWARE PRODUCT CODE AND PASSING IT TO THE     *04970032
STCFEE*  TEPITM TABLE VIA THE SALES HUB.  TXKUT005 WILL THEN LOAD IT   *04980032
STCFEE*  TO THE TAX EXTRACT RECORDS AS THEY ARE CREATED.  THIS PROGRAM *04990032
STCFEE*  SHOULD NOT OVERLAY TAXWARE PRODUCT CODES UNLESS THEY ARE      *05000032
STCFEE*  SPACES.                                                       *05010032
049300******************************************************************05020000
049400 2000-PROCESS-TAX-EXTRACT.                                        05030000
049500                                                                  05040000
049510     IF (TX006-DEPT-NBR = 981 OR 983)                             05050030
STCFEE     AND TX006-TAXWARE-PROD-CDE = SPACES                          05060029
049520         MOVE '61900' TO TX006-TAXWARE-PROD-CDE                   05070029
049530         MOVE SPACES  TO TX006-POS-DESC                           05080023
049540     ELSE                                                         05090023
049600         IF TX006-DEPT-NBR   = PV-DEPT-NBR AND                    05100023
049700            TX006-SUB-CL-NBR = PV-SUB-CL-NBR                      05110023
049800             CONTINUE                                             05120023
049900         ELSE                                                     05130023
050000             MOVE TX006-DEPT-NBR   TO PV-DEPT-NBR                 05140023
050100             MOVE TX006-SUB-CL-NBR TO PV-SUB-CL-NBR               05150023
050200             PERFORM 4000-GET-SUB-CL-INFO                         05160023
050300         END-IF                                                   05170023
050400                                                                  05180009
STCFEE         IF TX006-TAXWARE-PROD-CDE = SPACES                       05190027
050500             IF TX006-SKU-NBR NOT EQUAL PV-SKU-NBR-RE             05200027
050600                 MOVE TX006-SKU-NBR TO PV-SKU-NBR-RE              05210027
050610                 IF PV-SKU-LST-3DIGIT = 000                       05220027
050620                     MOVE PV-DFLT-TX-PRD-CDE TO PV-TX-PRD-CDE     05230027
050630                 ELSE                                             05240027
050700                     PERFORM 3000-GET-SKU-INFO                    05250027
050710                 END-IF                                           05260027
050710             END-IF                                               05270027
051100             MOVE PV-TX-PRD-CDE      TO TX006-TAXWARE-PROD-CDE    05280027
STCFEE         END-IF                                                   05290027
050900                                                                  05300007
051300         MOVE XST00014-POS-MDSE-DESC TO TX006-POS-DESC            05310024
051310     END-IF.                                                      05320023
051400                                                                  05330000
051500     WRITE TAX-EXTRACT-OUT-RECORD FROM                            05340000
051600           TX006-TAX-AUDIT-RECORD.                                05350000
051700                                                                  05360000
051800     PERFORM 2100-READ-TAX-EXTRACT-FILE.                          05370000
051900                                                                  05380000
052000******************************************************************05390008
052100*  READ A RECORD FROM THE TAX EXTRACT FILE AND CHECK FOR END OF  *05400008
052200*  FILE.                                                         *05410008
052300******************************************************************05420008
052400 2100-READ-TAX-EXTRACT-FILE.                                      05430000
052500                                                                  05440000
052600     READ TAX-EXTRACT-IN-FILE                                     05450000
052700         INTO TX006-TAX-AUDIT-RECORD                              05460000
052800         AT END                                                   05470000
052900             SET PS-END-OF-TAX-EXTRACT-FILE TO TRUE               05480000
053000     END-READ.                                                    05490000
053100                                                                  05500000
053110     IF PS-NOT-END-OF-TAX-EXTRACT-FILE                            05510011
053200         ADD +1 TO PV-RECORD-CNT                                  05520011
053210     END-IF.                                                      05530011
053400                                                                  05540000
053500******************************************************************05550008
053600*  GET THE TAXWARE PRODUCT CODE ASSIGNED TO THE SKU FROM XST_SKU.*05560008
053700*  IF THE SKU IS NOT FOUND, WRITE A RECORD TO THE EXCEPTION      *05570008
053800*  REPORT.  ASSIGN THE DEFAULT TAXWARE PRODUCT CODE FOR THE      *05580008
053900*  DEPARTMENT CLASS TO THE SKU.                                  *05590008
054000******************************************************************05600008
054100 3000-GET-SKU-INFO.                                               05610006
054200                                                                  05620000
054300     MOVE PV-SKU-NBR-RE TO XST00010-SKU-NBR.                      05630009
054400                                                                  05640008
054500     EXEC SQL                                                     05650000
054600         SELECT A.TX_PRD_CDE_DESC                                 05660013
054700           INTO :XST00010-TX-PRD-CDE-DESC                         05670008
054800           FROM XST_SKU A                                         05680008
054900          WHERE A.SKU_NBR = :XST00010-SKU-NBR                     05690008
055000     END-EXEC.                                                    05700000
055100                                                                  05710000
055200     EVALUATE SQLCODE                                             05720000
055300         WHEN ZERO                                                05730000
055400             MOVE XST00010-TX-PRD-CDE-DESC TO PV-TX-PRD-CDE       05740008
055500         WHEN +100                                                05750000
055510             MOVE PV-DFLT-TX-PRD-CDE       TO PV-TX-PRD-CDE       05760019
055600             PERFORM 5000-SKU-EXCEPTION                           05770026
055800         WHEN OTHER                                               05780000
055900             DISPLAY 'SKU NUMBER IS ' TX006-SKU-NBR               05790008
056000             MOVE '3000-GET-SKU-INFO' TO PV-PARAGRAPH-NAME        05800008
056100             MOVE 'ERROR SELECTING FROM XST_SKU'                  05810009
056200                                      TO PV-DB2-OPERATION         05820008
056300             PERFORM 9200-SQL-ABEND                               05830000
056400     END-EVALUATE.                                                05840000
056500                                                                  05850000
056600******************************************************************05860009
056700* GET THE POS MDSE DESCRIPTION FOR THE DEPT/CL FROM XST_DEPT_CL   05870009
056800* AND GET THE DEFAULT TAXWARE PRODUCT CODE FROM THE DEFAULT MNT   05880009
056900* EXTRACT FILE.                                                   05890009
057000******************************************************************05900009
057100 4000-GET-SUB-CL-INFO.                                            05910009
057200                                                                  05920009
057300     IF PV-DEPT-XXX   = IM040-MDSAER-DEPT-NBR AND                 05930009
057400        PV-SUB-CL-NBR = IM040-MDSEAR-SUB-CL-NBR                   05940009
057500         CONTINUE                                                 05950009
057600     ELSE                                                         05960009
057700         IF PS-END-OF-DFLT-MNT-EXTRACT                            05970009
057800             CONTINUE                                             05980009
057900         ELSE                                                     05990009
058000             IF PV-DEPT-NBR > IM040-MDSAER-DEPT-NBR               06000009
058100                                OR                                06010009
058200                (PV-DEPT-NBR   = IM040-MDSAER-DEPT-NBR AND        06020009
058300                 PV-SUB-CL-NBR > IM040-MDSEAR-SUB-CL-NBR)         06030009
058400                   SET PS-SUB-CL-NOT-FOUND TO TRUE                06040009
058500                   PERFORM 4100-READ-DFLT-MNT-EXTRACT             06050009
058600                     UNTIL PS-END-OF-DFLT-MNT-EXTRACT             06060009
058700                        OR PS-SUB-CL-FOUND                        06070009
058800                        OR PS-SUB-CL-PASSED                       06080009
058900             ELSE                                                 06090009
059000                 SET PS-SUB-CL-PASSED TO TRUE                     06100009
059100             END-IF                                               06110009
059200         END-IF                                                   06120009
059300     END-IF.                                                      06130009
059400                                                                  06140009
059410     IF PS-SUB-CL-FOUND                                           06150011
059500         MOVE IM040-VSCHVL-CHARTC-VAL-DESC TO PV-DFLT-TX-PRD-CDE  06160011
059501     ELSE                                                         06170011
059503         MOVE '00000'                      TO PV-DFLT-TX-PRD-CDE  06180011
059504         PERFORM 5200-DFLT-PRD-CDE-ERROR                          06190011
059510     END-IF.                                                      06200011
059600                                                                  06210009
059700     MOVE PV-DEPT-NBR   TO XST00014-DEPT-NBR.                     06220009
059800     MOVE PV-SUB-CL-NBR TO XST00014-SUB-CL-NBR.                   06230009
059900                                                                  06240009
060000     PERFORM 4200-GET-POS-DESC.                                   06250009
060100                                                                  06260009
060200******************************************************************06270009
060300* READ THE DEPARTMENT CLASS EXTRACT FILE.  SET THE END OF FILE    06280010
060400* INDICATOR AT END OF FILE, SET THE RECORD FOUND INDICATOR WHEN   06290010
060500* THE KEYS MATCH.  IF THE KEY OF THE RECORD READ IS GREATER THAN  06300010
060600* THE KEY OF THE CURRENT DEPT CL, SET THE DEPT CL SKIPPED FLAG.   06310010
060700******************************************************************06320010
060800 4100-READ-DFLT-MNT-EXTRACT.                                      06330011
060900                                                                  06340010
060910     READ DEPT-CL-EXTRACT-FILE                                    06350016
060920         INTO IM040-DEFAULT-MAINT-EXTRACT                         06360016
060930         AT END                                                   06370011
060940             SET PS-END-OF-DFLT-MNT-EXTRACT TO TRUE               06380011
060950     END-READ.                                                    06390011
060960                                                                  06400011
060970     IF PS-END-OF-DFLT-MNT-EXTRACT                                06410011
060971         SET PS-SUB-CL-PASSED TO TRUE                             06420011
060972     ELSE                                                         06430011
060975         IF PV-DEPT-XXX   = IM040-MDSAER-DEPT-NBR AND             06440020
060976            PV-SUB-CL-NBR = IM040-MDSEAR-SUB-CL-NBR               06450011
060977             SET PS-SUB-CL-FOUND TO TRUE                          06460011
060978         ELSE                                                     06470011
060979             IF PV-DEPT-NBR < IM040-MDSAER-DEPT-NBR               06480011
060980                                OR                                06490011
060981                (PV-DEPT-NBR   = IM040-MDSAER-DEPT-NBR AND        06500011
060982                 PV-SUB-CL-NBR < IM040-MDSEAR-SUB-CL-NBR)         06510011
060983                 SET PS-SUB-CL-PASSED TO TRUE                     06520011
060984             END-IF                                               06530011
060985         END-IF                                                   06540011
060992     END-IF.                                                      06550011
060993                                                                  06560011
061000******************************************************************06570010
061100* SELECT THE POS MDSE DESCRIPTION FROM XST_SUB_CL.  IF THE SUB CL 06580010
061200* IS NOT FOUND, WRITE A RECORD TO THE EXCEPTION REPORT.           06590010
061300******************************************************************06600010
061400 4200-GET-POS-DESC.                                               06610010
061500                                                                  06620010
061600     EXEC SQL                                                     06630010
061610         SELECT SUB_CL_NM                                         06640011
061700               ,POS_MDSE_DESC                                     06650011
061800           INTO :XST00014-SUB-CL-NM                               06660011
061810               ,:XST00014-POS-MDSE-DESC                           06670011
061900           FROM XST_SUB_CL                                        06680010
062000          WHERE DEPT_NBR   = :XST00014-DEPT-NBR                   06690010
062100            AND SUB_CL_NBR = :XST00014-SUB-CL-NBR                 06700010
062200     END-EXEC.                                                    06710010
062300                                                                  06720010
062400     EVALUATE SQLCODE                                             06730010
062500         WHEN ZERO                                                06740010
062600             CONTINUE                                             06750010
062700         WHEN +100                                                06760010
062800             MOVE 'SUB CL NOT FOUND' TO XST00014-POS-MDSE-DESC    06770010
062810             MOVE SPACES             TO XST00014-SUB-CL-NM        06780011
063000         WHEN OTHER                                               06790010
063100             DISPLAY 'DEPT NBR = ' XST00014-DEPT-NBR              06800010
063200                     ' SUB CL  = ' XST00014-SUB-CL-NBR            06810014
063300             MOVE '4100-GET-POS-DESC' TO PV-PARAGRAPH-NAME        06820010
063400             MOVE 'ERROR SELECTING FROM XST_SUB_CL'               06830010
063500                                      TO PV-DB2-OPERATION         06840010
063600             PERFORM 9200-SQL-ABEND                               06850010
063700     END-EVALUATE.                                                06860010
063800                                                                  06870010
063900******************************************************************06880000
064000* GET INFORMATION TO CREATE EXCEPTION RECORD                      06890000
064100******************************************************************06900000
064200 5000-SKU-EXCEPTION.                                              06910011
064300                                                                  06920000
064400     MOVE PV-DEPT-XXX            TO DTL1-DEPT-XXX.                06930011
064500     MOVE PV-SUB-CL              TO DTL1-TSK-SUB-CL.              06940011
064600     MOVE PV-SKU-NBR-RE          TO DTL1-SKU-NUMBER.              06950011
064700     MOVE XST00014-POS-MDSE-DESC TO DTL1-MDSECL-POS-DESC.         06960011
064710     MOVE XST00014-SUB-CL-NM     TO DTL1-SUB-CLASS-DESC.          06970011
064720     MOVE 'SKU NOT FOUND.'       TO DTL1-SKU-DESC.                06980019
064730     MOVE PV-DFLT-TX-PRD-CDE     TO DTL1-DEFAULT-PROD-CODE.       06990019
064800                                                                  07000000
064900     IF PV-DEPT-NBR NOT EQUAL XST00015-DEPT-NBR                   07010009
064910        MOVE PV-DEPT-NBR TO XST00015-DEPT-NBR                     07020011
065000        PERFORM 5100-GET-DEPT-NM                                  07030011
065100     END-IF.                                                      07040009
065200                                                                  07050009
065201     MOVE XST00015-DEPT-NM       TO DTL1-DEPT-DESC.               07060011
065202                                                                  07070011
065203     PERFORM 8500-WRITE-REPORT.                                   07080011
065204                                                                  07090011
065205******************************************************************07100011
065206* GET THE DEPARTMENT NAME FROM XST_DEPT                          *07110011
065209******************************************************************07120011
065210 5100-GET-DEPT-NM.                                                07130012
065211                                                                  07140011
065220     EXEC SQL                                                     07150011
065230         SELECT DEPT_NM                                           07160011
065240           INTO :XST00015-DEPT-NM                                 07170014
065250           FROM XST_DEPT                                          07180011
065260          WHERE DEPT_NBR = :XST00015-DEPT-NBR                     07190011
065270     END-EXEC.                                                    07200011
077300                                                                  07210000
077310     EVALUATE SQLCODE                                             07220011
077320         WHEN ZERO                                                07230011
077330             CONTINUE                                             07240011
077340         WHEN +100                                                07250011
077350             MOVE 'DEPT NOT FOUND'    TO XST00015-DEPT-NM         07260014
077370         WHEN OTHER                                               07270011
077380             DISPLAY 'DEPT NBR = ' XST00014-DEPT-NBR              07280011
077391             MOVE '5100-GET-DEPT-NM'  TO PV-PARAGRAPH-NAME        07290012
077392             MOVE 'ERROR SELECTING FROM XST_SUB_CL'               07300011
077393                                      TO PV-DB2-OPERATION         07310011
077394             PERFORM 9200-SQL-ABEND                               07320011
077395     END-EVALUATE.                                                07330011
077396                                                                  07340011
077397 5200-DFLT-PRD-CDE-ERROR.                                         07350014
077398                                                                  07360014
077399     MOVE PV-DEPT-XXX            TO DTL1-DEPT-XXX.                07370014
077400     MOVE PV-SUB-CL              TO DTL1-TSK-SUB-CL.              07380014
077401     MOVE SPACES                 TO DTL1-SKU-NUMBER.              07390019
077402     MOVE XST00014-POS-MDSE-DESC TO DTL1-MDSECL-POS-DESC.         07400014
077403     MOVE XST00014-SUB-CL-NM     TO DTL1-SUB-CLASS-DESC.          07410014
077405     MOVE SPACES                 TO DTL1-DEFAULT-PROD-CODE.       07420019
077406     MOVE 'TAX PROD CDE NOT FOUND'                                07430019
077407                                 TO DTL1-SKU-DESC.                07440019
077408                                                                  07450014
077409     IF PV-DEPT-NBR NOT EQUAL XST00015-DEPT-NBR                   07460014
077410        MOVE PV-DEPT-NBR TO XST00015-DEPT-NBR                     07470014
077411        PERFORM 5100-GET-DEPT-NM                                  07480014
077412     END-IF.                                                      07490014
077413                                                                  07500014
077414     MOVE XST00015-DEPT-NM       TO DTL1-DEPT-DESC.               07510014
077415                                                                  07520014
077416     PERFORM 8500-WRITE-REPORT.                                   07530014
077417                                                                  07540014
077420******************************************************************07550000
077500* 8000-HEADER-ROUTINE-1                                           07560000
077600*     GET CURRENT DATE AND TIME FROM SYSTEM.                      07570000
077700*     FORMAT REPORT FIELDS IN THE TOP PAGE HEADING LINE.          07580000
077800******************************************************************07590000
077900 8000-HEADER-ROUTINE-1.                                           07600000
078000                                                                  07610000
078100     MOVE FUNCTION CURRENT-DATE (1:8) TO PV-CURR-DATE-CCYYMMDD.   07620000
078200     ACCEPT PV-CURR-TIME FROM TIME.                               07630000
078300     ADD +1                           TO PV-PAGE-CNT.             07640000
078400                                                                  07650000
078500     MOVE PV-PAGE-CNT                 TO DP200-PAGE-NUMBER.       07660000
078600     MOVE PV-CURR-DATE-MM             TO DP200-RUN-MONTH.         07670000
078700     MOVE PV-CURR-DATE-DD             TO DP200-RUN-DAY.           07680000
078800     MOVE PV-CURR-DATE-CCYY           TO DP200-RUN-YEAR.          07690000
078900                                                                  07700000
079000     MOVE PV-CURR-TIME-HH             TO DP200-RUN-HOUR.          07710000
079100     MOVE PV-CURR-TIME-MM             TO DP200-RUN-MINUTE.        07720000
079200     MOVE PC-PROGRAM-NAME             TO DP200-PROGRAM-NAME.      07730000
079300     MOVE PC-REPORT-NUMBER            TO DP200-REPORT-NUMBER.     07740000
079400     MOVE DP200-STANDRD-HEADER-200-COLS                           07750000
079500                                      TO PV-PRINT-RECORD.         07760000
079600     PERFORM 8800-WRITE-RPT-TOP-OF-PAGE.                          07770000
079700                                                                  07780000
079800     WRITE PROD-CODE-EXCEPT-REC  FROM RH-HEADER1                  07790000
079900        AFTER ADVANCING 2 LINES.                                  07800000
080000                                                                  07810000
080100     WRITE PROD-CODE-EXCEPT-REC FROM RH-HEADER2                   07820000
080200        AFTER ADVANCING 2 LINES.                                  07830000
080300                                                                  07840000
080400     WRITE PROD-CODE-EXCEPT-REC FROM RH-HEADER3                   07850000
080500        AFTER ADVANCING 1 LINES.                                  07860000
080600                                                                  07870000
080700     WRITE PROD-CODE-EXCEPT-REC FROM RH-HEADER4                   07880000
080800        AFTER ADVANCING 0 LINES.                                  07890000
080900                                                                  07900000
081000     MOVE +5                          TO PV-LINE-CNT.             07910000
081100                                                                  07920000
081200                                                                  07930000
081300*******************************************************           07940000
081400*     WRITE-REPORT FROM DETAIL LINES                              07950000
081500*******************************************************           07960000
081600 8500-WRITE-REPORT.                                               07970000
081700     IF  PV-LINE-CNT GREATER PC-LINE-LIMIT                        07980000
081800         PERFORM 8000-HEADER-ROUTINE-1                            07990000
081900     END-IF.                                                      08000000
082000                                                                  08010000
082100     WRITE PROD-CODE-EXCEPT-REC FROM D1-DETAIL-LINE-1             08020000
082200        AFTER ADVANCING 2 LINES.                                  08030000
082300                                                                  08040000
082400     ADD +1 TO PV-EXCEPTION-CNT.                                  08050000
082500     ADD +2 TO PV-LINE-CNT.                                       08060000
082510                                                                  08070011
082600******************************************************************08080000
082700*     WRITE FIRST REPORT LINE AFTER PAGE BREAK.                   08090000
082800******************************************************************08100000
082900 8800-WRITE-RPT-TOP-OF-PAGE.                                      08110000
083000                                                                  08120000
083100     WRITE PROD-CODE-EXCEPT-REC                                   08130000
083200       FROM PV-PRINT-RECORD                                       08140000
083300         AFTER ADVANCING PAGE.                                    08150000
083400     MOVE +1                          TO PV-LINE-CNT.             08160000
083410                                                                  08170011
083500******************************************************************08180000
083600*  CLOSE ALL FILES.                                              *08190000
083700******************************************************************08200000
083800 9000-EOJ-ROUTINE.                                                08210000
083900                                                                  08220000
084000     IF  PV-LINE-CNT GREATER PC-LINE-LIMIT                        08230000
084100         PERFORM 8000-HEADER-ROUTINE-1                            08240000
084200     END-IF.                                                      08250000
084300                                                                  08260000
084400     WRITE PROD-CODE-EXCEPT-REC FROM D2-DETAIL-LINE-2             08270000
084500        AFTER ADVANCING 2 LINES.                                  08280000
084600                                                                  08290000
084700     CLOSE TAX-EXTRACT-IN-FILE                                    08300000
084800           TAX-EXTRACT-OUT-FILE                                   08310000
084900           DEPT-CL-EXTRACT-FILE                                   08320010
085000           PROD-CODE-EXCEPT-FILE.                                 08330000
085100                                                                  08340000
085200     DISPLAY 'NUMBER OF INPUT RECORDS READ: '                     08350000
085300                                   PV-RECORD-CNT.                 08360000
085400                                                                  08370000
085500     DISPLAY 'NUMBER OF EXCEPTIONS WRITTEN TO REPORT: '           08380000
085600                                   PV-EXCEPTION-CNT.              08390000
085700                                                                  08400000
085800******************************************************************08410000
085900* 9200-SQL-ABEND                                                  08420000
086000*     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.08430000
086100******************************************************************08440000
086200 9200-SQL-ABEND.                                                  08450000
086300                                                                  08460000
086400     DISPLAY '** ABEND        **'.                                08470000
086500     DISPLAY '** PROGRAM      ** = ' PC-PROGRAM-NAME.             08480000
086600     DISPLAY '** PARAGRAPH    ** = ' PV-PARAGRAPH-NAME.           08490000
086700     DISPLAY '** OPERATION    ** = ' PV-DB2-OPERATION.            08500000
086800                                                                  08510000
086900******************************************************************08520000
087000* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     08530000
087100* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      08540000
087200******************************************************************08550000
087300     COPY DPPD004.                                                08560006
087400                                                                  08570000
087500     SET AC-DB2-ERROR TO TRUE.                                    08580000
087600     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         08590000
087700                                                                  08600000
