000100 IDENTIFICATION DIVISION.                                         00010003
000200 PROGRAM-ID.    APKCS326.                                         00020003
000300 AUTHOR.        LORI LIPKE.                                       00030003
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040003
000500 DATE-WRITTEN.  06-94.                                            00050003
000600 DATE-COMPILED.                                                   00060003
000700                                                                  00070003
000800*---------------------------------------------------------------* 00080003
000900*    A326 - ITEM SELECTION LIST                                 * 00090003
001000*                                                               * 00100003
001100*    THIS PROGRAM GENERATES A LIST OF PO LINE ITEMS ASSOCIATED  * 00110003
001200*    WITH A PURCHASE ORDER ON AN INVOICE. THE PROGRAM ALLOWS    * 00120003
001300*    THE SELECTION OF THAT LINE ITEM TO BE PASSED TO THE        * 00130003
001400*    INVOICE ITME LIST/UPDATE.                                  * 00140003
001500*                                                               * 00150003
001600*---------------------------------------------------------------* 00160003
001700*                                                               * 00170003
001800* CHANGE LOG:                                                   * 00180003
001900*                                                               * 00190003
002000* 01/10/95    BMW  CHANGED CURSORS TO DISPLAY ALL PO LINES, NOT * 00200003
002100*                  JUST THOSE THAT HAVE NOT YET BEEN ASSIGNED   * 00210003
002200*                  TO AN INVOICE LINE.                          * 00220003
002300*                                                               * 00230003
002400* 07/17/95    MKK  CHANGED THE RETRIEVAL OF RECEIVING QTY:      * 00240003
002500*                  - ONLY VERIFIED, UNJOURNALIZED RECDIS QTY    * 00250003
002600*                    WILL BE RETRIEVED (FORMERLY, THE VERIFIED  * 00260003
002700*                    STATUS AND THE AP PRC CDE WERE NOT USED    * 00270003
002800*                    AS SELECTION CRITERIA)                     * 00280003
002900*                  - STORE NUMBER WAS ADDED TO THE SELECTION    * 00290003
003000*                    CRITERIA IF THE PO IS INVOICED BY STORE    * 00300003
003100*                  - ADDED NON-INVOICED RECEIPT QUANTITY FOR    * 00310003
003200*                    THE PO LINE TO THE TOTAL QTY RETRIEVED     * 00320003
003300*                    FOR THE PO/PO LINE OR PO/STORE/PO LINE     * 00330003
003400*                    SPECIFIED                                  * 00340003
003500*                  (PARAGRAPHS 4360, 4361, AND 4362)            * 00350003
003600*                                                               * 00360003
003700* 08/21/95    PJK  MOVED THE INVOICE STORE NUMBER FROM THE      * 00370003
003800*                  COMMAREA TO A W/S VARIABLE IN THE 4000-      * 00380003
003900*                  ROUTINE SO THAT THE CORRECT STORE NUMBER IS  * 00390003
004000*                  USED WHEN SORTING VIA THE F23 AND F24 KEYS.  * 00400003
004100*                                                               * 00410003
004200* 01/10/01    MAB  COMMENTED VARIOUS PARTS OF CODE WHERE ERROR  * 00420003
004300*                  MESSAGE 00851 IS USED TO STOP THE USER FROM  * 00430003
004400*                  UPDATING EDI EBTERED INVOICES.  ALSO RELATED * 00440003
004500*                  WAS CODE THAT REFERRED TO THE ENTR-MTHD-CDE  * 00450003
004600*                  BEING EQUAL TO 'ED'.  THIS WAS ALL DONE TO   * 00460003
004700*                  THE USER TO BE ABLE TO DO INVOICE DETAIL     * 00470003
004800*                  MODIFICATIONS SO THAT AP WON'T HAVE TO DO    * 00480003
004900*                  MULTIPLE PAY RELEASES.  THIS WILL CUT DOWN ON* 00490003
005000*                  THE MULTIPLE GENERATED SHORTAGES TO THE      * 00500003
005100*                  VENDOR ALSO.                 WR# 21576       * 00510003
005200*                                                               * 00520003
005300* 12/27/01    MAB  REPLACED THE TSK TABLE WITH TSKXREF AS PART  * 00530004
005400*                  OF RETEK PROJECT PRELIM FOR AP.  (PARA 4340-)* 00540005
005500*                                               WR# 21278       * 00550004
005600*                                                               * 00560004
005700*   5/22/02  RECOMPILED TO PICK UP NEW DCLGENS FOR TINVOIC,     * 00570006
005800*            TMDINVC AND TEXINVC AS PART OF THE ARK PO PHASE ONE* 00580006
005900*            PROJECT.                                           * 00590006
006000*             BY: MIKE BESKE                     WR: 23500      * 00600006
006100*                                                               * 00610006
006200*   6/17/02  MODIFIED SQL ACCESSING TINVOIC TO USE ITS NEW INDEX* 00620010
006300*            PO_NBR/INVC_ID.  PARAGRAPHS 1115-GET-ENTR-METHOD   * 00630010
006400*            AND 5250-UPDATE-TINVOIC WERE AFFECTED.             * 00640010
006500*             BY: NANCY EILBES                   WR: 23500      * 00650010
006600*                                                               * 00660010
006700*  04/18/03  ADDED CODE FOR NI-SKU PROJECT.  REPLACED THE USE OF* 00670016
006800*            DEPT NBR, CLASS AND SKU SEQ NBR BEING DISPLAYED ON * 00680016
006900*            THE LIST SCREEN. NOW EITHER THE SKU FROM TSKXREF OR* 00690016
007000*            THE RMS-PO-SKU-NBR FROM TPURITM WILL BE DISPLAYED. * 00700016
007100*            THE 2 CURSORS WILL HAVE TSKXREF JOINED TO TPURITM. * 00710016
007200*             BY: MIKE BESKE                     WR: 22557      * 00720016
007300*                                                               * 00730016
007400*  06/05/03  MODIFIED CODE FOR NI-SKU PROJECT.                  * 00740020
007500*            HAD TO REMOVE TSKXREF FROM THE 2 CURSORS AND PUT IT* 00750020
007600*            IN A SEPARATE SELECT PARAGRAPH (4320-).  THIS WAS  * 00760021
007700*            DONE BECAUSE IF THE ITM_NBR ON TPURITM = 0 THEN NO * 00770021
007800*            MATCH CAN BE MADE ON TSKXREF.  WITH THE SEPARATE   * 00780021
007900*            PARAGRAPH BEING PERFORMED IN THE FETCH CODE, ZEROES* 00790021
008000*            WILL BE MOVED TO PV-SKU IF THE PURITM-RMS-PO-NBR=0 * 00800021
008100*            AND PURITM-ITM-NBR=0.                              * 00810021
008200*             BY: MIKE BESKE                     WR: 22557      * 00820020
008300*                                                               * 00830020
008400* DATE  01/04/2005                                              * 00840024
008500*     CHANGE MADE: 2005 SUNRISE PROJECT - UPC/EAN EXPANSION.    * 00850023
008600*     IN PARAGRAPH 4340, CHANGED THE STRING STATEMENT TO BEGIN  * 00860022
008700*     AT POSITION 3:2 INSTEAD OF 4:1.  THIS WILL BRING IN 13    * 00870025
008800*     BYTES INSTEAD OF 12 TO ACCOMMODATE EAN-13.                * 00880025
008900*     MADE BY: KEVIN CATLIN            WR/IR #: WR27714         * 00890022
009000*                                                               * 00900022
009010* DATE  03/11/2007                                              * 00901030
009020*     CHANGE MADE: MATCH BY DC PROJECT - ADDED DC LOGIC FOR     * 00902030
009030*     LIST PURPOSES. ADD PARAGRAPH 4363 TO GET DC QUANITIY      * 00903030
009060*     MADE BY: GREG WISIALOWSKI        WR/IR #: WR21578         * 00906030
009070*                                                               * 00907030
009080* DATE  09/01/2021                                                00908031
009090*            - CHANGE CALL OF 'DPKUT100' TO                     * 00909031
009091*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00909131
009092*              MAKING THE CALL DYNAMIC VS STATIC                * 00909231
009093*     MADE BY: GERMAN BANDA            WR/IR #: CHG0261053        00909334
009094*                                                               * 00909437
009095* DATE  05/02/2022                                                00909536
009096*            - CHANGE UPC LOGIC - INSTEAD OF EXCLUDING BY THE   * 00909636
009097*              RANGE OF 400000000000 TO 409999999999, USE THE   * 00909736
009098*              EDI_ORD_IND FIELD (IF 'Y' THEN INCLUDE)          * 00909836
009099*     MADE BY: JEAN KURK               WR/IR #: CHG0268204        00909936
009100*                                                                 00910037
009101* DATE  10/21/2022                                                00910137
009102*     ADD COPYBOOK DPWS930                                        00910237
009103*     CHANGE CICS ARCHITECTURE CALL TO USE DP930-CICS-ARCH-API    00910337
009104*     MADE BY: BOB MCASEY              WR/IR #: CHG0276864        00910437
009110*---------------------------------------------------------------* 00911031
009200                                                                  00920003
009300/                                                                 00930003
009400 ENVIRONMENT DIVISION.                                            00940003
009500                                                                  00950003
009600 DATA DIVISION.                                                   00960003
009700                                                                  00970003
009800 WORKING-STORAGE SECTION.                                         00980003
009900                                                                  00990003
010000 01  DK-DB2-KEYS.                                                 01000003
010100     05  DK-PO-NBR                 PIC S9(9) COMP VALUE +0.       01010003
010200     05  DK-INVOICE-NBR            PIC  X(22)     VALUE SPACES.   01020003
010300     05  DK-ENT-ID                 PIC S9(9) COMP VALUE ZEROS.    01030003
010400     05  DK-DEPT-NBR               PIC  X(3)      VALUE SPACES.   01040003
010500     05  DK-PAYT-REQ-SEQ-NBR       PIC S9(9) COMP VALUE ZEROES.   01050003
010600                                                                  01060003
010700 01  PC-PROGRAM-CONSTANTS.                                        01070003
010800     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         01080003
010900                                                    'AP326A  '.   01090003
011000     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         01100003
011100                                                    'APKM326 '.   01110003
011200     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         01120003
011300                                                    'APKCS326'.   01130003
011400     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +6      01140003
011500                                                    COMP SYNC.    01150003
011600     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      01160003
011700                                                    COMP SYNC.    01170003
011800     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         01180003
011900                                                    +1000000      01190003
012000                                                    COMP-3.       01200003
012100     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      01210003
012200                                                    COMP SYNC.    01220003
012300     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      01230003
012400                                                    COMP-3.       01240003
012500     05  PC-LIST-QUEUE-SEQ              PIC 9(01)  VALUE 1.       01250003
012600     05  PC-SEL-QUEUE-SEQ               PIC 9(01)  VALUE 2.       01260003
012700     05  PC-EACH                        PIC X(02)  VALUE 'EA'.    01270003
012800     05  PC-INVOICE-UNIT-COST           PIC X      VALUE 'I'.     01280003
012900     05  PC-Y-CODE                      PIC X(01)  VALUE 'Y'.     01290003
013000     05  PC-PERCENT                     PIC X(01)  VALUE '%'.     01300003
013100     05  PC-MULTIPLE-UPC                PIC X(15)  VALUE          01310003
013200         'MORE THAN 1 UPC'.                                       01320003
013300     05  PC-NO-VENDOR-UPC               PIC X(15)  VALUE          01330003
013400         'NO VENDOR UPC  '.                                       01340003
013500*    05  PC-MIN-UPC                     PIC S9(15)V               01350035
013600*                                        VALUE +000400000000000   01360035
013700*                                                  COMP-3.        01370035
013800*    05  PC-MAX-UPC                     PIC S9(15)V               01380035
013900*                                        VALUE +000409999999999   01390035
014000*                                                  COMP-3.        01400035
014100     05  PC-TSYMSG-NUMBERS.                                       01410003
014200         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  01420003
014300         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  01430003
014400         10  PC-TSYMSG-00017            PIC  9(05)  VALUE 00017.  01440003
014500         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  01450003
014600         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01460003
014700         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01470003
014800         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01480003
014900         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01490003
015000         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01500003
015100         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01510003
015200         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01520003
015300         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01530003
015400         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01540003
015500         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01550003
015600         10  PC-TSYMSG-00168            PIC  9(05)  VALUE 00168.  01560003
015700         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01570003
015800         10  PC-TSYMSG-00310            PIC  9(05)  VALUE 00310.  01580003
015900         10  PC-TSYMSG-00330            PIC  9(05)  VALUE 00330.  01590003
016000         10  PC-TSYMSG-00461            PIC  9(05)  VALUE 00461.  01600003
016100         10  PC-TSYMSG-00486            PIC  9(05)  VALUE 00486.  01610003
016200         10  PC-TSYMSG-00587            PIC  9(05)  VALUE 00587.  01620003
016300         10  PC-TSYMSG-00588            PIC  9(05)  VALUE 00588.  01630003
016400         10  PC-TSYMSG-00851            PIC  9(05)  VALUE 00851.  01640003
016500                                                                  01650003
016600 01  PS-PROGRAM-SWITCHES.                                         01660003
016700     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01670003
016800         88  PS-NO-ERROR                            VALUE 'Y'.    01680003
016900         88  PS-ERROR                               VALUE 'N'.    01690003
017000     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01700003
017100         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01710003
017200         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01720003
017300     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01730003
017400         88  PS-DONE                                VALUE 'Y'.    01740003
017500         88  PS-NOT-DONE                            VALUE 'N'.    01750003
017600     05  PS-SKIP-SW                     PIC  X(01)  VALUE 'N'.    01760003
017700         88  PS-DONT-SKIP                           VALUE 'N'.    01770003
017800         88  PS-SKIP                                VALUE 'Y'.    01780003
017900     05  PS-DETAILS-ADDED-SW            PIC  X(01)  VALUE 'N'.    01790003
018000         88  PS-NO-DETAILS-ADDED                    VALUE 'N'.    01800003
018100         88  PS-DETAILS-ADDED                       VALUE 'Y'.    01810003
018200     05  PS-FIRST-PREQIT-SW             PIC  X(01)  VALUE 'Y'.    01820003
018300         88  PS-NOT-FIRST-PREQIT                    VALUE 'N'.    01830003
018400         88  PS-FIRST-PREQIT                        VALUE 'Y'.    01840003
018500                                                                  01850003
018600 01  PV-PROGRAM-VARIABLES.                                        01860003
018700     05  PV-SUB                         PIC S9(04)  VALUE +0      01870003
018800                                                    COMP SYNC.    01880003
018900     05  PV-MAX-NBR-NI                  PIC S9(04)  VALUE +0      01890003
019000                                                    COMP.         01900003
019100     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01910003
019200                                                    COMP SYNC.    01920003
019300     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01930003
019400                                                    COMP-3.       01940003
019500     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01950003
019600                                                    COMP-3.       01960003
019700     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01970003
019800                                                    COMP-3.       01980003
019900     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01990003
020000                                                    COMP-3.       02000003
020100     05  PV-MAX-PREQIT-LNE-NBR          PIC S9(9)   VALUE +0      02010003
020200                                                    COMP.         02020003
020300     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      02030003
020400                                                    COMP-3.       02040003
020500     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      02050003
020600                                                    COMP-3.       02060003
020700     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      02070003
020800                                                    COMP-3.       02080003
020900     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      02090003
021000                                                    COMP SYNC.    02100003
021100     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      02110003
021200                                                    COMP SYNC.    02120003
021300     05  PV-ITEM                        PIC S9(04)  VALUE +0      02130003
021400                                                    COMP SYNC.    02140003
021500     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      02150003
021600                                                    COMP SYNC.    02160003
021700     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      02170003
021800                                                    COMP SYNC.    02180003
021900     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      02190003
022000                                                    COMP SYNC.    02200003
022100     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      02210003
022200                                                    COMP SYNC.    02220003
022300     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      02230003
022400                                                    COMP SYNC.    02240003
022500     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02250003
022600                                                    COMP SYNC.    02260003
022700     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02270003
022800                                                    COMP SYNC.    02280003
022900     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      02290003
023000                                                    COMP SYNC.    02300003
023100     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      02310003
023200                                                    COMP SYNC.    02320003
023300     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      02330003
023400                                                    COMP SYNC.    02340003
023500     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      02350003
023600                                                    COMP SYNC.    02360003
023700     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02370003
023800                                                    COMP SYNC.    02380003
023900     05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      02390003
024000                                                    COMP-3.       02400003
024100     05  PV-VER-QTY-NULL                PIC S9(04)  VALUE +0      02410003
024200                                                    COMP SYNC.    02420003
024300     05  PV-NON-INVC-QTY-NULL           PIC S9(04)  VALUE +0      02430003
024400                                                    COMP SYNC.    02440003
024500     05  PV-ASN-QTY-NULL                PIC S9(04)  VALUE +0      02450003
024600                                                    COMP SYNC.    02460003
024700     05  PV-ALLOC-NULL                  PIC S9(04)  VALUE +0      02470003
024800                                                    COMP SYNC.    02480003
024900     05  PV-ALLOC-ALLPLN-NULL           PIC S9(04)  VALUE +0      02490003
025000                                                    COMP SYNC.    02500003
025100     05  PV-PO-LNE-NBR                  PIC S9(09)  VALUE +0      02510003
025200                                                    COMP.         02520003
025300     05  PV-ASN-PO-LN-NBR               PIC S9(03)V VALUE +0      02530003
025400                                                    COMP-3.       02540003
025500     05  PV-ASN-PO-NBR                  PIC X(22)   VALUE SPACES. 02550003
025600     05  PV-PO-NBR9                     PIC 9(10)   VALUE ZEROES. 02560003
025700     05  PV-UPC-NBR                     PIC 9(15).                02570003
025800     05  PV-UPC-NBR-X REDEFINES PV-UPC-NBR                        02580003
025900                                        PIC X(15).                02590003
026000     05  PV-STORE-NBR                   PIC S9(4)   VALUE ZEROES  02600003
026100                                                    COMP.         02610003
026110     05  PV-DC-NBR                      PIC S9(4)   VALUE ZEROES  02611026
026120                                                    COMP.         02612026
026130     05  PV-MTCH-LVL-CDE                PIC X       VALUE SPACES. 02613028
026200     05  PV-UPC-NBR-DISPLAY             PIC X(16)   VALUE SPACES. 02620003
026300     05  PV-AD-DATE-10.                                           02630003
026400         10  PV-AD-DATE-CC              PIC X(02).                02640012
026500         10  PV-AD-DATE.                                          02650003
026600             15  PV-AD-DATE-YY          PIC X(02).                02660012
026700             15  FILLER                 PIC X(01)    VALUE '-'.   02670012
026800             15  PV-AD-DATE-MM          PIC X(02).                02680012
026900             15  FILLER                 PIC X(01)    VALUE '-'.   02690012
027000             15  PV-AD-DATE-DD          PIC X(02).                02700012
027100     05  PV-SLASH-DATE.                                           02710003
027200         10  PV-SL-DATE.                                          02720003
027300             15  PV-SL-DATE-MM          PIC X(02).                02730012
027400             15  FILLER                 PIC X(01)    VALUE '/'.   02740012
027500             15  PV-SL-DATE-DD          PIC X(02).                02750012
027600             15  FILLER                 PIC X(01)    VALUE '/'.   02760012
027700             15  PV-SL-DATE-YY          PIC X(02).                02770012
027800         10  PV-SL-DATE-CC              PIC X(02).                02780012
027900     05  PV-SKU-NBR                     PIC X(08)   VALUE SPACES. 02790012
028000                                                                  02800003
028100*---------------------------------------------------------------* 02810003
028200*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 02820003
028300*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 02830003
028400*   APPLICATION-SPECIFIC COMMAREA.                              * 02840003
028500*---------------------------------------------------------------* 02850003
028600 01  LQW-LIST-QUEUE-WORK-AREA.                                    02860003
028700     05  LQW-BLOCK-MODIFIED             PIC X(01)   VALUE SPACE.  02870003
028800     05  LQW-ITEM-ENTRIES               OCCURS 6 TIMES            02880003
028900                                        INDEXED BY LQW-IDX.       02890003
029000         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02900003
029100         10  LQW-TEMP-SELECTED-SW       PIC X(01).                02910003
029200         10  LQW-SELECTED-SW            PIC X(01).                02920003
029300             88  LQW-SELECT                         VALUE 'S'.    02930003
029400             88  LQW-DESELECT                       VALUE ' '.    02940003
029500         10  LQW-PO-LNE-NBR             PIC 9(04).                02950003
029600         10  LQW-APP-PO-LNE-NBR         PIC 9(04).                02960003
029700         10  LQW-PO-LNE-VAR-NBR         PIC 9(04).                02970003
029800         10  LQW-SKU-NBR                PIC X(08).                02980012
029900         10  LQW-VEND-STYL-NAME         PIC X(20).                02990003
030000         10  LQW-COLOR-CODE             PIC X(03).                03000003
030100         10  LQW-SIZE-CODE              PIC X(05).                03010003
030200         10  LQW-QTY-RCVD               PIC 9(07).                03020003
030300         10  LQW-UPC                    PIC X(16).                03030003
030400         10  LQW-SKU-DESC               PIC X(24).                03040003
030500         10  LQW-COLOR                  PIC X(10).                03050003
030600         10  LQW-SIZE                   PIC X(10).                03060003
030700                                                                  03070003
030800/                                                                 03080003
030900*---------------------------------------------------------------* 03090003
031000*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 03100003
031100*---------------------------------------------------------------* 03110003
031200                                                                  03120003
031300     COPY APWS301.                                                03130003
031400                                                                  03140003
031500/                                                                 03150003
031600*---------------------------------------------------------------* 03160003
031700*    MAP LAYOUT                                                 * 03170003
031800*---------------------------------------------------------------* 03180003
031900                                                                  03190003
032000     COPY APKM326.                                                03200003
032100                                                                  03210003
032200 01  MR-OCCURS-LAYOUT                   REDEFINES  AP326AO.       03220003
032300     05  FILLER                         PIC X(53).                03230003
032400                                                                  03240003
032500     05  MR-INVOICE-NBR-X               PIC X(22).                03250003
032600                                                                  03260003
032700     05  FILLER                         PIC X(05).                03270003
032800     05  MR-PO-NBR-X.                                             03280003
032900         10 MR-PO-NBR                   PIC Z(9).                 03290003
033000                                                                  03300003
033100     05  FILLER                         PIC X(05).                03310003
033200     05  MR-VENDOR-NAME                 PIC X(10).                03320003
033300                                                                  03330003
033400                                                                  03340003
033500     05  MR-SCROLL-AREA                 OCCURS 6 TIMES.           03350003
033600         10  MR-SELECTL                 PIC S9(04) COMP.          03360003
033700         10  MR-SELECTA                 PIC X(01).                03370003
033800         10  MR-SELECTC                 PIC X(01).                03380003
033900         10  MR-SELECTH                 PIC X(01).                03390003
034000         10  MR-SELECT                  PIC X(01).                03400003
034100                                                                  03410003
034200         10  FILLER                     PIC X(05).                03420003
034300         10  MR-PO-LNE-NBR-X.                                     03430003
034400             15  MR-PO-LNE-NBR          PIC ZZZZ.                 03440003
034500                                                                  03450003
034600         10  FILLER                     PIC X(05).                03460003
034700         10  MR-SKU-NBR                 PIC X(08).                03470012
034800                                                                  03480003
034900         10  FILLER                     PIC X(05).                03490003
035000         10  MR-VEND-STYL-NAME          PIC X(20).                03500003
035100                                                                  03510003
035200         10  FILLER                     PIC X(05).                03520003
035300         10  MR-COLOR-CODE              PIC X(03).                03530003
035400                                                                  03540003
035500         10  FILLER                     PIC X(05).                03550003
035600         10  MR-SIZE-CODE               PIC X(05).                03560003
035700                                                                  03570003
035800         10  FILLER                     PIC X(05).                03580003
035900         10  MR-RCVD-QTY-X.                                       03590003
036000             15  MR-RCVD-QTY            PIC Z(7).                 03600003
036100         10  FILLER                     PIC X(05).                03610003
036200         10  MR-UPC                     PIC X(16).                03620003
036300         10  FILLER                     PIC X(05).                03630003
036400         10  MR-SKU-DESC                PIC X(24).                03640003
036500         10  FILLER                     PIC X(05).                03650003
036600         10  MR-COLOR                   PIC X(10).                03660003
036700         10  FILLER                     PIC X(05).                03670003
036800         10  MR-SIZE                    PIC X(10).                03680003
036900                                                                  03690003
037000/                                                                 03700003
037100*---------------------------------------------------------------* 03710003
037200*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03720003
037300*---------------------------------------------------------------* 03730003
037400                                                                  03740003
037500     COPY DPWS015.                                                03750003
037600                                                                  03760003
037700*---------------------------------------------------------------* 03770003
037800*    FUNCTION KEYS COPYBOOK.                                    * 03780003
037900*---------------------------------------------------------------* 03790003
038000                                                                  03800003
038100     COPY DPWS016.                                                03810003
038200                                                                  03820003
038300*---------------------------------------------------------------* 03830003
038400*    NUMERIC EDIT LAYOUT.                                       * 03840003
038500*---------------------------------------------------------------* 03850003
038600                                                                  03860003
038700     COPY DPWS010I.                                               03870003
038800                                                                  03880003
038900/                                                                 03890003
039000*---------------------------------------------------------------* 03900003
039100*    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   * 03910003
039200*---------------------------------------------------------------* 03920003
039300                                                                  03930003
039400     COPY DPWS030.                                                03940003
039410     COPY DPWS930.                                                03941037
039500                                                                  03950003
039600/                                                                 03960003
039700*---------------------------------------------------------------* 03970003
039800*    STANDARD COMMAREA.                                         * 03980003
039900*---------------------------------------------------------------* 03990003
040000                                                                  04000003
040100     COPY DPWS020.                                                04010003
040200     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04020003
040300                                                                  04030003
040400*---------------------------------------------------------------* 04040003
040500* INTER-APPLICATION COMMAREA.                                   * 04050003
040600*---------------------------------------------------------------* 04060003
040700                                                                  04070003
040800         10  INTER-APPL-COMM-AREA       PIC X(200).               04080003
040900     COPY APWS300.                                                04090003
041000*---------------------------------------------------------------* 04100003
041100*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 04110003
041200*---------------------------------------------------------------* 04120003
041300         10  ASC-SPECIFIC-COMMAREA.                               04130003
041400             15  ASC-LIST-KEYS.                                   04140003
041500                 20  ASC-KEY-PO-NBR        PIC S9(9) COMP.        04150003
041600                 20  ASC-KEY-DEPT-NBR      PIC  X(3).             04160003
041700                 20  ASC-KEY-INVOICE-NBR   PIC  X(22).            04170003
041800                 20  ASC-KEY-VENDOR-NAME   PIC  X(10).            04180003
041900                 20  ASC-KEY-PAYT-REC-SEQ-NBR                     04190003
042000                                           PIC S9(9) COMP.        04200003
042100                 20  ASC-KEY-ENTR-MTHD-CDE PIC  X(2).             04210003
042200             15  ASC-BLOCK-ENTRIES      OCCURS 2 TIMES.           04220003
042300                 20  ASC-BLOCK-MODIFIED-SW                        04230003
042400                                        PIC X(01).                04240003
042500                     88  ASC-BLOCK-NOT-MODIFIED    VALUE 'N'.     04250003
042600                     88  ASC-BLOCK-MODIFIED        VALUE 'Y'.     04260003
042700                                                                  04270003
042800                 20  ASC-ITEM-ARRAY.                              04280003
042900                     25  ASC-ITEM-ENTRIES OCCURS 6 TIMES.         04290003
043000                         30  ASC-LIST-ITEM-NUMBER                 04300003
043100                                        PIC S9(09) COMP-3.        04310003
043200                         30  ASC-TEMP-SELECTED-SW                 04320003
043300                                        PIC X(01).                04330003
043400                             88  ASC-VALID-SELECT  VALUE ' '      04340003
043500                                                         'S'      04350003
043600                                                         'B'      04360003
043700                                                         'E'.     04370003
043800                             88  ASC-TEMP-NO-SELECT               04380003
043900                                                   VALUE ' '.     04390003
044000                             88  ASC-TEMP-SELECT   VALUE 'S'.     04400003
044100                             88  ASC-TEMP-BEGIN    VALUE 'B'.     04410003
044200                             88  ASC-TEMP-END      VALUE 'E'.     04420003
044300                         30  ASC-SELECTED-SW                      04430003
044400                                        PIC X(01).                04440003
044500                             88  ASC-NO-SELECT     VALUE ' '.     04450003
044600                             88  ASC-SELECT        VALUE 'S'.     04460003
044700                             88  ASC-BEGIN         VALUE 'B'.     04470003
044800                             88  ASC-END           VALUE 'E'.     04480003
044900                         30  ASC-PO-LNE-NBR      PIC 9(04).       04490003
045000                         30  ASC-APP-PO-LNE-NBR  PIC 9(04).       04500003
045100                         30  ASC-PO-LNE-VAR-NBR  PIC 9(04).       04510003
045200                         30  ASC-SKU-NBR         PIC X(08).       04520012
045300                         30  ASC-VEND-STYL-NAME  PIC X(20).       04530003
045400                         30  ASC-COLOR-CODE      PIC X(03).       04540003
045500                         30  ASC-SIZE-CODE       PIC X(05).       04550003
045600                         30  ASC-QTY-RCVD        PIC 9(07).       04560003
045700                         30  ASC-UPC             PIC X(16).       04570003
045800                         30  ASC-SKU-DESC        PIC X(24).       04580003
045900                         30  ASC-COLOR           PIC X(10).       04590003
046000                         30  ASC-SIZE            PIC X(10).       04600003
046100                                                                  04610003
046200             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     04620003
046300             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     04630003
046400             15  ASC-NUMBER-OF-ITEMS-READ                         04640003
046500                                        PIC S9(09) COMP-3.        04650003
046600             15  ASC-NUMBER-OF-SELECTED-ITEMS                     04660003
046700                                        PIC S9(09) COMP-3.        04670003
046800             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        04680003
046900             15  ASC-ITEM-AT-TOP-OF-PANEL                         04690003
047000                                        PIC S9(09) COMP-3.        04700003
047100             15  ASC-ITEM-AT-BOT-OF-PANEL                         04710003
047200                                        PIC S9(09) COMP-3.        04720003
047300             15  ASC-HIGHEST-BLOCK-WRITTEN                        04730003
047400                                        PIC S9(04) COMP SYNC.     04740003
047500             15  ASC-START-OF-SELECTED-RANGE                      04750003
047600                                        PIC S9(09) COMP-3.        04760003
047700             15  ASC-END-OF-SELECTED-RANGE                        04770003
047800                                        PIC S9(09) COMP-3.        04780003
047900             15  ASC-ITEMS-LEFT-INDICATOR                         04790003
048000                                        PIC X(01).                04800003
048100                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     04810003
048200                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     04820003
048300             15  ASC-TEMP-QUEUE-UPDATE-SW                         04830003
048400                                        PIC X(01).                04840003
048500                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     04850003
048600                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     04860003
048700             15  ASC-LIST-QUEUE-NAME.                             04870003
048800                 20  ASC-LIST-TERM-ID   PIC X(04).                04880003
048900                 20  ASC-LIST-TASK-NUMBER                         04890003
049000                                        PIC S9(05) COMP-3.        04900003
049100                 20  ASC-LIST-SEQ       PIC 9(01).                04910003
049200             15  ASC-SEL-QUEUE-NAME.                              04920003
049300                 20  ASC-SEL-TERM-ID    PIC X(04).                04930003
049400                 20  ASC-SEL-TASK-NUMBER                          04940003
049500                                        PIC S9(05) COMP-3.        04950003
049600                 20  ASC-SEL-SEQ        PIC 9(01).                04960003
049700                                                                  04970003
049800             15  ASC-APPROVAL-SW        PIC X(01).                04980003
049900                 88  ASC-APPROVED                  VALUE 'Y'.     04990003
050000                 88  ASC-NOT-APPROVED              VALUE 'N'.     05000003
050100             15  ASC-CURSOR-SW          PIC X(01).                05010003
050200                 88  ASC-NO-CURSOR                 VALUE 'N'.     05020003
050300                 88  ASC-ITEM-CURSOR               VALUE 'I'.     05030003
050400                 88  ASC-VEND-STYLE-CURSOR         VALUE 'V'.     05040003
050500             15  ASC-START-ITEM-REQUEST.                          05050003
050600                 20  ASC-START-ITEM-REQUEST-N                     05060003
050700                                        PIC 9(07).                05070003
050800/                                                                 05080003
050900*---------------------------------------------------------------* 05090003
051000*    ABEND PROCESSING COPYBOOK.                                 * 05100003
051100*---------------------------------------------------------------* 05110003
051200                                                                  05120003
051300     COPY DPWS013.                                                05130003
051400                                                                  05140003
051500/                                                                 05150003
051600*---------------------------------------------------------------* 05160003
051700*    DB2 AREA FOR THE PURCHASE ORDER TABLE                      * 05170003
051800*---------------------------------------------------------------* 05180003
051900     EXEC SQL                                                     05190003
052000          INCLUDE TPURCHS                                         05200003
052100     END-EXEC.                                                    05210003
052200                                                                  05220003
052300/                                                                 05230003
052400*---------------------------------------------------------------* 05240003
052500*    DB2 AREA FOR THE PURCHASE ORDER LINE ITEM TABLE            * 05250003
052600*---------------------------------------------------------------* 05260003
052700     EXEC SQL                                                     05270003
052800          INCLUDE TPURITM                                         05280003
052900     END-EXEC.                                                    05290003
053000     EXEC SQL                                                     05300003
053100          INCLUDE TPREQIT                                         05310003
053200     END-EXEC.                                                    05320003
053300/                                                                 05330003
053400*---------------------------------------------------------------* 05340003
053500*    DB2 AREA FOR THE ENTERPRISE NAME TABLE                     * 05350003
053600*---------------------------------------------------------------* 05360003
053700     EXEC SQL                                                     05370003
053800          INCLUDE TENTNME                                         05380003
053900     END-EXEC.                                                    05390003
054000/                                                                 05400003
054100*---------------------------------------------------------------* 05410003
054200*    DB2 AREA FOR THE MERCHANDISE INVOICE ITEM TABLE            * 05420003
054300*---------------------------------------------------------------* 05430003
054400     EXEC SQL                                                     05440003
054500          INCLUDE TMIITEM                                         05450003
054600     END-EXEC.                                                    05460003
054700/                                                                 05470003
054800*---------------------------------------------------------------* 05480003
054900*    DB2 AREA FOR THE A/P INVOICE TABLE                         * 05490003
055000*---------------------------------------------------------------* 05500003
055100     EXEC SQL                                                     05510003
055200          INCLUDE TINVOIC                                         05520003
055300     END-EXEC.                                                    05530003
055400                                                                  05540003
055500/                                                                 05550003
055600*---------------------------------------------------------------* 05560003
055700*    DB2 AREA FOR THE RECEIVING TABLE                           * 05570003
055800*---------------------------------------------------------------* 05580003
055900     EXEC SQL                                                     05590003
056000          INCLUDE TRECEIV                                         05600003
056100     END-EXEC.                                                    05610003
056200                                                                  05620003
056300/                                                                 05630003
056400*---------------------------------------------------------------* 05640003
056500*    DB2 AREA FOR THE RECEIVING DISTRIBUTION TABLE              * 05650003
056600*---------------------------------------------------------------* 05660003
056700     EXEC SQL                                                     05670003
056800          INCLUDE TRECDIS                                         05680003
056900     END-EXEC.                                                    05690003
057000                                                                  05700003
057100/                                                                 05710003
057200*---------------------------------------------------------------* 05720003
057300*    DB2 AREA FOR THE NON-INVOICED RECEIPT TABLE                * 05730003
057400*---------------------------------------------------------------* 05740003
057500     EXEC SQL                                                     05750003
057600          INCLUDE TNINREC                                         05760003
057700     END-EXEC.                                                    05770003
057800                                                                  05780003
057900/                                                                 05790003
058000*---------------------------------------------------------------* 05800003
058100*    DB2 AREA FOR THE SKU CROSS REFERENCE TABLE                 * 05810004
058200*---------------------------------------------------------------* 05820003
058300     EXEC SQL                                                     05830003
058400          INCLUDE TSKXREF                                         05840004
058500     END-EXEC.                                                    05850003
058600                                                                  05860003
058700/                                                                 05870003
058800*---------------------------------------------------------------* 05880003
058900*    DB2 AREA FOR THE UPC SKU TABLE                             * 05890003
059000*---------------------------------------------------------------* 05900003
059100     EXEC SQL                                                     05910003
059200          INCLUDE TUPCSKU                                         05920003
059300     END-EXEC.                                                    05930003
059400                                                                  05940003
059500*---------------------------------------------------------------* 05950003
059600*    DB2 AREA FOR COMMUNICATIONS                                * 05960003
059700*---------------------------------------------------------------* 05970003
059800     EXEC SQL                                                     05980003
059900          INCLUDE SQLCA                                           05990003
060000     END-EXEC.                                                    06000003
060100                                                                  06010003
060200/                                                                 06020003
060300*---------------------------------------------------------------* 06030003
060400*  CURSOR TO SELECT LINE ITEMS WHEN PO IS NOT APPROVED          * 06040003
060500*---------------------------------------------------------------* 06050003
060600                                                                  06060003
060700*---------------------------------------------------------------* 06070003
060800*  CURSOR TO SELECT LINE ITEMS WHEN PO IS APPROVED              * 06080003
060900*---------------------------------------------------------------* 06090003
061000                                                                  06100003
061100     EXEC SQL                                                     06110003
061200          DECLARE VEND-STYLE-CSR CURSOR FOR                       06120003
061300          SELECT A.PO_LNE_NBR                                     06130012
061400                ,A.APP_PO_LNE_NBR                                 06140012
061500                ,A.CL_NBR                                         06150012
061600                ,A.SKU_SEQ_NBR                                    06160012
061700                ,A.VEND_STYL_NAME                                 06170012
061800                ,A.SKU_DESC                                       06180012
061900                ,A.UNT_QTY                                        06190012
062000                ,A.COLOR_CDE                                      06200012
062100                ,A.COLOR_DESC                                     06210012
062200                ,A.SIZE_CDE                                       06220012
062300                ,A.SIZE_DESC                                      06230012
062400                ,A.ITM_NBR                                        06240012
062500                ,A.RMS_PO_SKU_NBR                                 06250012
062600            FROM TPURITM A                                        06260012
062700          WHERE A.PO_NBR         = :DK-PO-NBR                     06270019
062800            AND A.VER_STATUS_CDE = 'A'                            06280012
062900          ORDER BY                                                06290012
063000                A.VEND_STYL_NAME, A.CL_NBR, A.SKU_SEQ_NBR         06300012
063100     END-EXEC.                                                    06310012
063200                                                                  06320012
063300*** REMOVED FROM CALL ABOVE SO THAT ALL PO LINES WILL DISPLAY     06330012
063400***         AND PO_LNE_NBR NOT IN                                 06340012
063500***           (SELECT VALUE(M.PO_LNE_NBR,+0)                      06350012
063600***            FROM TMIITEM M,                                    06360012
063700***                 TINVOIC I                                     06370012
063800***              WHERE I.PAYT_REQ_SEQ_NBR                         06380012
063900***                          = M.PAYT_REQ_SEQ_NBR                 06390012
064000***              AND M.PO_NBR = :DK-PO-NBR                        06400012
064100***              AND I.INVC_ID= :DK-INVOICE-NBR)                  06410012
064200                                                                  06420012
064300/                                                                 06430012
064400*---------------------------------------------------------------* 06440012
064500*  CURSOR TO SELECT LINE ITEMS WHEN PO IS APPROVED              * 06450012
064600*---------------------------------------------------------------* 06460012
064700                                                                  06470012
064800     EXEC SQL                                                     06480012
064900          DECLARE ITEM-CSR CURSOR FOR                             06490012
065000          SELECT A.PO_LNE_NBR                                     06500012
065100                ,A.APP_PO_LNE_NBR                                 06510012
065200                ,A.CL_NBR                                         06520012
065300                ,A.SKU_SEQ_NBR                                    06530012
065400                ,A.VEND_STYL_NAME                                 06540012
065500                ,A.SKU_DESC                                       06550012
065600                ,A.UNT_QTY                                        06560012
065700                ,A.COLOR_CDE                                      06570012
065800                ,A.COLOR_DESC                                     06580012
065900                ,A.SIZE_CDE                                       06590012
066000                ,A.SIZE_DESC                                      06600012
066100                ,A.ITM_NBR                                        06610012
066200                ,A.RMS_PO_SKU_NBR                                 06620012
066300            FROM TPURITM A                                        06630012
066400          WHERE A.PO_NBR         = :DK-PO-NBR                     06640019
066500            AND A.VER_STATUS_CDE = 'A'                            06650012
066600          ORDER BY                                                06660012
066700                A.PO_LNE_NBR                                      06670012
066800     END-EXEC.                                                    06680012
066900***         AND PO_LNE_NBR NOT IN                                 06690012
067000***           (SELECT VALUE(M.PO_LNE_NBR,+0)                      06700012
067100***            FROM TMIITEM M,                                    06710012
067200***                 TINVOIC I                                     06720012
067300***              WHERE I.PAYT_REQ_SEQ_NBR                         06730012
067400***                          = M.PAYT_REQ_SEQ_NBR                 06740012
067500***              AND M.PO_NBR = :DK-PO-NBR                        06750012
067600***              AND I.INVC_ID= :DK-INVOICE-NBR)                  06760012
067700                                                                  06770012
067800/                                                                 06780012
067900 LINKAGE SECTION.                                                 06790012
068000                                                                  06800012
068100 01  DFHCOMMAREA.                                                 06810012
068200     05  FILLER                         OCCURS  1 TO 4072 TIMES   06820012
068300                                        DEPENDING ON EIBCALEN.    06830012
068400         10  FILLER                     PIC X.                    06840012
068500                                                                  06850012
068600/                                                                 06860012
068700 PROCEDURE DIVISION.                                              06870012
068800*---------------------------------------------------------------* 06880012
068900*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 06890012
069000*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 06900012
069100*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 06910012
069200*---------------------------------------------------------------* 06920012
069300 0000-MAIN-MODULE.                                                06930012
069400                                                                  06940012
069500     INITIALIZE DP030-CICS-API-FIELDS.                            06950012
069600                                                                  06960012
069700     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       06970012
069800     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          06980012
069900     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         06990012
070000                                                                  07000012
070100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       07010012
070200                                                                  07020012
070300     MOVE LENGTH OF AP326AI        TO DP030-MAP-LENGTH (1).       07030012
070400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     07040012
070500                                                                  07050012
070600     PERFORM 0001-CALL-CICS-ARCH-API.                             07060012
070700     PERFORM 1000-CONTROL-PROCESSING                              07070012
070800                                                                  07080012
070900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     07090012
071000     PERFORM 0001-CALL-CICS-ARCH-API.                             07100012
071100                                                                  07110012
071200*---------------------------------------------------------------* 07120012
071300*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 07130012
071400*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 07140012
071500*---------------------------------------------------------------* 07150012
071600 0001-CALL-CICS-ARCH-API.                                         07160012
071700     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      07170037
071800                                    DFHCOMMAREA                   07180037
071900                                    DP030-CICS-API-FIELDS         07190037
072000                                    DP020-STANDARD-COMMAREA       07200037
072100                                    AP326AI.                      07210037
072200                                                                  07220012
072300     IF  DP030-RC-CALL-SUCCESSFUL                                 07230012
072400         CONTINUE                                                 07240012
072500     ELSE                                                         07250012
072600         SET DP013-NO-ROLLBACK                                    07260012
072700             DP013-XCTL-DISPLAY-RESTART                           07270012
072800             DP013-CICS-ABEND      TO TRUE                        07280012
072900         MOVE '0001-CALL-CICS-ARCH-API'                           07290012
073000                                   TO DP013-PARAGRAPH             07300012
073210         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O07321037
073220-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      07322037
073300         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      07330012
073400         PERFORM DP013-0000-PROCESS-ABEND                         07340012
073500     END-IF.                                                      07350012
073600                                                                  07360012
073700*----------------------------------------------------------------*07370012
073800* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *07380012
073900* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *07390012
074000*                                                                *07400012
074100* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *07410012
074200*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *07420012
074300*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *07430012
074400*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *07440012
074500*----------------------------------------------------------------*07450012
074600                                                                  07460012
074700 1000-CONTROL-PROCESSING.                                         07470012
074800                                                                  07480012
074900     EVALUATE TRUE                                                07490012
075000         WHEN DP020-NEXT-ACT-INITIAL                              07500012
075100             INITIALIZE ASC-SPECIFIC-COMMAREA                     07510012
075200             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            07520012
075300                                      ASC-SEL-TERM-ID             07530012
075400             MOVE DP020-SRC-TASK-NUMBER                           07540012
075500                                   TO ASC-LIST-TASK-NUMBER        07550012
075600                                      ASC-SEL-TASK-NUMBER         07560012
075700             MOVE PC-LIST-QUEUE-SEQ                               07570012
075800                                   TO ASC-LIST-SEQ                07580012
075900             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 07590012
076000             PERFORM 1100-PROCESS-INTER-APPL-COMM                 07600012
076100             IF  PS-COMMAREA-NOT-VALID                            07610012
076200                 SET DP020-NEXT-ACT-APPL-ERROR                    07620012
076300                                   TO TRUE                        07630012
076400             ELSE                                                 07640012
076500                 PERFORM 4000-BUILD-INITIAL-PANEL                 07650012
076600             END-IF                                               07660012
076700                                                                  07670012
076800         WHEN DP020-NEXT-ACT-READ-MAP                             07680012
076900             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        07690012
077000                                   TO PV-TOP-ITEM                 07700012
077100             PERFORM 2000-PROCESS-PANEL                           07710012
077200                                                                  07720012
077300         WHEN DP020-NEXT-ACT-RETURN                               07730012
077400             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        07740012
077500                                   TO PV-TOP-ITEM                 07750012
077600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07760012
077700             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 07770012
077800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07780012
077900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07790012
078000                                                                  07800012
078100         WHEN OTHER                                               07810012
078200             SET DP013-LOGIC-ABEND TO TRUE                        07820012
078300             SET DP013-NO-ROLLBACK TO TRUE                        07830012
078400             MOVE '1000-CONTROL-PROCESSING'                       07840012
078500                                   TO DP013-PARAGRAPH             07850012
078600             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    07860012
078700                                   TO DP013-MESSAGE-TEXT(1)       07870012
078800             PERFORM DP013-0000-PROCESS-ABEND                     07880012
078900     END-EVALUATE.                                                07890012
079000                                                                  07900012
079100/                                                                 07910012
079200*----------------------------------------------------------------*07920012
079300* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *07930012
079400*----------------------------------------------------------------*07940012
079500                                                                  07950012
079600 1100-PROCESS-INTER-APPL-COMM.                                    07960012
079700                                                                  07970012
079800     SET PS-COMMAREA-VALID         TO TRUE.                       07980012
079900     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     07990012
080000                                                                  08000012
080100     IF  AP300-PO-NBR = ZEROES                                    08010012
080200         MOVE PC-TSYMSG-00461    TO DP020-MSG-NUMBER              08020012
080300         SET PS-ERROR                                             08030012
080400             PS-COMMAREA-NOT-VALID                                08040012
080500             DP020-NEXT-ACT-APPL-ERROR                            08050012
080600             DP020-MSG-FATAL     TO TRUE                          08060012
080700     ELSE                                                         08070012
080800         MOVE AP300-PO-NBR       TO ASC-KEY-PO-NBR                08080012
080900                                    DK-PO-NBR                     08090012
081000         MOVE AP300-INVC-ID      TO ASC-KEY-INVOICE-NBR           08100012
081100                                    DK-INVOICE-NBR                08110012
081200         MOVE AP300-REC-SEQ-NBR  TO DK-PAYT-REQ-SEQ-NBR           08120012
081300                                    ASC-KEY-PAYT-REC-SEQ-NBR      08130012
081400         PERFORM 1115-GET-ENTR-METHOD                             08140012
081500         MOVE INVOIC-ENTR-MTHD-CDE TO ASC-KEY-ENTR-MTHD-CDE       08150012
081600*        IF INVOIC-ENTR-MTHD-CDE = 'ED'                           08160012
081700*                                                                 08170012
081800*            MOVE PC-TSYMSG-00851 TO DP020-MSG-NUMBER             08180012
081900*            SET PS-ERROR                                         08190012
082000*                DP020-MSG-WARNING  TO TRUE                       08200012
082100*        END-IF                                                   08210012
082200         PERFORM 1110-GET-PO-INFO                                 08220012
082300         IF PURCHS-STATUS-CDE = 'WK' OR 'PA' OR 'RJ' OR 'RS'      08230012
082400                                      OR 'FE'                     08240012
082500             SET ASC-ITEM-CURSOR                                  08250012
082600                 ASC-NOT-APPROVED                                 08260012
082700                                 TO TRUE                          08270012
082800         ELSE                                                     08280012
082900             SET ASC-VEND-STYLE-CURSOR                            08290012
083000                 ASC-APPROVED                                     08300012
083100                                 TO TRUE                          08310012
083200                                                                  08320012
083300         END-IF                                                   08330012
083400         PERFORM 1120-GET-PRIMARY-ENT-NAME-DESC                   08340012
083500     END-IF.                                                      08350012
083600                                                                  08360012
083700/                                                                 08370012
083800*----------------------------------------------------------------*08380012
083900*    READ PURCHASE ORDER HEADER                                  *08390012
084000*----------------------------------------------------------------*08400012
084100 1110-GET-PO-INFO.                                                08410012
084200                                                                  08420012
084300     PERFORM                                                      08430012
084400         WITH TEST AFTER                                          08440012
084500         VARYING PV-RETRY-COUNTER                                 08450012
084600         FROM 1 BY 1                                              08460012
084700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08470012
084800             OR (SQLCODE = +0))                                   08480012
084900                                                                  08490012
085000         EXEC SQL                                                 08500012
085100              SELECT DEPT_NBR                                     08510012
085200                    ,ENT_ID                                       08520012
085300                INTO :PURCHS-DEPT-NBR                             08530012
085400                    ,:PURCHS-ENT-ID                               08540012
085500                FROM TPURCHS                                      08550012
085600               WHERE PO_NBR         = :DK-PO-NBR                  08560012
085700                 AND VER_STATUS_CDE = 'A'                         08570012
085800         END-EXEC                                                 08580012
085900                                                                  08590012
086000         EVALUATE TRUE                                            08600012
086100             WHEN SQLCODE = +0                                    08610012
086200                  MOVE PURCHS-DEPT-NBR                            08620012
086300                                 TO DK-DEPT-NBR                   08630012
086400                                    ASC-KEY-DEPT-NBR              08640012
086500                  MOVE PURCHS-ENT-ID                              08650012
086600                                 TO DK-ENT-ID                     08660012
086700                                                                  08670012
086800             WHEN SQLCODE = -904                                  08680012
086900             WHEN SQLCODE = -913                                  08690012
087000                  CONTINUE                                        08700012
087100                                                                  08710012
087200             WHEN SQLWARN0 NOT = SPACES                           08720012
087300             WHEN SQLCODE < +0                                    08730012
087400             WHEN SQLCODE > +0                                    08740012
087500                  MOVE '1110-GET-PO-INFO'                         08750012
087600                                  TO DP013-PARAGRAPH              08760012
087700                  MOVE 'UNSUCCESSFUL SELECT ON PO HEADER'         08770012
087800                                  TO DP013-MESSAGE-TEXT (1)       08780012
087900                  MOVE SQLCA      TO DP013-SQLCA                  08790012
088000                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     08800012
088100                  SET DP013-DB2-ABEND                             08810012
088200                      DP013-XCTL-DISPLAY-RESTART                  08820012
088300                                  TO TRUE                         08830012
088400                  PERFORM DP013-0000-PROCESS-ABEND                08840012
088500         END-EVALUATE                                             08850012
088600     END-PERFORM.                                                 08860012
088700                                                                  08870012
088800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08880012
088900         MOVE '1110-GET-PO-INFO'  TO DP013-PARAGRAPH              08890012
089000         MOVE 'MAX RETRIES EXCEEDED ON SELECT FOR PO NBR'         08900012
089100                                  TO DP013-MESSAGE-TEXT (1)       08910012
089200         MOVE SQLCA               TO DP013-SQLCA                  08920012
089300         MOVE 'TPURCHS '          TO DP013-DB2-TABLE-NAME (1)     08930012
089400         SET DP013-DB2-ABEND                                      08940012
089500             DP013-XCTL-DISPLAY-RESTART                           08950012
089600                                  TO TRUE                         08960012
089700         PERFORM DP013-0000-PROCESS-ABEND                         08970012
089800     END-IF.                                                      08980012
089900                                                                  08990012
090000 1115-GET-ENTR-METHOD.                                            09000012
090100     PERFORM                                                      09010012
090200         WITH TEST AFTER                                          09020012
090300         VARYING PV-RETRY-COUNTER                                 09030012
090400         FROM 1 BY 1                                              09040012
090500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09050012
090600             OR (SQLCODE = +0))                                   09060012
090700                                                                  09070012
090800         EXEC SQL                                                 09080012
090900              SELECT ENTR_MTHD_CDE                                09090012
091000                INTO :INVOIC-ENTR-MTHD-CDE                        09100012
091100                FROM TINVOIC                                      09110012
091200               WHERE INVC_ID  = :DK-INVOICE-NBR                   09120012
091300                 AND PO_NBR   = :DK-PO-NBR                        09130012
091400         END-EXEC                                                 09140012
091500                                                                  09150012
091600         EVALUATE TRUE                                            09160012
091700             WHEN SQLCODE = +0                                    09170012
091800                  CONTINUE                                        09180012
091900             WHEN SQLCODE = -904                                  09190012
092000             WHEN SQLCODE = -913                                  09200012
092100                  CONTINUE                                        09210012
092200                                                                  09220012
092300             WHEN SQLWARN0 NOT = SPACES                           09230012
092400             WHEN SQLCODE < +0                                    09240012
092500             WHEN SQLCODE > +0                                    09250012
092600                  MOVE '1115-GET-ENTR-METHD'                      09260012
092700                                  TO DP013-PARAGRAPH              09270012
092800                  MOVE 'UNSUCCESSFUL SELECT ON INVOICE'           09280012
092900                                  TO DP013-MESSAGE-TEXT (1)       09290012
093000                  MOVE SQLCA      TO DP013-SQLCA                  09300012
093100                  MOVE 'TINVOIC ' TO DP013-DB2-TABLE-NAME (1)     09310012
093200                  SET DP013-DB2-ABEND                             09320012
093300                      DP013-XCTL-DISPLAY-RESTART                  09330012
093400                                  TO TRUE                         09340012
093500                  PERFORM DP013-0000-PROCESS-ABEND                09350012
093600         END-EVALUATE                                             09360012
093700     END-PERFORM.                                                 09370012
093800                                                                  09380012
093900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09390012
094000         MOVE '1115-GET-ENTR-METHD' TO DP013-PARAGRAPH            09400012
094100         MOVE 'MAX RETRIES EXCEEDED ON SELECT FOR INVOICE'        09410012
094200                                  TO DP013-MESSAGE-TEXT (1)       09420012
094300         MOVE SQLCA               TO DP013-SQLCA                  09430012
094400         MOVE 'TINVOIC '          TO DP013-DB2-TABLE-NAME (1)     09440012
094500         SET DP013-DB2-ABEND                                      09450012
094600             DP013-XCTL-DISPLAY-RESTART                           09460012
094700                                  TO TRUE                         09470012
094800         PERFORM DP013-0000-PROCESS-ABEND                         09480012
094900     END-IF.                                                      09490012
095000/                                                                 09500012
095100*----------------------------------------------------------------*09510012
095200*  RETRIEVE THE PRIMARY VENDOR NAME                               09520012
095300*----------------------------------------------------------------*09530012
095400                                                                  09540012
095500 1120-GET-PRIMARY-ENT-NAME-DESC.                                  09550012
095600                                                                  09560012
095700     PERFORM                                                      09570012
095800         WITH TEST AFTER                                          09580012
095900         VARYING PV-RETRY-COUNTER                                 09590012
096000         FROM 1 BY 1                                              09600012
096100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09610012
096200             OR (SQLCODE = +0))                                   09620012
096300                                                                  09630012
096400         EXEC SQL                                                 09640012
096500              SELECT ENT_NAME_DESC                                09650012
096600                INTO :ENTNME-ENT-NAME-DESC                        09660012
096700                FROM TENTNME                                      09670012
096800               WHERE ENT_ID   = :DK-ENT-ID                        09680012
096900                 AND TYPE_CDE = '01'                              09690012
097000         END-EXEC                                                 09700012
097100                                                                  09710012
097200         EVALUATE TRUE                                            09720012
097300             WHEN SQLCODE = +0                                    09730012
097400                  MOVE ENTNME-ENT-NAME-DESC                       09740012
097500                                  TO ASC-KEY-VENDOR-NAME          09750012
097600             WHEN SQLCODE = -904                                  09760012
097700             WHEN SQLCODE = -913                                  09770012
097800                  CONTINUE                                        09780012
097900                                                                  09790012
098000             WHEN SQLWARN0 NOT = SPACES                           09800012
098100             WHEN SQLCODE < +0                                    09810012
098200             WHEN SQLCODE > +0                                    09820012
098300                  MOVE '1120-GET-PRIMARY-ENT-NAME-DESC'           09830012
098400                                  TO DP013-PARAGRAPH              09840012
098500                  MOVE 'UNSUCCESSFUL SELECT ENTERPRISE NAME'      09850012
098600                                  TO DP013-MESSAGE-TEXT (1)       09860012
098700                  MOVE SQLCA      TO DP013-SQLCA                  09870012
098800                  MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (1)     09880012
098900                  SET DP013-DB2-ABEND                             09890012
099000                      DP013-XCTL-DISPLAY-RESTART                  09900012
099100                                  TO TRUE                         09910012
099200                  PERFORM DP013-0000-PROCESS-ABEND                09920012
099300         END-EVALUATE                                             09930012
099400     END-PERFORM.                                                 09940012
099500                                                                  09950012
099600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09960012
099700         MOVE '1120-GET-PRIMARY-NAME'                             09970012
099800                                  TO DP013-PARAGRAPH              09980012
099900         MOVE 'MAX RETRIES EXCEEDED ON SELECT ENTERPRISE NAME'    09990012
100000                                  TO DP013-MESSAGE-TEXT (1)       10000012
100100         MOVE SQLCA               TO DP013-SQLCA                  10010012
100200         MOVE 'TENTNME '          TO DP013-DB2-TABLE-NAME (1)     10020012
100300         SET DP013-DB2-ABEND                                      10030012
100400             DP013-XCTL-DISPLAY-RESTART                           10040012
100500                                  TO TRUE                         10050012
100600         PERFORM DP013-0000-PROCESS-ABEND                         10060012
100700     END-IF.                                                      10070012
100800                                                                  10080012
100900/                                                                 10090012
101000*----------------------------------------------------------------*10100012
101100* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *10110012
101200* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *10120012
101300* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *10130012
101400* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *10140012
101500* FUNCTION KEYS CAN GET THIS FAR.                                *10150012
101600*----------------------------------------------------------------*10160012
101700                                                                  10170012
101800 2000-PROCESS-PANEL.                                              10180012
101900     EVALUATE TRUE                                                10190012
102000         WHEN DP020-SRC-AID = DP016-CLEAR                         10200012
102100             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    10210012
102200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10220012
102300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10230012
102400                                                                  10240012
102500         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    10250012
102600             PERFORM 2050-DELETE-LIST-QUEUE                       10260012
102700             PERFORM 4000-BUILD-INITIAL-PANEL                     10270012
102800                                                                  10280012
102900         WHEN DP020-FK-DESELECT (DP020-SRC-AID)                   10290012
103000             PERFORM 2140-DESELECT-ALL-ITEMS                      10300012
103100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10310012
103200                                                                  10320012
103300         WHEN DP020-FK-SELECT-ALL (DP020-SRC-AID)                 10330012
103400              PERFORM 2150-SELECT-ALL-ITEMS                       10340012
103500              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                10350012
103600                                                                  10360012
103700         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              10370012
103800              PERFORM 2170-SELECT-RECEIVED-ITEMS                  10380012
103900              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                10390012
104000                                                                  10400012
104100         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              10410012
104200             PERFORM 2050-DELETE-LIST-QUEUE                       10420012
104300             MOVE ASC-KEY-PO-NBR TO DK-PO-NBR                     10430012
104400             MOVE ASC-KEY-INVOICE-NBR                             10440012
104500                                 TO DK-INVOICE-NBR                10450012
104600             SET ASC-VEND-STYLE-CURSOR                            10460012
104700                                 TO TRUE                          10470012
104800             PERFORM 4000-BUILD-INITIAL-PANEL                     10480012
104900                                                                  10490012
105000         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              10500012
105100             PERFORM 2050-DELETE-LIST-QUEUE                       10510012
105200             SET ASC-ITEM-CURSOR TO TRUE                          10520012
105300             MOVE ASC-KEY-PO-NBR TO DK-PO-NBR                     10530012
105400             MOVE ASC-KEY-INVOICE-NBR                             10540012
105500                                 TO DK-INVOICE-NBR                10550012
105600             PERFORM 4000-BUILD-INITIAL-PANEL                     10560012
105700                                                                  10570012
105800         WHEN OTHER                                               10580012
105900             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 10590012
106000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10600012
106100             IF  PS-NO-ERROR                                      10610012
106200                 SET DP030-CONTINUE-GO TO TRUE                    10620012
106300                 PERFORM 2100-CHECK-FUNCTION-KEY                  10630012
106400             ELSE                                                 10640012
106500                 SET DP030-OVERRIDE-GO TO TRUE                    10650012
106600             END-IF                                               10660012
106700     END-EVALUATE.                                                10670012
106800                                                                  10680012
106900/                                                                 10690012
107000*----------------------------------------------------------------*10700012
107100*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *10710012
107200*----------------------------------------------------------------*10720012
107300 2050-DELETE-LIST-QUEUE.                                          10730012
107400                                                                  10740012
107500     EXEC CICS                                                    10750012
107600         DELETEQ TS                                               10760012
107700           QUEUE (ASC-LIST-QUEUE-NAME)                            10770012
107800            RESP (PV-CICS-RESP)                                   10780012
107900     END-EXEC.                                                    10790012
108000                                                                  10800012
108100     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       10810012
108200        (PV-CICS-RESP = DFHRESP(QIDERR))                          10820012
108300         CONTINUE                                                 10830012
108400     ELSE                                                         10840012
108500         SET DP013-CICS-ABEND      TO TRUE                        10850012
108600         SET DP013-NO-ROLLBACK     TO TRUE                        10860012
108700                                                                  10870012
108800         MOVE '2050-DELETE-LIST-QUEUE'                            10880012
108900                                   TO DP013-PARAGRAPH             10890012
109000         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    10900012
109100                                   TO DP013-MESSAGE-TEXT (1)      10910012
109200         PERFORM DP013-0000-PROCESS-ABEND                         10920012
109300     END-IF.                                                      10930012
109400                                                                  10940012
109500     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  10950012
109600                                                                  10960012
109700/                                                                 10970012
109800*----------------------------------------------------------------*10980012
109900* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*10990012
110000* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *11000012
110100* CICS ARCHITECTURE API.                                         *11010012
110200*----------------------------------------------------------------*11020012
110300 2100-CHECK-FUNCTION-KEY.                                         11030012
110400                                                                  11040012
110500     EVALUATE TRUE                                                11050012
110600         WHEN DP020-FK-LOCAL-RETURN (DP020-SRC-AID)               11060012
110700*             IF ASC-KEY-ENTR-MTHD-CDE = 'ED'                     11070012
110800*                 MOVE PC-TSYMSG-00851 TO DP020-MSG-NUMBER        11080012
110900*                 SET  PS-ERROR                                   11090012
111000*                      DP030-OVERRIDE-GO                          11100012
111100*                      DP030-SET-CURSOR-TRAILER                   11110012
111200*                      DP020-MSG-FATAL TO TRUE                    11120012
111300*             ELSE                                                11130012
111400                  IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO         11140012
111500                      INITIALIZE AP300-INTER-APPL-COMMAREA        11150012
111600                      MOVE ASC-NUMBER-OF-SELECTED-ITEMS           11160012
111700                                TO AP300-NUMBER-OF-SELECTED-ITEMS 11170012
111800                      MOVE ASC-KEY-PO-NBR                         11180012
111900                                TO AP300-PO-NBR                   11190012
112000                      MOVE ASC-KEY-INVOICE-NBR                    11200012
112100                                TO AP300-INVC-ID                  11210012
112200                      MOVE ASC-KEY-PAYT-REC-SEQ-NBR               11220012
112300                                TO AP300-REC-SEQ-NBR              11230012
112400                      PERFORM 5000-PROCESS-SEL-ITEMS              11240012
112500                  ELSE                                            11250012
112600                      SET DP030-OVERRIDE-GO                       11260012
112700                          DP020-MSG-WARNING                       11270012
112800                                    TO TRUE                       11280012
112900                      MOVE PC-TSYMSG-00057                        11290012
113000                                    TO DP020-MSG-NUMBER           11300012
113100                  END-IF                                          11310012
113200*             END-IF                                              11320012
113300                                                                  11330012
113400         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  11340012
113500             MOVE +1               TO PV-TOP-ITEM                 11350012
113600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11360012
113700             PERFORM 3200-RESET-ATTRIBUTES                        11370012
113800                                                                  11380012
113900         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   11390012
114000             PERFORM 2110-BROWSE-BACKWARD                         11400012
114100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11410012
114200             PERFORM 3200-RESET-ATTRIBUTES                        11420012
114300                                                                  11430012
114400         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   11440012
114500             PERFORM 2120-BROWSE-FORWARD                          11450012
114600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11460012
114700             PERFORM 3200-RESET-ATTRIBUTES                        11470012
114800                                                                  11480012
114900         WHEN DP020-SRC-AID = DP016-ENTER                         11490012
115000             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   11500012
115100             IF  PS-ERROR                                         11510012
115200                 CONTINUE                                         11520012
115300             ELSE                                                 11530012
115400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             11540012
115500             END-IF                                               11550012
115600                                                                  11560012
115700         WHEN OTHER                                               11570012
115800             SET DP013-NO-ROLLBACK                                11580012
115900                 DP013-XCTL-DISPLAY-RESTART                       11590012
116000                 DP013-CICS-ABEND  TO TRUE                        11600012
116100             MOVE '2100-CHECK-FUNCTION-KEY'                       11610012
116200                                   TO DP013-PARAGRAPH             11620012
116300             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      11630012
116400                                   TO DP013-MESSAGE-TEXT (1)      11640012
116500             PERFORM DP013-0000-PROCESS-ABEND                     11650012
116600     END-EVALUATE.                                                11660012
116700                                                                  11670012
116800/                                                                 11680012
116900*----------------------------------------------------------------*11690012
117000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *11700012
117100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *11710012
117200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *11720012
117300*    MESSAGE.                                                    *11730012
117400*----------------------------------------------------------------*11740012
117500                                                                  11750012
117600 2110-BROWSE-BACKWARD.                                            11760012
117700                                                                  11770012
117800     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    11780012
117900         GIVING PV-TOP-ITEM.                                      11790012
118000                                                                  11800012
118100     IF  ((PV-TOP-ITEM < +1)                                      11810012
118200       OR (PV-TOP-ITEM = +1))                                     11820012
118300         MOVE +1                   TO PV-TOP-ITEM                 11830012
118400*        -- TOP OF LIST --                                        11840012
118500         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            11850012
118600         SET DP020-MSG-INFORMATIONAL                              11860012
118700                                   TO TRUE                        11870012
118800     END-IF.                                                      11880012
118900                                                                  11890012
119000/                                                                 11900012
119100*----------------------------------------------------------------*11910012
119200*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *11920012
119300*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *11930012
119400*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *11940012
119500*----------------------------------------------------------------*11950012
119600                                                                  11960012
119700 2120-BROWSE-FORWARD.                                             11970012
119800                                                                  11980012
119900     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              11990012
120000         GIVING PV-TOP-ITEM.                                      12000012
120100                                                                  12010012
120200     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   12020012
120300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            12030012
120400                                   TO PV-TOP-ITEM                 12040012
120500*        -- BOTTOM OF LIST --                                     12050012
120600         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            12060012
120700         SET DP020-MSG-INFORMATIONAL                              12070012
120800                                   TO TRUE                        12080012
120900     ELSE                                                         12090012
121000         COMPUTE PV-BOTTOM-ITEM =                                 12100012
121100             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 12110012
121200         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            12120012
121300*            -- BOTTOM OF LIST --                                 12130012
121400             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            12140012
121500             SET DP020-MSG-INFORMATIONAL                          12150012
121600                                   TO TRUE                        12160012
121700         END-IF                                                   12170012
121800     END-IF.                                                      12180012
121900                                                                  12190012
122000/                                                                 12200012
122100*----------------------------------------------------------------*12210012
122200*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *12220012
122300*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *12230012
122400*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *12240012
122500*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *12250012
122600*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *12260012
122700*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *12270012
122800*----------------------------------------------------------------*12280012
122900                                                                  12290012
123000 2130-CHECK-FOR-JUMP-BROWSE.                                      12300012
123100                                                                  12310012
123200     SET PS-NO-ERROR               TO TRUE.                       12320012
123300     IF (ASC-START-ITEM-REQUEST = SPACE)                          12330012
123400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            12340012
123500                                   TO PV-TOP-ITEM                 12350012
123600     ELSE                                                         12360012
123700         MOVE ASC-START-ITEM-REQUEST                              12370012
123800                                   TO DP010I-UNEDITED-FIELD       12380012
123900         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       12390012
124000         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     12400012
124100         SET DP010I-NEGATIVE-NOT-ALLOWED                          12410012
124200                                   TO TRUE                        12420012
124320         CALL DP010I-NUMERIC-EDIT-ROUTINE                         12432031
124330                         USING DP010I-NUMERIC-EDIT-AREA           12433031
124400                                                                  12440012
124500         IF  NOT DP010I-ERROR-DETECTED                            12450012
124600             MOVE DP010I-NUMERIC-FIELD                            12460012
124700                                   TO ASC-START-ITEM-REQUEST-N    12470012
124800             IF  ASC-START-ITEM-REQUEST-N > ZERO                  12480012
124900                 IF  ASC-START-ITEM-REQUEST-N >                   12490012
125000                                          ASC-NUMBER-OF-ITEMS-READ12500012
125100                     MOVE SPACE TO ASC-START-ITEM-REQUEST         12510012
125200                     COMPUTE PV-TOP-ITEM =                        12520012
125300                             ASC-NUMBER-OF-ITEMS-READ             12530012
125400                             - PC-ITEMS-PER-PANEL + 1             12540012
125500                     IF  PV-TOP-ITEM < +1                         12550012
125600                         MOVE +1   TO PV-TOP-ITEM                 12560012
125700                         MOVE PC-TSYMSG-00070                     12570012
125800                                   TO DP020-MSG-NUMBER            12580012
125900                         SET DP020-MSG-INFORMATIONAL              12590012
126000                                   TO TRUE                        12600012
126100                     END-IF                                       12610012
126200                 ELSE                                             12620012
126300                     MOVE ASC-START-ITEM-REQUEST-N                12630012
126400                                   TO PV-TOP-ITEM                 12640012
126500                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      12650012
126600                     COMPUTE PV-BOTTOM-ITEM =                     12660012
126700                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     12670012
126800                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ12680012
126900*                        -- BOTTOM OF LIST --                     12690012
127000                         MOVE PC-TSYMSG-00070                     12700012
127100                                   TO DP020-MSG-NUMBER            12710012
127200                         SET DP020-MSG-INFORMATIONAL              12720012
127300                                   TO TRUE                        12730012
127400                     END-IF                                       12740012
127500                 END-IF                                           12750012
127600             ELSE                                                 12760012
127700*                --- VALUE OUT OF RANGE ----                      12770012
127800                 MOVE PC-TSYMSG-00101                             12780012
127900                                   TO DP020-MSG-NUMBER            12790012
128000                 MOVE -1           TO ASTRTITL                    12800012
128100                 SET DP030-SET-CURSOR-APPL-1                      12810012
128200                                   TO TRUE                        12820012
128300                 MOVE DP015-REVERSE                               12830012
128400                                   TO ASTRTITH                    12840012
128500                 MOVE DP015-RED    TO ASTRTITC                    12850012
128600                 MOVE DP015-UNP-NUM-BRT-MDT                       12860012
128700                                   TO ASTRTITA                    12870012
128800                 SET DP020-MSG-FATAL                              12880012
128900                                   TO TRUE                        12890012
129000                 SET PS-ERROR      TO TRUE                        12900012
129100             END-IF                                               12910012
129200                                                                  12920012
129300         ELSE                                                     12930012
129400             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            12940012
129500             MOVE -1               TO ASTRTITL                    12950012
129600             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  12960012
129700             MOVE DP015-REVERSE    TO ASTRTITH                    12970012
129800             MOVE DP015-RED        TO ASTRTITC                    12980012
129900             MOVE DP015-UNP-NUM-BRT-MDT                           12990012
130000                                   TO ASTRTITA                    13000012
130100             SET DP020-MSG-FATAL   TO TRUE                        13010012
130200             SET PS-ERROR          TO TRUE                        13020012
130300         END-IF                                                   13030012
130400     END-IF.                                                      13040012
130500                                                                  13050012
130600/                                                                 13060012
130700*----------------------------------------------------------------*13070012
130800*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *13080012
130900*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *13090012
131000*----------------------------------------------------------------*13100012
131100 2140-DESELECT-ALL-ITEMS.                                         13110012
131200                                                                  13120012
131300     MOVE +1                       TO ASC-BLK-SUB.                13130012
131400                                                                  13140012
131500     PERFORM 2141-CLEAR-SELECTED-INDS                             13150012
131600         VARYING ASC-ITEM-SUB                                     13160012
131700         FROM 1 BY 1                                              13170012
131800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13180012
131900                                                                  13190012
132000     ADD +1                        TO ASC-BLK-SUB.                13200012
132100                                                                  13210012
132200     PERFORM 2141-CLEAR-SELECTED-INDS                             13220012
132300         VARYING ASC-ITEM-SUB                                     13230012
132400         FROM 1 BY 1                                              13240012
132500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13250012
132600                                                                  13260012
132700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               13270012
132800                                   TO PV-LIST-ITEM-NUMBER.        13280012
132900                                                                  13290012
133000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13300012
133100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    13310012
133200                                                                  13320012
133300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     13330012
133400        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      13340012
133500         MOVE +1                   TO ASC-BLK-SUB                 13350012
133600                                                                  13360012
133700         PERFORM 5100-WRITE-TEMP-STORAGE                          13370012
133800                                                                  13380012
133900         MOVE +1                   TO PV-BLOCK-NUMBER             13390012
134000                                                                  13400012
134100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13410012
134200             PV-FIRST-BLOCK-IN-ARRAY - 1                          13420012
134300                                                                  13430012
134400         PERFORM                                                  13440012
134500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       13450012
134600                                                                  13460012
134700             PERFORM 4410-READ-TEMP-STORAGE                       13470012
134800                                                                  13480012
134900             PERFORM 2141-CLEAR-SELECTED-INDS                     13490012
135000                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 13500012
135100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13510012
135200                                                                  13520012
135300             PERFORM 5100-WRITE-TEMP-STORAGE                      13530012
135400                                                                  13540012
135500             ADD +1                TO PV-BLOCK-NUMBER             13550012
135600                                                                  13560012
135700         END-PERFORM                                              13570012
135800                                                                  13580012
135900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         13590012
136000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     13600012
136100                                                                  13610012
136200         PERFORM                                                  13620012
136300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       13630012
136400                   ASC-HIGHEST-BLOCK-WRITTEN                      13640012
136500                                                                  13650012
136600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          13660012
136700                                   TO PV-BLOCK-NUMBER             13670012
136800                                                                  13680012
136900             PERFORM 4410-READ-TEMP-STORAGE                       13690012
137000                                                                  13700012
137100             PERFORM 2141-CLEAR-SELECTED-INDS                     13710012
137200                 VARYING ASC-ITEM-SUB                             13720012
137300                 FROM 1 BY 1                                      13730012
137400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13740012
137500                                                                  13750012
137600             PERFORM 5100-WRITE-TEMP-STORAGE                      13760012
137700                                                                  13770012
137800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      13780012
137900                                                                  13790012
138000         END-PERFORM                                              13800012
138100                                                                  13810012
138200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             13820012
138300                                   TO PV-BLOCK-NUMBER             13830012
138400                                                                  13840012
138500         PERFORM 4410-READ-TEMP-STORAGE                           13850012
138600     END-IF.                                                      13860012
138700                                                                  13870012
138800                                                                  13880012
138900     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS13890012
139000     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.13900012
139100     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  13910012
139200                                                                  13920012
139300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        13930012
139400                                                                  13940012
139500/                                                                 13950012
139600*----------------------------------------------------------------*13960012
139700*    MARK EACH ITEM AS BEING NOT SELECTED.                       *13970012
139800*----------------------------------------------------------------*13980012
139900                                                                  13990012
140000 2141-CLEAR-SELECTED-INDS.                                        14000012
140100                                                                  14010012
140200     IF  ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)          14020012
140300             NOT EQUAL ZERO                                       14030012
140400         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          14040012
140500             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          14050012
140600                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    14060012
140700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  14070012
140800                                   TO TRUE                        14080012
140900         END-IF                                                   14090012
141000     END-IF.                                                      14100012
141100                                                                  14110012
141200/                                                                 14120012
141300*----------------------------------------------------------------*14130012
141400*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *14140012
141500*  FOR ALL ITEMS.                                                *14150012
141600*----------------------------------------------------------------*14160012
141700                                                                  14170012
141800 2150-SELECT-ALL-ITEMS.                                           14180012
141900                                                                  14190012
142000     MOVE +1                       TO ASC-BLK-SUB.                14200012
142100                                                                  14210012
142200     PERFORM 2151-SET-SELECTED-INDS                               14220012
142300         VARYING ASC-ITEM-SUB                                     14230012
142400         FROM 1 BY 1                                              14240012
142500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14250012
142600                                                                  14260012
142700     ADD +1                        TO ASC-BLK-SUB.                14270012
142800                                                                  14280012
142900     PERFORM 2151-SET-SELECTED-INDS                               14290012
143000         VARYING ASC-ITEM-SUB                                     14300012
143100         FROM 1 BY 1                                              14310012
143200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14320012
143300                                                                  14330012
143400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               14340012
143500                                   TO PV-LIST-ITEM-NUMBER.        14350012
143600                                                                  14360012
143700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            14370012
143800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    14380012
143900                                                                  14390012
144000     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     14400012
144100        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    14410012
144200         MOVE +1                   TO ASC-BLK-SUB                 14420012
144300                                                                  14430012
144400         PERFORM 5100-WRITE-TEMP-STORAGE                          14440012
144500                                                                  14450012
144600         MOVE +1                   TO PV-BLOCK-NUMBER             14460012
144700                                                                  14470012
144800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         14480012
144900             PV-FIRST-BLOCK-IN-ARRAY - 1                          14490012
145000                                                                  14500012
145100         PERFORM                                                  14510012
145200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       14520012
145300                                                                  14530012
145400             PERFORM 4410-READ-TEMP-STORAGE                       14540012
145500                                                                  14550012
145600             PERFORM 2151-SET-SELECTED-INDS                       14560012
145700                 VARYING ASC-ITEM-SUB                             14570012
145800                 FROM 1 BY 1                                      14580012
145900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14590012
146000                                                                  14600012
146100             PERFORM 5100-WRITE-TEMP-STORAGE                      14610012
146200                                                                  14620012
146300             ADD +1                TO PV-BLOCK-NUMBER             14630012
146400         END-PERFORM                                              14640012
146500                                                                  14650012
146600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         14660012
146700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     14670012
146800                                                                  14680012
146900         PERFORM                                                  14690012
147000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       14700012
147100                   ASC-HIGHEST-BLOCK-WRITTEN                      14710012
147200                                                                  14720012
147300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          14730012
147400                                   TO PV-BLOCK-NUMBER             14740012
147500                                                                  14750012
147600             PERFORM 4410-READ-TEMP-STORAGE                       14760012
147700                                                                  14770012
147800             PERFORM 2151-SET-SELECTED-INDS                       14780012
147900                 VARYING ASC-ITEM-SUB                             14790012
148000                 FROM 1 BY 1                                      14800012
148100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14810012
148200                                                                  14820012
148300             PERFORM 5100-WRITE-TEMP-STORAGE                      14830012
148400                                                                  14840012
148500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      14850012
148600         END-PERFORM                                              14860012
148700                                                                  14870012
148800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             14880012
148900                                   TO PV-BLOCK-NUMBER             14890012
149000                                                                  14900012
149100         PERFORM 4410-READ-TEMP-STORAGE                           14910012
149200     END-IF.                                                      14920012
149300                                                                  14930012
149400     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             14940012
149500          ASC-NUMBER-OF-SELECTED-ITEMS.                           14950012
149600                                                                  14960012
149700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        14970012
149800                                                                  14980012
149900/                                                                 14990012
150000*----------------------------------------------------------------*15000012
150100*    MARK EACH ITEM AS BEING SELECTED.                           *15010012
150200*----------------------------------------------------------------*15020012
150300                                                                  15030012
150400 2151-SET-SELECTED-INDS.                                          15040012
150500                                                                  15050012
150600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           15060012
150700             NOT EQUAL ZERO                                       15070012
150800         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             15080012
150900             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             15090012
151000                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        15100012
151100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  15110012
151200                                   TO TRUE                        15120012
151300         END-IF                                                   15130012
151400     END-IF.                                                      15140012
151500                                                                  15150012
151600/                                                                 15160012
151700*----------------------------------------------------------------*15170012
151800*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *15180012
151900*  FOR ALL ITEMS.                                                *15190012
152000*----------------------------------------------------------------*15200012
152100                                                                  15210012
152200 2170-SELECT-RECEIVED-ITEMS.                                      15220012
152300     MOVE ZERO                     TO ASC-NUMBER-OF-SELECTED-ITEMS15230012
152400                                                                  15240012
152500     MOVE +1                       TO ASC-BLK-SUB.                15250012
152600                                                                  15260012
152700     PERFORM 2171-SET-RECEIVED-INDS                               15270012
152800         VARYING ASC-ITEM-SUB                                     15280012
152900         FROM 1 BY 1                                              15290012
153000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15300012
153100                                                                  15310012
153200     ADD +1                        TO ASC-BLK-SUB.                15320012
153300                                                                  15330012
153400     PERFORM 2171-SET-RECEIVED-INDS                               15340012
153500         VARYING ASC-ITEM-SUB                                     15350012
153600         FROM 1 BY 1                                              15360012
153700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15370012
153800                                                                  15380012
153900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15390012
154000                                   TO PV-LIST-ITEM-NUMBER.        15400012
154100                                                                  15410012
154200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15420012
154300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    15430012
154400                                                                  15440012
154500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     15450012
154600        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    15460012
154700         MOVE +1                   TO ASC-BLK-SUB                 15470012
154800                                                                  15480012
154900         PERFORM 5100-WRITE-TEMP-STORAGE                          15490012
155000                                                                  15500012
155100         MOVE +1                   TO PV-BLOCK-NUMBER             15510012
155200                                                                  15520012
155300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         15530012
155400             PV-FIRST-BLOCK-IN-ARRAY - 1                          15540012
155500                                                                  15550012
155600         PERFORM                                                  15560012
155700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       15570012
155800                                                                  15580012
155900             PERFORM 4410-READ-TEMP-STORAGE                       15590012
156000                                                                  15600012
156100             PERFORM 2171-SET-RECEIVED-INDS                       15610012
156200                 VARYING ASC-ITEM-SUB                             15620012
156300                 FROM 1 BY 1                                      15630012
156400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15640012
156500                                                                  15650012
156600             PERFORM 5100-WRITE-TEMP-STORAGE                      15660012
156700                                                                  15670012
156800             ADD +1                TO PV-BLOCK-NUMBER             15680012
156900         END-PERFORM                                              15690012
157000                                                                  15700012
157100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15710012
157200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15720012
157300                                                                  15730012
157400         PERFORM                                                  15740012
157500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15750012
157600                   ASC-HIGHEST-BLOCK-WRITTEN                      15760012
157700                                                                  15770012
157800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          15780012
157900                                   TO PV-BLOCK-NUMBER             15790012
158000                                                                  15800012
158100             PERFORM 4410-READ-TEMP-STORAGE                       15810012
158200                                                                  15820012
158300             PERFORM 2171-SET-RECEIVED-INDS                       15830012
158400                 VARYING ASC-ITEM-SUB                             15840012
158500                 FROM 1 BY 1                                      15850012
158600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15860012
158700                                                                  15870012
158800             PERFORM 5100-WRITE-TEMP-STORAGE                      15880012
158900                                                                  15890012
159000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      15900012
159100         END-PERFORM                                              15910012
159200                                                                  15920012
159300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             15930012
159400                                   TO PV-BLOCK-NUMBER             15940012
159500                                                                  15950012
159600         PERFORM 4410-READ-TEMP-STORAGE                           15960012
159700     END-IF.                                                      15970012
159800                                                                  15980012
159900     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        15990012
160000                                                                  16000012
160100/                                                                 16010012
160200*----------------------------------------------------------------*16020012
160300*    MARK EACH ITEM THAT HAS BEEN RECEIVED AS BEING SELECTED.    *16030012
160400*----------------------------------------------------------------*16040012
160500                                                                  16050012
160600 2171-SET-RECEIVED-INDS.                                          16060012
160700                                                                  16070012
160800     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           16080012
160900             NOT EQUAL ZERO                                       16090012
161000         IF ASC-QTY-RCVD (ASC-BLK-SUB ASC-ITEM-SUB) > ZERO        16100012
161100             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             16110012
161200                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        16120012
161300                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  16130012
161400                                 TO TRUE                          16140012
161500             ADD +1              TO ASC-NUMBER-OF-SELECTED-ITEMS  16150012
161600         ELSE                                                     16160012
161700             SET ASC-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)         16170012
161800                 ASC-TEMP-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)     16180012
161900                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  16190012
162000                                 TO TRUE                          16200012
162100         END-IF                                                   16210012
162200     END-IF.                                                      16220012
162300                                                                  16230012
162400/                                                                 16240012
162500*----------------------------------------------------------------*16250012
162600*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *16260012
162700*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *16270012
162800*----------------------------------------------------------------*16280012
162900 2200-MOVE-SCREEN-TO-COMMAREA.                                    16290012
163000                                                                  16300012
163100     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             16310012
163200     MOVE +1                       TO PV-SUB.                     16320012
163300                                                                  16330012
163400     PERFORM 3100-SET-SUBSCRIPTS.                                 16340012
163500                                                                  16350012
163600     IF  ASTRTITL > ZERO                                          16360012
163700         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      16370012
163800     ELSE                                                         16380012
163900         IF  ASTRTITF = DP015-ERASE-EOF                           16390012
164000             INITIALIZE ASC-START-ITEM-REQUEST                    16400012
164100         END-IF                                                   16410012
164200     END-IF.                                                      16420012
164300                                                                  16430012
164400     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          16440012
164500         VARYING PV-SUB                                           16450012
164600         FROM 1 BY 1                                              16460012
164700         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      16470012
164800                                                                  16480012
164900/                                                                 16490012
165000*----------------------------------------------------------------*16500012
165100*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *16510012
165200*----------------------------------------------------------------*16520012
165300 2210-MOVE-LINES-TO-COMMAREA.                                     16530012
165400                                                                  16540012
165500     IF  MR-SELECTL (PV-SUB) > ZERO                               16550012
165600         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     16560012
165700                                   TO TRUE                        16570012
165800         MOVE MR-SELECT (PV-SUB)   TO ASC-TEMP-SELECTED-SW        16580012
165900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      16590012
166000     ELSE                                                         16600012
166100         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                16610012
166200             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         16620012
166300             MOVE SPACE            TO ASC-TEMP-SELECTED-SW        16630012
166400                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      16640012
166500         END-IF                                                   16650012
166600     END-IF.                                                      16660012
166700                                                                  16670012
166800     ADD +1                        TO ASC-ITEM-SUB.               16680012
166900                                                                  16690012
167000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        16700012
167100         ADD +1                    TO ASC-BLK-SUB                 16710012
167200         MOVE +1                   TO ASC-ITEM-SUB                16720012
167300     END-IF.                                                      16730012
167400                                                                  16740012
167500/                                                                 16750012
167600*----------------------------------------------------------------*16760012
167700*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *16770012
167800*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *16780012
167900*----------------------------------------------------------------*16790012
168000 3000-EDIT-DATA-IN-COMMAREA.                                      16800012
168100                                                                  16810012
168200     SET PS-NO-ERROR               TO TRUE.                       16820012
168300                                                                  16830012
168400     PERFORM 3200-RESET-ATTRIBUTES.                               16840012
168500                                                                  16850012
168600     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     16860012
168700**                                                                16870012
168800* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              16880012
168900* EDITTING IS DONE FROM THE BOTTOM UP.                            16890012
169000**                                                                16900012
169100     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       16910012
169200         ASC-ITEMS-DISPLAYED - 1.                                 16920012
169300                                                                  16930012
169400     PERFORM 3100-SET-SUBSCRIPTS.                                 16940012
169500     PERFORM 3300-EDIT-SELECTIONS                                 16950012
169600         VARYING PV-SUB                                           16960012
169700         FROM PV-SUB BY -1                                        16970012
169800         UNTIL PV-SUB < +1                                        16980012
169900                                                                  16990012
170000     IF  PS-NO-ERROR                                              17000012
170100         PERFORM 3400-CHECK-RANGE-SEQUENCE                        17010012
170200     END-IF.                                                      17020012
170300                                                                  17030012
170400     IF  ((PS-NO-ERROR)                                           17040012
170500       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   17050012
170600       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    17060012
170700             PERFORM 3500-MARK-RANGE-AS-SELECTED                  17070012
170800     END-IF.                                                      17080012
170900                                                                  17090012
171000/                                                                 17100012
171100*----------------------------------------------------------------*17110012
171200*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *17120012
171300*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*17130012
171400*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *17140012
171500*                                                                *17150012
171600*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *17160012
171700*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *17170012
171800*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *17180012
171900*    US IN THE 2ND BLOCK OF THE ARRAY.                           *17190012
172000*----------------------------------------------------------------*17200012
172100                                                                  17210012
172200 3100-SET-SUBSCRIPTS.                                             17220012
172300                                                                  17230012
172400     COMPUTE ASC-ITEM-SUB =                                       17240012
172500         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        17250012
172600                                                                  17260012
172700     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         17270012
172800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            17280012
172900                                                                  17290012
173000         MOVE PC-MAX-BLOCKS-IN-ARRAY                              17300012
173100                                   TO ASC-BLK-SUB                 17310012
173200     ELSE                                                         17320012
173300         MOVE +1                   TO ASC-BLK-SUB                 17330012
173400     END-IF.                                                      17340012
173500                                                                  17350012
173600*----------------------------------------------------------------*17360012
173700*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *17370012
173800*----------------------------------------------------------------*17380012
173900                                                                  17390012
174000 3200-RESET-ATTRIBUTES.                                           17400012
174100                                                                  17410012
174200     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   17420012
174300     MOVE DP015-GREEN              TO ASTRTITC.                   17430012
174400     MOVE DP015-UNDERLINE          TO ASTRTITH.                   17440012
174500                                                                  17450012
174600     IF DP020-NEXT-ACT-RETURN                                     17460012
174700     OR DP020-NEXT-ACT-READ-MAP                                   17470012
174800        PERFORM                                                   17480012
174900            VARYING PV-SUB                                        17490012
175000            FROM 1 BY 1                                           17500012
175100            UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                    17510012
175200            MOVE DP015-UNP-ALP-NOR-OFF                            17520012
175300                                      TO MR-SELECTA (PV-SUB)      17530012
175400            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      17540012
175500            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      17550012
175600        END-PERFORM                                               17560012
175700     ELSE                                                         17570012
175800        PERFORM                                                   17580012
175900            VARYING PV-SUB                                        17590012
176000            FROM 1 BY 1                                           17600012
176100            UNTIL PV-SUB > PC-ITEMS-PER-PANEL                     17610012
176200            MOVE DP015-UNP-ALP-NOR-OFF                            17620012
176300                                      TO MR-SELECTA (PV-SUB)      17630012
176400            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      17640012
176500            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      17650012
176600        END-PERFORM                                               17660012
176700     END-IF.                                                      17670012
176800                                                                  17680012
176900/                                                                 17690012
177000*----------------------------------------------------------------*17700012
177100*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *17710012
177200*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *17720012
177300*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *17730012
177400*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *17740012
177500*----------------------------------------------------------------*17750012
177600 3300-EDIT-SELECTIONS.                                            17760012
177700                                                                  17770012
177800     EVALUATE TRUE                                                17780012
177900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     17790012
178000             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         17800012
178100                 CONTINUE                                         17810012
178200                                                                  17820012
178300         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         17830012
178400             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        17840012
178500                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS17850012
178600                 MOVE ASC-TEMP-SELECTED-SW                        17860012
178700                                     (ASC-BLK-SUB ASC-ITEM-SUB)   17870012
178800                                   TO ASC-SELECTED-SW             17880012
178900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   17890012
179000             END-IF                                               17900012
179100                                                                  17910012
179200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     17920012
179300                 = SPACE                                          17930012
179400             EVALUATE TRUE                                        17940012
179500                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       17950012
179600                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS17960012
179700                     MOVE SPACE    TO ASC-SELECTED-SW             17970012
179800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   17980012
179900                                                                  17990012
180000                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        18000012
180100                     MOVE ZERO     TO ASC-START-OF-SELECTED-RANGE 18010012
180200                     MOVE SPACE    TO ASC-SELECTED-SW             18020012
180300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   18030012
180400                                                                  18040012
180500                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          18050012
180600                     MOVE ZERO     TO ASC-END-OF-SELECTED-RANGE   18060012
180700                     MOVE SPACE    TO ASC-SELECTED-SW             18070012
180800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   18080012
180900             END-EVALUATE                                         18090012
181000                                                                  18100012
181100         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           18110012
181200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            18120012
181300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    18130012
181400             END-IF                                               18140012
181500             PERFORM 3310-EDIT-RANGE                              18150012
181600                                                                  18160012
181700         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             18170012
181800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            18180012
181900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    18190012
182000             END-IF                                               18200012
182100             PERFORM 3310-EDIT-RANGE                              18210012
182200                                                                  18220012
182300         WHEN OTHER                                               18230012
182400             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            18240012
182500             SET DP020-MSG-FATAL   TO TRUE                        18250012
182600             MOVE -1               TO MR-SELECTL (PV-SUB)         18260012
182700             SET DP030-SET-CURSOR-APPL-1                          18270012
182800                                   TO TRUE                        18280012
182900             MOVE DP015-RED        TO MR-SELECTC (PV-SUB)         18290012
183000             MOVE DP015-REVERSE    TO MR-SELECTH (PV-SUB)         18300012
183100             SET PS-ERROR          TO TRUE                        18310012
183200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            18320012
183300                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     18330012
183400                 MOVE SPACE        TO ASC-SELECTED-SW             18340012
183500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   18350012
183600             END-IF                                               18360012
183700     END-EVALUATE.                                                18370012
183800                                                                  18380012
183900     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             18390012
184000     SUBTRACT +1 FROM ASC-ITEM-SUB.                               18400012
184100                                                                  18410012
184200     IF  ASC-ITEM-SUB < 1                                         18420012
184300         SUBTRACT +1 FROM ASC-BLK-SUB                             18430012
184400         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                18440012
184500     END-IF.                                                      18450012
184600                                                                  18460012
184700*----------------------------------------------------------------*18470012
184800*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *18480012
184900*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *18490012
185000*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *18500012
185100*  THE ENDING.                                                   *18510012
185200*----------------------------------------------------------------*18520012
185300 3310-EDIT-RANGE.                                                 18530012
185400                                                                  18540012
185500     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                18550012
185600         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   18560012
185700             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)18570012
185800                                   TO ASC-SELECTED-SW             18580012
185900                                        (ASC-BLK-SUB ASC-ITEM-SUB)18590012
186000             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 18600012
186100         ELSE                                                     18610012
186200             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     18620012
186300                 CONTINUE                                         18630012
186400             ELSE                                                 18640012
186500*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        18650012
186600                 MOVE PC-TSYMSG-00054                             18660012
186700                                   TO DP020-MSG-NUMBER            18670012
186800                 SET DP020-MSG-FATAL                              18680012
186900                                   TO TRUE                        18690012
187000                 MOVE -1           TO MR-SELECTL (PV-SUB)         18700012
187100                 SET DP030-SET-CURSOR-APPL-1                      18710012
187200                                   TO TRUE                        18720012
187300                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         18730012
187400                 MOVE DP015-UNDERLINE                             18740012
187500                                   TO MR-SELECTH (PV-SUB)         18750012
187600                 SET PS-ERROR      TO TRUE                        18760012
187700             END-IF                                               18770012
187800         END-IF                                                   18780012
187900     ELSE                                                         18790012
188000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     18800012
188100             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 18810012
188200                                   TO ASC-SELECTED-SW             18820012
188300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   18830012
188400             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   18840012
188500         ELSE                                                     18850012
188600             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       18860012
188700                 CONTINUE                                         18870012
188800             ELSE                                                 18880012
188900*                -- ONLY ONE END-OF-RANGE ALLOWED --              18890012
189000                 MOVE PC-TSYMSG-00055                             18900012
189100                                   TO DP020-MSG-NUMBER            18910012
189200                 SET DP020-MSG-FATAL                              18920012
189300                                   TO TRUE                        18930012
189400                 MOVE -1           TO MR-SELECTL (PV-SUB)         18940012
189500                 SET DP030-SET-CURSOR-APPL-1                      18950012
189600                                   TO TRUE                        18960012
189700                 SET PS-ERROR      TO TRUE                        18970012
189800             END-IF                                               18980012
189900         END-IF                                                   18990012
190000     END-IF.                                                      19000012
190100                                                                  19010012
190200*----------------------------------------------------------------*19020012
190300*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *19030012
190400*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *19040012
190500*----------------------------------------------------------------*19050012
190600 3400-CHECK-RANGE-SEQUENCE.                                       19060012
190700                                                                  19070012
190800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       19080012
190900       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      19090012
191000       AND  ASC-START-OF-SELECTED-RANGE >                         19100012
191100                                         ASC-END-OF-SELECTED-RANGE19110012
191200*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                19120012
191300         MOVE PC-TSYMSG-00052      TO DP020-MSG-NUMBER            19130012
191400         SET DP020-MSG-FATAL       TO TRUE                        19140012
191500         SET PS-ERROR              TO TRUE                        19150012
191600         PERFORM 3410-POSITION-AT-ERROR                           19160012
191700     END-IF.                                                      19170012
191800                                                                  19180012
191900*----------------------------------------------------------------*19190012
192000*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *19200012
192100*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *19210012
192200*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *19220012
192300*----------------------------------------------------------------*19230012
192400 3410-POSITION-AT-ERROR.                                          19240012
192500                                                                  19250012
192600     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       19260012
192700                                                                  19270012
192800     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 19280012
192900                    - PV-TOP-ITEM + 1.                            19290012
193000                                                                  19300012
193100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      19310012
193200         CONTINUE                                                 19320012
193300     ELSE                                                         19330012
193400         MOVE -1                   TO MR-SELECTL (PV-SUB)         19340012
193500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         19350012
193600         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         19360012
193700     END-IF.                                                      19370012
193800                                                                  19380012
193900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   19390012
194000                    - PV-TOP-ITEM + 1.                            19400012
194100                                                                  19410012
194200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      19420012
194300         CONTINUE                                                 19430012
194400     ELSE                                                         19440012
194500         MOVE -1                   TO MR-SELECTL (PV-SUB)         19450012
194600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         19460012
194700         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         19470012
194800     END-IF.                                                      19480012
194900                                                                  19490012
195000/                                                                 19500012
195100*----------------------------------------------------------------*19510012
195200*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *19520012
195300*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *19530012
195400*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *19540012
195500*----------------------------------------------------------------*19550012
195600                                                                  19560012
195700 3500-MARK-RANGE-AS-SELECTED.                                     19570012
195800                                                                  19580012
195900     MOVE +1                       TO ASC-BLK-SUB.                19590012
196000                                                                  19600012
196100     PERFORM 3510-MARK-SELECTED-INDS                              19610012
196200         VARYING ASC-ITEM-SUB                                     19620012
196300         FROM 1 BY 1                                              19630012
196400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19640012
196500                                                                  19650012
196600     ADD +1                        TO ASC-BLK-SUB.                19660012
196700                                                                  19670012
196800     PERFORM 3510-MARK-SELECTED-INDS                              19680012
196900         VARYING ASC-ITEM-SUB                                     19690012
197000         FROM 1 BY 1                                              19700012
197100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19710012
197200                                                                  19720012
197300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               19730012
197400                                   TO PV-LIST-ITEM-NUMBER.        19740012
197500                                                                  19750012
197600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            19760012
197700         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         19770012
197800               PC-ITEMS-PER-PANEL).                               19780012
197900                                                                  19790012
198000     MOVE ASC-START-OF-SELECTED-RANGE                             19800012
198100                                   TO PV-START-OF-SELECTED-RANGE. 19810012
198200                                                                  19820012
198300     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            19830012
198400         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  19840012
198500               PC-ITEMS-PER-PANEL).                               19850012
198600                                                                  19860012
198700     MOVE ASC-END-OF-SELECTED-RANGE                               19870012
198800                                   TO PV-END-OF-SELECTED-RANGE.   19880012
198900                                                                  19890012
199000     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             19900012
199100         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    19910012
199200               PC-ITEMS-PER-PANEL).                               19920012
199300                                                                  19930012
199400     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             19940012
199500         PV-FIRST-BLOCK-IN-ARRAY + 1.                             19950012
199600                                                                  19960012
199700     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    19970012
199800        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        19980012
199900         MOVE +1                   TO ASC-BLK-SUB                 19990012
200000         PERFORM 5100-WRITE-TEMP-STORAGE                          20000012
200100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         20010012
200200             PV-FIRST-BLOCK-IN-ARRAY - 1                          20020012
200300                                                                  20030012
200400         PERFORM                                                  20040012
200500             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      20050012
200600                   PV-PREV-BLOCK-IN-ARRAY                         20060012
200700             MOVE PV-FIRST-BLOCK-IN-RANGE                         20070012
200800                                   TO PV-BLOCK-NUMBER             20080012
200900             PERFORM 4410-READ-TEMP-STORAGE                       20090012
201000             PERFORM 3510-MARK-SELECTED-INDS                      20100012
201100                 VARYING ASC-ITEM-SUB                             20110012
201200                 FROM 1 BY 1                                      20120012
201300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          20130012
201400             PERFORM 5100-WRITE-TEMP-STORAGE                      20140012
201500             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     20150012
201600         END-PERFORM                                              20160012
201700                                                                  20170012
201800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         20180012
201900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     20190012
202000         PERFORM                                                  20200012
202100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       20210012
202200                   PV-LAST-BLOCK-IN-RANGE                         20220012
202300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          20230012
202400                                   TO PV-BLOCK-NUMBER             20240012
202500             PERFORM 4410-READ-TEMP-STORAGE                       20250012
202600             PERFORM 3510-MARK-SELECTED-INDS                      20260012
202700                 VARYING ASC-ITEM-SUB                             20270012
202800                 FROM 1 BY 1                                      20280012
202900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          20290012
203000             PERFORM 5100-WRITE-TEMP-STORAGE                      20300012
203100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      20310012
203200         END-PERFORM                                              20320012
203300                                                                  20330012
203400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             20340012
203500                                   TO PV-BLOCK-NUMBER             20350012
203600         PERFORM 4410-READ-TEMP-STORAGE                           20360012
203700     END-IF.                                                      20370012
203800                                                                  20380012
203900     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 20390012
204000                                      ASC-END-OF-SELECTED-RANGE.  20400012
204100                                                                  20410012
204200/                                                                 20420012
204300*----------------------------------------------------------------*20430012
204400* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *20440012
204500*----------------------------------------------------------------*20450012
204600                                                                  20460012
204700 3510-MARK-SELECTED-INDS.                                         20470012
204800                                                                  20480012
204900     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) >         20490012
205000         ASC-START-OF-SELECTED-RANGE)                             20500012
205100     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =         20510012
205200         ASC-START-OF-SELECTED-RANGE)                             20520012
205300                                                                  20530012
205400         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) <     20540012
205500             ASC-END-OF-SELECTED-RANGE)                           20550012
205600         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =     20560012
205700             ASC-END-OF-SELECTED-RANGE)                           20570012
205800                                                                  20580012
205900             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          20590012
206000                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   20600012
206100                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   20610012
206200                                   TO TRUE                        20620012
206300                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              20630012
206400                                   TO TRUE                        20640012
206500                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS20650012
206600             END-IF                                               20660012
206700         END-IF                                                   20670012
206800     END-IF.                                                      20680012
206900                                                                  20690012
207000/                                                                 20700012
207100*----------------------------------------------------------------*20710012
207200*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *20720012
207300*    INITIALIZE ALL COUNTERS AND FLAGS.                          *20730012
207400*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *20740012
207500*    DISPLAY THE PANEL TO USER.                                  *20750012
207600*----------------------------------------------------------------*20760012
207700                                                                  20770012
207800 4000-BUILD-INITIAL-PANEL.                                        20780012
207900                                                                  20790012
208000     INITIALIZE ASC-BLOCK-ENTRIES (1)                             20800012
208100                ASC-BLOCK-ENTRIES (2).                            20810012
208200                                                                  20820012
208300     MOVE +1                       TO ASC-BLK-SUB.                20830012
208400                                                                  20840012
208500     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       20850012
208600                                                                  20860012
208700     MOVE +0                       TO ASC-ITEM-SUB                20870012
208800                                      ASC-NUMBER-OF-ITEMS-READ    20880012
208900                                      ASC-NUMBER-OF-SELECTED-ITEMS20890012
209000                                      ASC-HIGHEST-BLOCK-WRITTEN   20900012
209100                                      ASC-START-OF-SELECTED-RANGE 20910012
209200                                      ASC-END-OF-SELECTED-RANGE   20920012
209300                                      ASC-ITEM-AT-TOP-OF-PANEL.   20930012
209400                                                                  20940012
209500     PERFORM 4100-PREPARE-CURSOR.                                 20950012
209600                                                                  20960012
209700     MOVE ZEROES                   TO PV-PO-LNE-NBR.              20970012
209800     MOVE AP300-STORE-NBR          TO PV-STORE-NBR.               20980012
209810     MOVE AP300-DC-NBR             TO PV-DC-NBR.                  20981027
209820     MOVE AP300-MTCH-LVL-IND       TO PV-MTCH-LVL-CDE.            20982028
209900                                                                  20990012
210000     PERFORM 4010-OPEN-CURSOR.                                    21000012
210100                                                                  21010012
210200     PERFORM 4300-READ-ITEMS-FROM-DB.                             21020012
210300                                                                  21030012
210400     PERFORM 4020-CLOSE-CURSOR.                                   21040012
210500                                                                  21050012
210600     MOVE +1                       TO PV-TOP-ITEM.                21060012
210700                                                                  21070012
210800     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          21080012
210900         SET DP020-NEXT-ACT-APPL-ERROR                            21090012
211000                                   TO TRUE                        21100012
211100         SET DP020-MSG-FATAL       TO TRUE                        21110012
211200         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            21120012
211300     ELSE                                                         21130012
211400         MOVE -1                   TO MR-SELECTL (1)              21140012
211500         SET DP030-SET-CURSOR-APPL-1                              21150012
211600                                   TO TRUE                        21160012
211700         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     21170012
211800     END-IF.                                                      21180012
211900                                                                  21190012
212000/                                                                 21200012
212100*----------------------------------------------------------------*21210012
212200* OPEN THE PO LINE ITEM CURSOR                                   *21220012
212300*----------------------------------------------------------------*21230012
212400                                                                  21240012
212500 4010-OPEN-CURSOR.                                                21250012
212600                                                                  21260012
212700     PERFORM                                                      21270012
212800         WITH TEST AFTER                                          21280012
212900         VARYING PV-RETRY-COUNTER                                 21290012
213000         FROM 1 BY 1                                              21300012
213100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21310012
213200            OR (SQLCODE = +0))                                    21320012
213300                                                                  21330012
213400         EVALUATE TRUE                                            21340012
213500                                                                  21350012
213600             WHEN ASC-ITEM-CURSOR                                 21360012
213700                  EXEC SQL                                        21370012
213800                      OPEN ITEM-CSR                               21380012
213900                  END-EXEC                                        21390012
214000                                                                  21400012
214100             WHEN ASC-VEND-STYLE-CURSOR                           21410012
214200                  EXEC SQL                                        21420012
214300                      OPEN VEND-STYLE-CSR                         21430012
214400                  END-EXEC                                        21440012
214500                                                                  21450012
214600         END-EVALUATE                                             21460012
214700                                                                  21470012
214800         EVALUATE TRUE                                            21480012
214900             WHEN SQLCODE = +0                                    21490012
215000                  CONTINUE                                        21500012
215100             WHEN SQLCODE = -904                                  21510012
215200             WHEN SQLCODE = -913                                  21520012
215300                  CONTINUE                                        21530012
215400             WHEN SQLWARN0 NOT = SPACE                            21540012
215500             WHEN SQLCODE  NOT = +0                               21550012
215600                  MOVE '4010-OPEN-CURSOR'                         21560012
215700                                   TO DP013-PARAGRAPH             21570012
215800                  MOVE 'OPEN APP/ITEM-CSR CURSOR'                 21580012
215900                                   TO DP013-MESSAGE-TEXT (1)      21590012
216000                  MOVE SQLCA       TO DP013-SQLCA                 21600012
216100                  MOVE 'TPURITM'   TO DP013-DB2-TABLE-NAME (1)    21610012
216200                  MOVE 'TSKXREF'   TO DP013-DB2-TABLE-NAME (2)    21620017
216300                  SET DP013-DB2-ABEND                             21630012
216400                                   TO TRUE                        21640012
216500                  PERFORM DP013-0000-PROCESS-ABEND                21650012
216600         END-EVALUATE                                             21660012
216700     END-PERFORM.                                                 21670012
216800                                                                  21680012
216900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        21690012
217000         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             21700012
217100         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              21710012
217200                                   TO DP013-MESSAGE-TEXT (1)      21720012
217300         MOVE SQLCA                TO DP013-SQLCA                 21730012
217400         SET DP013-DB2-ABEND       TO TRUE                        21740012
217500         PERFORM DP013-0000-PROCESS-ABEND                         21750012
217600     END-IF.                                                      21760012
217700                                                                  21770012
217800/                                                                 21780012
217900*----------------------------------------------------------------*21790012
218000* CLOSE THE PO LINE ITEM CURSOR                                  *21800012
218100*----------------------------------------------------------------*21810012
218200                                                                  21820012
218300 4020-CLOSE-CURSOR.                                               21830012
218400                                                                  21840012
218500     EVALUATE TRUE                                                21850012
218600                                                                  21860012
218700         WHEN ASC-ITEM-CURSOR                                     21870012
218800              EXEC SQL                                            21880012
218900                  CLOSE ITEM-CSR                                  21890012
219000              END-EXEC                                            21900012
219100                                                                  21910012
219200         WHEN ASC-VEND-STYLE-CURSOR                               21920012
219300              EXEC SQL                                            21930012
219400                  CLOSE VEND-STYLE-CSR                            21940012
219500              END-EXEC                                            21950012
219600                                                                  21960012
219700     END-EVALUATE.                                                21970012
219800                                                                  21980012
219900     EVALUATE TRUE                                                21990012
220000         WHEN SQLCODE = +0                                        22000012
220100              CONTINUE                                            22010012
220200                                                                  22020012
220300         WHEN SQLWARN0 NOT = SPACE                                22030012
220400         WHEN SQLCODE  NOT = +0                                   22040012
220500              MOVE '4020-CLOSE-CURSOR'                            22050012
220600                                   TO DP013-PARAGRAPH             22060012
220700              MOVE 'CLOSE APP/ITEM-CSR CURSOR'                    22070012
220800                                   TO DP013-MESSAGE-TEXT (1)      22080012
220900              MOVE SQLCA           TO DP013-SQLCA                 22090012
221000              MOVE 'TPURITM'       TO DP013-DB2-TABLE-NAME (1)    22100012
221100              MOVE 'TSKXREF'       TO DP013-DB2-TABLE-NAME (2)    22110017
221200              SET DP013-DB2-ABEND  TO TRUE                        22120012
221300              PERFORM DP013-0000-PROCESS-ABEND                    22130012
221400     END-EVALUATE.                                                22140012
221500                                                                  22150012
221600/                                                                 22160012
221700*----------------------------------------------------------------*22170012
221800*    DEPENDING ON WHAT WAS PASSED IN THE COMMAREA, SETUP THE     *22180012
221900*    DB2 KEYS IN PREPARATION FOR THE OPEN CURSROR.               *22190012
222000*----------------------------------------------------------------*22200012
222100                                                                  22210012
222200 4100-PREPARE-CURSOR.                                             22220012
222300                                                                  22230012
222400     MOVE ASC-KEY-PO-NBR         TO DK-PO-NBR.                    22240012
222500     MOVE ASC-KEY-INVOICE-NBR    TO DK-INVOICE-NBR.               22250012
222600                                                                  22260012
222700/                                                                 22270012
222800*----------------------------------------------------------------*22280012
222900*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *22290012
223000*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *22300012
223100*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *22310012
223200*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *22320012
223300*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *22330012
223400*                                                                *22340012
223500*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *22350012
223600*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *22360012
223700*    UPON INITIALIZATION.                                        *22370012
223800*----------------------------------------------------------------*22380012
223900                                                                  22390012
224000 4300-READ-ITEMS-FROM-DB.                                         22400012
224100                                                                  22410012
224200     PERFORM                                                      22420012
224300         VARYING PV-READ-COUNT                                    22430012
224400         FROM 1 BY 1                                              22440012
224500         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    22450012
224600            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         22460012
224700                                                                  22470012
224800         PERFORM 4310-FETCH                                       22480012
224900                                                                  22490012
225000         IF  ASC-ITEMS-LEFT-ON-DB                                 22500012
225100             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                22510012
225200                 ADD +1            TO ASC-ITEM-SUB                22520012
225300             ELSE                                                 22530012
225400                 ADD +1            TO ASC-BLK-SUB                 22540012
225500                 MOVE +1           TO ASC-ITEM-SUB                22550012
225600                                                                  22560012
225700                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         22570012
225800                     MOVE +1       TO ASC-BLK-SUB                 22580012
225900                     SET ASC-BLOCK-MODIFIED (1)                   22590012
226000                                   TO TRUE                        22600012
226100                     PERFORM 5100-WRITE-TEMP-STORAGE              22610012
226200                     MOVE ASC-BLOCK-ENTRIES                       22620012
226300                               (PC-MAX-BLOCKS-IN-ARRAY)           22630012
226400                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 22640012
226500                     ADD +1        TO ASC-BLK-SUB                 22650012
226600                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   22660012
226700                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      22670012
226800                                   TO TRUE                        22680012
226900                 END-IF                                           22690012
227000             END-IF                                               22700012
227100             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    22710012
227200             MOVE ASC-NUMBER-OF-ITEMS-READ                        22720012
227300                                   TO ASC-LIST-ITEM-NUMBER        22730012
227400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22740012
227500             IF  ASC-ITEM-CURSOR                                  22750012
227600                 IF ASC-APPROVED                                  22760012
227700                     MOVE PURITM-APP-PO-LNE-NBR                   22770012
227800                                   TO ASC-APP-PO-LNE-NBR          22780012
227900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22790012
228000                     MOVE ZEROES   TO ASC-PO-LNE-VAR-NBR          22800012
228100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22810012
228200                 ELSE                                             22820012
228300                     MOVE PURITM-PO-LNE-NBR                       22830012
228400                                   TO ASC-PO-LNE-VAR-NBR          22840012
228500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22850012
228600                     MOVE ZEROES   TO ASC-APP-PO-LNE-NBR          22860012
228700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22870012
228800                 END-IF                                           22880012
228900             ELSE                                                 22890012
229000                 IF ASC-APPROVED                                  22900012
229100                     MOVE ZEROES   TO ASC-PO-LNE-VAR-NBR          22910012
229200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22920012
229300                     MOVE PURITM-APP-PO-LNE-NBR                   22930012
229400                                   TO ASC-APP-PO-LNE-NBR          22940012
229500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22950012
229600                 ELSE                                             22960012
229700                     MOVE PURITM-PO-LNE-NBR                       22970012
229800                                   TO ASC-PO-LNE-VAR-NBR          22980012
229900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22990012
230000                     MOVE ZEROES   TO ASC-APP-PO-LNE-NBR          23000012
230100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23010012
230200                 END-IF                                           23020012
230300             END-IF                                               23030012
230400             MOVE PURITM-PO-LNE-NBR                               23040012
230500                                   TO ASC-PO-LNE-NBR              23050012
230600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23060012
230700             MOVE ASC-KEY-DEPT-NBR TO DK-DEPT-NBR                 23070015
230800             MOVE PV-SKU-NBR       TO ASC-SKU-NBR                 23080014
230900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23090014
231000             MOVE PURITM-VEND-STYL-NAME                           23100012
231100                                   TO ASC-VEND-STYL-NAME          23110012
231200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23120012
231300             MOVE PURITM-SKU-DESC  TO ASC-SKU-DESC                23130012
231400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23140012
231500             MOVE PURITM-COLOR-CDE TO ASC-COLOR-CODE              23150012
231600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23160012
231700             MOVE PURITM-SIZE-CDE  TO ASC-SIZE-CODE               23170012
231800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23180012
231900             MOVE PURITM-COLOR-DESC                               23190012
232000                                   TO ASC-COLOR                   23200012
232100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23210012
232200             MOVE PURITM-SIZE-DESC TO ASC-SIZE                    23220012
232300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23230012
232400             PERFORM 4340-GET-UPC-INFO                            23240012
232500             MOVE PV-UPC-NBR-DISPLAY                              23250012
232600                                   TO ASC-UPC                     23260012
232700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23270012
232800             PERFORM 4360-GET-RCVG-INFO                           23280012
232900         END-IF                                                   23290012
233000     END-PERFORM.                                                 23300012
233100                                                                  23310012
233200     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          23320012
233300         MOVE +1                   TO ASC-BLK-SUB                 23330012
233400         PERFORM 5100-WRITE-TEMP-STORAGE                          23340012
233500         ADD +1                    TO ASC-BLK-SUB                 23350012
233600         PERFORM 5100-WRITE-TEMP-STORAGE                          23360012
233700                                                                  23370012
233800         MOVE 1                    TO ASC-BLK-SUB                 23380012
233900                                      PV-BLOCK-NUMBER             23390012
234000         PERFORM 4410-READ-TEMP-STORAGE                           23400012
234100         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             23410012
234200             MOVE 2                TO ASC-BLK-SUB                 23420012
234300                                      PV-BLOCK-NUMBER             23430012
234400             PERFORM 4410-READ-TEMP-STORAGE                       23440012
234500         END-IF                                                   23450012
234600     END-IF.                                                      23460012
234700                                                                  23470012
234800/                                                                 23480012
234900*----------------------------------------------------------------*23490012
235000*    FETCH A VENDOR ROW                                          *23500012
235100*----------------------------------------------------------------*23510012
235200                                                                  23520012
235300 4310-FETCH.                                                      23530012
235400                                                                  23540012
235500     EVALUATE TRUE                                                23550012
235600                                                                  23560012
235700         WHEN ASC-ITEM-CURSOR                                     23570012
235800              EXEC SQL                                            23580012
235900                  FETCH ITEM-CSR                                  23590012
236000                   INTO :PURITM-PO-LNE-NBR                        23600012
236100                       ,:PURITM-APP-PO-LNE-NBR                    23610012
236200                       ,:PURITM-CL-NBR                            23620012
236300                       ,:PURITM-SKU-SEQ-NBR                       23630012
236400                       ,:PURITM-VEND-STYL-NAME                    23640012
236500                       ,:PURITM-SKU-DESC                          23650012
236600                       ,:PURITM-UNT-QTY                           23660012
236700                       ,:PURITM-COLOR-CDE                         23670012
236800                       ,:PURITM-COLOR-DESC                        23680012
236900                       ,:PURITM-SIZE-CDE                          23690012
237000                       ,:PURITM-SIZE-DESC                         23700012
237100                       ,:PURITM-ITM-NBR                           23710012
237200                       ,:PURITM-RMS-PO-SKU-NBR                    23720012
237300               END-EXEC                                           23730012
237400                                                                  23740012
237500         WHEN ASC-VEND-STYLE-CURSOR                               23750012
237600              EXEC SQL                                            23760012
237700                  FETCH VEND-STYLE-CSR                            23770012
237800                   INTO :PURITM-PO-LNE-NBR                        23780012
237900                       ,:PURITM-APP-PO-LNE-NBR                    23790012
238000                       ,:PURITM-CL-NBR                            23800012
238100                       ,:PURITM-SKU-SEQ-NBR                       23810012
238200                       ,:PURITM-VEND-STYL-NAME                    23820012
238300                       ,:PURITM-SKU-DESC                          23830012
238400                       ,:PURITM-UNT-QTY                           23840012
238500                       ,:PURITM-COLOR-CDE                         23850012
238600                       ,:PURITM-COLOR-DESC                        23860012
238700                       ,:PURITM-SIZE-CDE                          23870012
238800                       ,:PURITM-SIZE-DESC                         23880012
238900                       ,:PURITM-ITM-NBR                           23890012
239000                       ,:PURITM-RMS-PO-SKU-NBR                    23900012
239100               END-EXEC                                           23910012
239200                                                                  23920012
239300     END-EVALUATE                                                 23930012
239400                                                                  23940012
239500     EVALUATE TRUE                                                23950012
239600         WHEN SQLCODE = +0                                        23960012
239700              IF PURITM-RMS-PO-SKU-NBR NOT = 0                    23970019
239800                 MOVE PURITM-RMS-PO-SKU-NBR TO PV-SKU-NBR         23980019
239900              ELSE                                                23990019
240000                 IF PURITM-ITM-NBR = 0                            24000019
240100                    MOVE ZEROES             TO PV-SKU-NBR         24010019
240200                 ELSE                                             24020019
240300                    PERFORM 4320-SELECT-SKU                       24030019
240400                    MOVE SKXREF-SKU         TO PV-SKU-NBR         24040019
240500                 END-IF                                           24050019
240600              END-IF                                              24060019
240700         WHEN SQLCODE = +100                                      24070012
240800              SET ASC-NO-ITEMS-LEFT-ON-DB                         24080012
240900                                   TO TRUE                        24090012
241000         WHEN SQLWARN0 NOT = SPACE                                24100012
241100         WHEN SQLCODE < +0                                        24110012
241200         WHEN SQLCODE > +0                                        24120012
241300              MOVE '4310-FETCH-CURSOR'                            24130012
241400                                   TO DP013-PARAGRAPH             24140012
241500              MOVE 'FETCH APP/ITEM CURSOR'                        24150012
241600                                   TO DP013-MESSAGE-TEXT (1)      24160012
241700              MOVE SQLCA           TO DP013-SQLCA                 24170012
241800              MOVE 'TPURITM'       TO DP013-DB2-TABLE-NAME (1)    24180012
241900              MOVE '       '       TO DP013-DB2-TABLE-NAME (2)    24190019
242000              SET DP013-DB2-ABEND  TO TRUE                        24200012
242100              PERFORM DP013-0000-PROCESS-ABEND                    24210012
242200     END-EVALUATE.                                                24220012
242300                                                                  24230012
242400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        24240012
242500         MOVE '4310-FETCH-CURSOR'  TO DP013-PARAGRAPH             24250012
242600         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             24260012
242700                                   TO DP013-MESSAGE-TEXT (1)      24270012
242800         MOVE SQLCA                TO DP013-SQLCA                 24280012
242900         SET DP013-DB2-ABEND                                      24290012
243000             DP013-XCTL-DISPLAY-RESTART                           24300012
243100                                   TO TRUE                        24310012
243200         PERFORM DP013-0000-PROCESS-ABEND                         24320012
243300     END-IF.                                                      24330012
243400                                                                  24340012
243500/                                                                 24350012
243600*----------------------------------------------------------------*24360012
243700* SELECTS THE SKU FROM TSKXREF.                                  *24370019
243800*----------------------------------------------------------------*24380012
243900 4320-SELECT-SKU.                                                 24390019
244000                                                                  24400012
244100     EXEC SQL                                                     24410019
244200        SELECT B.SKU                                              24420019
244300          INTO :SKXREF-SKU                                        24430019
244400         FROM TSKXREF B                                           24440019
244500        WHERE B.ITM_NBR        = :PURITM-ITM-NBR                  24450019
244600     END-EXEC.                                                    24460019
244700                                                                  24470019
244800     EVALUATE TRUE                                                24480012
244900         WHEN SQLCODE = +0                                        24490012
245000           CONTINUE                                               24500019
245100                                                                  24510012
245200         WHEN SQLWARN0 NOT = SPACES                               24520012
245300         WHEN SQLCODE  NOT = ZERO                                 24530019
245400         WHEN SQLCODE > +0                                        24540012
245500             MOVE '4320-SELECT-SKU  '                             24550019
245600                               TO DP013-PARAGRAPH                 24560012
245700             MOVE 'UNSUCCESSFUL SELECT OF SKU'                    24570019
245800                               TO DP013-MESSAGE-TEXT (1)          24580012
245900             MOVE SQLCA        TO DP013-SQLCA                     24590012
246000             MOVE 'TSKXREF'    TO DP013-DB2-TABLE-NAME (1)        24600019
246100             MOVE '       '    TO DP013-DB2-TABLE-NAME (2)        24610012
246200             SET DP013-DB2-ABEND                                  24620012
246300                 DP013-XCTL-DISPLAY-RESTART                       24630012
246400                               TO TRUE                            24640012
246500             PERFORM DP013-0000-PROCESS-ABEND                     24650012
246600     END-EVALUATE.                                                24660012
246700                                                                  24670012
246800/                                                                 24680019
246900*----------------------------------------------------------------*24690019
247000* SELECT A ROW FROM THE DB2 TUPCSKU TABLE.                       *24700019
247100*----------------------------------------------------------------*24710019
247200 4340-GET-UPC-INFO.                                               24720019
247300                                                                  24730019
247400     EXEC SQL                                                     24740019
247500         SELECT DISTINCT                                          24750019
247600              A.UPC_NBR                                           24760019
247700          INTO :TUPCSKU-UPC-NBR                                   24770019
247800          FROM TUPCSKU A                                          24780019
247900         WHERE A.ITEM_NBR         = :PURITM-ITM-NBR               24790019
247910           AND A.EDI_ORD_IND      = :PC-Y-CODE                    24791035
248000*          AND (A.UPC_NBR NOT BETWEEN                             24800035
248100*              :PC-MIN-UPC AND :PC-MAX-UPC)                       24810035
248200     END-EXEC.                                                    24820019
248300                                                                  24830019
248400     EVALUATE TRUE                                                24840019
248500         WHEN SQLCODE = +0                                        24850019
248600           MOVE TUPCSKU-UPC-NBR  TO PV-UPC-NBR                    24860019
248700           STRING PV-UPC-NBR-X(3:2)  DELIMITED BY SIZE            24870022
248800                  '-'                DELIMITED BY SIZE            24880019
248900                  PV-UPC-NBR-X(5:5)  DELIMITED BY SIZE            24890019
249000                  '-'                DELIMITED BY SIZE            24900019
249100                  PV-UPC-NBR-X(10:5) DELIMITED BY SIZE            24910019
249200                  '-'                DELIMITED BY SIZE            24920019
249300                  PV-UPC-NBR-X(15:1) DELIMITED BY SIZE            24930019
249400                               INTO PV-UPC-NBR-DISPLAY            24940019
249500                                                                  24950019
249600         WHEN SQLCODE = +100                                      24960019
249700           MOVE PC-NO-VENDOR-UPC TO PV-UPC-NBR-DISPLAY            24970019
249800                                                                  24980019
249900         WHEN SQLCODE = -811                                      24990019
250000           MOVE PC-MULTIPLE-UPC  TO PV-UPC-NBR-DISPLAY            25000019
250100                                                                  25010019
250200         WHEN SQLWARN0 NOT = SPACES                               25020019
250300         WHEN SQLCODE < +0                                        25030019
250400         WHEN SQLCODE > +0                                        25040019
250500             MOVE '4340-GET-UPC-INFO'                             25050019
250600                               TO DP013-PARAGRAPH                 25060019
250700             MOVE 'SELECT UPC INFO  '                             25070019
250800                               TO DP013-MESSAGE-TEXT (1)          25080019
250900             MOVE SQLCA        TO DP013-SQLCA                     25090019
251000             MOVE 'TUPCSKU'    TO DP013-DB2-TABLE-NAME (1)        25100019
251100             MOVE '       '    TO DP013-DB2-TABLE-NAME (2)        25110019
251200             SET DP013-DB2-ABEND                                  25120019
251300                 DP013-XCTL-DISPLAY-RESTART                       25130019
251400                               TO TRUE                            25140019
251500             PERFORM DP013-0000-PROCESS-ABEND                     25150019
251600     END-EVALUATE.                                                25160019
251700                                                                  25170019
251800/                                                                 25180019
251900*----------------------------------------------------------------*25190019
252000 4360-GET-RCVG-INFO.                                              25200019
252100                                                                  25210019
252200     EVALUATE TRUE                                                25220028
252210         WHEN PV-MTCH-LVL-CDE = 'P'                               25221028
252300             PERFORM 4361-SELECT-BULK-QTY                         25230028
252400         WHEN PV-MTCH-LVL-CDE = 'S'                               25240028
252500             PERFORM 4362-SELECT-STORE-QTY                        25250028
252510         WHEN PV-MTCH-LVL-CDE = 'D'                               25251028
252520             PERFORM 4363-SELECT-DC-QTY                           25252028
252600     END-EVALUATE.                                                25260028
252700                                                                  25270019
252800     IF PV-VER-QTY-NULL < ZERO                                    25280019
252900        MOVE ZEROES           TO                                  25290019
253000                 ASC-QTY-RCVD (ASC-BLK-SUB ASC-ITEM-SUB)          25300019
253100     ELSE                                                         25310019
253200        MOVE RECDIS-AP-VERIFY-ITM-QTY TO                          25320019
253300                 ASC-QTY-RCVD (ASC-BLK-SUB ASC-ITEM-SUB)          25330019
253400     END-IF.                                                      25340019
253500                                                                  25350019
253600     IF PV-NON-INVC-QTY-NULL < ZERO                               25360019
253700         CONTINUE                                                 25370019
253800     ELSE                                                         25380019
253900         ADD NINREC-NON-INVC-UNT-QTY TO                           25390019
254000                 ASC-QTY-RCVD (ASC-BLK-SUB ASC-ITEM-SUB)          25400019
254100     END-IF.                                                      25410019
254200                                                                  25420019
254300                                                                  25430019
254400                                                                  25440019
254500*----------------------------------------------------------------*25450019
254600*  RETRIEVES THE QUANTITY FOR A SPECIFIED PO AND PO LINE NUMBER  *25460019
254700*  COMBINATION.                                                  *25470019
254800*----------------------------------------------------------------*25480019
254900 4361-SELECT-BULK-QTY.                                            25490019
255000                                                                  25500019
255100     EXEC SQL                                                     25510019
255200                                                                  25520019
255300         SELECT SUM(AP_VERIFY_ITM_QTY)                            25530019
255400          INTO :RECDIS-AP-VERIFY-ITM-QTY:PV-VER-QTY-NULL          25540019
255500          FROM TRECDIS RD                                         25550019
255600              ,TRECEIV RV                                         25560019
255700          WHERE RV.ORD_NBR        = :ASC-KEY-PO-NBR               25570019
255800           AND  RV.ORD_NBR        = RD.ORD_NBR                    25580019
255900           AND  RD.ORD_LNE_NBR    = :PURITM-APP-PO-LNE-NBR        25590019
256000           AND  RD.AP_PRC_CDE     = ' '                           25600019
256100           AND  RV.AP_PRC_CDE     = ' '                           25610019
256200           AND  RD.VER_STATUS_CDE = 'A'                           25620019
256300           AND  RV.VER_STATUS_CDE = 'A'                           25630019
256400           AND  RV.REC_SEQ_NBR    = RD.REC_SEQ_NBR                25640019
256500           AND  RV.STATUS_CDE     = 'VE'                          25650019
256600                                                                  25660019
256700     END-EXEC.                                                    25670019
256800                                                                  25680019
256900     EVALUATE TRUE                                                25690019
257000         WHEN SQLCODE = +0                                        25700019
257100             CONTINUE                                             25710019
257200         WHEN SQLWARN0 NOT = SPACES                               25720019
257300         WHEN SQLCODE < +0                                        25730019
257400         WHEN SQLCODE > +0                                        25740019
257500             MOVE '4361-SELECT-BULK-QTY'                          25750019
257600                               TO DP013-PARAGRAPH                 25760019
257700             MOVE 'UNSUCCESSFUL SELECT     '                      25770019
257800                               TO DP013-MESSAGE-TEXT (1)          25780019
257900             MOVE SQLCA        TO DP013-SQLCA                     25790019
258000             MOVE 'TRECDIS'    TO DP013-DB2-TABLE-NAME (1)        25800019
258100             MOVE 'TRECEIV'    TO DP013-DB2-TABLE-NAME (2)        25810019
258200             SET DP013-DB2-ABEND                                  25820019
258300                 DP013-XCTL-DISPLAY-RESTART                       25830019
258400                               TO TRUE                            25840019
258500             PERFORM DP013-0000-PROCESS-ABEND                     25850019
258600     END-EVALUATE.                                                25860019
258700                                                                  25870019
258800     EXEC SQL                                                     25880019
258900                                                                  25890019
259000         SELECT SUM(NON_INVC_UNT_QTY)                             25900019
259100          INTO :NINREC-NON-INVC-UNT-QTY:PV-NON-INVC-QTY-NULL      25910019
259200          FROM TNINREC                                            25920019
259300         WHERE PO_NBR          = :ASC-KEY-PO-NBR                  25930019
259400           AND PO_LNE_NBR      = :PURITM-APP-PO-LNE-NBR           25940019
259500           AND STATUS_CDE      = ' '                              25950019
259600                                                                  25960019
259700     END-EXEC.                                                    25970019
259800                                                                  25980019
259900     EVALUATE TRUE                                                25990019
260000         WHEN SQLCODE = +0                                        26000019
260100             CONTINUE                                             26010019
260200         WHEN SQLWARN0 NOT = SPACES                               26020019
260300         WHEN SQLCODE < +0                                        26030019
260400         WHEN SQLCODE > +0                                        26040019
260500             MOVE '4361-SELECT-BULK-QTY'                          26050019
260600                               TO DP013-PARAGRAPH                 26060019
260700             MOVE 'UNSUCCESSFUL SELECT     '                      26070019
260800                               TO DP013-MESSAGE-TEXT (1)          26080019
260900             MOVE SQLCA        TO DP013-SQLCA                     26090019
261000             MOVE 'TNINREC'    TO DP013-DB2-TABLE-NAME (1)        26100019
261100             SET DP013-DB2-ABEND                                  26110019
261200                 DP013-XCTL-DISPLAY-RESTART                       26120019
261300                               TO TRUE                            26130019
261400             PERFORM DP013-0000-PROCESS-ABEND                     26140019
261500     END-EVALUATE.                                                26150019
261600                                                                  26160019
261700                                                                  26170019
261800*----------------------------------------------------------------*26180019
261900*  RETRIEVES THE QUANTITY FOR A SPECIFIED PO, STORE, AND PO      *26190019
262000*  LINE NUMBER COMBINATION.                                      *26200019
262100*----------------------------------------------------------------*26210019
262200 4362-SELECT-STORE-QTY.                                           26220019
262300                                                                  26230019
262400     EXEC SQL                                                     26240019
262500                                                                  26250019
262600         SELECT SUM(AP_VERIFY_ITM_QTY)                            26260019
262700          INTO :RECDIS-AP-VERIFY-ITM-QTY:PV-VER-QTY-NULL          26270019
262800          FROM TRECDIS RD                                         26280019
262900              ,TRECEIV RV                                         26290019
263000          WHERE RV.ORD_NBR        = :ASC-KEY-PO-NBR               26300019
263100           AND  RV.ORD_NBR        = RD.ORD_NBR                    26310019
263200           AND  RD.STR_NBR        = :PV-STORE-NBR                 26320019
263300           AND  RD.ORD_LNE_NBR    = :PURITM-APP-PO-LNE-NBR        26330019
263400           AND  RD.AP_PRC_CDE     = ' '                           26340019
263500           AND  RV.AP_PRC_CDE     = ' '                           26350019
263600           AND  RD.VER_STATUS_CDE = 'A'                           26360019
263700           AND  RV.VER_STATUS_CDE = 'A'                           26370019
263800           AND  RV.REC_SEQ_NBR    = RD.REC_SEQ_NBR                26380019
263900           AND  RV.STATUS_CDE     = 'VE'                          26390019
264000                                                                  26400019
264100     END-EXEC.                                                    26410019
264200                                                                  26420019
264300     EVALUATE TRUE                                                26430019
264400         WHEN SQLCODE = +0                                        26440019
264500             CONTINUE                                             26450019
264600         WHEN SQLWARN0 NOT = SPACES                               26460019
264700         WHEN SQLCODE < +0                                        26470019
264800         WHEN SQLCODE > +0                                        26480019
264900             MOVE '4362-SELECT-STORE-QTY'                         26490019
265000                               TO DP013-PARAGRAPH                 26500019
265100             MOVE 'UNSUCCESSFUL SELECT     '                      26510019
265200                               TO DP013-MESSAGE-TEXT (1)          26520019
265300             MOVE SQLCA        TO DP013-SQLCA                     26530019
265400             MOVE 'TRECDIS'    TO DP013-DB2-TABLE-NAME (1)        26540019
265500             MOVE 'TRECEIV'    TO DP013-DB2-TABLE-NAME (2)        26550019
265600             SET DP013-DB2-ABEND                                  26560019
265700                 DP013-XCTL-DISPLAY-RESTART                       26570019
265800                               TO TRUE                            26580019
265900             PERFORM DP013-0000-PROCESS-ABEND                     26590019
266000     END-EVALUATE.                                                26600019
266100                                                                  26610019
266200     EXEC SQL                                                     26620019
266300                                                                  26630019
266400         SELECT SUM(NON_INVC_UNT_QTY)                             26640019
266500          INTO :NINREC-NON-INVC-UNT-QTY:PV-NON-INVC-QTY-NULL      26650019
266600          FROM TNINREC                                            26660019
266700         WHERE PO_NBR          = :ASC-KEY-PO-NBR                  26670019
266800           AND STR_NBR         = :PV-STORE-NBR                    26680019
266900           AND PO_LNE_NBR      = :PURITM-APP-PO-LNE-NBR           26690019
267000           AND STATUS_CDE      = ' '                              26700019
267100                                                                  26710019
267200     END-EXEC.                                                    26720019
267300                                                                  26730019
267400     EVALUATE TRUE                                                26740019
267500         WHEN SQLCODE = +0                                        26750019
267600             CONTINUE                                             26760019
267700         WHEN SQLWARN0 NOT = SPACES                               26770019
267800         WHEN SQLCODE < +0                                        26780019
267900         WHEN SQLCODE > +0                                        26790019
268000             MOVE '4362-SELECT-STORE-QTY'                         26800019
268100                               TO DP013-PARAGRAPH                 26810019
268200             MOVE 'UNSUCCESSFUL SELECT     '                      26820019
268300                               TO DP013-MESSAGE-TEXT (1)          26830019
268400             MOVE SQLCA        TO DP013-SQLCA                     26840019
268500             MOVE 'TNINREC'    TO DP013-DB2-TABLE-NAME (1)        26850019
268600             SET DP013-DB2-ABEND                                  26860019
268700                 DP013-XCTL-DISPLAY-RESTART                       26870019
268800                               TO TRUE                            26880019
268900             PERFORM DP013-0000-PROCESS-ABEND                     26890019
269000     END-EVALUATE.                                                26900019
269100/                                                                 26910019
269110 4363-SELECT-DC-QTY.                                              26911028
269120                                                                  26912028
269130     EXEC SQL                                                     26913028
269140                                                                  26914028
269150         SELECT SUM(AP_VERIFY_ITM_QTY)                            26915028
269160          INTO :RECDIS-AP-VERIFY-ITM-QTY:PV-VER-QTY-NULL          26916028
269170          FROM TRECDIS RD                                         26917028
269180              ,TRECEIV RV                                         26918028
269190          WHERE RV.ORD_NBR        = :ASC-KEY-PO-NBR               26919028
269191           AND  RV.ORD_NBR        = RD.ORD_NBR                    26919128
269192           AND  RD.OPER_UNT_ID    = :PV-DC-NBR                    26919229
269193           AND  RD.ORD_LNE_NBR    = :PURITM-APP-PO-LNE-NBR        26919328
269194           AND  RD.AP_PRC_CDE     = ' '                           26919428
269195           AND  RV.AP_PRC_CDE     = ' '                           26919528
269196           AND  RD.VER_STATUS_CDE = 'A'                           26919628
269197           AND  RV.VER_STATUS_CDE = 'A'                           26919728
269198           AND  RV.REC_SEQ_NBR    = RD.REC_SEQ_NBR                26919828
269199           AND  RV.STATUS_CDE     = 'VE'                          26919928
269200                                                                  26920028
269201     END-EXEC.                                                    26920128
269202                                                                  26920228
269203     EVALUATE TRUE                                                26920328
269204         WHEN SQLCODE = +0                                        26920428
269205             CONTINUE                                             26920528
269206         WHEN SQLWARN0 NOT = SPACES                               26920628
269207         WHEN SQLCODE < +0                                        26920728
269208         WHEN SQLCODE > +0                                        26920828
269209             MOVE '4363-SELECT-DC-QTY'                            26920928
269210                               TO DP013-PARAGRAPH                 26921028
269211             MOVE 'UNSUCCESSFUL SELECT     '                      26921128
269212                               TO DP013-MESSAGE-TEXT (1)          26921228
269213             MOVE SQLCA        TO DP013-SQLCA                     26921328
269214             MOVE 'TRECDIS'    TO DP013-DB2-TABLE-NAME (1)        26921428
269215             MOVE 'TRECEIV'    TO DP013-DB2-TABLE-NAME (2)        26921528
269216             SET DP013-DB2-ABEND                                  26921628
269217                 DP013-XCTL-DISPLAY-RESTART                       26921728
269218                               TO TRUE                            26921828
269219             PERFORM DP013-0000-PROCESS-ABEND                     26921928
269220     END-EVALUATE.                                                26922028
269221                                                                  26922128
269222     EXEC SQL                                                     26922228
269223                                                                  26922328
269224         SELECT SUM(NON_INVC_UNT_QTY)                             26922428
269225          INTO :NINREC-NON-INVC-UNT-QTY:PV-NON-INVC-QTY-NULL      26922528
269226          FROM TNINREC                                            26922628
269227         WHERE PO_NBR          = :ASC-KEY-PO-NBR                  26922728
269228           AND DC_NBR          = :PV-DC-NBR                       26922828
269229           AND PO_LNE_NBR      = :PURITM-APP-PO-LNE-NBR           26922928
269230           AND STATUS_CDE      = ' '                              26923028
269231                                                                  26923128
269232     END-EXEC.                                                    26923228
269233                                                                  26923328
269234     EVALUATE TRUE                                                26923428
269235         WHEN SQLCODE = +0                                        26923528
269236             CONTINUE                                             26923628
269237         WHEN SQLWARN0 NOT = SPACES                               26923728
269238         WHEN SQLCODE < +0                                        26923828
269239         WHEN SQLCODE > +0                                        26923928
269240             MOVE '4363-SELECT-DC-QTY'                            26924028
269241                               TO DP013-PARAGRAPH                 26924128
269242             MOVE 'UNSUCCESSFUL SELECT     '                      26924228
269243                               TO DP013-MESSAGE-TEXT (1)          26924328
269244             MOVE SQLCA        TO DP013-SQLCA                     26924428
269245             MOVE 'TNINREC'    TO DP013-DB2-TABLE-NAME (1)        26924528
269246             SET DP013-DB2-ABEND                                  26924628
269247                 DP013-XCTL-DISPLAY-RESTART                       26924728
269248                               TO TRUE                            26924828
269249             PERFORM DP013-0000-PROCESS-ABEND                     26924928
269250     END-EVALUATE.                                                26925028
269251/                                                                 26925128
269260*----------------------------------------------------------------*26926028
269300* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *26930019
269400*----------------------------------------------------------------*26940019
269500                                                                  26950019
269600 4400-MOVE-COMMAREA-TO-SCREEN.                                    26960019
269700                                                                  26970019
269800     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             26980019
269900         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          26990019
270000         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          27000019
270100             MOVE +1               TO ASC-BLK-SUB                 27010019
270200             PERFORM 5100-WRITE-TEMP-STORAGE                      27020019
270300             ADD +1                TO ASC-BLK-SUB                 27030019
270400             PERFORM 5100-WRITE-TEMP-STORAGE                      27040019
270500             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             27050019
270600                 GIVING PV-BLOCK-NUMBER                           27060019
270700                 REMAINDER PV-REMAINDER                           27070019
270800             IF  PV-REMAINDER > ZERO                              27080019
270900                 ADD +1            TO PV-BLOCK-NUMBER             27090019
271000             END-IF                                               27100019
271100             MOVE +1               TO ASC-BLK-SUB                 27110019
271200             PERFORM 4410-READ-TEMP-STORAGE                       27120019
271300             ADD +1                TO ASC-BLK-SUB                 27130019
271400                                      PV-BLOCK-NUMBER             27140019
271500             PERFORM 4410-READ-TEMP-STORAGE                       27150019
271600     END-IF.                                                      27160019
271700                                                                  27170019
271800     MOVE +1                       TO ASC-BLK-SUB.                27180019
271900                                                                  27190019
272000     COMPUTE ASC-ITEM-SUB =                                       27200019
272100         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              27210019
272200         + PC-ITEMS-PER-PANEL).                                   27220019
272300                                                                  27230019
272400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        27240019
272500         ADD +1                    TO ASC-BLK-SUB                 27250019
272600         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            27260019
272700     END-IF.                                                      27270019
272800                                                                  27280019
272900     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           27290019
273000         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                27300019
273100                                                                  27310019
273200     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        27320019
273300     PERFORM 4420-FORMAT-LIST-LINES                               27330019
273400         VARYING PV-SUB                                           27340019
273500         FROM PC-ITEMS-PER-PANEL BY -1                            27350019
273600         UNTIL PV-SUB < +1.                                       27360019
273700                                                                  27370019
273800     COMPUTE ASC-ITEMS-DISPLAYED =                                27380019
273900         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          27390019
274000                                                                  27400019
274100     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    27410019
274200                                      ASTRTITO.                   27420019
274300                                                                  27430019
274400     MOVE ASC-KEY-PO-NBR           TO MR-PO-NBR.                  27440019
274500     MOVE ASC-KEY-INVOICE-NBR      TO MR-INVOICE-NBR-X.           27450019
274600     MOVE ASC-KEY-VENDOR-NAME      TO MR-VENDOR-NAME.             27460019
274700                                                                  27470019
274800     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    27480019
274900     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    27490019
275000     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            27500019
275100                                   TO ASELITO.                    27510019
275200                                                                  27520019
275300     IF  DP020-MSG-NUMBER-X = SPACE                               27530019
275400         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  27540019
275500*            --- MORE ITEMS TO DISPLAY ----                       27550019
275600             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            27560019
275700             SET DP020-MSG-INFORMATIONAL                          27570019
275800                                   TO TRUE                        27580019
275900         END-IF                                                   27590019
276000     END-IF.                                                      27600019
276100                                                                  27610019
276200*----------------------------------------------------------------*27620019
276300*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *27630019
276400*----------------------------------------------------------------*27640019
276500                                                                  27650019
276600 4410-READ-TEMP-STORAGE.                                          27660019
276700                                                                  27670019
276800     EXEC CICS                                                    27680019
276900         READQ TS                                                 27690019
277000             QUEUE (ASC-LIST-QUEUE-NAME)                          27700019
277100             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               27710019
277200             ITEM  (PV-BLOCK-NUMBER)                              27720019
277300             RESP  (PV-CICS-RESP)                                 27730019
277400     END-EXEC.                                                    27740019
277500                                                                  27750019
277600     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       27760019
277700       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     27770019
277800         CONTINUE                                                 27780019
277900     ELSE                                                         27790019
278000         SET DP013-CICS-ABEND      TO TRUE                        27800019
278100         SET DP013-NO-ROLLBACK     TO TRUE                        27810019
278200         MOVE '4410-READ-TEMP-STORAGE'                            27820019
278300                                   TO DP013-PARAGRAPH             27830019
278400         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      27840019
278500                                   TO DP013-MESSAGE-TEXT(1)       27850019
278600         PERFORM DP013-0000-PROCESS-ABEND                         27860019
278700     END-IF.                                                      27870019
278800                                                                  27880019
278900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      27890019
279000                                   TO TRUE.                       27900019
279100                                                                  27910019
279200     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         27920019
279300         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               27930019
279400     END-IF.                                                      27940019
279500                                                                  27950019
279600/                                                                 27960019
279700*----------------------------------------------------------------*27970019
279800*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *27980019
279900*----------------------------------------------------------------*27990019
280000                                                                  28000019
280100 4420-FORMAT-LIST-LINES.                                          28010019
280200                                                                  28020019
280300     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      28030019
280400         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                28040019
280500         MOVE DP015-ASK-DRK-OFF    TO MR-SELECTA (PV-SUB)         28050019
280600         MOVE SPACES               TO MR-SELECT  (PV-SUB)         28060019
280700                                      MR-PO-LNE-NBR-X (PV-SUB)    28070019
280800                                      MR-SKU-NBR (PV-SUB)         28080019
280900                                      MR-VEND-STYL-NAME (PV-SUB)  28090019
281000                                      MR-COLOR-CODE (PV-SUB)      28100019
281100                                      MR-SIZE-CODE (PV-SUB)       28110019
281200                                      MR-RCVD-QTY-X (PV-SUB)      28120019
281300                                      MR-SKU-DESC (PV-SUB)        28130019
281400                                      MR-COLOR (PV-SUB)           28140019
281500                                      MR-SIZE (PV-SUB)            28150019
281600                                      MR-UPC (PV-SUB)             28160019
281700     ELSE                                                         28170019
281800         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      28180019
281900                                                   > SPACE        28190019
282000             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 28200019
282100                                   TO MR-SELECT (PV-SUB)          28210019
282200         ELSE                                                     28220019
282300             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      28230019
282400                                   TO MR-SELECT (PV-SUB)          28240019
282500         END-IF                                                   28250019
282600                                                                  28260019
282700         IF  DP030-SET-CURSOR-TRAILER                             28270019
282800             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)28280019
282900                 > SPACE)                                         28290019
283000               OR (PV-SUB = 1))                                   28300019
283100                SET DP030-SET-CURSOR-APPL-1 TO TRUE               28310019
283200                MOVE -1            TO MR-SELECTL (PV-SUB)         28320019
283300             END-IF                                               28330019
283400         END-IF                                                   28340019
283500                                                                  28350019
283600         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           28360019
283700             IF  ASC-ITEM-CURSOR                                  28370019
283800                 IF ASC-APPROVED                                  28380019
283900                     MOVE ASC-APP-PO-LNE-NBR                      28390019
284000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 28400019
284100                                   TO MR-PO-LNE-NBR (PV-SUB)      28410019
284200                 ELSE                                             28420019
284300                     MOVE ASC-PO-LNE-VAR-NBR                      28430019
284400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 28440019
284500                                   TO MR-PO-LNE-NBR (PV-SUB)      28450019
284600                 END-IF                                           28460019
284700             ELSE                                                 28470019
284800                 IF ASC-APPROVED                                  28480019
284900                     MOVE ASC-APP-PO-LNE-NBR                      28490019
285000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 28500019
285100                                   TO MR-PO-LNE-NBR (PV-SUB)      28510019
285200                 ELSE                                             28520019
285300                     MOVE ASC-PO-LNE-VAR-NBR                      28530019
285400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 28540019
285500                                   TO MR-PO-LNE-NBR (PV-SUB)      28550019
285600                 END-IF                                           28560019
285700             END-IF                                               28570019
285800             MOVE ASC-SKU-NBR (ASC-BLK-SUB ASC-ITEM-SUB)          28580019
285900                                   TO MR-SKU-NBR (PV-SUB)         28590019
286000             MOVE ASC-VEND-STYL-NAME (ASC-BLK-SUB ASC-ITEM-SUB)   28600019
286100                                   TO MR-VEND-STYL-NAME (PV-SUB)  28610019
286200             MOVE ASC-COLOR-CODE (ASC-BLK-SUB ASC-ITEM-SUB)       28620019
286300                                   TO MR-COLOR-CODE (PV-SUB)      28630019
286400             MOVE ASC-SIZE-CODE (ASC-BLK-SUB ASC-ITEM-SUB)        28640019
286500                                   TO MR-SIZE-CODE (PV-SUB)       28650019
286600             MOVE ASC-QTY-RCVD (ASC-BLK-SUB ASC-ITEM-SUB)         28660019
286700                                   TO MR-RCVD-QTY (PV-SUB)        28670019
286800             MOVE ASC-UPC (ASC-BLK-SUB ASC-ITEM-SUB)              28680019
286900                                   TO MR-UPC (PV-SUB)             28690019
287000             MOVE ASC-SKU-DESC (ASC-BLK-SUB ASC-ITEM-SUB)         28700019
287100                                   TO MR-SKU-DESC (PV-SUB)        28710019
287200             MOVE ASC-COLOR (ASC-BLK-SUB ASC-ITEM-SUB)            28720019
287300                                   TO MR-COLOR(PV-SUB)            28730019
287400             MOVE ASC-SIZE (ASC-BLK-SUB ASC-ITEM-SUB)             28740019
287500                                   TO MR-SIZE(PV-SUB)             28750019
287600         END-IF                                                   28760019
287700     END-IF.                                                      28770019
287800                                                                  28780019
287900     SUBTRACT +1 FROM ASC-ITEM-SUB.                               28790019
288000                                                                  28800019
288100     IF  ASC-ITEM-SUB < + 1                                       28810019
288200         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                28820019
288300         MOVE +1                   TO ASC-BLK-SUB                 28830019
288400     END-IF.                                                      28840019
288500                                                                  28850019
288600*----------------------------------------------------------------*28860019
288700*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *28870019
288800*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *28880019
288900*  ISSUE A WARNING.                                              *28890019
289000*----------------------------------------------------------------*28900019
289100 4430-CHECK-FOR-BEGIN-AND-END.                                    28910019
289200                                                                  28920019
289300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       28930019
289400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     28940019
289500*            -- NO END-OF-RANGE SPECFIED ---                      28950019
289600             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            28960019
289700             SET DP020-MSG-WARNING TO TRUE                        28970019
289800             PERFORM 4431-POSITION-AT-WARNING                     28980019
289900         END-IF                                                   28990019
290000     ELSE                                                         29000019
290100         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     29010019
290200*            -- NO BEGINNING-OF-RANGE SPECFIED ---                29020019
290300             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            29030019
290400             SET DP020-MSG-WARNING TO TRUE                        29040019
290500             PERFORM 4431-POSITION-AT-WARNING                     29050019
290600         END-IF                                                   29060019
290700     END-IF.                                                      29070019
290800                                                                  29080019
290900*----------------------------------------------------------------*29090019
291000*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *29100019
291100*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *29110019
291200*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *29120019
291300*  POSITION THE CURSOR THERE.                                    *29130019
291400*----------------------------------------------------------------*29140019
291500 4431-POSITION-AT-WARNING.                                        29150019
291600                                                                  29160019
291700     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 29170019
291800                    - PV-TOP-ITEM + 1.                            29180019
291900                                                                  29190019
292000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      29200019
292100         CONTINUE                                                 29210019
292200     ELSE                                                         29220019
292300         SET DP030-SET-CURSOR-APPL-1                              29230019
292400                                   TO TRUE                        29240019
292500         MOVE -1                   TO MR-SELECTL (PV-SUB)         29250019
292600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         29260019
292700         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         29270019
292800     END-IF.                                                      29280019
292900                                                                  29290019
293000     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   29300019
293100                    - PV-TOP-ITEM + 1.                            29310019
293200                                                                  29320019
293300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      29330019
293400         CONTINUE                                                 29340019
293500     ELSE                                                         29350019
293600         SET DP030-SET-CURSOR-APPL-1                              29360019
293700                                   TO TRUE                        29370019
293800         MOVE -1                   TO MR-SELECTL (PV-SUB)         29380019
293900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         29390019
294000         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         29400019
294100     END-IF.                                                      29410019
294200                                                                  29420019
294300/                                                                 29430019
294400*----------------------------------------------------------------*29440019
294500* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *29450019
294600* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *29460019
294700* FOR THE SELECTED ITEMS QUEUE.                                  *29470019
294800*                                                                *29480019
294900* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *29490019
295000* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *29500019
295100* THE ARRAY IS FULL.                                             *29510019
295200*----------------------------------------------------------------*29520019
295300                                                                  29530019
295400 5000-PROCESS-SEL-ITEMS.                                          29540019
295500                                                                  29550019
295600     MOVE +1                       TO ASC-BLK-SUB.                29560019
295700     PERFORM 5100-WRITE-TEMP-STORAGE.                             29570019
295800     ADD +1                        TO ASC-BLK-SUB.                29580019
295900     PERFORM 5100-WRITE-TEMP-STORAGE.                             29590019
296000                                                                  29600019
296100     IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                      29610019
296200         SET ASC-UPDATE-TSQ        TO TRUE                        29620019
296300     END-IF.                                                      29630019
296400                                                                  29640019
296500     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           29650019
296600             VARYING PV-ITEM                                      29660019
296700             FROM 1 BY 1                                          29670019
296800             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     29680019
296900/                                                                 29690019
297000*----------------------------------------------------------------*29700019
297100*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *29710019
297200*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *29720019
297300*----------------------------------------------------------------*29730019
297400                                                                  29740019
297500 5100-WRITE-TEMP-STORAGE.                                         29750019
297600                                                                  29760019
297700     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     29770019
297800                                   TO PV-LIST-ITEM-NUMBER.        29780019
297900     COMPUTE PV-BLOCK-NUMBER =                                    29790019
298000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    29800019
298100                                                                  29810019
298200     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             29820019
298300     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             29830019
298400         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      29840019
298500             PERFORM 5105-REWRITE-ASC-LISTQ                       29850019
298600         END-IF                                                   29860019
298700     ELSE                                                         29870019
298800         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       29880019
298900         ASC-HIGHEST-BLOCK-WRITTEN + 1                            29890019
299000         PERFORM 5110-WRITE-ASC-LISTQ                             29900019
299100         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   29910019
299200     END-IF.                                                      29920019
299300                                                                  29930019
299400     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      29940019
299500                                   TO TRUE.                       29950019
299600                                                                  29960019
299700/                                                                 29970019
299800*----------------------------------------------------------------*29980019
299900*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *29990019
300000*  SPECIFIC COMMAREA.                                            *30000019
300100*----------------------------------------------------------------*30010019
300200 5105-REWRITE-ASC-LISTQ.                                          30020019
300300                                                                  30030019
300400     EXEC CICS                                                    30040019
300500         WRITEQ TS                                                30050019
300600             QUEUE (ASC-LIST-QUEUE-NAME)                          30060019
300700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               30070019
300800             ITEM  (PV-BLOCK-NUMBER)                              30080019
300900             REWRITE                                              30090019
301000             RESP  (PV-CICS-RESP)                                 30100019
301100     END-EXEC.                                                    30110019
301200                                                                  30120019
301300     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           30130019
301400         CONTINUE                                                 30140019
301500     ELSE                                                         30150019
301600         SET DP013-CICS-ABEND      TO TRUE                        30160019
301700         SET DP013-NO-ROLLBACK     TO TRUE                        30170019
301800         MOVE '5105-REWRITE-ASC-LISTQ'                            30180019
301900                                   TO DP013-PARAGRAPH             30190019
302000         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     30200019
302100                                   TO DP013-MESSAGE-TEXT(1)       30210019
302200         PERFORM DP013-0000-PROCESS-ABEND                         30220019
302300     END-IF.                                                      30230019
302400                                                                  30240019
302500/                                                                 30250019
302600*----------------------------------------------------------------*30260019
302700*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *30270019
302800*  SPECIFIC COMMAREA.                                            *30280019
302900*----------------------------------------------------------------*30290019
303000 5110-WRITE-ASC-LISTQ.                                            30300019
303100                                                                  30310019
303200     EXEC CICS                                                    30320019
303300         WRITEQ TS                                                30330019
303400             QUEUE (ASC-LIST-QUEUE-NAME)                          30340019
303500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               30350019
303600             ITEM  (PV-BLOCK-NUMBER)                              30360019
303700             RESP  (PV-CICS-RESP)                                 30370019
303800     END-EXEC.                                                    30380019
303900                                                                  30390019
304000     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      30400019
304100         SET DP013-CICS-ABEND      TO TRUE                        30410019
304200         SET DP013-NO-ROLLBACK     TO TRUE                        30420019
304300         MOVE '5110-WRITE-ASC-LISTQ'                              30430019
304400                                   TO DP013-PARAGRAPH             30440019
304500         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           30450019
304600                                   TO DP013-MESSAGE-TEXT(1)       30460019
304700         PERFORM DP013-0000-PROCESS-ABEND                         30470019
304800     END-IF.                                                      30480019
304900                                                                  30490019
305000/                                                                 30500019
305100*----------------------------------------------------------------*30510019
305200* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *30520019
305300* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *30530019
305400*----------------------------------------------------------------*30540019
305500                                                                  30550019
305600 5200-FILL-SEL-QUEUE-RECORD.                                      30560019
305700                                                                  30570019
305800     PERFORM 6112-READ-LIST-QUEUE.                                30580019
305900                                                                  30590019
306000     SET PS-NO-DETAILS-ADDED TO TRUE.                             30600019
306100                                                                  30610019
306200     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       30620019
306300         SET PS-FIRST-PREQIT TO TRUE                              30630019
306400         PERFORM                                                  30640019
306500         VARYING LQW-IDX                                          30650019
306600         FROM 1 BY 1                                              30660019
306700         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            30670019
306800           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          30680019
306900                                                                  30690019
307000             IF  LQW-SELECT (LQW-IDX)                             30700019
307100                 PERFORM 5500-ADD-PAY-REQ-ITEM                    30710019
307200                 PERFORM 5600-ADD-INVOICE-ITEM                    30720019
307300             END-IF                                               30730019
307400         END-PERFORM                                              30740019
307500     END-IF.                                                      30750019
307600*                                                                 30760019
307700     IF PS-DETAILS-ADDED                                          30770019
307800        PERFORM 5250-UPDATE-TINVOIC.                              30780019
307900                                                                  30790019
308000 5250-UPDATE-TINVOIC.                                             30800019
308100*                                                                 30810019
308200     PERFORM                                                      30820019
308300         WITH TEST AFTER                                          30830019
308400         VARYING PV-RETRY-COUNTER                                 30840019
308500         FROM 1 BY 1                                              30850019
308600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               30860019
308700             OR (SQLCODE = +0))                                   30870019
308800                                                                  30880019
308900         EXEC SQL UPDATE TINVOIC                                  30890019
309000             SET DTL_ENTR_IND      = :PC-Y-CODE                   30900019
309100          WHERE PO_NBR  = :ASC-KEY-PO-NBR                         30910019
309200            AND INVC_ID = :ASC-KEY-INVOICE-NBR                    30920019
309300                                                                  30930019
309400         END-EXEC                                                 30940019
309500                                                                  30950019
309600         EVALUATE TRUE                                            30960019
309700             WHEN SQLCODE = +0                                    30970019
309800             WHEN SQLCODE = -904                                  30980019
309900             WHEN SQLCODE = -913                                  30990019
310000                 CONTINUE                                         31000019
310100                                                                  31010019
310200             WHEN SQLWARN0 NOT = SPACES                           31020019
310300             WHEN SQLCODE < +0                                    31030019
310400             WHEN SQLCODE > +0                                    31040019
310500                 MOVE '5250-UPDATE-TINVOIC'                       31050019
310600                                   TO DP013-PARAGRAPH             31060019
310700                 MOVE 'UPDATE A ROW ON TINVOIC'                   31070019
310800                                   TO DP013-MESSAGE-TEXT(1)       31080019
310900                 MOVE SQLCA        TO DP013-SQLCA                 31090019
311000                 MOVE 'TINVOIC'    TO DP013-DB2-TABLE-NAME (1)    31100019
311100                 SET DP013-DB2-ABEND                              31110019
311200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           31120019
311300                 PERFORM DP013-0000-PROCESS-ABEND                 31130019
311400         END-EVALUATE                                             31140019
311500     END-PERFORM.                                                 31150019
311600                                                                  31160019
311700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        31170019
311800         MOVE '5150-UPDATE-TINVOIC' TO DP013-PARAGRAPH            31180019
311900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              31190019
312000                                   TO DP013-MESSAGE-TEXT (1)      31200019
312100         MOVE 'TO UPDATE A TINVOIC ROW'                           31210019
312200                                   TO DP013-MESSAGE-TEXT (2)      31220019
312300         MOVE SQLCA                TO DP013-SQLCA                 31230019
312400         MOVE 'TINVOIC'            TO DP013-DB2-TABLE-NAME (1)    31240019
312500         SET DP013-DB2-ABEND                                      31250019
312600             DP013-XCTL-DISPLAY-RESTART                           31260019
312700                                   TO TRUE                        31270019
312800         PERFORM DP013-0000-PROCESS-ABEND                         31280019
312900     END-IF.                                                      31290019
313000                                                                  31300019
313100*----------------------------------------------------------------*31310019
313200*  ADD A ROW FOR EACH SELECTED ITEM TO THE PAYMENT REQUEST ITEM  *31320019
313300*  TABLE                                                         *31330019
313400*----------------------------------------------------------------*31340019
313500 5500-ADD-PAY-REQ-ITEM.                                           31350019
313600     MOVE ASC-KEY-PAYT-REC-SEQ-NBR                                31360019
313700                                 TO PREQIT-PAYT-REQ-SEQ-NBR       31370019
313800                                    DK-PAYT-REQ-SEQ-NBR.          31380019
313900                                                                  31390019
314000     IF PS-FIRST-PREQIT                                           31400019
314100        PERFORM 5510-EXT-MAX-LNE-NBR                              31410019
314200        SET PS-NOT-FIRST-PREQIT TO TRUE                           31420019
314300     ELSE                                                         31430019
314400        ADD +1 TO PV-MAX-PREQIT-LNE-NBR.                          31440019
314500                                                                  31450019
314600     MOVE PV-MAX-PREQIT-LNE-NBR  TO PREQIT-PAYT-REQ-LNE-NBR       31460019
314700                                                                  31470019
314800     MOVE ZERO                   TO PREQIT-PAY-REQ-LNE-QTY        31480019
314900                                    PREQIT-UNT-COST-AMT.          31490019
315000     MOVE PC-EACH                TO PREQIT-QTY-UNT-OF-MSMT.       31500019
315100     EXEC SQL                                                     31510019
315200         INSERT INTO TPREQIT                                      31520019
315300             (PAYT_REQ_SEQ_NBR,                                   31530019
315400              PAYT_REQ_LNE_NBR,                                   31540019
315500              PAY_REQ_LNE_QTY,                                    31550019
315600              QTY_UNT_OF_MSMT,                                    31560019
315700              UNT_COST_AMT)                                       31570019
315800         VALUES                                                   31580019
315900             (:PREQIT-PAYT-REQ-SEQ-NBR,                           31590019
316000              :PREQIT-PAYT-REQ-LNE-NBR,                           31600019
316100              :PREQIT-PAY-REQ-LNE-QTY,                            31610019
316200              :PREQIT-QTY-UNT-OF-MSMT,                            31620019
316300              :PREQIT-UNT-COST-AMT)                               31630019
316400     END-EXEC.                                                    31640019
316500     EVALUATE TRUE                                                31650019
316600         WHEN SQLCODE = ZERO                                      31660019
316700             SET PS-DETAILS-ADDED TO TRUE                         31670019
316800         WHEN OTHER                                               31680019
316900             MOVE '5500-ADD-PAY-REQ-ITEM'                         31690019
317000                               TO DP013-PARAGRAPH                 31700019
317100             MOVE 'INSER ROW ON TABLE      '                      31710019
317200                               TO DP013-MESSAGE-TEXT (1)          31720019
317300             MOVE SQLCA        TO DP013-SQLCA                     31730019
317400             MOVE 'TPREQIT'    TO DP013-DB2-TABLE-NAME (1)        31740019
317500             SET DP013-DB2-ABEND                                  31750019
317600                 DP013-XCTL-DISPLAY-RESTART                       31760019
317700                               TO TRUE                            31770019
317800             PERFORM DP013-0000-PROCESS-ABEND                     31780019
317900     END-EVALUATE.                                                31790019
318000*----------------------------------------------------------------*31800019
318100*                                                                *31810019
318200*----------------------------------------------------------------*31820019
318300 5510-EXT-MAX-LNE-NBR.                                            31830019
318400     EXEC SQL                                                     31840019
318500         SELECT MAX(PAYT_REQ_LNE_NBR)                             31850019
318600         INTO :PV-MAX-PREQIT-LNE-NBR:PV-MAX-NBR-NI                31860019
318700         FROM TPREQIT                                             31870019
318800         WHERE PAYT_REQ_SEQ_NBR = :DK-PAYT-REQ-SEQ-NBR            31880019
318900     END-EXEC.                                                    31890019
319000     EVALUATE TRUE                                                31900019
319100         WHEN SQLCODE = ZERO                                      31910019
319200             ADD +1              TO PV-MAX-PREQIT-LNE-NBR         31920019
319300         WHEN SQLCODE = +100                                      31930019
319400             MOVE +1             TO PV-MAX-PREQIT-LNE-NBR         31940019
319500         WHEN OTHER                                               31950019
319600             MOVE '5510-EXT-MAX-LNE-NBR'                          31960019
319700                               TO DP013-PARAGRAPH                 31970019
319800             MOVE 'EXTRACT MAX LINE NUMBER '                      31980019
319900                               TO DP013-MESSAGE-TEXT (1)          31990019
320000             MOVE SQLCA        TO DP013-SQLCA                     32000019
320100             MOVE 'TPREQIT'    TO DP013-DB2-TABLE-NAME (1)        32010019
320200             SET DP013-DB2-ABEND                                  32020019
320300                 DP013-XCTL-DISPLAY-RESTART                       32030019
320400                               TO TRUE                            32040019
320500             PERFORM DP013-0000-PROCESS-ABEND                     32050019
320600     END-EVALUATE.                                                32060019
320700*----------------------------------------------------------------*32070019
320800*  ADD A ROW FOR EACH SELECTED ITEM TO THE INVOICE ITEM TABLE.   *32080019
320900*----------------------------------------------------------------*32090019
321000 5600-ADD-INVOICE-ITEM.                                           32100019
321100     MOVE PREQIT-PAYT-REQ-SEQ-NBR                                 32110019
321200                                 TO MIITEM-PAYT-REQ-SEQ-NBR       32120019
321300     MOVE PREQIT-PAYT-REQ-LNE-NBR                                 32130019
321400                                 TO MIITEM-PAYT-REQ-LNE-NBR       32140019
321500     MOVE PC-INVOICE-UNIT-COST   TO MIITEM-UNT-COST-SEL-CDE       32150019
321600     MOVE ASC-KEY-PO-NBR         TO MIITEM-PO-NBR                 32160019
321700     MOVE LQW-PO-LNE-NBR (LQW-IDX)                                32170019
321800                                 TO MIITEM-PO-LNE-NBR             32180019
321900     EXEC SQL                                                     32190019
322000         INSERT INTO TMIITEM                                      32200019
322100             (PAYT_REQ_SEQ_NBR,                                   32210019
322200              PAYT_REQ_LNE_NBR,                                   32220019
322300              UNT_COST_SEL_CDE,                                   32230019
322400              PO_NBR,                                             32240019
322500              PO_LNE_NBR)                                         32250019
322600         VALUES                                                   32260019
322700             (:MIITEM-PAYT-REQ-SEQ-NBR,                           32270019
322800              :MIITEM-PAYT-REQ-LNE-NBR,                           32280019
322900              :MIITEM-UNT-COST-SEL-CDE,                           32290019
323000              :MIITEM-PO-NBR,                                     32300019
323100              :MIITEM-PO-LNE-NBR)                                 32310019
323200     END-EXEC.                                                    32320019
323300                                                                  32330019
323400     EVALUATE TRUE                                                32340019
323500         WHEN SQLCODE = ZERO                                      32350019
323600         WHEN SQLCODE = +100                                      32360019
323700             CONTINUE                                             32370019
323800         WHEN OTHER                                               32380019
323900             MOVE '5510-EXT-MAX-LNE-NBR'                          32390019
324000                               TO DP013-PARAGRAPH                 32400019
324100             MOVE 'EXTRACT MAX LINE NUMBER '                      32410019
324200                               TO DP013-MESSAGE-TEXT (1)          32420019
324300             MOVE SQLCA        TO DP013-SQLCA                     32430019
324400             MOVE 'TPREQIT'    TO DP013-DB2-TABLE-NAME (1)        32440019
324500             SET DP013-DB2-ABEND                                  32450019
324600                 DP013-XCTL-DISPLAY-RESTART                       32460019
324700                               TO TRUE                            32470019
324800             PERFORM DP013-0000-PROCESS-ABEND                     32480019
324900     END-EVALUATE.                                                32490019
325000*----------------------------------------------------------------*32500019
325100*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *32510019
325200*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *32520019
325300*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *32530019
325400*  THE USER.                                                     *32540019
325500*----------------------------------------------------------------*32550019
325600 6000-REFRESH-PANEL-FROM-TEMP.                                    32560019
325700                                                                  32570019
325800     IF  ASC-UPDATE-TSQ                                           32580019
325900         SET ASC-NO-TSQ-UPDATE     TO TRUE                        32590019
326000         MOVE ZERO                 TO PV-SAVE-ITEM                32600019
326100                                      PV-SEL-QUEUE-ITEM           32610019
326200         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        32620019
326300                                   TO PV-HOLD-SELECTED-ITEMS      32630019
326400         PERFORM 6100-UPDATE-TSQ                                  32640019
326500             UNTIL PV-ITEMS-PROCESSED >                           32650019
326600                                     ASC-NUMBER-OF-SELECTED-ITEMS 32660019
326700         PERFORM 6010-DELETE-SEL-QUEUE                            32670019
326800         INITIALIZE ASC-BLOCK-ENTRIES (1)                         32680019
326900                    ASC-BLOCK-ENTRIES (2)                         32690019
327000     END-IF.                                                      32700019
327100                                                                  32710019
327200/                                                                 32720019
327300*----------------------------------------------------------------*32730019
327400*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *32740019
327500*----------------------------------------------------------------*32750019
327600 6010-DELETE-SEL-QUEUE.                                           32760019
327700                                                                  32770019
327800     EXEC CICS                                                    32780019
327900         DELETEQ TS                                               32790019
328000             QUEUE (ASC-SEL-QUEUE-NAME)                           32800019
328100             RESP  (PV-CICS-RESP)                                 32810019
328200     END-EXEC.                                                    32820019
328300                                                                  32830019
328400     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      32840019
328500         (PV-CICS-RESP = DFHRESP(QIDERR)))                        32850019
328600         CONTINUE                                                 32860019
328700     ELSE                                                         32870019
328800         SET DP013-CICS-ABEND      TO TRUE                        32880019
328900         SET DP013-NO-ROLLBACK     TO TRUE                        32890019
329000         MOVE '6010-DELETE-SEL-QUEUE'                             32900019
329100                                   TO DP013-PARAGRAPH             32910019
329200         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         32920019
329300                                   TO DP013-MESSAGE-TEXT (1)      32930019
329400         PERFORM DP013-0000-PROCESS-ABEND                         32940019
329500     END-IF.                                                      32950019
329600                                                                  32960019
329700/                                                                 32970019
329800*----------------------------------------------------------------*32980019
329900*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *32990019
330000*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *33000019
330100*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *33010019
330200*    THE TEMP QUEUE.                                             *33020019
330300*----------------------------------------------------------------*33030019
330400                                                                  33040019
330500 6100-UPDATE-TSQ.                                                 33050019
330600                                                                  33060019
330700     ADD 1                         TO PV-SEL-QUEUE-ITEM.          33070019
330800     PERFORM 6105-READ-SEL-QUEUE.                                 33080019
330900                                                                  33090019
331000     PERFORM                                                      33100019
331100         VARYING AP301-IDX                                        33110019
331200         FROM 1 BY 1                                              33120019
331300         UNTIL ((PV-ITEMS-PROCESSED >                             33130019
331400                              PV-HOLD-SELECTED-ITEMS)             33140019
331500         OR (AP301-IDX GREATER THAN AP301-MAX-ITEMS))             33150019
331600         IF  AP301-ACTION-SW (AP301-IDX) > SPACE                  33160019
331700             PERFORM 6110-PROCESS-ITEMS                           33170019
331800         END-IF                                                   33180019
331900         ADD +1                    TO PV-ITEMS-PROCESSED          33190019
332000     END-PERFORM.                                                 33200019
332100                                                                  33210019
332200     PERFORM 6111-WRITE-LIST-QUEUE.                               33220019
332300                                                                  33230019
332400/                                                                 33240019
332500*----------------------------------------------------------------*33250019
332600*    READ THE LIST QUEUE RECORD.                                 *33260019
332700*----------------------------------------------------------------*33270019
332800                                                                  33280019
332900 6105-READ-SEL-QUEUE.                                             33290019
333000                                                                  33300019
333100     EXEC CICS                                                    33310019
333200          READQ TS                                                33320019
333300              QUEUE (ASC-SEL-QUEUE-NAME)                          33330019
333400              INTO  (AP301-INVC-LIST-TS-RCRD)                     33340019
333500              ITEM  (PV-SEL-QUEUE-ITEM)                           33350019
333600              RESP  (PV-CICS-RESP)                                33360019
333700     END-EXEC.                                                    33370019
333800                                                                  33380019
333900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          33390019
334000         CONTINUE                                                 33400019
334100     ELSE                                                         33410019
334200         SET DP013-CICS-ABEND      TO TRUE                        33420019
334300         SET DP013-NO-ROLLBACK     TO TRUE                        33430019
334400         MOVE '6105-READ-SEL-QUEUE'                               33440019
334500                                   TO DP013-PARAGRAPH             33450019
334600         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           33460019
334700                                   TO DP013-MESSAGE-TEXT(1)       33470019
334800         PERFORM DP013-0000-PROCESS-ABEND                         33480019
334900     END-IF.                                                      33490019
335000                                                                  33500019
335100/                                                                 33510019
335200*----------------------------------------------------------------*33520019
335300*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*33530019
335400*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*33540019
335500*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *33550019
335600*----------------------------------------------------------------*33560019
335700                                                                  33570019
335800 6110-PROCESS-ITEMS.                                              33580019
335900                                                                  33590019
336000     COMPUTE PV-ITEM = 1 + ((AP301-ITEM (AP301-IDX) - 1)          33600019
336100                     / PC-ITEMS-PER-PANEL).                       33610019
336200                                                                  33620019
336300     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           33630019
336400         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          33640019
336500             PERFORM 6111-WRITE-LIST-QUEUE                        33650019
336600         END-IF                                                   33660019
336700         MOVE PV-ITEM              TO PV-SAVE-ITEM                33670019
336800                                                                  33680019
336900         PERFORM 6112-READ-LIST-QUEUE                             33690019
337000         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               33700019
337100             CONTINUE                                             33710019
337200         END-IF                                                   33720019
337300     END-IF.                                                      33730019
337400                                                                  33740019
337500     COMPUTE PV-SUB = (AP301-ITEM (AP301-IDX)                     33750019
337600                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              33760019
337700                                                                  33770019
337800     SET LQW-DESELECT (PV-SUB)     TO TRUE.                       33780019
337900     MOVE LQW-SELECTED-SW (PV-SUB) TO LQW-TEMP-SELECTED-SW        33790019
338000                                     (PV-SUB).                    33800019
338100     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                33810019
338200                                                                  33820019
338300/                                                                 33830019
338400*----------------------------------------------------------------*33840019
338500*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *33850019
338600*----------------------------------------------------------------*33860019
338700                                                                  33870019
338800 6111-WRITE-LIST-QUEUE.                                           33880019
338900                                                                  33890019
339000     EXEC CICS                                                    33900019
339100         WRITEQ TS                                                33910019
339200             QUEUE (ASC-LIST-QUEUE-NAME)                          33920019
339300             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     33930019
339400             ITEM  (PV-SAVE-ITEM)                                 33940019
339500             REWRITE                                              33950019
339600             RESP  (PV-CICS-RESP)                                 33960019
339700     END-EXEC.                                                    33970019
339800                                                                  33980019
339900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          33990019
340000         CONTINUE                                                 34000019
340100     ELSE                                                         34010019
340200         SET DP013-CICS-ABEND      TO TRUE                        34020019
340300         SET DP013-NO-ROLLBACK     TO TRUE                        34030019
340400         MOVE '6111-WRITE-LIST-QUEUE'                             34040019
340500                                   TO DP013-PARAGRAPH             34050019
340600         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  34060019
340700                                   TO DP013-MESSAGE-TEXT(1)       34070019
340800         PERFORM DP013-0000-PROCESS-ABEND                         34080019
340900     END-IF.                                                      34090019
341000                                                                  34100019
341100/                                                                 34110019
341200*----------------------------------------------------------------*34120019
341300*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*34130019
341400*----------------------------------------------------------------*34140019
341500                                                                  34150019
341600 6112-READ-LIST-QUEUE.                                            34160019
341700                                                                  34170019
341800     EXEC CICS                                                    34180019
341900         READQ TS                                                 34190019
342000             QUEUE (ASC-LIST-QUEUE-NAME)                          34200019
342100             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     34210019
342200             ITEM  (PV-ITEM)                                      34220019
342300             RESP  (PV-CICS-RESP)                                 34230019
342400     END-EXEC.                                                    34240019
342500                                                                  34250019
342600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          34260019
342700         CONTINUE                                                 34270019
342800     ELSE                                                         34280019
342900         SET DP013-CICS-ABEND      TO TRUE                        34290019
343000         SET DP013-NO-ROLLBACK     TO TRUE                        34300019
343100         MOVE '6112-READ-LIST-QUEUE'                              34310019
343200                                   TO DP013-PARAGRAPH             34320019
343300         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    34330019
343400                                   TO DP013-MESSAGE-TEXT(1)       34340019
343500         PERFORM DP013-0000-PROCESS-ABEND                         34350019
343600     END-IF.                                                      34360019
343700                                                                  34370019
343800/                                                                 34380019
343900*----------------------------------------------------------------*34390019
344000*    ABEND PROCESSOR MODULE                                      *34400019
344100*----------------------------------------------------------------*34410019
344200                                                                  34420019
344300     COPY DPPD013.                                                34430019
