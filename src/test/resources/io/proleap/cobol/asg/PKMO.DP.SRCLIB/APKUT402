000100 IDENTIFICATION DIVISION.                                         00010026
000200 PROGRAM-ID.     APKUT402.                                        00020026
000300 AUTHOR.         M WILKINSON.                                     00030026
000400*DATE-WRITTEN.   OCT 30, 1996.                                    00040026
000500*DATE-COMPILED.                                                   00050026
000600*************************************************************     00060026
000700*    COBOL 2 WITH SQL                                       *     00070026
000800*                                                           *     00080026
000900*    PULL RECEIVER INFO PER DATA FILE                       *     00090026
001000*                                                           *     00100026
001100*    TRECEIV - RECEIVER TABLE                               *     00110026
001200*    TRECDIS - RECEIVER DISTRIBUTION TABLE                  *     00120026
001300*                                                           *     00130026
001400* INPUT:                                                    *     00140026
001500* 1.  DATA FILE                                             *     00150026
001600*                                                           *     00160026
001700* OUTPUT:                                                   *     00170026
001800* 1.  FLAT FILE OF RECEIVER INFO                            *     00180026
001900*                                                           *     00190026
002000*************************************************************     00200026
002100* CHANGE LOG:                                               *     00210026
002200*                                                           *     00220026
002300* 10/30/96    INITIAL VERSION.                              *     00230026
002400*                                                           *     00240026
002500* 04/20/2000  JILL JUEL                      WR# 20563      *     00250026
002600*             INCREASE SIZE OF INPUT RECORD, COPYBOOK       *     00260026
002700*             APRD400 WAS CHANGED.                          *     00270026
002800*                                                           *     00280026
002900* 06/17/2003  MIKE BESKE                     WR# 24481      *     00290027
003000*             ADDED 'WITH UR' TO THE 2 CURSORS TO AVOID     *     00300027
003100*             CONTENTION ABENDS.                            *     00310027
003200*                                                           *     00320027
003300*                                                           *     00330026
003400*************************************************************     00340026
003500                                                                  00350026
003600 ENVIRONMENT DIVISION.                                            00360026
003700                                                                  00370026
003800 INPUT-OUTPUT SECTION.                                            00380026
003900                                                                  00390026
004000 FILE-CONTROL.                                                    00400026
004100                                                                  00410026
004200     SELECT PO-NBR-FILE                                           00420026
004300         ASSIGN         TO UT-S-INP01.                            00430026
004400     SELECT RECVR-OUT-AP402-FILE                                  00440026
004500         ASSIGN         TO UT-S-OUT01.                            00450026
004600                                                                  00460026
004700 DATA DIVISION.                                                   00470026
004800                                                                  00480026
004900 FILE SECTION.                                                    00490026
005000                                                                  00500026
005100 FD  PO-NBR-FILE                                                  00510026
005200     RECORDING MODE IS F                                          00520026
005300     LABEL RECORDS ARE STANDARD                                   00530026
005400     BLOCK CONTAINS 0 RECORDS                                     00540026
005500     DATA RECORD IS PO-NBR-REC.                                   00550026
005600 01  PO-NBR-REC.                                                  00560026
005700     05  FILLER                       PIC  X(800).                00570026
005800                                                                  00580026
005900 FD  RECVR-OUT-AP402-FILE                                         00590026
006000         LABEL RECORDS  ARE STANDARD                              00600026
006100         RECORDING MODE IS  F                                     00610026
006200         DATA RECORD    IS  RECVR-OUT-AP402-RECORD.               00620026
006300                                                                  00630026
006400 01  RECVR-OUT-AP402-RECORD        PIC X(425).                    00640026
006500                                                                  00650026
006600                                                                  00660026
006700/                                                                 00670026
006800 WORKING-STORAGE SECTION.                                         00680026
006900                                                                  00690026
007000 01  FILLER                        PIC X(25) VALUE                00700026
007100                             'WS FOR APKUT402 BEGINS==>'.         00710026
007200 01  PV-RECORDS-WRITTEN            PIC 9(09) VALUE ZEROS.         00720026
007300                                                                  00730026
007400 01  PV-ORD-NBR                    PIC S9(09) COMP VALUE 0.       00740026
007500                                                                  00750026
007600 01  ABEND-CODE                    PIC S9(4) COMP SYNC            00760026
007700                                             VALUE ZEROS.         00770026
007800     88 AP-DB2-ERROR               VALUE +4013.                   00780026
007900                                                                  00790026
008000 01  PV-RETRY-COUNTER              PIC S9(4) COMP VALUE ZERO.     00800026
008100 01  PV-ABEND-FILEDS.                                             00810026
008200     05  PV-ABEND-PROGRAM             PIC X(8)  VALUE 'APKUT402'. 00820026
008300     05  PV-ABEND-PARAGRAPH           PIC X(50) VALUE SPACES.     00830026
008400     05  PV-ABEND-OPERATION           PIC X(50) VALUE SPACES.     00840026
008500     05  PV-ABEND-STRUCTURE-1         PIC X(8)  VALUE SPACES.     00850026
008600     05  PV-ABEND-STRUCTURE-2         PIC X(8)  VALUE SPACES.     00860026
008700     05  PV-ABEND-STATUS              PIC XX    VALUE SPACES.     00870026
008800                                                                  00880026
008900 01  PV-SWITCHES.                                                 00890026
009000     05  END-OF-JOB-SW                PIC X(03) VALUE 'NO '.      00900026
009100         88  END-OF-DATA              VALUE 'YES'.                00910026
009200         88  NOT-END-OF-DATA          VALUE 'NO '.                00920026
009300     05  FIRST-FETCH-SW               PIC X(03) VALUE 'YES'.      00930026
009400         88  FIRST-FETCH              VALUE 'YES'.                00940026
009500         88  NOT-FIRST-FETCH          VALUE 'NO '.                00950026
009600     05  RCVR-DATA-SW                 PIC X(03) VALUE 'NO '.      00960026
009700         88  RCVR-FOUND               VALUE 'YES'.                00970026
009800         88  RCVR-NOT-FOUND           VALUE 'NO '.                00980026
009900     05  RCVR-DATA-SW                 PIC X(03) VALUE 'NO '.      00990026
010000         88  MORE-RCVR-DATA           VALUE 'YES'.                01000026
010100         88  NO-MORE-RCVR-DATA        VALUE 'NO '.                01010026
010200     05  RDIS-DATA-SW                 PIC X(03) VALUE 'NO '.      01020026
010300         88  MORE-RDIS-DATA           VALUE 'YES'.                01030026
010400         88  NO-MORE-RDIS-DATA        VALUE 'NO '.                01040026
010500                                                                  01050026
010600 01  RUN-TIME.                                                    01060026
010700     05  R-HR                    PIC 99.                          01070026
010800     05  R-MIN                   PIC 99.                          01080026
010900     05  R-SEC                   PIC 99.                          01090026
011000     05  R-TH                    PIC 99.                          01100026
011100*                                                                 01110026
011200 01  DATE-IN.                                                     01120026
011300     05 DATE-IN-YY               PIC XX.                          01130026
011400     05 DATE-IN-MM               PIC XX.                          01140026
011500     05 DATE-IN-DD               PIC XX.                          01150026
011600                                                                  01160026
011700 01  PV-JULIAN-DATE              PIC 9(05)  VALUE ZEROS.          01170026
011800/                                                                 01180026
011900 01  FILLER                      PIC X(35)  VALUE                 01190026
012000     'BEGINNING OF AP WORK RECORD AREA **'.                       01200026
012100     COPY APRD400.                                                01210026
012200 01  PV-OUTFILE.                                                  01220026
012300     COPY APRD402.                                                01230026
012400******************************************************************01240026
012500*                                                                 01250026
012600******************************************************************01260026
012700     COPY DPWS004.                                                01270026
012800******************************************************************01280026
012900*                                                                 01290026
013000******************************************************************01300026
013100*  COMMUNICATIONS AREA2 FOR DB2                                   01310026
013200******************************************************************01320026
013300     COPY SQLCA2.                                                 01330026
013400******************************************************************01340026
013500*                                                                 01350026
013600******************************************************************01360026
013700     EXEC SQL                                                     01370026
013800          INCLUDE SQLCA                                           01380026
013900     END-EXEC.                                                    01390026
014000******************************************************************01400026
014100*                                                                 01410026
014200******************************************************************01420026
014300     EXEC SQL                                                     01430026
014400          INCLUDE TRECEIV                                         01440026
014500     END-EXEC.                                                    01450026
014600******************************************************************01460026
014700*                                                                 01470026
014800******************************************************************01480026
014900     EXEC SQL                                                     01490026
015000          INCLUDE TRECDIS                                         01500026
015100     END-EXEC.                                                    01510026
015200******************************************************************01520026
015300                                                                  01530026
015400     EXEC SQL                                                     01540026
015500          DECLARE RECEIV_CSR CURSOR FOR                           01550026
015600            SELECT                                                01560026
015700             ORD_NBR                                              01570026
015800          ,  REC_SEQ_NBR                                          01580026
015900          ,  CRE_TMST                                             01590026
016000          ,  CRE_UID                                              01600026
016100          ,  PO_VER_NBR                                           01610026
016200          ,  OPER_UNT_ID                                          01620026
016300          ,  FCLTY_ID                                             01630026
016400          ,  STATUS_CDE                                           01640026
016500          ,  SYST_CRE_CDE                                         01650026
016600          ,  REC_TYP_CDE                                          01660026
016700          ,  VER_STATUS_CDE                                       01670026
016800          ,  PACK_BY_ST_IND                                       01680026
016900          ,  REC_TMST                                             01690026
017000          ,  EXPTED_CART_CNT                                      01700026
017100          ,  ACTL_CART_CNT                                        01710026
017200          ,  EXPTED_ITM_QTY                                       01720026
017300          ,  ACTL_ITM_QTY                                         01730026
017400          ,  RCVR_NBR                                             01740026
017500          ,  ML_POST_TMST                                         01750026
017600          ,  FS_POST_TMST                                         01760026
017700          ,  PRE_TKT_IND                                          01770026
017800          ,  AD_INFO_DESC                                         01780026
017900          ,  IN_TRBL_TMST                                         01790026
018000          ,  IN_TRBL_MIN_CNT                                      01800026
018100          ,  IN_TRBL_HOUR_CNT                                     01810026
018200          ,  VERFYD_TMST                                          01820026
018300          ,  RCVG_CLERK_INIT_ID                                   01830026
018400          ,  REFER_BACK_SEQ_NBR                                   01840026
018500          ,  AP_PRC_CDE                                           01850026
018600          ,  AP_PRC_DTE                                           01860026
018700          ,  MIS_DIRECT_IND                                       01870026
018800          ,  IMPRT_IND                                            01880026
018900          ,  CRE_OPER_UNT_ID                                      01890026
019000          ,  CRE_FCLTY_ID                                         01900026
019100          ,  CURR_OPER_UNT_ID                                     01910026
019200          ,  CURR_FCLTY_ID                                        01920026
019300          ,  UPD_TMST                                             01930026
019400          ,  UPD_UID                                              01940026
019500          ,  UPD_PGM_ID                                           01950026
019600          ,  APRON_LOC_DESC                                       01960026
019700          ,  MKNG_APRN_PRT_TMST                                   01970026
019800          ,  GOH_IND                                              01980026
019900          ,  VRFD_USR_ID                                          01990026
020000          ,  AP_RVRSL_IND                                         02000026
020100          ,  AP_RVRSL_DTE                                         02010026
020200            FROM                                                  02020026
020300               TRECEIV                                            02030026
020400            WHERE                                                 02040026
020500                  ORD_NBR             = :PV-ORD-NBR               02050026
020600              AND STATUS_CDE          = 'VE'                      02060026
020700              AND VER_STATUS_CDE      = 'A'                       02070026
020800            ORDER BY                                              02080026
020900             ORD_NBR                                              02090026
021000          ,  REC_SEQ_NBR                                          02100026
021100          ,  CRE_TMST                                             02110026
021200            WITH UR                                               02120027
021300     END-EXEC.                                                    02130026
021400*                                                                 02140026
021500     EXEC SQL                                                     02150026
021600          DECLARE RECDIS_CSR CURSOR FOR                           02160026
021700        SELECT                                                    02170026
021800             ORD_NBR                                              02180026
021900          ,  ORD_LNE_NBR                                          02190026
022000          ,  REC_SEQ_NBR                                          02200026
022100          ,  OPER_UNT_ID                                          02210026
022200          ,  FCLTY_ID                                             02220026
022300          ,  CRE_TMST                                             02230026
022400          ,  CRE_UID                                              02240026
022500          ,  VER_STATUS_CDE                                       02250026
022600          ,  EXPTED_ITM_QTY                                       02260026
022700          ,  VERIFY_ITM_QTY                                       02270026
022800          ,  AP_VERIFY_ITM_QTY                                    02280026
022900          ,  STR_NBR                                              02290026
023000          ,  STR_FCLTY_ID                                         02300026
023100          ,  PLAN_ITM_QTY                                         02310026
023200          ,  AP_PRC_CDE                                           02320026
023300          ,  AP_PRC_DTE                                           02330026
023400        FROM                                                      02340026
023500           TRECDIS                                                02350026
023600        WHERE                                                     02360026
023700              ORD_NBR             = :PV-ORD-NBR                   02370026
023800          AND VER_STATUS_CDE      = 'A'                           02380026
023900        ORDER BY                                                  02390026
024000             ORD_NBR                                              02400026
024100          ,  ORD_LNE_NBR                                          02410026
024200          ,  REC_SEQ_NBR                                          02420026
024300          ,  OPER_UNT_ID                                          02430026
024400          ,  FCLTY_ID                                             02440026
024500          ,  CRE_TMST                                             02450026
024600            WITH UR                                               02460027
024700     END-EXEC.                                                    02470026
024800******************************************************************02480026
024900*                                                                 02490026
025000******************************************************************02500026
025100******************************************************************02510026
025200*LINKAGE SECTION.                                                 02520026
025300******************************************************************02530026
025400*                                                                 02540026
025500        EJECT                                                     02550026
025600 PROCEDURE DIVISION.                                              02560026
025700 A100-MAINLINE.                                                   02570026
025800                                                                  02580026
025900     PERFORM B100-INITIALIZE.                                     02590026
026000                                                                  02600026
026100     PERFORM B200-PROCESSING                                      02610026
026200         UNTIL END-OF-DATA.                                       02620026
026300                                                                  02630026
026400     PERFORM B300-END-OF-JOB.                                     02640026
026500                                                                  02650026
026600     GOBACK.                                                      02660026
026700                                                                  02670026
026800        EJECT                                                     02680026
026900 B100-INITIALIZE.                                                 02690026
027000*                                                                 02700026
027100***************************************************************** 02710026
027200*    GET DATE, TIME, OPEN FILES, SET UP CONTROLS, ETC             02720026
027300***************************************************************** 02730026
027400*                                                                 02740026
027500     ACCEPT RUN-TIME FROM TIME.                                   02750026
027600     ACCEPT DATE-IN  FROM DATE.                                   02760026
027700     ACCEPT PV-JULIAN-DATE FROM DAY.                              02770026
027800                                                                  02780026
027900     OPEN  INPUT   PO-NBR-FILE                                    02790026
028000           OUTPUT  RECVR-OUT-AP402-FILE.                          02800026
028100     INITIALIZE PV-OUTFILE.                                       02810026
028200                                                                  02820026
028300     READ PO-NBR-FILE INTO AP400-PO-EXTRACT-RECORD                02830026
028400         AT END SET END-OF-DATA TO TRUE.                          02840026
028500                                                                  02850026
028600 B200-PROCESSING.                                                 02860026
028700*                                                                 02870026
028800***************************************************************** 02880026
028900***************************************************************** 02890026
029000*                                                                 02900026
029100     SET RCVR-NOT-FOUND TO TRUE.                                  02910026
029200     MOVE AP400-PO-NBR    TO PV-ORD-NBR.                          02920026
029300                                                                  02930026
029400     PERFORM C100-PROCESS-RECEIV.                                 02940026
029500     IF RCVR-FOUND                                                02950026
029600        PERFORM C200-PROCESS-RECDIS                               02960026
029700     END-IF.                                                      02970026
029800                                                                  02980026
029900     READ PO-NBR-FILE INTO AP400-PO-EXTRACT-RECORD                02990026
030000         AT END SET END-OF-DATA TO TRUE.                          03000026
030100                                                                  03010026
030200 B300-END-OF-JOB.                                                 03020026
030300*                                                                 03030026
030400***************************************************************** 03040026
030500*     FINISH THE ERROR PROCESS, REPORT ON NECESSARY TOTALS,       03050026
030600*     AND CLOSE ALL FILES                                         03060026
030700***************************************************************** 03070026
030800*                                                                 03080026
030900     CLOSE PO-NBR-FILE                                            03090026
031000           RECVR-OUT-AP402-FILE.                                  03100026
031100                                                                  03110026
031200     DISPLAY '************************************************'.  03120026
031300     DISPLAY 'LAST PURCHASE ORDER NUMBER = '                      03130026
031400              AP402-RCV-ORD-NBR.                                  03140026
031500                                                                  03150026
031600     DISPLAY 'TOTAL ALL RECORDS WRITTEN      = '                  03160026
031700              PV-RECORDS-WRITTEN.                                 03170026
031800     DISPLAY '************************************************'.  03180026
031900                                                                  03190026
032000     IF   END-OF-DATA                                             03200026
032100          DISPLAY ' PROGRAM APKUT402 ENDS NORMALLY '              03210026
032200     ELSE                                                         03220026
032300          DISPLAY ' PROGRAM APKUT402 ENDS ABNORMALLY '            03230026
032400     END-IF.                                                      03240026
032500                                                                  03250026
032600     ACCEPT RUN-TIME FROM TIME.                                   03260026
032700     ACCEPT DATE-IN  FROM DATE.                                   03270026
032800                                                                  03280026
032900     DISPLAY ' RUN-DATE = ' DATE-IN '   RUN-TIME = ' RUN-TIME.    03290026
033000     DISPLAY '************************************************'.  03300026
033100                                                                  03310026
033200        EJECT                                                     03320026
033300*                                                                 03330026
033400***************************************************************** 03340026
033500*     PROCESS RECEIVER INFO                                       03350026
033600***************************************************************** 03360026
033700*                                                                 03370026
033800 C100-PROCESS-RECEIV.                                             03380026
033900                                                                  03390026
034000     SET MORE-RCVR-DATA TO TRUE.                                  03400026
034100     SET FIRST-FETCH    TO TRUE.                                  03410026
034200                                                                  03420026
034300     PERFORM O100-OPEN-CSR.                                       03430026
034400                                                                  03440026
034500     PERFORM F100-FETCH-RECEIV UNTIL NO-MORE-RCVR-DATA.           03450026
034600                                                                  03460026
034700     PERFORM C500-CLOSE-RECEIV-CSR.                               03470026
034800                                                                  03480026
034900*                                                                 03490026
035000***************************************************************** 03500026
035100*     PROCESS REC DIS INFO                                        03510026
035200***************************************************************** 03520026
035300*                                                                 03530026
035400 C200-PROCESS-RECDIS.                                             03540026
035500                                                                  03550026
035600     SET MORE-RDIS-DATA TO TRUE.                                  03560026
035700                                                                  03570026
035800     PERFORM O300-OPEN-CSR.                                       03580026
035900                                                                  03590026
036000     PERFORM F300-FETCH-RECDIS UNTIL NO-MORE-RDIS-DATA.           03600026
036100                                                                  03610026
036200     PERFORM C600-CLOSE-RECDIS-CSR.                               03620026
036300                                                                  03630026
036400*                                                                 03640026
036500***************************************************************** 03650026
036600*     CLOSE RECEIVER CURSOR                                       03660026
036700***************************************************************** 03670026
036800*                                                                 03680026
036900 C500-CLOSE-RECEIV-CSR.                                           03690026
037000     PERFORM WITH TEST AFTER                                      03700026
037100             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 03710026
037200             UNTIL   PV-RETRY-COUNTER > 3  OR                     03720026
037300                     SQLCODE = ZERO                               03730026
037400                                                                  03740026
037500             EXEC SQL                                             03750026
037600                CLOSE RECEIV_CSR                                  03760026
037700             END-EXEC                                             03770026
037800                                                                  03780026
037900             EVALUATE TRUE                                        03790026
038000                 WHEN SQLCODE = ZERO                              03800026
038100                 WHEN SQLCODE = +100                              03810026
038200                 WHEN SQLCODE = -904                              03820026
038300                 WHEN SQLCODE = -913                              03830026
038400                      CONTINUE                                    03840026
038500                                                                  03850026
038600                 WHEN SQLWARN0 NOT = SPACES                       03860026
038700                 WHEN SQLCODE  NOT = ZERO                         03870026
038800                      MOVE 'C500-CLOSE-RECEIV-CSR         '       03880026
038900                                    TO PV-ABEND-PARAGRAPH         03890026
039000                      MOVE 'UNSUCCESSFUL CLOSE  RECEIV'           03900026
039100                                    TO PV-ABEND-OPERATION         03910026
039200                      MOVE 'TRECEIV ' TO PV-ABEND-STRUCTURE-1     03920026
039300                      MOVE '        ' TO PV-ABEND-STRUCTURE-2     03930026
039400                      PERFORM Z999-SQL-ERROR                      03940026
039500             END-EVALUATE                                         03950026
039600     END-PERFORM.                                                 03960026
039700                                                                  03970026
039800     IF PV-RETRY-COUNTER > 3                                      03980026
039900         MOVE 'C500-CLOSE-RECEIV-CSR         '                    03990026
040000                       TO PV-ABEND-PARAGRAPH                      04000026
040100         MOVE 'MAX RETRIES EXCEEDED ON CLOSE  RECEIV'             04010026
040200                         TO PV-ABEND-OPERATION                    04020026
040300         PERFORM Z999-SQL-ERROR.                                  04030026
040400*                                                                 04040026
040500***************************************************************** 04050026
040600*     CLOSE REC DIS  CURSOR                                       04060026
040700***************************************************************** 04070026
040800*                                                                 04080026
040900 C600-CLOSE-RECDIS-CSR.                                           04090026
041000     PERFORM WITH TEST AFTER                                      04100026
041100             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 04110026
041200             UNTIL   PV-RETRY-COUNTER > 3  OR                     04120026
041300                     SQLCODE = ZERO                               04130026
041400                                                                  04140026
041500             EXEC SQL                                             04150026
041600                CLOSE RECDIS_CSR                                  04160026
041700             END-EXEC                                             04170026
041800                                                                  04180026
041900             EVALUATE TRUE                                        04190026
042000                 WHEN SQLCODE = ZERO                              04200026
042100                 WHEN SQLCODE = +100                              04210026
042200                 WHEN SQLCODE = -904                              04220026
042300                 WHEN SQLCODE = -913                              04230026
042400                      CONTINUE                                    04240026
042500                                                                  04250026
042600                 WHEN SQLWARN0 NOT = SPACES                       04260026
042700                 WHEN SQLCODE  NOT = ZERO                         04270026
042800                      MOVE 'C600-CLOSE-RECDIS-CSR         '       04280026
042900                                    TO PV-ABEND-PARAGRAPH         04290026
043000                      MOVE 'UNSUCCESSFUL CLOSE  RECDIS'           04300026
043100                                    TO PV-ABEND-OPERATION         04310026
043200                      MOVE 'TRECDIS ' TO PV-ABEND-STRUCTURE-1     04320026
043300                      MOVE '        ' TO PV-ABEND-STRUCTURE-2     04330026
043400                      PERFORM Z999-SQL-ERROR                      04340026
043500             END-EVALUATE                                         04350026
043600     END-PERFORM.                                                 04360026
043700                                                                  04370026
043800     IF PV-RETRY-COUNTER > 3                                      04380026
043900         MOVE 'C600-CLOSE-RECDIS-CSR         '                    04390026
044000                       TO PV-ABEND-PARAGRAPH                      04400026
044100         MOVE 'MAX RETRIES EXCEEDED ON CLOSE  RECDIS'             04410026
044200                         TO PV-ABEND-OPERATION                    04420026
044300         PERFORM Z999-SQL-ERROR.                                  04430026
044400                                                                  04440026
044500        EJECT                                                     04450026
044600*                                                                 04460026
044700***************************************************************** 04470026
044800*     FETCH RECEIVER INFO                                         04480026
044900***************************************************************** 04490026
045000*                                                                 04500026
045100 F100-FETCH-RECEIV.                                               04510026
045200*                                                                 04520026
045300     PERFORM WITH TEST AFTER                                      04530026
045400        VARYING PV-RETRY-COUNTER FROM 1 BY 1                      04540026
045500        UNTIL   PV-RETRY-COUNTER > 3  OR                          04550026
045600                SQLCODE = ZERO OR                                 04560026
045700                SQLCODE = +100                                    04570026
045800        EXEC SQL                                                  04580026
045900            FETCH RECEIV_CSR                                      04590026
046000            INTO                                                  04600026
046100                :RECEIV-ORD-NBR                                   04610026
046200              , :RECEIV-REC-SEQ-NBR                               04620026
046300              , :RECEIV-CRE-TMST                                  04630026
046400              , :RECEIV-CRE-UID                                   04640026
046500              , :RECEIV-PO-VER-NBR                                04650026
046600              , :RECEIV-OPER-UNT-ID                               04660026
046700              , :RECEIV-FCLTY-ID                                  04670026
046800              , :RECEIV-STATUS-CDE                                04680026
046900              , :RECEIV-SYST-CRE-CDE                              04690026
047000              , :RECEIV-REC-TYP-CDE                               04700026
047100              , :RECEIV-VER-STATUS-CDE                            04710026
047200              , :RECEIV-PACK-BY-ST-IND                            04720026
047300              , :RECEIV-REC-TMST                                  04730026
047400              , :RECEIV-EXPTED-CART-CNT                           04740026
047500              , :RECEIV-ACTL-CART-CNT                             04750026
047600              , :RECEIV-EXPTED-ITM-QTY                            04760026
047700              , :RECEIV-ACTL-ITM-QTY                              04770026
047800              , :RECEIV-RCVR-NBR                                  04780026
047900              , :RECEIV-ML-POST-TMST                              04790026
048000              , :RECEIV-FS-POST-TMST                              04800026
048100              , :RECEIV-PRE-TKT-IND                               04810026
048200              , :RECEIV-AD-INFO-DESC                              04820026
048300              , :RECEIV-IN-TRBL-TMST                              04830026
048400              , :RECEIV-IN-TRBL-MIN-CNT                           04840026
048500              , :RECEIV-IN-TRBL-HOUR-CNT                          04850026
048600              , :RECEIV-VERFYD-TMST                               04860026
048700              , :RECEIV-RCVG-CLERK-INIT-ID                        04870026
048800              , :RECEIV-REFER-BACK-SEQ-NBR                        04880026
048900              , :RECEIV-AP-PRC-CDE                                04890026
049000              , :RECEIV-AP-PRC-DTE                                04900026
049100              , :RECEIV-MIS-DIRECT-IND                            04910026
049200              , :RECEIV-IMPRT-IND                                 04920026
049300              , :RECEIV-CRE-OPER-UNT-ID                           04930026
049400              , :RECEIV-CRE-FCLTY-ID                              04940026
049500              , :RECEIV-CURR-OPER-UNT-ID                          04950026
049600              , :RECEIV-CURR-FCLTY-ID                             04960026
049700              , :RECEIV-UPD-TMST                                  04970026
049800              , :RECEIV-UPD-UID                                   04980026
049900              , :RECEIV-UPD-PGM-ID                                04990026
050000              , :RECEIV-APRON-LOC-DESC                            05000026
050100              , :RECEIV-MKNG-APRN-PRT-TMST                        05010026
050200              , :RECEIV-GOH-IND                                   05020026
050300              , :RECEIV-VRFD-USR-ID                               05030026
050400              , :RECEIV-AP-RVRSL-IND                              05040026
050500              , :RECEIV-AP-RVRSL-DTE                              05050026
050600        END-EXEC                                                  05060026
050700                                                                  05070026
050800        EVALUATE TRUE                                             05080026
050900            WHEN SQLCODE = ZERO                                   05090026
051000                 IF FIRST-FETCH                                   05100026
051100                    SET NOT-FIRST-FETCH TO TRUE                   05110026
051200                    SET RCVR-FOUND      TO TRUE                   05120026
051300                 END-IF                                           05130026
051400                 PERFORM M100-MOVE-RECEIV                         05140026
051500            WHEN SQLCODE = +100                                   05150026
051600                 SET NO-MORE-RCVR-DATA TO TRUE                    05160026
051700                 IF FIRST-FETCH                                   05170026
051800                    SET NOT-FIRST-FETCH TO TRUE                   05180026
051900                 END-IF                                           05190026
052000            WHEN SQLCODE = -904                                   05200026
052100            WHEN SQLCODE = -913                                   05210026
052200              CONTINUE                                            05220026
052300            WHEN SQLWARN0 NOT = SPACES                            05230026
052400            WHEN SQLCODE  NOT = ZERO                              05240026
052500              MOVE 'F100-FETCH-RECEIV             '               05250026
052600                            TO PV-ABEND-PARAGRAPH                 05260026
052700              MOVE 'UNSUCCESSFUL FETCH  RECEIV'                   05270026
052800                            TO PV-ABEND-OPERATION                 05280026
052900              MOVE 'TRECEIV ' TO PV-ABEND-STRUCTURE-1             05290026
053000              MOVE '        ' TO PV-ABEND-STRUCTURE-2             05300026
053100              PERFORM Z999-SQL-ERROR                              05310026
053200           END-EVALUATE                                           05320026
053300         END-PERFORM.                                             05330026
053400                                                                  05340026
053500     IF PV-RETRY-COUNTER > 3                                      05350026
053600         MOVE 'F100-FETCH-RECEIV             '                    05360026
053700                       TO PV-ABEND-PARAGRAPH                      05370026
053800         MOVE 'MAX RETRIES EXCEEDED ON FETCH  RECEIV'             05380026
053900                         TO PV-ABEND-OPERATION                    05390026
054000         PERFORM Z999-SQL-ERROR                                   05400026
054100     END-IF.                                                      05410026
054200                                                                  05420026
054300        EJECT                                                     05430026
054400*                                                                 05440026
054500***************************************************************** 05450026
054600*     FETCH REC DIS  INFO                                         05460026
054700***************************************************************** 05470026
054800*                                                                 05480026
054900 F300-FETCH-RECDIS.                                               05490026
055000*                                                                 05500026
055100     PERFORM WITH TEST AFTER                                      05510026
055200        VARYING PV-RETRY-COUNTER FROM 1 BY 1                      05520026
055300        UNTIL   PV-RETRY-COUNTER > 3  OR                          05530026
055400                SQLCODE = ZERO OR                                 05540026
055500                SQLCODE = +100                                    05550026
055600        EXEC SQL                                                  05560026
055700            FETCH RECDIS_CSR                                      05570026
055800            INTO                                                  05580026
055900            :RECDIS-ORD-NBR                                       05590026
056000          , :RECDIS-ORD-LNE-NBR                                   05600026
056100          , :RECDIS-REC-SEQ-NBR                                   05610026
056200          , :RECDIS-OPER-UNT-ID                                   05620026
056300          , :RECDIS-FCLTY-ID                                      05630026
056400          , :RECDIS-CRE-TMST                                      05640026
056500          , :RECDIS-CRE-UID                                       05650026
056600          , :RECDIS-VER-STATUS-CDE                                05660026
056700          , :RECDIS-EXPTED-ITM-QTY                                05670026
056800          , :RECDIS-VERIFY-ITM-QTY                                05680026
056900          , :RECDIS-AP-VERIFY-ITM-QTY                             05690026
057000          , :RECDIS-STR-NBR                                       05700026
057100          , :RECDIS-STR-FCLTY-ID                                  05710026
057200          , :RECDIS-PLAN-ITM-QTY                                  05720026
057300          , :RECDIS-AP-PRC-CDE                                    05730026
057400          , :RECDIS-AP-PRC-DTE                                    05740026
057500        END-EXEC                                                  05750026
057600                                                                  05760026
057700        EVALUATE TRUE                                             05770026
057800            WHEN SQLCODE = ZERO                                   05780026
057900                 PERFORM M200-MOVE-RECDIS                         05790026
058000            WHEN SQLCODE = +100                                   05800026
058100                 SET NO-MORE-RDIS-DATA TO TRUE                    05810026
058200            WHEN SQLCODE = -904                                   05820026
058300            WHEN SQLCODE = -913                                   05830026
058400              CONTINUE                                            05840026
058500            WHEN SQLWARN0 NOT = SPACES                            05850026
058600            WHEN SQLCODE  NOT = ZERO                              05860026
058700              MOVE 'F300-FETCH-RECDIS             '               05870026
058800                            TO PV-ABEND-PARAGRAPH                 05880026
058900              MOVE 'UNSUCCESSFUL FETCH  RECDIS'                   05890026
059000                            TO PV-ABEND-OPERATION                 05900026
059100              MOVE 'TRECDIS ' TO PV-ABEND-STRUCTURE-1             05910026
059200              MOVE '        ' TO PV-ABEND-STRUCTURE-2             05920026
059300              PERFORM Z999-SQL-ERROR                              05930026
059400           END-EVALUATE                                           05940026
059500         END-PERFORM.                                             05950026
059600                                                                  05960026
059700     IF PV-RETRY-COUNTER > 3                                      05970026
059800         MOVE 'F300-FETCH-RECDIS             '                    05980026
059900                       TO PV-ABEND-PARAGRAPH                      05990026
060000         MOVE 'MAX RETRIES EXCEEDED ON FETCH  RECDIS'             06000026
060100                         TO PV-ABEND-OPERATION                    06010026
060200         PERFORM Z999-SQL-ERROR                                   06020026
060300     END-IF.                                                      06030026
060400                                                                  06040026
060500        EJECT                                                     06050026
060600*                                                                 06060026
060700***************************************************************** 06070026
060800*     MOVE RECEIVER ROWS TO OUTPUT FIELDS.                        06080026
060900***************************************************************** 06090026
061000*                                                                 06100026
061100 M100-MOVE-RECEIV.                                                06110026
061200                                                                  06120026
061300     MOVE SPACES TO PV-OUTFILE.                                   06130026
061400                                                                  06140026
061500     SET AP402-RECEIV TO TRUE.                                    06150026
061600     INITIALIZE AP402-RECEIV-AREA.                                06160026
061700                                                                  06170026
061800     MOVE RECEIV-ORD-NBR            TO AP402-RCV-ORD-NBR.         06180026
061900     MOVE RECEIV-REC-SEQ-NBR        TO AP402-RCV-REC-SEQ-NBR.     06190026
062000     MOVE RECEIV-CRE-TMST           TO AP402-RCV-CRE-TMST.        06200026
062100     MOVE RECEIV-CRE-UID            TO AP402-RCV-CRE-UID.         06210026
062200     MOVE RECEIV-PO-VER-NBR         TO AP402-RCV-PO-VER-NBR.      06220026
062300     MOVE RECEIV-OPER-UNT-ID        TO AP402-RCV-OPER-UNT-ID.     06230026
062400     MOVE RECEIV-FCLTY-ID           TO AP402-RCV-FCLTY-ID.        06240026
062500     MOVE RECEIV-STATUS-CDE         TO AP402-RCV-STATUS-CDE.      06250026
062600     MOVE RECEIV-SYST-CRE-CDE       TO AP402-RCV-SYST-CRE-CDE.    06260026
062700     MOVE RECEIV-REC-TYP-CDE        TO AP402-RCV-REC-TYP-CDE.     06270026
062800     MOVE RECEIV-VER-STATUS-CDE     TO AP402-RCV-VER-STATUS-CDE.  06280026
062900     MOVE RECEIV-PACK-BY-ST-IND     TO AP402-RCV-PACK-BY-ST-IND.  06290026
063000     MOVE RECEIV-REC-TMST           TO AP402-RCV-REC-TMST.        06300026
063100     MOVE RECEIV-EXPTED-CART-CNT    TO AP402-RCV-EXPTED-CART-CNT. 06310026
063200     MOVE RECEIV-ACTL-CART-CNT      TO AP402-RCV-ACTL-CART-CNT.   06320026
063300     MOVE RECEIV-EXPTED-ITM-QTY     TO AP402-RCV-EXPTED-ITM-QTY.  06330026
063400     MOVE RECEIV-ACTL-ITM-QTY       TO AP402-RCV-ACTL-ITM-QTY.    06340026
063500     MOVE RECEIV-RCVR-NBR           TO AP402-RCV-RCVR-NBR.        06350026
063600     MOVE RECEIV-ML-POST-TMST       TO AP402-RCV-ML-POST-TMST.    06360026
063700     MOVE RECEIV-FS-POST-TMST       TO AP402-RCV-FS-POST-TMST.    06370026
063800     MOVE RECEIV-PRE-TKT-IND        TO AP402-RCV-PRE-TKT-IND.     06380026
063900     MOVE RECEIV-AD-INFO-DESC       TO AP402-RCV-AD-INFO-DESC.    06390026
064000     MOVE RECEIV-IN-TRBL-TMST       TO AP402-RCV-IN-TRBL-TMST.    06400026
064100     MOVE RECEIV-IN-TRBL-MIN-CNT    TO AP402-RCV-IN-TRBL-MIN-CNT. 06410026
064200     MOVE RECEIV-IN-TRBL-HOUR-CNT   TO                            06420026
064300                                    AP402-RCV-IN-TRBL-HOUR-CNT.   06430026
064400     MOVE RECEIV-VERFYD-TMST        TO AP402-RCV-VERFYD-TMST.     06440026
064500     MOVE RECEIV-RCVG-CLERK-INIT-ID TO                            06450026
064600                                     AP402-RCV-RCVG-CLERK-INIT-ID.06460026
064700     MOVE RECEIV-REFER-BACK-SEQ-NBR TO                            06470026
064800                                    AP402-RCV-REFER-BACK-SEQ-NBR. 06480026
064900     MOVE RECEIV-AP-PRC-CDE         TO AP402-RCV-AP-PRC-CDE.      06490026
065000     MOVE RECEIV-AP-PRC-DTE         TO AP402-RCV-AP-PRC-DTE.      06500026
065100     MOVE RECEIV-MIS-DIRECT-IND     TO AP402-RCV-MIS-DIRECT-IND.  06510026
065200     MOVE RECEIV-IMPRT-IND          TO AP402-RCV-IMPRT-IND.       06520026
065300     MOVE RECEIV-CRE-OPER-UNT-ID    TO AP402-RCV-CRE-OPER-UNT-ID. 06530026
065400     MOVE RECEIV-CRE-FCLTY-ID       TO AP402-RCV-CRE-FCLTY-ID.    06540026
065500     MOVE RECEIV-CURR-OPER-UNT-ID   TO                            06550026
065600                                    AP402-RCV-CURR-OPER-UNT-ID.   06560026
065700     MOVE RECEIV-CURR-FCLTY-ID      TO AP402-RCV-CURR-FCLTY-ID.   06570026
065800     MOVE RECEIV-UPD-TMST           TO AP402-RCV-UPD-TMST.        06580026
065900     MOVE RECEIV-UPD-UID            TO AP402-RCV-UPD-UID.         06590026
066000     MOVE RECEIV-UPD-PGM-ID         TO AP402-RCV-UPD-PGM-ID.      06600026
066100     MOVE RECEIV-APRON-LOC-DESC     TO AP402-RCV-APRON-LOC-DESC.  06610026
066200     MOVE RECEIV-MKNG-APRN-PRT-TMST TO                            06620026
066300                                    AP402-RCV-MKNG-APRN-PRT-TMST. 06630026
066400     MOVE RECEIV-GOH-IND            TO AP402-RCV-GOH-IND.         06640026
066500     MOVE RECEIV-VRFD-USR-ID        TO AP402-RCV-VRFD-USR-ID.     06650026
066600     MOVE RECEIV-AP-RVRSL-IND       TO AP402-RCV-AP-RVRSL-IND.    06660026
066700     MOVE RECEIV-AP-RVRSL-DTE      TO AP402-RCV-AP-RVRSL-DTE.     06670026
066800                                                                  06680026
066900     PERFORM W100-WRITE-OUFILE.                                   06690026
067000                                                                  06700026
067100        EJECT                                                     06710026
067200*                                                                 06720026
067300***************************************************************** 06730026
067400*     MOVE REC DIS ROWS TO OUTPUT FIELDS.                         06740026
067500***************************************************************** 06750026
067600*                                                                 06760026
067700 M200-MOVE-RECDIS.                                                06770026
067800                                                                  06780026
067900     MOVE SPACES TO PV-OUTFILE.                                   06790026
068000                                                                  06800026
068100     SET AP402-RECDIS TO TRUE.                                    06810026
068200     INITIALIZE AP402-RECDIS-AREA.                                06820026
068300                                                                  06830026
068400     MOVE RECDIS-ORD-NBR            TO AP402-RDS-ORD-NBR.         06840026
068500     MOVE RECDIS-ORD-LNE-NBR        TO AP402-RDS-ORD-LNE-NBR.     06850026
068600     MOVE RECDIS-REC-SEQ-NBR        TO AP402-RDS-REC-SEQ-NBR.     06860026
068700     MOVE RECDIS-OPER-UNT-ID        TO AP402-RDS-OPER-UNT-ID.     06870026
068800     MOVE RECDIS-FCLTY-ID           TO AP402-RDS-FCLTY-ID.        06880026
068900     MOVE RECDIS-CRE-TMST           TO AP402-RDS-CRE-TMST.        06890026
069000     MOVE RECDIS-CRE-UID            TO AP402-RDS-CRE-UID.         06900026
069100     MOVE RECDIS-VER-STATUS-CDE     TO AP402-RDS-VER-STATUS-CDE.  06910026
069200     MOVE RECDIS-EXPTED-ITM-QTY     TO AP402-RDS-EXPTED-ITM-QTY.  06920026
069300     MOVE RECDIS-VERIFY-ITM-QTY     TO AP402-RDS-VERIFY-ITM-QTY.  06930026
069400     MOVE RECDIS-AP-VERIFY-ITM-QTY  TO                            06940026
069500                                    AP402-RDS-AP-VERIFY-ITM-QTY.  06950026
069600     MOVE RECDIS-STR-NBR            TO AP402-RDS-STR-NBR.         06960026
069700     MOVE RECDIS-STR-FCLTY-ID       TO AP402-RDS-STR-FCLTY-ID.    06970026
069800     MOVE RECDIS-PLAN-ITM-QTY       TO AP402-RDS-PLAN-ITM-QTY.    06980026
069900     MOVE RECDIS-AP-PRC-CDE         TO AP402-RDS-AP-PRC-CDE.      06990026
070000     MOVE RECDIS-AP-PRC-DTE         TO AP402-RDS-AP-PRC-DTE.      07000026
070100                                                                  07010026
070200     PERFORM W100-WRITE-OUFILE.                                   07020026
070300                                                                  07030026
070400        EJECT                                                     07040026
070500*                                                                 07050026
070600***************************************************************** 07060026
070700*     OPEN RECEIVER CURSOR                                        07070026
070800***************************************************************** 07080026
070900*                                                                 07090026
071000 O100-OPEN-CSR.                                                   07100026
071100     PERFORM WITH TEST AFTER                                      07110026
071200             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 07120026
071300             UNTIL   PV-RETRY-COUNTER > 3  OR                     07130026
071400                     SQLCODE = ZERO                               07140026
071500                                                                  07150026
071600             EXEC SQL                                             07160026
071700                OPEN RECEIV_CSR                                   07170026
071800             END-EXEC                                             07180026
071900                                                                  07190026
072000             EVALUATE TRUE                                        07200026
072100                 WHEN SQLCODE = ZERO                              07210026
072200                 WHEN SQLCODE = -904                              07220026
072300                 WHEN SQLCODE = -913                              07230026
072400                      CONTINUE                                    07240026
072500                                                                  07250026
072600                 WHEN SQLWARN0 NOT = SPACES                       07260026
072700                 WHEN SQLCODE  NOT = ZERO                         07270026
072800                      MOVE 'O100-OPEN-CSR                 '       07280026
072900                                    TO PV-ABEND-PARAGRAPH         07290026
073000                      MOVE 'UNSUCCESSFUL OPEN   RECEIV'           07300026
073100                                    TO PV-ABEND-OPERATION         07310026
073200                      MOVE 'TRECEIV ' TO PV-ABEND-STRUCTURE-1     07320026
073300                      MOVE '        ' TO PV-ABEND-STRUCTURE-2     07330026
073400                      PERFORM Z999-SQL-ERROR                      07340026
073500             END-EVALUATE                                         07350026
073600     END-PERFORM.                                                 07360026
073700                                                                  07370026
073800     IF PV-RETRY-COUNTER > 3                                      07380026
073900         MOVE 'O100-OPEN-CSR                 '                    07390026
074000                       TO PV-ABEND-PARAGRAPH                      07400026
074100         MOVE 'MAX RETRIES EXCEEDED ON OPEN   RECEIV'             07410026
074200                         TO PV-ABEND-OPERATION                    07420026
074300         PERFORM Z999-SQL-ERROR.                                  07430026
074400                                                                  07440026
074500*                                                                 07450026
074600***************************************************************** 07460026
074700*     OPEN REC DIS  CURSOR                                        07470026
074800***************************************************************** 07480026
074900*                                                                 07490026
075000 O300-OPEN-CSR.                                                   07500026
075100     PERFORM WITH TEST AFTER                                      07510026
075200             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 07520026
075300             UNTIL   PV-RETRY-COUNTER > 3  OR                     07530026
075400                     SQLCODE = ZERO                               07540026
075500                                                                  07550026
075600             EXEC SQL                                             07560026
075700                OPEN RECDIS_CSR                                   07570026
075800             END-EXEC                                             07580026
075900                                                                  07590026
076000             EVALUATE TRUE                                        07600026
076100                 WHEN SQLCODE = ZERO                              07610026
076200                 WHEN SQLCODE = -904                              07620026
076300                 WHEN SQLCODE = -913                              07630026
076400                      CONTINUE                                    07640026
076500                                                                  07650026
076600                 WHEN SQLWARN0 NOT = SPACES                       07660026
076700                 WHEN SQLCODE  NOT = ZERO                         07670026
076800                      MOVE 'O300-OPEN-CSR                 '       07680026
076900                                    TO PV-ABEND-PARAGRAPH         07690026
077000                      MOVE 'UNSUCCESSFUL OPEN   RECDIS'           07700026
077100                                    TO PV-ABEND-OPERATION         07710026
077200                      MOVE 'TRECDIS ' TO PV-ABEND-STRUCTURE-1     07720026
077300                      MOVE '        ' TO PV-ABEND-STRUCTURE-2     07730026
077400                      PERFORM Z999-SQL-ERROR                      07740026
077500             END-EVALUATE                                         07750026
077600     END-PERFORM.                                                 07760026
077700                                                                  07770026
077800     IF PV-RETRY-COUNTER > 3                                      07780026
077900         MOVE 'O300-OPEN-CSR                 '                    07790026
078000                       TO PV-ABEND-PARAGRAPH                      07800026
078100         MOVE 'MAX RETRIES EXCEEDED ON OPEN   RECDIS'             07810026
078200                         TO PV-ABEND-OPERATION                    07820026
078300         PERFORM Z999-SQL-ERROR.                                  07830026
078400                                                                  07840026
078500        EJECT                                                     07850026
078600*                                                                 07860026
078700***************************************************************** 07870026
078800*     WRITE DATA TO THE OUTFILE                                   07880026
078900***************************************************************** 07890026
079000*                                                                 07900026
079100 W100-WRITE-OUFILE.                                               07910026
079200                                                                  07920026
079300     WRITE RECVR-OUT-AP402-RECORD FROM PV-OUTFILE.                07930026
079400     ADD 1 TO PV-RECORDS-WRITTEN.                                 07940026
079500                                                                  07950026
079600 Z999-SQL-ERROR.                                                  07960026
079700*                                                                 07970026
079800***************************************************************** 07980026
079900*     PROCESS DB2 ABENDS                                          07990026
080000***************************************************************** 08000026
080100*                                                                 08010026
080200     DISPLAY '*** DB2 ERROR '.                                    08020026
080300     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 08030026
080400     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               08040026
080500     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               08050026
080600     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             08060026
080700     IF PV-ABEND-STRUCTURE-2 > SPACES                             08070026
080800         DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2.         08080026
080900                                                                  08090026
081000     MOVE +4013                    TO ABEND-CODE.                 08100026
081100                                                                  08110026
081200     COPY DPPD004.                                                08120026
081300     CALL 'ILBOABN0' USING ABEND-CODE.                            08130026
081400                                                                  08140026
