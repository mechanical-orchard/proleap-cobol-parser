000100*-----------------------*                                         00010016
000200 IDENTIFICATION DIVISION.                                         00020017
000210*-----------------------*                                         00021017
000220 PROGRAM-ID.    CNKCS223.                                         00022017
000230 AUTHOR.        DEANNA BRANTNER.                                  00023017
000240 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00024017
000250 DATE-WRITTEN.  JANUARY, 2001                                     00025038
000260 DATE-COMPILED.                                                   00026017
000270                                                                  00027017
000280*---------------------------------------------------------------* 00028017
000290*    Y223 - TRAILER MANIFESTING - DC-TRAILER LIST                 00029017
000300*---------------------------------------------------------------* 00030017
263455* CHANGED 11/02/2021    BY JIM HUNTER      WR: CHG0263455         00031053
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00032053
263455* MAKING THE CALL DYNAMIC VS STATIC.                              00033053
263455*----------------------------------------------------------------*00034053
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961         00035054
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00036054
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00037054
CICS  *-----------------------------------------------------------------00038054
000400 ENVIRONMENT DIVISION.                                            00040017
000500 DATA DIVISION.                                                   00050017
000600                                                                  00060017
000700 WORKING-STORAGE SECTION.                                         00070017
000800                                                                  00080017
000900 01  DK-DB2-KEYS.                                                 00090017
001000     05  DK-SCAC-CDE               PIC  X(04)  VALUE SPACES.      00100017
001100     05  DK-TRAILER-ID             PIC  X(12)  VALUE SPACES.      00110017
001200     05  DK-SERIAL-NBR             PIC S9(09) COMP VALUE +0.      00120017
001300                                                                  00130017
001400 01  PC-PROGRAM-CONSTANTS.                                        00140017
001500     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE 'CNK223  '.  00150017
001600     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE 'CNKM223 '.  00160017
001700     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'CNKCS223'.  00170017
001800     05  PC-PRTR-VALIDATION-PGM    PIC  X(08)  VALUE 'DPKCS060'.  00180017
001810     05  PC-REPORT-PGM-1           PIC  X(08)  VALUE 'PCKCS126'.  00181017
001820     05  PC-LIST-QUEUE-SEQ         PIC  9(01)  VALUE 1.           00182017
001830     05  PC-SEL-QUEUE-SEQ          PIC  9(01)  VALUE 2.           00183017
001840     05  PC-CRIT-SPEC-FORMAT       PIC  X(01)  VALUE '1'.         00184017
001850     05  PC-DETAIL-SCREEN          PIC  X(01)  VALUE '2'.         00185017
001860     05  PC-ITEMS-PER-PANEL        PIC S9(04)  VALUE +12          00186017
001870                                               COMP SYNC.         00187017
001880     05  PC-MAX-BLOCKS-IN-ARRAY    PIC S9(04)  VALUE +2           00188017
001890                                               COMP SYNC.         00189017
001900     05  PC-MAX-ITEMS              PIC S9(09)  VALUE +1000000     00190017
002000                                               COMP-3.            00200017
002100     05  PC-MSG-NUMBER-LENGTH      PIC S9(04)  VALUE +5           00210017
002200                                               COMP SYNC.         00220017
002300     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00230017
002400                                               COMP-3.            00240017
002500     05  PC-INQ                    PIC  X(03)  VALUE 'INQ'.       00250017
002600     05  PC-UPD                    PIC  X(03)  VALUE 'UPD'.       00260017
002700     05  PC-DEL                    PIC  X(03)  VALUE 'DEL'.       00270017
002800     05  PC-ERR                    PIC  X(03)  VALUE 'ERR'.       00280017
002900     05  PC-01                     PIC  X(02)  VALUE '01'.        00290017
003000                                                                  00300017
003100*----------------------------------------------------------------*00310017
003200*  SYSTEM MESSAGES                                               *00320017
003300*----------------------------------------------------------------*00330017
003400*   00005 = INVALID VALUE                                        *00340017
003500*   00008 = MUST BE NUMERIC                                      *00350017
003600*   00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED  *00360017
003700*   00051 - NO END OF RANGE HAS BEEN SPECIFIED                   *00370017
003800*   00052 - END OF RANGE PRECEDES START OF RANGE                 *00380017
003900*   00053 - NO START OF RANGE HAS BEEN SPECIFIED                 *00390017
004000*   00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED   *00400017
004100*   00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED     *00410017
004200*   00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       *00420017
004300*   00069 - TOP OF LIST                                          *00430017
004400*   00070 - BOTTOM OF LIST                                       *00440017
004500*   00098 - PRINT REQUEST HAS BEEN SUBMITTED                     *00450039
004600*   00101 - VALUE MUST BE > ZERO AND  < 1,000,000                *00460017
004700*   00279 - MORE ITEMS TO DISPLAY                                *00470017
004800*   00746 - INVALID PRINTER DESTINATION                          *00480017
004900*   01422 - THIS IS AN INVALID LABEL FOR THIS DEPARTMENT         *00490039
005000*   01563 - PRINTER ID MUST BE ENTERED FOR THIS SELECTION        *00500017
005100*   02122 - LABEL REQUEST FAILED DUE TO COMMUNICATION ERROR - CALL00510039
005200*----------------------------------------------------------------*00520017
005300     05  PC-TSYMSG-NUMBERS.                                       00530017
005400         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00540017
005500         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00550017
005600         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00560017
005700         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00570017
005800         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00580017
005900         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00590017
006000         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00600017
006100         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00610017
006200         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00620017
006300         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00630017
006400         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00640017
006500         10  PC-TSYMSG-00098            PIC  9(05)  VALUE 00098.  00650017
006600         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00660017
006700         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00670017
006701         10  PC-TSYMSG-00746            PIC  9(05)  VALUE 00746.  00670117
006702         10  PC-TSYMSG-01422            PIC  9(05)  VALUE 01422.  00670217
006703         10  PC-TSYMSG-01563            PIC  9(05)  VALUE 01563.  00670317
006704         10  PC-TSYMSG-02122            PIC  9(05)  VALUE 02122.  00670417
006705*                                                                 00670517
006706 01  PS-PROGRAM-SWITCHES.                                         00670617
006707     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00670717
006708         88  PS-NO-ERROR                            VALUE 'Y'.    00670817
006709         88  PS-ERROR                               VALUE 'N'.    00670917
006710     05  PS-BLOCK-ERROR-SW              PIC  X(01)  VALUE 'Y'.    00671017
006720         88  PS-NO-BLOCK-ERROR                      VALUE 'Y'.    00672017
006730         88  PS-BLOCK-ERROR                         VALUE 'N'.    00673017
006740     05  PS-CONFIRM-PROCESSING-IND      PIC  X(01)  VALUE  'N'.   00674017
006750         88  PS-CONFIRM-PROCESSING                  VALUE  'Y'.   00675017
006760         88  PS-NOT-CONFIRM-PROCESSING              VALUE  'N'.   00676017
006770     05  PS-SOFT-ABORT-ERROR-SW         PIC  X(01)  VALUE 'N'.    00677017
006780         88  PS-SOFT-ABORT-ERROR                    VALUE 'Y'.    00678017
006790         88  PS-NO-SOFT-ABORT-ERROR                 VALUE 'N'.    00679017
006800     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00680017
006900         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00690017
007000         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00700017
007100     05  PS-LIST-END-SW                 PIC  X(01)  VALUE 'N'.    00710017
007200         88  PS-LIST-END                            VALUE 'Y'.    00720017
007300         88  PS-NO-LIST-END                         VALUE 'N'.    00730017
007400*                                                                 00740017
007500 01  PV-PROGRAM-VARIABLES.                                        00750017
007600     05  PV-CICS-RESPONSE               PIC S9(08)  VALUE ZEROES  00760017
007700                                        COMP SYNC.                00770017
007800     05  PV-SUB                         PIC S9(04)  VALUE +0      00780017
007900                                                    COMP SYNC.    00790017
008000     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00800017
008100                                                    COMP SYNC.    00810017
008200     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00820017
008300                                                    COMP-3.       00830017
008400     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00840017
008500                                                    COMP-3.       00850017
008600     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      00860017
008700                                                    COMP-3.       00870017
008800     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00880017
008900                                                    COMP-3.       00890017
009000     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      00900017
009100                                                    COMP-3.       00910017
009200     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      00920017
009300                                                    COMP-3.       00930017
009400     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      00940017
009500                                                    COMP-3.       00950017
009600     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      00960017
009700                                                    COMP SYNC.    00970017
009800     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      00980017
009900                                                    COMP SYNC.    00990017
010000     05  PV-ITEM                        PIC S9(04)  VALUE +0      01000017
010100                                                    COMP SYNC.    01010017
010200     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01020017
010300                                                    COMP SYNC.    01030017
010400     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01040017
010500                                                    COMP SYNC.    01050017
010600     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01060017
010700                                                    COMP SYNC.    01070017
010800     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01080017
010900                                                    COMP SYNC.    01090017
011000     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01100017
011100                                                    COMP SYNC.    01110017
011200     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01120017
011300                                                    COMP SYNC.    01130017
011400     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01140017
011500                                                    COMP SYNC.    01150017
011600     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01160017
011700                                                    COMP SYNC.    01170017
011800     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01180017
011900                                                    COMP SYNC.    01190017
012000     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01200017
012100                                                    COMP SYNC.    01210017
012200     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01220017
012300                                                    COMP SYNC.    01230017
012400     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01240017
012500                                                    COMP SYNC.    01250017
012600     05  PV-SOFT-ABORT-MSG.                                       01260017
012700         10  FILLER            PIC X(12) VALUE ' CNKCS223 - '.    01270017
012800         10  FILLER            PIC X(09) VALUE 'SQLCODE: '.       01280017
012900         10  PV-SOFT-SQLCODE   PIC ZZZZZZZZ9-.                    01290017
013000         10  FILLER            PIC X(12) VALUE ' PARAGRAPH: '.    01300017
013100         10  PV-SOFT-PARAGRAPH PIC X(30).                         01310017
013200     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01320017
013300                                                     COMP SYNC.   01330017
013400     05  PV-CICS-MSG-AREA                PIC  X(80)  VALUE SPACE. 01340017
013500     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACE. 01350017
013600     05  PV-CICS-MSG-HOLD.                                        01360017
013700         10  FILLER                      PIC  X(01)  VALUE SPACE. 01370017
013800         10  PV-CICS-MSG-DATA            PIC  X(79)  VALUE SPACE. 01380017
013900     05  PV-CICS-MSG-HOLD2.                                       01390017
014000         10  FILLER                      PIC  X(01)  VALUE SPACE. 01400017
014100         10  PV-CICS-MSG-DATA2           PIC  X(99)  VALUE SPACE. 01410017
014200                                                                  01420017
014300     05  PV-ORIGINAL-BLOCK               PIC S9(04)  VALUE +0     01430017
014400                                                     COMP SYNC.   01440017
014500     05  PV-ITEMS-HOLD                   PIC S9(03)  COMP-3.      01450017
014600     05  PV-ITEMS-DIFF                   PIC S9(03)  COMP-3.      01460017
014610     05  PV-TRAILER-ID                   PIC  X(12)  VALUE SPACE. 01461042
014620     05  PV-SERIAL-NBR                   PIC  9(09)  VALUE ZERO.  01462043
014700                                                                  01470017
014800******************************************************************01480017
014900**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01490017
015000**  THIS MUST BE THE EXACT SAME FORMAT AS BLOCK IN THE          **01500017
015100**  APPLICATION-SPECIFIC COMMAREA.                              **01510017
015200******************************************************************01520017
015300 01  LQW-LIST-QUEUE-WORK-AREA.                                    01530017
015400     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01540017
015500     05  LQW-ITEM-ENTRIES               OCCURS 12 TIMES           01550017
015600                                        INDEXED BY LQW-IDX.       01560017
015700         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01570017
015800         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01580017
015900         10  LQW-SELECTED-SW            PIC  X(01).               01590017
016000             88  LQW-SELECT                         VALUE 'S'.    01600017
016100             88  LQW-DESELECT                       VALUE ' '.    01610017
016200         10  LQW-ACTION                 PIC  X(03).               01620017
016300             88  LQW-DEL                            VALUE 'DEL'.  01630017
016400             88  LQW-INQ                            VALUE 'INQ'.  01640017
016500             88  LQW-UPD                            VALUE 'UPD'.  01650017
016600             88  LQW-ERR                            VALUE 'ERR'.  01660017
016700             88  LQW-PRT                            VALUE 'PRT'.  01670017
016800         10  LQW-TRAILER-ID             PIC  X(12).               01680017
016900         10  LQW-SERIAL-NBR             PIC  9(09).               01690017
016910         10  LQW-TRLR-LENGTH            PIC  9(04).               01691045
017000                                                                  01700017
017100*---------------------------------------------------------------* 01710017
017200* SELECTION QUEUE LAYOUT                                        * 01720017
017300*---------------------------------------------------------------* 01730017
017400     COPY CNWS010.                                                01740017
017500                                                                  01750017
017600*---------------------------------------------------------------* 01760017
017700*    LABEL REQUEST LAYOUT                                         01770017
017800*---------------------------------------------------------------* 01780017
017900     COPY PCWS140.                                                01790017
018000                                                                  01800017
018100*---------------------------------------------------------------* 01810017
018200*    MAP LAYOUT                                                 * 01820017
018300*---------------------------------------------------------------* 01830017
018400     COPY CNKM223.                                                01840017
018500*                                                                 01850017
018600 01  MR-OCCURS-LAYOUT                   REDEFINES  CNK223O.       01860017
018700     05  FILLER                         PIC X(99).                01870017
018800     05  MR-SCROLL-AREA                 OCCURS 12 TIMES.          01880017
018900         10  MR-SELECTL                 PIC S9(04) COMP.          01890017
019000         10  MR-SELECTA                 PIC  X(01).               01900017
019100         10  MR-SELECTC                 PIC  X(01).               01910017
019200         10  MR-SELECTH                 PIC  X(01).               01920017
019300         10  MR-SELECTI                 PIC  X(01).               01930017
019400                                                                  01940017
019500         10  MR-ACTIONL                 PIC S9(04) COMP.          01950017
019600         10  MR-ACTIONA                 PIC  X(01).               01960017
019700         10  MR-ACTIONC                 PIC  X(01).               01970017
019800         10  MR-ACTIONH                 PIC  X(01).               01980017
019900         10  MR-ACTION                  PIC  X(03).               01990017
020000                                                                  02000017
020100         10  MR-TRAILER-IDL            PIC S9(04) COMP.           02010017
020200         10  MR-TRAILER-IDA            PIC  X(01).                02020017
020300         10  MR-TRAILER-IDC            PIC  X(01).                02030017
020400         10  MR-TRAILER-IDH            PIC  X(01).                02040017
020500         10  MR-TRAILER-ID             PIC  X(12).                02050017
020600                                                                  02060017
020700         10  MR-SERIAL-NBRL            PIC S9(04) COMP.           02070017
020800         10  MR-SERIAL-NBRA            PIC  X(01).                02080017
020900         10  MR-SERIAL-NBRC            PIC  X(01).                02090017
021000         10  MR-SERIAL-NBRH            PIC  X(01).                02100017
021100         10  MR-SERIAL-NBR             PIC  X(09).                02110017
021110                                                                  02111043
021120         10  MR-TRLR-LNGTHL            PIC S9(04) COMP.           02112043
021130         10  MR-TRLR-LNGTHA            PIC  X(01).                02113043
021140         10  MR-TRLR-LNGTHC            PIC  X(01).                02114043
021150         10  MR-TRLR-LNGTHH            PIC  X(01).                02115043
021160         10  MR-TRLR-LNGTH             PIC  Z(04).                02116043
021200                                                                  02120017
021300     05  FILLER                         PIC  X(12).               02130017
021301                                                                  02130117
021302*----------------------------------------------------------------*02130217
021303*  SENDING/RECEIVING AREA FOR THE                                 02130317
021304*  PRINTER VALIDATION ROUTING (DPKCS060)                          02130417
021305*----------------------------------------------------------------*02130517
021306     COPY DPWS072.                                                02130617
021307                                                                  02130717
021308*---------------------------------------------------------------* 02130817
021309*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02130917
021310*---------------------------------------------------------------* 02131017
021320     COPY DPWS015.                                                02132017
021330                                                                  02133017
021340*---------------------------------------------------------------* 02134017
021350*    FUNCTION KEYS COPYBOOK.                                    * 02135017
021360*---------------------------------------------------------------* 02136017
021370     COPY DPWS016.                                                02137017
021380                                                                  02138017
021390*---------------------------------------------------------------* 02139017
021400*    NUMERIC EDIT LAYOUT.                                       * 02140017
021500*---------------------------------------------------------------* 02150017
021600     COPY DPWS010I.                                               02160017
021700                                                                  02170017
021800*---------------------------------------------------------------* 02180017
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02190054
022000*---------------------------------------------------------------* 02200017
022100     COPY DPWS030.                                                02210017
CICS       COPY DPWS930.                                                02211054
022200                                                                  02220017
022300*---------------------------------------------------------------* 02230017
022400*    STANDARD COMMAREA.                                         * 02240017
022500*---------------------------------------------------------------* 02250017
022600     COPY DPWS020.                                                02260017
022700     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02270017
022800                                                                  02280017
022900*---------------------------------------------------------------* 02290017
023000* INTER-APPLICATION COMMAREA.                                   * 02300017
023100*   CNWS008 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 02310017
023200*             SPEC SCREEN.                                      * 02320017
023300*   CNWS009 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 02330017
023400*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 02340017
023500*---------------------------------------------------------------* 02350017
023600         10  INTER-APPL-COMM-AREA       PIC X(200).               02360017
023700     COPY CNWS008.                                                02370017
025210     COPY CNWS009.                                                02521004
025300                                                                  02530001
025400*---------------------------------------------------------------* 02540001
025500*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02550001
025600*---------------------------------------------------------------* 02560001
025700         10  ASC-SPECIFIC-COMMAREA.                               02570001
025800             15  ASC-OPER-UNT-ID              PIC  9(04).         02580008
025801             15  ASC-FCLTY-ID                 PIC  9(04).         02580108
025802             15  ASC-FCLTY-NAME               PIC  X(25).         02580214
025803             15  ASC-PRTR-ID                  PIC  X(08).         02580314
025804             15  ASC-DC-PRTD-AT               PIC  X(02).         02580414
025805             15  ASC-USER-ID                  PIC  X(08).         02580514
025806             15  ASC-SCAC                     PIC  X(04).         02580614
025807             15  ASC-SCAC-NAME                PIC  X(30).         02580714
025808             15  ASC-TRLR-ID                  PIC  X(12).         02580814
025809             15  ASC-TRLR-SRL-NBR             PIC S9(09) COMP.    02580914
025810             15  ASC-XFER-MODE-ID             PIC  X(02).         02581014
025811             15  ASC-IP-ADDRESS               PIC  X(15).         02581114
025812             15  ASC-OS-RLSE-CDE              PIC  X(05).         02581214
025820             15  ASC-BLK-SUB                  PIC S9(04) COMP     02582014
025900                                                         SYNC.    02590001
026000             15  ASC-ITEM-SUB                 PIC S9(04) COMP     02600001
026100                                                         SYNC.    02610001
026200             15  ASC-NUMBER-OF-ITEMS-READ     PIC S9(09) COMP-3.  02620001
026300             15  ASC-NUMBER-OF-SELECTED-ITEMS PIC S9(09) COMP-3.  02630001
026400             15  ASC-ITEMS-DISPLAYED          PIC S9(03) COMP-3.  02640001
026500             15  ASC-ITEM-AT-TOP-OF-PANEL     PIC S9(09) COMP-3.  02650001
026600             15  ASC-ITEM-AT-BOT-OF-PANEL     PIC S9(09) COMP-3.  02660001
026700             15  ASC-HIGHEST-BLOCK-WRITTEN    PIC S9(04) COMP     02670001
026800                                                         SYNC.    02680001
026900             15  ASC-START-OF-SELECTED-RANGE  PIC S9(09) COMP-3.  02690001
027000             15  ASC-END-OF-SELECTED-RANGE    PIC S9(09) COMP-3.  02700001
027010             15  ASC-XCNTL-TO-RESEND-SW       PIC  X(01).         02701043
027020                 88  ASC-XCNTL-TO-RESEND           VALUE 'Y'.     02702043
027030                 88  ASC-XCNTL-TO-RESEND-NO        VALUE 'N'.     02703043
027100             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         02710001
027200                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     02720001
027300                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     02730001
027400             15  ASC-TEMP-QUEUE-UPDATE-SW     PIC  X(01).         02740001
027500                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     02750001
027600                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     02760001
027700             15  ASC-LIST-QUEUE-NAME.                             02770001
027800                 20  ASC-LIST-TERM-ID         PIC  X(04).         02780001
027900                 20  ASC-LIST-TASK-NUMBER     PIC S9(05) COMP-3.  02790001
028000                 20  ASC-LIST-SEQ             PIC  9(01).         02800001
028100                                                                  02810001
028200             15  ASC-START-ITEM-REQUEST.                          02820001
028300                 20  ASC-START-ITEM-REQUEST-N PIC  9(05).         02830001
028400                                                                  02840001
028500             15  ASC-SEL-SUB                  PIC S9(4) COMP.     02850001
028600             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     02860001
028700             15  ASC-CURSOR-SW                PIC  X(02).         02870001
028800                 88  ASC-NO-CURSOR                   VALUE 'Z '.  02880001
028900                 88  ASC-SCAC-CSR                    VALUE 'A '.  02890014
029000                 88  ASC-SCAC-ID-CSR                 VALUE 'B '.  02900014
029100*                                                                 02910001
029200             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          02920001
029300                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 02930001
029400             15  ASC-SEL-QUEUE-NAME.                              02940001
029500                 20  ASC-SEL-TERM-ID          PIC  X(04).         02950001
029600                 20  ASC-SEL-TASK-NUMBER      PIC S9(05) COMP-3.  02960001
029700                 20  ASC-SEL-SEQ              PIC  9(01).         02970001
029800             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  02980001
029900                                                                  02990001
030000*-----------------------------------------------------------------03000001
030100             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03010001
030200                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03020001
030300                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03030001
030400                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03040001
030500                                                                  03050001
030600                 20  ASC-ITEM-ARRAY.                              03060001
030700                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        03070001
031000                         30  ASC-LIST-ITEM-NUMBER                 03100001
031100                                                     PIC S9(09)   03110001
031200                                                     COMP-3.      03120001
031300                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03130001
031400                             88  ASC-VALID-SELECT    VALUE ' '    03140001
031500                                                           'S'    03150001
031600                                                           'B'    03160001
031700                                                           'E'.   03170001
031800                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03180001
031900                             88  ASC-TEMP-SELECT     VALUE 'S'.   03190001
032000                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03200001
032100                             88  ASC-TEMP-END        VALUE 'E'.   03210001
032200                         30  ASC-SELECTED-SW         PIC  X(01).  03220001
032300                             88  ASC-NO-SELECT       VALUE ' '.   03230001
032400                             88  ASC-SELECT          VALUE 'S'.   03240001
032500                             88  ASC-BEGIN           VALUE 'B'.   03250001
032600                             88  ASC-END             VALUE 'E'.   03260001
032700                         30  ASC-ACTION              PIC  X(03).  03270001
032810                         30  ASC-TRAILER-ID          PIC  X(12).  03281001
032820                         30  ASC-SERIAL-NBR          PIC  X(09).  03282001
032821                         30  ASC-SERIAL-NBR-X REDEFINES           03282102
032822                                                   ASC-SERIAL-NBR.03282202
032823                             35  ASC-SERIAL-NBR-N     PIC  9(09). 03282302
032824                         30  ASC-TRLR-LENGTH         PIC  9(04).  03282444
032830                                                                  03283001
032900*---------------------------------------------------------------* 03290001
033000*    ABEND PROCESSING COPYBOOK.                                 * 03300001
033100*---------------------------------------------------------------* 03310001
033200     COPY DPWS013.                                                03320001
033300                                                                  03330001
033900*---------------------------------------------------------------* 03390001
034000*    TCNTRID -  TRAILER ID TABLE                                * 03400001
034100*---------------------------------------------------------------* 03410001
034200     EXEC SQL                                                     03420001
034300          INCLUDE TCNTRID                                         03430001
034400     END-EXEC.                                                    03440001
034500*                                                                 03450001
035300*---------------------------------------------------------------* 03530001
035400*    SCAC CURSOR WITHOUT TRAILER ID                               03540001
035500*---------------------------------------------------------------* 03550001
035600     EXEC SQL                                                     03560001
035700        DECLARE SCAC-CSR CURSOR FOR                               03570001
035800           SELECT TRLR_ID                                         03580001
035900                 ,TRLR_SRL_NBR                                    03590001
035910                 ,TRLR_SIZE_MU                                    03591044
036000           FROM  TCNTRID                                          03600001
036010          WHERE  SCAC_CDE  = :DK-SCAC-CDE                         03601001
036020        ORDER BY TRLR_ID                                          03602001
036030                ,TRLR_SRL_NBR                                     03603001
036100     END-EXEC.                                                    03610001
036200                                                                  03620001
036210*---------------------------------------------------------------* 03621001
036220*    SCAC CURSOR WITH TRAILER ID                                  03622001
036230*---------------------------------------------------------------* 03623001
036240     EXEC SQL                                                     03624001
036250        DECLARE SCAC-ID-CSR CURSOR FOR                            03625001
036260           SELECT TRLR_ID                                         03626001
036270                 ,TRLR_SRL_NBR                                    03627001
036271                 ,TRLR_SIZE_MU                                    03627144
036280           FROM  TCNTRID                                          03628001
036290          WHERE  SCAC_CDE  = :DK-SCAC-CDE                         03629001
036291            AND  TRLR_ID   = :DK-TRAILER-ID                       03629103
036292        ORDER BY TRLR_ID                                          03629201
036293                ,TRLR_SRL_NBR                                     03629301
036294     END-EXEC.                                                    03629401
036295                                                                  03629512
036296*---------------------------------------------------------------* 03629612
036297*    DB2 AREA FOR COMMUNICATIONS                                * 03629712
036298*---------------------------------------------------------------* 03629812
036299     EXEC SQL                                                     03629912
036300          INCLUDE SQLCA                                           03630012
036301     END-EXEC.                                                    03630112
036302                                                                  03630212
036303***************************************************************** 03630301
036310 LINKAGE SECTION.                                                 03631001
036400                                                                  03640001
036500 01  DFHCOMMAREA.                                                 03650001
036600     05  FILLER                         OCCURS  1 TO 4072 TIMES   03660001
036700                                        DEPENDING ON EIBCALEN.    03670001
036800         10  FILLER                     PIC X.                    03680001
036900                                                                  03690001
037000                                                                  03700001
037100 PROCEDURE DIVISION.                                              03710001
037200******************************************************************03720001
037300**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **03730001
037400**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **03740001
037500**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **03750001
037600******************************************************************03760001
037700 0000-MAIN-MODULE.                                                03770001
037800     INITIALIZE DP030-CICS-API-FIELDS.                            03780001
037900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03790001
038000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03800001
038100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03810001
038200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03820001
038300     MOVE LENGTH OF CNK223I        TO DP030-MAP-LENGTH (1).       03830001
038400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03840001
038500     PERFORM 0001-CALL-CICS-ARCH-API.                             03850001
038600*                                                                 03860001
038700     PERFORM 1000-CONTROL-PROCESSING                              03870001
038800*                                                                 03880001
038900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03890001
039000     PERFORM 0001-CALL-CICS-ARCH-API.                             03900001
039100                                                                  03910001
039200******************************************************************03920001
039300**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **03930001
039400**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **03940001
039500******************************************************************03950001
039600 0001-CALL-CICS-ARCH-API.                                         03960001
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03970054
039800                                    DFHCOMMAREA                   03980054
039900                                    DP030-CICS-API-FIELDS         03990054
040000                                    DP020-STANDARD-COMMAREA       04000054
040100                                    CNK223I.                      04010054
040200*                                                                 04020001
040300     IF  DP030-RC-CALL-SUCCESSFUL                                 04030001
040400         CONTINUE                                                 04040001
040500     ELSE                                                         04050001
040600         SET DP013-NO-ROLLBACK                                    04060001
040700             DP013-XCTL-DISPLAY-RESTART                           04070001
040800             DP013-CICS-ABEND      TO TRUE                        04080001
040900         MOVE '0001-CALL-CICS-ARCH-API'                           04090001
041000                                   TO DP013-PARAGRAPH             04100001
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04101054
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04102054
041300         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04130001
041400         PERFORM DP013-0000-PROCESS-ABEND                         04140001
041500     END-IF.                                                      04150001
041600                                                                  04160001
041700*----------------------------------------------------------------*04170001
041800* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04180001
041900* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04190001
042000*                                                                *04200001
042100* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04210001
042200*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04220001
042300*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04230001
042400*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04240001
042500*----------------------------------------------------------------*04250001
042600 1000-CONTROL-PROCESSING.                                         04260001
042700     EVALUATE TRUE                                                04270001
042800         WHEN DP020-NEXT-ACT-INITIAL                              04280001
042900             INITIALIZE ASC-SPECIFIC-COMMAREA                     04290001
043000             MOVE EIBTRMID    TO ASC-LIST-TERM-ID                 04300023
043100                                 ASC-SEL-TERM-ID                  04310023
043200             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   04320023
043300                                           ASC-SEL-TASK-NUMBER    04330043
043500             MOVE PC-LIST-QUEUE-SEQ TO ASC-LIST-SEQ               04350001
043600             MOVE PC-SEL-QUEUE-SEQ  TO ASC-SEL-SEQ                04360001
043700             PERFORM 1100-PROCESS-INTER-APPL-COMM                 04370001
043800             PERFORM 4000-BUILD-INITIAL-PANEL                     04380043
044900                                                                  04490001
045000         WHEN DP020-NEXT-ACT-READ-MAP                             04500001
045100             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         04510043
045200             PERFORM 2000-PROCESS-PANEL                           04520043
045300                                                                  04530001
045400         WHEN DP020-NEXT-ACT-RETURN                               04540001
045500             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         04550043
045600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    04560043
045700                                                                  04570043
045800         IF  ASC-XCNTL-TO-RESEND                                  04580043
045810             PERFORM 2050-DELETE-LIST-QUEUE                       04581043
045820             PERFORM 4000-BUILD-INITIAL-PANEL                     04582043
045830             PERFORM 2140-DESELECT-ALL-ITEMS                      04583043
045840             PERFORM 3200-RESET-ATTRIBUTES                        04584043
045850             SET ASC-XCNTL-TO-RESEND-NO  TO TRUE                  04585043
045860         END-IF                                                   04586043
045870                                                                  04587043
045880             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 04588043
045890             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04589043
045900                                                                  04590001
046000         WHEN OTHER                                               04600001
046100             SET DP013-LOGIC-ABEND TO TRUE                        04610001
046200             SET DP013-NO-ROLLBACK TO TRUE                        04620001
046300             MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH    04630001
046400             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    04640001
046500                                   TO DP013-MESSAGE-TEXT(1)       04650001
046600             PERFORM DP013-0000-PROCESS-ABEND                     04660001
046700     END-EVALUATE.                                                04670001
046800                                                                  04680001
046900*----------------------------------------------------------------*04690001
047000* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *04700001
047100* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *04710001
047200*----------------------------------------------------------------*04720001
047300 1100-PROCESS-INTER-APPL-COMM.                                    04730001
047400                                                                  04740001
047500     SET PS-COMMAREA-VALID         TO TRUE.                       04750001
047600     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     04760001
047700                                                                  04770001
047800     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          04780025
047900         MOVE CN008-OPER-UNT-ID        TO ASC-OPER-UNT-ID         04790043
047910         MOVE CN008-FCLTY-ID           TO ASC-FCLTY-ID            04791043
047911         MOVE CN008-FCLTY-NME          TO ASC-FCLTY-NAME          04791143
047912         MOVE CN008-SCAC               TO ASC-SCAC                04791243
047913         MOVE CN008-SCAC-NAME          TO ASC-SCAC-NAME           04791343
047914         MOVE CN008-TRLR-ID            TO ASC-TRLR-ID             04791443
047915         MOVE CN008-TRLR-SRL-NBR       TO ASC-TRLR-SRL-NBR        04791543
047916         MOVE CN008-PRINTER-ID         TO ASC-PRTR-ID             04791643
047917     ELSE                                                         04791743
047918         MOVE CN009-CURR-OPER-UNT-ID   TO ASC-OPER-UNT-ID         04791843
047919         MOVE CN009-CURR-FCLTY-ID      TO ASC-FCLTY-ID            04791943
047920         MOVE CN009-PRTR-ID            TO ASC-PRTR-ID             04792043
047930         MOVE CN009-DC-PRTD-AT         TO ASC-DC-PRTD-AT          04793043
047940         MOVE CN009-USER-ID            TO ASC-USER-ID             04794043
047950     END-IF.                                                      04795043
047960                                                                  04796043
047970*----------------------------------------------------------------*04797043
047980* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04798043
047990* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04799043
048800* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04880001
048900* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *04890001
049000* FUNCTION KEYS CAN GET THIS FAR.                                *04900001
049100*----------------------------------------------------------------*04910001
049200 2000-PROCESS-PANEL.                                              04920001
049300     EVALUATE TRUE                                                04930001
049400         WHEN DP020-SRC-AID = DP016-CLEAR                         04940001
049500             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                04950001
049600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04960001
049700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04970001
049800                                                                  04980001
049900         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    04990001
050000             PERFORM 2050-DELETE-LIST-QUEUE                       05000001
050100             PERFORM 4000-BUILD-INITIAL-PANEL                     05010001
050200                                                                  05020001
050300         WHEN DP020-FK-DESELECT (DP020-SRC-AID)                   05030043
050400             PERFORM 2140-DESELECT-ALL-ITEMS                      05040012
050500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05050012
050600                                                                  05060001
050700         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  05070012
050800             PERFORM 2150-SELECT-ALL-ITEMS                        05080012
050900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05090012
051000                                                                  05100001
051100         WHEN OTHER                                               05110001
051200             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05120001
051300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05130001
051400             IF  PS-NO-ERROR                                      05140001
051500                 SET DP030-CONTINUE-GO TO TRUE                    05150001
051600                 PERFORM 2100-CHECK-FUNCTION-KEY                  05160001
051700             ELSE                                                 05170001
051800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05180001
051900                 SET DP030-OVERRIDE-GO TO TRUE                    05190001
052000             END-IF                                               05200001
052100     END-EVALUATE.                                                05210001
052200                                                                  05220001
052300*----------------------------------------------------------------*05230001
052400*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *05240001
052500*----------------------------------------------------------------*05250001
052600 2050-DELETE-LIST-QUEUE.                                          05260001
052700                                                                  05270001
052800     EXEC CICS                                                    05280001
052900         DELETEQ TS                                               05290001
053000             QUEUE (ASC-LIST-QUEUE-NAME)                          05300001
053100             RESP  (PV-CICS-RESP)                                 05310001
053200     END-EXEC.                                                    05320001
053300                                                                  05330001
053400     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       05340001
053500        (PV-CICS-RESP = DFHRESP(QIDERR))                          05350001
053600         CONTINUE                                                 05360001
053700     ELSE                                                         05370001
053800         SET DP013-CICS-ABEND      TO TRUE                        05380001
053900         SET DP013-NO-ROLLBACK     TO TRUE                        05390001
054000                                                                  05400001
054100         MOVE '2050-DELETE-LIST-QUEUE' TO DP013-PARAGRAPH         05410001
054200         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    05420001
054300                                   TO DP013-MESSAGE-TEXT (1)      05430001
054400         PERFORM DP013-0000-PROCESS-ABEND                         05440001
054500     END-IF.                                                      05450001
054600                                                                  05460001
054700     MOVE +0  TO ASC-HIGHEST-BLOCK-WRITTEN.                       05470012
054800                                                                  05480001
054900*----------------------------------------------------------------*05490001
055000* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*05500001
055100* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *05510001
055200* CICS ARCHITECTURE API.                                         *05520001
055300*----------------------------------------------------------------*05530001
055400 2100-CHECK-FUNCTION-KEY.                                         05540001
055500                                                                  05550001
055600     EVALUATE TRUE                                                05560001
055700                                                                  05570001
055800* F18 - PRINT LABELS  (LOCAL-FUNC-01)                             05580043
055900         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              05590043
056000             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              05600043
056100                 PERFORM 3010-VALIDATE-PRINTER-ID                 05610043
056200                 IF  PS-NO-ERROR                                  05620043
056300                     PERFORM 4600-PROCESS-PRINT-FUNCTION          05630043
056400                       VARYING PV-ITEM FROM 1 BY 1                05640043
056500                       UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN  05650043
056600                         OR PS-SOFT-ABORT-ERROR                   05660043
056700                         IF PS-NO-ERROR                           05670043
056800                            MOVE DP015-UNP-NUM-NOR-OFF TO APRTIDA 05680043
056900                            MOVE DP015-GREEN           TO APRTIDC 05690043
057000                            MOVE DP015-UNDERLINE       TO APRTIDH 05700043
057100                         END-IF                                   05710043
057200                 END-IF                                           05720043
057300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05730043
057400             ELSE                                                 05740043
057500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05750043
057600                 SET DP030-OVERRIDE-GO TO TRUE                    05760043
057700                 MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER        05770043
057800                 SET DP020-MSG-FATAL   TO TRUE                    05780043
057900             END-IF                                               05790043
058000                                                                  05800043
058100*-----------------------------------------------------------------05810047
058200* F15 - UPDATE        (LOCAL-FUNC-02)                             05820047
058201* ADDED - DMH - 07-06-2018                                        05820147
058210*-----------------------------------------------------------------05821047
058300         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              05830047
058400             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              05840047
058500                 INITIALIZE CN009-INTER-APPL-COMMAREA             05850049
058510                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                05851048
058520                                TO CN009-NUMBER-OF-SELECTED-ITEMS 05852048
058530                 MOVE ASC-SEL-QUEUE-NAME                          05853048
058540                                TO CN009-SEL-QUEUE-NAME           05854048
058550                 MOVE ASC-OPER-UNT-ID                             05855048
058592                                TO  CN009-CURR-OPER-UNT-ID        05859248
058593                 MOVE ASC-FCLTY-ID                                05859348
058594                                TO  CN009-CURR-FCLTY-ID           05859448
058595                 MOVE ASC-PRTR-ID                                 05859548
058596                                TO  CN009-PRTR-ID                 05859648
058597                 MOVE ASC-DC-PRTD-AT                              05859748
058598                                TO  CN009-DC-PRTD-AT              05859848
058599                 MOVE ASC-USER-ID                                 05859948
058600                                TO  CN009-USER-ID                 05860048
058601                 PERFORM 5000-PREPARE-SEL-QUEUE                   05860148
058602             ELSE                                                 05860247
058603                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05860347
058604                 SET DP030-OVERRIDE-GO TO TRUE                    05860447
058605                 MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER        05860547
058606                 SET DP020-MSG-FATAL   TO TRUE                    05860647
058607             END-IF                                               05860747
058608                                                                  05860847
058610* F6 - FIRST PAGE                                                 05861001
058700         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  05870001
058800             MOVE +1               TO PV-TOP-ITEM                 05880001
058900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05890001
059000                                                                  05900001
059100* F7 - PREVIOUS PAGE                                              05910001
059200         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   05920001
059300             PERFORM 2110-BROWSE-BACKWARD                         05930001
059400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05940001
059500                                                                  05950001
059600* F8 - NEXT PAGE                                                  05960001
059700         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   05970001
059800             PERFORM 2120-BROWSE-FORWARD                          05980001
059900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05990001
060000                                                                  06000001
060100* ENTER KEY                                                       06010001
060200         WHEN DP020-SRC-AID = DP016-ENTER                         06020001
060300             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   06030001
060400             IF  PS-ERROR                                         06040001
060500                 CONTINUE                                         06050001
060600             ELSE                                                 06060001
060700                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06070001
060800             END-IF                                               06080001
060900                                                                  06090001
061000         WHEN OTHER                                               06100001
061100             SET DP013-NO-ROLLBACK                                06110001
061200                 DP013-XCTL-DISPLAY-RESTART                       06120001
061300                 DP013-CICS-ABEND  TO TRUE                        06130001
061400             MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH    06140001
061500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06150001
061600                                   TO DP013-MESSAGE-TEXT (1)      06160001
061700             PERFORM DP013-0000-PROCESS-ABEND                     06170001
061800     END-EVALUATE.                                                06180001
061900                                                                  06190001
062000*----------------------------------------------------------------*06200001
062100*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *06210001
062200*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *06220001
062300*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *06230001
062400*    MESSAGE.                                                    *06240001
062500*----------------------------------------------------------------*06250001
062600 2110-BROWSE-BACKWARD.                                            06260001
062700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    06270001
062800         GIVING PV-TOP-ITEM.                                      06280001
062900*                                                                 06290001
063000     IF  ((PV-TOP-ITEM < +1)                                      06300001
063100       OR (PV-TOP-ITEM = +1))                                     06310001
063200         MOVE +1                   TO PV-TOP-ITEM                 06320001
063300*        -- TOP OF LIST --                                        06330001
063400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06340001
063500         SET DP020-MSG-INFORMATIONAL TO TRUE                      06350001
063600     END-IF.                                                      06360001
063700                                                                  06370001
063800*----------------------------------------------------------------*06380001
063900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *06390001
064000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *06400001
064100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *06410001
064200*----------------------------------------------------------------*06420001
064300 2120-BROWSE-FORWARD.                                             06430001
064400     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              06440001
064500         GIVING PV-TOP-ITEM.                                      06450001
064600     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   06460001
064700         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             06470001
064800*        -- BOTTOM OF LIST --                                     06480001
064900         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06490001
065000         SET DP020-MSG-INFORMATIONAL TO TRUE                      06500001
065100     ELSE                                                         06510001
065200         COMPUTE PV-BOTTOM-ITEM =                                 06520001
065300             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 06530001
065400         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            06540001
065500*            -- BOTTOM OF LIST --                                 06550001
065600             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            06560001
065700             SET DP020-MSG-INFORMATIONAL TO TRUE                  06570001
065800         END-IF                                                   06580001
065900     END-IF.                                                      06590001
066000                                                                  06600001
066100*----------------------------------------------------------------*06610001
066200*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *06620001
066300*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *06630001
066400*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *06640001
066500*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *06650001
066600*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *06660001
066700*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *06670001
066800*----------------------------------------------------------------*06680001
066900 2130-CHECK-FOR-JUMP-BROWSE.                                      06690001
067000     SET PS-NO-ERROR               TO TRUE.                       06700001
067100     IF (ASC-START-ITEM-REQUEST = SPACE)                          06710001
067200         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             06720001
067300     ELSE                                                         06730001
067400         MOVE ASC-START-ITEM-REQUEST TO DP010I-UNEDITED-FIELD     06740001
067500         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       06750001
067600         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     06760001
067700         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  06770001
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06781053
263455              USING DP010I-NUMERIC-EDIT-AREA                      06782053
067900                                                                  06790001
068000         IF  NOT DP010I-ERROR-DETECTED                            06800001
068100             MOVE DP010I-NUMERIC-FIELD TO ASC-START-ITEM-REQUEST-N06810001
068200             IF  ASC-START-ITEM-REQUEST-N > ZERO                  06820001
068300                 IF  ASC-START-ITEM-REQUEST-N >                   06830001
068400                                          ASC-NUMBER-OF-ITEMS-READ06840001
068500                     MOVE SPACE TO ASC-START-ITEM-REQUEST         06850001
068600                     COMPUTE PV-TOP-ITEM =                        06860001
068700                             ASC-NUMBER-OF-ITEMS-READ             06870001
068800                             - PC-ITEMS-PER-PANEL + 1             06880001
068900                     IF  PV-TOP-ITEM < +1                         06890001
069000                         MOVE +1   TO PV-TOP-ITEM                 06900001
069100                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 06910001
069200                         SET DP020-MSG-INFORMATIONAL TO TRUE      06920001
069300                     END-IF                                       06930001
069400                 ELSE                                             06940001
069500                     MOVE ASC-START-ITEM-REQUEST-N                06950001
069600                                   TO PV-TOP-ITEM                 06960001
069700                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      06970001
069800                     COMPUTE PV-BOTTOM-ITEM =                     06980001
069900                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     06990001
070000                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ07000001
070100*                        -- BOTTOM OF LIST --                     07010001
070200                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 07020001
070300                         SET DP020-MSG-INFORMATIONAL TO TRUE      07030001
070400                     END-IF                                       07040001
070500                 END-IF                                           07050001
070600             ELSE                                                 07060001
070700*                --- VALUE OUT OF RANGE ----                      07070001
070800                 MOVE PC-TSYMSG-00101 TO DP020-MSG-NUMBER         07080001
070900                 MOVE -1              TO ASTRTITL                 07090001
071000                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              07100001
071100                 MOVE DP015-REVERSE   TO ASTRTITH                 07110001
071200                 MOVE DP015-RED       TO ASTRTITC                 07120001
071300                 MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA           07130001
071400                 SET DP020-MSG-FATAL  TO TRUE                     07140001
071500                 SET PS-ERROR         TO TRUE                     07150001
071600             END-IF                                               07160001
071700         ELSE                                                     07170001
071800             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07180001
071900             MOVE -1               TO ASTRTITL                    07190001
072000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07200001
072100             MOVE DP015-REVERSE    TO ASTRTITH                    07210001
072200             MOVE DP015-RED        TO ASTRTITC                    07220001
072300             MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA               07230001
072400             SET DP020-MSG-FATAL   TO TRUE                        07240001
072500             SET PS-ERROR          TO TRUE                        07250001
072600         END-IF                                                   07260001
072700     END-IF.                                                      07270001
072800                                                                  07280001
072900*----------------------------------------------------------------*07290001
073000*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *07300001
073100*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *07310001
073200*----------------------------------------------------------------*07320001
073300 2140-DESELECT-ALL-ITEMS.                                         07330001
073400     MOVE +1                       TO ASC-BLK-SUB.                07340001
073500                                                                  07350001
073600     PERFORM 2141-CLEAR-SELECTED-INDS                             07360001
073700         VARYING ASC-ITEM-SUB                                     07370001
073800         FROM 1 BY 1                                              07380001
073900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 07390001
074000                                                                  07400001
074100     ADD +1                        TO ASC-BLK-SUB.                07410001
074200                                                                  07420001
074300     PERFORM 2141-CLEAR-SELECTED-INDS                             07430001
074400         VARYING ASC-ITEM-SUB                                     07440001
074500         FROM 1 BY 1                                              07450001
074600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 07460001
074700                                                                  07470001
074800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               07480001
074900                                   TO PV-LIST-ITEM-NUMBER.        07490001
075000                                                                  07500001
075100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            07510001
075200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    07520001
075300                                                                  07530001
075310     IF  PV-FIRST-BLOCK-IN-ARRAY  = +1                            07531043
075320         MOVE +1                   TO ASC-BLK-SUB                 07532043
075330                                                                  07533043
075340         PERFORM 5100-WRITE-TEMP-STORAGE                          07534043
075350         MOVE +2                   TO ASC-BLK-SUB                 07535043
075360         PERFORM 5100-WRITE-TEMP-STORAGE                          07536043
075370         MOVE +1                   TO ASC-BLK-SUB                 07537043
075380         MOVE +1                   TO PV-BLOCK-NUMBER             07538043
075390     END-IF.                                                      07539043
075391                                                                  07539143
075400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     07540001
075500        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      07550001
075600         MOVE +1                   TO ASC-BLK-SUB                 07560001
075700                                                                  07570001
075710         PERFORM 5100-WRITE-TEMP-STORAGE                          07571043
075720         MOVE +2  TO ASC-BLK-SUB                                  07572043
075800         PERFORM 5100-WRITE-TEMP-STORAGE                          07580001
075900         MOVE +1  TO ASC-BLK-SUB                                  07590043
076000         MOVE +1  TO PV-BLOCK-NUMBER                              07600037
076100                                                                  07610001
076200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         07620001
076300             PV-FIRST-BLOCK-IN-ARRAY - 1                          07630001
076400                                                                  07640001
076500         PERFORM                                                  07650001
076600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       07660001
076700                                                                  07670001
076800             PERFORM 4410-READ-TEMP-STORAGE                       07680001
076900                                                                  07690001
077000             PERFORM 2141-CLEAR-SELECTED-INDS                     07700001
077100                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 07710001
077200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          07720001
077300                                                                  07730001
077400             PERFORM 5100-WRITE-TEMP-STORAGE                      07740001
077500                                                                  07750001
077600             ADD +1                TO PV-BLOCK-NUMBER             07760001
077700                                                                  07770001
077800         END-PERFORM                                              07780001
077900                                                                  07790001
078000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         07800001
078100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     07810001
078200                                                                  07820001
078300         PERFORM                                                  07830001
078400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       07840001
078500                   ASC-HIGHEST-BLOCK-WRITTEN                      07850001
078600                                                                  07860001
078700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          07870001
078800                                   TO PV-BLOCK-NUMBER             07880001
078900                                                                  07890001
079000             PERFORM 4410-READ-TEMP-STORAGE                       07900001
079100                                                                  07910001
079200             PERFORM 2141-CLEAR-SELECTED-INDS                     07920001
079300                 VARYING ASC-ITEM-SUB                             07930001
079400                 FROM 1 BY 1                                      07940001
079500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          07950001
079600                                                                  07960001
079700             PERFORM 5100-WRITE-TEMP-STORAGE                      07970001
079800                                                                  07980001
079900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      07990001
080000                                                                  08000001
080100         END-PERFORM                                              08010001
080200                                                                  08020001
080300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             08030001
080400                                   TO PV-BLOCK-NUMBER             08040001
080500                                                                  08050001
080600         PERFORM 4410-READ-TEMP-STORAGE                           08060001
080700     END-IF.                                                      08070001
080800                                                                  08080001
080900                                                                  08090001
081000     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 08100001
081100     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.08110001
081200     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  08120001
081300                                                                  08130001
081400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        08140001
081500                                                                  08150001
081600*----------------------------------------------------------------*08160001
081700*    MARK EACH ITEM AS BEING NOT SELECTED.                       *08170001
081800*----------------------------------------------------------------*08180001
081900 2141-CLEAR-SELECTED-INDS.                                        08190001
082000     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           08200001
082100             NOT EQUAL ZERO                                       08210001
082200         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          08220001
082300             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          08230001
082400                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    08240001
082500                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE          08250023
082700         END-IF                                                   08270001
082800     END-IF.                                                      08280001
082900                                                                  08290001
083000*----------------------------------------------------------------*08300001
083100*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTION SWITCH *08310001
083200*  FOR ALL ITEMS.                                                *08320001
083300*----------------------------------------------------------------*08330001
083400 2150-SELECT-ALL-ITEMS.                                           08340001
083500     MOVE +1                       TO ASC-BLK-SUB.                08350001
083600                                                                  08360001
083700     PERFORM 2151-SET-SELECTED-INDS                               08370001
083800         VARYING ASC-ITEM-SUB                                     08380001
083900         FROM 1 BY 1                                              08390001
084000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08400001
084100                                                                  08410001
084200     ADD +1                        TO ASC-BLK-SUB.                08420001
084300                                                                  08430001
084400     PERFORM 2151-SET-SELECTED-INDS                               08440001
084500         VARYING ASC-ITEM-SUB                                     08450001
084600         FROM 1 BY 1                                              08460001
084700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08470001
084800                                                                  08480001
084900     MOVE ASC-LIST-ITEM-NUMBER(1 1)  TO PV-LIST-ITEM-NUMBER.      08490001
085000                                                                  08500001
085100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            08510001
085200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    08520001
085300                                                                  08530001
085310     IF  PV-FIRST-BLOCK-IN-ARRAY  = +1                            08531043
085320         MOVE +1                   TO ASC-BLK-SUB                 08532043
085330                                                                  08533043
085340         PERFORM 5100-WRITE-TEMP-STORAGE                          08534043
085350         MOVE +2                   TO ASC-BLK-SUB                 08535043
085360         PERFORM 5100-WRITE-TEMP-STORAGE                          08536043
085370         MOVE +1                   TO ASC-BLK-SUB                 08537043
085380         MOVE +1                   TO PV-BLOCK-NUMBER             08538043
085390     END-IF.                                                      08539043
085400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     08540001
085500        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    08550001
085600         MOVE +1                   TO ASC-BLK-SUB                 08560001
085700                                                                  08570001
085800         PERFORM 5100-WRITE-TEMP-STORAGE                          08580001
085900                                                                  08590001
086000         MOVE +1                   TO PV-BLOCK-NUMBER             08600001
086100                                                                  08610001
086200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         08620001
086300             PV-FIRST-BLOCK-IN-ARRAY - 1                          08630001
086400                                                                  08640001
086500         PERFORM                                                  08650001
086600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       08660001
086700                                                                  08670001
086800             PERFORM 4410-READ-TEMP-STORAGE                       08680001
086900                                                                  08690001
087000             PERFORM 2151-SET-SELECTED-INDS                       08700001
087100                 VARYING ASC-ITEM-SUB                             08710001
087200                 FROM 1 BY 1                                      08720001
087300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08730001
087400                                                                  08740001
087500             PERFORM 5100-WRITE-TEMP-STORAGE                      08750001
087600                                                                  08760001
087700             ADD +1                TO PV-BLOCK-NUMBER             08770001
087800                                                                  08780001
087900         END-PERFORM                                              08790001
088000                                                                  08800001
088100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         08810001
088200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     08820001
088300                                                                  08830001
088400         PERFORM                                                  08840001
088500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       08850001
088600                   ASC-HIGHEST-BLOCK-WRITTEN                      08860001
088700                                                                  08870001
088800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          08880001
088900                                   TO PV-BLOCK-NUMBER             08890001
089000                                                                  08900001
089100             PERFORM 4410-READ-TEMP-STORAGE                       08910001
089200                                                                  08920001
089300             PERFORM 2151-SET-SELECTED-INDS                       08930001
089400                 VARYING ASC-ITEM-SUB                             08940001
089500                 FROM 1 BY 1                                      08950001
089600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08960001
089700                                                                  08970001
089800             PERFORM 5100-WRITE-TEMP-STORAGE                      08980001
089900                                                                  08990001
090000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09000001
090100                                                                  09010001
090200         END-PERFORM                                              09020001
090300                                                                  09030001
090400         MOVE PV-FIRST-BLOCK-IN-ARRAY  TO PV-BLOCK-NUMBER         09040001
090500                                                                  09050001
090600         PERFORM 4410-READ-TEMP-STORAGE                           09060001
090700     END-IF.                                                      09070001
090800                                                                  09080001
090900     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             09090001
091000                       ASC-NUMBER-OF-SELECTED-ITEMS.              09100001
091100                                                                  09110001
091200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09120001
091300                                                                  09130001
091400*----------------------------------------------------------------*09140001
091500*    MARK EACH ITEM AS BEING SELECTED.                           *09150001
091600*----------------------------------------------------------------*09160001
091700 2151-SET-SELECTED-INDS.                                          09170001
091800     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           09180001
091900             NOT EQUAL ZERO                                       09190001
092000         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             09200001
092100             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             09210001
092200                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        09220001
092300                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  09230001
092400                               TO  TRUE                           09240001
092500         END-IF                                                   09250001
092600     END-IF.                                                      09260001
092700                                                                  09270001
092800******************************************************************09280001
092900** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **09290001
093000** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **09300001
093100******************************************************************09310001
093200 2200-MOVE-SCREEN-TO-COMMAREA.                                    09320001
093300                                                                  09330001
093400     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             09340001
093500     MOVE +1                       TO PV-SUB.                     09350001
093600*                                                                 09360001
093700     PERFORM 3100-SET-SUBSCRIPTS.                                 09370001
093710                                                                  09371009
093800     IF  ASTRTITL > ZERO                                          09380001
093900         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          09390012
094000     ELSE                                                         09400001
094100         IF  ASTRTITF = DP015-ERASE-EOF                           09410001
094200             INITIALIZE ASC-START-ITEM-REQUEST                    09420012
094300         END-IF                                                   09430001
094400     END-IF.                                                      09440001
094500                                                                  09450001
094510     IF  APRTIDL > ZERO                                           09451012
094520         IF APRTIDI  NOT = ASC-PRTR-ID                            09452014
094540             MOVE APRTIDI            TO ASC-PRTR-ID               09454014
094550         ELSE                                                     09455012
094560             IF  APRTIDF = DP015-ERASE-EOF                        09456012
094580                 MOVE  SPACES        TO ASC-PRTR-ID               09458014
094590             END-IF                                               09459012
094591         END-IF                                                   09459112
094592     END-IF.                                                      09459212
094593                                                                  09459312
094600     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          09460001
094700         VARYING PV-SUB FROM 1 BY 1                               09470009
094900         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      09490001
095000                                                                  09500001
095100******************************************************************09510001
095200** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**09520001
095300******************************************************************09530001
095400 2210-MOVE-LINES-TO-COMMAREA.                                     09540001
095500     IF  MR-SELECTL (PV-SUB) > ZERO                               09550001
095600         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             09560001
095800         MOVE MR-SELECTI (PV-SUB)  TO ASC-TEMP-SELECTED-SW        09580001
095900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      09590001
096000     ELSE                                                         09600001
096100         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                09610001
096200                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     09620001
096300                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        09630001
096400                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 09640006
096500         END-IF                                                   09650001
096600     END-IF.                                                      09660001
096700                                                                  09670001
096800     ADD +1                        TO ASC-ITEM-SUB.               09680001
096900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        09690001
097000         ADD +1                    TO ASC-BLK-SUB                 09700001
097100         MOVE +1                   TO ASC-ITEM-SUB                09710001
097200     END-IF.                                                      09720001
097300                                                                  09730001
097400******************************************************************09740001
097500** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **09750001
097600** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **09760001
097700******************************************************************09770001
097800 3000-EDIT-DATA-IN-COMMAREA.                                      09780001
097900     SET PS-NO-ERROR               TO TRUE.                       09790001
098000     PERFORM 3200-RESET-ATTRIBUTES.                               09800001
098100     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     09810001
098110                                                                  09811009
098200                                                                  09820001
098300* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              09830001
098400* EDITTING IS DONE FROM THE BOTTOM UP.                            09840001
098500**                                                                09850001
098600     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       09860001
098700         ASC-ITEMS-DISPLAYED - 1.                                 09870001
098800     PERFORM 3100-SET-SUBSCRIPTS.                                 09880001
098900                                                                  09890001
099000      IF  PS-NO-ERROR                                             09900001
099100          PERFORM 3005-EDIT-COMMAREA-BLOCKS                       09910001
099200      END-IF.                                                     09920001
099300                                                                  09930001
099400     IF  PS-NO-ERROR                                              09940001
099500         PERFORM 3400-CHECK-RANGE-SEQUENCE                        09950001
099600     END-IF.                                                      09960001
099700                                                                  09970001
099800     IF  ((PS-NO-ERROR)                                           09980001
099900       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   09990001
100000       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    10000001
100100             PERFORM 3500-MARK-RANGE-AS-SELECTED                  10010001
100200     END-IF.                                                      10020001
100300                                                                  10030001
100400*----------------------------------------------------------------*10040001
100500* 3005-EDIT-COMMAREA-BLOCKS                                      *10050001
100600*----------------------------------------------------------------*10060001
100700 3005-EDIT-COMMAREA-BLOCKS.                                       10070001
100800     MOVE +1                       TO PV-BLOCK-NUMBER.            10080001
100900     MOVE +1                       TO ASC-BLK-SUB.                10090001
101000     MOVE PC-ITEMS-PER-PANEL       TO ASC-ITEM-SUB.               10100001
101100                                                                  10110001
101200     COMPUTE PV-BLOCK-NUMBER  =                                   10120001
101300             1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /            10130001
101400             PC-ITEMS-PER-PANEL.                                  10140001
101500                                                                  10150001
101600     MOVE  PV-BLOCK-NUMBER         TO PV-ORIGINAL-BLOCK.          10160001
101700                                                                  10170001
101800     PERFORM                                                      10180001
101900        UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN         10190001
102000           OR PS-ERROR                                            10200001
102100           OR PS-BLOCK-ERROR                                      10210001
102200                                                                  10220001
102300              COMPUTE PV-ITEMS-HOLD  =                            10230001
102400                      ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +       10240001
102500                      PC-ITEMS-PER-PANEL - 1                      10250001
102600                                                                  10260001
102700               IF  PV-ITEMS-HOLD  >  ASC-NUMBER-OF-ITEMS-READ     10270001
102800                   SUBTRACT  ASC-NUMBER-OF-ITEMS-READ             10280001
102900                       FROM  PV-ITEMS-HOLD                        10290001
103000                     GIVING  PV-ITEMS-DIFF                        10300001
103100                   SUBTRACT  PV-ITEMS-DIFF                        10310001
103200                       FROM  PC-ITEMS-PER-PANEL                   10320001
103300                     GIVING  PV-ITEMS-HOLD                        10330001
103400                       MOVE  PV-ITEMS-HOLD TO PV-SUB              10340001
103500                                              ASC-ITEM-SUB        10350001
103600                                              ASC-ITEMS-DISPLAYED 10360001
103700                                                                  10370001
103800               ELSE                                               10380001
103900                   MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB            10390001
104000                   MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB      10400001
104100               END-IF                                             10410001
104200                                                                  10420001
104300               PERFORM 3300-EDIT-SELECTIONS                       10430001
104400                       VARYING PV-SUB                             10440001
104500                          FROM PV-SUB BY -1                       10450001
104600                          UNTIL PV-SUB < +1                       10460001
104700                                                                  10470001
104900               MOVE +1               TO ASC-BLK-SUB               10490001
105000                                                                  10500001
105100               PERFORM 5105-REWRITE-ASC-LISTQ                     10510001
105200                                                                  10520001
105300               MOVE +1                TO ASC-BLK-SUB              10530001
105400                                                                  10540001
105500               IF  PS-BLOCK-ERROR                                 10550001
105600                   SET  PS-ERROR     TO TRUE                      10560001
105700                   MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)      10570001
105800                                     TO PV-TOP-ITEM               10580001
105900               ELSE                                               10590001
106000                   ADD  +1           TO PV-BLOCK-NUMBER           10600001
106100                   IF  PV-BLOCK-NUMBER >                          10610001
106200                       ASC-HIGHEST-BLOCK-WRITTEN                  10620001
106300                       MOVE +2       TO ASC-BLK-SUB               10630001
106400                       PERFORM 4410-READ-TEMP-STORAGE             10640001
106500                       MOVE +1       TO ASC-BLK-SUB               10650001
106600                   ELSE                                           10660001
106700                       PERFORM 4410-READ-TEMP-STORAGE             10670001
106800                       ADD  +1        TO PV-BLOCK-NUMBER          10680001
106900                       MOVE +2        TO ASC-BLK-SUB              10690001
107000                       PERFORM 4410-READ-TEMP-STORAGE             10700001
107100                       SUBTRACT +1  FROM PV-BLOCK-NUMBER          10710001
107200                       MOVE +1        TO ASC-BLK-SUB              10720001
107300               END-IF                                             10730001
107400           END-IF                                                 10740001
107500     END-PERFORM.                                                 10750001
107600                                                                  10760001
107700     IF  PV-ORIGINAL-BLOCK  = +1    OR                            10770001
107800         PS-ERROR                   OR                            10780001
107900         PS-BLOCK-ERROR                                           10790001
108000             CONTINUE                                             10800001
108100     ELSE                                                         10810001
108200         MOVE +1                 TO PV-BLOCK-NUMBER               10820001
108300         MOVE +1                 TO ASC-BLK-SUB                   10830001
108400         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  10840001
108500         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEMS-DISPLAYED           10850001
108600         PERFORM 4410-READ-TEMP-STORAGE                           10860001
108700                                                                  10870001
108800         PERFORM                                                  10880001
108900            UNTIL PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK             10890001
109000               OR PS-ERROR                                        10900001
109100               OR PS-BLOCK-ERROR                                  10910001
109200                                                                  10920001
109300                  COMPUTE PV-ITEMS-HOLD  =                        10930001
109400                          ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +   10940001
109500                          PC-ITEMS-PER-PANEL - 1                  10950001
109600                                                                  10960001
109700                  IF  PV-ITEMS-HOLD > ASC-NUMBER-OF-ITEMS-READ    10970001
109800                      SUBTRACT  ASC-NUMBER-OF-ITEMS-READ          10980001
109900                          FROM  PV-ITEMS-HOLD                     10990001
110000                        GIVING  PV-ITEMS-DIFF                     11000001
110100                      SUBTRACT  PV-ITEMS-DIFF                     11010001
110200                          FROM  PC-ITEMS-PER-PANEL                11020001
110300                        GIVING  PV-ITEMS-HOLD                     11030001
110400                          MOVE  PV-ITEMS-HOLD TO PV-SUB           11040001
110500                                                 ASC-ITEM-SUB     11050001
110600                                              ASC-ITEMS-DISPLAYED 11060001
110700                  ELSE                                            11070001
110800                      MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB         11080001
110900                      MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB   11090001
111000                  END-IF                                          11100001
111100                                                                  11110001
111200                  PERFORM 3300-EDIT-SELECTIONS                    11120001
111300                          VARYING PV-SUB                          11130001
111400                             FROM PV-SUB BY -1                    11140001
111500                            UNTIL PV-SUB < +1                     11150001
111600                                                                  11160001
111700                                                                  11170001
111800                  MOVE +1               TO ASC-BLK-SUB            11180001
111900                                                                  11190001
112000                  PERFORM 5105-REWRITE-ASC-LISTQ                  11200001
112100                                                                  11210001
112200                  MOVE +1                TO ASC-BLK-SUB           11220001
112300                                                                  11230001
112400                  IF  PS-BLOCK-ERROR                              11240001
112500                      SET  PS-ERROR     TO TRUE                   11250001
112600                      MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)   11260001
112700                                        TO PV-TOP-ITEM            11270001
112800                  ELSE                                            11280001
112900                      ADD  +1            TO PV-BLOCK-NUMBER       11290001
113000                      IF  PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK     11300001
113100                          MOVE +2        TO ASC-BLK-SUB           11310001
113200                          PERFORM 4410-READ-TEMP-STORAGE          11320001
113300                          MOVE +1        TO ASC-BLK-SUB           11330001
113400                      ELSE                                        11340001
113500                          PERFORM 4410-READ-TEMP-STORAGE          11350001
113600                          ADD  +1        TO PV-BLOCK-NUMBER       11360001
113700                          MOVE +2        TO ASC-BLK-SUB           11370001
113800                          PERFORM 4410-READ-TEMP-STORAGE          11380001
113900                          SUBTRACT +1  FROM PV-BLOCK-NUMBER       11390001
114000                          MOVE +1        TO ASC-BLK-SUB           11400001
114100                      END-IF                                      11410001
114200                  END-IF                                          11420001
114300     END-PERFORM.                                                 11430001
114400                                                                  11440001
114410*----------------------------------------------------------------*11441009
114420* VALIDATE PRINTER ID                                             11442009
114430*----------------------------------------------------------------*11443009
114440 3010-VALIDATE-PRINTER-ID.                                        11444009
114460     IF  ASC-PRTR-ID  =  SPACES                                   11446009
114470         SET PS-ERROR                                             11447009
114480             DP020-MSG-FATAL           TO TRUE                    11448009
114490         MOVE PC-TSYMSG-01563          TO DP020-MSG-NUMBER        11449009
114491         MOVE DP015-UNP-ALP-BRT-OFF    TO APRTIDA                 11449109
114492         MOVE DP015-RED                TO APRTIDC                 11449209
114493         MOVE DP015-REVERSE            TO APRTIDH                 11449309
114494         MOVE -1                       TO APRTIDL                 11449409
114495         SET DP030-SET-CURSOR-APPL-1   TO TRUE                    11449509
114496     ELSE                                                         11449609
114497         PERFORM 3020-VALIDATE-PRINTER                            11449709
114498         IF DP072-PRTR-PRTR-TRK-STAT-CDE  EQUAL 'A'               11449809
114499            MOVE DP072-PRTR-IP-ADDRESS          TO ASC-IP-ADDRESS 11449909
114500            MOVE DP072-PRTR-CLUSTER-OS-RLSE-CDE TO                11450009
114501                                                  ASC-OS-RLSE-CDE 11450109
114502            MOVE DP072-PRTR-DATA-XFER-MODE-ID TO ASC-XFER-MODE-ID 11450209
114503         ELSE                                                     11450309
114504             SET PS-ERROR                                         11450409
114505                 DP020-MSG-FATAL           TO TRUE                11450509
114506             MOVE PC-TSYMSG-00746          TO DP020-MSG-NUMBER    11450609
114507             MOVE DP015-UNP-ALP-BRT-OFF    TO APRTIDA             11450709
114508             MOVE DP015-RED                TO APRTIDC             11450809
114509             MOVE DP015-REVERSE            TO APRTIDH             11450909
114510             MOVE -1                       TO APRTIDL             11451009
114511             SET DP030-SET-CURSOR-APPL-1   TO TRUE                11451109
114512         END-IF                                                   11451209
114513     END-IF.                                                      11451309
114514                                                                  11451409
114515*----------------------------------------------------------------*11451509
114516*   3020-VALIDATE-PRINTER                                         11451609
114517* CALLS DPKCS060 TO VALIDATE THE PRINTER ID                       11451709
114518*----------------------------------------------------------------*11451809
114519 3020-VALIDATE-PRINTER.                                           11451909
114520                                                                  11452009
114521     MOVE PC-01                      TO DP072-RPT-PGM-TYP-ID.     11452109
114522     MOVE DP020-LOCATION-NBR         TO DP072-ORIGIN-OPER-UNT-ID. 11452246
114523     MOVE DP020-LOCATION-NBR         TO DP072-OPER-UNT-ID.        11452346
114524     MOVE 1                          TO DP072-ORIGIN-FCLTY-ID     11452409
114525                                        DP072-FCLTY-ID.           11452509
114526     MOVE ASC-PRTR-ID                TO DP072-PRINTER-ID          11452609
114527     MOVE PC-REPORT-PGM-1            TO DP072-RPT-PGM-NME         11452709
114528     MOVE PC-01                      TO DP072-RPT-PGM-TYP-ID.     11452809
114529     SET DP072-VALIDATE              TO TRUE.                     11452909
114530                                                                  11453009
114531     EXEC CICS                                                    11453109
114532          LINK PROGRAM  (PC-PRTR-VALIDATION-PGM)                  11453209
114533               COMMAREA (DP072-COMM-AREA)                         11453309
114534               RESP     (PV-CICS-RESPONSE)                        11453409
114535     END-EXEC                                                     11453509
114536                                                                  11453609
114537     EVALUATE TRUE                                                11453709
114538         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 11453809
114539              CONTINUE                                            11453909
114540         WHEN OTHER                                               11454009
114541             SET PS-ERROR                                         11454109
114542                 DP020-MSG-FATAL            TO TRUE               11454209
114543             MOVE PC-TSYMSG-00746           TO DP020-MSG-NUMBER   11454309
114544             IF  DP072-RPT-PGM-NME = PC-REPORT-PGM-1              11454409
114545                 MOVE DP015-UNP-ALP-BRT-OFF TO APRTIDA            11454509
114546                 MOVE DP015-RED             TO APRTIDC            11454609
114547                 MOVE DP015-REVERSE         TO APRTIDH            11454709
114548                 MOVE -1                    TO APRTIDL            11454809
114549             ELSE                                                 11454909
114550                 MOVE DP015-UNP-ALP-BRT-OFF TO APRTIDA            11455009
114551                 MOVE DP015-RED             TO APRTIDC            11455109
114552                 MOVE DP015-REVERSE         TO APRTIDH            11455209
114553                 MOVE -1                    TO APRTIDL            11455309
114554             END-IF                                               11455409
114555             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  11455509
114556     END-EVALUATE.                                                11455609
114557                                                                  11455709
114560*----------------------------------------------------------------*11456001
114600*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *11460001
114700*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*11470001
114800*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *11480001
114900*                                                                *11490001
115000*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *11500001
115100*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *11510001
115200*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *11520001
115300*    US IN THE 2ND BLOCK OF THE ARRAY.                           *11530001
115400*----------------------------------------------------------------*11540001
115500 3100-SET-SUBSCRIPTS.                                             11550001
115600     COMPUTE ASC-ITEM-SUB =                                       11560001
115700         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        11570001
115800                                                                  11580001
115900     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         11590001
116000         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            11600001
116200         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               11620001
116300     ELSE                                                         11630001
116400         MOVE +1                     TO ASC-BLK-SUB               11640001
116500     END-IF.                                                      11650001
116600                                                                  11660001
116700******************************************************************11670001
116800** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **11680001
116900******************************************************************11690001
117000 3200-RESET-ATTRIBUTES.                                           11700001
117100     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA                    11710012
117110                                      APRTIDA.                    11711012
117200     MOVE DP015-GREEN              TO ASTRTITC                    11720012
117210                                      APRTIDC.                    11721012
117300     MOVE DP015-UNDERLINE          TO ASTRTITH                    11730012
117310                                      APRTIDH.                    11731012
117400                                                                  11740012
117500     PERFORM                                                      11750009
117600         VARYING PV-SUB                                           11760009
117700         FROM 1 BY 1                                              11770009
117800         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        11780009
117900         MOVE DP015-UNP-ALP-NOR-OFF                               11790009
118000                                   TO MR-SELECTA (PV-SUB)         11800009
118100         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         11810009
118200         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         11820009
118210         MOVE DP015-PRO-NOR-OFF    TO MR-TRAILER-IDA (PV-SUB)     11821009
118221                                      MR-SERIAL-NBRA (PV-SUB)     11822109
118222                                      MR-TRLR-LNGTHA (PV-SUB)     11822244
118230         MOVE DP015-BLUE           TO MR-TRAILER-IDC (PV-SUB)     11823009
118231                                      MR-SERIAL-NBRC (PV-SUB)     11823109
118232                                      MR-TRLR-LNGTHC (PV-SUB)     11823244
118300     END-PERFORM.                                                 11830009
118400                                                                  11840001
118500******************************************************************11850001
118600** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **11860001
118700** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **11870001
118800** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **11880001
118900** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **11890001
119000******************************************************************11900001
119100 3300-EDIT-SELECTIONS.                                            11910001
119200     EVALUATE TRUE                                                11920001
119300         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     11930001
119400             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         11940001
119500                 CONTINUE                                         11950001
119600         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         11960001
119700             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        11970001
119800                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   11980001
119900                 MOVE ASC-TEMP-SELECTED-SW                        11990001
120000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12000001
120100                                TO ASC-SELECTED-SW                12010001
120200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12020001
120300             END-IF                                               12030001
120400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12040001
120500                 = SPACE                                          12050001
120600             EVALUATE TRUE                                        12060001
120700                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       12070001
120800                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS12080001
120900                     MOVE SPACE TO ASC-SELECTED-SW                12090001
121000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12100001
121100                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        12110001
121200                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    12120001
121300                     MOVE SPACE TO ASC-SELECTED-SW                12130001
121400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12140001
121500                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          12150001
121600                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      12160001
121700                     MOVE SPACE TO ASC-SELECTED-SW                12170001
121800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12180001
121900             END-EVALUATE                                         12190001
122000         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           12200001
122100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12210001
122200                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12220001
122300             END-IF                                               12230001
122400             PERFORM 3310-EDIT-RANGE                              12240001
122500         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             12250001
122600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12260001
122700                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12270001
122800             END-IF                                               12280001
122900             PERFORM 3310-EDIT-RANGE                              12290001
123000         WHEN OTHER                                               12300001
123100             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           12310001
123200             SET DP020-MSG-FATAL    TO TRUE                       12320001
123400             MOVE -1                TO ASTRTITL                   12340001
123500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  12350009
123700*            MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        12370001
123800*            MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        12380001
123900             SET PS-ERROR TO TRUE                                 12390001
124000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12400001
124100                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     12410001
124200                 MOVE SPACE         TO ASC-SELECTED-SW            12420001
124300                                        (ASC-BLK-SUB ASC-ITEM-SUB)12430001
124400             END-IF                                               12440001
124500     END-EVALUATE.                                                12450001
124600                                                                  12460001
124700     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 12470001
124800     SUBTRACT +1 FROM ASC-ITEM-SUB.                               12480001
124900     IF  ASC-ITEM-SUB < 1                                         12490001
125000         SUBTRACT +1 FROM ASC-BLK-SUB                             12500001
125100         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                12510001
125200     END-IF.                                                      12520001
125300                                                                  12530001
125400******************************************************************12540001
125500** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **12550001
125600** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **12560001
125700** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**12570001
125800** THE ENDING.                                                  **12580001
125900******************************************************************12590001
126000 3310-EDIT-RANGE.                                                 12600001
126100     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                12610001
126200         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   12620001
126300             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)12630001
126400                                   TO ASC-SELECTED-SW             12640001
126500                                        (ASC-BLK-SUB ASC-ITEM-SUB)12650001
126600             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 12660001
126700         ELSE                                                     12670001
126800             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     12680001
126900                 CONTINUE                                         12690001
127000             ELSE                                                 12700001
127100*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        12710001
127200                 MOVE PC-TSYMSG-00054                             12720001
127300                                   TO DP020-MSG-NUMBER            12730001
127400                 SET DP020-MSG-FATAL                              12740001
127500                                   TO TRUE                        12750001
127600*                MOVE -1           TO MR-SELECTL (PV-SUB)         12760001
127700                 MOVE -1           TO ASTRTITL                    12770001
127800                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              12780002
128000                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         12800002
128100                 MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)      12810002
128300                 SET PS-ERROR      TO TRUE                        12830001
128400             END-IF                                               12840001
128500         END-IF                                                   12850001
128600     ELSE                                                         12860001
128700         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     12870001
128800             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 12880001
128900                                   TO ASC-SELECTED-SW             12890001
129000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12900001
129100             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   12910001
129200         ELSE                                                     12920001
129300             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       12930001
129400                 CONTINUE                                         12940001
129500             ELSE                                                 12950001
129600*                -- ONLY ONE END-OF-RANGE ALLOWED --              12960001
129700                 MOVE PC-TSYMSG-00055                             12970001
129800                                   TO DP020-MSG-NUMBER            12980001
129900                 SET DP020-MSG-FATAL                              12990001
130000                                   TO TRUE                        13000001
130100*                MOVE -1           TO MR-SELECTL (PV-SUB)         13010001
130200                 MOVE -1           TO ASTRTITL                    13020001
130300                 SET DP030-SET-CURSOR-APPL-1                      13030001
130400                                   TO TRUE                        13040001
130500                 SET PS-ERROR      TO TRUE                        13050001
130600             END-IF                                               13060001
130700         END-IF                                                   13070001
130800     END-IF.                                                      13080001
130900*                                                                 13090001
131000******************************************************************13100001
131100** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **13110001
131200** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **13120001
131300******************************************************************13130001
131400 3400-CHECK-RANGE-SEQUENCE.                                       13140001
131500     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       13150001
131600       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      13160001
131700       AND  ASC-START-OF-SELECTED-RANGE >                         13170001
131800                                         ASC-END-OF-SELECTED-RANGE13180001
131900*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                13190001
132000         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 13200001
132100         SET DP020-MSG-FATAL TO TRUE                              13210001
132200         SET PS-ERROR TO TRUE                                     13220001
132300         PERFORM 3410-POSITION-AT-ERROR                           13230001
132400     END-IF.                                                      13240001
132500                                                                  13250001
132600******************************************************************13260001
132700** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **13270001
132800** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **13280001
132900** SHOULD BE POSITIONED ON A RANGE ERROR.                       **13290001
133000******************************************************************13300001
133100 3410-POSITION-AT-ERROR.                                          13310001
133200     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       13320012
133400     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 13340001
133500                    - PV-TOP-ITEM + 1.                            13350001
133600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      13360014
133700         CONTINUE                                                 13370014
133800     ELSE                                                         13380012
133900         MOVE -1                   TO MR-SELECTL (PV-SUB)         13390012
134000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         13400012
134100         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         13410012
134200     END-IF.                                                      13420012
134300                                                                  13430012
134400     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   13440001
134500                    - PV-TOP-ITEM + 1.                            13450001
134600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      13460014
134700         CONTINUE                                                 13470014
134800     ELSE                                                         13480014
134900         MOVE -1                   TO MR-SELECTL (PV-SUB)         13490014
135000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         13500014
135100         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         13510014
135200     END-IF.                                                      13520014
135300                                                                  13530001
135400*----------------------------------------------------------------*13540001
135500*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *13550001
135600*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *13560001
135700*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *13570001
135800*----------------------------------------------------------------*13580001
135900 3500-MARK-RANGE-AS-SELECTED.                                     13590001
136000     MOVE +1                       TO  ASC-BLK-SUB.               13600001
136100     PERFORM 3510-MARK-SELECTED-INDS                              13610001
136200         VARYING ASC-ITEM-SUB                                     13620001
136300         FROM 1 BY 1                                              13630001
136400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13640001
136500                                                                  13650001
136600     ADD +1                        TO ASC-BLK-SUB.                13660001
136700     PERFORM 3510-MARK-SELECTED-INDS                              13670001
136800         VARYING ASC-ITEM-SUB                                     13680001
136900         FROM 1 BY 1                                              13690001
137000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13700001
137100                                                                  13710001
137200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               13720001
137300                                   TO  PV-LIST-ITEM-NUMBER.       13730001
137400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13740001
137500         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         13750001
137600               PC-ITEMS-PER-PANEL).                               13760001
137700                                                                  13770001
137800     MOVE ASC-START-OF-SELECTED-RANGE                             13780001
137900                                   TO PV-START-OF-SELECTED-RANGE. 13790001
138000     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            13800001
138100         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  13810001
138200               PC-ITEMS-PER-PANEL).                               13820001
138300                                                                  13830001
138400     MOVE ASC-END-OF-SELECTED-RANGE                               13840001
138500                                   TO  PV-END-OF-SELECTED-RANGE.  13850001
138600     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             13860001
138700         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    13870001
138800               PC-ITEMS-PER-PANEL).                               13880001
138900     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             13890001
139000         PV-FIRST-BLOCK-IN-ARRAY + 1.                             13900001
139100                                                                  13910001
139200     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    13920001
139300        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        13930001
139400         MOVE +1                   TO ASC-BLK-SUB                 13940001
139500         PERFORM 5100-WRITE-TEMP-STORAGE                          13950001
139600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13960001
139700             PV-FIRST-BLOCK-IN-ARRAY - 1                          13970001
139800                                                                  13980001
139900         PERFORM                                                  13990001
140000             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      14000001
140100                   PV-PREV-BLOCK-IN-ARRAY                         14010001
140200             MOVE PV-FIRST-BLOCK-IN-RANGE                         14020001
140300                                   TO PV-BLOCK-NUMBER             14030001
140400             PERFORM 4410-READ-TEMP-STORAGE                       14040001
140500             PERFORM 3510-MARK-SELECTED-INDS                      14050001
140600                 VARYING ASC-ITEM-SUB                             14060001
140700                 FROM 1 BY 1                                      14070001
140800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14080001
140900             PERFORM 5100-WRITE-TEMP-STORAGE                      14090001
141000             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     14100001
141100         END-PERFORM                                              14110001
141200                                                                  14120001
141300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         14130001
141400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     14140001
141500         PERFORM                                                  14150001
141600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       14160001
141700                   PV-LAST-BLOCK-IN-RANGE                         14170001
141800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          14180001
141900                                   TO PV-BLOCK-NUMBER             14190001
142000             PERFORM 4410-READ-TEMP-STORAGE                       14200001
142100             PERFORM 3510-MARK-SELECTED-INDS                      14210001
142200                 VARYING ASC-ITEM-SUB                             14220001
142300                 FROM 1 BY 1                                      14230001
142400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14240001
142500             PERFORM 5100-WRITE-TEMP-STORAGE                      14250001
142600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      14260001
142700         END-PERFORM                                              14270001
142800                                                                  14280001
142900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             14290001
143000                                   TO PV-BLOCK-NUMBER             14300001
143100         PERFORM 4410-READ-TEMP-STORAGE                           14310001
143200     END-IF.                                                      14320001
143300                                                                  14330001
143400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 14340001
143500                                      ASC-END-OF-SELECTED-RANGE.  14350001
143600                                                                  14360001
143700*----------------------------------------------------------------*14370001
143800* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *14380001
143900*----------------------------------------------------------------*14390001
144000 3510-MARK-SELECTED-INDS.                                         14400001
144100     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         14410001
144200                                ASC-ITEM-SUB) >                   14420001
144300         ASC-START-OF-SELECTED-RANGE)                             14430001
144400     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         14440001
144500                                ASC-ITEM-SUB) =                   14450001
144600         ASC-START-OF-SELECTED-RANGE)                             14460001
144700                                                                  14470001
144800         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     14480001
144900                                    ASC-ITEM-SUB) <               14490001
145000             ASC-END-OF-SELECTED-RANGE)                           14500001
145100         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     14510001
145200                                    ASC-ITEM-SUB) =               14520001
145300             ASC-END-OF-SELECTED-RANGE)                           14530001
145400                                                                  14540001
145500             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          14550001
145600                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   14560001
145700                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   14570001
145800                               TO TRUE                            14580001
145900                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              14590001
146000                               TO TRUE                            14600001
146100                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    14610001
146200             END-IF                                               14620001
146300         END-IF                                                   14630001
146400     END-IF.                                                      14640001
146500                                                                  14650001
146600*----------------------------------------------------------------*14660001
146700*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *14670001
146800*    INITIALIZE ALL COUNTERS AND FLAGS.                          *14680001
146900*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *14690001
147000*    DISPLAY THE PANEL TO USER.                                  *14700001
147100*----------------------------------------------------------------*14710001
147200 4000-BUILD-INITIAL-PANEL.                                        14720001
147300     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            14730043
147400                                 ASC-BLOCK-ENTRIES (2).           14740043
147500     MOVE +1                   TO ASC-BLK-SUB.                    14750009
147600     SET ASC-ITEMS-LEFT-ON-DB  TO TRUE.                           14760009
147800                                                                  14780001
147900     MOVE +0                 TO ASC-ITEM-SUB                      14790001
148000                                ASC-NUMBER-OF-ITEMS-READ          14800001
148100                                ASC-NUMBER-OF-SELECTED-ITEMS      14810001
148200                                ASC-HIGHEST-BLOCK-WRITTEN         14820001
148300                                ASC-START-OF-SELECTED-RANGE       14830001
148400                                ASC-END-OF-SELECTED-RANGE         14840001
148500                                ASC-ITEM-AT-TOP-OF-PANEL.         14850001
148600                                                                  14860043
148610     PERFORM 4100-PREPARE-CURSOR                                  14861013
148700     PERFORM 4010-OPEN-CURSOR.                                    14870001
148900     PERFORM 4300-READ-ITEMS-FROM-DB.                             14890001
149100     PERFORM 4020-CLOSE-CURSOR.                                   14910001
149200                                                                  14920001
149300     MOVE +1                   TO  PV-TOP-ITEM.                   14930001
149400     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          14940001
149500         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    14950001
149600         SET DP020-MSG-FATAL   TO  TRUE                           14960001
149700         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               14970001
149800     ELSE                                                         14980001
150000         MOVE -1               TO MR-SELECTL (1)                  15000025
150100         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      15010001
150300         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     15030001
150400     END-IF.                                                      15040001
150500                                                                  15050001
150600*----------------------------------------------------------------*15060001
150700* OPEN THE CURSOR.                                               *15070001
150710*   IN THIS PARTICULAR APPLICATION ONE OF 2 DIFFERENT CURSORS    *15071013
150720*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *15072013
150730*   ASSOCIATE.                                                   *15073013
150800*----------------------------------------------------------------*15080001
150900 4010-OPEN-CURSOR.                                                15090001
151000     PERFORM                                                      15100001
151100         WITH TEST AFTER                                          15110001
151200         VARYING PV-RETRY-COUNTER                                 15120001
151300         FROM 1 BY 1                                              15130001
151400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15140001
151500                   OR (SQLCODE = ZERO))                           15150001
151600                                                                  15160001
151610         EVALUATE TRUE                                            15161013
151620             WHEN ASC-SCAC-CSR                                    15162013
151630                  MOVE 'CURSOR:  SCAC-CSR'                        15163013
151640                                 TO DP013-MESSAGE-TEXT (2)        15164013
151641                  EXEC SQL                                        15164113
151642                      OPEN SCAC-CSR                               15164213
151643                  END-EXEC                                        15164313
151644                                                                  15164413
151690             WHEN ASC-SCAC-ID-CSR                                 15169013
151691                 MOVE 'CURSOR:  SCAC-ID-CSR'                      15169113
151692                                   TO DP013-MESSAGE-TEXT (2)      15169213
151693                   EXEC SQL                                       15169313
151694                      OPEN SCAC-ID-CSR                            15169413
151695                   END-EXEC                                       15169513
151696                                                                  15169613
151711         END-EVALUATE                                             15171113
151712                                                                  15171213
152100         EVALUATE TRUE                                            15210001
152200             WHEN SQLCODE = ZERO                                  15220001
152300             WHEN SQLCODE = -904                                  15230001
152400             WHEN SQLCODE = -913                                  15240001
152500                 CONTINUE                                         15250001
152600             WHEN SQLWARN0 NOT = SPACES                           15260001
152700             WHEN SQLCODE < ZERO                                  15270001
152800             WHEN SQLCODE > ZERO                                  15280001
152900                 MOVE '4010-OPEN-CURSOR' TO DP013-PARAGRAPH       15290001
153000                 MOVE 'UNABLE TO OPEN A CURSOR -'                 15300013
153100                                   TO DP013-MESSAGE-TEXT (1)      15310001
153200                 MOVE SQLCA        TO DP013-SQLCA                 15320001
153300                 MOVE 'TCNTRID '   TO DP013-DB2-TABLE-NAME (1)    15330001
153400                 SET DP013-DB2-ABEND                              15340001
153500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15350001
153600                 PERFORM DP013-0000-PROCESS-ABEND                 15360001
153700         END-EVALUATE                                             15370001
153800     END-PERFORM.                                                 15380001
153900*                                                                 15390001
154000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15400001
154100         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             15410001
154200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   15420001
154300                                   TO DP013-MESSAGE-TEXT (1)      15430001
154400         MOVE SQLCA                TO DP013-SQLCA                 15440001
154500         MOVE 'TCNTRID '           TO DP013-DB2-TABLE-NAME (1)    15450001
154600         SET DP013-DB2-ABEND                                      15460001
154700             DP013-XCTL-DISPLAY-RESTART TO TRUE                   15470001
154800         PERFORM DP013-0000-PROCESS-ABEND                         15480001
154900     END-IF.                                                      15490001
155000                                                                  15500001
155100*----------------------------------------------------------------*15510001
155200* CLOSE THE CURSOR                                               *15520001
155300*----------------------------------------------------------------*15530001
155400 4020-CLOSE-CURSOR.                                               15540001
155410     EVALUATE TRUE                                                15541013
155420         WHEN ASC-SCAC-CSR                                        15542013
155500              EXEC SQL                                            15550013
155600                   CLOSE SCAC-CSR                                 15560013
155700              END-EXEC                                            15570013
155800*                                                                 15580001
155810         WHEN ASC-SCAC-ID-CSR                                     15581013
155830              EXEC SQL                                            15583013
155840                   CLOSE SCAC-ID-CSR                              15584013
155850              END-EXEC                                            15585013
155851     END-EVALUATE.                                                15585113
155860                                                                  15586013
155910     EVALUATE TRUE                                                15591013
156000         WHEN SQLCODE = ZERO                                      15600001
156100             CONTINUE                                             15610001
156200         WHEN SQLWARN0 NOT = SPACES                               15620001
156300         WHEN SQLCODE < ZERO                                      15630001
156400         WHEN SQLCODE > ZERO                                      15640001
156500             MOVE '4020-CLOSE-CURSOR' TO DP013-PARAGRAPH          15650001
156600             MOVE 'UNABLE TO CLOSE CURSOR '                       15660013
156700                               TO DP013-MESSAGE-TEXT (1)          15670001
156800             MOVE SQLCA        TO DP013-SQLCA                     15680001
156900             MOVE 'TCNTRID '   TO DP013-DB2-TABLE-NAME (1)        15690001
157000             SET DP013-DB2-ABEND                                  15700001
157100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15710001
157200             PERFORM DP013-0000-PROCESS-ABEND                     15720001
157300     END-EVALUATE.                                                15730001
157400                                                                  15740001
157500*----------------------------------------------------------------*15750013
157510*    SET UP THE HOST VARIABLES.                                  *15751013
157520*----------------------------------------------------------------*15752013
157530 4100-PREPARE-CURSOR.                                             15753013
157540                                                                  15754013
157550     MOVE ASC-SCAC        TO  DK-SCAC-CDE.                        15755013
157560     MOVE ASC-TRLR-ID     TO  DK-TRAILER-ID.                      15756013
157570                                                                  15757013
157580     IF  DK-TRAILER-ID   = SPACES                                 15758013
157591         SET ASC-SCAC-CSR TO TRUE                                 15759113
157592     ELSE                                                         15759213
157595          SET ASC-SCAC-ID-CSR TO TRUE                             15759513
157607     END-IF.                                                      15760713
157608                                                                  15760813
157610*----------------------------------------------------------------*15761001
157700*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *15770001
157800*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *15780001
157900*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *15790001
158000*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *15800001
158100*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *15810001
158200*                                                                *15820001
158300*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *15830001
158400*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *15840001
158500*    UPON INITIALIZATION.                                        *15850001
158600*----------------------------------------------------------------*15860001
158700 4300-READ-ITEMS-FROM-DB.                                         15870001
158800     PERFORM                                                      15880001
158900         VARYING PV-READ-COUNT                                    15890001
159000         FROM 1 BY 1                                              15900001
159100         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    15910001
159200            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         15920001
159300                                                                  15930001
159400         PERFORM 4310-FETCH                                       15940001
159500                                                                  15950001
159600         IF  ASC-ITEMS-LEFT-ON-DB                                 15960001
159700             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                15970001
159800                 ADD +1            TO ASC-ITEM-SUB                15980001
159900             ELSE                                                 15990001
160000                 ADD +1            TO ASC-BLK-SUB                 16000001
160100                 MOVE +1           TO ASC-ITEM-SUB                16010001
160200                                                                  16020001
160300                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         16030001
160400                     MOVE +1       TO ASC-BLK-SUB                 16040001
160500                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           16050001
160600                     PERFORM 5100-WRITE-TEMP-STORAGE              16060001
160700                     MOVE ASC-BLOCK-ENTRIES                       16070001
160800                               (PC-MAX-BLOCKS-IN-ARRAY)           16080001
160900                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 16090001
161000                     ADD +1        TO ASC-BLK-SUB                 16100001
161100                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   16110001
161200                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      16120001
161300                                   TO TRUE                        16130001
161400                 END-IF                                           16140001
161500             END-IF                                               16150001
161600             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    16160001
161700             MOVE ASC-NUMBER-OF-ITEMS-READ                        16170001
161800                                   TO ASC-LIST-ITEM-NUMBER        16180001
161900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16190001
162000             MOVE SPACES           TO  ASC-ACTION                 16200001
162100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16210001
162200             MOVE CNTRID-TRLR-ID   TO  ASC-TRAILER-ID             16220001
162400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16240001
162500             MOVE CNTRID-TRLR-SRL-NBR TO  ASC-SERIAL-NBR          16250001
162700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16270001
162710             MOVE CNTRID-TRLR-SIZE-MU TO  ASC-TRLR-LENGTH         16271044
162720                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16272044
162800         END-IF                                                   16280001
162900     END-PERFORM.                                                 16290001
163000                                                                  16300001
163100     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          16310001
163200         MOVE +1               TO ASC-BLK-SUB                     16320001
163300         PERFORM 5100-WRITE-TEMP-STORAGE                          16330001
163400         ADD +1                TO ASC-BLK-SUB                     16340001
163500         PERFORM 5100-WRITE-TEMP-STORAGE                          16350001
163600                                                                  16360001
163700         MOVE 1                TO ASC-BLK-SUB                     16370001
163800                                  PV-BLOCK-NUMBER                 16380001
163900         PERFORM 4410-READ-TEMP-STORAGE                           16390001
164000         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             16400001
164100             MOVE 2            TO ASC-BLK-SUB                     16410001
164200                                  PV-BLOCK-NUMBER                 16420001
164300             PERFORM 4410-READ-TEMP-STORAGE                       16430001
164400         END-IF                                                   16440001
164500     END-IF.                                                      16450001
164600                                                                  16460001
164700*----------------------------------------------------------------*16470001
164800*    FETCH THE CURSOR                                             16480013
164900*----------------------------------------------------------------*16490001
165100 4310-FETCH.                                                      16510001
165110       EVALUATE TRUE                                              16511013
165120           WHEN ASC-SCAC-CSR                                      16512013
165200               EXEC SQL                                           16520013
165300                    FETCH SCAC-CSR                                16530013
165400                    INTO  :CNTRID-TRLR-ID                         16540013
165500                        , :CNTRID-TRLR-SRL-NBR                    16550013
165510                        , :CNTRID-TRLR-SIZE-MU                    16551044
165600               END-EXEC                                           16560013
165700                                                                  16570001
165710           WHEN ASC-SCAC-ID-CSR                                   16571013
165720               EXEC SQL                                           16572013
165730                    FETCH SCAC-ID-CSR                             16573013
165740                    INTO  :CNTRID-TRLR-ID                         16574013
165750                        , :CNTRID-TRLR-SRL-NBR                    16575013
165751                        , :CNTRID-TRLR-SIZE-MU                    16575144
165760               END-EXEC                                           16576013
165770                                                                  16577013
165800     EVALUATE TRUE                                                16580001
165900         WHEN SQLCODE = ZERO                                      16590001
166000         WHEN SQLCODE = +100                                      16600001
166100              CONTINUE                                            16610001
166200         WHEN SQLWARN0 NOT = SPACE                                16620001
166300         WHEN SQLCODE NOT = ZERO                                  16630001
166400              MOVE '4310-FETCH-CURSOR' TO DP013-PARAGRAPH         16640001
166500              MOVE 'COULD NOT FETCH CURSOR'                       16650013
166600                               TO DP013-MESSAGE-TEXT (1)          16660001
166700              MOVE SQLCA       TO DP013-SQLCA                     16670001
166800              SET DP013-DB2-ABEND TO TRUE                         16680001
166900              PERFORM DP013-0000-PROCESS-ABEND                    16690001
167000     END-EVALUATE.                                                16700001
167100                                                                  16710001
167200     IF  SQLCODE EQUAL +100                                       16720013
167300         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                      16730001
167400     END-IF.                                                      16740001
167500                                                                  16750001
167600*----------------------------------------------------------------*16760001
167700* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *16770001
167800*----------------------------------------------------------------*16780001
167900 4400-MOVE-COMMAREA-TO-SCREEN.                                    16790001
168000     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             16800001
168100         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          16810001
168200         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          16820001
168300             MOVE +1    TO ASC-BLK-SUB                            16830001
168400             PERFORM 5100-WRITE-TEMP-STORAGE                      16840001
168500             ADD +1     TO ASC-BLK-SUB                            16850001
168600             PERFORM 5100-WRITE-TEMP-STORAGE                      16860001
168700             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             16870001
168800                 GIVING PV-BLOCK-NUMBER                           16880001
168900                 REMAINDER PV-REMAINDER                           16890001
169000             IF  PV-REMAINDER > ZERO                              16900001
169100                 ADD +1 TO PV-BLOCK-NUMBER                        16910001
169200             END-IF                                               16920001
169300             MOVE +1    TO ASC-BLK-SUB                            16930001
169400             PERFORM 4410-READ-TEMP-STORAGE                       16940001
169500             ADD +1     TO ASC-BLK-SUB                            16950001
169600                           PV-BLOCK-NUMBER                        16960001
169700             PERFORM 4410-READ-TEMP-STORAGE                       16970001
169800     END-IF.                                                      16980001
169900     MOVE +1            TO ASC-BLK-SUB.                           16990001
170000     COMPUTE ASC-ITEM-SUB =                                       17000001
170100         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              17010001
170200         + PC-ITEMS-PER-PANEL).                                   17020001
170300*                                                                 17030001
170400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        17040001
170500         ADD +1         TO ASC-BLK-SUB                            17050001
170600         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            17060001
170700     END-IF.                                                      17070001
170800*                                                                 17080001
170900     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           17090001
171000         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                17100001
171100     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        17110001
171200     PERFORM 4420-FORMAT-LIST-LINES                               17120001
171300         VARYING PV-SUB                                           17130001
171400         FROM PC-ITEMS-PER-PANEL BY -1                            17140001
171500         UNTIL PV-SUB < +1.                                       17150001
171600*                                                                 17160001
171700     COMPUTE ASC-ITEMS-DISPLAYED =                                17170001
171800         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          17180001
171900     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    17190001
172000                                      ASTRTITO.                   17200001
172100     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    17210001
172200     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    17220001
172300     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            17230001
172400                                   TO ASELITO.                    17240001
172410     MOVE ASC-SCAC                 TO ASCACCDO.                   17241013
172420     MOVE ASC-SCAC-NAME            TO ASCACDSO.                   17242013
172430     MOVE ASC-PRTR-ID              TO APRTIDO.                    17243013
172500                                                                  17250001
172600     IF  DP020-MSG-NUMBER-X = SPACE                               17260001
172700         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  17270001
172800*            --- MORE ITEMS TO DISPLAY ----                       17280001
172900             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            17290001
173000             SET DP020-MSG-INFORMATIONAL TO TRUE                  17300001
173100         END-IF                                                   17310001
173200     END-IF.                                                      17320001
173300                                                                  17330001
173400*----------------------------------------------------------------*17340001
173500*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *17350001
173600*----------------------------------------------------------------*17360001
173700 4410-READ-TEMP-STORAGE.                                          17370001
173800     EXEC CICS                                                    17380001
173900         READQ TS                                                 17390001
174000             QUEUE (ASC-LIST-QUEUE-NAME)                          17400001
174100             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               17410001
174200             ITEM  (PV-BLOCK-NUMBER)                              17420001
174300             RESP  (PV-CICS-RESP)                                 17430001
174400     END-EXEC.                                                    17440001
174500                                                                  17450001
174600     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       17460001
174700       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     17470001
174800         CONTINUE                                                 17480001
174900     ELSE                                                         17490001
175000         SET DP013-CICS-ABEND     TO TRUE                         17500001
175100         SET DP013-NO-ROLLBACK    TO TRUE                         17510001
175200         MOVE '4410-READ-TEMP-STORAGE' TO DP013-PARAGRAPH         17520001
175300         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      17530001
175400                                  TO DP013-MESSAGE-TEXT(1)        17540001
175500         PERFORM DP013-0000-PROCESS-ABEND                         17550001
175600     END-IF.                                                      17560001
175700                                                                  17570001
175800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             17580001
175900*                                                                 17590001
176000     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         17600001
176100         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               17610001
176200     END-IF.                                                      17620001
176300                                                                  17630001
176400*----------------------------------------------------------------*17640001
176500*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *17650001
176600*----------------------------------------------------------------*17660001
176700 4420-FORMAT-LIST-LINES.                                          17670001
176800     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      17680001
176900         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                17690001
177000         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           17700016
177100         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           17710016
177200         MOVE SPACE              TO MR-SELECTI (PV-SUB)           17720016
177300                                    MR-ACTION (PV-SUB)            17730016
177400         MOVE SPACE TO              MR-TRAILER-ID  (PV-SUB)       17740002
177500                                    MR-SERIAL-NBR  (PV-SUB)       17750002
177510         MOVE ZEROES             TO MR-TRLR-LNGTH  (PV-SUB)       17751044
177600     ELSE                                                         17760001
177700         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      17770026
177800                                                   > SPACE        17780026
177900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 17790026
178000                                 TO MR-SELECTI (PV-SUB)           17800026
178100         ELSE                                                     17810026
178200             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      17820026
178300                                 TO MR-SELECTI (PV-SUB)           17830026
178400         END-IF                                                   17840043
178500                                                                  17850043
178600         IF  DP030-SET-CURSOR-TRAILER                             17860026
178700             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)17870026
178800                 > SPACE)                                         17880026
178900               OR (PV-SUB = 1))                                   17890026
179000                SET DP030-SET-CURSOR-APPL-1 TO TRUE               17900026
179100                MOVE -1          TO MR-SELECTL (PV-SUB)           17910026
179300             END-IF                                               17930026
179400         END-IF                                                   17940026
179500                                                                  17950001
179600         MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)               17960001
179700                                 TO MR-ACTION (PV-SUB)            17970001
179800         MOVE ASC-TRAILER-ID  (ASC-BLK-SUB ASC-ITEM-SUB)          17980001
179900                                 TO MR-TRAILER-ID  (PV-SUB)       17990001
180000         MOVE ASC-SERIAL-NBR (ASC-BLK-SUB ASC-ITEM-SUB)           18000001
180100                                 TO MR-SERIAL-NBR (PV-SUB)        18010001
180110         MOVE ASC-TRLR-LENGTH(ASC-BLK-SUB ASC-ITEM-SUB)           18011044
180120                                 TO MR-TRLR-LNGTH (PV-SUB)        18012044
180200     END-IF.                                                      18020001
180300     SUBTRACT +1 FROM ASC-ITEM-SUB                                18030001
180400     IF  ASC-ITEM-SUB < + 1                                       18040001
180500         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  18050001
180600         MOVE +1                 TO ASC-BLK-SUB                   18060001
180700     END-IF.                                                      18070001
180800                                                                  18080001
180900******************************************************************18090001
181000** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **18100001
181100** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **18110001
181200** ISSUE A WARNING.                                             **18120001
181300******************************************************************18130001
181400 4430-CHECK-FOR-BEGIN-AND-END.                                    18140001
181500     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       18150001
181600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     18160001
181700*            -- NO END-OF-RANGE SPECFIED ---                      18170001
181800             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            18180001
181900             SET DP020-MSG-WARNING TO TRUE                        18190001
182000             PERFORM 4431-POSITION-AT-WARNING                     18200001
182100         END-IF                                                   18210001
182200     ELSE                                                         18220001
182300         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     18230001
182400*            -- NO BEGINNING-OF-RANGE SPECFIED ---                18240001
182500             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            18250001
182600             SET DP020-MSG-WARNING TO TRUE                        18260001
182700             PERFORM 4431-POSITION-AT-WARNING                     18270001
182800         END-IF                                                   18280001
182900     END-IF.                                                      18290001
183000                                                                  18300001
183100******************************************************************18310001
183200** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **18320001
183300** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **18330001
183400** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **18340001
183500** POSITION THE CURSOR THERE.                                   **18350001
183600******************************************************************18360001
183700 4431-POSITION-AT-WARNING.                                        18370001
183800     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 18380001
183900                    - PV-TOP-ITEM + 1.                            18390001
184000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18400013
184100         CONTINUE                                                 18410013
184200     ELSE                                                         18420013
184300         SET DP030-SET-CURSOR-APPL-1                              18430013
184400                                   TO TRUE                        18440013
184500         MOVE -1                   TO MR-SELECTL (PV-SUB)         18450013
184600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18460013
184700         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         18470013
184800     END-IF.                                                      18480013
184900                                                                  18490013
185000     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   18500001
185100                    - PV-TOP-ITEM + 1.                            18510001
185200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18520013
185300         CONTINUE                                                 18530013
185400     ELSE                                                         18540013
185500         SET DP030-SET-CURSOR-APPL-1                              18550013
185600                                   TO TRUE                        18560013
185700         MOVE -1                   TO MR-SELECTL (PV-SUB)         18570013
185800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18580013
185900         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         18590013
186000     END-IF.                                                      18600013
186100                                                                  18610001
186101*----------------------------------------------------------------*18610143
186102*  PRINT PULL FUNCTION                                           *18610243
186103*----------------------------------------------------------------*18610343
186104 4600-PROCESS-PRINT-FUNCTION.                                     18610443
186105                                                                  18610543
186106     MOVE +1                       TO ASC-BLK-SUB.                18610643
186107     PERFORM 5100-WRITE-TEMP-STORAGE.                             18610743
186108     ADD +1                        TO ASC-BLK-SUB.                18610843
186109     PERFORM 5100-WRITE-TEMP-STORAGE.                             18610943
186110                                                                  18611043
186111     PERFORM 6112-READ-LIST-QUEUE.                                18611143
186112                                                                  18611243
186113     SET  LQW-IDX  TO   1.                                        18611343
186114                                                                  18611443
186115     IF PS-NO-SOFT-ABORT-ERROR                                    18611543
186116       IF PV-CICS-RESP = DFHRESP (NORMAL)                         18611643
186117         PERFORM                                                  18611743
186118         VARYING LQW-IDX  FROM 1 BY 1                             18611843
186119         UNTIL   LQW-IDX > PC-ITEMS-PER-PANEL                     18611943
186120            OR   LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO            18612043
186121            OR   PS-SOFT-ABORT-ERROR                              18612143
186122            OR   PS-ERROR                                         18612243
186123             IF  LQW-SELECT (LQW-IDX)                             18612343
186124                 PERFORM 4605-PROCESS-SELECTED-LINES              18612443
186125             END-IF                                               18612543
186126         END-PERFORM                                              18612643
186127       END-IF                                                     18612743
186128     END-IF.                                                      18612843
186129                                                                  18612943
186130     MOVE PV-ITEM      TO PV-SAVE-ITEM.                           18613043
186131     PERFORM 6111-WRITE-LIST-QUEUE.                               18613143
186132                                                                  18613243
186133     MOVE +1                     TO  ASC-BLK-SUB.                 18613343
186134     PERFORM 4410-READ-TEMP-STORAGE.                              18613443
186135                                                                  18613543
186136     ADD +1                      TO  ASC-BLK-SUB                  18613643
186137                                     PV-BLOCK-NUMBER.             18613743
186138                                                                  18613843
186139     PERFORM 4410-READ-TEMP-STORAGE.                              18613943
186140                                                                  18614043
186141*----------------------------------------------------------------*18614143
186142* PROCESS SELECTED LINES                                         *18614243
186143*----------------------------------------------------------------*18614343
186144 4605-PROCESS-SELECTED-LINES.                                     18614443
186145                                                                  18614543
186146     MOVE LQW-TRAILER-ID (LQW-IDX)       TO PV-TRAILER-ID.        18614643
186147     MOVE LQW-SERIAL-NBR (LQW-IDX)       TO PV-SERIAL-NBR.        18614743
186148                                                                  18614843
186149     IF  LQW-SELECT (LQW-IDX)                                     18614943
186150             PERFORM 4630-ISSUE-PRINT-REQ                         18615043
186160     END-IF                                                       18616043
186170                                                                  18617043
186180     IF  PS-NO-ERROR                                              18618043
186181         SET  LQW-DESELECT (LQW-IDX)                              18618143
186182              LQW-PRT (LQW-IDX)        TO  TRUE                   18618243
186183         SUBTRACT  1                                              18618343
186184             FROM  ASC-NUMBER-OF-SELECTED-ITEMS                   18618443
186185         MOVE LQW-SELECTED-SW (LQW-IDX)                           18618543
186186                              TO LQW-TEMP-SELECTED-SW (LQW-IDX)   18618643
186187     END-IF.                                                      18618743
186188                                                                  18618843
186189*----------------------------------------------------------------*18618943
186190* ISSUE PRINT REQUEST                                          *  18619043
186191*----------------------------------------------------------------*18619143
186192 4630-ISSUE-PRINT-REQ.                                            18619243
186193                                                                  18619343
186194     INITIALIZE PC140-TRLR-SERL-NBR-LBL.                          18619443
186195     SET PC140-TRAILER-SERIAL-LBL-NBR TO TRUE.                    18619543
186196     MOVE ASC-PRTR-ID               TO PC140-TSN-PRTR-ID.         18619643
186197     IF ASC-USER-ID = SPACES                                      18619743
186198         MOVE DP020-USERID          TO PC140-TSN-USERID           18619843
186199     ELSE                                                         18619943
186200         MOVE ASC-USER-ID           TO PC140-TSN-USERID           18620043
186201     END-IF.                                                      18620143
186202     MOVE ASC-OPER-UNT-ID           TO PC140-TSN-OPER-UNT-ID.     18620243
186209     MOVE ASC-SCAC                  TO PC140-TSN-SCAC.            18620933
186210     MOVE PV-TRAILER-ID             TO PC140-TSN-TRLR-ID.         18621033
186212     MOVE PV-SERIAL-NBR             TO PC140-TSN-SERL-NBR.        18621233
186214     MOVE ASC-XFER-MODE-ID          TO PC140-TSN-XFER-MODE-ID.    18621433
186215     MOVE ASC-IP-ADDRESS            TO PC140-TSN-IP-ADDRESS.      18621533
186216     MOVE ASC-OS-RLSE-CDE           TO PC140-TSN-OS-RLSE-CDE.     18621633
186217                                                                  18621733
186218     MOVE 400  TO  PV-COMMAREA-LENGTH.                            18621833
186219                                                                  18621933
186220     EXEC CICS                                                    18622033
186230          LINK PROGRAM  ('PCKCS707')                              18623033
186240               COMMAREA (PC140-LABELMST)                          18624033
186241               LENGTH   (PV-COMMAREA-LENGTH)                      18624133
186242               RESP     (PV-CICS-RESPONSE)                        18624233
186243     END-EXEC.                                                    18624333
186244                                                                  18624433
186245     EVALUATE TRUE                                                18624533
186246         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 18624633
186247              CONTINUE                                            18624733
186248         WHEN OTHER                                               18624833
186249              SET PS-ERROR                TO TRUE                 18624933
186250              PERFORM DP013-0000-PROCESS-ABEND                    18625033
186251     END-EVALUATE.                                                18625133
186252     IF PC140-CRA-SOCKET-COMM-ERROR                               18625233
186253         SET PS-ERROR                TO TRUE                      18625333
186254         SET DP020-MSG-FATAL         TO TRUE                      18625433
186255         MOVE PC-TSYMSG-02122        TO DP020-MSG-NUMBER          18625533
186256         MOVE DP015-UNP-NUM-BRT-OFF  TO APRTIDA                   18625633
186257         MOVE -1                     TO APRTIDL                   18625733
186258         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      18625833
186259     ELSE                                                         18625933
186260     IF PC140-CRA-INVALID-PRT-FMT                                 18626033
186261         SET PS-ERROR                TO TRUE                      18626133
186262         SET DP020-MSG-FATAL         TO TRUE                      18626233
186263         MOVE PC-TSYMSG-01422        TO DP020-MSG-NUMBER          18626333
186264         MOVE -1                     TO APRTIDL                   18626433
186265         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      18626533
186266     ELSE                                                         18626633
186267         SET DP020-MSG-INFORMATIONAL TO TRUE                      18626733
186268         MOVE PC-TSYMSG-00098        TO DP020-MSG-NUMBER          18626833
186269         MOVE -1                     TO APRTIDL                   18626933
186270         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      18627033
186271     END-IF.                                                      18627133
186272                                                                  18627233
186325*----------------------------------------------------------------*18632501
186330* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *18633001
186400* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *18640001
186500* FOR THE SELECTED ITEMS QUEUE.                                  *18650001
186600*                                                                *18660001
186700* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *18670001
186800* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *18680001
186900* THE ARRAY IS FULL.                                             *18690001
187000*----------------------------------------------------------------*18700001
187100 5000-PREPARE-SEL-QUEUE.                                          18710001
187200     MOVE +1                   TO  ASC-BLK-SUB.                   18720001
187300     PERFORM 5100-WRITE-TEMP-STORAGE.                             18730001
187400     ADD +1                    TO  ASC-BLK-SUB.                   18740001
187500     PERFORM 5100-WRITE-TEMP-STORAGE.                             18750001
187600                                                                  18760001
187700     MOVE ASC-SEL-QUEUE-NAME   TO  CN009-SEL-QUEUE-NAME.          18770001
187800     PERFORM 6010-DELETE-SEL-QUEUE.                               18780001
187900                                                                  18790001
188000     SET ASC-UPDATE-TSQ        TO  TRUE.                          18800001
188100                                                                  18810001
188200     SET CN010-IDX             TO  1.                             18820002
188300     MOVE ZERO                 TO CN009-NUMBER-OF-TS-ITEMS.       18830001
188400     INITIALIZE CN010-SELECTED-ITEM-ARRAY.                        18840002
188500                                                                  18850001
188600     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           18860001
188700             VARYING PV-ITEM                                      18870001
188800             FROM 1 BY 1                                          18880001
188900             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     18890001
189000                                                                  18900001
189100     IF  CN010-IDX > 1                                            18910002
189200         PERFORM 5205-WRITE-SEL-QUEUE                             18920001
189300         ADD +1                TO CN009-NUMBER-OF-TS-ITEMS        18930001
189400     END-IF.                                                      18940001
189500                                                                  18950001
189600*----------------------------------------------------------------*18960001
189700*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *18970001
189800*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *18980001
189900*----------------------------------------------------------------*18990001
190000 5100-WRITE-TEMP-STORAGE.                                         19000001
190100     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     19010001
190200                                   TO PV-LIST-ITEM-NUMBER.        19020001
190300     COMPUTE PV-BLOCK-NUMBER =                                    19030001
190400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    19040001
190500                                                                  19050001
190600     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             19060001
190700     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             19070001
190800         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      19080001
190900             PERFORM 5105-REWRITE-ASC-LISTQ                       19090001
191000         END-IF                                                   19100001
191100     ELSE                                                         19110001
191200         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       19120001
191300         ASC-HIGHEST-BLOCK-WRITTEN + 1                            19130001
191400         PERFORM 5110-WRITE-ASC-LISTQ                             19140001
191500         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   19150001
191600     END-IF.                                                      19160001
191700                                                                  19170001
191800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             19180001
191900                                                                  19190001
192000******************************************************************19200001
192100** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **19210001
192200** SPECIFIC COMMAREA.                                           **19220001
192300******************************************************************19230001
192400 5105-REWRITE-ASC-LISTQ.                                          19240001
192500     EXEC CICS                                                    19250001
192600         WRITEQ TS                                                19260001
192700             QUEUE (ASC-LIST-QUEUE-NAME)                          19270001
192800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19280001
192900             ITEM  (PV-BLOCK-NUMBER)                              19290001
193000             REWRITE                                              19300001
193100             RESP  (PV-CICS-RESP)                                 19310001
193200     END-EXEC.                                                    19320001
193300                                                                  19330001
193400     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           19340001
193500         CONTINUE                                                 19350001
193600     ELSE                                                         19360001
193700         SET DP013-CICS-ABEND            TO TRUE                  19370001
193800         SET DP013-NO-ROLLBACK           TO TRUE                  19380001
193900         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       19390001
194000         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     19400001
194100                                         TO DP013-MESSAGE-TEXT(1) 19410001
194200         PERFORM DP013-0000-PROCESS-ABEND                         19420001
194300     END-IF.                                                      19430001
194400                                                                  19440001
194500******************************************************************19450001
194600** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **19460001
194700** SPECIFIC COMMAREA.                                           **19470001
194800******************************************************************19480001
194900 5110-WRITE-ASC-LISTQ.                                            19490001
195000     EXEC CICS                                                    19500001
195100         WRITEQ TS                                                19510001
195200             QUEUE (ASC-LIST-QUEUE-NAME)                          19520001
195300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19530001
195400             ITEM  (PV-BLOCK-NUMBER)                              19540001
195500             RESP  (PV-CICS-RESP)                                 19550001
195600     END-EXEC.                                                    19560001
195700     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      19570001
195800         SET DP013-CICS-ABEND      TO TRUE                        19580001
195900         SET DP013-NO-ROLLBACK     TO TRUE                        19590001
196000         MOVE '5110-WRITE-ASC-LISTQ'                              19600001
196100                                   TO DP013-PARAGRAPH             19610001
196200         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           19620001
196300                                   TO DP013-MESSAGE-TEXT(1)       19630001
196400         PERFORM DP013-0000-PROCESS-ABEND                         19640001
196500     END-IF.                                                      19650001
196600                                                                  19660001
196700*----------------------------------------------------------------*19670001
196800* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *19680001
196900* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *19690001
197000*----------------------------------------------------------------*19700001
197100 5200-FILL-SEL-QUEUE-RECORD.                                      19710001
197200     PERFORM 6112-READ-LIST-QUEUE.                                19720001
197300                                                                  19730001
197400     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       19740001
197500         PERFORM VARYING LQW-IDX                                  19750013
197700         FROM 1 BY 1                                              19770001
197800         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            19780001
197900           OR  LQW-LIST-ITEM-NUMBER(LQW-IDX) = ZERO               19790013
198000                                                                  19800001
198010           IF LQW-SELECT (LQW-IDX)                                19801014
198020                 MOVE LQW-LIST-ITEM-NUMBER(LQW-IDX) TO            19802013
198030                                            CN010-ITEM (CN010-IDX)19803013
198040                 MOVE SPACE      TO  CN010-ACTION-SW (CN010-IDX)  19804026
198610                 MOVE LQW-TRAILER-ID (LQW-IDX)                    19861034
198700                                  TO CN010-TRAILER-ID (CN010-IDX) 19870013
198710                 MOVE ASC-SCAC                                    19871050
198720                                  TO CN010-SCAC       (CN010-IDX) 19872050
198800                  MOVE LQW-SERIAL-NBR (LQW-IDX)                   19880034
199000                                  TO CN010-SERIAL-NBR (CN010-IDX) 19900013
199100                  MOVE LQW-TRLR-LENGTH (LQW-IDX)                  19910051
199110                                  TO CN010-TRLR-LENGTH(CN010-IDX) 19911051
199200                                                                  19920011
199300                 SET CN010-IDX UP BY 1                            19930002
199400                 IF  CN010-IDX > CN010-MAX-ITEMS                  19940002
199500                     PERFORM 5205-WRITE-SEL-QUEUE                 19950001
199600                     ADD +1        TO CN009-NUMBER-OF-TS-ITEMS    19960001
199700                     INITIALIZE CN010-SELECTED-ITEM-ARRAY         19970002
199800                     SET CN010-IDX TO  1                          19980014
199900                 END-IF                                           19990001
200000           END-IF                                                 20000014
200100         END-PERFORM                                              20010001
200200     END-IF.                                                      20020001
200300                                                                  20030001
200400*----------------------------------------------------------------*20040001
200500*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *20050001
200600*----------------------------------------------------------------*20060001
200700 5205-WRITE-SEL-QUEUE.                                            20070001
200800     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO CN010-SELECTED-ITEMS.   20080002
200900                                                                  20090001
201000     EXEC CICS                                                    20100001
201100          WRITEQ TS                                               20110001
201200              QUEUE (ASC-SEL-QUEUE-NAME)                          20120001
201300              FROM  (CN010-SELECT-RECORD)                         20130002
201400              ITEM  (PV-SEL-QUEUE-ITEM)                           20140001
201500              RESP  (PV-CICS-RESP)                                20150001
201600     END-EXEC.                                                    20160001
201700                                                                  20170001
201800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          20180001
201900         CONTINUE                                                 20190001
202000     ELSE                                                         20200001
202100         SET DP013-CICS-ABEND      TO TRUE                        20210001
202200         SET DP013-NO-ROLLBACK     TO TRUE                        20220001
202300         MOVE '5205-WRITE-SEL-QUEUE'                              20230001
202400                                   TO DP013-PARAGRAPH             20240001
202500         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          20250001
202600                                   TO DP013-MESSAGE-TEXT(1)       20260001
202700         PERFORM DP013-0000-PROCESS-ABEND                         20270001
202800     END-IF.                                                      20280001
202900                                                                  20290001
203000******************************************************************20300001
203100** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **20310001
203200** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **20320001
203300** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **20330001
203400** THE USER.                                                    **20340001
203500******************************************************************20350001
203600 6000-REFRESH-PANEL-FROM-TEMP.                                    20360001
203700     IF  ASC-UPDATE-TSQ AND ASC-NUMBER-OF-SELECTED-ITEMS > 0      20370041
203800         SET ASC-NO-TSQ-UPDATE TO TRUE                            20380001
203900         MOVE ZERO                 TO PV-SAVE-ITEM                20390001
204000                                      PV-SEL-QUEUE-ITEM           20400001
204100         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        20410001
204200                                   TO PV-HOLD-SELECTED-ITEMS      20420001
204300         MOVE +1                   TO PV-ITEMS-PROCESSED          20430001
204400         PERFORM 6100-UPDATE-TSQ                                  20440001
204500             UNTIL PV-ITEMS-PROCESSED >                           20450001
204600                                     PV-HOLD-SELECTED-ITEMS       20460001
204700         PERFORM 6010-DELETE-SEL-QUEUE                            20470026
204710         INITIALIZE ASC-BLOCK-ENTRIES (1)                         20471026
204800                    ASC-BLOCK-ENTRIES (2)                         20480001
204900     END-IF.                                                      20490001
205000                                                                  20500001
205100*----------------------------------------------------------------*20510001
205200*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *20520001
205300*----------------------------------------------------------------*20530001
205400 6010-DELETE-SEL-QUEUE.                                           20540001
205500                                                                  20550001
205600     EXEC CICS                                                    20560001
205700         DELETEQ TS                                               20570001
205800             QUEUE (ASC-SEL-QUEUE-NAME)                           20580001
205900             RESP  (PV-CICS-RESP)                                 20590001
206000     END-EXEC.                                                    20600001
206100*                                                                 20610001
206200     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      20620001
206300        (PV-CICS-RESP = DFHRESP(QIDERR)))                         20630001
206400         CONTINUE                                                 20640001
206500     ELSE                                                         20650001
206600         SET DP013-CICS-ABEND TO TRUE                             20660001
206700         SET DP013-NO-ROLLBACK TO TRUE                            20670001
206800         MOVE '6010-DELETE-SEL-QUEUE' TO DP013-PARAGRAPH          20680009
207000         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         20700001
207100                                        TO DP013-MESSAGE-TEXT (1) 20710009
207200         PERFORM DP013-0000-PROCESS-ABEND                         20720001
207300     END-IF.                                                      20730001
207400                                                                  20740001
207500*----------------------------------------------------------------*20750001
207600*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *20760001
207700*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *20770001
207800*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *20780001
207900*    THE TEMP QUEUE.                                             *20790001
208000*----------------------------------------------------------------*20800001
208100 6100-UPDATE-TSQ.                                                 20810001
208200     ADD 1    TO  PV-SEL-QUEUE-ITEM.                              20820009
208300     PERFORM 6105-READ-SEL-QUEUE.                                 20830001
208400     PERFORM                                                      20840001
208500         VARYING CN010-IDX FROM 1 BY 1                            20850009
208700         UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS)     20870009
208900         OR (CN010-IDX GREATER THAN CN010-MAX-ITEMS))             20890002
209000         IF  CN010-ACTION-SW (CN010-IDX) > SPACE                  20900002
209100             PERFORM 6110-PROCESS-ITEMS                           20910001
209200         END-IF                                                   20920001
209300         ADD +1                TO PV-ITEMS-PROCESSED              20930001
209400     END-PERFORM.                                                 20940001
209500     PERFORM 6111-WRITE-LIST-QUEUE.                               20950001
209600                                                                  20960001
209700*----------------------------------------------------------------*20970001
209800*    READ THE LIST QUEUE RECORD.                                 *20980001
209900*----------------------------------------------------------------*20990001
210000 6105-READ-SEL-QUEUE.                                             21000001
210100                                                                  21010001
210200     EXEC CICS                                                    21020001
210300          READQ TS                                                21030001
210400              QUEUE (ASC-SEL-QUEUE-NAME)                          21040001
210500              INTO  (CN010-SELECT-RECORD)                         21050002
210600              ITEM  (PV-SEL-QUEUE-ITEM)                           21060001
210700              RESP  (PV-CICS-RESP)                                21070001
210800     END-EXEC.                                                    21080001
210900*                                                                 21090001
211000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          21100001
211100         CONTINUE                                                 21110001
211200     ELSE                                                         21120001
211300         SET DP013-CICS-ABEND      TO  TRUE                       21130001
211400         SET DP013-NO-ROLLBACK     TO  TRUE                       21140001
211500         MOVE '6105-READ-SEL-QUEUE'                               21150001
211600                                   TO  DP013-PARAGRAPH            21160001
211700         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           21170001
211800                                   TO  DP013-MESSAGE-TEXT(1)      21180001
211900         PERFORM DP013-0000-PROCESS-ABEND                         21190001
212000     END-IF.                                                      21200001
212100                                                                  21210001
212200*----------------------------------------------------------------*21220001
212300*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*21230001
212400*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*21240001
212500*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *21250001
212600*----------------------------------------------------------------*21260001
212700 6110-PROCESS-ITEMS.                                              21270001
212800                                                                  21280001
212900     COMPUTE PV-ITEM = 1 + ((CN010-ITEM (CN010-IDX) - 1)          21290002
213000                     / PC-ITEMS-PER-PANEL).                       21300001
213100                                                                  21310001
213200     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           21320001
213300         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          21330001
213400             PERFORM 6111-WRITE-LIST-QUEUE                        21340001
213500         END-IF                                                   21350001
213600         MOVE PV-ITEM          TO PV-SAVE-ITEM                    21360001
213700                                                                  21370001
213800         PERFORM 6112-READ-LIST-QUEUE                             21380001
213900         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               21390001
214000             CONTINUE                                             21400001
214100         END-IF                                                   21410001
214200     END-IF.                                                      21420001
214300                                                                  21430001
214400     COMPUTE PV-SUB = (CN010-ITEM (CN010-IDX)                     21440002
214500                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              21450001
214600     SET LQW-DESELECT (PV-SUB) TO    TRUE                         21460001
214700     MOVE LQW-SELECTED-SW (PV-SUB)                                21470001
214800                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  21480001
214900     EVALUATE TRUE                                                21490001
215000         WHEN CN010-INQ (CN010-IDX)                               21500002
215100              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             21510001
215200                                                                  21520001
215300         WHEN CN010-UPD (CN010-IDX)                               21530002
215400              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             21540001
215410              MOVE CN010-TRLR-LENGTH (CN010-IDX)                  21541052
215420                               TO LQW-TRLR-LENGTH (PV-SUB)        21542052
215500                                                                  21550001
215600         WHEN CN010-DEL (CN010-IDX)                               21560002
215700              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             21570001
215800                                                                  21580001
215900         WHEN CN010-ERR (CN010-IDX)                               21590002
216000              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             21600001
216010                                                                  21601032
216020         WHEN OTHER                                               21602032
216030              MOVE 'PRT'       TO LQW-ACTION (PV-SUB)             21603032
216100     END-EVALUATE.                                                21610001
216200                                                                  21620001
216300     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                21630001
216400                                                                  21640001
216500*----------------------------------------------------------------*21650001
216600*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *21660001
216700*----------------------------------------------------------------*21670001
216800 6111-WRITE-LIST-QUEUE.                                           21680001
216900     EXEC CICS                                                    21690001
217000         WRITEQ TS                                                21700001
217100             QUEUE (ASC-LIST-QUEUE-NAME)                          21710001
217200             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     21720001
217300             ITEM  (PV-SAVE-ITEM)                                 21730001
217400             REWRITE                                              21740001
217500             RESP  (PV-CICS-RESP)                                 21750001
217600     END-EXEC.                                                    21760001
217700*                                                                 21770001
217800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          21780001
217900         CONTINUE                                                 21790001
218000     ELSE                                                         21800001
218100         SET DP013-CICS-ABEND  TO  TRUE                           21810001
218200         SET DP013-NO-ROLLBACK TO  TRUE                           21820001
218300         MOVE '6111-WRITE-LIST-QUEUE' TO  DP013-PARAGRAPH         21830001
218400         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  21840001
218500                               TO  DP013-MESSAGE-TEXT(1)          21850001
218600         PERFORM DP013-0000-PROCESS-ABEND                         21860001
218700     END-IF.                                                      21870001
218800                                                                  21880001
218900*----------------------------------------------------------------*21890001
219000*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*21900001
219100*----------------------------------------------------------------*21910001
219200 6112-READ-LIST-QUEUE.                                            21920001
219300     EXEC CICS                                                    21930001
219400         READQ TS                                                 21940001
219500             QUEUE (ASC-LIST-QUEUE-NAME)                          21950001
219600             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     21960001
219700             ITEM  (PV-ITEM)                                      21970001
219800             RESP  (PV-CICS-RESP)                                 21980001
219900     END-EXEC.                                                    21990001
220000*                                                                 22000001
220100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22010001
220200         CONTINUE                                                 22020001
220300     ELSE                                                         22030001
220400         SET DP013-CICS-ABEND        TO TRUE                      22040001
220500         SET DP013-NO-ROLLBACK       TO TRUE                      22050001
220600         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           22060001
220700         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    22070001
220800                                     TO DP013-MESSAGE-TEXT(1)     22080001
220900         PERFORM DP013-0000-PROCESS-ABEND                         22090001
221000     END-IF.                                                      22100001
221100                                                                  22110001
221340*----------------------------------------------------------------*22134001
221400*    THE DB2 RESOURCE IS NOT AVAILABLE, DISPLAY A MESSAGE ON     *22140001
221500*    THE TERMINAL INDICATING THAT THE RESOURCE IS UNAVAILABLE.   *22150001
221600*----------------------------------------------------------------*22160001
221700 9900-SOFT-ABORT.                                                 22170001
221800     EXEC CICS SYNCPOINT                                          22180001
221900          ROLLBACK                                                22190001
222000     END-EXEC.                                                    22200001
222100                                                                  22210001
222200     SET  PS-ERROR                                                22220001
222300          PS-SOFT-ABORT-ERROR                                     22230001
222400          DP020-MSG-FATAL       TO  TRUE.                         22240001
222500                                                                  22250001
222600*----------------------------------------------------------------*22260001
222700*    ABEND PROCESSOR MODULE                                      *22270001
222800*----------------------------------------------------------------*22280001
222900     COPY DPPD013.                                                22290001
