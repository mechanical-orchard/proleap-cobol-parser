000100*-----------------------*                                                 
000200 IDENTIFICATION DIVISION.                                                 
000300*-----------------------*                                                 
000400 PROGRAM-ID.    TRKCS148.                                                 
000500 AUTHOR.        LARRY SCHLEICHER (STRATAGEM).                             
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
000700 DATE-WRITTEN.  06-10-97.                                                 
000800 DATE-COMPILED.                                                           
000900*----------------------------------------------------------------*        
001000*    Y148 - ADD/UPDATE/DELETE COUNTRY CODES                      *        
001100*    COPIED 9/18/97                                              *        
001200*    THIS PROGRAM ALLOWS THE USER TO ADD/UPDATE/DELETE COUNTRY   *        
001300*    CODES.  THE COUNTRY DESCRIPTION MUST BE ENTERED FOR THE     *        
001400*    ADD FUNCTION.                                               *        
001500*----------------------------------------------------------------*        
P5207 *DATE: 11/27/2013 CHANGE MADE BY: COGNIZANT(SHEBENA)             *        
P5207 *CHANGE MADE: RECOMPILED THE PROGRAM AS THE TRWS019 COPYBOOK HAS *        
P5207 *             NEW FIELDS INCOTERM CODE AND DESCRIPTION ADDED TO  *        
P5207 *             IT.  CHANGE TAG : P5207  CR # : CHG0081355         *        
P5207 *----------------------------------------------------------------*        
CICS  * CHANGED 11/21/2022    BY JIM HUNTER      WR: CHG0278495                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
001600                                                                          
001700 ENVIRONMENT DIVISION.                                                    
001800                                                                          
001900 DATA DIVISION.                                                           
002000                                                                          
002100 WORKING-STORAGE SECTION.                                                 
002200                                                                          
002300 01  DK-DB2-KEYS.                                                         
002400     05  DK-COUNTRY-CODE                PIC  X(03)  VALUE SPACE.          
002410     05  DK-STAT-CODE                   PIC  X(01)  VALUE SPACE.          
002500*                                                                         
002600 01  PC-PROGRAM-CONSTANTS.                                                
002700     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'TR148A  '.          
002800     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'TRKM148 '.          
002900     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'TRKCS148'.          
003000     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3                   
003100                                              COMP.                       
003200     05  PC-MAX-LOCK-RETRIES      PIC S9(04)  VALUE  +3                   
003300                                              COMP.                       
003400     05  PC-MAX-MSG-VAR           PIC S9(04)  VALUE +1                    
003500                                              COMP.                       
003600     05  PC-UPD-VSAM              PIC  X(01)  VALUE 'Y'.                  
003700     05  PC-A                     PIC  X(01)  VALUE 'A'.                  
003710     05  PC-I                     PIC  X(01)  VALUE 'I'.                  
003800     05  PC-MSG-VAR-SYMBOLIC      PIC  X(04)  VALUE '&VAR'.               
003900     05  PC-TSYMSG-NUMBERS.                                               
004000         10  PC-TSYMSG-00004      PIC  9(05)  VALUE  00004.               
004001         10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.               
004010         10  PC-TSYMSG-00029      PIC  9(05)  VALUE  00029.               
004011         10  PC-TSYMSG-00034      PIC  9(05)  VALUE  00034.               
004012         10  PC-TSYMSG-00035      PIC  9(05)  VALUE  00035.               
004013         10  PC-TSYMSG-00050      PIC  9(05)  VALUE  00050.               
004014         10  PC-TSYMSG-00057      PIC  9(05)  VALUE  00057.               
004015         10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.               
004020         10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.               
004030         10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.               
004100         10  PC-TSYMSG-00095      PIC  9(05)  VALUE  00095.               
004200         10  PC-TSYMSG-00115      PIC  9(05)  VALUE  00115.               
004201         10  PC-TSYMSG-00116      PIC  9(05)  VALUE  00116.               
004202         10  PC-TSYMSG-00117      PIC  9(05)  VALUE  00117.               
004210         10  PC-TSYMSG-00223      PIC  9(05)  VALUE  00223.               
004300         10  PC-TSYMSG-00224      PIC  9(05)  VALUE  00224.               
004400         10  PC-TSYMSG-00224      PIC  9(05)  VALUE  00224.               
004500         10  PC-TSYMSG-00068      PIC  9(05)  VALUE  00068.               
004600         10  PC-TSYMSG-00352      PIC  9(05)  VALUE  00352.               
004610         10  PC-TSYMSG-00388      PIC  9(05)  VALUE  00388.               
004700         10  PC-TSYMSG-01450      PIC  9(05)  VALUE  01450.               
004701         10  PC-TSYMSG-01644      PIC  9(05)  VALUE  01644.               
004702     05  PC-INTER-APPL-CODES.                                             
004703         10  PC-INTER-APPL-CRIT-ADD   PIC X(01)  VALUE '1'.               
004704         10  PC-INTER-APPL-CRIT-UPD   PIC X(01)  VALUE '2'.               
004705         10  PC-INTER-APPL-CRIT-DEL   PIC X(01)  VALUE '3'.               
004706         10  PC-INTER-APPL-LIST-UPD   PIC X(01)  VALUE '4'.               
004707         10  PC-INTER-APPL-LIST-DEL   PIC X(01)  VALUE '5'.               
004710         10  PC-INTER-APPL-LIST-COPY  PIC X(01)  VALUE '7'.               
004800*                                                                         
004900 01  PS-PROGRAM-SWITCHES.                                                 
005000     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.                 
005100         88  PS-ERROR                         VALUE  'Y'.                 
005200         88  PS-NO-ERROR                      VALUE  'N'.                 
005201     05  PS-COMMAREA-SW           PIC X(01)   VALUE 'N'.                  
005202         88  PS-COMMAREA-VALID                VALUE 'Y'.                  
005210         88  PS-COMMAREA-NOT-VALID            VALUE 'N'.                  
005211     05  PS-LIST-END-SW           PIC X(01)   VALUE 'N'.                  
005212         88  PS-LIST-END                      VALUE 'Y'.                  
005220         88  PS-NO-LIST-END                   VALUE 'N'.                  
005300*                                                                         
005400 01  PV-PROGRAM-VARIABLES.                                                
005500     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0                    
005600                                              COMP SYNC.                  
005700     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0                    
005800                                              COMP SYNC.                  
005900     05  PV-LOCK-RETRY-COUNTER    PIC S9(04)  VALUE +0                    
006000                                              COMP SYNC.                  
006100     05  PV-MSG-VAR-CNT           PIC S9(04)  VALUE +0                    
006200                                              COMP SYNC.                  
006210     05  PV-DISPLAY-TASK          PIC 9(05).                              
006300                                                                          
006301*---------------------------------------------------------------*         
006302*  RECORD LAYOUT FOR THE COUNTRY CODE SELECTION TEMP STORAGE    *         
006303*  QUEUE.                                                       *         
006304*---------------------------------------------------------------*         
006305                                                                          
006306     COPY TRWS020.                                                        
006310                                                                          
006400 EJECT                                                                    
006500*----------------------------------------------------------------*        
006600*    CALLING PARAMETERS FOR LOCKING MODULE DPKCS044              *        
006700*----------------------------------------------------------------*        
006800                                                                          
006900     COPY DPWS044.                                                        
007000 EJECT                                                                    
007100*----------------------------------------------------------------*        
007200*    MAP LAYOUT                                                  *        
007300*----------------------------------------------------------------*        
007400                                                                          
007500     COPY TRKM148.                                                        
007600                                                                          
007700                                                                          
007800     EJECT                                                                
007900*----------------------------------------------------------------*        
008000*    ATTRIBUTE SETTINGS COPYBOOK.                                *        
008100*----------------------------------------------------------------*        
008200                                                                          
008300     COPY DPWS015.                                                        
008400                                                                          
008500*----------------------------------------------------------------*        
008600*    FUNCTION KEYS COPYBOOK                                      *        
008700*----------------------------------------------------------------*        
008800                                                                          
008900     COPY DPWS016.                                                        
009000 EJECT                                                                    
009100*****************************************************************         
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.                    
009300*****************************************************************         
009400     COPY DPWS030.                                                        
CICS       COPY DPWS930.                                                        
009500 EJECT                                                                    
009600*****************************************************************         
009700*    STANDARD COMMAREA.                                                   
009800*****************************************************************         
009900                                                                          
010000     COPY DPWS020.                                                        
010100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                        
010200                                                                          
010300*****************************************************************         
010400*    INTER-APPLICATION COMMAREA.                                          
010500*****************************************************************         
010600                                                                          
010700         10  INTER-APPL-COMM-AREA PIC X(200).                             
010800     COPY TRWS019.                                                        
010900*****************************************************************         
011000*    SPECIFIC COMMMAREA FOR TRKCS148.                                     
011100*****************************************************************         
011200         10  ASC-SPECIFIC-COMMAREA.                                       
011300             15  ASC-FORMAT-IND                 PIC  X(01).               
011400                 88  ASC-ADD-COUNTRY                    VALUE '1'.        
011500                 88  ASC-UPD-COUNTRY               VALUE '2', '4'.        
011600                 88  ASC-DEL-COUNTRY                    VALUE '3'.        
011700                 88  ASC-UPD-FROM-LIST                  VALUE '4'.        
011800                 88  ASC-DEL-FROM-LIST                  VALUE '5'.        
011810                 88  ASC-ADD-FROM-LIST                  VALUE '6'.        
011900             15  ASC-ADD-COMPLETE-SW            PIC  X(01).               
012000                 88  ASC-ADD-COMPLETE                   VALUE 'Y'.        
012100                 88  ASC-ADD-PENDING                    VALUE 'N'.        
012200             15  ASC-UPD-COMPLETE-SW            PIC  X(01).               
012300                 88  ASC-UPD-COMPLETE                   VALUE 'Y'.        
012400                 88  ASC-UPD-PENDING                    VALUE 'N'.        
012500             15  ASC-DEL-COMPLETE-SW            PIC  X(01).               
012600                 88  ASC-DEL-COMPLETE                   VALUE 'Y'.        
012700                 88  ASC-DEL-PENDING                    VALUE 'N'.        
012800             15  ASC-COUNTRY-DESC-CHANGED-SW    PIC  X(01).               
012900                 88  ASC-COUNTRY-DESC-CHANGED           VALUE 'Y'.        
013000                 88  ASC-COUNTRY-DESC-NOT-CHANGED       VALUE ' '.        
013100             15  ASC-COUNTRY-CODE               PIC  X(03).               
013200             15  ASC-COUNTRY-CODE-DESC          PIC  X(40).               
013300             15  ASC-COUNTRY-CODE-IND           PIC  X(01).               
013400                 88  ASC-VALID-COUNTRY-CODE    VALUE 'Y'.                 
013500                 88  ASC-INVALID-COUNTRY-CODE  VALUE 'N'.                 
013600             15  ASC-USE-SELECTION-QUEUE-IND PIC  X(01).                  
013700                 88  ASC-USE-SEL-QUEUE         VALUE 'Y'.                 
013800             15  ASC-LIST-QUEUE-NAME.                                     
013900                 20  ASC-LIST-TERM-ID                PIC  X(04).          
014000                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)           
014100                                                          COMP-3.         
014200                 20  ASC-LIST-SEQ                    PIC  9(01).          
014201             15  ASC-NUMBER-OF-SELECTED-ITEMS                             
014202                                            PIC S9(09) COMP-3.            
014203             15  ASC-NUMBER-OF-TS-ITEMS     PIC S9(05) COMP-3.            
014204             15  ASC-SEL-QUEUE-NAME.                                      
014205                 20  ASC-SEL-TERM-ID        PIC X(04).                    
014206                 20  ASC-SEL-TASK           PIC S9(05) COMP-3.            
014207                 20  ASC-SEL-SEQ            PIC 9(01).                    
014208             15  ASC-SEL-SUB                PIC S9(04) COMP.              
014209             15  ASC-SEL-ITEM               PIC S9(04) COMP.              
014300     EJECT                                                                
014400*----------------------------------------------------------------*        
014500*    ABEND PROCESSING COPYBOOK.                                  *        
014600*----------------------------------------------------------------*        
014700                                                                          
014800     COPY DPWS013.                                                        
014900                                                                          
015000*    DB2 AREA FOR TSYMSG  (SYSTEM MESSAGE - SHORT MESSAGE)                
015100                                                                          
015200*---------------------------------------------------------------*         
015300*    DB2 AREA FOR COUNTRY CODE TABLE                            *         
015400*---------------------------------------------------------------*         
015500     EXEC SQL                                                             
015600          INCLUDE TCNTRY                                                  
015700     END-EXEC.                                                            
015800                                                                          
015900*---------------------------------------------------------------*         
016000*    DB2 AREA FOR COMMUNICATIONS                                *         
016100*---------------------------------------------------------------*         
016200     EXEC SQL                                                             
016300          INCLUDE SQLCA                                                   
016400     END-EXEC.                                                            
016500                                                                          
016600 EJECT                                                                    
016700 LINKAGE SECTION.                                                         
016800                                                                          
016900 01  DFHCOMMAREA.                                                         
017000     05  FILLER                         OCCURS  1 TO 4072 TIMES           
017100                                        DEPENDING ON EIBCALEN.            
017200         10  FILLER                     PIC  X(01).                       
017300                                                                          
017400                                                                          
017500 PROCEDURE DIVISION.                                                      
017600*****************************************************************         
017700** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. **         
017800** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  **         
017900** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            **         
018000**                                                             **         
018100** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  **         
018200** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       **         
018300*****************************************************************         
018400 0000-MAIN-MODULE.                                                        
018500     INITIALIZE DP030-CICS-API-FIELDS.                                    
018600     MOVE +1                       TO DP030-NUMBER-OF-MAPS.               
018700     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.                  
018800     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).                 
018900     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                               
019000     MOVE LENGTH OF TR148AI        TO DP030-MAP-LENGTH (1).               
019100     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).             
019200     PERFORM 0001-CALL-CICS-ARCH-API.                                     
019300*                                                                         
019400     PERFORM 1000-CONTROL-PROCESSING                                      
019500*                                                                         
019600     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).             
019700     PERFORM 0001-CALL-CICS-ARCH-API.                                     
019800                                                                          
019900 0001-CALL-CICS-ARCH-API.                                                 
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
020100                                    DFHCOMMAREA                           
020200                                    DP030-CICS-API-FIELDS                 
020300                                    DP020-STANDARD-COMMAREA               
020400                                    TR148AI.                              
020500*                                                                         
020600     IF  DP030-RC-CALL-SUCCESSFUL                                         
020700         CONTINUE                                                         
020800     ELSE                                                                 
020900         SET DP013-NO-ROLLBACK                                            
021000             DP013-XCTL-DISPLAY-RESTART                                   
021100             DP013-CICS-ABEND      TO TRUE                                
021200         MOVE 'BEFORE 0000-MAIN-MODULE'                                   
021300                                   TO DP013-PARAGRAPH                     
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
021600         MOVE DP030-RETURN-CODE                                           
021700                                   TO DP013-MESSAGE-TEXT (3)              
021800         PERFORM DP013-0000-PROCESS-ABEND                                 
021900     END-IF.                                                              
022000 EJECT                                                                    
022100*----------------------------------------------------------------*        
022200*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *        
022300*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *        
022400*----------------------------------------------------------------*        
022500                                                                          
022600 1000-CONTROL-PROCESSING.                                                 
022700                                                                          
022800     EVALUATE TRUE                                                        
022900         WHEN DP020-NEXT-ACT-INITIAL                                      
023000             INITIALIZE ASC-SPECIFIC-COMMAREA                             
023100             MOVE TR019-COUNTRY-CODE TO ASC-COUNTRY-CODE                  
023110*            MOVE TR019-COUNTRY-CODE-DESC                                 
023120*                  TO ASC-COUNTRY-CODE-DESC                               
023200             MOVE DP020-INT-APPL-FORMAT-IND TO ASC-FORMAT-IND           D 
023300             PERFORM 1100-PROCESS-INTER-APPL-COMM                       00
023700             PERFORM 4000-BUILD-INITIAL-PANEL                             
023710*            PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
023711             IF ASC-COUNTRY-CODE = SPACES                                 
023720                SET PS-ERROR TO TRUE                                      
023730             END-IF                                                       
023800             PERFORM 3200-RESET-ATTRIBUTES                                
023900                                                                          
024000                                                                          
024100         WHEN DP020-NEXT-ACT-READ-MAP                                     
024200             PERFORM 2000-PROCESS-PANEL                                   
024300                                                                          
024400         WHEN DP020-NEXT-ACT-RETURN                                       
024600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
024700                                                                          
024800         WHEN OTHER                                                       
024900             SET DP013-LOGIC-ABEND                                        
025000                 DP013-NO-ROLLBACK TO TRUE                                
025100             MOVE '1000-CONTROL-PROCESSING'                               
025200                                   TO DP013-PARAGRAPH                     
025300             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'           
025400                                   TO DP013-MESSAGE-TEXT(1)               
025500             MOVE DP020-NEXT-APPL-ACTIVITY                                
025600                                   TO DP013-MESSAGE-TEXT(2)               
025700             PERFORM DP013-0000-PROCESS-ABEND                             
025800     END-EVALUATE.                                                        
025801                                                                          
025802*----------------------------------------------------------------*        
025803*    DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE  *        
025804*    INTER-APPLICATION FORMAT CODE.                              *        
025805*                                                                *        
025806*    PERFORM SPECIFIC VALIDATIONS FOR EACH "MODE" AND BASED      *        
025807*    ON WHERE THE PROGRAM WAS INITIATED FROM.                    *        
025808*----------------------------------------------------------------*        
025809 1100-PROCESS-INTER-APPL-COMM.                                            
025810                                                                          
025811     SET PS-COMMAREA-VALID         TO TRUE.                               
025812                                                                          
025813*    INITIALIZE ASC-SPECIFIC-COMMAREA.                                    
025909              PERFORM 4200-SELECT-COUNTRY-DESC                            
025910              IF ASC-INVALID-COUNTRY-CODE                                 
025913                    SET PS-ERROR                                          
025914                        DP020-MSG-FATAL   TO TRUE                         
025915                    SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                 
025916                    MOVE PC-TSYMSG-00050  TO DP020-MSG-NUMBER             
025917                    MOVE DP015-UNP-ALP-BRT-OFF                            
025918                                          TO ACNTCODA                     
025919                    MOVE DP015-RED        TO ACNTCODC                     
025920                    MOVE DP015-REVERSE    TO ACNTCODH                     
025921                    MOVE -1               TO ACNTCODL                     
025922                    SET DP030-SET-CURSOR-APPL-1 TO TRUE                   
025923               END-IF                                                     
025956                                                                          
025814                                                                          
025816     EVALUATE DP020-INT-APPL-FORMAT-IND                                   
025817* PERFORM PRE-EDITS WHEN UPDATING, COMING FROM A LIST SCREEN              
025818* PERFORM PRE-EDITS WHEN DELETING, COMING FROM A LIST SCREEN              
025819         WHEN PC-INTER-APPL-LIST-UPD                                      
025820         WHEN PC-INTER-APPL-LIST-DEL                                      
025823             IF TR019-NUMBER-OF-SELECTED-ITEMS  = 0                       
025824                 SET DP020-NEXT-ACT-APPL-ERROR                            
025825                     DP030-OVERRIDE-GO                                    
025826                     DP020-MSG-WARNING                                    
025827                     PS-ERROR                                             
025828                     PS-COMMAREA-NOT-VALID                                
025829                                   TO TRUE                                
025830                 MOVE PC-TSYMSG-00057                                     
025831                                   TO DP020-MSG-NUMBER                    
025832             ELSE                                                         
025833                 SET ASC-USE-SEL-QUEUE                                    
025834                     DP030-SET-CURSOR-APPL-1                              
025835                                   TO TRUE                                
025836                 MOVE TR019-NUMBER-OF-SELECTED-ITEMS                      
025837                                   TO ASC-NUMBER-OF-SELECTED-ITEMS        
025838                 MOVE TR019-NUMBER-OF-TS-ITEMS                            
025839                                   TO ASC-NUMBER-OF-TS-ITEMS              
025840                 MOVE TR019-SEL-QUEUE-NAME                                
025841                                   TO ASC-SEL-QUEUE-NAME                  
025842                 PERFORM 1120-PREPARE-LIST-ENTRY                          
025843             END-IF                                                       
025877                                                                          
025878             IF  PS-NO-ERROR                                              
025880                 IF ASC-UPD-FROM-LIST                                     
025881                     SET ASC-UPD-PENDING                                  
025882                                   TO TRUE                                
025883                     MOVE -1       TO ACNTDESL                            
025884                 ELSE                                                     
025885                     MOVE PC-TSYMSG-00004                                 
025886                                   TO DP020-MSG-NUMBER                    
025887                     SET ASC-DEL-PENDING                                  
025888                     DP020-MSG-INFORMATIONAL                              
025889                                   TO TRUE                                
025890                 END-IF                                                   
025891             END-IF                                                       
025892                                                                          
025893* PERFORM PRE-EDITS WHEN UPDATING, COMING FROM THE CRIT SPEC              
025894* PERFORM PRE-EDITS WHEN DELETING, COMING FROM THE CRIT SPEC              
025895         WHEN PC-INTER-APPL-CRIT-UPD                                      
025896         WHEN PC-INTER-APPL-CRIT-DEL                                      
025897              MOVE TR019-COUNTRY-CODE TO ASC-COUNTRY-CODE                 
025898                                         DK-COUNTRY-CODE                  
025957             IF DP020-INT-APPL-FORMAT-IND = PC-INTER-APPL-CRIT-UPD        
025958                 IF  PS-NO-ERROR                                          
025959                     SET ASC-UPD-PENDING                                  
025960                                   TO TRUE                                
025961                     MOVE -1       TO ACNTDESL                            
025962                 END-IF                                                   
025963             END-IF                                                       
025964                                                                          
025965             IF DP020-INT-APPL-FORMAT-IND = PC-INTER-APPL-CRIT-DEL        
025966                 IF  PS-NO-ERROR                                          
025967                     MOVE PC-TSYMSG-00004                                 
025968                                   TO DP020-MSG-NUMBER                    
025969                     SET ASC-DEL-PENDING                                  
025970                         DP020-MSG-INFORMATIONAL                          
025971                                   TO TRUE                                
025972                 END-IF                                                   
025973             END-IF                                                       
025974     END-EVALUATE.                                                        
025975                                                                          
025976 1120-PREPARE-LIST-ENTRY.                                                 
025977                                                                          
025978     MOVE TR020-MAX-ITEMS          TO ASC-SEL-SUB.                        
025979     MOVE ZERO                     TO ASC-SEL-ITEM.                       
025980                                                                          
025981     PERFORM 2140-GET-NEXT-COUNTRY-CODE.                                  
025990*----------------------------------------------------------------*        
026000* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*        
026100* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*        
026200* EDITS.                                                         *        
026300*----------------------------------------------------------------*        
026400 2000-PROCESS-PANEL.                                                      
026500                                                                          
026600     EVALUATE TRUE                                                        
026700                                                                          
026800         WHEN DP020-SRC-AID = DP016-CLEAR                                 
026900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
027000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
027101                                                                          
027102         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                            
027103             IF  ASC-DEL-COMPLETE                                         
027104                 MOVE PC-TSYMSG-00116                                     
027105                                   TO DP020-MSG-NUMBER                    
027106                 SET DP020-MSG-FATAL                                      
027107                     PS-ERROR      TO TRUE                                
027108                 PERFORM 3200-RESET-ATTRIBUTES                            
027110             ELSE                                                         
027111                 SET DP030-CONTINUE-GO                                    
027112                                   TO TRUE                                
027113*                PERFORM 7100-DEL-COUNTRY-CODE                            
027114                 PERFORM 7000-DEL-COUNTRY-CODE                            
027115                 MOVE SPACE TO TR019-COUNTRY-CODE                         
027116             END-IF                                                       
027120                                                                          
027200         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                             
027300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
027310             IF ASC-COUNTRY-CODE = SPACES OR                              
027320                ASC-COUNTRY-CODE-DESC = SPACES                            
027400                SET PS-ERROR TO TRUE                                      
027410             END-IF                                                       
027500             PERFORM 3200-RESET-ATTRIBUTES                                
027600                                                                          
027700         WHEN OTHER                                                       
027800             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                         
027900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
028000             IF  PS-NO-ERROR                                              
028100                 PERFORM 2100-CHECK-FUNCTION-KEY                          
028200                 SET DP030-CONTINUE-GO TO TRUE                            
028300             ELSE                                                         
028400                 SET DP030-OVERRIDE-GO TO TRUE                            
028500             END-IF                                                       
028600     END-EVALUATE.                                                        
028700                                                                          
028800 EJECT                                                                    
028900******************************************************************        
029000** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **        
029100** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **        
029200** FROM THE CICS ARCHITECTURE API.                              **        
029300******************************************************************        
029400 2100-CHECK-FUNCTION-KEY.                                                 
029500     EVALUATE TRUE                                                        
029600         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                      
029601             IF CNTRY-STAT-CDE = PC-I                                     
029610                  PERFORM 6010-ADD-INACTIVE-COUNTRY                       
029620             ELSE                                                         
029700                  PERFORM 5000-ADD-COUNTRY-CODE                           
029710             END-IF                                                       
029800             SET ASC-ADD-COMPLETE  TO TRUE                                
029900*            THE COUNTRY CODE HAS BEEN ADDED                              
030000             MOVE PC-TSYMSG-00034  TO DP020-MSG-NUMBER                    
030100             SET DP020-MSG-INFORMATIONAL                                  
030200                                   TO TRUE                                
030300             PERFORM 2110-PREPARE-INTER-APPL-COMM                         
030310             PERFORM 3200-RESET-ATTRIBUTES                                
030400*            SET DP030-ERASE-UNPROT TO TRUE                               
030500                                                                          
030600         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)                      
030700             PERFORM 6000-UPDATE-COUNTRY                                  
030800             SET ASC-UPD-COMPLETE                                         
030900                 ASC-COUNTRY-DESC-NOT-CHANGED TO TRUE                     
031000*            THE COUNTRY CODE HAS BEEN UPDATED                            
031100             MOVE PC-TSYMSG-00059  TO DP020-MSG-NUMBER                    
031200             SET DP020-MSG-INFORMATIONAL                                  
031300                                   TO TRUE                                
031400             PERFORM 2110-PREPARE-INTER-APPL-COMM                         
031500*            SET DP030-ERASE-UNPROT TO TRUE                               
031600                                                                          
031700         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)                      
031800             PERFORM 7000-DEL-COUNTRY-CODE                                
031900             SET ASC-DEL-COMPLETE  TO TRUE                                
032000*            THE COUNTRY CODE HAS BEEN DELETED                            
032010             SET TR019-RECORD-UPDATED TO TRUE                             
032100             MOVE PC-TSYMSG-00115  TO DP020-MSG-NUMBER                    
032200             SET DP020-MSG-INFORMATIONAL                                  
032300                                   TO TRUE                                
032400             PERFORM 2110-PREPARE-INTER-APPL-COMM                         
032500*            SET DP030-ERASE-UNPROT TO TRUE                               
032600         WHEN DP020-SRC-AID = DP016-ENTER                                 
032700             CONTINUE                                                     
032900         WHEN OTHER                                                       
033000             SET DP013-NO-ROLLBACK                                        
033100                 DP013-XCTL-DISPLAY-RESTART                               
033200                 DP013-CICS-ABEND  TO TRUE                                
033300             MOVE '2100-CHECK-FUNCTION-KEY'                               
033400                                   TO DP013-PARAGRAPH                     
033500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'              
033600                                   TO DP013-MESSAGE-TEXT (1)              
033700             PERFORM DP013-0000-PROCESS-ABEND                             
033800     END-EVALUATE.                                                        
033900 EJECT                                                                    
034000******************************************************************        
034100** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **        
034200** INTER-APPLICATION COMMAREA.                                  **        
034300******************************************************************        
034400 2110-PREPARE-INTER-APPL-COMM.                                            
034410      MOVE ASC-COUNTRY-CODE TO TR019-COUNTRY-CODE.                        
034420*     MOVE ASC-COUNTRY-CODE-DESC TO TR019-COUNTRY-CODE-DESC.              
034500      MOVE CNTRY-STAT-CDE        TO TR019-STAT-CDE.                       
034511                                                                          
034512*-----------------------------------------------------------------*       
034513*     GET THE NEXT MESSAGE IF A LIST OF MESSAGES IS BEING         *       
034514*     PROCESSED.                                                  *       
034515*-----------------------------------------------------------------*       
034516                                                                          
034517  2140-GET-NEXT-COUNTRY-CODE.                                             
034518                                                                          
034519      ADD +1                       TO ASC-SEL-SUB.                        
034520      IF  ASC-SEL-SUB > TR020-MAX-ITEMS                                   
034521          ADD +1                   TO ASC-SEL-ITEM                        
034522          MOVE +1                  TO ASC-SEL-SUB                         
034523      END-IF.                                                             
034524      IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                       
034525          PERFORM 9100-READ-SEL-QUEUE                                     
034526          IF  TR020-ITEM (ASC-SEL-SUB) > ZERO                             
034527              MOVE TR020-COUNTRY-CODE   (ASC-SEL-SUB)                     
034528                                   TO ASC-COUNTRY-CODE                    
034530              SET TR020-INQ (ASC-SEL-SUB) TO TRUE                         
034531*             MOVE CNTRY-CNTRY-NM TO TR019-COUNTRY-CODE-DESC              
034532              MOVE CNTRY-CNTRY-NM TO TR019-COUNTRY-CODE                   
034533              PERFORM 9200-REWRITE-SEL-QUEUE                              
034534          ELSE                                                            
034535              SUBTRACT +1 FROM ASC-SEL-SUB                                
034536*            --- BOTTOM OF LIST ---                                     00
034537              MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER                    
034538              SET DP020-MSG-INFORMATIONAL TO TRUE                         
034539              SET PS-LIST-END             TO TRUE                         
034540          END-IF                                                          
034541      ELSE                                                                
034542          SUBTRACT +1 FROM ASC-SEL-ITEM                                   
034543          MOVE TR020-MAX-ITEMS     TO ASC-SEL-SUB                         
034544          MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER                    
034545          SET DP020-MSG-INFORMATIONAL TO TRUE                             
034546          SET PS-LIST-END             TO TRUE                             
034547      END-IF.                                                             
034548                                                                          
034549*-----------------------------------------------------------------*       
034550*     GET THE PREVIOUS MESSAGE IF A LIST OF MESSAGES IS BEING     *       
034551*     PROCESSED.                                                  *       
034552*-----------------------------------------------------------------*       
034553                                                                          
034554  2150-GET-PREV-COUNTRY-CODE.                                             
034555                                                                          
034556      SUBTRACT +1 FROM ASC-SEL-SUB.                                       
034557      IF  ASC-SEL-SUB < +1                                                
034558          SUBTRACT +1 FROM ASC-SEL-ITEM                                   
034559          MOVE TR020-MAX-ITEMS     TO ASC-SEL-SUB                         
034560      END-IF.                                                             
034561                                                                          
034562      IF  ASC-SEL-ITEM > ZERO                                             
034563          PERFORM 9100-READ-SEL-QUEUE                                     
034564          MOVE TR020-COUNTRY-CODE   (ASC-SEL-SUB)                         
034565                                   TO ASC-COUNTRY-CODE                    
034566      ELSE                                                                
034567          MOVE +1                  TO ASC-SEL-ITEM                        
034568                                      ASC-SEL-SUB                         
034569*        --- TOP OF LIST ---                                      04740000
034570          MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER                    
034571          SET DP020-MSG-INFORMATIONAL TO TRUE                             
034572          SET PS-LIST-END             TO TRUE                             
034573      END-IF.                                                             
034574                                                                          
034575/                                                                         
034576*----------------------------------------------------------------*        
034577*    GET THE COUNTRY CODE OF THE PREVIOUS SELECTED               *        
034578*    OBJECT FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.         *        
034580*----------------------------------------------------------------*        
034600*----------------------------------------------------------------*        
034700* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*        
034800* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *        
034900* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *        
035000*----------------------------------------------------------------*        
035100                                                                          
035200 2200-MOVE-SCREEN-TO-COMMAREA.                                            
035300     IF  ACNTCODL > ZERO                                                  
035400         MOVE ACNTCODI             TO ASC-COUNTRY-CODE                    
035500     ELSE                                                                 
035600         IF  ACNTCODF = DP015-ERASE-EOF                                   
035700             MOVE SPACE            TO ASC-COUNTRY-CODE                    
035800         END-IF                                                           
035900     END-IF.                                                              
036000                                                                          
036100     IF  ACNTDESL > ZERO                                                  
036200         MOVE ACNTDESI             TO ASC-COUNTRY-CODE-DESC               
036300         SET ASC-COUNTRY-DESC-CHANGED TO TRUE                             
036400     ELSE                                                                 
036500         IF  ACNTDESF = DP015-ERASE-EOF                                   
036600             MOVE SPACE            TO ASC-COUNTRY-CODE-DESC               
036700             SET ASC-COUNTRY-DESC-CHANGED TO TRUE                         
036800         END-IF                                                           
036900     END-IF.                                                              
037000                                                                          
037100                                                                          
037200*----------------------------------------------------------------*        
037300* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *        
037400* IS FOUND THE CURSOR IS POSITIONED AT THAT FIELD AND AN         *        
037500* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *        
037600*----------------------------------------------------------------*        
037700                                                                          
037800 3000-EDIT-DATA-IN-COMMAREA.                                              
037900     PERFORM 3200-RESET-ATTRIBUTES.                                       
037901     IF ASC-COUNTRY-CODE > SPACE                                          
037902         MOVE ASC-COUNTRY-CODE     TO DK-COUNTRY-CODE                     
037903         PERFORM 4100-SELECT-COUNTRY                                      
037904     ELSE                                                                 
037905         SET ASC-ADD-FROM-LIST TO TRUE                                    
037907     END-IF.                                                              
037908     EVALUATE TRUE                                                        
037909         WHEN ASC-UPD-COUNTRY                                             
037910         WHEN ASC-DEL-COUNTRY                                             
037920             MOVE ASC-COUNTRY-CODE     TO DK-COUNTRY-CODE                 
039600             MOVE ASC-COUNTRY-CODE-DESC    TO ACNTDESO                    
039601                 IF ASC-COUNTRY-CODE-DESC = SPACE                         
039610                      SET PS-ERROR                                        
039620                          DP020-MSG-FATAL   TO TRUE                       
039630*                    COUNTRY DESC = SPACES                                
039650                      MOVE PC-TSYMSG-00007                                
039660                          TO DP020-MSG-NUMBER                             
039670                      MOVE DP015-UNP-ALP-BRT-OFF                          
039680                                   TO ACNTCODA                            
039690                                      ACNTDESA                            
039691                     SET DP030-SET-CURSOR-APPL-1   TO TRUE                
039692                     MOVE -1       TO ACNTDESL                            
039693                  END-IF                                                  
039700         WHEN ASC-ADD-COUNTRY                                             
039810             IF CNTRY-STAT-CDE = PC-I                                     
039814                  MOVE CNTRY-CNTRY-NM  TO                                 
039815                        ASC-COUNTRY-CODE-DESC                             
039816                                         ACNTDESO                         
039817              ELSE                                                        
039840                   IF CNTRY-STAT-CDE = PC-A                               
039900                          SET PS-ERROR                                    
040000                              DP020-MSG-FATAL   TO TRUE                   
040100*                        COUNTRY CODE ALREADY EXISTS                      
040110                          MOVE CNTRY-CNTRY-NM   TO ACNTDESO               
040200                          MOVE PC-TSYMSG-00117                            
040201                              TO DP020-MSG-NUMBER                         
040202                          MOVE DP015-UNP-ALP-BRT-OFF                      
040203                                       TO ACNTCODA                        
040204                                          ACNTDESA                        
040205                     ELSE                                                 
040270                 IF ASC-COUNTRY-CODE = SPACE                              
040280                      SET PS-ERROR                                        
040290                          DP020-MSG-FATAL   TO TRUE                       
040300*                    COUNTRY CODE = SPACES                                
040400                      MOVE PC-TSYMSG-00007                                
040500                          TO DP020-MSG-NUMBER                             
040501                      SET DP020-MSG-WARNING                               
040510                                    TO TRUE                               
040600                      MOVE DP015-UNP-ALP-BRT-OFF                          
040700                                   TO ACNTCODA                            
040801                     SET DP030-SET-CURSOR-APPL-1   TO TRUE                
040802                     MOVE -1       TO ACNTCODL                            
040803                 ELSE                                                     
040804                     IF ASC-COUNTRY-CODE-DESC = SPACE                     
040805                          SET PS-ERROR                                    
040806                              DP020-MSG-FATAL   TO TRUE                   
040807*                        COUNTRY DESC = SPACES                            
040808                         MOVE DP015-GREEN                                 
040809                             TO ACNTCODC                                  
040810                         MOVE DP015-UNP-ALP-BRT-OFF                       
040811                                   TO ACNTCODA                            
040812                         MOVE DP015-UNDERLINE                             
040813                            TO ACNTCODH                                   
040814                         MOVE PC-TSYMSG-00007                             
040815                              TO DP020-MSG-NUMBER                         
040816                          MOVE DP015-UNP-ALP-BRT-OFF                      
040817                                                TO ACNTDESA               
040818                          MOVE DP015-GREEN      TO ACNTDESC               
040819*                         MOVE DP015-REVERSE    TO ACNTDESH               
040820                         SET DP030-SET-CURSOR-APPL-1   TO TRUE            
040821                         MOVE -1       TO ACNTDESL                        
040822                      END-IF                                              
040823                  END-IF                                                  
040824                   MOVE ASC-COUNTRY-CODE-DESC TO                          
040825                                          ACNTDESO                        
040830                     END-IF                                               
040840                END-IF                                                    
040910         WHEN ASC-UPD-COUNTRY                                             
040920         WHEN ASC-UPD-FROM-LIST                                           
040930             IF ASC-COUNTRY-DESC-CHANGED                                  
041200                 MOVE ASC-COUNTRY-CODE-DESC    TO ACNTDESO                
041300             ELSE                                                         
041400                 MOVE CNTRY-CNTRY-NM TO ASC-COUNTRY-CODE-DESC             
041500                                          ACNTDESO                        
041600             END-IF                                                       
041700         WHEN ASC-ADD-FROM-LIST                                           
041720             MOVE DP015-UNP-ALP-NOR-OFF    TO ACNTCODA                    
041721             MOVE DP015-UNP-ALP-NOR-OFF    TO ACNTDESA                    
041730             MOVE DP015-GREEN              TO ACNTCODC                    
041740             MOVE DP015-GREEN              TO ACNTDESC                    
041760             MOVE DP015-UNDERLINE          TO ACNTCODH                    
041770             MOVE DP015-UNDERLINE          TO ACNTDESH                    
041780             SET ASC-ADD-COUNTRY TO TRUE                                  
041790                 IF ASC-COUNTRY-CODE = SPACE                              
041792                      SET PS-ERROR                                        
041793                          DP020-MSG-INFORMATIONAL TO TRUE                 
041794*                    COUNTRY CODE = SPACES                                
041795                      MOVE PC-TSYMSG-00007                                
041796                          TO DP020-MSG-NUMBER                             
041797                      MOVE DP015-UNP-ALP-BRT-OFF                          
041798                                   TO ACNTCODA                            
041799                                      ACNTDESA                            
041800                     SET DP030-SET-CURSOR-APPL-1   TO TRUE                
041801                     MOVE -1       TO ACNTCODL                            
041802               ELSE                                                       
041803                 IF ASC-COUNTRY-CODE-DESC = SPACE                         
041804                      SET PS-ERROR                                        
041805                          DP020-MSG-FATAL   TO TRUE                       
041806*                    COUNTRY DESC = SPACES                                
041807                      MOVE PC-TSYMSG-00007                                
041808                          TO DP020-MSG-NUMBER                             
041809                      MOVE DP015-UNP-ALP-BRT-OFF                          
041810                                   TO ACNTCODA                            
041811                                      ACNTDESA                            
041812                     SET DP030-SET-CURSOR-APPL-1   TO TRUE                
041813                     MOVE -1       TO ACNTDESL                            
041815                  END-IF                                                  
041819                END-IF                                                    
041820     END-EVALUATE.                                                        
041900                                                                          
042000*                                                                         
042100 3200-RESET-ATTRIBUTES.                                                   
042200     EVALUATE TRUE                                                        
042300         WHEN ASC-ADD-COMPLETE                                            
042400             MOVE DP015-PRO-NOR-OFF        TO ACNTCODA                    
042410             MOVE DP015-BLUE               TO ACNTCODC                    
042500             MOVE DP015-PRO-NOR-OFF        TO ACNTDESA                    
042700             MOVE DP015-BLUE               TO ACNTDESC                    
042800             MOVE DP015-UNDERLINE          TO ACNTCODH                    
042901*                                             ACNTDESH                    
042902*            SET ASC-ADD-PENDING TO TRUE                                  
042903                                                                          
042910         WHEN ASC-ADD-COUNTRY                                             
042922             IF  PS-ERROR                                                 
042924                 MOVE DP015-GREEN              TO ACNTCODC                
042925                 MOVE DP015-GREEN              TO ACNTDESC                
042926                 MOVE DP015-UNDERLINE          TO ACNTCODH                
042927                 SET DP030-SET-CURSOR-APPL-1   TO TRUE                    
042928                 MOVE -1                       TO ACNTCODL                
042931              ELSE                                                        
042935                 MOVE DP015-PRO-NOR-OFF        TO ACNTCODA                
042936                 MOVE DP015-BLUE               TO ACNTCODC                
042940                 MOVE DP015-PRO-NOR-OFF        TO ACNTDESA                
042950                 MOVE DP015-BLUE               TO ACNTDESC                
042960                 MOVE DP015-UNDERLINE          TO ACNTCODH                
042970                                                  ACNTDESH                
042980              END-IF                                                      
043000         WHEN ASC-UPD-COUNTRY                                             
043100             MOVE DP015-PRO-NOR-OFF        TO ACNTCODA                    
043200             MOVE DP015-UNP-ALP-NOR-OFF    TO ACNTDESA                    
043300             MOVE DP015-BLUE               TO ACNTCODC                    
043400             MOVE DP015-GREEN              TO ACNTDESC                    
043500             MOVE DP015-HL-OFF             TO ACNTCODH                    
043600             MOVE DP015-UNDERLINE          TO ACNTDESH                    
043601             SET DP030-SET-CURSOR-APPL-1   TO TRUE                        
043610             MOVE -1                       TO ACNTDESL                    
043700         WHEN ASC-DEL-COUNTRY                                             
043710         WHEN ASC-DEL-FROM-LIST                                           
043800             MOVE DP015-PRO-NOR-OFF        TO ACNTCODA                    
043900                                              ACNTDESA                    
044000             MOVE DP015-BLUE               TO ACNTCODC                    
044100                                              ACNTDESC                    
044200             MOVE DP015-HL-OFF             TO ACNTCODH                    
044300                                              ACNTDESH                    
044310         WHEN ASC-ADD-COMPLETE                                            
044320             MOVE DP015-PRO-NOR-OFF        TO ACNTCODA                    
044330                                              ACNTDESA                    
044340             MOVE DP015-BLUE               TO ACNTCODC                    
044350                                              ACNTDESC                    
044360             MOVE DP015-HL-OFF             TO ACNTCODH                    
044370                                              ACNTDESH                    
044400     END-EVALUATE.                                                        
044500*----------------------------------------------------------------*        
044600* GET THE NEXT AVAILABLE MESSAGE NUMBER, MOVE IT TO THE SCREEN   *        
044700* AND POSITION THE CURSOR FOR THE INITIAL PANEL.                 *        
044800*----------------------------------------------------------------*        
044900                                                                          
045000 4000-BUILD-INITIAL-PANEL.                                                
045100                                                                          
045200*    IF ASC-UPD-COUNTRY OR                                                
045300*       ASC-DEL-COUNTRY                                                   
045400*        MOVE TR019-COUNTRY-CODE TO ASC-COUNTRY-CODE                      
045401     IF ASC-ADD-COUNTRY                                                   
045403         MOVE ASC-COUNTRY-CODE                                            
045404                                TO                                        
045405                                    DK-COUNTRY-CODE                       
045406                                    ACNTCODO                              
045407         MOVE ASC-COUNTRY-CODE-DESC   TO                                  
045408                                    ACNTDESO                              
045409         SET DP030-SET-CURSOR-APPL-1   TO TRUE                            
045410         MOVE -1                       TO ACNTCODL                        
045411*                                   ASC-COUNTRY-CODE-DESC                 
045412*                                   ACNTDESO                              
045413      ELSE                                                                
045414         IF PS-NO-ERROR                                                   
045420             MOVE ASC-COUNTRY-CODE TO                                     
045500                                    DK-COUNTRY-CODE                       
045600                                    ACNTCODO                              
045700             PERFORM 4100-SELECT-COUNTRY                                  
045800             MOVE CNTRY-CNTRY-NM     TO ASC-COUNTRY-CODE-DESC             
045900                                        ACNTDESO                          
045910             MOVE CNTRY-STAT-CDE     TO TR019-STAT-CDE                    
046000             SET DP030-SET-CURSOR-APPL-1   TO TRUE                        
046100             MOVE -1                       TO ACNTDESL                    
046200         END-IF                                                           
046600     END-IF.                                                              
046900                                                                          
047000*                                                                         
047100 4100-SELECT-COUNTRY.                                                     
047200                                                                          
047300     EXEC SQL                                                             
047400         SELECT A.CNTRY_NM                                                
047410               ,A.STAT_CDE                                                
047500            INTO :CNTRY-CNTRY-NM                                          
047510                ,:CNTRY-STAT-CDE                                          
047600             FROM TCNTRY A                                                
047700             WHERE A.CNTRY_CDE = :DK-COUNTRY-CODE                         
047800               AND A.STAT_CDE IN (:PC-A, :PC-I)                           
047900     END-EXEC                                                             
048000                                                                          
048100         EVALUATE TRUE                                                    
048200             WHEN SQLCODE = ZERO                                          
048300                 SET ASC-VALID-COUNTRY-CODE TO TRUE                       
048310                 IF (ASC-UPD-COUNTRY OR ASC-DEL-COUNTRY)                  
048320                     AND CNTRY-STAT-CDE = PC-I                            
048330                     SET ASC-INVALID-COUNTRY-CODE TO TRUE                 
048331                     MOVE SPACES TO ASC-COUNTRY-CODE-DESC                 
048340                  END-IF                                                  
048400             WHEN SQLCODE = +100                                          
048500                 SET ASC-INVALID-COUNTRY-CODE TO TRUE                     
048510*            WHEN SQLCODE = -811                                          
048520*                SET ASC-VALID-COUNTRY-CODE TO TRUE                       
048700             WHEN OTHER                                                   
048800                 MOVE '4100-SELECT-COUNTRY'                               
048900                                   TO DP013-PARAGRAPH                     
049000                 MOVE 'SQL ERROR SELECTING COUNTRY NAME'                  
049100                                   TO DP013-MESSAGE-TEXT (1)              
049200                 MOVE SQLCA        TO DP013-SQLCA                         
049300                 MOVE 'TCNTRY  '   TO DP013-DB2-TABLE-NAME (1)            
049400                 SET DP013-DB2-ABEND                                      
049500                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
049600                 PERFORM DP013-0000-PROCESS-ABEND                         
049700         END-EVALUATE.                                                    
049800                                                                          
047100 4200-SELECT-COUNTRY-DESC.                                                
047200                                                                          
047300     EXEC SQL                                                             
047400         SELECT A.CNTRY_NM                                                
047500            INTO :CNTRY-CNTRY-NM                                          
047600             FROM TCNTRY A                                                
047700             WHERE A.CNTRY_CDE = :DK-COUNTRY-CODE                         
047800               AND A.STAT_CDE IN (:PC-A, :PC-I)                           
047900     END-EXEC                                                             
048000                                                                          
048100         EVALUATE TRUE                                                    
048200             WHEN SQLCODE = ZERO                                          
048510*            WHEN SQLCODE = -811                                          
                       MOVE CNTRY-CNTRY-NM TO ASC-COUNTRY-CODE-DESC             
048400             WHEN SQLCODE = +100                                          
048520                 MOVE SPACES TO ASC-COUNTRY-CODE-DESC                     
048700             WHEN OTHER                                                   
048800                 MOVE '4200-SELECT-COUNTRY-DESC'                          
048900                                   TO DP013-PARAGRAPH                     
049000                 MOVE 'SQL ERROR SELECTING COUNTRY NAME'                  
049100                                   TO DP013-MESSAGE-TEXT (1)              
049200                 MOVE SQLCA        TO DP013-SQLCA                         
049300                 MOVE 'TCNTRY  '   TO DP013-DB2-TABLE-NAME (1)            
049400                 SET DP013-DB2-ABEND                                      
049500                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
049600                 PERFORM DP013-0000-PROCESS-ABEND                         
049700         END-EVALUATE.                                                    
049800                                                                          
049900 EJECT                                                                    
050000*----------------------------------------------------------------*        
050100*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *        
050200*----------------------------------------------------------------*        
050300                                                                          
050400 4400-MOVE-COMMAREA-TO-SCREEN.                                            
050500     MOVE ASC-COUNTRY-CODE         TO ACNTCODO.                           
050600     MOVE ASC-COUNTRY-CODE-DESC    TO ACNTDESO.                           
050700                                                                          
050800 EJECT                                                                    
050900*----------------------------------------------------------------*        
051000* CREATE THE COUNTRY CODE OBJECT ON THE TCNTRY TABLE.            *        
051100*----------------------------------------------------------------*        
051200 5000-ADD-COUNTRY-CODE.                                                   
051300     MOVE ASC-COUNTRY-CODE         TO CNTRY-CNTRY-CDE                     
051310                                      TR019-COUNTRY-CODE.                 
051400     MOVE ASC-COUNTRY-CODE-DESC    TO CNTRY-CNTRY-NM.                     
051500     MOVE 'A'                      TO CNTRY-STAT-CDE.                     
051600     MOVE DP020-USERID             TO CNTRY-LAST-UPD-USR-ID.              
051700     PERFORM 5100-INSERT-COUNTRY-CODE.                                    
051701*    MOVE DP015-BLUE               TO ACNTCODC                            
051702*                                     ACNTDESC.                           
051703*    MOVE DP015-PRO-NOR-OFF        TO ACNTCODA                            
051704*                                     ACNTDESA.                           
051710     IF  ASC-USE-SEL-QUEUE                                                
051720         PERFORM 5200-UPDATE-SELECTION-QUEUE                              
051730     END-IF.                                                              
051800*----------------------------------------------------------------*        
051900* INSERT A ROW INTO THE TCNTRY TABLE.                            *        
052000*----------------------------------------------------------------*        
052100 5100-INSERT-COUNTRY-CODE.                                                
052200     EXEC SQL                                                             
052300         INSERT INTO TCNTRY                                               
052400            (CNTRY_CDE,                                                   
052500             CNTRY_NM,                                                    
052600             STAT_CDE,                                                    
052700             LAST_UPD_TMST,                                               
052800             LAST_UPD_USR_ID)                                             
052900         VALUES                                                           
053000            (:CNTRY-CNTRY-CDE,                                            
053100             :CNTRY-CNTRY-NM,                                             
053200             :CNTRY-STAT-CDE,                                             
053300              CURRENT TIMESTAMP,                                          
053400             :CNTRY-LAST-UPD-USR-ID)                                      
053500     END-EXEC.                                                            
053600                                                                          
053700     EVALUATE TRUE                                                        
053800         WHEN SQLCODE = ZERO                                              
053900             CONTINUE                                                     
054000         WHEN SQLCODE = -803                                              
054010             PERFORM 6010-ADD-INACTIVE-COUNTRY                            
054200         WHEN SQLWARN0 NOT = SPACES                                       
054300         WHEN SQLCODE < ZERO                                              
054400         WHEN SQLCODE > ZERO                                              
054500             MOVE '5100-INSERT-COUNTRY-CODE'                              
054600                               TO DP013-PARAGRAPH                         
054700             MOVE 'INSERT A ROW INTO THE COUNTRY CODE TABLE'              
054800                               TO DP013-MESSAGE-TEXT(1)                   
054900             MOVE SQLCA        TO DP013-SQLCA                             
055000             MOVE 'TCNTRY'     TO DP013-DB2-TABLE-NAME (1)                
055100             SET DP013-DB2-ABEND                                          
055200                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
055300             PERFORM DP013-0000-PROCESS-ABEND                             
055400     END-EVALUATE.                                                        
055500 EJECT                                                                    
055501                                                                          
055502 5200-UPDATE-SELECTION-QUEUE.                                             
055503                                                                          
055504     PERFORM 9100-READ-SEL-QUEUE.                                         
055505                                                                          
055507     IF  ASC-DEL-COMPLETE                                                 
055508         SET TR020-DEL (ASC-SEL-SUB) TO TRUE                              
055509         SET TR019-RECORD-UPDATED TO TRUE                                 
055510*        MOVE CNTRY-CNTRY-NM TO TR019-COUNTRY-CODE-DESC                   
055511         MOVE CNTRY-CNTRY-NM TO TR019-COUNTRY-CODE                        
055512         MOVE 'A'            TO TR019-STAT-CDE                            
055513     ELSE                                                                 
055514         SET TR020-UPD (ASC-SEL-SUB) TO TRUE                              
055515*        MOVE CNTRY-CNTRY-NM TO TR019-COUNTRY-CODE-DESC                   
055516         MOVE CNTRY-CNTRY-NM TO TR019-COUNTRY-CODE                        
055517     END-IF.                                                              
055518                                                                          
055520     PERFORM 9200-REWRITE-SEL-QUEUE.                                      
055600                                                                          
055700 6000-UPDATE-COUNTRY.                                                     
055800                                                                          
055900     MOVE ASC-COUNTRY-CODE         TO CNTRY-CNTRY-CDE.                    
056000     MOVE ASC-COUNTRY-CODE-DESC    TO CNTRY-CNTRY-NM.                     
056010     MOVE 'A'                      TO CNTRY-STAT-CDE.                     
056100     MOVE 'A'                      TO DK-STAT-CODE.                       
056200     MOVE DP020-USERID             TO CNTRY-LAST-UPD-USR-ID.              
056300     PERFORM 6100-UPDATE-COUNTRY-CODE.                                    
056301     IF  ASC-USE-SEL-QUEUE                                                
056302         PERFORM 5200-UPDATE-SELECTION-QUEUE                              
056303     END-IF.                                                              
056304                                                                          
056310 6010-ADD-INACTIVE-COUNTRY.                                               
056320                                                                          
056330     MOVE ASC-COUNTRY-CODE         TO CNTRY-CNTRY-CDE.                    
056340     MOVE ASC-COUNTRY-CODE-DESC    TO CNTRY-CNTRY-NM.                     
056341     MOVE 'I'                      TO DK-STAT-CODE.                       
056350     MOVE 'A'                      TO CNTRY-STAT-CDE.                     
056360     MOVE DP020-USERID             TO CNTRY-LAST-UPD-USR-ID.              
056370     PERFORM 6100-UPDATE-COUNTRY-CODE.                                    
056372     IF ASC-COUNTRY-CODE-DESC = SPACE                                     
056373         MOVE CNTRY-CNTRY-NM TO                                           
056374             ASC-COUNTRY-CODE-DESC                                        
056375             ACNTDESO                                                     
056376     END-IF.                                                              
056377     MOVE DP015-BLUE               TO ACNTCODC                            
056378                                      ACNTDESC.                           
056379     MOVE DP015-PRO-NOR-OFF        TO ACNTCODA                            
056380                                      ACNTDESA.                           
056383     IF  ASC-USE-SEL-QUEUE                                                
056390         PERFORM 5200-UPDATE-SELECTION-QUEUE                              
056391     END-IF.                                                              
056400                                                                          
056500*----------------------------------------------------------------*        
056600* UPDATE A ROW IN THE TCNTRY TABLE.                              *        
056700*----------------------------------------------------------------*        
056800 6100-UPDATE-COUNTRY-CODE.                                                
056900     EXEC SQL                                                             
057000       UPDATE TCNTRY                                                      
057100         SET  CNTRY_NM     = :CNTRY-CNTRY-NM                              
057200            , STAT_CDE     = :CNTRY-STAT-CDE                              
057300            , LAST_UPD_TMST = CURRENT TIMESTAMP                           
057400            , LAST_UPD_USR_ID = :CNTRY-LAST-UPD-USR-ID                    
057500       WHERE  CNTRY_CDE     = :CNTRY-CNTRY-CDE                            
057510         AND  STAT_CDE      =  :DK-STAT-CODE                              
057600     END-EXEC.                                                            
057700                                                                          
057800     EVALUATE TRUE                                                        
057900         WHEN SQLCODE = ZERO                                              
058000             CONTINUE                                                     
058100         WHEN SQLWARN0 NOT = SPACES                                       
058200         WHEN SQLCODE < ZERO                                              
058300         WHEN SQLCODE > ZERO                                              
058400             MOVE '6100-UPDATE-COUNTRY-CODE'                              
058500                               TO DP013-PARAGRAPH                         
058600             MOVE 'UPDATE A ROW INTO THE COUNTRY CODE TABLE'              
058700                               TO DP013-MESSAGE-TEXT(1)                   
058800             MOVE SQLCA        TO DP013-SQLCA                             
058900             MOVE 'TCNTRY'     TO DP013-DB2-TABLE-NAME (1)                
059000             SET DP013-DB2-ABEND                                          
059100                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
059200             PERFORM DP013-0000-PROCESS-ABEND                             
059300     END-EVALUATE.                                                        
059400 7000-DEL-COUNTRY-CODE.                                                   
059500     MOVE ASC-COUNTRY-CODE         TO CNTRY-CNTRY-CDE.                    
059600     MOVE 'I'                      TO CNTRY-STAT-CDE.                     
059700     MOVE DP020-USERID             TO CNTRY-LAST-UPD-USR-ID.              
059800     PERFORM 7100-DEL-COUNTRY-CODE.                                       
059801                                                                          
059802     MOVE PC-TSYMSG-00115          TO DP020-MSG-NUMBER.                   
059803     SET DP020-MSG-INFORMATIONAL                                          
059804         ASC-DEL-COMPLETE          TO TRUE.                               
059805         SET TR019-RECORD-UPDATED TO TRUE                                 
059806                                                                          
059807     IF  ASC-USE-SEL-QUEUE                                                
059808         PERFORM 5200-UPDATE-SELECTION-QUEUE                              
059809     END-IF.                                                              
059810                                                                          
059900                                                                          
060000*----------------------------------------------------------------*        
060100* DELETE A ROW IN THE TCNTRY TABLE.                              *        
060200*----------------------------------------------------------------*        
060300 7100-DEL-COUNTRY-CODE.                                                   
060400     EXEC SQL                                                             
060500       UPDATE TCNTRY                                                      
060600         SET  STAT_CDE     = :CNTRY-STAT-CDE                              
060700            , LAST_UPD_TMST = CURRENT TIMESTAMP                           
060800            , LAST_UPD_USR_ID = :CNTRY-LAST-UPD-USR-ID                    
060900       WHERE  CNTRY_CDE     = :CNTRY-CNTRY-CDE                            
061000     END-EXEC.                                                            
061100                                                                          
061200     EVALUATE TRUE                                                        
061300         WHEN SQLCODE = ZERO                                              
061400             CONTINUE                                                     
061500         WHEN SQLWARN0 NOT = SPACES                                       
061600         WHEN SQLCODE < ZERO                                              
061700         WHEN SQLCODE > ZERO                                              
061800             MOVE '7100-DEL-COUNTRY-CODE'                                 
061900                               TO DP013-PARAGRAPH                         
062000             MOVE 'UPDATE A ROW INTO THE COUNTRY CODE TABLE'              
062100                               TO DP013-MESSAGE-TEXT(1)                   
062200             MOVE SQLCA        TO DP013-SQLCA                             
062300             MOVE 'TCNTRY'     TO DP013-DB2-TABLE-NAME (1)                
062400             SET DP013-DB2-ABEND                                          
062500                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
062600             PERFORM DP013-0000-PROCESS-ABEND                             
062700     END-EVALUATE.                                                        
062800 EJECT                                                                    
062801/                                                                         
062802*----------------------------------------------------------------*        
062803*    READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE     *        
062804*----------------------------------------------------------------*        
062805                                                                          
062806 9100-READ-SEL-QUEUE.                                                     
062807                                                                          
062808     EXEC CICS                                                            
062809         READQ TS                                                         
062810             QUEUE (ASC-SEL-QUEUE-NAME)                                   
062811             INTO  ( TR020-COUNTRY-SEL-REC )                              
062812             ITEM  (ASC-SEL-ITEM)                                         
062813             RESP  (PV-CICS-RESPONSE)                                     
062814     END-EXEC.                                                            
062815                                                                          
062816     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)                               
062817         CONTINUE                                                         
062818     ELSE                                                                 
062819         SET DP013-LOGIC-ABEND                                            
062820             DP013-NO-ROLLBACK     TO TRUE                                
062821         MOVE '9100-READ-SEL-QUEUE'                                       
062822                                   TO DP013-PARAGRAPH                     
062823         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'           
062824                                   TO DP013-MESSAGE-TEXT (1)              
062825         MOVE ASC-SEL-TASK         TO PV-DISPLAY-TASK                     
062826         STRING 'QUEUE ID: '                                              
062827                ASC-SEL-TERM-ID                                           
062828                ' '                                                       
062829                PV-DISPLAY-TASK                                           
062830                ' '                                                       
062831                ASC-SEL-SEQ DELIMITED BY SIZE                             
062832                               INTO DP013-MESSAGE-TEXT (2)                
062833         PERFORM DP013-0000-PROCESS-ABEND                                 
062834     END-IF.                                                              
062835                                                                          
062836/                                                                         
062837*----------------------------------------------------------------*        
062838*    UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE     *        
062839*----------------------------------------------------------------*        
062840 9200-REWRITE-SEL-QUEUE.                                                  
062841                                                                          
062842     EXEC CICS                                                            
062843          WRITEQ TS                                                       
062844              QUEUE  (ASC-SEL-QUEUE-NAME)                                 
062845              FROM   (TR020-COUNTRY-SEL-REC)                              
062846              ITEM   (ASC-SEL-ITEM)                                       
062847              RESP   (PV-CICS-RESPONSE)                                   
062848              REWRITE                                                     
062849     END-EXEC.                                                            
062850                                                                          
062851     IF  PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                           
062852         SET DP013-CICS-ABEND                                             
062853             DP013-NO-ROLLBACK     TO TRUE                                
062854         MOVE '9200-REWRITE-SEL-QUEUE'                                    
062855                                   TO DP013-PARAGRAPH                     
062856         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'           
062857                                   TO DP013-MESSAGE-TEXT (1)              
062858         PERFORM DP013-0000-PROCESS-ABEND                                 
062859     END-IF.                                                              
062860                                                                          
062900*----------------------------------------------------------------*        
063000*    ABEND PROCESSOR MODULE                                      *        
063100*----------------------------------------------------------------*        
063200                                                                          
063300     COPY DPPD013.                                                        
063400                                                                          
063500*----------------------------------------------------------------*        
063600*    LINK TO CICS OBJECT LOCKING MODULE                          *        
063700*----------------------------------------------------------------*        
063800                                                                          
063900     COPY DPPD044.                                                        
