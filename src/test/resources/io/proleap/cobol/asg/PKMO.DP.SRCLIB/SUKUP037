000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400*                                                                 00040000
000500 PROGRAM-ID.             SUKUP037.                                00050000
000600 AUTHOR.                 DENISE HAHN.                             00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN.           MARCH 2020.                              00080000
000900 DATE-COMPILED.                                                   00090000
001000*                                                                 00100000
001100***************************************************************** 00110000
001200* THIS PROGRAM WILL BE USED TO DELETE ROWS FROM THE OUTBOUND      00120000
001300* CARTON PACKED UPC (SUT_OTBND_PKD_UPC).                          00130000
001400***************************************************************** 00140000
001500 ENVIRONMENT DIVISION.                                            00150000
001600***************************************************************** 00160000
001700 CONFIGURATION SECTION.                                           00170000
001800 SOURCE-COMPUTER.                        IBM-3090.                00180000
001900 OBJECT-COMPUTER.                        IBM-3090.                00190000
002000 INPUT-OUTPUT SECTION.                                            00200000
002100 FILE-CONTROL.                                                    00210000
002200                                                                  00220000
002300     SELECT EXTRACT-FILE                                          00230000
002400         ASSIGN TO INP01.                                         00240000
002500/                                                                 00250000
002600***************************************************************** 00260000
002700 DATA DIVISION.                                                   00270000
002800***************************************************************** 00280000
002900 FILE SECTION.                                                    00290000
003000                                                                  00300000
003100 FD  EXTRACT-FILE                                                 00310000
003200     RECORDING MODE IS F                                          00320000
003300     LABEL RECORDS ARE STANDARD                                   00330000
003400     BLOCK CONTAINS 0 RECORDS.                                    00340000
003500 01  EXTRACT-RECORD                   PIC X(100).                 00350000
003600/                                                                 00360000
003700***************************************************************** 00370000
003800 WORKING-STORAGE SECTION.                                         00380000
003900***************************************************************** 00390000
004000                                                                  00400000
004100 01  PS-SWITCHES.                                                 00410000
004200     05  PS-END-OF-INPUT-FILE-SW      PIC X(01) VALUE 'N'.        00420000
004300         88  PS-END-OF-INPUT                    VALUE 'Y'.        00430000
004400         88  PS-NOT-END-OF-INPUT                VALUE 'N'.        00440000
004500                                                                  00450000
004600 01  PV-VARIABLES.                                                00460000
004700     05  PV-COUNT                     PIC  9(09) VALUE ZERO.      00470000
004800     05  PV-COMMIT-CNT                PIC  9(09) VALUE ZERO.      00480000
004900     05  PV-READ-CNT                  PIC  9(09) VALUE ZERO.      00490000
005000     05  PV-OTBND-DELETE-CNT          PIC  9(09) VALUE ZERO.      00500000
005100     05  PV-OTBND-NOT-FND-CNT         PIC  9(09) VALUE ZERO.      00510000
005200     05  PV-DISPLAY-CNT               PIC  ZZZ,ZZZ,ZZ9.           00520000
005310     05  PV-DISP-SML                  PIC  9(18) VALUE ZERO.      00531001
005320     05  PV-DISP-PO                   PIC  9(09) VALUE ZERO.      00532001
005330     05  PV-DISP-RCVR                 PIC  9(04) VALUE ZERO.      00533001
005400                                                                  00540000
005500******************************************************************00550000
005600 01  PV-ABEND-FIELDS.                                             00560000
005700     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         00570000
005800                                                 COMP SYNC.       00580000
005900     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'SUKUP037'.00590000
006000     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00600000
006100     05  PV-ABEND-OPERATION           PIC  X(51) VALUE SPACES.    00610000
006200     05  PV-ABEND-STRUCTURE-1         PIC  X(08) VALUE SPACES.    00620000
006300     05  PV-ABEND-STRUCTURE-2         PIC  X(08) VALUE SPACES.    00630000
006400     05  PV-ABEND-STRUCTURE-3         PIC  X(08) VALUE SPACES.    00640000
006500     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    00650000
006600     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    00660000
006700     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    00670000
006800     05  PV-DB2-FUNCTION              PIC  X(50) VALUE SPACES.    00680000
006900/                                                                 00690000
007000 01  PC-CONSTANTS.                                                00700000
007100     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'SUKUP037'. 00710000
007200     05  PC-COMMIT-HOLD               PIC 9(3)  VALUE 100.        00720000
007300     05  PC-COUNT-HOLD                PIC 9(9)  VALUE 100000.     00730000
007400                                                                  00740000
007500******************************************************************00750000
007600*  LAYOUT FOR EXTRACT FILE                                        00760000
007700******************************************************************00770000
007800     COPY SURD169.                                                00780000
007900*                                                                 00790000
008000******************************************************************00800000
008100*  DB2 FORMATTED MESSAGE AREA                                     00810000
008200******************************************************************00820000
008300     COPY DPWS004.                                                00830000
008400                                                                  00840000
008500******************************************************************00850000
008600*   DB2 SQL COMMUNICATION AREA                                    00860000
008700******************************************************************00870000
008800     EXEC SQL                                                     00880000
008900         INCLUDE SQLCA                                            00890000
009000     END-EXEC.                                                    00900000
009100*                                                                 00910000
009200     COPY SQLCA2.                                                 00920000
009300*                                                                 00930000
009400******************************************************************00940000
009500*   SU-OUTBOUND CARTON PACKED UPC - SUT_OTBND_PKD_UPC             00950000
009600******************************************************************00960000
009700*                                                                 00970000
009800     EXEC SQL                                                     00980000
009900         INCLUDE SUT00025                                         00990000
010000     END-EXEC.                                                    01000000
010100*                                                                 01010000
010200******************************************************************01020000
010300 PROCEDURE DIVISION.                                              01030000
010400******************************************************************01040000
010500 0000-MAINLINE.                                                   01050000
010600                                                                  01060000
010700     PERFORM 1000-INITIALIZE.                                     01070000
010800                                                                  01080000
010900     PERFORM 2000-PROCESS-EXTRACT                                 01090000
011000         UNTIL PS-END-OF-INPUT.                                   01100000
011100                                                                  01110000
011200     PERFORM 9000-EOJ.                                            01120000
011300                                                                  01130000
011400      GOBACK.                                                     01140000
011500                                                                  01150000
011600******************************************************************01160000
011700*  INITIALIZATION TASKS.                                          01170000
011800*    -- OPEN INPUT FILE                                           01180000
011900*    -- READ FILE                                                 01190000
012000******************************************************************01200000
012100 1000-INITIALIZE.                                                 01210000
012200                                                                  01220000
012300     OPEN INPUT  EXTRACT-FILE.                                    01230000
012400                                                                  01240000
012500     PERFORM 2100-READ-EXTRACT.                                   01250000
012600/                                                                 01260000
012700******************************************************************01270000
012800 2000-PROCESS-EXTRACT.                                            01280000
012900******************************************************************01290000
013000*                                                                 01300000
013100     IF  PV-COUNT  <  PC-COUNT-HOLD                               01310000
013200         CONTINUE                                                 01320000
013300     ELSE                                                         01330000
013400         MOVE PV-READ-CNT  TO  PV-DISPLAY-CNT                     01340000
013500         DISPLAY 'READ:  '     PV-DISPLAY-CNT                     01350000
013600         MOVE  ZEROES  TO      PV-COUNT                           01360000
013700     END-IF.                                                      01370000
013800                                                                  01380000
013900     PERFORM 8100-DELETE-PKD-UPC.                                 01390000
014000     ADD +1 TO PV-COMMIT-CNT                                      01400000
014100                                                                  01410000
014200     IF PV-COMMIT-CNT > PC-COMMIT-HOLD                            01420000
014300         PERFORM 2200-COMMIT-DELETE                               01430000
014400     END-IF.                                                      01440000
014500                                                                  01450000
014600     PERFORM 2100-READ-EXTRACT.                                   01460000
014700                                                                  01470000
014800                                                                  01480000
014900*                                                                 01490000
015000******************************************************************01500000
015100*  READ NEXT INPUT FILE RECORD.                                   01510000
015200******************************************************************01520000
015300 2100-READ-EXTRACT.                                               01530000
015400                                                                  01540000
015500     READ EXTRACT-FILE INTO SU169-EXTRACT-RECORD                  01550000
015600        AT END                                                    01560000
015700           SET PS-END-OF-INPUT TO TRUE                            01570000
015800        NOT AT END                                                01580000
015900           ADD +1                   TO PV-READ-CNT                01590000
016000                                       PV-COUNT                   01600000
016100     END-READ.                                                    01610000
016200*                                                                 01620000
016300******************************************************************01630000
016400* COMMIT THE DELETE FROM ERROR TABLE                              01640000
016500******************************************************************01650000
016600 2200-COMMIT-DELETE.                                              01660000
016700                                                                  01670000
016800      EXEC SQL                                                    01680000
016900         COMMIT                                                   01690000
017000      END-EXEC                                                    01700000
017100                                                                  01710000
017200      MOVE +0 TO PV-COMMIT-CNT.                                   01720000
017300                                                                  01730000
017400******************************************************************01740000
017500* DELETE THE OUTBOUND DATABASE                                    01750000
017600******************************************************************01760000
017700 8100-DELETE-PKD-UPC.                                             01770000
017800                                                                  01780000
017900     EXEC SQL                                                     01790000
018000          DELETE                                                  01800000
018100            FROM  SUT_OTBND_PKD_UPC                               01810000
018200           WHERE SHIPT_UNT_ID  = :SU169-SHIPT-UNT-ID              01820000
018300             AND TRN_NBR       = :SU169-TRN-NBR                   01830000
018400             AND RCVR_SEQ_NBR  = :SU169-RCVR-SEQ-NBR              01840000
018500             AND TRN_LNE_NBR   = :SU169-TRN-LNE-NBR               01850000
018600             AND TRN_TYP_CDE   = :SU169-TRN-TYP-CDE               01860000
018700             AND UPC_NBR       = :SU169-UPC-NBR                   01870000
018800             AND PKD_BY_USR_ID = :SU169-PKD-BY-USR-ID             01880000
018900             AND PKD_TMST      = :SU169-PKD-TMST                  01890000
019000     END-EXEC.                                                    01900000
019100                                                                  01910000
019200     EVALUATE TRUE                                                01920000
019300         WHEN SQLCODE = 0                                         01930000
019400             ADD +1           TO PV-OTBND-DELETE-CNT              01940000
019500         WHEN SQLCODE = +100                                      01950000
019600             ADD +1           TO PV-OTBND-NOT-FND-CNT             01960000
019700         WHEN SQLCODE < 0                                         01970000
019800         WHEN SQLCODE > 0                                         01980000
019900         WHEN SQLWARN0 = 'W'                                      01990000
020000             MOVE '8100-DELETE-PKD-UPC  '                         02000000
020100                         TO PV-ABEND-PARAGRAPH                    02010000
020200             MOVE 'DELETE OF SUT_OTBND_CART '                     02020000
020300                         TO PV-DB2-FUNCTION                       02030000
020400             PERFORM 9200-SQL-ABEND                               02040000
020500     END-EVALUATE.                                                02050000
020600                                                                  02060000
020700******************************************************************02070000
020800*CLOSE INPUT FILE.                                                02080000
020900******************************************************************02090000
021000 9000-EOJ.                                                        02100000
021100*                                                                 02110000
021200     CLOSE EXTRACT-FILE.                                          02120000
021300                                                                  02130000
021400     MOVE PV-READ-CNT           TO PV-DISPLAY-CNT.                02140000
021500     DISPLAY 'READ:              ' PV-DISPLAY-CNT.                02150000
021600                                                                  02160000
021700     MOVE PV-OTBND-DELETE-CNT   TO PV-DISPLAY-CNT.                02170000
021800     DISPLAY 'OTBND-CART DELETE: ' PV-DISPLAY-CNT.                02180000
021900                                                                  02190000
022000     MOVE PV-OTBND-NOT-FND-CNT  TO PV-DISPLAY-CNT.                02200000
022100     DISPLAY 'OTBND-CART NOT FD: ' PV-DISPLAY-CNT.                02210000
022200                                                                  02220000
022500                                                                  02250000
022600******************************************************************02260000
022700 9200-SQL-ABEND.                                                  02270000
022800******************************************************************02280000
022900                                                                  02290000
023000     MOVE SQLCODE                     TO SQLCODE2.                02300000
023100     MOVE SQLERRD(3)                  TO SQLERRD3.                02310000
023200                                                                  02320000
023210     MOVE SU169-SHIPT-UNT-ID          TO PV-DISP-SML.             02321001
023220     MOVE SU169-TRN-NBR               TO PV-DISP-PO.              02322001
023221     MOVE SU169-RCVR-SEQ-NBR          TO PV-DISP-RCVR.            02322101
023230                                                                  02323001
023300     DISPLAY '** ABEND **         ** = SQLERROR'.                 02330000
023400     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        02340000
023500     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             02350000
023600     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                02360000
023700     DISPLAY '*** SML         = ' PV-DISP-SML.                    02370001
023800     DISPLAY '*** RCVR        = ' PV-DISP-PO                      02380001
023900             '-'                  PV-DISP-RCVR.                   02390001
024000                                                                  02400000
024100     DISPLAY '** SQLCODE          ** = ' SQLCODE2.                02410000
024200     DISPLAY '** ROWS PROCESSED   ** = ' SQLERRD3.                02420000
024300     DISPLAY '** SQLERRM          ** = ' SQLERRM.                 02430000
024400     DISPLAY '** SQLERRMC         ** = ' SQLERRMC.                02440000
024500                                                                  02450000
024600                                                                  02460000
024700     MOVE +4013                       TO PV-ABEND-CODE.           02470000
024800     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02480000
024900                                                                  02490000
