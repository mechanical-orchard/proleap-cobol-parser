000100******************************************************************00010018
000200 IDENTIFICATION DIVISION.                                         00020018
000300******************************************************************00030018
000400                                                                  00040018
000500 PROGRAM-ID.    RCKUT033.                                         00050018
000600 AUTHOR.        MARY SARDINA.                                     00060018
000700 INSTALLATION.  KOHLS.                                            00070018
000800 DATE-WRITTEN   JANUARY, 1996.                                    00080018
000900 DATE-COMPILED.                                                   00090018
001000                                                                  00100018
001100******************************************************************00110018
001200*  THIS PROGRAM CREATES AN EXTRACT FILE OF DATA FORM THE RECEIPT  00120018
001300*  ITEM AUDIT TABLE.  IT ALSO CREATES A TIMESTAMP CONTROL FILE.   00130018
001400******************************************************************00140018
001500                                                                  00150018
001600******************************************************************00160018
001700 ENVIRONMENT DIVISION.                                            00170018
001800******************************************************************00180018
001900                                                                  00190018
002000 CONFIGURATION SECTION.                                           00200018
002100                                                                  00210018
002200 SOURCE-COMPUTER.        IBM-3090.                                00220018
002300 OBJECT-COMPUTER.        IBM-3090.                                00230018
002400                                                                  00240018
002500 INPUT-OUTPUT SECTION.                                            00250018
002600                                                                  00260018
002700 FILE-CONTROL.                                                    00270018
002800                                                                  00280018
002900                                                                  00290018
003000     SELECT TIMESTAMP-FILE                                        00300018
003100         ASSIGN TO IN01.                                          00310018
003200                                                                  00320018
003300     SELECT RECEIPT-ITEM-AUDIT-FILE                               00330018
003400         ASSIGN TO OUT02.                                         00340018
003500******************************************************************00350018
003600 DATA DIVISION.                                                   00360018
003700******************************************************************00370018
003800                                                                  00380018
003900 FILE SECTION.                                                    00390018
004000                                                                  00400018
004100 FD  TIMESTAMP-FILE                                               00410018
004200     RECORDING MODE IS F                                          00420018
004300     LABEL RECORDS ARE STANDARD                                   00430018
004400     BLOCK CONTAINS 0 RECORDS.                                    00440018
004500                                                                  00450018
004600 01  TIMESTAMP-RECORD           PIC  X(50).                       00460018
004700                                                                  00470018
004800 FD  RECEIPT-ITEM-AUDIT-FILE                                      00480018
004900     RECORDING MODE IS F                                          00490018
005000     LABEL RECORDS ARE STANDARD                                   00500018
005100     BLOCK CONTAINS 0 RECORDS.                                    00510018
005200                                                                  00520018
005300 01  RECEIPT-ITEM-AUDIT-RECORD  PIC  X(450).                      00530018
005400*                                                                 00540018
005500*                                                                 00550018
005600******************************************************************00560018
005700 WORKING-STORAGE SECTION.                                         00570018
005800******************************************************************00580018
005900*                                                                 00590018
006000*                                                                 00600018
006100*                                                                 00610018
006200*                                                                 00620018
006300******************************************************************00630018
006400*  RECORD LAYOUT FOR THE TIMESTAMP FILE.                          00640018
006500******************************************************************00650018
006600     COPY RCRD011.                                                00660018
006700*                                                                 00670018
006800*                                                                 00680018
006900******************************************************************00690018
007000*  RECORD LAYOUT FOR THE RECEIPT ITEM  TABLE.                     00700018
007100******************************************************************00710018
007200     COPY RCRD013.                                                00720018
007300*                                                                 00730018
007400*                                                                 00740018
007500******************************************************************00750018
007600*  DB2 FORMATTED MESSAGE AREA                                     00760018
007700******************************************************************00770018
007800     COPY DPWS004.                                                00780018
007900*                                                                 00790018
008000*                                                                 00800018
008100*                                                                 00810018
008200******************************************************************00820018
008300*  COMMUNICATIONS AREA FOR DB2                                    00830018
008400******************************************************************00840018
008500     EXEC SQL                                                     00850018
008600          INCLUDE SQLCA                                           00860018
008700     END-EXEC.                                                    00870018
008800*                                                                 00880018
008900*                                                                 00890018
009000******************************************************************00900018
009100*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE RECEIPT ITEM AUDIT 00910018
009200*  TABLE                                                          00920018
009300******************************************************************00930018
009400     EXEC SQL                                                     00940018
009500          INCLUDE TAURECI                                         00950018
009600     END-EXEC.                                                    00960018
009700*                                                                 00970018
009800 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00980018
009900                                                   COMP SYNC.     00990018
010000                                                                  01000018
010100 01  PS-PROGRAM-SWITCHES.                                         01010018
010200     05  PS-EOF-AUDIT-RECI-CSR-SW    PIC  X(01)    VALUE SPACE.   01020018
010300         88  PS-EOF-AUDIT-RECI-CSR                 VALUE 'Y'.     01030018
010400                                                                  01040018
010500                                                                  01050018
010600 01  PC-PROGRAM-CONSTANTS.                                        01060018
010700     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     01070018
010800                                                   COMP SYNC.     01080018
010900     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          01090018
011000         'RCKUT033'.                                              01100018
011100     05  PC-CURRENT-OPERATING-COMPANY                             01110018
011200                                     PIC  X(02)    VALUE '03'.    01120018
011300     05  PC-MAX-RETRIES              PIC S9(04)    VALUE +3       01130018
011400                                                   COMP SYNC.     01140018
011500     05  PC-CURRENT-TIMESTAMP        PIC  X(26)    VALUE SPACES.  01150018
011600                                                                  01160018
011700 01  PV-PROGRAM-VARIABLES.                                        01170018
011800     05  PV-ITEM-NBR                 PIC  9(15)    VALUE ZERO.    01180018
011900     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  01190018
012000     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01200018
012100     05  PV-OPEN-COUNTER             PIC S9(04)    VALUE ZERO     01210018
012200                                                   COMP SYNC.     01220018
012300     05  PV-CLOSE-COUNTER            PIC S9(04)    VALUE ZERO     01230018
012400                                                   COMP SYNC.     01240018
012500     05  PV-FETCH-COUNTER            PIC S9(04)    VALUE ZERO     01250018
012600                                                   COMP SYNC.     01260018
012700     05  PV-WRITE-COUNTER            PIC S9(09)    VALUE ZERO     01270018
012800                                                   COMP SYNC.     01280018
012900     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             01290018
013000                                                                  01300018
013100     05  PV-DB2-COUNT                PIC S9(09)    VALUE ZERO     01310018
013200                                                   COMP-3.        01320018
013300     05  PV-OPER-UNT-ID              PIC 9(04)     VALUE ZERO.    01330018
013400                                                                  01340018
013500     05  PV-RECI-SEQ-NBR             PIC 9(03)     VALUE ZERO.    01350018
013600                                                                  01360018
013700     05  PV-PO-NBR                   PIC S9(08)    VALUE ZERO.    01370018
013800                                                                  01380018
013900     05  PV-PO-LNE-NBR               PIC 9(03)     VALUE ZERO.    01390018
014000                                                                  01400018
014100*                                                                 01410018
014200*                                                                 01420018
014300 01  SD-SYSTEM-DATE.                                              01430018
014400     05  SD-SYSTEM-DATE-YY           PIC  9(02)      VALUE ZERO.  01440018
014500     05  SD-SYSTEM-DATE-MM           PIC  9(02)      VALUE ZERO.  01450018
014600     05  SD-SYSTEM-DATE-DD           PIC  9(02)      VALUE ZERO.  01460018
014700                                                                  01470018
014800*                                                                 01480018
014900*  CURSOR DECLARATION FOR ALL EXCEPTION ACTIVITY ON THE           01490018
015000*  UPC CERTIFICATION ACTIVITY LOG TABLE                           01500018
015100*                                                                 01510018
015200                                                                  01520018
015300     EXEC SQL                                                     01530018
015400          DECLARE AUDIT_RECI_CURSOR CURSOR FOR                    01540018
015500           SELECT                                                 01550018
015600             ORD_NBR                                              01560018
015700            ,ORD_LNE_NBR                                          01570018
015800            ,REC_SEQ_NBR                                          01580018
015900            ,OPER_UNT_ID                                          01590018
016000            ,FCLTY_ID                                             01600018
016100            ,CRE_TMST                                             01610018
016200            ,CRE_UID                                              01620018
016300            ,PO_VER_NBR                                           01630018
016400            ,ITM_NBR                                              01640018
016500            ,PRE_TKT_IND                                          01650018
016600            ,TKT_FMT_ID                                           01660018
016700            ,RTV_IND                                              01670018
016800            ,STATUS_CDE                                           01680018
016900            ,VER_STATUS_CDE                                       01690018
017000            ,PKSL_ITM_QTY                                         01700018
017100            ,DTL_CK_ITM_QTY                                       01710018
017200            ,INNR_PACK_QTY                                        01720018
017300            ,CASE_PACK_QTY                                        01730018
017400            ,RTV_QTY                                              01740018
017500            ,EXPTED_CART_CNT                                      01750018
017600            ,ACTL_CART_CNT                                        01760018
017700            ,MKING_APRON_TMST                                     01770018
017800            ,UNT_COST_AMT                                         01780018
017900            ,COLOR_DESC                                           01790018
018000            ,SIZE_DESC                                            01800018
018100            ,VEND_STYL_NAME                                       01810018
018200            ,VEND_DESC                                            01820018
018300            ,VERFYD_TMST                                          01830018
018400            ,PKSL_NBR                                             01840018
018500            ,REC_INV_LNE_NBR                                      01850018
018600            ,DMG_ITM_QTY                                          01860018
018700            ,UPD_TMST                                             01870018
018800            ,UPD_UID                                              01880018
018900            ,UPD_PGM_ID                                           01890018
019000            ,RCPT_DISTR_UPD_CDE                                   01900018
019100            ,AUD_TYP_CDE                                          01910018
019200            ,AUD_FUNC_CDE                                         01920018
019300            ,NOTIF_NBR                                            01930018
019400            ,VRFD_USR_ID                                          01940018
019500            ,LAST_TRSCP_TMST                                      01950018
019600            ,LAST_TRSCP_USR_ID                                    01960018
019700            ,ROW_CRER_PGM_ID                                      01970018
019800            ,ROW_CRER_USR_ID                                      01980018
019900            ,ROW_CREN_TMST                                        01990018
020000            ,PREPK_ID                                             02000018
020100            ,PREPK_RATO_QTY                                       02010018
020200            ,PREPK_ODD_UNT_QTY                                    02020018
020300            ,PREPK_DRV_LNE_CDE                                    02030018
020310            ,UNT_RTL_AMT                                          02031019
020320            ,GP_RTL_AMT                                           02032019
020330            ,GP_QTY                                               02033019
020340            ,ORIG_PKSL_ITM_QTY                                    02034019
020400             FROM TAURECI                                         02040018
020500            WHERE ROW_CREN_TMST = :PC-CURRENT-TIMESTAMP           02050018
020600               OR ROW_CREN_TMST < :PC-CURRENT-TIMESTAMP           02060018
020700                                                                  02070018
020800     END-EXEC.                                                    02080018
020900                                                                  02090018
021000                                                                  02100018
021100******************************************************************02110018
021200 PROCEDURE DIVISION.                                              02120018
021300******************************************************************02130018
021400                                                                  02140018
021500 0000-PROGRAM-MAINLINE.                                           02150018
021600******************************************************************02160018
021700* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     02170018
021800*      PROGRAM.                                                   02180018
021900******************************************************************02190018
022000                                                                  02200018
022100     PERFORM 1000-INITIALIZE.                                     02210018
022200     PERFORM 2000-PROCESS-AUDIT-RECPT-ITEMS                       02220018
022300       UNTIL PS-EOF-AUDIT-RECI-CSR.                               02230018
022400     PERFORM 9000-EOJ-ROUTINE.                                    02240018
022500                                                                  02250018
022600     STOP RUN.                                                    02260018
022700*0000-EXIT.                                                       02270018
022800*                                                                 02280018
022900*                                                                 02290018
023000 1000-INITIALIZE.                                                 02300018
023100******************************************************************02310018
023200*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    02320018
023300*    -- OPEN OUTPUT FILE                                          02330018
023400*    -- OPEN CURSOR                                               02340018
023500*    -- FETCH CURSOR                                              02350018
023600******************************************************************02360018
023700*                                                                 02370018
023800     ACCEPT SD-SYSTEM-DATE FROM DATE.                             02380018
023900*                                                                 02390018
024000     OPEN INPUT  TIMESTAMP-FILE.                                  02400018
024100     OPEN OUTPUT RECEIPT-ITEM-AUDIT-FILE.                         02410018
024200                                                                  02420018
024300     PERFORM 1100-READ-TIMESTAMP-FILE.                            02430018
024400                                                                  02440018
024500     PERFORM 7000-OPEN-AUDIT-RECI-CURSOR.                         02450018
024600                                                                  02460018
024700     PERFORM 7100-FETCH-AUDIT-RECI-CURSOR.                        02470018
024800*1000-EXIT.                                                       02480018
024900*                                                                 02490018
025000 1100-READ-TIMESTAMP-FILE.                                        02500018
025100      READ TIMESTAMP-FILE INTO                                    02510018
025200          RC011-CONTROL-RECORD.                                   02520018
025300      MOVE RC011-CONTROL-TMST TO PC-CURRENT-TIMESTAMP.            02530018
025400     DISPLAY 'RCKUT033 CONTROL CARD -- ' RC011-CONTROL-TMST.      02540018
025500*1100-EXIT.                                                       02550018
025600 2000-PROCESS-AUDIT-RECPT-ITEMS.                                  02560018
025700******************************************************************02570018
025800*  PROCESS THE CERTIFICATION REQUESTS (LOOP THROUGH THE RESULTS   02580018
025900*  TABLE).  FORMAT THE OUTPUT RECORD.  WRITE THE RECORDS THAT     02590018
026000*  MEET THE CRITERIA.                                             02600018
026100******************************************************************02610018
026200                                                                  02620018
026300     PERFORM 8000-WRITE-AUDIT-RECI-RECORD.                        02630018
026400     PERFORM 7100-FETCH-AUDIT-RECI-CURSOR.                        02640018
026500*2000-EXIT.                                                       02650018
026600*                                                                 02660018
026700 7000-OPEN-AUDIT-RECI-CURSOR.                                     02670018
026800******************************************************************02680018
026900*  OPEN THE CURSOR.                                               02690018
027000******************************************************************02700018
027100     PERFORM WITH TEST AFTER                                      02710018
027200       VARYING PV-OPEN-COUNTER FROM 1 BY 1                        02720018
027300         UNTIL (PV-OPEN-COUNTER > PC-MAX-RETRIES                  02730018
027400                OR                                                02740018
027500                SQLCODE = ZERO)                                   02750018
027600                                                                  02760018
027700         EXEC SQL                                                 02770018
027800              OPEN AUDIT_RECI_CURSOR                              02780018
027900         END-EXEC                                                 02790018
028000                                                                  02800018
028100         EVALUATE TRUE                                            02810018
028200             WHEN SQLCODE = -904                                  02820018
028300             WHEN SQLCODE = -911                                  02830018
028400                 CONTINUE                                         02840018
028500             WHEN SQLWARN0 NOT = SPACES                           02850018
028600             WHEN SQLCODE < ZERO                                  02860018
028700             WHEN SQLCODE > ZERO                                  02870018
028800                 MOVE '7000-OPEN-AUDIT-RECI-CURSOR    '           02880018
028900                                 TO PV-PARAGRAPH-NAME             02890018
029000                 MOVE 'OPEN THE AUDIT_RECI_CURSOR    '            02900018
029100                                 TO PV-DB2-OPERATION-ATTEMPTED    02910018
029200                 PERFORM 9100-SQL-ABEND                           02920018
029300             WHEN SQLCODE = ZERO                                  02930018
029400                 CONTINUE                                         02940018
029500         END-EVALUATE                                             02950018
029600     END-PERFORM.                                                 02960018
029700                                                                  02970018
029800     IF PV-OPEN-COUNTER > PC-MAX-RETRIES                          02980018
029900         MOVE '7000-OPEN-AUDIT-RECI-CURSOR   '                    02990018
030000                                 TO PV-PARAGRAPH-NAME             03000018
030100         MOVE 'OPEN MAX RETRIES EXCEEDED     '                    03010018
030200                                 TO PV-DB2-OPERATION-ATTEMPTED    03020018
030300         PERFORM 9100-SQL-ABEND                                   03030018
030400     END-IF.                                                      03040018
030500*7000-EXIT.                                                       03050018
030600*                                                                 03060018
030700*                                                                 03070018
030800 7100-FETCH-AUDIT-RECI-CURSOR.                                    03080018
030900******************************************************************03090018
031000*  FETCH THE ROW FROM THE RESULTS TABLE USING THE CURSOR.         03100018
031100******************************************************************03110018
031200     EXEC SQL                                                     03120018
031300          FETCH AUDIT_RECI_CURSOR                                 03130018
031400           INTO :AURECI-ORD-NBR,                                  03140018
031500                :AURECI-ORD-LNE-NBR,                              03150018
031600                :AURECI-REC-SEQ-NBR,                              03160018
031700                :AURECI-OPER-UNT-ID,                              03170018
031800                :AURECI-FCLTY-ID,                                 03180018
031900                :AURECI-CRE-TMST,                                 03190018
032000                :AURECI-CRE-UID,                                  03200018
032100                :AURECI-PO-VER-NBR,                               03210018
032200                :AURECI-ITM-NBR,                                  03220018
032300                :AURECI-PRE-TKT-IND,                              03230018
032400                :AURECI-TKT-FMT-ID,                               03240018
032500                :AURECI-RTV-IND,                                  03250018
032600                :AURECI-STATUS-CDE,                               03260018
032700                :AURECI-VER-STATUS-CDE,                           03270018
032800                :AURECI-PKSL-ITM-QTY,                             03280018
032900                :AURECI-DTL-CK-ITM-QTY,                           03290018
033000                :AURECI-INNR-PACK-QTY,                            03300018
033100                :AURECI-CASE-PACK-QTY,                            03310018
033200                :AURECI-RTV-QTY,                                  03320018
033300                :AURECI-EXPTED-CART-CNT,                          03330018
033400                :AURECI-ACTL-CART-CNT,                            03340018
033500                :AURECI-MKING-APRON-TMST,                         03350018
033600                :AURECI-UNT-COST-AMT,                             03360018
033700                :AURECI-COLOR-DESC,                               03370018
033800                :AURECI-SIZE-DESC,                                03380018
033900                :AURECI-VEND-STYL-NAME,                           03390018
034000                :AURECI-VEND-DESC,                                03400018
034100                :AURECI-VERFYD-TMST,                              03410018
034200                :AURECI-PKSL-NBR,                                 03420018
034300                :AURECI-REC-INV-LNE-NBR,                          03430018
034400                :AURECI-DMG-ITM-QTY,                              03440018
034500                :AURECI-UPD-TMST,                                 03450018
034600                :AURECI-UPD-UID,                                  03460018
034700                :AURECI-UPD-PGM-ID,                               03470018
034800                :AURECI-RCPT-DISTR-UPD-CDE,                       03480018
034900                :AURECI-AUD-TYP-CDE,                              03490018
035000                :AURECI-AUD-FUNC-CDE,                             03500018
035100                :AURECI-NOTIF-NBR,                                03510018
035200                :AURECI-VRFD-USR-ID,                              03520018
035300                :AURECI-LAST-TRSCP-TMST,                          03530018
035400                :AURECI-LAST-TRSCP-USR-ID,                        03540018
035500                :AURECI-ROW-CRER-PGM-ID,                          03550018
035600                :AURECI-ROW-CRER-USR-ID,                          03560018
035700                :AURECI-ROW-CREN-TMST,                            03570018
035800                :AURECI-PREPK-ID,                                 03580018
035900                :AURECI-PREPK-RATO-QTY,                           03590018
036000                :AURECI-PREPK-ODD-UNT-QTY,                        03600018
036100                :AURECI-PREPK-DRV-LNE-CDE,                        03610019
036110                :AURECI-UNT-RTL-AMT,                              03611019
036120                :AURECI-GP-RTL-AMT,                               03612019
036130                :AURECI-GP-QTY,                                   03613019
036140                :AURECI-ORIG-PKSL-ITM-QTY                         03614019
036200     END-EXEC.                                                    03620018
036300                                                                  03630018
036400     EVALUATE TRUE                                                03640018
036500         WHEN SQLCODE = ZERO                                      03650018
036600             CONTINUE                                             03660018
036700         WHEN SQLCODE = +100                                      03670018
036800             SET PS-EOF-AUDIT-RECI-CSR                            03680018
036900                                 TO TRUE                          03690018
037000         WHEN SQLWARN0 NOT = SPACES                               03700018
037100         WHEN SQLCODE < ZERO                                      03710018
037200         WHEN SQLCODE > ZERO                                      03720018
037300             MOVE '7100-FETCH-AUDIT-RECI-CURSOR  '                03730018
037400                                 TO PV-PARAGRAPH-NAME             03740018
037500             MOVE 'FETCH THE AUDIT-RECI-CURSOR   '                03750018
037600                                 TO PV-DB2-OPERATION-ATTEMPTED    03760018
037700             PERFORM 9100-SQL-ABEND                               03770018
037800     END-EVALUATE.                                                03780018
037900*7100-EXIT.                                                       03790018
038000*                                                                 03800018
038100*                                                                 03810018
038200*                                                                 03820018
038300 8000-WRITE-AUDIT-RECI-RECORD.                                    03830018
038400******************************************************************03840018
038500*  WRITE THE RECEIPT-ITEM-AUDIT-RECORD                            03850018
038600******************************************************************03860018
038700     PERFORM 8010-BUILD-RC013-RECORD.                             03870018
038800     WRITE RECEIPT-ITEM-AUDIT-RECORD                              03880018
038900         FROM RC013-TRECITM-AUDIT-RECORD.                         03890018
039000     ADD +1 TO PV-WRITE-COUNTER.                                  03900018
039100                                                                  03910018
039200*8000-EXIT.                                                       03920018
039300*                                                                 03930018
039400 8010-BUILD-RC013-RECORD.                                         03940018
039500     INITIALIZE RECEIPT-ITEM-AUDIT-RECORD.                        03950018
039600     MOVE AURECI-ORD-NBR              TO RC013-ORD-NBR            03960018
039700     MOVE AURECI-ORD-LNE-NBR          TO RC013-ORD-LNE-NBR        03970018
039800     MOVE AURECI-REC-SEQ-NBR          TO RC013-REC-SEQ-NBR        03980018
039900     MOVE AURECI-OPER-UNT-ID          TO RC013-OPER-UNT-ID        03990018
040000     MOVE AURECI-FCLTY-ID             TO RC013-FCLTY-ID           04000018
040100     MOVE AURECI-CRE-TMST             TO RC013-CRE-TMST           04010018
040200     MOVE AURECI-CRE-UID              TO RC013-CRE-UID            04020018
040300     MOVE AURECI-PO-VER-NBR           TO RC013-PO-VER-NBR         04030018
040400     MOVE AURECI-ITM-NBR              TO RC013-ITM-NBR            04040018
040500     MOVE AURECI-PRE-TKT-IND          TO RC013-PRE-TKT-IND        04050018
040600     MOVE AURECI-TKT-FMT-ID           TO RC013-TKT-FMT-ID         04060018
040700     MOVE AURECI-RTV-IND              TO RC013-RTV-IND            04070018
040800     MOVE AURECI-STATUS-CDE           TO RC013-STATUS-CDE         04080018
040900     MOVE AURECI-VER-STATUS-CDE       TO RC013-VER-STATUS-CDE     04090018
041000     MOVE AURECI-PKSL-ITM-QTY         TO RC013-PKSL-ITM-QTY       04100018
041100     MOVE AURECI-DTL-CK-ITM-QTY       TO RC013-DTL-CK-ITM-QTY     04110018
041200     MOVE AURECI-INNR-PACK-QTY        TO RC013-INNR-PACK-QTY      04120018
041300     MOVE AURECI-CASE-PACK-QTY        TO RC013-CASE-PACK-QTY      04130018
041400     MOVE AURECI-RTV-QTY              TO RC013-RTV-QTY            04140018
041500     MOVE AURECI-EXPTED-CART-CNT      TO RC013-EXPTED-CART-CNT    04150018
041600     MOVE AURECI-ACTL-CART-CNT        TO RC013-ACTL-CART-CNT      04160018
041700     MOVE AURECI-MKING-APRON-TMST     TO RC013-MKING-APRON-TMST   04170018
041800     MOVE AURECI-UNT-COST-AMT         TO RC013-UNT-COST-AMT       04180018
041900     MOVE AURECI-COLOR-DESC           TO RC013-COLOR-DESC         04190018
042000     MOVE AURECI-SIZE-DESC            TO RC013-SIZE-DESC          04200018
042100     MOVE AURECI-VEND-STYL-NAME       TO RC013-VEND-STYL-NAME     04210018
042200     MOVE AURECI-VEND-DESC            TO RC013-VEND-DESC          04220018
042300     MOVE AURECI-VERFYD-TMST          TO RC013-VERFYD-TMST        04230018
042400     MOVE AURECI-PKSL-NBR             TO RC013-PKSL-NBR           04240018
042500     MOVE AURECI-REC-INV-LNE-NBR      TO RC013-REC-INV-LNE-NBR    04250018
042600     MOVE AURECI-DMG-ITM-QTY          TO RC013-DMG-ITM-QTY        04260018
042700     MOVE AURECI-UPD-TMST             TO RC013-UPD-TMST           04270018
042800     MOVE AURECI-UPD-UID              TO RC013-UPD-UID            04280018
042900     MOVE AURECI-UPD-PGM-ID           TO RC013-UPD-PGM-ID         04290018
043000     MOVE AURECI-RCPT-DISTR-UPD-CDE   TO RC013-RCPT-DISTR-UPD-CDE 04300018
043100     MOVE AURECI-AUD-TYP-CDE          TO RC013-AUD-TYP-CDE        04310018
043200     MOVE AURECI-AUD-FUNC-CDE         TO RC013-FUNC-CDE           04320018
043300     MOVE AURECI-NOTIF-NBR            TO RC013-NOTIF-NBR          04330018
043400     MOVE AURECI-VRFD-USR-ID          TO RC013-VRFD-USR-ID        04340018
043500     MOVE AURECI-LAST-TRSCP-TMST      TO RC013-LAST-TRSCP-TMST    04350018
043600     MOVE AURECI-LAST-TRSCP-USR-ID    TO RC013-LAST-TRSCP-USR-ID  04360018
043700     MOVE AURECI-ROW-CRER-PGM-ID      TO RC013-ROW-CRER-PGM-ID    04370018
043800     MOVE AURECI-ROW-CRER-USR-ID      TO RC013-ROW-CRER-USR-ID    04380018
043900     MOVE AURECI-ROW-CREN-TMST        TO RC013-ROW-CREN-TMST      04390018
044000     MOVE AURECI-PREPK-ID             TO RC013-PREPK-ID           04400018
044100     MOVE AURECI-PREPK-RATO-QTY       TO RC013-PREPK-RATO-QTY     04410018
044200     MOVE AURECI-PREPK-ODD-UNT-QTY    TO RC013-PREPK-ODD-UNT-QTY  04420018
044300     MOVE AURECI-PREPK-DRV-LNE-CDE    TO RC013-PREPK-DRV-LNE-CDE. 04430018
044310     MOVE AURECI-UNT-RTL-AMT          TO RC013-UNT-RTL-AMT        04431019
044320     MOVE AURECI-GP-RTL-AMT           TO RC013-GP-RTL-AMT         04432019
044330     MOVE AURECI-GP-QTY               TO RC013-GP-QTY             04433019
044340     MOVE AURECI-ORIG-PKSL-ITM-QTY    TO RC013-ORIG-PKSL-ITM-QTY. 04434020
044400/                                                                 04440018
044500                                                                  04450018
044600 9000-EOJ-ROUTINE.                                                04460018
044700******************************************************************04470018
044800*  CLOSE OUTPUT FILE.  CLOSE THE CURSOR.                          04480018
044900******************************************************************04490018
045000     MOVE PV-WRITE-COUNTER TO PV-DISPLAY-COUNT.                   04500018
045100     DISPLAY 'TOTAL AUDIT RECORDS SELECTED ' PV-DISPLAY-COUNT.    04510018
045200                                                                  04520018
045300     CLOSE RECEIPT-ITEM-AUDIT-FILE                                04530018
045400           TIMESTAMP-FILE.                                        04540018
045500                                                                  04550018
045600     PERFORM WITH TEST AFTER                                      04560018
045700       VARYING PV-CLOSE-COUNTER FROM 1 BY 1                       04570018
045800         UNTIL (PV-CLOSE-COUNTER > PC-MAX-RETRIES                 04580018
045900                OR                                                04590018
046000                SQLCODE = ZERO)                                   04600018
046100                                                                  04610018
046200         EXEC SQL                                                 04620018
046300              CLOSE AUDIT_RECI_CURSOR                             04630018
046400         END-EXEC                                                 04640018
046500                                                                  04650018
046600         EVALUATE TRUE                                            04660018
046700             WHEN SQLCODE = -904                                  04670018
046800             WHEN SQLCODE = -911                                  04680018
046900                 CONTINUE                                         04690018
047000             WHEN SQLWARN0 NOT = SPACES                           04700018
047100             WHEN SQLCODE < ZERO                                  04710018
047200             WHEN SQLCODE > ZERO                                  04720018
047300                 MOVE '9000-EOJ-ROUTINE               '           04730018
047400                                 TO PV-PARAGRAPH-NAME             04740018
047500                 MOVE 'CLOSE THE AUDIT_RECI_CURSOR    '           04750018
047600                                 TO PV-DB2-OPERATION-ATTEMPTED    04760018
047700                 PERFORM 9100-SQL-ABEND                           04770018
047800             WHEN SQLCODE = ZERO                                  04780018
047900                 CONTINUE                                         04790018
048000         END-EVALUATE                                             04800018
048100     END-PERFORM.                                                 04810018
048200                                                                  04820018
048300     IF PV-CLOSE-COUNTER > PC-MAX-RETRIES                         04830018
048400         MOVE '9000-EOJ-ROUTINE               '                   04840018
048500                                 TO PV-PARAGRAPH-NAME             04850018
048600         MOVE 'CLOSE MAX RETRIES EXCEEDED     '                   04860018
048700                                 TO PV-DB2-OPERATION-ATTEMPTED    04870018
048800         PERFORM 9100-SQL-ABEND                                   04880018
048900     END-IF.                                                      04890018
049000*9000-EXIT.                                                       04900018
049100*                                                                 04910018
049200*                                                                 04920018
049300 9100-SQL-ABEND.                                                  04930018
049400******************************************************************04940018
049500*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    04950018
049600*  ERROR OR WARNING CODE OCCURS.                                  04960018
049700******************************************************************04970018
049800     DISPLAY '9100-SQL-ABEND'.                                    04980018
049900     DISPLAY '** ABEND     **'.                                   04990018
050000     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        05000018
050100     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              05010018
050200     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     05020018
050300                                                                  05030018
050400******************************************************************05040018
050500* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    05050018
050600* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         05060018
050700* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     05070018
050800* FORMAT.                                                         05080018
050900******************************************************************05090018
051000     COPY DPPD004.                                                05100018
051100                                                                  05110018
051200     MOVE +4013                  TO ABEND-CODE.                   05120018
051300     CALL 'ILBOABN0' USING ABEND-CODE.                            05130018
051400*9100-EXIT.                                                       05140018
