000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400 PROGRAM-ID.    SUKUT045.                                         00040001
000500 AUTHOR.        VISWA KARUTURI                                    00050001
000600 INSTALLATION.  KOHLS.                                            00060001
000700 DATE-WRITTEN   AUGUST, 2004.                                     00070001
000800 DATE-COMPILED.                                                   00080001
000900******************************************************************00090001
001000*   THIS PROGRAM READS CARTON DETAIL FILE (PCRD010) AND GET       00100003
001100*   INTR-UPC-ID FROM XLT_UPC TABLE BY UPC_NBR                     00110017
001200*   AND WRITE PCRD010 RECORD WITH INTR-UPC-ID TO OUTPUT           00120017
001210*  2005/05  DEANNA BRANTER  THIS PROGRAM WILL NOW PASS PO AND     00121022
001220*                           LINE NUMBER TO PCKUT064 WHICH WILL    00122023
001230*                           RETRIEVE INTR-UPC-ID FROM XLT_SKU.    00123023
001300******************************************************************00130001
001400 ENVIRONMENT DIVISION.                                            00140001
001500 CONFIGURATION SECTION.                                           00150001
001600                                                                  00160001
001700 SOURCE-COMPUTER.        IBM-3090.                                00170001
001800 OBJECT-COMPUTER.        IBM-3090.                                00180001
001900                                                                  00190001
002000 INPUT-OUTPUT SECTION.                                            00200001
002100 FILE-CONTROL.                                                    00210001
002200                                                                  00220001
002300     SELECT CARTON-DTL-INP-FILE                                   00230001
002400         ASSIGN TO IN01.                                          00240001
002500                                                                  00250001
002600     SELECT CARTON-DTL-OUT-FILE                                   00260001
002700         ASSIGN TO OUT01.                                         00270001
002800                                                                  00280001
002900******************************************************************00290001
003000 DATA DIVISION.                                                   00300001
003100 FILE SECTION.                                                    00310001
003200                                                                  00320001
003300 FD  CARTON-DTL-INP-FILE                                          00330001
003400     RECORDING MODE IS F                                          00340001
003500     LABEL RECORDS ARE STANDARD                                   00350001
003600     BLOCK CONTAINS 0 RECORDS.                                    00360001
003700                                                                  00370001
003800 01  CARTON-DTL-INP-RECORD   PIC  X(100).                         00380001
003900*                                                                 00390001
004000 FD  CARTON-DTL-OUT-FILE                                          00400001
004100     RECORDING MODE IS F                                          00410001
004200     LABEL RECORDS ARE STANDARD                                   00420001
004300     BLOCK CONTAINS 0 RECORDS.                                    00430001
004400                                                                  00440001
004500 01  CARTON-DTL-OUT-RECORD  PIC  X(100).                          00450001
004600*                                                                 00460001
004700******************************************************************00470001
004800 WORKING-STORAGE SECTION.                                         00480001
004900******************************************************************00490001
005000******************************************************************00500001
005100*  CARTON OUTPUT FILE LAYOUT                                      00510001
005200******************************************************************00520001
005300     COPY PCRD010.                                                00530001
005400*                                                                 00540001
005410******************************************************************00541023
005430*  COPY BOOK FOR INTR-UPC-ID CALLED MODULE PCKUT064               00543019
005440******************************************************************00544019
005450     COPY PCWS064.                                                00545019
005460*                                                                 00546019
005500******************************************************************00550018
005600*  COMMUNICATIONS AREA FOR DB2                                    00560018
005700******************************************************************00570018
005800     EXEC SQL                                                     00580018
005900          INCLUDE SQLCA                                           00590018
005910     END-EXEC.                                                    00591018
005920                                                                  00592018
006000******************************************************************00600007
006100*  DCLGEN FOR SUT_OTBND_UPC TABLE                                 00610017
006200******************************************************************00620007
006300     EXEC SQL                                                     00630007
006400          INCLUDE SUT00028                                        00640008
006500     END-EXEC.                                                    00650007
006600                                                                  00660007
006610******************************************************************00661017
006620*  DCLGEN FOR XLT_UPC TABLE                                       00662017
006630******************************************************************00663017
006640     EXEC SQL                                                     00664017
006650          INCLUDE XLT00006                                        00665017
006660     END-EXEC.                                                    00666017
006670                                                                  00667017
006700******************************************************************00670001
006800 01  PS-PROGRAM-SWITCHES.                                         00680001
006900     05  PS-END-OF-FILE-SW           PIC  X(01)    VALUE 'N'.     00690001
007000         88  PS-END-OF-FILE                        VALUE 'Y'.     00700001
007100         88  PS-NOT-END-OF-FILE                    VALUE 'N'.     00710001
007200                                                                  00720001
007300 01  PC-PROGRAM-CONSTANTS.                                        00730001
007400     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08) VALUE 'SUKUT045'. 00740001
007600                                                                  00760001
007700 01  PV-PROGRAM-VARIABLES.                                        00770001
007800     05  PV-PARAGRAPH-NAME           PIC  X(30)     VALUE SPACES. 00780001
007900     05  PV-READ-COUNTER             PIC  9(5) COMP VALUE ZEROS.  00790001
007910     05  PV-READ-COUNTER-2           PIC  9(5) COMP VALUE ZEROS.  00791015
008000     05  PV-WRITE-COUNTER            PIC  9(5) COMP VALUE ZEROS.  00800001
008001     05  PV-XL-SELECT-COUNT          PIC  9(5) COMP VALUE ZEROS.  00800117
008010     05  PV-BAD-UPC-COUNTER          PIC  9(5) COMP VALUE ZEROS.  00801010
008100     05  PV-UPC-NBR                  PIC S9(15)V    VALUE ZEROS.  00810001
008200     05  PV-INTR-UPC-ID              PIC S9(9) COMP VALUE ZEROS.  00820001
008210     05  PV-PO-NBR                   PIC S9(9) COMP VALUE ZEROS.  00821021
008220     05  PV-LINE-NBR                 PIC S9(9) COMP VALUE ZEROS.  00822021
008300     05  PV-DISPLAY-COUNT            PIC  ZZZ,ZZZ,ZZ9.            00830001
008301     05  PV-DISPLAY-COUNT2           PIC  ZZZ,ZZZ,ZZ9.            00830115
008310     05  PV-DISPLAY-SQLCODE          PIC  +999.                   00831010
008320     05  PV-DISPLAY-UPC-NBR          PIC  Z(15).                  00832017
008330     05  PV-DISPLAY-PO-NBR           PIC  Z(10).                  00833020
008340     05  PV-DISPLAY-LINE-NBR         PIC  Z(04).                  00834020
008350     05  PV-DISPLAY-ITM-NBR          PIC  9(15).                  00835023
008360     05  PV-DISPLAY-INTR-UPC         PIC  9(09).                  00836023
008370     05  PV-DISPLAY-MSG              PIC X(128).                  00837025
008371     05  PV-DISPLAY-MSG-R REDEFINES PV-DISPLAY-MSG.               00837125
008380         10  PV-DISPLAY-MSG-1        PIC X(87).                   00838025
008390         10  PV-DISPLAY-MSG-2        PIC X(41).                   00839025
008400                                                                  00840001
008500******************************************************************00850001
008600 PROCEDURE DIVISION.                                              00860001
008700******************************************************************00870001
008800******************************************************************00880001
008900* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     00890001
009000*      PROGRAM.                                                   00900001
009100******************************************************************00910001
009200 0000-PROGRAM-MAINLINE.                                           00920001
009300                                                                  00930001
009310     DISPLAY '***** SUKUT045 STARTED *****'.                      00931013
009320                                                                  00932013
009400     PERFORM 1000-INITIALIZE.                                     00940001
009500     PERFORM 2000-PROCESS-CARTON-FILE                             00950004
009600         UNTIL PS-END-OF-FILE.                                    00960004
009700     PERFORM 9000-EOJ-ROUTINE.                                    00970001
009800                                                                  00980001
009900     STOP RUN.                                                    00990001
010000                                                                  01000001
010100******************************************************************01010001
010200*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    01020001
010300*    -- OPEN INPUT FILE                                           01030001
010400*    -- OPEN OUTPUT FILE                                          01040001
010500*    -- READ INPUT FILE                                           01050001
010600******************************************************************01060001
010700 1000-INITIALIZE.                                                 01070001
010800                                                                  01080001
010900     OPEN INPUT  CARTON-DTL-INP-FILE.                             01090001
011000     OPEN OUTPUT CARTON-DTL-OUT-FILE.                             01100001
011100                                                                  01110001
011200     PERFORM 7000-READ-FILE.                                      01120001
011300                                                                  01130001
011400******************************************************************01140001
011500*  RETRIEVING INTR-UPC-ID AND WRITE RECORD TO OUTPUT              01150002
011600******************************************************************01160001
011700 2000-PROCESS-CARTON-FILE.                                        01170002
011800                                                                  01180001
011900     IF PC010-PO-NBR       = PV-PO-NBR AND                        01190022
012000        PC010-TRN-LNE-NBR  = PV-LINE-NBR                          01200022
012100            MOVE PV-INTR-UPC-ID     TO PC010-INTR-UPC-ID          01210022
012101     ELSE                                                         01210122
012102            PERFORM 6010-GET-INTERNAL-UPC-ID                      01210221
012103            MOVE PV-INTR-UPC-ID     TO PC010-INTR-UPC-ID          01210322
012110            ADD  +1  TO  PV-XL-SELECT-COUNT                       01211021
012500            MOVE PC010-PO-NBR       TO PV-PO-NBR                  01250021
012510            MOVE PC010-TRN-LNE-NBR  TO PV-LINE-NBR                01251021
012600     END-IF.                                                      01260001
012700                                                                  01270001
012710****** THIS PROGRAM IS NOW DRIVEN BY PO/LINE NUMBER.************  01271021
012711******      2005/05  DEANNA BRANTNER                ************  01271121
012712*    IF PC010-UPC-NBR NOT = PV-UPC-NBR                            01271221
012720*        IF PC010-UPC-NBR NOT = ZEROES                            01272021
012730*            PERFORM 6010-GET-INTERNAL-UPC-ID                     01273021
012740*            ADD  +1  TO  PV-XL-SELECT-COUNT                      01274021
012750*        ELSE                                                     01275021
012760*            MOVE ZEROS      TO PV-INTR-UPC-ID                    01276021
012770*        END-IF                                                   01277021
012780*        MOVE PC010-UPC-NBR  TO PV-UPC-NBR                        01278021
012790*    END-IF.                                                      01279021
012791                                                                  01279121
012810                                                                  01281016
012820*** DMH - 08/27/2004 - BEGIN                                      01282016
012830     IF  PC010-UNLOAD-ST                                          01283016
012840         MULTIPLY  PC010-IN-TRNST-QTY  BY  -1                     01284016
012841           GIVING  PC010-IN-TRNST-QTY                             01284116
012850     END-IF.                                                      01285016
012860*** DMH - 08/27/2004 - BEGIN                                      01286016
012870                                                                  01287016
012900     PERFORM 8000-WRITE-OUTPUT.                                   01290001
013000     PERFORM 7000-READ-FILE.                                      01300001
013100                                                                  01310001
013200******************************************************************01320020
013300*  2005/05 DEANNA BRANTNER CHANGED THIS PARAGRAPH TO              01330020
013310*  GET THE INTR-UPC-ID FROM CALLED MODULE PCKUT064                01331020
013400******************************************************************01340020
013410 6010-GET-INTERNAL-UPC-ID.                                        01341020
013600                                                                  01360020
013700     INITIALIZE PC064-COMMAREA-REC.                               01370020
013800     MOVE PC010-PO-NBR          TO PC064-ORD-NBR.                 01380020
014000     MOVE PC010-TRN-LNE-NBR     TO PC064-ORD-LNE-NBR.             01400020
014100     MOVE PC010-OTB-TYP-CDE     TO PC064-TRN-TYP-CDE.             01410020
014200     MOVE 'SUKUT045'            TO PC064-CALLING-PGM-NME.         01420020
014300                                                                  01430020
014400     CALL PC064-INTR-UPC-ID-MODULE  USING   PC064-COMMAREA-REC.   01440020
014500                                                                  01450020
014600     EVALUATE TRUE                                                01460020
014700         WHEN PC064-SUCCESSFUL                                    01470020
014800              MOVE PC064-INTR-UPC-ID  TO  PV-INTR-UPC-ID          01480020
015620         WHEN OTHER                                               01562020
015643              MOVE SQLCODE             TO  PV-DISPLAY-SQLCODE     01564320
015644              MOVE PC010-PO-NBR        TO  PV-DISPLAY-PO-NBR      01564420
015645              MOVE PC010-TRN-LNE-NBR   TO  PV-DISPLAY-LINE-NBR    01564520
015646              DISPLAY 'INTR-UPC-ID NOT FOUND  '                   01564620
015648                      ' PO-LINE: '                                01564823
015649                       PV-DISPLAY-PO-NBR '-'                      01564923
015651                       PV-DISPLAY-LINE-NBR  ' - '                 01565123
015652                       PC010-TRN-TYP-CDE                          01565224
015653                      ' = ' PV-DISPLAY-SQLCODE                    01565323
015654                                                                  01565423
015655              MOVE PC064-ORD-NBR       TO  PV-DISPLAY-PO-NBR      01565523
015656              MOVE PC064-ORD-LNE-NBR   TO  PV-DISPLAY-LINE-NBR    01565623
015657              MOVE PC064-ITM-NBR       TO  PV-DISPLAY-ITM-NBR     01565723
015659              MOVE PC064-INTR-UPC-ID   TO  PV-DISPLAY-INTR-UPC    01565923
015660              DISPLAY ' PCWS064'                                  01566023
015661                      ' PO-LINE: '                                01566123
015662                       PV-DISPLAY-PO-NBR '-'                      01566223
015663                       PV-DISPLAY-LINE-NBR  ' - '                 01566323
015664                       PV-DISPLAY-ITM-NBR   ' - '                 01566423
015665                       PV-DISPLAY-INTR-UPC  ' - '                 01566523
015666                       PC064-CRA-RET-CDE ' - '                    01566623
015667                       PC064-TRN-TYP-CDE                          01566723
015668              MOVE ZEROES             TO PV-INTR-UPC-ID           01566823
015669                                                                  01566923
015670              MOVE  PC064-CRA-RET-MSG  TO  PV-DISPLAY-MSG         01567025
015671              DISPLAY PV-DISPLAY-MSG-1                            01567125
015672              DISPLAY PV-DISPLAY-MSG-2                            01567225
015673                                                                  01567325
015674              ADD  1                  TO PV-BAD-UPC-COUNTER       01567425
015675     END-EVALUATE.                                                01567525
015676                                                                  01567625
015677******************************************************************01567725
015678* GET INTERNAL UPC ID                                             01567825
015679******************************************************************01567925
015680* 6010-GET-INTERNAL-UPC-ID.                                       01568025
015681*                                                                 01568125
015682*    MOVE  PC010-UPC-NBR   TO  XLT00006-UPC-NBR                   01568225
015683*                                                                 01568325
015684*    EXEC SQL                                                     01568425
015685*        SELECT DISTINCT INTR_UPC_ID                              01568525
015686*          INTO :XLT00006-INTR-UPC-ID                             01568625
015687*          FROM XLT_UPC                                           01568725
015688*         WHERE UPC_NBR  =  :XLT00006-UPC-NBR                     01568825
015689*    END-EXEC.                                                    01568925
015690*                                                                 01569025
015691*    EVALUATE TRUE                                                01569125
015692*        WHEN SQLCODE = ZERO                                      01569225
015693*             MOVE XLT00006-INTR-UPC-ID  TO  PV-INTR-UPC-ID       01569325
015694*        WHEN SQLWARN0 NOT = SPACES                               01569425
015695*        WHEN SQLCODE < ZERO                                      01569525
015696*        WHEN SQLCODE > ZERO                                      01569625
015697*             MOVE SQLCODE             TO  PV-DISPLAY-SQLCODE     01569725
015698*             MOVE PC010-UPC-NBR       TO  PV-DISPLAY-UPC-NBR     01569825
015699*             DISPLAY 'INTR-UPC-ID NOT FOUND  '                   01569925
015700*                      PV-DISPLAY-UPC-NBR                         01570025
015701*                     ' === ' PV-DISPLAY-SQLCODE                  01570125
015702*             MOVE ZEROES             TO PV-INTR-UPC-ID           01570225
015703*             ADD  1                  TO PV-BAD-UPC-COUNTER       01570325
015704*    END-EVALUATE.                                                01570425
015705*                                                                 01570525
015706*                                                                 01570625
015710******************************************************************01571001
015800*  READ INPUT FILE.                                               01580001
015900******************************************************************01590001
016000 7000-READ-FILE.                                                  01600001
016100      INITIALIZE PC010-PCT-INTRANSIT-REC.                         01610001
016200                                                                  01620001
016300      READ CARTON-DTL-INP-FILE INTO                               01630001
016400          PC010-PCT-INTRANSIT-REC                                 01640001
016500            AT END SET PS-END-OF-FILE TO TRUE.                    01650001
016600                                                                  01660001
016700      IF PS-END-OF-FILE                                           01670001
016800         CONTINUE                                                 01680001
016900      ELSE                                                        01690001
017000         ADD +1 TO PV-READ-COUNTER                                01700001
017010                   PV-READ-COUNTER-2                              01701015
017020         IF  PV-READ-COUNTER-2  >= 200000                         01702015
017021             MOVE PV-READ-COUNTER           TO  PV-DISPLAY-COUNT  01702115
017022             MOVE PV-XL-SELECT-COUNT        TO  PV-DISPLAY-COUNT2 01702217
017030             DISPLAY 'RECORDS PROCESSED....: '  PV-DISPLAY-COUNT  01703015
017032                     '      XL SELECTS.....: '  PV-DISPLAY-COUNT2 01703217
017040             MOVE  ZEROES  TO  PV-READ-COUNTER-2                  01704015
017050         END-IF                                                   01705015
017100      END-IF.                                                     01710001
017200                                                                  01720001
017300******************************************************************01730001
017400*  WRITE OUTPUT FILE.                                             01740001
017500******************************************************************01750001
017600 8000-WRITE-OUTPUT.                                               01760001
017700                                                                  01770001
017800     WRITE CARTON-DTL-OUT-RECORD FROM                             01780001
017900         PC010-PCT-INTRANSIT-REC.                                 01790001
018000                                                                  01800001
018100     ADD +1 TO PV-WRITE-COUNTER.                                  01810001
018200                                                                  01820001
018300******************************************************************01830001
018400*  CLOSE INPUT FILE.  DISPLAY COUNTERS.                           01840001
018500******************************************************************01850001
018600 9000-EOJ-ROUTINE.                                                01860001
018700     CLOSE CARTON-DTL-INP-FILE                                    01870001
018800           CARTON-DTL-OUT-FILE.                                   01880001
018900                                                                  01890001
019000     MOVE PV-READ-COUNTER           TO  PV-DISPLAY-COUNT.         01900012
019100     DISPLAY 'TOTAL RECORDS READ...: '  PV-DISPLAY-COUNT.         01910012
019200     MOVE PV-WRITE-COUNTER          TO  PV-DISPLAY-COUNT.         01920012
019300     DISPLAY 'TOTAL RECORDS WRITTEN: '  PV-DISPLAY-COUNT.         01930012
019310     MOVE PV-BAD-UPC-COUNTER        TO  PV-DISPLAY-COUNT.         01931012
019320     DISPLAY 'TOTAL NOT FOUND UPC..: '  PV-DISPLAY-COUNT.         01932012
019330     MOVE PV-XL-SELECT-COUNT        TO  PV-DISPLAY-COUNT.         01933017
019340     DISPLAY 'XL TABLE SELECTS.....: '  PV-DISPLAY-COUNT.         01934017
019350     DISPLAY '*****  SUKUT045 ENDED  *****'.                      01935014
019400                                                                  01940001
