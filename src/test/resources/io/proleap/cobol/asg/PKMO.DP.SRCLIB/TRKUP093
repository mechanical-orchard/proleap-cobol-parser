000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.    TRKUP093.                                         00050000
000600 AUTHOR.        DENISE HAHN.                                      00060000
000700 INSTALLATION.  KOHLS.                                            00070000
000800 DATE-WRITTEN   FEBRUARY 2021                                     00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*  THIS PROGRAM IS USED TO CLEAN UP OLD INBOUND TRIPS.            00120000
001300*  INPUT FILES CREATED BY TRKUP093 CONTAINING OLD TRIPS THAT NEED 00130000
001400*  TO BE CLEANED UP.  ALSO CREATED FILE OF ASSOCIATED SHIPMENTS   00140000
001410*  THAT ALSO NEED TO BE CLEANED UP.                               00141000
001420*                                                                 00142000
001421*  THIS PROGRAM WILL TAKE BOTH FILE (TRIP & SHIPMENT) AND CREATE  00142100
001422*  DE (DELETED) & ET (END TRIP) INSERT SQL STATEMENTS FOR         00142200
001423*  TTRIPST & TSHIPST TABLES.                                      00142300
001424*                                                                 00142400
001425******************************************************************00142500
001426******************************************************************00142600
001427 ENVIRONMENT DIVISION.                                            00142700
001428******************************************************************00142800
001429                                                                  00142900
001430 CONFIGURATION SECTION.                                           00143000
001440                                                                  00144000
001450 SOURCE-COMPUTER.        IBM-3090.                                00145000
001460 OBJECT-COMPUTER.        IBM-3090.                                00146000
001470                                                                  00147000
001480 INPUT-OUTPUT SECTION.                                            00148000
001490                                                                  00149000
001500 FILE-CONTROL.                                                    00150000
001600                                                                  00160000
001700     SELECT TRIP-FILE                                             00170000
001800         ASSIGN TO INP01.                                         00180000
001900                                                                  00190000
002000     SELECT SHIP-FILE                                             00200000
002100         ASSIGN TO INP02.                                         00210000
002200                                                                  00220000
002300******************************************************************00230000
002400 DATA DIVISION.                                                   00240000
002500******************************************************************00250000
002600                                                                  00260000
002700 FILE SECTION.                                                    00270000
002800                                                                  00280000
002900 FD  TRIP-FILE                                                    00290000
003000     RECORDING MODE IS F                                          00300000
003100     LABEL RECORDS ARE STANDARD                                   00310000
003200     BLOCK CONTAINS 0 RECORDS.                                    00320000
003300*                                                                 00330000
003400 01  TRIP-RECORD.                                                 00340000
003500     05  FILLER                  PIC X(125).                      00350000
003600                                                                  00360000
003700 FD  SHIP-FILE                                                    00370000
003800     RECORDING MODE IS F                                          00380000
003900     LABEL RECORDS ARE STANDARD                                   00390000
004000     BLOCK CONTAINS 0 RECORDS.                                    00400000
004100*                                                                 00410000
004200 01  SHIP-RECORD.                                                 00420000
004300     05  FILLER                  PIC X(100).                      00430000
004400                                                                  00440000
004500                                                                  00450000
004600*                                                                 00460000
004700******************************************************************00470000
004800 WORKING-STORAGE SECTION.                                         00480000
004900******************************************************************00490000
005000*                                                                 00500000
005100******************************************************************00510000
005200*  TRIP FILE                                                      00520000
005300******************************************************************00530000
005400     COPY TRRD074.                                                00540000
005500*                                                                 00550000
005600******************************************************************00560000
005700*  SHPMT FILE                                                     00570000
005800******************************************************************00580000
005900     COPY TRRD075.                                                00590000
006000*                                                                 00600000
006100*                                                                 00610000
006200 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00620000
006300                                                   COMP SYNC.     00630000
006400                                                                  00640000
006500 01  PC-PROGRAM-CONSTANTS.                                        00650000
006600     05  PC-TRKUP093                 PIC X(08) VALUE 'TRKUP093'.  00660000
006610                                                                  00661000
006620 01  PS-PROGRAM-SWITCHES.                                         00662000
006630     05  PS-EOF-TRIP-SW              PIC  X(01)    VALUE 'N'.     00663000
006640         88  PS-EOF-TRIP                           VALUE 'Y'.     00664000
006650         88  PS-MORE-TRIP                          VALUE 'N'.     00665000
006660     05  PS-EOF-SHIP-SW              PIC  X(01)    VALUE 'N'.     00666000
006670         88  PS-EOF-SHIP                           VALUE 'Y'.     00667000
006680         88  PS-MORE-SHIP                          VALUE 'N'.     00668000
006690                                                                  00669000
006700 01  DK-DB2-KEYS.                                                 00670000
006800     05  DK-TRIP-ID                  PIC  S9(9) COMP VALUE ZEROES.00680000
006900                                                                  00690000
007000 01  PROGRAM-VARIABLES.                                           00700000
007100     05  PV-DISP-OPER-UNT            PIC  9(04).                  00710000
007110     05  PV-DISP-TRIP-ID             PIC  9(09).                  00711000
007120     05  PV-DISP-SHIPMT-ID           PIC  9(09).                  00712000
007130     05  PV-TRIP-COUNT               PIC  9(09).                  00713000
007140     05  PV-TTRIPST-CNT              PIC  9(09).                  00714000
007141     05  PV-TSHIPST-CNT              PIC  9(09).                  00714100
007142     05  PV-COMMIT-CNT               PIC  9(09).                  00714200
007143     05  PV-SHPMT-COUNT              PIC S9(09)  VALUE ZEROES     00714300
007144                                                 COMP.            00714400
007145     05  PV-NULL-IND-1               PIC S9(04)  VALUE ZEROS      00714500
007146                                                 COMP SYNC.       00714600
007147     05  PV-NULL-IND-2               PIC S9(04)  VALUE ZEROS      00714700
007148                                                 COMP SYNC.       00714800
007149     05  PV-DISP-TRIP                PIC  Z(10)  VALUE ZEROS.     00714900
007150     05  PV-DISP-OPER                PIC  Z(03)  VALUE ZERO.      00715000
007160                                                                  00716000
007170     05  PV-ITEM-NBR                 PIC  9(15)    VALUE ZERO.    00717000
007180     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  00718000
007190     05  PV-VEHICL-COUNT             PIC S9(09)    VALUE ZERO.    00719000
007200     05  PV-SHIP-COUNT               PIC S9(09)    VALUE ZERO.    00720000
007201     05  PV-READ-COUNTER             PIC S9(09)    VALUE ZERO     00720100
007202                                                   COMP SYNC.     00720200
007203     05  PV-WRITE-COUNTER            PIC S9(09)    VALUE ZERO     00720300
007204                                                   COMP SYNC.     00720400
007205     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             00720500
007206                                                                  00720600
007207     05  PV-DB2-COUNT                PIC S9(09)    VALUE ZERO     00720700
007208                                                   COMP-3.        00720800
007209     05  PV-TMST-HOLD                PIC X(26).                   00720900
007210     05  PV-TMST-HOLD-R REDEFINES PV-TMST-HOLD.                   00721000
007211         10  PV-TMST-DATE            PIC X(10).                   00721100
007212         10  PV-TMST-TIME            PIC X(16).                   00721200
007213             88 PV-DP-TIME      VALUE '-00.01.00.000000'.         00721300
007214             88 PV-ET-TIME      VALUE '-00.02.00.000000'.         00721400
007215                                                                  00721500
007216 01  PV-ABEND-FIELDS.                                             00721600
007217     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'TRKUP093'.00721700
007218     05  PV-ABEND-CODE               PIC S9(04)  VALUE +0         00721800
007219                                                 COMP SYNC.       00721900
007220     05  PV-PARAGRAPH-NAME           PIC  X(30)  VALUE SPACES.    00722000
007221     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)  VALUE SPACES.    00722100
007222     05  PV-ABEND-PARAGRAPH          PIC  X(30)  VALUE SPACES.    00722200
007223     05  PV-ABEND-OPERATION          PIC  X(30)  VALUE SPACES.    00722300
007224     05  PV-DB2-OPER-ATTEMPTED       PIC  X(30)  VALUE SPACES.    00722400
007225     05  PV-DB2-OPERATION-MESSAGE-1  PIC  X(79)  VALUE SPACES.    00722500
007226     05  PV-DB2-OPERATION-MESSAGE-2  PIC  X(79)  VALUE SPACES.    00722600
007227     05  PV-DB2-OPERATION-MESSAGE-3  PIC  X(79)  VALUE SPACES.    00722700
007228     05  PV-DB2-OPERATION-MESSAGE-4  PIC  X(79)  VALUE SPACES.    00722800
007229     05  PV-SQLCODE                  PIC -Z(03)  VALUE ZERO.      00722900
007230     05  PV-NEW-STATUS-DTE           PIC  X(10)  VALUE SPACES.    00723000
007231                                                                  00723100
007232                                                                  00723200
007233***************************************************************** 00723300
007234*    SQL ABEND ROUTINE WORKING STORAGE                          * 00723400
007235***************************************************************** 00723500
007236     COPY DPWS004.                                                00723600
007237                                                                  00723700
007238     EXEC SQL                                                     00723800
007239        INCLUDE TTRIPST                                           00723900
007240     END-EXEC.                                                    00724000
007250                                                                  00725000
007260     EXEC SQL                                                     00726000
007270        INCLUDE TSHIPST                                           00727000
007280     END-EXEC.                                                    00728000
007290                                                                  00729000
007340***************************************************************** 00734000
007350*   DB2 SQL COMMUNICATION AREA                                  * 00735000
007360***************************************************************** 00736000
007370     EXEC SQL                                                     00737000
007380          INCLUDE SQLCA                                           00738000
007390     END-EXEC.                                                    00739000
007400                                                                  00740000
007500                                                                  00750000
007600******************************************************************00760000
007700 PROCEDURE DIVISION.                                              00770000
007800******************************************************************00780000
007900                                                                  00790000
008000 0000-PROGRAM-MAINLINE.                                           00800000
008100******************************************************************00810000
008200* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     00820000
008300*      PROGRAM.                                                   00830000
008400******************************************************************00840000
008500                                                                  00850000
008600     PERFORM 1000-INITIALIZE.                                     00860000
008700                                                                  00870000
008800     IF PS-MORE-TRIP                                              00880000
008900         PERFORM 2000-PROCESS-TRIP                                00890000
009000            UNTIL PS-EOF-TRIP                                     00900000
009100     END-IF.                                                      00910000
009200                                                                  00920000
009300     SET  PS-MORE-SHIP  TO  TRUE.                                 00930000
009400                                                                  00940000
009500     IF PS-MORE-SHIP                                              00950000
009600         PERFORM 2100-PROCESS-SHIP                                00960000
009700            UNTIL PS-EOF-SHIP                                     00970000
009800     END-IF.                                                      00980000
009900                                                                  00990000
010000     PERFORM 9000-EOJ-ROUTINE.                                    01000000
010100                                                                  01010000
010200     STOP RUN.                                                    01020000
010300                                                                  01030000
010400 1000-INITIALIZE.                                                 01040000
010500******************************************************************01050000
010600*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    01060000
010700*    -- OPEN FILES                                                01070000
010800******************************************************************01080000
010900                                                                  01090000
010910     DISPLAY '************************************************'   01091000
010920     DISPLAY '** TRKUP093'                                        01092000
010930     DISPLAY '** '                                                01093000
010940                                                                  01094000
010950     OPEN INPUT TRIP-FILE                                         01095000
010960                SHIP-FILE.                                        01096000
010970                                                                  01097000
010980 2000-PROCESS-TRIP.                                               01098000
010990******************************************************************01099000
011000*  PROCESS THE TRIP FILE.                                         01100000
011100******************************************************************01110000
011200                                                                  01120000
011300     PERFORM 8000-READ-TRIP.                                      01130000
011400                                                                  01140000
011500     IF PS-EOF-TRIP                                               01150000
011600         CONTINUE                                                 01160000
011700     ELSE                                                         01170000
011800         MOVE TR074-TRIP-ID        TO TRIPST-TRIP-ID              01180000
011900         MOVE 'DE'                 TO TRIPST-TRIP-STATUS-CDE      01190000
012000         MOVE TR074-NEW-STATUS-DTE TO TRIPST-STATUS-DTE           01200000
012100         MOVE '00:01:00'           TO TRIPST-STATUS-TME           01210000
012200         MOVE PC-TRKUP093          TO TRIPST-STATUS-UID           01220000
012300         MOVE TR074-OPER-UNT-ID    TO TRIPST-OPER-UNT-ID          01230000
012400         MOVE 1                    TO TRIPST-FCLTY-ID             01240000
012500         MOVE SPACES               TO TRIPST-FCLTY-AREA-ID        01250000
012600         MOVE TR074-NEW-STATUS-DTE TO PV-TMST-DATE                01260000
012700         SET  PV-DP-TIME           TO TRUE                        01270000
012800         MOVE PV-TMST-HOLD         TO TRIPST-CRE-TMST             01280000
012900                                                                  01290000
013000         PERFORM 8200-INSERT-TTRIPST                              01300000
013100                                                                  01310000
013200         MOVE TR074-TRIP-ID        TO TRIPST-TRIP-ID              01320000
013210         MOVE 'ET'                 TO TRIPST-TRIP-STATUS-CDE      01321000
013220         MOVE TR074-NEW-STATUS-DTE TO TRIPST-STATUS-DTE           01322000
013230         MOVE '00:02:00'           TO TRIPST-STATUS-TME           01323000
013240         MOVE PC-TRKUP093          TO TRIPST-STATUS-UID           01324000
013241         MOVE TR074-OPER-UNT-ID    TO TRIPST-OPER-UNT-ID          01324100
013242         MOVE 1                    TO TRIPST-FCLTY-ID             01324200
013243         MOVE SPACES               TO TRIPST-FCLTY-AREA-ID        01324300
013244         MOVE TR074-NEW-STATUS-DTE TO PV-TMST-DATE                01324400
013245         SET  PV-ET-TIME           TO TRUE                        01324500
013246         MOVE PV-TMST-HOLD         TO TRIPST-CRE-TMST             01324600
013247                                                                  01324700
013248         PERFORM 8200-INSERT-TTRIPST                              01324800
013249                                                                  01324900
013270     END-IF.                                                      01327000
013271                                                                  01327100
013272     IF  PV-COMMIT-CNT > 50                                       01327200
013273         PERFORM 8500-COMMIT                                      01327300
013274         MOVE ZEROES TO PV-COMMIT-CNT                             01327400
013275     END-IF.                                                      01327500
013276                                                                  01327600
013277                                                                  01327700
013278 2100-PROCESS-SHIP.                                               01327800
013279******************************************************************01327900
013280*  PROCESS THE SHIPMENT FILE.                                     01328000
013290******************************************************************01329000
013300                                                                  01330000
013310     PERFORM 8100-READ-SHIP.                                      01331000
013320                                                                  01332000
013330     IF PS-EOF-SHIP                                               01333000
013340         CONTINUE                                                 01334000
013350     ELSE                                                         01335000
013360         MOVE TR075-SHIPT-ID        TO SHIPST-SHIPT-ID            01336000
013370         MOVE 'DE'                  TO SHIPST-SHIPT-STATUS-CDE    01337000
013380         MOVE TR075-NEW-STATUS-DTE  TO SHIPST-STATUS-DTE          01338000
013390         MOVE '00:01:00'            TO SHIPST-STATUS-TME          01339000
013400         MOVE PC-TRKUP093           TO SHIPST-STATUS-UID          01340000
013500         MOVE SPACES                TO SHIPST-DELAY-RSN-CDE       01350000
013600         MOVE SPACES                TO SHIPST-CARR-STATUS-CDE     01360000
013700         MOVE SPACES                TO SHIPST-TIME-ZONE-CDE       01370000
013701         MOVE SPACES                TO SHIPST-CITY-NAME           01370100
013702         MOVE SPACES                TO SHIPST-STATE-CDE           01370200
013703         MOVE TR075-NEW-STATUS-DTE  TO PV-TMST-DATE               01370300
013704         SET  PV-DP-TIME            TO TRUE                       01370400
013705         MOVE PV-TMST-HOLD          TO SHIPST-CRE-TMST            01370500
013706                                                                  01370600
013707         PERFORM 8400-INSERT-TSHIPST                              01370700
013708                                                                  01370800
013709         MOVE TR075-SHIPT-ID        TO SHIPST-SHIPT-ID            01370900
013710         MOVE 'ET'                  TO SHIPST-SHIPT-STATUS-CDE    01371000
013711         MOVE TR075-NEW-STATUS-DTE  TO SHIPST-STATUS-DTE          01371100
013712         MOVE '00:02:00'            TO SHIPST-STATUS-TME          01371200
013713         MOVE PC-TRKUP093           TO SHIPST-STATUS-UID          01371300
013714         MOVE SPACES                TO SHIPST-DELAY-RSN-CDE       01371400
013715         MOVE SPACES                TO SHIPST-CARR-STATUS-CDE     01371500
013716         MOVE SPACES                TO SHIPST-TIME-ZONE-CDE       01371600
013717         MOVE SPACES                TO SHIPST-CITY-NAME           01371700
013718         MOVE SPACES                TO SHIPST-STATE-CDE           01371800
013719         MOVE TR075-NEW-STATUS-DTE  TO PV-TMST-DATE               01371900
013720         SET  PV-ET-TIME            TO TRUE                       01372000
013730         MOVE PV-TMST-HOLD          TO SHIPST-CRE-TMST            01373000
013740                                                                  01374000
013741         PERFORM 8400-INSERT-TSHIPST                              01374100
013742                                                                  01374200
013743     END-IF.                                                      01374300
013744                                                                  01374400
013745     IF  PV-COMMIT-CNT > 50                                       01374500
013746         PERFORM 8500-COMMIT                                      01374600
013747         MOVE ZEROES TO PV-COMMIT-CNT                             01374700
013748     END-IF.                                                      01374800
013749                                                                  01374900
013750                                                                  01375000
013760                                                                  01376000
013761 8000-READ-TRIP.                                                  01376100
013762******************************************************************01376200
013763*  READ THE TRIP DATA                                             01376300
013764******************************************************************01376400
013765     READ TRIP-FILE                                               01376500
013766          INTO  TR074-RECORD                                      01376600
013767          AT END                                                  01376700
013768             SET PS-EOF-TRIP TO TRUE.                             01376800
013769                                                                  01376900
013770     IF  PS-EOF-TRIP                                              01377000
013780         DISPLAY ' '                                              01378000
013790         CONTINUE                                                 01379000
013800     ELSE                                                         01380000
013900         ADD +1 TO PV-TRIP-COUNT                                  01390000
014000                                                                  01400000
014100         MOVE TR074-TRIP-ID     TO PV-DISP-TRIP-ID                01410000
014200         MOVE TR074-OPER-UNT-ID TO PV-DISP-OPER-UNT               01420000
014300         DISPLAY  'TTRIPST: '                                     01430000
014310                  TR074-OWNER-SCAC-ID   '/'                       01431000
014320                  TR074-VEH-NBR         ' '                       01432000
014330                  PV-DISP-TRIP-ID       ' '                       01433000
014340                  TR074-TRIP-STATUS-CDE ' '                       01434000
014350                  TR074-TRIP-STATUS-DTE ' '                       01435000
014360                  TR074-TRIP-STATUS-TME ' '                       01436000
014370                  TR074-TRIP-STATUS-UID ' '                       01437000
014380                  PV-DISP-OPER-UNT                                01438000
014390     END-IF.                                                      01439000
014400                                                                  01440000
014500                                                                  01450000
014600 8100-READ-SHIP.                                                  01460000
014610******************************************************************01461000
014620*  READ THE SHIP DATA                                             01462000
014630******************************************************************01463000
014640     READ SHIP-FILE                                               01464000
014650          INTO  TR075-RECORD                                      01465000
014660          AT END                                                  01466000
014670             SET PS-EOF-SHIP TO TRUE.                             01467000
014680                                                                  01468000
014690     IF  PS-EOF-SHIP                                              01469000
014700         DISPLAY ' '                                              01470000
014800         CONTINUE                                                 01480000
014900     ELSE                                                         01490000
015000         ADD +1 TO PV-SHIP-COUNT                                  01500000
015010                                                                  01501000
015020         MOVE TR075-TRIP-ID     TO PV-DISP-TRIP-ID                01502000
015030         MOVE TR075-SHIPT-ID    TO PV-DISP-SHIPMT-ID              01503000
015040         DISPLAY  'TSHIPST: '                                     01504000
015050                  PV-DISP-TRIP-ID        ' '                      01505000
015060                  PV-DISP-SHIPMT-ID      ' '                      01506000
015070                  TR075-SHIPT-STATUS-CDE ' '                      01507000
015080                  TR075-STATUS-DTE       ' '                      01508000
015090                  TR075-STATUS-TME       ' '                      01509000
015091     END-IF.                                                      01509100
015092                                                                  01509200
015093                                                                  01509300
015094******************************************************************01509400
015095* TTRIPST INSERTS                                                 01509500
015096******************************************************************01509600
015097 8200-INSERT-TTRIPST.                                             01509700
015098                                                                  01509800
015099     EXEC SQL                                                     01509900
015100          INSERT                                                  01510000
015101            INTO TTRIPST                                          01510102
015102                ( TRIP_ID                                         01510200
015103                , TRIP_STATUS_CDE                                 01510300
015104                , STATUS_DTE                                      01510400
015105                , STATUS_TME                                      01510500
015106                , STATUS_UID                                      01510600
015107                , OPER_UNT_ID                                     01510700
015108                , FCLTY_ID                                        01510800
015109                , FCLTY_AREA_ID                                   01510900
015110                , CRE_TMST)                                       01511000
015120          VALUES                                                  01512000
015130                (:TRIPST-TRIP-ID                                  01513000
015140                ,:TRIPST-TRIP-STATUS-CDE                          01514000
015150                ,:TRIPST-STATUS-DTE                               01515000
015160                ,:TRIPST-STATUS-TME                               01516000
015170                ,:TRIPST-STATUS-UID                               01517000
015180                ,:TRIPST-OPER-UNT-ID                              01518000
015190                ,:TRIPST-FCLTY-ID                                 01519000
015200                ,:TRIPST-FCLTY-AREA-ID                            01520000
015300                , CURRENT TIMESTAMP                               01530000
015400                )                                                 01540000
015500     END-EXEC.                                                    01550000
015600                                                                  01560000
015700     EVALUATE TRUE                                                01570000
015800         WHEN SQLCODE = ZERO                                      01580000
015900         WHEN SQLCODE = -803                                      01590000
016000              ADD +1 TO PV-TTRIPST-CNT                            01600000
016100                        PV-COMMIT-CNT                             01610000
016200                                                                  01620000
016300         WHEN OTHER                                               01630000
016400             MOVE '8200-WRITE-TTRIPST-SQL'                        01640000
016500                                       TO PV-ABEND-PARAGRAPH      01650000
016600             MOVE 'INSERT TTRIPST'     TO PV-ABEND-OPERATION      01660000
016700             PERFORM 9900-DB2-ABEND                               01670000
016800     END-EVALUATE.                                                01680000
016900                                                                  01690000
017000                                                                  01700000
017916******************************************************************01791600
017917* TSHIPST INSERTS                                                 01791700
017918******************************************************************01791800
017919 8400-INSERT-TSHIPST.                                             01791900
017920                                                                  01792000
017930     EXEC SQL                                                     01793000
017940          INSERT                                                  01794000
017950            INTO TSHIPST                                          01795002
017960                (SHIPT_ID                                         01796000
017970                ,SHIPT_STATUS_CDE                                 01797000
017980                ,STATUS_DTE                                       01798000
017990                ,STATUS_TME                                       01799000
018000                ,STATUS_UID                                       01800000
018100                ,DELAY_RSN_CDE                                    01810000
018200                ,CARR_STATUS_CDE                                  01820000
018300                ,TIME_ZONE_CDE                                    01830000
018400                ,CITY_NAME                                        01840000
018500                ,STATE_CDE                                        01850000
018600                ,CRE_TMST)                                        01860000
018700          VALUES                                                  01870000
018800                (:SHIPST-SHIPT-ID                                 01880000
018900                ,:SHIPST-SHIPT-STATUS-CDE                         01890000
019000                ,:SHIPST-STATUS-DTE                               01900000
019100                ,:SHIPST-STATUS-TME                               01910000
019200                ,:SHIPST-STATUS-UID                               01920000
019300                ,:SHIPST-DELAY-RSN-CDE                            01930000
019400                ,:SHIPST-CARR-STATUS-CDE                          01940000
019500                ,:SHIPST-TIME-ZONE-CDE                            01950000
019600                ,:SHIPST-CITY-NAME                                01960000
019700                ,:SHIPST-STATE-CDE                                01970000
019800                , CURRENT TIMESTAMP                               01980000
019900                )                                                 01990000
020000     END-EXEC.                                                    02000000
020100                                                                  02010000
020200     EVALUATE TRUE                                                02020000
020300         WHEN SQLCODE = ZERO                                      02030000
020400         WHEN SQLCODE = -803                                      02040000
020500              ADD +1 TO PV-TSHIPST-CNT                            02050000
020501                        PV-COMMIT-CNT                             02050100
020502                                                                  02050200
020503         WHEN OTHER                                               02050300
020504             MOVE '8400-INSERT-TSHIPST   '                        02050400
020505                                       TO PV-ABEND-PARAGRAPH      02050500
020506             MOVE 'INSERT TSHIPST'     TO PV-ABEND-OPERATION      02050600
020507             PERFORM 9900-DB2-ABEND                               02050700
020508     END-EVALUATE.                                                02050800
020509                                                                  02050900
020510                                                                  02051000
020520                                                                  02052000
020521******************************************************************02052100
020522*  COMMIT                                                         02052200
020523******************************************************************02052300
020524 8500-COMMIT.                                                     02052400
020525                                                                  02052500
020526     EXEC SQL                                                     02052600
020527         COMMIT                                                   02052700
020528     END-EXEC.                                                    02052800
020529                                                                  02052900
020530     DISPLAY ' '.                                                 02053000
020531     DISPLAY 'COMMIT'                                             02053100
020532     DISPLAY ' '.                                                 02053200
020533                                                                  02053300
020534                                                                  02053400
020535******************************************************************02053500
020536*  CLOSE OUTPUT FILE.                                             02053600
020537******************************************************************02053700
020538 9000-EOJ-ROUTINE.                                                02053800
020539     CLOSE TRIP-FILE                                              02053900
020540           SHIP-FILE.                                             02054000
020541                                                                  02054100
020542     DISPLAY 'TRKUP093 COUNTS'.                                   02054200
020543     DISPLAY ' '.                                                 02054300
020544     MOVE PV-TRIP-COUNT           TO PV-DISPLAY-COUNT             02054400
020545     DISPLAY 'TOTAL TRIP CNT:   '    PV-DISPLAY-COUNT.            02054500
020546     MOVE PV-TTRIPST-CNT          TO PV-DISPLAY-COUNT             02054600
020547     DISPLAY 'TTRIPST INSERTS:  '    PV-DISPLAY-COUNT.            02054700
020548     DISPLAY ' '.                                                 02054800
020549                                                                  02054900
020550     MOVE PV-SHIP-COUNT   TO PV-DISPLAY-COUNT                     02055000
020560     DISPLAY 'TOTAL SHIPMT CNT: '    PV-DISPLAY-COUNT.            02056000
020570     MOVE PV-TSHIPST-CNT          TO PV-DISPLAY-COUNT             02057000
020580     DISPLAY 'TSHIPST INSERTS:  '    PV-DISPLAY-COUNT.            02058000
020590     DISPLAY ' '.                                                 02059000
020600                                                                  02060000
020700***********************************************************       02070000
020800*                                                         *       02080000
020900***********************************************************       02090000
021000 9900-DB2-ABEND.                                                  02100000
021100                                                                  02110000
021200     MOVE SQLCODE TO PV-SQLCODE.                                  02120000
021300     DISPLAY '*** DB2 ERROR '.                                    02130000
021400     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       02140000
021500     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 02150000
021600     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               02160000
021700     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               02170000
021800     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       02180000
021900     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       02190000
022000     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       02200000
022100                                                                  02210000
022200     COPY DPPD004.                                                02220000
022300                                                                  02230000
022400     IF SQLCODE NOT = -911                                        02240000
022500         EXEC SQL                                                 02250000
022600              ROLLBACK                                            02260000
022700         END-EXEC                                                 02270000
022800     END-IF.                                                      02280000
022900                                                                  02290000
023000     MOVE +4013                  TO PV-ABEND-CODE.                02300000
023100     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02310000
023200                                                                  02320000
