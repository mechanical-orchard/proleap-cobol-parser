000100 IDENTIFICATION DIVISION.                                         00010086
000200                                                                  00020086
000300 PROGRAM-ID.      SAKUT109.                                       00030086
000400 AUTHOR.          COGNIZANT.                                      00040099
000500 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00050086
000600 DATE-WRITTEN.    08/24/2012.                                     00060099
000700 DATE-COMPILED.                                                   00070086
000800                                                                  00080086
000900******************************************************************00090086
001000*       REGISTERS WITH WRONG BUSINESS - EXTRACT                   00100086
001100******************************************************************00110086
001300*                                                                 00120086
001400*   THIS PROGRAM WILL EXTRACT THE DETAILS OF REGISTER WITH THE    00130086
001500*   WRONG BUSINESS DATE.IT WILL CREATE THE EMAIL OUTPUT FILE      00140099
001601*   THAT HAS TO BE SENT TO STORE SERVICE DELIVERY AND POS         00150086
001602*   SOFTWARE TEAM. IT WILL ALSO CREATE THE NETCOOL ALERT IF THERE 00160099
001603*   IS ANY REGISTERS WITH WRONG BUSINESS DATE.                    00170099
001604*                                                                 00180086
001605*   IT READS THE CONTROL CARD CONTAINING THE PREVIOUS TIMESTAMP   00190086
001606*   AND ANOTHER CONTROL CARD CONTAINING THE CUTOFF TIME. THE      00200086
001607*   AND ANOTHER CONTROL CARD CONTAINING THE PROCESSING DATE. THE  00210099
001608*   CURSOR WILL BE EXECUTED BASED ON THE CONTROL CARD TIMESTAMP   00220099
001609*   AND CURRENT TIMESTAMP. THE RECORDS FETCHED OUT OF THE CURSOR  00230099
001610*   WILL BE WRITTEN INTO THE EMAIL OUTPUT FILE.                   00240099
001700*                                                                 00250086
001800*   INPUT :                                                       00260086
001900*    1) COSA-PROCESSING DAY KEY TABLE       TEPDKEY               00270086
002700*    2) COSA-PARTITIONING TABLE             TEPPART               00280086
002800*    3) COSA-TRANSACTION TABLE              TEPTRN                00290086
002900*    4) LOCATION TABLE                      XST00001              00300087
003400*    5) CONTROL CARD 1-PREV TIMESTAMP       SACC122               00310087
003410*    6) CONTROL CARD 2-PROCESSING DATE      EPCC014               00320087
003411*    7) CONTROL CARD 3-CUTOFF TIME          SACC123               00330087
003412*    8) CONTROL CARD 4-CUTOFF TIME HOLIDAY  SACC124               00340087
003500*                                                                 00350086
003501*   OUTPUT:                                                       00360086
003502*    1) EMAIL OUTPUT FILE                                         00370086
003503*    2) CONTROL CARD 1(UPDATED)             SACC122               00380086
004500*************************** CHANGE LOG ***************************00390086
004600* AUTH     BY       DATE      DESCRIPTION                         00400086
004700* -------  -------  --------  ------------------------------------00410086
004800* CR32292    CTS    08-24-12  CREATED.                            00420099
CR7647*            CTS    03-18-15  MODIFIED THE PROGRAM TO TRIGGER     00430099
CR7647*                             NETCOOL ALERT WHEN THERE ARE        00440099
CR7647*                             MORE THAN ONE TRANSACTION           00450099
CR7647*                             WITH WRONG BUSINESS DATE            00460099
P51066*                                                                 00470099
P51066* CHG0120720 CTS    08-17-15  CHANGED THE CUT-OFF TIME FROM 4PM   00480099
P51066*                             TO  12PM.                           00490099
P51066*                                                                 00500099
004900******************************************************************00510086
005000                                                                  00520086
005100 ENVIRONMENT DIVISION.                                            00530086
005200 CONFIGURATION SECTION.                                           00540086
005300                                                                  00550086
005400 SOURCE-COMPUTER.        IBM-3090.                                00560086
005500 OBJECT-COMPUTER.        IBM-3090.                                00570086
005600                                                                  00580086
005700 INPUT-OUTPUT SECTION.                                            00590086
005800 FILE-CONTROL.                                                    00600086
005900                                                                  00610086
006000     SELECT CONTROL-CARD-IN-OUT  ASSIGN TO INP01.                 00620086
006100     SELECT CONTROL-CARD-IN2     ASSIGN TO INP02.                 00630086
006101     SELECT CONTROL-CARD-IN3     ASSIGN TO INP03.                 00640086
006102     SELECT CONTROL-CARD-IN4     ASSIGN TO INP04.                 00650087
006500     SELECT EMAIL-OUTPUT-FILE    ASSIGN TO OUT01.                 00660086
006500     SELECT EMAIL-OUTPUT-FILE2   ASSIGN TO OUT02.                 00670099
006900                                                                  00680086
007000 DATA DIVISION.                                                   00690086
007100 FILE SECTION.                                                    00700086
007200                                                                  00710086
010300 FD  CONTROL-CARD-IN-OUT                                          00720086
010400     RECORDING MODE IS F                                          00730086
010500     LABEL RECORDS ARE STANDARD                                   00740086
010600     BLOCK CONTAINS 0 CHARACTERS.                                 00750086
010700 01  CONTROL-CARD1-REC               PIC X(80).                   00760086
010701                                                                  00770086
010702 FD  CONTROL-CARD-IN2                                             00780086
010703     RECORDING MODE IS F                                          00790086
010704     LABEL RECORDS ARE STANDARD                                   00800086
010705     BLOCK CONTAINS 0 CHARACTERS.                                 00810086
010706 01  CONTROL-CARD2-REC               PIC X(80).                   00820086
010707                                                                  00830086
010708 FD  CONTROL-CARD-IN3                                             00840086
010709     RECORDING MODE IS F                                          00850086
010710     LABEL RECORDS ARE STANDARD                                   00860086
010711     BLOCK CONTAINS 0 CHARACTERS.                                 00870086
010712 01  CONTROL-CARD3-REC               PIC X(80).                   00880086
010713                                                                  00890086
010714 FD  CONTROL-CARD-IN4                                             00900087
010715     RECORDING MODE IS F                                          00910087
010716     LABEL RECORDS ARE STANDARD                                   00920087
010717     BLOCK CONTAINS 0 CHARACTERS.                                 00930087
010718 01  CONTROL-CARD4-REC               PIC X(80).                   00940087
010719                                                                  00950087
012510 FD  EMAIL-OUTPUT-FILE                                            00960099
012520     RECORDING MODE IS F                                          00970086
012530     LABEL RECORDS ARE STANDARD                                   00980086
012540     BLOCK CONTAINS 0 CHARACTERS.                                 00990086
012550 01  EMAIL-OUTPUT-REC                PIC X(80).                   01000086
012510 FD  EMAIL-OUTPUT-FILE2                                           01010099
012520     RECORDING MODE IS F                                          01020099
012530     LABEL RECORDS ARE STANDARD                                   01030099
012540     BLOCK CONTAINS 0 CHARACTERS.                                 01040099
012550 01  EMAIL-OUTPUT-REC2               PIC X(80).                   01050099
012700******************************************************************01060086
012800*                       WORKING STORAGE                           01070086
012900******************************************************************01080086
013000 WORKING-STORAGE SECTION.                                         01090086
013100                                                                  01100086
013200 01  W-START                         PIC  X(40)                   01110086
013300     VALUE 'SAKUT109 - WORKING STORAGE BEGINS HERE'.              01120086
013500                                                                  01130086
013600******************************************************************01140086
013700*                         SWITCHES                                01150086
013800******************************************************************01160086
013900 01  PS-PROGRAM-SWITCHES.                                         01170086
014000                                                                  01180086
014700     05  PS-END-OF-TRN-CSR-SW        PIC  X(01)  VALUE 'N'.       01190086
014800         88  PS-END-OF-TRN-CSR-Y                 VALUE 'Y'.       01200086
014900         88  PS-END-OF-TRN-CSR-N                 VALUE 'N'.       01210086
                                                                        01220099
014700     05  PS-END-OF-FUT-CSR-SW        PIC  X(01)  VALUE 'N'.       01230099
014800         88  PS-END-OF-FUT-CSR-Y                 VALUE 'Y'.       01240099
014900         88  PS-END-OF-FUT-CSR-N                 VALUE 'N'.       01250099
018000                                                                  01260086
018001     05  PS-END-OF-CARD1-FILE-SW     PIC  X(01)  VALUE 'N'.       01270086
018002         88  PS-END-OF-CARD1-FILE-Y              VALUE 'Y'.       01280086
018003                                                                  01290086
018004     05  PS-END-OF-CARD2-FILE-SW     PIC  X(01)  VALUE 'N'.       01300086
018005         88  PS-END-OF-CARD2-FILE-Y              VALUE 'Y'.       01310086
018006                                                                  01320086
018007     05  PS-END-OF-CARD3-FILE-SW     PIC  X(01)  VALUE 'N'.       01330086
018008         88  PS-END-OF-CARD3-FILE-Y              VALUE 'Y'.       01340086
018009                                                                  01350086
018010     05  PS-END-OF-CARD4-FILE-SW     PIC  X(01)  VALUE 'N'.       01360087
018011         88  PS-END-OF-CARD4-FILE-Y              VALUE 'Y'.       01370087
018012                                                                  01380087
019001******************************************************************01390086
019002*                         VARIABLES                               01400086
019003******************************************************************01410086
024300 01  PV-PROGRAM-VARIABLES.                                        01420086
024500     05  PV-CURR-TIMESTAMP           PIC X(26)  VALUE SPACES.     01430090
024501     05  PV-PREV-TIMESTAMP           PIC X(26)  VALUE SPACES.     01440090
024502     05  PV-PRCHG-DATE               PIC X(10)  VALUE SPACES.     01450087
024503     05  FILLER REDEFINES  PV-PRCHG-DATE.                         01460093
024504         10  PV-PRCHG-YYYY           PIC X(04).                   01470093
024505         10  PV-DASH1                PIC X(01).                   01480095
024506         10  PV-PRCHG-MM             PIC X(02).                   01490093
024507         10  PV-DASH2                PIC X(01).                   01500095
024508         10  PV-PRCHG-DD             PIC X(02).                   01510093
024509     05  PV-PRCHG-DATE-MINUS1        PIC X(10)  VALUE SPACES.     01520089
024510     05  PV-TRAN-DATE1               PIC X(10)  VALUE SPACES.     01530090
024511     05  PV-TRAN-DATE2               PIC X(10)  VALUE SPACES.     01540090
024512     05  PV-BLANK-LINE               PIC X(80)  VALUE SPACES.     01550099
024513     05  PV-CUTOFF-TIME              PIC X(08)  VALUE SPACES.     01560086
024514     05  PV-CUTOFF-TIME-SPLIT1       PIC X(08)  VALUE SPACES.     01570086
024515     05  PV-CUTOFF-TIME-SPLIT2       PIC X(08)  VALUE SPACES.     01580086
024600     05  PV-SAVE-ZONE                PIC X(03)  VALUE SPACES.     01590086
024610     05  PV-TRAN-COUNT               PIC S9(09)    COMP           01600086
024700                                                VALUE ZEROES.     01610086
024701******************************************************************01620091
024702* MISC ABEND - VARIABLES                                          01630091
024703******************************************************************01640091
024704 01  PV-MISC-ABEND-FIELDS.                                        01650091
024705     05  PV-PARAGRAPH-NAME            PIC X(30) VALUE SPACE.      01660091
024706     05  PV-OPERATION-MSG-1           PIC X(40) VALUE SPACE.      01670091
024707     05  PV-OPERATION-MSG-2           PIC X(40) VALUE SPACE.      01680091
024708     05  PV-DB2-OPERATION             PIC X(30) VALUE SPACE.      01690091
024709******************************************************************01700099
024710* EMAIL RECORD LAYOUT                                             01710099
024720******************************************************************01720099
024900 01  PV-EMAIL-RECORD.                                             01730086
025000     05  PV-EMAIL-HEADER1.                                        01740086
025200         10 FILLER                   PIC X(13)  VALUE             01750086
025300            'Store Zone : '.                                      01760086
025800         10 PV-EMAIL-STORE-ZN        PIC X(03).                   01770086
025900         10 FILLER                   PIC X(64)  VALUE SPACES.     01780086
026000     05  PV-EMAIL-HEADER2.                                        01790086
026200         10 FILLER                   PIC X(05)  VALUE             01800086
026300            'Store'.                                              01810086
026301         10 FILLER                   PIC X(04)  VALUE SPACES.     01820086
026302         10 FILLER                   PIC X(06)  VALUE             01830086
026303            'Reg ID'.                                             01840086
026304         10 FILLER                   PIC X(03)  VALUE SPACES.     01850086
026305         10 FILLER                   PIC X(10)  VALUE             01860086
026600            'Sales Date'.                                         01870086
026601         10 FILLER                   PIC X(04)  VALUE SPACES.     01880086
026602         10 FILLER                   PIC X(10)  VALUE             01890099
026603            'Trans Date'.                                         01900099
026604         10 FILLER                   PIC X(04)  VALUE SPACES.     01910086
026605         10 FILLER                   PIC X(08)  VALUE             01920086
026606            'Tran cnt'.                                           01930086
026700         10 FILLER                   PIC X(27)  VALUE SPACES.     01940086
026800     05  PV-EMAIL-HEADER3.                                        01950086
027000         10 FILLER                   PIC X(70)  VALUE ALL '-'.    01960099
027010         10 FILLER                   PIC X(10)  VALUE spaces.     01970099
027100     05  PV-EMAIL-DETAIL.                                         01980086
027200         10 FILLER                   PIC X(01)  VALUE SPACES.     01990086
027300         10 PV-EMAIL-STORE           PIC X(04).                   02000086
027400         10 FILLER                   PIC X(05)  VALUE SPACES.     02010086
027500         10 PV-EMAIL-REG-ID          PIC X(04).                   02020086
027600         10 FILLER                   PIC X(04)  VALUE SPACES.     02030086
027601         10 PV-EMAIL-SLS-DTE         PIC X(10).                   02040086
027602         10 FILLER                   PIC X(04)  VALUE SPACES.     02050086
027603         10 PV-EMAIL-TRN-DTE         PIC X(10).                   02060086
027604         10 FILLER                   PIC X(05)  VALUE SPACES.     02070086
027605         10 PV-EMAIL-TRN-CNT         PIC 9(04).                   02080086
027606                                                                  02090086
027607******************************************************************02100086
027608*   RECORD LAYOUT FOR THE CONTROL CARD                            02110086
027609******************************************************************02120086
027610 01  CC-CONTROL-CARD1.                                            02130086
027611     05 FILLER                       PIC X(01).                   02140086
027612     05 CC-PREV-TIMESTAMP            PIC X(26).                   02150086
027613     05 FILLER                       PIC X(53)  VALUE SPACES.     02160086
027614                                                                  02170086
027615 01  CC-CONTROL-CARD2.                                            02180086
027620     05 FILLER                       PIC X(20).                   02190087
027621     05 CC-PRCHG-DATE-CYMD           PIC X(08).                   02200087
027630     05 FILLER             REDEFINES CC-PRCHG-DATE-CYMD.          02210087
027640        10 CC-PRCHG-YEAR             PIC X(04).                   02220088
027650        10 CC-PRCHG-MONTH            PIC X(02).                   02230087
027651        10 CC-PRCHG-DAY              PIC X(02).                   02240087
027652     05 FILLER                       PIC X(52).                   02250087
027653                                                                  02260086
027654 01  CC-CONTROL-CARD3.                                            02270086
027655     05 CC-CUTOFF-TIME               PIC X(08).                   02280087
027656     05 FILLER                       PIC X(72)  VALUE SPACES.     02290086
027657                                                                  02300086
027658 01  CC-CONTROL-CARD4.                                            02310087
027659     05 CC-HDAY-DATE                 PIC X(10).                   02320087
027660     05 FILLER                       PIC X(01)  VALUE SPACES.     02330087
027661     05 CC-HDAY-CUTOFF-TIME          PIC X(08).                   02340087
027662     05 FILLER                       PIC X(61)  VALUE SPACES.     02350087
027663                                                                  02360087
027664******************************************************************02370086
027665*                        ACCUMULATORS                             02380086
027666******************************************************************02390086
027667 01  PA-PROGRAM-ACCUMULATORS.                                     02400086
027668     05  PA-LATE-TRAN-COUNT          PIC S9(9) VALUE ZEROES COMP. 02410086
027668     05  PA-FUT-TRAN-COUNT           PIC S9(9) VALUE ZEROES COMP. 02420099
027669     05  PA-RECORDS-WRITTEN          PIC S9(9) VALUE ZEROES COMP. 02430086
027670******************************************************************02440086
027671*                          CONSTANTS                              02450086
027672******************************************************************02460086
027673 01  PC-PROGRAM-CONSTANTS.                                        02470086
027674     05  PC-PROGRAM-NAME             PIC  X(08) VALUE 'SAKUT109'. 02480099
027675     05  PC-ONE                      PIC  9(01) VALUE 1.          02490099
027676                                                                  02500086
033000******************************************************************02510086
033100*                        ERROR HANDLING                           02520086
033200******************************************************************02530086
033300 01  ABEND-CODE                  PIC S9(4) VALUE ZEROS COMP SYNC. 02540086
033400     88  ABEND-4001-WRITE-ERROR            VALUE +4001.           02550086
033500     88  ABEND-4002-READ-ERROR             VALUE +4002.           02560086
033600     88  ABEND-4003-CTRL-CARD-ERROR        VALUE +4003.           02570086
033700     88  ABEND-4004-TABLE-ERROR            VALUE +4004.           02580086
033800     88  ABEND-4005-OPEN-ERROR             VALUE +4005.           02590086
033900     88  ABEND-4006-CLOSE-ERROR            VALUE +4006.           02600086
034000     88  ABEND-4007-SEQUENCE-ERROR         VALUE +4007.           02610086
034100     88  ABEND-4008-DATA-ERROR             VALUE +4008.           02620086
034200     88  ABEND-4009-CARD-ERROR             VALUE +4009.           02630086
034500     88  ABEND-4013-DB2-ERROR              VALUE +4013.           02640086
034600     88  ABEND-4019-DATE-ROUTINE-ERROR     VALUE +4019.           02650086
034700     88  ABEND-4444-FORCED-ABEND           VALUE +4444.           02660086
034800                                                                  02670086
034900******************************************************************02680091
035000* NETCOOL MESSAGE LAYOUT                                          02690091
035100******************************************************************02700091
035200     COPY ISWS003.                                                02710091
035300                                                                  02720091
036200******************************************************************02730086
036201*   DATE CONVERSION COPYBOOK                                      02740086
036202******************************************************************02750086
036203     COPY DPWS500.                                                02760086
036204                                                                  02770086
036205******************************************************************02780086
036300* DPWS004 VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004 02790086
036400******************************************************************02800086
036500     COPY DPWS004.                                                02810086
036600                                                                  02820086
037200******************************************************************02830086
037300* DB2 MESSAGE AREA                                                02840086
037400******************************************************************02850086
037500     COPY SQLCA2.                                                 02860086
037600                                                                  02870086
037700******************************************************************02880086
037800* STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                 02890086
037900******************************************************************02900086
038000     EXEC SQL                                                     02910086
038100         INCLUDE SQLCA                                            02920086
038200     END-EXEC.                                                    02930086
038201                                                                  02940086
038202******************************************************************02950086
038203*  DB2 TABLE TEPPART - PARTITION TABLE                            02960086
038204******************************************************************02970086
038205     EXEC SQL                                                     02980086
038206          INCLUDE TEPPART                                         02990086
038207     END-EXEC.                                                    03000086
038208                                                                  03010086
038209******************************************************************03020086
038210*  DB2 TABLE TEPDKEY - PROCESSING DAY KEY TABLE                   03030086
038211******************************************************************03040086
038212     EXEC SQL                                                     03050086
038213          INCLUDE TEPDKEY                                         03060086
038214     END-EXEC.                                                    03070086
038215                                                                  03080086
038216******************************************************************03090086
038217*  DB2 TABLE TEPTRN - TRANSACTION TABLE                           03100086
038218******************************************************************03110086
038219     EXEC SQL                                                     03120086
038220          INCLUDE TEPTRN                                          03130086
038221     END-EXEC.                                                    03140086
038222                                                                  03150086
038223******************************************************************03160086
038224*  DB2 TABLE XST_LOC - LOCATION TABLE                             03170086
038225******************************************************************03180086
038226     EXEC SQL                                                     03190086
038227          INCLUDE XST00001                                        03200086
038228     END-EXEC.                                                    03210086
038229                                                                  03220086
068000******************************************************************03230086
068100* LATE-TRAN-CSR - REGISTER WITH WRONG BUSINESS DATE               03240086
068110*                 EXTRACTS LATE TRANSACTION                       03250086
068200******************************************************************03260086
068300     EXEC SQL                                                     03270086
068400        DECLARE LATE-TRAN-CSR CURSOR FOR                          03280086
068500           SELECT  L.STD_TM_ZN_CDE                                03290086
068600                  ,T.STR_NBR                                      03300086
068700                  ,T.RGST_ID                                      03310086
069100                  ,T.SLS_DTE                                      03320086
069200                  ,T.TRN_DTE                                      03330086
069210                  ,COUNT(T.TRN_NBR) AS CNT_OF_TRN                 03340086
069310             FROM  TEPDKEY K                                      03350086
069320                  ,TEPPART P                                      03360086
069400                  ,TEPTRN  T                                      03370086
069500                  ,XST_LOC L                                      03380086
069600            WHERE  K.PRCG_DTE     = :PV-PRCHG-DATE                03390090
069710              AND  P.SLS_DTE      = K.SLS_DTE                     03400086
069800              AND  T.PARTN_NBR    = P.PARTN_NBR                   03410086
069900              AND  T.STR_NBR      = K.STR_NBR                     03420086
070100              AND  T.RGST_ID      = K.RGST_ID                     03430086
070200              AND  T.TRN_NBR      = K.TRN_NBR                     03440086
070300              AND  T.STRT_TM      = K.STRT_TM                     03450086
070400              AND  T.SLS_CORR_SEQ_NBR = K.SLS_CORR_SEQ_NBR        03460086
070410              AND  T.TRN_TYP_CDE NOT IN ('44','64')               03470086
070500              AND  T.CRE_TMST    >= :PV-PREV-TIMESTAMP            03480090
070510              AND  T.CRE_TMST    <  :PV-CURR-TIMESTAMP            03490090
070600              AND  ((T.TRN_DTE    = :PV-TRAN-DATE1 AND            03500090
070700                     T.STRT_TM    > :PV-CUTOFF-TIME-SPLIT1)       03510086
070800                                OR                                03520086
070900                    (T.TRN_DTE    = :PV-TRAN-DATE2 AND            03530090
070901                     T.STRT_TM    > :PV-CUTOFF-TIME-SPLIT2))      03540090
071100              AND  T.STR_NBR      = L.LOC_NBR                     03550086
                    AND  T.POS_CPBL_LVL_NBR = 79                        03551099
071200           GROUP BY T.STR_NBR,                                    03560099
071300                    T.RGST_ID,                                    03570099
071400                    T.SLS_DTE,                                    03580099
071500                    T.TRN_DTE,                                    03590099
071600                    L.STD_TM_ZN_CDE                               03600099
CR7647           HAVING COUNT(T.TRN_NBR) > 1                            03610099
071700           ORDER BY L.STD_TM_ZN_CDE,                              03620086
071800                    T.STR_NBR,                                    03630086
071900                    CNT_OF_TRN DESC,                              03640086
071901                    T.RGST_ID,                                    03650086
071902                    T.SLS_DTE,                                    03660086
071903                    T.TRN_DTE DESC                                03670086
071904           WITH UR                                                03680086
071905     END-EXEC.                                                    03690086
068000******************************************************************03700099
068100* FUT-TRAN-CSR - REGISTER WITH WRONG TRANSACTION DATE             03710099
068200******************************************************************03720099
068300     EXEC SQL                                                     03730099
068400        DECLARE FUT-TRAN-CSR CURSOR FOR                           03740099
068500           SELECT  L.STD_TM_ZN_CDE                                03750099
068600                  ,T.STR_NBR                                      03760099
068700                  ,T.RGST_ID                                      03770099
069100                  ,T.SLS_DTE                                      03780099
069200                  ,T.TRN_DTE                                      03790099
069210                  ,COUNT(T.TRN_NBR) AS CNT_OF_TRN                 03800099
069320             FROM  TEPPART P                                      03810099
069400                  ,TEPTRN  T                                      03820099
069500                  ,XST_LOC L                                      03830099
069600            WHERE  P.SLS_DTE      = :PV-PRCHG-DATE                03840099
069800              AND  T.PARTN_NBR    = P.PARTN_NBR                   03850099
070410              AND  T.TRN_TYP_CDE IN ('01','02','11','12','24')    03860099
070500              AND  T.CRE_TMST    >= :PV-PREV-TIMESTAMP            03870099
070510              AND  T.CRE_TMST    <  :PV-CURR-TIMESTAMP            03880099
070600              AND  T.TRN_DTE     > T.SLS_DTE                      03890099
071100              AND  T.STR_NBR      = L.LOC_NBR                     03900099
                    AND  T.STRT_TM > '01.00.00'                         03901099
                    AND  T.OMNI_CHNL_FFLMT_TYP_CDE IS NULL              03910099
                    AND  T.POS_CPBL_LVL_NBR = 79                        03911099
071200           GROUP BY T.STR_NBR,                                    03920099
071300                    T.RGST_ID,                                    03930099
071400                    T.SLS_DTE,                                    03940099
071500                    T.TRN_DTE,                                    03950099
071600                    L.STD_TM_ZN_CDE                               03960099
CR7647           HAVING COUNT(T.TRN_NBR) > 1                            03970099
071700           ORDER BY L.STD_TM_ZN_CDE,                              03980099
071800                    T.STR_NBR,                                    03990099
071900                    CNT_OF_TRN DESC,                              04000099
071901                    T.RGST_ID,                                    04010099
071902                    T.SLS_DTE,                                    04020099
071903                    T.TRN_DTE DESC                                04030099
071904           WITH UR                                                04040099
071905     END-EXEC.                                                    04050099
068000******************************************************************04060099
071906                                                                  04070099
071907 PROCEDURE DIVISION.                                              04080086
071908******************************************************************04090086
071909* MAIN DRIVER                                                     04100086
071910******************************************************************04110086
071911 0000-MAINLINE.                                                   04120086
071912                                                                  04130086
071913     PERFORM 1000-INITIALIZE.                                     04140086
071914                                                                  04150086
071915     PERFORM 2000-PROCESS-TRANSACTION.                            04160086
071916                                                                  04170086
085100     PERFORM 3000-END-OF-PROGRAM.                                 04180086
085101                                                                  04190086
085102     STOP RUN.                                                    04200086
085103                                                                  04210086
085104******************************************************************04220086
085105* 1000-INITIALIZE.                                                04230086
085106*      PERFORMS TASK INITIATION PROCESSING                        04240086
085107******************************************************************04250086
085108 1000-INITIALIZE.                                                 04260086
085109                                                                  04270086
085110     OPEN I-O    CONTROL-CARD-IN-OUT.                             04280086
085111     OPEN INPUT  CONTROL-CARD-IN2                                 04290086
085112                 CONTROL-CARD-IN3                                 04300087
085113                 CONTROL-CARD-IN4.                                04310087
085114     OPEN OUTPUT EMAIL-OUTPUT-FILE EMAIL-OUTPUT-FILE2.            04320099
085115                                                                  04330086
085118     PERFORM 1010-GET-CURRENT-TIMESTAMP.                          04340090
085119                                                                  04350087
085120     PERFORM 1020-READ-CONTROL-CARD1.                             04360090
085121                                                                  04370086
085122     PERFORM 1030-READ-CONTROL-CARD2.                             04380090
085123                                                                  04390090
085124     PERFORM 1040-CALC-PRCHGDT-LESS1.                             04400090
085125                                                                  04410086
085126     PERFORM 1050-READ-CONTROL-CARD3.                             04420090
085127                                                                  04430086
085128     PERFORM 1060-READ-CONTROL-CARD4.                             04440090
085129                                                                  04450090
085172     PERFORM 7100-OPEN-LATE-TRAN-CSR.                             04460086
085173                                                                  04470086
085174     PERFORM 7200-FETCH-LATE-TRAN-CSR.                            04480086
085175                                                                  04490086
085176                                                                  04500086
086604******************************************************************04510087
086605* 1010-GET-CURRENT-TIMESTAMP.                                     04520090
086606*      GET THE CURRENT TIMESTAMP USING THE DB2.                   04530087
086607******************************************************************04540087
086608 1010-GET-CURRENT-TIMESTAMP.                                      04550090
086609                                                                  04560087
086610     EXEC SQL                                                     04570087
086611         SET :PV-CURR-TIMESTAMP = CURRENT TIMESTAMP               04580090
086612     END-EXEC.                                                    04590087
086613                                                                  04600087
086614     EVALUATE TRUE                                                04610087
086615         WHEN SQLCODE = +0                                        04620087
086616             DISPLAY 'CURRENT TIMESTAMP  =  ' PV-CURR-TIMESTAMP   04630090
086617                                                                  04640087
086618         WHEN OTHER                                               04650087
086619             MOVE '1010-GET-CURRENT-TIMESTAMP      '              04660090
086700                              TO PV-PARAGRAPH-NAME                04670087
086800             MOVE 'RETRIEVE CURRENT TIMESTAMP     '               04680087
086900                              TO PV-DB2-OPERATION                 04690087
087000             PERFORM 9900-SQL-ABEND                               04700087
087001     END-EVALUATE.                                                04710087
087002******************************************************************04720086
087003* 1020-READ-CONTROL-CARD1.                                        04730090
087004*      READS THE CONTROL CARD AND GET THE PREVIOUS TIMESTAMP.     04740099
087005******************************************************************04750086
087006 1020-READ-CONTROL-CARD1.                                         04760090
087007                                                                  04770086
087008     READ CONTROL-CARD-IN-OUT INTO CC-CONTROL-CARD1               04780086
087009        AT END                                                    04790086
087010           SET PS-END-OF-CARD1-FILE-Y TO TRUE.                    04800086
087011                                                                  04810086
087012     IF  PS-END-OF-CARD1-FILE-Y                                   04820099
087013         MOVE '1020-READ-CONTROL-CARD1' TO PV-PARAGRAPH-NAME      04830099
087014         MOVE 'EMPTY CONTROL CARD1 '    TO PV-OPERATION-MSG-1     04840086
087015         MOVE 'PREV TMST MISSING   '    TO PV-OPERATION-MSG-2     04850090
087016         SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                   04860086
087017         PERFORM 9999-ABEND                                       04870086
087018     END-IF.                                                      04880086
087019     MOVE CC-PREV-TIMESTAMP             TO PV-PREV-TIMESTAMP.     04890090
087020     DISPLAY 'PREVIOUS TIMESTAMP =  ' CC-PREV-TIMESTAMP.          04900086
087021                                                                  04910086
087022******************************************************************04920086
087023* 1030 - GET THE PROCESSING DATE FROM THE CONTROL CARD EPCC014    04930090
087024******************************************************************04940086
087025 1030-READ-CONTROL-CARD2.                                         04950090
087026                                                                  04960086
087027     READ CONTROL-CARD-IN2    INTO CC-CONTROL-CARD2               04970086
087028        AT END                                                    04980086
087029           SET PS-END-OF-CARD2-FILE-Y   TO TRUE.                  04990086
087030                                                                  05000086
087031     IF  PS-END-OF-CARD2-FILE-Y                                   05010099
087032         MOVE '1030-READ-CONTROL-CARD2' TO PV-PARAGRAPH-NAME      05020090
087033         MOVE 'EMPTY CONTROL CARD2    ' TO PV-OPERATION-MSG-1     05030090
087034         MOVE 'PROCESSING DATE MISSING' TO PV-OPERATION-MSG-2     05040090
087035         SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                   05050086
087036         PERFORM 9999-ABEND                                       05060086
087037     END-IF.                                                      05070086
087038                                                                  05080086
087039     MOVE CC-PRCHG-YEAR                 TO PV-PRCHG-YYYY.         05090088
087040     MOVE CC-PRCHG-MONTH                TO PV-PRCHG-MM.           05100088
087041     MOVE CC-PRCHG-DAY                  TO PV-PRCHG-DD.           05110088
087042     MOVE '-'                           TO PV-DASH1               05120095
087043                                           PV-DASH2.              05130095
087044     DISPLAY 'PROCESSING DATE    =  ' PV-PRCHG-DATE.              05140088
087045                                                                  05150086
087046******************************************************************05160090
087047* 1040-CALC-PRCHGDT-LESS1.                                        05170090
087048*      CALCULATE THE PROCESSING DATE - 1 DAY                      05180090
087049******************************************************************05190090
087050 1040-CALC-PRCHGDT-LESS1.                                         05200090
087051                                                                  05210090
087052     SET DPG51-ACTUAL-CALENDAR-ONLY                               05220090
087053         DPG51-DECREMENT-DATE                                     05230090
087054         DPG52-LK-DTE-ISO-FMT    TO TRUE.                         05240090
087055                                                                  05250090
087056     MOVE PC-ONE                 TO DPG51-INCR-DECR-DAYS-9.       05260093
087057     MOVE PV-PRCHG-DATE          TO DPG52-LK-DATE-INPUT.          05270094
087058     MOVE 'ERROR SUBTRACTING 1 DAYS FROM THE '                    05280090
087059                                 TO PV-OPERATION-MSG-1.           05290090
087060     MOVE 'PROCESSING DATE '     TO PV-OPERATION-MSG-2.           05300090
087061                                                                  05310090
087062     PERFORM 9700-CALENDAR-ROUTINE.                               05320090
087063                                                                  05330090
087064     MOVE DPG55-DB2-ISO-DATE-FMT TO  PV-PRCHG-DATE-MINUS1.        05340090
087065     DISPLAY 'PROCESSING DATE -1 =  ' PV-PRCHG-DATE-MINUS1.       05350099
087066                                                                  05360090
087067******************************************************************05370086
087068* 1050 - GET THE CUT OFF TIME DEFINED IN THE CONTROL CARD         05380090
087069*        FOR NORMAL DAYS                                          05390090
087070******************************************************************05400086
087071 1050-READ-CONTROL-CARD3.                                         05410090
087072                                                                  05420086
087073     READ CONTROL-CARD-IN3    INTO CC-CONTROL-CARD3               05430086
087074        AT END                                                    05440086
087075           SET PS-END-OF-CARD3-FILE-Y   TO TRUE.                  05450086
087076                                                                  05460086
087077     IF  PS-END-OF-CARD3-FILE-Y                                   05470099
087078         MOVE '1050-READ-CONTROL-CARD3' TO PV-PARAGRAPH-NAME      05480090
087079         MOVE 'EMPTY CONTROL CARD3    ' TO PV-OPERATION-MSG-1     05490090
087080         MOVE 'CUTTOFF TIME MISSING   ' TO PV-OPERATION-MSG-2     05500090
087081         SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                   05510086
087082         PERFORM 9999-ABEND                                       05520086
087083     END-IF.                                                      05530086
087084     MOVE  CC-CUTOFF-TIME               TO PV-CUTOFF-TIME.        05540099
087085                                                                  05550086
087086******************************************************************05560090
087087* 1060 - GET THE CUT OFF TIME DEFINED IN THE CONTROL CARD         05570090
087088*        FOR HOLIDAYS                                             05580090
087089*        CHECK IF THE CONTROL CARD DATE IS MATCHING WITH THE      05590090
087090*        PROCESSING DATE - 1 DAY. IF YES, CUT OFF TIME CORRESPONDI05600090
087091*        TO THE DATE TO BE USED FOR PROCESSING.                   05610090
087092******************************************************************05620090
087100 1060-READ-CONTROL-CARD4.                                         05630090
087101                                                                  05640090
087102     READ CONTROL-CARD-IN4    INTO CC-CONTROL-CARD4               05650090
087103        AT END                                                    05660090
087104           SET PS-END-OF-CARD4-FILE-Y   TO TRUE.                  05670090
087105                                                                  05680090
087106     IF  PS-END-OF-CARD4-FILE-Y                                   05690099
087107         DISPLAY ' ** EMPTY CONTROL CARD 4 ** '                   05700090
087108         DISPLAY ' CUTOFF TIME NOT DEFINED FOR HOLIDAY '          05710090
087109         DISPLAY ' DEFAULT CUT OFF TIME WILL BE CONSIDERED'       05720090
087110         MOVE CC-CUTOFF-TIME            TO PV-CUTOFF-TIME         05730099
087120     END-IF.                                                      05740090
087130                                                                  05750099
087140     PERFORM UNTIL CC-HDAY-DATE >= PV-PRCHG-DATE-MINUS1           05760099
087141                OR PS-END-OF-CARD4-FILE-Y                         05770099
087142        READ CONTROL-CARD-IN4    INTO CC-CONTROL-CARD4            05780099
087143          AT END                                                  05790099
087144             SET PS-END-OF-CARD4-FILE-Y TO TRUE                   05800099
087145        END-READ                                                  05810099
087146     END-PERFORM.                                                 05820099
087147                                                                  05830099
087148     IF NOT  PS-END-OF-CARD4-FILE-Y                               05840099
087149        AND  PV-PRCHG-DATE-MINUS1 = CC-HDAY-DATE                  05850099
087150        MOVE CC-HDAY-CUTOFF-TIME        TO PV-CUTOFF-TIME         05860099
087151     END-IF.                                                      05870090
087152                                                                  05880090
P51066     IF PV-CUTOFF-TIME >= '00.00.00'  AND                         05890099
P51066        PV-CUTOFF-TIME <= '09.00.00'                              05900099
087155        MOVE PV-PRCHG-DATE              TO PV-TRAN-DATE1          05910099
087156                                           PV-TRAN-DATE2          05920099
087157        MOVE PV-CUTOFF-TIME             TO PV-CUTOFF-TIME-SPLIT1  05930099
087158                                           PV-CUTOFF-TIME-SPLIT2  05940099
087159     END-IF                                                       05950090
087160                                                                  05960090
P51066     IF PV-CUTOFF-TIME >= '12.00.00'  AND                         05970099
P51066        PV-CUTOFF-TIME <= '24.00.00'                              05980099
087180        MOVE PV-PRCHG-DATE-MINUS1       TO PV-TRAN-DATE1          05990099
087181        MOVE PV-PRCHG-DATE              TO PV-TRAN-DATE2          06000099
087182        MOVE PV-CUTOFF-TIME             TO PV-CUTOFF-TIME-SPLIT1  06010099
087183        MOVE '00.00.00'                 TO PV-CUTOFF-TIME-SPLIT2  06020099
087184     END-IF.                                                      06030090
087185                                                                  06040090
087186     DISPLAY 'CUT OFF TIME       =  ' PV-CUTOFF-TIME.             06050099
087187                                                                  06060090
087188******************************************************************06070086
087189* 2000- PROCESS-TRANSACTION                                       06080086
087190*       PROCESS LATE TRANSACTION & FUTURE DATED TRANSACTION       06090086
087191******************************************************************06100086
087192 2000-PROCESS-TRANSACTION.                                        06110086
087193                                                                  06120086
087194     PERFORM 2100-PROCESS-LATE-TRAN                               06130086
087195       UNTIL PS-END-OF-TRN-CSR-Y.                                 06140086
087196                                                                  06150086
087197     IF  PA-LATE-TRAN-COUNT > 0                                   06160091
087199         PERFORM 2400-WRITE-NETCOOL-ALERT                         06170099
087200     END-IF.                                                      06180091
                                                                        06190099
           INITIALIZE PV-EMAIL-DETAIL PV-SAVE-ZONE.                     06200099
                                                                        06210099
           PERFORM 7400-OPEN-FUT-TRAN-CSR.                              06220099
                                                                        06230099
           PERFORM 7500-FETCH-FUT-TRAN-CSR.                             06240099
                                                                        06250099
087194     PERFORM 2200-PROCESS-FUT-TRAN                                06260099
087195       UNTIL PS-END-OF-FUT-CSR-Y.                                 06270099
                                                                        06280099
087197     IF  PA-FUT-TRAN-COUNT > 0                                    06290099
087199         PERFORM 2500-WRITE-NETCOOL-ALERT                         06300099
087200     END-IF.                                                      06310099
092000                                                                  06320086
092001******************************************************************06330086
092002* 2100-PROCESS-LATE-TRAN                                          06340086
092003*       PROCESS LATE TRANSACTION - CORRECTIONS                    06350086
092004******************************************************************06360086
092005 2100-PROCESS-LATE-TRAN.                                          06370086
092006                                                                  06380086
092007      PERFORM 2300-POPULATE-OUTPUT-RECORD.                        06390099
092007      PERFORM 6200-WRITE-EMAIL-DETAIL.                            06400099
092008                                                                  06410086
092009      PERFORM 7200-FETCH-LATE-TRAN-CSR.                           06420086
092001******************************************************************06430099
092002* 2200-PROCESS-LATE-TRAN                                          06440099
092003*       PROCESS LATE TRANSACTION - CORRECTIONS                    06450099
092004******************************************************************06460099
092005 2200-PROCESS-FUT-TRAN.                                           06470099
092006                                                                  06480099
092007      PERFORM 2350-POPULATE-OUTPUT-RECORD                         06490099
092007      PERFORM 6250-WRITE-EMAIL-DETAIL.                            06500099
092008                                                                  06510099
092009      PERFORM 7500-FETCH-FUT-TRAN-CSR.                            06520099
092502******************************************************************06530086
092503* 2300-POPULATE-OUTPUT-RECORD                                     06540086
092504*      POPULATE EMAIL OUTPUT RECORD                               06550086
092505******************************************************************06560086
092506 2300-POPULATE-OUTPUT-RECORD.                                     06570086
092507                                                                  06580086
092508      IF XST00001-STD-TM-ZN-CDE NOT = PV-SAVE-ZONE                06590086
092509         MOVE  XST00001-STD-TM-ZN-CDE TO PV-EMAIL-STORE-ZN        06600086
092510         MOVE  XST00001-STD-TM-ZN-CDE TO PV-SAVE-ZONE             06610086
092540         PERFORM 6000-WRITE-BLANK-LINE                            06620099
092541         PERFORM 6100-WRITE-EMAIL-HEADER                          06630099
092550      END-IF.                                                     06640086
092560                                                                  06650086
092570      MOVE EPTRN-STR-NBR              TO PV-EMAIL-STORE.          06660099
092580      MOVE EPTRN-RGST-ID              TO PV-EMAIL-REG-ID.         06670099
092581      MOVE EPTRN-SLS-DTE              TO PV-EMAIL-SLS-DTE.        06680099
092582      MOVE EPTRN-TRN-DTE              TO PV-EMAIL-TRN-DTE.        06690099
092583      MOVE PV-TRAN-COUNT              TO PV-EMAIL-TRN-CNT.        06700099
092591                                                                  06710099
092502******************************************************************06720099
092503* 2350-POPULATE-OUTPUT-RECORD                                     06730099
092504*      POPULATE EMAIL OUTPUT RECORD                               06740099
092505******************************************************************06750099
092506 2350-POPULATE-OUTPUT-RECORD.                                     06760099
092507                                                                  06770099
092508      IF XST00001-STD-TM-ZN-CDE NOT = PV-SAVE-ZONE                06780099
092509         MOVE  XST00001-STD-TM-ZN-CDE TO PV-EMAIL-STORE-ZN        06790099
092510         MOVE  XST00001-STD-TM-ZN-CDE TO PV-SAVE-ZONE             06800099
092541         PERFORM 6150-WRITE-EMAIL-HEADER                          06810099
092550      END-IF.                                                     06820099
092560                                                                  06830099
092570      MOVE EPTRN-STR-NBR              TO PV-EMAIL-STORE.          06840099
092580      MOVE EPTRN-RGST-ID              TO PV-EMAIL-REG-ID.         06850099
092581      MOVE EPTRN-SLS-DTE              TO PV-EMAIL-SLS-DTE.        06860099
092582      MOVE EPTRN-TRN-DTE              TO PV-EMAIL-TRN-DTE.        06870099
092583      MOVE PV-TRAN-COUNT              TO PV-EMAIL-TRN-CNT.        06880099
092591                                                                  06890099
092592******************************************************************06900099
092593* 2400-WRITE-NETCOOL-ALERT                                        06910091
092594******************************************************************06920091
092595 2400-WRITE-NETCOOL-ALERT.                                        06930091
092596                                                                  06940091
092597     STRING 'REGISTERS ARE WITH WRONG'        DELIMITED BY SIZE   06950091
092598            ' BUSINESS DATE. DETAILS'         DELIMITED BY SIZE   06960099
092599            ' ARE E-MAILED. PLEASE TAKE'      DELIMITED BY SIZE   06970099
092700            ' ACTION.'                        DELIMITED BY SIZE   06980099
092800       INTO IS003-SUMMARY.                                        06990091
092900                                                                  07000091
093000     DISPLAY 'IS003-SUMMARY : ' IS003-SUMMARY.                    07010091
093100                                                                  07020091
093200     MOVE 'SA'                   TO IS003-SYSTEM-ID.              07030099
093300     MOVE 'SA09PROD'             TO IS003-AUTOMATION-LABEL.       07040099
093400     SET IS003-BATCH                                              07050091
093500         IS003-VERSION-1                                          07060091
093600         IS003-PROBLEM-ALERT                                      07070091
093700         IS003-WARNING           TO TRUE.                         07080091
093800                                                                  07090091
093900     CALL IS003-ALERT-PROGRAM                                     07100091
094000         USING IS003-NETCOOL-ALERT.                               07110091
094100                                                                  07120091
094200     DISPLAY ' NETCOOL ALERT GENERATED   '.                       07130091
094300                                                                  07140091
094400     IF IS003-INFO-MSG                                            07150091
094500         DISPLAY IS003-MESSAGE                                    07160091
094600     END-IF.                                                      07170091
094700                                                                  07180091
094800     IF IS003-ERROR                                               07190091
094900         DISPLAY IS003-MESSAGE                                    07200091
095000         CALL 'ILBOABN0' USING ABEND-CODE                         07210091
095100     END-IF.                                                      07220091
095101                                                                  07230091
092592******************************************************************07240099
092593* 2500-WRITE-NETCOOL-ALERT                                        07250099
092594******************************************************************07260099
092595 2500-WRITE-NETCOOL-ALERT.                                        07270099
092596                                                                  07280099
092597     STRING 'REGISTERS ARE WITH FUTURE'       DELIMITED BY SIZE   07290099
092598            ' TRANSACTION DATE. DETAILS'      DELIMITED BY SIZE   07300099
092599            ' ARE E-MAILED. PLEASE TAKE'      DELIMITED BY SIZE   07310099
092700            ' ACTION.'                        DELIMITED BY SIZE   07320099
092800       INTO IS003-SUMMARY.                                        07330099
092900                                                                  07340099
093000     DISPLAY 'IS003-SUMMARY : ' IS003-SUMMARY.                    07350099
093100                                                                  07360099
093200     MOVE 'SA'                   TO IS003-SYSTEM-ID.              07370099
093300     MOVE 'SA09PROD'             TO IS003-AUTOMATION-LABEL.       07380099
093400     SET IS003-BATCH                                              07390099
093500         IS003-VERSION-1                                          07400099
093600         IS003-PROBLEM-ALERT                                      07410099
093700         IS003-WARNING           TO TRUE.                         07420099
093800                                                                  07430099
093900     CALL IS003-ALERT-PROGRAM                                     07440099
094000         USING IS003-NETCOOL-ALERT.                               07450099
094100                                                                  07460099
094200     DISPLAY ' NETCOOL ALERT GENERATED   '.                       07470099
094300                                                                  07480099
094400     IF IS003-INFO-MSG                                            07490099
094500         DISPLAY IS003-MESSAGE                                    07500099
094600     END-IF.                                                      07510099
094700                                                                  07520099
094800     IF IS003-ERROR                                               07530099
094900         DISPLAY IS003-MESSAGE                                    07540099
095000         CALL 'ILBOABN0' USING ABEND-CODE                         07550099
095100     END-IF.                                                      07560099
092592******************************************************************07570099
095101                                                                  07580099
095103* 3000-END-OF-PROGRAM.                                            07590086
095104*      END OF PROGRAM TASK                                        07600086
095105*      UPDATE THE CONTROL CARD WITH THE CURRENT TIMESTAMP         07610086
095106******************************************************************07620086
095107 3000-END-OF-PROGRAM.                                             07630086
095108                                                                  07640086
095109     PERFORM 7300-CLOSE-LATE-TRAN-CSR.                            07650086
095109     PERFORM 7600-CLOSE-FUT-TRAN-CSR.                             07660099
095110     PERFORM 6300-REWRITE-TIMESTAMP.                              07670099
095111                                                                  07680086
095112     DISPLAY ' '.                                                 07690086
095113     DISPLAY ' '.                                                 07700086
095114     DISPLAY 'NO OF LATE TRAN FETCHED     :' PA-LATE-TRAN-COUNT.  07710086
095114     DISPLAY 'NO OF FUTURE TRAN FETCHED   :' PA-FUT-TRAN-COUNT.   07720099
095115     DISPLAY 'NO OF DETAIL RECS WRITTEN   :' PA-RECORDS-WRITTEN.  07730099
095116     CLOSE CONTROL-CARD-IN-OUT                                    07740086
095117           CONTROL-CARD-IN2                                       07750086
095118           CONTROL-CARD-IN3                                       07760087
095119           CONTROL-CARD-IN4                                       07770087
095120           EMAIL-OUTPUT-FILE                                      07780099
095120           EMAIL-OUTPUT-FILE2.                                    07790099
095121                                                                  07800086
095122******************************************************************07810086
095123* 6000-WRITE-BLANK-LINE.                                          07820099
095124*      WRITE THE BLANK LINE IN THE REPORT FILE.                   07830099
095125******************************************************************07840086
095126 6000-WRITE-BLANK-LINE.                                           07850099
095127                                                                  07860086
095128     WRITE EMAIL-OUTPUT-REC  FROM PV-BLANK-LINE.                  07870099
095129                                                                  07880099
095130******************************************************************07890099
095131* 6100-WRITE-EMAIL-HEADER.                                        07900099
095132*      WRITE THE HEADER LINE FOR THE INDIVIDUAL STORE NUMBERS.    07910099
095133******************************************************************07920099
095134 6100-WRITE-EMAIL-HEADER.                                         07930099
095135                                                                  07960099
095136     WRITE EMAIL-OUTPUT-REC  FROM PV-EMAIL-HEADER1.               07970099
095137                                                                  07980099
095138     WRITE EMAIL-OUTPUT-REC  FROM PV-EMAIL-HEADER2.               07990099
095139                                                                  08000099
095140     WRITE EMAIL-OUTPUT-REC  FROM PV-EMAIL-HEADER3.               08010099
095141                                                                  08020099
095130******************************************************************08030099
095131* 6150-WRITE-EMAIL-HEADER.                                        08040099
095132*      WRITE THE HEADER LINE FOR THE INDIVIDUAL STORE NUMBERS.    08050099
095133******************************************************************08060099
095134 6150-WRITE-EMAIL-HEADER.                                         08070099
095128                                                                  08070199
095128     WRITE EMAIL-OUTPUT-REC2 FROM PV-BLANK-LINE.                  08071099
095135                                                                  08080099
095136     WRITE EMAIL-OUTPUT-REC2 FROM PV-EMAIL-HEADER1.               08090099
095137                                                                  08100099
095138     WRITE EMAIL-OUTPUT-REC2 FROM PV-EMAIL-HEADER2.               08110099
095139                                                                  08120099
095140     WRITE EMAIL-OUTPUT-REC2 FROM PV-EMAIL-HEADER3.               08130099
095141                                                                  08140099
095142******************************************************************08150086
095143* 6200-WRITE-EMAIL-DETAIL.                                        08160099
095144*      WRITE THE DETAIL LINE FOR THE INDIVIDUAL STORE NUMBERS.    08170086
095145******************************************************************08180086
095146 6200-WRITE-EMAIL-DETAIL.                                         08190099
095147                                                                  08200086
095148     WRITE EMAIL-OUTPUT-REC  FROM PV-EMAIL-DETAIL.                08210099
095149     ADD  1  TO PA-RECORDS-WRITTEN.                               08220099
095150                                                                  08230099
095142******************************************************************08240099
095143* 6250-WRITE-EMAIL-DETAIL.                                        08250099
095144*      WRITE THE DETAIL LINE FOR THE INDIVIDUAL STORE NUMBERS.    08260099
095145******************************************************************08270099
095146 6250-WRITE-EMAIL-DETAIL.                                         08280099
095147                                                                  08290099
095148     WRITE EMAIL-OUTPUT-REC2 FROM PV-EMAIL-DETAIL.                08300099
095149     ADD  1  TO PA-RECORDS-WRITTEN.                               08310099
095150                                                                  08320099
095151******************************************************************08330086
095152* 6300-REWRITE-TIMESTAMP.                                         08340099
095153*      WRITE THE CURRENT TIMESTAMP PROCEESED BY THIS PROGRAM INTO 08350086
095154*      CONTROL CARD                                               08360086
095155******************************************************************08370086
095156 6300-REWRITE-TIMESTAMP.                                          08380099
095157                                                                  08390086
095158     MOVE  PV-CURR-TIMESTAMP  TO CC-PREV-TIMESTAMP.               08400090
095159                                                                  08410086
095160     REWRITE CONTROL-CARD1-REC FROM CC-CONTROL-CARD1.             08420099
095161                                                                  08430099
095162******************************************************************08440086
095163* 7100-OPEN-LATE-TRAN-CSR.                                        08450086
095164*      OPEN THE LATE-TRAN-CSR                                     08460086
095165******************************************************************08470086
095166 7100-OPEN-LATE-TRAN-CSR.                                         08480086
095167                                                                  08490086
095168     EXEC SQL                                                     08500086
095169          OPEN LATE-TRAN-CSR                                      08510086
095170     END-EXEC.                                                    08520086
095171                                                                  08530086
095172     EVALUATE TRUE                                                08540086
095173         WHEN SQLCODE = ZERO                                      08550086
095174             CONTINUE                                             08560086
095175         WHEN SQLWARN0 NOT EQUAL SPACE                            08570086
095176         WHEN SQLCODE  NOT EQUAL ZERO                             08580086
095177             MOVE '7100-OPEN-LATE-TRAN-CSR'                       08590086
095178                                   TO PV-PARAGRAPH-NAME           08600086
095179             MOVE 'ERROR ON OPEN OF LATE-TRAN-CSR'                08610086
095180                                   TO PV-DB2-OPERATION            08620086
095181             PERFORM 9900-SQL-ABEND                               08630086
095182     END-EVALUATE.                                                08640086
095183******************************************************************08650086
095184* 7200-FETCH-LATE-TRAN-CSR                                        08660086
095185*      FETCH THE LATE-TRAN-CSR                                    08670086
095186******************************************************************08680086
095187 7200-FETCH-LATE-TRAN-CSR.                                        08690086
095188                                                                  08700086
095189     EXEC SQL                                                     08710086
095190          FETCH LATE-TRAN-CSR                                     08720086
095191           INTO  :XST00001-STD-TM-ZN-CDE                          08730086
095192                ,:EPTRN-STR-NBR                                   08740086
095193                ,:EPTRN-RGST-ID                                   08750086
095194                ,:EPTRN-SLS-DTE                                   08760086
095195                ,:EPTRN-TRN-DTE                                   08770086
095196                ,:PV-TRAN-COUNT                                   08780086
095197     END-EXEC.                                                    08790086
095198                                                                  08800086
095199     EVALUATE TRUE                                                08810086
095200         WHEN SQLCODE = ZERO                                      08820086
095201             ADD 1 TO PA-LATE-TRAN-COUNT                          08830086
095202         WHEN SQLCODE = 100                                       08840086
095203             SET PS-END-OF-TRN-CSR-Y                              08850086
095204                                   TO TRUE                        08860086
095205         WHEN SQLWARN0 NOT EQUAL SPACE                            08870086
095206         WHEN SQLCODE  NOT EQUAL ZERO                             08880086
095207             MOVE '7200-FETCH-LATE-TRAN-CSR'                      08890086
095208                                   TO PV-PARAGRAPH-NAME           08900086
095209             MOVE 'ERROR ON FETCH LATE-TRAN-CSR'                  08910086
095210                                   TO PV-DB2-OPERATION            08920086
095211             PERFORM 9900-SQL-ABEND                               08930086
095212     END-EVALUATE.                                                08940086
095213******************************************************************08950086
095214* 7300-CLOSE-LATE-TRAN-CSR.                                       08960086
095215*      CLOSE THE LATE-TRAN-CSR                                    08970086
095216******************************************************************08980086
095217 7300-CLOSE-LATE-TRAN-CSR.                                        08990086
095218                                                                  09000086
095219     EXEC SQL                                                     09010086
095220          CLOSE LATE-TRAN-CSR                                     09020086
095221     END-EXEC.                                                    09030086
095222                                                                  09040086
095223     EVALUATE TRUE                                                09050086
095224         WHEN SQLCODE = ZERO                                      09060086
095225             CONTINUE                                             09070086
095226         WHEN SQLWARN0 NOT EQUAL SPACE                            09080086
095227         WHEN SQLCODE  NOT EQUAL ZERO                             09090086
095228             MOVE '7300-CLOSE-LATE-TRAN-CSR'                      09100086
095229                                   TO PV-PARAGRAPH-NAME           09110086
095230             MOVE 'ERROR ON CLOSE OF LATE-TRAN-CSR'               09120086
095231                                   TO PV-DB2-OPERATION            09130086
095232             PERFORM 9900-SQL-ABEND                               09140086
095233     END-EVALUATE.                                                09150086
095162******************************************************************09160099
095163* 7400-OPEN-FUT-TRAN-CSR.                                         09170099
095164*      OPEN THE FUT-TRAN-CSR                                      09180099
095165******************************************************************09190099
095166 7400-OPEN-FUT-TRAN-CSR.                                          09200099
095167                                                                  09210099
095168     EXEC SQL                                                     09220099
095169          OPEN FUT-TRAN-CSR                                       09230099
095170     END-EXEC.                                                    09240099
095171                                                                  09250099
095172     EVALUATE TRUE                                                09260099
095173         WHEN SQLCODE = ZERO                                      09270099
095174             CONTINUE                                             09280099
095175         WHEN SQLWARN0 NOT EQUAL SPACE                            09290099
095176         WHEN SQLCODE  NOT EQUAL ZERO                             09300099
095177             MOVE '7400-OPEN-FUT-TRAN-CSR'                        09310099
095178                                   TO PV-PARAGRAPH-NAME           09320099
095179             MOVE 'ERROR ON OPEN OF FUT-TRAN-CSR'                 09330099
095180                                   TO PV-DB2-OPERATION            09340099
095181             PERFORM 9900-SQL-ABEND                               09350099
095182     END-EVALUATE.                                                09360099
095183******************************************************************09370099
095184* 7500-FETCH-FUT-TRAN-CSR                                         09380099
095185*      FETCH THE FUT-TRAN-CSR                                     09390099
095186******************************************************************09400099
095187 7500-FETCH-FUT-TRAN-CSR.                                         09410099
095188                                                                  09420099
095189     EXEC SQL                                                     09430099
095190          FETCH FUT-TRAN-CSR                                      09440099
095191           INTO  :XST00001-STD-TM-ZN-CDE                          09450099
095192                ,:EPTRN-STR-NBR                                   09460099
095193                ,:EPTRN-RGST-ID                                   09470099
095194                ,:EPTRN-SLS-DTE                                   09480099
095195                ,:EPTRN-TRN-DTE                                   09490099
095196                ,:PV-TRAN-COUNT                                   09500099
095197     END-EXEC.                                                    09510099
095198                                                                  09520099
095199     EVALUATE TRUE                                                09530099
095200         WHEN SQLCODE = ZERO                                      09540099
095201             ADD 1 TO PA-FUT-TRAN-COUNT                           09550099
095202         WHEN SQLCODE = 100                                       09560099
095203             SET PS-END-OF-FUT-CSR-Y                              09570099
095204                                   TO TRUE                        09580099
095205         WHEN SQLWARN0 NOT EQUAL SPACE                            09590099
095206         WHEN SQLCODE  NOT EQUAL ZERO                             09600099
095207             MOVE '7400-FETCH-FUT-TRAN-CSR'                       09610099
095208                                   TO PV-PARAGRAPH-NAME           09620099
095209             MOVE 'ERROR ON FETCH FUT-TRAN-CSR'                   09630099
095210                                   TO PV-DB2-OPERATION            09640099
095211             PERFORM 9900-SQL-ABEND                               09650099
095212     END-EVALUATE.                                                09660099
095213******************************************************************09670099
095214* 7600-CLOSE-FUT-TRAN-CSR.                                        09680099
095215*      CLOSE THE FUT-TRAN-CSR                                     09690099
095216******************************************************************09700099
095217 7600-CLOSE-FUT-TRAN-CSR.                                         09710099
095218                                                                  09720099
095219     EXEC SQL                                                     09730099
095220          CLOSE FUT-TRAN-CSR                                      09740099
095221     END-EXEC.                                                    09750099
095222                                                                  09760099
095223     EVALUATE TRUE                                                09770099
095224         WHEN SQLCODE = ZERO                                      09780099
095225             CONTINUE                                             09790099
095226         WHEN SQLWARN0 NOT EQUAL SPACE                            09800099
095227         WHEN SQLCODE  NOT EQUAL ZERO                             09810099
095228             MOVE '7600-CLOSE-FUT-TRAN-CSR'                       09820099
095229                                   TO PV-PARAGRAPH-NAME           09830099
095230             MOVE 'ERROR ON CLOSE OF FUT-TRAN-CSR'                09840099
095231                                   TO PV-DB2-OPERATION            09850099
095232             PERFORM 9900-SQL-ABEND                               09860099
095233     END-EVALUATE.                                                09870099
095236***************************************************************** 09880099
095235*  CALL THE DATE ROUTINE WITH SPECIFIED PARAMETERS.             * 09890086
095236***************************************************************** 09900086
095237 9700-CALENDAR-ROUTINE.                                           09910086
095238                                                                  09920086
095239     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          09930086
095240                                             DPG53 DPG54          09940086
095241                                             DPG55 DPG56.         09950086
095242                                                                  09960086
095243     EVALUATE TRUE                                                09970086
095244         WHEN DPG54-NO-ERROR                                      09980086
095245             CONTINUE                                             09990086
095246         WHEN DPG54-WARNING-ERROR                                 10000086
095247             DISPLAY '** WARNING - PROGRAM '                      10010086
095248                      PC-PROGRAM-NAME ' **'                       10020086
095249             DISPLAY '** 9700-CALENDAR-ROUTINE'                   10030086
095250             DISPLAY '** CALL TO DPKUT500 RETURNED WARNING ERROR' 10040086
095251             DISPLAY '** DPG54-ERROR-MESSAGE: '                   10050086
095252             DISPLAY '** ' DPG54-ERROR-MESSAGE                    10060086
095253             DISPLAY '** DPG51: ' DPG51                           10070086
095254             DISPLAY '** DPG52: ' DPG52                           10080086
095255             DISPLAY '** PLEASE INVESTIGATE FURTHER **'           10090086
095256         WHEN DPG54-SEVERE-ERROR                                  10100086
095257             DISPLAY '** ABEND - PROGRAM '                        10110086
095258                      PC-PROGRAM-NAME ' **'                       10120086
095259             DISPLAY '** 9700-CALENDAR-ROUTINE'                   10130086
095260             DISPLAY '** CALL TO DPKUT500 RETURNED SEVERE ERROR'  10140086
095261             IF DPG54-CALENDAR-TYPE-INVALID                       10150086
095262                DISPLAY '** DPG54-CALENDAR-TYPE-INVALID'          10160086
095263                DISPLAY '** DPG51-CALENDAR-TYPE: '                10170086
095264                         DPG51-CALENDAR-TYPE                      10180086
095265             END-IF                                               10190086
095266             IF DPG54-DATE-INVALID                                10200086
095267                DISPLAY '** DPG54-DATE-INVALID'                   10210086
095268                DISPLAY '** DPG52-LK-DATE-INPUT: '                10220086
095269                         DPG52-LK-DATE-INPUT                      10230086
095270             END-IF                                               10240086
095271             IF DPG54-INCR-DECR-INVALID                           10250086
095272                DISPLAY '** DPG54-INCR-DECR-INVALID'              10260086
095273                DISPLAY '** DPG51-INCREMENT-DECREMENT-FLAG: '     10270086
095274                         DPG51-INCREMENT-DECREMENT-FLAG           10280086
095275             END-IF                                               10290086
095276             MOVE DPG54-ERROR-MESSAGE TO PV-OPERATION-MSG-2       10300086
095277             SET ABEND-4019-DATE-ROUTINE-ERROR TO TRUE            10310086
095278             MOVE '9700-CALENDAR-ROUTINE'                         10320086
095279                                      TO PV-PARAGRAPH-NAME        10330086
095280             PERFORM 9999-ABEND                                   10340086
095281     END-EVALUATE.                                                10350086
095282                                                                  10360086
095283***************************************************************** 10370086
095284* 9900-SQL-ABEND                                                  10380086
095285*     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.10390086
095286***************************************************************** 10400086
095287 9900-SQL-ABEND.                                                  10410086
095288     DISPLAY '** ABEND     **'.                                   10420086
095289     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                10430086
095290     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              10440086
095291     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               10450086
095292                                                                  10460086
095293***************************************************************** 10470086
095294* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     10480086
095295* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      10490086
095296***************************************************************** 10500086
095297     COPY DPPD004.                                                10510086
095298                                                                  10520086
095299     SET ABEND-4013-DB2-ERROR TO TRUE.                            10530086
095300     CALL 'ILBOABN0' USING ABEND-CODE.                            10540086
095301                                                                  10550086
095302***************************************************************** 10560086
095303* 9999-ABEND                                                      10570086
095304*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  10580086
095305***************************************************************** 10590086
095306 9999-ABEND.                                                      10600086
095307     DISPLAY '** ABEND           **'.                             10610086
095308     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          10620086
095309     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        10630086
095310     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       10640086
095311     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       10650086
095312     CALL 'ILBOABN0' USING ABEND-CODE.                            10660086
