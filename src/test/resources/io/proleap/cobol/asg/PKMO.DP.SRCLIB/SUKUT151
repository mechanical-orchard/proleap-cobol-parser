000100 IDENTIFICATION DIVISION.                                         00010021
000200                                                                  00020021
000300 PROGRAM-ID.             SUKUT151.                                00030078
000400 AUTHOR.                 DAVID WELLER.                            00040079
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050079
000600 DATE-WRITTEN            AUGUST 2012.                             00060079
000700 DATE-COMPILED.                                                   00070079
000800***************************************************************** 00080079
000900*                                                                 00090079
001000******************************************************************00100079
001100*  MODULE TYPE: COBOL2 DB2 BATCH                                  00110079
001200*                                                                 00120079
001300*  DESCRIPTION:                                                   00130079
001400*                                                                 00140079
001500*  PROGRAM TO POPULATE THE SUT_TRIP_PRCHG TABLE                   00150056
001600*                                                                 00160049
001700*========================== CHANGE LOG ===========================00170056
001800*  BY        DATE     #                DESCRIPTION                00180056
001900*=================================================================00190056
002000*  C.PARMLEY 11-19-12 CRQ000000037068  ADDED XLT_DEPT TABLE TO    00200056
002100*                                      INCLUDE DESC IN THE OUTPUT 00210056
002200*                                      FILE. ALSO CREATE A RECORD 00220064
002300*                                      FOR THE OUTPUT FILE THAT   00230064
002400*                                      HAS NO PRICE CHANGES FOR   00240064
002500*                                      THAT STORE.                00250064
002510*  C.PARMLEY 07-10-15 CHG              MERCHANDISE PGM ID REPLACED00251086
002520*                                      WITH BRAND ID              00252083
002600******************************************************************00260056
001700*========================== CHANGE LOG ===========================00261094
001800*  BY        DATE     #                DESCRIPTION                00262094
001900*=================================================================00263094
002000*  GEERTHANA 02-27-17 CHG0161815 CHANGE WAS MADE BY ADDING THE    00264094
002100*                                CTA PRICE CHANGE TYPE CODE TO    00265094
002200*                                THE DECLARE CSR-SKUPRCHG CURSOR  00266094
002300*                                FOUND IN PARAGRAPH 3000-DECLARE- 00267094
002400*                                CURSOR.                          00268094
002500*                                FIND FOR THE CODING TAG# P63260  00269094
002600******************************************************************00269394
002700 ENVIRONMENT DIVISION.                                            00270021
002800 CONFIGURATION SECTION.                                           00280021
002900 SOURCE-COMPUTER.        IBM-3090.                                00290021
003000 OBJECT-COMPUTER.        IBM-3090.                                00300021
003100 INPUT-OUTPUT SECTION.                                            00310021
003200 FILE-CONTROL.                                                    00320021
003300                                                                  00330021
003400     SELECT INPUT-UPDATE-FILE                                     00340021
003500         ASSIGN TO INP01.                                         00350021
003600                                                                  00360021
003700     SELECT OUTPUT-FILE                                           00370021
003800         ASSIGN TO OUT01.                                         00380021
003900                                                                  00390021
004000 DATA DIVISION.                                                   00400021
004100 FILE SECTION.                                                    00410021
004200                                                                  00420021
004300 FD  INPUT-UPDATE-FILE                                            00430021
004400     RECORDING MODE IS F                                          00440021
004500     LABEL RECORDS ARE STANDARD                                   00450021
004600     BLOCK CONTAINS 0  RECORDS.                                   00460021
004700 01  INPUT-UPDATE-REC                 PIC X(100).                 00470021
004800                                                                  00480021
004900 FD  OUTPUT-FILE                                                  00490021
005000     RECORDING MODE IS F                                          00500021
005100     LABEL RECORDS ARE STANDARD                                   00510021
005200     BLOCK CONTAINS 0  RECORDS.                                   00520021
005300 01  OUTPUT-REC                       PIC X(200).                 00530086
005400                                                                  00540021
005500 WORKING-STORAGE SECTION.                                         00550021
005600 01  PS-SWITCHES.                                                 00560021
005700     05  PS-EOF-EXTRACT-SW            PIC X(01) VALUE 'N'.        00570021
005800         88  PS-EOF-EXTRACT-YES                 VALUE 'Y'.        00580021
005900     05  PS-END-OF-CSR-SW             PIC  X(01) VALUE 'N'.       00590078
006000         88 PS-END-OF-CSR-N                      VALUE 'N'.       00600066
006100         88 PS-END-OF-CSR-Y                      VALUE 'Y'.       00610066
006200     05  PS-NO-PRICE-CHG-SW           PIC  X(01) VALUE 'N'.       00620078
006300         88 PS-PRICE-CHG                         VALUE 'N'.       00630078
006400         88 PS-NO-PRICE-CHG                      VALUE 'Y'.       00640078
006500                                                                  00650021
006600 01  PROGRAM-CONSTANTS.                                           00660078
006700     05  PC-NO-PC-VERBIAGE            PIC X(23) VALUE             00670078
006800         'NO P/C ITEMS ON TRAILER'.                               00680078
006900                                                                  00690066
007000 01  PROGRAM-VARIABLES.                                           00700066
007100     05  PV-DISP-NBR                  PIC Z,ZZZ,ZZ9.              00710021
007200     05  PV-DISP-TRIP-ID              PIC ZZZ,ZZZ,ZZ9.            00720021
007300     05  PV-DISP-TRIP                 PIC ZZZZZZZZ9.              00730021
007400     05  PV-DISP-OCRNC                PIC ZZZZZZZZ9.              00740021
007500     05  PV-DISP-TRLR-SRL             PIC ZZZZZZZZ9.              00750025
007600     05  PV-DISP-STORE                PIC ZZZ9.                   00760035
007700     05  PV-DISP-SKU                  PIC ZZZZZZZ9.               00770033
007800     05  PV-DISP-FETCH-COUNT          PIC ZZZ,ZZZ,ZZ9.            00780025
007900     05  PV-DISP-CURRENT-DATE-1       PIC X(10).                  00790030
008000     05  PV-DISP-CURRENT-DATE-2       PIC X(10).                  00800030
008100     05  PV-DISP-DAYS-PCRDYA          PIC ZZZ,ZZZ,ZZ9.            00810030
008200     05  PV-DISP-DAYS-PCRDYB          PIC ZZZ,ZZZ,ZZ9.            00820030
008300     05  PV-DISP-DAYS-PCRDYC          PIC ZZZ,ZZZ,ZZ9.            00830030
008400     05  PV-ABEND-CODE                PIC S9(04) VALUE ZERO       00840021
008500                                                 COMP SYNC.       00850021
008600         88  ABEND-4013-DB2-ERROR                VALUE +4013.     00860021
008700     05  PV-INPUT-COUNT               PIC S9(09) COMP-3           00870021
008800                                          VALUE ZERO.             00880021
008900     05  PV-CSR-SKUPRCHG-COUNT        PIC S9(09) COMP-3           00890021
009000                                          VALUE ZERO.             00900021
009100     05  PV-PAST-DATE                 PIC X(10).                  00910031
009200     05  PV-FUTURE-DATE               PIC X(10).                  00920031
009300     05  PV-SOR-DATE                  PIC X(10).                  00930037
009400     05  PV-PAST-DAYS                 PIC S9(09) COMP             00940031
009500                                          VALUE +0.               00950021
009600     05  PV-FUTURE-DAYS               PIC S9(09) COMP             00960021
009700                                          VALUE +0.               00970021
009800     05  PV-DAYS-GT-SOR-CRE           PIC S9(09) COMP             00980029
009900                                          VALUE +0.               00990029
010000     05  PC-MAX-RETRIES               PIC S9(03) COMP-3           01000021
010100                                        VALUE 3.                  01010021
010200     05  PV-ABEND-PARAGRAPH           PIC X(35) VALUE SPACES.     01020021
010300     05  PV-CURRENT-TMST              PIC X(26) VALUE SPACES.     01030021
010400     05  PV-DEFAULT-TMST              PIC X(26) VALUE             01040031
010500                                '9999-12-31-24.00.00.000000'.     01050031
010600     05  PV-WORK-TMST.                                            01060021
010700         10  PV-WORK-DATE             PIC X(10) VALUE SPACES.     01070021
010800         10  PV-WORK-TIME             PIC X(16) VALUE             01080021
010900                                      '-00.00.00.000000'.         01090021
011000                                                                  01100021
011100 01  PV-DISP-KEY-MSG.                                             01110021
011200     05  FILLER                      PIC X(11) VALUE              01120021
011300         ' TRIP-ID = '.                                           01130021
011400     05  PV-KEY-OTBND-TRIP-ID        PIC 9(09) VALUE ZEROES.      01140021
011500     05  FILLER                      PIC X(09) VALUE              01150021
011600         '; DEPT = '.                                             01160021
011700     05  PV-KEY-DEPT-NBR             PIC 9(04) VALUE ZEROES.      01170021
011800     05  FILLER                      PIC X(12) VALUE              01180021
011900         '; MAJ-CLS = '.                                          01190021
012000     05  PV-KEY-MAJ-CLS-NBR          PIC 9(04) VALUE ZEROES.      01200021
012100     05  FILLER                      PIC X(13) VALUE              01210021
012200         '; BUS-AREA = '.                                         01220021
012300     05  PV-KEY-BUS-AREA-ID          PIC 9(04) VALUE ZEROES.      01230021
012601*CLP 07/10/2015 START                                             01260184
012610     05  FILLER                      PIC X(13) VALUE              01261083
012620         '; BRND-ID  = '.                                         01262083
012630     05  PV-KEY-BRND-ID              PIC 9(10) VALUE ZEROES.      01263083
012640*CLP 07/10/2015 END                                               01264084
012700                                                                  01270021
012800     COPY SURD069.                                                01280021
012900                                                                  01290021
013000     COPY SURD105.                                                01300021
013100***DB2 ABEND COPYBOOK                                             01310021
013200     COPY DPWS900.                                                01320021
013300                                                                  01330021
013400     EXEC SQL                                                     01340021
013500         INCLUDE SUT00007                                         01350021
013600     END-EXEC.                                                    01360021
013700                                                                  01370021
013800     EXEC SQL                                                     01380021
013900         INCLUDE SUT00095                                         01390021
014000     END-EXEC.                                                    01400021
014100                                                                  01410021
014200     EXEC SQL                                                     01420021
014300         INCLUDE TKRPRPM                                          01430021
014400     END-EXEC.                                                    01440021
014500                                                                  01450021
014600     EXEC SQL                                                     01460050
014700         INCLUDE XLT00002                                         01470050
014800     END-EXEC.                                                    01480050
014900                                                                  01490049
015000     EXEC SQL                                                     01500021
015100         INCLUDE XLT00003                                         01510021
015200     END-EXEC.                                                    01520021
015300                                                                  01530021
015400     EXEC SQL                                                     01540021
015500         INCLUDE XLT00010                                         01550021
015600     END-EXEC.                                                    01560021
015700                                                                  01570021
015800     EXEC SQL                                                     01580021
015900         INCLUDE XLT00032                                         01590021
016000     END-EXEC.                                                    01600021
016100                                                                  01610021
016200     EXEC SQL                                                     01620021
016300         INCLUDE XLT00033                                         01630021
016400     END-EXEC.                                                    01640021
016500                                                                  01650021
016600     EXEC SQL                                                     01660021
016700         INCLUDE XLT00034                                         01670021
016800     END-EXEC.                                                    01680021
016900                                                                  01690021
017000     EXEC SQL                                                     01700033
017100         INCLUDE XST00008                                         01710033
017200     END-EXEC.                                                    01720033
017300                                                                  01730021
017400     EXEC SQL                                                     01740021
017500         INCLUDE TCNTRID                                          01750021
017600     END-EXEC.                                                    01760021
017700                                                                  01770021
017800     EXEC SQL                                                     01780021
017900         INCLUDE TSUOBTR                                          01790021
018000     END-EXEC.                                                    01800021
018100                                                                  01810035
018200     EXEC SQL                                                     01820035
018300         INCLUDE TUPCPLS                                          01830035
018400     END-EXEC.                                                    01840035
018500                                                                  01850021
018600     EXEC SQL                                                     01860021
018700         INCLUDE SQLCA                                            01870021
018800     END-EXEC.                                                    01880021
018900                                                                  01890021
019000     COPY SQLCA2.                                                 01900021
019100     COPY DPWS004.                                                01910021
019200 EJECT                                                            01920021
019300/                                                                 01930021
019400 PROCEDURE DIVISION.                                              01940021
019500     PERFORM 1000-INITIALIZE.                                     01950021
019600     PERFORM 2000-PROCESS                                         01960021
019700             UNTIL PS-EOF-EXTRACT-YES                             01970021
019800     PERFORM 9000-EOJ.                                            01980021
019900                                                                  01990021
020000     GOBACK.                                                      02000021
020100                                                                  02010021
020200 1000-INITIALIZE.                                                 02020021
020300                                                                  02030021
020400     OPEN INPUT INPUT-UPDATE-FILE.                                02040021
020500     OPEN OUTPUT OUTPUT-FILE.                                     02050021
020600                                                                  02060021
020700     EXEC SQL                                                     02070021
020800         SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                 02080021
020900     END-EXEC.                                                    02090021
021000                                                                  02100021
021100     PERFORM 8000-READ-EXTRACT-FILE.                              02110021
021200     IF PS-EOF-EXTRACT-YES                                        02120021
021300         DISPLAY ' SUKUT151 - INPUT FILE IS EMPTY '               02130021
021400     ELSE                                                         02140021
021500         PERFORM 2300-GET-PAST-DAYS                               02150021
021600         PERFORM 2400-GET-FUTURE-DAYS                             02160021
021700         PERFORM 2500-GET-DAYS-GT-SOR-CRE                         02170041
021800         PERFORM 3000-DECLARE-CURSOR                              02180021
021900         PERFORM 3100-OPEN-CURSOR                                 02190021
022000     END-IF.                                                      02200021
022100                                                                  02210021
022200 2000-PROCESS.                                                    02220021
022300                                                                  02230021
022400     PERFORM 3200-FETCH-CURSOR.                                   02240021
022500     IF PS-END-OF-CSR-N                                           02250021
022600         PERFORM 3300-PROCESS-CURSOR                              02260021
022700           UNTIL PS-END-OF-CSR-Y                                  02270023
022800     END-IF.                                                      02280021
022900                                                                  02290023
023000     PERFORM 3400-CLOSE-CURSOR.                                   02300023
023100                                                                  02310078
023200     IF PV-CSR-SKUPRCHG-COUNT =  0                                02320078
023300*        NO PRICE CHANGE RECORDS FOR LOCATION                     02330078
023400         PERFORM 3500-BUILD-NO-PC-RPT                             02340078
023500         IF PS-NO-PRICE-CHG                                       02350078
023600             PERFORM 3600-MOVE-TO-OUTPUT                          02360078
023700             PERFORM 8100-WRITE-OUTPUT-FILE                       02370078
023800         END-IF                                                   02380078
023900     END-IF.                                                      02390078
024000                                                                  02400078
024100     PERFORM 8000-READ-EXTRACT-FILE.                              02410021
024200     IF PS-EOF-EXTRACT-YES                                        02420021
024300         DISPLAY ' SUKUT151 - END OF INPUT FILE '                 02430021
024400     ELSE                                                         02440021
024500         PERFORM 3000-DECLARE-CURSOR                              02450021
024600         PERFORM 3100-OPEN-CURSOR                                 02460021
024700     END-IF.                                                      02470021
024800                                                                  02480021
024900 2300-GET-PAST-DAYS.                                              02490021
025000                                                                  02500021
025100     MOVE '2300-GET-PAST-DAYS'        TO PV-ABEND-PARAGRAPH.      02510021
025200                                                                  02520021
025300     EXEC SQL                                                     02530021
025400       SELECT FUNC_QTY                                            02540021
025500             ,CURRENT DATE - FUNC_QTY DAYS                        02550031
025600         INTO :PV-PAST-DAYS                                       02560021
025700            , :PV-PAST-DATE                                       02570031
025800         FROM TKRPRPM P                                           02580021
025900        WHERE                                                     02590021
026000              P.LOC_ID            = 90                            02600021
026100          AND P.INTFC_SYS_CDE     = 'KHL'                         02610021
026200          AND P.SYS_PRC_FUNC_CDE  = 'PCRDYA'                      02620021
026300          AND P.FUNC_PRC_STAT_CDE = 'AC'                          02630021
026400     END-EXEC.                                                    02640021
026500                                                                  02650021
026600     EVALUATE TRUE                                                02660021
026700         WHEN SQLCODE = 0                                         02670030
026800              MOVE PV-PAST-DAYS     TO  PV-DISP-DAYS-PCRDYA       02680030
026900              DISPLAY '* PAST DAYS  :'  PV-DISP-DAYS-PCRDYA       02690030
027000                      '  PAST DATE  :'  PV-PAST-DATE              02700031
027100        WHEN SQLCODE = 100                                        02710021
027200            CONTINUE                                              02720021
027300        WHEN SQLCODE NOT EQUAL ZERO                               02730021
027400             MOVE SU069-OTBND-TRIP-ID TO PV-KEY-OTBND-TRIP-ID     02740021
027500             MOVE SU069-BUS-AREA-ID   TO PV-KEY-BUS-AREA-ID       02750021
027600             DISPLAY '**************************************'     02760021
027700             DISPLAY '2300-ERROR ISSUED ON                  '     02770021
027800             DISPLAY 'SELECT FUNC_QTY                       '     02780021
027900             DISPLAY PV-DISP-KEY-MSG                              02790021
028000             DISPLAY '**************************************'     02800021
028100             PERFORM 9900-SQL-ERROR                               02810021
028200     END-EVALUATE.                                                02820021
028300*    MOVE 2000 TO PV-PAST-DAYS.                                   02830021
028400                                                                  02840021
028500 2400-GET-FUTURE-DAYS.                                            02850029
028600                                                                  02860021
028700     MOVE '2400-GET-FUTURE-DAYS'      TO PV-ABEND-PARAGRAPH.      02870021
028800                                                                  02880021
028900     EXEC SQL                                                     02890021
029000       SELECT FUNC_QTY                                            02900021
029100            , CURRENT_DATE + FUNC_QTY DAYS                        02910031
029200         INTO :PV-FUTURE-DAYS                                     02920021
029300            , :PV-FUTURE-DATE                                     02930031
029400         FROM TKRPRPM P                                           02940021
029500        WHERE                                                     02950021
029600              P.LOC_ID            = 90                            02960021
029700          AND P.INTFC_SYS_CDE     = 'KHL'                         02970021
029800          AND P.SYS_PRC_FUNC_CDE  = 'PCRDYB'                      02980021
029900          AND P.FUNC_PRC_STAT_CDE = 'AC'                          02990021
030000     END-EXEC.                                                    03000021
030100                                                                  03010021
030200     EVALUATE TRUE                                                03020021
030300         WHEN SQLCODE = 0                                         03030031
030400              MOVE PV-FUTURE-DAYS   TO  PV-DISP-DAYS-PCRDYB       03040030
030500              DISPLAY '* FUTURE DAYS:'  PV-DISP-DAYS-PCRDYB       03050030
030600                      '  FUTURE DATE:'  PV-FUTURE-DATE            03060031
030700        WHEN SQLCODE = 100                                        03070021
030800            CONTINUE                                              03080021
030900        WHEN SQLCODE NOT EQUAL ZERO                               03090021
031000             MOVE SU069-OTBND-TRIP-ID TO PV-KEY-OTBND-TRIP-ID     03100021
031100             MOVE SU069-BUS-AREA-ID   TO PV-KEY-BUS-AREA-ID       03110021
031200             DISPLAY '**************************************'     03120021
031300             DISPLAY '2400-ERROR ISSUED ON                  '     03130021
031400             DISPLAY 'SELECT FUNC_QTY                       '     03140021
031500             DISPLAY PV-DISP-KEY-MSG                              03150021
031600             DISPLAY '**************************************'     03160021
031700             PERFORM 9900-SQL-ERROR                               03170021
031800     END-EVALUATE.                                                03180021
031900*    MOVE 2000 TO PV-FUTURE-DAYS.                                 03190029
032000                                                                  03200021
032100 2500-GET-DAYS-GT-SOR-CRE.                                        03210041
032200                                                                  03220041
032300     MOVE '2500-GET-DAYS-GT-SOR-CRE' TO PV-ABEND-PARAGRAPH.       03230041
032400                                                                  03240041
032500     EXEC SQL                                                     03250041
032600       SELECT FUNC_QTY                                            03260041
032700            , CURRENT DATE - FUNC_QTY DAYS                        03270042
032800         INTO :PV-DAYS-GT-SOR-CRE                                 03280041
032900            , :PV-SOR-DATE                                        03290041
033000         FROM TKRPRPM P                                           03300041
033100        WHERE                                                     03310041
033200              P.LOC_ID            = 90                            03320041
033300          AND P.INTFC_SYS_CDE     = 'KHL'                         03330041
033400          AND P.SYS_PRC_FUNC_CDE  = 'PCRDYC'                      03340041
033500          AND P.FUNC_PRC_STAT_CDE = 'AC'                          03350041
033600     END-EXEC.                                                    03360041
033700                                                                  03370041
033800     EVALUATE TRUE                                                03380041
033900         WHEN SQLCODE = 0                                         03390041
034000              MOVE PV-DAYS-GT-SOR-CRE TO PV-DISP-DAYS-PCRDYC      03400041
034100              DISPLAY '* CREATE DAYS:'   PV-DISP-DAYS-PCRDYC      03410041
034200                      '     SOR DATE:'   PV-SOR-DATE              03420041
034300        WHEN SQLCODE = 100                                        03430041
034400              MOVE PV-DAYS-GT-SOR-CRE TO PV-DISP-DAYS-PCRDYC      03440041
034500              DISPLAY '* MISSING PARM*  '                         03450041
034600                      '* CREATE DAYS:'   PV-DISP-DAYS-PCRDYC      03460041
034700                      '     SOR DATE:'   PV-SOR-DATE              03470041
034800                                                                  03480041
034900        WHEN SQLCODE NOT EQUAL ZERO                               03490041
035000             MOVE SU069-OTBND-TRIP-ID TO PV-KEY-OTBND-TRIP-ID     03500041
035100             MOVE SU069-BUS-AREA-ID   TO PV-KEY-BUS-AREA-ID       03510041
035200             DISPLAY '**************************************'     03520041
035300             DISPLAY '2500-ERROR ISSUED ON                  '     03530041
035400             DISPLAY 'SELECT FUNC_QTY                       '     03540041
035500             DISPLAY PV-DISP-KEY-MSG                              03550041
035600             DISPLAY '**************************************'     03560041
035700             PERFORM 9900-SQL-ERROR                               03570041
035800     END-EVALUATE.                                                03580041
035900                                                                  03590031
036000****************************************************************  03600031
036100*     DECLARE CURSOR. THE CURSOR FETCHES THE SKU'S CONTAINED IN   03610021
036200*     EACH TRAILER THAT HAVE A RECENT OR PENDING PRICE CHANGE.    03620021
036300****************************************************************  03630021
036400 3000-DECLARE-CURSOR.                                             03640021
036500                                                                  03650021
036600     MOVE '3000-DECLARE-CURSOR'       TO PV-ABEND-PARAGRAPH.      03660021
036700     MOVE SU069-TRIP-OCRNC-ID         TO SUT00095-TRIP-OCRNC-ID.  03670021
036800     MOVE SUT00095-TRIP-OCRNC-ID      TO PV-DISP-TRIP-ID.         03680021
036900                                                                  03690021
037000     MOVE SU069-OTBND-TRIP-ID         TO PV-DISP-TRIP.            03700021
037100     MOVE SU069-TRIP-OCRNC-ID         TO PV-DISP-OCRNC.           03710021
037200     MOVE ZEROES                      TO PV-CSR-SKUPRCHG-COUNT.   03720028
037300*    DISPLAY '*                                                 ' 03730054
037400*    DISPLAY '*  3000-DECLARE-CURSOR   '                          03740054
037500*                'TRIP:'  PV-DISP-TRIP '   '                      03750054
037600*                'OCRNC:' PV-DISP-OCRNC                           03760054
037700                                                                  03770021
037800     EXEC SQL                                                     03780021
037900       DECLARE CSR-SKUPRCHG CURSOR FOR                            03790021
038000         SELECT A.PRCHG_ID                                        03800021
038100               ,T.TRIP_OCRNC_ID                                   03810021
038200               ,I.SKU_NBR                                         03820021
038300               ,B.PRCHG_EFF_DTE                                   03830021
038400*              ,E.PREV_UNT_RTL_AMT                                03840033
038500               ,COALESCE(E.UNT_RTL_AMT, 0)                        03850021
038600               ,E.LAST_UPD_TMST                                   03860021
038700               ,A.PRCHG_TYP_CDE                                   03870021
038800               ,T.DEPT_NBR                                        03880021
038900               ,T.BUS_AREA_ID                                     03890021
039000               ,T.MAJ_CL_NBR                                      03900021
039010*CLP 07/10/2015 START                                             03901084
039100               ,T.BRND_ID                                         03910084
039110*CLP 07/10/2015 END                                               03911084
039200               ,D.LOC_NM                                          03920021
039300               ,I.SKU_DESC                                        03930021
039400               ,G.CRE_TMST                                        03940021
039500               ,J.SCAC_CDE                                        03950021
039600               ,J.TRLR_ID                                         03960021
039700               ,SUM(T.UNT_QTY)                                    03970021
039800           FROM                                                   03980021
039900                XLT_PRCHG              A                          03990021
040000               ,XLT_STR_GP_PRCHG       B                          04000021
040100               ,XLT_STR_GP_MBSHP       C                          04010021
040200               ,XLT_LOC                D                          04020021
040300               ,XLT_PRCHG_MDSE         E                          04030021
040400               ,SUT_TRIP_SUM           G                          04040021
040500               ,TSUOBTR                H                          04050021
040600               ,XLT_SKU                I                          04060021
040700               ,TCNTRID                J                          04070021
040710               ,TKRPRPM                K                          04071080
040800               ,(SELECT DISTINCT                                  04080021
040900                   SKU_NBR                                        04090021
041000                  ,TRIP_OCRNC_ID                                  04100021
041100                  ,DEPT_NBR                                       04110021
041200                  ,BUS_AREA_ID                                    04120021
041300                  ,MAJ_CL_NBR                                     04130021
041310*CLP 07/10/2015 START                                             04131084
041400                  ,BRND_ID                                        04140084
041410*CLP 07/10/2015 END                                               04141084
041500                  ,UNT_QTY                                        04150021
041600                   FROM SUT_TRIP_DTL_SUM                          04160021
041700                WHERE TRIP_OCRNC_ID = :SUT00095-TRIP-OCRNC-ID) T  04170021
041800          WHERE                                                   04180021
041900                A.PRCHG_ID       = B.PRCHG_ID                     04190021
P63260**PRB0063260 START                                                04191093
P63260            AND A.PRCHG_TYP_CDE  IN ('RCP','MK2','MUA','MDA',     04200093
P63260                'CTA')                                            04201093
P63260**PRB0063260 END                                                  04202093
042100            AND A.PRCHG_ST_CDE   = 'APR'                          04210021
042200            AND A.LAST_ACTN_CDE  <> 'D'                           04220021
042300            AND B.LAST_ACTN_CDE  <> 'D'                           04230021
042400            AND B.STR_GP_TYP_CDE = C.STR_GP_TYP_CDE               04240021
042500            AND B.STR_GP_ID      = C.STR_GP_ID                    04250021
042511** 2/28/13                                                        04251180
042512            AND K.LOC_ID            = 90                          04251280
042513            AND K.INTFC_SYS_CDE     = 'KHL'                       04251380
042514            AND K.SYS_PRC_FUNC_CDE  = 'PCRDYC'                    04251482
042515            AND K.FUNC_PRC_STAT_CDE = 'AC'                        04251580
042516            AND ((B.PRCHG_EFF_DTE  - K.FUNC_QTY DAYS)             04251680
042517                  >=  DATE(B.SOR_CRE_TMST)                        04251781
042520                                                                  04252080
042600** 2/28/13  AND ((DATE(:PV-SOR-DATE) <= DATE(B.SOR_CRE_TMST))     04260079
042700               OR B.SOR_CRE_TMST = :PV-DEFAULT-TMST )             04270046
042800            AND C.LOC_NBR        = D.LOC_NBR                      04280021
042900            AND C.LOC_NBR        = H.DEST_OPER_UNT_ID             04290021
043000            AND B.STR_GP_TYP_CDE = E.STR_GP_TYP_CDE               04300021
043100            AND B.STR_GP_ID      = E.STR_GP_ID                    04310021
043200            AND B.PRCHG_ID       = E.PRCHG_ID                     04320021
043300            AND (C.EFF_END_DTE  >= B.PRCHG_EFF_DTE                04330021
043400             OR C.EFF_END_DTE   IS NULL)                          04340021
043500            AND C.EFF_BEG_DTE   <= B.PRCHG_EFF_DTE                04350021
043600            AND E.LAST_ACTN_CDE <> 'D'                            04360021
043700            AND E.SKU_NBR        = T.SKU_NBR                      04370021
043800            AND I.SKU_NBR        = T.SKU_NBR                      04380021
043900            AND B.PRCHG_EFF_DTE BETWEEN                           04390021
044000                   :PV-PAST-DATE  AND :PV-FUTURE-DATE             04400031
044100            AND H.OTBND_TRIP_ID  = G.OTBND_TRIP_ID                04410021
044200            AND J.TRLR_SRL_NBR   = H.TRLR_SRL_NBR                 04420021
044300            AND G.TRIP_OCRNC_ID  = :SUT00095-TRIP-OCRNC-ID        04430021
044400            AND G.CRE_TMST =                                      04440021
044500              (SELECT MAX(I.CRE_TMST)                             04450021
044600                 FROM SUT_TRIP_SUM I                              04460021
044700                WHERE I.OTBND_TRIP_ID = G.OTBND_TRIP_ID)          04470021
044800           GROUP BY                                               04480021
044900             A.PRCHG_ID                                           04490021
045000            ,T.TRIP_OCRNC_ID                                      04500021
045100            ,I.SKU_NBR                                            04510021
045200            ,B.PRCHG_EFF_DTE                                      04520021
045300*           ,E.PREV_UNT_RTL_AMT                                   04530033
045400            ,E.UNT_RTL_AMT                                        04540021
045500            ,E.LAST_UPD_TMST                                      04550021
045600            ,A.PRCHG_TYP_CDE                                      04560021
045700            ,T.DEPT_NBR                                           04570021
045800            ,T.BUS_AREA_ID                                        04580021
045900            ,T.MAJ_CL_NBR                                         04590021
045910*CLP 07/10/2015 START                                             04591084
046000            ,T.BRND_ID                                            04600083
046010*CLP 07/10/2015 END                                               04601084
046100            ,D.LOC_NM                                             04610021
046200            ,I.SKU_DESC                                           04620021
046300            ,G.CRE_TMST                                           04630021
046400            ,J.SCAC_CDE                                           04640021
046500            ,J.TRLR_ID                                            04650021
046600       FOR FETCH ONLY                                             04660021
046700       WITH UR                                                    04670021
046800                                                                  04680021
046900     END-EXEC.                                                    04690021
047000                                                                  04700021
047100     EVALUATE TRUE                                                04710021
047200        WHEN SQLCODE = 100                                        04720021
047300            CONTINUE                                              04730021
047400        WHEN SQLCODE NOT EQUAL ZERO                               04740021
047500             MOVE SU069-OTBND-TRIP-ID TO PV-KEY-OTBND-TRIP-ID     04750021
047600             MOVE SU069-BUS-AREA-ID   TO PV-KEY-BUS-AREA-ID       04760021
047700             DISPLAY '**************************************'     04770021
047800             DISPLAY '3000-ERROR ISSUED ON                  '     04780021
047900             DISPLAY 'CURSOR DECLARE - CSR-SKUPRCHG         '     04790021
048000             DISPLAY PV-DISP-KEY-MSG                              04800021
048100             DISPLAY '**************************************'     04810021
048200             PERFORM 9900-SQL-ERROR                               04820021
048300     END-EVALUATE.                                                04830021
048400                                                                  04840021
048500 3100-OPEN-CURSOR.                                                04850021
048600                                                                  04860021
048700     MOVE SU069-OTBND-TRIP-ID         TO PV-DISP-TRIP.            04870021
048800     MOVE SU069-TRIP-OCRNC-ID         TO PV-DISP-OCRNC.           04880021
048900*    DISPLAY '*  3100-OPEN-CURSOR      '                          04890054
049000*                'TRIP:'  PV-DISP-TRIP '   '                      04900054
049100*                'OCRNC:' PV-DISP-OCRNC                           04910054
049200                                                                  04920021
049300     MOVE '3100-OPEN-CURSOR'          TO PV-ABEND-PARAGRAPH       04930021
049400                                                                  04940021
049500     EXEC SQL                                                     04950021
049600        OPEN CSR-SKUPRCHG                                         04960021
049700     END-EXEC.                                                    04970021
049800                                                                  04980021
049900     EVALUATE SQLCODE                                             04990021
050000        WHEN 0                                                    05000021
050100            SET PS-END-OF-CSR-N       TO TRUE                     05010021
050200        WHEN OTHER                                                05020021
050300             MOVE SU069-OTBND-TRIP-ID TO PV-KEY-OTBND-TRIP-ID     05030021
050400             MOVE SU069-BUS-AREA-ID   TO PV-KEY-BUS-AREA-ID       05040021
050500             DISPLAY '**************************************'     05050021
050600             DISPLAY '3100-ERROR ISSUED ON                  '     05060021
050700             DISPLAY 'OPEN CURSOR CSR-SKUPRCHG              '     05070021
050800             DISPLAY PV-DISP-KEY-MSG                              05080021
050900             DISPLAY '**************************************'     05090021
051000             PERFORM 9900-SQL-ERROR                               05100021
051100     END-EVALUATE.                                                05110021
051200                                                                  05120021
051300 3200-FETCH-CURSOR.                                               05130021
051400                                                                  05140021
051500     MOVE '3200-FETCH-CURSOR'         TO PV-ABEND-PARAGRAPH.      05150021
051600                                                                  05160021
051700*    MOVE SU069-OTBND-TRIP-ID         TO PV-DISP-TRIP.            05170025
051800*    MOVE SU069-TRIP-OCRNC-ID         TO PV-DISP-OCRNC.           05180025
051900*    DISPLAY '*  3200-FETCH-CURSOR     '                          05190054
052000*                'TRIP:'  PV-DISP-TRIP '   '                      05200054
052100*                'OCRNC:' PV-DISP-OCRNC                           05210054
052200                                                                  05220021
052300     EXEC SQL                                                     05230021
052400        FETCH CSR-SKUPRCHG                                        05240021
052500         INTO :XLT00032-PRCHG-ID                                  05250021
052600             ,:SUT00095-TRIP-OCRNC-ID                             05260021
052700             ,:XLT00003-SKU-NBR                                   05270021
052800             ,:XLT00033-PRCHG-EFF-DTE                             05280021
052900*            ,:XLT00034-PREV-UNT-RTL-AMT                          05290033
053000             ,:XLT00034-UNT-RTL-AMT                               05300021
053100             ,:XLT00034-LAST-UPD-TMST                             05310021
053200             ,:XLT00032-PRCHG-TYP-CDE                             05320021
053300             ,:SUT00095-DEPT-NBR                                  05330021
053400             ,:SUT00095-BUS-AREA-ID                               05340021
053500             ,:SUT00095-MAJ-CL-NBR                                05350021
053510*CLP 07/10/2015 START                                             05351084
053600             ,:SUT00095-BRND-ID                                   05360083
053610*CLP 07/10/2015 END                                               05361084
053700             ,:XLT00010-LOC-NM                                    05370021
053800             ,:XLT00003-SKU-DESC                                  05380021
053900             ,:SUT00007-CRE-TMST                                  05390021
054000             ,:CNTRID-SCAC-CDE                                    05400021
054100             ,:CNTRID-TRLR-ID                                     05410021
054200             ,:SUT00095-UNT-QTY                                   05420033
054300     END-EXEC.                                                    05430021
054400                                                                  05440021
054500     EVALUATE TRUE                                                05450021
054600        WHEN SQLCODE EQUAL ZERO                                   05460021
054700             ADD 1 TO PV-CSR-SKUPRCHG-COUNT                       05470027
054710             DISPLAY '*** SUT00095-TRIP-OCRNC-ID '                05471088
054720              SUT00095-TRIP-OCRNC-ID ' ' SUT00095-BRND-ID         05472089
054800        WHEN SQLCODE = +100                                       05480021
054900             MOVE PV-CSR-SKUPRCHG-COUNT                           05490027
055000                                      TO PV-DISP-FETCH-COUNT      05500027
055100             DISPLAY 'END OF CURSOR   '                           05510027
055200                   'FETCH COUNT: '  PV-DISP-FETCH-COUNT           05520027
055300             SET PS-END-OF-CSR-Y        TO TRUE                   05530027
055400        WHEN OTHER                                                05540021
055500             MOVE SU069-OTBND-TRIP-ID TO PV-KEY-OTBND-TRIP-ID     05550021
055600             MOVE SU069-BUS-AREA-ID   TO PV-KEY-BUS-AREA-ID       05560021
055700             MOVE PV-CSR-SKUPRCHG-COUNT                           05570026
055800                                      TO PV-DISP-FETCH-COUNT      05580025
055900            DISPLAY '**************************************'      05590021
056000            DISPLAY '3200-ERROR ISSUED ON                  '      05600021
056100            DISPLAY 'FETCH CURSOR CSR-SKUPRCHG             '      05610021
056200            DISPLAY 'FETCH COUNT: '  PV-DISP-FETCH-COUNT          05620025
056300            DISPLAY PV-DISP-KEY-MSG                               05630021
056400            DISPLAY '**************************************'      05640021
056500            PERFORM 9900-SQL-ERROR                                05650021
056600     END-EVALUATE.                                                05660021
056700                                                                  05670021
056800 3300-PROCESS-CURSOR.                                             05680021
056900                                                                  05690065
057000     PERFORM 4200-GET-PREV-PRICE.                                 05700033
057100     PERFORM 4210-GET-DEPT-NAME.                                  05710050
057200     PERFORM 4300-MOVE-TO-OUTPUT.                                 05720021
057300     PERFORM 8100-WRITE-OUTPUT-FILE.                              05730021
057400     PERFORM 3200-FETCH-CURSOR.                                   05740021
057500                                                                  05750021
057600 3400-CLOSE-CURSOR.                                               05760021
057700                                                                  05770021
057800     MOVE '3400-CLOSE-CURSOR'         TO PV-ABEND-PARAGRAPH       05780021
057900                                                                  05790021
058000     MOVE SU069-OTBND-TRIP-ID         TO PV-DISP-TRIP.            05800021
058100     MOVE SU069-TRIP-OCRNC-ID         TO PV-DISP-OCRNC.           05810021
058200**   DISPLAY '*  3400-CLOSE-CURSOR     '                          05820032
058300**               'TRIP:'  PV-DISP-TRIP '   '                      05830032
058400**               'OCRNC:' PV-DISP-OCRNC                           05840032
058500                                                                  05850021
058600                                                                  05860021
058700     EXEC SQL                                                     05870021
058800        CLOSE CSR-SKUPRCHG                                        05880021
058900     END-EXEC.                                                    05890021
059000                                                                  05900021
059100     EVALUATE TRUE                                                05910021
059200        WHEN SQLCODE EQUAL ZERO                                   05920021
059300           CONTINUE                                               05930021
059400        WHEN OTHER                                                05940021
059500             MOVE SU069-OTBND-TRIP-ID  TO PV-KEY-OTBND-TRIP-ID    05950021
059600             MOVE SUT00095-DEPT-NBR    TO PV-KEY-DEPT-NBR         05960021
059700             MOVE SUT00095-MAJ-CL-NBR  TO PV-KEY-MAJ-CLS-NBR      05970021
059800             MOVE SU069-BUS-AREA-ID    TO PV-KEY-BUS-AREA-ID      05980021
059810*CLP 07/10/2015 START                                             05981084
059900             MOVE SUT00095-BRND-ID     TO PV-KEY-BRND-ID          05990083
059910*CLP 07/10/2015 END                                               05991084
060000             DISPLAY '**************************************'     06000021
060100             DISPLAY '3400-ERROR ISSUED ON                  '     06010021
060200             DISPLAY 'CLOSE CURSOR CSR-SKUPRCHG             '     06020021
060300             DISPLAY PV-DISP-KEY-MSG                              06030021
060400             DISPLAY '**************************************'     06040021
060500             PERFORM 9900-SQL-ERROR                               06050021
060600     END-EVALUATE.                                                06060021
060700                                                                  06070021
060800 3500-BUILD-NO-PC-RPT.                                            06080078
060900                                                                  06090065
061000     MOVE '3500-NO-PRICE-CHG'         TO PV-ABEND-PARAGRAPH.      06100078
061100     SET PS-PRICE-CHG                 TO TRUE.                    06110078
061200                                                                  06120065
061300     EXEC SQL                                                     06130078
061400       SELECT G.OTBND_TRIP_ID                                     06140078
061500             ,D.LOC_NBR                                           06150078
061600             ,D.LOC_NM                                            06160078
061700             ,J.SCAC_CDE                                          06170078
061800             ,J.TRLR_ID                                           06180078
061900             ,J.TRLR_SRL_NBR                                      06190078
062000         INTO                                                     06200078
062100            :SUT00007-OTBND-TRIP-ID                               06210078
062200           ,:XLT00010-LOC-NBR                                     06220078
062300           ,:XLT00010-LOC-NM                                      06230078
062400           ,:CNTRID-SCAC-CDE                                      06240078
062500           ,:CNTRID-TRLR-ID                                       06250078
062600           ,:CNTRID-TRLR-SRL-NBR                                  06260078
062700         FROM XLT_LOC D                                           06270078
062800             ,SUT_TRIP_SUM G                                      06280078
062900             ,TSUOBTR H                                           06290078
063000             ,TCNTRID J                                           06300078
063100           WHERE D.LOC_NBR =                                      06310078
063200                       H.DEST_OPER_UNT_ID                         06320078
063300             AND H.OTBND_TRIP_ID = G.OTBND_TRIP_ID                06330078
063400             AND J.TRLR_SRL_NBR  = H.TRLR_SRL_NBR                 06340078
063500             AND G.TRIP_OCRNC_ID = :SUT00095-TRIP-OCRNC-ID        06350078
063600     END-EXEC.                                                    06360078
063700                                                                  06370067
063800     EVALUATE TRUE                                                06380078
063900        WHEN SQLCODE EQUAL ZERO                                   06390078
064000             SET PS-NO-PRICE-CHG TO TRUE                          06400078
064100                                                                  06410078
064200        WHEN SQLCODE = +100                                       06420078
064300             CONTINUE                                             06430078
064400                                                                  06440078
064500        WHEN OTHER                                                06450078
064600             MOVE SU069-OTBND-TRIP-ID TO PV-KEY-OTBND-TRIP-ID     06460078
064700             MOVE SU069-BUS-AREA-ID   TO PV-KEY-BUS-AREA-ID       06470078
064800             MOVE PV-CSR-SKUPRCHG-COUNT                           06480078
064900                                      TO PV-DISP-FETCH-COUNT      06490078
065000            DISPLAY '**************************************'      06500078
065100            DISPLAY '3500-ERROR ISSUED ON                  '      06510078
065200            DISPLAY 'SELECT WHEN NO PRICE CHANGE           '      06520078
065300            DISPLAY PV-DISP-KEY-MSG                               06530078
065400            DISPLAY '**************************************'      06540078
065500            PERFORM 9900-SQL-ERROR                                06550078
065600     END-EVALUATE.                                                06560078
065700                                                                  06570065
065800 3600-MOVE-TO-OUTPUT.                                             06580078
065900                                                                  06590078
066000     INITIALIZE SU105-INPUT-RECORD.                               06600078
066100                                                                  06610078
066200     MOVE SUT00007-OTBND-TRIP-ID    TO SU105-OTBND-TRIP-ID.       06620078
066300     MOVE XLT00010-LOC-NBR          TO SU105-LOC-NBR.             06630078
066400     MOVE XLT00010-LOC-NM           TO SU105-LOC-NM.              06640078
066500     MOVE CNTRID-SCAC-CDE           TO SU105-SCAC-CDE.            06650078
066600     MOVE CNTRID-TRLR-SRL-NBR       TO SU105-TRLR-SRL-NBR.        06660078
066700     MOVE CNTRID-TRLR-ID            TO SU105-TRLR-ID.             06670078
066800     MOVE PC-NO-PC-VERBIAGE         TO SU105-SKU-DESC.            06680078
066900                                                                  06690066
067000 4200-GET-PREV-PRICE.                                             06700033
067100                                                                  06710033
067200     MOVE '4200-GET-PREV-PRICE'       TO PV-ABEND-PARAGRAPH.      06720033
067300                                                                  06730033
067400     EXEC SQL                                                     06740035
067500         SELECT A.UNT_RTL_AMT                                     06750035
067600           INTO :UPCPLS-UNT-RTL-AMT                               06760035
067700         FROM TUPCPLS A                                           06770035
067800            , XLT_SKU B                                           06780035
067900         WHERE B.SKU_NBR = :XLT00003-SKU-NBR                      06790035
068000           AND A.ITM_NBR = B.ITM_NBR                              06800035
068100           AND (A.STR_NBR = :SU069-LOC-NBR                        06810035
068200            OR  A.STR_NBR = 0)                                    06820035
068300           AND DATE(:XLT00033-PRCHG-EFF-DTE) - 1 DAYS             06830039
068400             BETWEEN DATE(A.EFF_BEG_TMST)                         06840037
068500             AND COALESCE(DATE(A.EFF_END_TMST),                   06850039
068600                 DATE(:XLT00033-PRCHG-EFF-DTE)                    06860039
068700                 + :PV-FUTURE-DAYS DAYS)                          06870039
068800         ORDER BY A.STR_NBR DESC                                  06880048
068900         FETCH FIRST 1 ROWS ONLY                                  06890048
069000         WITH UR                                                  06900035
069100     END-EXEC.                                                    06910034
069200                                                                  06920034
069300     EVALUATE TRUE                                                06930034
069400         WHEN SQLCODE = 0                                         06940034
069500              CONTINUE                                            06950047
069600         WHEN SQLCODE = -811                                      06960047
069700              CONTINUE                                            06970047
069800        WHEN SQLCODE = 100                                        06980047
069900*           MOVE ZEROS TO XST00008-UNT-RTL-AMT                    06990047
070000            MOVE ZEROS TO UPCPLS-UNT-RTL-AMT                      07000047
070100            MOVE XLT00003-SKU-NBR TO PV-DISP-SKU                  07010047
070200            MOVE SU069-LOC-NBR TO PV-DISP-STORE                   07020047
070300            DISPLAY '**************************************'      07030047
070400            DISPLAY '*** PREVIOUS RETAIL AMOUNT NOT FOUND ***'    07040047
070500            DISPLAY 'SKU:  ' PV-DISP-SKU                          07050047
070600            DISPLAY 'STR:  ' PV-DISP-STORE                        07060047
070700        WHEN SQLCODE NOT EQUAL ZERO                               07070047
070800             DISPLAY '**************************************'     07080047
070900             DISPLAY '4200-ERROR ISSUED ON                  '     07090047
071000             DISPLAY 'SELECT A.UNT_RTL_AMT                  '     07100047
071100             MOVE XLT00003-SKU-NBR TO PV-DISP-SKU                 07110047
071200             MOVE SU069-LOC-NBR TO PV-DISP-STORE                  07120047
071300             DISPLAY 'SKU:  ' PV-DISP-SKU                         07130047
071400             DISPLAY 'LOC:  ' PV-DISP-STORE                       07140047
071500             DISPLAY '**************************************'     07150047
071600             PERFORM 9900-SQL-ERROR                               07160047
071700     END-EVALUATE.                                                07170047
071800                                                                  07180047
071900 4210-GET-DEPT-NAME.                                              07190050
072000                                                                  07200050
072100     MOVE '4210-GET-DEPT-NAME'        TO PV-ABEND-PARAGRAPH.      07210050
072200                                                                  07220050
072300     EXEC SQL                                                     07230050
072400       SELECT DEPT_NM                                             07240050
072500         INTO :XLT00002-DEPT-NM                                   07250051
072600         FROM XLT_DEPT                                            07260050
072700        WHERE                                                     07270050
072800              DEPT_NBR          = :SUT00095-DEPT-NBR              07280050
072900     END-EXEC.                                                    07290050
073000                                                                  07300050
073100     EVALUATE TRUE                                                07310050
073200         WHEN SQLCODE = 0                                         07320050
073300             CONTINUE                                             07330050
073400        WHEN SQLCODE = 100                                        07340050
073500             MOVE SPACE               TO XLT00002-DEPT-NM         07350051
073600        WHEN SQLCODE NOT EQUAL ZERO                               07360050
073700             MOVE SPACE               TO XLT00002-DEPT-NM         07370051
073800     END-EVALUATE.                                                07380050
073900                                                                  07390050
074000 4300-MOVE-TO-OUTPUT.                                             07400033
074100                                                                  07410021
074200     MOVE SU069-LOC-NBR             TO SU105-LOC-NBR.             07420021
074300     MOVE CNTRID-SCAC-CDE           TO SU105-SCAC-CDE.            07430021
074400     MOVE SU069-OTBND-TRIP-SRL-NBR  TO SU105-TRLR-SRL-NBR.        07440021
074500     MOVE CNTRID-TRLR-ID            TO SU105-TRLR-ID.             07450021
074600     MOVE SU069-OTBND-TRIP-ID       TO SU105-OTBND-TRIP-ID.       07460021
074700     MOVE XLT00003-SKU-NBR          TO SU105-SKU-NBR.             07470021
074800     MOVE XLT00032-PRCHG-ID         TO SU105-PRCHG-ID.            07480021
074900     MOVE XLT00033-PRCHG-EFF-DTE    TO SU105-PRIC-EFF-STRT-DTE.   07490021
075000     MOVE UPCPLS-UNT-RTL-AMT        TO SU105-PREV-UNT-RTL-AMT.    07500035
075100*    MOVE XST00008-UNT-RTL-AMT      TO SU105-PREV-UNT-RTL-AMT.    07510035
075200*    MOVE XLT00034-PREV-UNT-RTL-AMT TO SU105-PREV-UNT-RTL-AMT.    07520033
075300     MOVE XLT00034-UNT-RTL-AMT      TO SU105-UNT-RTL-AMT.         07530021
075400     MOVE XLT00032-PRCHG-TYP-CDE    TO SU105-PRCHG-TYP-CDE.       07540021
075500     MOVE XLT00003-SKU-DESC         TO SU105-SKU-DESC.            07550021
075600     MOVE SUT00095-UNT-QTY          TO SU105-SUMMED-UNT-QTY.      07560021
075700     MOVE XLT00010-LOC-NM           TO SU105-LOC-NM.              07570021
075800     MOVE SUT00095-DEPT-NBR         TO SU105-DEPT-NBR.            07580021
075900     MOVE SUT00095-MAJ-CL-NBR       TO SU105-MAJ-CLS-NBR.         07590021
076000     MOVE SU069-BUS-AREA-ID         TO SU105-BUS-AREA-ID.         07600021
076010*CLP 07/10/2015 START                                             07601085
076100     MOVE SUT00095-BRND-ID          TO SU105-BRND-ID.             07610084
076110*CLP 07/10/2015 END                                               07611084
076200     MOVE XLT00033-PRCHG-EFF-DTE    TO PV-WORK-DATE.              07620021
076300     MOVE PV-WORK-TMST              TO SU105-UPD-PRIC-EFF-DTE.    07630021
076400*    MOVE XLT00034-LAST-UPD-TMST    TO SU105-LAST-UPD-TMST.       07640021
076500     MOVE PV-CURRENT-TMST           TO SU105-LAST-UPD-TMST.       07650021
076600     MOVE XLT00002-DEPT-NM          TO SU105-DEPT-NM.             07660052
076700                                                                  07670021
076800 8000-READ-EXTRACT-FILE.                                          07680021
076900                                                                  07690021
077000     READ INPUT-UPDATE-FILE                                       07700021
077100         INTO SU069-EXTRACT-RECORD                                07710021
077200     AT END                                                       07720021
077300         SET PS-EOF-EXTRACT-YES       TO TRUE                     07730021
077400     NOT AT END                                                   07740021
077500         ADD 1                          TO PV-INPUT-COUNT         07750025
077600         MOVE  SU069-OTBND-TRIP-ID      TO PV-DISP-TRIP           07760025
077700         MOVE  SU069-TRIP-OCRNC-ID      TO PV-DISP-OCRNC          07770025
077800         MOVE  SU069-OTBND-TRIP-SRL-NBR TO PV-DISP-TRLR-SRL       07780025
077900         MOVE  SU069-LOC-NBR            TO PV-DISP-STORE          07790025
078000         DISPLAY '*'                                              07800024
078100         DISPLAY 'TRIP:'    PV-DISP-TRIP                          07810025
078200                 '  OCRNC:' PV-DISP-OCRNC                         07820024
078300                 '  SRL:'   PV-DISP-TRLR-SRL                      07830025
078400                 '  STORE:' PV-DISP-STORE                         07840025
078500     END-READ.                                                    07850021
078600                                                                  07860021
078700 8100-WRITE-OUTPUT-FILE.                                          07870021
078800                                                                  07880021
078900     WRITE OUTPUT-REC                                             07890021
079000         FROM SU105-INPUT-RECORD.                                 07900021
079100                                                                  07910021
079200 9000-EOJ.                                                        07920021
079300                                                                  07930021
079400     CLOSE      INPUT-UPDATE-FILE                                 07940021
079500                OUTPUT-FILE.                                      07950021
079600                                                                  07960021
079700*    PERFORM 3400-CLOSE-CURSOR.                                   07970021
079800                                                                  07980021
079900     DISPLAY SPACES.                                              07990021
080000     DISPLAY ' SUKUT151'                                          08000021
080100     DISPLAY SPACES.                                              08010021
080200     MOVE PV-INPUT-COUNT              TO PV-DISP-NBR              08020021
080300     DISPLAY 'INPUTS READ   = ' PV-DISP-NBR.                      08030021
080400                                                                  08040021
080500 9800-SQL-WARNING.                                                08050021
080600                                                                  08060021
080700     MOVE SQLCODE               TO SQLCODE2.                      08070021
080800     MOVE SQLERRD(3)            TO SQLERRD3.                      08080021
080900     DISPLAY '** ABEND **       ** = SQLWARNING'.                 08090021
081000     DISPLAY '** PROGRAM        ** = SUKUT151'.                   08100021
081100     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        08110021
081200     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  08120021
081300     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  08130021
081400                                                                  08140021
081500     COPY DPPD004.                                                08150021
081600     SET ABEND-4013-DB2-ERROR   TO TRUE                           08160021
081700     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         08170021
081800                                                                  08180021
081900 9900-SQL-ERROR.                                                  08190021
082000                                                                  08200021
082100     MOVE SQLCODE               TO SQLCODE2.                      08210021
082200     MOVE SQLERRD(3)            TO SQLERRD3.                      08220021
082300     DISPLAY '** ABEND **       ** = SQLERROR'.                   08230021
082400     DISPLAY '** PROGRAM        ** = SUKUT151'.                   08240021
082500     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        08250021
082600     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  08260021
082700                                                                  08270021
082800     COPY DPPD004.                                                08280021
082900     SET ABEND-4013-DB2-ERROR   TO TRUE                           08290021
083000     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         08300021
