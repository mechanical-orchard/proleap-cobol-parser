000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    INKCS010.                                         00040000
000500 AUTHOR.        M. FURLICK - STRATAGEM                            00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  09-08-93.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*----------------------------------------------------------------*00100000
001100*    I010 - PHYSICAL INVENTORY ADJUSTMENT SELECTION CRITERIA     *00110000
001200*                                                                *00120000
001300*    THIS PROGRAM IS THE ENTRY POINT TO THE PI ADJUSTMENT SUB-   *00130000
001400*    SYSTEM.  A CORPORATE USER IS PROMPTED FOR THE STORE NUMBER; *00140000
001500*    A STORE USER HAS THIS FILLED IN.  THE USER MAY OPT TO GO    *00150000
001600*    TO THE ADJUSTMENT ADD SCREEN OR TO THE PHYSICAL INVENTORY   *00160000
001700*    LIST SCREEN.  STORE AND AREA NUMBER ARE REQUIRED ENTRIES.   *00170000
001800*----------------------------------------------------------------*00180000
001900*    CHANGED 7/14/00   S.JACKSON     CHGID: WR21015              *00190000
002000**** FIX EXISTING ABEND ISSUE FOR VALID STORE (TSTR000) NOT SET  *00200000
002100*    UP ON TINVPAR. PARA 4200- CHANGED TO REMOVE VALIDITY FOR    *00210000
002200*    NULL VALUE - INSTEAD ISSUE ERROR MESSAGE FOR -305 SQLCODE.  *00220000
002300**** ADD PF-KEY FOR ADJUSTMENT 'MASS-ADD' SCREEN (PF17-INAPHADD).*00230000
002400*    THIS IS FOR NEW RECORDS BEING ADDED TO EXISTING AREAS. THIS *00240000
002500*    FNC WILL ALSO VERIFY THIS STR/AREA IN ON TSUMINV OR TADJADD.*00250000
002600*----------------------------------------------------------------*00260000
002700*    CHANGED 1/15/00   R.BUTZ        CHGID: RB0115               *00270000
002800*                                                                *00280000
002900*    FIX EDITING FOR STORE/AREA COMBINATION.                     *00290000
003000*    THE FIRST CHECK IS AGAINST THE INVLOC TABLE.  IF THE        *00300000
003100*    STORE/AREA DOES NOT EXIST, THEN CHECK THE SUMINV TABLE.     *00310000
003200*    IF THE STORE/AREA STILL DOES NOT EXIST THE CHECK THE        *00320000
003300*    ADJADD.  IF THE STORE/AREA STILL DOES NOT EXIST THEN DISPLAY*00330000
003400*    THE ERROR MESSAGE TO ERROR NUMBER 00697                     *00340000
003500*                                                                *00350000
003600*----------------------------------------------------------------*00360000
003700*   CHANGED 4/24/02   R.BUTZ        CHGID: W23511               * 00370000
003800*                                                               * 00380000
003900*   MODIFICATIONS FOR THE MASS DELETE FUNCTION.                 * 00390000
004000*----------------------------------------------------------------*00400000
004100*   CHANGED 7/02/02   S.JACKSON     CHGID: S23511                *00410000
004200*                                                                *00420000
004300*   EXISTING FUNCTIONALITY IS ALLOWING A NON-INVENTORY STORE     *00430000
004400*   THE ABILITY TO ENTER ADDS IF AREA STILL RESIDED ON ONE OF    *00440000
004500*   3 DB2 TABLES(TSUMINV,TADJDTL,TADJADD) FROM A PRIOR INVENTORY *00450000
004600*----------------------------------------------------------------*00460000
004100*   CHANGED 9/23/03   S.JACKSON     CHGID: W25248                *00470000
004200*                                                                *00480000
004300*   EXPAND STORE NUMBER TO 4 DIGITS. REPLACE TSTR000 (XMT_LOC).  *00490000
004300*   ALLOW PRINTING OF A STORE/AREA DETAIL(PF18) FROM MAIN SCREEN.*00500000
004600*----------------------------------------------------------------*00510000
R25248*   CHANGED 12/24/03  R.JANSSEN     CHGID: W25248                 00520000
R25248*   ASRA ABEND WHEN INV TABLES ARE OUT OF SYNC.                   00530000
004600*----------------------------------------------------------------*00540000
RM0123*   CHANGED 01/23/04  R. MCDONALD   CHGID: RM0123                 00550000
RM0123*   REMOVE FIX FOR ASRA ABEND WHEN INV TABLES ARE OUT OF SYNC.    00560000
RM0123*   THIS WAS ONLY AN ISSUE IN LEARNING REGION WHERE THERE WASN'T  00570000
RM0123*   ANY SUMINV DATA LOADED.  THE LOGIC IS CAUSING SUMINV AND      00580000
RM0123*   ADJADD TABLE TO BE SEARCHED WHEN FOR AREA 88888 AND 99999.    00590000
RM0123*   THESE AREAS ARE SPECIAL AND WILL NOT NECESSARILY EXIST IN     00600000
RM0123*   THESE TABLES, BUT IT DOES EXIST IN TINVLOC.  THE ASRA FIX     00610000
RM0123*   WAS NOT CHECKING THE SWITCH FOR THE AREA EXISTING IN THE      00620000
RM0123*   TINVLOC.                                                      00630000
      *                                                                 00640000
W26600* W26600  06-29-2004 ROD JANSSEN INV STORE EXPANSION              00650000
W26600*----------------------------------------------------------------*00660013
W26006*   CHANGED 2/24/05   ERIN SEARL    CHGID: W26006                *00670013
W26006*   REMOVE REFERENCES TO OBSOLETE STORE TABLE.                   *00680013
      *----------------------------------------------------------------*00690015
      *   CHANGED 01/23/2006 LEE YANG     CHGID: W29908                *00700015
      *   ADD PKMO.PROCLIB TO THE JCLLIB CONCATENATION.                *00710015
W30692* W30692  02-01-2006 ROD JANSSEN DEFINE THE DEFAULT PRINTER FOR   00720018
W30692*                                THE USER.                        00730018
J28545* W28545 06-16-2006 JAN BLAZICH  TINVPAR/TINCNTL ARE USED TO GET  00731023
J28545*                                THE PROPER INV-ID AND STORE      00732023
      * W33304 05-01-2008 JILL LIN     HOLDING INVENTORY LEDGER OPEN    00733024
      *                                ACROSS PERIODS INVENTORY SHORTAGE00734024
      *                                REPORTING                        00735024
W26006*----------------------------------------------------------------*00740013
263126* CHANGED 10/25/2021    BY JIM HUNTER      WR: CHG0263126         00741026
263126* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00742026
263126* MAKING THE CALL DYNAMIC VS STATIC.                              00743026
263126*----------------------------------------------------------------*00744026
1122RM* CHANGED 11/03/2022    BY BOB MCASEY      WR: CHG0277188         00746027
1122RM* ADDED THE DPKCS930 COPYBOOK. CHANGED THE PARAMETERS FOR CALLING 00747027
1122RM* THE CICS ARCHITECTURE API.                                      00748027
1122RM*---------------------------------------------------------------* 00749027
1122JK* CHANGED 01/11/2024    BY JEAN KURK       WR: CHG0297810         00749131
1122JK* REMOVE CODE FOR LOCAL-05                                        00749229
1122RM*---------------------------------------------------------------* 00749429
004700                                                                  00750000
004900 ENVIRONMENT DIVISION.                                            00760000
005300 DATA DIVISION.                                                   00770000
005600 WORKING-STORAGE SECTION.                                         00780000
W25428                                                                  00790000
W25428 01  TD-TRANSIENT-DATA-AREA.                                      00800000
W25428     05  TD-QUEUE-NAME           PIC X(4)     VALUE 'IRTD'.       00810000
W25428     05  TD-QUEUE-NAME-LENGTH    PIC S9(4)    VALUE +4            00820000
W25428                                 COMP SYNC.                       00830000
W25428     05  TD-JCL-LINE             PIC X(80)    VALUE SPACES.       00840000
W25428     05  TD-JCL-LINE-LENGTH      PIC S9(4)    VALUE +80           00850000
W25428                                 COMP SYNC.                       00860000
W25428                                                                  00870000
W25428 01  JL-JCL-WORK-AREA.                                            00880000
W25428     05  JL-JCL-INK950-LINE-1.                                    00890000
W25428         10  FILLER                     PIC X(02)    VALUE '//'.  00900000
W25428         10  JL-JCL-INK950-JOBNAME      PIC X(08)    VALUE SPACES.00910000
W25428         10  FILLER REDEFINES JL-JCL-INK950-JOBNAME.              00920000
W25428             15  FILLER                 PIC X(07).                00930000
W25428             15  JL-JCL-INK950-JOB-UNQ  PIC X(01).                00940000
W25428         10  FILLER                     PIC X(11)    VALUE        00950000
W25428             ' JOB KOHLS,'.                                       00960000
W25428         10  FILLER                     PIC X(01)    VALUE QUOTE. 00970000
W25428         10  FILLER                     PIC X(18)    VALUE        00980000
W25428             'INV ADJUST DTL RPT'.                                00990000
W25428         10  FILLER                     PIC X(01)    VALUE QUOTE. 01000000
W25428         10  FILLER                     PIC X(01)    VALUE ','.   01010000
W25428     05  JL-JCL-INK950-LINE-2.                                    01020000
W25428         10  FILLER                     PIC X(21)    VALUE        01030000
W25428             '//             CLASS='.                             01040000
W25428         10  JL-JCL-INK950-JOBCLASS     PIC X(01)    VALUE 'Q'.   01050000
W25428         10  FILLER                     PIC X(10)    VALUE        01060000
W25428             ',MSGCLASS='.                                        01070000
W25428         10  JL-JCL-INK950-MSGCLASS     PIC X(01)    VALUE 'P'.   01080000
W25428         10  JL-JCL-INK950-NOTIFY-OPT   PIC X(16)    VALUE SPACES.01090000
W25428     05  JL-JCL-INK950-LINE-3.                                    01100000
W25428         10  FILLER                     PIC X(13)    VALUE        01110000
W25428             '/*JOBPARM K=0'.                                     01120000
W25428     05  JL-JCL-INK950-CMT-SHORT.                                 01130000
W25428         10  FILLER                     PIC X(03)    VALUE '//*'. 01140000
W25428     05  JL-JCL-INK950-CMT-LONG.                                  01150000
W25428         10  FILLER                     PIC X(40)    VALUE        01160000
W25428             '//**************************************'.          01170000
W25428         10  FILLER                     PIC X(32)    VALUE        01180000
W25428             '********************************'.                  01190000
W25428     05  JL-JCL-INK950-CMT-USER-INFO.                             01200000
W25428         10  FILLER                     PIC X(26)    VALUE        01210000
W25428             '//* INK950 - SUBMITTED BY '.                        01220000
W25428         10  JL-JCL-INK950-CMT-USRID    PIC X(08)    VALUE SPACES.01230000
W25428         10  FILLER                     PIC X(06)    VALUE        01240000
W25428             ' FROM '.                                            01250000
W25428         10  JL-JCL-INK950-CMT-REGION   PIC X(08)    VALUE SPACES.01260000
W25428         10  FILLER                     PIC X(04)    VALUE        01270000
W25428             ' ON '.                                              01280000
W25428         10  JL-JCL-INK950-CMT-SUBDATE  PIC X(10)    VALUE SPACES.01290000
W25428         10  FILLER                     PIC X(02)    VALUE SPACES.01300000
W25428         10  JL-JCL-INK950-CMT-SUBTIME  PIC X(08)    VALUE SPACES.01310000
W25428     05  JL-JCL-INK950-CMT-1.                                     01320000
W25428         10  FILLER                     PIC X(40)    VALUE        01330000
W25428             '//* THIS JOB PRODUCES A DETAILED REPORT '.          01340000
W25428         10  FILLER                     PIC X(32)    VALUE        01350000
W25428             'OF SKU / UPC ADJUSTMENTS        '.                  01360000
W25428     05  JL-JCL-INK950-CMT-2.                                     01370000
W25428         10  FILLER                     PIC X(40)    VALUE        01380000
W25428             '//* REPORT AND PRINT THEM AT THE USER DE'.          01390000
W25428         10  FILLER                     PIC X(32)    VALUE        01400000
W25428             'FAULT PRINT DESTINATION OR      '.                  01410000
W25428     05  JL-JCL-INK950-CMT-3.                                     01420000
W25428         10  FILLER                     PIC X(40)    VALUE        01430000
W25428             '//* LOCAL, IF THERE IS NO DEFAULT PRINTE'.          01440000
W25428         10  FILLER                     PIC X(32)    VALUE        01450000
W25428             'R DEFINED TO THE USER.          '.                  01460000
W25428     05  JL-JCL-INK950-CMT-4.                                     01470000
W25428         10  FILLER                     PIC X(22)    VALUE        01480000
W25428             '//* OPTION REQUESTED: '.                            01490000
W25428         10  JL-JCL-INK950-CMT-OPTION   PIC X(20)    VALUE SPACES.01500000
W25428     05  JL-JCL-INK950-LINE-10.                                   01510000
W25428         10  FILLER                     PIC X(39)    VALUE        01520000
W25428             '//JOBLIB   DD DSN=PKMO.LOADLIB,DISP=SHR'.           01530000
W25428     05  JL-JCL-INK950-LINE-11.                                   01540000
W25428         10  FILLER                     PIC X(03)    VALUE        01550000
W25428             '//*'.                                               01560000
W25428     05  JL-JCL-INK950-LINE-12.                                   01570000
W25428         10  FILLER                     PIC X(32)    VALUE        01580000
W25428             '//PS020    EXEC INK9501,PRTDEST='.                  01590007
W25428         10  JL-JCL-INK950-PRTDEST      PIC X(08)    VALUE        01600007
W25428             'LOCAL'.                                             01610007
W25428     05  JL-JCL-INK950-LINE-13.                                   01620000
W25428         10  FILLER                     PIC X(20)    VALUE        01630000
W25428             '//S010.SYSUT1   DD *'.                              01640000
W25428     05  JL-JCL-INK950-LINE-14.                                   01650000
W25428         10  JL-JCL-INK950-REQ-OPTION   PIC X(56).                01660016
W25428     05  JL-JCL-INK950-LINE-EOD.                                  01670000
W25428         10  FILLER                     PIC X(02)    VALUE '/*'.  01680000
W25428     05  JL-JCL-INK950-LINE-EOF.                                  01690000
W25428         10  FILLER                     PIC X(05)    VALUE        01700000
W25428             '/*EOF'.                                             01710000
W25428     05  JL-JCL-TEST-LINE-10.                                     01720000
W25428         10  FILLER                     PIC X(35)    VALUE        01730000
W25428             '//PROCS  JCLLIB ORDER=(TKMA.PROCLIB'.               01740000
W29908         10  FILLER                     PIC X(19)    VALUE        01750014
W29908             ',QKMO.PROCLIB.STAGE'.                               01760014
W29908         10  FILLER                     PIC X(18)    VALUE        01770014
W29908             ',PKMO.PROCLIB)'.                                    01780014
W25428     05  JL-JCL-TEST-LINE-11A.                                    01790000
W25428         10  FILLER                     PIC X(39)    VALUE        01800000
W25428             '//JOBLIB   DD DSN=TKMA.LOADLIB,DISP=SHR'.           01810000
W25428     05  JL-JCL-TEST-LINE-11B.                                    01820000
W25428         10  FILLER                     PIC X(39)    VALUE        01830000
W25428             '//         DD DSN=QKMO.LOADLIB,DISP=SHR'.           01840000
W25428     05  JL-JCL-TEST-LINE-11C.                                    01850000
W25428         10  FILLER                     PIC X(39)    VALUE        01860000
W25428             '//         DD DSN=PKMO.LOADLIB,DISP=SHR'.           01870000
W25428     05  JL-JCL-TEST-NOTIFY.                                      01880000
W25428         10  FILLER                     PIC X(08)    VALUE        01890000
W25428             ',NOTIFY='.                                          01900000
W25428         10  JL-JCL-TEST-USER           PIC X(08)    VALUE SPACES.01910000
W25428     05  JL-JCL-INK950-CC-INFO.                                   01920000
W25428         10  FILLER                     PIC X(03)    VALUE        01930000
W25428             'SKU'.                                               01940000
W25428         10  FILLER                     PIC X(01)    VALUE SPACES.01950000
W26600         10  JL-JCL-INK950-STORE        PIC X(04)    VALUE SPACES.01960000
W26600*        10  JL-JCL-INK950-STR-NBR.                               01970000
W26600*            15  FILLER                 PIC X(01)    VALUE '0'.   01980000
W26600*            15  JL-JCL-INK950-STORE    PIC X(03)    VALUE SPACES.01990000
W25428         10  FILLER                     PIC X(01)    VALUE SPACES.02000000
W25428         10  JL-JCL-INK950-AREA         PIC X(07)    VALUE SPACES.02010000
W25428         10  FILLER                     PIC X(01)    VALUE SPACES.02020000
W25428         10  JL-JCL-INK950-SKU          PIC X(08)    VALUE SPACES.02030000
W25428         10  FILLER                     PIC X(01)    VALUE SPACES.02040000
W28545         10  JL-JCL-INK950-RETAIL       PIC X(09)    VALUE SPACES.02050016
W26600         10  FILLER                     PIC X(01)    VALUE SPACES.02060001
W26600         10  JL-JCL-INK950-USERID       PIC X(07)    VALUE SPACES.02070001
W26600         10  FILLER                     PIC X(01)    VALUE SPACES.02080010
W26600         10  JL-JCL-INK950-PRT-IND      PIC X(01)    VALUE SPACES.02090010
W28545         10  FILLER                     PIC X(01)    VALUE SPACES.02100016
W28545         10  JL-JCL-DB2-ACTL-INV-DTE    PIC X(10)    VALUE SPACES.02110016
                                                                        02120001
                                                                        02130000
005800 01  PC-PROGRAM-CONSTANTS.                                        02140000
005900     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'INKCS010'.  02150000
006000     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'IN010A  '.  02160000
006100     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'INKM010 '.  02170000
006200     05  PC-APPL-MAP              PIC S9(04)  VALUE  +1           02180000
006300                                              COMP.               02190000
006400     05  PC-MAX-MSG-VAR           PIC S9(04)  VALUE  +1           02200000
006500                                              COMP.               02210000
006600     05  PC-INTER-APPL-CODES.                                     02220000
006700         10  PC-INTER-APPL-CRIT-SPEC                              02230000
006800                                  PIC  X(01)  VALUE '1'.          02240000
006900         10  PC-INTER-APPL-LIST   PIC  X(01)  VALUE '2'.          02250000
007000     05  PC-MSG-VAR-SYMBOLIC      PIC  X(04)  VALUE '&VAR'.       02260000
007100     05  PC-ASTERISK              PIC  X(01)  VALUE '*'.          02270000
007200     05  PC-COMPANY               PIC  X(02)  VALUE '03'.         02280000
007300     05  PC-3                     PIC  9(01)  VALUE 3.            02290000
007300     05  PC-4                     PIC  9(01)  VALUE 4.            02300000
007400     05  PC-6                     PIC  9(01)  VALUE 6.            02310000
007500*    05  PC-NOT-INVENTORIED       PIC  X(10)  VALUE               02320000
007600*                                             '1993-12-08'.       02330000
007700                                                                  02340000
007800     05  PC-TSYMSG-NUMBERS.                                       02350000
007900         10  PC-TSYMSG-00005      PIC  9(05)  VALUE  00005.       02360000
008000         10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       02370000
008100         10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       02380000
008200         10  PC-TSYMSG-00017      PIC  9(05)  VALUE  00017.       02390000
008300         10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.       02400000
008400         10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.       02410000
008500         10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.       02420000
008600         10  PC-TSYMSG-00095      PIC  9(05)  VALUE  00095.       02430000
22000          10  PC-TSYMSG-00098      PIC  9(05)  VALUE  00098.       02440000
008700         10  PC-TSYMSG-00148      PIC  9(05)  VALUE  00148.       02450000
008800         10  PC-TSYMSG-00302      PIC  9(05)  VALUE  00302.       02460000
008900         10  PC-TSYMSG-00388      PIC  9(05)  VALUE  00388.       02470000
009000*        10  PC-TSYMSG-00543      PIC  9(05)  VALUE  00543.       02480000
009100         10  PC-TSYMSG-02472      PIC  9(05)  VALUE  02472.       02490000
009200         10  PC-TSYMSG-00551      PIC  9(05)  VALUE  00551.       02500000
009300         10  PC-TSYMSG-00697      PIC  9(05)  VALUE  00697.       02510000
W30692         10  PC-TSYMSG-01714      PIC  9(05)  VALUE  01714.       02520019
009400         10  PC-TSYMSG-99901      PIC  9(05)  VALUE  99901.       02530000
009500         10  PC-TSYMSG-99903      PIC  9(05)  VALUE  99903.       02540000
009600                                                                  02550000
009700 01  PS-PROGRAM-SWITCHES.                                         02560000
009800     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         02570000
009900         88  PS-ERROR                         VALUE  'Y'.         02580000
010000         88  PS-NO-ERROR                      VALUE  'N'.         02590000
010100     05  PS-STORE-INVENTORIED-SW  PIC  X(01)  VALUE  'N'.         02600000
010200         88  PS-STORE-INVENTORIED             VALUE  'Y'.         02610000
010300     05  PS-STORE-AREA-FOUND-SW   PIC  X(01)  VALUE  'N'.         02620000
010400         88  PS-STORE-AREA-FOUND              VALUE  'Y'.         02630000
010500         88  PS-STORE-AREA-NOT-FOUND          VALUE  'N'.         02640000
22000      05  PS-INTERNAL-READER-ENQ-DEQ-IND PIC X(1)    VALUE 'D'.    02650000
22000          88  PS-INTERNAL-READER-ENQUEUED            VALUE 'E'.    02660000
22000          88  PS-INTERNAL-READER-DEQUEUED            VALUE 'D'.    02670000
010600                                                                  02680000
010700 01  PV-PROGRAM-VARIABLES.                                        02690000
22000      05  PV-CICS-ID.                                              02700000
22000          10  PV-FIRST-4              PIC X(4)       VALUE SPACES. 02710000
22000          10  PV-CICS-REGION-TYPE     PIC X          VALUE SPACE.  02720000
22000              88  PV-CICS-REGION-PRODUCTION          VALUE 'P'.    02730000
22000              88  PV-CICS-REGION-ACCEPTANCE          VALUE 'A'.    02740000
22000              88  PV-CICS-REGION-QUALITY             VALUE 'Q'.    02750000
22000              88  PV-CICS-REGION-LEARNING            VALUE 'L'.    02760000
22000              88  PV-CICS-REGION-TEST                VALUE 'T'.    02770000
22000              88  PV-CICS-REGION-SYSTEST             VALUE 'S'.    02780000
22000          10  PV-CICS-REGION-CODE     PIC X          VALUE SPACES. 02790000
22000          10  PV-LAST-2               PIC X(2)       VALUE SPACES. 02800000
22000                                                                   02810000
010800     05  PV-CICS-RESP             PIC S9(04)  VALUE +0            02820000
010900                                              COMP SYNC.          02830000
011000     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            02840000
011100                                              COMP SYNC.          02850000
011200     05  PV-ASTERISK-CNT          PIC S9(04)  VALUE +0            02860000
011300                                              COMP SYNC.          02870000
011400     05  PV-NULL                  PIC S9(04)  VALUE +0            02880000
011500                                              COMP SYNC.          02890000
011400     05  PV-STR-NBR               PIC S9(04)  VALUE +0            02900000
011500                                              COMP SYNC.          02910000
W30692     05  PV-EDIT-LOC-NBR           PIC 9(04)  VALUE ZEROS.        02920018
W30692     05  PV-EDIT-LOC-NBR-RED REDEFINES                            02930018
W30692         PV-EDIT-LOC-NBR.                                         02940018
W30692         10  PV-EDIT-LOC-NBR-P1    PIC 9(01).                     02950018
W30692         10  PV-EDIT-LOC-NBR-P2    PIC 9(03).                     02960018
W30692     05  PV-USER-USER-CODE         PIC X(08)  VALUE SPACES.       02970018
W30692                                                                  02980018
011600                                                                  02990000
011700/                                                                 03000000
011800/                                                                 03010000
011900*----------------------------------------------------------------*03020000
012000*    MAP LAYOUT                                                  *03030000
012100*----------------------------------------------------------------*03040000
012200                                                                  03050000
012300     COPY INKM010.                                                03060000
012400                                                                  03070000
012500/                                                                 03080000
012600*----------------------------------------------------------------*03090000
012700*    ATTRIBUTE SETTINGS COPYBOOK.                                *03100000
012800*----------------------------------------------------------------*03110000
012900                                                                  03120000
013000     COPY DPWS015.                                                03130000
013100                                                                  03140000
W30692     COPY DPWS026.                                                03150018
W30692                                                                  03160018
013200*----------------------------------------------------------------*03170000
013300*    FUNCTION KEYS COPYBOOK                                      *03180000
013400*----------------------------------------------------------------*03190000
013500                                                                  03200000
013600     COPY DPWS016.                                                03210000
013700                                                                  03220000
013800/                                                                 03230000
013900*----------------------------------------------------------------*03240000
014000*  THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT     *03250000
014100*  SUB-ROUTINE (DPKUT100).                                       *03260000
014200*----------------------------------------------------------------*03270000
014300     COPY DPWS010I.                                               03280000
014400/                                                                 03290000
014500*----------------------------------------------------------------*03300000
014600*  THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS ARCHITECTURE*03310000
014700*  APPLICATION PROGRAMMING INTERFACE MODULE -- DPKCS030.         *03320000
014800*----------------------------------------------------------------*03330000
014900     COPY DPWS030.                                                03340000
1122RM     COPY DPWS930.                                                03341027
015000/                                                                 03350000
015100**--------------------------------------------------------------**03360000
015200*    STANDARD COMMAREA.                                           03370000
015300**--------------------------------------------------------------**03380000
015400                                                                  03390000
015500     COPY DPWS020.                                                03400000
015600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03410000
015700                                                                  03420000
015800***************************************************************** 03430000
015900*    INTER-APPLICATION COMMAREA.                                  03440000
016000***************************************************************** 03450000
016100                                                                  03460000
016200         10  INTER-APPL-COMM-AREA PIC X(200).                     03470000
W26600     COPY INWS001.                                                03480000
016400***************************************************************** 03490000
016500*    SPECIFIC COMMMAREA FOR DPKCS041.                             03500000
016600***************************************************************** 03510000
016700         10  ASC-SPECIFIC-COMMAREA.                               03520000
016800             15  ASC-INT-APPL-FORMAT-IND   PIC  X(01).            03530000
W26600             15  ASC-STORE-NBRX            PIC  X(04).            03540000
W26600             15  ASC-STORE-NBR  REDEFINES ASC-STORE-NBRX          03550000
W26600                                           PIC  9(04).            03560000
017200             15  ASC-AREA-NBRX.                                   03570000
017300                 20  ASC-AREA-NBR          PIC  9(06).            03580000
017400             15  ASC-STORE-NAME            PIC  X(25).            03590000
017500             15  ASC-REASON-MSG            PIC  X(25).            03600000
017600             15  ASC-HOLD-INTER-APPL       PIC  X(200).           03610000
017700         10  FILLER                        PIC  X(200).           03620000
017800     EJECT                                                        03630000
017900*----------------------------------------------------------------*03640000
018000*    ABEND PROCESSING COPYBOOK.                                  *03650000
018100*----------------------------------------------------------------*03660000
018200                                                                  03670000
018300     COPY DPWS013.                                                03680000
018400                                                                  03690000
018500*----------------------------------------------------------------*03700000
018600*    CURRENT DATE WORKA AREA.                                    *03710000
018700*----------------------------------------------------------------*03720000
018800                                                                  03730000
018900     COPY DPWS017.                                                03740000
019000                                                                  03750000
019100*----------------------------------------------------------------*03760000
019200*    LOCATION TABLE XMT_LOC                                      *03770000
019300*----------------------------------------------------------------*03780000
019400*                                                                 03790000
019500     EXEC SQL                                                     03800000
W26600          INCLUDE XMT00001                                        03810000
019700     END-EXEC.                                                    03820000
019800*                                                                 03830000
019900*----------------------------------------------------------------*03840000
020000*    INVENTORY PARAMETERS TABLE                                  *03850000
020100*----------------------------------------------------------------*03860000
020200                                                                  03870000
020300     EXEC SQL                                                     03880000
020400          INCLUDE TINVPAR                                         03890000
020500     END-EXEC.                                                    03900000
J28545*----------------------------------------------------------------*03901021
J28545*    INVENTORY CONTROL TABLE                                      03902021
J28545*----------------------------------------------------------------*03903021
J28545                                                                  03904021
J28545     EXEC SQL                                                     03905021
J28545          INCLUDE TINCNTL                                         03906021
J28545     END-EXEC.                                                    03907021
020600                                                                  03910000
020700*----------------------------------------------------------------*03920000
020800*    INVENTORY LOCATION TABLE                                    *03930000
020900*----------------------------------------------------------------*03940000
021000                                                                  03950000
021100     EXEC SQL                                                     03960000
021200          INCLUDE TINVLOC                                         03970000
021300     END-EXEC.                                                    03980000
021400                                                                  03990000
021500*----------------------------------------------------------------*04000000
021600*    INVENTORY SUM DATA LOADED VIA INK300                        *04010000
021700*----------------------------------------------------------------*04020000
021800                                                                  04030000
021900     EXEC SQL                                                     04040000
022000          INCLUDE TSUMINV                                         04050000
022100     END-EXEC.                                                    04060000
022200                                                                  04070000
022300*----------------------------------------------------------------*04080000
022400*    INVENTORY ADJUSTMENT ADD TABLE                              *04090000
022500*----------------------------------------------------------------*04100000
022600                                                                  04110000
022700     EXEC SQL                                                     04120000
022800          INCLUDE TADJADD                                         04130000
022900     END-EXEC.                                                    04140000
023000                                                                  04150000
W26600*---------------------------------------------------------------* 04160000
W26600*    TADJDTL - SALES ADJUSTMENT DETAIL TABLE                    * 04170000
W26600*---------------------------------------------------------------* 04180000
W26600*    EXEC SQL                                                     04190000
W26600*         INCLUDE TADJDTL                                         04200000
W26600*    END-EXEC.                                                    04210000
W26600*                                                                 04220000
22000 *---------------------------------------------------------------* 04230000
22000 *    TUSER   - USER INFORMATION TABLE                           * 04240000
22000 *---------------------------------------------------------------* 04250000
22000      EXEC SQL                                                     04260000
22000           INCLUDE TUSER                                           04270000
22000      END-EXEC.                                                    04280000
22000                                                                   04290000
023100*----------------------------------------------------------------*04300000
023200*    COMMUNICATIONS AREA                                         *04310000
023300*----------------------------------------------------------------*04320000
023400                                                                  04330000
023500     EXEC SQL                                                     04340000
023600          INCLUDE SQLCA                                           04350000
023700     END-EXEC.                                                    04360000
023800                                                                  04370000
023900/                                                                 04380000
024000 LINKAGE SECTION.                                                 04390000
024100                                                                  04400000
024200 01  DFHCOMMAREA.                                                 04410000
024300     05  FILLER                         OCCURS  1 TO 4072 TIMES   04420000
024400                                        DEPENDING ON EIBCALEN.    04430000
024500         10  FILLER                     PIC X.                    04440000
024600                                                                  04450000
024700                                                                  04460000
024800 PROCEDURE DIVISION.                                              04470000
024900**-------------------------------------------------------------** 04480000
025000** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 04490000
025100** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 04500000
025200** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 04510000
025300**                                                             ** 04520000
025400** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 04530000
025500** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 04540000
025600**-------------------------------------------------------------** 04550000
025700                                                                  04560000
025800 0000-MAIN-MODULE.                                                04570000
025900                                                                  04580000
026000     INITIALIZE DP030-CICS-API-FIELDS.                            04590000
026100     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04600000
026200     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04610000
026300     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04620000
026400     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04630000
026500                                                                  04640000
026600     MOVE LENGTH OF IN010AI        TO DP030-MAP-LENGTH (1).       04650000
026700     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04660000
026800     PERFORM 0001-CALL-CICS-ARCH-API.                             04670000
026900                                                                  04680000
027000     PERFORM 1000-CONTROL-PROCESSING                              04690000
027100                                                                  04700000
027200     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04710000
027300     PERFORM 0001-CALL-CICS-ARCH-API.                             04720000
027400                                                                  04730000
027500 0001-CALL-CICS-ARCH-API.                                         04740000
027600                                                                  04750000
027700*    CALL 'DPKCS030' USING DFHEIBLK                               04760027
1122RM     CALL DP930-CICS-ARCH-API                                     04761027
1122RM                     USING DFHEIBLK                               04762027
027800                           DFHCOMMAREA                            04770000
027900                           DP030-CICS-API-FIELDS                  04780000
028000                           DP020-STANDARD-COMMAREA                04790000
028100                           IN010AI.                               04800000
028200                                                                  04810000
028300     IF  DP030-RC-CALL-SUCCESSFUL                                 04820000
028400         CONTINUE                                                 04830000
028500     ELSE                                                         04840000
028600         SET DP013-NO-ROLLBACK                                    04850000
028700             DP013-XCTL-DISPLAY-RESTART                           04860000
028800             DP013-CICS-ABEND      TO TRUE                        04870000
028900         MOVE 'BEFORE 0000-MAIN-MODULE'                           04880000
029000                                   TO DP013-PARAGRAPH             04890000
029100*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX04900027
029200*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      04910027
1122RM         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04911027
1122RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04912027
029300         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04920000
029400         PERFORM DP013-0000-PROCESS-ABEND                         04930000
029500     END-IF.                                                      04940000
029600/                                                                 04950000
029700*----------------------------------------------------------------*04960000
029800*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *04970000
029900*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *04980000
030000*----------------------------------------------------------------*04990000
030100                                                                  05000000
030200 1000-CONTROL-PROCESSING.                                         05010000
030300                                                                  05020000
030400     EVALUATE TRUE                                                05030000
030500         WHEN DP020-NEXT-ACT-INITIAL                              05040000
030600              INITIALIZE ASC-SPECIFIC-COMMAREA                    05050000
030700              PERFORM 4000-BUILD-INITIAL-PANEL                    05060000
030800                                                                  05070000
030900         WHEN DP020-NEXT-ACT-READ-MAP                             05080000
031000              PERFORM 2000-PROCESS-PANEL                          05090000
031100                                                                  05100000
031200         WHEN DP020-NEXT-ACT-RETURN                               05110000
031300              MOVE ASC-HOLD-INTER-APPL                            05120000
031400                                  TO INTER-APPL-COMM-AREA         05130000
031500              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  05140000
031600              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                05150000
031700                                                                  05160000
031800         WHEN OTHER                                               05170000
031900              SET DP013-LOGIC-ABEND TO TRUE                       05180000
032000              SET DP013-NO-ROLLBACK TO TRUE                       05190000
032100              MOVE '1000-CONTROL-PROCESSING'                      05200000
032200                                    TO DP013-PARAGRAPH            05210000
032300              MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'  05220000
032400                                    TO DP013-MESSAGE-TEXT(1)      05230000
032500              MOVE DP020-NEXT-APPL-ACTIVITY                       05240000
032600                                    TO DP013-MESSAGE-TEXT(2)      05250000
032700              PERFORM DP013-0000-PROCESS-ABEND                    05260000
032800     END-EVALUATE.                                                05270000
032900/                                                                 05280000
033000*----------------------------------------------------------------*05290000
033100* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05300000
033200* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05310000
033300* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05320000
033400* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05330000
033500* FUNCTION KEYS CAN GET THIS FAR.                                *05340000
033600*----------------------------------------------------------------*05350000
033700                                                                  05360000
033800 2000-PROCESS-PANEL.                                              05370000
033900                                                                  05380000
034000     SET DP030-SET-CURSOR-APPL-1   TO  TRUE.                      05390000
034100     IF  IN001-STORE-NBR NOT NUMERIC                              05400000
034200         MOVE ASC-HOLD-INTER-APPL TO INTER-APPL-COMM-AREA         05410000
034300     END-IF.                                                      05420000
034400                                                                  05430000
034500     EVALUATE TRUE                                                05440000
034600                                                                  05450000
034700         WHEN DP020-SRC-AID = DP016-CLEAR                         05460000
034800              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  05470000
034900              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                05480000
035000                                                                  05490000
035100         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     05500000
035200              SET DP030-DONT-ERASE                                05510000
035300                  DP030-SEND-DATAONLY (PC-APPL-MAP)               05520000
035400                                   TO TRUE                        05530000
035500              PERFORM 4000-BUILD-INITIAL-PANEL                    05540000
035600              PERFORM 3200-RESET-ATTRIBUTES                       05550000
035700                                                                  05560000
035800         WHEN OTHER                                               05570000
035900              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                05580000
036000              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  05590000
036100              IF  PS-NO-ERROR                                     05600000
036200                  SET DP030-CONTINUE-GO                           05610000
036300                                   TO TRUE                        05620000
036400                  PERFORM 2100-CHECK-FUNCTION-KEY                 05630000
036500              ELSE                                                05640000
036600                  SET DP030-OVERRIDE-GO                           05650000
036700                                   TO TRUE                        05660000
036800              END-IF                                              05670000
036900     END-EVALUATE.                                                05680000
037000                                                                  05690000
037100*----------------------------------------------------------------*05700000
037200* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *05710000
037300* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *05720000
037400* FROM THE CICS ARCHITECTURE API.                                *05730000
037500*----------------------------------------------------------------*05740000
037600                                                                  05750000
037700 2100-CHECK-FUNCTION-KEY.                                         05760000
037800                                                                  05770000
037900     EVALUATE TRUE                                                05780000
038000         WHEN DP020-SRC-AID = DP016-ENTER                         05790000
038100              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                05800000
038200                                                                  05810000
038300         WHEN DP020-FK-LOCAL-GOTO    (DP020-SRC-AID)              05820000
038400*        WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)              05830028
038500*             MOVE INTER-APPL-COMM-AREA                           05840028
038600*                                  TO  ASC-HOLD-INTER-APPL        05850028
038700*        WHEN DP020-FK-LOCAL-FUNC-11 (DP020-SRC-AID)              05860028
038800*             MOVE INTER-APPL-COMM-AREA                           05870028
038900*                                  TO  ASC-HOLD-INTER-APPL        05880028
22000                                                                   05890000
22000          WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)              05900000
W30692             PERFORM DP026-0000-GET-LOGON-INFO                    05910018
W30692             IF DP026-CICS-RESPONSE = DFHRESP(NORMAL)             05920018
W30692                 IF DP026-DFLT-PRTR-ID EQUAL SPACES               05930018
W30692                   IF DP026-LOCATION-TYPE NOT EQUAL 'HQ'          05940018
W30692                     PERFORM 6001-USE-STORE-DEFAULT-PRTR          05950018
W30692                     IF JL-JCL-INK950-PRTDEST EQUAL SPACES        05960018
W30692                         SET DP030-OVERRIDE-GO                    05970018
W30692                             DP020-MSG-FATAL TO TRUE              05980018
W30692                         MOVE PC-TSYMSG-01714                     05990018
W30692                                           TO DP020-MSG-NUMBER    06000018
W30692                     ELSE                                         06010018
W30692                         PERFORM 6000-FORMAT-AND-SUBMIT           06020019
W30692                         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN     06030018
W30692                         MOVE PC-TSYMSG-00098                     06040018
W30692                                              TO DP020-MSG-NUMBER 06050018
W30692                         SET DP020-MSG-INFORMATIONAL TO TRUE      06060018
W30692                     END-IF                                       06070018
W30692                   ELSE                                           06080018
W30692                       MOVE 'LOCAL'  TO JL-JCL-INK950-PRTDEST     06090018
W30692                       MOVE 'Y'      TO JL-JCL-INK950-PRT-IND     06100018
W30692                       PERFORM 6000-FORMAT-AND-SUBMIT             06110019
W30692                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       06120018
W30692                       MOVE PC-TSYMSG-00098   TO DP020-MSG-NUMBER 06130018
W30692                       SET DP020-MSG-INFORMATIONAL TO TRUE        06140018
W30692                   END-IF                                         06150018
W30692                 ELSE                                             06160018
W30692                     MOVE DP026-DFLT-PRTR-ID                      06170018
W30692                                        TO JL-JCL-INK950-PRTDEST  06180018
W30692                     MOVE 'Y'           TO JL-JCL-INK950-PRT-IND  06190018
W30692                     PERFORM 6000-FORMAT-AND-SUBMIT               06200019
W30692                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         06210018
W30692                     MOVE PC-TSYMSG-00098   TO DP020-MSG-NUMBER   06220018
W30692                     SET DP020-MSG-INFORMATIONAL TO TRUE          06230018
W30692                 END-IF                                           06240018
W30692             ELSE                                                 06250018
W30692                 SET DP013-NO-ROLLBACK                            06260018
W30692                     DP013-XCTL-DISPLAY-RESTART                   06270018
W30692                     DP013-CICS-ABEND  TO TRUE                    06280018
W30692                 MOVE '2100-CHECK-FUNCTION-KEY'                   06290018
W30692                                       TO DP013-PARAGRAPH         06300018
W30692                 MOVE 'DP026-0000-GET-LOGON-INFO ERROR'           06310018
W30692                                       TO DP013-MESSAGE-TEXT (1)  06320018
W30692                 PERFORM DP013-0000-PROCESS-ABEND                 06330018
W30692             END-IF                                               06340018
W30692*            PERFORM 6000-FORMAT-AND-SUBMIT                       06350018
W30692*            PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06360018
W30692*            MOVE PC-TSYMSG-00098 TO DP020-MSG-NUMBER             06370018
W30692*            SET DP020-MSG-INFORMATIONAL TO TRUE                  06380018
039000                                                                  06390000
039100         WHEN OTHER                                               06400000
039200             SET DP013-NO-ROLLBACK                                06410000
039300                 DP013-XCTL-DISPLAY-RESTART                       06420000
039400                 DP013-CICS-ABEND  TO TRUE                        06430000
039500             MOVE '2000-PROCESS-PANEL'                            06440000
039600                                   TO DP013-PARAGRAPH             06450000
039700             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06460000
039800                                   TO DP013-MESSAGE-TEXT (1)      06470000
039900             PERFORM DP013-0000-PROCESS-ABEND                     06480000
040000     END-EVALUATE.                                                06490000
040100                                                                  06500000
040200/                                                                 06510000
040300*----------------------------------------------------------------*06520000
040400* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS   *06530000
040500* IN THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN   *06540000
040600* THE APPLICATION-SPECIFIC COMMAERA, NOT ON THE SCREEN.          *06550000
040700*----------------------------------------------------------------*06560000
040800                                                                  06570000
040900 2200-MOVE-SCREEN-TO-COMMAREA.                                    06580000
041000                                                                  06590000
041100     IF  ASTOREL > ZERO                                           06600000
041200         MOVE ASTOREI              TO ASC-STORE-NBRX              06610000
041300     ELSE                                                         06620000
041400         IF  ASTOREF = DP015-ERASE-EOF                            06630000
041500             MOVE SPACE            TO ASC-STORE-NBRX              06640000
041600         END-IF                                                   06650000
041700     END-IF.                                                      06660000
041800                                                                  06670000
041900     IF  AAREAL > ZERO                                            06680000
042000         MOVE AAREAI               TO ASC-AREA-NBRX               06690000
042100     ELSE                                                         06700000
042200         IF  AAREAF = DP015-ERASE-EOF                             06710000
042300             MOVE SPACE            TO ASC-AREA-NBRX               06720000
042400         END-IF                                                   06730000
042500     END-IF.                                                      06740000
042600                                                                  06750000
042700     IF  ADMSG00L > ZERO                                          06760000
042800         MOVE ADMSG00I             TO ASC-REASON-MSG              06770000
042900                                      IN001-REASON-MSG            06780000
043000     ELSE                                                         06790000
043100         MOVE SPACE                TO ASC-REASON-MSG              06800000
043200                                      IN001-REASON-MSG            06810000
043300     END-IF.                                                      06820000
043400/                                                                 06830000
043500*----------------------------------------------------------------*06840000
043600* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *06850000
043700* IS FOUND, THE CURSOR IS POSITIONED AT THAT FIELD AND AN        *06860000
043800* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *06870000
043900*----------------------------------------------------------------*06880000
044000                                                                  06890000
044100 3000-EDIT-DATA-IN-COMMAREA.                                      06900000
044200                                                                  06910000
044300     PERFORM 3200-RESET-ATTRIBUTES.                               06920000
044400     SET DP030-SET-CURSOR-APPL-1   TO  TRUE.                      06930000
044500                                                                  06940000
044600     MOVE ASC-AREA-NBRX            TO  DP010I-UNEDITED-FIELD.     06950000
044700     MOVE PC-6                     TO  DP010I-MAXIMUM-DIGITS.     06960000
044800     MOVE ZERO                     TO  DP010I-MAXIMUM-DECIMALS.   06970000
044900     SET DP010I-NEGATIVE-NOT-ALLOWED                              06980000
045000                                   TO  TRUE.                      06990000
263126     CALL DP010I-NUMERIC-EDIT-ROUTINE                             07001026
263126          USING DP010I-NUMERIC-EDIT-AREA.                         07002026
045200                                                                  07010000
045300     IF  DP010I-ERROR-DETECTED                                    07020000
045400         SET  PS-ERROR                                            07030000
045500              DP020-MSG-FATAL      TO  TRUE                       07040000
045600         MOVE PC-TSYMSG-00005      TO  DP020-MSG-NUMBER           07050000
045700         MOVE DP015-UNP-ALP-BRT-OFF                               07060000
045800                                   TO  AAREAA                     07070000
045900         MOVE DP015-RED            TO  AAREAC                     07080000
046000         MOVE DP015-REVERSE        TO  AAREAH                     07090000
046100         MOVE -1                   TO  AAREAL                     07100000
046200     ELSE                                                         07110000
046300         MOVE DP010I-NUMERIC-FIELD                                07120000
046400                                   TO  ASC-AREA-NBR               07130000
046500                                       IN001-AREA-NBR             07140000
046600     END-IF.                                                      07150000
046700                                                                  07160000
046800                                                                  07170000
046900     MOVE ASC-STORE-NBRX           TO  DP010I-UNEDITED-FIELD.     07180000
W25248**   MOVE PC-3                     TO  DP010I-MAXIMUM-DIGITS.     07190000
W25248     MOVE PC-4                     TO  DP010I-MAXIMUM-DIGITS.     07200000
047100     MOVE ZERO                     TO  DP010I-MAXIMUM-DECIMALS.   07210000
047200     SET DP010I-NEGATIVE-NOT-ALLOWED                              07220000
047300                                   TO  TRUE.                      07230000
263126     CALL DP010I-NUMERIC-EDIT-ROUTINE                             07241026
263126          USING DP010I-NUMERIC-EDIT-AREA.                         07242026
047500                                                                  07250000
047600     IF  DP010I-ERROR-DETECTED                                    07260000
047700         SET  PS-ERROR                                            07270000
047800              DP020-MSG-FATAL      TO  TRUE                       07280000
047900         MOVE PC-TSYMSG-00005      TO  DP020-MSG-NUMBER           07290000
048000         MOVE DP015-UNP-ALP-BRT-OFF                               07300000
048100                                   TO  ASTOREA                    07310000
048200         MOVE DP015-RED            TO  ASTOREC                    07320000
048300         MOVE DP015-REVERSE        TO  ASTOREH                    07330000
048400         MOVE -1                   TO  ASTOREL                    07340000
048500     ELSE                                                         07350000
048600         MOVE DP010I-NUMERIC-FIELD                                07360000
048700                                   TO  ASC-STORE-NBR              07370000
048800     END-IF.                                                      07380000
048900                                                                  07390000
049000     PERFORM 4100-GET-STORE-NAME.                                 07400000
049100     IF  SQLCODE NOT EQUAL ZERO                                   07410000
049200         SET  PS-ERROR                                            07420000
049300              DP020-MSG-FATAL      TO  TRUE                       07430000
049400         MOVE PC-TSYMSG-00017      TO  DP020-MSG-NUMBER           07440000
049500         MOVE DP015-UNP-ALP-BRT-OFF                               07450000
049600                                   TO  ASTOREA                    07460000
049700         MOVE DP015-RED            TO  ASTOREC                    07470000
049800         MOVE DP015-REVERSE        TO  ASTOREH                    07480000
049900         MOVE -1                   TO  ASTOREL                    07490000
050000     ELSE                                                         07500000
050100         MOVE XMT00001-LOC-NM      TO  ASTRNAMO                   07510000
050200                                       IN001-STORE-NAME           07520000
W25428         MOVE ASC-STORE-NBR        TO  IN001-STORE-NBR            07530000
050400     END-IF.                                                      07540000
050500                                                                  07550000
050600     IF  PS-NO-ERROR                                              07560000
050700         MOVE 'N'                  TO PS-STORE-AREA-FOUND-SW      07570000
050800         PERFORM 3100-CONTINUE-CHECKING                           07580000
R25248******   IF PS-STORE-AREA-NOT-FOUND                               07590000
R25248*        IF PS-NO-ERROR                                           07600000
RM0123         IF PS-STORE-AREA-NOT-FOUND                               07610000
051000             PERFORM 4500-READ-TSUMINV                            07620000
051100             IF  PS-NO-ERROR                                      07630000
051200                 MOVE -1               TO  ASTOREL                07640000
051300             END-IF                                               07650000
R25248         END-IF                                                   07660000
051400     END-IF.                                                      07670000
051500                                                                  07680000
052200*----------------------------------------------------------------*07690000
052300*    NOW CHECK IF THE INVENTORY PARAMETERS ARE OK AND THAT THE   *07700000
052400*    AREA EXISTS FOR THE STORE.                                  *07710000
052500*----------------------------------------------------------------*07720000
052600                                                                  07730000
052700 3100-CONTINUE-CHECKING.                                          07740000
052800                                                                  07750000
052900     PERFORM 4200-READ-TINVPAR.                                   07760000
053000                                                                  07770000
053100     IF  NOT PS-STORE-INVENTORIED                                 07780000
053200         SET PS-ERROR                                             07790000
053300             DP020-MSG-FATAL       TO  TRUE                       07800000
053400*        MOVE PC-TSYMSG-00543      TO  DP020-MSG-NUMBER           07810000
053500         MOVE PC-TSYMSG-02472      TO  DP020-MSG-NUMBER           07820000
053600         MOVE DP015-UNP-ALP-BRT-OFF                               07830000
053700                                   TO  ASTOREA                    07840000
053800         MOVE DP015-RED            TO  ASTOREC                    07850000
053900         MOVE DP015-REVERSE        TO  ASTOREH                    07860000
054000         MOVE -1                   TO  ASTOREL                    07870000
054100     ELSE                                                         07880000
054200         PERFORM 4300-READ-TINVLOC                                07890000
054300*                                                                 07900000
054400*        IF  SQLCODE EQUAL +100                                   07910000
054500*            SET PS-ERROR                                         07920000
054600*                DP020-MSG-FATAL   TO  TRUE                       07930000
054700*            MOVE PC-TSYMSG-00697  TO  DP020-MSG-NUMBER           07940000
054800*            MOVE DP015-UNP-ALP-BRT-OFF                           07950000
054900*                                  TO  AAREAA                     07960000
055000*            MOVE DP015-RED        TO  AAREAC                     07970000
055100*            MOVE DP015-REVERSE    TO  AAREAH                     07980000
055200*            MOVE -1               TO  AAREAL                     07990000
055300*        END-IF                                                   08000000
055400*                                                                 08010000
055500     END-IF.                                                      08020000
055600                                                                  08030000
055700*----------------------------------------------------------------*08040000
055800* MOVE THE DEFAULT ATTRIBUTE VALUES TO THE ENTERABLE FIELDS ON   *08050000
055900* MAP.                                                           *08060000
056000*----------------------------------------------------------------*08070000
056100                                                                  08080000
056200 3200-RESET-ATTRIBUTES.                                           08090000
056300                                                                  08100000
056400     MOVE DP015-UNP-ALP-NOR-OFF    TO  AAREAA                     08110000
056500                                       ASTOREA.                   08120000
056600     MOVE DP015-GREEN              TO  AAREAC                     08130000
056700                                       ASTOREC.                   08140000
056800     MOVE DP015-UNDERLINE          TO  AAREAH                     08150000
056900                                       ASTOREH.                   08160000
057000                                                                  08170000
057100/                                                                 08180000
057200*----------------------------------------------------------------*08190000
057300*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *08200000
057400*    ENTRY.                                                      *08210000
057500*----------------------------------------------------------------*08220000
057600                                                                  08230000
057700 4000-BUILD-INITIAL-PANEL.                                        08240000
057800                                                                  08250000
057900     SET DP030-SET-CURSOR-APPL-1   TO  TRUE.                      08260000
058000     MOVE -1                       TO  ASTOREL.                   08270000
058100     MOVE LOW-VALUES               TO  ASC-STORE-NBRX.            08280000
058200     MOVE LOW-VALUES               TO  ASC-AREA-NBRX.             08290000
058300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        08300000
058400/                                                                 08310000
058500*----------------------------------------------------------------*08320000
058600* SELECT A ROW FROM THE DB2 STORE TABLE.                         *08330000
058700*----------------------------------------------------------------*08340000
058800                                                                  08350000
058900 4100-GET-STORE-NAME.                                             08360000
059000                                                                  08370000
W25248         MOVE ASC-STORE-NBR  TO PV-STR-NBR                        08380000
W25248                                                                  08390000
W25428         EXEC SQL                                                 08400000
W25428             SELECT LOC_NM                                        08410000
W25428             INTO   :XMT00001-LOC-NM                              08420000
W25428             FROM   XMT_LOC                                       08430000
W25248             WHERE  LOC_NBR   =  :PV-STR-NBR                      08440000
W25428         END-EXEC.                                                08450000
060200                                                                  08460000
060300         EVALUATE TRUE                                            08470000
060400             WHEN SQLCODE = ZERO                                  08480000
060500             WHEN SQLCODE = +100                                  08490000
060600                 CONTINUE                                         08500000
060700             WHEN SQLCODE = -904                                  08510000
060800             WHEN SQLCODE = -913                                  08520000
060900                  PERFORM 9900-SOFT-ABORT                         08530000
061000             WHEN SQLWARN0 NOT = SPACES                           08540000
061100             WHEN SQLCODE NOT EQUAL ZERO                          08550000
061200                 MOVE '4100-GET-STORE-NAME'                       08560000
061300                                   TO DP013-PARAGRAPH             08570000
061400                 MOVE 'SELECT LOCATION NAME'                      08580000
061500                                   TO DP013-MESSAGE-TEXT (1)      08590000
061600                 MOVE SQLCA        TO DP013-SQLCA                 08600000
061700                 MOVE 'XMT_LOC'    TO DP013-DB2-TABLE-NAME (1)    08610000
061800                 SET DP013-DB2-ABEND                              08620000
061900                     DP013-XCTL-DISPLAY-RESTART                   08630000
062000                                   TO TRUE                        08640000
062100                 PERFORM DP013-0000-PROCESS-ABEND                 08650000
062200         END-EVALUATE.                                            08660000
062300/                                                                 08670000
062400*----------------------------------------------------------------*08680000
062500*     GET THE ACTUAL DATE AND SCAN SWITCH.                       *08690000
062600*----------------------------------------------------------------*08700000
062700                                                                  08710000
062800 4200-READ-TINVPAR.                                               08720000
062900                                                                  08730000
W26600     MOVE PV-STR-NBR          TO INVPAR-LOC-NBR.                  08740000
J28545                                                                  09820020
J28545     MOVE 'N' TO PS-STORE-INVENTORIED-SW.                         09821020
J28545                                                                  09822020
J28545     EXEC SQL                                                     09830020
J28545         SELECT A.ACTL_INV_DTE                                    09840022
J28545               ,A.SCAN_INV_IND                                    09850020
J28545               ,A.ACTL_INV_RECD_DTE                               09860020
J28545               ,B.INV_ID                                          09870020
J28545               ,B.INV_NM                                          09880020
J28545           INTO                                                   09890020
J28545                :INVPAR-ACTL-INV-DTE                              09900020
J28545               ,:INVPAR-SCAN-INV-IND                              09910020
J28545               ,:INVPAR-ACTL-INV-RECD-DTE                         09920020
J28545               ,:INCNTL-INV-ID                                    09930020
J28545               ,:INCNTL-INV-NM                                    09940020
J28545           FROM TINVPAR A                                         09950020
J28545               ,TINCNTL B                                         09960020
J28545         WHERE A.INV_ID = B.INV_ID                                09970020
J28545           AND B.ACTV_IND = 'Y'                                   09980020
J28545           AND A.LOC_NBR = :INVPAR-LOC-NBR                        09990020
J28545           AND A.ACTL_FIN_BK_DTE = '9999-09-09'                   10000020
W33304           AND A.LOC_INV_STAT_CDE = 'IN'                          10001025
J28545     END-EXEC.                                                    10010020
J28545                                                                  10020020
J28545     EVALUATE TRUE                                                10030020
J28545         WHEN SQLCODE = ZERO                                      10040020
J28545             SET PS-STORE-INVENTORIED TO TRUE                     10050020
J28545         WHEN SQLCODE = +100                                      10060020
J28545             CONTINUE                                             10070020
J28545         WHEN SQLCODE = -904                                      10080020
J28545         WHEN SQLCODE = -913                                      10090020
J28545              PERFORM 9900-SOFT-ABORT                             10100020
J28545         WHEN SQLWARN0 NOT = SPACES                               10110020
J28545         WHEN SQLCODE NOT EQUAL ZERO                              10120020
J28545             MOVE '4200-READ-TINVPAR - 0'                         10130020
J28545                               TO DP013-PARAGRAPH                 10140020
J28545             MOVE 'SELECT STORE NAME'                             10150020
J28545                               TO DP013-MESSAGE-TEXT (1)          10160020
J28545             MOVE SQLCA        TO DP013-SQLCA                     10170020
J28545             MOVE 'TINVPAR'    TO DP013-DB2-TABLE-NAME (1)        10180020
J28545             SET DP013-DB2-ABEND                                  10190020
J28545                 DP013-XCTL-DISPLAY-RESTART                       10200020
J28545                               TO TRUE                            10210020
J28545             PERFORM DP013-0000-PROCESS-ABEND                     10220020
J28545     END-EVALUATE.                                                10230020
J28545                                                                  10240020
J28545     IF (SQLCODE = ZERO                                           10250020
J28545     AND PS-STORE-INVENTORIED                                     10260020
J28545     AND INVPAR-ACTL-INV-DTE GREATER THAN SPACES)                 10270020
J28545         MOVE INVPAR-ACTL-INV-DTE  TO  IN001-DB2-ACTL-INV-DTE     10280020
J28545         MOVE INVPAR-SCAN-INV-IND  TO  IN001-SCANNING-STORE-SW    10290020
J28545         MOVE INCNTL-INV-ID        TO  IN001-INV-ID               10291020
J28545         MOVE INCNTL-INV-NM        TO  IN001-INV-NM               10300020
J28545                                                                  10301020
J28545         PERFORM DP017-0000-GET-CURR-DATE-TIME                    10310020
J28545         SET DP017-EDITED-YMD-DATE-DASH-1                         10320020
J28545             DP017-EDITED-YMD-DATE-DASH-2                         10330020
J28545                                   TO  TRUE                       10340020
J28545         IF (INVPAR-ACTL-INV-DTE > DP017-EDITED-DATE-YYYYMMDD     10350020
J28545         AND INVPAR-ACTL-INV-RECD-DTE >                           10360020
J28545                                       DP017-EDITED-DATE-YYYYMMDD)10370020
J28545             MOVE 'N' TO PS-STORE-INVENTORIED-SW                  10380020
J28545         END-IF                                                   10390020
J28545     ELSE                                                         10400020
J28545         MOVE 'NO PARAMETER DATA FOUND FOR THIS STORE'            10410020
J28545                                   TO  DP020-MSG-MESSAGE          10420020
J28545         SET PS-ERROR                                             10430020
J28545             DP020-MSG-FATAL       TO  TRUE                       10440020
J28545     END-IF.                                                      10450020
073100*----------------------------------------------------------------*10460000
073200*    READ THE INVENTORY LOCATION TABLE TO ENSURE THE AREA        *10470000
073300*    PASSED EXISTS.                                              *10480000
073400*----------------------------------------------------------------*10490000
073500                                                                  10500000
073600 4300-READ-TINVLOC.                                               10510000
073700                                                                  10520000
W26600      MOVE ASC-STORE-NBR           TO INVLOC-LOC-NBR.             10530000
073800      MOVE ASC-AREA-NBR            TO  INVLOC-AREA-NBR.           10540000
073900                                                                  10550000
074000      EXEC SQL                                                    10560000
074100          SELECT                                                  10570000
074200                AREA_NBR                                          10580000
074300          INTO                                                    10590000
074400                :INVLOC-AREA-NBR                                  10600000
074500          FROM                                                    10610000
074600                TINVLOC                                           10620000
074700          WHERE                                                   10630000
W25248**              STORE_NBR    =   :ASC-STORE-NBRX                  10640000
W26600                LOC_NBR    =   :INVLOC-LOC-NBR                    10650000
074900            AND                                                   10660000
075000                AREA_NBR     =   :INVLOC-AREA-NBR                 10670000
075100      END-EXEC.                                                   10680000
075200                                                                  10690000
075300      EVALUATE TRUE                                               10700000
075400          WHEN SQLCODE = ZERO                                     10710000
075500              MOVE 'Y' TO PS-STORE-AREA-FOUND-SW                  10720000
075600          WHEN SQLCODE = +100                                     10730000
075700              CONTINUE                                            10740000
075800          WHEN SQLCODE = -904                                     10750000
075900          WHEN SQLCODE = -913                                     10760000
076000               PERFORM 9900-SOFT-ABORT                            10770000
076100          WHEN SQLWARN0 NOT = SPACES                              10780000
076200          WHEN SQLCODE NOT EQUAL ZERO                             10790000
076300              MOVE '4300-READ-TINVLOC'                            10800000
076400                                TO DP013-PARAGRAPH                10810000
076500              MOVE 'SELECT FOR AREA VALIDATION'                   10820000
076600                                TO DP013-MESSAGE-TEXT (1)         10830000
076700              MOVE SQLCA        TO DP013-SQLCA                    10840000
076800              MOVE 'TINVLOC'    TO DP013-DB2-TABLE-NAME (1)       10850000
076900              SET DP013-DB2-ABEND                                 10860000
077000                  DP013-XCTL-DISPLAY-RESTART                      10870000
077100                                TO TRUE                           10880000
077200              PERFORM DP013-0000-PROCESS-ABEND                    10890000
077300      END-EVALUATE.                                               10900000
077400                                                                  10910000
077500*----------------------------------------------------------------*10920000
077600*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *10930000
077700*----------------------------------------------------------------*10940000
077800                                                                  10950000
077900 4400-MOVE-COMMAREA-TO-SCREEN.                                    10960000
078000                                                                  10970000
078100     MOVE IN001-STORE-NAME         TO  ASTRNAMO.                  10980000
078200     MOVE ASC-STORE-NBRX           TO  ASTOREO.                   10990000
078300     MOVE ASC-AREA-NBRX            TO  AAREAO.                    11000000
078400                                                                  11010000
078500*----------------------------------------------------------------*11020000
078600*    READ THE INVENTORY SUM TABLE. IF ROW EXISTS, CONTROL PASSED *11030000
078700*    TO MASS ADD PROGRAM. IF NOT FOUND - LOOK ON TADJADD.        *11040000
078800*----------------------------------------------------------------*11050000
078900                                                                  11060000
079000 4500-READ-TSUMINV.                                               11070000
079100                                                                  11080000
W26600      MOVE ASC-STORE-NBR           TO SUMINV-LOC-NBR.             11090000
079200      MOVE ASC-AREA-NBR            TO  SUMINV-AREA-NBR.           11100000
079300                                                                  11110000
079400      EXEC SQL                                                    11120000
079500*         SELECT COUNT(*)                                         11130000
079600          SELECT DISTINCT(AREA_NBR)                               11140000
079700            INTO  :SUMINV-AREA-NBR                                11150000
079800            FROM  TSUMINV                                         11160000
W25248**          WHERE STORE_NBR    = :ASC-STORE-NBRX                  11170000
W26600            WHERE LOC_NBR    = :SUMINV-LOC-NBR                    11180000
080000              AND AREA_NBR     = :SUMINV-AREA-NBR                 11190000
080100      END-EXEC.                                                   11200000
080200                                                                  11210000
080300      EVALUATE TRUE                                               11220000
080400          WHEN SQLCODE = ZERO                                     11230000
080500              CONTINUE                                            11240000
080600          WHEN SQLCODE = +100                                     11250000
080700              PERFORM 4550-READ-TADJADD                           11260000
080800          WHEN SQLCODE = -904                                     11270000
080900          WHEN SQLCODE = -913                                     11280000
081000               PERFORM 9900-SOFT-ABORT                            11290000
081100          WHEN SQLWARN0 NOT = SPACES                              11300000
081200          WHEN SQLCODE NOT EQUAL ZERO                             11310000
081300              MOVE '4500-READ-TSUMINV'                            11320000
081400                                TO DP013-PARAGRAPH                11330000
081500              MOVE 'SELECT FOR STORE/AREA VALIDATION'             11340000
081600                                TO DP013-MESSAGE-TEXT (1)         11350000
081700              MOVE SQLCA        TO DP013-SQLCA                    11360000
081800              MOVE 'TSUMINV'    TO DP013-DB2-TABLE-NAME (1)       11370000
081900              SET DP013-DB2-ABEND                                 11380000
082000                  DP013-XCTL-DISPLAY-RESTART                      11390000
082100                                TO TRUE                           11400000
082200              PERFORM DP013-0000-PROCESS-ABEND                    11410000
082300      END-EVALUATE.                                               11420000
082400                                                                  11430000
082500*----------------------------------------------------------------*11440000
082600*    READ THE ADJUSTMENT ADD TABLE.IF ROW EXISTS, CONTROL PASSED *11450000
082700*    TO MASS ADD PROGRAM. IF NOT FOUND THEN THIS IS AN ERROR.    *11460000
082800*----------------------------------------------------------------*11470000
082900                                                                  11480000
083000 4550-READ-TADJADD.                                               11490000
083100                                                                  11500000
W26600      MOVE ASC-STORE-NBR           TO ADJADD-LOC-NBR.             11510000
083200      MOVE ASC-AREA-NBR            TO  ADJADD-AREA-NBR.           11520000
083300                                                                  11530000
083400      EXEC SQL                                                    11540000
083500          SELECT  DISTINCT(AREA_NBR)                              11550000
083600            INTO  :ADJADD-AREA-NBR                                11560000
083700            FROM  TADJADD                                         11570000
W25248**          WHERE STORE_NBR    = :ASC-STORE-NBRX                  11580000
W26600            WHERE LOC_NBR    = :ADJADD-LOC-NBR                    11590000
083900              AND AREA_NBR     = :ADJADD-AREA-NBR                 11600000
084000      END-EXEC.                                                   11610000
084100                                                                  11620000
084200      EVALUATE TRUE                                               11630000
084300          WHEN SQLCODE = ZERO                                     11640000
084400              CONTINUE                                            11650000
084500          WHEN SQLCODE = +100                                     11660000
084600             SET PS-ERROR                                         11670000
084700                 DP020-MSG-FATAL   TO  TRUE                       11680000
084800             MOVE PC-TSYMSG-00697  TO  DP020-MSG-NUMBER           11690000
084900             MOVE DP015-UNP-ALP-BRT-OFF                           11700000
085000                                   TO  AAREAA                     11710000
085100             MOVE DP015-RED        TO  AAREAC                     11720000
085200             MOVE DP015-REVERSE    TO  AAREAH                     11730000
085300             MOVE -1               TO  AAREAL                     11740000
085400          WHEN SQLCODE = -904                                     11750000
085500          WHEN SQLCODE = -913                                     11760000
085600               PERFORM 9900-SOFT-ABORT                            11770000
085700          WHEN SQLWARN0 NOT = SPACES                              11780000
085800          WHEN SQLCODE NOT EQUAL ZERO                             11790000
085900              MOVE '4550-READ-TADJADD'                            11800000
086000                                TO DP013-PARAGRAPH                11810000
086100              MOVE 'SELECT FOR STORE/AREA VALIDATION'             11820000
086200                                TO DP013-MESSAGE-TEXT (1)         11830000
086300              MOVE SQLCA        TO DP013-SQLCA                    11840000
086400              MOVE 'TADJADD'    TO DP013-DB2-TABLE-NAME (1)       11850000
086500              SET DP013-DB2-ABEND                                 11860000
086600                  DP013-XCTL-DISPLAY-RESTART                      11870000
086700                                TO TRUE                           11880000
086800              PERFORM DP013-0000-PROCESS-ABEND                    11890000
086900      END-EVALUATE.                                               11900000
087000                                                                  11910000
W30692/*****************************************************************11920018
W30692* 6001-USE-STORE-DEFAULT-PRTR.                                    11930018
W30692******************************************************************11940018
W30692 6001-USE-STORE-DEFAULT-PRTR.                                     11950018
W30692                                                                  11960018
W30692     MOVE DP026-LOCATION-NBR TO PV-EDIT-LOC-NBR.                  11970018
W30692     IF PV-EDIT-LOC-NBR-P1 IS EQUAL TO ZERO                       11980018
W30692         STRING 'TKST' DELIMITED BY SIZE                          11990018
W30692                PV-EDIT-LOC-NBR-P2 DELIMITED BY SIZE              12000018
W30692                            INTO PV-USER-USER-CODE                12010018
W30692     ELSE                                                         12020018
W30692         STRING 'TKS' DELIMITED BY SIZE                           12030018
W30692                PV-EDIT-LOC-NBR DELIMITED BY SIZE                 12040018
W30692                            INTO PV-USER-USER-CODE                12050018
W30692     END-IF.                                                      12060018
W30692                                                                  12070018
W30692     MOVE PV-USER-USER-CODE TO USER-USER-CODE.                    12080018
W30692                                                                  12090018
W30692     EXEC SQL                                                     12100018
W30692         SELECT DFLT_PRTR_ID                                      12110018
W30692         INTO  :USER-DFLT-PRTR-ID                                 12120018
W30692         FROM  TUSER                                              12130018
W30692         WHERE USER_CODE = :USER-USER-CODE                        12140018
W30692         WITH UR                                                  12150018
W30692     END-EXEC.                                                    12160018
W30692                                                                  12170018
W30692     EVALUATE TRUE                                                12180018
W30692         WHEN SQLCODE = ZERO                                      12190018
W30692             IF USER-DFLT-PRTR-ID GREATER SPACES                  12200018
W30692                 MOVE USER-DFLT-PRTR-ID                           12210018
W30692                               TO JL-JCL-INK950-PRTDEST           12220018
W30692                 MOVE 'Y'      TO JL-JCL-INK950-PRT-IND           12230018
W30692             ELSE                                                 12240018
W30692                 MOVE SPACES   TO JL-JCL-INK950-PRTDEST           12250018
W30692                 MOVE 'N'      TO JL-JCL-INK950-PRT-IND           12260018
W30692             END-IF                                               12270018
W30692         WHEN SQLCODE = +100                                      12280018
W30692             MOVE SPACES       TO JL-JCL-INK950-PRTDEST           12290018
W30692             MOVE 'N'          TO JL-JCL-INK950-PRT-IND           12300018
W30692         WHEN OTHER                                               12310018
W30692             MOVE SPACES       TO JL-JCL-INK950-PRTDEST           12320018
W30692             MOVE 'N'          TO JL-JCL-INK950-PRT-IND           12330018
W30692             MOVE '6001-USE-STORE-DEFAULT-PRTR'                   12340018
W30692                               TO DP013-PARAGRAPH                 12350018
W30692             MOVE 'SELECT DFLT-PRT-ID'                            12360018
W30692                               TO DP013-MESSAGE-TEXT (1)          12370018
W30692             MOVE SQLCA        TO DP013-SQLCA                     12380018
W30692             MOVE 'TUSER  '    TO DP013-DB2-TABLE-NAME (1)        12390018
W30692             SET DP013-DB2-ABEND                                  12400018
W30692                 DP013-XCTL-DISPLAY-RESTART TO TRUE               12410018
W30692             PERFORM DP013-0000-PROCESS-ABEND                     12420018
W30692     END-EVALUATE.                                                12430018
W30692                                                                  12440018
22000 ******************************************************************12450000
22000 ** FORMAT AND SUBMIT BATCH JOB.                                 **12460000
22000 ******************************************************************12470000
22000  6000-FORMAT-AND-SUBMIT.                                          12480000
22000                                                                   12490000
22000      PERFORM 9500-ENQUEUE-INTERNAL-READER.                        12500000
22000                                                                   12510000
22000      EXEC CICS                                                    12520000
22000        ASSIGN                                                     12530000
22000          APPLID (PV-CICS-ID)                                      12540000
22000      END-EXEC.                                                    12550000
22000                                                                   12560000
22000      IF PV-CICS-REGION-PRODUCTION                                 12570000
22000          MOVE 'INK950'     TO JL-JCL-INK950-JOBNAME               12580000
22000          MOVE 'Q'          TO JL-JCL-INK950-JOBCLASS              12590000
22000          MOVE 'P'          TO JL-JCL-INK950-MSGCLASS              12600000
22000          MOVE SPACES       TO JL-JCL-INK950-NOTIFY-OPT            12610000
22000      ELSE                                                         12620000
22000          MOVE DP020-USERID TO JL-JCL-INK950-JOBNAME               12630000
22000                               JL-JCL-TEST-USER                    12640000
22000          MOVE 'P'          TO JL-JCL-INK950-JOB-UNQ               12650000
22000          MOVE 'A'          TO JL-JCL-INK950-JOBCLASS              12660000
22000          MOVE 'X'          TO JL-JCL-INK950-MSGCLASS              12670000
22000          MOVE JL-JCL-TEST-NOTIFY TO JL-JCL-INK950-NOTIFY-OPT      12680000
22000      END-IF.                                                      12690000
22000      MOVE JL-JCL-INK950-LINE-1 TO TD-JCL-LINE.                    12700000
22000      PERFORM 8000-WRITE-TD-LINE.                                  12710000
22000                                                                   12720000
22000      MOVE JL-JCL-INK950-LINE-2 TO TD-JCL-LINE.                    12730000
22000      PERFORM 8000-WRITE-TD-LINE.                                  12740000
22000                                                                   12750000
22000      MOVE JL-JCL-INK950-LINE-3 TO TD-JCL-LINE.                    12760000
22000      PERFORM 8000-WRITE-TD-LINE.                                  12770000
22000                                                                   12780000
22000      MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.             12790000
22000      PERFORM 8000-WRITE-TD-LINE.                                  12800000
22000                                                                   12810000
22000      MOVE JL-JCL-INK950-CMT-LONG      TO TD-JCL-LINE.             12820000
22000      PERFORM 8000-WRITE-TD-LINE.                                  12830000
22000                                                                   12840000
22000      MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.             12850000
22000      PERFORM 8000-WRITE-TD-LINE.                                  12860000
22000                                                                   12870000
22000 *    PERFORM DP017-0000-GET-CURR-DATE-TIME.                       12880000
22000 *    MOVE DP017-EDITED-DATE-MMDDYYYY                              12890000
22000 *        TO JL-JCL-INK950-CMT-SUBDATE                             12900000
22000 *    MOVE DP017-EDITED-TIME-HMS                                   12910000
22000 *        TO JL-JCL-INK950-CMT-SUBTIME                             12920000
22000 *    MOVE DP020-USERID TO JL-JCL-INK950-CMT-USRID                 12930000
22000 *    MOVE PV-CICS-ID   TO JL-JCL-INK950-CMT-REGION.               12940000
22000 *    MOVE JL-JCL-INK950-CMT-USER-INFO TO TD-JCL-LINE.             12950000
22000 *    PERFORM 8000-WRITE-TD-LINE.                                  12960000
22000                                                                   12970000
22000      MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.             12980000
22000      PERFORM 8000-WRITE-TD-LINE.                                  12990000
22000                                                                   13000000
22000      MOVE JL-JCL-INK950-CMT-1         TO TD-JCL-LINE.             13010000
22000      PERFORM 8000-WRITE-TD-LINE.                                  13020000
22000                                                                   13030000
22000      MOVE JL-JCL-INK950-CMT-2         TO TD-JCL-LINE.             13040000
22000      PERFORM 8000-WRITE-TD-LINE.                                  13050000
22000                                                                   13060000
22000      MOVE JL-JCL-INK950-CMT-3         TO TD-JCL-LINE.             13070000
22000      PERFORM 8000-WRITE-TD-LINE.                                  13080000
22000                                                                   13090000
22000      MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.             13100000
22000      PERFORM 8000-WRITE-TD-LINE.                                  13110000
22000                                                                   13120000
W25428                                                                  13130000
W25428**   CONTROL CARD INFORMATION (JL-JCL-INK950-LINE-14)             13140000
W25428     MOVE IN001-STORE-NBR         TO  JL-JCL-INK950-STORE.        13150000
W25428     MOVE IN001-AREA-NBR          TO  JL-JCL-INK950-AREA.         13160000
W25428     MOVE ZEROES                  TO  JL-JCL-INK950-SKU           13170000
W25428                                      JL-JCL-INK950-RETAIL.       13180000
W28545     MOVE IN001-DB2-ACTL-INV-DTE  TO  JL-JCL-DB2-ACTL-INV-DTE     13190016
W25428                                                                  13200000
W26600     EXEC CICS ASSIGN                                             13210002
W26600         USERID(JL-JCL-INK950-USERID)                             13220002
W26600     END-EXEC.                                                    13230002
W26600                                                                  13240002
22000      MOVE JL-JCL-INK950-CC-INFO       TO JL-JCL-INK950-CMT-OPTION.13250000
22000      PERFORM 8000-WRITE-TD-LINE.                                  13260000
W25428                                                                  13270000
W25428     MOVE JL-JCL-INK950-CMT-4         TO TD-JCL-LINE.             13280000
W25428     PERFORM 8000-WRITE-TD-LINE.                                  13290000
22000                                                                   13300000
22000      MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.             13310000
22000      PERFORM 8000-WRITE-TD-LINE.                                  13320000
22000                                                                   13330000
22000      MOVE JL-JCL-INK950-CMT-LONG      TO TD-JCL-LINE.             13340000
22000      PERFORM 8000-WRITE-TD-LINE.                                  13350000
22000                                                                   13360000
22000      MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.             13370000
22000      PERFORM 8000-WRITE-TD-LINE.                                  13380000
22000                                                                   13390000
22000      IF PV-CICS-REGION-PRODUCTION                                 13400000
22000          MOVE JL-JCL-INK950-LINE-10       TO TD-JCL-LINE          13410000
22000          PERFORM 8000-WRITE-TD-LINE                               13420000
22000      ELSE                                                         13430000
22000          MOVE JL-JCL-TEST-LINE-10         TO TD-JCL-LINE          13440000
22000          PERFORM 8000-WRITE-TD-LINE                               13450000
22000          MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE          13460000
22000          PERFORM 8000-WRITE-TD-LINE                               13470000
22000                                                                   13480000
22000          MOVE JL-JCL-TEST-LINE-11A        TO TD-JCL-LINE          13490000
22000          PERFORM 8000-WRITE-TD-LINE                               13500000
22000          MOVE JL-JCL-TEST-LINE-11B        TO TD-JCL-LINE          13510000
22000          PERFORM 8000-WRITE-TD-LINE                               13520000
22000          MOVE JL-JCL-TEST-LINE-11C        TO TD-JCL-LINE          13530000
22000          PERFORM 8000-WRITE-TD-LINE                               13540000
22000      END-IF.                                                      13550000
22000                                                                   13560000
22000      MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.             13570000
22000      PERFORM 8000-WRITE-TD-LINE.                                  13580000
22000                                                                   13590000
22000      MOVE JL-JCL-INK950-LINE-11       TO TD-JCL-LINE.             13600000
22000      PERFORM 8000-WRITE-TD-LINE.                                  13610000
22000                                                                   13620000
22000      MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.             13630000
22000      PERFORM 8000-WRITE-TD-LINE.                                  13640000
22000                                                                   13650000
W30692*    EXEC SQL                                                     13660018
W30692*        SELECT DFLT_PRTR_ID                                      13670018
W30692*        INTO  :USER-DFLT-PRTR-ID                                 13680018
W30692*        FROM  TUSER                                              13690018
W30692*        WHERE USER_CODE = :DP020-USERID                          13700018
W30692*    END-EXEC.                                                    13710018
W30692*    MOVE 'LOCAL'           TO JL-JCL-INK950-PRTDEST.             13720018
W30692*    MOVE 'N'               TO JL-JCL-INK950-PRT-IND.             13730018
W30692*    EVALUATE TRUE                                                13740018
W30692*        WHEN SQLCODE = ZERO                                      13750018
W30692*            IF USER-DFLT-PRTR-ID NOT = SPACES                    13760018
W30692*                MOVE USER-DFLT-PRTR-ID TO JL-JCL-INK950-PRTDEST  13770018
W30692*                MOVE 'Y'               TO JL-JCL-INK950-PRT-IND  13780018
W30692*            END-IF                                               13790018
W30692*        WHEN SQLCODE = +100                                      13800018
W30692*            CONTINUE                                             13810018
W30692*        WHEN OTHER                                               13820018
W30692*            MOVE '6000-FORMAT-AND-SUBMIT'                        13830018
W30692*                              TO DP013-PARAGRAPH                 13840018
W30692*            MOVE 'SELECT DFLT-PRT-ID'                            13850018
W30692*                              TO DP013-MESSAGE-TEXT (1)          13860018
W30692*            MOVE SQLCA        TO DP013-SQLCA                     13870018
W30692*            MOVE 'TUSER  '    TO DP013-DB2-TABLE-NAME (1)        13880018
W30692*            SET DP013-DB2-ABEND                                  13890018
W30692*                DP013-XCTL-DISPLAY-RESTART                       13900018
W30692*                              TO TRUE                            13910018
W30692*            PERFORM DP013-0000-PROCESS-ABEND                     13920018
W30692*    END-EVALUATE.                                                13930018
22000                                                                   13940017
22000      MOVE JL-JCL-INK950-LINE-12       TO TD-JCL-LINE.             13950000
22000      PERFORM 8000-WRITE-TD-LINE.                                  13960000
22000                                                                   13970000
22000      MOVE JL-JCL-INK950-LINE-13       TO TD-JCL-LINE.             13980000
22000      PERFORM 8000-WRITE-TD-LINE.                                  13990000
22000                                                                   14000000
W25428**   CONTROL CARD INFORMATION (IN-STREAM DATA ON JOB CARD)        14010000
W25428**                                    JL-JCL-INK950-UPC           14020000
W25428     MOVE JL-JCL-INK950-CC-INFO       TO JL-JCL-INK950-REQ-OPTION.14030000
22000      MOVE JL-JCL-INK950-LINE-14       TO TD-JCL-LINE.             14040000
22000      PERFORM 8000-WRITE-TD-LINE.                                  14050000
22000                                                                   14060000
22000      MOVE JL-JCL-INK950-LINE-EOD      TO TD-JCL-LINE.             14070000
22000      PERFORM 8000-WRITE-TD-LINE.                                  14080000
22000                                                                   14090000
22000      MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.             14100000
22000      PERFORM 8000-WRITE-TD-LINE.                                  14110000
22000                                                                   14120000
22000      MOVE JL-JCL-INK950-LINE-EOF      TO TD-JCL-LINE.             14130000
22000      PERFORM 8000-WRITE-TD-LINE.                                  14140000
22000                                                                   14150000
22000      PERFORM 9600-DEQUEUE-INTERNAL-READER.                        14160000
22000                                                                   14170000
22000 ******************************************************************14180000
22000 *  WRITE A JCL LINE TO THE TRANSIENT DATA QUEUE FOR THE INTERNAL *14190000
22000 *  READER.  ON ANY ERROR, DEQUEUE THE INTERNAL READER AND ABEND. *14200000
22000 ******************************************************************14210000
22000  8000-WRITE-TD-LINE.                                              14220000
22000      EXEC CICS                                                    14230000
22000          WRITEQ TD                                                14240000
22000              QUEUE(TD-QUEUE-NAME)                                 14250000
22000              FROM(TD-JCL-LINE)                                    14260000
22000              LENGTH(TD-JCL-LINE-LENGTH)                           14270000
22000              RESP(PV-CICS-RESP)                                   14280000
22000      END-EXEC.                                                    14290000
22000                                                                   14300000
22000      IF PV-CICS-RESP NOT = DFHRESP(NORMAL)                        14310000
22000          SET DP013-CICS-ABEND      TO TRUE                        14320000
22000          SET DP013-NO-ROLLBACK     TO TRUE                        14330000
22000          MOVE '8000-WRITE-TD-LINE' TO DP013-PARAGRAPH             14340000
22000          MOVE 'ATTEMPTING TO WRITE TO INTERNAL READER TD QUEUE'   14350000
22000                                    TO DP013-MESSAGE-TEXT(1)       14360000
22000          PERFORM 9600-DEQUEUE-INTERNAL-READER                     14370000
22000          PERFORM DP013-0000-PROCESS-ABEND                         14380000
22000      END-IF.                                                      14390000
22000                                                                   14400000
22000 ******************************************************************14410000
22000 *  ENQUEUE THE TRANSIENT DATA QUEUE FOR THE INTERNAL READER.     *14420000
22000 *  THIS WILL PREVENT INTERLEAVING OF JCL SUBMITTED CONCURRENTLY  *14430000
22000 *  BY MULTIPLE USERS.  IF THE QUEUE IS BUSY, THIS PROGRAM WILL   *14440000
22000 *  WAIT TO ENQUEUE IT, BY NOT SPECIFICALLY HANDLING THE QBUSY    *14450000
22000 *  CONDITION.                                                    *14460000
22000 ******************************************************************14470000
22000  9500-ENQUEUE-INTERNAL-READER.                                    14480000
22000      EXEC CICS                                                    14490000
22000          ENQ                                                      14500000
22000              RESOURCE(TD-QUEUE-NAME)                              14510000
22000              LENGTH(TD-QUEUE-NAME-LENGTH)                         14520000
22000              RESP(PV-CICS-RESP)                                   14530000
22000      END-EXEC.                                                    14540000
22000                                                                   14550000
22000      IF PV-CICS-RESP NOT = DFHRESP(NORMAL)                        14560000
22000          SET DP013-CICS-ABEND      TO TRUE                        14570000
22000          SET DP013-NO-ROLLBACK     TO TRUE                        14580000
22000          MOVE '9500-ENQUEUE-INTERNAL-READER'                      14590000
22000                                    TO DP013-PARAGRAPH             14600000
22000          STRING 'ENQUEUE '            DELIMITED BY SIZE           14610000
22000                 TD-QUEUE-NAME         DELIMITED BY SIZE           14620000
22000                 ' (INTERNAL READER)'  DELIMITED BY SIZE           14630000
22000              INTO DP013-MESSAGE-TEXT (1)                          14640000
22000          PERFORM DP013-0000-PROCESS-ABEND                         14650000
22000      END-IF.                                                      14660000
22000                                                                   14670000
22000      SET PS-INTERNAL-READER-ENQUEUED TO TRUE.                     14680000
22000                                                                   14690000
22000 ******************************************************************14700000
22000 *  DEQUEUE THE TRANSIENT DATA QUEUE FOR THE INTERNAL READER.     *14710000
22000 *  THIS SHOULD BE DONE FOLLOWING A SUCCESSFUL REPORT REQUEST     *14720000
22000 *  SUBMISSION, A CANCELLATION OF THE CURRENT REPORT REQUEST, OR  *14730000
22000 *  ANY DETECTED ABENDS.  THIS WILL FREE UP THE INTERNAL READER   *14740000
22000 *  FOR THE NEXT USER.                                            *14750000
22000 ******************************************************************14760000
22000  9600-DEQUEUE-INTERNAL-READER.                                    14770000
22000      SET PS-INTERNAL-READER-DEQUEUED TO TRUE.                     14780000
22000                                                                   14790000
22000      EXEC CICS                                                    14800000
22000          DEQ                                                      14810000
22000              RESOURCE(TD-QUEUE-NAME)                              14820000
22000              LENGTH(TD-QUEUE-NAME-LENGTH)                         14830000
22000              RESP(PV-CICS-RESP)                                   14840000
22000      END-EXEC.                                                    14850000
22000                                                                   14860000
22000      IF PV-CICS-RESP NOT = DFHRESP(NORMAL)                        14870000
22000          SET DP013-CICS-ABEND      TO TRUE                        14880000
22000          SET DP013-NO-ROLLBACK     TO TRUE                        14890000
22000          MOVE '9600-DEQUEUE-INTERNAL-READER'                      14900000
22000                                    TO DP013-PARAGRAPH             14910000
22000          STRING 'DEQUEUE '            DELIMITED BY SIZE           14920000
22000                 TD-QUEUE-NAME         DELIMITED BY SIZE           14930000
22000                 ' (INTERNAL READER)'  DELIMITED BY SIZE           14940000
22000              INTO DP013-MESSAGE-TEXT (1)                          14950000
22000          PERFORM DP013-0000-PROCESS-ABEND                         14960000
22000      END-IF.                                                      14970000
22000                                                                   14980000
087100/                                                                 14990000
087200*----------------------------------------------------------------*15000000
087300*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *15010000
087400*    AND THE ERROR SWITCHES.                                     *15020000
087500*----------------------------------------------------------------*15030000
087600                                                                  15040000
087700 9900-SOFT-ABORT.                                                 15050000
087800                                                                  15060000
087900     SET PS-ERROR                TO  TRUE.                        15070000
088000     SET DP020-MSG-WARNING       TO  TRUE.                        15080000
088100     MOVE PC-TSYMSG-00551        TO  DP020-MSG-NUMBER.            15090000
088200/                                                                 15100000
088300*----------------------------------------------------------------*15110000
088400*    ABEND PROCESSOR MODULE                                      *15120000
088500*----------------------------------------------------------------*15130000
088600                                                                  15140000
088700     COPY DPPD013.                                                15150000
088800/                                                                 15160000
088900*----------------------------------------------------------------*15170000
089000*    CURRENT DATE                                                *15180000
089100*----------------------------------------------------------------*15190000
089200                                                                  15200000
089300     COPY DPPD017.                                                15210000
W30692                                                                  15220018
W30692*----------------------------------------------------------------*15230018
W30692*    RETRIEVE LOGON INFORMATION FOR DEFAULT PRINTER DESTINATION  *15240018
W30692*----------------------------------------------------------------*15250018
W30692     COPY DPPD026.                                                15260018
