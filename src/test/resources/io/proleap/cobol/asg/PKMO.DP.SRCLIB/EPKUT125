000100 IDENTIFICATION DIVISION.                                         00010011
000200 PROGRAM-ID.      EPKUT125.                                       00020011
000300 AUTHOR.          BOB KOLESAR (SAFENET CONSULTING).               00030011
000400 DATE-WRITTEN.    FEBRUARY, 2003.                                 00040011
000500                                                                  00050011
000600*-----------------------------------------------------------      00060011
000700*            SIMPLE PRICING CORRECTION IDENTIFIER                 00070011
000800*-----------------------------------------------------------      00080011
000900*-----------------------------------------------------------      00090011
001000* HISTORY LOG:                                                    00100011
001100*-----------------------------------------------------------      00110011
001200* DATE:                                                           00120011
001300* WR/IR#:                                                         00130011
001400* PROGRAMMER:                                                     00140011
001500* DESCRIPTION:                                                    00150011
001600                                                                  00160050
001700*----------------------------------------------------------       00170011
001800 ENVIRONMENT DIVISION.                                            00180011
001900*----------------------------------------------------------       00190011
002000 CONFIGURATION SECTION.                                           00200011
002100 SOURCE-COMPUTER.        IBM-3090.                                00210011
002200 OBJECT-COMPUTER.        IBM-3090.                                00220011
002210                                                                  00221011
002220 INPUT-OUTPUT SECTION.                                            00222011
002230                                                                  00223011
002240 FILE-CONTROL.                                                    00224011
002250                                                                  00225011
002251     SELECT CONTROL-CARD-PGM-LAST-RUN-DTE                         00225144
002252       ASSIGN TO INP01.                                           00225247
002253     SELECT CONTROL-CARD-CURR-PRICG-DTE                           00225345
002254       ASSIGN TO INP02.                                           00225447
002255     SELECT CONTROL-CARD-FUTRE-CORR-DTE                           00225545
002256       ASSIGN TO INP03.                                           00225647
002257     SELECT CONTROL-CARD-CRIT-EFF-DTE                             00225745
002258       ASSIGN TO INP04.                                           00225847
002259     SELECT PROMO-NIGHT-FILE                                      00225945
002260       ASSIGN TO OUT01.                                           00226047
002261     SELECT PROMO-EMERGENCY-FILE                                  00226145
002262       ASSIGN TO OUT02.                                           00226247
002263                                                                  00226345
002264 DATA DIVISION.                                                   00226445
002265 FILE SECTION.                                                    00226545
002266                                                                  00226645
002267 FD  CONTROL-CARD-PGM-LAST-RUN-DTE                                00226745
002268     RECORDING MODE F                                             00226845
002269     BLOCK CONTAINS 0 RECORDS                                     00226945
002270     LABEL RECORDS ARE OMITTED                                    00227045
002271     DATA RECORD IS CNTRL-CARD-PGM-LAST-RUN-REC.                  00227145
002272 01  CNTRL-CARD-PGM-LAST-RUN-REC                   PIC  X(080).   00227247
002273                                                                  00227345
002274 FD  CONTROL-CARD-CURR-PRICG-DTE                                  00227445
002275     RECORDING MODE F                                             00227545
002276     BLOCK CONTAINS 0 RECORDS                                     00227645
002277     LABEL RECORDS ARE OMITTED                                    00227745
002278     DATA RECORD IS CNTRL-CARD-CURR-PRICG-DTE-REC.                00227845
002279 01  CNTRL-CARD-CURR-PRICG-DTE-REC                 PIC  X(080).   00227947
002280                                                                  00228045
002290 FD  CONTROL-CARD-FUTRE-CORR-DTE                                  00229045
002300     RECORDING MODE F                                             00230045
002400     BLOCK CONTAINS 0 RECORDS                                     00240045
002500     LABEL RECORDS ARE OMITTED                                    00250045
002600     DATA RECORD IS CNTRL-CARD-FUTRE-CORR-DTE-REC.                00260045
002700 01  CNTRL-CARD-FUTRE-CORR-DTE-REC                 PIC  X(080).   00270047
002800                                                                  00280045
002900 FD  CONTROL-CARD-CRIT-EFF-DTE                                    00290045
003000     RECORDING MODE F                                             00300045
003010     BLOCK CONTAINS 0 RECORDS                                     00301045
003020     LABEL RECORDS ARE OMITTED                                    00302045
003030     DATA RECORD IS CNTRL-CARD-CRIT-EFF-DTE-REC.                  00303045
003040 01  CNTRL-CARD-CRIT-EFF-DTE-REC                   PIC  X(080).   00304047
003050                                                                  00305045
003060 FD  PROMO-NIGHT-FILE                                             00306045
003070     RECORDING MODE F                                             00307045
003080     BLOCK CONTAINS 0 RECORDS                                     00308045
003090     LABEL RECORDS ARE OMITTED                                    00309045
003100     DATA RECORD IS PROMO-NIGHT-ID-RECORD.                        00310045
003101 01  PROMO-NIGHT-RECORD                            PIC X(200).    00310147
003102                                                                  00310245
003103 FD  PROMO-EMERGENCY-FILE                                         00310345
003104     RECORDING MODE F                                             00310445
003105     BLOCK CONTAINS 0 RECORDS                                     00310545
003106     LABEL RECORDS ARE OMITTED                                    00310645
003110     DATA RECORD IS PROMO-EMERG-ID-RECORD.                        00311011
003120 01  PROMO-EMERGENCY-RECORD                        PIC X(200).    00312047
003130                                                                  00313045
003140 WORKING-STORAGE SECTION.                                         00314045
003150*-----------------------------------------------------------      00315045
003160* PS - PROGRAM SWITCHES                                           00316045
003170*-----------------------------------------------------------      00317045
003180 01  PS-PROGRAM-SWITCHES.                                         00318045
003190     05  PS-SMP-PRICG-CSR-EOF-SW                   PIC  X(001).   00319047
003200       88  PS-SMP-PRICG-CSR-EOF                      VALUE 'Y'.   00320047
003300       88  PS-SMP-PRICG-CSR-NOT-EOF                  VALUE 'N'.   00330047
003400     05  PS-SMP-PRICG-ADHOC-CSR-EOF-SW             PIC  X(001).   00340047
003500       88  PS-SMP-PRICG-ADHOC-CSR-EOF                VALUE 'Y'.   00350047
003600       88  PS-SMP-PRICG-ADHOC-CSR-NOT-EOF            VALUE 'N'.   00360047
004000     05  PS-REC-FOUND-SW                           PIC  X(001).   00400047
004100       88  PS-REC-FOUND                              VALUE 'Y'.   00410047
004200       88  PS-NO-REC-FOUND                           VALUE 'N'.   00420047
004300     05  PS-WRITE-PROMO-SW                         PIC  X(001).   00430047
004400       88  PS-WRITE-PROMO                            VALUE 'Y'.   00440047
004500       88  PS-DONT-WRITE-PROMO                       VALUE 'N'.   00450047
004600     05  PS-FILE-STATUS                            PIC  X(002).   00460047
004700       88  PS-SUCCESSFUL-COMPLETION                  VALUE '00'.  00470047
004800       88  PS-END-OF-FILE                            VALUE '10'.  00480047
004900       88  PS-SUCCESSFUL-OPEN                        VALUE '97'.  00490047
005000     05  PS-END-OF-CNTL-CRD-SW                     PIC  X(001).   00500047
005100       88  PS-END-OF-CNTL-CRD-FILE                   VALUE 'Y'.   00510047
005200       88  PS-NOT-END-OF-CNTL-CRD-FILE               VALUE 'N'.   00520047
005300                                                                  00530045
005400*-----------------------------------------------------------      00540045
005500* PROGRAM CONSTANTS                                               00550045
005600*-----------------------------------------------------------      00560045
005700 01  PC-PROGRAM-CONSTANTS.                                        00570045
005800     05  PC-CURRENT-PROGRAM-NAME                   PIC  X(008)    00580047
005900       VALUE 'EPKUT125'.                                          00590045
006000     05  PC-PRICING-BUS-EVENT                      PIC  X(003)    00600047
006010       VALUE '090'.                                               00601045
006020     05  PC-ADHOC-DEV-BUS-EVENT                    PIC  X(003)    00602047
006030       VALUE '050'.                                               00603045
006040     05  PC-RMS-PRC-SETUP-IND                      PIC  X(001)    00604047
006050       VALUE 'R'.                                                 00605045
006060     05  PC-ADHOC-PRC-SETUP-IND                    PIC  X(001)    00606047
006070       VALUE 'A'.                                                 00607045
006080     05  PC-ADHOC-STR-GRP-TYP-CDE                  PIC  X(005)    00608047
006090       VALUE '99999'.                                             00609047
006091     05  PC-ADHOC-STR-SPEC-CDE                     PIC  X(004)    00609147
006092       VALUE '5000'.                                              00609245
006093     05  PC-STR-SELN-HIER-CDE                      PIC  X(002)    00609347
006094       VALUE '61'.                                                00609445
006095     05  PC-FILE-ACT-TYPE                          PIC  X(003)    00609547
006096       VALUE 'CHG'.                                               00609645
006097     05  PC-APPLY-NIGHTLY                          PIC  X(001)    00609747
006098       VALUE 'N'.                                                 00609845
006099     05  PC-APPLY-CORRECTION                       PIC  X(001)    00609947
006100       VALUE 'C'.                                                 00610045
006101     05  PC-SMP-PRICG-STAT-CDE                     PIC  X(001).   00610147
006102       88  PC-SCHEDULED-STATUS                       VALUE 'S'.   00610247
006103       88  PC-DELETE-STATUS                          VALUE 'D'.   00610347
006104       88  PC-CANCEL-STATUS                          VALUE 'C'.   00610447
006105     05  PC-ADD-STAT-CDE                           PIC  X(001)    00610547
006106       VALUE 'A'.                                                 00610645
006107     05  PC-DELETE-STAT-CDE                        PIC  X(001)    00610747
006108       VALUE 'D'.                                                 00610845
006109     05  PC-MDSE-INCL-IND                          PIC  X(001)    00610947
006110       VALUE 'I'.                                                 00611045
006120                                                                  00612045
006130*-----------------------------------------------------------      00613045
006140* PV- PROGRAM VARIABLES                                           00614045
006150*-----------------------------------------------------------      00615045
006160 01  PV-PROGRAM-VARAIBLES.                                        00616045
006170     05  PV-SQL-SUB                                PIC S9(004)    00617047
006180                                                     VALUE +0     00618047
006190                                                     COMP.        00619047
006200     05  PV-CURRENT-SYSTEM-TMST                    PIC  X(026)    00620047
006300                                                     VALUE SPACES.00630047
006500     05  PV-ACTL-STRT-TMST.                                       00650045
006600       10  PV-ACTL-STRT-TMST-DATE                  PIC  X(010)    00660047
006300                                                     VALUE SPACES.00670047
006900       10  FILLER                                  PIC  X(016)    00690047
006300                                                     VALUE SPACES.00700048
007200     05  PV-SOR-LAST-UPD-TMST                      PIC  X(026)    00720047
006300                                                     VALUE SPACES.00730047
008600     05  PV-EFF-STRT-TMST                          PIC  X(026)    00860047
006300                                                     VALUE SPACES.00861047
008630     05  PV-EFF-END-TMST                           PIC  X(026)    00863047
006300                                                     VALUE SPACES.00864047
008660     05  PV-EFF-END-NULL                           PIC S9(004)    00866047
008692                                                     VALUE ZEROS  00866148
008670                                                     COMP.        00867047
008680     05  PV-ABEND-CODE                             PIC  9999      00868047
008692                                                     VALUE ZEROS  00868148
008690                                                     COMP.        00869048
008693     05  PV-FUL-FILE-STR                           PIC  9(005)    00869347
008692                                                     VALUE ZEROS. 00869447
008696     05  EP111-CC-DATE-PLUS1                       PIC  X(010)    00869647
006300                                                     VALUE SPACES.00869747
008699     05  EP113-CC-CRNT-DTE-MINUS1                  PIC  X(010)    00870047
006300                                                     VALUE SPACES.00870147
008702                                                                  00870424
008710*----------------------------------------------------------       00871011
008800* FULL FILE EXTRACT OUTPUT FILE.                                  00880011
008900*----------------------------------------------------------       00890011
009000     COPY EPRD072.                                                00900011
009100                                                                  00910011
009200*----------------------------------------------------------       00920011
009300* EPCC111 CONTROL CARD LAYOUT                                     00930011
009400*----------------------------------------------------------       00940011
009500     COPY EPRD111.                                                00950011
009600                                                                  00960011
009700*----------------------------------------------------------       00970011
009800* EPCC113 CONTROL CARD LAYOUT                                     00980011
009900*----------------------------------------------------------       00990011
010000     COPY EPRD113.                                                01000011
010100                                                                  01010011
010200*----------------------------------------------------------       01020011
010300* EPCC118 CONTROL CARD LAYOUT                                     01030013
010400*----------------------------------------------------------       01040011
010500     COPY EPRD118.                                                01050013
010600                                                                  01060011
010700*----------------------------------------------------------       01070011
010800* EPCC128 CONTROL CARD LAYOUT                                     01080011
010810*----------------------------------------------------------       01081011
010820     COPY EPRD128.                                                01082011
010830                                                                  01083011
010900*----------------------------------------------------------       01090011
011000* DATE ROUTINE COPY MEMBERS                                       01100011
011100*----------------------------------------------------------       01110011
011200     COPY DPWS500.                                                01120011
011300                                                                  01130011
011400*-----------------------------------------------------------      01140011
011500* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         01150011
011600*-----------------------------------------------------------      01160011
011700     COPY DPWS004.                                                01170011
011800                                                                  01180011
011900*-----------------------------------------------------------      01190011
012000* DB2 ABEND COPYBOOK                                              01200011
012100*-----------------------------------------------------------      01210011
012200     COPY DPWS900.                                                01220011
012300                                                                  01230011
012400*-----------------------------------------------------------      01240011
012500* DB2 MESSAGE AREA                                                01250011
012600*-----------------------------------------------------------      01260011
012700     COPY SQLCA2.                                                 01270011
012800                                                                  01280011
012900*-----------------------------------------------------------      01290011
013000* PROGRAM COUNTERS                                                01300011
013100*-----------------------------------------------------------      01310011
013200 01  PC-PROGRAM-COUNTERS.                                         01320011
013210     05  PC-CNT-READ-RECS                          PIC  9(009)    01321047
013220                                                     VALUE 0.     01322047
013230     05  PC-CNT-NIGHT-RECS                         PIC  9(009)    01323047
013240                                                     VALUE 0.     01324047
013250     05  PC-CNT-EMERG-RECS                         PIC  9(009)    01325047
013260                                                     VALUE 0.     01326047
013270     05  PC-CNT-PROMO-RECS                         PIC  9(009)    01327047
013280                                                     VALUE 0.     01328047
013290     05  PC-CNT-RMS-RECS                           PIC  9(009)    01329047
013291                                                     VALUE 0.     01329147
013292     05  PC-CNT-ADHOC-RECS                         PIC  9(009)    01329247
013293                                                     VALUE 0.     01329347
013294     05  PC-CNT-DEVT-RECS                          PIC  9(009)    01329447
013295                                                     VALUE 0.     01329547
013296     05  PC-CNT-PMAP-RECS                          PIC  9(009)    01329647
013297                                                     VALUE 0.     01329747
013298     05  PC-CNT-ERROR-RECS                         PIC  9(009)    01329847
013299                                                     VALUE 0.     01329947
013300     05  PC-CNT-ALL-RECS                           PIC  9(009)    01330047
013301                                                     VALUE 0.     01330147
013302     05  PC-CNT-SPACES                             PIC  9(009)    01330247
013303                                                     VALUE 0.     01330347
013304     05  PC-CNT-POS                                PIC  9(009)    01330447
013305                                                     VALUE 0.     01330547
013306     05  PC-CNT-EXCL-CHECK                         PIC  9(009)    01330647
013307                                                     VALUE 0.     01330747
013308     05  PC-MAX-RETRIES                            PIC S9(004)    01330847
013309                                                     VALUE +5     01330947
013310                                                     COMP.        01331047
014070                                                                  01407011
014080*-----------------------------------------------------------      01408011
014090* ERROR HANDLING                                                  01409011
014100*-----------------------------------------------------------      01410011
014200 01  PV-MISC-ABEND-FIELDS.                                        01420026
014300     05  PV-PARAGRAPH-NAME                         PIC  X(030)    01430047
014400                                                     VALUE SPACE. 01440047
014500     05  PV-OPERATION-MSG-1                        PIC  X(040)    01450047
014600                                                     VALUE SPACE. 01460047
014700     05  PV-OPERATION-MSG-2                        PIC  X(040)    01470047
014800                                                     VALUE SPACE. 01480047
014900     05  PV-DB2-OPERATION                          PIC  X(030)    01490047
015000                                                     VALUE SPACE. 01500047
015100 01  ABEND-CODE                                    PIC S9(004)    01510047
015200                                                     VALUE ZEROS  01520047
015300                                                     COMP         01530047
015310                                                     SYNC.        01531047
015320   88  ABEND-4003-CTRL-CARD-ERROR                    VALUE +4003. 01532047
015330   88  ABEND-4013-DB2-ERROR                          VALUE +4013. 01533047
015340   88  ABEND-4019-CAL-SUB-ERROR                      VALUE +4019. 01534047
015350   88  ABEND-4020-MQ-ERROR                           VALUE +4020. 01535047
015360   88  ABEND-4444-FORCED-ABEND                       VALUE +4444. 01536047
015370   88  ABEND-4008                                    VALUE +4008. 01537047
015380                                                                  01538026
015400                                                                  01540011
015500*-----------------------------------------------------------      01550011
015600* DB2 COMMUNICATIONS AREA                                         01560011
015700*-----------------------------------------------------------      01570011
015800     EXEC SQL                                                     01580011
015900       INCLUDE SQLCA                                              01590026
016000     END-EXEC.                                                    01600011
016100                                                                  01610011
016200*-----------------------------------------------------------      01620046
016300* DB2 TABLE XST00023(XST_STR_GP_MBSHP) - STORE GROUP              01630046
016400*-----------------------------------------------------------      01640046
016500     EXEC SQL                                                     01650011
016600       INCLUDE XST00023                                           01660026
016700     END-EXEC.                                                    01670011
016800                                                                  01680011
016810*-----------------------------------------------------------      01681014
016820* DB2 TABLE XST00028(XST_MDSE_LNE_SELN) - MERCHANDISE TABLE       01682014
016830*-----------------------------------------------------------      01683014
016840     EXEC SQL                                                     01684014
016850       INCLUDE XST00028                                           01685026
016860     END-EXEC.                                                    01686014
016870                                                                  01687014
016900*-----------------------------------------------------------      01690011
017000* DB2 TABLE XST00029(XST_PROMO_STR_GP) - STORE ZONE PRICING       01700011
017100*                                               TABLE             01710011
017200*-----------------------------------------------------------      01720011
017300     EXEC SQL                                                     01730011
017400       INCLUDE XST00029                                           01740026
017500     END-EXEC.                                                    01750011
017600                                                                  01760011
017700*-----------------------------------------------------------      01770011
017800* DB2 TABLE XST00030(XST_SMP_PRICG) SIMPLE PRICING                01780014
017900*-----------------------------------------------------------      01790011
018000     EXEC SQL                                                     01800011
018100       INCLUDE XST00030                                           01810027
018200     END-EXEC.                                                    01820011
018210                                                                  01821014
018220*-----------------------------------------------------------      01822014
018230* DB2 TABLE XST00031(XST_PROMO_ADHC_RLT) ADHOC RELATION           01823014
018240*-----------------------------------------------------------      01824014
018250     EXEC SQL                                                     01825014
018260       INCLUDE XST00031                                           01826025
018270     END-EXEC.                                                    01827014
018300                                                                  01830011
018400*-----------------------------------------------------------      01840011
018500* DB2 TABLE XST00033(XST_PROMO_ADHC_STR) PROMO ADHOC STORES       01850014
018600*-----------------------------------------------------------      01860011
018700     EXEC SQL                                                     01870011
018800       INCLUDE XST00033                                           01880026
018900     END-EXEC.                                                    01890011
019000                                                                  01900011
019100*-----------------------------------------------------------      01910011
019200* SIMPLE PRICING CHANGE INTERFACE INCLUDE CURSOR. (RMS)           01920015
019300*-----------------------------------------------------------      01930011
019400     EXEC SQL                                                     01940011
019500       DECLARE SMP-PRICG-RMS CURSOR FOR                           01950047
019510         SELECT SMPPRC.STAT_CDE                                   01951026
019600               ,SMPPRC.LAST_UPD_TMST                              01960026
019800               ,SMPPRC.SOR_LAST_UPD_TMST                          01980026
019900               ,STRGP.PROMO_INTFC_ID                              01990026
020000               ,STRGP.MDSE_LNE_ID                                 02000026
020100               ,STRGP.STR_GP_TYP_CDE                              02010026
020200               ,STRGP.STR_GP_ID                                   02020026
020300               ,STRGP.STR_SELN_HIER_CDE                           02030026
020400               ,STRGP.ACTL_STRT_TMST                              02040026
020500               ,STRGP.ACTL_END_TMST                               02050026
020600               ,MDSSEL.PRICG_TYP_CDE                              02060026
020700         FROM XST_SMP_PRICG      SMPPRC                           02070047
020800             ,XST_PROMO_STR_GP   STRGP                            02080047
020900             ,XST_MDSE_LNE_SELN  MDSSEL                           02090047
021000         WHERE SMPPRC.PROMO_INTFC_ID = MDSSEL.PROMO_INTFC_ID      02100047
021100           AND SMPPRC.MDSE_LNE_ID    = MDSSEL.MDSE_LNE_ID         02110047
021200           AND MDSSEL.PROMO_INTFC_ID = STRGP.PROMO_INTFC_ID       02120047
021300           AND MDSSEL.MDSE_LNE_ID    = STRGP.MDSE_LNE_ID          02130047
021500           AND STRGP.STAT_CDE  IN ('S')                           02150047
021600           AND (SMPPRC.LAST_UPD_TMST                              02160047
021700               BETWEEN :EP118-CC-SIMPLE-CUTOFF-TMST               02170047
021710                   AND :PV-CURRENT-SYSTEM-TMST)                   02171047
021720           AND ((:EP111-CC-CRNT-DTE                               02172047
021730               BETWEEN DATE(STRGP.ACTL_STRT_TMST)                 02173047
021740                   AND DATE(STRGP.ACTL_END_TMST))                 02174047
021750           OR  (DATE(STRGP.ACTL_STRT_TMST)                        02175047
021760               BETWEEN :EP111-CC-DATE-PLUS1                       02176047
021770                   AND :EP113-CC-CRNT-DTE-MINUS1))                02177047
021780         FOR FETCH ONLY                                           02178047
021790         WITH UR                                                  02179047
021800     END-EXEC.                                                    02180011
021801                                                                  02180111
021802*-----------------------------------------------------------      02180211
021803* SIMPLE PRICING CHANGE ID ADHOC CURSOR.                          02180315
021804*-----------------------------------------------------------      02180411
021805     EXEC SQL                                                     02180511
021806       DECLARE SMP-PRICG-ADHOC CURSOR FOR                         02180615
021807         SELECT SMPPRC.STAT_CDE                                   02180726
021808               ,SMPPRC.LAST_UPD_TMST                              02180826
021810               ,SMPPRC.SOR_LAST_UPD_TMST                          02181026
021811               ,ADHOC.PROMO_INTFC_ID                              02181126
021820               ,ADHOC.MDSE_LNE_ID                                 02182026
021830               ,ADHOC.ADHC_STR_GP_ID                              02183026
021840               ,ADHOC.STR_SELN_HIER_CDE                           02184026
021850               ,ADHOC.ACTL_STRT_TMST                              02185026
021860               ,ADHOC.ACTL_END_TMST                               02186026
021870               ,MDSSEL.PRICG_TYP_CDE                              02187026
021871        FROM XST_SMP_PRICG      SMPPRC                            02187147
021872            ,XST_PROMO_ADHC_RLT ADHOC                             02187247
021873            ,XST_MDSE_LNE_SELN  MDSSEL                            02187347
021874        WHERE SMPPRC.PROMO_INTFC_ID = MDSSEL.PROMO_INTFC_ID       02187447
021875          AND SMPPRC.MDSE_LNE_ID    = MDSSEL.MDSE_LNE_ID          02187547
021876          AND ADHOC.PROMO_INTFC_ID  = MDSSEL.PROMO_INTFC_ID       02187647
021877          AND ADHOC.MDSE_LNE_ID     = MDSSEL.MDSE_LNE_ID          02187747
021878          AND ADHOC.STAT_CDE  IN ('S')                            02187847
021880          AND (SMPPRC.LAST_UPD_TMST                               02188047
021890              BETWEEN :EP118-CC-SIMPLE-CUTOFF-TMST                02189047
021900                  AND :PV-CURRENT-SYSTEM-TMST)                    02190047
021910          AND ((:EP111-CC-CRNT-DTE                                02191047
021911              BETWEEN DATE(ADHOC.ACTL_STRT_TMST)                  02191147
021912                  AND DATE(ADHOC.ACTL_END_TMST))                  02191247
021913          OR  (DATE(ADHOC.ACTL_STRT_TMST)                         02191347
021914              BETWEEN :EP111-CC-DATE-PLUS1                        02191447
021915                  AND :EP113-CC-CRNT-DTE-MINUS1))                 02191547
021916        FOR FETCH ONLY                                            02191647
021917        WITH UR                                                   02191747
021918     END-EXEC.                                                    02191811
021919                                                                  02191911
021971 LINKAGE SECTION.                                                 02197118
021972                                                                  02197218
021973*----------------------------------------------------------       02197318
021974 PROCEDURE DIVISION.                                              02197418
021975*----------------------------------------------------------       02197518
021976 0000-MAINLINE.                                                   02197618
021977                                                                  02197718
021978     PERFORM 1000-INITIALIZATION.                                 02197818
021979                                                                  02197918
021980     PERFORM 2000-PROCESS-SIMPLE-PRICING.                         02198018
021981                                                                  02198118
021982     PERFORM 9999-WRAPUP.                                         02198218
021983                                                                  02198318
021984     GOBACK.                                                      02198418
021985                                                                  02198518
021986*0000-EXIT.                                                       02198618
021987 EJECT.                                                           02198718
021988                                                                  02198818
021989*----------------------------------------------------------       02198918
021990* 1000-INITIALIZATION.                                            02199018
021991*     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS      02199118
021992*     FILES, READS INPUT FILES, AND PROCESSES ANY INPUT FILE      02199218
021993*     PARAMETERS IT MAY NEED TO USE TO READ THE PROMO             02199318
021994*     INTERFACE ID FILE.                                          02199418
021995*----------------------------------------------------------       02199518
022000 1000-INITIALIZATION.                                             02200011
022100                                                                  02210011
022200     OPEN INPUT  CONTROL-CARD-CURR-PRICG-DTE                      02220026
022300                 CONTROL-CARD-FUTRE-CORR-DTE                      02230026
022400                 CONTROL-CARD-PGM-LAST-RUN-DTE                    02240026
022500                 CONTROL-CARD-CRIT-EFF-DTE.                       02250026
022600     OPEN OUTPUT PROMO-NIGHT-FILE                                 02260011
022700                 PROMO-EMERGENCY-FILE.                            02270011
022800                                                                  02280011
023000     INITIALIZE EP072-PROMO-INTFC-RECORD.                         02300011
023100                                                                  02310011
023200     PERFORM 1010-GET-CURRENT-SYSTEM-TMST.                        02320011
023300     PERFORM 1020-READ-PGM-LAST-RUN-CARD.                         02330026
023400     PERFORM 1030-READ-CURR-PRICG-DTE-CARD.                       02340026
023500     PERFORM 1040-READ-FUTRE-CORR-DTE-CARD.                       02350026
023600     PERFORM 1050-READ-CRIT-EFF-DTE-CARD.                         02360026
023800     PERFORM 6100-DATE-ROUTINE.                                   02380011
023900                                                                  02390011
024000*1000-EXIT.                                                       02400011
024100 EJECT.                                                           02410011
024200                                                                  02420011
024300*----------------------------------------------------------       02430011
024400* 1010-GET-CURRENT-SYSTEM-TMST.                                   02440011
024500*     RETREIVE THE CURRENT SYSTEM TIMESTAMP. THIS WILL BE         02450011
024600*     USED WITHIN THE QUERIES TO IDENTIFY WHICH SIMPLE            02460044
024700*     PRICING CHANGES NEED TO BE INCLUDED, TMST ALSO WILL BE      02470044
024800*     USED TO UPDATE EPCC118 ON PROGRAM EXIT.                     02480044
024900*----------------------------------------------------------       02490011
025000 1010-GET-CURRENT-SYSTEM-TMST.                                    02500011
025100                                                                  02510011
025200     EXEC SQL                                                     02520011
025300       SET :PV-CURRENT-SYSTEM-TMST = CURRENT TIMESTAMP            02530011
025400     END-EXEC.                                                    02540011
025500                                                                  02550011
025600     IF SQLCODE NOT EQUAL ZERO                                    02560011
025700       MOVE 'GET CURRENT TIMESTAMP' TO PV-DB2-OPERATION           02570047
025800       MOVE '1010-GET-CURRENT-SYSTEM-TMST'                        02580047
025900                                     TO PV-PARAGRAPH-NAME         02590011
026000       PERFORM 9900-SQL-ABEND-ROUTINE                             02600047
026100     END-IF.                                                      02610011
026200                                                                  02620011
026300*1010-EXIT.                                                       02630011
026400 EJECT.                                                           02640026
026500                                                                  02650011
026600*----------------------------------------------------------       02660026
026700* 1020-READ-PGM-LAST-RUN-CARD.                                    02670026
026800*     READ CONTROL CARD EPCC118. THIS CONTROL CARD CONTAINS       02680026
026900*     THE TIMESTAMP FROM THE LAST RUN OF EPKUT125                 02690026
027000*----------------------------------------------------------       02700026
027100 1020-READ-PGM-LAST-RUN-CARD.                                     02710026
027200                                                                  02720026
027300     READ CONTROL-CARD-PGM-LAST-RUN-DTE                           02730026
027400                                    INTO EP118-CC-CONTROL-CARD    02740026
027500       AT END                                                     02750026
027600          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    02760026
027700                                                                  02770026
027800     IF PS-END-OF-CNTL-CRD-FILE                                   02780026
027900       DISPLAY ' '                                                02790026
028000       DISPLAY '** ABEND     **'                                  02800026
028100       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      02810026
028200       DISPLAY '** PARAGRAPH **  = 1020-READ-PGM-LAST-RUN-CARD'   02820026
028300       DISPLAY '** CONTROL FILE IS EMPTY  '                       02830026
028310       DISPLAY ' '                                                02831026
028320       MOVE +4002 TO ABEND-CODE                                   02832026
028330       CALL 'ILBOABN0' USING ABEND-CODE                           02833026
028340     ELSE                                                         02834026
028341       DISPLAY '** PROGRAM LAST RUN CONTROL CARD  **'             02834126
028342       DISPLAY '** EPCC118     **  =' EP118-CC-SIMPLE-CUTOFF-TMST 02834229
028343       DISPLAY ' '                                                02834328
028344     END-IF.                                                      02834426
028345                                                                  02834526
028346*1020-EXIT.                                                       02834626
028347 EJECT.                                                           02834726
028348                                                                  02834826
028349*----------------------------------------------------------       02834926
028350* 1030-READ-CURR-PRICG-DTE-CARD.                                  02835026
028351*     READ CONTROL CARD EPCC111. THIS CONTROL CARD CONTAINS       02835126
028352*     THE CURRENT PRICING DATE.                                   02835226
028353*----------------------------------------------------------       02835326
028354 1030-READ-CURR-PRICG-DTE-CARD.                                   02835426
028355                                                                  02835526
028356     READ CONTROL-CARD-CURR-PRICG-DTE                             02835626
028357                               INTO EP111-CC-CONTROL-CARD         02835726
028358       AT END                                                     02835826
028359          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    02835926
028360                                                                  02836026
028361     IF PS-END-OF-CNTL-CRD-FILE                                   02836126
028362       DISPLAY ' '                                                02836226
028363       DISPLAY '** ABEND     **'                                  02836326
028364       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      02836426
028365       DISPLAY '** PARAGRAPH **  = 1030-READ-CURR-PRICG-DTE-CARD' 02836526
028366       DISPLAY '** CONTROL FILE IS EMPTY  '                       02836626
028367       DISPLAY ' '                                                02836726
028368       MOVE +4002 TO ABEND-CODE                                   02836826
028369       CALL 'ILBOABN0' USING ABEND-CODE                           02836926
028370     ELSE                                                         02837026
028371       DISPLAY '** CURRENT PRICING DATE CONTROL CARD  **'         02837126
028372       DISPLAY '** EPCC111       **  = ' EP111-CC-CRNT-DTE        02837226
028373       DISPLAY ' '                                                02837326
028374     END-IF.                                                      02837426
028376                                                                  02837626
028377*1030-EXIT.                                                       02837726
028378 EJECT.                                                           02837826
028379                                                                  02837926
028380*----------------------------------------------------------       02838026
028381* 1040-READ-FUTRE-CORR-DTE-CARD.                                  02838126
028382*     READ CONTROL CARD EPCC113. THIS CONTROL CARD CONTAINS       02838226
028383*     THE NEXT FUTURE CORRECTIONS DATE                            02838326
028384*----------------------------------------------------------       02838426
028385 1040-READ-FUTRE-CORR-DTE-CARD.                                   02838526
028386                                                                  02838626
028387     READ CONTROL-CARD-FUTRE-CORR-DTE                             02838726
028388                               INTO EP113-CC-CONTROL-CARD         02838826
028389       AT END                                                     02838926
028390          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    02839026
028391                                                                  02839126
028392     IF PS-END-OF-CNTL-CRD-FILE                                   02839226
028393       DISPLAY ' '                                                02839326
028394       DISPLAY '** ABEND     **'                                  02839426
028395       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      02839526
028396       DISPLAY '** PARAGRAPH **  = 1040-READ-FUTRE-CORR-DTE-CARD' 02839626
028397       DISPLAY '** CONTROL FILE IS EMPTY  '                       02839726
028398       DISPLAY ' '                                                02839826
028399       MOVE +4002 TO ABEND-CODE                                   02839926
028400       CALL 'ILBOABN0' USING ABEND-CODE                           02840026
028401     ELSE                                                         02840126
028402       DISPLAY '** FUTURE CORRECTION DATE CONTROL CARD  **'       02840226
028403       DISPLAY '** EPCC113       **  = ' EP113-CC-CRNT-DTE        02840326
028404       DISPLAY ' '                                                02840426
028405     END-IF.                                                      02840526
028406                                                                  02840626
028407*1040-EXIT.                                                       02840726
028408 EJECT.                                                           02840826
028409                                                                  02840926
028410*----------------------------------------------------------       02841026
028411* 1050-READ-CRIT-EFF-DTE-CARD.                                    02841126
028412*     READ CONTROL CARD EPCC128  THIS CONTROL CARD CONTAINS       02841226
028413*     THE CRITICAL EFFECTIVE DATE, WHICH DETERMINES IF CHANGES    02841326
028414*     ARE EMERGENCY OR NIGHTLY.                                   02841426
028415*----------------------------------------------------------       02841526
028416 1050-READ-CRIT-EFF-DTE-CARD.                                     02841626
028417                                                                  02841726
028418     READ CONTROL-CARD-CRIT-EFF-DTE                               02841826
028419                               INTO EP128-CC-CONTROL-CARD         02841926
028420       AT END                                                     02842026
028421          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    02842126
028422                                                                  02842226
028423     IF PS-END-OF-CNTL-CRD-FILE                                   02842326
028424       DISPLAY ' '                                                02842426
028425       DISPLAY '** ABEND     **'                                  02842526
028426       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      02842626
028427       DISPLAY '** PARAGRAPH **  = 1050-READ-CRIT-EFF-DTE-CARD'   02842726
028428       DISPLAY '** CONTROL FILE IS EMPTY  '                       02842826
028429       DISPLAY ' '                                                02842926
028430       MOVE +4002 TO ABEND-CODE                                   02843026
028431       CALL 'ILBOABN0' USING ABEND-CODE                           02843126
028432     ELSE                                                         02843226
028433       DISPLAY '** CRITICAL EFFECTIVE DATE CONTROL CARD  **'      02843326
028434       DISPLAY '** EPCC128       **  = ' EP128-CC-CRITICAL-DTE    02843426
028435       DISPLAY ' '                                                02843526
028436     END-IF.                                                      02843626
028437                                                                  02843726
028438*1050-EXIT.                                                       02843826
028439 EJECT.                                                           02843926
028440                                                                  02844026
028441*----------------------------------------------------------       02844111
028442* 2000-PROCESS-SIMPLE-PRICING                                     02844215
028443*     MAIN PROCESSING AREA - EXECUTES RMS AND ADHOC QUERY         02844311
028444*     TO IDENTIFY SIMPLE PRICING CHANGES AND CREATES OUTPUT       02844415
028445*     FILES TO IDENTIFY WHICH STORE GROUP/PROMO INTERFACE I.D     02844515
028446*     COMBO'S NEED RECORDS CREATED FOR THE STORE SERVER.          02844611
028447*----------------------------------------------------------       02844711
028448 2000-PROCESS-SIMPLE-PRICING.                                     02844815
028449                                                                  02844911
028450     PERFORM 2100-PROCESS-RMS-CURSOR.                             02845011
028451                                                                  02845111
028452     PERFORM 2200-PROCESS-ADHOC-CURSOR.                           02845226
028455                                                                  02845516
028456*2000-EXIT.                                                       02845616
028457 EJECT.                                                           02845716
028458                                                                  02845816
028459*----------------------------------------------------------       02845916
028460* 2100-PROCESS-RMS-CURSOR.                                        02846016
028461*     READ THE RECORD FROM THE SIMPLE PRICING TABLE AND           02846115
028462*     CREATE PROMO AND PMAP RECORDS BASED ON THE RECORD READ.     02846211
028463*----------------------------------------------------------       02846311
028464 2100-PROCESS-RMS-CURSOR.                                         02846411
                                                                        02846551
028465     PERFORM 2110-OPEN-SMP-PRICG-RMS.                             02846647
028466     PERFORM 2120-FETCH-SMP-PRICG-RMS                             02846748
028467       UNTIL PS-SMP-PRICG-CSR-EOF.                                02846826
028468     PERFORM 2130-CLOSE-SMP-PRICG-RMS.                            02846947
028469                                                                  02847011
028470*2100-EXIT.                                                       02847147
028471 EJECT.                                                           02847211
028472                                                                  02847311
028480*----------------------------------------------------------       02848011
028500* 2110-OPEN-SMP-PRICG-RMS.                                        02850047
028600*     OPEN THE SIMPLE PRICING CURSOR (RMS).                       02860015
028700*----------------------------------------------------------       02870011
028800 2110-OPEN-SMP-PRICG-RMS.                                         02880047
028900                                                                  02890011
029000     PERFORM                                                      02900011
029100         WITH TEST AFTER                                          02910011
029200         VARYING PV-SQL-SUB                                       02920011
029300         FROM 1 BY 1                                              02930011
029400         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 02940011
029500                   OR  SQLCODE = 0)                               02950011
029600                                                                  02960011
029700         EXEC SQL                                                 02970011
029800           OPEN SMP-PRICG-RMS                                     02980051
029900         END-EXEC                                                 02990011
030000                                                                  03000011
030100         EVALUATE TRUE                                            03010011
030200           WHEN SQLCODE = -904                                    03020047
030300           WHEN SQLCODE = -911                                    03030047
030400           WHEN SQLCODE = -913                                    03040047
030500             CONTINUE                                             03050047
030600           WHEN SQLCODE = 0                                       03060047
030700             SET PS-SMP-PRICG-CSR-NOT-EOF TO TRUE                 03070047
                   DISPLAY 'EP118-CC-SIMPLE-CUTOFF-TMST = '             03071055
                            EP118-CC-SIMPLE-CUTOFF-TMST                 03071155
                   DISPLAY 'PV-CURRENT-SYSTEM-TMST = '                  03072055
                            PV-CURRENT-SYSTEM-TMST                      03072155
                   DISPLAY 'EP111-CC-CRNT-DTE = '                       03073055
                            EP111-CC-CRNT-DTE                           03074055
030800           WHEN SQLWARN0 NOT EQUAL SPACE                          03080047
030900           WHEN SQLCODE NOT EQUAL ZERO                            03090047
031000             MOVE '2110-OPEN-SMP-PRICG-RMS'                       03100047
031100                                   TO PV-PARAGRAPH-NAME           03110047
031200             MOVE 'ERROR ON OPEN OF SMP PRICG RMS CURSOR'         03120049
031300                                   TO PV-DB2-OPERATION            03130047
031400             PERFORM 9900-SQL-ABEND-ROUTINE                       03140047
031500         END-EVALUATE                                             03150011
031600     END-PERFORM.                                                 03160011
031700                                                                  03170011
031800     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         03180011
031900       MOVE '2110-OPEN-SMP-PRICG-RMS'                             03190047
032000                             TO  PV-PARAGRAPH-NAME                03200011
032100       MOVE 'OPEN RETRIES EXCEEDED'                               03210047
032200                              TO  PV-DB2-OPERATION                03220011
032300       PERFORM 9900-SQL-ABEND-ROUTINE                             03230047
032400     END-IF.                                                      03240011
032500                                                                  03250011
032600*2110-EXIT.                                                       03260011
032700 EJECT.                                                           03270011
032800                                                                  03280011
032900*----------------------------------------------------------       03290011
033000* 2120-FETCH-SMP-PRICG-RMS.                                       03300047
033100*     FETCH THE SIMPLE PRICING ID CURSOR. (RMS)                   03310026
033200*----------------------------------------------------------       03320011
033300 2120-FETCH-SMP-PRICG-RMS.                                        03330047
033400                                                                  03340011
033500     PERFORM                                                      03350011
033600         WITH TEST AFTER                                          03360011
033700         VARYING PV-SQL-SUB                                       03370011
033800         FROM 1 BY 1                                              03380011
033900         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 03390011
034000                   OR  SQLCODE = 0                                03400011
034100                   OR  SQLCODE = +100)                            03410011
034200                                                                  03420011
034300         EXEC SQL                                                 03430051
034400           FETCH SMP-PRICG-RMS                                    03440051
034410           INTO  :XST00030-STAT-CDE                               03441051
034500                ,:XST00030-LAST-UPD-TMST                          03450051
034700                ,:XST00030-SOR-LAST-UPD-TMST                      03470051
034800                ,:XST00029-PROMO-INTFC-ID                         03480051
034900                ,:XST00029-MDSE-LNE-ID                            03490051
035000                ,:XST00029-STR-GP-TYP-CDE                         03500051
035100                ,:XST00029-STR-GP-ID                              03510051
035200                ,:XST00029-STR-SELN-HIER-CDE                      03520051
035300                ,:XST00029-ACTL-STRT-TMST                         03530051
035400                ,:XST00029-ACTL-END-TMST                          03540051
035500                ,:XST00028-PRICG-TYP-CDE                          03550051
035600         END-EXEC                                                 03560051
035700                                                                  03570011
035800         EVALUATE TRUE                                            03580051
035900           WHEN SQLCODE = -904                                    03590051
036000           WHEN SQLCODE = -911                                    03600051
036100           WHEN SQLCODE = -913                                    03610051
036200             CONTINUE                                             03620051
036300           WHEN SQLCODE = ZERO                                    03630051
036400             PERFORM 3000-FORMAT-RMS-OUTPUT                       03640051
036500             ADD 1 TO PC-CNT-RMS-RECS                             03650051
036600           WHEN SQLCODE = +100                                    03660051
036700             SET PS-SMP-PRICG-CSR-EOF TO TRUE                     03670051
036800           WHEN SQLWARN0 NOT EQUAL SPACE                          03680051
036900           WHEN SQLCODE NOT EQUAL ZERO                            03690051
037000             MOVE '2120-FETCH-SMP-PRICG-RMS'                      03700051
037100                                    TO PV-PARAGRAPH-NAME          03710051
037200             MOVE 'ERROR ON FETCHING SMP PRICG RMS CURSOR'        03720051
037300                                    TO PV-DB2-OPERATION           03730051
037400             PERFORM 9900-SQL-ABEND-ROUTINE                       03740051
037500         END-EVALUATE                                             03750051
037600     END-PERFORM.                                                 03760011
037700                                                                  03770011
037800     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         03780051
037900       MOVE '2120-FETCH-SMP-PRICG-RMS'                            03790047
038000                               TO  PV-PARAGRAPH-NAME              03800011
038100       MOVE 'FETCH RETRIES EXCEEDED'                              03810047
038200                               TO  PV-DB2-OPERATION               03820011
038300       PERFORM 9900-SQL-ABEND-ROUTINE                             03830047
038400     END-IF.                                                      03840011
038500                                                                  03850011
038600*2120-EXIT.                                                       03860011
038700 EJECT.                                                           03870011
038800                                                                  03880011
038900*-----------------------------------------------------------      03890011
039000* 2130-CLOSE-SMP-PRICG-RMS.                                       03900047
039100*                                                                 03910011
039200*-----------------------------------------------------------      03920011
039300 2130-CLOSE-SMP-PRICG-RMS.                                        03930047
039400                                                                  03940011
039500     PERFORM                                                      03950011
039600         WITH TEST AFTER                                          03960011
039700         VARYING PV-SQL-SUB                                       03970011
039800         FROM 1 BY 1                                              03980011
039900         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 03990011
040000                   OR  SQLCODE = 0)                               04000011
040100                                                                  04010011
040200         EXEC SQL                                                 04020051
040300           CLOSE SMP-PRICG-RMS                                    04030051
040400         END-EXEC                                                 04040051
040500                                                                  04050011
040600         EVALUATE TRUE                                            04060051
040700           WHEN SQLCODE = -904                                    04070051
040800           WHEN SQLCODE = -911                                    04080051
040900           WHEN SQLCODE = -913                                    04090051
041000           WHEN SQLCODE = 0                                       04100051
041100             CONTINUE                                             04110051
041200           WHEN SQLWARN0 NOT EQUAL SPACE                          04120051
041300           WHEN SQLCODE NOT EQUAL ZERO                            04130051
041400             MOVE '2130-CLOSE-SMP-PRICG-RMS'                      04140051
041500                                       TO PV-PARAGRAPH-NAME       04150051
041600             MOVE 'ERROR ON CLOSE OF SMP PRICG RMS CURSOR'        04160051
041700                                       TO PV-DB2-OPERATION        04170051
041800             PERFORM 9900-SQL-ABEND-ROUTINE                       04180051
041900         END-EVALUATE                                             04190051
042000     END-PERFORM.                                                 04200011
042100                                                                  04210011
042200     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         04220011
042300       MOVE '2130-CLOSE-SMP-PRICG-RMS'                            04230047
042400                               TO  PV-PARAGRAPH-NAME              04240011
042500       MOVE 'CLOSE RETRIES EXCEEDED'                              04250047
042600                               TO  PV-DB2-OPERATION               04260011
042700       PERFORM 9900-SQL-ABEND-ROUTINE                             04270047
042800     END-IF.                                                      04280011
042900                                                                  04290011
043000*2130-EXIT.                                                       04300011
043100 EJECT.                                                           04310011
043200                                                                  04320011
043300*----------------------------------------------------------       04330011
043400* 2200-PROCESS-ADHOC-CURSOR.                                      04340026
043500*     READ THE RECORD FROM THE SIMPLE PRICING TABLE AND           04350026
043600*     CREATE PROMO AND RECORDS BASED ON THE RECORD READ.          04360026
043700*----------------------------------------------------------       04370011
043800 2200-PROCESS-ADHOC-CURSOR.                                       04380026
                                                                        04381051
043900     PERFORM 2210-OPEN-SMP-PRICG-ADHOC.                           04390026
044000     PERFORM 2220-FETCH-SMP-PRICG-ADHOC                           04400029
044100       UNTIL PS-SMP-PRICG-ADHOC-CSR-EOF.                          04410047
044200     PERFORM 2230-CLOSE-SMP-PRICG-ADHOC.                          04420026
044300                                                                  04430011
044400*2200-EXIT.                                                       04440011
044500 EJECT.                                                           04450011
044600                                                                  04460011
044700*----------------------------------------------------------       04470011
044800* 2210-OPEN-SMP-PRICG-ADHOC.                                      04480026
044900*     OPEN THE SIMPLE PRICING ADHOC CURSOR.                       04490026
045000*----------------------------------------------------------       04500011
045100 2210-OPEN-SMP-PRICG-ADHOC.                                       04510026
045200                                                                  04520011
045300     PERFORM                                                      04530011
045400         WITH TEST AFTER                                          04540011
045500         VARYING PV-SQL-SUB                                       04550011
045600         FROM 1 BY 1                                              04560011
045700         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 04570011
045800                   OR  SQLCODE = 0)                               04580011
045900                                                                  04590011
046000         EXEC SQL                                                 04600051
046100           OPEN SMP-PRICG-ADHOC                                   04610051
046200         END-EXEC                                                 04620051
046300                                                                  04630011
046400         EVALUATE TRUE                                            04640011
046500           WHEN SQLCODE = -904                                    04650047
046600           WHEN SQLCODE = -911                                    04660047
046700           WHEN SQLCODE = -913                                    04670047
046800             CONTINUE                                             04680047
046900           WHEN SQLCODE = 0                                       04690047
047000             SET PS-SMP-PRICG-ADHOC-CSR-NOT-EOF TO TRUE           04700047
047100           WHEN SQLWARN0 NOT EQUAL SPACE                          04710047
047200           WHEN SQLCODE NOT EQUAL ZERO                            04720047
047300             MOVE '2210-OPEN-SMP-PRICG-ADHOC'                     04730047
047400                                     TO PV-PARAGRAPH-NAME         04740011
047500             MOVE 'ERROR ON OPEN OF SMP PRICG ADHOC CURSOR'       04750047
047600                                     TO PV-DB2-OPERATION          04760011
047700             PERFORM 9900-SQL-ABEND-ROUTINE                       04770047
047800         END-EVALUATE                                             04780011
047900     END-PERFORM.                                                 04790011
048000                                                                  04800011
048100     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         04810011
048200       MOVE '2210-OPEN-SMP-PRICG-ADHOC'                           04820047
048300                             TO  PV-PARAGRAPH-NAME                04830011
048400       MOVE 'OPEN RETRIES EXCEEDED'                               04840047
048500                              TO  PV-DB2-OPERATION                04850011
048600       PERFORM 9900-SQL-ABEND-ROUTINE                             04860047
048700     END-IF.                                                      04870011
048800                                                                  04880011
048900*2210-EXIT.                                                       04890011
049000 EJECT.                                                           04900011
049100                                                                  04910011
049200*----------------------------------------------------------       04920011
049300* 2220-FETCH-SMP-PRICG-ADHOC.                                     04930026
049400*     FETCH THE SIMPLE PRICING ADHOC CURSOR.                      04940026
049500*----------------------------------------------------------       04950011
049600 2220-FETCH-SMP-PRICG-ADHOC.                                      04960026
049700                                                                  04970011
049800     PERFORM                                                      04980011
049900         WITH TEST AFTER                                          04990011
050000         VARYING PV-SQL-SUB                                       05000011
050100         FROM 1 BY 1                                              05010011
050200         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 05020011
050300                   OR  SQLCODE = 0                                05030011
050400                   OR  SQLCODE = +100)                            05040011
050500                                                                  05050011
050600         EXEC SQL                                                 05060051
050700           FETCH SMP-PRICG-ADHOC                                  05070051
050710            INTO  :XST00030-STAT-CDE                              05071051
050800                 ,:XST00030-LAST-UPD-TMST                         05080051
051000                 ,:XST00030-SOR-LAST-UPD-TMST                     05100051
051100                 ,:XST00031-PROMO-INTFC-ID                        05110051
051110                 ,:XST00031-MDSE-LNE-ID                           05111051
051120                 ,:XST00031-ADHC-STR-GP-ID                        05112051
051130                 ,:XST00031-STR-SELN-HIER-CDE                     05113051
051140                 ,:XST00031-ACTL-STRT-TMST                        05114051
051150                 ,:XST00031-ACTL-END-TMST                         05115051
051160                 ,:XST00028-PRICG-TYP-CDE                         05116051
051170         END-EXEC                                                 05117051
051180                                                                  05118011
051190         EVALUATE TRUE                                            05119051
051200           WHEN SQLCODE = -904                                    05120051
051300           WHEN SQLCODE = -911                                    05130051
051400           WHEN SQLCODE = -913                                    05140051
051500             CONTINUE                                             05150051
051600           WHEN SQLCODE = ZERO                                    05160051
051700             PERFORM 3100-FORMAT-ADHOC-OUTPUT                     05170051
051800             ADD 1 TO PC-CNT-ADHOC-RECS                           05180051
051810           WHEN SQLCODE = +100                                    05181051
051820             SET PS-SMP-PRICG-ADHOC-CSR-EOF TO TRUE               05182051
051830           WHEN SQLWARN0 NOT EQUAL SPACE                          05183051
051840           WHEN SQLCODE NOT EQUAL ZERO                            05184051
051850             MOVE '2220-FETCH-SMP-PRICG-ADHOC'                    05185051
051860                                    TO PV-PARAGRAPH-NAME          05186051
051870             MOVE 'ERROR ON FETCHING SMP PRICG ADHOC CURSOR'      05187051
051880                                    TO PV-DB2-OPERATION           05188051
051881             DISPLAY 'SQLCODE= ' SQLCODE                          05188151
051882             PERFORM 9900-SQL-ABEND-ROUTINE                       05188251
051883         END-EVALUATE                                             05188351
051884     END-PERFORM.                                                 05188411
051885                                                                  05188511
051886     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         05188651
051887       MOVE '2220-FETCH-SMP-PRICG-ADHOC'                          05188751
051888                              TO  PV-PARAGRAPH-NAME               05188851
051889       MOVE 'FETCH RETRIES EXCEEDED'                              05188951
051890                              TO  PV-DB2-OPERATION                05189051
051891       PERFORM 9900-SQL-ABEND-ROUTINE                             05189151
051892     END-IF.                                                      05189211
051893                                                                  05189311
051894*2220-EXIT.                                                       05189411
051895 EJECT.                                                           05189511
051896                                                                  05189611
051897*-----------------------------------------------------------      05189711
051898* 2230-CLOSE-SMP-PRICG-ADHOC.                                     05189826
051899*     CLOSE THE SIMPLE PRICING ADHOC CURSOR.                      05189926
051900*-----------------------------------------------------------      05190011
051901 2230-CLOSE-SMP-PRICG-ADHOC.                                      05190126
051902                                                                  05190211
051903     PERFORM                                                      05190311
051904         WITH TEST AFTER                                          05190411
051905         VARYING PV-SQL-SUB                                       05190511
051906         FROM 1 BY 1                                              05190611
051907         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 05190711
051908                   OR  SQLCODE = 0)                               05190811
051909                                                                  05190911
051910         EXEC SQL                                                 05191051
051911           CLOSE SMP-PRICG-ADHOC                                  05191151
051912         END-EXEC                                                 05191251
051913                                                                  05191311
051914         EVALUATE TRUE                                            05191451
051915           WHEN SQLCODE = -904                                    05191551
051916           WHEN SQLCODE = -911                                    05191651
051917           WHEN SQLCODE = -913                                    05191751
051918           WHEN SQLCODE = 0                                       05191851
051919             CONTINUE                                             05191951
051920           WHEN SQLWARN0 NOT EQUAL SPACE                          05192051
051921           WHEN SQLCODE NOT EQUAL ZERO                            05192151
051922             MOVE '2230-CLOSE-SMP-PRICG-ADHOC'                    05192251
051923                                     TO PV-PARAGRAPH-NAME         05192351
051924             MOVE 'ERROR ON CLOSE OF SMP PRICG ADHOC CURSOR'      05192451
051925                                     TO PV-DB2-OPERATION          05192551
051926             PERFORM 9900-SQL-ABEND-ROUTINE                       05192651
051927         END-EVALUATE                                             05192751
051928     END-PERFORM.                                                 05192811
051929                                                                  05192911
051930     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         05193011
051931       MOVE '2230-CLOSE-SMP-PRICG-ADHOC'                          05193147
051932                               TO  PV-PARAGRAPH-NAME              05193211
051933       MOVE 'CLOSE RETRIES EXCEEDED'                              05193347
051934                               TO  PV-DB2-OPERATION               05193411
051935       PERFORM 9900-SQL-ABEND-ROUTINE                             05193547
051936     END-IF.                                                      05193611
051937                                                                  05193711
051938*2230-EXIT.                                                       05193811
051939 EJECT.                                                           05193911
051940                                                                  05194011
052106*-----------------------------------------------------------      05210626
052107* 3000-FORMAT-RMS-OUTPUT.                                         05210726
052108*     POPULATE COPYBOOK EPRD072.                                  05210826
052109*-----------------------------------------------------------      05210926
052110 3000-FORMAT-RMS-OUTPUT.                                          05211026
052111                                                                  05211126
052112     INITIALIZE EP072-PROMO-INTFC-RECORD.                         05211237
052113     MOVE PC-PRICING-BUS-EVENT                                    05211326
052114                             TO EP072-BUSINESS-EVENT-ID.          05211426
052115     MOVE PC-RMS-PRC-SETUP-IND                                    05211526
052116                             TO EP072-PRC-SETUP-IND.              05211626
052117     MOVE XST00029-STR-GP-TYP-CDE                                 05211726
052118                             TO EP072-SETUP-STR-GRP-TYP-CDE.      05211826
052119     MOVE XST00029-STR-GP-ID                                      05211926
052120                             TO EP072-SETUP-STR-GRP-ID.           05212026
052121     MOVE XST00029-STR-SELN-HIER-CDE                              05212126
052122                             TO EP072-STR-SELN-HIER-CDE.          05212226
052123     MOVE XST00029-STR-GP-TYP-CDE                                 05212326
052124                             TO EP072-DIST-STR-GRP-TYP-CDE.       05212426
052125     MOVE XST00029-STR-GP-ID                                      05212526
052126                             TO EP072-DIST-STR-GRP-ID.            05212626
052127     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               05212726
052128                                                                  05212826
052129     MOVE XST00029-ACTL-STRT-TMST                                 05212942
052130                             TO PV-ACTL-STRT-TMST.                05213042
052131                                                                  05213142
           DISPLAY 'PROMO ' XST00029-PROMO-INTFC-ID.                    05213256
           DISPLAY PV-ACTL-STRT-TMST-DATE ' '                           05213356
              EP128-CC-CRITICAL-DTE ' ' EP113-CC-CRNT-DTE               05213456
052132     IF PV-ACTL-STRT-TMST-DATE > EP128-CC-CRITICAL-DTE            05213542
052133       AND PV-ACTL-STRT-TMST-DATE < EP113-CC-CRNT-DTE             05213647
               DISPLAY 'ACTL-STRT > EP128 AND '                         05213756
               DISPLAY 'ACTL-STRT < 113  SHOULD BE NIGHT'               05213856
052134         MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND               05213947
               DISPLAY '* ' EP072-APPLY-IND                             05214056
052135     ELSE                                                         05214142
052136       IF PV-ACTL-STRT-TMST-DATE <= EP128-CC-CRITICAL-DTE         05214242
               DISPLAY 'ACTL-STRT <= EP128 SHOULD BE CORRECTION'        05214356
052137         MOVE PC-APPLY-CORRECTION                                 05214447
052138                                  TO EP072-APPLY-IND              05214542
               DISPLAY '** ' EP072-APPLY-IND                            05214656
052139       END-IF                                                     05214742
052140     END-IF.                                                      05214842
052141                                                                  05214926
           DISPLAY 'APPLY-IND = ' EP072-APPLY-IND                       05215056
052142     MOVE XST00030-STAT-CDE  TO PC-SMP-PRICG-STAT-CDE             05215126
052143                                                                  05215226
052144     IF PC-SCHEDULED-STATUS                                       05215326
052145       MOVE PC-ADD-STAT-CDE                                       05215426
052146                             TO EP072-RECORD-ACTION               05215526
052147     ELSE                                                         05215626
052148       IF PC-DELETE-STATUS OR PC-CANCEL-STATUS                    05215747
052149         MOVE PC-DELETE-STAT-CDE                                  05215847
052150                             TO EP072-RECORD-ACTION               05215947
             END-IF                                                     05216047
           END-IF.                                                      05216147
052151                                                                  05216226
052152     MOVE XST00029-PROMO-INTFC-ID                                 05216326
052153                             TO EP072-PROMO-INTFC-ID.             05216426
052154     MOVE XST00029-MDSE-LNE-ID                                    05216626
052155                             TO EP072-MERCH-LNE-ID.               05216726
052156     MOVE XST00028-PRICG-TYP-CDE                                  05216826
052157                             TO EP072-PRICG-TYP-CDE.              05216926
052158     MOVE PC-MDSE-INCL-IND                                        05217026
052159                             TO EP072-MDSE-INC-EXC-IND.           05217126
052160     MOVE XST00029-ACTL-STRT-TMST                                 05217226
052161                             TO EP072-STR-GRP-PROMO-STRT-TMST.    05217326
052162     MOVE XST00029-ACTL-END-TMST                                  05217426
052163                             TO EP072-STR-GRP-PROMO-END-TMST.     05217526
052164     MOVE XST00030-SOR-LAST-UPD-TMST                              05217626
052165                             TO EP072-SOR-LAST-UPD-TMST.          05217726
052166                                                                  05217826
052167     IF EP072-APPLY-NIGHTLY                                       05217926
052168       PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                      05218026
052169     ELSE                                                         05218126
052171       PERFORM 4100-WRITE-EMERG-APPLY-RECORD                      05218252
052134       MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND                 05218352
052170       PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                      05218426
052172     END-IF.                                                      05218526
052173                                                                  05218626
052174*3000-EXIT.                                                       05218726
052175 EJECT.                                                           05218826
052176*-----------------------------------------------------------      05218926
052177* 3100-FORMAT-ADHOC-OUTPUT.                                       05219026
052178*     POPULATE COPYBOOK EPRD072.                                  05219126
052179*-----------------------------------------------------------      05219226
052180 3100-FORMAT-ADHOC-OUTPUT.                                        05219326
052181                                                                  05219426
052182     INITIALIZE EP072-PROMO-INTFC-RECORD.                         05219537
052183     MOVE PC-PRICING-BUS-EVENT                                    05219626
052184                             TO EP072-BUSINESS-EVENT-ID.          05219726
052185     MOVE PC-ADHOC-PRC-SETUP-IND                                  05219826
052186                             TO EP072-PRC-SETUP-IND.              05219926
052187     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                05220026
052188                             TO EP072-SETUP-STR-GRP-TYP-CDE.      05220126
052190     MOVE XST00031-ADHC-STR-GP-ID                                 05220211
052200                             TO EP072-SETUP-STR-GRP-ID.           05220311
052210     MOVE XST00031-STR-SELN-HIER-CDE                              05221011
052220                             TO EP072-STR-SELN-HIER-CDE.          05222011
052230     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                05223011
052240                             TO EP072-DIST-STR-GRP-TYP-CDE.       05224011
052250     MOVE XST00031-ADHC-STR-GP-ID                                 05225011
052260                             TO EP072-DIST-STR-GRP-ID.            05226011
052270     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               05227011
052280                                                                  05228011
052281     MOVE XST00031-ACTL-STRT-TMST                                 05228143
052282                             TO PV-ACTL-STRT-TMST.                05228242
052283                                                                  05228342
052284     IF PV-ACTL-STRT-TMST-DATE > EP128-CC-CRITICAL-DTE            05228442
052285       AND PV-ACTL-STRT-TMST-DATE < EP113-CC-CRNT-DTE             05228547
052286         MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND               05228647
052287     ELSE                                                         05228742
052288       IF PV-ACTL-STRT-TMST-DATE <= EP128-CC-CRITICAL-DTE         05228842
052289         MOVE PC-APPLY-CORRECTION                                 05228947
052290                                  TO EP072-APPLY-IND              05229042
052291       END-IF                                                     05229142
052292     END-IF.                                                      05229242
052302                                                                  05230211
052303     MOVE XST00030-STAT-CDE  TO PC-SMP-PRICG-STAT-CDE             05230329
052304                                                                  05230411
052305     IF PC-SCHEDULED-STATUS                                       05230511
052306       MOVE PC-ADD-STAT-CDE                                       05230611
052307                             TO EP072-RECORD-ACTION               05230711
052308     ELSE                                                         05230811
052309       IF PC-DELETE-STATUS OR PC-CANCEL-STATUS                    05230947
052310         MOVE PC-DELETE-STAT-CDE                                  05231047
052311                             TO EP072-RECORD-ACTION               05231147
052291       END-IF                                                     05231247
052292     END-IF.                                                      05231347
052312                                                                  05231411
052313     MOVE XST00031-PROMO-INTFC-ID                                 05231511
052314                             TO EP072-PROMO-INTFC-ID.             05231611
052315     MOVE XST00031-MDSE-LNE-ID                                    05231711
052316                             TO EP072-MERCH-LNE-ID.               05231811
052317     MOVE XST00028-PRICG-TYP-CDE                                  05231911
052318                             TO EP072-PRICG-TYP-CDE.              05232011
052319     MOVE PC-MDSE-INCL-IND                                        05232126
052320                             TO EP072-MDSE-INC-EXC-IND.           05232211
052321     MOVE XST00031-ACTL-STRT-TMST                                 05232311
052322                             TO EP072-STR-GRP-PROMO-STRT-TMST.    05232411
052323     MOVE XST00031-ACTL-END-TMST                                  05232526
052324                             TO EP072-STR-GRP-PROMO-END-TMST.     05232611
052325     MOVE XST00030-SOR-LAST-UPD-TMST                              05232726
052326                             TO EP072-SOR-LAST-UPD-TMST.          05232811
052327                                                                  05232911
052328     IF EP072-APPLY-NIGHTLY                                       05233011
052329       PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                      05233111
052330     ELSE                                                         05233211
052171       PERFORM 4100-WRITE-EMERG-APPLY-RECORD                      05233352
052134       MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND                 05233452
052170       PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                      05233552
052333     END-IF.                                                      05233811
052340                                                                  05234011
052350*3100-EXIT.                                                       05235011
052360 EJECT.                                                           05236011
052370                                                                  05237011
052453*----------------------------------------------------------       05245326
052454* 4000-WRITE-NIGHT-APPLY-RECORD.                                  05245426
052460*     WRITES THE PROMO FULL FILE RECORD TO THE FULL FILE          05246026
052500*----------------------------------------------------------       05250011
052600 4000-WRITE-NIGHT-APPLY-RECORD.                                   05260011
052700                                                                  05270011
052710     WRITE PROMO-NIGHT-RECORD FROM EP072-PROMO-INTFC-RECORD.      05271011
052720                                                                  05272011
052730     ADD 1           TO PC-CNT-NIGHT-RECS                         05273011
052740                        PC-CNT-ALL-RECS.                          05274011
052760                                                                  05276011
052770*4000-EXIT.                                                       05277011
052780 EJECT.                                                           05278011
052790                                                                  05279011
052800*----------------------------------------------------------       05280011
052801* 4100-WRITE-EMERG-APPLY-RECORD.                                  05280111
052802*     WRITES THE PROMO FULL FILE RECORD TO THE FULL FILE          05280211
052803*----------------------------------------------------------       05280311
052804 4100-WRITE-EMERG-APPLY-RECORD.                                   05280411
052805                                                                  05280511
052806     WRITE PROMO-EMERGENCY-RECORD FROM EP072-PROMO-INTFC-RECORD.  05280611
052807                                                                  05280711
052808     ADD 1           TO PC-CNT-EMERG-RECS                         05280811
052809                        PC-CNT-ALL-RECS.                          05280911
052820*                                                                 05282011
052830*4100-EXIT.                                                       05283011
052840 EJECT.                                                           05284011
052850                                                                  05285011
052860*----------------------------------------------------------       05286047
052870* DATE ROUTINE TO SET UP THE PROCESS DATE IN                      05287047
052880* CCYYMMDD FORMAT.                                                05288047
052890*----------------------------------------------------------       05289047
052900 6100-DATE-ROUTINE.                                               05290011
053000                                                                  05300011
053100     INITIALIZE DPG51 DPG52 DPG53                                 05310011
053200                DPG54 DPG55 DPG56.                                05320011
053210                                                                  05321011
053220     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      05322011
053230     SET DPG51-INCREMENT-DATE       TO TRUE.                      05323011
053240     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      05324011
053241     MOVE 1                         TO DPG51-INCR-DECR-DAYS-9.    05324111
053242     MOVE EP111-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    05324211
053243                                                                  05324311
053244     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    05324411
053245                                             DPG54 DPG55 DPG56.   05324511
053246                                                                  05324611
053247     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  05324711
053248       DISPLAY '** ABEND **'                                      05324847
053249       DISPLAY '** PROGRAM = EPKUT125'                            05324947
053250       DISPLAY 'DATE = ' EP111-CC-CRNT-DTE                        05325047
053251       DISPLAY DPG54-ERROR-MESSAGE                                05325147
053252       MOVE 4019 TO PV-ABEND-CODE                                 05325247
053253       CALL 'ILBOABN0' USING PV-ABEND-CODE                        05325348
           END-IF.                                                      05325447
053254                                                                  05325511
053255     MOVE DPG55-DB2-ISO-DATE-FMT     TO EP111-CC-DATE-PLUS1.      05325611
           DISPLAY 'EP111-CC-DATE-PLUS1 = ' EP111-CC-DATE-PLUS1.        05325755
053256                                                                  05325811
053257     INITIALIZE DPG51 DPG52 DPG53                                 05325911
053258                DPG54 DPG55 DPG56.                                05326011
053259                                                                  05326111
053260     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      05326211
053261     SET DPG51-DECREMENT-DATE       TO TRUE.                      05326311
053262     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      05326411
053263     MOVE 1                         TO DPG51-INCR-DECR-DAYS-9.    05326511
053264     MOVE EP113-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    05326611
053265                                                                  05326711
053266     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    05326811
053267                                             DPG54 DPG55 DPG56.   05326911
053268                                                                  05327011
053269     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  05327111
053270       DISPLAY '** ABEND **'                                      05327247
053271       DISPLAY '** PROGRAM = EPKUT125'                            05327347
053272       DISPLAY 'DATE = ' EP111-CC-CRNT-DTE                        05327447
053273       DISPLAY DPG54-ERROR-MESSAGE                                05327547
053274       MOVE 4019 TO PV-ABEND-CODE                                 05327647
053275       CALL 'ILBOABN0' USING PV-ABEND-CODE                        05327748
           END-IF.                                                      05327847
053276                                                                  05327911
053277     MOVE DPG55-DB2-ISO-DATE-FMT    TO EP113-CC-CRNT-DTE-MINUS1.  05328011
053277     DISPLAY 'EP113-CC-CRNT-DTE-MINUS1 = '                        05328155
053277                                         EP113-CC-CRNT-DTE-MINUS1.05328255
053278                                                                  05328355
053279*6100-EXIT.                                                       05328455
053280 EJECT.                                                           05328555
053281                                                                  05328655
055100*----------------------------------------------------------       05510011
055200* 9900-SQL-ABEND-ROUTINE.                                         05520011
055300*     SQL ABEND ROUTINE.                                          05530011
055400*----------------------------------------------------------       05540011
055500 9900-SQL-ABEND-ROUTINE.                                          05550011
055600                                                                  05560011
055700     DISPLAY '** ABEND     **'.                                   05570011
055800     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        05580011
055900     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              05590011
056000     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               05600011
056100                                                                  05610011
056200     COPY DPPD004.                                                05620011
056300     SET ABEND-4013-DB2-ERROR TO TRUE.                            05630011
056400     CALL 'ILBOABN0' USING ABEND-CODE.                            05640011
056500                                                                  05650011
056600*9900-EXIT.                                                       05660011
056700 EJECT.                                                           05670011
056800                                                                  05680011
056900*----------------------------------------------------------       05690011
057000* 9999-WRAPUP.                                                    05700011
057100*     END OF PROGRAM ROUTINE.  CLOSES ALL FILES AND DISPLAYS      05710011
057200*     ANY DATA FROM THE PROGRAM.                                  05720011
057300*----------------------------------------------------------       05730011
057400 9999-WRAPUP.                                                     05740011
057500                                                                  05750011
058010     CLOSE CONTROL-CARD-PGM-LAST-RUN-DTE.                         05801029
058020     OPEN OUTPUT CONTROL-CARD-PGM-LAST-RUN-DTE.                   05802029
058030                                                                  05803029
058031     MOVE PV-CURRENT-SYSTEM-TMST TO EP118-CC-SIMPLE-CUTOFF-TMST   05803129
058032     WRITE CNTRL-CARD-PGM-LAST-RUN-REC                            05803229
058034                                   FROM EP118-CC-CONTROL-CARD.    05803429
058070                                                                  05807029
058080     CLOSE CONTROL-CARD-CURR-PRICG-DTE                            05808029
058090           CONTROL-CARD-FUTRE-CORR-DTE                            05809029
058091           CONTROL-CARD-PGM-LAST-RUN-DTE                          05809129
058092           CONTROL-CARD-CRIT-EFF-DTE                              05809229
058093           PROMO-NIGHT-FILE                                       05809329
058094           PROMO-EMERGENCY-FILE.                                  05809429
058095                                                                  05809529
058100     DISPLAY ' '.                                                 05810011
058200     DISPLAY '*********************************************'.     05820011
058300     DISPLAY 'PROGRAM NAME: ' PC-CURRENT-PROGRAM-NAME.            05830011
058400     DISPLAY '*********************************************'.     05840011
058700     DISPLAY 'NUMBER OF NIGHT RECS WRITTEN: ' PC-CNT-NIGHT-RECS.  05870011
058800     DISPLAY 'NUMBER OF EMERG. RECS WRITTEN: ' PC-CNT-EMERG-RECS. 05880011
058900     DISPLAY 'NUMBER OF RECS FROM RMS QUERY:' PC-CNT-RMS-RECS.    05890011
059000     DISPLAY 'NUMBER OF RECS FROM ADHC QUERY: ' PC-CNT-ADHOC-RECS.05900011
059100*    DISPLAY 'NUMBER OF RECS FROM DEVT QUERY: ' PC-CNT-DEVT-RECS. 05910044
059200     DISPLAY 'ALL RECS WRITTEN: ' PC-CNT-ALL-RECS.                05920011
059300     DISPLAY '*********************************************'.     05930011
059400                                                                  05940011
059500*9999-EXIT.                                                       05950011
059600 EJECT.                                                           05960011
059700                                                                  05970011
