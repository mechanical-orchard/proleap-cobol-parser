000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    MAKUT230.                                         00020000
000300 AUTHOR.        LINDA GRIESBACH.                                  00030000
000400                                                                  00040000
000500*----------------------------------------------------------------*00050000
000600*                 MODIFICATION LOG                               *00060000
000700*----------------------------------------------------------------*00070000
000800* MM-DD-YYYY    NAME    X-X-X-X-X-X-X-X-X-X-X-X-X-X-X-X-X-X-X-X  *00080000
000900*----------------------------------------------------------------*00090000
001000* 09-29-2010  COGNIZANT (SANDEEP)                                *00100000
001100*                       (WR #38972) MLOF PROJECT CHANGES.        *00110000
001200*                       REMOVED THE HARD CODED EFC STORE WRITTEN *00120000
001300*                       AT THE END OF THE CURSOR.                *00130000
001400*                       MODIFIED THE CS CURSOR TO FETCH THE EFC  *00140000
001500*                       STORE ALSO.                              *00150000
001600*----------------------------------------------------------------*00160000
070941* 07-30-2018  COGNIZANT ORACLE LOGON STANDARDS PROGRAM CHANGE    *00160202
001600*----------------------------------------------------------------*00161002
001700                                                                  00170000
001800 ENVIRONMENT DIVISION.                                            00180000
001900 INPUT-OUTPUT SECTION.                                            00190000
002000 FILE-CONTROL.                                                    00200000
002100     SELECT CENTRAL-STK-FILE                                      00210000
002200         ASSIGN TO OUT01.                                         00220000
002201                                                                  00220101
002210     SELECT ORACLE-LOGON-FILE                                     00221001
002220          ASSIGN TO ORALOGON.                                     00222001
002300                                                                  00230000
002400 DATA DIVISION.                                                   00240000
002500 FILE SECTION.                                                    00250000
002600                                                                  00260000
002700 FD  CENTRAL-STK-FILE                                             00270000
002800     RECORDING MODE IS F                                          00280000
002900     BLOCK CONTAINS 0 RECORDS.                                    00290000
003000 01  CENTRAL-STK-RECORD              PIC X(80).                   00300000
003100                                                                  00310000
003110 FD  ORACLE-LOGON-FILE                                            00311001
003120     RECORDING MODE IS F                                          00312001
003130     LABEL RECORDS ARE STANDARD                                   00313001
003140     BLOCK CONTAINS 0 RECORDS                                     00314001
003150     RECORD CONTAINS 80 CHARACTERS                                00315001
003160     DATA RECORDS IS OL-ORACLE-LOGON-RECORD.                      00316001
003170 01  OL-ORACLE-LOGON-RECORD          PIC X(80).                   00317001
003180                                                                  00318001
003200 WORKING-STORAGE SECTION.                                         00320000
003300                                                                  00330000
003400 01  WS-VARIABLES.                                                00340000
003410     05  PV-ORACLE-USERID-LEN        PIC S9(04)  VALUE ZEROS      00341001
003420                                                 COMP SYNC.       00342001
003430     05  PV-ORACLE-PASSWORD-LEN      PIC S9(04)  VALUE ZEROS      00343001
003440                                                 COMP SYNC.       00344001
003500     05  WS-MSG-TEXT                 PIC X(512).                  00350000
003600     05  WS-MSG-LENGTH               PIC S9(9)   COMP.            00360000
003700     05  WS-ABEND-CODE               PIC S9(4)   COMP SYNC        00370000
003800                                                 VALUE 0.         00380000
003900                                                                  00390000
004000 01  WS-CONSTANTS.                                                00400000
004010     05  PC-AUTO-LOGON               PIC X(01)   VALUE '/'.       00401001
004100*    05  WS-ECOMMERCE-STORE          PIC X(4)    VALUE '0873'.    00410000
004200     05  WS-MAX-SIZE                 PIC S9(9)   COMP             00420000
004300                                                 VALUE 512.       00430000
004400                                                                  00440000
004500 01  WS-PROGRAM-SWITCHES.                                         00450000
004510     05  PS-END-OF-LOGON-FILE-SW     PIC X(01)   VALUE 'N'.       00451001
004520         88  PS-END-OF-LOGON-FILE                VALUE 'Y'.       00452001
004530     05  PS-END-OF-PROC-INST-FILE-SW PIC X(01)   VALUE 'N'.       00453001
004540         88  PS-END-OF-PROC-INST-FILE            VALUE 'Y'.       00454001
004550         88  PS-NOT-END-OF-PROC-INST-FILE        VALUE 'N'.       00455001
004560     05  PS-ORA-SRC-CTL-DONE-SW      PIC X(01)   VALUE 'N'.       00456001
004570         88  PS-ORA-SRC-EMPTY                    VALUE 'Y'.       00457001
004600     05  WS-CENTRAL-STK-SW           PIC X(1)    VALUE 'N'.       00460000
004700         88  WS-CENTRAL-STK-EOF                  VALUE 'Y'.       00470000
004800         88  WS-CENTRAL-STK-NOT-EOF              VALUE 'N'.       00480000
004900                                                                  00490000
004920 01  CC-ORACLE-CONNECTION.                                        00492001
004930     05  CC-ORACLE-USERID            PIC X(40).                   00493001
004940         88 CC-AUTO-LOGON                        VALUE '/'.       00494001
004950     05  CC-ORACLE-PASSWORD          PIC X(40).                   00495001
004960                                                                  00496001
005000 01  WS-CENTRAL-STK-RECORD.                                       00500000
005100     05  WS-CENTRAL-STK              PIC X(4).                    00510000
005200     05  FILLER                      PIC X(76)   VALUE SPACES.    00520000
005300                                                                  00530000
005400******************************************************************00540000
005500*    WORK AREA FOR THE ABEND ROUTINE.                             00550000
005600******************************************************************00560000
005700     COPY DPWS004.                                                00570000
005800                                                                  00580000
005900                                                                  00590000
006000     EXEC SQL BEGIN DECLARE SECTION END-EXEC.                     00600000
006100                                                                  00610000
006200 01  AUTO-ORACLE-ID                  PIC X(1)    VALUE '/'.       00620000
006300 01  USERNAME                        PIC X(10)   VARYING.         00630000
006400 01  PASSWD                          PIC X(10)   VARYING.         00640000
006500                                                                  00650000
006600     EXEC SQL                                                     00660000
006700         INCLUDE TORGCLT                                          00670000
006800     END-EXEC.                                                    00680000
006900                                                                  00690000
007000     EXEC SQL END DECLARE SECTION END-EXEC.                       00700000
007100                                                                  00710000
007200     EXEC SQL                                                     00720000
007300         INCLUDE SQLCA                                            00730000
007400     END-EXEC.                                                    00740000
007500                                                                  00750000
007600     COPY SQLCA2.                                                 00760000
007700                                                                  00770000
007800                                                                  00780000
007900 PROCEDURE DIVISION.                                              00790000
008000 0000-MAINLINE.                                                   00800000
008100                                                                  00810000
008200     PERFORM 1000-INTIALIZATION                                   00820000
008300        THRU 1000-EXIT.                                           00830000
008400                                                                  00840000
008500     PERFORM 2000-OPEN-CENTRAL-STK-CSR                            00850000
008600        THRU 2000-EXIT.                                           00860000
008700                                                                  00870000
008800     PERFORM 3000-CREATE-CENTRAL-STK-DATA                         00880000
008900        THRU 3000-EXIT                                            00890000
009000       UNTIL WS-CENTRAL-STK-EOF.                                  00900000
009100                                                                  00910000
009200      PERFORM 4000-CLOSE-CENTRAL-STK-CSR                          00920000
009300         THRU 4000-EXIT.                                          00930000
009400                                                                  00940000
009500     CLOSE CENTRAL-STK-FILE.                                      00950000
009600                                                                  00960000
009700     STOP RUN.                                                    00970000
009800                                                                  00980000
009900 0000-MAINLINE-EXIT.                                              00990000
010000     EXIT.                                                        01000000
010100                                                                  01010000
010200                                                                  01020000
010300 1000-INTIALIZATION.                                              01030000
010400                                                                  01040000
010500     OPEN OUTPUT CENTRAL-STK-FILE.                                01050000
010600                                                                  01060000
010700*********  LOGON TO ORACLE  *************************             01070000
010800                                                                  01080000
010810     PERFORM A1010-CONNECT-TO-ORACLE.                             01081001
013600                                                                  01360000
013700*    CENTRAL STOCK LOCATIONS CURSOR                               01370000
013800     EXEC SQL                                                     01380000
013900         DECLARE CS CURSOR FOR                                    01390000
014000             SELECT ORG_CLUSTR_NAME                               01400000
014100               FROM TORGCLT                                       01410000
014200*             WHERE ORG_TYP_CDE = 'CS'                            01420000
014300*               AND EFF_END_TMST IS NULL                          01430000
014400              WHERE (    ORG_TYP_CDE   = 'CS'                     01440000
014500                     AND EFF_END_TMST IS NULL )                   01450000
014600                 OR (    ORG_TYP_CDE   = 'DS'                     01460000
014700                     AND E_BUS_LOC_IND = 'Y'                      01470000
014800                     AND EFF_END_TMST IS NULL )                   01480000
014900     END-EXEC.                                                    01490000
015000                                                                  01500000
015100 1000-EXIT.                                                       01510000
015200     EXIT.                                                        01520000
015300                                                                  01530000
015410****************************************************************  01541001
015420*   CONNECT TO THE APPROPRIATE ORACLE SERVER.                  *  01542001
015430****************************************************************  01543001
015440 A1010-CONNECT-TO-ORACLE.                                         01544001
015450                                                                  01545001
015460     OPEN INPUT ORACLE-LOGON-FILE.                                01546001
015470                                                                  01547001
015480     PERFORM A1020-READ-ORACLE-LOGON.                             01548001
015490                                                                  01549001
015491     CLOSE ORACLE-LOGON-FILE.                                     01549101
015492                                                                  01549201
015493     IF ((PS-END-OF-LOGON-FILE)                                   01549301
015494             OR (CC-ORACLE-CONNECTION = SPACES))                  01549401
015495         DISPLAY '** ABEND **'                                    01549501
015496         DISPLAY 'MAKUT230 - ORACLE LOGON CONTROL CARD '          01549601
015497                   'NOT PROVIDED'                                 01549701
015498         SET PS-ORA-SRC-EMPTY TO TRUE                             01549801
015499         CALL 'ILBOABN0' USING WS-ABEND-CODE                      01549901
015500     END-IF.                                                      01550001
015501                                                                  01550101
015502     IF CC-AUTO-LOGON                                             01550201
015503         DISPLAY 'MAKUT230 - AUTO LOGON TO ORACLE'                01550301
015504         EXEC SQL                                                 01550401
015505              CONNECT :USERNAME                                   01550501
015506         END-EXEC                                                 01550601
015507     ELSE                                                         01550701
015508         INITIALIZE PV-ORACLE-USERID-LEN                          01550801
015509                    PV-ORACLE-PASSWORD-LEN                        01550901
015510         INSPECT CC-ORACLE-USERID                                 01551001
015511             TALLYING PV-ORACLE-USERID-LEN                        01551101
015512          FOR CHARACTERS BEFORE INITIAL SPACE                     01551201
015513      INSPECT CC-ORACLE-PASSWORD                                  01551301
015514          TALLYING PV-ORACLE-PASSWORD-LEN                         01551401
015515          FOR CHARACTERS BEFORE INITIAL SPACE                     01551501
015516      MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO           01551601
015517                USERNAME-ARR                                      01551701
015518      MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                   01551801
015519      MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO       01551901
015520                PASSWD-ARR                                        01552001
015521      MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                   01552101
015522      DISPLAY 'MAKUT230 - LOGON TO ORACLE AS USER '               01552201
015523                USERNAME-ARR                                      01552301
015524      EXEC SQL                                                    01552401
015525        CONNECT :USERNAME IDENTIFIED BY :PASSWD                   01552501
015526      END-EXEC                                                    01552601
015527      INITIALIZE CC-ORACLE-PASSWORD                               01552701
015528                 PASSWD                                           01552801
015529      END-IF.                                                     01552901
015530                                                                  01553001
015531     IF (SQLCODE NOT = 0)                                         01553101
015532         DISPLAY 'A1010-CONNECT-TO-ORACLE'                        01553201
015533         DISPLAY 'MAKUT230 - ERROR LOGGING ON TO ORACLE'          01553301
015534         PERFORM 9900-SQL-ABEND                                   01553401
015535     END-IF.                                                      01553501
015536                                                                  01553601
015537****************************************************************  01553701
015538** READ THE ORACLE LOGON CONTROL CARD.                        **  01553801
015539****************************************************************  01553901
015540 A1020-READ-ORACLE-LOGON.                                         01554001
015541                                                                  01554101
015542     READ ORACLE-LOGON-FILE                                       01554201
015543         INTO CC-ORACLE-CONNECTION                                01554301
015544         AT END                                                   01554401
015545             SET PS-END-OF-LOGON-FILE TO TRUE                     01554501
015546     END-READ.                                                    01554601
015547                                                                  01554701
015550 2000-OPEN-CENTRAL-STK-CSR.                                       01555000
015600                                                                  01560000
015700     EXEC SQL                                                     01570000
015800         OPEN CS                                                  01580000
015900     END-EXEC.                                                    01590000
016000                                                                  01600000
016100     EVALUATE TRUE                                                01610000
016200         WHEN SQLCODE = ZEROS                                     01620000
016300             CONTINUE                                             01630000
016400         WHEN OTHER                                               01640000
016500             DISPLAY '2000-OPEN-CENTRAL-STK-CSR'                  01650000
016600             PERFORM 9900-SQL-ABEND                               01660000
016700     END-EVALUATE.                                                01670000
016800                                                                  01680000
016900 2000-EXIT.                                                       01690000
017000     EXIT.                                                        01700000
017100                                                                  01710000
017200                                                                  01720000
017300 3000-CREATE-CENTRAL-STK-DATA.                                    01730000
017400                                                                  01740000
017500     PERFORM 3100-FETCH-CENTRAL-STK-CSR                           01750000
017600        THRU 3100-EXIT.                                           01760000
017700                                                                  01770000
017800*    PERFORM 3200-WRITE-CENTRAL-STK-RCD                           01780000
017900*       THRU 3200-EXIT.                                           01790000
018000     IF SQLCODE = ZEROS                                           01800000
018100        PERFORM 3200-WRITE-CENTRAL-STK-RCD                        01810000
018200           THRU 3200-EXIT                                         01820000
018300     END-IF.                                                      01830000
018400                                                                  01840000
018500 3000-EXIT.                                                       01850000
018600     EXIT.                                                        01860000
018700                                                                  01870000
018800                                                                  01880000
018900 3100-FETCH-CENTRAL-STK-CSR.                                      01890000
019000                                                                  01900000
019100     EXEC SQL                                                     01910000
019200         FETCH CS                                                 01920000
019300          INTO :ORGCLT-ORG-CLUSTR-NAME                            01930000
019400     END-EXEC.                                                    01940000
019500                                                                  01950000
019600     EVALUATE TRUE                                                01960000
019700         WHEN SQLCODE = ZEROS                                     01970000
019800             MOVE ORGCLT-ORG-CLUSTR-NAME(1:4) TO WS-CENTRAL-STK   01980000
019900         WHEN SQLCODE = +1403                                     01990000
020000*------------------------------------------------------*          02000000
020100* THE E-COMMERCE STORE IS INCLUDED IN THE QTYS BRIDGED *          02010000
020200* TO ADAM.  THIS ALLOWS CS PULLS TO BE DONE FROM THE   *          02020000
020300* E-COMMERCE STORE, EVEN THOUGH IT IS NOT A 'CS'       *          02030000
020400* LOCATION TYPE.                                       *          02040000
020500*------------------------------------------------------*          02050000
020600*           MOVE WS-ECOMMERCE-STORE TO WS-CENTRAL-STK             02060000
020700            SET WS-CENTRAL-STK-EOF TO TRUE                        02070000
020800         WHEN OTHER                                               02080000
020900            DISPLAY '3100-FETCH-CENTRAL-STK-CSR'                  02090000
021000            PERFORM 9900-SQL-ABEND                                02100000
021100     END-EVALUATE.                                                02110000
021200                                                                  02120000
021300 3100-EXIT.                                                       02130000
021400     EXIT.                                                        02140000
021500                                                                  02150000
021600                                                                  02160000
021700 3200-WRITE-CENTRAL-STK-RCD.                                      02170000
021800                                                                  02180000
021900     WRITE CENTRAL-STK-RECORD                                     02190000
022000               FROM WS-CENTRAL-STK-RECORD.                        02200000
022100                                                                  02210000
022200 3200-EXIT.                                                       02220000
022300     EXIT.                                                        02230000
022400                                                                  02240000
022500                                                                  02250000
022600 4000-CLOSE-CENTRAL-STK-CSR.                                      02260000
022700                                                                  02270000
022800     EXEC SQL                                                     02280000
022900         CLOSE CS                                                 02290000
023000     END-EXEC.                                                    02300000
023100                                                                  02310000
023200     EVALUATE TRUE                                                02320000
023300         WHEN SQLCODE = ZEROS                                     02330000
023400             CONTINUE                                             02340000
023500         WHEN OTHER                                               02350000
023600             DISPLAY '4000-CLOSE-CENTRAL-STK-CSR'                 02360000
023700             PERFORM 9900-SQL-ABEND                               02370000
023800     END-EVALUATE.                                                02380000
023900                                                                  02390000
024000 4000-EXIT.                                                       02400000
024100     EXIT.                                                        02410000
024200                                                                  02420000
024300                                                                  02430000
024400 9900-SQL-ABEND.                                                  02440000
024500                                                                  02450000
024600     MOVE SQLCODE    TO SQLCODE2.                                 02460000
024700     MOVE SQLERRD(3) TO SQLERRD3.                                 02470000
024800     DISPLAY '** ABEND **       ** = SQLERROR'.                   02480000
024900     DISPLAY '** PROGRAM        ** = MAKUT230'.                   02490000
025000     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  02500000
025100     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  02510000
025200     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   02520000
025300     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  02530000
025400     DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                02540000
025500                                                                  02550000
025600     MOVE SPACES TO WS-MSG-TEXT.                                  02560000
025700                                                                  02570000
025800*    GET FULL TEXT OF ERROR MESSAGE                               02580000
025900                                                                  02590000
026000     CALL 'SQLGLM' USING WS-MSG-TEXT,                             02600000
026100                         WS-MAX-SIZE,                             02610000
026200                         WS-MSG-LENGTH.                           02620000
026300     DISPLAY 'MESSAGE TEXT      ** = ' WS-MSG-TEXT.               02630000
026400                                                                  02640000
026500     CALL 'ILBOABN0' USING WS-ABEND-CODE.                         02650000
026600                                                                  02660000
