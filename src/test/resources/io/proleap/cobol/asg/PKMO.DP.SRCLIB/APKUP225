000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     APKUP225.                                        00020000
000300 AUTHOR.         MIKE BESKE                                       00030000
000400 DATE-WRITTEN.   DECEMBER 2000.                                   00040000
000500*************************************************************     00050000
000600*    COBOL 2  WITH SQL                                            00060000
000700*                                                                 00070000
000800*    ADD IMPORT EXPENSE INVOICES.                                 00080000
000900*                                                                 00090000
001000*************************************************************     00100000
001100*                                                                 00110000
001200*    TPAYREQ - PAYMENT REQUEST TABLE                              00120000
001300*    TINVOIC - ACCOUNTS PAYABLE NEW INVOICE TABLE                 00130000
001400*    TEXINVC - EXPENSE INVOICE TABLE                              00140000
001500*    TINVCTM - INVOICE TERMS TABLE                                00150000
001600*    TALCHRG - ALLOWANCE CHARGE TABLE                             00160000
001700*    TAPCNTL - AP CONTROL TABLE                                   00170000
001800*    TDTATTR - DATE ATTRIBUTE TABLE                               00180006
001900*    TCKRSTCNTL - CHECKPOINT RESTART CONTROL TABLE                00190003
002000*    TCKRSTINF  - CHECKPOINT RESTART INFORMATION TABLE            00200004
002100*                                                                 00210004
002200* INPUT:                                                          00220004
002300* 1.  EDI IMPORT EXPENSE INVOICE LOAD RECORDS   (APRD016)         00230004
002400*                                                                 00240004
002500* OUTPUT                                                          00250004
002600* 1.  RPT OF TOTALS                                               00260004
002700*                                                                 00270004
002800******************************************************************00280004
002900* CHANGE LOG:                                                     00290004
003000*                                                                 00300004
003100* 07/06/01    CHANGE: CHANGED THE INPUT RECORD SIZE FROM 360 TO   00310004
003200*             435.  INCREASED THE TALCHRG ARRAY FROM 15 TO 20     00320004
003300*             TIMES.  CHANGED THE INVOIC-ENTR-MTHD VARIABLE AND   00330004
003400*             THE INVOIC-STATUS-CDE VARIABLE TO BE POPULATED      00340004
003500*             FROM THE INPUT RECORD INSTEAD OF HARD CODED.        00350004
003600*             BY: ALEXIS KEIKER             WR/IR: WR20530        00360004
003700*                                                                 00370004
003800* 11/21/01    CHANGE: CORRECTED THE PART OF THE CHECKPOINT        00380004
003900*             RESTART CODE THAT ACTUALLY MOVE VALUES TO THE       00390004
004000*             TCKRSTINF TABLE SO THAT THE RETART CAN RESTART IN   00400004
004100*             THE CORRECT PART OF THE INPUT DATASET.              00410004
004200*             BY: MIKE BESKE                PITS: 433700          00420004
004300*                                                                 00430004
004400* 04/29/02    ADDED LOGIC TO READ THE TAPCNTL TABLE TO GET THE    00440004
004500*             BATCH PROCESS DATE PLUS 1 DAY TO USE AS THE ENTER   00450004
004600*             DATE ON THE INVOICES BEING INSERTED.  THIS CHANGE   00460004
004700*             ADDRESSES A PROBLEM WHERE THE NEW INVOICES WERE NOT 00470004
004800*             BEING INCLUDED IN DAILY REPORTS THE NEXT DAY WHEN   00480004
004900*             THIS PROGRAM RAN PRIOR TO MIDNIGHT.                 00490004
005000*             BY: NANCY EILBES              WR:  22902            00500004
005100*                                                                 00510004
005200* 06/16/2002 ARK PO PROJECT PHASE 1.  ELIMINATED ALL REFERENCES TO00520004
005300*            INIT_INVC_ID.  ADDED LOGIC TO POPULATE NEW COLUMNS   00530004
005400*            FOR TABLES TINVOIC AND TEXINVC.  ADDED NEW COLUMNS   00540004
005500*            AND SEQUENCE ON THE INSERTS TO TINVOIC AND TEXINVC.  00550004
005600*            PARAGRAPHS MODIFIED ARE F200, F300, I200, AND I300.  00560004
005700*            MADE BY:  KEVIN CATLIN           WR/IR #: 23500      00570004
005800*                                                                 00580004
005900* 09/09/2002 ARK PO PROJECT PHASE 2.  CHANGED ALL REFERENCES TO   00590005
006000*            PEYMENT REQUEST NUMBER TO PO NUMBER AND INVOICE ID   00600004
006100*            BECAUSE THE PAYMENT REQUEST NUMBER IS NO LONGER USED.00610004
006200*            POPULATED THE PO AND THE ID FOR THE PAYMENT TERMS AND00620004
006300*            ALLOWANCE CHARGE IN PARAGRAPHS F400 AND F500.        00630004
006400*            MODIFIED THE SQL IN PARAGRAPHS I400 AND I500 AND     00640004
006500*            REMOVED REFERNES OF THE PAYMENT REQUEST NUMBER IN    00650004
006600*            R200.  ALSO REMOVED THE COPY BOOK APWS900 BECAUSE    00660004
006700*            IT IS NO LONGER USED.                                00670004
006800*            MADE BY: BRIAN HASSLINGER             WR/IR #: 23500 00680004
006900*                                                                 00690007
007000* 11/05/2002 COLBY DATING PROJECT.  ADDED TABLE TDTATTR AND JOINED00700007
007100*            IT WITH TABLE TAPCNTL TO DETERMINE THE DAY OF THE    00710007
007200*            WEEK.  THE SQL GETTING THE ENTER DATE TO USE ON EACH 00720007
007300*            INVOICE WILL CHOOSE EITHER BTCH-PRC-DTE + 2 FOR      00730007
007400*            SATURDAY RUNS OR BTCH-PRC-DTE + 1 FOR ALL OTHER DAYS.00740007
007500*            THIS SHOULD ENSURE THAT THE COMMISSION INVOICES ARE  00750007
007600*            PROCESSED CORRECTLY BY THE NEXT RUN OF APK012, WHICH 00760007
007700*            DOES NOT RUN ON SUNDAYS (THAT'S WHY WE SKIP SUNDAY AS00770007
007800*            AN ENTER DATE IF LOADING ON SATURDAY).               00780007
007900*            MADE BY: NANCY EILBES                 WR/IR #: 23750 00790007
008000*                                                                 00800008
008100* 04/22/2004 CHANGED THE HARD CODED VALUE FROM '90' TO 90 THAT IS 00810008
008200*            BEING MOVED TO INVOIC-STR-NBR AS PART OF STORE       00820008
008300*            CONSTRAINTS PROJECT.                                 00830008
008400*            MADE BY: MIKE BESKE                   WR/IR #: 25805 00840008
008500*                                                                 00850009
008600* DATE  01/21/2005                                                00860009
008700*     CHANGE MADE: CHANGED 'COLBY' TO 'LI & FUNG' IN THE FIELD    00870009
008800*            HL-HEADING-LINE1.  LI & FUNG IS THE PARENT COMPANY   00880009
008900*            OF COLBY.TS PROJECT.                                 00890009
009000*     MADE BY: MIKE BESKE              WR/IR #: WR28114           00900009
009100*                                                                 00910010
009200* DATE  02/14/2007                                                00920014
009300*     CHANGE MADE:  INSTALLED THE CODE THAT REMOVED TPAYREQ       00930014
009400*     AHEAD OF THE MATCH BY DC INSTALL BECAUSE OF THE OVER        00940014
009500*     ABUNDANCE OF -803 DB2 ERROR CODES. REMOVED PARAS            00950014
009600*     F100- AND I100-.  ADDED CODE TO CALCULATE THE PAYT_REQ_SEQ  00960014
009700*     _NBR WITHIN THE TINVOIC INSERT PARA I200- WHEN A -803       00970014
009800*     HAPPENS.  THIS IS THE SAME CALCULATION THAT WAS PUT IN      00980014
009900*     APKUP202.                                                   00990014
010000*     MADE BY: MIKE BESKE              WR/IR #: P000982838        01000014
010100*                                                                 01010014
010200* DATE  03/11/2007                                                01020015
010300*     CHANGE MADE: MATCH BY DC PROJECT.                           01030010
010400*            REMOVED ALL REFERENCES TO TPAYREQ.                   01040010
010500*     MADE BY: ROLF NOHE               WR/IR #: WR21578           01050010
010510*                                                                 01051020
010600* DATE  10/20/2009                                                01060020
010700*     CHANGE MADE: UPDATED TEXINVC INSERT STATEMENT TO INCLUDE NEW01070016
010800*            COLUMNS, INVC_CONTNR_ID AND IMPRT_BKR_REF_NBR.       01080016
010900*     MADE BY: PAUL STROEDE            WR/IR #: WR23145           01090020
011000******************************************************************01100008
011100                                                                  01110008
011200 ENVIRONMENT DIVISION.                                            01120008
011300                                                                  01130008
011400 INPUT-OUTPUT SECTION.                                            01140008
011500                                                                  01150008
011600 FILE-CONTROL.                                                    01160008
011700                                                                  01170008
011800      SELECT INPUT-FILE ASSIGN TO INP01.                          01180008
011900                                                                  01190008
012000      SELECT TOT-REPORT ASSIGN TO RPT01.                          01200008
012100                                                                  01210008
012200 DATA DIVISION.                                                   01220008
012300                                                                  01230008
012400 FILE SECTION.                                                    01240008
012500*                                                                 01250008
012600 FD  INPUT-FILE                                                   01260008
012700     RECORDING MODE IS F                                          01270008
012800     LABEL RECORDS ARE STANDARD                                   01280008
012900     RECORD CONTAINS 476 CHARACTERS                               01290019
013000     BLOCK CONTAINS 0  RECORDS                                    01300008
013100     DATA RECORD IS INPUT-RECORD.                                 01310008
013200 01  INPUT-RECORD                  PIC  X(476).                   01320019
013300*                                                                 01330008
013400 FD  TOT-REPORT                                                   01340008
013500     RECORDING MODE IS F                                          01350008
013600     LABEL RECORDS ARE STANDARD                                   01360008
013700     RECORD CONTAINS 132 CHARACTERS                               01370008
013800     BLOCK CONTAINS 0 RECORDS                                     01380008
013900     DATA RECORD IS TOT-LINE.                                     01390008
014000 01  TOT-LINE                      PIC X(132).                    01400008
014100*                                                                 01410008
014200/                                                                 01420008
014300 WORKING-STORAGE SECTION.                                         01430008
014400                                                                  01440008
014500 01  FILLER                        PIC X(25) VALUE                01450008
014600                             'WS FOR APKUP225 BEGINS==>'.         01460008
014700 01  ABEND-CODE                    PIC S9(4) COMP SYNC            01470008
014800                                             VALUE ZEROS.         01480008
014900     88 AP-TABLE-FULL              VALUE +4004.                   01490008
015000     88 AP-EMPTY-FILE              VALUE +4005.                   01500008
015100     88 AP-DB2-ERROR               VALUE +4013.                   01510008
015200                                                                  01520008
015300 01  WS-NULLS-INDICATORS.                                         01530008
015400     05  WS-MIITEM-VER-NBR-NULL    PIC S9(4) COMP VALUE ZERO.     01540008
015500     05  WS-MIITEM-PO-LNE-NBR-NULL PIC S9(4) COMP VALUE ZERO.     01550008
015600                                                                  01560008
015700 01  WS-RETRY-COUNTER                 PIC S9(4) COMP VALUE ZERO.  01570013
015800 01  WS-INSERT-INVC-RETRY-COUNTER     PIC S9(4) COMP VALUE ZERO.  01580013
015900 01  WS-DISPLAY-RETRY-COUNTER         PIC 9(9)  VALUE ZEROS.      01590013
016000 01  WS-ABEND-FILEDS.                                             01600008
016100     05  WS-ABEND-PROGRAM             PIC X(8)  VALUE 'APKUP225'. 01610008
016200     05  WS-ABEND-SQLCODE             PIC X(4)  VALUE SPACES.     01620008
016300     05  WS-ABEND-PARAGRAPH           PIC X(50) VALUE SPACES.     01630008
016400     05  WS-ABEND-OPERATION           PIC X(50) VALUE SPACES.     01640008
016500     05  WS-ABEND-STRUCTURE-1         PIC X(8)  VALUE SPACES.     01650008
016600     05  WS-ABEND-STRUCTURE-2         PIC X(8)  VALUE SPACES.     01660008
016700     05  WS-ABEND-STATUS              PIC XX    VALUE SPACES.     01670008
016800                                                                  01680008
016900 01  WS-TIMESTAMP            PIC X(26)     VALUE SPACES.          01690008
017000 01  FILLER REDEFINES WS-TIMESTAMP.                               01700008
017100     05  FILLER              PIC X(14).                           01710008
017200     05  WS-MINUTE           PIC X(02).                           01720008
017300     05  FILLER              PIC X(02).                           01730008
017400     05  WS-SECOND           PIC X(01).                           01740008
017500     05  FILLER              PIC X(01).                           01750008
017600     05  WS-NANOSEC-1-3      PIC X(03).                           01760008
017700     05  WS-NANOSEC-4-6      PIC X(03).                           01770008
017800                                                                  01780008
017900 01  WS-RANDOM-KEY           PIC 9(09)     VALUE 0.               01790008
018000 01  FILLER REDEFINES WS-RANDOM-KEY.                              01800008
018100     05  WS-RND-NANOSEC-4-6  PIC X(03).                           01810008
018200     05  WS-RND-NANOSEC-1-3  PIC X(03).                           01820008
018300     05  WS-RND-MINUTE       PIC X(02).                           01830008
018400     05  WS-RND-SECOND       PIC X(01).                           01840008
018500                                                                  01850008
018600 01  WS-RANDOM-KEY-COMP      PIC S9(09)    VALUE 0 COMP.          01860008
018700                                                                  01870008
018800 01  WS-WORK-AREA.                                                01880008
018900     05  PV-REMIT-TO-DUN-NBR     PIC X(9)    VALUE SPACES.        01890008
019000     05  PV-PO-NBR               PIC 9(9)    VALUE ZEROS.         01900008
019100     05  PV-INVC-ID              PIC X(22)   VALUE SPACES.        01910008
019200     05  WS-SAVE-RMT-DUN-NBR     PIC X(9)    VALUE SPACES.        01920008
019300     05  WS-SAVE-PO-NBR          PIC S9(9) COMP VALUE ZEROS.      01930008
019400     05  WS-SAVE-INVOICE-NBR     PIC X(22) VALUE SPACES.          01940008
019500     05  PV-INVOICE-COUNT        PIC 9(9)    VALUE ZEROS.         01950008
019600     05  PV-PROGRAM-NAME         PIC X(08)   VALUE 'APKUP225'.    01960008
019700     05  PV-CKPT-STAT-CODE       PIC X(01)   VALUE SPACE.         01970008
019800     05  PV-8V99                 PIC Z(8).99.                     01980008
019900     05  PV-8V99-X REDEFINES                                      01990008
020000         PV-8V99                 PIC X(11).                       02000008
020100     05  PV-8V99-SIGN            PIC -Z(8).99.                    02010008
020200     05  PV-8V99-SIGN-X REDEFINES                                 02020008
020300         PV-8V99-SIGN            PIC X(12).                       02030008
020400                                                                  02040008
020500     05  WS-MAX-RETRIES          PIC S9(4) COMP VALUE +3.         02050008
020600     05  WS-TALCHRG-MAX          PIC  9(4) VALUE 20.              02060008
020700                                                                  02070008
020800     05  WS-IMPORT-DUN-NBR       PIC  X(09)  VALUE  '009206194'.  02080008
020900     05  WS-IMPORT-CHRG-PRC-CDE  PIC  X(09)  VALUE '1ST'.         02090008
021000                                                                  02100008
021100     05  WS-TOT-NO-PAY-REQ-ADDED PIC S9(11)    VALUE 0.           02110008
021200     05  WS-TOT-GROSS-COST-ADDED PIC S9(09)V99 VALUE 0.           02120008
021300                                                                  02130008
021400     05  WS-PAYT-REQ-SEQ-NBR     PIC S9(9) COMP VALUE ZEROS.      02140010
021500     05  WS-PAYT-REQ-LNE-NBR     PIC S9(9) COMP VALUE ZEROS.      02150008
021600     05  WS-PAYT-REQ-LNE-NBR-UNPK PIC S9(18) VALUE ZEROS.         02160008
021700     05  WS-TERMS-SEQ-NBR        PIC S9(4) COMP VALUE ZEROS.      02170008
021800     05  WS-ALW-CHRG-SEQ-NBR     PIC S9(4) COMP VALUE ZEROS.      02180008
021900                                                                  02190008
022000     05  WS-ALLW-CHRG-PCT        PIC SV9(04)  COMP-3 VALUE +0.    02200008
022100                                                                  02210008
022200     05  WS-BTCH-ENTR-DTE        PIC X(10).                       02220008
022300     05  WS-SAVE-CURRENT-DATE.                                    02230008
022400         10  WS-SAVE-CURRENT-CC  PIC X(02) VALUE ZEROS.           02240008
022500         10  WS-SAVE-CURRENT-YY  PIC X(02) VALUE ZEROS.           02250008
022600         10  FILLER              PIC X(01) VALUE '-'.             02260008
022700         10  WS-SAVE-CURRENT-MM  PIC X(02) VALUE ZEROS.           02270008
022800         10  FILLER              PIC X(01) VALUE '-'.             02280008
022900         10  WS-SAVE-CURRENT-DD  PIC X(02) VALUE ZEROS.           02290008
023000                                                                  02300008
023100                                                                  02310008
023200*                                                                 02320008
023300 01  WS-PROGRAM-COUNTERS.                                         02330008
023400     05  WS-INPUT-COUNT          PIC 9(9)  VALUE ZEROS.           02340008
023500                                                                  02350008
023600 01  WS-SWITCHES.                                                 02360008
023700     05  END-OF-EDIIN-SW         PIC X(01) VALUE 'N'.             02370008
023800         88  END-OF-EDIIN                  VALUE 'Y'.             02380008
023900                                                                  02390008
024000     05  WS-END-OF-INPUT-SW      PIC X(03) VALUE 'NO '.           02400008
024100         88  WS-END-OF-INPUT               VALUE 'YES'.           02410008
024200         88  WS-NOT-END-OF-INPUT           VALUE 'NO '.           02420008
024300                                                                  02430008
024400     05  INSERT-SUCCESSFUL-SW         PIC X(01) VALUE 'N'.        02440013
024500         88  INSERT-SUCCESSFUL                  VALUE 'Y'.        02450013
024600         88  INSERT-NOT-SUCCESSFUL              VALUE 'N'.        02460013
024700                                                                  02470013
024800 01  PS-PROGRAM-SWITCHES-II.                                      02480008
024900     05  PS-RUN-TYPE-SW          PIC X(01) VALUE ' '.             02490008
025000         88  NORMAL-RUN                    VALUE '0'.             02500008
025100         88  RESTART-RUN                   VALUE '9'.             02510008
025200                                                                  02520008
025300 01  RUN-TIME.                                                    02530008
025400     05  R-HR                    PIC 99.                          02540008
025500     05  R-MIN                   PIC 99.                          02550008
025600     05  R-SEC                   PIC 99.                          02560008
025700     05  R-TH                    PIC 99.                          02570008
025800*                                                                 02580008
025900 01  DATE-IN.                                                     02590008
026000     05 DATE-IN-YY               PIC XX.                          02600008
026100     05 DATE-IN-MM               PIC XX.                          02610008
026200     05 DATE-IN-DD               PIC XX.                          02620008
026300                                                                  02630008
026400 01  PC-PROGRAM-CONSTANTS.                                        02640008
026500     05  PC-IN-PROCESS-CODE      PIC  X(01)  VALUE '9'.           02650008
026600     05  PC-RUN-COMPLETE-CODE    PIC  X(01)  VALUE '0'.           02660008
026700                                                                  02670008
026800 01  CKPT-RESTART-INFO.                                           02680008
026900     05  CR-REMIT-TO-DUN-NBR     PIC X(9)    VALUE SPACES.        02690008
027000     05  CR-PO-NBR               PIC S9(9)   VALUE ZEROS  COMP.   02700008
027100     05  CR-INVC-ID              PIC X(22)   VALUE SPACES.        02710008
027200     05  CR-TOT-NO-PAY-REQ-ADDED PIC S9(11)    VALUE ZEROS.       02720008
027300     05  CR-TOT-GROSS-COST-ADDED PIC S9(09)V99 VALUE ZEROS.       02730008
027400                                                                  02740008
027500 01  CKPT-RESTART-TMST.                                           02750008
027600     05  CR-CURR-TMST            PIC X(26)   VALUE SPACES.        02760008
027700     05  CR-NEXT-TMST            PIC X(26)   VALUE SPACES.        02770008
027800                                                                  02780008
027900                                                                  02790008
028000****************************************************************  02800008
028100* STANDARD HEADER 132 COLUMNS.  COPY DPWS132O                     02810008
028200****************************************************************  02820008
028300*                                                                 02830008
028400     COPY DPWS132O.                                               02840008
028500*                                                                 02850008
028600****************************************************************  02860008
028700*                                                                 02870008
028800 01  HL-HEADING-LINE1.                                            02880008
028900     05  FILLER                  PIC X(42)     VALUE SPACES.      02890009
029000     05  FILLER                  PIC X(48)     VALUE              02900009
029100         ' EDI LI & FUNG COMMISSION INVOICE UPDATE TOTALS '.      02910009
029200     05  FILLER                  PIC X(42)     VALUE SPACES.      02920009
029300                                                                  02930008
029400 01  DETAIL-LINE1.                                                02940008
029500     05  FILLER                  PIC X(50)     VALUE              02950008
029600     'TOTAL NUMBER OF INVOICES ADDED TO DB2 TABLES =    '.        02960008
029700     05  WS-EDITTED-PAY-REQ           PIC  ZZ,ZZZ,ZZZ,ZZ9.        02970008
029800     05  FILLER                  PIC X(68)     VALUE SPACES.      02980008
029900                                                                  02990008
030000 01  DETAIL-LINE2.                                                03000008
030100     05  FILLER                  PIC X(49)     VALUE              03010008
030200     'TOTAL GROSS AMOUNT ADDED TO DB2 TABLES =         '.         03020008
030300     05  WS-EDITTED-COST              PIC $ZZZ,ZZZ,ZZ9.99.        03030008
030400     05  FILLER                  PIC X(68)     VALUE SPACES.      03040008
030500                                                                  03050008
030600****************************************************************  03060008
030700 01  FILLER                      PIC X(35)  VALUE                 03070008
030800     'BEGINNING OF AP016 INPUT FILE    **'.                       03080008
030900     COPY APRD016.                                                03090008
031000                                                                  03100008
031100 01  FILLER                      PIC X(35)  VALUE                 03110008
031200     'END OF AP WORK RECORD AREA       **'.                       03120008
031300                                                                  03130008
031400     COPY DPWS004.                                                03140008
031500                                                                  03150008
031600******************************************************************03160008
031700*  COMMUNICATIONS AREA2 FOR DB2                                   03170008
031800******************************************************************03180008
031900     COPY SQLCA2.                                                 03190008
032000                                                                  03200008
032100     EXEC SQL                                                     03210008
032200          INCLUDE SQLCA                                           03220008
032300     END-EXEC.                                                    03230008
032400                                                                  03240008
032500     EXEC SQL                                                     03250008
032600          INCLUDE TINVOIC                                         03260008
032700     END-EXEC.                                                    03270008
032800                                                                  03280008
032900     EXEC SQL                                                     03290008
033000          INCLUDE TEXINVC                                         03300008
033100     END-EXEC.                                                    03310008
033200                                                                  03320008
033300     EXEC SQL                                                     03330008
033400          INCLUDE TINVCTM                                         03340008
033500     END-EXEC.                                                    03350008
033600                                                                  03360008
033700     EXEC SQL                                                     03370008
033800          INCLUDE TALCHRG                                         03380008
033900     END-EXEC.                                                    03390008
034000                                                                  03400008
034100     EXEC SQL                                                     03410008
034200          INCLUDE TAPCNTL                                         03420008
034300     END-EXEC.                                                    03430008
034400                                                                  03440008
034500     EXEC SQL                                                     03450008
034600          INCLUDE TDTATTR                                         03460008
034700     END-EXEC.                                                    03470008
034800                                                                  03480008
034900     EXEC SQL                                                     03490008
035000          INCLUDE TCKRSTCN                                        03500008
035100     END-EXEC.                                                    03510008
035200                                                                  03520008
035300     EXEC SQL                                                     03530008
035400          INCLUDE TCKRSTIN                                        03540008
035500     END-EXEC.                                                    03550008
035600                                                                  03560008
035700 01  FILLER                        PIC X(25) VALUE                03570008
035800          '<====WS FOR APKUP225 ENDS'.                            03580008
035900                                                                  03590008
036000*LINKAGE SECTION.                                                 03600008
036100                                                                  03610008
036200                                                                  03620008
036300 PROCEDURE DIVISION.                                              03630008
036400                                                                  03640008
036500 A100-MAINLINE.                                                   03650008
036600                                                                  03660008
036700     PERFORM B100-HOUSEKEEPING.                                   03670008
036800                                                                  03680008
036900     PERFORM B200-PROCESSING UNTIL WS-END-OF-INPUT.               03690008
037000                                                                  03700008
037100     PERFORM B300-END-OF-JOB.                                     03710008
037200                                                                  03720008
037300     GOBACK.                                                      03730008
037400                                                                  03740008
037500                                                                  03750008
037600***************************************************************** 03760008
037700*    GET DATE, TIME, OPEN FILES, SET UP CONTROLS, ETC             03770008
037800***************************************************************** 03780008
037900 B100-HOUSEKEEPING.                                               03790008
038000                                                                  03800008
038100     ACCEPT RUN-TIME FROM TIME.                                   03810008
038200     ACCEPT DATE-IN  FROM DATE.                                   03820008
038300                                                                  03830008
038400     DISPLAY ' RUN-DATE = ' DATE-IN '   RUN-TIME = ' RUN-TIME.    03840008
038500     IF DATE-IN-YY > 80                                           03850008
038600        MOVE '19' TO WS-SAVE-CURRENT-CC                           03860008
038700     ELSE                                                         03870008
038800        MOVE '20' TO WS-SAVE-CURRENT-CC                           03880008
038900     END-IF.                                                      03890008
039000     MOVE DATE-IN-YY TO WS-SAVE-CURRENT-YY                        03900008
039100                        DP132O-RUN-YEAR.                          03910008
039200     MOVE DATE-IN-MM TO WS-SAVE-CURRENT-MM                        03920008
039300                        DP132O-RUN-MONTH.                         03930008
039400     MOVE DATE-IN-DD TO WS-SAVE-CURRENT-DD                        03940008
039500                        DP132O-RUN-DAY.                           03950008
039600                                                                  03960008
039700     MOVE R-HR   TO DP132O-RUN-HOUR.                              03970008
039800     MOVE R-MIN  TO DP132O-RUN-MINUTE.                            03980008
039900                                                                  03990008
040000     MOVE PV-PROGRAM-NAME TO DP132O-PROGRAM-NAME.                 04000008
040100                                                                  04010008
040200     OPEN INPUT  INPUT-FILE                                       04020008
040300          OUTPUT TOT-REPORT.                                      04030008
040400                                                                  04040008
040500     INITIALIZE DCLTINVOIC.                                       04050008
040600     INITIALIZE DCLTEXINVC.                                       04060008
040700     INITIALIZE DCLTINVCTM.                                       04070008
040800     INITIALIZE DCLTALCHRG.                                       04080008
040900     INITIALIZE DCLTAPCNTL.                                       04090008
041000     INITIALIZE DCLTDTATTR.                                       04100008
041100     INITIALIZE DCLTCKRSTCNTL.                                    04110008
041200     INITIALIZE DCLTCKRSTINF.                                     04120008
041300                                                                  04130008
041400     PERFORM S600-SELECT-CONTROL-DATA.                            04140008
041500     DISPLAY 'ENTER DATE BEING USED = ' WS-BTCH-ENTR-DTE.         04150008
041600                                                                  04160008
041700     PERFORM S400-GET-CHECKPOINT-CNTL.                            04170008
041800     MOVE PV-CKPT-STAT-CODE TO PS-RUN-TYPE-SW.                    04180008
041900                                                                  04190008
042000     IF RESTART-RUN                                               04200008
042100        PERFORM X200-CHECKPOINT-RESTART                           04210008
042200     ELSE                                                         04220008
042300        PERFORM R100-READ-INPUT                                   04230008
042400     END-IF.                                                      04240008
042500                                                                  04250008
042600     IF WS-END-OF-INPUT                                           04260008
042700        IF NORMAL-RUN                                             04270008
042800           DISPLAY '**********************************'           04280008
042900           DISPLAY '*   EMPTY EDI INVOICE FILE       *'           04290008
043000           DISPLAY '*   PROGRAM ** = APKUP225        *'           04300008
043100           DISPLAY '**********************************'           04310008
043200        ELSE                                                      04320008
043300           DISPLAY '***********************************'          04330008
043400           DISPLAY '*   NO MATCH TO CONTROL VEND-PO-INV'          04340008
043500           DISPLAY '*   PROGRAM ** = APKUP225'                    04350008
043600           DISPLAY '*   VENDOR NUMBER= ' PV-REMIT-TO-DUN-NBR      04360008
043700           DISPLAY '*   PO NUMBER    = ' PV-PO-NBR                04370008
043800           DISPLAY '*   INVOICE ID   = ' PV-INVC-ID               04380008
043900           DISPLAY '***********************************'          04390008
044000        END-IF                                                    04400008
044100     END-IF.                                                      04410008
044200                                                                  04420008
044300                                                                  04430008
044400***************************************************************** 04440008
044500*     PROCESS EDI INVOICES:                                       04450008
044600*     -- DATA FOR EACH INVOICE THAT HAS ONE AND ONLY ONE OF       04460008
044700*        THE RECORD TYPE IS LOADED TO THE DCLGENS THAT IT WILL    04470008
044800*        BE UPDATING                                              04480008
044900*     -- DATA THAT IS COMING IN ON A RECORD TYPE THAT CAN HAVE    04490008
045000*        MULTIPLE RECORDS IS LOADED TO TABLES AND PROCESSED TO    04500008
045100*        THE DCLGEN DURING TABLE CREATION                         04510008
045200*     -- ON BREAK IN INVOICE NUMBER THE TABLES ARE CREATED FOR    04520008
045300*        THE INVOICE AND THE WORKING STORAGE,DCLGEN AREAS ARE     04530008
045400*        RE-INITIALIZED FOR THE NEXT INVOICE                      04540008
045500***************************************************************** 04550008
045600 B200-PROCESSING.                                                 04560008
045700                                                                  04570008
045800     PERFORM R200-DETERMINE-PAYT-NBR.                             04580008
045900                                                                  04590008
046000     PERFORM F200-FILL-INVOIC.                                    04600008
046100                                                                  04610008
046200     PERFORM F300-FILL-EXINVC.                                    04620008
046300                                                                  04630008
046400     PERFORM F400-FILL-INVCTM.                                    04640008
046500                                                                  04650008
046600***************************************************************** 04660008
046700*    PROCESS THE ALLW/CHRG RECORDS FOR THE ALCHRG ROWS            04670008
046800*            CHECK IF ANY ALLW/CHRG RECORDS EXIST                 04680008
046900*            IF YES THEN INSERT ALL OF THE LOADED RECORDS-        04690008
047000*            THE ALLW/CHRG CAN HAVE MULTIPLE ROWS                 04700008
047100***************************************************************** 04710008
047200                                                                  04720008
047300     MOVE 1 TO WS-ALW-CHRG-SEQ-NBR.                               04730008
047400     PERFORM F500-FILL-ALCHRG                                     04740008
047500       VARYING TALCHRG-INDEX FROM 1 BY 1                          04750008
047600       UNTIL TALCHRG-INDEX > WS-TALCHRG-MAX OR                    04760008
047700             AP016-ALW-CHRG-TYP-CDE (TALCHRG-INDEX) = SPACE.      04770008
047800                                                                  04780008
047900     MOVE AP016-REMIT-TO-DUN-NBR TO WS-SAVE-RMT-DUN-NBR.          04790008
048000     MOVE AP016-PO-NBR           TO WS-SAVE-PO-NBR.               04800008
048100     MOVE AP016-INVC-ID          TO WS-SAVE-INVOICE-NBR.          04810008
048200     ADD 1                       TO WS-TOT-NO-PAY-REQ-ADDED.      04820008
048300     ADD AP016-INVC-NET-COST-AMT TO WS-TOT-GROSS-COST-ADDED.      04830008
048400                                                                  04840008
048500     PERFORM X100-CHECKPOINT-COMMIT.                              04850008
048600                                                                  04860008
048700     PERFORM R100-READ-INPUT.                                     04870008
048800                                                                  04880008
048900                                                                  04890008
049000***************************************************************** 04900008
049100*     CLOSE ALL FILES, REPORT ON NECESSARY TOTALS                 04910008
049200***************************************************************** 04920008
049300 B300-END-OF-JOB.                                                 04930008
049400                                                                  04940008
049500     DISPLAY '************************************************'.  04950008
049600     DISPLAY 'TOTAL INVOICES RECORDS READ    = ' WS-INPUT-COUNT.  04960008
049700     DISPLAY '************************************************'.  04970008
049800                                                                  04980008
049900     MOVE WS-TOT-NO-PAY-REQ-ADDED TO WS-EDITTED-PAY-REQ.          04990008
050000     MOVE WS-TOT-GROSS-COST-ADDED TO WS-EDITTED-COST.             05000008
050100                                                                  05010008
050200     DISPLAY '************************************************'.  05020008
050300     DISPLAY 'TOT NUMBER PAY REQS ADDED = ' WS-EDITTED-PAY-REQ.   05030008
050400     DISPLAY '************************************************'.  05040008
050500                                                                  05050008
050600     DISPLAY '************************************************'.  05060008
050700     DISPLAY 'TOT GROSS COST ADDED = ' WS-EDITTED-COST.           05070008
050800     DISPLAY '************************************************'.  05080008
050900                                                                  05090008
051000     PERFORM W100-TOT-REPORT.                                     05100008
051100                                                                  05110008
051200     CLOSE INPUT-FILE                                             05120008
051300           TOT-REPORT.                                            05130008
051400                                                                  05140008
051500     MOVE PC-RUN-COMPLETE-CODE TO PV-CKPT-STAT-CODE.              05150008
051600     PERFORM U100-UPDATE-TCKRSTCNTL.                              05160008
051700     PERFORM U200-UPDATE-TCKRSTINF.                               05170008
051800     PERFORM U300-COMMIT.                                         05180008
051900                                                                  05190008
052000     IF WS-END-OF-INPUT                                           05200008
052100        DISPLAY ' PROGRAM APKUP225 ENDS NORMALLY '                05210008
052200     ELSE                                                         05220008
052300        DISPLAY ' PROGRAM APKUP225 ENDS ABNORMALLY '              05230008
052400     END-IF.                                                      05240008
052500                                                                  05250008
052600     ACCEPT RUN-TIME FROM TIME.                                   05260008
052700     ACCEPT DATE-IN  FROM DATE.                                   05270008
052800                                                                  05280008
052900     DISPLAY ' RUN-DATE = ' DATE-IN '   RUN-TIME = ' RUN-TIME.    05290008
053000     DISPLAY '************************************************'.  05300008
053100                                                                  05310008
053200                                                                  05320008
053300***************************************************************** 05330008
053400*    MOVE THE DATA TO COMPLETE THE INVOIC ROW                     05340008
053500***************************************************************** 05350008
053600 F200-FILL-INVOIC.                                                05360008
053700                                                                  05370008
053800     MOVE AP016-PO-NBR            TO INVOIC-PO-NBR.               05380008
053900     MOVE AP016-INVC-ID           TO INVOIC-INVC-ID.              05390008
054000     MOVE 'EI'                    TO INVOIC-INVC-TYP-CDE.         05400008
054100     MOVE AP016-ENTR-MTHD-CDE     TO INVOIC-ENTR-MTHD-CDE.        05410008
054200     MOVE PV-PROGRAM-NAME         TO INVOIC-CRE-BY-USR-ID.        05420008
054300     MOVE SPACE                   TO INVOIC-BAR-CDE.              05430008
054400     MOVE 'N'                     TO INVOIC-SPLIT-TERMS-IND.      05440008
054500     MOVE 'N'                     TO INVOIC-DTL-ENTR-IND.         05450008
054600     MOVE ZERO                    TO INVOIC-INVC-CART-CT.         05460008
054700     MOVE WS-BTCH-ENTR-DTE        TO INVOIC-CRE-DTE.              05470008
054800     MOVE 'N'                     TO INVOIC-PPD-RVRSL-IND.        05480008
054900     MOVE AP016-INVC-DTE          TO INVOIC-INVC-DTE.             05490008
055000     MOVE ZERO                    TO INVOIC-GRO-COST-AMT.         05500008
055100     MOVE AP016-INVC-NET-COST-AMT TO INVOIC-INVC-NET-COST-AMT.    05510008
055200     MOVE AP016-REMIT-TO-DUN-NBR  TO INVOIC-RMIT-VND-ID.          05520008
055300     MOVE 90                      TO INVOIC-STR-NBR.              05530008
055400     MOVE AP016-HOLD-IND          TO INVOIC-HOLD-IND.             05540008
055500     MOVE SPACE                   TO INVOIC-DUE-DTE-SRC-CDE.      05550008
055600     MOVE '0001-01-01'            TO INVOIC-CALC-DUE-DTE.         05560008
055700     MOVE '9999-09-09'            TO INVOIC-PAYT-DTE.             05570008
055800     MOVE '9999-09-09'            TO INVOIC-AP-PRC-DTE.           05580008
055900     MOVE SPACE                   TO INVOIC-AP-PRC-CDE.           05590008
056000     MOVE '9999-09-09-09.09.09.999999'                            05600008
056100                                  TO INVOIC-PAYT-RLSE-TMST.       05610008
056200     MOVE AP016-STATUS-CDE        TO INVOIC-STATUS-CDE.           05620008
056300     MOVE ZERO                    TO INVOIC-DC-NBR.               05630011
056400     MOVE SPACE                   TO INVOIC-MTCH-LVL-CDE.         05640011
056500                                                                  05650008
056600     PERFORM I200-INSERT-INVOIC.                                  05660008
056700                                                                  05670008
056800***************************************************************** 05680008
056900*    MOVE THE DATA TO COMPLETE THE EXINVC ROW                     05690008
057000***************************************************************** 05700008
057100 F300-FILL-EXINVC.                                                05710008
057200                                                                  05720008
057300     MOVE AP016-PO-NBR           TO EXINVC-PO-NBR.                05730008
057400     MOVE AP016-INVC-ID          TO EXINVC-INVC-ID.               05740008
057500     MOVE AP016-IMPRT-ENTR-NBR   TO EXINVC-IMPRT-ENTR-NBR.        05750008
057600     MOVE AP016-IMPRT-BOL-ID     TO EXINVC-IMPRT-BOL-ID.          05760008
057700     MOVE AP016-CONTAINER-NBR    TO EXINVC-INVC-CONTNR-ID.        05770018
057710     MOVE AP016-BKR-REF-NBR      TO EXINVC-IMPRT-BKR-REF-NBR.     05771019
057900                                                                  05790008
058000     PERFORM I300-INSERT-EXINVC.                                  05800008
058100                                                                  05810008
058200                                                                  05820008
058300***************************************************************** 05830008
058400*     MOVE THE DATA TO COMPLETE THE INVCTM ROW                    05840008
058500***************************************************************** 05850008
058600 F400-FILL-INVCTM.                                                05860008
058700                                                                  05870008
058800     MOVE 1                        TO INVCTM-TERM-SEQ-NBR.        05880008
058900     MOVE AP016-TERM-TYP-CDE       TO INVCTM-TERM-TYP-CDE.        05890008
059000     MOVE AP016-TERM-BASIS-DTE-CDE TO INVCTM-TERM-BASIS-DTE-CDE.  05900008
059100     MOVE '9999-09-09'             TO INVCTM-EFF-DTE.             05910008
059200     MOVE ZERO                     TO INVCTM-DISC-PCT.            05920008
059300     MOVE ZERO                     TO INVCTM-DISC-AMT.            05930008
059400     MOVE '9999-09-09'             TO INVCTM-DISC-DUE-DTE.        05940008
059500     MOVE ZERO                     TO INVCTM-DISC-DUE-DAY-QTY.    05950008
059600     MOVE '9999-09-09'             TO INVCTM-NET-DUE-DTE.         05960008
059700     MOVE AP016-NET-DUE-DAY-QTY    TO INVCTM-NET-DUE-DAY-QTY.     05970008
059800     MOVE ZERO                     TO INVCTM-EXTD-DAYS-QTY.       05980008
059900     MOVE AP016-PO-NBR             TO INVCTM-PO-NBR.              05990008
060000     MOVE AP016-INVC-ID            TO INVCTM-INVC-ID.             06000008
060100                                                                  06010008
060200     PERFORM I400-INSERT-INVCTM.                                  06020008
060300                                                                  06030008
060400                                                                  06040008
060500***************************************************************** 06050008
060600*    MOVE THE DATA TO COMPLETE THE ALCHRG ROW(S)                  06060008
060700***************************************************************** 06070008
060800 F500-FILL-ALCHRG.                                                06080008
060900                                                                  06090008
061000     MOVE AP016-PO-NBR        TO ALCHRG-PO-NBR.                   06100008
061100     MOVE AP016-INVC-ID       TO ALCHRG-INVC-ID.                  06110008
061200     MOVE WS-ALW-CHRG-SEQ-NBR TO ALCHRG-ALW-CHRG-SEQ-NBR.         06120008
061300     MOVE AP016-ALW-CHRG-TYP-CDE (TALCHRG-INDEX)                  06130008
061400                              TO ALCHRG-ALW-CHRG-TYP-CDE.         06140008
061500     MOVE AP016-ALW-CHRG-CDE (TALCHRG-INDEX)                      06150008
061600                              TO ALCHRG-ALW-CHRG-CDE.             06160008
061700     MOVE SPACE               TO ALCHRG-ALW-CHRG-SER-CDE.         06170008
061800     MOVE ZERO                TO ALCHRG-ALW-CHRG-PCT.             06180008
061900     MOVE AP016-ALW-CHRG-AMT (TALCHRG-INDEX)                      06190008
062000                              TO ALCHRG-ALW-CHRG-AMT.             06200008
062100                                                                  06210008
062200     PERFORM I500-INSERT-ALCHRG.                                  06220008
062300                                                                  06230008
062400     COMPUTE WS-ALW-CHRG-SEQ-NBR                                  06240008
062500        =    WS-ALW-CHRG-SEQ-NBR                                  06250008
062600        +    1                                                    06260008
062700     END-COMPUTE.                                                 06270008
062800                                                                  06280008
062900                                                                  06290008
063000***************************************************************** 06300008
063100*     INSERT THE INVOIC ROW FOR THIS INVOICE NUMBER               06310008
063200***************************************************************** 06320008
063300 I200-INSERT-INVOIC.                                              06330008
063400                                                                  06340008
063500***** SET THE MAX RETRIES HIGHER HERE SO THAT MORE ATTEMPTS WILL  06350012
063600***** BE MADE TO DETERMINE A UNIQUE RANDOM PAYT-REQ-SEQ-NBR       06360012
063700                                                                  06370012
063800     SET INSERT-NOT-SUCCESSFUL TO TRUE.                           06380012
063900                                                                  06390012
064000     PERFORM WITH TEST AFTER                                      06400012
064100             VARYING WS-INSERT-INVC-RETRY-COUNTER FROM 1 BY 1     06410012
064200             UNTIL   WS-INSERT-INVC-RETRY-COUNTER > 100           06420012
064300                OR   INSERT-SUCCESSFUL                            06430012
064400                                                                  06440012
064500             EXEC SQL                                             06450008
064600                 INSERT INTO TINVOIC                              06460008
064700                    ( PO_NBR                                      06470008
064800                     ,INVC_ID                                     06480008
064900                     ,PAYT_REQ_SEQ_NBR                            06490008
065000                     ,INVC_TYP_CDE                                06500008
065100                     ,ENTR_MTHD_CDE                               06510008
065200                     ,CRE_BY_USR_ID                               06520008
065300                     ,BAR_CDE                                     06530008
065400                     ,SPLIT_TERMS_IND                             06540008
065500                     ,DTL_ENTR_IND                                06550008
065600                     ,INVC_CART_CT                                06560008
065700                     ,CRE_DTE                                     06570008
065800                     ,PPD_RVRSL_IND                               06580008
065900                     ,INVC_DTE                                    06590008
066000                     ,GRO_COST_AMT                                06600008
066100                     ,INVC_NET_COST_AMT                           06610008
066200                     ,RMIT_VND_ID                                 06620008
066300                     ,STR_NBR                                     06630008
066400                     ,HOLD_IND                                    06640008
066500                     ,DUE_DTE_SRC_CDE                             06650008
066600                     ,CALC_DUE_DTE                                06660008
066700                     ,PAYT_DTE                                    06670008
066800                     ,AP_PRC_DTE                                  06680008
066900                     ,AP_PRC_CDE                                  06690008
067000                     ,PAYT_RLSE_TMST                              06700008
067100                     ,STATUS_CDE                                  06710008
067200                     ,STATUS_CHG_TMST                             06720011
067300                     ,DC_NBR                                      06730011
067400                     ,MTCH_LVL_CDE )                              06740011
067500                 VALUES                                           06750008
067600                     (:INVOIC-PO-NBR                              06760008
067700                     ,:INVOIC-INVC-ID                             06770008
067800                     ,:INVOIC-PAYT-REQ-SEQ-NBR                    06780008
067900                     ,:INVOIC-INVC-TYP-CDE                        06790008
068000                     ,:INVOIC-ENTR-MTHD-CDE                       06800008
068100                     ,:INVOIC-CRE-BY-USR-ID                       06810008
068200                     ,:INVOIC-BAR-CDE                             06820008
068300                     ,:INVOIC-SPLIT-TERMS-IND                     06830008
068400                     ,:INVOIC-DTL-ENTR-IND                        06840008
068500                     ,:INVOIC-INVC-CART-CT                        06850008
068600                     ,:INVOIC-CRE-DTE                             06860008
068700                     ,:INVOIC-PPD-RVRSL-IND                       06870008
068800                     ,:INVOIC-INVC-DTE                            06880008
068900                     ,:INVOIC-GRO-COST-AMT                        06890008
069000                     ,:INVOIC-INVC-NET-COST-AMT                   06900008
069100                     ,:INVOIC-RMIT-VND-ID                         06910008
069200                     ,:INVOIC-STR-NBR                             06920008
069300                     ,:INVOIC-HOLD-IND                            06930008
069400                     ,:INVOIC-DUE-DTE-SRC-CDE                     06940008
069500                     ,:INVOIC-CALC-DUE-DTE                        06950008
069600                     ,:INVOIC-PAYT-DTE                            06960008
069700                     ,:INVOIC-AP-PRC-DTE                          06970008
069800                     ,:INVOIC-AP-PRC-CDE                          06980008
069900                     ,:INVOIC-PAYT-RLSE-TMST                      06990008
070000                     ,:INVOIC-STATUS-CDE                          07000008
070100                     , CURRENT TIMESTAMP                          07010011
070200                     ,:INVOIC-DC-NBR                              07020011
070300                     ,:INVOIC-MTCH-LVL-CDE)                       07030011
070400             END-EXEC                                             07040008
070500                                                                  07050008
070600             EVALUATE TRUE                                        07060008
070700                 WHEN SQLCODE = ZERO                              07070008
070800                      SET INSERT-SUCCESSFUL TO TRUE               07080012
070900                 WHEN SQLCODE = -904                              07090008
071000                 WHEN SQLCODE = -913                              07100008
071100                      CONTINUE                                    07110008
071200                                                                  07120008
071300                 WHEN SQLCODE = -803                              07130012
071400                      MOVE WS-INSERT-INVC-RETRY-COUNTER TO        07140012
071500                                    WS-DISPLAY-RETRY-COUNTER      07150012
071600                      DISPLAY 'DUPLICATE INVOIC:'                 07160012
071700                          ' PO: ' INVOIC-PO-NBR                   07170012
071800                          ' INVC ID: ' INVOIC-INVC-ID             07180012
071900                          ' PAYREQ: ' INVOIC-PAYT-REQ-SEQ-NBR     07190012
072000                          ' RETRY#: ' WS-DISPLAY-RETRY-COUNTER    07200012
072100                      PERFORM R200-DETERMINE-PAYT-NBR             07210012
072200                                                                  07220012
072300                 WHEN SQLWARN0 NOT = SPACES                       07230008
072400                 WHEN SQLCODE  NOT = ZERO                         07240008
072500                      MOVE 'I200-INSERT-TINVOIC '                 07250008
072600                                      TO WS-ABEND-PARAGRAPH       07260008
072700                      MOVE 'UNSUCCESSFUL INSERT INVOIC  ROW'      07270008
072800                                      TO WS-ABEND-OPERATION       07280008
072900                      MOVE 'TINVOIC ' TO WS-ABEND-STRUCTURE-1     07290008
073000                      PERFORM Z999-SQL-ERROR                      07300008
073100             END-EVALUATE                                         07310008
073200     END-PERFORM.                                                 07320008
073300                                                                  07330008
073400     IF WS-INSERT-INVC-RETRY-COUNTER > 100                        07340012
073500         MOVE 'I200-INSERT-TINVOIC '                              07350008
073600                         TO WS-ABEND-PARAGRAPH                    07360008
073700         MOVE 'MAX RETRIES EXCEEDED ON INSERT  INVOIC ROW'        07370008
073800                         TO WS-ABEND-OPERATION                    07380008
073900         MOVE 'TINVOIC ' TO WS-ABEND-STRUCTURE-1                  07390008
074000         PERFORM Z999-SQL-ERROR                                   07400008
074100     END-IF.                                                      07410008
074200                                                                  07420008
074300     EVALUATE TRUE                                                07430008
074400        WHEN SQLCODE = ZEROS                                      07440008
074500             CONTINUE                                             07450008
074600        WHEN OTHER                                                07460008
074700             MOVE 'I200-INSERT-TINVOIC           ' TO             07470008
074800                                       WS-ABEND-PARAGRAPH         07480008
074900             MOVE 'UNSUCCESSFUL INSERT  INVOIC ROW'               07490008
075000                             TO WS-ABEND-OPERATION                07500008
075100             MOVE 'TINVOIC ' TO WS-ABEND-STRUCTURE-1              07510008
075200             PERFORM Z999-SQL-ERROR                               07520008
075300     END-EVALUATE.                                                07530008
075400                                                                  07540008
075500                                                                  07550008
075600***************************************************************** 07560008
075700*     INSERT THE EXINVC ROW FOR THIS INVOICE NUMBER               07570008
075800***************************************************************** 07580008
075900 I300-INSERT-EXINVC.                                              07590008
076000                                                                  07600008
076100     PERFORM WITH TEST AFTER                                      07610008
076200             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 07620008
076300             UNTIL   WS-RETRY-COUNTER > WS-MAX-RETRIES OR         07630008
076400                     SQLCODE = ZERO                               07640008
076500                                                                  07650008
076600             EXEC SQL                                             07660008
076700                 INSERT INTO TEXINVC                              07670008
076800                     ( PO_NBR                                     07680008
076900                      ,INVC_ID                                    07690008
077000                      ,IMPRT_ENTR_NBR                             07700008
077100                      ,IMPRT_BOL_ID                               07710008
077200                      ,PAYT_REQ_SEQ_NBR                           07720016
077300                      ,INVC_CONTNR_ID                             07730016
077400                      ,IMPRT_BKR_REF_NBR )                        07740016
077500                 VALUES                                           07750008
077600                     ( :EXINVC-PO-NBR                             07760008
077700                      ,:EXINVC-INVC-ID                            07770008
077800                      ,:EXINVC-IMPRT-ENTR-NBR                     07780008
077900                      ,:EXINVC-IMPRT-BOL-ID                       07790008
078000                      ,:EXINVC-PAYT-REQ-SEQ-NBR                   07800016
078100                      ,:EXINVC-INVC-CONTNR-ID                     07810016
078200                      ,:EXINVC-IMPRT-BKR-REF-NBR )                07820016
078300             END-EXEC                                             07830008
078400                                                                  07840008
078500             EVALUATE TRUE                                        07850008
078600                 WHEN SQLCODE = ZERO                              07860008
078700                 WHEN SQLCODE = -904                              07870008
078800                 WHEN SQLCODE = -913                              07880008
078900                      CONTINUE                                    07890008
079000                                                                  07900008
079100                 WHEN SQLWARN0 NOT = SPACES                       07910008
079200                 WHEN SQLCODE  NOT = ZERO                         07920008
079300                      MOVE 'I300-INSERT-TEXINVC '                 07930008
079400                                      TO WS-ABEND-PARAGRAPH       07940008
079500                      MOVE 'UNSUCCESSFUL INSERT TEXINVC ROW'      07950008
079600                                      TO WS-ABEND-OPERATION       07960008
079700                      MOVE 'TEXINVC ' TO WS-ABEND-STRUCTURE-1     07970008
079800                      PERFORM Z999-SQL-ERROR                      07980008
079900             END-EVALUATE                                         07990008
080000     END-PERFORM.                                                 08000008
080100                                                                  08010008
080200     IF WS-RETRY-COUNTER > WS-MAX-RETRIES                         08020008
080300         MOVE 'I300-INSERT-TEXINVC '                              08030008
080400                         TO WS-ABEND-PARAGRAPH                    08040008
080500         MOVE 'MAX RETRIES EXCEEDED ON INSERT TEXINVC ROW'        08050008
080600                         TO WS-ABEND-OPERATION                    08060008
080700         MOVE 'TEXINVC ' TO WS-ABEND-STRUCTURE-1                  08070008
080800         PERFORM Z999-SQL-ERROR                                   08080008
080900     END-IF.                                                      08090008
081000                                                                  08100008
081100     EVALUATE TRUE                                                08110008
081200        WHEN SQLCODE = ZEROS                                      08120008
081300             CONTINUE                                             08130008
081400        WHEN OTHER                                                08140008
081500             MOVE 'I300-INSERT-TEXINVC           ' TO             08150008
081600                                       WS-ABEND-PARAGRAPH         08160008
081700             MOVE 'UNSUCCESSFUL INSERT TEXINVC ROW'               08170008
081800                             TO WS-ABEND-OPERATION                08180008
081900             MOVE 'TEXINVC ' TO WS-ABEND-STRUCTURE-1              08190008
082000             PERFORM Z999-SQL-ERROR                               08200008
082100     END-EVALUATE.                                                08210008
082200                                                                  08220008
082300                                                                  08230008
082400***************************************************************** 08240008
082500*     INSERT THE INVCTM ROW FOR THIS INVOICE NUMBER               08250008
082600***************************************************************** 08260008
082700 I400-INSERT-INVCTM.                                              08270008
082800                                                                  08280008
082900     PERFORM WITH TEST AFTER                                      08290008
083000             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 08300008
083100             UNTIL   WS-RETRY-COUNTER > WS-MAX-RETRIES OR         08310008
083200                     SQLCODE = ZERO                               08320008
083300                                                                  08330008
083400             EXEC SQL                                             08340008
083500                 INSERT INTO TINVCTM                              08350008
083600                    ( PO_NBR                                      08360008
083700                     ,INVC_ID                                     08370008
083800                     ,TERM_SEQ_NBR                                08380008
083900                     ,TERM_TYP_CDE                                08390008
084000                     ,TERM_BASIS_DTE_CDE                          08400008
084100                     ,EFF_DTE                                     08410008
084200                     ,DISC_PCT                                    08420008
084300                     ,DISC_AMT                                    08430008
084400                     ,DISC_DUE_DTE                                08440008
084500                     ,DISC_DUE_DAY_QTY                            08450008
084600                     ,NET_DUE_DTE                                 08460008
084700                     ,NET_DUE_DAY_QTY                             08470008
084800                     ,EXTD_DAYS_QTY)                              08480008
084900                 VALUES                                           08490008
085000                     (:INVCTM-PO-NBR                              08500008
085100                     ,:INVCTM-INVC-ID                             08510008
085200                     ,:INVCTM-TERM-SEQ-NBR                        08520008
085300                     ,:INVCTM-TERM-TYP-CDE                        08530008
085400                     ,:INVCTM-TERM-BASIS-DTE-CDE                  08540008
085500                     ,:INVCTM-EFF-DTE                             08550008
085600                     ,:INVCTM-DISC-PCT                            08560008
085700                     ,:INVCTM-DISC-AMT                            08570008
085800                     ,:INVCTM-DISC-DUE-DTE                        08580008
085900                     ,:INVCTM-DISC-DUE-DAY-QTY                    08590008
086000                     ,:INVCTM-NET-DUE-DTE                         08600008
086100                     ,:INVCTM-NET-DUE-DAY-QTY                     08610008
086200                     ,:INVCTM-EXTD-DAYS-QTY)                      08620008
086300             END-EXEC                                             08630008
086400                                                                  08640008
086500             EVALUATE TRUE                                        08650008
086600                 WHEN SQLCODE = ZERO                              08660008
086700                 WHEN SQLCODE = -904                              08670008
086800                 WHEN SQLCODE = -913                              08680008
086900                      CONTINUE                                    08690008
087000                                                                  08700008
087100                 WHEN SQLWARN0 NOT = SPACES                       08710008
087200                 WHEN SQLCODE  NOT = ZERO                         08720008
087300                      MOVE 'I400-INSERT-TINVCTM '                 08730008
087400                                      TO WS-ABEND-PARAGRAPH       08740008
087500                      MOVE 'UNSUCCESSFUL INSERT INVCTM  ROW'      08750008
087600                                      TO WS-ABEND-OPERATION       08760008
087700                      MOVE 'TINVCTM ' TO WS-ABEND-STRUCTURE-1     08770008
087800                      PERFORM Z999-SQL-ERROR                      08780008
087900             END-EVALUATE                                         08790008
088000     END-PERFORM.                                                 08800008
088100                                                                  08810008
088200     IF WS-RETRY-COUNTER > WS-MAX-RETRIES                         08820008
088300         MOVE 'I400-INSERT-TINVCTM '                              08830008
088400                         TO WS-ABEND-PARAGRAPH                    08840008
088500         MOVE 'MAX RETRIES EXCEEDED ON INSERT  INVCTM ROW'        08850008
088600                         TO WS-ABEND-OPERATION                    08860008
088700         MOVE 'TINVCTM ' TO WS-ABEND-STRUCTURE-1                  08870008
088800         PERFORM Z999-SQL-ERROR                                   08880008
088900     END-IF.                                                      08890008
089000                                                                  08900008
089100     EVALUATE TRUE                                                08910008
089200        WHEN SQLCODE = ZEROS                                      08920008
089300             CONTINUE                                             08930008
089400        WHEN OTHER                                                08940008
089500             MOVE 'I400-INSERT-TINVCTM           ' TO             08950008
089600                                       WS-ABEND-PARAGRAPH         08960008
089700             MOVE 'UNSUCCESSFUL INSERT  INVCTM ROW'               08970008
089800                             TO WS-ABEND-OPERATION                08980008
089900             MOVE 'TINVCTM ' TO WS-ABEND-STRUCTURE-1              08990008
090000             PERFORM Z999-SQL-ERROR                               09000008
090100     END-EVALUATE.                                                09010008
090200                                                                  09020008
090300                                                                  09030008
090400***************************************************************** 09040008
090500*     INSERT THE ALCHRG ROW FOR THIS INVOICE NUMBER               09050008
090600***************************************************************** 09060008
090700 I500-INSERT-ALCHRG.                                              09070008
090800                                                                  09080008
090900     PERFORM WITH TEST AFTER                                      09090008
091000             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 09100008
091100             UNTIL   WS-RETRY-COUNTER > WS-MAX-RETRIES OR         09110008
091200                     SQLCODE = ZERO                               09120008
091300                                                                  09130008
091400             EXEC SQL                                             09140008
091500                 INSERT INTO TALCHRG                              09150008
091600                    ( PO_NBR                                      09160008
091700                     ,INVC_ID                                     09170008
091800                     ,ALW_CHRG_SEQ_NBR                            09180008
091900                     ,ALW_CHRG_TYP_CDE                            09190008
092000                     ,ALW_CHRG_CDE                                09200008
092100                     ,ALW_CHRG_SER_CDE                            09210008
092200                     ,ALW_CHRG_PCT                                09220008
092300                     ,ALW_CHRG_AMT)                               09230008
092400                 VALUES                                           09240008
092500                     (:ALCHRG-PO-NBR                              09250008
092600                     ,:ALCHRG-INVC-ID                             09260008
092700                     ,:ALCHRG-ALW-CHRG-SEQ-NBR                    09270008
092800                     ,:ALCHRG-ALW-CHRG-TYP-CDE                    09280008
092900                     ,:ALCHRG-ALW-CHRG-CDE                        09290008
093000                     ,:ALCHRG-ALW-CHRG-SER-CDE                    09300008
093100                     ,:ALCHRG-ALW-CHRG-PCT                        09310008
093200                     ,:ALCHRG-ALW-CHRG-AMT)                       09320008
093300             END-EXEC                                             09330008
093400                                                                  09340008
093500             EVALUATE TRUE                                        09350008
093600                 WHEN SQLCODE = ZERO                              09360008
093700                 WHEN SQLCODE = -904                              09370008
093800                 WHEN SQLCODE = -913                              09380008
093900                      CONTINUE                                    09390008
094000                                                                  09400008
094100                 WHEN SQLWARN0 NOT = SPACES                       09410008
094200                 WHEN SQLCODE  NOT = ZERO                         09420008
094300                      MOVE 'I500-INSERT-TALCHRG '                 09430008
094400                                      TO WS-ABEND-PARAGRAPH       09440008
094500                      MOVE 'UNSUCCESSFUL INSERT ALCHRG  ROW'      09450008
094600                                      TO WS-ABEND-OPERATION       09460008
094700                      MOVE 'TALCHRG ' TO WS-ABEND-STRUCTURE-1     09470008
094800                      PERFORM Z999-SQL-ERROR                      09480008
094900             END-EVALUATE                                         09490008
095000     END-PERFORM.                                                 09500008
095100                                                                  09510008
095200     IF WS-RETRY-COUNTER > WS-MAX-RETRIES                         09520008
095300         MOVE 'I500-INSERT-TALCHRG '                              09530008
095400                         TO WS-ABEND-PARAGRAPH                    09540008
095500         MOVE 'MAX RETRIES EXCEEDED ON INSERT  ALCHRG ROW'        09550008
095600                         TO WS-ABEND-OPERATION                    09560008
095700         MOVE 'TALCHRG ' TO WS-ABEND-STRUCTURE-1                  09570008
095800         PERFORM Z999-SQL-ERROR                                   09580008
095900     END-IF.                                                      09590008
096000                                                                  09600008
096100     EVALUATE TRUE                                                09610008
096200        WHEN SQLCODE = ZEROS                                      09620008
096300             CONTINUE                                             09630008
096400        WHEN OTHER                                                09640008
096500             MOVE 'I500-INSERT-TALCHRG           ' TO             09650008
096600                                       WS-ABEND-PARAGRAPH         09660008
096700             MOVE 'UNSUCCESSFUL INSERT  ALCHRG ROW'               09670008
096800                             TO WS-ABEND-OPERATION                09680008
096900             MOVE 'TALCHRG ' TO WS-ABEND-STRUCTURE-1              09690008
097000             PERFORM Z999-SQL-ERROR                               09700008
097100     END-EVALUATE.                                                09710008
097200                                                                  09720008
097300                                                                  09730008
097400***************************************************************** 09740008
097500*     READ THE EDI PRODUCTION FILE INTO WORKING STORAGE COPYBOOK  09750008
097600***************************************************************** 09760008
097700 R100-READ-INPUT.                                                 09770008
097800                                                                  09780008
097900     READ INPUT-FILE INTO AP016-INVOICE-LOAD-RECORD               09790008
098000          AT END                                                  09800008
098100             SET WS-END-OF-INPUT TO TRUE.                         09810008
098200                                                                  09820008
098300     IF WS-NOT-END-OF-INPUT                                       09830008
098400        ADD 1 TO WS-INPUT-COUNT                                   09840008
098500     END-IF.                                                      09850008
098600                                                                  09860008
098700                                                                  09870008
098800***************************************************************** 09880008
098900*     DETERMINE A RANDOM PAYT-REQ-SEQ-NBR                         09890008
099000***************************************************************** 09900008
099100 R200-DETERMINE-PAYT-NBR.                                         09910008
099200                                                                  09920008
099300     PERFORM WITH TEST AFTER                                      09930008
099400             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 09940008
099500             UNTIL   WS-RETRY-COUNTER > 3  OR                     09950008
099600                     SQLCODE = ZERO                               09960008
099700                                                                  09970008
099800             EXEC SQL                                             09980008
099900                 SET  :WS-TIMESTAMP = CURRENT TIMESTAMP           09990008
100000             END-EXEC                                             10000008
100100                                                                  10010008
100200             EVALUATE TRUE                                        10020008
100300                 WHEN SQLCODE = ZERO                              10030008
100400                 WHEN SQLCODE = -904                              10040008
100500                 WHEN SQLCODE = -913                              10050008
100600                      CONTINUE                                    10060008
100700                                                                  10070008
100800                 WHEN SQLWARN0 NOT = SPACES                       10080008
100900                 WHEN SQLCODE  NOT = ZERO                         10090008
101000                      MOVE 'R200-DETERMINE-PAYT-NBR '             10100008
101100                                    TO WS-ABEND-PARAGRAPH         10110008
101200                      MOVE 'UNSUCCESSFUL SET TIMESTAMP'           10120008
101300                                    TO WS-ABEND-OPERATION         10130008
101400                      MOVE SPACES     TO WS-ABEND-STRUCTURE-1     10140008
101500                      MOVE SPACES     TO WS-ABEND-STRUCTURE-2     10150008
101600                      PERFORM Z999-SQL-ERROR                      10160008
101700             END-EVALUATE                                         10170008
101800     END-PERFORM.                                                 10180008
101900                                                                  10190008
102000     IF WS-RETRY-COUNTER > 3                                      10200008
102100         MOVE 'R200-DETERMINE-PAYT-NBR           '                10210008
102200                       TO WS-ABEND-PARAGRAPH                      10220008
102300         MOVE 'MAX RETRIES EXCEEDED ON SET TIMESTAMP'             10230008
102400                         TO WS-ABEND-OPERATION                    10240008
102500         PERFORM Z999-SQL-ERROR                                   10250008
102600     END-IF.                                                      10260008
102700                                                                  10270008
102800     EVALUATE TRUE                                                10280008
102900        WHEN SQLCODE = ZEROS                                      10290008
103000          MOVE WS-MINUTE      TO WS-RND-MINUTE                    10300008
103100          MOVE WS-SECOND      TO WS-RND-SECOND                    10310008
103200          MOVE WS-NANOSEC-1-3 TO WS-RND-NANOSEC-1-3               10320008
103300          MOVE WS-NANOSEC-4-6 TO WS-RND-NANOSEC-4-6               10330008
103400          MOVE WS-RANDOM-KEY  TO WS-RANDOM-KEY-COMP               10340008
103500          MOVE WS-RANDOM-KEY-COMP TO                              10350008
103600                              INVOIC-PAYT-REQ-SEQ-NBR             10360008
103700                              EXINVC-PAYT-REQ-SEQ-NBR             10370008
103800        WHEN SQLCODE NOT = ZEROS                                  10380008
103900             MOVE 'R200-DETERMINE-PAYT-NBR           ' TO         10390008
104000                                       WS-ABEND-PARAGRAPH         10400008
104100             MOVE 'UNSUCCESSFUL SET TIMESTAMP'                    10410008
104200                           TO WS-ABEND-OPERATION                  10420008
104300             MOVE '        ' TO WS-ABEND-STRUCTURE-1              10430008
104400             MOVE SPACES     TO WS-ABEND-STRUCTURE-2              10440008
104500             PERFORM Z999-SQL-ERROR                               10450008
104600     END-EVALUATE.                                                10460008
104700                                                                  10470008
104800                                                                  10480008
104900*----------------------------------------------------------------*10490008
105000*    SELECT CHECKPOINT RESTART CONTROL INFO.                      10500008
105100*----------------------------------------------------------------*10510008
105200 S400-GET-CHECKPOINT-CNTL.                                        10520008
105300                                                                  10530008
105400                                                                  10540008
105500     EXEC SQL                                                     10550008
105600      SELECT CKPT_STAT_CODE                                       10560008
105700       INTO :PV-CKPT-STAT-CODE                                    10570008
105800       FROM TCKRSTCNTL                                            10580008
105900       WHERE PLAN_NAME = :PV-PROGRAM-NAME                         10590008
106000     END-EXEC.                                                    10600008
106100                                                                  10610008
106200     EVALUATE TRUE                                                10620008
106300         WHEN SQLCODE = ZERO                                      10630008
106400             CONTINUE                                             10640008
106500                                                                  10650008
106600         WHEN SQLWARN0 NOT = SPACES                               10660008
106700         WHEN SQLCODE  NOT = ZERO                                 10670008
106800             MOVE 'S400-GET-CHECKPOINT-CNTL'                      10680008
106900                                 TO WS-ABEND-PARAGRAPH            10690008
107000             DISPLAY '******** PLAN_NAME:'                        10700008
107100                      PV-PROGRAM-NAME                             10710008
107200             MOVE 'UNSUCCESSFUL SELECT'                           10720008
107300                                 TO WS-ABEND-OPERATION            10730008
107400             MOVE 'TCKRSTCNTL'   TO WS-ABEND-STRUCTURE-1          10740008
107500             MOVE SPACES         TO WS-ABEND-STRUCTURE-2          10750008
107600             PERFORM Z999-SQL-ERROR                               10760008
107700     END-EVALUATE.                                                10770008
107800                                                                  10780008
107900                                                                  10790008
108000*----------------------------------------------------------------*10800008
108100*    SELECT CHECKPOINT RESTART WORKING STORAGE DESCRIPTION INFO.  10810008
108200*----------------------------------------------------------------*10820008
108300 S500-GET-CHECKPOINT-INFO.                                        10830008
108400                                                                  10840008
108500                                                                  10850008
108600     EXEC SQL                                                     10860008
108700      SELECT WORK_STRG_DESC                                       10870008
108800       INTO :TCKRSTINF-WORK-STRG-DESC                             10880008
108900       FROM TCKRSTINF                                             10890008
109000       WHERE PLAN_NAME = :PV-PROGRAM-NAME                         10900008
109100     END-EXEC.                                                    10910008
109200                                                                  10920008
109300     EVALUATE TRUE                                                10930008
109400         WHEN SQLCODE = ZERO                                      10940008
109500              CONTINUE                                            10950008
109600                                                                  10960008
109700         WHEN SQLWARN0 NOT = SPACES                               10970008
109800         WHEN SQLCODE  NOT = ZERO                                 10980008
109900             MOVE 'S500-GET-CHECKPOINT-INFO'                      10990008
110000                                 TO WS-ABEND-PARAGRAPH            11000008
110100             DISPLAY '******** PLAN_NAME:'                        11010008
110200                      PV-PROGRAM-NAME                             11020008
110300             MOVE 'UNSUCCESSFUL SELECT'                           11030008
110400                                 TO WS-ABEND-OPERATION            11040008
110500             MOVE 'TCKRSTINF'    TO WS-ABEND-STRUCTURE-1          11050008
110600             MOVE SPACES         TO WS-ABEND-STRUCTURE-2          11060008
110700             PERFORM Z999-SQL-ERROR                               11070008
110800     END-EVALUATE.                                                11080008
110900                                                                  11090008
111000                                                                  11100008
111100 S600-SELECT-CONTROL-DATA.                                        11110008
111200                                                                  11120008
111300     EXEC SQL                                                     11130008
111400       SELECT (CASE                                               11140008
111500               WHEN B.DAY_NM = 'SATURDAY'                         11150008
111600                    THEN DATE(A.BTCH_PRC_DTE + 2 DAYS)            11160008
111700                    ELSE DATE(A.BTCH_PRC_DTE + 1 DAY)             11170008
111800               END)                                               11180008
111900         INTO :WS-BTCH-ENTR-DTE                                   11190008
112000         FROM TAPCNTL A                                           11200008
112100            , TDTATTR B                                           11210008
112200        WHERE A.BTCH_PRC_DTE = B.KY_DTE                           11220008
112300     END-EXEC.                                                    11230008
112400                                                                  11240008
112500     EVALUATE TRUE                                                11250008
112600         WHEN SQLCODE = ZEROS                                     11260008
112700              CONTINUE                                            11270008
112800         WHEN OTHER                                               11280008
112900             MOVE 'S600-SELECT-CONTROL-DATA'                      11290008
113000                                 TO WS-ABEND-PARAGRAPH            11300008
113100             MOVE 'UNSUCCESSFUL SELECT'                           11310008
113200                                 TO WS-ABEND-OPERATION            11320008
113300             MOVE 'TAPCNTL'      TO WS-ABEND-STRUCTURE-1          11330008
113400             MOVE 'TDTATTR'      TO WS-ABEND-STRUCTURE-2          11340008
113500             PERFORM Z999-SQL-ERROR                               11350008
113600     END-EVALUATE.                                                11360008
113700 EJECT                                                            11370008
113800*----------------------------------------------------------------*11380008
113900*    UPDATES THE CHECKPOINT RESTART CONTROL TABLE.  THE STATUS   *11390008
114000*    CODE IS SET TO '9' (RUN IN PROGRESS) OR '0' (RUN COMPLETE). *11400008
114100*----------------------------------------------------------------*11410008
114200 U100-UPDATE-TCKRSTCNTL.                                          11420008
114300                                                                  11430008
114400                                                                  11440008
114500     EXEC SQL                                                     11450008
114600         UPDATE TCKRSTCNTL                                        11460008
114700         SET CKPT_STAT_CODE = :PV-CKPT-STAT-CODE                  11470008
114800         WHERE PLAN_NAME    = :PV-PROGRAM-NAME                    11480008
114900     END-EXEC.                                                    11490008
115000                                                                  11500008
115100     EVALUATE TRUE                                                11510008
115200         WHEN SQLCODE = ZERO                                      11520008
115300              CONTINUE                                            11530008
115400                                                                  11540008
115500         WHEN SQLWARN0 NOT = SPACES                               11550008
115600         WHEN SQLCODE  NOT = ZERO                                 11560008
115700             MOVE 'U100-UPDATE-TCKRSTCNTL'                        11570008
115800                                 TO WS-ABEND-PARAGRAPH            11580008
115900             DISPLAY '******** PLAN_NAME:'                        11590008
116000                      PV-PROGRAM-NAME                             11600008
116100             MOVE 'UNSUCCESSFUL UPDATE'                           11610008
116200                                 TO WS-ABEND-OPERATION            11620008
116300             MOVE 'TCKRSTCNTL'   TO WS-ABEND-STRUCTURE-1          11630008
116400             MOVE SPACES         TO WS-ABEND-STRUCTURE-2          11640008
116500             PERFORM Z999-SQL-ERROR                               11650008
116600     END-EVALUATE.                                                11660008
116700                                                                  11670008
116800/                                                                 11680008
116900*----------------------------------------------------------------*11690008
117000*    UPDATES THE CHECKPOINT RESTART INFO TABLE.  THE WORKING     *11700008
117100*    STORAGE DESCRIPTION FIELD IS UPDATED WITH THE CURRENT INPUT *11710008
117200*    FILE RECORD COUNTS AND THE FILE PROCESSOR INDICATOR.         11720008
117300*----------------------------------------------------------------*11730008
117400 U200-UPDATE-TCKRSTINF.                                           11740008
117500                                                                  11750008
117600     MOVE WS-SAVE-RMT-DUN-NBR TO CR-REMIT-TO-DUN-NBR.             11760008
117700     MOVE WS-SAVE-PO-NBR      TO CR-PO-NBR.                       11770008
117800     MOVE WS-SAVE-INVOICE-NBR TO CR-INVC-ID.                      11780008
117900     MOVE WS-TOT-NO-PAY-REQ-ADDED TO CR-TOT-NO-PAY-REQ-ADDED.     11790008
118000     MOVE WS-TOT-GROSS-COST-ADDED TO CR-TOT-GROSS-COST-ADDED.     11800008
118100     MOVE CKPT-RESTART-INFO   TO TCKRSTINF-WORK-STRG-DESC-TEXT.   11810008
118200     MOVE 4022                TO TCKRSTINF-WORK-STRG-DESC-LEN.    11820008
118300                                                                  11830008
118400     EXEC SQL                                                     11840008
118500         UPDATE TCKRSTINF                                         11850008
118600         SET WORK_STRG_DESC   = :TCKRSTINF-WORK-STRG-DESC         11860008
118700         WHERE PLAN_NAME      = :PV-PROGRAM-NAME                  11870008
118800     END-EXEC.                                                    11880008
118900                                                                  11890008
119000     EVALUATE TRUE                                                11900008
119100         WHEN SQLCODE = ZERO                                      11910008
119200              CONTINUE                                            11920008
119300                                                                  11930008
119400         WHEN SQLWARN0 NOT = SPACES                               11940008
119500         WHEN SQLCODE  NOT = ZERO                                 11950008
119600             MOVE 'U200-UPDATE-TCKRSTINF'                         11960008
119700                         TO WS-ABEND-PARAGRAPH                    11970008
119800             DISPLAY '******** PLAN_NAME:'                        11980008
119900                      PV-PROGRAM-NAME                             11990008
120000             MOVE 'UNSUCCESSFUL UPDATE'                           12000008
120100                                 TO WS-ABEND-OPERATION            12010008
120200             MOVE 'TCKRSTINF'    TO WS-ABEND-STRUCTURE-1          12020008
120300             MOVE SPACES         TO WS-ABEND-STRUCTURE-2          12030008
120400             PERFORM Z999-SQL-ERROR                               12040008
120500     END-EVALUATE.                                                12050008
120600                                                                  12060008
120700                                                                  12070008
120800******************************************************************12080008
120900*    WRITE THE DETAIL LINE HEADING                                12090008
121000******************************************************************12100008
121100 W100-TOT-REPORT.                                                 12110008
121200                                                                  12120008
121300     MOVE 1 TO DP132O-REPORT-NUMBER.                              12130008
121400                                                                  12140008
121500     MOVE 1             TO DP132O-PAGE-NUMBER.                    12150008
121600                                                                  12160008
121700     WRITE TOT-LINE FROM DP132O-STANDRD-HEADER-132-COLS           12170008
121800         AFTER ADVANCING PAGE.                                    12180008
121900                                                                  12190008
122000     WRITE TOT-LINE FROM HL-HEADING-LINE1                         12200008
122100         AFTER ADVANCING 3 LINE.                                  12210008
122200                                                                  12220008
122300     WRITE TOT-LINE FROM DETAIL-LINE1                             12230008
122400         AFTER ADVANCING 2 LINE.                                  12240008
122500                                                                  12250008
122600     WRITE TOT-LINE FROM DETAIL-LINE2                             12260008
122700         AFTER ADVANCING 2 LINE.                                  12270008
122800                                                                  12280008
122900                                                                  12290008
123000*----------------------------------------------------------------*12300008
123100*    COMMITS DB2 UPDATES FOR THE PO PROCESSED.                    12310008
123200*----------------------------------------------------------------*12320008
123300 U300-COMMIT.                                                     12330008
123400                                                                  12340008
123500     EXEC SQL                                                     12350008
123600         COMMIT                                                   12360008
123700     END-EXEC.                                                    12370008
123800                                                                  12380008
123900     EVALUATE TRUE                                                12390008
124000         WHEN SQLCODE = ZEROS                                     12400008
124100              CONTINUE                                            12410008
124200         WHEN OTHER                                               12420008
124300             MOVE   'U300-COMMIT'                                 12430008
124400                                 TO WS-ABEND-PARAGRAPH            12440008
124500             MOVE 'UNSUCCESSFUL COMMIT'                           12450008
124600                                 TO WS-ABEND-OPERATION            12460008
124700             MOVE SPACES         TO WS-ABEND-STRUCTURE-1          12470008
124800                                    WS-ABEND-STRUCTURE-2          12480008
124900             PERFORM Z999-SQL-ERROR                               12490008
125000     END-EVALUATE.                                                12500008
125100                                                                  12510008
125200*----------------------------------------------------------------*12520008
125300*    DO THE CHECKPOINT RESTART AND THE COMMIT.                    12530008
125400*----------------------------------------------------------------*12540008
125500 X100-CHECKPOINT-COMMIT.                                          12550008
125600                                                                  12560008
125700     EXEC SQL                                                     12570008
125800       SET :CR-CURR-TMST = CURRENT TIMESTAMP                      12580008
125900     END-EXEC.                                                    12590008
126000                                                                  12600008
126100     EVALUATE TRUE                                                12610008
126200         WHEN SQLCODE = ZERO                                      12620008
126300              CONTINUE                                            12630008
126400                                                                  12640008
126500        WHEN SQLWARN0 NOT = SPACES                                12650008
126600        WHEN SQLCODE  NOT = ZERO                                  12660008
126700            MOVE 'UNSUCCESSFUL SET TMST'                          12670008
126800                                TO WS-ABEND-PARAGRAPH             12680008
126900            PERFORM Z999-SQL-ERROR                                12690008
127000     END-EVALUATE.                                                12700008
127100                                                                  12710008
127200     IF CR-CURR-TMST > CR-NEXT-TMST                               12720008
127300        MOVE PC-IN-PROCESS-CODE      TO PV-CKPT-STAT-CODE         12730008
127400        PERFORM U100-UPDATE-TCKRSTCNTL                            12740008
127500        PERFORM U200-UPDATE-TCKRSTINF                             12750008
127600        PERFORM U300-COMMIT                                       12760008
127700                                                                  12770008
127800        EXEC SQL                                                  12780008
127900         SELECT (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)     12790008
128000          INTO :CR-NEXT-TMST                                      12800008
128100          FROM TCKRSTCNTL                                         12810008
128200          WHERE PLAN_NAME = :PV-PROGRAM-NAME                      12820008
128300        END-EXEC                                                  12830008
128400                                                                  12840008
128500          EVALUATE TRUE                                           12850008
128600              WHEN SQLCODE = ZERO                                 12860008
128700                   CONTINUE                                       12870008
128800                                                                  12880008
128900          WHEN SQLWARN0 NOT = SPACES                              12890008
129000          WHEN SQLCODE  NOT = ZERO                                12900008
129100              MOVE 'UNSUCCESSFUL NEXT TMST'                       12910008
129200                                  TO WS-ABEND-PARAGRAPH           12920008
129300              PERFORM Z999-SQL-ERROR                              12930008
129400       END-EVALUATE                                               12940008
129500     END-IF.                                                      12950008
129600                                                                  12960008
129700                                                                  12970008
129800*----------------------------------------------------------------*12980008
129900*    GET THE RESTART INFO.                                        12990008
130000*----------------------------------------------------------------*13000008
130100 X200-CHECKPOINT-RESTART.                                         13010008
130200                                                                  13020008
130300     PERFORM S500-GET-CHECKPOINT-INFO.                            13030008
130400     MOVE TCKRSTINF-WORK-STRG-DESC-TEXT TO CKPT-RESTART-INFO.     13040008
130500                                                                  13050008
130600     MOVE CR-REMIT-TO-DUN-NBR TO PV-REMIT-TO-DUN-NBR.             13060008
130700     MOVE CR-PO-NBR           TO PV-PO-NBR.                       13070008
130800     MOVE CR-INVC-ID          TO PV-INVC-ID.                      13080008
130900                                                                  13090008
131000     DISPLAY '***********************************************'.   13100008
131100     DISPLAY '** APKUP225 CHECKPOINT RESTART **'.                 13110008
131200     DISPLAY '** CURSOR VENDOR NBR ON RESTART = '                 13120008
131300                                              PV-REMIT-TO-DUN-NBR.13130008
131400     DISPLAY '** CURSOR PO NUMBER ON RESTART  = ' PV-PO-NBR.      13140008
131500     DISPLAY '** CURSOR INVOICE ID ON RESTART = ' PV-INVC-ID.     13150008
131600     DISPLAY '***********************************************'.   13160008
131700                                                                  13170008
131800     PERFORM R100-READ-INPUT                                      13180008
131900           WITH TEST AFTER                                        13190008
132000                UNTIL WS-END-OF-INPUT                             13200008
132100                  OR  AP016-REMIT-TO-DUN-NBR > CR-REMIT-TO-DUN-NBR13210008
132200                  OR (AP016-REMIT-TO-DUN-NBR = CR-REMIT-TO-DUN-NBR13220008
132300                      AND AP016-PO-NBR > CR-PO-NBR)               13230008
132400                  OR (AP016-REMIT-TO-DUN-NBR = CR-REMIT-TO-DUN-NBR13240008
132500                      AND AP016-PO-NBR = CR-PO-NBR                13250008
132600                      AND AP016-INVC-ID > CR-INVC-ID).            13260008
132700                                                                  13270008
132800     MOVE CR-TOT-NO-PAY-REQ-ADDED TO WS-TOT-NO-PAY-REQ-ADDED.     13280008
132900     MOVE CR-TOT-GROSS-COST-ADDED TO WS-TOT-GROSS-COST-ADDED.     13290008
133000                                                                  13300008
133100                                                                  13310008
133200***************************************************************** 13320008
133300*     PROCESS DB2 ABENDS                                          13330008
133400***************************************************************** 13340008
133500 Z999-SQL-ERROR.                                                  13350008
133600                                                                  13360008
133700     CLOSE INPUT-FILE                                             13370008
133800           TOT-REPORT.                                            13380008
133900                                                                  13390008
134000     MOVE WS-PAYT-REQ-LNE-NBR TO WS-PAYT-REQ-LNE-NBR-UNPK.        13400008
134100     DISPLAY 'PO NUMBER        = ' AP016-PO-NBR.                  13410008
134200     DISPLAY 'INVOICE NUMBER   = ' AP016-INVC-ID.                 13420008
134300     DISPLAY 'PAYT REQ SEQ NBR = ' WS-RANDOM-KEY.                 13430008
134400     DISPLAY '*** DB2 ERROR '.                                    13440008
134500     DISPLAY '*** SQL CODE = '  WS-ABEND-SQLCODE.                 13450008
134600     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 13460008
134700     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               13470008
134800     DISPLAY '*** OPERATION = ' WS-ABEND-OPERATION.               13480008
134900     DISPLAY '*** TABLE 1   = ' WS-ABEND-STRUCTURE-1.             13490008
135000     IF WS-ABEND-STRUCTURE-2 > SPACES                             13500008
135100         DISPLAY '*** TABLE 2   = ' WS-ABEND-STRUCTURE-2.         13510008
135200                                                                  13520008
135300     COPY DPPD004.                                                13530008
135400                                                                  13540008
135500     MOVE +4013                    TO ABEND-CODE.                 13550008
135600                                                                  13560008
135700     CALL 'ILBOABN0' USING ABEND-CODE.                            13570008
