000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400 TITLE 'MONITOR TUPLDER TABLE FOR P2L/JWL CARTON UPLOADS'.        00040000
000500*                                                                 00050000
000600 PROGRAM-ID.    PCKUT099.                                         00060000
000700 AUTHOR.        DENISE HAHN.                                      00070000
000800 INSTALLATION.  KOHLS.                                            00080000
000900 DATE-WRITTEN   AUGUST 2007.                                      00090000
001000 DATE-COMPILED.                                                   00100000
001100                                                                  00110000
001200***************************************************************** 00120000
001300*    PROGRAM WILL PULL MESSAGES FROM THE TUPLDER TABLE USING    * 00130000
001400*    THE PREVIOUS RUN TIMESTAMP AND THE CURRENT TIMESTAMP.      * 00140000
001500*    IF MESSAGES ARE FOUND, THEY WILL BE WRITTEN TO A DATASET   * 00150000
001600*    AND THE RETURN CODE WILL BE SET TO 4095, SO THAT THE       * 00160000
001700*    FOLLOWING STEP WILL SEND OUT AN EMAIL.                     * 00170000
001800*                                                               * 00180000
001810*    THE P2L ERRORS BEING MONITORED ARE P2L/JWL TOTES THAT DO   * 00181000
001820*    NOT HAVE A SOURCE OF P2L/JWL.  DC'S ARE ALSO USING THE     * 00182000
001830*    SAME TOTES FOR SMALL PBS CREATING MASTER CONTAINERS.       * 00183000
001840*    SOMETIMES THEY USE THE SAME SML FOR THE MASTER AS FOR      * 00184000
001850*    P2L/JWL.  THIS IS NOT VALID                                * 00185000
001900***************************************************************** 00190000
002000 ENVIRONMENT DIVISION.                                            00200000
002100 INPUT-OUTPUT SECTION.                                            00210000
002200                                                                  00220000
002300 FILE-CONTROL.                                                    00230000
002400                                                                  00240000
002500     SELECT TIMESTAMP-FILE                                        00250000
002600         ASSIGN TO INP01.                                         00260000
002700                                                                  00270000
002800     SELECT ERROR-OUT-FILE                                        00280000
002900         ASSIGN TO OUT01.                                         00290000
003000                                                                  00300000
003100***************************************************************** 00310000
003200 DATA DIVISION.                                                   00320000
003300***************************************************************** 00330000
003400 FILE SECTION.                                                    00340000
003500                                                                  00350000
003600 FD  TIMESTAMP-FILE                                               00360000
003700     RECORDING MODE IS F                                          00370000
003800     BLOCK CONTAINS 0 RECORDS                                     00380000
003900     LABEL RECORDS ARE STANDARD.                                  00390000
004000                                                                  00400000
004100 01  TIMESTAMP-REC                PIC X(80).                      00410000
004200                                                                  00420000
004300 FD  ERROR-OUT-FILE                                               00430000
004400     RECORDING MODE IS F                                          00440000
004500     BLOCK CONTAINS 0 RECORDS                                     00450000
004600     LABEL RECORDS ARE STANDARD.                                  00460000
004700                                                                  00470000
004800 01  ERROR-OUT-RECORD             PIC X(100).                     00480030
004900                                                                  00490000
005000                                                                  00500000
005100***************************************************************** 00510000
005200 WORKING-STORAGE SECTION.                                         00520000
005201                                                                  00520118
005210 01  CC-CONTROL-CARD.                                             00521018
005220     05  CC-OPER-UNT-ID              PIC 9(04)     VALUE ZERO.    00522018
005230     05  FILLER                      PIC X(03)     VALUE SPACES.  00523018
005240     05  CC-FCLTY-NAME               PIC X(20)     VALUE SPACES.  00524018
005300                                                                  00530000
005310 01  DK-DB2-KEYS.                                                 00531018
005320     05  DK-OPER-UNT-ID              PIC S9(04)    VALUE +0       00532018
005330                                                   COMP SYNC.     00533018
005340                                                                  00534018
005400 01  TIMESTAMP-REC-IN.                                            00540000
005500     05  FILLER                       PIC X(1)    VALUE SPACES.   00550000
005600     05  TR-FROM-TIMESTAMP            PIC X(26)   VALUE SPACES.   00560000
005700     05  FILLER                       PIC X(1)    VALUE SPACES.   00570000
005800     05  TR-TO-TIMESTAMP              PIC X(26)   VALUE SPACES.   00580000
005900     05  FILLER                       PIC X(26)   VALUE SPACES.   00590000
006000                                                                  00600000
006100 01  PS-PROGRAM-SWITCHES.                                         00610000
006200     05  PS-EOF-ERROR-CSR-SW          PIC X(01)  VALUE 'N'.       00620000
006300         88  PS-EOF-ERROR-CSR-YES                VALUE 'Y'.       00630000
006400         88  PS-EOF-ERROR-CSR-NO                 VALUE 'N'.       00640000
006410     05  PS-ERROR-WITH-MST-SW         PIC X(01)  VALUE 'N'.       00641067
006420         88  PS-ERROR-WITH-MST-YES               VALUE 'Y'.       00642067
006430         88  PS-ERROR-WITH-MST-NO                VALUE 'N'.       00643067
006500                                                                  00650000
006600 01  PC-PROGRAM-CONSTANTS.                                        00660000
006700     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'PCKUT099'.00670000
006800                                                                  00680000
006900 01  PV-PROGRAM-VARIABLES.                                        00690000
007000     05  PV-PKT-TXT                   PIC X(100) VALUE SPACE.     00700028
007001     05  PV-P2L-NBR                   PIC 9(03)  VALUE ZEROES.    00700136
007002     05  PV-P2L-NBR-R REDEFINES PV-P2L-NBR.                       00700236
007003         10  FILLER                   PIC X(01).                  00700336
007004         10  PV-P2L-NBR-2-3           PIC 9(02).                  00700436
007005                                                                  00700536
007010     05  PV-REC-CNT                   PIC  9(09) VALUE  0.        00701028
007100     05  PV-BAD-TK-CNT                PIC  9(09) VALUE  0.        00710000
007200     05  PV-ERR-CNT                   PIC S9(09) COMP VALUE +0.   00720000
007300     05  PV-THIS-TIMESTAMP            PIC X(26) VALUE SPACES.     00730000
007400     05  PV-LAST-TIMESTAMP            PIC X(26) VALUE SPACES.     00740000
007500     05  PV-SQL-RETURN-CD             PIC -9(04).                 00750000
007600     05  PV-DISPLAY-ERR               PIC -9(04).                 00760000
007700     05  PV-PREV-OPER                 PIC 9(04).                  00770015
007810     05  PV-NULL-IND                  PIC S9(04)  VALUE ZEROS     00781011
007820                                                  COMP SYNC.      00782011
007821     05  PV-WORK-DATE.                                            00782112
007822         10  PV-WORK-CCYY             PIC X(04)  VALUE SPACES.    00782213
007823         10  PV-WORK-MM               PIC X(02)  VALUE SPACES.    00782313
007824         10  PV-WORK-DD               PIC X(02)  VALUE SPACES.    00782413
007825         10  PV-FILLER                PIC X(06)  VALUE SPACES.    00782513
007826                                                                  00782612
007827     05  PV-EDIT-DATE.                                            00782712
007828         10  PV-EDIT-CCYY             PIC X(04)  VALUE SPACES.    00782813
007829         10  PV-EDIT-DASH-1           PIC X(01)  VALUE SPACES.    00782913
007830         10  PV-EDIT-MM               PIC X(02)  VALUE SPACES.    00783013
007831         10  PV-EDIT-DASH-2           PIC X(01)  VALUE SPACES.    00783113
007832         10  PV-EDIT-DD               PIC X(02)  VALUE SPACES.    00783213
007833                                                                  00783312
007834                                                                  00783422
007835     05  PV-SML-CHAR.                                             00783522
007836         10  FILLER                   PIC X(02)  VALUE SPACES.    00783622
007837         10  PV-SML-NUM               PIC 9(18)  VALUE ZEROES.    00783722
007900                                                                  00790000
007901 01  PV-MST-INSTR-01.                                             00790167
007902     05  FILLER                       PIC X(50)   VALUE           00790267
007903         '*                                                 '.    00790367
007904     05  FILLER                       PIC X(50)   VALUE           00790467
007905         '                                                * '.    00790567
007906 01  PV-MST-INSTR-02.                                             00790667
007907     05  FILLER                       PIC X(50)   VALUE           00790767
007908         '* 1   CREATE A NEW MASTER CONTAINER LABEL         '.    00790867
007909     05  FILLER                       PIC X(50)   VALUE           00790967
007910         '                                                  '.    00791067
007911 01  PV-MST-INSTR-03.                                             00791168
007912     05  FILLER                       PIC X(50)   VALUE           00791267
007913         '* 2   ATTACH THE CHILD CARTONS TO THE NEW MASTER C'.    00791367
007914     05  FILLER                       PIC X(50)   VALUE           00791467
007915         'ONTAINER LABEL (CREATED IN                        '.    00791569
007916 01  PV-MST-INSTR-04.                                             00791668
007917     05  FILLER                       PIC X(50)   VALUE           00791767
007918         '*     STEP 1).  THIS IS DONE USING THE RF APPLICAT'.    00791869
007919     05  FILLER                       PIC X(50)   VALUE           00791967
007920         'ION.                                              '.    00792069
007921 01  PV-MST-INSTR-05.                                             00792168
007922     05  FILLER                       PIC X(50)   VALUE           00792267
007923         '* 3   ONCE ALL OF THE CHILD CARTONS ARE MOVED TO T'.    00792367
007924     05  FILLER                       PIC X(50)   VALUE           00792467
007925         'HE NEW MASTER -  LOG INTO PCC.                    '.    00792569
007926 01  PV-MST-INSTR-06.                                             00792668
007927     05  FILLER                       PIC X(50)   VALUE           00792767
007928         '* 4   FROM THE CARTON PANEL, RIGHT CLICK ON THE SM'.    00792867
007929     05  FILLER                       PIC X(50)   VALUE           00792967
007930         'L -  SELECT RESEND                                '.    00793067
007931 01  PV-MST-INSTR-07.                                             00793168
007932     05  FILLER                       PIC X(50)   VALUE           00793267
007933         '*     THIS WILL SEND THE JWL MANIFEST TO CICS     '.    00793367
007934     05  FILLER                       PIC X(50)   VALUE           00793467
007935         '                                                  '.    00793567
007936 01  PV-MST-INSTR-08.                                             00793668
007937     05  FILLER                       PIC X(50)   VALUE           00793767
007938         '*                                                 '.    00793867
007939     05  FILLER                       PIC X(50)   VALUE           00793967
007940         '                                                * '.    00794067
007950                                                                  00795022
008000 01  PV-ABEND-FIELDS.                                             00800000
008100     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00810000
008200     05  PV-ABEND-TABLE               PIC  X(12) VALUE SPACES.    00820000
008300     05  PV-DB2-MESSAGE               PIC  X(50) VALUE SPACES.    00830000
008400     05  PV-ABEND-CODE                PIC S9(04) COMP SYNC        00840000
008500                                                 VALUE +0.        00850000
008600                                                                  00860000
008700 01  HEAD-MSG-00.                                                 00870039
008800     05  FILLER                       PIC X(50)   VALUE           00880040
008801         '* * * * * * * * * * * * * * * * * * * * * * * * * '.    00880140
008802     05  FILLER                       PIC X(50)   VALUE           00880240
008803         '* * * * * * * * * * * * * * * * * * * * * * * * * '.    00880340
008804 01  HEAD-MSG-01.                                                 00880440
008805     05  FILLER                       PIC X(50)   VALUE           00880540
008806         '*                                                 '.    00880640
008807     05  FILLER                       PIC X(50)   VALUE           00880740
008808         '                                                * '.    00880840
008809 01  HEAD-MSG-02.                                                 00880940
008810     05  FILLER                       PIC X(50)   VALUE           00881040
008811         '* ASN - SML HAS ALREADY BEEN USED BY RECEIVING    '.    00881140
008812     05  FILLER                       PIC X(50)   VALUE           00881240
008813         '                                                  '.    00881340
008814 01  HEAD-MSG-03.                                                 00881440
008815     05  FILLER                       PIC X(50)   VALUE           00881540
008816         '* CPK - CASEPACK SPLIT - SML USED FOR VIRTUAL LABE'.    00881640
008817     05  FILLER                       PIC X(50)   VALUE           00881740
008818         'L                                                 '.    00881840
008819 01  HEAD-MSG-04.                                                 00881940
008820     05  FILLER                       PIC X(50)   VALUE           00882040
008821         '* MST - SML HAS ALREADY BEEN USED AS A MASTER CONT'.    00882140
008822     05  FILLER                       PIC X(50)   VALUE           00882240
008823         'AINER                                             '.    00882340
008824 01  HEAD-MSG-05.                                                 00882440
008825     05  FILLER                       PIC X(50)   VALUE           00882540
008826         '*                                                 '.    00882640
008827     05  FILLER                       PIC X(50)   VALUE           00882740
008828         '                                                  '.    00882840
008829 01  HEAD-MSG-06.                                                 00882940
008830     05  FILLER                       PIC X(50)   VALUE           00883040
008831         '* P2L CLOS - SML HAS BEEN CLOSED IN PACK-TO-LIGHT '.    00883140
008832     05  FILLER                       PIC X(50)   VALUE           00883240
008833         '                                                  '.    00883340
008836 01  HEAD-MSG-07.                                                 00883640
008837     05  FILLER                       PIC X(50)   VALUE           00883740
008838         '* P2L OPEN - SML IS CURRENTLY OPEN IN PACK-TO-LIGH'.    00883840
008839     05  FILLER                       PIC X(50)   VALUE           00883940
008840         'T                                                 '.    00884040
008841 01  HEAD-MSG-08.                                                 00884140
008842     05  FILLER                       PIC X(50)   VALUE           00884240
008843         '*                                                 '.    00884340
008844     05  FILLER                       PIC X(50)   VALUE           00884440
008845         '                                                  '.    00884540
008846 01  HEAD-MSG-09.                                                 00884640
008847     05  FILLER                       PIC X(50)   VALUE           00884740
008848         '* * * * * * * * * * * * * * * * * * * * * * * * * '.    00884840
008849     05  FILLER                       PIC X(50)   VALUE           00884940
008850         '* * * * * * * * * * * * * * * * * * * * * * * * * '.    00885040
008851 01  HEADING-OUT.                                                 00885140
008860     05  HEAD-REC                     PIC X(100)  VALUE SPACES.   00886040
008900 01  HEADING-1.                                                   00890001
009000     05  FILLER                       PIC X(04)   VALUE 'OPER'.   00900015
009110     05  FILLER                       PIC X(03)   VALUE SPACES.   00911064
009120     05  FILLER                       PIC X(03)   VALUE 'SML'.    00912015
009200     05  FILLER                       PIC X(17)   VALUE SPACES.   00920064
009300     05  FILLER                       PIC X(09)   VALUE           00930001
009400                                                  'OPEN DATE'.    00940001
009600     05  FILLER                       PIC X(02)   VALUE SPACES.   00960064
009700     05  FILLER                       PIC X(03)   VALUE 'MOD'.    00970001
009800     05  FILLER                       PIC X(01)   VALUE SPACE.    00980064
009900     05  FILLER                       PIC X(03)   VALUE 'SRC'.    00990001
009901     05  FILLER                       PIC X(08)   VALUE SPACES.   00990152
009910     05  FILLER                       PIC X(02)   VALUE SPACES.   00991064
009920     05  FILLER                       PIC X(08)   VALUE           00992001
009921                                                  'CRE DATE'.     00992101
009930     05  FILLER                       PIC X(03)   VALUE SPACES.   00993064
009940     05  FILLER                       PIC X(06)   VALUE 'USERID'. 00994001
009941     05  FILLER                       PIC X(02)   VALUE SPACES.   00994164
009942     05  FILLER                       PIC X(03)   VALUE 'ACT'.    00994253
009950     05  FILLER                       PIC X(01)   VALUE SPACES.   00995059
009980     05  FILLER                       PIC X(09)   VALUE           00998001
009990                                                  'OTBD TRIP'.    00999001
010020     05  FILLER                       PIC X(04)   VALUE SPACES.   01002064
010030     05  FILLER                       PIC X(09)   VALUE SPACES.   01003066
010100                                                                  01010000
010101 01  HEADING-2-E-MAIL.                                            01010126
010102     05  FILLER                       PIC X(04)   VALUE 'OPER'.   01010226
010103     05  FILLER                       PIC X(02)   VALUE SPACES.   01010326
010104     05  FILLER                       PIC X(03)   VALUE 'SML'.    01010426
010105     05  FILLER                       PIC X(26)   VALUE SPACES.   01010529
010106     05  FILLER                       PIC X(05)   VALUE ' OPEN'.  01010631
010108     05  FILLER                       PIC X(05)   VALUE SPACES.   01010831
010109     05  FILLER                       PIC X(03)   VALUE 'MOD'.    01010926
010110     05  FILLER                       PIC X(01)   VALUE ' '.      01011026
010111     05  FILLER                       PIC X(03)   VALUE 'SRC'.    01011126
010112     05  FILLER                       PIC X(18)   VALUE SPACES.   01011264
010116     05  FILLER                       PIC X(06)   VALUE 'USERID'. 01011626
010117     05  FILLER                       PIC X(02)   VALUE '  '.     01011726
010118     05  FILLER                       PIC X(03)   VALUE 'ACT'.    01011853
010119     05  FILLER                       PIC X(02)   VALUE '  '.     01011953
010122     05  FILLER                       PIC X(09)   VALUE           01012226
010123                                                  'OTBD TRIP'.    01012326
010125     05  FILLER                       PIC X(08)   VALUE SPACES.   01012566
010126                                                                  01012626
010127 01  DETAIL-1.                                                    01012701
010128     05  DTL-OPER                     PIC Z(04).                  01012826
010129     05  FILLER                       PIC X(02)   VALUE SPACES.   01012926
010130     05  DTL-SML                      PIC X(20).                  01013001
010131     05  FILLER                       PIC X(01)   VALUE ' '.      01013126
010132     05  DTL-OPEN-DTE                 PIC X(10).                  01013201
010133     05  FILLER                       PIC X(02)   VALUE ' '.      01013365
010134     05  DTL-MOD                      PIC X(02).                  01013465
010135     05  FILLER                       PIC X(01)   VALUE ' '.      01013526
010136     05  DTL-SRC                      PIC X(03).                  01013601
010137     05  FILLER                       PIC X(01)   VALUE ' '.      01013726
010138     05  DTL-MSG                      PIC X(08).                  01013852
010139     05  FILLER                       PIC X(01).                  01013952
010140     05  DTL-CRE-DTE                  PIC X(10).                  01014001
010141     05  FILLER                       PIC X(01)   VALUE ' '.      01014126
010142     05  DTL-CRE-USERID               PIC X(07).                  01014214
010143     05  FILLER                       PIC X(02)   VALUE '  '.     01014353
010144     05  DTL-ACTIVE-IND               PIC X(01).                  01014453
010145     05  FILLER                       PIC X(02)   VALUE '  '.     01014526
010148     05  DTL-OTBND-TRIP               PIC Z(09).                  01014801
010151     05  FILLER                       PIC X(13)   VALUE SPACES.   01015166
010152                                                                  01015201
010160 01  DETAIL-2-E-MAIL.                                             01016026
010170     05  DTL-E-OPER                   PIC Z(04).                  01017026
010180     05  FILLER                       PIC X(02)   VALUE SPACES.   01018026
010190     05  DTL-E-SML                    PIC X(20).                  01019026
010191     05  FILLER                       PIC X(01)   VALUE ' '.      01019126
010192     05  DTL-E-OPEN-DTE               PIC X(10).                  01019226
010193     05  FILLER                       PIC X(02)   VALUE ' '.      01019332
010194     05  DTL-E-MOD                    PIC X(02).                  01019432
010195     05  FILLER                       PIC X(01)   VALUE ' '.      01019526
010196     05  DTL-E-SRC                    PIC X(03).                  01019626
010197     05  FILLER                       PIC X(02)   VALUE '  '.     01019752
010198     05  DTL-E-MSG                    PIC X(08).                  01019862
010199     05  FILLER                       PIC X(02)   VALUE '  '.     01019962
010200     05  DTL-E-CRE-USERID             PIC X(07).                  01020026
010201     05  FILLER                       PIC X(02)   VALUE '  '.     01020126
010202     05  DTL-E-ACTIVE-IND             PIC X(01).                  01020253
010203     05  FILLER                       PIC X(13)   VALUE '  '.     01020353
010206     05  DTL-E-OTBND-TRIP             PIC Z(09).                  01020626
010207     05  FILLER                       PIC X(11)   VALUE SPACES.   01020766
010210                                                                  01021026
010211                                                                  01021101
010220* * * COMMUNICATIONS AREA FOR DB2                                 01022000
010300     EXEC SQL                                                     01030000
010400          INCLUDE SQLCA                                           01040000
010500     END-EXEC.                                                    01050000
010510                                                                  01051001
010600* * * TUPLDER TABLE - UPLOAD ERROR TABLE                          01060000
010700     EXEC SQL                                                     01070000
010800         INCLUDE TUPLDER                                          01080000
010900     END-EXEC.                                                    01090000
011000                                                                  01100000
011010* * * SUT_OTBND_CART- OUTBOUND CARTON TABLE                       01101001
011020     EXEC SQL                                                     01102001
011030         INCLUDE SUT00024                                         01103001
011040     END-EXEC.                                                    01104001
011050                                                                  01105001
011051* * * TDISTHD - DISTRIBUTION HEADER                               01105134
011052     EXEC SQL                                                     01105234
011053         INCLUDE TDISTHD                                          01105334
011054     END-EXEC.                                                    01105434
011060                                                                  01106034
011061* * * TRECITM - RECEIVER ITEM                                     01106134
011062     EXEC SQL                                                     01106234
011063         INCLUDE TRECITM                                          01106334
011064     END-EXEC.                                                    01106434
011065                                                                  01106534
011066* * * TLBVRDA - CASEPACK SPLIT VIRTUAL LABELS                     01106634
011067     EXEC SQL                                                     01106734
011068         INCLUDE TLBVRDA                                          01106834
011069     END-EXEC.                                                    01106934
011070                                                                  01107034
011091                                                                  01109134
011100**DECLARE THE ERROR-REC-CSR                                       01110000
011110*  A - 006 -- CARTON UPLOAD SOURCE OTHER THAN P2L/JWL             01111023
011120*  A - 104 -- BOX OPEN - CARTON ALREADY THERE DIFFERENT SOURCE    01112023
011130*  A - 105 -- BOX OPEN - ON TLBVRDA                               01113023
011140**                                                                01114023
011200     EXEC SQL                                                     01120000
011300          DECLARE ERROR-REC-CSR CURSOR FOR                        01130000
011400           SELECT   UPLD_TRN_CDE                                  01140000
011500                   ,OPER_UNT_ID                                   01150000
011510                   ,PRC_TMST                                      01151001
011600                   ,ERR_CDE                                       01160000
011700                   ,SUBSTR(PKT_TXT,9,92)                          01170010
011710                   ,PKT_TXT                                       01171028
011800             FROM   TUPLDER                                       01180002
011900            WHERE  (                                              01190021
011901                    (UPLD_TRN_CDE  IN ('A')  AND                  01190121
011910                     ERR_CDE       IN ('006'))     OR             01191021
011920                    (UPLD_TRN_CDE  IN ('A')  AND                  01192021
011930                     ERR_CDE       IN ('104'))     OR             01193023
011931                    (UPLD_TRN_CDE  IN ('A')  AND                  01193123
011932                     ERR_CDE       IN ('105'))                    01193223
011940                   )                                              01194019
012000              AND   PRC_TMST       > :TR-FROM-TIMESTAMP           01200002
012100              AND   PRC_TMST      <= :TR-TO-TIMESTAMP             01210002
012200              AND   OPER_UNT_ID    = :DK-OPER-UNT-ID              01220018
012500           ORDER BY UPLD_TRN_CDE                                  01250000
012600                   ,OPER_UNT_ID                                   01260000
012610                   ,PRC_TMST                                      01261001
012700                   ,ERR_CDE                                       01270000
012800     END-EXEC.                                                    01280000
012900                                                                  01290000
013000     COPY DPWS004.                                                01300000
013001                                                                  01300103
013002*  LAYOUT OF RECORD COMING FROM P2L SML UPLOAD                    01300220
013010     COPY PCWS185.                                                01301003
013100                                                                  01310000
013101*  LAYOUT OF RECORD COMING FROM P2L BOX OPEN LABOR EVENT          01310120
013110     COPY PCWS245.                                                01311020
013120                                                                  01312020
013130*    UPLOAD ERROR FORMAT WHEN CARTON ALREADY EXISTS               01313024
013140     COPY PCWS059.                                                01314024
013150                                                                  01315024
013200                                                                  01320000
013300***************************************************************** 01330000
013400 PROCEDURE DIVISION.                                              01340000
013500***************************************************************** 01350000
013600                                                                  01360000
013700     OPEN INPUT  TIMESTAMP-FILE                                   01370000
013800          OUTPUT ERROR-OUT-FILE.                                  01380000
013900                                                                  01390000
013901     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           01390118
013910                                                                  01391018
014000     PERFORM 1000-GET-TIMESTAMP.                                  01400000
014010                                                                  01401018
014020     DISPLAY 'CONTROL CARD ====>  ' CC-CONTROL-CARD.              01402018
014030                                                                  01403018
014040     MOVE CC-OPER-UNT-ID       TO DK-OPER-UNT-ID.                 01404018
014100                                                                  01410000
014200     PERFORM 2000-OPEN-ERROR-CSR.                                 01420000
014300     PERFORM 2010-FETCH-ERROR-CSR.                                01430001
014301                                                                  01430101
014302     IF  PS-EOF-ERROR-CSR-YES                                     01430203
014328         CONTINUE                                                 01432801
014329     ELSE                                                         01432901
014332         WRITE ERROR-OUT-RECORD  FROM HEAD-MSG-01                 01433239
014333                                                                  01433343
014334         MOVE SPACES               TO HEAD-REC                    01433443
014335         DISPLAY HEAD-REC                                         01433543
014336                                                                  01433643
014337         MOVE '* * * ERROR - SML BEING USED IN P2L/JWL IS   '     01433746
014338                                   TO HEAD-REC                    01433843
014339         DISPLAY HEAD-REC                                         01433943
014340         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     01434043
014341                                                                  01434143
014342         MOVE '* * *         ALREADY BEING USED BY ANOTHER  '     01434246
014343                                   TO HEAD-REC                    01434346
014344         DISPLAY HEAD-REC                                         01434446
014345         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     01434546
014346                                                                  01434646
014347         MOVE '* * *         FUNCTION ON THE MAINFRAME/CICS '     01434746
014348                                   TO HEAD-REC                    01434846
014349         DISPLAY HEAD-REC                                         01434946
014350         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     01435046
014351                                                                  01435146
014352         MOVE SPACES               TO HEAD-REC                    01435243
014353         DISPLAY HEAD-REC                                         01435343
014354                                                                  01435446
014355         WRITE ERROR-OUT-RECORD  FROM HEAD-MSG-01                 01435548
014356         MOVE                                                     01435647
014357         '* * *         P2L/JWL SML WILL NOT MANIFEST CORRECTLY'  01435747
014358                                   TO HEAD-REC                    01435847
014359         DISPLAY HEAD-REC                                         01435947
014360         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     01436047
014361                                                                  01436147
014362         MOVE SPACES               TO HEAD-REC                    01436247
014363         DISPLAY HEAD-REC                                         01436347
014364                                                                  01436453
014365         MOVE HEADING-1            TO HEAD-REC                    01436560
014366         DISPLAY HEAD-REC                                         01436660
014367         MOVE SPACES               TO HEAD-REC                    01436760
014368                                                                  01436860
014371         WRITE ERROR-OUT-RECORD  FROM HEAD-MSG-01                 01437153
014372         WRITE ERROR-OUT-RECORD  FROM HEAD-MSG-09                 01437253
014373         WRITE ERROR-OUT-RECORD  FROM HEADING-2-E-MAIL            01437353
014374     END-IF.                                                      01437453
014375                                                                  01437553
014380     PERFORM 2030-PROCESS-CURSOR                                  01438039
014400         UNTIL PS-EOF-ERROR-CSR-YES.                              01440000
014410                                                                  01441001
014420     DISPLAY '        '                                           01442017
014430     MOVE SPACES TO ERROR-OUT-RECORD.                             01443017
014440     WRITE ERROR-OUT-RECORD.                                      01444017
014450                                                                  01445017
014500     PERFORM 2020-CLOSE-ERROR-CSR.                                01450000
014600                                                                  01460000
014800     WRITE ERROR-OUT-RECORD  FROM HEAD-MSG-00.                    01480051
014900     DISPLAY HEAD-REC.                                            01490051
014920                                                                  01492047
014960     WRITE ERROR-OUT-RECORD  FROM HEAD-MSG-01.                    01496051
014961     WRITE ERROR-OUT-RECORD  FROM HEAD-MSG-02.                    01496151
014970     WRITE ERROR-OUT-RECORD  FROM HEAD-MSG-03.                    01497051
014980     WRITE ERROR-OUT-RECORD  FROM HEAD-MSG-04.                    01498051
014990     WRITE ERROR-OUT-RECORD  FROM HEAD-MSG-05.                    01499051
014991     WRITE ERROR-OUT-RECORD  FROM HEAD-MSG-06.                    01499151
014992     WRITE ERROR-OUT-RECORD  FROM HEAD-MSG-07.                    01499251
014993     WRITE ERROR-OUT-RECORD  FROM HEAD-MSG-08.                    01499351
014994     WRITE ERROR-OUT-RECORD  FROM HEAD-MSG-09.                    01499451
015000                                                                  01500000
015010     IF  PS-ERROR-WITH-MST-YES                                    01501067
015011         WRITE ERROR-OUT-RECORD  FROM PV-MST-INSTR-01             01501167
015012         WRITE ERROR-OUT-RECORD  FROM PV-MST-INSTR-02             01501267
015013         WRITE ERROR-OUT-RECORD  FROM PV-MST-INSTR-03             01501367
015014         WRITE ERROR-OUT-RECORD  FROM PV-MST-INSTR-04             01501467
015015         WRITE ERROR-OUT-RECORD  FROM PV-MST-INSTR-05             01501567
015016         WRITE ERROR-OUT-RECORD  FROM PV-MST-INSTR-06             01501667
015017         WRITE ERROR-OUT-RECORD  FROM PV-MST-INSTR-07             01501767
015018         WRITE ERROR-OUT-RECORD  FROM PV-MST-INSTR-08             01501868
015019     END-IF.                                                      01501968
015020                                                                  01502067
015100     CLOSE TIMESTAMP-FILE                                         01510000
015200           ERROR-OUT-FILE.                                        01520000
015300                                                                  01530000
015400*    IF ANY ERRORS WERE FOUND, THEN SET THE RETURN-CODE, SO       01540000
015500*    THAT THE EMAIL WILL GET SENT OUT IN THE NEXT STEP            01550000
015600                                                                  01560000
015700     IF PV-REC-CNT > 0                                            01570000
015800         MOVE 4095 TO RETURN-CODE                                 01580000
015900     END-IF.                                                      01590000
016000                                                                  01600000
016100     GOBACK.                                                      01610000
016200                                                                  01620000
016300***************************************************************** 01630000
016400*  GET THE CURRENT TIMESTAMP                                      01640000
016500***************************************************************** 01650000
016600 1000-GET-TIMESTAMP.                                              01660000
016700                                                                  01670000
016800     READ TIMESTAMP-FILE                                          01680000
016900     INTO TIMESTAMP-REC-IN                                        01690000
017000            AT END                                                01700000
017100               MOVE 'MISSING TIMESTAMP FILE '                     01710000
017110                                TO PV-DB2-MESSAGE                 01711000
017120               MOVE '1000-GET-TIMESTAMP'                          01712000
017130                                TO PV-ABEND-PARAGRAPH             01713000
017140               MOVE 'INP01'     TO PV-ABEND-TABLE                 01714000
017150               PERFORM 9100-SQL-ABEND                             01715000
017160     END-READ.                                                    01716000
017170                                                                  01717000
017180                                                                  01718000
017190     MOVE HEAD-MSG-00                   TO HEAD-REC.              01719044
017300     DISPLAY HEAD-REC.                                            01730000
017400     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        01740000
017500                                                                  01750000
017510                                                                  01751000
017511     MOVE SPACES TO HEAD-REC.                                     01751145
017520     STRING  'FROM DATE - '     TR-FROM-TIMESTAMP                 01752000
017530             '    PCKUT099'                                       01753000
017540                  DELIMITED BY SIZE                               01754000
017550                                      INTO HEAD-REC.              01755000
017560     DISPLAY HEAD-REC.                                            01756000
017570     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        01757000
018000                                                                  01800000
018010     MOVE SPACES TO HEAD-REC.                                     01801045
018100     STRING  'TO DATE   - '     TR-TO-TIMESTAMP                   01810000
018200             '    PCKUT099'                                       01820000
018300                  DELIMITED BY SIZE                               01830000
018400                                      INTO HEAD-REC.              01840000
018500     DISPLAY HEAD-REC.                                            01850000
018600     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        01860000
018700                                                                  01870000
018800                                                                  01880000
018910     MOVE HEAD-MSG-00                   TO HEAD-REC.              01891044
019100     DISPLAY HEAD-REC.                                            01910000
019200     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        01920000
019300                                                                  01930000
019940                                                                  01994000
019950***************************************************************** 01995000
019960*  OPEN THE ERROR REC CURSOR                                      01996000
019970***************************************************************** 01997000
019980 2000-OPEN-ERROR-CSR.                                             01998000
019990                                                                  01999000
020000     SET PS-EOF-ERROR-CSR-NO        TO TRUE.                      02000000
020100                                                                  02010000
020200     EXEC SQL                                                     02020000
020300          OPEN ERROR-REC-CSR                                      02030000
020400     END-EXEC.                                                    02040000
020500                                                                  02050000
020600     EVALUATE TRUE                                                02060000
020700         WHEN SQLCODE = ZERO                                      02070000
020800         WHEN SQLCODE = -904                                      02080000
020900         WHEN SQLCODE = -913                                      02090000
021000         WHEN SQLCODE = -911                                      02100000
021100              CONTINUE                                            02110000
021200         WHEN SQLWARN0 NOT = SPACES                               02120000
021300         WHEN SQLCODE NOT = ZERO                                  02130000
021400             MOVE SQLCODE               TO PV-SQL-RETURN-CD       02140000
021500             STRING 'SQL='                                        02150000
021600                  PV-SQL-RETURN-CD                                02160000
021700                  DELIMITED BY SIZE                               02170000
021800                            INTO PV-DB2-MESSAGE                   02180000
021900             MOVE '2000-OPEN-ERROR-CSR'                           02190000
022000                              TO PV-ABEND-PARAGRAPH               02200000
022100             MOVE 'TUPLDER'   TO PV-ABEND-TABLE                   02210000
022200             PERFORM 9100-SQL-ABEND                               02220000
022300     END-EVALUATE.                                                02230000
022400                                                                  02240000
022500                                                                  02250000
022600***************************************************************** 02260000
022700*  FETCH THE ERROR REC CURSOR RECORDS                             02270000
022800***************************************************************** 02280000
022900 2010-FETCH-ERROR-CSR.                                            02290000
023000                                                                  02300000
023100     EXEC SQL                                                     02310000
023200          FETCH ERROR-REC-CSR                                     02320000
023300          INTO  :UPLDER-UPLD-TRN-CDE                              02330000
023400               ,:UPLDER-OPER-UNT-ID                               02340000
023500               ,:UPLDER-PRC-TMST                                  02350001
023510               ,:UPLDER-ERR-CDE                                   02351001
023600               ,:UPLDER-PKT-TXT                                   02360001
023610               ,:PV-PKT-TXT                                       02361028
023700     END-EXEC.                                                    02370000
023800                                                                  02380000
023900     EVALUATE TRUE                                                02390000
024000         WHEN SQLCODE = ZERO                                      02400000
024100              CONTINUE                                            02410001
024200         WHEN SQLCODE = +100                                      02420000
024300              SET PS-EOF-ERROR-CSR-YES   TO TRUE                  02430000
024400         WHEN SQLCODE = -904                                      02440000
024500         WHEN SQLCODE = -913                                      02450000
024600         WHEN SQLCODE = -911                                      02460000
024700              CONTINUE                                            02470000
024800         WHEN SQLWARN0 NOT = SPACES                               02480000
024900         WHEN SQLCODE NOT = ZERO                                  02490000
025000             MOVE SQLCODE               TO PV-SQL-RETURN-CD       02500000
025100             STRING 'SQL='                                        02510000
025200                  PV-SQL-RETURN-CD                                02520000
025300                  DELIMITED BY SIZE                               02530000
025400                            INTO PV-DB2-MESSAGE                   02540000
025500             MOVE '2010-FETCH-ERROR-CSR'                          02550000
025600                              TO PV-ABEND-PARAGRAPH               02560000
025700             MOVE 'TUPLDER'   TO PV-ABEND-TABLE                   02570000
025800             PERFORM 9100-SQL-ABEND                               02580000
025900     END-EVALUATE.                                                02590000
026000                                                                  02600000
026100                                                                  02610000
026200***************************************************************** 02620000
026300*  CLOSE THE ERROR REC CURSOR                                     02630000
026400***************************************************************** 02640000
026500 2020-CLOSE-ERROR-CSR.                                            02650000
026600                                                                  02660000
026700     EXEC SQL                                                     02670000
026800          CLOSE ERROR-REC-CSR                                     02680000
026900     END-EXEC.                                                    02690000
027000                                                                  02700000
027100     EVALUATE TRUE                                                02710000
027200         WHEN SQLCODE = ZERO                                      02720000
027300         WHEN SQLCODE = -904                                      02730000
027400         WHEN SQLCODE = -913                                      02740000
027500         WHEN SQLCODE = -911                                      02750000
027600             CONTINUE                                             02760000
027700         WHEN SQLWARN0 NOT = SPACES                               02770000
027800         WHEN SQLCODE NOT = ZERO                                  02780000
027900             MOVE SQLCODE               TO PV-SQL-RETURN-CD       02790000
028000             STRING 'SQL='                                        02800000
028100                  PV-SQL-RETURN-CD                                02810000
028200                  DELIMITED BY SIZE                               02820000
028300                            INTO PV-DB2-MESSAGE                   02830000
028400             MOVE '2020-CLOSE-ERROR-CSR'                          02840000
028500                              TO PV-ABEND-PARAGRAPH               02850000
028600             MOVE 'TUPLDER'   TO PV-ABEND-TABLE                   02860000
028700             PERFORM 9100-SQL-ABEND                               02870000
028800     END-EVALUATE.                                                02880000
028900                                                                  02890000
028901                                                                  02890101
028902***************************************************************** 02890201
028903*  PROCESS ERROR CURSOR                                           02890301
028904***************************************************************** 02890401
028910 2030-PROCESS-CURSOR.                                             02891001
028911                                                                  02891120
028912* DMH - 11-07-12 BEGIN                                            02891220
028913     IF  UPLDER-ERR-CDE  = '006'                                  02891320
028914         MOVE  UPLDER-PKT-TXT     TO  PC185-SML-UPLOAD-RECORD     02891420
028915         MOVE  PC185-HDR-SML-NBR  TO  SUT00024-SHIPT-UNT-ID       02891520
028916     ELSE                                                         02891620
028917     IF  UPLDER-ERR-CDE  = '104'  OR                              02891723
028918         UPLDER-ERR-CDE  = '105'                                  02891823
028919         MOVE  PV-PKT-TXT         TO   PC059-UPLOAD-ERROR-RECORD  02891928
028922         MOVE  PC059-BO-BOX-BARCODE  TO  PV-SML-CHAR              02892223
028923         MOVE  PV-SML-NUM            TO  SUT00024-SHIPT-UNT-ID    02892323
028924                                                                  02892426
028925***                                                               02892526
028926***      DISPLAY PC059-UPLOAD-ERROR-RECORD                        02892637
028927***                                                               02892726
028928                                                                  02892826
028929     END-IF                                                       02892922
028930     END-IF.                                                      02893022
028931* DMH - 11-07-12 BEGIN                                            02893122
028932                                                                  02893222
028933     PERFORM 2200-OTBND-CART.                                     02893322
028934     IF  SUT00024-CART-SRC-CDE  =  'P2L'  OR                      02893422
028935         SUT00024-CART-SRC-CDE  =  'JWL'                          02893522
028936         CONTINUE                                                 02893622
028937     ELSE                                                         02893722
028938         PERFORM 2100-PROCESS-RECORD                              02893822
028939     END-IF.                                                      02893922
028940                                                                  02894022
028950     PERFORM 2010-FETCH-ERROR-CSR.                                02895001
029000                                                                  02900000
029010                                                                  02901001
029100***************************************************************** 02910000
029200*  WRITE A ERROR RECORD AND GATHER CARTON INFO                    02920001
029300***************************************************************** 02930000
029400 2100-PROCESS-RECORD.                                             02940001
029500     IF  UPLDER-UPLD-TRN-CDE  =  'A'  AND                         02950023
029710             (UPLDER-ERR-CDE  =  '104'  OR                        02971023
029711              UPLDER-ERR-CDE  =  '105')                           02971123
029712         MOVE PC059-BO-DC-NBR  TO  SUT00024-ORGN-LOC-NBR          02971223
029713     END-IF                                                       02971323
029720                                                                  02972001
029724     IF  SUT00024-ORGN-LOC-NBR  =  PV-PREV-OPER                   02972415
029725         CONTINUE                                                 02972515
029726     ELSE                                                         02972615
029727         DISPLAY '        '                                       02972715
029728         MOVE SPACES TO ERROR-OUT-RECORD                          02972815
029729         WRITE ERROR-OUT-RECORD                                   02972915
029730                                                                  02973015
029731         MOVE SUT00024-ORGN-LOC-NBR  TO  PV-PREV-OPER             02973115
029732     END-IF.                                                      02973215
029733                                                                  02973315
029735     IF  UPLDER-UPLD-TRN-CDE  =  'A'  AND                         02973523
029736         UPLDER-ERR-CDE       =  '006'                            02973625
029740                                                                  02974020
029741         MOVE SUT00024-ORGN-LOC-NBR   TO  DTL-OPER                02974123
029742                                          DTL-E-OPER              02974226
029743         MOVE PC185-HDR-SML-NBR       TO  DTL-SML                 02974326
029744                                          DTL-E-SML               02974426
029745         MOVE PC185-OPEN-DATE-TIME    TO  PV-WORK-DATE            02974526
029746         MOVE PV-WORK-CCYY            TO  PV-EDIT-CCYY            02974626
029747         MOVE '-'                     TO  PV-EDIT-DASH-1          02974726
029748         MOVE PV-WORK-MM              TO  PV-EDIT-MM              02974826
029749         MOVE '-'                     TO  PV-EDIT-DASH-2          02974926
029750         MOVE PV-WORK-DD              TO  PV-EDIT-DD              02975026
029751         MOVE PV-EDIT-DATE            TO  DTL-OPEN-DTE            02975126
029752                                          DTL-E-OPEN-DTE          02975226
029754         MOVE PC185-P2L-MODULE-NBR    TO  PV-P2L-NBR              02975436
029755         MOVE PV-P2L-NBR-2-3          TO  DTL-MOD                 02975565
029756                                          DTL-E-MOD               02975665
029757         MOVE SUT00024-CART-SRC-CDE   TO  DTL-SRC                 02975765
029758                                          DTL-E-SRC               02975865
029759         MOVE SUT00024-CRE-DTE        TO  DTL-CRE-DTE             02975965
029760         MOVE SUT00024-CRE-USR-ID     TO  DTL-CRE-USERID          02976065
029761                                          DTL-E-CRE-USERID        02976165
029763         MOVE SUT00024-OTBND-TRIP-ID  TO  DTL-OTBND-TRIP          02976326
029764                                          DTL-E-OTBND-TRIP        02976426
029765         MOVE SUT00024-ACTV-IND       TO  DTL-ACTIVE-IND          02976526
029766                                          DTL-E-ACTIVE-IND        02976626
029767         MOVE 'P2L CLOSED     '       TO  DTL-MSG                 02976731
029768                                          DTL-E-MSG               02976826
029769                                                                  02976926
029770         DISPLAY DETAIL-1                                         02977023
029780         WRITE ERROR-OUT-RECORD FROM DETAIL-2-E-MAIL              02978026
037300     ELSE                                                         03730023
037310     IF  UPLDER-UPLD-TRN-CDE  =  'A'  AND                         03731023
037320             (UPLDER-ERR-CDE  =  '104'  OR                        03732023
037330              UPLDER-ERR-CDE  =  '105')                           03733023
037341         MOVE PC059-BO-DC-NBR         TO  DTL-OPER                03734123
037342                                          DTL-E-OPER              03734226
037343         MOVE PC059-BO-BOX-BARCODE    TO  DTL-SML                 03734326
037344                                          DTL-E-SML               03734426
037345         MOVE PC059-BO-BOXOPEN-DATE   TO  PV-EDIT-DATE            03734526
037351         MOVE PC059-BO-LOCATION-NM    TO  DTL-MOD                 03735123
037352                                          DTL-E-MOD               03735226
037353         MOVE SUT00024-CART-SRC-CDE   TO  DTL-SRC                 03735326
037354                                          DTL-E-SRC               03735426
037355         MOVE SUT00024-CRE-DTE        TO  DTL-CRE-DTE             03735526
037357         MOVE SUT00024-CRE-USR-ID     TO  DTL-CRE-USERID          03735726
037358                                          DTL-E-CRE-USERID        03735826
037361         MOVE SUT00024-OTBND-TRIP-ID  TO  DTL-OTBND-TRIP          03736126
037362                                          DTL-E-OTBND-TRIP        03736226
037363         MOVE SUT00024-ACTV-IND       TO  DTL-ACTIVE-IND          03736326
037364                                          DTL-E-ACTIVE-IND        03736426
037365         MOVE 'P2L OPEN       '       TO  DTL-MSG                 03736531
037366                                          DTL-E-MSG               03736626
037367         DISPLAY DETAIL-1                                         03736726
037368         WRITE ERROR-OUT-RECORD FROM DETAIL-2-E-MAIL              03736826
037369     END-IF                                                       03736926
037370     END-IF.                                                      03737026
037600                                                                  03760000
037700     IF  DTL-SRC  =  'MST'                                        03770067
037800         SET  PS-ERROR-WITH-MST-YES  TO  TRUE                     03780067
037900     END-IF.                                                      03790067
038000                                                                  03800067
038200     ADD +1         TO PV-REC-CNT.                                03820003
038500                                                                  03850000
038501                                                                  03850101
038502******************************************************************03850201
038503*  GET OUTBOUND CARTON INFORMATION                                03850301
038504******************************************************************03850401
038510 2200-OTBND-CART.                                                 03851001
038600                                                                  03860000
038602**   DISPLAY ' 2200- ' PV-SML-NUM                                 03860238
038603**           '  '      SUT00024-SHIPT-UNT-ID.                     03860338
038604                                                                  03860432
038605     EXEC SQL                                                     03860532
038606          SELECT CART_SRC_CDE                                     03860632
038607               , ORGN_LOC_NBR                                     03860732
038608               , CRE_DTE                                          03860832
038609               , CRE_USR_ID                                       03860932
038610               , MSTR_CART_IND                                    03861032
038611               , OTBND_TRIP_ID                                    03861132
038612               , ACTV_IND                                         03861232
038613            INTO :SUT00024-CART-SRC-CDE                           03861332
038614               , :SUT00024-ORGN-LOC-NBR                           03861432
038615               , :SUT00024-CRE-DTE                                03861532
038616               , :SUT00024-CRE-USR-ID                             03861632
038617               , :SUT00024-MSTR-CART-IND                          03861732
038618               , :SUT00024-OTBND-TRIP-ID :PV-NULL-IND             03861832
038619               , :SUT00024-ACTV-IND                               03861932
038620                                                                  03862032
038621          FROM SUT_OTBND_CART                                     03862132
038622          WHERE SHIPT_UNT_ID  =  :SUT00024-SHIPT-UNT-ID           03862232
038623     END-EXEC.                                                    03862332
038624                                                                  03862432
038625     EVALUATE TRUE                                                03862532
038626         WHEN SQLCODE = ZERO                                      03862632
038627              IF  PV-NULL-IND  =  -1                              03862734
038628                  MOVE ZEROES  TO SUT00024-OTBND-TRIP-ID          03862834
038629              END-IF                                              03862934
038630         WHEN SQLCODE = +100                                      03863032
038633              MOVE SPACES  TO  SUT00024-CART-SRC-CDE              03863334
038634              MOVE ZEROES  TO  SUT00024-ORGN-LOC-NBR              03863434
038635              MOVE SPACES  TO  SUT00024-CRE-DTE                   03863534
038636              MOVE SPACES  TO  SUT00024-CRE-USR-ID                03863634
038637              MOVE 'N'     TO  SUT00024-MSTR-CART-IND             03863734
038638              MOVE ZEROES  TO  SUT00024-OTBND-TRIP-ID             03863834
038640              MOVE SPACES  TO  SUT00024-ACTV-IND                  03864034
038641              PERFORM 2210-CASEPACK-DWNLD                         03864134
038642         WHEN SQLCODE = -904                                      03864233
038643         WHEN SQLCODE = -913                                      03864301
038644         WHEN SQLCODE = -911                                      03864401
038645              CONTINUE                                            03864501
038646         WHEN SQLWARN0 NOT = SPACES                               03864601
038647         WHEN SQLCODE NOT = ZERO                                  03864701
038648             MOVE SQLCODE               TO PV-SQL-RETURN-CD       03864801
038649             STRING 'SQL='                                        03864901
038650                  PV-SQL-RETURN-CD                                03865001
038651                  '  '                                            03865101
038652                  PC185-HDR-SML-NBR                               03865201
038653                  DELIMITED BY SIZE                               03865301
038654                            INTO PV-DB2-MESSAGE                   03865401
038655             MOVE '2200-OTBND-CART'                               03865501
038656                              TO PV-ABEND-PARAGRAPH               03865601
038657             MOVE 'SUT00024'  TO PV-ABEND-TABLE                   03865702
038658             PERFORM 9100-SQL-ABEND                               03865801
038659     END-EVALUATE.                                                03865901
038660                                                                  03866001
038661                                                                  03866101
038662******************************************************************03866234
038663*  WHEN WAS CASEPACK SPLIT DOWNLOADED                             03866334
038664******************************************************************03866434
038665 2210-CASEPACK-DWNLD.                                             03866534
038666                                                                  03866634
038667     MOVE  PC059-BO-BOX-BARCODE   TO  LBVRDA-BRCDE-NBR.           03866738
038668                                                                  03866839
038669***  DISPLAY ' 2210- ' PC059-BO-BOX-BARCODE                       03866939
038670***          '  '      SUT00024-SHIPT-UNT-ID                      03867039
038671***          ' -'      LBVRDA-BRCDE-NBR                           03867139
038672***          '-'.                                                 03867239
038674                                                                  03867438
038675     EXEC SQL                                                     03867538
038679          SELECT A.OPER_UNT_ID                                    03867934
038680               , A.CRE_USR_ID                                     03868034
038690               , DATE(A.CRE_TMST)                                 03869034
038691            INTO                                                  03869134
038692                 :SUT00024-ORGN-LOC-NBR                           03869234
038693               , :SUT00024-CRE-USR-ID                             03869334
038694               , :SUT00024-CRE-DTE                                03869434
038695            FROM                                                  03869534
038696                 TDISTHD A                                        03869634
038697               , TRECITM B                                        03869734
038698               , TLBVRDA C                                        03869834
038699           WHERE                                                  03869934
038700                 C.BRCDE_NBR     = :LBVRDA-BRCDE-NBR              03870037
038701             AND A.ORD_NBR       =  C.PO_NBR                      03870134
038702             AND A.RCVR_SEQ_NBR  =  C.RCVR_SEQ_NBR                03870234
038703             AND A.ORD_NBR       =  B.ORD_NBR                     03870334
038704             AND A.RCVR_SEQ_NBR  =  B.REC_SEQ_NBR                 03870434
038705             AND (                                                03870534
038706                  (A.PREPK_LNE_PRC_CDE  IN ('N',' ')      AND     03870634
038707                   A.ORD_LNE_NBR        =  B.ORD_LNE_NBR  AND     03870734
038708                   A.ORD_LNE_NBR        =  C.PO_LNE_NBR)          03870834
038709                OR                                                03870934
038710                  (A.PREPK_LNE_PRC_CDE  IN ('D')          AND     03871034
038711                   B.PREPK_ID           =  C.PREPK_ID     AND     03871134
038712                   A.ORD_LNE_NBR        =  B.ORD_LNE_NBR)         03871234
038713                 )                                                03871334
038714            WITH UR                                               03871434
038715     END-EXEC.                                                    03871534
038716                                                                  03871634
038717     EVALUATE TRUE                                                03871734
038718         WHEN SQLCODE = ZERO                                      03871834
038719              MOVE 'CPK'   TO  SUT00024-CART-SRC-CDE              03871934
038723              MOVE 'N'     TO  SUT00024-MSTR-CART-IND             03872334
038724              MOVE ZEROES  TO  SUT00024-OTBND-TRIP-ID             03872434
038725              MOVE SPACES  TO  SUT00024-ACTV-IND                  03872534
038729         WHEN SQLCODE = +100                                      03872934
038730              CONTINUE                                            03873034
038731         WHEN SQLCODE = -904                                      03873134
038732         WHEN SQLCODE = -913                                      03873234
038733         WHEN SQLCODE = -911                                      03873334
038734              CONTINUE                                            03873434
038735         WHEN SQLWARN0 NOT = SPACES                               03873534
038736         WHEN SQLCODE NOT = ZERO                                  03873634
038737             MOVE SQLCODE               TO PV-SQL-RETURN-CD       03873734
038738             STRING 'SQL='                                        03873834
038739                  PV-SQL-RETURN-CD                                03873934
038740                  '  '                                            03874034
038741                  PC185-HDR-SML-NBR                               03874134
038742                  DELIMITED BY SIZE                               03874234
038743                            INTO PV-DB2-MESSAGE                   03874334
038744             MOVE '2210-CASEPACK-DWNLD'                           03874434
038745                              TO PV-ABEND-PARAGRAPH               03874534
038746             MOVE 'TDISTHD '  TO PV-ABEND-TABLE                   03874634
038747             PERFORM 9100-SQL-ABEND                               03874734
038748     END-EVALUATE.                                                03874834
038749                                                                  03874934
038750                                                                  03875034
038751                                                                  03875134
038752                                                                  03875234
038760 9100-SQL-ABEND.                                                  03876034
038800******************************************************************03880000
038900*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    03890000
039000*  ERROR OR WARNING CODE OCCURS.                                  03900000
039100******************************************************************03910000
039200     DISPLAY '9100-SQL-ABEND'.                                    03920000
039300     DISPLAY '** ABEND     **'.                                   03930000
039400     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                03940000
039500     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             03950000
039600     DISPLAY '** TABLE     ** = ' PV-ABEND-TABLE.                 03960000
039700     DISPLAY '** MESSAGE   ** = ' PV-DB2-MESSAGE.                 03970000
039800     COPY DPPD004.                                                03980000
039900                                                                  03990000
040000     MOVE +4013                  TO PV-ABEND-CODE.                04000000
040100     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         04010000
040200                                                                  04020000
