000100******************************************************************00010032
000200 IDENTIFICATION DIVISION.                                         00020033
000300******************************************************************00030033
000400 PROGRAM-ID.    SUKUT166.                                         00040033
000500 AUTHOR.        JIM HUNTER.                                       00050033
000600 INSTALLATION.  KOHLS.                                            00060033
000700 DATE-WRITTEN   MARCH, 2017.                                      00070033
000800 DATE-COMPILED.                                                   00080033
000900******************************************************************00090033
001000*   THIS PROGRAM DETERMINES HOW MANY DAYS BACK TO LOOK FOR        00100033
001100*   CARTONS THAT WERE MISLOADED (SHIPPED TO THE WRONG STORE).     00110033
001200*   WHEN MISLOADED CARTONS ARE FOUND, FILES ARE GENERATED TO      00120033
001300*   UPDATE INTRANSIT, ML AND FASHION (SINGLE FILE), AND THE STORE 00130033
001400*   SCAN TABLE.                                                   00140033
001500*   IF ONE STORE IS SCANNING AND THE CARTON IS NOT ATTACHED TO    00150033
001600*   AN OUTBOUND TRIP, THE TRIP ID WILL BE WRITTEN TO A FILE THAT  00160033
001700*   WILL BE USED TO ADD THE CARTON TO THE TRIP ID.                00170033
001800******************************************************************00180033
001900*  07/18/2017    JIM ARENDT        CHG0173485                     00190033
002000*  CHANGED PROGRAM TO RETRIEVE THE BATCH PROCESSING DATE FROM AN  00200033
002100*  INPUT CONTROL CARD INSTEAD OF FROM DB2 TABLE TCOCNTL.          00210033
002200******************************************************************00220033
002300 ENVIRONMENT DIVISION.                                            00230033
002400 CONFIGURATION SECTION.                                           00240033
002500                                                                  00250033
002600 SOURCE-COMPUTER.        IBM-3090.                                00260033
002700 OBJECT-COMPUTER.        IBM-3090.                                00270033
002800                                                                  00280033
002900 INPUT-OUTPUT SECTION.                                            00290033
003000 FILE-CONTROL.                                                    00300033
003100                                                                  00310033
003200     SELECT BATCH-DATE-IN                                         00320033
003300         ASSIGN TO INP01.                                         00330033
003400                                                                  00340033
003500     SELECT INTRANSIT-FILE-OUT                                    00350033
003600         ASSIGN TO OUT01.                                         00360033
003700                                                                  00370033
003800     SELECT ML-FASHION-FILE-OUT                                   00380033
003900         ASSIGN TO OUT02.                                         00390033
004000                                                                  00400033
004100     SELECT CARTON-UPDATE-FILE-OUT                                00410033
004200         ASSIGN TO OUT03.                                         00420033
004300                                                                  00430033
004400     SELECT TRIP-UPDATE-FILE-OUT                                  00440033
004500         ASSIGN TO OUT04.                                         00450033
004600******************************************************************00460033
004700 DATA DIVISION.                                                   00470033
004800 FILE SECTION.                                                    00480033
004900                                                                  00490033
005000 FD  BATCH-DATE-IN                                                00500033
005100     RECORDING MODE IS F                                          00510033
005200     LABEL RECORDS ARE STANDARD                                   00520033
005300     BLOCK CONTAINS 0 RECORDS.                                    00530033
005400                                                                  00540033
005500 01  BATCH-DATE-RECORD-IN               PIC  X(80).               00550033
005600                                                                  00560033
005700 FD  INTRANSIT-FILE-OUT                                           00570033
005800     RECORDING MODE IS F                                          00580033
005900     LABEL RECORDS ARE STANDARD                                   00590033
006000     BLOCK CONTAINS 0 RECORDS.                                    00600033
006100                                                                  00610033
006200 01  INTRANSIT-RECORD-OUT               PIC  X(100).              00620033
006300*                                                                 00630033
006400 FD  ML-FASHION-FILE-OUT                                          00640033
006500     RECORDING MODE IS F                                          00650033
006600     LABEL RECORDS ARE STANDARD                                   00660033
006700     BLOCK CONTAINS 0 RECORDS.                                    00670033
006800                                                                  00680033
006900 01  ML-FASHION-RECORD-OUT              PIC  X(100).              00690033
007000*                                                                 00700033
007100 FD  CARTON-UPDATE-FILE-OUT                                       00710033
007200     RECORDING MODE IS F                                          00720033
007300     LABEL RECORDS ARE STANDARD                                   00730033
007400     BLOCK CONTAINS 0 RECORDS.                                    00740033
007500                                                                  00750033
007600 01  CARTON-UPDATE-RECORD-OUT           PIC  X(100).              00760033
007700*                                                                 00770033
007800 FD  TRIP-UPDATE-FILE-OUT                                         00780033
007900     RECORDING MODE IS F                                          00790033
008000     LABEL RECORDS ARE STANDARD                                   00800033
008100     BLOCK CONTAINS 0 RECORDS.                                    00810033
008200                                                                  00820033
008300 01  TRIP-UPDATE-RECORD-OUT             PIC  X(50).               00830033
008400*                                                                 00840033
008500******************************************************************00850033
008600 WORKING-STORAGE SECTION.                                         00860033
008700******************************************************************00870033
008800******************************************************************00880033
008900*  INTRANSIT OUTPUT FILE                                          00890033
009000******************************************************************00900033
009100     COPY PCRD010.                                                00910033
009200                                                                  00920033
009300******************************************************************00930033
009400*  ML - FASHION OUTPUT FILE                                       00940033
009500******************************************************************00950033
009600     COPY SURD154.                                                00960033
009700                                                                  00970033
009800******************************************************************00980033
009900*  CARTON UPDATE OUTPUT FILE                                      00990033
010000******************************************************************01000033
010100     COPY SURD153.                                                01010033
010200                                                                  01020033
010300******************************************************************01030033
010400*  TRIP UPDATE OUTPUT FILE                                        01040033
010500******************************************************************01050033
010600     COPY SURD043.                                                01060033
010700                                                                  01070033
010800 01  PS-PROGRAM-SWITCHES.                                         01080033
010900     05  PS-END-OF-MISLOAD-CTN-CSR-SW  PIC X(01)    VALUE 'N'.    01090033
011000         88  PS-END-OF-MISLOAD-CTN-CSR              VALUE 'Y'.    01100033
011100         88  PS-NOT-END-OF-MISLOAD-CTN-CSR          VALUE 'N'.    01110033
011200                                                                  01120033
011300     05  PS-STORE-SCANNING-SW          PIC X(01)    VALUE 'N'.    01130033
011400         88  PS-ONE-STORE-NOT-SCANNING              VALUE 'N'.    01140033
011500         88  PS-BOTH-STORES-ARE-SCANNING            VALUE 'S'.    01150033
011600                                                                  01160033
011700     05  PS-ECOM-STORE-SW              PIC X(01)    VALUE 'N'.    01170033
011800         88  PS-NOT-ECOM-STORE                      VALUE 'N'.    01180033
011900         88  PS-ECOM-STORE                          VALUE 'Y'.    01190033
012000                                                                  01200033
012100     05  PS-SCANNING-STORE-SW          PIC X(01)    VALUE 'N'.    01210033
012200         88  PS-NOT-SCANNING-STORE                  VALUE 'N'.    01220033
012300         88  PS-SCANNING-STORE                      VALUE 'Y'.    01230033
012400                                                                  01240033
012500     05  PS-END-OF-CONTROL-SW        PIC  X(01)    VALUE 'N'.     01250033
012600         88  PS-END-OF-CONTROL                     VALUE 'Y'.     01260033
012700         88  PS-NOT-END-OF-CONTROL                 VALUE 'N'.     01270033
012710                                                                  01271035
012720     05  PS-PROCESS-EFC-MISLOAD-SW   PIC  X(01)    VALUE 'N'.     01272035
012730         88  PS-PROCESS-EFC-MISLOAD                VALUE 'Y'.     01273035
012740         88  PS-BYPASS-EFC-MISLOAD                 VALUE 'N'.     01274035
012750     05  PS-RED-RDC-FOUND-SW         PIC  X(01)    VALUE 'N'.     01275038
012760         88  PS-RED-RDC-FOUND-YES                  VALUE 'Y'.     01276038
012770         88  PS-RED-RDC-FOUND-NO                   VALUE 'N'.     01277038
012790     05  PS-CS-CONVRSON-SW           PIC  X(01)    VALUE 'N'.     01279038
012791         88  PS-CS-CONVRSON-YES                    VALUE 'Y'.     01279138
012792         88  PS-CS-CONVRSON-NO                     VALUE 'N'.     01279238
012800                                                                  01280033
012900 01  PV-INPUT-FILE.                                               01290033
013000     05  PIF-RUN-DATE                PIC  X(10) VALUE SPACES.     01300033
013100     05  FILLER                      PIC  X(70) VALUE SPACES.     01310033
013200                                                                  01320033
013220 01  DK-DB2-KEYS.                                                 01322040
013230     05  DK-PO-NBR                       PIC S9(09) COMP SYNC.    01323040
013240     05  DK-STORE-NBR                    PIC S9(04) COMP SYNC.    01324040
013250                                                                  01325040
013300 01  PC-PROGRAM-CONSTANTS.                                        01330033
013400     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'SUKUT166'. 01340033
013500     05  PC-CURRENT-TIMESTAMP        PIC  X(26)    VALUE SPACES.  01350033
013600                                                                  01360033
013700 01  PV-PROGRAM-VARIABLES.                                        01370033
013800     05  PV-PARAGRAPH-NAME            PIC  X(30)    VALUE SPACES. 01380033
013900     05  PV-CARTON-SKUS-FETCHED       PIC  9(9) COMP VALUE ZEROS. 01390033
014000     05  PV-INTRANSIT-WRITE-COUNT     PIC  9(9) COMP VALUE ZEROS. 01400033
014100     05  PV-ML-FASHION-WRITE-COUNT    PIC  9(9) COMP VALUE ZEROS. 01410033
014200     05  PV-CARTON-UPDATE-WRITE-COUNT PIC  9(9) COMP VALUE ZEROS. 01420033
014300     05  PV-TRIP-UPDATE-WRITE-COUNT   PIC  9(9) COMP VALUE ZEROS. 01430033
014400     05  PV-DISPLAY-COUNT             PIC  ZZZ,ZZZ,ZZ9.           01440033
014500     05  PV-DISPLAY-SQLCODE           PIC  +999  VALUE ZEROES.    01450033
014600     05  PV-DISPLAY-STORE             PIC  9999  VALUE ZEROES.    01460033
014700     05  PV-DISPLAY-TRIP-ID           PIC  Z(8)9.                 01470039
014710     05  PV-DISPLAY-PO                PIC  Z(8)9.                 01471039
014800     05  PV-PREV-SHIPT-UNT-ID         PIC S9(18)V VALUE 0 COMP-3. 01480033
014900     05  PV-PREV-STORE                PIC S9(4) COMP VALUE ZEROS. 01490033
015000     05  PV-PREV-TRIP-ID              PIC S9(9) COMP VALUE ZEROS. 01500033
015100     05  PV-FUNC-TXT                  PIC  X(25) VALUE SPACES.    01510033
015110     05  PV-SMPEFC-TXT                PIC  X(25) VALUE SPACES.    01511035
015200     05  PV-MISLOAD-QTY               PIC S9(4)  COMP VALUE +0.   01520033
015300     05  PV-MISLOAD-DATE              PIC  X(10) VALUE SPACES.    01530033
015400     05  PV-DISPLAY-QTY               PIC  +9999.                 01540033
015500     05  PV-E-BUS-IND-NULL-IND        PIC S9(4)  COMP VALUE +0.   01550033
015600     05  PV-TRIP-ID-NULL-IND          PIC S9(4)  COMP VALUE +0.   01560033
015700         88 PV-TRIP-ID-IS-NULL        VALUE -1.                   01570033
015800         88 PV-TRIP-ID-NOT-FOUND      VALUE -1.                   01580033
015810     05  PV-HOLD-PREV-LOC-NBR         PIC S9(04) COMP VALUE +0.   01581038
015830     05  PV-HOLD-PREV-PO-NBR          PIC S9(09) COMP VALUE +0.   01583038
015850     05  PV-USE-LOC-NBR               PIC S9(04) COMP VALUE +0.   01585038
015900                                                                  01590033
016000 01  PV-ABEND-CODE                    PIC S9(04)   VALUE ZERO     01600033
016100                                                   COMP SYNC.     01610033
016200 01  PV-ABEND-FIELDS.                                             01620033
016300     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'SUKUT166'.01630033
016400     05  PV-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    01640033
016500     05  PV-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    01650033
016600     05  PV-ABEND-STRUCTURE-1         PIC X(8)   VALUE SPACES.    01660033
016700     05  PV-ABEND-STRUCTURE-2         PIC X(20)  VALUE SPACES.    01670033
016800     05  PV-ABEND-STRUCTURE-3         PIC X(20)  VALUE SPACES.    01680033
016900     05  PV-ABEND-STATUS              PIC XX     VALUE SPACES.    01690033
017000     05  PV-DB2-OPERATION-MESSAGE-1   PIC X(79)  VALUE SPACES.    01700033
017100     05  PV-DB2-OPERATION-MESSAGE-2   PIC X(79)  VALUE SPACES.    01710033
017200     05  PV-DB2-OPERATION-MESSAGE-3   PIC X(79)  VALUE SPACES.    01720033
017300     05  PV-DB2-OPERATION-MESSAGE-4   PIC X(79)  VALUE SPACES.    01730033
017400*  USED FOR DB2 ERROR MESSAGE BUILDING                            01740033
017500     COPY DPWS004.                                                01750033
017600                                                                  01760033
017700******************************************************************01770033
017800*    COMMUNICATIONS AREA FOR DB2                                  01780033
017900******************************************************************01790033
018000     EXEC SQL                                                     01800033
018100          INCLUDE SQLCA                                           01810033
018200     END-EXEC.                                                    01820033
018300                                                                  01830033
018920******************************************************************01892035
018930*    OUTBOUND STORE SCAN TABLE (SUT_OTBND_STR_SCN)                01893035
018940******************************************************************01894035
018950     EXEC SQL                                                     01895035
018960          INCLUDE SUT00121                                        01896035
018970     END-EXEC.                                                    01897035
019000                                                                  01900033
019100******************************************************************01910033
019200*    XLT_UPC  TABLE                                               01920033
019300******************************************************************01930033
019400     EXEC SQL                                                     01940033
019500          INCLUDE XLT00006                                        01950033
019600     END-EXEC.                                                    01960033
019700                                                                  01970033
019800******************************************************************01980033
019900*    XLT_SKU  TABLE                                               01990033
020000******************************************************************02000033
020100     EXEC SQL                                                     02010033
020200          INCLUDE XLT00003                                        02020033
020300     END-EXEC.                                                    02030033
020400                                                                  02040033
020500******************************************************************02050033
020600*    SUT_OTBND_CART  TABLE                                        02060033
020700******************************************************************02070033
020800     EXEC SQL                                                     02080033
020900          INCLUDE SUT00024                                        02090033
021000     END-EXEC.                                                    02100033
021100                                                                  02110033
021200******************************************************************02120033
021300*    SUT_OTBND_UPC UPC TABLE                                      02130033
021400******************************************************************02140033
021500     EXEC SQL                                                     02150033
021600          INCLUDE SUT00028                                        02160033
021700     END-EXEC.                                                    02170033
021800                                                                  02180033
021900******************************************************************02190033
022000*    OUTBOUND TRAILER TRIP TABLE                                  02200033
022100******************************************************************02210033
022200     EXEC SQL                                                     02220033
022300          INCLUDE TSUOBTR                                         02230033
022400     END-EXEC.                                                    02240033
022500                                                                  02250033
022600******************************************************************02260033
022700*    OUTBOUND TRAILER TRIP STATUS TABLE                           02270033
022800******************************************************************02280033
022900     EXEC SQL                                                     02290033
023000          INCLUDE TSUOBTS                                         02300033
023100     END-EXEC.                                                    02310033
023200                                                                  02320033
023300******************************************************************02330033
023400*    PARAMATER TABLE                                              02340033
023500******************************************************************02350033
023600     EXEC SQL                                                     02360033
023700          INCLUDE TKRPRPM                                         02370033
023800     END-EXEC.                                                    02380033
023900                                                                  02390033
023910******************************************************************02391040
023920*    PO HEADER TABLE                                              02392040
023930******************************************************************02393040
023940     EXEC SQL                                                     02394040
023950          INCLUDE TPURCHS                                         02395040
023960     END-EXEC.                                                    02396040
023961                                                                  02396140
023962******************************************************************02396240
023963*    SEASONAL SET TABLE                                           02396340
023964******************************************************************02396440
023965     EXEC SQL                                                     02396540
023966          INCLUDE TSEASET                                         02396640
023967     END-EXEC.                                                    02396740
023970                                                                  02397040
024000***************************************************************** 02400033
024100*    WST_INTGRTN_TYP TABLE                                        02410033
024200***************************************************************** 02420033
024300     EXEC SQL                                                     02430033
024400          INCLUDE WST00008                                        02440033
024500     END-EXEC.                                                    02450033
024600                                                                  02460033
024700***************************************************************** 02470033
024800*    WST_ATTR_ELEM TABLE                                          02480033
024900***************************************************************** 02490033
025000     EXEC SQL                                                     02500033
025100          INCLUDE WST00009                                        02510033
025200     END-EXEC.                                                    02520033
025300                                                                  02530033
025400***************************************************************** 02540033
025500*    WST_ATTR_DEFN TABLE                                          02550033
025600***************************************************************** 02560033
025700     EXEC SQL                                                     02570033
025800          INCLUDE WST00010                                        02580033
025900     END-EXEC.                                                    02590033
026000                                                                  02600033
026100******************************************************************02610033
026200*    XLT_LOC  TABLE                                               02620033
026300******************************************************************02630033
026400     EXEC SQL                                                     02640033
026500          INCLUDE XLT00010                                        02650033
026600     END-EXEC.                                                    02660033
026700                                                                  02670033
026800                                                                  02680033
026900******************************************************************02690033
027000*    MISLOAD CARTON DETAIL CURSOR                                 02700033
027100******************************************************************02710033
027200     EXEC SQL                                                     02720033
027300         DECLARE MISLOAD-CARTON-CSR  CURSOR  FOR                  02730033
027400           SELECT D.SHIPT_UNT_ID                                  02740033
027500                 ,SUM(A.SHPD_UNT_QTY)                             02750033
027600                 ,A.UPC_NBR                                       02760033
027700                 ,A.TRN_LNE_NBR                                   02770033
027800                 ,A.TRN_NBR                                       02780033
027900                 ,A.RCVR_SEQ_NBR                                  02790033
028000                 ,A.TRN_TYP_CDE                                   02800033
028100                 ,C.SKU_NBR                                       02810033
028200                 ,C.INTR_UPC_ID                                   02820033
028300                 ,D.DEST_LOC_NBR                                  02830033
028400                 ,E.SCN_LOC_NBR                                   02840033
028500                 ,E.SCN_TYP_CDE                                   02850033
028600                 ,E.SCN_OTBND_TRIP_ID                             02860033
028700                 ,E.CRE_TMST                                      02870033
028800                 ,D.OTBND_TRIP_ID                                 02880033
028900                 ,D.CART_SRC_CDE                                  02890033
029000             FROM SUT_OTBND_UPC       A                           02900033
029100                 ,XLT_UPC             B                           02910033
029200                 ,XLT_SKU             C                           02920033
029300                 ,SUT_OTBND_CART      D                           02930033
029400                 ,SUT_OTBND_STR_SCN   E                           02940033
029500            WHERE A.SHIPT_UNT_ID    = D.SHIPT_UNT_ID              02950033
029600              AND D.SHIPT_UNT_ID    = E.SHIPT_UNT_ID              02960033
029700              AND A.UPC_NBR         = B.UPC_NBR                   02970033
029800              AND B.INTR_UPC_ID     = C.INTR_UPC_ID               02980033
029900              AND E.SCN_TYP_CDE    IN ('SSAM','SSSM')             02990033
030000              AND DATE(E.CRE_TMST) <= :PIF-RUN-DATE               03000033
030100              AND D.CART_SRC_CDE   <> 'FXR'                       03010033
030200              AND E.PRCD_IND        = 'N'                         03020033
030300              AND E.ACTV_IND        = 'Y'                         03030033
030400         GROUP BY A.UPC_NBR, A.TRN_LNE_NBR, A.TRN_NBR,            03040033
030500                  A.RCVR_SEQ_NBR, A.TRN_TYP_CDE,                  03050033
030600                  C.SKU_NBR, C.INTR_UPC_ID, D.SHIPT_UNT_ID,       03060033
030700                  D.DEST_LOC_NBR, E.SCN_LOC_NBR, E.SCN_TYP_CDE,   03070033
030800                  E.SCN_OTBND_TRIP_ID, E.CRE_TMST,                03080033
030900                  D.OTBND_TRIP_ID,D.CART_SRC_CDE                  03090033
031000         ORDER BY E.SCN_OTBND_TRIP_ID, D.SHIPT_UNT_ID             03100033
031100        WITH UR                                                   03110033
031200     END-EXEC.                                                    03120033
031300                                                                  03130033
031400                                                                  03140033
031500******************************************************************03150033
031600 PROCEDURE DIVISION.                                              03160033
031700******************************************************************03170033
031800******************************************************************03180033
031900* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     03190033
032000*      PROGRAM.                                                   03200033
032100******************************************************************03210033
032200 0000-PROGRAM-MAINLINE.                                           03220033
032300                                                                  03230033
032400     DISPLAY ' '.                                                 03240033
032500     DISPLAY '***** SUKUT166 STARTED *****'.                      03250033
032600                                                                  03260033
032700     PERFORM 1000-INITIALIZE.                                     03270033
032800                                                                  03280033
032900     IF PV-FUNC-TXT = 'A' OR 'E'                                  03290033
033000         PERFORM 2000-PROCESS-MISLOAD-TRIP-IDS                    03300033
033100     END-IF.                                                      03310033
033200                                                                  03320033
033300     PERFORM 9000-EOJ-ROUTINE.                                    03330033
033400                                                                  03340033
033500     STOP RUN.                                                    03350033
033600                                                                  03360033
033700******************************************************************03370033
033800*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    03380033
033900*  -- OPEN INPUT/OUTPUT FILES                                     03390033
034000*  -- GET CURRENT TIMESTAMP FOR THE OUTPUT INTRANSIT RECORD       03400033
034100*  -- READ TKRPRPM PARM TABLE TO SEE IF STORES ARE SCANNING       03410033
034200*     IF THEY ARE:                                                03420033
034300*     READ THE CURRENT BATCH PROCESS DATE FROM THE TCOCNTL TABLE, 03430033
034400*     GET THE OFFSET DAYS FROM THE TKRPRPM TABLE AND SUBTRACT     03440033
034500*     IT FROM THE BATCH PROCESS DATE TO GET THE PROCESSING DATE   03450033
034600*     TO USE IN DETERMINING MISLOADED CARTONS.                    03460033
034700******************************************************************03470033
034800 1000-INITIALIZE.                                                 03480033
034900                                                                  03490033
035000     OPEN INPUT  BATCH-DATE-IN.                                   03500033
035100     OPEN OUTPUT INTRANSIT-FILE-OUT.                              03510033
035200     OPEN OUTPUT ML-FASHION-FILE-OUT.                             03520033
035300     OPEN OUTPUT CARTON-UPDATE-FILE-OUT.                          03530033
035400     OPEN OUTPUT TRIP-UPDATE-FILE-OUT.                            03540033
035500                                                                  03550033
035600     EXEC SQL                                                     03560033
035700         SET :PC-CURRENT-TIMESTAMP  = CURRENT TIMESTAMP           03570033
035800     END-EXEC.                                                    03580033
035900                                                                  03590033
035910     PERFORM 1150-READ-TKRPRPM-SMPEFC-PARM.                       03591035
036000     PERFORM 1100-READ-TKRPRPM-SCAN-IND.                          03600033
036100                                                                  03610033
036200     IF PV-FUNC-TXT = 'A' OR 'E'                                  03620033
036300         PERFORM 1200-READ-CONTROL-CARD                           03630033
036400     END-IF.                                                      03640033
036500                                                                  03650033
036600                                                                  03660033
036700******************************************************************03670033
036800*  READ PARM TABLE TO DETERMINE IF ALL STORES, NO STORES OR       03680033
036900*  SOME STORES ARE SCANNING.                                      03690033
037000******************************************************************03700033
037100 1100-READ-TKRPRPM-SCAN-IND.                                      03710033
037200                                                                  03720033
037300     EXEC SQL                                                     03730033
037400         SELECT  FUNC_TXT                                         03740033
037500           INTO  :PV-FUNC-TXT                                     03750033
037600           FROM  TKRPRPM                                          03760033
037700          WHERE  LOC_ID            = 90                           03770033
037800            AND  INTFC_SYS_CDE     = 'KHL'                        03780033
037900            AND  SYS_PRC_FUNC_CDE  = 'STRSCN'                     03790033
038000            AND  FUNC_PRC_STAT_CDE = 'AC'                         03800033
038100     END-EXEC.                                                    03810033
038200                                                                  03820033
038300     EVALUATE TRUE                                                03830033
038400         WHEN SQLCODE = ZERO                                      03840033
038500             IF PV-FUNC-TXT = 'A' OR 'E' OR 'N'                   03850033
038600                 DISPLAY 'STORES SCANNING OPTION = ' PV-FUNC-TXT  03860033
038700             ELSE                                                 03870033
038800                 DISPLAY 'PARA 1100-READ-TKRPRPM-SCAN-IND '       03880033
038900                         'FOUND INVALID OPTION (NOT A, E, N)'     03890033
039000                 DISPLAY 'SYS_PRC_FUNC_CDE = STRSCN'              03900033
039100                 DISPLAY 'PV-FUNC-TXT = ' PV-FUNC-TXT             03910033
039200                 DISPLAY 'DEFAULTING TO OPTION E'                 03920033
039300                 MOVE 'E' TO PV-FUNC-TXT                          03930033
039400             END-IF                                               03940033
039500         WHEN SQLCODE = +100                                      03950033
039600                 DISPLAY 'PARA 1100-READ-TKRPRPM-SCAN-IND '       03960033
039700                         'PARM NOT FOUND'                         03970033
039800                 DISPLAY 'SYS_PRC_FUNC_CDE = STRSCN'              03980033
039900                 DISPLAY 'DEFAULTING TO OPTION E'                 03990033
040000                 MOVE 'E' TO PV-FUNC-TXT                          04000033
040100         WHEN OTHER                                               04010033
040200             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          04020033
040300             MOVE  '1100-READ-TKRPRPM-SCAN-IND'                   04030033
040400                                   TO PV-ABEND-PARAGRAPH          04040033
040500             MOVE 'SYS_PRC_FUNC_CDE  = STRSCN'                    04050033
040600                                   TO PV-ABEND-OPERATION          04060033
040700             MOVE 'CHECKING STORE SCAN PARM '                     04070033
040800                                   TO PV-DB2-OPERATION-MESSAGE-1  04080033
040900             MOVE 'TKRPRPM'        TO PV-ABEND-STRUCTURE-1        04090033
041000             PERFORM 9900-DB2-ABEND                               04100033
041100     END-EVALUATE.                                                04110033
041110                                                                  04111035
041120******************************************************************04112035
041130*  READ PARM TABLE TO DETERMINE HOW THE PROGRAM SHOULD PROCESS    04113035
041140*  STORE MISLOADS IF THE STORE ASSOCIATED TO THE CARTON IS AN     04114035
041141*  EFC STORE.                                                     04114135
041150******************************************************************04115035
041160 1150-READ-TKRPRPM-SMPEFC-PARM.                                   04116035
041170                                                                  04117035
041180     EXEC SQL                                                     04118035
041190         SELECT  FUNC_TXT                                         04119035
041191           INTO  :PV-SMPEFC-TXT                                   04119135
041192           FROM  TKRPRPM                                          04119235
041193          WHERE  LOC_ID            = 90                           04119335
041194            AND  INTFC_SYS_CDE     = 'KHL'                        04119435
041195            AND  SYS_PRC_FUNC_CDE  = 'SMPEFC'                     04119535
041196            AND  FUNC_PRC_STAT_CDE = 'AC'                         04119635
041197     END-EXEC.                                                    04119735
041198                                                                  04119835
041199     EVALUATE TRUE                                                04119935
041200         WHEN SQLCODE = ZERO                                      04120035
041201             IF  PV-SMPEFC-TXT = 'N'                              04120135
041202                 SET PS-BYPASS-EFC-MISLOAD TO TRUE                04120235
041203                 DISPLAY 'BYPASS EFC MISLOADS'                    04120335
041205             ELSE                                                 04120535
041206                 IF  PV-SMPEFC-TXT = 'Y'                          04120635
041207                     SET PS-PROCESS-EFC-MISLOAD TO TRUE           04120735
041208                     DISPLAY 'PROCESS EFC MISLOADS'               04120835
041211                 ELSE                                             04121135
041212                     DISPLAY '1150-READ-TKRPRPM-SMPEFC-PARM '     04121235
041213                             'FOUND INVALID OPTION (NOT Y OR N)'  04121335
041214                     DISPLAY 'SYS_PRC_FUNC_CDE = SMPEFC'          04121435
041215                     DISPLAY 'PV-FUNC-TXT = ' PV-SMPEFC-TXT       04121535
041216                     DISPLAY 'DEFAULTING TO OPTION Y'             04121635
041217                     DISPLAY 'PROCESS EFC MISLOADS'               04121735
041218                     SET PS-PROCESS-EFC-MISLOAD TO TRUE           04121835
041219                 END-IF                                           04121935
041220             END-IF                                               04122035
041221         WHEN SQLCODE = +100                                      04122135
041222                 DISPLAY '1150-READ-TKRPRPM-SMPEFC-PARM '         04122235
041223                         'PARM NOT FOUND'                         04122335
041224                 DISPLAY 'SYS_PRC_FUNC_CDE = SMPEFC'              04122435
041225                 DISPLAY 'DEFAULTING TO OPTION Y'                 04122535
041226                 DISPLAY 'PROCESS EFC MISLOADS'                   04122635
041227                 SET PS-PROCESS-EFC-MISLOAD TO TRUE               04122735
041228         WHEN OTHER                                               04122835
041229             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          04122935
041230             MOVE  '1150-READ-TKRPRPM-SMPEFC-PARM'                04123035
041231                                   TO PV-ABEND-PARAGRAPH          04123135
041232             MOVE 'SYS_PRC_FUNC_CDE  = SMPEFC'                    04123235
041233                                   TO PV-ABEND-OPERATION          04123335
041234             MOVE 'CHECKING PROCESS EFC MISLOAD PARM'             04123435
041235                                   TO PV-DB2-OPERATION-MESSAGE-1  04123535
041236             MOVE 'TKRPRPM'        TO PV-ABEND-STRUCTURE-1        04123635
041237             PERFORM 9900-DB2-ABEND                               04123735
041238     END-EVALUATE.                                                04123835
041240                                                                  04124035
041300                                                                  04130033
041400******************************************************************04140033
041500*  READ INPUT CONTROL CARD TO GET THE CURRENT BATCH PROCESSING    04150033
041600*  DATE.                                                          04160033
041700******************************************************************04170033
041800 1200-READ-CONTROL-CARD.                                          04180033
041900                                                                  04190033
042000     READ BATCH-DATE-IN                                           04200033
042100         INTO PV-INPUT-FILE                                       04210033
042200             AT END                                               04220033
042300                 MOVE 'Y' TO PS-END-OF-CONTROL-SW.                04230033
042400                                                                  04240033
042500     IF PS-END-OF-CONTROL                                         04250033
042600         DISPLAY ' '                                              04260033
042700         DISPLAY ' *** NO CONTROL CARD FOUND TO PROCESS ***'      04270033
042800         DISPLAY ' '                                              04280033
042900     ELSE                                                         04290033
043000         DISPLAY 'BATCH PROCESS DATE  = ' PIF-RUN-DATE            04300033
043100     END-IF.                                                      04310033
043200                                                                  04320033
043300                                                                  04330033
043400******************************************************************04340033
043500*  FIND ALL TRIP IDS AS WELL AS THEIR CARTON AND SKU LEVEL        04350033
043600*  INFORMATION WHICH HAVE A STATUS OF 'SSAM' (ASSUMPTIVE MISLOAD) 04360033
043700*  OR 'SSSM' (STORE MISLOAD SCAN) THAT WERE CREATED ON OR BEFORE  04370033
043800*  THE PROCESS DATE DETERMINED IN THE INITIALIZATION PARAGRAPH.   04380033
043900******************************************************************04390033
044000 2000-PROCESS-MISLOAD-TRIP-IDS.                                   04400033
044100                                                                  04410033
044200     SET PS-NOT-END-OF-MISLOAD-CTN-CSR TO TRUE.                   04420033
044300     PERFORM 2100-OPEN-MISLOAD-CARTON-CSR.                        04430033
044400     PERFORM 2200-FETCH-MISLOAD-CARTON-CSR.                       04440033
044500     PERFORM 2300-PROCESS-MISLOAD-CTN-CSR UNTIL                   04450033
044600             PS-END-OF-MISLOAD-CTN-CSR.                           04460033
044700     PERFORM 2400-CLOSE-MISLOAD-CARTON-CSR.                       04470033
044800                                                                  04480033
044900                                                                  04490033
045000******************************************************************04500033
045100*  OPEN MISLOADED CARTONS CURSOR.                                 04510033
045200******************************************************************04520033
045300 2100-OPEN-MISLOAD-CARTON-CSR.                                    04530033
045400                                                                  04540033
045500     EXEC SQL                                                     04550033
045600         OPEN MISLOAD-CARTON-CSR                                  04560033
045700     END-EXEC.                                                    04570033
045800                                                                  04580033
045900     EVALUATE TRUE                                                04590033
046000         WHEN SQLCODE = ZERO                                      04600033
046100             CONTINUE                                             04610033
046200         WHEN OTHER                                               04620033
046300             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          04630033
046400             MOVE  '2100-OPEN-MISLOAD-CARTON-CSR '                04640033
046500                                   TO PV-ABEND-PARAGRAPH          04650033
046600             MOVE 'OPEN CURSOR '                                  04660033
046700                                   TO PV-ABEND-OPERATION          04670033
046800             MOVE 'SUT_OTBND_STR_SCN'                             04680033
046900                                   TO PV-ABEND-STRUCTURE-1        04690033
047000             PERFORM 9900-DB2-ABEND                               04700033
047100     END-EVALUATE.                                                04710033
047200                                                                  04720033
047300                                                                  04730033
047400******************************************************************04740033
047500*  FETCH MISLOADED CARTON CURSOR ROW.                             04750033
047600******************************************************************04760033
047700 2200-FETCH-MISLOAD-CARTON-CSR.                                   04770033
047800     EXEC SQL                                                     04780033
047900        FETCH MISLOAD-CARTON-CSR                                  04790033
048000         INTO  :SUT00024-SHIPT-UNT-ID                             04800033
048100             , :SUT00028-SHPD-UNT-QTY                             04810033
048200             , :SUT00028-UPC-NBR                                  04820033
048300             , :SUT00028-TRN-LNE-NBR                              04830033
048400             , :SUT00028-TRN-NBR                                  04840033
048500             , :SUT00028-RCVR-SEQ-NBR                             04850033
048600             , :SUT00028-TRN-TYP-CDE                              04860033
048700             , :XLT00003-SKU-NBR                                  04870033
048800             , :XLT00003-INTR-UPC-ID                              04880033
048900             , :SUT00024-DEST-LOC-NBR                             04890033
049000             , :SUT00121-SCN-LOC-NBR                              04900033
049100             , :SUT00121-SCN-TYP-CDE                              04910033
049200             , :SUT00121-SCN-OTBND-TRIP-ID                        04920033
049300             , :SUT00121-CRE-TMST                                 04930033
049400             , :SUT00024-OTBND-TRIP-ID :PV-TRIP-ID-NULL-IND       04940033
049500             , :SUT00024-CART-SRC-CDE                             04950033
049600     END-EXEC.                                                    04960033
049700                                                                  04970033
049800     EVALUATE TRUE                                                04980033
049900         WHEN SQLCODE = ZERO                                      04990033
050000             ADD +1 TO PV-CARTON-SKUS-FETCHED                     05000033
050100             IF PV-TRIP-ID-IS-NULL                                05010033
050200                 MOVE ZEROES  TO  SUT00024-OTBND-TRIP-ID          05020033
050300             END-IF                                               05030033
050400         WHEN SQLCODE = +100                                      05040033
050500             SET PS-END-OF-MISLOAD-CTN-CSR TO TRUE                05050033
050600         WHEN OTHER                                               05060033
050700             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          05070033
050800             MOVE  '2200-FETCH-MISLOAD-CARTON-CSR'                05080033
050900                                   TO PV-ABEND-PARAGRAPH          05090033
051000             MOVE 'FETCH CURSOR '                                 05100033
051100                                   TO PV-ABEND-OPERATION          05110033
051200             MOVE 'SUT_OTBND_STR_SCN'                             05120033
051300                                   TO PV-ABEND-STRUCTURE-1        05130033
051400             PERFORM 9900-DB2-ABEND                               05140033
051500     END-EVALUATE.                                                05150033
051600                                                                  05160033
051700******************************************************************05170033
051800*  PROCESS MISLOADED CARTON CURSOR ROW.                           05180033
051900*  ECOM AND SCANNING CHECKS ARE PERFORMED AGAINST THE STORE THAT  05190033
052000*        THE TRIP ID WAS SUPPOSED TO BE RECEIVED AT.              05200033
052100*  IF THE CARTON IS NOT ATTACHED TO A TRIP, ECOM AND STORE        05210033
052200*        SCANNING CHECKS SHOULD BE BYPASSED BECAUSE THERE IS NOT  05220033
052300*        AN EXPECTED DESTINATION STORE NUMBER TO CHECK AGAINST.   05230033
052400*  CHECK FOR AN ECOM STORE ON A BREAK IN TRIP OR STORE.           05240033
052500*  SKIP RECORDS WHERE THE SHIP TO STORE IS AN ECOM STORE.         05250033
052600*  CHECK IF THE STORE THAT WAS SUPPOSED TO RECEIVE THE CARTONS IS 05260033
052700*        A SCANNING STORE ON A BREAK IN TRIP OR STORE.            05270033
052800*  CHECK IF THE STORE ASSOCIATED TO THE CARTON IS AN EFC LOCATION 05280035
052810*  AND IF IT IS, CHECK THE SMPEFC PARM VALUE TO SEE IF THE        05281035
052820*  MISLOAD SHOULD BE PROCESSED OR NOT.                            05282035
052900******************************************************************05290033
053000 2300-PROCESS-MISLOAD-CTN-CSR.                                    05300033
053100                                                                  05310033
053110     PERFORM 5000-CHECK-IF-RED-MDSE.                              05311038
053120                                                                  05312037
053200     IF PV-TRIP-ID-NOT-FOUND                                      05320033
053300         PERFORM 4000-PROCESS-OUTPUT-FILES                        05330033
053400     ELSE                                                         05340033
053500         IF SUT00024-DEST-LOC-NBR  NOT = PV-PREV-STORE            05350033
053600             PERFORM 3400-CHECK-STORE                             05360035
053700         END-IF                                                   05370033
053800         IF  PS-ECOM-STORE                                        05380035
053810         AND PS-BYPASS-EFC-MISLOAD                                05381035
053900**           BYPASS ALL CARTONS GOING TO ECOM STORES              05390033
054000             CONTINUE                                             05400033
054100         ELSE                                                     05410033
054200             IF PV-FUNC-TXT = 'A'                                 05420033
054300**               ALL STORES ARE SCANNING                          05430033
054400                 SET PS-BOTH-STORES-ARE-SCANNING  TO TRUE         05440033
054500             ELSE                                                 05450033
054600**               EXCEPTION STORES ARE SCANNING ('E')              05460033
054700                 IF SUT00024-DEST-LOC-NBR  NOT = PV-PREV-STORE    05470033
054800                 OR SUT00024-OTBND-TRIP-ID NOT = PV-PREV-TRIP-ID  05480033
054900                     PERFORM 3500-CHECK-IF-SCANNING-STORE         05490033
055000                 END-IF                                           05500033
055100                 IF PS-SCANNING-STORE                             05510033
055200                     SET PS-BOTH-STORES-ARE-SCANNING  TO TRUE     05520033
055300                 ELSE                                             05530033
055400                     SET PS-ONE-STORE-NOT-SCANNING    TO TRUE     05540033
055500                 END-IF                                           05550033
055600             END-IF                                               05560033
055700             PERFORM 4000-PROCESS-OUTPUT-FILES                    05570033
055800         END-IF                                                   05580033
055900     END-IF.                                                      05590033
056000                                                                  05600033
056100     MOVE SUT00024-DEST-LOC-NBR   TO  PV-PREV-STORE.              05610033
056200     MOVE SUT00024-OTBND-TRIP-ID  TO  PV-PREV-TRIP-ID.            05620033
056300                                                                  05630033
056400     PERFORM 2200-FETCH-MISLOAD-CARTON-CSR.                       05640033
056500                                                                  05650033
056600                                                                  05660033
056700******************************************************************05670033
056800*  CLOSE MISLOADED CARTON CURSOR.                                 05680033
056900******************************************************************05690033
057000 2400-CLOSE-MISLOAD-CARTON-CSR.                                   05700033
057100     EXEC SQL                                                     05710033
057200        CLOSE MISLOAD-CARTON-CSR                                  05720033
057300     END-EXEC.                                                    05730033
057400                                                                  05740033
057500     EVALUATE TRUE                                                05750033
057600         WHEN SQLCODE = ZERO                                      05760033
057700             CONTINUE                                             05770033
057800         WHEN OTHER                                               05780033
057900             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          05790033
058000             MOVE  '2400-CLOSE-MISLOAD-CARTON-CSR'                05800033
058100                                   TO PV-ABEND-PARAGRAPH          05810033
058200             MOVE 'CLOSE CURSOR '                                 05820033
058300                                   TO PV-ABEND-OPERATION          05830033
058400             MOVE 'SUT_OTBND_STR_SCN'                             05840033
058500                                   TO PV-ABEND-STRUCTURE-1        05850033
058600             PERFORM 9900-DB2-ABEND                               05860033
058700     END-EVALUATE.                                                05870033
058800                                                                  05880033
058900                                                                  05890033
059300                                                                  05930038
059301******************************************************************05930137
059302*  RETRIEVE THE LOCATION TYPE CODE AND THE E BUSINESS INDICATOR   05930237
059303*  FOR THE STORE THAT THE CARTON WAS BUILT FOR.                   05930337
059304******************************************************************05930437
059310 3400-CHECK-STORE.                                                05931035
059400                                                                  05940033
059500     MOVE SUT00024-DEST-LOC-NBR      TO PV-DISPLAY-TRIP-ID.       05950033
059600                                                                  05960033
059700     EXEC SQL                                                     05970033
059800        SELECT  E_BUS_IND                                         05980033
059810             ,  LOC_TYP_CDE                                       05981033
059900          INTO :XLT00010-E-BUS-IND :PV-E-BUS-IND-NULL-IND         05990033
059910             , :XLT00010-LOC-TYP-CDE                              05991033
060000          FROM  XLT_LOC                                           06000033
060100         WHERE  LOC_NBR      = :SUT00024-DEST-LOC-NBR             06010033
060200         WITH UR                                                  06020033
060300     END-EXEC.                                                    06030033
060400                                                                  06040033
060500     EVALUATE TRUE                                                06050033
060600         WHEN SQLCODE = ZERO                                      06060033
060700            IF PV-E-BUS-IND-NULL-IND = -1                         06070033
060800                SET PS-NOT-ECOM-STORE TO TRUE                     06080033
060900            ELSE                                                  06090033
061000              IF XLT00010-E-BUS-IND = 'Y'                         06100033
061100                  SET PS-ECOM-STORE     TO TRUE                   06110033
061200              ELSE                                                06120033
061300                  SET PS-NOT-ECOM-STORE TO TRUE                   06130033
061400              END-IF                                              06140033
061500            END-IF                                                06150033
061600         WHEN SQLCODE = +100                                      06160033
061700              SET PS-NOT-ECOM-STORE     TO TRUE                   06170033
061710              MOVE '  '                 TO XLT00010-LOC-TYP-CDE   06171033
061800         WHEN SQLWARN0 NOT = SPACES                               06180033
061900         WHEN SQLCODE < ZERO                                      06190033
062000         WHEN SQLCODE > ZERO                                      06200033
062100             MOVE SQLCODE         TO PV-DISPLAY-SQLCODE           06210033
062200             MOVE '3400-CHECK-STORE'                              06220035
062300                                   TO PV-ABEND-PARAGRAPH          06230033
062400             MOVE 'SELECT XLT_LOC TABLE '                         06240033
062500                                   TO PV-ABEND-OPERATION          06250033
062600             MOVE 'STORE BEING PROCESSED: '                       06260033
062700                                   TO PV-DB2-OPERATION-MESSAGE-1  06270033
062800             MOVE SUT00024-DEST-LOC-NBR TO PV-DISPLAY-STORE       06280033
062900             MOVE PV-DISPLAY-STORE TO PV-DB2-OPERATION-MESSAGE-2  06290033
063000             MOVE  'CHECK TO SEE STORE IS AN ECOM STORE'          06300033
063100                                   TO PV-DB2-OPERATION-MESSAGE-3  06310033
063200             MOVE 'XLT_LOC     '   TO PV-ABEND-STRUCTURE-1        06320033
063300             PERFORM 9900-DB2-ABEND                               06330033
063400     END-EVALUATE.                                                06340033
063500                                                                  06350033
063600                                                                  06360033
063700******************************************************************06370033
063800*  CHECK IF SCANNING HAS BEEN TURNED ON FOR THE STORE.            06380033
063900******************************************************************06390033
064000 3500-CHECK-IF-SCANNING-STORE.                                    06400033
064100                                                                  06410033
064200     MOVE SUT00024-DEST-LOC-NBR   TO PV-DISPLAY-STORE.            06420033
064300     MOVE SUT00024-OTBND-TRIP-ID  TO PV-DISPLAY-TRIP-ID.          06430033
064400                                                                  06440033
064500     EXEC SQL                                                     06450033
064600        SELECT  E.OTBND_STAT_TMST                                 06460033
064700             ,  F.DEST_OPER_UNT_ID                                06470033
064800          INTO :SUOBTS-OTBND-STAT-TMST                            06480033
064900             , :SUOBTR-DEST-OPER-UNT-ID                           06490033
065000          FROM  WST_INTGRTN_TYP   A                               06500033
065100             ,  WST_ATTR_DEFN     B                               06510033
065200             ,  WST_ATTR_ELEM     C                               06520033
065300             ,  WST_ATTR_ELEM     D                               06530033
065400             ,  TSUOBTS           E                               06540033
065500             ,  TSUOBTR           F                               06550033
065600         WHERE  C.ATTR_ELEM_NBR      = F.DEST_OPER_UNT_ID         06560033
065700           AND  A.INTGRTN_TYP_CDE    = 'STOTBNDUPD'               06570033
065800           AND  A.INTGRTN_TYP_CDE    = B.INTGRTN_TYP_CDE          06580033
065900           AND  B.ATTR_DEFN_SEQ_NBR  = 1                          06590033
066000           AND  B.INTGRTN_TYP_CDE    = C.INTGRTN_TYP_CDE          06600033
066100           AND  C.ATTR_DEFN_SEQ_NBR  = 1                          06610033
066200           AND  B.INTGRTN_TYP_CDE    = D.INTGRTN_TYP_CDE          06620033
066300           AND  D.ATTR_DEFN_SEQ_NBR  = 2                          06630033
066400           AND  C.INTGRTN_TYP_CDE    = D.INTGRTN_TYP_CDE          06640033
066500           AND  C.ATTR_ELEM_SEQ_NBR  = D.ATTR_ELEM_SEQ_NBR        06650033
066600           AND  E.OTBND_TRIP_ID      = :SUT00024-OTBND-TRIP-ID    06660033
066700           AND  E.OTBND_TRIP_ID      = F.OTBND_TRIP_ID            06670033
066800           AND  E.TRIP_STAT_CDE      = 'DS'                       06680033
066900           AND  D.ATTR_ELEM_TMST     <= E.OTBND_STAT_TMST         06690033
067000         WITH UR                                                  06700033
067100       END-EXEC.                                                  06710033
067200                                                                  06720033
067300     EVALUATE TRUE                                                06730033
067400         WHEN SQLCODE = ZERO                                      06740033
067500              SET PS-SCANNING-STORE      TO TRUE                  06750033
067600         WHEN SQLCODE = -811                                      06760033
067700              SET PS-SCANNING-STORE      TO TRUE                  06770033
067800         WHEN SQLCODE = +100                                      06780033
067900              SET PS-NOT-SCANNING-STORE  TO TRUE                  06790033
068000         WHEN SQLWARN0 NOT = SPACES                               06800033
068100         WHEN SQLCODE < ZERO                                      06810033
068200         WHEN SQLCODE > ZERO                                      06820033
068300             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          06830033
068400             MOVE  '3500-CHECK-IF-SCANNING-STORE'                 06840033
068500                                   TO PV-ABEND-PARAGRAPH          06850033
068600             MOVE 'SELECT WST_* TABLES '                          06860033
068700                                   TO PV-ABEND-OPERATION          06870033
068800             MOVE 'TRIP ID BEING PROCESSED: '                     06880033
068900                                   TO PV-DB2-OPERATION-MESSAGE-1  06890033
069000             MOVE SUT00024-OTBND-TRIP-ID TO PV-DISPLAY-TRIP-ID    06900033
069100             MOVE PV-DISPLAY-TRIP-ID                              06910033
069200                                   TO PV-DB2-OPERATION-MESSAGE-2  06920033
069300             MOVE  'CHECK TO SEE IF STORE SCANS'                  06930033
069400                                   TO PV-DB2-OPERATION-MESSAGE-3  06940033
069500             MOVE 'TSUOBTS'        TO PV-ABEND-STRUCTURE-1        06950033
069600             MOVE 'TSUOBTR'        TO PV-ABEND-STRUCTURE-2        06960033
069700             PERFORM 9900-DB2-ABEND                               06970033
069800     END-EVALUATE.                                                06980033
069900                                                                  06990033
070000                                                                  07000033
070100******************************************************************07010033
070200*  DETERMINE WHICH OUTPUT FILES THE CURRENT RECORD SHOULD BE      07020033
070300*  WRITTEN TO.                                                    07030033
070400******************************************************************07040033
070500 4000-PROCESS-OUTPUT-FILES.                                       07050033
070600                                                                  07060033
070700     IF PV-TRIP-ID-NOT-FOUND                                      07070033
070800         MOVE SUT00024-DEST-LOC-NBR       TO PC010-STR-NBR        07080033
070900         SET PC010-MISLOAD-UNLOAD         TO TRUE                 07090033
071000         MOVE SUT00121-SCN-OTBND-TRIP-ID  TO PC010-TRIP-ID        07100033
071001         PERFORM 8000-WRITE-INTRANSIT-FILE                        07100136
071010*        IF  XLT00010-LOC-TYP-CDE = 'CS'                          07101036
071020*            NEXT SENTENCE                                        07102036
071030*        ELSE                                                     07103036
071100*            PERFORM 8000-WRITE-INTRANSIT-FILE                    07110036
071110*        END-IF                                                   07111036
071300         MOVE SUT00121-SCN-LOC-NBR        TO PC010-STR-NBR        07130033
071400         SET PC010-MISLOAD-MEMO           TO TRUE                 07140033
071500         MOVE SUT00121-SCN-OTBND-TRIP-ID  TO PC010-TRIP-ID        07150033
071600         PERFORM 8000-WRITE-INTRANSIT-FILE                        07160033
071700                                                                  07170033
071800         PERFORM 8100-WRITE-ML-FASHION-FILE                       07180033
071900         IF SUT00024-SHIPT-UNT-ID NOT = PV-PREV-SHIPT-UNT-ID      07190033
072000             PERFORM 8200-WRITE-CARTON-UPDATE-FILE                07200033
072100         END-IF                                                   07210033
072200         PERFORM 8300-WRITE-TRIP-UPDATE-FILE                      07220033
072300     ELSE                                                         07230033
072400         IF PS-BOTH-STORES-ARE-SCANNING                           07240033
072500             MOVE SUT00024-DEST-LOC-NBR       TO PC010-STR-NBR    07250033
072600             SET PC010-MISLOAD-UNLOAD         TO TRUE             07260033
072700             MOVE SUT00024-OTBND-TRIP-ID      TO PC010-TRIP-ID    07270033
072701             PERFORM 8000-WRITE-INTRANSIT-FILE                    07270136
072710*            IF  XLT00010-LOC-TYP-CDE = 'CS'                      07271036
072720*                NEXT SENTENCE                                    07272036
072730*            ELSE                                                 07273036
072800*                PERFORM 8000-WRITE-INTRANSIT-FILE                07280036
072900*            END-IF                                               07290036
073000             MOVE SUT00121-SCN-LOC-NBR        TO PC010-STR-NBR    07300033
073100             SET PC010-MISLOAD-MEMO           TO TRUE             07310033
073200             MOVE SUT00121-SCN-OTBND-TRIP-ID  TO PC010-TRIP-ID    07320033
073300             PERFORM 8000-WRITE-INTRANSIT-FILE                    07330033
073400                                                                  07340033
073500             PERFORM 8100-WRITE-ML-FASHION-FILE                   07350033
073600             IF SUT00024-SHIPT-UNT-ID NOT = PV-PREV-SHIPT-UNT-ID  07360033
073700                 PERFORM 8200-WRITE-CARTON-UPDATE-FILE            07370033
073800             END-IF                                               07380033
073900         ELSE                                                     07390033
074000**           IF PS-ONE-STORE-NOT-SCANNING                         07400033
074100                 MOVE SUT00121-SCN-LOC-NBR       TO PC010-STR-NBR 07410033
074200                 SET PC010-MISLOAD-MEMO          TO TRUE          07420033
074300                 MOVE SUT00121-SCN-OTBND-TRIP-ID TO PC010-TRIP-ID 07430033
074400                 PERFORM 8000-WRITE-INTRANSIT-FILE                07440033
074500                 PERFORM 8100-WRITE-ML-FASHION-FILE               07450033
074600                 IF SUT00024-SHIPT-UNT-ID NOT =                   07460033
074700                                          PV-PREV-SHIPT-UNT-ID    07470033
074800                     PERFORM 8200-WRITE-CARTON-UPDATE-FILE        07480033
074900                 END-IF                                           07490033
075000**           END-IF                                               07500033
075100         END-IF                                                   07510033
075200     END-IF.                                                      07520033
075300     MOVE SUT00024-SHIPT-UNT-ID   TO  PV-PREV-SHIPT-UNT-ID.       07530033
075400                                                                  07540033
075401******************************************************************07540138
075402*  THIS PARAGRAPH WILL TAKE THE ROW RETURNED FROM THE CURSOR AND  07540238
075403*  SEE IF THE MERCHANDISE ASSOCIATED TO THE ROW IS RELATED TO     07540338
075404*  RED (MERCHANDISE VERIFIED TO A CENTRAL STOCK LOCATION THAT IS  07540438
075405*  TO BE USED TO FULFILL KOHLS.COM ORDERS).  IF MERCHANDISE IS    07540538
075406*  RED MERCHANDISE, THEN THE STORE NUMBER ASSOCIATED TO THE       07540638
075407*  CARTON WILL BE CONVERTED TO THE STORE NUMBER ASSOCIATED TO THE 07540738
075408*  RED LOCATION (BASED ON PARM ).                                 07540838
075409******************************************************************07540938
075410 5000-CHECK-IF-RED-MDSE.                                          07541038
075411                                                                  07541138
075412     IF (PV-HOLD-PREV-PO-NBR  =  SUT00028-TRN-NBR)                07541238
075413        AND PS-RED-RDC-FOUND-YES                                  07541338
075414        AND (PV-HOLD-PREV-LOC-NBR =  SUT00024-DEST-LOC-NBR)       07541438
075415           MOVE PV-USE-LOC-NBR TO SUT00024-DEST-LOC-NBR           07541538
075417     ELSE                                                         07541738
075418         SET PS-RED-RDC-FOUND-NO TO TRUE                          07541838
075419         PERFORM 5200-RED-PO-RDC-CHECK                            07541939
075420         IF PS-RED-RDC-FOUND-YES                                  07542038
075421            PERFORM 5400-RETRIEVE-TRANSLATE-STORE                 07542139
075422            MOVE PV-USE-LOC-NBR TO SUT00024-DEST-LOC-NBR          07542238
075424            MOVE  0             TO PV-HOLD-PREV-LOC-NBR           07542438
075425         END-IF                                                   07542538
075426         MOVE SUT00028-TRN-NBR  TO PV-HOLD-PREV-PO-NBR            07542638
075427     END-IF.                                                      07542738
075432                                                                  07543238
075433****************************************************************  07543338
075434*  ACCESS TKRPRPM TO GET TRANSLATED VALUE.                        07543438
075435*  SE-OPER-UNT-ID IS FROM THE INPUT FILE, THIS IS MATCHED AGAINST 07543538
075436*  THE LOC-ID IN THE TABLE ALONG WITH SPECIFIC CONSTANTS FOR      07543638
075437*  THE FUNC_PRC_STAT_CDE AND THE SYS_PRC_FUNC_CDE COLUMNS.        07543738
075438****************************************************************  07543838
075439                                                                  07543938
075440 5200-RED-PO-RDC-CHECK.                                           07544038
075441                                                                  07544138
075442                                                                  07544238
075443     MOVE SUT00028-TRN-NBR    TO   DK-PO-NBR.                     07544339
075444                                                                  07544438
075445     EXEC SQL                                                     07544538
075446         SELECT G.SEASET_SHRT_NM                                  07544638
075447           INTO :SEASET-SEASET-SHRT-NM                            07544738
075448           FROM  WST_INTGRTN_TYP  A                               07544838
075449                ,WST_ATTR_DEFN    B                               07544938
075450                ,WST_ATTR_ELEM    C                               07545038
075451                ,WST_ATTR_ELEM    D                               07545138
075452                ,WST_ATTR_ELEM    E                               07545238
075453                ,WST_ATTR_ELEM    F                               07545338
075454                ,TSEASET          G                               07545438
075455                ,TPURCHS          H                               07545538
075456            WHERE A.INTGRTN_TYP_CDE   = 'EFCATRDC'                07545638
075457              AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE         07545738
075458              AND B.ATTR_DEFN_SEQ_NBR = 1                         07545838
075459              AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE         07545938
075460              AND C.ATTR_DEFN_SEQ_NBR = 1                         07546038
075461              AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE         07546138
075462              AND D.ATTR_DEFN_SEQ_NBR = 2                         07546238
075463              AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE         07546338
075464              AND E.ATTR_DEFN_SEQ_NBR = 3                         07546438
075465              AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE         07546538
075466              AND F.ATTR_DEFN_SEQ_NBR = 4                         07546638
075467              AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR       07546738
075468              AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR       07546838
075469              AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR       07546938
075470              AND C.ATTR_ELEM_TXT     = G.SEASET_TYP_CDE          07547038
075471              AND D.ATTR_ELEM_TXT     = 'ACTIVE'                  07547138
075472              AND E.ATTR_ELEM_TMST   <= CURRENT TIMESTAMP         07547238
075473              AND F.ATTR_ELEM_TMST   >= CURRENT TIMESTAMP         07547338
075474              AND G.SEASET_SHRT_NM    = H.SEASET_SHRT_NM          07547438
075475              AND G.SEASET_YR         = H.SEASET_YR               07547538
075476              AND H.PO_NBR            = :DK-PO-NBR                07547638
075477              AND H.VER_STATUS_CDE    = 'A'                       07547738
075478       END-EXEC.                                                  07547838
075479                                                                  07547938
075480     EVALUATE TRUE                                                07548038
075481         WHEN SQLCODE = ZERO                                      07548138
075482             SET PS-RED-RDC-FOUND-YES TO TRUE                     07548238
075483         WHEN SQLCODE = +100                                      07548338
075484             SET PS-RED-RDC-FOUND-NO  TO TRUE                     07548438
075502         WHEN SQLWARN0 NOT = SPACES                               07550239
075503         WHEN SQLCODE < ZERO                                      07550339
075504         WHEN SQLCODE > ZERO                                      07550439
075505             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          07550539
075506             MOVE  '5200-RED-PO-RDC-CHECK'                        07550639
075507                                   TO PV-ABEND-PARAGRAPH          07550739
075508             MOVE 'SELECT WST_* TABLES - EFCATRDC '               07550839
075509                                   TO PV-ABEND-OPERATION          07550939
075510             MOVE 'PO BEING PROCESSED: '                          07551039
075511                                   TO PV-DB2-OPERATION-MESSAGE-1  07551139
075512             MOVE DK-PO-NBR        TO PV-DISPLAY-PO               07551239
075513             MOVE PV-DISPLAY-PO    TO PV-DB2-OPERATION-MESSAGE-2  07551339
075515             MOVE  'CHECK TO SEE IF PO PART OF RED SET '          07551539
075516                                   TO PV-DB2-OPERATION-MESSAGE-3  07551639
075517             MOVE 'TSEASET'        TO PV-ABEND-STRUCTURE-1        07551739
075518             MOVE 'TPURCHS'        TO PV-ABEND-STRUCTURE-2        07551839
075519             MOVE PV-CARTON-SKUS-FETCHED                          07551939
075520                                   TO PV-DISPLAY-COUNT            07552039
075521             DISPLAY 'FETCH COUNT BEING PROCESSED IS '            07552139
075522                                   PV-DISPLAY-COUNT               07552239
075523             PERFORM 9900-DB2-ABEND                               07552339
075524                                                                  07552438
075525     END-EVALUATE.                                                07552538
075526                                                                  07552638
075527                                                                  07552738
075528****************************************************************  07552838
075529*  ACCESS TKRPRPM TO GET TRANSLATED VALUE.                        07552938
075530*  SE-LOC-NBR IS FROM THE INPUT FILE, THIS IS MATCHED AGAINST     07553038
075531*  THE LOC-ID IN THE TABLE ALONG WITH SPECIFIC CONSTANTS FOR      07553138
075532*  THE FUNC_PRC_STAT_CDE AND THE SYS_PRC_FUNC_CDE COLUMNS.        07553238
075533****************************************************************  07553338
075534                                                                  07553438
075535 5400-RETRIEVE-TRANSLATE-STORE.                                   07553538
075536     MOVE SUT00024-DEST-LOC-NBR   TO DK-STORE-NBR.                07553639
075537     SET  PS-CS-CONVRSON-NO       TO TRUE.                        07553739
075538                                                                  07553838
075539     EXEC SQL                                                     07553938
075540      SELECT FUNC_QTY                                             07554038
075541       INTO :KRPRPM-FUNC-QTY                                      07554138
075542       FROM TKRPRPM A                                             07554238
075543            WHERE A.LOC_ID            = :DK-STORE-NBR             07554338
075544              AND A.FUNC_PRC_STAT_CDE = 'AC'                      07554438
075545              AND A.SYS_PRC_FUNC_CDE  = 'REDPGM'                  07554538
075546              AND A.FUNC_TXT          = :SEASET-SEASET-SHRT-NM    07554638
075547       WITH UR                                                    07554738
075548     END-EXEC.                                                    07554838
075549                                                                  07554938
075550     EVALUATE TRUE                                                07555038
075551         WHEN SQLCODE = ZERO                                      07555138
075552             MOVE KRPRPM-FUNC-QTY   TO PV-USE-LOC-NBR             07555238
075553             SET PS-CS-CONVRSON-YES TO TRUE                       07555338
075554         WHEN SQLCODE = +100                                      07555438
075555             PERFORM 5600-TRNSLTE-STRE-ANY-LOC                    07555539
075556         WHEN SQLWARN0 NOT = SPACE                                07555639
075557         WHEN SQLCODE  NOT = ZERO                                 07555739
075558             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          07555839
075559             MOVE  '5400-RETRIEVE-TRANSLATE-STORE'                07555939
075560                                   TO PV-ABEND-PARAGRAPH          07556039
075561             MOVE 'SYS_PRC_FUNC_CDE  = REDPGM'                    07556139
075562                                   TO PV-ABEND-OPERATION          07556239
075563             MOVE 'CHECKING FOR STORE REPLACE #1'                 07556339
075564                                   TO PV-DB2-OPERATION-MESSAGE-1  07556439
075565             MOVE 'TKRPRPM'        TO PV-ABEND-STRUCTURE-1        07556539
075566             MOVE PV-CARTON-SKUS-FETCHED                          07556639
075567                                   TO PV-DISPLAY-COUNT            07556739
075568             DISPLAY 'FETCH COUNT BEING PROCESSED IS '            07556839
075569                                   PV-DISPLAY-COUNT               07556939
075570             MOVE DK-PO-NBR        TO PV-DISPLAY-PO               07557039
075571             DISPLAY 'PO BEING PROCESSED:  '                      07557139
075572                     PV-DISPLAY-PO                                07557239
075573             PERFORM 9900-DB2-ABEND                               07557339
075576                                                                  07557638
075577     END-EVALUATE.                                                07557738
075578                                                                  07557838
075579****************************************************************  07557938
075580*  ACCESS TKRPRPM TO GET TRANSLATED VALUE.                        07558038
075581*  SECOND CHECK FOR TRANSLATED VALUE REMOVING THE                 07558138
075582*  SEASET-SEASET-SHRT-NM FROM THE SELECT. CONDITION WHERE A       07558238
075583*  RED PO HAS MULTIPLE DC SPLITS                                  07558338
075584****************************************************************  07558438
075585 5600-TRNSLTE-STRE-ANY-LOC.                                       07558538
075586                                                                  07558638
075587     EXEC SQL                                                     07558738
075588      SELECT FUNC_QTY                                             07558838
075589       INTO :KRPRPM-FUNC-QTY                                      07558938
075590       FROM TKRPRPM A                                             07559038
075591            WHERE A.LOC_ID            = :DK-STORE-NBR             07559138
075592              AND A.FUNC_PRC_STAT_CDE = 'AC'                      07559238
075593              AND A.SYS_PRC_FUNC_CDE  = 'REDPGM'                  07559338
075594       WITH UR                                                    07559438
075595     END-EXEC.                                                    07559538
075596                                                                  07559638
075597     EVALUATE TRUE                                                07559738
075598         WHEN SQLCODE = ZERO                                      07559838
075599             MOVE KRPRPM-FUNC-QTY        TO PV-USE-LOC-NBR        07559939
075600             SET PS-CS-CONVRSON-YES      TO TRUE                  07560039
075601         WHEN SQLCODE = +100                                      07560138
075602             MOVE SUT00024-DEST-LOC-NBR  TO PV-USE-LOC-NBR        07560239
075613         WHEN SQLWARN0 NOT = SPACE                                07561339
075614         WHEN SQLCODE  NOT = ZERO                                 07561439
075615             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          07561539
075616             MOVE '5600-TRNSLTE-STRE-ANY-LOC'                     07561639
075618                                   TO PV-ABEND-PARAGRAPH          07561839
075619             MOVE 'SYS_PRC_FUNC_CDE  = REDPGM'                    07561939
075620                                   TO PV-ABEND-OPERATION          07562039
075621             MOVE 'CHECKING FOR STORE REPLACE #2'                 07562139
075622                                   TO PV-DB2-OPERATION-MESSAGE-1  07562239
075623             MOVE 'TKRPRPM'        TO PV-ABEND-STRUCTURE-1        07562339
075624             MOVE PV-CARTON-SKUS-FETCHED                          07562439
075625                                   TO PV-DISPLAY-COUNT            07562539
075626             DISPLAY 'FETCH COUNT BEING PROCESSED IS '            07562639
075627                                   PV-DISPLAY-COUNT               07562739
075628             MOVE DK-PO-NBR        TO PV-DISPLAY-PO               07562839
075629             DISPLAY 'PO BEING PROCESSED:  '                      07562939
075630                     PV-DISPLAY-PO                                07563039
075631             PERFORM 9900-DB2-ABEND                               07563139
075632                                                                  07563238
075633     END-EVALUATE.                                                07563338
075634                                                                  07563438
075635                                                                  07563538
075636******************************************************************07563633
075640*  WRITE INTRANSIT OUTPUT FILE.                                   07564033
075700******************************************************************07570033
075800 8000-WRITE-INTRANSIT-FILE.                                       07580033
075900                                                                  07590033
076000     MOVE XLT00003-INTR-UPC-ID        TO  PC010-INTR-UPC-ID.      07600033
076100***GB BEG                                                         07610033
076200     IF PC010-MISLOAD-UNLOAD OR PC010-MISLOAD-MEMO                07620033
076300        COMPUTE PC010-IN-TRNST-QTY =                              07630033
076400                SUT00028-SHPD-UNT-QTY * -1                        07640033
076500     ELSE                                                         07650033
076600***GB END                                                         07660033
076700        MOVE SUT00028-SHPD-UNT-QTY       TO  PC010-IN-TRNST-QTY   07670033
076800     END-IF                                                       07680033
076900     MOVE PC-CURRENT-PROGRAM-NAME     TO  PC010-UPD-USR-ID.       07690033
077000     MOVE SUT00028-TRN-NBR            TO  PC010-PO-NBR.           07700033
077100     MOVE SUT00028-RCVR-SEQ-NBR       TO  PC010-RCVR-SEQ-NBR.     07710033
077200     SET  PC010-NOT-SHIPPED-FROM-DC   TO  TRUE.                   07720033
077300     SET  PC010-UNLOADED-AT-STORE     TO  TRUE.                   07730033
077400     SET  PC010-TRN-STR-EXPECTED      TO  TRUE.                   07740033
077500     MOVE SUT00028-UPC-NBR            TO  PC010-UPC-NBR.          07750033
077600     MOVE PC-CURRENT-TIMESTAMP        TO  PC010-EVENT-TMST.       07760033
077700     MOVE SUT00028-TRN-LNE-NBR        TO  PC010-TRN-LNE-NBR.      07770033
077800     MOVE SUT00028-TRN-TYP-CDE        TO  PC010-OTB-TYP-CDE.      07780033
077900                                                                  07790033
078000     WRITE INTRANSIT-RECORD-OUT                                   07800033
078100      FROM PC010-PCT-INTRANSIT-REC.                               07810033
078200                                                                  07820033
078300     ADD +1 TO PV-INTRANSIT-WRITE-COUNT.                          07830033
078400                                                                  07840033
078500                                                                  07850033
078600******************************************************************07860033
078700*  WRITE ML / FASHION OUTPUT FILE.                                07870033
078800******************************************************************07880033
078900 8100-WRITE-ML-FASHION-FILE.                                      07890033
079000                                                                  07900033
079100     MOVE XLT00003-SKU-NBR            TO  SU154-SKU-NUMBER.       07910033
079200     MOVE SUT00024-DEST-LOC-NBR       TO  SU154-FROM-STR-NBR.     07920033
079300     MOVE SUT00121-SCN-LOC-NBR        TO  SU154-TO-STR-NBR.       07930033
079400     MOVE SUT00028-SHPD-UNT-QTY       TO  SU154-IN-TRNST-QTY.     07940033
079500     MOVE PC-CURRENT-PROGRAM-NAME     TO  SU154-UPD-USR-ID.       07950033
079600     MOVE SUT00028-TRN-NBR            TO  SU154-PO-NBR.           07960033
079700     MOVE SUT00028-RCVR-SEQ-NBR       TO  SU154-RCVR-SEQ-NBR.     07970033
079800     MOVE SUT00028-TRN-LNE-NBR        TO  SU154-TRN-LNE-NBR.      07980033
079900     MOVE SUT00028-UPC-NBR            TO  SU154-UPC-NBR.          07990033
080000     MOVE SUT00024-SHIPT-UNT-ID       TO  SU154-SHIPT-UNT-ID.     08000033
080100     MOVE SUT00024-OTBND-TRIP-ID      TO  SU154-ORIG-TRIP-ID.     08010033
080200     MOVE SUT00121-SCN-OTBND-TRIP-ID  TO  SU154-SCAN-TRIP-ID.     08020033
080300     MOVE SUT00024-CART-SRC-CDE       TO  SU154-SML-TYPE.         08030033
080400                                                                  08040033
080500     WRITE ML-FASHION-RECORD-OUT                                  08050033
080600     FROM  SU154-STR-MISLD-TRANS-REC.                             08060033
080700                                                                  08070033
080800     ADD +1 TO PV-ML-FASHION-WRITE-COUNT.                         08080033
080900                                                                  08090033
081000                                                                  08100033
081100******************************************************************08110033
081200*  WRITE CARTON UPDATE FILE.                                      08120033
081300******************************************************************08130033
081400 8200-WRITE-CARTON-UPDATE-FILE.                                   08140033
081500                                                                  08150033
081600     MOVE SUT00024-SHIPT-UNT-ID       TO  SU153-SHIPT-UNT-ID.     08160033
081700     MOVE SUT00121-SCN-LOC-NBR        TO  SU153-SCN-LOC-NBR.      08170033
081800     MOVE SUT00121-SCN-OTBND-TRIP-ID  TO  SU153-OTBND-TRIP-ID.    08180033
081900     MOVE SUT00121-SCN-TYP-CDE        TO  SU153-SCN-TYPE-CDE.     08190033
082000     SET  SU153-UPDATE-RECORD         TO  TRUE.                   08200033
082100     MOVE SUT00121-CRE-TMST           TO  SU153-CRTN-SCAN-TMST.   08210033
082200                                                                  08220033
082300     WRITE CARTON-UPDATE-RECORD-OUT                               08230033
082400     FROM  SU153-EXTRACT-RECORD.                                  08240033
082500                                                                  08250033
082600     ADD +1 TO PV-CARTON-UPDATE-WRITE-COUNT.                      08260033
082700                                                                  08270033
082800                                                                  08280033
082900******************************************************************08290033
083000*  WRITE TRIP OUTPUT FILE WHEN CARTON IS NOT ASSIGNED TO A TRIP.  08300033
083100******************************************************************08310033
083200 8300-WRITE-TRIP-UPDATE-FILE.                                     08320033
083300                                                                  08330033
083400     MOVE SUT00121-SCN-OTBND-TRIP-ID  TO  SU043-OTBND-TRIP-ID.    08340033
083500     MOVE SUT00024-SHIPT-UNT-ID       TO  SU043-SHIPT-UNT-ID.     08350033
083600                                                                  08360033
083700     WRITE TRIP-UPDATE-RECORD-OUT                                 08370033
083800     FROM  SU043-RECORD.                                          08380033
083900                                                                  08390033
084000     ADD +1 TO PV-TRIP-UPDATE-WRITE-COUNT.                        08400033
084100                                                                  08410033
084200                                                                  08420033
084300******************************************************************08430033
084400*  CLOSE OUTPUT FILES.  DISPLAY COUNTS.                           08440033
084500******************************************************************08450033
084600 9000-EOJ-ROUTINE.                                                08460033
084700                                                                  08470033
084800     CLOSE BATCH-DATE-IN                                          08480033
084900           INTRANSIT-FILE-OUT                                     08490033
085000           ML-FASHION-FILE-OUT                                    08500033
085100           CARTON-UPDATE-FILE-OUT                                 08510033
085200           TRIP-UPDATE-FILE-OUT.                                  08520033
085300                                                                  08530033
085400     MOVE PV-CARTON-SKUS-FETCHED       TO  PV-DISPLAY-COUNT.      08540033
085500     DISPLAY 'MISLOAD CARTON SKUS READ: '  PV-DISPLAY-COUNT.      08550033
085600     DISPLAY '                          '.                        08560033
085700                                                                  08570033
085800     MOVE PV-INTRANSIT-WRITE-COUNT     TO  PV-DISPLAY-COUNT.      08580033
085900     DISPLAY 'INTRANSIT RECS WRITTEN..: '  PV-DISPLAY-COUNT.      08590033
086000     MOVE PV-ML-FASHION-WRITE-COUNT    TO  PV-DISPLAY-COUNT.      08600033
086100     DISPLAY 'ML FASHION RECS WRITTEN.: '  PV-DISPLAY-COUNT.      08610033
086200     MOVE PV-CARTON-UPDATE-WRITE-COUNT TO  PV-DISPLAY-COUNT.      08620033
086300     DISPLAY 'CARTON RECS WRITTEN.....: '  PV-DISPLAY-COUNT.      08630033
086400     MOVE PV-TRIP-UPDATE-WRITE-COUNT   TO  PV-DISPLAY-COUNT.      08640033
086500     DISPLAY 'TRIP RECORDS WRITTEN....: '  PV-DISPLAY-COUNT.      08650033
086600     DISPLAY '                          '.                        08660033
086700     DISPLAY '*****  SUKUT166 ENDED  *****'.                      08670033
086800                                                                  08680033
086900                                                                  08690033
087000******************************************************************08700033
087100*  FORMAT DB2 ABEND MESSAGES AND ABEND.                           08710033
087200******************************************************************08720033
087300 9900-DB2-ABEND.                                                  08730033
087400                                                                  08740033
087500     DISPLAY '*** DB2 ERROR '.                                    08750033
087600     DISPLAY '*** SQLCODE   = ' PV-DISPLAY-SQLCODE                08760033
087700     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM                  08770033
087800     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               08780033
087900     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               08790033
088000     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       08800033
088100     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       08810033
088200     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       08820033
088300     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             08830033
088400     DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2.             08840033
088500                                                                  08850033
088600                                                                  08860033
088700     COPY DPPD004.                                                08870033
088800                                                                  08880033
088900     IF SQLCODE NOT = -911                                        08890033
089000         EXEC SQL                                                 08900033
089100              ROLLBACK                                            08910033
089200         END-EXEC                                                 08920033
089300     END-IF.                                                      08930033
089400                                                                  08940033
089500     MOVE +4013                  TO PV-ABEND-CODE.                08950033
089600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         08960033
089700                                                                  08970033
