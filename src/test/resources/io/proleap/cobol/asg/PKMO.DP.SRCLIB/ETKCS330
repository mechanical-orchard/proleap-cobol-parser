000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.    ETKCS330.                                         00030000
000400 AUTHOR.        TESS BESTE.                                       00040000
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
000600 DATE-WRITTEN.  03-02-94.                                         00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900*-----------------------------------------------------------------00090000
001000*        E330 - FUNCTION GROUP/TRANSACTION SET LIST PROGRAM       00100000
001100*                                                                 00110000
001200* THIS PROGRAM GENERATES A LIST OF FUNCTIONAL GROUPS AND THE      00120000
001300* TRANSACTION SETS ASSOCIATED WITH THEM. FOR EACH FUNCTIONAL      00130000
001400* GROUP, IT LISTS THE FUNCTION CODE AND NAME, AND THE TRANSACION  00140000
001500* SET CODE, NAME, AND ABBREVIATION FOR EACH TRANSACTION SET       00150000
001600* ASSOCIATED WITH THE FUNCTIONAL GROUP.                           00160000
001700*                                                                 00170000
001800* THERE IS NO SELECTION FIELD ON THIS LIST. IT JUST DISPLAYS      00180000
001900* INFORMATION. THE ADD FUNCTION CAN BE INVOKED BY PRESSING THE    00190000
002000* ADD FUNCTION KEY. NO OTHER FUNCTIONS CAN BE INVOKED FROM THIS   00200000
002100* LIST.                                                           00210000
002200*-----------------------------------------------------------------00220000
002210* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00221002
002220*            - CHANGE CALL OF DPKUT100 TO                       * 00222002
002230*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00223002
002240*              MAKING THE CALL DYNAMIC VS STATIC                * 00224002
002250*                                                               * 00225002
002260*---------------------------------------------------------------* 00226002
CICS  *  CHANGED 10/28/2022    BY BARB SCHULTZ    WR: CHG0277210      * 00227003
CICS  *                                                               * 00228003
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00229003
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00229103
CCIS  *---------------------------------------------------------------* 00229303
002300                                                                  00230000
002400                                                                  00240000
002500 ENVIRONMENT DIVISION.                                            00250000
002600                                                                  00260000
002700 DATA DIVISION.                                                   00270000
002800                                                                  00280000
002900 WORKING-STORAGE SECTION.                                         00290000
003000                                                                  00300000
003100 01  PC-PROGRAM-CONSTANTS.                                        00310000
003200     05  PC-CURRENT-MAP-NAME          PIC  X(08)    VALUE         00320000
003300                                                         'ET330A'.00330000
003400     05  PC-CURRENT-MAPSET-NAME       PIC  X(08)    VALUE         00340000
003500                                                        'ETKM330'.00350000
003600     05  PC-CURRENT-PROGRAM-NAME      PIC  X(08)    VALUE         00360000
003700                                                       'ETKCS330'.00370000
003800     05  PC-LIST-QUEUE-SEQ            PIC  9        VALUE 1.      00380000
003900     05  PC-ITEMS-PER-PANEL           PIC S9(4)     COMP SYNC     00390000
004000                                                    VALUE +12.    00400000
004100     05  PC-MAX-BLOCKS-IN-ARRAY       PIC S9(4)     COMP SYNC     00410000
004200                                                    VALUE +2.     00420000
004300     05  PC-MAX-ITEMS                 PIC S9(9)     COMP-3        00430000
004400                                                    VALUE         00440000
004500                                                         +1000000.00450000
004600     05  PC-ITEM-NUMBER-LENGTH        PIC S9(4)     COMP SYNC     00460000
004700                                                    VALUE +7.     00470000
004800                                                                  00480000
004900     05  PC-TSYMSG-NUMBERS.                                       00490000
005000         10  PC-TSYMSG-00008          PIC  9(5)     VALUE 00008.  00500000
005100         10  PC-TSYMSG-00050          PIC  9(5)     VALUE 00050.  00510000
005200         10  PC-TSYMSG-00069          PIC  9(5)     VALUE 00069.  00520000
005300         10  PC-TSYMSG-00070          PIC  9(5)     VALUE 00070.  00530000
005400         10  PC-TSYMSG-00101          PIC  9(5)     VALUE 00101.  00540000
005500         10  PC-TSYMSG-00279          PIC  9(5)     VALUE 00279.  00550000
005600         10  PC-TSYMSG-00551          PIC  9(5)     VALUE 00551.  00560000
005700                                                                  00570000
005800 01  PS-PROGRAM-SWITCHES.                                         00580000
005900     05  PS-START-ITEM-ERROR-SW       PIC  X        VALUE 'Y'.    00590000
006000         88  PS-NO-START-ITEM-ERROR                 VALUE 'Y'.    00600000
006100         88  PS-START-ITEM-ERROR                    VALUE 'N'.    00610000
006200     05  PS-TTRNSET-CSR-OPEN-OK-SW    PIC  X        VALUE 'Y'.    00620000
006300         88  PS-TTRNSET-CSR-OPEN-OK                 VALUE 'Y'.    00630000
006400         88  PS-TTRNSET-CSR-OPEN-NOT-OK             VALUE 'N'.    00640000
006500     05  PS-END-OF-TTRNSET-CSR-SW     PIC  X        VALUE 'N'.    00650000
006600         88  PS-END-OF-TTRNSET-CSR                  VALUE 'Y'.    00660000
006700         88  PS-NOT-END-OF-TTRNSET-CSR              VALUE 'N'.    00670000
006800                                                                  00680000
006900 01  PV-PROGRAM-VARIABLES.                                        00690000
007000     05  PV-SUB                       PIC S9(4)     COMP SYNC     00700000
007100                                                    VALUE +0.     00710000
007200     05  PV-REMAINDER                 PIC S9(4)     COMP SYNC     00720000
007300                                                    VALUE +0.     00730000
007400     05  PV-READ-COUNT                PIC S9(9)     COMP-3        00740000
007500                                                    VALUE +0.     00750000
007600     05  PV-ITEMS-PROCESSED           PIC S9(9)     COMP-3        00760000
007700                                                    VALUE +0.     00770000
007800     05  PV-ITEM-IN-USE               PIC S9(9)     COMP-3        00780000
007900                                                    VALUE +0.     00790000
008000     05  PV-TOP-ITEM                  PIC S9(9)     COMP-3        00800000
008100                                                    VALUE +0.     00810000
008200     05  PV-BOTTOM-ITEM               PIC S9(9)     COMP-3        00820000
008300                                                    VALUE +0.     00830000
008400     05  PV-TEMP-BLOCK-NUMBER         PIC S9(9)     COMP-3        00840000
008500                                                    VALUE +0.     00850000
008600     05  PV-BLOCK-NUMBER              PIC S9(4)     COMP SYNC     00860000
008700                                                    VALUE +0.     00870000
008800     05  PV-CICS-RESP                 PIC S9(4)     COMP SYNC     00880000
008900                                                    VALUE +0.     00890000
009000     05  PV-ITEM                      PIC S9(4)     COMP SYNC     00900000
009100                                                    VALUE +0.     00910000
009200     05  PV-HIGHEST-BLOCK-WRITTEN     PIC S9(4)     COMP SYNC     00920000
009300                                                    VALUE +0.     00930000
009400     05  PV-LIST-ITEM-NUMBER          PIC S9(4)     COMP SYNC     00940000
009500                                                    VALUE +0.     00950000
009600     05  PV-FIRST-BLOCK-IN-ARRAY      PIC S9(4)     COMP SYNC     00960000
009700                                                    VALUE +0.     00970000
009800     05  PV-NEXT-BLOCK-IN-ARRAY       PIC S9(4)     COMP SYNC     00980000
009900                                                    VALUE +0.     00990000
010000     05  PV-PREV-BLOCK-IN-ARRAY       PIC S9(4)     COMP SYNC     01000000
010100                                                    VALUE +0.     01010000
010200                                                                  01020000
010300*-----------------------------------------------------------------01030000
010400* THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE. THERE 01040000
010500* MUST BE A BLOCK IN THE APPLICATION SPECIFIC COMMAREA WITH AN    01050000
010600* IDENTICAL LAYOUT.                                               01060000
010700*-----------------------------------------------------------------01070000
010800 01  LQW-LIST-QUEUE-WORK-AREA.                                    01080000
010900     05  LQW-BLOCK-MODIFIED           PIC  X(01)    VALUE SPACE.  01090000
011000     05  LQW-ITEM-ENTRIES             OCCURS 12 TIMES             01100000
011100                                      INDEXED BY LQW-IDX.         01110000
011200         10  LQW-LIST-ITEM-NUMBER     PIC S9(9)     COMP-3.       01120000
011300         10  LQW-FUNCTIONAL-GROUP     PIC  X(2).                  01130000
011400         10  LQW-FG-NAME              PIC  X(25).                 01140000
011500         10  LQW-TRANSACTION-SET      PIC  X(3).                  01150000
011600         10  LQW-TS-NAME              PIC  X(25).                 01160000
011700         10  LQW-ABBREVIATION         PIC  X(3).                  01170000
011800                                                                  01180000
011900*---------------------------------------------------------------* 01190000
012000*    MAP LAYOUT                                                 * 01200000
012100*---------------------------------------------------------------* 01210000
012200     COPY ETKM330.                                                01220000
012300                                                                  01230000
012400 01  MR-MAP-REDEFINITION              REDEFINES ET330AO.          01240000
012500     05  FILLER                       PIC X(48).                  01250000
012600     05  MR-SCROLL-AREA               OCCURS 12 TIMES.            01260000
012700         10  MR-FUNCTIONAL-GROUPL     PIC S9(04)    COMP.         01270000
012800         10  MR-FUNCTIONAL-GROUPA     PIC  X.                     01280000
012900         10  MR-FUNCTIONAL-GROUPC     PIC  X.                     01290000
013000         10  MR-FUNCTIONAL-GROUPH     PIC  X.                     01300000
013100         10  MR-FUNCTIONAL-GROUP      PIC  X(2).                  01310000
013200                                                                  01320000
013300         10  MR-FG-NAMEL              PIC S9(04)    COMP.         01330000
013400         10  MR-FG-NAMEA              PIC  X.                     01340000
013500         10  MR-FG-NAMEC              PIC  X.                     01350000
013600         10  MR-FG-NAMEH              PIC  X.                     01360000
013700         10  MR-FG-NAME               PIC  X(25).                 01370000
013800                                                                  01380000
013900         10  MR-TRANSACTION-SETL      PIC S9(04)    COMP.         01390000
014000         10  MR-TRANSACTION-SETA      PIC  X.                     01400000
014100         10  MR-TRANSACTION-SETC      PIC  X.                     01410000
014200         10  MR-TRANSACTION-SETH      PIC  X.                     01420000
014300         10  MR-TRANSACTION-SET       PIC  X(3).                  01430000
014400                                                                  01440000
014500         10  MR-TS-NAMEL              PIC S9(04)    COMP.         01450000
014600         10  MR-TS-NAMEA              PIC  X.                     01460000
014700         10  MR-TS-NAMEC              PIC  X.                     01470000
014800         10  MR-TS-NAMEH              PIC  X.                     01480000
014900         10  MR-TS-NAME               PIC  X(25).                 01490000
015000                                                                  01500000
015100         10  MR-ABBREVIATIONL         PIC S9(04)    COMP.         01510000
015200         10  MR-ABBREVIATIONA         PIC  X.                     01520000
015300         10  MR-ABBREVIATIONC         PIC  X.                     01530000
015400         10  MR-ABBREVIATIONH         PIC  X.                     01540000
015500         10  MR-ABBREVIATION          PIC  X(3).                  01550000
015600                                                                  01560000
015700*---------------------------------------------------------------* 01570000
015800*    ATTRIBUTE SETTINGS COPYBOOK.                               * 01580000
015900*---------------------------------------------------------------* 01590000
016000     COPY DPWS015.                                                01600000
016100                                                                  01610000
016200*---------------------------------------------------------------* 01620000
016300*    FUNCTION KEYS COPYBOOK.                                    * 01630000
016400*---------------------------------------------------------------* 01640000
016500     COPY DPWS016.                                                01650000
016600                                                                  01660000
016700*---------------------------------------------------------------* 01670000
016800*    NUMERIC EDIT LAYOUT.                                       * 01680000
016900*---------------------------------------------------------------* 01690000
017000     COPY DPWS010I.                                               01700000
017100                                                                  01710000
017200*---------------------------------------------------------------* 01720000
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 01730003
017400*---------------------------------------------------------------* 01740000
017500     COPY DPWS030.                                                01750000
CICS       COPY DPWS930.                                                01751003
017600                                                                  01760000
017700*---------------------------------------------------------------* 01770000
017800*    STANDARD COMMAREA.                                         * 01780000
017900*---------------------------------------------------------------* 01790000
018000     COPY DPWS020.                                                01800000
018100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01810000
018200                                                                  01820000
018300*---------------------------------------------------------------* 01830000
018400*  INTER-APPLICATION COMMAREA FOR THE NETWORK SCREENS.            01840000
018500*---------------------------------------------------------------* 01850000
018600         10  INTER-APPL-COMM-AREA       PIC X(200).               01860000
018700                                                                  01870000
018800*---------------------------------------------------------------* 01880000
018900*  APPLICATION-SPECIFIC COMMAREA.                                 01890000
019000*---------------------------------------------------------------* 01900000
019100         10  ASC-SPECIFIC-COMMAREA.                               01910000
019200             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                01920000
019300                 20  ASC-BLOCK-MODIFIED-SW                        01930000
019400                                      PIC  X.                     01940000
019500                     88  ASC-BLOCK-NOT-MODIFIED     VALUE 'N'.    01950000
019600                     88  ASC-BLOCK-MODIFIED         VALUE 'Y'.    01960000
019700                                                                  01970000
019800                 20  ASC-ITEM-ARRAY.                              01980000
019900                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        01990000
020000                         30  ASC-LIST-ITEM-NUMBER                 02000000
020100                                      PIC S9(9)     COMP-3.       02010000
020200                         30  ASC-FUNCTIONAL-GROUP                 02020000
020300                                      PIC  X(2).                  02030000
020400                         30  ASC-FG-NAME                          02040000
020500                                      PIC  X(25).                 02050000
020600                         30  ASC-TRANSACTION-SET                  02060000
020700                                      PIC  X(3).                  02070000
020800                         30  ASC-TS-NAME                          02080000
020900                                      PIC  X(25).                 02090000
021000                         30  ASC-ABBREVIATION                     02100000
021100                                      PIC  X(3).                  02110000
021200             15  ASC-BLK-SUB          PIC S9(4)     COMP SYNC.    02120000
021300             15  ASC-ITEM-SUB         PIC S9(4)     COMP SYNC.    02130000
021400             15  ASC-NUMBER-OF-ITEMS-READ                         02140000
021500                                      PIC S9(9)     COMP-3.       02150000
021600             15  ASC-ITEMS-DISPLAYED  PIC S9(3)     COMP-3.       02160000
021700             15  ASC-ITEM-AT-TOP-OF-PANEL                         02170000
021800                                      PIC S9(9)     COMP-3.       02180000
021900             15  ASC-ITEM-AT-BOT-OF-PANEL                         02190000
022000                                      PIC S9(9)     COMP-3.       02200000
022100             15  ASC-HIGHEST-BLOCK-WRITTEN                        02210000
022200                                      PIC S9(4)     COMP SYNC.    02220000
022300             15  ASC-ITEMS-LEFT-INDICATOR                         02230000
022400                                      PIC X.                      02240000
022500                 88  ASC-ITEMS-LEFT-ON-DB           VALUE 'Y'.    02250000
022600                 88  ASC-NO-ITEMS-LEFT-ON-DB        VALUE 'N'.    02260000
022700             15  ASC-LIST-QUEUE-NAME.                             02270000
022800                 20  ASC-LIST-TERM-ID PIC  X(4).                  02280000
022900                 20  ASC-LIST-TASK-NUMBER                         02290000
023000                                      PIC S9(5)     COMP-3.       02300000
023100                 20  ASC-LIST-SEQ     PIC  9.                     02310000
023200             15  ASC-START-ITEM-REQUEST.                          02320000
023300                 20  ASC-START-ITEM-REQUEST-N                     02330000
023400                                      PIC  9(7).                  02340000
023500         10  FILLER                   PIC  X(1310).               02350000
023600                                                                  02360000
023700*---------------------------------------------------------------* 02370000
023800*    ABEND PROCESSING COPYBOOK.                                 * 02380000
023900*---------------------------------------------------------------* 02390000
024000     COPY DPWS013.                                                02400000
024100                                                                  02410000
024200*---------------------------------------------------------------* 02420000
024300*    DB2 AREA FOR FUNCTIONAL GROUP TABLE                          02430000
024400*---------------------------------------------------------------* 02440000
024500     EXEC SQL                                                     02450000
024600          INCLUDE TFCNGRP                                         02460000
024700     END-EXEC.                                                    02470000
024800                                                                  02480000
024900*---------------------------------------------------------------* 02490000
025000*    DB2 AREA FOR TRANSACTION SET TABLE                           02500000
025100*---------------------------------------------------------------* 02510000
025200     EXEC SQL                                                     02520000
025300          INCLUDE TTRNSET                                         02530000
025400     END-EXEC.                                                    02540000
025500                                                                  02550000
025600*---------------------------------------------------------------* 02560000
025700*    DB2 AREA FOR COMMUNICATIONS                                * 02570000
025800*---------------------------------------------------------------* 02580000
025900     EXEC SQL                                                     02590000
026000          INCLUDE SQLCA                                           02600000
026100     END-EXEC.                                                    02610000
026200                                                                  02620000
026300*---------------------------------------------------------------* 02630000
026400*    FUNCTIONAL GROUP CURSOR. SELECT ALL FUNCTIONAL GROUPS.     * 02640000
026500*    ORDER THEM BY THE FUNCTIONAL GROUP CODE.                     02650000
026600*---------------------------------------------------------------* 02660000
026700     EXEC SQL                                                     02670000
026800         DECLARE  TFCNGRP-CSR CURSOR FOR                          02680000
026900         SELECT   FUNC_CDE                                        02690000
027000                , FUNC_NME                                        02700000
027100         FROM     TFCNGRP                                         02710000
027200         ORDER BY FUNC_CDE                                        02720000
027300     END-EXEC.                                                    02730000
027400                                                                  02740000
027500                                                                  02750000
027600*---------------------------------------------------------------* 02760000
027700*    TRANSACTION SET CURSOR. SELECT ALL TRANSACTION SETS FOR A    02770000
027800*    PARTICULAR FUNTIONAL GROUP. ORDER THEM BY ???.               02780000
027900*---------------------------------------------------------------* 02790000
028000     EXEC SQL                                                     02800000
028100         DECLARE  TTRNSET-CSR CURSOR FOR                          02810000
028200         SELECT   TRAN_SET_CDE                                    02820000
028300                , TRAN_SET_NME                                    02830000
028400                , TRAN_SET_NME_ID                                 02840000
028500         FROM     TTRNSET                                         02850000
028600         WHERE    FUNC_CDE = :FCNGRP-FUNC-CDE                     02860000
028700         ORDER BY TRAN_SET_CDE                                    02870000
028800     END-EXEC.                                                    02880000
028900                                                                  02890000
029000                                                                  02900000
029100 LINKAGE SECTION.                                                 02910000
029200                                                                  02920000
029300 01  DFHCOMMAREA.                                                 02930000
029400     05  FILLER                         OCCURS  1 TO 4072 TIMES   02940000
029500                                        DEPENDING ON EIBCALEN.    02950000
029600         10  FILLER                     PIC X.                    02960000
029700 EJECT                                                            02970000
029800 PROCEDURE DIVISION.                                              02980000
029900                                                                  02990000
030000*-----------------------------------------------------------------03000000
030100* THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.     03010000
030200* CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM PROCESSING, 03020000
030300* AND CALL THE CICS ARCHITECTURE API TO EXIT.                     03030000
030400*-----------------------------------------------------------------03040000
030500 0000-MAIN-MODULE.                                                03050000
030600                                                                  03060000
030700     INITIALIZE DP030-CICS-API-FIELDS.                            03070000
030800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03080000
030900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03090000
031000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03100000
031100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03110000
031200     MOVE LENGTH OF ET330AI        TO DP030-MAP-LENGTH (1).       03120000
031300     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03130000
031400     PERFORM 0001-CALL-CICS-ARCH-API.                             03140000
031500                                                                  03150000
031600     PERFORM 1000-CONTROL-PROCESSING                              03160000
031700                                                                  03170000
031800     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03180000
031900     PERFORM 0001-CALL-CICS-ARCH-API.                             03190000
032000                                                                  03200000
032100                                                                  03210000
032200*-----------------------------------------------------------------03220000
032300* THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE. IT   03230000
032400* WILL ABEND IF ANY ERRORS OCCUR IN THAT CALL.                    03240000
032500*-----------------------------------------------------------------03250000
032600 0001-CALL-CICS-ARCH-API.                                         03260000
032700                                                                  03270000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03280003
032900                                    DFHCOMMAREA                   03290003
033000                                    DP030-CICS-API-FIELDS         03300003
033100                                    DP020-STANDARD-COMMAREA       03310003
033200                                    ET330AI.                      03320003
033300                                                                  03330000
033400     IF  DP030-RC-CALL-SUCCESSFUL                                 03340000
033500         CONTINUE                                                 03350000
033600     ELSE                                                         03360000
033700         SET DP013-NO-ROLLBACK                                    03370000
033800             DP013-XCTL-DISPLAY-RESTART                           03380000
033900             DP013-CICS-ABEND      TO TRUE                        03390000
034000         MOVE '0001-CALL-CICS-ARCH-API'                           03400000
034100                                   TO DP013-PARAGRAPH             03410000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03420003
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03430003
034400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      03440000
034500         PERFORM DP013-0000-PROCESS-ABEND                         03450000
034600     END-IF.                                                      03460000
034700                                                                  03470000
034800*-----------------------------------------------------------------03480000
034900* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *03490000
035000* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *03500000
035100*                                                                *03510000
035200* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *03520000
035300*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *03530000
035400*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *03540000
035500*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *03550000
035600*-----------------------------------------------------------------03560000
035700 1000-CONTROL-PROCESSING.                                         03570000
035800                                                                  03580000
035900     EVALUATE TRUE                                                03590000
036000         WHEN DP020-NEXT-ACT-INITIAL                              03600000
036100             INITIALIZE ASC-SPECIFIC-COMMAREA                     03610000
036200             MOVE EIBTRMID              TO ASC-LIST-TERM-ID       03620000
036300             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   03630000
036400             MOVE PC-LIST-QUEUE-SEQ     TO ASC-LIST-SEQ           03640000
036500             MOVE SPACE                 TO ASC-START-ITEM-REQUEST 03650000
036600             PERFORM 4000-BUILD-INITIAL-PANEL                     03660000
036700                                                                  03670000
036800         WHEN DP020-NEXT-ACT-READ-MAP                             03680000
036900             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         03690000
037000             PERFORM 2000-PROCESS-PANEL                           03700000
037100                                                                  03710000
037200         WHEN DP020-NEXT-ACT-RETURN                               03720000
037300             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        03730000
037400                                   TO PV-TOP-ITEM                 03740000
037500             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    03750000
037600             PERFORM 3200-RESET-ATTRIBUTES                        03760000
037700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03770000
037800                                                                  03780000
037900         WHEN OTHER                                               03790000
038000             SET DP013-LOGIC-ABEND                                03800000
038100                 DP013-NO-ROLLBACK TO TRUE                        03810000
038200             MOVE '1000-CONTROL-PROCESSING'                       03820000
038300                                   TO DP013-PARAGRAPH             03830000
038400             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    03840000
038500                                   TO DP013-MESSAGE-TEXT(1)       03850000
038600             PERFORM DP013-0000-PROCESS-ABEND                     03860000
038700     END-EVALUATE.                                                03870000
038800                                                                  03880000
038900                                                                  03890000
039000 2000-PROCESS-PANEL.                                              03900000
039100                                                                  03910000
039200     EVALUATE TRUE                                                03920000
039300         WHEN DP020-SRC-AID = DP016-CLEAR                         03930000
039400             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    03940000
039500             PERFORM 3200-RESET-ATTRIBUTES                        03950000
039600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03960000
039700                                                                  03970000
039800         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    03980000
039900             PERFORM 2050-DELETE-LIST-QUEUE                       03990000
040000             PERFORM 4000-BUILD-INITIAL-PANEL                     04000000
040100                                                                  04010000
040200         WHEN OTHER                                               04020000
040300             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 04030000
040400             PERFORM 3200-RESET-ATTRIBUTES                        04040000
040500             SET DP030-CONTINUE-GO TO TRUE                        04050000
040600             PERFORM 2100-CHECK-FUNCTION-KEY                      04060000
040700     END-EVALUATE.                                                04070000
040800                                                                  04080000
040900                                                                  04090000
041000*-----------------------------------------------------------------04100000
041100*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *04110000
041200*-----------------------------------------------------------------04120000
041300 2050-DELETE-LIST-QUEUE.                                          04130000
041400                                                                  04140000
041500     EXEC CICS                                                    04150000
041600         DELETEQ TS                                               04160000
041700             QUEUE (ASC-LIST-QUEUE-NAME)                          04170000
041800             RESP  (PV-CICS-RESP)                                 04180000
041900     END-EXEC.                                                    04190000
042000                                                                  04200000
042100     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       04210000
042200        (PV-CICS-RESP = DFHRESP(QIDERR))                          04220000
042300         CONTINUE                                                 04230000
042400     ELSE                                                         04240000
042500         SET DP013-CICS-ABEND                                     04250000
042600             DP013-NO-ROLLBACK     TO TRUE                        04260000
042700                                                                  04270000
042800         MOVE '2050-DELETE-LIST-QUEUE'                            04280000
042900                                   TO DP013-PARAGRAPH             04290000
043000         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    04300000
043100                                   TO DP013-MESSAGE-TEXT (1)      04310000
043200         PERFORM DP013-0000-PROCESS-ABEND                         04320000
043300     END-IF.                                                      04330000
043400                                                                  04340000
043500     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  04350000
043600                                                                  04360000
043700                                                                  04370000
043800*-----------------------------------------------------------------04380000
043900* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *04390000
044000* CICS ARCHITECTURE API.                                         *04400000
044100*-----------------------------------------------------------------04410000
044200 2100-CHECK-FUNCTION-KEY.                                         04420000
044300                                                                  04430000
044400     EVALUATE TRUE                                                04440000
044500         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              04450000
044600             CONTINUE                                             04460000
044700                                                                  04470000
044800         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  04480000
044900             MOVE +1               TO PV-TOP-ITEM                 04490000
045000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04500000
045100                                                                  04510000
045200         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   04520000
045300             PERFORM 2110-BROWSE-BACKWARD                         04530000
045400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04540000
045500                                                                  04550000
045600         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   04560000
045700             PERFORM 2120-BROWSE-FORWARD                          04570000
045800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04580000
045900                                                                  04590000
046000         WHEN DP020-SRC-AID = DP016-ENTER                         04600000
046100             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   04610000
046200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04620000
046300                                                                  04630000
046400         WHEN OTHER                                               04640000
046500             SET DP013-NO-ROLLBACK                                04650000
046600                 DP013-XCTL-DISPLAY-RESTART                       04660000
046700                 DP013-CICS-ABEND  TO TRUE                        04670000
046800             MOVE '2100-CHECK-FUNCTION-KEY'                       04680000
046900                                   TO DP013-PARAGRAPH             04690000
047000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      04700000
047100                                   TO DP013-MESSAGE-TEXT (1)      04710000
047200             PERFORM DP013-0000-PROCESS-ABEND                     04720000
047300     END-EVALUATE.                                                04730000
047400                                                                  04740000
047500                                                                  04750000
047600*----------------------------------------------------------------*04760000
047700* IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP ITEM    04770000
047800* NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP, SET THE TOP   04780000
047900* ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST MESSAGE.          04790000
048000*----------------------------------------------------------------*04800000
048100 2110-BROWSE-BACKWARD.                                            04810000
048200                                                                  04820000
048300     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    04830000
048400         GIVING PV-TOP-ITEM.                                      04840000
048500                                                                  04850000
048600     IF  ((PV-TOP-ITEM < +1)                                      04860000
048700       OR (PV-TOP-ITEM = +1))                                     04870000
048800         MOVE +1                   TO PV-TOP-ITEM                 04880000
048900*        -- TOP OF LIST --                                        04890000
049000         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            04900000
049100         SET DP020-MSG-INFORMATIONAL TO TRUE                      04910000
049200     END-IF.                                                      04920000
049300                                                                  04930000
049400                                                                  04940000
049500*----------------------------------------------------------------*04950000
049600* IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP ITEM     04960000
049700* NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO PAST THE   04970000
049800* END, ISSUE THE BOTTOM OF LIST MESSAGE.                          04980000
049900*----------------------------------------------------------------*04990000
050000 2120-BROWSE-FORWARD.                                             05000000
050100                                                                  05010000
050200     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              05020000
050300         GIVING PV-TOP-ITEM.                                      05030000
050400     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   05040000
050500         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            05050000
050600                                   TO PV-TOP-ITEM                 05060000
050700*        -- BOTTOM OF LIST --                                     05070000
050800         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            05080000
050900         SET DP020-MSG-INFORMATIONAL                              05090000
051000                                   TO TRUE                        05100000
051100     ELSE                                                         05110000
051200         COMPUTE PV-BOTTOM-ITEM =                                 05120000
051300             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 05130000
051400         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            05140000
051500*            -- BOTTOM OF LIST --                                 05150000
051600             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            05160000
051700             SET DP020-MSG-INFORMATIONAL                          05170000
051800                                   TO TRUE                        05180000
051900         END-IF                                                   05190000
052000     END-IF.                                                      05200000
052100                                                                  05210000
052200                                                                  05220000
052300*----------------------------------------------------------------*05230000
052400* THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO THAT   05240000
052500* THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST. THIS IS A  05250000
052600* FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST RATHER THAN    05260000
052700* HITTING NEXT-PAGE TO GET TO THAT POINT. THE NEW LIST NUMBER     05270000
052800* ENTERED IS EDITED TO MAKE SURE THAT IT IS NUMERIC AND FALLS     05280000
052900* WITHIN A SPECIFIED RANGE.                                       05290000
053000*----------------------------------------------------------------*05300000
053100 2130-CHECK-FOR-JUMP-BROWSE.                                      05310000
053200                                                                  05320000
053300     IF ASC-START-ITEM-REQUEST = SPACE                            05330000
053400         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             05340000
053500     ELSE                                                         05350000
053600         MOVE ASC-START-ITEM-REQUEST  TO DP010I-UNEDITED-FIELD    05360000
053700         MOVE PC-ITEM-NUMBER-LENGTH   TO DP010I-MAXIMUM-DIGITS    05370000
053800         MOVE +0                      TO DP010I-MAXIMUM-DECIMALS  05380000
053900         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  05390000
054010         CALL DP010I-NUMERIC-EDIT-ROUTINE                         05401001
054020                         USING DP010I-NUMERIC-EDIT-AREA           05402001
054100                                                                  05410000
054200         IF  NOT DP010I-ERROR-DETECTED                            05420000
054300             MOVE DP010I-NUMERIC-FIELD                            05430000
054400                                   TO  ASC-START-ITEM-REQUEST-N   05440000
054500             IF  ASC-START-ITEM-REQUEST-N > ZERO                  05450000
054600             AND ASC-START-ITEM-REQUEST-N < 1000000               05460000
054700                 IF  ASC-START-ITEM-REQUEST-N >                   05470000
054800                                          ASC-NUMBER-OF-ITEMS-READ05480000
054900                     MOVE SPACE TO ASC-START-ITEM-REQUEST         05490000
055000                     COMPUTE PV-TOP-ITEM =                        05500000
055100                             ASC-NUMBER-OF-ITEMS-READ             05510000
055200                             - PC-ITEMS-PER-PANEL + 1             05520000
055300                     IF  PV-TOP-ITEM < +1                         05530000
055400                         MOVE +1   TO PV-TOP-ITEM                 05540000
055500*                        ---- BOTTOM OF LIST ----                 05550000
055600                         MOVE PC-TSYMSG-00070                     05560000
055700                                   TO DP020-MSG-NUMBER            05570000
055800                         SET DP020-MSG-INFORMATIONAL TO TRUE      05580000
055900                     END-IF                                       05590000
056000                 ELSE                                             05600000
056100                     MOVE ASC-START-ITEM-REQUEST-N TO PV-TOP-ITEM 05610000
056200                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      05620000
056300                     COMPUTE PV-BOTTOM-ITEM =                     05630000
056400                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     05640000
056500                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ05650000
056600*                        -- BOTTOM OF LIST --                     05660000
056700                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 05670000
056800                         SET DP020-MSG-INFORMATIONAL TO TRUE      05680000
056900                     END-IF                                       05690000
057000                 END-IF                                           05700000
057100             ELSE                                                 05710000
057200*                --- VALUE OUT OF RANGE ----                      05720000
057300                 MOVE PC-TSYMSG-00101        TO DP020-MSG-NUMBER  05730000
057400                 MOVE -1                     TO ASTRTITL          05740000
057500                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              05750000
057600                 MOVE DP015-REVERSE          TO ASTRTITH          05760000
057700                 MOVE DP015-RED              TO ASTRTITC          05770000
057800                 MOVE DP015-UNP-NUM-BRT-OFF  TO ASTRTITA          05780000
057900                 SET DP020-MSG-FATAL                              05790000
058000                     PS-START-ITEM-ERROR     TO TRUE              05800000
058100             END-IF                                               05810000
058200         ELSE                                                     05820000
058300*            ---- MUST BE NUMERIC ----                            05830000
058400             MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER      05840000
058500             MOVE -1                     TO ASTRTITL              05850000
058600             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  05860000
058700             MOVE DP015-REVERSE          TO ASTRTITH              05870000
058800             MOVE DP015-RED              TO ASTRTITC              05880000
058900             MOVE DP015-UNP-NUM-BRT-OFF  TO ASTRTITA              05890000
059000             SET DP020-MSG-FATAL         TO TRUE                  05900000
059100             SET PS-START-ITEM-ERROR     TO TRUE                  05910000
059200         END-IF                                                   05920000
059300     END-IF.                                                      05930000
059400                                                                  05940000
059500                                                                  05950000
059600*----------------------------------------------------------------*05960000
059700* MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE       05970000
059800* SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.    05980000
059900*----------------------------------------------------------------*05990000
060000 2200-MOVE-SCREEN-TO-COMMAREA.                                    06000000
060100                                                                  06010000
060200     IF  ASTRTITL > ZERO                                          06020000
060300         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          06030000
060400     ELSE                                                         06040000
060500         IF ASTRTITF = DP015-ERASE-EOF                            06050000
060600             MOVE SPACE TO ASC-START-ITEM-REQUEST                 06060000
060700         END-IF.                                                  06070000
060800                                                                  06080000
060900                                                                  06090000
061000*----------------------------------------------------------------*06100000
061100* RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.        06110000
061200*----------------------------------------------------------------*06120000
061300 3200-RESET-ATTRIBUTES.                                           06130000
061400                                                                  06140000
061500     MOVE DP015-UNP-NUM-NOR-OFF    TO ASTRTITA.                   06150000
061600     MOVE DP015-GREEN              TO ASTRTITC.                   06160000
061700     MOVE DP015-UNDERLINE          TO ASTRTITH.                   06170000
061800                                                                  06180000
061900                                                                  06190000
062000*----------------------------------------------------------------*06200000
062100* INITIALIZE BOTH BLOCKS IN THE ARRAY AND ALL COUNTERS AND FLAGS. 06210000
062200* READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.      06220000
062300* DISPLAY THE PANEL TO USER.                                      06230000
062400*----------------------------------------------------------------*06240000
062500 4000-BUILD-INITIAL-PANEL.                                        06250000
062600                                                                  06260000
062700     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            06270000
062800                                 ASC-BLOCK-ENTRIES (2).           06280000
062900     MOVE +1                  TO ASC-BLK-SUB.                     06290000
063000     SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                            06300000
063100     MOVE +0                  TO ASC-ITEM-SUB                     06310000
063200                                 ASC-NUMBER-OF-ITEMS-READ         06320000
063300                                 ASC-HIGHEST-BLOCK-WRITTEN        06330000
063400                                 ASC-ITEM-AT-TOP-OF-PANEL.        06340000
063500                                                                  06350000
063600     PERFORM 7000-OPEN-TFCNGRP-CSR.                               06360000
063700                                                                  06370000
063800     IF SQLCODE = ZERO                                            06380000
063900         PERFORM 4300-READ-ITEMS-FROM-DB                          06390000
064000         PERFORM 7020-CLOSE-TFCNGRP-CSR                           06400000
064100         IF PS-TTRNSET-CSR-OPEN-NOT-OK                            06410000
064200             SET  DP020-NEXT-ACT-APPL-ERROR                       06420000
064300                  DP020-MSG-WARNING         TO TRUE               06430000
064400*            ---- WAIT 15 SECONDS, THEN RETRY ----                06440000
064500             MOVE PC-TSYMSG-00551  TO  DP020-MSG-NUMBER           06450000
064600         ELSE                                                     06460000
064700             MOVE +1 TO  PV-TOP-ITEM                              06470000
064800             IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                  06480000
064900                 SET DP020-NEXT-ACT-APPL-ERROR                    06490000
065000                     DP020-MSG-FATAL TO TRUE                      06500000
065100*                ---- NO LIST ITEMS FOUND FOR CRITERIA ----       06510000
065200                 MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER       06520000
065300             ELSE                                                 06530000
065400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06540000
065500             END-IF                                               06550000
065600         END-IF                                                   06560000
065700     ELSE                                                         06570000
065800         SET  DP020-NEXT-ACT-APPL-ERROR                           06580000
065900              DP020-MSG-WARNING         TO TRUE                   06590000
066000*        ---- WAIT 15 SECONDS, THEN RETRY ----                    06600000
066100         MOVE PC-TSYMSG-00551  TO  DP020-MSG-NUMBER               06610000
066200     END-IF.                                                      06620000
066300                                                                  06630000
066400                                                                  06640000
066500*----------------------------------------------------------------*06650000
066600* READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE BLOCKS 06660000
066700* IN THE ARRAY. WHENEVER BOTH BLOCKS BECOME FULL, WRITE OUT THE   06670000
066800* 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND BLOCK IN THE ARRAY 06680000
066900* TO THE 1ST BLOCK, AND INITIALIZE THE 2ND BLOCK, MAKING IT       06690000
067000* AVAILABLE TO BE USED.                                           06700000
067100*                                                                 06710000
067200* DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE ROWS   06720000
067300* ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM UPON      06730000
067400* INITIALIZATION.                                                 06740000
067500*----------------------------------------------------------------*06750000
067600 4300-READ-ITEMS-FROM-DB.                                         06760000
067700                                                                  06770000
067800     PERFORM                                                      06780000
067900         VARYING PV-READ-COUNT                                    06790000
068000         FROM 1 BY 1                                              06800000
068100         UNTIL PV-READ-COUNT > PC-MAX-ITEMS                       06810000
068200            OR ASC-NO-ITEMS-LEFT-ON-DB                            06820000
068300            OR PS-TTRNSET-CSR-OPEN-NOT-OK                         06830000
068400                                                                  06840000
068500         PERFORM 7010-FETCH-TFCNGRP-CSR                           06850000
068600                                                                  06860000
068700         IF  ASC-ITEMS-LEFT-ON-DB                                 06870000
068800             INITIALIZE DCLTTRNSET                                06880000
068900             PERFORM 7030-OPEN-TTRNSET-CSR                        06890000
069000             IF PS-TTRNSET-CSR-OPEN-OK                            06900000
069100                 PERFORM 7040-FETCH-TTRNSET-CSR                   06910000
069200                 IF PS-END-OF-TTRNSET-CSR                         06920000
069300                     PERFORM 4310-MOVE-DB-ITEM-TO-ASC             06930000
069400                 ELSE                                             06940000
069500                     PERFORM UNTIL PS-END-OF-TTRNSET-CSR          06950000
069600                         PERFORM 4310-MOVE-DB-ITEM-TO-ASC         06960000
069700                         PERFORM 7040-FETCH-TTRNSET-CSR           06970000
069800                     END-PERFORM                                  06980000
069900                 END-IF                                           06990000
070000                 PERFORM 7050-CLOSE-TTRNSET-CSR                   07000000
070100             END-IF                                               07010000
070200         END-IF                                                   07020000
070300     END-PERFORM.                                                 07030000
070400                                                                  07040000
070500     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          07050000
070600         MOVE +1               TO ASC-BLK-SUB                     07060000
070700         PERFORM 5100-WRITE-TEMP-STORAGE                          07070000
070800         ADD +1                TO ASC-BLK-SUB                     07080000
070900         PERFORM 5100-WRITE-TEMP-STORAGE                          07090000
071000                                                                  07100000
071100         MOVE 1                TO ASC-BLK-SUB                     07110000
071200                                  PV-BLOCK-NUMBER                 07120000
071300         PERFORM 4410-READ-TEMP-STORAGE                           07130000
071400         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             07140000
071500             MOVE 2            TO ASC-BLK-SUB                     07150000
071600                                  PV-BLOCK-NUMBER                 07160000
071700             PERFORM 4410-READ-TEMP-STORAGE                       07170000
071800         END-IF                                                   07180000
071900     END-IF.                                                      07190000
072000                                                                  07200000
072100                                                                  07210000
072200 4310-MOVE-DB-ITEM-TO-ASC.                                        07220000
072300                                                                  07230000
072400     IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                        07240000
072500         ADD +1            TO ASC-ITEM-SUB                        07250000
072600     ELSE                                                         07260000
072700         ADD +1            TO ASC-BLK-SUB                         07270000
072800         MOVE +1           TO ASC-ITEM-SUB                        07280000
072900                                                                  07290000
073000         IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                 07300000
073100             MOVE +1 TO ASC-BLK-SUB                               07310000
073200             SET ASC-BLOCK-MODIFIED (1) TO TRUE                   07320000
073300             PERFORM 5100-WRITE-TEMP-STORAGE                      07330000
073400             MOVE ASC-BLOCK-ENTRIES (PC-MAX-BLOCKS-IN-ARRAY)      07340000
073500                 TO ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               07350000
073600             ADD +1 TO ASC-BLK-SUB                                07360000
073700             INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)           07370000
073800             SET ASC-BLOCK-NOT-MODIFIED   (ASC-BLK-SUB) TO TRUE   07380000
073900         END-IF                                                   07390000
074000     END-IF.                                                      07400000
074100                                                                  07410000
074200     ADD +1            TO ASC-NUMBER-OF-ITEMS-READ                07420000
074300                                                                  07430000
074400     MOVE ASC-NUMBER-OF-ITEMS-READ                                07440000
074500         TO ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB).      07450000
074600     MOVE FCNGRP-FUNC-CDE                                         07460000
074700         TO ASC-FUNCTIONAL-GROUP (ASC-BLK-SUB ASC-ITEM-SUB).      07470000
074800     MOVE FCNGRP-FUNC-NME                                         07480000
074900         TO ASC-FG-NAME          (ASC-BLK-SUB ASC-ITEM-SUB)       07490000
075000     MOVE TRNSET-TRAN-SET-CDE                                     07500000
075100         TO ASC-TRANSACTION-SET  (ASC-BLK-SUB ASC-ITEM-SUB).      07510000
075200     MOVE TRNSET-TRAN-SET-NME                                     07520000
075300         TO ASC-TS-NAME          (ASC-BLK-SUB ASC-ITEM-SUB).      07530000
075400     MOVE TRNSET-TRAN-SET-NME-ID                                  07540000
075500         TO ASC-ABBREVIATION     (ASC-BLK-SUB ASC-ITEM-SUB).      07550000
075600                                                                  07560000
075700                                                                  07570000
075800*----------------------------------------------------------------*07580000
075900* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *07590000
076000*----------------------------------------------------------------*07600000
076100 4400-MOVE-COMMAREA-TO-SCREEN.                                    07610000
076200                                                                  07620000
076300     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             07630000
076400         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          07640000
076500         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          07650000
076600             MOVE +1    TO ASC-BLK-SUB                            07660000
076700             PERFORM 5100-WRITE-TEMP-STORAGE                      07670000
076800             ADD +1     TO ASC-BLK-SUB                            07680000
076900             PERFORM 5100-WRITE-TEMP-STORAGE                      07690000
077000             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             07700000
077100                 GIVING PV-BLOCK-NUMBER                           07710000
077200                 REMAINDER PV-REMAINDER                           07720000
077300             IF  PV-REMAINDER > ZERO                              07730000
077400                 ADD +1 TO PV-BLOCK-NUMBER                        07740000
077500             END-IF                                               07750000
077600             MOVE +1    TO ASC-BLK-SUB                            07760000
077700             PERFORM 4410-READ-TEMP-STORAGE                       07770000
077800             ADD +1     TO ASC-BLK-SUB                            07780000
077900                           PV-BLOCK-NUMBER                        07790000
078000             PERFORM 4410-READ-TEMP-STORAGE                       07800000
078100     END-IF.                                                      07810000
078200                                                                  07820000
078300     MOVE +1            TO ASC-BLK-SUB.                           07830000
078400                                                                  07840000
078500     COMPUTE ASC-ITEM-SUB =                                       07850000
078600         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              07860000
078700         + PC-ITEMS-PER-PANEL).                                   07870000
078800                                                                  07880000
078900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        07890000
079000         ADD +1         TO ASC-BLK-SUB                            07900000
079100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            07910000
079200     END-IF.                                                      07920000
079300                                                                  07930000
079400     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           07940000
079500         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                07950000
079600                                                                  07960000
079700     PERFORM 4420-FORMAT-LIST-LINES                               07970000
079800         VARYING PV-SUB                                           07980000
079900         FROM PC-ITEMS-PER-PANEL BY -1                            07990000
080000         UNTIL PV-SUB < +1.                                       08000000
080100                                                                  08010000
080200     COMPUTE ASC-ITEMS-DISPLAYED =                                08020000
080300         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          08030000
080400                                                                  08040000
080500     IF PS-NO-START-ITEM-ERROR                                    08050000
080600         MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL08060000
080700                                          ASTRTITO                08070000
080800         MOVE SPACE                    TO ASC-START-ITEM-REQUEST  08080000
080900     ELSE                                                         08090000
081000         MOVE ASC-START-ITEM-REQUEST   TO ASTRTITO                08100000
081100     END-IF.                                                      08110000
081200                                                                  08120000
081300     MOVE ASC-ITEM-AT-BOT-OF-PANEL     TO AENDITO.                08130000
081400     MOVE ASC-NUMBER-OF-ITEMS-READ     TO ATOTITO.                08140000
081500     MOVE ZERO                         TO ASELITO.                08150000
081600                                                                  08160000
081700     IF  DP020-MSG-NUMBER-X = SPACE                               08170000
081800         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  08180000
081900*            --- MORE ITEMS TO DISPLAY ----                       08190000
082000             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            08200000
082100             SET DP020-MSG-INFORMATIONAL TO TRUE                  08210000
082200         END-IF                                                   08220000
082300     END-IF.                                                      08230000
082400                                                                  08240000
082500                                                                  08250000
082600*----------------------------------------------------------------*08260000
082700*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *08270000
082800*----------------------------------------------------------------*08280000
082900 4410-READ-TEMP-STORAGE.                                          08290000
083000                                                                  08300000
083100     EXEC CICS                                                    08310000
083200         READQ TS                                                 08320000
083300             QUEUE (ASC-LIST-QUEUE-NAME)                          08330000
083400             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               08340000
083500             ITEM  (PV-BLOCK-NUMBER)                              08350000
083600             RESP  (PV-CICS-RESP)                                 08360000
083700     END-EXEC.                                                    08370000
083800                                                                  08380000
083900     IF ((PV-CICS-RESP = DFHRESP (NORMAL))                        08390000
084000     OR  (PV-CICS-RESP = DFHRESP (ITEMERR)))                      08400000
084100         CONTINUE                                                 08410000
084200     ELSE                                                         08420000
084300         SET DP013-CICS-ABEND                                     08430000
084400             DP013-NO-ROLLBACK    TO TRUE                         08440000
084500         MOVE '4410-READ-TEMP-STORAGE' TO DP013-PARAGRAPH         08450000
084600         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      08460000
084700                                       TO DP013-MESSAGE-TEXT(1)   08470000
084800         PERFORM DP013-0000-PROCESS-ABEND                         08480000
084900     END-IF.                                                      08490000
085000                                                                  08500000
085100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             08510000
085200                                                                  08520000
085300     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         08530000
085400         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               08540000
085500     END-IF.                                                      08550000
085600                                                                  08560000
085700                                                                  08570000
085800*----------------------------------------------------------------*08580000
085900* PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.        08590000
086000*----------------------------------------------------------------*08600000
086100 4420-FORMAT-LIST-LINES.                                          08610000
086200                                                                  08620000
086300     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      08630000
086400         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                08640000
086500         MOVE SPACE             TO MR-FUNCTIONAL-GROUP    (PV-SUB)08650000
086600                                   MR-FG-NAME             (PV-SUB)08660000
086700                                   MR-TRANSACTION-SET     (PV-SUB)08670000
086800                                   MR-TS-NAME             (PV-SUB)08680000
086900                                   MR-ABBREVIATION        (PV-SUB)08690000
087000     ELSE                                                         08700000
087100         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           08710000
087200             MOVE ASC-FUNCTIONAL-GROUP (ASC-BLK-SUB ASC-ITEM-SUB) 08720000
087300                  TO MR-FUNCTIONAL-GROUP    (PV-SUB)              08730000
087400             MOVE ASC-FG-NAME          (ASC-BLK-SUB ASC-ITEM-SUB) 08740000
087500                  TO MR-FG-NAME             (PV-SUB)              08750000
087600             MOVE ASC-TRANSACTION-SET  (ASC-BLK-SUB ASC-ITEM-SUB) 08760000
087700                  TO MR-TRANSACTION-SET     (PV-SUB)              08770000
087800             MOVE ASC-TS-NAME          (ASC-BLK-SUB ASC-ITEM-SUB) 08780000
087900                  TO MR-TS-NAME             (PV-SUB)              08790000
088000             MOVE ASC-ABBREVIATION     (ASC-BLK-SUB ASC-ITEM-SUB) 08800000
088100                  TO MR-ABBREVIATION        (PV-SUB)              08810000
088200         END-IF                                                   08820000
088300     END-IF.                                                      08830000
088400                                                                  08840000
088500     SUBTRACT +1 FROM ASC-ITEM-SUB                                08850000
088600     IF  ASC-ITEM-SUB < + 1                                       08860000
088700         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  08870000
088800         MOVE +1                 TO ASC-BLK-SUB                   08880000
088900     END-IF.                                                      08890000
089000                                                                  08900000
089100                                                                  08910000
089200*----------------------------------------------------------------*08920000
089300* WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE. REWRITE  08930000
089400* AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.                08940000
089500*----------------------------------------------------------------*08950000
089600 5100-WRITE-TEMP-STORAGE.                                         08960000
089700                                                                  08970000
089800     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     08980000
089900                                   TO PV-LIST-ITEM-NUMBER.        08990000
090000     COMPUTE PV-BLOCK-NUMBER =                                    09000000
090100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09010000
090200                                                                  09020000
090300     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             09030000
090400     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             09040000
090500         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      09050000
090600             PERFORM 5105-REWRITE-ASC-LISTQ                       09060000
090700         END-IF                                                   09070000
090800     ELSE                                                         09080000
090900         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       09090000
091000         ASC-HIGHEST-BLOCK-WRITTEN + 1                            09100000
091100         PERFORM 5110-WRITE-ASC-LISTQ                             09110000
091200         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   09120000
091300     END-IF.                                                      09130000
091400                                                                  09140000
091500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             09150000
091600                                                                  09160000
091700                                                                  09170000
091800******************************************************************09180000
091900* REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       09190000
092000* SPECIFIC COMMAREA.                                              09200000
092100******************************************************************09210000
092200 5105-REWRITE-ASC-LISTQ.                                          09220000
092300                                                                  09230000
092400     EXEC CICS                                                    09240000
092500         WRITEQ TS                                                09250000
092600             QUEUE (ASC-LIST-QUEUE-NAME)                          09260000
092700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               09270000
092800             ITEM  (PV-BLOCK-NUMBER)                              09280000
092900             REWRITE                                              09290000
093000             RESP  (PV-CICS-RESP)                                 09300000
093100     END-EXEC.                                                    09310000
093200                                                                  09320000
093300     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           09330000
093400         CONTINUE                                                 09340000
093500     ELSE                                                         09350000
093600         SET DP013-CICS-ABEND            TO TRUE                  09360000
093700         SET DP013-NO-ROLLBACK           TO TRUE                  09370000
093800         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       09380000
093900         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     09390000
094000                                         TO DP013-MESSAGE-TEXT(1) 09400000
094100         PERFORM DP013-0000-PROCESS-ABEND                         09410000
094200     END-IF.                                                      09420000
094300                                                                  09430000
094400                                                                  09440000
094500*-----------------------------------------------------------------09450000
094600* WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-SPECIFIC 09460000
094700* COMMAREA.                                                       09470000
094800*-----------------------------------------------------------------09480000
094900 5110-WRITE-ASC-LISTQ.                                            09490000
095000                                                                  09500000
095100     EXEC CICS                                                    09510000
095200         WRITEQ TS                                                09520000
095300             QUEUE (ASC-LIST-QUEUE-NAME)                          09530000
095400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               09540000
095500             ITEM  (PV-BLOCK-NUMBER)                              09550000
095600             RESP  (PV-CICS-RESP)                                 09560000
095700     END-EXEC.                                                    09570000
095800                                                                  09580000
095900     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      09590000
096000         SET DP013-CICS-ABEND      TO TRUE                        09600000
096100         SET DP013-NO-ROLLBACK     TO TRUE                        09610000
096200         MOVE '5110-WRITE-ASC-LISTQ'                              09620000
096300                                   TO DP013-PARAGRAPH             09630000
096400         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           09640000
096500                                   TO DP013-MESSAGE-TEXT(1)       09650000
096600         PERFORM DP013-0000-PROCESS-ABEND                         09660000
096700     END-IF.                                                      09670000
096800                                                                  09680000
096900                                                                  09690000
097000 7000-OPEN-TFCNGRP-CSR.                                           09700000
097100                                                                  09710000
097200     EXEC SQL                                                     09720000
097300          OPEN TFCNGRP-CSR                                        09730000
097400     END-EXEC.                                                    09740000
097500                                                                  09750000
097600     EVALUATE TRUE                                                09760000
097700         WHEN SQLCODE = ZERO                                      09770000
097800         WHEN SQLCODE = -904                                      09780000
097900         WHEN SQLCODE = -913                                      09790000
098000             CONTINUE                                             09800000
098100         WHEN SQLWARN0 NOT = SPACES                               09810000
098200         WHEN SQLCODE  NOT = ZERO                                 09820000
098300             MOVE '7000-OPEN-TFCNGRP-CSR'                         09830000
098400                                     TO DP013-PARAGRAPH           09840000
098500             MOVE 'OPEN TFCNGRP-CSR' TO DP013-MESSAGE-TEXT (1)    09850000
098600             MOVE 'TFCNGRP '         TO DP013-DB2-TABLE-NAME (1)  09860000
098700             MOVE SQLCA              TO DP013-SQLCA               09870000
098800             SET DP013-DB2-ABEND                                  09880000
098900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09890000
099000             PERFORM DP013-0000-PROCESS-ABEND                     09900000
099100     END-EVALUATE.                                                09910000
099200                                                                  09920000
099300                                                                  09930000
099400 7010-FETCH-TFCNGRP-CSR.                                          09940000
099500                                                                  09950000
099600      EXEC SQL                                                    09960000
099700           FETCH TFCNGRP-CSR                                      09970000
099800           INTO  :FCNGRP-FUNC-CDE                                 09980000
099900               , :FCNGRP-FUNC-NME                                 09990000
100000      END-EXEC.                                                   10000000
100100                                                                  10010000
100200     EVALUATE TRUE                                                10020000
100300         WHEN SQLCODE = ZERO                                      10030000
100400         WHEN SQLCODE = +100                                      10040000
100500              CONTINUE                                            10050000
100600         WHEN SQLWARN0 NOT = SPACE                                10060000
100700         WHEN SQLCODE  NOT = ZERO                                 10070000
100800              MOVE '7010-FETCH-TFCNGRP-CURSOR'                    10080000
100900                                       TO DP013-PARAGRAPH         10090000
101000              MOVE 'FETCH TFCNGRP-CSR' TO DP013-MESSAGE-TEXT (1)  10100000
101100              MOVE 'TFCNGRP '          TO DP013-DB2-TABLE-NAME (1)10110000
101200              MOVE SQLCA               TO DP013-SQLCA             10120000
101300              SET DP013-DB2-ABEND      TO TRUE                    10130000
101400              PERFORM DP013-0000-PROCESS-ABEND                    10140000
101500     END-EVALUATE.                                                10150000
101600                                                                  10160000
101700     IF  SQLCODE = +100                                           10170000
101800         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                      10180000
101900     END-IF.                                                      10190000
102000                                                                  10200000
102100                                                                  10210000
102200 7020-CLOSE-TFCNGRP-CSR.                                          10220000
102300                                                                  10230000
102400     EXEC SQL                                                     10240000
102500         CLOSE TFCNGRP-CSR                                        10250000
102600     END-EXEC.                                                    10260000
102700                                                                  10270000
102800     EVALUATE TRUE                                                10280000
102900         WHEN SQLCODE = ZERO                                      10290000
103000             CONTINUE                                             10300000
103100         WHEN SQLWARN0 NOT = SPACES                               10310000
103200         WHEN SQLCODE  NOT = ZERO                                 10320000
103300             MOVE '7020-CLOSE-TFCNGRP-CSR'                        10330000
103400                                      TO DP013-PARAGRAPH          10340000
103500             MOVE 'CLOSE TFCNGRP-CSR' TO DP013-MESSAGE-TEXT (1)   10350000
103600             MOVE 'TFCNGRP'           TO DP013-DB2-TABLE-NAME (1) 10360000
103700             MOVE SQLCA               TO DP013-SQLCA              10370000
103800             SET DP013-DB2-ABEND                                  10380000
103900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               10390000
104000             PERFORM DP013-0000-PROCESS-ABEND                     10400000
104100     END-EVALUATE.                                                10410000
104200                                                                  10420000
104300                                                                  10430000
104400 7030-OPEN-TTRNSET-CSR.                                           10440000
104500                                                                  10450000
104600     EXEC SQL                                                     10460000
104700          OPEN TTRNSET-CSR                                        10470000
104800     END-EXEC.                                                    10480000
104900                                                                  10490000
105000     EVALUATE TRUE                                                10500000
105100         WHEN SQLCODE = ZERO                                      10510000
105200             SET PS-TTRNSET-CSR-OPEN-OK TO TRUE                   10520000
105300         WHEN SQLCODE = -904                                      10530000
105400         WHEN SQLCODE = -913                                      10540000
105500             SET PS-TTRNSET-CSR-OPEN-NOT-OK TO TRUE               10550000
105600         WHEN SQLWARN0 NOT = SPACES                               10560000
105700         WHEN SQLCODE  NOT = ZERO                                 10570000
105800             MOVE '7030-OPEN-TTRNSET-CSR'                         10580000
105900                                     TO DP013-PARAGRAPH           10590000
106000             MOVE 'OPEN TTRNSET-CSR' TO DP013-MESSAGE-TEXT (1)    10600000
106100             MOVE 'TTRNSET '         TO DP013-DB2-TABLE-NAME (1)  10610000
106200             MOVE SQLCA              TO DP013-SQLCA               10620000
106300             SET DP013-DB2-ABEND                                  10630000
106400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               10640000
106500             PERFORM DP013-0000-PROCESS-ABEND                     10650000
106600     END-EVALUATE.                                                10660000
106700                                                                  10670000
106800                                                                  10680000
106900 7040-FETCH-TTRNSET-CSR.                                          10690000
107000                                                                  10700000
107100      EXEC SQL                                                    10710000
107200           FETCH TTRNSET-CSR                                      10720000
107300           INTO  :TRNSET-TRAN-SET-CDE                             10730000
107400               , :TRNSET-TRAN-SET-NME                             10740000
107500               , :TRNSET-TRAN-SET-NME-ID                          10750000
107600      END-EXEC.                                                   10760000
107700                                                                  10770000
107800     EVALUATE TRUE                                                10780000
107900         WHEN SQLCODE = ZERO                                      10790000
108000             SET PS-NOT-END-OF-TTRNSET-CSR TO TRUE                10800000
108100         WHEN SQLCODE = +100                                      10810000
108200             SET PS-END-OF-TTRNSET-CSR     TO TRUE                10820000
108300         WHEN SQLWARN0 NOT = SPACE                                10830000
108400         WHEN SQLCODE  NOT = ZERO                                 10840000
108500              MOVE '7040-FETCH-TTRNSET-CSR'                       10850000
108600                                       TO DP013-PARAGRAPH         10860000
108700              MOVE 'FETCH TTRNSET-CSR' TO DP013-MESSAGE-TEXT (1)  10870000
108800              MOVE 'TTRNSET '          TO DP013-DB2-TABLE-NAME (1)10880000
108900              MOVE SQLCA               TO DP013-SQLCA             10890000
109000              SET DP013-DB2-ABEND      TO TRUE                    10900000
109100              PERFORM DP013-0000-PROCESS-ABEND                    10910000
109200     END-EVALUATE.                                                10920000
109300                                                                  10930000
109400                                                                  10940000
109500 7050-CLOSE-TTRNSET-CSR.                                          10950000
109600                                                                  10960000
109700     EXEC SQL                                                     10970000
109800         CLOSE TTRNSET-CSR                                        10980000
109900     END-EXEC.                                                    10990000
110000                                                                  11000000
110100     EVALUATE TRUE                                                11010000
110200         WHEN SQLCODE = ZERO                                      11020000
110300             CONTINUE                                             11030000
110400         WHEN SQLWARN0 NOT = SPACES                               11040000
110500         WHEN SQLCODE  NOT = ZERO                                 11050000
110600             MOVE '7050-CLOSE-TTRNSET-CSR'                        11060000
110700                                      TO DP013-PARAGRAPH          11070000
110800             MOVE 'CLOSE TTRNSET-CSR' TO DP013-MESSAGE-TEXT (1)   11080000
110900             MOVE 'TTRNSET'           TO DP013-DB2-TABLE-NAME (1) 11090000
111000             MOVE SQLCA               TO DP013-SQLCA              11100000
111100             SET DP013-DB2-ABEND                                  11110000
111200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               11120000
111300             PERFORM DP013-0000-PROCESS-ABEND                     11130000
111400     END-EVALUATE.                                                11140000
111500                                                                  11150000
111600                                                                  11160000
111700*----------------------------------------------------------------*11170000
111800*    ABEND PROCESSOR MODULE                                      *11180000
111900*----------------------------------------------------------------*11190000
112000                                                                  11200000
112100     COPY DPPD013.                                                11210000
