000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400                                                                  00040000
000500 PROGRAM-ID.             SUKUT093.                                00050000
000600 AUTHOR.                 DENISE HAHN.                             00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            AUGUST, 2003.                            00080000
000900 DATE-COMPILED.                                                   00090000
001000***************************************************************** 00100000
001200*                                                               * 00120000
001300*  THIS PROGRAM WILL CREATE AN EXTRACT FILE CONTAINING SML'S    * 00130000
001400*  CREATED MORE THAN X(PARM VALUE) NUMBER OF MONTHS OLD.        * 00140000
001410*  IT WILL CREATE AN EXTRACT RECORD FOR EACH PO-RCVR IN THE     * 00141000
001420*  OUTBOUND CARTON INDICATING IF THE RECEIVER WAS VERIFIED      * 00142000
001430*  MOVE THAN 6 MONTHS AGO.  THIS WILL BE USED TO PURGE THE      * 00143000
001440*  OUTBOUND DATABASES.                                          * 00144000
001500***************************************************************** 00150000
002000***************************************************************** 00200000
002100 ENVIRONMENT DIVISION.                                            00210000
002200***************************************************************** 00220000
002300                                                                  00230000
002400 CONFIGURATION SECTION.                                           00240000
002500                                                                  00250000
002600 SOURCE-COMPUTER.        IBM-3090.                                00260000
002700 OBJECT-COMPUTER.        IBM-3090.                                00270000
002800                                                                  00280000
002900 INPUT-OUTPUT SECTION.                                            00290000
003000                                                                  00300000
003100 FILE-CONTROL.                                                    00310000
003200*                                                                 00320000
003600     SELECT SU-OTBND-EXTRACT-FILE                                 00360000
003700         ASSIGN TO OUT01.                                         00370000
004100*                                                                 00410000
004200***************************************************************** 00420000
004300 DATA DIVISION.                                                   00430000
004400***************************************************************** 00440000
004500*                                                                 00450000
004600 FILE SECTION.                                                    00460000
004700*                                                                 00470000
005500 FD  SU-OTBND-EXTRACT-FILE                                        00550000
005600     RECORDING MODE IS F                                          00560000
005700     BLOCK CONTAINS 0  RECORDS.                                   00570000
005800 01  SU-OTBND-EXTRACT-RECORD         PIC  X(100).                 00580001
005900*                                                                 00590000
006600                                                                  00660000
006700 WORKING-STORAGE SECTION.                                         00670000
006800*                                                                 00680000
006900 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00690000
007000                                                   COMP SYNC.     00700000
007100*                                                                 00710000
007200 01  PROGRAM-SWITCHES.                                            00720000
007300     05  PS-EOF-SML-CURSOR-SW        PIC  X(01)    VALUE 'N'.     00730000
007400         88  PS-EOF-SML-CSR                        VALUE 'Y'.     00740000
007500         88  PS-NOT-EOF-SML-CSR                    VALUE 'N'.     00750000
007510     05  PS-EOF-UPC-CURSOR-SW        PIC  X(01)    VALUE 'N'.     00751000
007520         88  PS-EOF-UPC-CSR                        VALUE 'Y'.     00752000
007530         88  PS-NOT-EOF-UPC-CSR                    VALUE 'N'.     00753000
007540                                                                  00754005
007550 01  PC-PROGRAM-CONSTANTS.                                        00755005
007560     05  PC-CURRENT-PROGRAM-NAME    PIC  X(08)     VALUE          00756005
007570                                                   'SUKUT093'.    00757005
008740                                                                  00874002
009500 01  PV-PROGRAM-VARIABLES.                                        00950002
009510     05  PV-DISPLAY-PURGE-WEEKS      PIC  Z(09).                  00951005
009520     05  PV-PURGE-TMST               PIC  X(26).                  00952004
009521     05  PV-PURGE-DATE               PIC  X(10).                  00952113
009522                                                                  00952213
009530     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  00953005
009531     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  00953105
009540     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  00954005
009541                                                                  00954105
009590     05  PV-SML-FETCH-CNT            PIC  9(09)    VALUE ZERO.    00959006
009610     05  PV-UPC-FETCH-CNT            PIC  9(09)    VALUE ZERO.    00961006
009700     05  PV-SML-OUTPUT-CNT           PIC  9(09)    VALUE ZERO.    00970011
009810     05  PV-UPC-OUTPUT-CNT           PIC  9(09)    VALUE ZERO.    00981011
009820     05  PV-TOTAL-CNT                PIC  9(09)    VALUE ZERO.    00982013
009830     05  PV-DE-COUNT                 PIC  9(09)    VALUE ZERO.    00983015
009840     05  PV-NO-RCVR-COUNT            PIC  9(09)    VALUE ZERO.    00984015
011400                                                                  01140002
011500 01  DK-DB-KEYS.                                                  01150002
011600     05  DK-PURGE-WEEKS              PIC S9(09)  COMP.            01160002
012100                                                                  01210000
013200 01  VENDOR-EXTRACT-FILE.                                         01320000
013300     COPY SURD049.                                                01330001
013400                                                                  01340000
013410/                                                                 01341000
013450******************************************************************01345000
013460*  DB2 FORMATTED MESSAGE AREA                                     01346000
013470******************************************************************01347000
013480     COPY DPWS004.                                                01348015
013490                                                                  01349001
013600******************************************************************01360000
014200*  COPY BOOK FOR THE PARAMETER TABLE                              01420001
014210******************************************************************01421001
014400     EXEC SQL                                                     01440000
014500          INCLUDE TKRPRPM                                         01450001
014600     END-EXEC.                                                    01460000
015500                                                                  01550000
015501******************************************************************01550101
015502*  COPY BOOK FOR THE OUTBOUND SHIPPING UNIT TABLE                 01550202
015503******************************************************************01550301
015504     EXEC SQL                                                     01550401
015505          INCLUDE SUT00024                                        01550502
015506     END-EXEC.                                                    01550601
015507                                                                  01550701
015508******************************************************************01550802
015509*  COPY BOOK FOR THE OUTBOUND SHIPPING UNIT UPC TABLE             01550902
015510******************************************************************01551002
015511     EXEC SQL                                                     01551102
015512          INCLUDE SUT00028                                        01551202
015513     END-EXEC.                                                    01551302
015514                                                                  01551402
015515******************************************************************01551502
015516*  COPY BOOK FOR THE OUTBOUND SHIPPING UNIT VENDOR TABLE          01551602
015517******************************************************************01551702
015518     EXEC SQL                                                     01551802
015519          INCLUDE SUT00026                                        01551902
015520     END-EXEC.                                                    01552002
015521                                                                  01552102
015530******************************************************************01553001
015700*  COPY BOOK FOR THE RECEIVING TABLE                              01570000
015701******************************************************************01570101
015720     EXEC SQL                                                     01572000
015730          INCLUDE TRECEIV                                         01573000
015740     END-EXEC.                                                    01574000
015750                                                                  01575000
015751******************************************************************01575102
015752*  COPY BOOK FOR THE PACKSLIP TABLE                               01575202
015753******************************************************************01575302
015754     EXEC SQL                                                     01575402
015755          INCLUDE TPKSLIP                                         01575502
015756     END-EXEC.                                                    01575602
015757                                                                  01575702
015760******************************************************************01576001
017500*  DB2 COMMUNICATION AREA                                         01750000
017510******************************************************************01751001
017700     EXEC SQL                                                     01770000
017800         INCLUDE SQLCA                                            01780000
017900     END-EXEC.                                                    01790000
018000                                                                  01800001
018010******************************************************************01801001
018100*  DB2 COMMUNICATION AREA2                                        01810000
018110******************************************************************01811001
018300     COPY SQLCA2.                                                 01830015
018500                                                                  01850000
018600                                                                  01860000
018700     EXEC SQL                                                     01870000
018800       DECLARE SML-CSR CURSOR FOR                                 01880002
018900         SELECT SHIPT_UNT_ID                                      01890002
019000               ,DEST_LOC_NBR                                      01900002
019500          FROM  SUT_OTBND_CART                                    01950002
019700          WHERE CRE_DTE < (CURRENT DATE -                         01970003
019800                           (:DK-PURGE-WEEKS * 7) DAYS)            01980004
019900     END-EXEC.                                                    01990000
020000                                                                  02000000
020100                                                                  02010002
020200     EXEC SQL                                                     02020002
020300       DECLARE UPC-CSR CURSOR FOR                                 02030002
020400         SELECT DISTINCT(TRN_NBR)                                 02040002
020510               ,RCVR_SEQ_NBR                                      02051002
020600          FROM  SUT_OTBND_UPC                                     02060002
020700          WHERE SHIPT_UNT_ID  =  :SUT00024-SHIPT-UNT-ID           02070002
020800     END-EXEC.                                                    02080002
020900                                                                  02090002
022700                                                                  02270000
022800                                                                  02280000
022900*                                                                 02290000
023000 PROCEDURE DIVISION.                                              02300000
023100*                                                                 02310000
023200 0000-MAINLINE-PROCESSING.                                        02320000
023300******************************************************************02330000
023400**  THIS IS THE MAIN DRIVER FOR THE PROGRAM.                      02340000
023500******************************************************************02350000
023600                                                                  02360002
023610     PERFORM 1000-INITIALIZATION.                                 02361000
023630                                                                  02363002
023640     PERFORM 2000-PROCESS-SML                                     02364002
023650       UNTIL PS-EOF-SML-CSR.                                      02365005
023670                                                                  02367002
023671     PERFORM 2300-CLOSE-SML-CSR.                                  02367102
023672                                                                  02367213
023673     ADD  PV-SML-OUTPUT-CNT                                       02367313
023674          PV-UPC-OUTPUT-CNT                                       02367413
023675     GIVING  PV-TOTAL-CNT.                                        02367513
023676                                                                  02367613
023677     DISPLAY 'SML FETCHED=' PV-SML-FETCH-CNT   '  **'.            02367710
023679     DISPLAY 'UPC FETCHED=' PV-UPC-FETCH-CNT   '  **'.            02367910
023680     DISPLAY '                                 '.                 02368013
023681     DISPLAY 'EMPTY SML  =' PV-SML-OUTPUT-CNT  '  **'.            02368110
023683     DISPLAY 'UPC WRITTEN=' PV-UPC-OUTPUT-CNT  '  **'             02368310
023686     DISPLAY 'TOTAL OUT  =' PV-TOTAL-CNT       '  **'             02368613
023687     DISPLAY '                                 '.                 02368715
023688     DISPLAY 'NO RCVR    =' PV-NO-RCVR-COUNT   '  **'             02368815
023689     DISPLAY 'DE RCVR    =' PV-DE-COUNT        '  **'             02368915
023690                                                                  02369013
023691     CLOSE SU-OTBND-EXTRACT-FILE.                                 02369113
023692                                                                  02369213
023693     GOBACK.                                                      02369313
023694                                                                  02369413
023700                                                                  02370002
023800 1000-INITIALIZATION.                                             02380000
023900******************************************************************02390000
024000**  PERFORM THE INITIAL PROCESSING FOR THE PROGRAM.               02400000
024100******************************************************************02410000
024200                                                                  02420000
024400     OPEN OUTPUT SU-OTBND-EXTRACT-FILE.                           02440002
024600                                                                  02460000
024700     PERFORM 7000-GET-PURGE-WEEKS.                                02470002
024800                                                                  02480000
025000     DISPLAY '** SUKUT093 **'.                                    02500008
025100     DISPLAY '** PURGE ' PV-DISPLAY-PURGE-WEEKS ' WEEKS **'.      02510008
025200     DISPLAY '** DATE  ' PV-PURGE-DATE.                           02520013
025500                                                                  02550000
025510     SET  PS-NOT-EOF-SML-CSR                                      02551002
025520          PS-NOT-EOF-UPC-CSR  TO  TRUE.                           02552002
025530                                                                  02553002
025600     PERFORM 2100-OPEN-SML-CSR.                                   02560002
025610     PERFORM 2200-FETCH-SML-CSR.                                  02561002
025620                                                                  02562002
025630                                                                  02563002
025700*                                                                 02570000
025800 2000-PROCESS-SML.                                                02580005
025801                                                                  02580102
025810     SET PS-NOT-EOF-UPC-CSR  TO  TRUE.                            02581002
025830     INITIALIZE  SU049-EXTRACT-RECORD.                            02583002
025840                                                                  02584002
025850     MOVE SUT00024-SHIPT-UNT-ID  TO  SU049-SML                    02585012
025851                                     SU049-DISPLAY-SML.           02585112
025860     MOVE SUT00024-DEST-LOC-NBR  TO  SU049-DEST.                  02586002
025870     SET  SU049-PURGE-YES        TO  TRUE.                        02587002
025900                                                                  02590002
026000     PERFORM 2400-OPEN-UPC-CSR.                                   02600005
026100     PERFORM 2500-FETCH-UPC-CSR.                                  02610005
026110                                                                  02611002
026120     IF  PS-EOF-UPC-CSR                                           02612002
026121         SET  SU049-PURGE-YES    TO  TRUE                         02612102
026122         ADD  1  TO  PV-SML-OUTPUT-CNT                            02612206
026123         PERFORM 2600-CLOSE-UPC-CSR                               02612302
026124         PERFORM 8000-WRITE-EXTRACT-RECORD                        02612402
026130     ELSE                                                         02613002
026200         PERFORM 3000-PROCESS-UPC-CSR                             02620005
026300           UNTIL PS-EOF-UPC-CSR                                   02630002
026301         PERFORM 2600-CLOSE-UPC-CSR                               02630102
026310     END-IF.                                                      02631002
026400                                                                  02640002
026501                                                                  02650102
026502     PERFORM 2200-FETCH-SML-CSR.                                  02650202
026503                                                                  02650302
026510                                                                  02651002
026600 2100-OPEN-SML-CSR.                                               02660002
026700     MOVE '2100-OPEN-SML-CSR'    TO PV-ABEND-PARAGRAPH.           02670002
026800                                                                  02680002
027000     EXEC SQL                                                     02700002
027100          OPEN SML-CSR                                            02710002
027200     END-EXEC.                                                    02720002
027800                                                                  02780000
027900     EVALUATE TRUE                                                02790000
028000         WHEN SQLCODE = 0                                         02800002
028200             CONTINUE                                             02820000
028300         WHEN SQLWARN0 NOT = SPACES                               02830000
028400         WHEN SQLCODE < ZERO                                      02840000
028500         WHEN SQLCODE > ZERO                                      02850000
028600             MOVE '2100-OPEN-SML-CSR'                             02860002
028700                             TO PV-PARAGRAPH-NAME                 02870000
028800             MOVE 'OPEN THE SML_CURSOR            '               02880002
028900                             TO PV-DB2-OPERATION-ATTEMPTED        02890000
029000             PERFORM 9100-SQL-ABEND                               02900000
029100     END-EVALUATE.                                                02910000
029200                                                                  02920000
029210                                                                  02921002
029300 2200-FETCH-SML-CSR.                                              02930002
029400     MOVE '2200-FETCH-SML-CSR'   TO PV-ABEND-PARAGRAPH.           02940002
029500                                                                  02950002
029700     EXEC SQL                                                     02970002
029800          FETCH SML-CSR                                           02980002
029900          INTO  :SUT00024-SHIPT-UNT-ID                            02990002
030000              , :SUT00024-DEST-LOC-NBR                            03000002
030500     END-EXEC.                                                    03050002
031700                                                                  03170000
031800     EVALUATE TRUE                                                03180000
031900       WHEN SQLCODE = ZEROS                                       03190000
031910            ADD  1  TO  PV-SML-FETCH-CNT                          03191006
032100       WHEN SQLCODE = +100                                        03210000
032200            SET PS-EOF-SML-CSR  TO TRUE                           03220006
032300       WHEN SQLWARN0 NOT = SPACES                                 03230000
032400       WHEN SQLCODE < ZERO                                        03240000
032500       WHEN SQLCODE > ZERO                                        03250000
032600           MOVE '2200-FETCH-SML-CSR'                              03260002
032700                               TO PV-PARAGRAPH-NAME               03270000
032800           MOVE 'FETCH SML CURSOR '                               03280002
032900                               TO PV-DB2-OPERATION-ATTEMPTED      03290000
033000           PERFORM 9100-SQL-ABEND                                 03300000
033100     END-EVALUATE.                                                03310000
033200                                                                  03320000
033210                                                                  03321002
038500 2300-CLOSE-SML-CSR.                                              03850002
038600     MOVE '2300-CLOSE-SML-CSR'   TO PV-ABEND-PARAGRAPH.           03860002
038700                                                                  03870002
038900     EXEC SQL                                                     03890002
039000         CLOSE SML-CSR                                            03900002
039100     END-EXEC.                                                    03910002
039700                                                                  03970000
039800     EVALUATE TRUE                                                03980000
039810         WHEN SQLCODE = ZERO                                      03981002
039900         WHEN SQLCODE = -904                                      03990000
040000         WHEN SQLCODE = -911                                      04000000
040100              CONTINUE                                            04010002
040200         WHEN SQLWARN0 NOT = SPACES                               04020000
040300         WHEN SQLCODE < ZERO                                      04030000
040400         WHEN SQLCODE > ZERO                                      04040000
040500              MOVE '2300-CLOSE-SML-CSR'                           04050002
040600                              TO PV-PARAGRAPH-NAME                04060002
040700              MOVE 'CLOSE THE SML-CSR              '              04070002
040800                              TO PV-DB2-OPERATION-ATTEMPTED       04080002
040900              PERFORM 9100-SQL-ABEND                              04090002
041200     END-EVALUATE.                                                04120000
041300                                                                  04130002
041310                                                                  04131002
041320 2400-OPEN-UPC-CSR.                                               04132002
041330     MOVE '2400-OPEN-UPC-CSR'    TO PV-ABEND-PARAGRAPH.           04133002
041340                                                                  04134002
041350     EXEC SQL                                                     04135002
041360          OPEN UPC-CSR                                            04136002
041370     END-EXEC.                                                    04137002
041380                                                                  04138002
041390     EVALUATE TRUE                                                04139002
041391         WHEN SQLCODE = 0                                         04139102
041392             CONTINUE                                             04139202
041393         WHEN SQLWARN0 NOT = SPACES                               04139302
041394         WHEN SQLCODE < ZERO                                      04139402
041395         WHEN SQLCODE > ZERO                                      04139502
041396             MOVE '2400-OPEN-UPC-CSR'                             04139602
041397                             TO PV-PARAGRAPH-NAME                 04139702
041398             MOVE 'OPEN THE UPC_CSR               '               04139802
041399                             TO PV-DB2-OPERATION-ATTEMPTED        04139902
041400             PERFORM 9100-SQL-ABEND                               04140002
041401     END-EVALUATE.                                                04140102
041402                                                                  04140202
041403                                                                  04140302
041404 2500-FETCH-UPC-CSR.                                              04140402
041405     MOVE '2500-FETCH-UPC-CSR'   TO PV-ABEND-PARAGRAPH.           04140502
041406                                                                  04140602
041407     EXEC SQL                                                     04140702
041408          FETCH UPC-CSR                                           04140802
041411          INTO  :SUT00028-TRN-NBR                                 04141102
041412              , :SUT00028-RCVR-SEQ-NBR                            04141202
041413     END-EXEC.                                                    04141302
041414                                                                  04141402
041415     EVALUATE TRUE                                                04141502
041416       WHEN SQLCODE = ZEROS                                       04141602
041417            ADD  1  TO  PV-UPC-FETCH-CNT                          04141706
041419       WHEN SQLCODE = +100                                        04141902
041420            SET PS-EOF-UPC-CSR  TO TRUE                           04142006
041421       WHEN SQLWARN0 NOT = SPACES                                 04142102
041422       WHEN SQLCODE < ZERO                                        04142202
041423       WHEN SQLCODE > ZERO                                        04142302
041424           MOVE '2500-FETCH-UPC-CSR'                              04142402
041425                               TO PV-PARAGRAPH-NAME               04142502
041426           MOVE 'FETCH UPC CURSOR '                               04142602
041427                               TO PV-DB2-OPERATION-ATTEMPTED      04142702
041428           PERFORM 9100-SQL-ABEND                                 04142802
041429     END-EVALUATE.                                                04142902
041430                                                                  04143002
041431                                                                  04143102
041432 2600-CLOSE-UPC-CSR.                                              04143202
041433     MOVE '2600-CLOSE-UPC-CSR'   TO PV-ABEND-PARAGRAPH.           04143302
041434                                                                  04143402
041435     EXEC SQL                                                     04143502
041436         CLOSE UPC-CSR                                            04143602
041437     END-EXEC.                                                    04143702
041438                                                                  04143802
041439     EVALUATE TRUE                                                04143902
041440         WHEN SQLCODE = ZERO                                      04144002
041441         WHEN SQLCODE = -904                                      04144102
041442         WHEN SQLCODE = -911                                      04144202
041443              CONTINUE                                            04144302
041444         WHEN SQLWARN0 NOT = SPACES                               04144402
041445         WHEN SQLCODE < ZERO                                      04144502
041446         WHEN SQLCODE > ZERO                                      04144602
041447              MOVE '2600-CLOSE-UPC-CSR'                           04144702
041448                              TO PV-PARAGRAPH-NAME                04144802
041449              MOVE 'CLOSE THE UPC-CSR              '              04144902
041450                              TO PV-DB2-OPERATION-ATTEMPTED       04145002
041451              PERFORM 9100-SQL-ABEND                              04145102
041452     END-EVALUATE.                                                04145202
041453                                                                  04145302
041454                                                                  04145402
041455 3000-PROCESS-UPC-CSR.                                            04145505
046700                                                                  04670000
046701     MOVE SUT00028-TRN-NBR       TO  SU049-PO-NBR                 04670112
046702                                     SU049-DISPLAY-PO.            04670212
046703     MOVE SUT00028-RCVR-SEQ-NBR  TO  SU049-RCVR-SEQ-NBR           04670312
046704                                     SU049-DISPLAY-RCVR.          04670412
046710                                                                  04671002
046720     IF  SU049-PO-NBR        =  ZEROES                            04672002
046721         CONTINUE                                                 04672102
046724     ELSE                                                         04672402
046725     IF  SU049-RCVR-SEQ-NBR  =  ZEROES                            04672502
046730         PERFORM 3100-GET-RCVR-NBR                                04673002
046731         MOVE  PKSLIP-REC-SEQ-NBR  TO  SU049-RCVR-SEQ-NBR         04673102
046732                                       SU049-DISPLAY-RCVR         04673212
046733     END-IF                                                       04673312
046734     END-IF                                                       04673412
046740                                                                  04674002
046741     IF  SU049-PO-NBR        =  ZEROES  OR                        04674102
046742         SU049-RCVR-SEQ-NBR  =  ZEROES                            04674202
046743         SET  SU049-PURGE-YES    TO  TRUE                         04674302
046744         ADD  1  TO  PV-UPC-OUTPUT-CNT                            04674406
046745         PERFORM 8000-WRITE-EXTRACT-RECORD                        04674502
046746     ELSE                                                         04674602
046747         PERFORM 3200-CHECK-VRFY-DATE                             04674702
046748                                                                  04674815
046749*** DMH - ADDED 3/16/09  - BEGIN                                  04674915
046750         IF  SQLCODE  =  +100                                     04675015
046751             SET  SU049-PURGE-YES    TO  TRUE                     04675115
046752             ADD  1  TO  PV-NO-RCVR-COUNT                         04675215
046753             PERFORM 8000-WRITE-EXTRACT-RECORD                    04675315
046754         ELSE                                                     04675415
046755             IF  RECEIV-STATUS-CDE  =  'DE'                       04675515
046756                 SET  SU049-PURGE-YES    TO  TRUE                 04675615
046757                 ADD  1  TO  PV-DE-COUNT                          04675715
046758                 PERFORM 8000-WRITE-EXTRACT-RECORD                04675815
046759             ELSE                                                 04675915
046760*** DMH - ADDED 3/16/09 - END                                     04676015
046761                                                                  04676115
046762                 IF  RECEIV-STATUS-CDE  =  'VE'  AND              04676215
046763                     RECEIV-VERFYD-TMST <  PV-PURGE-TMST          04676315
046764                     SET  SU049-PURGE-YES    TO  TRUE             04676415
046765                     ADD  1  TO  PV-UPC-OUTPUT-CNT                04676515
046766                     PERFORM 8000-WRITE-EXTRACT-RECORD            04676615
046767                 ELSE                                             04676715
046768                     SET  SU049-PURGE-NO     TO  TRUE             04676815
046769                     ADD  1  TO  PV-UPC-OUTPUT-CNT                04676915
046770                     PERFORM 8000-WRITE-EXTRACT-RECORD            04677015
046771                 END-IF                                           04677115
046772             END-IF                                               04677215
046773         END-IF                                                   04677315
046774     END-IF.                                                      04677402
046780                                                                  04678002
046790     PERFORM 2500-FETCH-UPC-CSR.                                  04679002
046791                                                                  04679102
046792                                                                  04679202
046793 3100-GET-RCVR-NBR.                                               04679302
046794                                                                  04679402
046795     EXEC SQL                                                     04679502
046796         SELECT A.REC_SEQ_NBR                                     04679604
046797           INTO :PKSLIP-REC-SEQ-NBR                               04679702
046798           FROM TPKSLIP A                                         04679802
046799               ,SUT_OTBND_VND B                                   04679902
046800          WHERE B.SHIPT_UNT_ID = :SUT00024-SHIPT-UNT-ID           04680002
046801            AND B.PO_NBR       = :SUT00028-TRN-NBR                04680102
046802            AND A.PO_NBR       = B.PO_NBR                         04680202
046803            AND A.SEQ_NBR      = B.PKSL_SEQ_NBR                   04680302
046804            AND A.VER_STAT_CDE = 'A'                              04680402
046806     END-EXEC.                                                    04680602
046807                                                                  04680702
046808     EVALUATE TRUE                                                04680802
046809         WHEN SQLCODE = ZEROS                                     04680902
046810              CONTINUE                                            04681002
046811         WHEN SQLCODE = +100                                      04681102
046812              MOVE 0  TO PKSLIP-REC-SEQ-NBR                       04681202
046816         WHEN SQLWARN0 NOT = SPACES                               04681602
046817         WHEN SQLCODE < ZERO                                      04681702
046818         WHEN SQLCODE > ZERO                                      04681802
046819             MOVE '3100-GET-RCVR-NBR'                             04681902
046820                             TO PV-PARAGRAPH-NAME                 04682002
046821             MOVE 'GET RECEIVER FROM PKSLIP       '               04682102
046822                             TO PV-DB2-OPERATION-ATTEMPTED        04682202
046826             PERFORM 9100-SQL-ABEND                               04682602
046827          WHEN SQLCODE = ZERO                                     04682702
046828              CONTINUE                                            04682802
046829     END-EVALUATE.                                                04682902
046830                                                                  04683002
046831                                                                  04683102
046832 3200-CHECK-VRFY-DATE.                                            04683202
046833                                                                  04683302
046834     EXEC SQL                                                     04683402
046835         SELECT  STATUS_CDE                                       04683502
046836                ,VERFYD_TMST                                      04683602
046837                ,(CURRENT DATE -                                  04683704
046838                  (:DK-PURGE-WEEKS * 7) DAYS)                     04683804
046839           INTO :RECEIV-STATUS-CDE                                04683904
046840               ,:RECEIV-VERFYD-TMST                               04684004
046841               ,:PV-PURGE-TMST                                    04684104
046842           FROM TRECEIV A                                         04684204
046843          WHERE ORD_NBR      = :SU049-PO-NBR                      04684302
046844            AND REC_SEQ_NBR  = :SU049-RCVR-SEQ-NBR                04684402
046846     END-EXEC.                                                    04684602
046847                                                                  04684702
046848     EVALUATE TRUE                                                04684802
046849         WHEN SQLCODE = ZEROS                                     04684902
046850         WHEN SQLCODE = +100                                      04685002
046851              CONTINUE                                            04685102
046854         WHEN SQLWARN0 NOT = SPACES                               04685402
046855         WHEN SQLCODE < ZERO                                      04685502
046856         WHEN SQLCODE > ZERO                                      04685602
046857             MOVE '3200-CHECK-VRFY-DATE'                          04685702
046858                             TO PV-PARAGRAPH-NAME                 04685802
046859             MOVE 'GET RECEIVER FROM PKSLIP       '               04685902
046860                             TO PV-DB2-OPERATION-ATTEMPTED        04686002
046861             PERFORM 9100-SQL-ABEND                               04686102
046863     END-EVALUATE.                                                04686302
046864                                                                  04686402
046865                                                                  04686502
046866 7000-GET-PURGE-WEEKS.                                            04686605
046867                                                                  04686705
046868     EXEC SQL                                                     04686805
046869         SELECT  FUNC_QTY                                         04686905
046873           INTO :DK-PURGE-WEEKS                                   04687305
046876           FROM TKRPRPM                                           04687605
046877          WHERE LOC_ID            =  90                           04687705
046878            AND INTFC_SYS_CDE     = 'KHL'                         04687805
046879            AND SYS_PRC_FUNC_CDE  = 'OTPURG'                      04687905
046880            AND FUNC_PRC_STAT_CDE = 'AC'                          04688005
046882     END-EXEC.                                                    04688205
046883                                                                  04688305
046884     EVALUATE TRUE                                                04688405
046885         WHEN SQLCODE = ZEROS                                     04688505
046886              MOVE  DK-PURGE-WEEKS  TO  PV-DISPLAY-PURGE-WEEKS    04688605
046887              PERFORM 7100-GET-PURGE-DATE                         04688713
046888         WHEN SQLCODE = +100                                      04688805
046889              CONTINUE                                            04688905
046890         WHEN SQLWARN0 NOT = SPACES                               04689005
046891         WHEN SQLCODE < ZERO                                      04689105
046892         WHEN SQLCODE > ZERO                                      04689205
046893             MOVE '7000-GET-PURGE-WEEKS'                          04689305
046894                             TO PV-PARAGRAPH-NAME                 04689405
046895             MOVE 'GET NUMBER OF WEEKS TO PURGE   '               04689505
046896                             TO PV-DB2-OPERATION-ATTEMPTED        04689605
046897             PERFORM 9100-SQL-ABEND                               04689705
046898     END-EVALUATE.                                                04689805
046899                                                                  04689905
046900                                                                  04690013
046910 7100-GET-PURGE-DATE.                                             04691013
046911                                                                  04691113
046920     EXEC SQL                                                     04692013
046930         SELECT  (CURRENT_DATE -                                  04693013
046960                  (:DK-PURGE-WEEKS * 7) DAYS)                     04696013
046970           INTO :PV-PURGE-DATE                                    04697013
046991           FROM TKRPRPM                                           04699113
046992          WHERE LOC_ID            =  90                           04699214
046993            AND INTFC_SYS_CDE     = 'KHL'                         04699314
046994            AND SYS_PRC_FUNC_CDE  = 'OTPURG'                      04699414
046995            AND FUNC_PRC_STAT_CDE = 'AC'                          04699514
046996     END-EXEC.                                                    04699613
046997                                                                  04699713
046998     EVALUATE TRUE                                                04699813
046999         WHEN SQLCODE = ZEROS                                     04699913
047000         WHEN SQLCODE = +100                                      04700013
047001              CONTINUE                                            04700113
047002         WHEN SQLWARN0 NOT = SPACES                               04700213
047003         WHEN SQLCODE < ZERO                                      04700313
047004         WHEN SQLCODE > ZERO                                      04700413
047005             MOVE '7100-GET-PURGE-DATE '                          04700513
047006                             TO PV-PARAGRAPH-NAME                 04700613
047007             MOVE 'CALCULATE PURGE DATE           '               04700713
047008                             TO PV-DB2-OPERATION-ATTEMPTED        04700813
047009             PERFORM 9100-SQL-ABEND                               04700913
047010     END-EVALUATE.                                                04701013
047020                                                                  04702005
047100                                                                  04710013
071800 8000-WRITE-EXTRACT-RECORD.                                       07180002
071900     WRITE SU-OTBND-EXTRACT-RECORD                                07190002
072000       FROM SU049-EXTRACT-RECORD.                                 07200002
072400                                                                  07240002
073000                                                                  07300000
073100 9100-SQL-ABEND.                                                  07310000
073200******************************************************************07320000
073300*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    07330000
073400*  ERROR OR WARNING CODE OCCURS.                                  07340000
073500******************************************************************07350000
073600     DISPLAY '9100-SQL-ABEND'.                                    07360000
073700     DISPLAY '** ABEND     **'.                                   07370000
073800     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        07380000
073900     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              07390000
074000     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     07400000
074100                                                                  07410000
074200******************************************************************07420000
074300* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    07430000
074400* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         07440000
074500* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     07450000
074600* FORMAT.                                                         07460000
074700******************************************************************07470000
074800     COPY DPPD004.                                                07480000
074900                                                                  07490000
075000     MOVE +4013                  TO ABEND-CODE.                   07500000
075100     CALL 'ILBOABN0' USING ABEND-CODE.                            07510000
075200                                                                  07520000
