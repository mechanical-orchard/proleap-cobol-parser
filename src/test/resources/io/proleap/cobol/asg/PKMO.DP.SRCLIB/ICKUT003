000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.      ICKUT003.                                       00030000
000400 AUTHOR.          STEVEN NOWAK.                                   00040000
000500 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00050000
000600 DATE-WRITTEN.    04/15/10.                                       00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900******************************************************************00090000
001000*         SUM GROUP LEVEL COUNTS TO ICT_LOC_CNT_SUM TABLE         00100000
001100*=================================================================00110000
001200* THIS PROGRAM WILL READ A FILE CREATED BY PROGRAM ICKUP055       00120000
001300* WHERE THE ICRD057-EXEC-LVL-CDE > SPACE, SUM THE QTY'S ON THE    00130000
001400* ICT_SKU_LOC_CNT TABLE BY THE LEVEL (MAJOR CLASS, SUB CLASS      00140000
001500* OR STYLE) SPECIFIED IN THE ICRD057-EXEC-LVL-CDE FIELD AND       00150000
001600* WRITE OUT AN INSERT ROW OF THESE SUMMED QTYS FOR INSERT INTO    00160000
001700* THE ICT_LOC_CNT_SUM TABLE.                                      00170000
001800*                                                                 00180000
001900*========================== CHANGE LOG ===========================00190000
002000*  AUTH        BY        DATE                 DESCRIPTION         00200000
002100*=================================================================00210000
002200* WR37120     S. NOWAK   04-15-10   CREATE PROGRAM                00220000
002300*                                                                 00230000
IC5389* INC 1275389 COGNIZANT  06-07-10   MODIFIED PROGRAM TO INITIALIZE00240000
IC5389* TAG : IC5389                      THE OUTPUT RECORD BEFORE EVERY00250000
IC5389*                                   WRITE.                        00260000
IC5389*                                                                 00270000
008801* PKE 08801   COGNIZANT  08-11-11   MODIFIED MDSE_EXPRN_DTE TO    00280009
008801*                                   CHECK GREATER THAN EQUAL TO   00290009
008801*                                   CURRENT DATE.THIS IS DONE TO  00300009
008801*                                   FIX ON HANDS ISSUE THAT SHOWS 00310009
008801*                                   DIFFERENCE WITH ACCEPTED QTY. 00320009
002400******************************************************************00330000
002500                                                                  00340000
002600 ENVIRONMENT DIVISION.                                            00350000
002700 CONFIGURATION SECTION.                                           00360000
002800                                                                  00370000
002900 SOURCE-COMPUTER. IBM-3090.                                       00380000
003000 OBJECT-COMPUTER. IBM-3090.                                       00390000
003100                                                                  00400000
003200 INPUT-OUTPUT SECTION.                                            00410000
003300 FILE-CONTROL.                                                    00420000
003400                                                                  00430000
003500     SELECT MAINT-FILE ASSIGN TO INP01.                           00440000
003600     SELECT UPDT-FILE  ASSIGN TO OUT01.                           00450000
003700                                                                  00460000
003800 DATA DIVISION.                                                   00470000
003900 FILE SECTION.                                                    00480000
004000                                                                  00490000
004100 FD  MAINT-FILE                                                   00500000
004200     LABEL RECORDS ARE STANDARD                                   00510000
004300     RECORDING MODE IS F                                          00520000
004400     BLOCK CONTAINS 0 RECORDS                                     00530000
004500     DATA RECORD IS MAINT-FILE.                                   00540000
004600                                                                  00550000
004700 01  MAINT-REC                        PIC  X(60).                 00560000
004800                                                                  00570000
004900 FD  UPDT-FILE                                                    00580000
005000     LABEL RECORDS ARE STANDARD                                   00590000
005100     RECORDING MODE IS F                                          00600000
005200     BLOCK CONTAINS 0 RECORDS                                     00610000
005300     DATA RECORD IS MAINT-FILE.                                   00620000
005400                                                                  00630000
005500 01  UPDT-REC                         PIC  X(82).                 00640000
005600                                                                  00650000
005700                                                                  00660000
005800******************************************************************00670000
005900*                       WORKING STORAGE                           00680000
006000******************************************************************00690000
006100 WORKING-STORAGE SECTION.                                         00700000
006200                                                                  00710000
006300 01  W-START                          PIC  X(40)                  00720000
006400     VALUE 'ICKUT003 - WORKING STORAGE BEGINS HERE'.              00730000
006500                                                                  00740000
006600******************************************************************00750000
006700*                         SWITCHES                                00760000
006800******************************************************************00770000
006900 01  PS-PROGRAM-SWITCHES.                                         00780000
007000     05  PS-END-OF-FILE-SW            PIC  X(01) VALUE 'N'.       00790000
007100         88  PS-END-OF-FILE                      VALUE 'Y'.       00800000
007200                                                                  00810000
007300     05  PS-PROCESS-STOP-SW           PIC  X(01) VALUE 'N'.       00820000
007400         88  PS-PROCESS-STOP                     VALUE 'Y'.       00830000
007500                                                                  00840000
007600     05  PS-MORE-MJCL-SUM-CNT-SW      PIC  X(01) VALUE 'N'.       00850000
007700         88  PS-MORE-MJCL-SUM-CNT                VALUE 'Y'.       00860000
007800         88  PS-NO-MORE-MJCL-SUM-CNT             VALUE 'N'.       00870000
007900     05  PS-MORE-SBCL-SUM-CNT-SW      PIC  X(01) VALUE 'N'.       00880000
008000         88  PS-MORE-SBCL-SUM-CNT                VALUE 'Y'.       00890000
008100         88  PS-NO-MORE-SBCL-SUM-CNT             VALUE 'N'.       00900000
008200     05  PS-MORE-STYL-SUM-CNT-SW      PIC  X(01) VALUE 'N'.       00910000
008300         88  PS-MORE-STYL-SUM-CNT                VALUE 'Y'.       00920000
008400         88  PS-NO-MORE-STYL-SUM-CNT             VALUE 'N'.       00930000
008500                                                                  00940000
008600******************************************************************00950000
008700*                       ACCUMULATORS                              00960000
008800******************************************************************00970000
008900 01  PA-PROGRAM-ACCUMS.                                           00980000
009000     05  PA-READ                      PIC  9(09) VALUE ZERO.      00990000
009100     05  PA-WRITTEN                   PIC  9(09) VALUE ZERO.      01000000
009200                                                                  01010000
009300     05  PA-MJCL-SUM-CNTS             PIC  9(09) VALUE ZEROS.     01020000
009400     05  PA-SBCL-SUM-CNTS             PIC  9(09) VALUE ZEROS.     01030000
009500     05  PA-STYL-SUM-CNTS             PIC  9(09) VALUE ZEROS.     01040000
009600                                                                  01050000
009700     05  PA-SKU-CNTS                  PIC  9(09) VALUE ZEROS.     01060000
009800     05  PA-INVALID-CNTS              PIC  9(09) VALUE ZEROS.     01070000
009900                                                                  01080000
010000******************************************************************01090000
010100*                        CONSTANTS                                01100000
010200******************************************************************01110000
010300 01  PC-PROGRAM-CONSTANTS.                                        01120000
010400     05  PC-JOB-NAME                  PIC  X(08) VALUE 'ICK011  '.01130000
010500     05  PC-PGM-NAME                  PIC  X(08) VALUE 'ICKUT003'.01140000
010600                                                                  01150000
010700     05  PC-MAXIMUM-RETRY-COUNT       PIC S9(04) VALUE +2         01160000
010800                                                 COMP SYNC.       01170000
010900                                                                  01180000
011000     05  PC-DEFAULT-TMST              PIC  X(26) VALUE            01190000
011100                                 '2007-01-01-00.00.00.000000'.    01200000
011200                                                                  01210000
011300******************************************************************01220000
011400*                        VARIABLES                                01230000
011500******************************************************************01240000
011600 01  PV-WORK-VARIABLES.                                           01250000
011700     05  PV-RETRIES                   PIC S9(04) VALUE +0         01260000
011800                                                 COMP.            01270000
011900                                                                  01280000
012000     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACES.    01290000
012100     05  PV-OPERATION-MSG             PIC  X(30) VALUE SPACES.    01300000
012200                                                                  01310000
012300     05  PV-PLUS-MILSEC               PIC S9(04) COMP             01320000
012400                                                 VALUE 5000.      01330000
012500                                                                  01340000
012600******************************************************************01350000
012700*                        NULL INDICATORS                          01360000
012800******************************************************************01370000
012900 01  PV-NULL-IND.                                                 01380000
013000     05  PV-EXTR-PRC-TMST-NI          PIC S9(04) COMP             01390000
013100                                                 VALUE ZERO.      01400000
013200         88 PV-EXTR-PRC-TMST-IS-NOT-NULL         VALUE -1.        01410000
013300         88 PV-EXTR-PRC-TMST-IS-NULL             VALUE 0.         01420000
013400                                                                  01430000
013500     05  PV-DEPT-NBR-NI               PIC S9(04) COMP             01440000
013600                                                 VALUE ZERO.      01450000
013700         88 PV-DEPT-NBR-IS-NULL                  VALUE -1.        01460000
013800         88 PV-DEPT-NBR-IS-NOT-NULL              VALUE 0.         01470000
013900                                                                  01480000
014000     05  PV-MJCL-NBR-NI               PIC S9(04) COMP             01490000
014100                                                 VALUE ZERO.      01500000
014200         88 PV-MJCL-NBR-IS-NULL                  VALUE -1.        01510000
014300         88 PV-MJCL-NBR-IS-NOT-NULL              VALUE 0.         01520000
014400                                                                  01530000
014500     05  PV-SBCL-NBR-NI               PIC S9(04) COMP             01540000
014600                                                 VALUE ZERO.      01550000
014700         88 PV-SBCL-NBR-IS-NULL                  VALUE -1.        01560000
014800         88 PV-SBCL-NBR-IS-NOT-NULL              VALUE 0.         01570000
014900                                                                  01580000
015000     05  PV-STYL-NBR-NI               PIC S9(04) COMP             01590000
015100                                                 VALUE ZERO.      01600000
015200         88 PV-STYL-NBR-IS-NULL                  VALUE -1.        01610000
015300         88 PV-STYL-NBR-IS-NOT-NULL              VALUE 0.         01620000
015400                                                                  01630000
015500     05  PV-STD-TM-ZN-CDE-NI          PIC S9(04) COMP             01640000
015600                                                 VALUE ZERO.      01650000
015700         88 PV-STD-TM-ZN-CDE-IS-NULL             VALUE -1.        01660000
015800                                                                  01670000
015900                                                                  01680000
016000******************************************************************01690000
016100*               SYSTEM TIME AND DATE VARIABLES                    01700000
016200******************************************************************01710000
016300 01  SYS-DATE-TIME.                                               01720000
016400     05  SYS-DATE                     PIC  X(08) VALUE SPACES.    01730000
016500     05  SYS-TIME                     PIC  X(08) VALUE SPACES.    01740000
016600                                                                  01750000
016700 01  ST-BEG-TIME.                                                 01760000
016800     05  ST-BEG-HR                    PIC  9(02) VALUE ZEROS.     01770000
016900     05  FILLER                       PIC  X(01) VALUE ':'.       01780000
017000     05  ST-BEG-MN                    PIC  9(02) VALUE ZEROS.     01790000
017100                                                                  01800000
017200 01  ST-END-TIME.                                                 01810000
017300     05  ST-END-HR                    PIC  9(02) VALUE ZEROS.     01820000
017400     05  FILLER                       PIC  X(01) VALUE ':'.       01830000
017500     05  ST-END-MN                    PIC  9(02) VALUE ZEROS.     01840000
017600                                                                  01850000
017700 01  SD-EDIT-DATE.                                                01860000
017800     05  SD-MONTH                     PIC  9(02) VALUE ZEROS.     01870000
017900     05  FILLER                       PIC  X(01) VALUE '-'.       01880000
018000     05  SD-DAY                       PIC  9(02) VALUE ZEROS.     01890000
018100     05  FILLER                       PIC  X(01) VALUE '-'.       01900000
018200     05  SD-CENT                      PIC  9(02) VALUE ZEROS.     01910000
018300     05  SD-YEAR                      PIC  9(02) VALUE ZEROS.     01920000
018400                                                                  01930000
018500******************************************************************01940000
018600*                        ERROR HANDLING                           01950000
018700******************************************************************01960000
018800 01  ABEND-CODE                       PIC S9(04) VALUE ZERO       01970000
018900                                                 COMP SYNC.       01980000
019000     88  AC-DB2-ERROR                            VALUE +4013.     01990000
019100                                                                  02000000
019200                                                                  02010000
019300******************************************************************02020000
019400* INPUT COPYBOOK                                                  02030000
019500******************************************************************02040000
019600     COPY ICRD057.                                                02050000
019700                                                                  02060000
019800******************************************************************02070000
019900* OUTPUT COPYBOOK                                                 02080000
020000******************************************************************02090000
020100     COPY ICRD048.                                                02100000
020200                                                                  02110000
020300******************************************************************02120000
020400* TIMEZONE CONVERSION ROUTINE COPYBOOK                            02130000
020500******************************************************************02140000
020600     COPY ICWS010.                                                02150000
020700                                                                  02160000
020800******************************************************************02170000
020900* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         02180000
021000******************************************************************02190000
021100     COPY DPWS004.                                                02200000
021200                                                                  02210000
021300******************************************************************02220000
021400* DB2 MESSAGE AREA                                                02230000
021500******************************************************************02240000
021600     COPY SQLCA2.                                                 02250000
021700                                                                  02260000
021800******************************************************************02270000
021900*  DB2 COMMUNICATION AREA                                         02280000
022000******************************************************************02290000
022100     EXEC SQL                                                     02300000
022200        INCLUDE SQLCA                                             02310000
022300     END-EXEC.                                                    02320000
022400                                                                  02330000
022500******************************************************************02340000
022600*  XST_LOC TABLE                                                  02350000
022700******************************************************************02360000
022800     EXEC SQL                                                     02370000
022900          INCLUDE XST00001                                        02380000
023000     END-EXEC.                                                    02390000
023100                                                                  02400000
023200******************************************************************02410000
023300*  XST_SKU TABLE                                                  02420000
023400******************************************************************02430000
023500     EXEC SQL                                                     02440000
023600          INCLUDE XST00010                                        02450000
023700     END-EXEC.                                                    02460000
023800                                                                  02470000
023900******************************************************************02480000
024000*  XST_VND_STYL TABLE                                             02490000
024100******************************************************************02500000
024200     EXEC SQL                                                     02510000
024300          INCLUDE XST00013                                        02520000
024400     END-EXEC.                                                    02530000
024500                                                                  02540000
024600******************************************************************02550000
024700*  ICT_SKU_LOC_CNT TABLE                                          02560000
024800******************************************************************02570000
024900     EXEC SQL                                                     02580000
025000          INCLUDE ICT00011                                        02590000
025100     END-EXEC.                                                    02600000
025200                                                                  02610000
025300                                                                  02620000
025400******************************************************************02630000
025500*  USA IC COUNTS CURSOR TO SUM COUNT BY MAJOR CLASS               02640000
025600******************************************************************02650000
025700     EXEC SQL                                                     02660000
025800       DECLARE MJCL-SUM-CSR CURSOR FOR                            02670000
025900       SELECT  A.LOC_NBR                                          02680000
026000              ,A.CNT_STUP_ID                                      02690000
026100              ,A.EXEC_TMST                                        02700000
026200              ,C.DEPT_NBR                                         02710000
026300              ,C.MAJ_CL_NBR                                       02720000
026400              ,SUM(LOC_EXPTED_UNT_QTY)                            02730000
026500                                                                  02740000
026600       FROM  ICT_SKU_LOC_CNT A                                    02750000
026700            ,XST_SKU         B                                    02760000
026800            ,XST_VND_STYL    C                                    02770000
026900                                                                  02780000
027000       WHERE A.LOC_NBR      = :ICT00011-LOC-NBR                   02790000
027100         AND A.CNT_STUP_ID  = :ICT00011-CNT-STUP-ID               02800000
027200         AND A.CNT_SEQ_NBR  = :ICT00011-CNT-SEQ-NBR               02810000
027300         AND (A.MDSE_EXPRN_DTE IS NULL                            02820000
008801          OR  A.MDSE_EXPRN_DTE >= CURRENT DATE)                   02830009
027400         AND B.SKU_NBR      = A.SKU_NBR                           02840000
027500         AND C.STYL_ID      = B.STYL_ID                           02850000
027600                                                                  02860000
027700         AND A.LAST_UPD_TMST       =                              02870000
027800         (SELECT MAX(D.LAST_UPD_TMST)                             02880000
027900          FROM ICT_SKU_LOC_CNT  D                                 02890000
028000          WHERE D.LOC_NBR         = A.LOC_NBR                     02900000
028100            AND D.CNT_STUP_ID     = A.CNT_STUP_ID                 02910000
028200            AND D.CNT_SEQ_NBR     = A.CNT_SEQ_NBR                 02920000
028300            AND D.SKU_NBR         = A.SKU_NBR)                    02930000
028400                                                                  02940000
028500       GROUP BY  A.LOC_NBR                                        02950000
028600                ,A.CNT_STUP_ID                                    02960000
028700                ,A.EXEC_TMST                                      02970000
028800                ,C.DEPT_NBR                                       02980000
028900                ,C.MAJ_CL_NBR                                     02990000
029000                                                                  03000000
029100     END-EXEC.                                                    03010000
029200                                                                  03020000
029300                                                                  03030000
029400******************************************************************03040000
029500*  USA IC COUNTS CURSOR TO SUM COUNT BY SUB CLASS                 03050000
029600******************************************************************03060000
029700     EXEC SQL                                                     03070000
029800       DECLARE SBCL-SUM-CSR CURSOR FOR                            03080000
029900       SELECT  A.LOC_NBR                                          03090000
030000              ,A.CNT_STUP_ID                                      03100000
030100              ,A.EXEC_TMST                                        03110000
030200              ,C.DEPT_NBR                                         03120000
030300              ,C.MAJ_CL_NBR                                       03130000
030400              ,C.SUB_CL_NBR                                       03140000
030500              ,SUM(LOC_EXPTED_UNT_QTY)                            03150000
030600                                                                  03160000
030700       FROM  ICT_SKU_LOC_CNT A                                    03170000
030800            ,XST_SKU         B                                    03180000
030900            ,XST_VND_STYL    C                                    03190000
031000                                                                  03200000
031100       WHERE A.LOC_NBR      = :ICT00011-LOC-NBR                   03210000
031200         AND A.CNT_STUP_ID  = :ICT00011-CNT-STUP-ID               03220000
031300         AND A.CNT_SEQ_NBR  = :ICT00011-CNT-SEQ-NBR               03230000
027300         AND (A.MDSE_EXPRN_DTE IS NULL                            03240007
008801          OR  A.MDSE_EXPRN_DTE >= CURRENT DATE)                   03250009
031500         AND B.SKU_NBR      = A.SKU_NBR                           03260000
031600         AND C.STYL_ID      = B.STYL_ID                           03270000
031700                                                                  03280000
031800         AND A.LAST_UPD_TMST       =                              03290000
031900         (SELECT MAX(D.LAST_UPD_TMST)                             03300000
032000          FROM ICT_SKU_LOC_CNT  D                                 03310000
032100          WHERE D.LOC_NBR         = A.LOC_NBR                     03320000
032200            AND D.CNT_STUP_ID     = A.CNT_STUP_ID                 03330000
032300            AND D.CNT_SEQ_NBR     = A.CNT_SEQ_NBR                 03340000
032400            AND D.SKU_NBR         = A.SKU_NBR)                    03350000
032500                                                                  03360000
032600       GROUP BY  A.LOC_NBR                                        03370000
032700                ,A.CNT_STUP_ID                                    03380000
032800                ,A.EXEC_TMST                                      03390000
032900                ,C.DEPT_NBR                                       03400000
033000                ,C.MAJ_CL_NBR                                     03410000
033100                ,C.SUB_CL_NBR                                     03420000
033200                                                                  03430000
033300     END-EXEC.                                                    03440000
033400                                                                  03450000
033500                                                                  03460000
033600******************************************************************03470000
033700*  USA IC COUNTS CURSOR TO SUM COUNT BY STYLE                     03480000
033800******************************************************************03490000
033900     EXEC SQL                                                     03500000
034000       DECLARE STYL-SUM-CSR CURSOR FOR                            03510000
034100       SELECT  A.LOC_NBR                                          03520000
034200              ,A.CNT_STUP_ID                                      03530000
034300              ,A.EXEC_TMST                                        03540000
034400              ,DEPT_NBR                                           03550000
034500              ,MAJ_CL_NBR                                         03560000
034600              ,SUB_CL_NBR                                         03570000
034700              ,C.STYL_ID                                          03580000
034800              ,SUM(LOC_EXPTED_UNT_QTY)                            03590000
034900                                                                  03600000
035000       FROM  ICT_SKU_LOC_CNT A                                    03610000
035100            ,XST_SKU         B                                    03620000
035200            ,XST_VND_STYL    C                                    03630000
035300                                                                  03640000
035400       WHERE A.LOC_NBR        = :ICT00011-LOC-NBR                 03650000
035500            AND A.CNT_STUP_ID = :ICT00011-CNT-STUP-ID             03660000
035600            AND A.CNT_SEQ_NBR = :ICT00011-CNT-SEQ-NBR             03670000
027300            AND (A.MDSE_EXPRN_DTE IS NULL                         03680007
008801             OR  A.MDSE_EXPRN_DTE >= CURRENT DATE)                03690009
035800            AND B.SKU_NBR     = A.SKU_NBR                         03700000
035900            AND C.STYL_ID     = B.STYL_ID                         03710000
036000                                                                  03720000
036100            AND A.LAST_UPD_TMST       =                           03730000
036200            (SELECT MAX(D.LAST_UPD_TMST)                          03740000
036300             FROM ICT_SKU_LOC_CNT  D                              03750000
036400             WHERE D.LOC_NBR         = A.LOC_NBR                  03760000
036500               AND D.CNT_STUP_ID     = A.CNT_STUP_ID              03770000
036600               AND D.CNT_SEQ_NBR     = A.CNT_SEQ_NBR              03780000
036700               AND D.SKU_NBR         = A.SKU_NBR)                 03790000
036800                                                                  03800000
036900       GROUP BY  A.LOC_NBR                                        03810000
037000                ,A.CNT_STUP_ID                                    03820000
037100                ,A.EXEC_TMST                                      03830000
037200                ,DEPT_NBR                                         03840000
037300                ,MAJ_CL_NBR                                       03850000
037400                ,SUB_CL_NBR                                       03860000
037500                ,C.STYL_ID                                        03870000
037600                                                                  03880000
037700     END-EXEC.                                                    03890000
037800                                                                  03900000
037900                                                                  03910000
038000                                                                  03920000
038100 PROCEDURE DIVISION.                                              03930000
038200******************************************************************03940000
038300* MAINLINE                                                        03950000
038400******************************************************************03960000
038500 0000-MAINLINE.                                                   03970000
038600                                                                  03980000
038700     PERFORM 1000-INITIALIZATION.                                 03990000
038800                                                                  04000000
038900     PERFORM 2000-PROCESS-COUNTS                                  04010000
039000       UNTIL PS-END-OF-FILE.                                      04020000
039100                                                                  04030000
039200     PERFORM 9900-END-OF-JOB.                                     04040000
039300                                                                  04050000
039400     STOP RUN.                                                    04060000
039500                                                                  04070000
039600                                                                  04080000
039700******************************************************************04090000
039800* PREFORMS TASK INITIATION                                        04100000
039900******************************************************************04110000
040000 1000-INITIALIZATION.                                             04120000
040100                                                                  04130000
040200     OPEN INPUT  MAINT-FILE                                       04140000
040300          OUTPUT UPDT-FILE.                                       04150000
040400                                                                  04160000
040500     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 04170000
040600                                                                  04180000
040700     MOVE SYS-TIME (1:2) TO ST-BEG-HR.                            04190000
040800     MOVE SYS-TIME (3:2) TO ST-BEG-MN.                            04200000
040900                                                                  04210000
041000     MOVE SYS-DATE (1:2) TO SD-CENT.                              04220000
041100     MOVE SYS-DATE (3:2) TO SD-YEAR.                              04230000
041200     MOVE SYS-DATE (5:2) TO SD-MONTH.                             04240000
041300     MOVE SYS-DATE (7:2) TO SD-DAY.                               04250000
041400                                                                  04260000
041500     PERFORM 7000-READ-MAINT-FILE.                                04270000
041600                                                                  04280000
041700     PERFORM 9000-TIMEZONE-CONVERSION-SETUP.                      04290000
041800                                                                  04300000
041900                                                                  04310000
042000******************************************************************04320000
042100* PROCESS THE COUNTS                                              04330000
042200******************************************************************04340000
042300 2000-PROCESS-COUNTS.                                             04350000
042400                                                                  04360000
IC5389     INITIALIZE IC048-UPDT-REC.                                   04370000
IC5389                                                                  04380000
042500     MOVE ICRD057-CNT-STUP-ID   TO ICT00011-CNT-STUP-ID.          04390000
042600     MOVE ICRD057-LOC-NBR       TO ICT00011-LOC-NBR.              04400000
042700     MOVE ICRD057-CNT-SEQ-NBR   TO ICT00011-CNT-SEQ-NBR.          04410000
042800                                                                  04420000
042900     IF ICRD057-EXEC-LVL-CDE = 'MCL'                              04430000
043000        PERFORM 2100-PROCESS-MCL                                  04440000
043100                                                                  04450000
043200     ELSE                                                         04460000
043300        IF ICRD057-EXEC-LVL-CDE = 'SCL'                           04470000
043400           PERFORM 2200-PROCESS-SCL                               04480000
043500                                                                  04490000
043600        ELSE                                                      04500000
043700           IF ICRD057-EXEC-LVL-CDE = 'STY'                        04510000
043800              PERFORM 2300-PROCESS-STY                            04520000
043900                                                                  04530000
044000           ELSE                                                   04540000
044100              IF ICRD057-EXEC-LVL-CDE = 'SKU'                     04550000
044200                 ADD 1 TO PA-SKU-CNTS                             04560000
044300                                                                  04570000
044400              ELSE                                                04580000
044500                 ADD 1 TO PA-INVALID-CNTS                         04590000
044600                 DISPLAY 'INVALID EXEC LEVEL - '                  04600000
044700                     ICRD057-IC-CNT-QTY-MAINT-FILE                04610000
044800                                                                  04620000
044900              END-IF                                              04630000
045000           END-IF                                                 04640000
045100        END-IF                                                    04650000
045200     END-IF.                                                      04660000
045300                                                                  04670000
045400     PERFORM 7000-READ-MAINT-FILE.                                04680000
045500                                                                  04690000
045600                                                                  04700000
045700******************************************************************04710000
045800* PROCESS MCL RECORDS                                             04720000
045900******************************************************************04730000
046000 2100-PROCESS-MCL.                                                04740000
046100                                                                  04750000
046200     SET PS-MORE-MJCL-SUM-CNT TO TRUE.                            04760000
046300                                                                  04770000
046400     PERFORM 8110-OPEN-MJCL-SUM.                                  04780000
046500     PERFORM 8120-FETCH-MJCL-SUM.                                 04790000
046600                                                                  04800000
046700     PERFORM 2150-PROCESS                                         04810000
046800       UNTIL PS-NO-MORE-MJCL-SUM-CNT.                             04820000
046900                                                                  04830000
047000     PERFORM 8130-CLOSE-MJCL-SUM.                                 04840000
047100                                                                  04850000
047200                                                                  04860000
047300******************************************************************04870000
047400* PROCESS RECORDS                                                 04880000
047500******************************************************************04890000
047600 2150-PROCESS.                                                    04900000
047700                                                                  04910000
047800     MOVE XST00013-DEPT-NBR   TO IC048-DEPT-NBR.                  04920000
047900     MOVE XST00013-MAJ-CL-NBR TO IC048-MAJ-CL-NBR.                04930000
048000                                                                  04940000
048100     SET PV-DEPT-NBR-IS-NOT-NULL TO TRUE.                         04950000
048200     SET PV-MJCL-NBR-IS-NOT-NULL TO TRUE.                         04960000
048300     SET PV-SBCL-NBR-IS-NULL     TO TRUE.                         04970000
048400     SET PV-STYL-NBR-IS-NULL     TO TRUE.                         04980000
048500                                                                  04990000
048600     PERFORM 3000-PROCESS-SUM-COUNTS.                             05000000
048700                                                                  05010000
048800     PERFORM 8120-FETCH-MJCL-SUM.                                 05020000
048900                                                                  05030000
049000                                                                  05040000
049100******************************************************************05050000
049200* PROCESS SCL RECORDS                                             05060000
049300******************************************************************05070000
049400 2200-PROCESS-SCL.                                                05080000
049500                                                                  05090000
049600     SET PS-MORE-SBCL-SUM-CNT TO TRUE.                            05100000
049700                                                                  05110000
049800     PERFORM 8210-OPEN-SBCL-SUM.                                  05120000
049900     PERFORM 8220-FETCH-SBCL-SUM.                                 05130000
050000                                                                  05140000
050100     PERFORM 2250-PROCESS                                         05150000
050200       UNTIL PS-NO-MORE-SBCL-SUM-CNT.                             05160000
050300                                                                  05170000
050400     PERFORM 8230-CLOSE-SBCL-SUM.                                 05180000
050500                                                                  05190000
050600                                                                  05200000
050700******************************************************************05210000
050800* PROCESS RECORDS                                                 05220000
050900******************************************************************05230000
051000 2250-PROCESS.                                                    05240000
051100                                                                  05250000
051200     MOVE XST00013-DEPT-NBR   TO IC048-DEPT-NBR.                  05260000
051300     MOVE XST00013-MAJ-CL-NBR TO IC048-MAJ-CL-NBR.                05270000
051400     MOVE XST00013-SUB-CL-NBR TO IC048-SUB-CL-NBR.                05280000
051500                                                                  05290000
051600     SET PV-DEPT-NBR-IS-NOT-NULL TO TRUE.                         05300000
051700     SET PV-MJCL-NBR-IS-NOT-NULL TO TRUE.                         05310000
051800     SET PV-SBCL-NBR-IS-NOT-NULL TO TRUE.                         05320000
051900     SET PV-STYL-NBR-IS-NULL     TO TRUE.                         05330000
052000                                                                  05340000
052100     PERFORM 3000-PROCESS-SUM-COUNTS.                             05350000
052200                                                                  05360000
052300     PERFORM 8220-FETCH-SBCL-SUM.                                 05370000
052400                                                                  05380000
052500                                                                  05390000
052600******************************************************************05400000
052700* PROCESS STY RECORDS                                             05410000
052800******************************************************************05420000
052900 2300-PROCESS-STY.                                                05430000
053000                                                                  05440000
053100     SET PS-MORE-STYL-SUM-CNT TO TRUE.                            05450000
053200                                                                  05460000
053300     PERFORM 8310-OPEN-STYL-SUM.                                  05470000
053400     PERFORM 8320-FETCH-STYL-SUM.                                 05480000
053500                                                                  05490000
053600     PERFORM 2350-PROCESS                                         05500000
053700       UNTIL PS-NO-MORE-STYL-SUM-CNT.                             05510000
053800                                                                  05520000
053900     PERFORM 8330-CLOSE-STYL-SUM.                                 05530000
054000                                                                  05540000
054100                                                                  05550000
054200******************************************************************05560000
054300* PROCESS RECORDS                                                 05570000
054400******************************************************************05580000
054500 2350-PROCESS.                                                    05590000
054600                                                                  05600000
054700     MOVE XST00013-DEPT-NBR   TO IC048-DEPT-NBR.                  05610000
054800     MOVE XST00013-MAJ-CL-NBR TO IC048-MAJ-CL-NBR.                05620000
054900     MOVE XST00013-SUB-CL-NBR TO IC048-SUB-CL-NBR.                05630000
055000     MOVE XST00013-VS-ID      TO IC048-STYL-ID.                   05640000
055100                                                                  05650000
055200     SET PV-DEPT-NBR-IS-NULL     TO TRUE.                         05660000
055300     SET PV-MJCL-NBR-IS-NULL     TO TRUE.                         05670000
055400     SET PV-SBCL-NBR-IS-NULL     TO TRUE.                         05680000
055500     SET PV-STYL-NBR-IS-NOT-NULL TO TRUE.                         05690000
055600                                                                  05700000
055700     PERFORM 3000-PROCESS-SUM-COUNTS.                             05710000
055800                                                                  05720000
055900     PERFORM 8320-FETCH-STYL-SUM.                                 05730000
056000                                                                  05740000
056100                                                                  05750000
056200******************************************************************05760000
056300* PROCESS SUM COUNTS                                              05770000
056400******************************************************************05780000
056500 3000-PROCESS-SUM-COUNTS.                                         05790000
056600                                                                  05800000
056700     PERFORM 3100-GET-STR-TIMEZONE.                               05810000
056800                                                                  05820000
056900     PERFORM 3200-SETUP-FIELDS.                                   05830000
057000                                                                  05840000
057100     PERFORM 9000-TIMEZONE-CONVERSION.                            05850000
057200                                                                  05860000
057300     PERFORM 3300-UPDT-TIMESTAMP.                                 05870000
057400                                                                  05880000
057500     PERFORM 3400-WRITE-SUMMED-QTYS.                              05890000
057600                                                                  05900000
057700                                                                  05910000
057800******************************************************************05920000
057900* GET A STORE TIMEZONE                                            05930000
058000******************************************************************05940000
058100 3100-GET-STR-TIMEZONE.                                           05950000
058200                                                                  05960000
058300     MOVE ICT00011-LOC-NBR TO XST00001-LOC-NBR.                   05970000
058400                                                                  05980000
058500     EXEC SQL                                                     05990000
058600       SELECT STD_TM_ZN_CDE                                       06000000
058700             ,DST_IND                                             06010000
058800                                                                  06020000
058900        INTO :XST00001-STD-TM-ZN-CDE :PV-STD-TM-ZN-CDE-NI         06030000
059000                                                                  06040000
059100         FROM XST_LOC                                             06050000
059200                                                                  06060000
059300        WHERE LOC_NBR = :XST00001-LOC-NBR                         06070000
059400     END-EXEC.                                                    06080000
059500                                                                  06090000
059600     EVALUATE TRUE                                                06100000
059700        WHEN SQLCODE = 0                                          06110000
059800          CONTINUE                                                06120000
059900                                                                  06130000
060000        WHEN OTHER                                                06140000
060100          DISPLAY '          '                                    06150000
060200          DISPLAY 'LOC-NBR = ' XST00001-LOC-NBR                   06160000
060300                                                                  06170000
060400          MOVE '3100-GET-STR-TIMEZONE' TO PV-PARAGRAPH-NAME       06180000
060500          MOVE 'XST_LOC TBL ERROR'   TO PV-OPERATION-MSG          06190000
060600                                                                  06200000
060700          PERFORM 9100-SQL-ABEND                                  06210000
060800     END-EVALUATE.                                                06220000
060900                                                                  06230000
061000                                                                  06240000
061100******************************************************************06250000
061200* SETUP FIELDS                                                    06260000
061300******************************************************************06270000
061400 3200-SETUP-FIELDS.                                               06280000
061500                                                                  06290000
061600     MOVE ICT00011-LOC-NBR       TO IC048-LOC-NBR.                06300000
061700     MOVE ICT00011-CNT-SEQ-NBR   TO IC048-CNT-SEQ-NBR.            06310000
061800     MOVE ICT00011-CNT-STUP-ID   TO IC048-CNT-STUP-ID.            06320000
061900     MOVE ZERO                   TO IC048-KYD-UNT-QTY.            06330000
062000                                                                  06340000
062100     MOVE ICT00011-LOC-EXPTED-UNT-QTY TO                          06350000
062200                              IC048-LOC-EXPTED-UNT-QTY.           06360000
062300                                                                  06370000
062400     MOVE ICT00011-EXEC-TMST     TO IC048-EXEC-TMST.              06380000
062500                                                                  06390000
062600     IF  PV-STD-TM-ZN-CDE-IS-NULL                                 06400000
062700         MOVE 'CST' TO XST00001-STD-TM-ZN-CDE                     06410000
062800     END-IF.                                                      06420000
062900                                                                  06430000
063000     MOVE XST00001-STD-TM-ZN-CDE TO                               06440000
063100                              ICWS010-TZC-TZ-IN-TM-ZN-CDE.        06450000
063200                                                                  06460000
063300                                                                  06470000
063400******************************************************************06480000
063500* THIS ADDS 1 MILISECOND TO THE LAST_UPD_TMST BECAUSE IT IS       06490000
063600* POSSIBLE TO HAVE MANY ROWS WITH THE SAME KEY. AN EXAMPLE OF     06500000
063700* THIS IS A COUNT SPECIFIED AT A SYLE LEVEL, ALL ROWS HAVE THE    06510000
063800* SAME CNT_ID, CNT_SEQ_NBR AND LOC_NBR FOR EACH STYLE_ID, SO,     06520000
063900* THE LAST_UPD_TMST IS VARIED TO AVOID DUPLICATE KEYS.            06530000
064000******************************************************************06540000
064100 3300-UPDT-TIMESTAMP.                                             06550000
064200                                                                  06560000
064300     MOVE ICWS010-TZC-LOCATION-TMST TO IC048-LAST-UPD-TMST.       06570000
064400                                                                  06580000
064500     EXEC SQL                                                     06590000
064600         SET :ICWS010-ETZ-TMST-TZC =                              06600000
064700              TIMESTAMP(:ICWS010-ETZ-TMST-TZC)                    06610000
064800              + :PV-PLUS-MILSEC MICROSECONDS                      06620000
064900     END-EXEC.                                                    06630000
065000     EXEC SQL                                                     06640000
065100         SET :ICWS010-CTZ-TMST-TZC =                              06650000
065200              TIMESTAMP(:ICWS010-CTZ-TMST-TZC)                    06660000
065300              + :PV-PLUS-MILSEC MICROSECONDS                      06670000
065400     END-EXEC.                                                    06680000
065500     EXEC SQL                                                     06690000
065600         SET :ICWS010-MTZ-TMST-TZC =                              06700000
065700              TIMESTAMP(:ICWS010-MTZ-TMST-TZC)                    06710000
065800              + :PV-PLUS-MILSEC MICROSECONDS                      06720000
065900     END-EXEC.                                                    06730000
066000     EXEC SQL                                                     06740000
066100         SET :ICWS010-PTZ-TMST-TZC =                              06750000
066200              TIMESTAMP(:ICWS010-PTZ-TMST-TZC)                    06760000
066300              + :PV-PLUS-MILSEC MICROSECONDS                      06770000
066400     END-EXEC.                                                    06780000
066500     EXEC SQL                                                     06790000
066600         SET :ICWS010-ATZ-TMST-TZC =                              06800000
066700              TIMESTAMP(:ICWS010-ATZ-TMST-TZC)                    06810000
066800              + :PV-PLUS-MILSEC MICROSECONDS                      06820000
066900     END-EXEC.                                                    06830000
067000     EXEC SQL                                                     06840000
067100         SET :ICWS010-ETZ-TMST-NO-DST-TZC =                       06850000
067200              TIMESTAMP(:ICWS010-ETZ-TMST-NO-DST-TZC)             06860000
067300              + :PV-PLUS-MILSEC MICROSECONDS                      06870000
067400     END-EXEC.                                                    06880000
067500     EXEC SQL                                                     06890000
067600         SET :ICWS010-CTZ-TMST-NO-DST-TZC =                       06900000
067700              TIMESTAMP(:ICWS010-CTZ-TMST-NO-DST-TZC)             06910000
067800              + :PV-PLUS-MILSEC MICROSECONDS                      06920000
067900     END-EXEC.                                                    06930000
068000     EXEC SQL                                                     06940000
068100         SET :ICWS010-MTZ-TMST-NO-DST-TZC =                       06950000
068200              TIMESTAMP(:ICWS010-MTZ-TMST-NO-DST-TZC)             06960000
068300              + :PV-PLUS-MILSEC MICROSECONDS                      06970000
068400     END-EXEC.                                                    06980000
068500     EXEC SQL                                                     06990000
068600         SET :ICWS010-PTZ-TMST-NO-DST-TZC =                       07000000
068700              TIMESTAMP(:ICWS010-PTZ-TMST-NO-DST-TZC)             07010000
068800              + :PV-PLUS-MILSEC MICROSECONDS                      07020000
068900     END-EXEC.                                                    07030000
069000     EXEC SQL                                                     07040000
069100         SET :ICWS010-ATZ-TMST-NO-DST-TZC =                       07050000
069200              TIMESTAMP(:ICWS010-ATZ-TMST-NO-DST-TZC)             07060000
069300              + :PV-PLUS-MILSEC MICROSECONDS                      07070000
069400     END-EXEC.                                                    07080000
069500                                                                  07090000
069600                                                                  07100000
069700******************************************************************07110000
069800* WRITE OUTPUT RECORD                                             07120000
069900******************************************************************07130000
070000 3400-WRITE-SUMMED-QTYS.                                          07140000
070100                                                                  07150000
070200     IF  IC048-DEPT-NBR   NOT NUMERIC                             07160000
070300         MOVE ZEROS TO IC048-DEPT-NBR                             07170000
070400     END-IF.                                                      07180000
070500     IF  IC048-MAJ-CL-NBR NOT NUMERIC                             07190000
070600         MOVE ZEROS TO IC048-MAJ-CL-NBR                           07200000
070700     END-IF.                                                      07210000
070800     IF  IC048-SUB-CL-NBR NOT NUMERIC                             07220000
070900         MOVE ZEROS TO IC048-SUB-CL-NBR                           07230000
071000     END-IF.                                                      07240000
071100     IF  IC048-STYL-ID    NOT NUMERIC                             07250000
071200         MOVE ZEROS TO IC048-STYL-ID                              07260000
071300     END-IF.                                                      07270000
071400                                                                  07280000
071500     WRITE UPDT-REC FROM IC048-UPDT-REC.                          07290000
071600                                                                  07300000
071700     ADD 1 TO PA-WRITTEN.                                         07310000
071800                                                                  07320000
071900                                                                  07330000
072000******************************************************************07340000
072100* 7000-READ-MAINT-FILE.                                           07350000
072200******************************************************************07360000
072300 7000-READ-MAINT-FILE.                                            07370000
072400                                                                  07380000
072500     READ MAINT-FILE INTO ICRD057-IC-CNT-QTY-MAINT-FILE           07390000
072600       AT END SET PS-END-OF-FILE TO TRUE.                         07400000
072700                                                                  07410000
072800     IF  PS-END-OF-FILE                                           07420000
072900         CONTINUE                                                 07430000
073000     ELSE                                                         07440000
073100         ADD 1 TO PA-READ                                         07450000
073200     END-IF.                                                      07460000
073300                                                                  07470000
073400                                                                  07480000
073500******************************************************************07490000
073600* OPEN CURSOR                                                     07500000
073700******************************************************************07510000
073800 8110-OPEN-MJCL-SUM.                                              07520000
073900                                                                  07530000
074000     PERFORM                                                      07540000
074100         WITH TEST AFTER                                          07550000
074200         VARYING PV-RETRIES                                       07560000
074300         FROM 1 BY 1                                              07570000
074400         UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT         07580000
074500            OR  PS-PROCESS-STOP                                   07590000
074600            OR  SQLCODE = 0)                                      07600000
074700                                                                  07610000
074800           EXEC SQL                                               07620000
074900              OPEN MJCL-SUM-CSR                                   07630000
075000           END-EXEC                                               07640000
075100                                                                  07650000
075200         EVALUATE TRUE                                            07660000
075300             WHEN SQLCODE = -904                                  07670000
075400             WHEN SQLCODE = -911                                  07680000
075500             WHEN SQLCODE = -913                                  07690000
075600                 CONTINUE                                         07700000
075700                                                                  07710000
075800             WHEN SQLCODE = 0                                     07720000
075900                 CONTINUE                                         07730000
076000                                                                  07740000
076100             WHEN OTHER                                           07750000
076200                 SET PS-PROCESS-STOP TO TRUE                      07760000
076300                                                                  07770000
076400         END-EVALUATE                                             07780000
076500     END-PERFORM.                                                 07790000
076600                                                                  07800000
076700     IF PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT                 07810000
076800     OR PS-PROCESS-STOP                                           07820000
076900         MOVE '8110-OPEN-MJCL-SUM'  TO PV-PARAGRAPH-NAME          07830000
077000         MOVE 'CURSOR OPEN ERROR'   TO PV-OPERATION-MSG           07840000
077100                                                                  07850000
077200         PERFORM 9100-SQL-ABEND                                   07860000
077300     END-IF.                                                      07870000
077400                                                                  07880000
077500                                                                  07890000
077600******************************************************************07900000
077700* FETCH CURSOR                                                    07910000
077800******************************************************************07920000
077900 8120-FETCH-MJCL-SUM.                                             07930000
078000                                                                  07940000
078100     PERFORM                                                      07950000
078200         WITH TEST AFTER                                          07960000
078300         VARYING PV-RETRIES                                       07970000
078400         FROM 1 BY 1                                              07980000
078500         UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT         07990000
078600            OR  PS-PROCESS-STOP                                   08000000
078700            OR  SQLCODE = 0                                       08010000
078800            OR  SQLCODE = +100)                                   08020000
078900                                                                  08030000
079000           EXEC SQL                                               08040000
079100              FETCH MJCL-SUM-CSR                                  08050000
079200              INTO  :ICT00011-LOC-NBR                             08060000
079300                   ,:ICT00011-CNT-STUP-ID                         08070000
079400                   ,:ICT00011-EXEC-TMST                           08080000
079500                   ,:XST00013-DEPT-NBR:PV-DEPT-NBR-NI             08090000
079600                   ,:XST00013-MAJ-CL-NBR:PV-MJCL-NBR-NI           08100000
079700                   ,:ICT00011-LOC-EXPTED-UNT-QTY                  08110000
079800           END-EXEC                                               08120000
079900                                                                  08130000
080000          EVALUATE TRUE                                           08140000
080100              WHEN SQLCODE = -904                                 08150000
080200              WHEN SQLCODE = -911                                 08160000
080300              WHEN SQLCODE = -913                                 08170000
080400                  CONTINUE                                        08180000
080500                                                                  08190000
080600              WHEN SQLCODE = ZERO                                 08200000
080700                  ADD +1 TO PA-MJCL-SUM-CNTS                      08210000
080800                                                                  08220000
080900              WHEN SQLCODE = +100                                 08230000
081000                  SET PS-NO-MORE-MJCL-SUM-CNT TO TRUE             08240000
081100                                                                  08250000
081200              WHEN OTHER                                          08260000
081300                  SET PS-PROCESS-STOP TO TRUE                     08270000
081400                                                                  08280000
081500          END-EVALUATE                                            08290000
081600     END-PERFORM.                                                 08300000
081700                                                                  08310000
081800     IF  PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT                08320000
081900     OR  PS-PROCESS-STOP                                          08330000
082000         MOVE '8120-FETCH-MJCL-SUM' TO PV-PARAGRAPH-NAME          08340000
082100         MOVE 'CURSOR FETCH ERROR'  TO PV-OPERATION-MSG           08350000
082200                                                                  08360000
082300         PERFORM 9100-SQL-ABEND                                   08370000
082400     END-IF.                                                      08380000
082500                                                                  08390000
082600                                                                  08400000
082700******************************************************************08410000
082800* CLOSE CURSOR                                                    08420000
082900******************************************************************08430000
083000 8130-CLOSE-MJCL-SUM.                                             08440000
083100                                                                  08450000
083200     PERFORM                                                      08460000
083300         WITH TEST AFTER                                          08470000
083400         VARYING PV-RETRIES                                       08480000
083500         FROM 1 BY 1                                              08490000
083600         UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT         08500000
083700            OR  PS-PROCESS-STOP                                   08510000
083800            OR  SQLCODE = 0)                                      08520000
083900                                                                  08530000
084000           EXEC SQL                                               08540000
084100              CLOSE MJCL-SUM-CSR                                  08550000
084200           END-EXEC                                               08560000
084300                                                                  08570000
084400          EVALUATE TRUE                                           08580000
084500             WHEN SQLCODE = -904                                  08590000
084600             WHEN SQLCODE = -911                                  08600000
084700             WHEN SQLCODE = -913                                  08610000
084800                 CONTINUE                                         08620000
084900                                                                  08630000
085000             WHEN SQLCODE = 0                                     08640000
085100                 CONTINUE                                         08650000
085200                                                                  08660000
085300             WHEN OTHER                                           08670000
085400                 SET PS-PROCESS-STOP TO TRUE                      08680000
085500                                                                  08690000
085600          END-EVALUATE                                            08700000
085700     END-PERFORM.                                                 08710000
085800                                                                  08720000
085900     IF  PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT                08730000
086000     OR  PS-PROCESS-STOP                                          08740000
086100         MOVE '8130-CLOSE-MJCL-SUM' TO PV-PARAGRAPH-NAME          08750000
086200         MOVE 'CURSOR CLOSE ERROR'  TO PV-OPERATION-MSG           08760000
086300                                                                  08770000
086400         PERFORM 9100-SQL-ABEND                                   08780000
086500     END-IF.                                                      08790000
086600                                                                  08800000
086700                                                                  08810000
086800******************************************************************08820000
086900* OPEN CURSOR                                                     08830000
087000******************************************************************08840000
087100 8210-OPEN-SBCL-SUM.                                              08850000
087200                                                                  08860000
087300     PERFORM                                                      08870000
087400         WITH TEST AFTER                                          08880000
087500         VARYING PV-RETRIES                                       08890000
087600         FROM 1 BY 1                                              08900000
087700         UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT         08910000
087800            OR  PS-PROCESS-STOP                                   08920000
087900            OR  SQLCODE = 0)                                      08930000
088000                                                                  08940000
088100           EXEC SQL                                               08950000
088200              OPEN SBCL-SUM-CSR                                   08960000
088300           END-EXEC                                               08970000
088400                                                                  08980000
088500         EVALUATE TRUE                                            08990000
088600             WHEN SQLCODE = -904                                  09000000
088700             WHEN SQLCODE = -911                                  09010000
088800             WHEN SQLCODE = -913                                  09020000
088900                 CONTINUE                                         09030000
089000                                                                  09040000
089100             WHEN SQLCODE = 0                                     09050000
089200                 CONTINUE                                         09060000
089300                                                                  09070000
089400             WHEN OTHER                                           09080000
089500                 SET PS-PROCESS-STOP TO TRUE                      09090000
089600                                                                  09100000
089700         END-EVALUATE                                             09110000
089800     END-PERFORM.                                                 09120000
089900                                                                  09130000
090000     IF  PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT                09140000
090100     OR  PS-PROCESS-STOP                                          09150000
090200         MOVE '8210-OPEN-SBCL-SUM' TO PV-PARAGRAPH-NAME           09160000
090300         MOVE 'CURSOR OPEN ERROR'   TO PV-OPERATION-MSG           09170000
090400                                                                  09180000
090500         PERFORM 9100-SQL-ABEND                                   09190000
090600     END-IF.                                                      09200000
090700                                                                  09210000
090800                                                                  09220000
090900******************************************************************09230000
091000* FETCH CURSOR                                                    09240000
091100******************************************************************09250000
091200 8220-FETCH-SBCL-SUM.                                             09260000
091300                                                                  09270000
091400     PERFORM                                                      09280000
091500         WITH TEST AFTER                                          09290000
091600         VARYING PV-RETRIES                                       09300000
091700         FROM 1 BY 1                                              09310000
091800         UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT         09320000
091900            OR  PS-PROCESS-STOP                                   09330000
092000            OR  SQLCODE = 0                                       09340000
092100            OR  SQLCODE = +100)                                   09350000
092200                                                                  09360000
092300           EXEC SQL                                               09370000
092400              FETCH SBCL-SUM-CSR                                  09380000
092500              INTO  :ICT00011-LOC-NBR                             09390000
092600                   ,:ICT00011-CNT-STUP-ID                         09400000
092700                   ,:ICT00011-EXEC-TMST                           09410000
092800                   ,:XST00013-DEPT-NBR:PV-DEPT-NBR-NI             09420000
092900                   ,:XST00013-MAJ-CL-NBR:PV-MJCL-NBR-NI           09430000
093000                   ,:XST00013-SUB-CL-NBR:PV-SBCL-NBR-NI           09440000
093100                   ,:ICT00011-LOC-EXPTED-UNT-QTY                  09450000
093200           END-EXEC                                               09460000
093300                                                                  09470000
093400          EVALUATE TRUE                                           09480000
093500              WHEN SQLCODE = -904                                 09490000
093600              WHEN SQLCODE = -911                                 09500000
093700              WHEN SQLCODE = -913                                 09510000
093800                  CONTINUE                                        09520000
093900                                                                  09530000
094000              WHEN SQLCODE = ZERO                                 09540000
094100                  ADD +1 TO PA-SBCL-SUM-CNTS                      09550000
094200                                                                  09560000
094300              WHEN SQLCODE = +100                                 09570000
094400                  SET PS-NO-MORE-SBCL-SUM-CNT TO TRUE             09580000
094500                                                                  09590000
094600              WHEN OTHER                                          09600000
094700                  SET PS-PROCESS-STOP TO TRUE                     09610000
094800                                                                  09620000
094900          END-EVALUATE                                            09630000
095000     END-PERFORM.                                                 09640000
095100                                                                  09650000
095200     IF  PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT                09660000
095300     OR  PS-PROCESS-STOP                                          09670000
095400         MOVE '8220-FETCH-SBCL-SUM' TO PV-PARAGRAPH-NAME          09680000
095500         MOVE 'CURSOR FETCH ERROR'  TO PV-OPERATION-MSG           09690000
095600                                                                  09700000
095700         PERFORM 9100-SQL-ABEND                                   09710000
095800     END-IF.                                                      09720000
095900                                                                  09730000
096000                                                                  09740000
096100******************************************************************09750000
096200* CLOSE CURSOR                                                    09760000
096300******************************************************************09770000
096400 8230-CLOSE-SBCL-SUM.                                             09780000
096500                                                                  09790000
096600     PERFORM                                                      09800000
096700         WITH TEST AFTER                                          09810000
096800         VARYING PV-RETRIES                                       09820000
096900         FROM 1 BY 1                                              09830000
097000         UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT         09840000
097100            OR  PS-PROCESS-STOP                                   09850000
097200            OR  SQLCODE = 0)                                      09860000
097300                                                                  09870000
097400           EXEC SQL                                               09880000
097500              CLOSE SBCL-SUM-CSR                                  09890000
097600           END-EXEC                                               09900000
097700                                                                  09910000
097800          EVALUATE TRUE                                           09920000
097900             WHEN SQLCODE = -904                                  09930000
098000             WHEN SQLCODE = -911                                  09940000
098100             WHEN SQLCODE = -913                                  09950000
098200                 CONTINUE                                         09960000
098300                                                                  09970000
098400             WHEN SQLCODE = 0                                     09980000
098500                 CONTINUE                                         09990000
098600                                                                  10000000
098700             WHEN OTHER                                           10010000
098800                 SET PS-PROCESS-STOP TO TRUE                      10020000
098900                                                                  10030000
099000          END-EVALUATE                                            10040000
099100     END-PERFORM.                                                 10050000
099200                                                                  10060000
099300     IF  PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT                10070000
099400     OR  PS-PROCESS-STOP                                          10080000
099500         MOVE '8230-CLOSE-SBCL-SUM' TO PV-PARAGRAPH-NAME          10090000
099600         MOVE 'CURSOR CLOSE ERROR'  TO PV-OPERATION-MSG           10100000
099700                                                                  10110000
099800         PERFORM 9100-SQL-ABEND                                   10120000
099900     END-IF.                                                      10130000
100000                                                                  10140000
100100                                                                  10150000
100200******************************************************************10160000
100300* OPEN CURSOR                                                     10170000
100400******************************************************************10180000
100500 8310-OPEN-STYL-SUM.                                              10190000
100600                                                                  10200000
100700     PERFORM                                                      10210000
100800         WITH TEST AFTER                                          10220000
100900         VARYING PV-RETRIES                                       10230000
101000         FROM 1 BY 1                                              10240000
101100         UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT         10250000
101200            OR  PS-PROCESS-STOP                                   10260000
101300            OR  SQLCODE = 0)                                      10270000
101400                                                                  10280000
101500           EXEC SQL                                               10290000
101600              OPEN STYL-SUM-CSR                                   10300000
101700           END-EXEC                                               10310000
101800                                                                  10320000
101900         EVALUATE TRUE                                            10330000
102000             WHEN SQLCODE = -904                                  10340000
102100             WHEN SQLCODE = -911                                  10350000
102200             WHEN SQLCODE = -913                                  10360000
102300                 CONTINUE                                         10370000
102400                                                                  10380000
102500             WHEN SQLCODE = 0                                     10390000
102600                 CONTINUE                                         10400000
102700                                                                  10410000
102800             WHEN OTHER                                           10420000
102900                 SET PS-PROCESS-STOP TO TRUE                      10430000
103000                                                                  10440000
103100         END-EVALUATE                                             10450000
103200     END-PERFORM.                                                 10460000
103300                                                                  10470000
103400     IF  PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT                10480000
103500     OR  PS-PROCESS-STOP                                          10490000
103600         MOVE '8310-OPEN-STYL-SUM'  TO PV-PARAGRAPH-NAME          10500000
103700         MOVE 'CURSOR OPEN ERROR'   TO PV-OPERATION-MSG           10510000
103800                                                                  10520000
103900         PERFORM 9100-SQL-ABEND                                   10530000
104000     END-IF.                                                      10540000
104100                                                                  10550000
104200                                                                  10560000
104300******************************************************************10570000
104400* FETCH CURSOR                                                    10580000
104500******************************************************************10590000
104600 8320-FETCH-STYL-SUM.                                             10600000
104700                                                                  10610000
104800     PERFORM                                                      10620000
104900         WITH TEST AFTER                                          10630000
105000         VARYING PV-RETRIES                                       10640000
105100         FROM 1 BY 1                                              10650000
105200         UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT         10660000
105300            OR  PS-PROCESS-STOP                                   10670000
105400            OR  SQLCODE = 0                                       10680000
105500            OR  SQLCODE = +100)                                   10690000
105600                                                                  10700000
105700           EXEC SQL                                               10710000
105800              FETCH STYL-SUM-CSR                                  10720000
105900              INTO  :ICT00011-LOC-NBR                             10730000
106000                   ,:ICT00011-CNT-STUP-ID                         10740000
106100                   ,:ICT00011-EXEC-TMST                           10750000
106200                   ,:XST00013-DEPT-NBR:PV-DEPT-NBR-NI             10760000
106300                   ,:XST00013-MAJ-CL-NBR:PV-MJCL-NBR-NI           10770000
106400                   ,:XST00013-SUB-CL-NBR:PV-SBCL-NBR-NI           10780000
106500                   ,:XST00013-VS-ID:PV-STYL-NBR-NI                10790000
106600                   ,:ICT00011-LOC-EXPTED-UNT-QTY                  10800000
106700           END-EXEC                                               10810000
106800                                                                  10820000
106900          EVALUATE TRUE                                           10830000
107000              WHEN SQLCODE = -904                                 10840000
107100              WHEN SQLCODE = -911                                 10850000
107200              WHEN SQLCODE = -913                                 10860000
107300                  CONTINUE                                        10870000
107400                                                                  10880000
107500              WHEN SQLCODE = ZERO                                 10890000
107600                  ADD +1 TO PA-STYL-SUM-CNTS                      10900000
107700                                                                  10910000
107800              WHEN SQLCODE = +100                                 10920000
107900                  SET PS-NO-MORE-STYL-SUM-CNT TO TRUE             10930000
108000                                                                  10940000
108100              WHEN OTHER                                          10950000
108200                  SET PS-PROCESS-STOP TO TRUE                     10960000
108300                                                                  10970000
108400          END-EVALUATE                                            10980000
108500     END-PERFORM.                                                 10990000
108600                                                                  11000000
108700     IF  PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT                11010000
108800     OR  PS-PROCESS-STOP                                          11020000
108900         MOVE '8320-FETCH-STYL-SUM' TO PV-PARAGRAPH-NAME          11030000
109000         MOVE 'CURSOR FETCH ERROR'  TO PV-OPERATION-MSG           11040000
109100                                                                  11050000
109200         PERFORM 9100-SQL-ABEND                                   11060000
109300     END-IF.                                                      11070000
109400                                                                  11080000
109500                                                                  11090000
109600******************************************************************11100000
109700* CLOSE CURSOR                                                    11110000
109800******************************************************************11120000
109900 8330-CLOSE-STYL-SUM.                                             11130000
110000                                                                  11140000
110100     PERFORM                                                      11150000
110200         WITH TEST AFTER                                          11160000
110300         VARYING PV-RETRIES                                       11170000
110400         FROM 1 BY 1                                              11180000
110500         UNTIL (PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT         11190000
110600            OR  PS-PROCESS-STOP                                   11200000
110700            OR  SQLCODE = 0)                                      11210000
110800                                                                  11220000
110900           EXEC SQL                                               11230000
111000              CLOSE STYL-SUM-CSR                                  11240000
111100           END-EXEC                                               11250000
111200                                                                  11260000
111300          EVALUATE TRUE                                           11270000
111400             WHEN SQLCODE = -904                                  11280000
111500             WHEN SQLCODE = -911                                  11290000
111600             WHEN SQLCODE = -913                                  11300000
111700                 CONTINUE                                         11310000
111800                                                                  11320000
111900             WHEN SQLCODE = 0                                     11330000
112000                 CONTINUE                                         11340000
112100                                                                  11350000
112200             WHEN OTHER                                           11360000
112300                 SET PS-PROCESS-STOP TO TRUE                      11370000
112400                                                                  11380000
112500          END-EVALUATE                                            11390000
112600     END-PERFORM.                                                 11400000
112700                                                                  11410000
112800     IF  PV-RETRIES GREATER PC-MAXIMUM-RETRY-COUNT                11420000
112900     OR  PS-PROCESS-STOP                                          11430000
113000         MOVE '8330-CLOSE-STYL-SUM' TO PV-PARAGRAPH-NAME          11440000
113100         MOVE 'CURSOR CLOSE ERROR'  TO PV-OPERATION-MSG           11450000
113200                                                                  11460000
113300         PERFORM 9100-SQL-ABEND                                   11470000
113400     END-IF.                                                      11480000
113500                                                                  11490000
113600                                                                  11500000
113700******************************************************************11510000
113800* ROUTINE TO CONVERT TIMEZONE                                     11520000
113900******************************************************************11530000
114000     COPY ICPD010.                                                11540000
114100                                                                  11550000
114200                                                                  11560000
114300******************************************************************11570000
114400* 9100-SQL-ABEND                                                  11580000
114500******************************************************************11590000
114600 9100-SQL-ABEND.                                                  11600000
114700                                                                  11610000
114800     PERFORM 9900-END-OF-JOB.                                     11620000
114900                                                                  11630000
115000     DISPLAY '** ABEND     **'.                                   11640000
115100     DISPLAY '** PROGRAM   ** = ' PC-PGM-NAME.                    11650000
115200     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              11660000
115300     DISPLAY '** OPERATION ** = ' PV-OPERATION-MSG.               11670000
115400                                                                  11680000
115500******************************************************************11690000
115600* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     11700000
115700* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      11710000
115800******************************************************************11720000
115900     COPY DPPD004.                                                11730000
116000                                                                  11740000
116100     SET AC-DB2-ERROR TO TRUE.                                    11750000
116200                                                                  11760000
116300     CALL 'ILBOABN0' USING ABEND-CODE.                            11770000
116400                                                                  11780000
116500                                                                  11790000
116600******************************************************************11800000
116700* PREFORMS TASK TERMINATION PROCESSING                            11810000
116800******************************************************************11820000
116900 9900-END-OF-JOB.                                                 11830000
117000                                                                  11840000
117100     CLOSE MAINT-FILE                                             11850000
117200           UPDT-FILE.                                             11860000
117300                                                                  11870000
117400     PERFORM 9999-CONTROLS.                                       11880000
117500                                                                  11890000
117600                                                                  11900000
117700******************************************************************11910000
117800* DISPLAY CONTROLS FROM THE PROGRAM                               11920000
117900******************************************************************11930000
118000 9999-CONTROLS.                                                   11940000
118100                                                                  11950000
118200     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 11960000
118300                                                                  11970000
118400     MOVE SYS-TIME (1:2) TO ST-END-HR.                            11980000
118500     MOVE SYS-TIME (3:2) TO ST-END-MN.                            11990000
118600                                                                  12000000
118700     DISPLAY '                    '.                              12010000
118800     DISPLAY '**********************'.                            12020000
118900     DISPLAY '   ICKUT003 CONTROLS  '.                            12030000
119000     DISPLAY '**********************'.                            12040000
119100     DISPLAY 'RUN DATE  = ' SD-EDIT-DATE.                         12050000
119200     DISPLAY 'BEG TIME  = ' ST-BEG-TIME.                          12060000
119300     DISPLAY 'END TIME  = ' ST-END-TIME.                          12070000
119400     DISPLAY '======================'.                            12080000
119500     DISPLAY 'INPUT FILE RECORDS = ' PA-READ.                     12090000
119600     DISPLAY '                                 '.                 12100000
119700     DISPLAY 'MJCL ROWS PROCESSED = ' PA-MJCL-SUM-CNTS.           12110000
119800     DISPLAY 'SBCL ROWS PROCESSED = ' PA-SBCL-SUM-CNTS.           12120000
119900     DISPLAY 'STYL ROWS PROCESSED = ' PA-STYL-SUM-CNTS.           12130000
120000     DISPLAY '                      '.                            12140000
120100     DISPLAY 'SKU BYPASSED    = ' PA-SKU-CNTS.                    12150000
120200     DISPLAY 'INVALID LVL-CDE = ' PA-INVALID-CNTS.                12160000
120300     DISPLAY '                 '.                                 12170000
120400     DISPLAY 'RECORDS WRITTEN = ' PA-WRITTEN.                     12180000
120500     DISPLAY '                  '.                                12190000
120600                                                                  12200000
120700                                                                  12210000
