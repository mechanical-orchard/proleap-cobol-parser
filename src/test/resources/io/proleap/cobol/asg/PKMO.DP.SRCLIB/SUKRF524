000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400                                                                  00040001
000500 PROGRAM-ID.             SUKRF524.                                00050001
000600 AUTHOR.                 STEPHANIE HERON.                         00060001
000700 INSTALLATION.           KOHLS.                                   00070001
000800 DATE-WRITTEN            DECEMBER, 1997.                                01
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100******************************************************************00110001
001200* THIS PROGRAM DISPLAYS THE TICKET EXCEPTION SCREEN WHICH WILL    00120001
001300* ALLOW THE USER TO LOG TICKET EXCEPTION TO THE EXCEPTIONT TABLE  00130001
001400******************************************************************00150001
001500                                                                  00160001
001600******************************************************************00170001
001700 ENVIRONMENT DIVISION.                                            00180001
001800******************************************************************00190001
001900                                                                  00200001
002000******************************************************************00210001
002100 DATA DIVISION.                                                   00220001
002200******************************************************************00230001
002300                                                                  00240001
002400******************************************************************00250001
002500 WORKING-STORAGE SECTION.                                         00260001
002600******************************************************************00270001
002700 01 CA-COMMAREA.                                                  00280001
002800     COPY SUWS006.                                                00290001
002900* * * * * * * * * * * *  PLEASE NOTE * * * * * * * * * * * *      00300001
003000* THE COMMAREA FROM HERE....                                      00310001
003100    05 CA-SUKRF513-COMMAREA.                                      00320001
003200       10 FILLER                            PIC X(35).                    
003300       10 CA-SYSTEM-RETAIL-X                PIC X(08).                    
003400       10 CA-SYSTEM-RETAIL        REDEFINES CA-SYSTEM-RETAIL-X            
003500                                            PIC ZZZZ9.99.         00350001
003600                                                                  00360001
003700       10 CA-SYSTEM-SKU-DESC                PIC X(19).            00370001
003800       10 CA-SYSTEM-COLOR                   PIC X(10).            00380001
003900       10 CA-SYSTEM-SIZE                    PIC X(10).            00390001
004000       10 CA-SYSTEM-STYLE                   PIC X(19).                    
004100* ... TO HERE IS COPIED FROM SUKRF513, AND IS THEN SENT ALONG TO  00400001
004200* SUKRF522 AND SUKRF517                                                 01
004300*     -- ANY CHANGED TO THIS AREA IN ANY OF THE PROGRAM MUST            01
004400* BE COPIED TO ALL THREE                                          00420001
004500    05 CA-PROGRAM-COMMAREA.                                       00430001
004600       10 FILLER                            PIC X(49).                    
004700*                                                                 00610001
004800 01  PS-PROGRAM-SWITCHES.                                         00840005
004900     05  PS-EXCEPTION-ALREAD-LOGGED-SW   PIC  X(01)  VALUE 'N'.   00850005
005000         88  PS-EXCEPTION-OK                         VALUE 'N'.   00860005
005100         88  PS-EXCEPTION-ALREADY-LOGGED             VALUE 'Y'.   00870005
005200                                                                          
005300 01  PC-PROGRAM-CONSTANTS.                                        00620001
005400     05  PC-CARTON-AUDIT-GROUP-CODE      PIC  X(03)  VALUE 'VA'.  00630001
005500     05  PC-TKT-ERR-NO-TKT-VILN-SEQ      PIC S9(04)  VALUE 08     00640001
005600                                                     COMP.        00650001
005700     05  PC-TKT-ERR-WRG-MDSE-VILN-SEQ    PIC S9(04)  VALUE 26     00640001
005800                                                     COMP.        00650001
005900     05  PC-TKT-ERR-WRG-TKT-VILN-SEQ     PIC S9(04)  VALUE 27     00640001
006000                                                     COMP.        00650001
006100     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00720001
006200         'SUKRF524'.                                              00730001
006300     05  PC-TKT-NO-MATCH-SCREEN          PIC  X(08)  VALUE        00740001
006400         'SUKRF517'.                                              00750001
006500     05  PC-CURRENT-TRANID               PIC  X(04)  VALUE 'S524'.00760001
006510     05  PC-TRANS-UNAVAILABLE-MSG   PIC X(19) VALUE                       
006520                                           'TRANS NOT AVAILABLE'.         
006600                                                                  00770001
006700 01  PV-PROGRAM-VARIABLES.                                        00780001
006800     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE ZERO   00790001
006900                                                     COMP SYNC.   00800001
007000     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  00810001
007100                                                     COMP SYNC.   00820001
007200     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 00830001
007300     05  PV-DECIMAL-COUNT                PIC S9(04)  VALUE ZERO   00831016
007400                                                     COMP.        00832016
007500     05  PV-DISPLAY-KEYS.                                         01010237
007600         10 FILLER                       PIC X(12)                01010337
007700            VALUE 'KEY VALUES: '.                                 01010437
007800         10 PV-DISP-AUD-CNTL-NBR         PIC 9(09).               01010537
007900         10 FILLER                       PIC X(04)                01010637
008000            VALUE ' -- '.                                         01010737
008100         10 PV-DISP-SHIPT-UNT-ID         PIC 9(18).               01010837
008200         10 FILLER                       PIC X(04)                01010937
008300            VALUE ' -- '.                                         01011037
008400         10 PV-DISP-UPC-NBR              PIC 9(15).               01011137
008500         10 FILLER                       PIC X(04)                01011237
008600            VALUE ' -- '.                                         01011337
008700         10 PV-DISP-SCN-TMST             PIC X(26).               01012037
008800     05  PV-SHORT-STYLE                  PIC X(12).                       
008900                                                                          
009000 01  DK-DB2-KEYS.                                                 00500005
009100     05  DK-UPC-NUMBER                   PIC S9(15) COMP-3.       00510005
009200*                                                                 00840001
009300******************************************************************00850001
009400*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      00860001
009500******************************************************************00870001
009600     COPY DFHAID.                                                 00880001
009700                                                                  00890001
009800                                                                  00900001
009900******************************************************************00910001
010000*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                00920001
010100******************************************************************00930001
010200     COPY DPWS013.                                                00940001
010300                                                                  00950001
010400******************************************************************00960001
010500*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 00970001
010600*****************************************************************.00980001
010700     COPY DPWS010I.                                               00990001
010800                                                                  01000001
010900******************************************************************01010001
011000*  GENERATED DSECT FOR THE SUKM524 MAPSET                         01020001
011100******************************************************************01030001
011200     COPY SUKM524.                                                01040001
011300                                                                  01050001
011400******************************************************************01060001
011500*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   01070001
011600******************************************************************01080001
011700     COPY DPWS015.                                                01090001
011800                                                                  01100001
011810*----------------------------------------------------------------*        
011820* HELP SCREEN COMMAREA                                                    
011830     COPY PCWS192.                                                        
011840*----------------------------------------------------------------*        
011850* HELP SCREEN WORK AREA                                                   
011860     COPY PCWS188.                                                        
011870                                                                          
011900******************************************************************01110001
012000*  COPY BOOK CONTAINING ERROR/WARNING/INFORMATIONAL MESSAGES      01120001
012100*  TO BE DISPLAYED ON THE LRT                                     01130001
012200******************************************************************01140001
012300     COPY SUWS005.                                                01150001
012400                                                                  01160001
012500******************************************************************01170001
012600*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT AUDIT01180001
012700*  TABLE (TSUATRN)                                                01190001
012800******************************************************************01200001
012900     EXEC SQL                                                     01210001
013000         INCLUDE TSUATRN                                          01220001
013100     END-EXEC.                                                    01230001
013200                                                                  01240001
013300******************************************************************01250001
013400*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      01260001
013500*  CONTENT AUDIT TABLE (TSUEXCP)                                  01270001
013600******************************************************************01280001
013700     EXEC SQL                                                     01290001
013800         INCLUDE TSUEXCP                                          01300001
013900     END-EXEC.                                                    01310001
014000                                                                  01320001
014100     EXEC SQL                                                     01290001
014200         INCLUDE TSUAUPC                                          01300001
014300     END-EXEC.                                                    01310001
014400                                                                  01320001
014500     EXEC SQL                                                     01290001
014600         INCLUDE TUPC                                             01300001
014700     END-EXEC.                                                    01310001
014800                                                                  01320001
014900     EXEC SQL                                                     01290001
015000         INCLUDE TUPCSKU                                          01300001
015100     END-EXEC.                                                    01310001
015200                                                                  01320001
015300******************************************************************01330001
015400*  COMMUNICATIONS AREA FOR DB2                                    01340001
015500******************************************************************01350001
015600     EXEC SQL                                                     01360001
015700         INCLUDE SQLCA                                            01370001
015800     END-EXEC.                                                    01380001
015900                                                                  01390001
016000                                                                  01400001
016100                                                                  01410001
016200******************************************************************01420001
016300 LINKAGE SECTION.                                                 01430001
016400******************************************************************01440001
016500 01  DFHCOMMAREA.                                                 01450001
016600     05  FILLER                         OCCURS  1 TO 4072 TIMES   01460001
016700                                        DEPENDING ON EIBCALEN.    01470001
016800         10  FILLER                     PIC X.                    01480001
016900                                                                  01490001
017000                                                                  01500001
017100******************************************************************01510001
017200 PROCEDURE DIVISION.                                              01520001
017300******************************************************************01530001
017400 0000-PROGRAM-MAINLINE.                                           01540001
017500     MOVE DFHCOMMAREA  TO  CA-COMMAREA.                           01550001
017600                                                                  01570001
017700     EVALUATE TRUE                                                01580001
017710****************************************************************          
017720* DPKRF278 IS THE PGM FOR THE HELP SCREEN.                                
017730****************************************************************          
017740         WHEN EIBTRNID = 'Z278'                                           
017750             MOVE DFHCOMMAREA          TO PC192-COMMAREA                  
017760             MOVE PC192-HOST-SAVE-AREA TO CA-COMMAREA                     
017770             SET SU006-PROCESS-SCREEN  TO TRUE                            
017780             PERFORM 8000-SEND-MAP                                        
017790             PERFORM 8200-RETURN-TRANID                                   
017791                                                                          
017800         WHEN EIBCALEN = ZERO                                     01590001
017900         WHEN EIBAID = DFHCLEAR                                   01600001
018000         WHEN SU006-INITIALIZE-SCREEN                             01610001
018100             SET SU006-PROCESS-SCREEN TO TRUE                     01630001
018200             PERFORM 8000-SEND-MAP                                01660001
018300             PERFORM 8200-RETURN-TRANID                           01670001
018400                                                                  01680001
018500         WHEN EIBAID = DFHPF3                                     01880004
018600             MOVE PC-TKT-NO-MATCH-SCREEN                                  
018700                                    TO  PV-TRANSFER-PROGRAM               
018800             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                01900004
018900                                                                  01910004
019000*        THE ONLY VALID FKEYS ARE 5,6 & 7.  LOGGED THE ERROR      01750001
019100*        BASED ON THE FKEY SELECTED AND TRANSFER CONTROL BACK     01760001
019200*        TO THE VISUAL TICKET INFO SCREEN                               01
019300         WHEN EIBAID = DFHPF5                                     01780001
019400         WHEN EIBAID = DFHPF6                                     01780001
019500         WHEN EIBAID = DFHPF7                                     01780001
019600             PERFORM 1500-CHECK-EXCEPTIONS                        01820001
019700             IF PS-EXCEPTION-ALREADY-LOGGED                       01830001
019800                MOVE PM-ERR-LOGGED-MSG TO AMSGLNO                         
019900             ELSE                                                         
020000                MOVE PC-TKT-NO-MATCH-SCREEN                             40
020100                                   TO  PV-TRANSFER-PROGRAM                
020200                PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                01860
020300             END-IF                                                       
020400                                                                  01870001
020410         WHEN EIBAID = DFHPF1                                             
020420              PERFORM 1400-HELP-SCREEN                                    
020430                                                                          
020500         WHEN OTHER                                               01920001
020600             MOVE PM-UNRECOGNIZED-PF-KEY-MSG  TO  AMSGLNO         01930001
020700                                                                  01940001
020800     END-EVALUATE.                                                01950001
020900                                                                  01960001
021000     PERFORM 8100-SEND-DATA-ONLY.                                 01970001
021100     PERFORM 8200-RETURN-TRANID.                                  01980001
021200                                                                  01990001
021300     GOBACK.                                                      02000001
021400****************************************************************  02010001
021500* 1000-SETUP-SCREEN                                               02020001
021600*    INITIAL SETUP OF AUDIT NUMBER AND STATUS                     02030001
021700****************************************************************  02040001
021800*                                                                 02240001
021900 1200-RECEIVE-MAP.                                                02250001
022000     EXEC CICS                                                    02260001
022100         RECEIVE                                                  02270001
022200             MAP     ('SU524A')                                   02280001
022300             MAPSET  ('SUKM524')                                  02290001
022400             RESP    (PV-CICS-RESPONSE)                           02300001
022500     END-EXEC.                                                    02310001
022600                                                                  02320001
022700     EVALUATE TRUE                                                02330001
022800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02340001
022900              CONTINUE                                                  01
023000         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                02360001
023100              CONTINUE                                            02370001
023200         WHEN OTHER                                               02380001
023300              MOVE '1200-RECEIVE-MAP'                             02390001
023400                                     TO DP013-PARAGRAPH           02400001
023500              MOVE 'UNABLE TO RECEIVE MAP'                        02410001
023600                                     TO DP013-MESSAGE-TEXT (1)    02420001
023700              SET DP013-LOGIC-ABEND  TO TRUE                      02430001
023800              SET DP013-NO-ROLLBACK  TO TRUE                      02440001
023900              PERFORM 9999-WRITE-CICS-LOG-MSG                     02450001
024000     END-EVALUATE.                                                02460001
024100*                                                                 02470001
024200*1210-RECEIVE-SCREEN-FIELDS.                                      02480001
024300*                                                                 02490001
024400                                                                  03870001
024401 1400-HELP-SCREEN.                                                        
024402     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM              
024403     MOVE 'SUKRF524'                  TO PC192-PROGRAM-NAME               
024404     COPY PCPD188.                                                        
024405     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.              
024406     PERFORM 4200-XCTL-TO-HELP.                                           
024407                                                                  08190043
024410                                                                  03870001
024500***************************************************************** 03880001
024600*   1500-CHECK-EXCEPTIONS                                       * 03890001
024700* COMPARE THE SCREEN VALUES WITH THE SYSTEM VALUES TO DETERMINE * 03900001
024800* WHICH EXCEPTIONS TO CREATE                                    * 03910001
024900***************************************************************** 03920001
025000 1500-CHECK-EXCEPTIONS.                                           03930001
025100                                                                  03940001
025200       IF EIBAID = DFHPF5                                               01
025300           MOVE PC-TKT-ERR-NO-TKT-VILN-SEQ                        03980001
025400                             TO SUEXCP-VILN-GP-SEQ-NBR            03990001
025500           PERFORM 1501-CREATE-EXCEPTION                          04000001
025600       END-IF.                                                    04010002
025700                                                                  04020001
025800       IF EIBAID = DFHPF6                                               01
025900           MOVE PC-TKT-ERR-WRG-MDSE-VILN-SEQ                      04060001
026000                             TO SUEXCP-VILN-GP-SEQ-NBR            04070001
026100           PERFORM 1501-CREATE-EXCEPTION                          04080001
026200       END-IF.                                                    04090002
026300                                                                  04100001
026400       IF EIBAID = DFHPF7                                               01
026500           MOVE PC-TKT-ERR-WRG-TKT-VILN-SEQ                       04140001
026600                             TO SUEXCP-VILN-GP-SEQ-NBR            04150001
026700           PERFORM 1501-CREATE-EXCEPTION                          04160001
026800       END-IF.                                                    04170002
026900                                                                  04290001
027000***************************************************************** 04300001
027100*   1501-CREATE-EXCEPTION                                       * 04310001
027200* CREATE THE APPROPRIATE EXCEPTION..........                    * 04320001
027300***************************************************************** 04330001
027400 1501-CREATE-EXCEPTION.                                           04340001
027500     MOVE PC-CARTON-AUDIT-GROUP-CODE TO SUEXCP-VILN-GP-CDE,       04350001
027600     MOVE SU006-AUDIT-CNTL-NBR       TO SUEXCP-AUD-CNTL-NBR.      04360001
027700     MOVE SU006-SHIP-UNIT-NBR        TO SUEXCP-SHIPT-UNT-ID.      04370001
027800     MOVE SU006-SCN-TMST             TO SUEXCP-SCN-TMST.          04380001
027900     MOVE SU006-UPC                  TO SUEXCP-UPC-NBR.           04390001
028000                                                                  04410001
028100     EXEC SQL                                                     04420001
028200         INSERT  INTO  TSUEXCP                                    04430001
028300                (AUD_CNTL_NBR                                     04440001
028400               , SHIPT_UNT_ID                                     04450001
028500               , UPC_NBR                                          04460001
028600               , SCN_TMST                                         04470001
028700               , VILN_GP_CDE                                      04480001
028800               , VILN_GP_SEQ_NBR                                  04490001
028900               , OVRRID_SYS_DAT_TXT)                              04500001
029000         VALUES                                                   04510001
029100             (                                                    04520001
029200                :SUEXCP-AUD-CNTL-NBR                              04530001
029300              , :SUEXCP-SHIPT-UNT-ID                              04540001
029400              , :SUEXCP-UPC-NBR                                   04550001
029500              , :SUEXCP-SCN-TMST                                  04560001
029600              , :SUEXCP-VILN-GP-CDE                               04570001
029700              , :SUEXCP-VILN-GP-SEQ-NBR                           04580001
029800              , :SUEXCP-OVRRID-SYS-DAT-TXT)                       04590001
029900     END-EXEC                                                     04600001
030000                                                                  04610001
030100     EVALUATE TRUE                                                04620001
030200         WHEN SQLCODE = ZERO                                      04630001
030300             CONTINUE                                             04640001
030400         WHEN SQLCODE = -803                                      04630001
030500             SET PS-EXCEPTION-ALREADY-LOGGED TO TRUE              04640001
030600                                                                  04650001
030700         WHEN SQLWARN0 NOT = SPACES                               04660001
030800         WHEN SQLCODE < ZERO                                      04670001
030900         WHEN SQLCODE > ZERO                                      04680001
031000             MOVE '1501-CREATE-EXCEPTION'                         04690001
031100                 TO DP013-PARAGRAPH                               04700001
031200             MOVE 'INSERT TO TSUEXCP TABLE'                       04710001
031300                 TO DP013-MESSAGE-TEXT (1)                        04720001
031400             MOVE SU006-SHIP-UNIT-NBR-X  TO DP013-MESSAGE-TEXT(3) 04730001
031500             MOVE SQLCA                  TO DP013-SQLCA           04740001
031600             MOVE 'TSUEXCP'            TO DP013-DB2-TABLE-NAME(1) 04750001
031700             SET DP013-DB2-ABEND         TO TRUE                  04760001
031800             SET DP013-NO-ROLLBACK       TO TRUE                  04770001
031900             PERFORM 9999-WRITE-CICS-LOG-MSG                      04780001
032000             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               04790001
032100             PERFORM 8100-SEND-DATA-ONLY                          04800001
032200             PERFORM 8200-RETURN-TRANID                           04810001
032300     END-EVALUATE.                                                04820001
032400                                                                  04830001
032500*    IF THE CURRENT SHIPPING UNIT AUDIT RECORD DOES NOT HAVE ANY  04840001
032600*    EXCEPTIONS CREATED YET, SET THE INDICATOR TO SAY THAT IT     04850001
032700*    DOES NOW                                                     04860001
032800     IF SU006-NO-AUD-ERR                                          04870001
032900         PERFORM 1600-UPDATE-SHIP-UNIT                            04880001
033000     END-IF.                                                      04890001
033100                                                                  04900001
033200                                                                  04910001
033300***************************************************************** 04920001
033400*   1600-UPDATE-SHIP-UNIT                                       * 04930001
033500* UPDATE THE AUDIT ERROR INDICATOR TO SAY THERE ARE EXCEPTIONS  * 04940001
033600* FOR THIS SHIPPING UNIT AUDIT                                  * 04950001
033700***************************************************************** 04960001
033800 1600-UPDATE-SHIP-UNIT.                                           04970001
033900                                                                  04980001
034000     MOVE SU006-AUDIT-CNTL-NBR TO SUATRN-AUD-CNTL-NBR.            04990001
034100     MOVE SU006-SHIP-UNIT-NBR TO SUATRN-SHIPT-UNT-ID.             05000001
034200                                                                  05010001
034300     EXEC SQL                                                     05020001
034400         UPDATE TSUATRN                                           05030001
034500            SET UNT_AUD_ERR_IND = 'Y'                             05040001
034600         WHERE   AUD_CNTL_NBR = :SUATRN-AUD-CNTL-NBR              05050001
034700           AND   SHIPT_UNT_ID = :SUATRN-SHIPT-UNT-ID              05060001
034800     END-EXEC                                                     05070001
034900                                                                  05080001
035000     EVALUATE TRUE                                                05090001
035100         WHEN SQLCODE = ZERO                                      05100001
035200             SET SU006-AUD-ERR TO TRUE                            05110001
035300                                                                  05120001
035400         WHEN SQLWARN0 NOT = SPACES                               05130001
035500         WHEN SQLCODE < ZERO                                      05140001
035600         WHEN SQLCODE > ZERO                                      05150001
035700             MOVE '1600-UPDATE-SHIP-UNIT'                         05160001
035800                 TO DP013-PARAGRAPH                               05170001
035900             MOVE 'UPDATE THE AUDIT ERROR CODE'                   05180001
036000                 TO DP013-MESSAGE-TEXT (1)                        05190001
036100             MOVE SU006-AUDIT-CNTL-NBR-X TO DP013-MESSAGE-TEXT(2) 05200001
036200             MOVE SU006-SHIP-UNIT-NBR-X  TO DP013-MESSAGE-TEXT(3) 05210001
036300             MOVE SQLCA                  TO DP013-SQLCA           05220001
036400             MOVE 'TSUATRN'            TO DP013-DB2-TABLE-NAME(1) 05230001
036500             SET DP013-DB2-ABEND         TO TRUE                  05240001
036600             SET DP013-NO-ROLLBACK       TO TRUE                  05250001
036700             PERFORM 9999-WRITE-CICS-LOG-MSG                      05260001
036800             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               05270001
036900             PERFORM 8100-SEND-DATA-ONLY                          05280001
037000             PERFORM 8200-RETURN-TRANID                           05290001
037100     END-EVALUATE.                                                05300001
037200                                                                  05310001
037300                                                                  10250035
037400***************************************************************** 05330001
037500*                                                               * 05340001
037600***************************************************************** 05350001
037700 2100-XCTL-TO-SELECTED-PROGRAM.                                   05360001
037800     SET SU006-INITIALIZE-SCREEN   TO  TRUE.                      05370001
037900     MOVE LENGTH OF CA-COMMAREA    TO  PV-COMMAREA-LENGTH.        05380001
038000     MOVE PC-CURRENT-PROGRAM-NAME  TO  SU006-LAST-PROGRAM.                
038100                                                                  05390001
038200     EXEC CICS                                                    05400001
038300         XCTL                                                     05410001
038400             PROGRAM   (PV-TRANSFER-PROGRAM)                      05420001
038500             COMMAREA  (CA-COMMAREA)                              05430001
038600             LENGTH    (PV-COMMAREA-LENGTH)                       05440001
038700             RESP      (PV-CICS-RESPONSE)                         05450001
038800     END-EXEC.                                                    05460001
038900                                                                  05470001
039000     EVALUATE TRUE                                                05480001
039100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05490001
039200              CONTINUE                                            05500001
039300         WHEN OTHER                                               05510001
039400              MOVE '2100-XCTL-TO-SELECTED-PROGRAM'                05520001
039500                                     TO DP013-PARAGRAPH           05530001
039600              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       05540001
039700                                     TO DP013-MESSAGE-TEXT (1)    05550001
039800              MOVE PV-TRANSFER-PROGRAM                            05560001
039900                                     TO DP013-MESSAGE-TEXT (2)    05570001
040000              SET DP013-CICS-ABEND   TO TRUE                      05580001
040100              SET DP013-NO-ROLLBACK  TO TRUE                      05590001
040200              PERFORM 9999-WRITE-CICS-LOG-MSG                     05600001
040300              MOVE PM-TRANS-NOT-AVAILABLE-MSG                     05610001
040400                                     TO AMSGLNO                   05620001
040500              SET SU006-PROCESS-SCREEN TO TRUE                    05630001
040600              PERFORM 8100-SEND-DATA-ONLY                         05640001
040700              PERFORM 8200-RETURN-TRANID                          05650001
040800     END-EVALUATE.                                                05660001
040900                                                                  05670001
040910 4200-XCTL-TO-HELP.                                                       
040920                                                                          
040930     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH.              
040940     SET  SU006-INITIALIZE-SCREEN     TO TRUE.                            
040950     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA.            
040960                                                                          
040970     EXEC CICS                                                            
040980         XCTL                                                             
040990             PROGRAM   (PV-TRANSFER-PROGRAM)                              
040991             COMMAREA  (PC192-COMMAREA)                                   
040992             LENGTH    (PV-COMMAREA-LENGTH)                               
040993             RESP      (PV-CICS-RESPONSE)                                 
040994     END-EXEC.                                                            
040995                                                                          
040996     EVALUATE TRUE                                                        
040997         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                         
040998              CONTINUE                                                    
040999         WHEN OTHER                                                       
041000             MOVE '4200-XCTL-TO-HELP '                                    
041001                 TO DP013-PARAGRAPH                                       
041002             MOVE 'SUKRF524 - UNABLE TO XCTL TO PROGRAM: '                
041003                 TO DP013-MESSAGE-TEXT (1)                                
041004             MOVE PV-TRANSFER-PROGRAM                                     
041005                 TO DP013-MESSAGE-TEXT (2)                                
041006             SET DP013-CICS-ABEND  TO TRUE                                
041007             SET DP013-ROLLBACK TO TRUE                                   
041008             PERFORM 9999-WRITE-CICS-LOG-MSG                              
041009             MOVE PC-TRANS-UNAVAILABLE-MSG TO AMSGLNO                     
041010             SET SU006-PROCESS-SCREEN TO TRUE                             
041011             PERFORM 8000-SEND-MAP                                        
041012             PERFORM 8200-RETURN-TRANID                                   
041013     END-EVALUATE.                                                        
041020                                                                  05680001
041100                                                                  05690001
041200******************************************************************05700001
041300*  8000-SEND-MAP                                                 *05710001
041400*  SEND THE REFRESHED MAP IMAGE TO THE SCREEN                    *05720001
041500******************************************************************05730001
041600 8000-SEND-MAP.                                                   05740001
041700     EXEC CICS                                                    05750001
041800         SEND                                                     05760001
041900             MAP     ('SU524A')                                   05770001
042000             MAPSET  ('SUKM524')                                  05780001
042100             ERASE                                                05790001
042200             RESP    (PV-CICS-RESPONSE)                           05800001
042300     END-EXEC.                                                    05810001
042400                                                                  05820001
042500     EVALUATE TRUE                                                05830001
042600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05840001
042700             CONTINUE                                             05850001
042800         WHEN OTHER                                               05860001
042900             MOVE '8000-SEND-MAP'   TO DP013-PARAGRAPH            05870001
043000             MOVE 'UNABLE TO SEND MAP'                            05880001
043100                                    TO DP013-MESSAGE-TEXT (1)     05890001
043200             SET DP013-CICS-ABEND   TO TRUE                       05900001
043300             SET DP013-NO-ROLLBACK  TO TRUE                       05910001
043400             PERFORM 9999-WRITE-CICS-LOG-MSG                      05920001
043500     END-EVALUATE.                                                05930001
043600*                                                                 05940001
043700 8100-SEND-DATA-ONLY.                                             05950001
043800                                                                  05960001
043900     EXEC CICS                                                    05970001
044000         SEND                                                     05980001
044100             MAP       ('SU524A')                                 05990001
044200             MAPSET    ('SUKM524')                                06000001
044300             CURSOR                                               06010001
044400             DATAONLY                                             06020001
044500             RESP      (PV-CICS-RESPONSE)                         06030001
044600     END-EXEC.                                                    06040001
044700                                                                  06050001
044800     EVALUATE TRUE                                                06060001
044900         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06070001
045000             CONTINUE                                             06080001
045100         WHEN OTHER                                               06090001
045200             MOVE '8100-SEND-DATA-ONLY'                           06100001
045300                                    TO DP013-PARAGRAPH            06110001
045400             MOVE 'UNABLE TO SEND DATA'                           06120001
045500                                    TO DP013-MESSAGE-TEXT (1)     06130001
045600             SET DP013-CICS-ABEND   TO TRUE                       06140001
045700             SET DP013-NO-ROLLBACK  TO TRUE                       06150001
045800             PERFORM 9999-WRITE-CICS-LOG-MSG                      06160001
045900     END-EVALUATE.                                                06170001
046000*                                                                 06180001
046100 8200-RETURN-TRANID.                                              06190001
046200     MOVE LENGTH OF CA-COMMAREA  TO  PV-COMMAREA-LENGTH.          06200001
046300                                                                  06210001
046400     EXEC CICS                                                    06220001
046500         RETURN                                                   06230001
046600             TRANSID   (PC-CURRENT-TRANID)                        06240001
046700             COMMAREA  (CA-COMMAREA)                              06250001
046800             LENGTH    (PV-COMMAREA-LENGTH)                       06260001
046900             RESP      (PV-CICS-RESPONSE)                         06270001
047000     END-EXEC.                                                    06280001
047100                                                                  06290001
047200     EVALUATE TRUE                                                06300001
047300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06310001
047400             CONTINUE                                             06320001
047500         WHEN OTHER                                               06330001
047600             MOVE '8200-RETURN-TRANID'                            06340001
047700                                    TO DP013-PARAGRAPH            06350001
047800             MOVE 'UNABLE TO RETURN TO TRANID'                    06360001
047900                                    TO DP013-MESSAGE-TEXT (1)     06370001
048000             SET DP013-CICS-ABEND   TO TRUE                       06380001
048100             SET DP013-NO-ROLLBACK  TO TRUE                       06390001
048200             PERFORM 9999-WRITE-CICS-LOG-MSG                      06400001
048300     END-EVALUATE.                                                06410001
048400*                                                                 06420001
048500*                                                                 06430001
048600 9999-WRITE-CICS-LOG-MSG.                                         06440001
048700     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            06450001
048800     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           06460001
048900     INITIALIZE DP013-SRC-TASK-NUMBER                             06470001
049000                DP013-STACK.                                      06480001
049100     SET DP013-LINK-RETURN           TO TRUE.                     06490001
049200                                                                  06500001
049300     EXEC CICS                                                    06510001
049400         LINK                                                     06520001
049500             PROGRAM   (DP013-NAME)                               06530001
049600             COMMAREA  (DP013-PARAMETERS)                         06540001
049700             LENGTH    (DP013-LENGTH)                             06550001
049800     END-EXEC.                                                    06560001
049900                                                                  06570001
050000*----------------------------------------------------------------*06580001
050100*    ABEND PROCESSOR MODULE                                      *06590001
050200*----------------------------------------------------------------*06600001
050300                                                                  06610001
050400     COPY DPPD014.                                                06620001
050500                                                                  06630001
