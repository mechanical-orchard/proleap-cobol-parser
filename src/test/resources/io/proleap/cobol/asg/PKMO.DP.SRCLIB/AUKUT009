000100 IDENTIFICATION DIVISION.                                         00010002
000200 PROGRAM-ID.         AUKUT009.                                    00020002
000300 AUTHOR.             BARB ERTL.                                   00030002
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040002
000500 DATE-WRITTEN.       FEBRUARY 2008.                               00050002
000600 DATE-COMPILED.                                                   00060002
000700                                                                  00070002
000800******************************************************************00080002
000900* THIS PROGRAM EXTRACTS THE 3RD PARTY GIFT CARD RECONCILIATIONS  *00090004
001000* FOR THE WEEK.                                                  *00100004
001100******************************************************************00110002
CH2352******************************************************************00111015
CH2352*  01/12/2015  GIFT COMMISSION SETUP HAS BEEN CHANGED. REVISED    00112015
CH2352*              COMMISSION RATE WILL BECOME EFFECTIVE ON THE NEXT  00113015
CH2352*              DAY OF OLD COMMSSION OF ANY UPC.QUERY HAS BEEN     00114015
CH2352*              MODIFIED TO PICK THE CORRECT COMMISSION RATE       00114115
CH2352*              INSTEAD OF ABENDING IT.                            00114215
CH2352* MADE  BY: COGNIZANT                        CHG0102352           00115015
CH2352***************************************************************** 00116015
001200                                                                  00120002
001300******************************************************************00130002
001400 ENVIRONMENT DIVISION.                                            00140002
001500******************************************************************00150002
001600                                                                  00160002
001700 CONFIGURATION SECTION.                                           00170002
001800                                                                  00180002
001900 SOURCE-COMPUTER.    IBM-3090.                                    00190002
002000 OBJECT-COMPUTER.    IBM-3090.                                    00200002
002100                                                                  00210002
002200 INPUT-OUTPUT SECTION.                                            00220002
002300                                                                  00230002
002400 FILE-CONTROL.                                                    00240002
002500                                                                  00250002
002600     SELECT CONTROL-CARD         ASSIGN TO INP01.                 00260002
002700     SELECT RECON-FILE           ASSIGN TO OUT01.                 00270002
002800                                                                  00280002
002900******************************************************************00290002
003000 DATA DIVISION.                                                   00300002
003100******************************************************************00310002
003200                                                                  00320002
003300 FILE SECTION.                                                    00330002
003400                                                                  00340002
003500 FD  CONTROL-CARD                                                 00350004
003600     RECORDING MODE IS F                                          00360002
003700     BLOCK CONTAINS 0 RECORDS                                     00370002
003800     LABEL RECORDS ARE OMITTED.                                   00380002
003900                                                                  00390002
004000 01  CONTROL-RECORD              PIC  X(80).                      00400004
004100                                                                  00410002
004200 FD  RECON-FILE                                                   00420004
004300     RECORDING MODE IS F                                          00430004
004400     BLOCK CONTAINS 0 RECORDS                                     00440004
004500     LABEL RECORDS ARE OMITTED.                                   00450004
004600                                                                  00460004
004700 01  RECON-RECORD                PIC  X(80).                      00470004
004800                                                                  00480004
004900 WORKING-STORAGE SECTION.                                         00490002
005000                                                                  00500002
005100 01  ABEND-CODE                  PIC S9(04)     VALUE +0  COMP.   00510002
005200     88  AC-CONTROL-CARD-ERROR                       VALUE +4003. 00520004
005300     88  AC-DB2-ERROR                                VALUE +4013. 00530004
005400     88  AC-CALENDAR-ROUTINE-ERROR                   VALUE +4019. 00540004
005500                                                                  00550002
005600******************************************************************00560002
005700*    PC-PROGRAM CONSTANTS                                        *00570002
005800******************************************************************00580002
005900 01  PC-PROGRAM-CONSTANTS.                                        00590002
006000     05  PC-PROGRAM-NAME         PIC X(08)      VALUE 'AUKUT009'. 00600002
006100                                                                  00610002
006200******************************************************************00620002
006300*    PV-PROGRAM VARIABLES                                        *00630002
006400******************************************************************00640002
006500 01  PV-PROGRAM-VARIABLES.                                        00650002
006600     05  PV-PARAGRAPH-NAME            PIC  X(30)     VALUE SPACES.00660002
006700     05  PV-OPERATION-MSG-1           PIC  X(30)     VALUE SPACES.00670005
006800     05  PV-OPERATION-MSG-2           PIC  X(30)     VALUE SPACES.00680005
006900     05  PV-START-DATE                PIC  X(10)     VALUE SPACES.00690004
007000     05  PV-END-DATE                  PIC  X(10)     VALUE SPACES.00700004
007100     05  PV-UPC-START                 PIC S9(15) COMP-3 VALUE 0.  00710003
007200     05  PV-UPC-END                   PIC S9(15) COMP-3 VALUE 0.  00720003
007300     05  PV-UPC-START-SETUP           PIC  9(15).                 00730008
007400     05  PV-UPC-START-SPLIT REDEFINES PV-UPC-START-SETUP.         00740008
007500         10  PV-UPC-START-1           PIC  9(14).                 00750009
007600         10  PV-UPC-START-2           PIC  9(01).                 00760009
007700     05  PV-UPC-END-SETUP             PIC  9(15).                 00770008
007800     05  PV-UPC-END-SPLIT REDEFINES PV-UPC-END-SETUP.             00780008
007900         10  PV-UPC-END-1             PIC  9(14).                 00790009
008000         10  PV-UPC-END-2             PIC  9(01).                 00800009
008100     05  PV-AUTH-TMST.                                            00810003
008200         10  PV-AUTH-TMST-DATE        PIC  X(10)     VALUE SPACES.00820003
008300         10  FILLER                   PIC  X(16)     VALUE SPACES.00830003
008400     05  PV-SAVE-UPC                  PIC S9(15) COMP-3 VALUE 0.  00840004
008500                                                                  00850002
008600******************************************************************00860002
008700*    PS-PROGRAM SWITCHES                                         *00870002
008800******************************************************************00880002
008900 01  PS-PROGRAM-SWITCHES.                                         00890002
009000     05  PS-END-OF-RECONCILE-CSR-SW   PIC  X(01)     VALUE 'N'.   00900004
009100         88  PS-END-OF-RECONCILE-CURSOR              VALUE 'Y'.   00910004
009200     05  PS-END-OF-CONTROL-SW         PIC  X(01)     VALUE 'N'.   00920004
009300         88  PS-END-OF-CONTROL                       VALUE 'Y'.   00930004
009400                                                                  00940002
009500******************************************************************00950002
009600*    PA-PROGRAM ACCUMULATORS                                     *00960002
009700******************************************************************00970002
009800 01  PA-PROGRAM-ACCUMULATORS.                                     00980002
009900     05  PA-RECONCILE-ROWS-FETCHED    PIC S9(11)     COMP-3       00990004
010000                                                     VALUE ZEROES.01000002
010100     05  PA-RECONCILE-ROWS-WRITTEN    PIC S9(11)     COMP-3       01010004
010200                                                     VALUE ZEROES.01020002
010300                                                                  01030002
010400******************************************************************01040004
010500* RECORD LAYOUT FOR INPUT DATE CARD                               01050004
010600******************************************************************01060004
010700  01  CC-CONTROL-CARD.                                            01070004
010800      05  CC-DATE                      PIC X(10) VALUE SPACES.    01080004
010900      05  FILLER                       PIC X(70) VALUE SPACES.    01090004
011000                                                                  01100004
011100******************************************************************01110002
011200*              EXTRACT RECORD LAYOUT                             *01120002
011300******************************************************************01130002
011400     COPY AURD016.                                                01140002
011500                                                                  01150002
011600******************************************************************01160002
011700*    CALENDAR ROUTINE STORAGE                                    *01170005
011800******************************************************************01180002
011900     COPY DPWS500.                                                01190005
012000                                                                  01200002
012100******************************************************************01210005
012200*    VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004     *01220005
012300******************************************************************01230005
012400     COPY DPWS004.                                                01240005
012500                                                                  01250005
012600******************************************************************01260002
012700*    3RD PARTY GIFT CARD TRANSACTION TABLE                       *01270002
012800******************************************************************01280002
012900     EXEC SQL                                                     01290002
013000         INCLUDE GCT00002                                         01300002
013100     END-EXEC.                                                    01310002
013200                                                                  01320002
013300******************************************************************01330002
013400*    3RD PARTY GIFT CARD RECONCILE TABLE                         *01340002
013500******************************************************************01350002
013600     EXEC SQL                                                     01360002
013700         INCLUDE GCT00001                                         01370002
013800     END-EXEC.                                                    01380002
013900                                                                  01390002
014000******************************************************************01400003
014100*    3RD PARTY GIFT CARD AUTH TABLE                              *01410003
014200******************************************************************01420003
014300     EXEC SQL                                                     01430003
014400         INCLUDE GCT00004                                         01440003
014500     END-EXEC.                                                    01450003
014600                                                                  01460003
014700******************************************************************01470003
014800*    3RD PARTY GIFT CARD COMMISSION TABLE                        *01480003
014900******************************************************************01490003
015000     EXEC SQL                                                     01500003
015100         INCLUDE GCT00005                                         01510003
015200     END-EXEC.                                                    01520003
015300                                                                  01530003
015400******************************************************************01540002
015500*    STANDARD LAYOUT FOR THE SQL COMMUNCATIONS AREA              *01550002
015600******************************************************************01560002
015700     EXEC SQL                                                     01570002
015800         INCLUDE SQLCA                                            01580002
015900     END-EXEC.                                                    01590002
016000                                                                  01600002
016100     COPY SQLCA2.                                                 01610002
016200                                                                  01620002
016300******************************************************************01630002
016400*    CURSOR DECLARATION FOR RECON    CURSOR                      *01640002
016500******************************************************************01650002
016600     EXEC SQL                                                     01660002
016700         DECLARE  RECON-CURSOR CURSOR FOR                         01670002
016800          SELECT  A.CRD_ACCT_NBR                                  01680002
016900                 ,A.UPC_NUMBER                                    01690002
017000                 ,A.CUST_CHRGD_AMT                                01700002
017100                 ,C.CRE_TMST                                      01710005
017200            FROM  GCT_GFT_CRD_TRN A                               01720002
017300                 ,GCT_GFT_CRD_RECNCL B                            01730002
017400                 ,GCT_VND_AUTH C                                  01740004
017500           WHERE A.CRD_ACCT_NBR = B.CRD_ACCT_NBR                  01750002
017600             AND A.CRD_ACCT_NBR = C.CRD_ACCT_NBR                  01760004
017700             AND B.VND_RECNCL_DTE BETWEEN :PV-START-DATE          01770004
017800                                      AND :PV-END-DATE            01780004
017900             AND C.CRE_TMST =                                     01790005
018000                   (SELECT MAX(D.CRE_TMST)                        01800005
018100                      FROM GCT_VND_AUTH D                         01810004
018200                     WHERE C.CRD_ACCT_NBR = D.CRD_ACCT_NBR)       01820004
018300           ORDER BY A.UPC_NUMBER                                  01830004
018400           WITH UR                                                01840002
018500     END-EXEC.                                                    01850002
018600                                                                  01860002
018700 PROCEDURE DIVISION.                                              01870002
018800                                                                  01880002
018900******************************************************************01890002
019000 0000-MAINLINE.                                                   01900002
019100******************************************************************01910002
019200                                                                  01920002
019300     PERFORM 1000-INITIALIZE.                                     01930002
019400                                                                  01940002
019500     PERFORM 2000-PROCESS-RECONCILE                               01950004
019600         UNTIL PS-END-OF-RECONCILE-CURSOR.                        01960004
019700                                                                  01970002
019800     PERFORM 3000-EOJ-ROUTINE.                                    01980002
019900                                                                  01990002
020000     GOBACK.                                                      02000002
020100******************************************************************02010002
020200*     1000-INITIALIZE                                            *02020002
020300* ==> PROCESSES:                                                 *02030002
020400*     -OPEN OUTPUT FILE                                          *02040002
020500*     -OPEN CURSOR                                               *02050002
020600*     -FETCH FIRST ROW OF CURSOR                                 *02060002
020700* ==> PERFORMED FROM: 0000-MAINLINE                              *02070002
020800******************************************************************02080002
020900 1000-INITIALIZE.                                                 02090002
021000                                                                  02100002
021100     OPEN INPUT  CONTROL-CARD                                     02110004
021200          OUTPUT RECON-FILE.                                      02120004
021300     PERFORM 1100-PROCESS-CONTROL-CARD.                           02130004
021400     PERFORM 7000-OPEN-RECONCILE-CURSOR.                          02140004
021500     PERFORM 7100-FETCH-RECONCILE-CURSOR.                         02150004
021600                                                                  02160004
021700******************************************************************02170004
021800* 1100-PROCESS-CONTROL-CARD                                       02180004
021900* READ DATE CONTROL CARD AND VALIDATE DATE.                       02190004
022000* IF VALID, GET BEGINNING AND END OF WEEK DATES.                  02200004
022100******************************************************************02210004
022200                                                                  02220004
022300 1100-PROCESS-CONTROL-CARD.                                       02230004
022400                                                                  02240004
022500     PERFORM 1110-READ-CONTROL-CARD.                              02250004
022600     CLOSE CONTROL-CARD.                                          02260004
022700     IF PS-END-OF-CONTROL                                         02270004
022800         MOVE '1100-PROCESS-CONTROL-CARD'  TO PV-PARAGRAPH-NAME   02280004
022900         MOVE 'NO CONTROL CARD TO PROCESS' TO PV-OPERATION-MSG-1  02290004
023000         SET AC-CONTROL-CARD-ERROR TO TRUE                        02300004
023100         PERFORM 9999-ABEND                                       02310004
023200     END-IF.                                                      02320004
023300                                                                  02330004
023400     PERFORM 1120-VALIDATE-CONTROL-CARD.                          02340004
023500                                                                  02350004
023600     MOVE DPG55-1ST-WKDY-DB2ISO-FMT  TO PV-START-DATE.            02360004
023700     MOVE DPG55-LAST-WKDY-DB2ISO-FMT TO PV-END-DATE.              02370004
023800     DISPLAY 'WEEK START DATE ' PV-START-DATE.                    02380004
023900     DISPLAY 'WEEK END DATE   ' PV-END-DATE.                      02390004
024000                                                                  02400004
024100******************************************************************02410004
024200* 1110-READ-CONTROL-CARD                                          02420004
024300* READ DATE CONTROL CARD.                                         02430004
024400******************************************************************02440004
024500                                                                  02450004
024600 1110-READ-CONTROL-CARD.                                          02460004
024700     READ CONTROL-CARD INTO CC-CONTROL-CARD                       02470004
024800        AT END                                                    02480004
024900           SET PS-END-OF-CONTROL TO TRUE.                         02490004
025000                                                                  02500004
025100******************************************************************02510004
025200* 1120-VALIDATE-CONTROL-CARD                                      02520004
025300* CALL KOHLS CALENDAR ROUTINE TO VERIFY THE CONTROL CARD DATA     02530004
025400* IS A VALID FISCAL MONTH-END DATE.                               02540004
025500******************************************************************02550004
025600                                                                  02560004
025700 1120-VALIDATE-CONTROL-CARD.                                      02570004
025800                                                                  02580004
025900     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              02590004
026000                                                                  02600004
026100     SET DPG51-ACTUAL-CALENDAR-ONLY                               02610004
026200         DPG52-LK-DTE-ISO-FMT          TO TRUE.                   02620004
026300                                                                  02630004
026400     MOVE CC-DATE                      TO DPG52-LK-DATE-INPUT.    02640004
026500                                                                  02650004
026600     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    02660004
026700                                             DPG54 DPG55 DPG56.   02670004
026800     EVALUATE TRUE                                                02680004
026900         WHEN DPG54-SEVERE-ERROR                                  02690004
027000         WHEN DPG54-DATE-INVALID                                  02700004
027100             MOVE '1120-VALIDATE-CONTROL-CARD'                    02710004
027200                                       TO PV-PARAGRAPH-NAME       02720004
027300             MOVE 'INVALID CONTROL DATE'                          02730004
027400                                       TO PV-OPERATION-MSG-1      02740004
027500             MOVE DPG54-ERROR-MESSAGE  TO PV-OPERATION-MSG-2      02750004
027600             SET AC-CONTROL-CARD-ERROR TO TRUE                    02760004
027700             PERFORM 9999-ABEND                                   02770004
027800     END-EVALUATE.                                                02780004
027900                                                                  02790004
028000******************************************************************02800002
028100*     2000-PROCESS-RECONCILE                                     *02810004
028200* ==> PROCESSES:                                                 *02820002
028300*     -PROCESS ROW FETCHED FROM THE CURSOR                       *02830002
028400*     -FETCHES THE NEXT ROW FROM THE CURSOR                      *02840002
028500* ==> PERFORMED FROM: 0000-MAINLINE                              *02850002
028600******************************************************************02860002
028700 2000-PROCESS-RECONCILE.                                          02870004
028800                                                                  02880002
028900     IF GCT00002-UPC-NUMBER = PV-SAVE-UPC                         02890004
029000         CONTINUE                                                 02900004
029100     ELSE                                                         02910004
029200         MOVE GCT00004-CRE-TMST TO PV-AUTH-TMST                   02920005
029300         MOVE GCT00002-UPC-NUMBER TO PV-UPC-START-1               02930004
029400                                     PV-UPC-END-1                 02940004
029500         MOVE 0                   TO PV-UPC-START-2               02950009
029600         MOVE 9                   TO PV-UPC-END-2                 02960009
029700         MOVE PV-UPC-START-SETUP  TO PV-UPC-START                 02970004
029800         MOVE PV-UPC-END-SETUP    TO PV-UPC-END                   02980004
029900         PERFORM 7300-GET-COMMISSION                              02990004
030000     END-IF.                                                      03000004
030100                                                                  03010004
030200     PERFORM 2100-WRITE-RECONCILE.                                03020004
030300     PERFORM 7100-FETCH-RECONCILE-CURSOR.                         03030004
030400                                                                  03040002
030500******************************************************************03050002
030600*     2100-WRITE-RECONCILE                                       *03060004
030700* ==> PROCESSES:                                                 *03070002
030800*     -FORMATS AND WRITES THE OUTPUT RECORD                      *03080002
030900* ==> PERFORMED FROM:  2000-PROCESS-RECONCILE                    *03090004
031000******************************************************************03100002
031100 2100-WRITE-RECONCILE.                                            03110004
031200                                                                  03120002
031300     INITIALIZE AU016-DETAIL-TRANS.                               03130004
031400                                                                  03140002
031500     MOVE GCT00002-CRD-ACCT-NBR    TO AU016-GIFT-CARD-NBR.        03150004
031600     MOVE GCT00002-CUST-CHRGD-AMT  TO AU016-TRANSACTION-AMT.      03160004
031700     MOVE GCT00005-UPC-NBR         TO AU016-UPC-NBR.              03170007
031800     MOVE GCT00005-UNT-COMMS-AMT   TO AU016-COMMISSION-AMT.       03180004
031900                                                                  03190002
032000     WRITE RECON-RECORD                                           03200002
032100         FROM AU016-DETAIL-TRANS.                                 03210004
032200                                                                  03220002
032300     ADD +1 TO PA-RECONCILE-ROWS-WRITTEN.                         03230004
032400                                                                  03240002
032500******************************************************************03250002
032600*     3000-EOJ-ROUTINE                                           *03260002
032700* ==> PROCESSES:                                                 *03270002
032800*     -CLOSES THE KMC RECONCILE CURSOR                           *03280004
032900* ==> PERFORMED FROM: 0000-MAINLINE                              *03290002
033000******************************************************************03300002
033100 3000-EOJ-ROUTINE.                                                03310002
033200                                                                  03320002
033300     PERFORM 7200-CLOSE-RECONCILE-CURSOR                          03330004
033400                                                                  03340002
033500     CLOSE RECON-FILE.                                            03350002
033600                                                                  03360002
033700     DISPLAY ' '.                                                 03370002
033800     DISPLAY PC-PROGRAM-NAME                                      03380002
033900             '  ROWS FETCHED FROM GCT_GFT_CRD_TRN    '            03390002
034000                                        PA-RECONCILE-ROWS-FETCHED.03400004
034100     DISPLAY PC-PROGRAM-NAME '  ROWS WRITTEN TO OUTPUT FILE:  '   03410002
034200                                        PA-RECONCILE-ROWS-WRITTEN.03420004
034300     DISPLAY ' '.                                                 03430002
034400                                                                  03440002
034500******************************************************************03450002
034600*     7000-OPEN-RECONCILE-CURSOR.                                *03460004
034700* ==> PROCESSES:                                                 *03470002
034800*     -OPENS THE RECONCILE CURSOR                                *03480004
034900* ==> PERFORMED FROM: 1000-INITIALIZE                            *03490002
035000******************************************************************03500002
035100 7000-OPEN-RECONCILE-CURSOR.                                      03510004
035200                                                                  03520002
035300     EXEC SQL                                                     03530002
035400         OPEN RECON-CURSOR                                        03540002
035500     END-EXEC.                                                    03550002
035600                                                                  03560002
035700     EVALUATE TRUE                                                03570002
035800         WHEN SQLCODE = +0                                        03580002
035900             CONTINUE                                             03590002
036000         WHEN OTHER                                               03600002
036100             MOVE '7000-OPEN-RECONCILE-CURSOR       '             03610004
036200                               TO PV-PARAGRAPH-NAME               03620002
036300             MOVE 'OPEN RECONCILE CURSOR      '                   03630004
036400                               TO PV-OPERATION-MSG-1              03640005
036500             PERFORM 9999-SQL-ABEND                               03650002
036600     END-EVALUATE.                                                03660002
036700                                                                  03670002
036800******************************************************************03680002
036900*     7100-FETCH-RECONCILE-CURSOR.                               *03690004
037000* ==> PROCESSES:                                                 *03700002
037100*     -FETCHES A ROW FROM THE RECONCILE CURSOR                   *03710004
037200* ==> PERFORMED FROM: 1000-INITIALIZE                            *03720002
037300*                     2000-PROCESS-RECONCILE                     *03730004
037400******************************************************************03740002
037500 7100-FETCH-RECONCILE-CURSOR.                                     03750004
037600                                                                  03760002
037700     EXEC SQL                                                     03770002
037800         FETCH  RECON-CURSOR                                      03780002
037900          INTO  :GCT00002-CRD-ACCT-NBR                            03790002
038000               ,:GCT00002-UPC-NUMBER                              03800002
038100               ,:GCT00002-CUST-CHRGD-AMT                          03810002
038200               ,:GCT00004-CRE-TMST                                03820005
038300     END-EXEC.                                                    03830002
038400                                                                  03840002
038500     EVALUATE TRUE                                                03850002
038600         WHEN SQLCODE = +0                                        03860002
038700             ADD +1 TO PA-RECONCILE-ROWS-FETCHED                  03870004
038800         WHEN SQLCODE = +100                                      03880002
038900             SET PS-END-OF-RECONCILE-CURSOR                       03890004
039000                               TO TRUE                            03900002
039100         WHEN OTHER                                               03910002
039200             MOVE '7100-FETCH-RECONCILE-CURSOR      '             03920004
039300                               TO PV-PARAGRAPH-NAME               03930002
039400             MOVE 'FETCH RECONCILE CURSOR     '                   03940004
039500                               TO PV-OPERATION-MSG-1              03950005
039600             PERFORM 9999-SQL-ABEND                               03960002
039700     END-EVALUATE.                                                03970002
039800                                                                  03980002
039900******************************************************************03990002
040000*     7200-CLOSE-RECONCILE-CURSOR.                               *04000004
040100* ==> PROCESSES:                                                 *04010002
040200*     -CLOSES THE RECONCILE CURSOR                               *04020004
040300* ==> PERFORMED FROM: 3000-EOJ-ROUTINE                           *04030002
040400******************************************************************04040002
040500 7200-CLOSE-RECONCILE-CURSOR.                                     04050004
040600                                                                  04060002
040700     EXEC SQL                                                     04070002
040800         CLOSE RECON-CURSOR                                       04080002
040900     END-EXEC.                                                    04090002
041000                                                                  04100002
041100     EVALUATE TRUE                                                04110002
041200         WHEN SQLCODE = +0                                        04120002
041300             CONTINUE                                             04130002
041400         WHEN OTHER                                               04140002
041500             MOVE '7200-CLOSE-RECONCILE-CURSOR      '             04150004
041600                               TO PV-PARAGRAPH-NAME               04160002
041700             MOVE 'CLOSE RECONCILE CURSOR     '                   04170004
041800                               TO PV-OPERATION-MSG-1              04180005
041900             PERFORM 9999-SQL-ABEND                               04190002
042000     END-EVALUATE.                                                04200002
042100                                                                  04210002
042200******************************************************************04220004
042300*     7300-GET-COMMISSION.                                       *04230004
042400* ==> PROCESSES:                                                 *04240004
042500*     -SELECTS THE COMMISSION AMOUNT FOR THE UPC                 *04250004
042600* ==> PERFORMED FROM: 2000-PROCESS-RECONCILE                     *04260004
042700******************************************************************04270004
042800 7300-GET-COMMISSION.                                             04280004
042900                                                                  04290004
043000     EXEC SQL                                                     04300004
043100         SELECT UPC_NBR                                           04310007
043200               ,UNT_COMMS_AMT                                     04320007
043300           INTO :GCT00005-UPC-NBR                                 04330007
043400               ,:GCT00005-UNT-COMMS-AMT                           04340007
043500           FROM GCT_VND_COMMS                                     04350004
043600          WHERE UPC_NBR BETWEEN :PV-UPC-START AND :PV-UPC-END     04360005
043700            AND :PV-AUTH-TMST-DATE >= EFF_STRT_DTE                04370010
CH2352            AND :PV-AUTH-TMST-DATE <= EFF_END_DTE                 04380015
043900          ORDER BY UPC_NBR                                        04390004
044000                  ,EFF_END_DTE                                    04400004
CH2352                   DESC                                           04401015
CH2352                   FETCH FIRST ROW ONLY                           04402015
044100           WITH UR                                                04410004
044200     END-EXEC.                                                    04420004
044300                                                                  04430004
044400     EVALUATE TRUE                                                04440004
044500         WHEN SQLCODE = 0                                         04450004
044600             CONTINUE                                             04460004
044700         WHEN SQLCODE = +100                                      04470004
044800             DISPLAY 'NO COMMISSION FOR UPC ' PV-UPC-START        04480011
044900             MOVE '7300-GET-COMMISSION' TO PV-PARAGRAPH-NAME      04490004
045000             MOVE 'SELECT FROM GCT_VND_COMMS   '                  04500004
045100                                            TO PV-OPERATION-MSG-1 04510005
045200             PERFORM 9999-SQL-ABEND                               04520004
045300         WHEN SQLWARN0 NOT EQUAL SPACE                            04530004
045400         WHEN SQLCODE NOT EQUAL ZERO                              04540004
045500             DISPLAY 'UPC ' PV-UPC-START                          04550011
045600             MOVE '7300-GET-COMMISSION' TO PV-PARAGRAPH-NAME      04560004
045700             MOVE 'SELECT FROM GCT_VND_COMMS   '                  04570004
045800                                            TO PV-OPERATION-MSG-1 04580005
045900             PERFORM 9999-SQL-ABEND                               04590004
046000     END-EVALUATE.                                                04600004
046100                                                                  04610004
046200******************************************************************04620004
046300* 9999-ABEND - PERFORMS A NON-SQL-ABEND                           04630004
046400******************************************************************04640004
046500 9999-ABEND.                                                      04650004
046600     DISPLAY '** ABEND           **'.                             04660004
046700     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          04670006
046800     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        04680004
046900     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       04690004
047000     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       04700004
047100     CALL 'ILBOABN0' USING ABEND-CODE.                            04710004
047200                                                                  04720004
047300******************************************************************04730002
047400*     9999-SQL-ABEND                                             *04740002
047500* ==> PROCESSES:                                                 *04750002
047600*     -PERFORMS ABEND PROCESSING FOR SQL ERRORS.                 *04760002
047700* ==> PERFORMED FROM:                                            *04770002
047800******************************************************************04780002
047900 9999-SQL-ABEND.                                                  04790002
048000                                                                  04800002
048100     DISPLAY '9999-SQL-ABEND'.                                    04810002
048200     DISPLAY '**  ABEND     **'.                                  04820002
048300     DISPLAY '**  PROGRAM   ** = ' PC-PROGRAM-NAME.               04830002
048400     DISPLAY '**  PARAGRAPH ** = ' PV-PARAGRAPH-NAME.             04840002
048500     DISPLAY '**  OPERATION ** = ' PV-OPERATION-MSG-1.            04850005
048600                                                                  04860002
048700******************************************************************04870002
048800* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *04880002
048900* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *04890002
049000* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *04900002
049100* FORMAT.                                                        *04910002
049200******************************************************************04920002
049300     COPY DPPD004.                                                04930002
049400                                                                  04940002
049500     SET AC-DB2-ERROR TO TRUE.                                    04950004
049600     CALL 'ILBOABN0' USING ABEND-CODE.                            04960002
