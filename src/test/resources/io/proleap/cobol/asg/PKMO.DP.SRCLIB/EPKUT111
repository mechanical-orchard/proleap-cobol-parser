000100 IDENTIFICATION DIVISION.                                         00002000
000200 PROGRAM-ID.      EPKUT111.                                       00003000
000300 AUTHOR.          ALEXIS KEIKER.                                  00004000
000310 DATE-WRITTEN.    NOVEMBER 12, 2002.                              00005000
000500                                                                  00006000
000600*-----------------------------------------------------------      00007000
000700*      CINC - CUSTOMER INCENTIVE RECORD CREATOR                   00008000
000800*-----------------------------------------------------------      00009000
000910* THIS PROGRAM WILL WRITE OUT CINC-CUSTOMER INCENTIVE RECORDS             
000920* FOR EACH INTERFACE ID FOUND IN THE INTERFACE ID FILE.                   
001100* THIS PROGRAM READS IN AN INTERFACE ID FILE. EACH RECORD         00030000
001200* WILL CONTAIN INFORMATION THAT WILL REQUIRE THIS PROGRAM         00040000
001300* TO EXECUTE CERTAIN QUERIES TO PULL THE INFORMATION              00050000
001400* FROM THE XS PROMO DOMAIN TABLES.  THIS INFORMATION WILL         00060000
001500* THEN BE USED TO CREATE CINC-CUSTOMER INCENTIVE RECORDS.         00070000
001510* THERE WILL BE A NUMBER OF DIFFERENT QUERIES THAT MAY POSSIBLY           
001700* BE EXECUTED.  THERE IS A SIMPLE PRICING QUERY, ALL RECORD       00090000
001800* TIERED PRICING QUERY, ALL RECORD EXCLUSION QUERY, SINGLE        00100000
001900* RECORD EXCLUSION QUERY, AND A SINGLE RECORD TIERED              00110000
002000* PRICING QUERY.  THE CORRECT QUERY IS EXECUTED DEPENDING         00120000
002100* ON WHAT TYPE OF BUSINESS EVENT IT IS, WHAT PRICING TYPE         00130000
002200* IT IS, AND IF IT IS AN EXCLUSION, INCLUSION, OR BOTH.           00140000
002300* THESE QUERIES ARE THEN EXECUTED TO GET THE INFORMATION          00150000
002310* NEEDED TO CREATE CINC-CUSTOMER INCENTIVE RECORDS THAT WILL              
002320* BE SENT DOWN TO THE STORES.                                             
002600*-----------------------------------------------------------      00180000
002700* HISTORY LOG:                                                    00190000
002800*-----------------------------------------------------------      00200000
002900* DATE: 07/28/2003                                                00210000
003000* WR/IR#: P000570009                                              00220000
003100* PROGRAMMER: SCOTT BARTELT                                       00230000
003200* DESCRIPTION: THE CURSOR FOR THE EXCLUSION DATA IS LOOKING       00240000
003300*              FOR THE STATUS CODE TO BE EQUAL TO THE             00250000
003400*              MERCHANDISE LINE TABLE.  THIS WILL NOT ALWAYS      00260000
003500*              BE THE CASE BECAUSE THE EXCLUSION CAN BE           00270000
003600*              DELETED, BUT THE MERCHANDISE LINE TABLE CAN        00280000
003700*              STILL BE ACTIVE BECAUSE THE PRICE IS STILL         00290000
003800*              ACTIVE.                                            00300000
003900*                                                                 00310000
004000* DATE: 07/29/2003                                                00320000
004100* WR/IR#: P000570495                                              00330000
004200* PROGRAMMER: SCOTT BARTELT                                       00340000
004300* DESCRIPTION: THE ESL TOPPER TYPE CODE WAS NOT WORKING.          00350000
004400*              IT WAS GETTING SET TO ZERO'S WHEN THE CODE         00360000
004500*              DID NOT EXIST FOR A PARTICULAR TABLE.  IT          00370000
004600*              THEN WAS BEING COMPARED TO OTHER NON-ZERO          00380000
004700*              VALUES AND THE ZERO WOULD ALWAYS WIN.              00390000
004800*                                                                 00400000
004900* DATE: 08/12/2003                                                00410000
005000* WR/IR#: P000574073                                              00420000
005100* PROGRAMMER: SCOTT BARTELT                                       00430000
005200* DESCRIPTION: WHEN FULL FILES ARE BEING PROCESSED THE            00440000
005300*              PROGRAM SHOULD USE THE BATCH DATE.  CURRENTLY      00450000
005400*              IT IS USING BATCH DATE + 1.                        00460000
005500*                                                                 00470000
005600* DATE: 08/27/2003                                                00480000
005700* WR/IR#: WR25647                                                 00490000
005800* PROGRAMMER: SCOTT BARTELT                                       00500000
005900* DESCRIPTION: ADDED LOGIC FOR ENHANCED BOGO TYPE OF 'GBL'.       00510000
006000*                                                                 00520000
006100* DATE: 09/18/2003                                                00530000
006200* WR/IR#: WR25647                                                 00540000
006300* PROGRAMMER: SCOTT BARTELT                                       00550000
006400* DESCRIPTION: CHANGED LOGIC SO THAT IF THE PRICING TYPE          00560000
006500*              CODE IS 'GAO', 'GBG', OR 'GBL' AND IT IS A         00570000
006600*              DELETE RECORD WE WILL ONLY CREATE THE PMAP         00580000
006700*              RECORD.                                            00590000
006800*                                                                 00600000
006900* DATE: 10/03/2003                                                00610000
007000* WR/IR#: P00593598                                               00620000
007100* PROGRAMMER: JODY TAINTER                                        00630000
007200* DESCRIPTION: CHANGED PMAP RECORD FOR TIERED TO HAVE SUB         00640000
007300*              INTERFACE ID.                                      00650000
007400*                                                                 00660000
007500* DATE: 11/05/2003                                                00670000
007600* WR/IR#: WR26114                                                 00680000
007700* PROGRAMMER: NANCY MARTIN                                        00690000
007800* DESCRIPTION: ADDED LOGIC FOR ENHANCED BOGO TYPES GBD & GBP.     00700000
007900*                                                                 00710000
008000* DATE: 01/20/2004                                                00720000
008100* WR/IR#: P00615821                                               00730000
008200* PROGRAMMER: SCOTT BARTELT                                       00740000
008300* DESCRIPTION: CHANGED LOGIC SO THAT WHEN TIERED PRICING IS BEING 00750000
008400*              PROCESSED, PROMO RECORDS ARE ONLY PRODUCED WHEN THE00760000
008500*              INPUT RECORD ACTION IS AN 'ADD'.  THERE WERE       00770000
008600*              SITUATIONS OCCURING WITH TIERED INPUT RECORDS OF   00780000
008700*              'DELETE' WHERE ONLY CERTAIN MERCHANDISE SHOULD     00790000
008800*              HAVE BEEN REMOVED FROM THE TIERED, BUT INSTEAD     00800000
008900*              ALL MERCHANDISE WOULD BE REMOVED BECAUSE THE PROMO 00810000
009000*              RECORD WHICH ACCOUNTED FOR ALL THE MERCHANDISE     00820000
009100*              WOULD BE DELETED.  THE PROGRAM WILL NOW ONLY       00830000
009200*              CREATE DELETE PMAP(MERCHANDISE) RECORDS, AND       00840000
009300*              IT WILL BE UP TO THE 'DELPROMO' PROCESS ON THE     00850000
009400*              STORE SERVER TO CLEAN UP THE TIERED PROMO RECORDS  00860000
009500*              ONCE THEY HAVE EXPIRED.                            00870000
009600*                                                                 00880000
009700* DATE: 01/20/2004                                                00890000
009800* WR/IR#: P00625756                                               00900000
009900* PROGRAMMER: SCOTT BARTELT                                       00910000
010000* DESCRIPTION: THERE WAS A PROBLEM WITH DELETING LEVELS OF A      00920000
010100*              TIERED PROMOTION WHILE OTHERS LEVELS REMAINED      00930000
010200*              ACTIVE.  THE DELETE WOULD NOT BE WRITTEN OUT AND   00940000
010300*              SENT TO THE STORE SERVER.  THIS WAS BECAUSE THE    00950000
010400*              SQL HAD A JOIN ON STATUS CODE BETWEEN THE TIER     00960000
010500*              TABLE AND THE MERCHANDISE TABLE.  THESE WOULD NOT  00970000
010600*              MATCH IN THIS SITUATION BECAUSE THE MERCHANDISE    00980000
010700*              IS STILL ACTIVE WHILE THE TIER LEVEL IS DELETED.   00990000
010800*                                                                 01000000
010900* DATE: 01/20/2004                                                01010000
011000* WR/IR#: P00625758                                               01020000
011100* PROGRAMMER: SCOTT BARTELT                                       01030000
011200* DESCRIPTION: THERE WAS A PROBLEM WITH TIERED PROMOTIONS IN      01040000
011300*              CONJUCTION WITH A STORE GROUP(120) DATE CHANGE.    01050000
011400*              BASICALLY WHEN THE STORE GROUP RECORD WOULD BE     01060000
011500*              PROCESSED IT WOULD PICK UP ALL TIER LEVELS WHETHER 01070000
011600*              SCHEDULED OR DELETED AND THEN IT WOULD SEND THEM   01080000
011700*              ALL DOWN AS ADD RECORDS THUS REINSTATING THE TIER  01090000
011800*              LEVELS WHICH WERE IN A DELETE/CANCEL STATUS AT THE 01100000
011900*              STORE SERVER.                                      01110000
012000*                                                                 01120000
012100* DATE: 03/05/2004                                                01130000
012200* WR/IR#: WR26737                                                 01140000
012300* PROGRAMMER: SCOTT BARTELT                                       01150000
012400* DESCRIPTION: ADDED LOGIC FOR THE NEW PROMOTION TYPES OF:        01160000
012500*               - GROUP PERCENT OFF (GPO)                         01170000
012600*               - PRICE POINT GOLDSTAR (CPP)                      01180000
012700*               - DOLLAR OFF GOLDSTAR (CAO)                       01190000
012800*               - TIERED BY QUANTITY, GET DOLLAR OFF (TQA)        01200000
012900*               - TIERED BY DOLLAR, GET DOLLAR OFF (TAA)          01210000
013000*                                                                 01220000
013100* DATE: 06/09/2004                                                01230000
013200* WR/IR#: WR27171                                                 01240000
013300* PROGRAMMER: SCOTT BARTELT                                       01250000
013400* DESCRIPTION: ENHANCE CURRENT BUY ONE GET ONE CAPABILITIES       01260000
013500*              TO INCLUDE THE PURCHASE OF 1 OR MORE ITEMS.        01270000
013600*              THE BENEFIT REMAINS AT ONE.                        01280000
013700*                                                                 01290000
013800* DATE: 07/23/2004                                                01300000
013900* WR/IR#: P00674723                                               01310000
014000* PROGRAMMER: SCOTT BARTELT AND NANCY MARTIN                      01320000
014100* DESCRIPTION: THERE WERE PROBLEMS WITH ADD HOC PROMTION          01330000
014200*              CORRECTIONS. ONE WAS THAT ONLY PROMO RECS WERE     01340000
014300*              BEING CREATED (NEEDED BOTH PROMO AND PMAP ARE      01350000
014400*              NEEDED).  SECOND PROBLEM WAS STORES BEING TAKEN    01360000
014500*              OUT OF A LIST WERE NOT BEING SENT AS CORRECTIONS.  01370000
014600*                                                                 01380000
014610* DATE: 09/28/2004                                                01390000
014620* WR/IR#: P00696492                                               01400000
014630* PROGRAMMER: SCOTT BARTELT                                       01410000
014640* DESCRIPTION: A PROBLEM EXISTS WHERE IF THE PRICING OR THE       01420000
014650*              STORE GROUP ATTACHED TO A SIMPLE PROMOTION IS      01430000
014660*              DELETED THE PROGRAM CREATES A DELETE PROMO RECORD  01440000
014670*              FOR THE INTERFACE I.D. EVEN IF THERE ARE OTHER     01450000
014680*              MERCHANDISE ITEMS ATTACHED TO THAT INTERFACE I.D.  01460000
014690*                                                                 01461000
014692* DATE: 03/24/2005                                                01462000
014693* WR/IR#: WR27895                                                 01463000
014694* PROGRAMMER: SCOTT BARTELT                                       01464000
014695* DESCRIPTION: STYLE LEVEL PROMOTIONS AND EXCLUSIONS WILL NO      01465000
014696*              LONGER HAVE THE "PARENT" MERCHANDISE INFORMATION   01466000
014697*              POPULATED ON THE DB2 TABLES.  HOWEVER, RCS STILL   01467000
014698*              NEEDS THESE FIELDS ON THE PMAP RECORD.             01468000
014700*                                                                 01469000
014701* DATE: 02/02/2009                                                01469100
014702* WR/IR#: WR35484                                                 01469200
014703* PROGRAMMER: MEDHA CHOUDHURY                                     01469300
014704* DESCRIPTION: WITH THE POS MOVING FROM FMS TO SQL DB, THERE IS A 01469400
014705*              NEED TO CREATE ONE MORE EXTRACT FILE WHICH WILL    01469500
014706*              MAP TO THE NEW CUSTOMER INCENTIVE TABLES.THE CHANGE01469600
014707*              IS TO WRITE THE EXTRACTED DATA INTO A NEW FORMAT   01469700
014708*              THAT MAPS TO THE PROMOTION TABLES (CALLED THE      01469800
014709*              CUSTOMER INCENTIVE ) AT THE POS SIDE.              01469900
014710* *** PLEASE LOOK FOR WR35484 TO TRACK CHANGES AND NEW PARAGRAPHS 01470000
014720*                                                                 01470100
071610* DATE: 03/01/2010                                                01470200
071611* WR/IR#: WR38172                                                 01470300
071612* PROGRAMMER: CHERI PARMLEY                                       01470400
071613* DESCRIPTION: CHANGES IN THIS PROGRAM INCLUDE A NEW PRICE TYPE   01470500
071614*              CODE 'RBO' AND A NEW REBATE CODE OF 'RB'.  CHANGES 01470600
071615*              OCCUR WHEN THE CUSTOMER INCENTIVE FILE IS BEING    01470700
071616*              WRITTEN OUT.                                       01470800
071617*                                                                 01470901
071618* DATE: 07/30/2010                                                01471001
071619* WR/IR#: WR38172                                                 01471101
071620* PROGRAMMER: CHERI PARMLEY                                       01471201
071621* DESCRIPTION: RECOMPILE - REMOVE DISPLAYS                        01471301
071622*                                                                 01470100
071624* DATE: 05/16/2011                                                01471503
071625* WR/IR#: WR39620                                                 01471603
071626* PROGRAMMER: COGNIZANT                                           01471704
071627* DESCRIPTION: CHANGES MADE TO ALWAYS PICK DEPT, MAJOR CLASS, AND 01471803
071628*              SUB CLASS FROM XST_VND_STYL TABLE FOR PROMOS SET   01471903
071629*              UP BY STYLE TO POPULATE TEH CUSTOMER INCENTIVE     01472003
071630*              FILE.                                              01472103
071631*                                                                 01472202
071632* DATE: 06/05/2011                                                01470200
071634* WR/IR#: PBI12437/PKE7184                                        01470300
071635* PROGRAMMER: MARGARET MORRISON                                   01470400
071636* DESCRIPTION: REMOVE LOGIC FOR NT10 MIDTIER SERVER PROMO         01470500
071637*              AND PMAP FILE CREATION.                                    
071638*                                                                         
071639*----------------------------------------------------------       01471500
071640 ENVIRONMENT DIVISION.                                            01471600
071641*----------------------------------------------------------       01471700
071642 CONFIGURATION SECTION.                                           01471800
071643 SOURCE-COMPUTER.        IBM-3090.                                01471900
071644 OBJECT-COMPUTER.        IBM-3090.                                01472000
071645                                                                  01472100
071646 INPUT-OUTPUT SECTION.                                            01472200
071647                                                                  01472300
071648 FILE-CONTROL.                                                    01472400
071649                                                                  01472500
071650     SELECT PROMO-INTFC-ID-FILE                                   01472600
071651            ASSIGN TO INP01.                                      01473000
071652     SELECT CONTROL-CARD-CURR-PRICG-DTE                           01474000
071653            ASSIGN TO INP02.                                      01475000
071654     SELECT CUST-INCTV-FILE                                       01480000
071655            ASSIGN TO OUT01.                                      01490000
071656                                                                  01500000
071657 DATA DIVISION.                                                   01510000
071658 FILE SECTION.                                                    01520000
071659                                                                  01530000
071660 FD  PROMO-INTFC-ID-FILE                                          01540000
071661     RECORDING MODE F                                             01550000
071662     BLOCK CONTAINS 0 RECORDS                                     01560000
071663     LABEL RECORDS ARE OMITTED                                    01570000
071664     DATA RECORD IS PROMO-INTFC-ID-RECORD.                        01580000
071665 01  PROMO-INTFC-ID-RECORD           PIC X(200).                  01590000
071666                                                                  01600000
071667 FD  CONTROL-CARD-CURR-PRICG-DTE                                  01610000
071668     RECORDING MODE F                                             01620000
071669     BLOCK CONTAINS 0 RECORDS                                     01630000
071670     LABEL RECORDS ARE OMITTED                                    01640000
071671     DATA RECORD IS CNTRL-CARD-CURR-PRICG-DTE-REC.                01650000
071672 01  CNTRL-CARD-CURR-PRICG-DTE-REC   PIC  X(80).                  01660000
071680                                                                  01670000
071684 FD  CUST-INCTV-FILE                                              01820000
071685     RECORDING MODE F                                             01830000
071686     BLOCK CONTAINS 0 RECORDS                                     01840000
071687     LABEL RECORDS ARE OMITTED                                    01850000
071688     DATA RECORD IS CUST-INCTV-RECORD.                            01860000
071689 01  CUST-INCTV-RECORD               PIC X(350).                  01870000
071690                                                                  01880000
071691 WORKING-STORAGE SECTION.                                         01890000
071692*-----------------------------------------------------------      01900000
071693* PS- PROGRAM SWITCHES                                            01910000
071694*-----------------------------------------------------------      01920000
071695 01  PS-PROGRAM-SWITCHES.                                         01930000
071696     05  PS-END-OF-INPUT-FILE-SW        PIC X(01) VALUE 'Y'.      01940000
071697         88  PS-END-OF-INPUT-FILE                 VALUE 'N'.      01950000
071698         88  PS-NOT-END-OF-INPUT-FILE             VALUE 'Y'.      01960000
071699     05  PS-END-OF-CURSOR-SW            PIC X(01) VALUE 'N'.      01970000
071700         88  PS-END-OF-CURSOR                     VALUE 'Y'.      01980000
071701         88  PS-NOT-END-OF-CURSOR                 VALUE 'N'.      01990000
071702     05  PS-TYPE-OF-REC-SW              PIC X(01) VALUE 'N'.      02000000
071703         88  PS-JUST-PROMO-RECS                   VALUE 'P'.      02010000
071704         88  PS-JUST-PMAP-RECS                    VALUE 'M'.      02020000
071705         88  PS-ALL-RECS                          VALUE 'A'.      02030000
071706     05  PS-HOW-MANY-REC-SW             PIC X(01) VALUE 'N'.      02040000
071707         88  PS-SINGLE-REC                        VALUE 'Y'.      02050000
071708         88  PS-NOT-SNGL-REC                      VALUE 'N'.      02060000
071709     05  PS-SKIP-RECORDS-SW             PIC X(01) VALUE 'N'.      02070000
071710         88  PS-SKIP-REC                          VALUE 'Y'.      02080000
071711         88  PS-NOT-SKIP-REC                      VALUE 'N'.      02090000
071712     05  PS-RMS-EOF-SW                  PIC X(01) VALUE 'N'.      02100000
071713         88  PS-RMS-EOF                           VALUE 'Y'.      02110000
071714         88  PS-NOT-RMS-EOF                       VALUE 'N'.      02120000
071715     05  PS-ADHOC-EOF-SW                PIC X(01) VALUE 'N'.      02130000
071716         88  PS-ADHOC-EOF                         VALUE 'Y'.      02140000
071717         88  PS-NOT-ADHOC-EOF                     VALUE 'N'.      02150000
071718     05  PS-END-OF-CNTL-CRD-SW          PIC  X(001).              02160000
071719         88  PS-END-OF-CNTL-CRD-FILE              VALUE 'Y'.      02170000
071720         88  PS-NOT-END-OF-CNTL-CRD-FILE          VALUE 'N'.      02180000
071721**-- WR#35484 - B                                                 02190000
071722     05  PS-MDSE-INC-EXC-SW             PIC  X(001).              02200000
071723         88  PS-MDSE-INCLUDE                      VALUE 'Y'.      02210000
071724         88  PS-MDSE-EXCLUDE                      VALUE 'N'.      02220000
071725     05  PS-CINC-REC-CREATE-SW          PIC  X(001).              02230000
071726         88  PS-CINC-CREATE                       VALUE 'Y'.      02240000
071727         88  PS-CINC-DO-NOT-CREATE                VALUE 'N'.      02250000
071728**-- WR#35484 - E                                                 02260000
071729                                                                  02270000
071730*-----------------------------------------------------------      02280000
071731* PROGRAM CONSTANTS                                               02281000
071732*-----------------------------------------------------------      02282000
071733 01  PC-PROGRAM-CONSTANTS.                                        02283000
071734     05  PC-CURRENT-PROGRAM-NAME   PIC X(08) VALUE 'EPKUT111'.    02284000
071735     05  PC-MAX-RETRIES            PIC S9(04) VALUE +5 COMP.      02285000
071736     05  PC-PERCENT-OFF            PIC 9(08) VALUE 100.           02286000
071737     05  PC-PRICE-POINT            PIC 9(08) VALUE 200.           02287000
071738     05  PC-GROUP-PRICING          PIC 9(08) VALUE 300.           02288000
071739     05  PC-PRCT-OFF-GRP-PRC       PIC 9(08) VALUE 301.           02289000
071740     05  PC-TIER-DOLLAR-GET-PRCT   PIC 9(08) VALUE 400.           02290000
071741     05  PC-TIER-DOLLAR-GET-DOL    PIC 9(08) VALUE 401.           02300000
071742     05  PC-TIER-QTY-GET-PRCT      PIC 9(08) VALUE 402.           02310000
071743     05  PC-TIER-QTY-GET-DOL       PIC 9(08) VALUE 403.           02320000
071744     05  PC-DOLLAR-OFF             PIC 9(08) VALUE 500.           02330000
071745     05  PC-ADDL-PRCT-OFF          PIC 9(08) VALUE 600.           02340000
071746     05  PC-ADDL-DOLLAR-OFF        PIC 9(08) VALUE 601.           02350000
071747     05  PC-REGULAR-PRICE          PIC 9(08) VALUE 101.           02360000
071748     05  PC-REBATE-RECEIPT         PIC 9(08) VALUE 700.           02370000
071749     05  PC-BOGO-PRICING           PIC 9(08) VALUE 800.           02380000
071750     05  PC-BOGO-PERCENT           PIC 9(08) VALUE 801.           02390000
071751     05  PC-BOGO-DOLLAR            PIC 9(08) VALUE 802.           02400000
071752     05  PC-CHAR-ADD               PIC X(03) VALUE 'ADD'.         02410000
071753     05  PC-CHAR-L                 PIC X(01) VALUE 'L'.           02420000
071754     05  PC-PERCENT-SIGN           PIC X(01) VALUE '%'.           02430000
071755     05  PC-DOLLAR-SIGN            PIC X(01) VALUE '$'.           02440000
071756     05  PC-CHAR-OFF               PIC X(03) VALUE 'OFF'.         02450000
071757     05  PC-FILE-ACT-TYP-FUL       PIC X(03) VALUE 'FUL'.         02460000
071758     05  PC-CHAR-PERIOD            PIC X(03) VALUE '.'.           02470000
071759     05  PC-INCLUDE-PROMO          PIC 9(01) VALUE 0.             02480000
071760     05  PC-EXCLUDE-PROMO          PIC 9(01) VALUE 1.             02490000
071761     05  PC-REPEAT-YES             PIC 9(08) VALUE 1.             02500000
071762     05  PC-REPEAT-NO              PIC 9(08) VALUE 0.             02510000
071763**--  WR35484 - B                                                 02520000
071764     05  PC-NULL-VALUE             PIC X(01) VALUE '~'.           02530000
071765     05  PC-ZERO-VALUE             PIC 9(01) VALUE 0.             02540000
071766     05  PC-LMT-PER-TRN-QTY        PIC 9(01) VALUE 1.             02550000
071767     05  PC-SELN-TYP-GET           PIC X(03) VALUE 'GET'.         02560000
071768     05  PC-SELN-TYP-CMB           PIC X(03) VALUE 'CMB'.         02570000
071769     05  PC-SYS-IDENTIFIER         PIC X(02) VALUE 'PM'.          02580000
071770     05  PC-SIMPLE-PROMOTION       PIC X(02) VALUE 'SP'.          02590000
071771     05  PC-TIERED-PROMOTION       PIC X(02) VALUE 'TR'.          02600000
071772     05  PC-TRGR-TYP-CDE           PIC X(03) VALUE 'SCN'.         02610000
071773     05  PC-SECT-TYP-CDE           PIC X(01) VALUE 'R'.           02611000
071774     05  PC-CNCTR-CDE-AND          PIC X(03) VALUE 'AND'.         02612000
071775     05  PC-CNCTR-CDE-OR           PIC X(02) VALUE 'OR'.          02613000
071776     05  PC-MDSE-NOT-EXCLUDED      PIC X(01) VALUE 'N'.           02614000
071777     05  PC-MDSE-EXCLUDED          PIC X(01) VALUE 'Y'.           02615000
071778**--  WR35484 - E                                                 02616000
071779     05  PC-REBATE-CDE             PIC X(02) VALUE 'RB'.          02617000
071780                                                                  02618000
071781*-----------------------------------------------------------      02619000
071782* PV- PROGRAM VARIABLES                                           02619100
071783*-----------------------------------------------------------      02619200
071784 01  PV-PROGRAM-VARAIBLES.                                        02619300
071785     05  PV-SQL-SUB                PIC S9(4) VALUE +0 COMP.       02619400
071786     05  PV-HOLD-PROMO-INTFC-ID    PIC S9(10)V VALUE +0 COMP-3.   02619500
071787     05  PV-HOLD-MDSE-LNE-ID       PIC S9(10)V VALUE +0 COMP-3.   02619600
071788     05  PV-HOLD-EXCL-MDSE-ID      PIC S9(10)V VALUE +0 COMP-3.   02619700
071789     05  PV-HOLD-INTFC-SUB-ID      PIC S9(10)V VALUE +0 COMP-3.   02619800
071790     05  PV-SETUP-STR-GRP-TYP-CDE  PIC S9(05)  VALUE +0 COMP-3.   02619900
071791     05  PV-SETUP-STR-GRP-ID       PIC S9(10)  VALUE +0 COMP-3.   02620000
071792     05  PV-PROMO-CDE              PIC S9(10) VALUE +0 COMP.      02630000
071793     05  PV-BWP-QTY                PIC S9(08) VALUE +0 COMP-3.    02640000
071794     05  PV-SALE-PRICE             PIC S9(8)V9(2) VALUE +0 COMP-3.02650000
071795     05  PV-DOLLARS-OFF            PIC S9(8)V9(2) VALUE +0 COMP-3.02660000
071796     05  PV-PRCG-AMT               PIC S9(8)V9(2) VALUE +0 COMP-3.02670000
071797     05  PV-QTY                    PIC S9(10) VALUE +0 COMP.      02680000
071799     05  PV-BUY-QTY                PIC 9(10)  VALUE 0.            02680000
071801     05  PV-BUY-AMT                PIC 9(08)V99 VALUE 0.                  
071802     05  PV-BUY-AMT-X REDEFINES PV-BUY-AMT                                
071803                                   PIC 9(10).                             
071804     05  PV-POINTER-FIELD          PIC S9(03) VALUE +0.           02690000
071805     05  PV-HOLD-AND-IND           PIC X(01)  VALUE SPACES.       02700000
071806     05  PV-PRICG-TYP-CDE          PIC X(03)  VALUE SPACES.       02710000
071807     05  PV-PROMO-ESL-TOPR-TYP     PIC X(03)  VALUE SPACES.       02720000
071808     05  PV-MDSE-ESL-TOPR-TYP      PIC X(03)  VALUE SPACES.       02730000
071809     05  PV-RMS-ESL-TOPR-TYP       PIC X(03)  VALUE SPACES.       02740000
071810     05  PV-ADHOC-ESL-TOPR-TYP     PIC X(03)  VALUE SPACES.       02750000
071811     05  PV-PROMO-TYP-IND.                                        02760000
071812         10  FILLER                PIC X(02)  VALUE '00'.         02770000
071820         10  PV-PROMO-TYP-IND-1    PIC X(03)  VALUE SPACES.       02780000
071825*NEW FIELDS BELOW                                                         
071826*                                                                         
071827     05  PV-PROMO-TYP-IND-IND-OUT  PIC X(01) VALUE SPACES.                
071828         88 PV-PROMO-TYP-IND-YES-OUT   VALUE 'Y'.                         
071829         88 PV-PROMO-TYP-IND-NO-OUT    VALUE 'N'.                         
071830     05  PV-PROMO-TYP-IND-OUT      PIC X(05) VALUE SPACES.                
071831                                                                          
071832     05  PV-PRCT-DSCT              PIC 9(07)V999 VALUE 0.                 
071833     05  PV-PRCT-DSCT-X REDEFINES PV-PRCT-DSCT                            
071834                                   PIC 9(10).                             
071836     05  PV-DLRS-OFF               PIC 9(08)V99 VALUE 0.                  
071837     05  PV-DLRS-OFF-X REDEFINES PV-DLRS-OFF                              
071839*NEW FIELDS ABOVE                                                         
071840                                   PIC 9(10).                             
071841     05  PV-GROUP-NAME             PIC X(20)  VALUE SPACES.       02790000
071842     05  PV-CHAR-PRCT-DSCT-1       PIC X(05)  VALUE SPACES.       02800000
071843     05  PV-CHAR-PRCT-DSCT-2       PIC X(03)  VALUE SPACES.       02810000
071844     05  PV-CHAR-DLRS-OFF-1        PIC X(06)  VALUE SPACES.       02820000
071845     05  PV-CHAR-DLRS-OFF-2        PIC X(02)  VALUE SPACES.       02830000
071846     05  PV-SAVE-PRCT-DSCT.                                       02840000
071847         10  PV-SAVE-PRCT-DSCT-1   PIC 9(05)  VALUE 0.            02850000
071848         10  PV-SAVE-PRCT-DSCT-2   PIC 9(03)  VALUE 0.            02860000
071849     05  PV-SAVE-DLRS-OFF.                                        02870000
071850         10  PV-SAVE-DLRS-OFF-1    PIC 9(06)  VALUE 0.            02880000
071851         10  PV-SAVE-DLRS-OFF-2    PIC 9(02)  VALUE 0.            02890000
071852                                                                  02900000
071853     05  PV-STAT-CDES.                                            02910000
071854         10  PV-SCHEDULED-STAT     PIC X(01)  VALUE SPACES.       02920000
071855         10  PV-CANCEL-STAT        PIC X(01)  VALUE SPACES.       02930000
071856         10  PV-DELETE-STAT        PIC X(01)  VALUE SPACES.       02940000
071857                                                                  02950000
071858     05  PV-NULL-INDICATORS.                                      02960000
071859         10  PV-PROMO-NM-IND       PIC S9(4)  VALUE +0 COMP.      02970000
071860             88  PV-PROMO-NM-NULL             VALUE -1.           02980000
071861         10  PV-PROMO-QTY-IND      PIC S9(4)  VALUE +0 COMP.      02990000
071862             88  PV-PROMO-QTY-NULL            VALUE -1.           03000000
071863         10  PV-PROMO-ITM-ID-IND   PIC S9(4)  VALUE +0 COMP.      03010000
071864             88  PV-PROMO-ITM-ID-NULL         VALUE -1.           03020000
071865         10  PV-DEPT-NBR-IND       PIC S9(4)  VALUE +0 COMP.      03030000
071866             88  PV-DEPT-NBR-NULL             VALUE -1.           03040000
071867         10  PV-MAJ-CL-NBR-IND     PIC S9(4)  VALUE +0 COMP.      03050000
071868             88  PV-MAJ-CL-NBR-NULL           VALUE -1.           03060000
071869         10  PV-SUB-CL-NBR-IND     PIC S9(4)  VALUE +0 COMP.      03070000
071870             88  PV-SUB-CL-NBR-NULL           VALUE -1.           03080000
071871         10  PV-STYL-ID-IND        PIC S9(4)  VALUE +0 COMP.      03090000
071872             88  PV-STYL-ID-NULL              VALUE -1.           03100000
071873         10  PV-SKU-NBR-IND        PIC S9(4)  VALUE +0 COMP.      03110000
071874             88  PV-SKU-NBR-NULL              VALUE -1.           03120000
071875         10  PV-TKT-CLOR-IND       PIC S9(4)  VALUE +0 COMP.      03130000
071876             88  PV-TKT-CLOR-NULL             VALUE -1.           03140000
071877         10  PV-RCPT-CMMT-IND      PIC S9(4)  VALUE +0 COMP.      03150000
071878             88  PV-RCPT-CMMT-NULL            VALUE -1.           03160000
071879         10  PV-THRS-AMT-IND       PIC S9(4)  VALUE +0 COMP.      03170000
071880             88 PV-THRS-AMT-NULL              VALUE -1.           03180000
071881         10  PV-DISC-AMT-IND       PIC S9(4)  VALUE +0 COMP.      03190000
071882             88  PV-DISC-AMT-NULL             VALUE -1.           03200000
071883         10  PV-DISC-PCT-IND       PIC S9(4)  VALUE +0 COMP.      03210000
071884             88  PV-DISC-PCT-NULL             VALUE -1.           03220000
071885         10  PV-PRCG-AMT-IND       PIC S9(4)  VALUE +0 COMP.      03230000
071886             88  PV-PRCG-AMT-NULL             VALUE -1.           03240000
071887         10  PV-SUB-ID-IND         PIC S9(4)  VALUE +0 COMP.      03250000
071888             88  PV-SUB-ID-NULL               VALUE -1.           03260000
071889         10  PV-MDSE-ESL-TOPR-IND  PIC S9(4)  VALUE +0 COMP.      03270000
071890             88  PV-MDSE-ESL-TOPR-NULL        VALUE -1.           03280000
071891         10  PV-PROMO-ESL-TOPR-IND PIC S9(4)  VALUE +0 COMP.      03290000
071892             88  PV-PROMO-ESL-TOPR-NULL       VALUE -1.           03300000
071893         10  PV-RMS-ESL-TOPR-IND PIC S9(4)    VALUE +0 COMP.      03310000
071894             88  PV-RMS-ESL-TOPR-NULL         VALUE -1.           03320000
071895         10  PV-ADHOC-ESL-TOPR-IND PIC S9(4)  VALUE +0 COMP.      03330000
071896             88  PV-ADHOC-ESL-TOPR-NULL       VALUE -1.           03340000
071897                                                                  03350000
071898     05  PV-DB2-FIELDS.                                           03360000
071899         10  PV-DB2-PROMO-ID       PIC S9(10)V VALUE +0 COMP-3.   03370000
071900         10  PV-DB2-DEPT-NBR       PIC S9(4)V VALUE +0 COMP-3.    03380000
071901         10  PV-DB2-MAJ-CL-NBR     PIC S9(4)V VALUE +0 COMP-3.    03390000
071902         10  PV-DB2-SUB-CL-NBR     PIC S9(4)V VALUE +0 COMP-3.    03400000
071903         10  PV-DB2-STYL-ID        PIC S9(8)V VALUE +0 COMP-3.    03410000
071904         10  PV-DB2-SKU-NBR        PIC S9(8)V VALUE +0 COMP-3.    03420000
071905         10  PV-DB2-MDSE-HIER-CDE  PIC X(03) VALUE SPACES.        03430000
071906         10  PV-DB2-TKT-CLOR-CDE   PIC X(01) VALUE SPACES.        03440000
071907         10  PV-DB2-RCPT-CMMT-TXT  PIC X(40) VALUE SPACES.        03450000
071908         10  PV-DB2-PROMO-ITM-ID   PIC S9(10)V VALUE +0 COMP-3.   03460000
071909         10  PV-DB2-PROMO-QTY      PIC S9(4) VALUE +0 COMP.       03470000
071910         10  PV-DB2-PRICG-AMT      PIC S9(7)V9(3) VALUE +0 COMP-3.03480000
071911         10  PV-DB2-PROMO-NAME     PIC X(40) VALUE SPACES.        03490000
071912         10  PV-DB2-PROMO-TYP-CDE  PIC X(02) VALUE SPACES.        03500000
071913         10  PV-DB2-PRICG-TYP-CDE  PIC X(03) VALUE SPACES.        03510000
071914         10  PV-DB2-INTFC-SUB-ID   PIC S9(10)V VALUE +0 COMP-3.   03520000
071915         10  PV-DB2-THRS-AMT       PIC S9(7)V9(2) VALUE +0 COMP-3.03530000
071916         10  PV-DB2-DISC-AMT       PIC S9(7)V9(2) VALUE +0 COMP-3.03540000
071917         10  PV-DB2-PRCG-AMT       PIC S9(7)V9(3) VALUE +0 COMP-3.03550000
071918         10  PV-DB2-DISC-PCT       PIC S9(3)V9(3) VALUE +0 COMP-3.03560000
071919         10  PV-DB2-EXCL-MDSE-ID     PIC S9(10)V VALUE +0 COMP-3. 03570000
071920         10  PV-DB2-MDSE-ESL-TOPR    PIC X(03) VALUE SPACES.      03580000
071921         10  PV-DB2-PROMO-ESL-TOPR   PIC X(03) VALUE SPACES.      03590000
071922         10  PV-DB2-RMS-ESL-TOPR     PIC X(03) VALUE SPACES.      03600000
071923         10  PV-DB2-ADHOC-ESL-TOPR   PIC X(03) VALUE SPACES.      03610000
071924                                                                  03620000
071925     05  PV-PRC-TYP-CDE            PIC X(03) VALUE SPACES.        03630000
071926         88  PV-SIMPLE-PRICING               VALUES 'SPO',        03640000
071927                                      'SRP', 'SPP', 'CPO',        03650000
071928                                      'GAO', 'MPP', 'GBG',        03660000
071929                                      'GBD', 'GBP', 'GBL',        03670000
071930                                      'GPO', 'CPP', 'CAO',        03680000
071931                                      'RBO'.                      03690000
071932         88  PV-TIERED-PRICING               VALUES 'TAP',        03700000
071933                                      'TQP', 'TQA', 'TAA'.        03710000
071934                                                                  03720000
071935     05  PV-PROMO-BUS-EVNT         PIC 9(03) VALUE 0.             03730000
071936         88  PV-PROMOTION-020                VALUE 020.           03740000
071937         88  PV-ADHC-STR-GP-040              VALUE 040.           03750000
071938         88  PV-ADHC-STR-LIST-050            VALUE 050.           03760000
071939         88  PV-PRICING-090                  VALUE 090.           03770000
071940         88  PV-PRICG-EXCL-110               VALUE 110.           03780000
071941         88  PV-PRICG-STR-GP-120             VALUE 120.           03790000
071942                                                                  03800000
071960    05  PV-DIST-LIST-DTE.                                         03990000
071961        10  PV-LIST-CCYY           PIC X(04) VALUE SPACES.        04000000
071962        10  PV-LIST-MM             PIC X(02) VALUE SPACES.        04010000
071963        10  PV-LIST-DD             PIC X(02) VALUE SPACES.        04020000
071964                                                                  04030000
071965    05  PV-SOR-LAST-UPD-TMST-LONG.                                04040000
071966        10  PV-LAST-UPD-LONG-DTE.                                 04050000
071967            15  PV-LAST-DTE-LONG-CCYY     PIC X(04).              04060000
071968            15  FILLER                    PIC X(01).              04070000
071969            15  PV-LAST-DTE-LONG-MM       PIC X(02).              04080000
071970            15  FILLER                    PIC X(01).              04090000
071971            15  PV-LAST-DTE-LONG-DD       PIC X(02).              04100000
071972        10  FILLER                        PIC X(01).              04110000
071973        10  PV-LAST-UPD-TM.                                       04120000
071974            15  PV-LAST-TM-LONG-HH        PIC X(02).              04130000
071975            15  FILLER                    PIC X(01).              04140000
071976            15  PV-LAST-TM-LONG-MM        PIC X(02).              04150000
071977            15  FILLER                    PIC X(01).              04160000
071978            15  PV-LAST-TM-LONG-SS        PIC X(02).              04170000
071979            15  FILLER                    PIC X(01).              04180000
071980            15  PV-LAST-TM-LONG-MMSS      PIC X(06).              04190000
071981                                                                  04200000
071982    05  PV-SOR-LAST-UPD-TMST.                                     04210000
071983        10  PV-LAST-UPD-DTE.                                      04220000
071984            15  PV-LAST-DTE-CCYY          PIC X(04).              04230000
071985            15  PV-LAST-DTE-MM            PIC X(02).              04240000
071986            15  PV-LAST-DTE-DD            PIC X(02).              04250000
071987        10  PV-LAST-UPD-TM.                                       04260000
071988            15  PV-LAST-TM-HH             PIC X(02).              04270000
071989            15  PV-LAST-TM-MM             PIC X(02).              04280000
071990            15  PV-LAST-TM-SS             PIC X(02).              04290000
071991            15  PV-LAST-TM-MMSS           PIC X(06).              04300000
071992                                                                  04310000
071993    05  PV-PROMO-STRT-TMST.                                       04320000
071994        10  PV-PROMO-STRT-DTE.                                    04330000
071995            15  PV-PROMO-STRT-DTE-CCYY    PIC X(04).              04340000
071996            15  FILLER                    PIC X(01).              04350000
071997            15  PV-PROMO-STRT-DTE-MM      PIC X(02).              04360000
071998            15  FILLER                    PIC X(01).              04370000
071999            15  PV-PROMO-STRT-DTE-DD      PIC X(02).              04380000
072000        10  FILLER                        PIC X(01).              04390000
072001        10  PV-PROMO-STRT-TM.                                     04400000
072002            15  PV-PROMO-STRT-TM-HH       PIC X(02).              04410000
072003            15  FILLER                    PIC X(01).              04420000
072004            15  PV-PROMO-STRT-TM-MM       PIC X(02).              04430000
072005            15  FILLER                    PIC X(01).              04440000
072006            15  PV-PROMO-STRT-TM-SS       PIC X(02).              04450000
072007            15  FILLER                    PIC X(01).              04460000
072008            15  PV-PROMO-STRT-TM-MMSS     PIC X(06).              04470000
072009                                                                  04480000
072010    05  PV-PROMO-END-TMST.                                        04490000
072011        10  PV-PROMO-END-DTE.                                     04500000
072012            15  PV-PROMO-END-DTE-CCYY     PIC X(04).              04510000
072013            15  FILLER                    PIC X(01).              04520000
072014            15  PV-PROMO-END-DTE-MM       PIC X(02).              04530000
072015            15  FILLER                    PIC X(01).              04540000
072016            15  PV-PROMO-END-DTE-DD       PIC X(02).              04550000
072017        10  FILLER                        PIC X(01).              04560000
072018        10  PV-PROMO-END-TM.                                      04570000
072019            15  PV-PROMO-END-TM-HH        PIC X(02).              04580000
072020            15  FILLER                    PIC X(01).              04590000
072021            15  PV-PROMO-END-TM-MM        PIC X(02).              04600000
072022            15  FILLER                    PIC X(01).              04610000
072023            15  PV-PROMO-END-TM-SS        PIC X(02).              04620000
072024            15  FILLER                    PIC X(01).              04630000
072025            15  PV-PROMO-END-TM-MMSS      PIC X(06).              04640000
072026                                                                  04650000
072027    05  PV-STRT-TM.                                               04660000
072028        10  PV-STRT-TM-HH                 PIC X(02).              04670000
072029        10  FILLER                        PIC X(01) VALUE ':'.    04680000
072030        10  PV-STRT-TM-MM                 PIC X(02).              04690000
072031        10  FILLER                        PIC X(01) VALUE ':'.    04700000
072032        10  PV-STRT-TM-SS                 PIC X(02).              04710000
072033                                                                  04720000
072034    05  PV-END-TM.                                                04730000
072035        10  PV-END-TM-HH                  PIC X(02).              04740000
072036        10  FILLER                        PIC X(01) VALUE ':'.    04750000
072037        10  PV-END-TM-MM                  PIC X(02).              04760000
072038        10  FILLER                        PIC X(01) VALUE ':'.    04770000
072039        10  PV-END-TM-SS                  PIC X(02).              04780000
072040                                                                  04790000
072041    05  PV-EP111-CC-ISO-DATE              PIC  X(010)             04800000
072042                                            VALUE SPACES.         04810000
072043**-- WR35484 - B                                                  04820000
072044    05  PV-CINCTV-EFF-BEG-TMST.                                   04830000
072045        10  PV-CINCTV-DATE-B              PIC X(10).              04840000
072046        10  PV-CINCTV-FILLER-B            PIC X(01) VALUE SPACE.  04850000
072047        10  PV-CINCTV-TIME-B              PIC X(08).              04860000
072048                                                                  04870000
072049    05  PV-CINCTV-EFF-END-TMST.                                   04880000
072050        10  PV-CINCTV-DATE-E              PIC X(10).              04890000
072051        10  PV-CINCTV-FILLER-E            PIC X(01) VALUE SPACE.  04900000
072052        10  PV-CINCTV-TIME-E              PIC X(08).              04901000
072053                                                                  04902000
072054    05  PV-PRIOR-INTFC-SUB-ID             PIC 9(10).              04903000
072055    05  PV-CURR-TIER-LVL-NUM              PIC 9(05).              04904000
072056                                                                  04905000
072057    05  PV-CINC-PROMO-SCHM.                                       04906000
072058        10 PV-CINC-ZERO                   PIC X(04).              04907000
072059        10 PV-CINC-CDE                    PIC X(04).              04908000
072060                                                                  04909000
072061    05  PV-CINC-ESL-TOPR-CD               PIC X(03) VALUE SPACES. 04909100
072062                                                                  04909200
072063**-- WR35484 - E                                                  04909300
072074*----------------------------------------------------------       04910400
072075* PROMO INTERFACE ID'S LAYOUT - INPUT                             04910500
072076*----------------------------------------------------------       04910600
072077     COPY EPRD072.                                                04910700
072078                                                                  04910800
072079*----------------------------------------------------------       04910900
072080* CUSTOMER INCENTIVE FILE LAYOUT - OUTPUT     WR#35484            04911000
072081*----------------------------------------------------------       04912000
072082     COPY EPRD216.                                                04913000
072083                                                                  04914000
072084*----------------------------------------------------------       04915000
072085* DATE ROUTINE COPY MEMBERS                                       04916000
072086*----------------------------------------------------------       04917000
072087     COPY DPWS500.                                                04918000
072088                                                                  04919000
072089*-----------------------------------------------------------      04920000
072090* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         04930000
072091*-----------------------------------------------------------      04940000
072092     COPY DPWS004.                                                04950000
072093                                                                  04960000
072094*-----------------------------------------------------------      04970000
072095* DB2 ABEND COPYBOOK                                              04980000
072096*-----------------------------------------------------------      04990000
072097     COPY DPWS900.                                                05000000
072098                                                                  05010000
072099*----------------------------------------------------------       05020000
072100* EPCC111 CONTROL CARD LAYOUT - CURRENT PRICING DATE              05030000
072101*----------------------------------------------------------       05040000
072102     COPY EPRD111.                                                05050000
072103                                                                  05060000
072104*-----------------------------------------------------------      05070000
072105* DB2 MESSAGE AREA                                                05080000
072106*-----------------------------------------------------------      05090000
072107     COPY SQLCA2.                                                 05100000
072108                                                                  05110000
072109*-----------------------------------------------------------      05120000
072110* PROGRAM COUNTERS                                                05130000
072111*-----------------------------------------------------------      05140000
072112 01  PC-PROGRAM-COUNTERS.                                         05150000
072113     05  PC-CNT-TIER-CHECK            PIC 9(09) VALUE 0.          05160000
072114     05  PC-CNT-READ-RECS             PIC 9(09) VALUE 0.          05170000
072117     05  PC-CNT-CUST-INCTV-RECS       PIC 9(09) VALUE 0.          05200000
072119     05  PC-CNT-SPACES                PIC 9(09) VALUE 0.          05220000
072120     05  PC-CNT-POS                   PIC 9(09) VALUE 0.          05230000
072121     05  PC-CNT-EXCL-CHECK            PIC 9(09) VALUE 0.          05240000
072123                                                                  05260000
072124*-----------------------------------------------------------      05270000
072125* ERROR HANDLING                                                  05280000
072126*-----------------------------------------------------------      05290000
072127 01  PV-MISC-ABEND-FIELDS.                                        05300000
072128     05  PV-PARAGRAPH-NAME            PIC X(30) VALUE SPACE.      05310000
072129     05  PV-OPERATION-MSG-1           PIC X(40) VALUE SPACE.      05320000
072130     05  PV-OPERATION-MSG-2           PIC X(40) VALUE SPACE.      05330000
072131     05  PV-DB2-OPERATION             PIC X(30) VALUE SPACE.      05340000
072132 01  ABEND-CODE                  PIC S9(4) VALUE ZEROS COMP SYNC. 05350000
072133     88  ABEND-4003-CTRL-CARD-ERROR        VALUE +4003.           05360000
072134     88  ABEND-4013-DB2-ERROR              VALUE +4013.           05370000
072135     88  ABEND-4019-CAL-SUB-ERROR          VALUE +4019.           05380000
072136     88  ABEND-4020-MQ-ERROR               VALUE +4020.           05390000
072137     88  ABEND-4444-FORCED-ABEND           VALUE +4444.           05400000
072138                                                                  05410000
072139*-----------------------------------------------------------      05420000
072140* DB2 COMMUNICATIONS AREA                                         05430000
072141*-----------------------------------------------------------      05440000
072142     EXEC SQL                                                     05450000
072143          INCLUDE SQLCA                                           05460000
072144     END-EXEC.                                                    05470000
072145                                                                  05480000
072146*----------------------------------------------------------------*05490000
072147* DB2 TABLE XST00013(XST_VND_STYL) - VENDOR STYLE TABLE           05500000
072148*----------------------------------------------------------------*05510000
072149     EXEC SQL                                                     05520000
072150       INCLUDE XST00013                                           05530000
072151     END-EXEC.                                                    05540000
072152                                                                  05550000
072153*-----------------------------------------------------------      05560000
072154* DB2 TABLE XST00026(XST_PROMO) - PROMOTION TABLE                 05570000
072155*-----------------------------------------------------------      05580000
072156     EXEC SQL                                                     05590000
072157          INCLUDE XST00026                                        05600000
072158     END-EXEC.                                                    05610000
072159                                                                  05620000
072160*-----------------------------------------------------------      05630000
072161* DB2 TABLE XST00028(XST_MDSE_LNE_SELN) - MERCHANDISE TABLE       05640000
072162*-----------------------------------------------------------      05650000
072163     EXEC SQL                                                     05660000
072164          INCLUDE XST00028                                        05670000
072165     END-EXEC.                                                    05680000
072166                                                                  05690000
072167*-----------------------------------------------------------      05700000
072168* DB2 TABLE XST00029(XST_PROMO_STR_GP) - RMS STORE GROUPS         05710000
072169*-----------------------------------------------------------      05720000
072170     EXEC SQL                                                     05730000
072171          INCLUDE XST00029                                        05740000
072172     END-EXEC.                                                    05750000
072173                                                                  05760000
072174*-----------------------------------------------------------      05770000
072175* DB2 TABLE XST00030(XST_SMP_PRICG) - SIMPLE PRICING TABLE        05780000
072176*-----------------------------------------------------------      05790000
072177     EXEC SQL                                                     05800000
072178          INCLUDE XST00030                                        05810000
072179     END-EXEC.                                                    05820000
072180                                                                  05830000
072181*-----------------------------------------------------------      05840000
072182* DB2 TABLE XST00031(XST_PROMO_ADHC_RLT) - ADHOC STORE TABLE      05850000
072183*-----------------------------------------------------------      05860000
072184     EXEC SQL                                                     05870000
072185          INCLUDE XST00031                                        05880000
072186     END-EXEC.                                                    05890000
072187                                                                  05900000
072188*-----------------------------------------------------------      05910000
072189* DB2 TABLE XST00034(XST_EXCL_MDSE) - EXCLUSION TABLE             05920000
072190*-----------------------------------------------------------      05930000
072191     EXEC SQL                                                     05940000
072192          INCLUDE XST00034                                        05950000
072193     END-EXEC.                                                    05960000
072194                                                                  05970000
072195*-----------------------------------------------------------      05980000
072196* DB2 TABLE XST00035(XST_TIER_PRICG) - TIERED PRICING TABLE       05990000
072197*-----------------------------------------------------------      06000000
072198     EXEC SQL                                                     06010000
072199          INCLUDE XST00035                                        06020000
072200     END-EXEC.                                                    06030000
072201                                                                  06040000
072202*-----------------------------------------------------------      06050000
072203* TIERED-CURSOR WILL FIND ALL TIERED RECORDS THAT CORRESPOND      06060000
072204* TO A CERTAIN PROMO INTERFACE ID AND MERCHANDISE ID.             06070000
072205*-----------------------------------------------------------      06080000
072206     EXEC SQL                                                     06090000
072207       DECLARE TIERED-CURSOR CURSOR FOR                           06100000
072208            SELECT  A.PROMO_ITM_ID                                06110000
072209                   ,A.PROMO_ID                                    06120000
072210                   ,A.DEPT_NBR                                    06130000
072211                   ,A.MAJ_CL_NBR                                  06140000
072212                   ,A.SUB_CL_NBR                                  06150000
072213                   ,A.STYL_ID                                     06160000
072214                   ,A.SKU_NBR                                     06170000
072215                   ,A.MDSE_HIER_CDE                               06180000
072216                   ,A.TKT_CLOR_CDE                                06190000
072217                   ,A.RCPT_CMMT_TXT                               06200000
072218                   ,A.ESL_TOPR_TYP_CDE                            06210000
072219                   ,B.PROMO_INTFC_SUB_ID                          06220000
072220                   ,B.THRS_QTY                                    06230000
072221                   ,B.THRS_AMT                                    06240000
072222                   ,B.DISC_AMT                                    06250000
072223                   ,B.DISC_PCT                                    06260000
072224              FROM  XST_MDSE_LNE_SELN A                           06270000
072225                   ,XST_TIER_PRICG B                              06280000
072226             WHERE  A.PROMO_INTFC_ID  = :PV-HOLD-PROMO-INTFC-ID   06290000
072227               AND  A.MDSE_LNE_ID     = :PV-HOLD-MDSE-LNE-ID      06300000
072228               AND  A.PROMO_INTFC_ID  = B.PROMO_INTFC_ID          06310000
072229               AND  A.MDSE_LNE_ID     = B.MDSE_LNE_ID             06320000
072230               AND ((B.STAT_CDE       = :PV-SCHEDULED-STAT)       06330000
072231                OR  (B.STAT_CDE       = :PV-CANCEL-STAT)          06340000
072232                OR  (B.STAT_CDE       = :PV-DELETE-STAT))         06350000
072233             ORDER BY THRS_QTY, THRS_AMT                          06360000
072234           WITH UR                                                06370000
072235     END-EXEC.                                                    06380000
072236                                                                  06390000
072237*-----------------------------------------------------------      06400000
072238* EXCLUDE-CURSOR WILL FIND ALL EXCLUSION RECORDS THAT             06410000
072239* CORRESPOND TO A CERTAIN PROMO INTERFACE ID AND MERCHANDISE      06420000
072240* ID.                                                             06430000
072241*-----------------------------------------------------------      06440000
072242     EXEC SQL                                                     06450000
072243       DECLARE EXCLUDE-CURSOR CURSOR FOR                          06460000
072244            SELECT  A.PROMO_ID                                    06470000
072245                   ,B.PROMO_INTFC_SUB_ID                          06480000
072246                   ,B.EXCL_MDSE_ID                                06490000
072247                   ,B.DEPT_NBR                                    06500000
072248                   ,B.MAJ_CL_NBR                                  06510000
072249                   ,B.SUB_CL_NBR                                  06520000
072250                   ,B.STYL_ID                                     06530000
072251                   ,B.SKU_NBR                                     06540000
072252                   ,B.MDSE_HIER_CDE                               06550000
072253              FROM  XST_MDSE_LNE_SELN A                           06560000
072254                   ,XST_EXCL_MDSE B                               06570000
072255             WHERE  A.PROMO_INTFC_ID  = :PV-HOLD-PROMO-INTFC-ID   06580000
072256               AND  A.MDSE_LNE_ID     = :PV-HOLD-MDSE-LNE-ID      06590000
072257               AND  A.PROMO_INTFC_ID  = B.PROMO_INTFC_ID          06600000
072258               AND  A.MDSE_LNE_ID     = B.MDSE_LNE_ID             06610000
072259               AND ((B.STAT_CDE       = :PV-SCHEDULED-STAT)       06620000
072260                OR  (B.STAT_CDE       = :PV-CANCEL-STAT)          06630000
072261                OR  (B.STAT_CDE       = :PV-DELETE-STAT))         06640000
072262             ORDER BY EXCL_MDSE_ID                                06650000
072263           WITH UR                                                06660000
072264     END-EXEC.                                                    06670000
072265                                                                  06680000
072266 LINKAGE SECTION.                                                 06690000
072267                                                                  06700000
072268*----------------------------------------------------------       06710000
072269 PROCEDURE DIVISION.                                              06720000
072270*----------------------------------------------------------       06730000
072271 0000-MAINLINE.                                                   06740000
072272                                                                  06750000
072273     PERFORM 1000-INITIALIZATION.                                 06760000
072274                                                                  06770000
072275     PERFORM 2000-PROCESS-RECORDS                                 06780000
072276             UNTIL PS-END-OF-INPUT-FILE.                          06790000
072277                                                                  06800000
072278     PERFORM 9999-WRAPUP.                                         06810000
072279                                                                  06820000
072280     GOBACK.                                                      06830000
072281                                                                  06840000
072282*0000-EXIT.                                                       06850000
072283 EJECT.                                                           06860000
072284                                                                  06870000
072285*----------------------------------------------------------       06880000
072286* 1000-INITIALIZATION.                                            06890000
072287*     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS      06900000
072288*     FILES, READS INPUT FILES, AND PROCESSES ANY INPUT FILE      06910000
072289*     PARAMETERS IT MAY NEED TO USE TO READ THE PROMO             06920000
072290*     INTERFACE ID FILE.                                          06930000
072291*----------------------------------------------------------       06940000
072292 1000-INITIALIZATION.                                             06950000
072293                                                                  06960000
072294     INITIALIZE EP072-PROMO-INTFC-RECORD.                         06970000
072295                                                                  06980000
072296     OPEN INPUT  PROMO-INTFC-ID-FILE                              06990000
072297                 CONTROL-CARD-CURR-PRICG-DTE                      07000000
072298          OUTPUT CUST-INCTV-FILE.                                 07030000
072299                                                                  07040000
072300     PERFORM 1010-READ-CURR-PRICG-DTE-CARD.                       07050000
072301     PERFORM 8000-DATE-ROUTINE.                                   07060000
072302                                                                  07070000
072303     PERFORM 9000-READ-INPUT-FILE.                                07080000
072304                                                                  07090000
072305     IF PS-END-OF-INPUT-FILE                                      07100000
072306        DISPLAY 'NO CINC-CUSTOMER INCENTIVE RECORDS WERE CREATED' 07101000
072307        DISPLAY 'NO PROMO INTERFACE IDS THAT WERE ELIGIBLE'       07102000
072308     END-IF.                                                      07103000
072309                                                                  07104000
072310*1000-EXIT.                                                       07105000
072320 EJECT.                                                           07106000
072400                                                                  07107000
072500*----------------------------------------------------------       07108000
072600* 1010-READ-CURR-PRICG-DTE-CARD.                                  07109000
072700*     READ CONTROL CARD EPCC111. THIS CONTROL CARD CONTAINS       07110000
072800*     THE CURRENT PRICING DATE.                                   07120000
072900*----------------------------------------------------------       07130000
073000 1010-READ-CURR-PRICG-DTE-CARD.                                   07140000
073100                                                                  07150000
073200     READ CONTROL-CARD-CURR-PRICG-DTE                             07160000
073300                               INTO EP111-CC-CONTROL-CARD         07170000
073400       AT END                                                     07180000
073500          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    07190000
073600                                                                  07200000
073700     IF PS-END-OF-CNTL-CRD-FILE                                   07210000
073800       DISPLAY ' '                                                07220000
073900       DISPLAY '** ABEND     **'                                  07230000
074000       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      07240000
074100       DISPLAY '** PARAGRAPH **  = 1010-READ-CURR-PRICG-DTE-CARD' 07250000
074200       DISPLAY '** CONTROL FILE IS EMPTY  '                       07260000
074300       DISPLAY ' '                                                07270000
074400       MOVE +4003 TO ABEND-CODE                                   07280000
074500       CALL 'ILBOABN0' USING ABEND-CODE                           07290000
074600     ELSE                                                         07300000
074700       DISPLAY '** CURRENT PRICING DATE CONTROL CARD  **'         07310000
074800       DISPLAY '** EPCC111       **  = ' EP111-CC-CRNT-DTE        07320000
074900       DISPLAY ' '                                                07330000
075000     END-IF.                                                      07340000
075100                                                                  07350000
075200                                                                  07360000
075300*1010-EXIT.                                                       07370000
075400 EJECT.                                                           07380000
075500                                                                  07390000
075600*----------------------------------------------------------       07400000
075700* 2000-PROCESS-RECORDS.                                           07410000
075800*     READ THE RECORD FROM THE PROMO INTERFACE FILE AND CREATE    07420000
075810*     CINC-CUSTOMER INCENTIVE RECORDS BASED ON THE RECORD READ.           
076000*----------------------------------------------------------       07440000
076100 2000-PROCESS-RECORDS.                                            07450000
076200                                                                  07460000
076410     INITIALIZE EP216-CUST-INCTV-RECORD                           07490000
076420                PV-CINC-ESL-TOPR-CD                               07500000
076500                PV-DB2-FIELDS                                     07510000
076600                PV-NULL-INDICATORS                                07520000
076700                PV-STAT-CDES.                                     07530000
076800     SET PS-ALL-RECS      TO TRUE.                                07540000
076900     SET PS-NOT-SNGL-REC  TO TRUE.                                07550000
077000     SET PS-NOT-SKIP-REC  TO TRUE.                                07560000
077100     SET PS-NOT-RMS-EOF   TO TRUE.                                07570000
077200     SET PS-NOT-ADHOC-EOF TO TRUE.                                07580000
077201     SET PS-MDSE-INCLUDE  TO TRUE.                                07590000
077202     SET PS-CINC-CREATE   TO TRUE.                                07600000
077210                                                                  07610000
077400     MOVE EP072-PRICG-TYP-CDE     TO PV-PRC-TYP-CDE.              07620000
077500     MOVE EP072-BUSINESS-EVENT-ID TO PV-PROMO-BUS-EVNT.           07630000
077600     MOVE EP072-PROMO-INTFC-ID    TO PV-HOLD-PROMO-INTFC-ID.      07640000
077700     MOVE EP072-MERCH-LNE-ID      TO PV-HOLD-MDSE-LNE-ID.         07650000
077800     MOVE EP072-PROMO-INTFC-SUB-ID                                07660000
077900                                  TO PV-HOLD-INTFC-SUB-ID.        07670000
078000     MOVE EP072-SETUP-STR-GRP-TYP-CDE                             07680000
078100                                  TO PV-SETUP-STR-GRP-TYP-CDE     07690000
078200     MOVE EP072-SETUP-STR-GRP-ID                                  07700000
078300                                  TO PV-SETUP-STR-GRP-ID.         07710000
078400     MOVE EP072-SOR-LAST-UPD-TMST TO PV-SOR-LAST-UPD-TMST-LONG.   07720000
078500     MOVE PV-LAST-DTE-LONG-CCYY   TO PV-LAST-DTE-CCYY.            07730000
078600     MOVE PV-LAST-DTE-LONG-MM     TO PV-LAST-DTE-MM.              07740000
078700     MOVE PV-LAST-DTE-LONG-DD     TO PV-LAST-DTE-DD.              07750000
078800     MOVE PV-LAST-TM-LONG-HH      TO PV-LAST-TM-HH.               07760000
078900     MOVE PV-LAST-TM-LONG-MM      TO PV-LAST-TM-MM.               07770000
079000     MOVE PV-LAST-TM-LONG-SS      TO PV-LAST-TM-SS.               07780000
079100     MOVE PV-LAST-TM-LONG-MMSS    TO PV-LAST-TM-MMSS.             07790000
079200     MOVE EP072-STR-GRP-PROMO-STRT-TMST                           07800000
079300                                  TO PV-PROMO-STRT-TMST.          07810000
079400     MOVE EP072-STR-GRP-PROMO-END-TMST                            07820000
079500                                  TO PV-PROMO-END-TMST.           07830000
079600     MOVE PV-PROMO-STRT-TM-HH     TO PV-STRT-TM-HH.               07840000
079700     MOVE PV-PROMO-STRT-TM-MM     TO PV-STRT-TM-MM.               07850000
079800     MOVE PV-PROMO-STRT-TM-SS     TO PV-STRT-TM-SS.               07860000
079900     MOVE PV-PROMO-END-TM-HH      TO PV-END-TM-HH.                07870000
080000     MOVE PV-PROMO-END-TM-MM      TO PV-END-TM-MM.                07880000
080100     MOVE PV-PROMO-END-TM-SS      TO PV-END-TM-SS.                07890000
080200                                                                  07900000
080300     MOVE PV-PROMO-STRT-DTE-CCYY  TO PV-LIST-CCYY.                07910000
080400     MOVE PV-PROMO-STRT-DTE-MM    TO PV-LIST-MM.                  07920000
080500     MOVE PV-PROMO-STRT-DTE-DD    TO PV-LIST-DD.                  07930000
080600                                                                  07940000
080610** WR#35484  CHANGES BEGIN                                        07950000
080620     PERFORM 2300-POPULATE-CUST-INCTV-HDR.                        07960000
080621** WR#35484  CHANGES END                                          07970000
080630                                                                  07980000
080700     EVALUATE TRUE                                                07990000
080800       WHEN (PV-PRICING-090 AND EP072-RECORD-ADD)                 08000000
080900            MOVE 'S' TO PV-SCHEDULED-STAT                         08010000
081000       WHEN (PV-PRICG-STR-GP-120 AND EP072-RECORD-DELETE)         08020000
081100            MOVE 'S' TO PV-SCHEDULED-STAT                         08030000
081200            MOVE 'C' TO PV-CANCEL-STAT                            08040000
081300            MOVE 'D' TO PV-DELETE-STAT                            08050000
081400       WHEN (PV-PRICG-STR-GP-120 AND EP072-RECORD-ADD)            08060000
081500            MOVE 'S' TO PV-SCHEDULED-STAT                         08061000
081600       WHEN (PV-ADHC-STR-LIST-050 AND EP072-RECORD-DELETE)        08062000
081700            MOVE 'S' TO PV-SCHEDULED-STAT                         08063000
081800            MOVE 'C' TO PV-CANCEL-STAT                            08064000
081900            MOVE 'D' TO PV-DELETE-STAT                            08065000
082000       WHEN (PV-ADHC-STR-LIST-050 AND EP072-RECORD-ADD)           08066000
082100         OR (PV-PROMOTION-020)                                    08067000
082200            MOVE 'S' TO PV-SCHEDULED-STAT                         08068000
082300       WHEN PV-PRICG-EXCL-110                                     08069000
082400            MOVE 'S' TO PV-SCHEDULED-STAT                         08070000
082500            MOVE 'C' TO PV-CANCEL-STAT                            08080000
082600            MOVE 'D' TO PV-DELETE-STAT                            08090000
082700       WHEN PV-PRICING-090 AND EP072-RECORD-DELETE                08100000
082800            MOVE 'C' TO PV-CANCEL-STAT                            08110000
082900            MOVE 'D' TO PV-DELETE-STAT                            08120000
083000     END-EVALUATE.                                                08130000
083100                                                                  08140000
083200     EVALUATE TRUE                                                08150000
083300       WHEN (PV-PRICING-090       AND EP072-RECORD-ADD)           08160000
083400         OR (PV-PRICG-STR-GP-120  AND EP072-RECORD-ADD)           08170000
083500         OR PV-ADHC-STR-LIST-050                                  08180000
083600            EVALUATE TRUE                                         08190000
083700              WHEN PV-SIMPLE-PRICING                              08200000
083800                   IF EP072-MDSE-INCLUDE                          08210000
084100                      PERFORM 3000-PROCESS-SMPL-PRC               08240000
084200                   ELSE                                           08250000
084300                      IF EP072-MDSE-INC-AND-EXC                   08260000
084600                         PERFORM 3000-PROCESS-SMPL-PRC            08290000
084700                         PERFORM 6000-PROCESS-EXCL-CINC           08300000
084800                      ELSE                                        08310000
085000                         PERFORM 6000-PROCESS-EXCL-CINC           08330000
085100                      END-IF                                      08340000
085200                   END-IF                                         08350000
085300              WHEN PV-TIERED-PRICING                              08360000
085400                   IF EP072-MDSE-INCLUDE                          08370000
085700                      PERFORM 4000-PROCESS-TIERED-PRC             08400000
085800                   ELSE                                           08410000
085900                      IF EP072-MDSE-INC-AND-EXC                   08420000
086200                         PERFORM 4000-PROCESS-TIERED-PRC          08450000
086300                         PERFORM 6000-PROCESS-EXCL-CINC           08460000
086400                      ELSE                                        08470000
086600                         PERFORM 6000-PROCESS-EXCL-CINC           08490000
086700                     END-IF                                       08500000
086800                   END-IF                                         08510000
086900            END-EVALUATE                                          08520000
087000       WHEN PV-PROMOTION-020                                      08530000
087100            SET PS-JUST-PROMO-RECS TO TRUE                        08540000
087300            EVALUATE TRUE                                         08560000
087400              WHEN PV-SIMPLE-PRICING                              08570000
087500                   PERFORM 3000-PROCESS-SMPL-PRC                  08580000
087600              WHEN PV-TIERED-PRICING                              08590000
087700                   PERFORM 4000-PROCESS-TIERED-PRC                08600000
087800            END-EVALUATE                                          08610000
087900       WHEN PV-PRICG-EXCL-110                                     08620000
088000            SET PS-SINGLE-REC TO TRUE                             08630000
088200            PERFORM 6000-PROCESS-EXCL-CINC                        08650000
088300       WHEN (PV-PRICING-090      AND EP072-RECORD-DELETE)         08660000
088400         OR (PV-PRICG-STR-GP-120 AND EP072-RECORD-DELETE)         08670000
088410            SET PS-JUST-PMAP-RECS TO TRUE                         08680000
088430                                                                  08700000
088500            EVALUATE TRUE                                         08710000
088600              WHEN PV-SIMPLE-PRICING                              08720000
088900                   PERFORM 3000-PROCESS-SMPL-PRC                  08730000
089000              WHEN PV-TIERED-PRICING                              08740000
089300                   IF PV-PRICING-090                              08750000
089400                     SET PS-SINGLE-REC TO TRUE                    08760000
089500                   END-IF                                         08770000
089600                   PERFORM 4000-PROCESS-TIERED-PRC                08780000
089700                   IF PV-PRICG-STR-GP-120                         08790000
089800                     PERFORM 6000-PROCESS-EXCL-CINC               08800000
089900                   END-IF                                         08810000
090000            END-EVALUATE                                          08820000
090100       WHEN OTHER                                                 08830000
090200            DISPLAY ' '                                           08840000
090300            DISPLAY 'INVALID BUSINESS EVENT AND RECORD ACTION'    08850000
090400            DISPLAY 'ERROR IN PROMO INTERFACE ID RECORD'          08860000
090500            DISPLAY 'BUSINESS EVENT ID: ' EP072-BUSINESS-EVENT-ID 08870000
090600            DISPLAY 'RECORD ACTION: ' EP072-RECORD-ACTION         08880000
090700            DISPLAY 'PROMO INTFC ID: ' EP072-PROMO-INTFC-ID       08890000
090800            DISPLAY 'MERCHANDISE LNE ID: ' EP072-MERCH-LNE-ID     08900000
090900            DISPLAY 'PROMO INTFC SUB ID: '                        08910000
091000                                     EP072-PROMO-INTFC-SUB-ID     08920000
091100            DISPLAY 'PRICING TYPE CODE: ' EP072-PRICG-TYP-CDE     08930000
091200            DISPLAY 'LAST UPDATED: ' EP072-SOR-LAST-UPD-TMST      08940000
091300            PERFORM 9800-ABEND                                    08950000
091400     END-EVALUATE.                                                08960000
091500                                                                  08970000
091600     PERFORM 9000-READ-INPUT-FILE.                                08980000
091700                                                                  08990000
091800*2000-EXIT.                                                       09000000
091900 EJECT.                                                           09010000
094300                                                                  09250000
096601*----------------------------------------------------------       09490000
096602* 2300-POPULATE-CUST-INCTV-HDR.              ** WR35484 **        09500000
096603*     POPULATE THE CUSTOMER INCENTIVE HEADER ATTRIBUTES.          09510000
096604*----------------------------------------------------------       09520000
096605 2300-POPULATE-CUST-INCTV-HDR.                                    09530000
096606                                                                  09540000
096608     MOVE EP072-FILE-ACT-TYP         TO EP216-FILE-ACT-TYP.       09550000
096609     MOVE EP072-STR-SELN-HIER-CDE    TO EP216-STR-HIER-CDE.       09560000
096610     MOVE PV-SOR-LAST-UPD-TMST       TO EP216-SOR-LAST-UPD-TMST.  09570000
096611     MOVE EP072-DIST-STR-GRP-TYP-CDE TO EP216-STR-GRP-TYP-CDE.    09580000
096612     MOVE EP072-DIST-STR-GRP-ID      TO EP216-STR-GRP-ID.         09590000
096613     MOVE EP072-BUSINESS-EVENT-ID    TO EP216-BUSINESS-EVENT-ID.  09600000
096614                                                                  09610000
096615     IF EP072-FILE-ACT-TYP = PC-FILE-ACT-TYP-FUL                  09620000
096616       MOVE PV-EP111-CC-ISO-DATE     TO EP216-STR-FILE-LIST-DTE   09630000
096617     ELSE                                                         09640000
096618       MOVE PV-DIST-LIST-DTE         TO EP216-STR-FILE-LIST-DTE   09650000
096619     END-IF.                                                      09660000
096620                                                                  09660100
096621     MOVE EP072-APPLY-IND            TO EP216-APPLY-IND.          09660200
096622                                                                  09660300
096623*2300-EXIT.                                                       09660400
096624 EJECT.                                                           09660500
096630                                                                  09660600
096700*----------------------------------------------------------       09660700
096800* 3000-PROCESS-SMPL-PRC.                                          09660800
096900*     PROCESS SIMPLE PRICING RECORDS.                             09660900
097000*----------------------------------------------------------       09661000
097100 3000-PROCESS-SMPL-PRC.                                           09661100
097200                                                                  09661200
097300     PERFORM 3100-SELECT-SMPL-PRICG-DATA.                         09661300
097400     IF PS-NOT-SKIP-REC                                           09661400
097500        PERFORM 7300-SELECT-PROMO-DATA                            09661500
097600        IF EP072-RMS-STR-PRC                                      09661600
097700          PERFORM 7400-SELECT-RMS-DATA                            09661700
097800            UNTIL PS-RMS-EOF                                      09661800
097900        ELSE                                                      09661900
098000          PERFORM 7500-SELECT-ADHOC-DATA                          09662000
098100            UNTIL PS-ADHOC-EOF                                    09663000
098200        END-IF                                                    09664000
098300                                                                  09665000
098400*** CREATE PROMO RECORDS                                          09666000
098500        EVALUATE TRUE                                             09667000
098600          WHEN EP072-PRICG-TYP-CDE = 'GAO' AND EP072-RECORD-DELETE09668000
098700          WHEN EP072-PRICG-TYP-CDE = 'GPO' AND EP072-RECORD-DELETE09669000
098800          WHEN EP072-PRICG-TYP-CDE = 'GBG' AND EP072-RECORD-DELETE09670000
098900          WHEN EP072-PRICG-TYP-CDE = 'GBL' AND EP072-RECORD-DELETE09680000
099000          WHEN EP072-PRICG-TYP-CDE = 'GBP' AND EP072-RECORD-DELETE09690000
099100          WHEN EP072-PRICG-TYP-CDE = 'GBD' AND EP072-RECORD-DELETE09700000
099200            CONTINUE                                              09710000
099300                                                                  09720000
099400          WHEN OTHER                                              09730000
099410            IF PS-ALL-RECS OR PS-JUST-PROMO-RECS                  09740000
099420*             CHECKS FOR RBO                                      09750000
099500              PERFORM 3200-CREATE-SMPL-PRC-RECS                   09760000
099610            END-IF                                                09780000
099700        END-EVALUATE                                              09790000
099840                                                                  09810000
099900*** CREATE PMAP RECORDS                                           09820000
100000        IF PS-ALL-RECS OR PS-JUST-PMAP-RECS                       09830000
100200*??        MOVE EP072-PROMO-INTFC-ID   TO PV-PROMO-CDE            09850000
100300           PERFORM 7200-PROCESS-MDSE-HIER                         09860000
100310           IF PS-NOT-SKIP-REC                                     09870000
100400             CONTINUE                                             09880000
100401           ELSE                                                   09890000
100402             SET PS-CINC-DO-NOT-CREATE TO TRUE                    09900000
100403             SET PS-NOT-SKIP-REC TO TRUE                          09910000
100410           END-IF                                                 09920000
100500        END-IF                                                    09930000
100510*** CREATE CUSTOMER INCENTIVE RECORDS    WR#35484-B               09940000
100520        IF PS-CINC-CREATE                                         09950000
100530           MOVE PC-NULL-VALUE TO EP216-CUST-SHRT-DESC             09960000
100540           PERFORM 7600-POPULATE-CUST-INCTV-REC                   09970000
100550           PERFORM 9300-WRITE-CUST-INCTV-REC                      09980000
100551        END-IF                                                    09990000
100560***                                      WR#35484-E               10000000
100600     END-IF.                                                      10010000
100700                                                                  10020000
100800*3000-EXIT.                                                       10030000
100900 EJECT.                                                           10040000
101000                                                                  10041000
101100*----------------------------------------------------------       10042000
101200* 3100-SELECT-SMPL-PRICG-DATA.                                    10043000
101300*     SELECT THE DATA NEEDED FOR THE SIMPLE PRICING RECORD.       10044000
101400*----------------------------------------------------------       10045000
101500 3100-SELECT-SMPL-PRICG-DATA.                                     10046000
101600                                                                  10047000
101700     PERFORM                                                      10048000
101800         WITH TEST AFTER                                          10049000
101900         VARYING PV-SQL-SUB                                       10050000
102000         FROM 1 BY 1                                              10060000
102100         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 10070000
102200                   OR  SQLCODE = 0                                10080000
102300                   OR  SQLCODE = +100)                            10090000
102400                                                                  10100000
102500         EXEC SQL                                                 10110000
102600             SELECT  A.PROMO_ID                                   10120000
102700                    ,A.DEPT_NBR                                   10130000
102800                    ,A.MAJ_CL_NBR                                 10140000
102900                    ,A.SUB_CL_NBR                                 10150000
103000                    ,A.STYL_ID                                    10160000
103100                    ,A.SKU_NBR                                    10170000
103110                    ,A.MDSE_HIER_CDE                              10180000
103200                    ,A.TKT_CLOR_CDE                               10190000
103300                    ,A.PROMO_ITM_ID                               10200000
103400                    ,A.ESL_TOPR_TYP_CDE                           10210000
103500                    ,B.DISC_GP_QTY                                10220000
103600                    ,B.DISC_PRCG_AMT                              10230000
103700               INTO  :PV-DB2-PROMO-ID                             10240000
103800                    ,:PV-DB2-DEPT-NBR :PV-DEPT-NBR-IND            10250000
103900                    ,:PV-DB2-MAJ-CL-NBR :PV-MAJ-CL-NBR-IND        10260000
104000                    ,:PV-DB2-SUB-CL-NBR :PV-SUB-CL-NBR-IND        10270000
104100                    ,:PV-DB2-STYL-ID :PV-STYL-ID-IND              10280000
104200                    ,:PV-DB2-SKU-NBR :PV-SKU-NBR-IND              10290000
104210                    ,:PV-DB2-MDSE-HIER-CDE                        10300000
104300                    ,:PV-DB2-TKT-CLOR-CDE :PV-TKT-CLOR-IND        10310000
104400                    ,:PV-DB2-PROMO-ITM-ID :PV-PROMO-ITM-ID-IND    10311000
104500                    ,:PV-DB2-MDSE-ESL-TOPR :PV-MDSE-ESL-TOPR-IND  10312000
104600                    ,:PV-DB2-PROMO-QTY :PV-PROMO-QTY-IND          10313000
104700                    ,:PV-DB2-PRCG-AMT                             10314000
104800               FROM  XST_MDSE_LNE_SELN A                          10315000
104900                    ,XST_SMP_PRICG B                              10316000
105000               WHERE A.PROMO_INTFC_ID = :PV-HOLD-PROMO-INTFC-ID   10317000
105100                 AND A.MDSE_LNE_ID    = :PV-HOLD-MDSE-LNE-ID      10318000
105200                 AND A.PROMO_INTFC_ID = B.PROMO_INTFC_ID          10319000
105300                 AND A.MDSE_LNE_ID    = B.MDSE_LNE_ID             10320000
105400                 AND A.STAT_CDE       = B.STAT_CDE                10330000
105500                 AND ((B.STAT_CDE     = :PV-SCHEDULED-STAT)       10340000
105600                  OR  (B.STAT_CDE     = :PV-CANCEL-STAT)          10350000
105700                  OR  (B.STAT_CDE     = :PV-DELETE-STAT))         10360000
105800               WITH UR                                            10370000
105900         END-EXEC                                                 10380000
106000                                                                  10390000
106100         EVALUATE TRUE                                            10400000
106200             WHEN SQLCODE = -904                                  10410000
106300             WHEN SQLCODE = -911                                  10420000
106400             WHEN SQLCODE = -913                                  10430000
106500                  CONTINUE                                        10440000
106600             WHEN SQLCODE = 0                                     10450000
106700                  CONTINUE                                        10460000
106800             WHEN SQLCODE = +100                                  10470000
106900                  SET PS-SKIP-REC TO TRUE                         10480000
107000             WHEN OTHER                                           10490000
107100                  DISPLAY 'PROMO INTFC ID: '                      10500000
107200                                         PV-HOLD-PROMO-INTFC-ID   10510000
107300                  DISPLAY 'MDSE LNE ID: ' PV-HOLD-MDSE-LNE-ID     10520000
107400                  DISPLAY 'SQLCODE: ' SQLCODE                     10530000
107500                  MOVE '3100-SELECT-SMPL-PRICG-DATA'              10540000
107600                                TO  PV-PARAGRAPH-NAME             10550000
107700                  MOVE 'SELECT SMPL PRICG DATA'                   10560000
107800                                TO  PV-DB2-OPERATION              10570000
107900                  PERFORM 9900-SQL-ABEND-ROUTINE                  10580000
108000         END-EVALUATE                                             10590000
108100     END-PERFORM.                                                 10600000
108200                                                                  10610000
108300     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         10620000
108400        DISPLAY 'SQLCODE: ' SQLCODE                               10630000
108500        MOVE '3100-SELECT-SMPL-PRICG-DATA'                        10640000
108600                              TO  PV-PARAGRAPH-NAME               10650000
108700        MOVE 'SELECT RETRIES EXCEEDED'                            10660000
108800                              TO  PV-DB2-OPERATION                10670000
108900        PERFORM 9900-SQL-ABEND-ROUTINE                            10680000
109000     END-IF.                                                      10690000
109100                                                                  10700000
109200*3100-EXIT.                                                       10710000
109300 EJECT.                                                           10720000
109400                                                                  10730000
109500*----------------------------------------------------------       10740000
109600* 3200-CREATE-SMPL-PRC-RECS.                                      10750000
109710*     CREATES SIMPLE PRICING CUSTOMER INCENTIVE RECORDS BY                
109720*     SELECTING WHICH TYPE OF SIMPLE PRICING RECORD NEEDS                 
109730*     TO BE CREATED.                                                      
109900*----------------------------------------------------------       10780000
110000 3200-CREATE-SMPL-PRC-RECS.                                       10790000
110100                                                                  10800000
110200*??  MOVE EP072-PROMO-INTFC-ID   TO PV-PROMO-CDE.                 10810000
110300                                                                  10820000
110400     PERFORM 7110-POPULATES-ESL-TOPR-TYP.                         22980000
110410                                                                  22990000
111600     EVALUATE TRUE                                                10950000
111700         WHEN EP072-PRICG-TYP-CDE = 'SPO' OR 'CPO'                10960000
111800              PERFORM 3210-CREATE-PERCENT-OFF                     10970000
111900         WHEN EP072-PRICG-TYP-CDE = 'SPP' OR 'CPP' OR 'MPP'       10980000
112000              PERFORM 3220-CREATE-PRICE-POINT                     10990000
112100         WHEN EP072-PRICG-TYP-CDE = 'SAO' OR 'CAO'                11000000
112200              PERFORM 3230-CREATE-DOLLAR-OFF                      11010000
112300         WHEN EP072-PRICG-TYP-CDE = 'SRP'                         11020000
112400              PERFORM 3240-CREATE-REG-PRICE                       11030000
112500         WHEN EP072-PRICG-TYP-CDE = 'GAO'                         11040000
112600              PERFORM 3250-CREATE-GRP-PRC                         11050000
112700         WHEN EP072-PRICG-TYP-CDE = 'APO'                         11060000
112800              PERFORM 3260-CREATE-ADDL-PRCT-OFF                   11070000
112900         WHEN EP072-PRICG-TYP-CDE = 'AAO'                         11080000
113000              PERFORM 3270-CREATE-ADDL-DOL-OFF                    11090000
113100         WHEN EP072-PRICG-TYP-CDE = 'GPO'                         11100000
113200              PERFORM 3280-CREATE-PRCT-OFF-GRP-PRC                11110000
113300         WHEN EP072-PRICG-TYP-CDE = 'GBG' OR 'GBL'                11120000
113400              PERFORM 3290-CREATE-BOGO-PRC                        11130000
113500         WHEN EP072-PRICG-TYP-CDE = 'GBP'                         11140000
113600              PERFORM 3300-CREATE-BOGO-PERCENT                    11150000
113700         WHEN EP072-PRICG-TYP-CDE = 'GBD'                         11160000
113800              PERFORM 3310-CREATE-BOGO-DOLLAR                     11170000
113801         WHEN EP072-PRICG-TYP-CDE = 'RBO'                         11180000
113802              PERFORM 3315-CREATE-REBATE                          11190000
113900     END-EVALUATE.                                                11200000
114000                                                                  11210000
114100*3200-EXIT.                                                       11220000
114200 EJECT.                                                           11230000
114300                                                                  11240000
114400*----------------------------------------------------------       11250000
114500* 3210-CREATE-PERCENT-OFF.                                        11260000
114600*     POPULATE THE FIELDS FOR THE PROMO PERCENT OFF RECORD.       11270000
114700*----------------------------------------------------------       11280000
114800 3210-CREATE-PERCENT-OFF.                                         11290000
114900                                                                  11300000
116020***  WR#35484-B                                                   11430000
116030     MOVE PV-DB2-PRCG-AMT       TO EP216-INCTV-PCT-OFF.           11440000
116031                                                                  11450000
116040     MOVE PC-PERCENT-OFF        TO PV-CINC-PROMO-SCHM.            11460000
116041     MOVE PV-CINC-CDE           TO EP216-PROMO-SCHEME-CDE.        11470000
116051     MOVE PC-NULL-VALUE         TO EP216-INCTV-BUY-QTY-NL         11480000
116052                                   EP216-INCTV-BUY-AMT-NL         11490000
116053                                   EP216-INCTV-BUY-TOL-AMT-NL     11500000
116054                                   EP216-INCTV-GET-QTY-NL         11510000
116055                                   EP216-INCTV-DOL-OFF-AMT-NL     11520000
116056                                   EP216-INCTV-PRC-PNT-AMT-NL.    11530000
116057     MOVE PC-ZERO-VALUE         TO EP216-TIER-LVL-NBR.            11540000
116058     MOVE PC-SELN-TYP-GET       TO EP216-SELN-TYP-CDE.            11550000
116059     MOVE PC-SIMPLE-PROMOTION   TO EP216-INCTV-TYP-CDE.           11560000
116060     MOVE PC-LMT-PER-TRN-QTY    TO EP216-LMT-PER-TRN-QTY.         11570000
116070***  WR#35484-E                                                   11580000
116100                                                                  11590000
116200*3210-EXIT.                                                       11600000
116300 EJECT.                                                           11601000
116400                                                                  11602000
116500*----------------------------------------------------------       11603000
116600* 3220-CREATE-PRICE-POINT.                                        11604000
116700*     POPULATE THE FIELDS FOR THE PROMO PRICE POINT RECORD.       11605000
116800*----------------------------------------------------------       11605100
116900 3220-CREATE-PRICE-POINT.                                         11605200
117000                                                                  11605300
118310***  WR#35484-B                                                   11640000
118311     MOVE PV-DB2-PRCG-AMT       TO PV-SALE-PRICE.                 11605500
118320     MOVE PV-SALE-PRICE         TO EP216-INCTV-PRC-PNT-AMT.       11650000
118330     MOVE PC-PRICE-POINT        TO PV-CINC-PROMO-SCHM.            11660000
118331     MOVE PV-CINC-CDE           TO EP216-PROMO-SCHEME-CDE.        11670000
118350     MOVE PC-NULL-VALUE         TO EP216-INCTV-BUY-QTY-NL         11680000
118360                                   EP216-INCTV-BUY-AMT-NL         11690000
118370                                   EP216-INCTV-BUY-TOL-AMT-NL     11700000
118380                                   EP216-INCTV-GET-QTY-NL         11710000
118390                                   EP216-INCTV-DOL-OFF-AMT-NL     11720000
118391                                   EP216-INCTV-PCT-OFF-NL.        11730000
118392     MOVE PC-ZERO-VALUE         TO EP216-TIER-LVL-NBR.            11740000
118393     MOVE PC-SELN-TYP-GET       TO EP216-SELN-TYP-CDE.            11750000
118394     MOVE PC-SIMPLE-PROMOTION   TO EP216-INCTV-TYP-CDE.           11760000
118395     MOVE PC-LMT-PER-TRN-QTY    TO EP216-LMT-PER-TRN-QTY.         11770000
118396***  WR#35484-E                                                   11780000
118397                                                                  11790000
118400*3220-EXIT.                                                       11800000
118500 EJECT.                                                           11810000
118600                                                                  11820000
118700*----------------------------------------------------------       11830000
118800* 3230-CREATE-DOLLAR-OFF.                                         11831000
118900*     POPULATE THE FIELDS FOR THE PROMO DOLLAR OFF RECORD.        11832000
119000*----------------------------------------------------------       11833000
119100 3230-CREATE-DOLLAR-OFF.                                          11834000
119200                                                                  11835000
120510***  WR#35484-B                                                   11840000
120511     MOVE PV-DB2-PRCG-AMT       TO PV-DOLLARS-OFF.                11837000
120520     MOVE PV-DOLLARS-OFF        TO EP216-INCTV-DOL-OFF-AMT.       11850000
120530     MOVE PC-DOLLAR-OFF         TO PV-CINC-PROMO-SCHM.            11860000
120531     MOVE PV-CINC-CDE           TO EP216-PROMO-SCHEME-CDE.        11870000
120550     MOVE PC-NULL-VALUE         TO EP216-INCTV-BUY-QTY-NL         11880000
120560                                   EP216-INCTV-BUY-AMT-NL         11890000
120570                                   EP216-INCTV-BUY-TOL-AMT-NL     11900000
120580                                   EP216-INCTV-GET-QTY-NL         11910000
120590                                   EP216-INCTV-PRC-PNT-AMT-NL     11920000
120591                                   EP216-INCTV-PCT-OFF-NL.        11930000
120592     MOVE PC-ZERO-VALUE         TO EP216-TIER-LVL-NBR.            11940000
120593     MOVE PC-SELN-TYP-GET       TO EP216-SELN-TYP-CDE.            11950000
120594     MOVE PC-SIMPLE-PROMOTION   TO EP216-INCTV-TYP-CDE.           11960000
120595     MOVE PC-LMT-PER-TRN-QTY    TO EP216-LMT-PER-TRN-QTY.         11970000
120596***  WR#35484-E                                                   11980000
120597                                                                  11990000
120600*3230-EXIT.                                                       12000000
120700 EJECT.                                                           12010000
120800                                                                  12020000
120900*----------------------------------------------------------       12030000
121000* 3240-CREATE-REG-PRICE.                                          12040000
121100*     POPULATE THE FIELDS FOR THE PROMO REGULAR PRICE RECORD.     12050000
121200*----------------------------------------------------------       12051000
121300 3240-CREATE-REG-PRICE.                                           12052000
121400                                                                  12053000
122610***  WR#35484-B                                                   12120000
122620     MOVE PV-DB2-PRCG-AMT       TO EP216-INCTV-PCT-OFF.           12130000
122630     MOVE PC-REGULAR-PRICE      TO PV-CINC-PROMO-SCHM.            12140000
122631     MOVE PV-CINC-CDE           TO EP216-PROMO-SCHEME-CDE.        12150000
122650     MOVE PC-NULL-VALUE         TO EP216-INCTV-BUY-QTY-NL         12160000
122660                                   EP216-INCTV-BUY-AMT-NL         12170000
122670                                   EP216-INCTV-BUY-TOL-AMT-NL     12180000
122680                                   EP216-INCTV-GET-QTY-NL         12190000
122690                                   EP216-INCTV-PRC-PNT-AMT-NL     12200000
122691                                   EP216-INCTV-DOL-OFF-AMT-NL.    12210000
122692     MOVE PC-ZERO-VALUE         TO EP216-TIER-LVL-NBR.            12220000
122693     MOVE PC-SELN-TYP-GET       TO EP216-SELN-TYP-CDE.            12230000
122694     MOVE PC-SIMPLE-PROMOTION   TO EP216-INCTV-TYP-CDE.           12240000
122695     MOVE PC-LMT-PER-TRN-QTY    TO EP216-LMT-PER-TRN-QTY.         12250000
122696***  WR#35484-E                                                   12260000
122697                                                                  12261000
122700*3240-EXIT.                                                       12262000
122800 EJECT.                                                           12263000
122900                                                                  12264000
123000*----------------------------------------------------------       12265000
123100* 3250-CREATE-GRP-PRC.                                            12266000
123200*     POPULATE THE FIELDS FOR THE PROMO GROUP PRICING RECORD.     12267000
123300*----------------------------------------------------------       12268000
123400 3250-CREATE-GRP-PRC.                                             12269000
123500                                                                  12269100
124100     IF PV-PROMO-QTY-NULL                                         12269700
124200        MOVE ZEROES             TO PV-BUY-QTY                     12269800
124300     ELSE                                                         12269900
124400        MOVE PV-DB2-PROMO-QTY   TO PV-QTY                         12270000
124500        MOVE PV-QTY             TO PV-BUY-QTY                     12280000
124600     END-IF.                                                      12290000
124700                                                                  12300000
125510***  WR#35484-B                                                   12390000
125511     MOVE PV-DB2-PRCG-AMT       TO PV-SALE-PRICE.                 12269300
125520     MOVE PV-SALE-PRICE         TO EP216-INCTV-PRC-PNT-AMT.       12400000
125530     MOVE PC-GROUP-PRICING      TO PV-CINC-PROMO-SCHM.            12410000
125531     MOVE PV-CINC-CDE           TO EP216-PROMO-SCHEME-CDE.        12420000
125532     MOVE PV-BUY-QTY            TO EP216-INCTV-BUY-QTY.           12430000
125550     MOVE PC-NULL-VALUE         TO EP216-INCTV-PCT-OFF-NL         12440000
125560                                   EP216-INCTV-BUY-AMT-NL         12450000
125570                                   EP216-INCTV-BUY-TOL-AMT-NL     12460000
125580                                   EP216-INCTV-GET-QTY-NL         12470000
125591                                   EP216-INCTV-DOL-OFF-AMT-NL.    12480000
125592     MOVE PC-ZERO-VALUE         TO EP216-TIER-LVL-NBR.            12490000
125593     MOVE PC-SELN-TYP-CMB       TO EP216-SELN-TYP-CDE.            12500000
125594     MOVE PC-SIMPLE-PROMOTION   TO EP216-INCTV-TYP-CDE.           12510000
125595     MOVE PC-LMT-PER-TRN-QTY    TO EP216-LMT-PER-TRN-QTY.         12520000
125596***  WR#35484-E                                                   12530000
125597                                                                  12540000
125600*3250-EXIT.                                                       12550000
125700 EJECT.                                                           12551000
125800                                                                  12552000
125900*----------------------------------------------------------       12553000
126000* 3260-CREATE-ADDL-PRCT-OFF.                                      12554000
126100*     POPULATE THE FIELDS FOR THE PROMO ADDITIONAL PERCENT OFF    12555000
126200*     RECORD.                                                     12556000
126300*----------------------------------------------------------       12557000
126400 3260-CREATE-ADDL-PRCT-OFF.                                       12558000
126500                                                                  12559000
126710     MOVE PV-DB2-PRCG-AMT       TO PV-PRCT-DSCT.                  12559200
126800                                                                  12559300
127000     INITIALIZE PV-SAVE-PRCT-DSCT                                 12559500
127100                PV-CHAR-PRCT-DSCT-1                               12559600
127200                PV-CHAR-PRCT-DSCT-2                               12559700
127300                PV-GROUP-NAME.                                    12559800
127400     INITIALIZE PC-CNT-SPACES                                     12559900
127500                PC-CNT-POS.                                       12560000
127610     MOVE PV-PRCT-DSCT-X        TO PV-SAVE-PRCT-DSCT.             12570000
127700     MOVE PV-SAVE-PRCT-DSCT-1   TO PV-CHAR-PRCT-DSCT-1.           12580000
127800     MOVE PV-SAVE-PRCT-DSCT-2   TO PV-CHAR-PRCT-DSCT-2.           12590000
127900     INSPECT PV-CHAR-PRCT-DSCT-1 REPLACING                        12600000
128000             LEADING ZERO BY " ".                                 12610000
128100     INSPECT PV-CHAR-PRCT-DSCT-1                                  12620000
128200            TALLYING PC-CNT-SPACES FOR ALL " ".                   12630000
128300     COMPUTE PC-CNT-POS = 5 - PC-CNT-SPACES.                      12640000
128400     ADD +1 TO PC-CNT-SPACES.                                     12650000
128500     MOVE +1 TO PV-POINTER-FIELD.                                 12660000
128600     STRING PC-CHAR-ADD DELIMITED BY " "                          12670000
128700            "'" DELIMITED BY SIZE                                 12680000
128800            PC-CHAR-L DELIMITED BY " "                            12690000
128900            " " DELIMITED BY SIZE                                 12700000
129000            PC-PERCENT-SIGN DELIMITED BY " "                      12710000
129100            PV-CHAR-PRCT-DSCT-1(PC-CNT-SPACES:PC-CNT-POS)         12720000
129200            PC-CHAR-PERIOD      DELIMITED BY " "                  12730000
129300            PV-CHAR-PRCT-DSCT-2 DELIMITED BY " "                  12740000
129400            " " DELIMITED BY SIZE                                 12750000
129500            PC-CHAR-OFF DELIMITED BY " "                          12760000
129600       INTO PV-GROUP-NAME                                         12770000
129700       WITH POINTER PV-POINTER-FIELD.                             12780000
129900                                                                  12800000
130710***  WR#35484-B                                                   12890000
130720     MOVE PV-DB2-PRCG-AMT       TO EP216-INCTV-PCT-OFF.           12900000
130730     MOVE PC-ADDL-PRCT-OFF      TO PV-CINC-PROMO-SCHM.            12910000
130731     MOVE PV-CINC-CDE           TO EP216-PROMO-SCHEME-CDE.        12920000
130750     MOVE PC-NULL-VALUE         TO EP216-INCTV-BUY-QTY-NL         12930000
130760                                   EP216-INCTV-BUY-AMT-NL         12940000
130770                                   EP216-INCTV-BUY-TOL-AMT-NL     12950000
130780                                   EP216-INCTV-GET-QTY-NL         12960000
130790                                   EP216-INCTV-PRC-PNT-AMT-NL     12970000
130791                                   EP216-INCTV-DOL-OFF-AMT-NL.    12980000
130792     MOVE PC-ZERO-VALUE         TO EP216-TIER-LVL-NBR.            12990000
130793     MOVE PC-SELN-TYP-GET       TO EP216-SELN-TYP-CDE.            13000000
130794     MOVE PV-GROUP-NAME         TO EP216-CUST-SHRT-DESC.          13010000
130795     MOVE PC-SIMPLE-PROMOTION   TO EP216-INCTV-TYP-CDE.           13020000
130796     MOVE PC-LMT-PER-TRN-QTY    TO EP216-LMT-PER-TRN-QTY.         13030000
130797***  WR#35484-E                                                   13040000
130798                                                                  13050000
130800*3260-EXIT.                                                       13060000
130900 EJECT.                                                           13070000
131000                                                                  13071000
131100*----------------------------------------------------------       13072000
131200* 3270-CREATE-ADDL-DOL-OFF.                                       13073000
131300*     POPULATE THE FIELDS FOR THE PROMO ADDITIONAL DOLLAR OFF     13074000
131400*     RECORD.                                                     13075000
131500*----------------------------------------------------------       13076000
131600 3270-CREATE-ADDL-DOL-OFF.                                        13077000
131700                                                                  13078000
131900     MOVE PV-DB2-PRCG-AMT       TO PV-DOLLARS-OFF.                13079100
132010     MOVE PV-DOLLARS-OFF        TO PV-DLRS-OFF.                           
132100                                                                  13079300
132300     INITIALIZE PV-SAVE-DLRS-OFF                                  13079500
132400                PV-CHAR-DLRS-OFF-1                                13079600
132500                PV-CHAR-DLRS-OFF-2                                13079700
132600                PV-GROUP-NAME.                                    13079800
132700     INITIALIZE PC-CNT-SPACES                                     13079900
132800                PC-CNT-POS.                                       13080000
132910     MOVE PV-DLRS-OFF-X         TO PV-SAVE-DLRS-OFF.              13090000
133000     MOVE PV-SAVE-DLRS-OFF-1    TO PV-CHAR-DLRS-OFF-1.            13100000
133100     MOVE PV-SAVE-DLRS-OFF-2    TO PV-CHAR-DLRS-OFF-2.            13110000
133200     INSPECT PV-CHAR-DLRS-OFF-1 REPLACING                         13120000
133300             LEADING ZERO BY " ".                                 13130000
133400     INSPECT PV-CHAR-DLRS-OFF-1 TALLYING                          13140000
133500             PC-CNT-SPACES FOR ALL " ".                           13150000
133600     COMPUTE PC-CNT-POS = 6 - PC-CNT-SPACES.                      13160000
133700     ADD +1 TO PC-CNT-SPACES.                                     13170000
133800     MOVE +1 TO PV-POINTER-FIELD.                                 13180000
133900     STRING PC-CHAR-ADD DELIMITED BY " "                          13190000
134000            "'" DELIMITED BY SIZE                                 13200000
134100            PC-CHAR-L DELIMITED BY " "                            13210000
134200            " " DELIMITED BY SIZE                                 13220000
134300            PC-DOLLAR-SIGN DELIMITED BY " "                       13230000
134400            PV-CHAR-DLRS-OFF-1(PC-CNT-SPACES:PC-CNT-POS)          13240000
134500            PC-CHAR-PERIOD      DELIMITED BY " "                  13250000
134600            PV-CHAR-DLRS-OFF-2  DELIMITED BY " "                  13260000
134700            " " DELIMITED BY SIZE                                 13270000
134800            PC-CHAR-OFF DELIMITED BY " "                          13280000
134900       INTO PV-GROUP-NAME                                         13290000
135000       WITH POINTER PV-POINTER-FIELD.                             13300000
135010                                                                          
135100     MOVE PV-GROUP-NAME         TO EP216-CUST-SHRT-DESC.          13530000
135200                                                                  13320000
136010***  WR#35484-B                                                   13410000
136020     MOVE PV-DOLLARS-OFF        TO EP216-INCTV-DOL-OFF-AMT.       13420000
136030     MOVE PC-ADDL-DOLLAR-OFF    TO PV-CINC-PROMO-SCHM.            13430000
136031     MOVE PV-CINC-CDE           TO EP216-PROMO-SCHEME-CDE.        13440000
136050     MOVE PC-NULL-VALUE         TO EP216-INCTV-BUY-QTY-NL         13450000
136060                                   EP216-INCTV-BUY-AMT-NL         13460000
136070                                   EP216-INCTV-BUY-TOL-AMT-NL     13470000
136080                                   EP216-INCTV-GET-QTY-NL         13480000
136090                                   EP216-INCTV-PRC-PNT-AMT-NL     13490000
136091                                   EP216-INCTV-PCT-OFF-NL.        13500000
136092     MOVE PC-ZERO-VALUE         TO EP216-TIER-LVL-NBR.            13510000
136093     MOVE PC-SELN-TYP-GET       TO EP216-SELN-TYP-CDE.            13520000
136095     MOVE PC-SIMPLE-PROMOTION   TO EP216-INCTV-TYP-CDE.           13540000
136096     MOVE PC-LMT-PER-TRN-QTY    TO EP216-LMT-PER-TRN-QTY.         13550000
136097***  WR#35484-E                                                   13560000
136098                                                                  13570000
136100*3270-EXIT.                                                       13580000
136200 EJECT.                                                           13590000
136300                                                                  13600000
136400*----------------------------------------------------------       13601000
136500* 3280-CREATE-PRCT-OFF-GRP-PRC.                                   13602000
136600*     POPULATE THE FIELDS FOR THE PROMO PERCENT OFF GROUP PRICING 13603000
136700*     RECORD.                                                     13604000
136800*----------------------------------------------------------       13605000
136900 3280-CREATE-PRCT-OFF-GRP-PRC.                                    13606000
137000                                                                  13607000
137510     MOVE PV-DB2-PROMO-QTY      TO PV-BUY-QTY.                    13609300
137900                                                                  13609700
138410***  WR#35484-B                                                   13640000
138420     MOVE PV-DB2-PRCG-AMT       TO EP216-INCTV-PCT-OFF.           13650000
138430     MOVE PC-PRCT-OFF-GRP-PRC   TO PV-CINC-PROMO-SCHM.            13660000
138431     MOVE PV-CINC-CDE           TO EP216-PROMO-SCHEME-CDE.        13670000
138450     MOVE PV-BUY-QTY            TO EP216-INCTV-BUY-QTY.           13680000
138460     MOVE PC-NULL-VALUE         TO EP216-INCTV-PRC-PNT-AMT-NL     13690000
138470                                   EP216-INCTV-BUY-AMT-NL         13700000
138480                                   EP216-INCTV-BUY-TOL-AMT-NL     13710000
138490                                   EP216-INCTV-GET-QTY-NL         13720000
138491                                   EP216-INCTV-DOL-OFF-AMT-NL.    13730000
138492     MOVE PC-ZERO-VALUE         TO EP216-TIER-LVL-NBR.            13740000
138493     MOVE PC-SELN-TYP-CMB       TO EP216-SELN-TYP-CDE.            13750000
138494     MOVE PC-SIMPLE-PROMOTION   TO EP216-INCTV-TYP-CDE.           13760000
138495     MOVE PC-LMT-PER-TRN-QTY    TO EP216-LMT-PER-TRN-QTY.         13770000
138496***  WR#35484-E                                                   13780000
138497                                                                  13790000
138500*3280-EXIT.                                                       13800000
138600 EJECT.                                                           13810000
138700                                                                  13820000
138800*----------------------------------------------------------       13830000
138900* 3290-CREATE-BOGO-PRC.                                           13840000
139000*     POPULATE THE FIELDS FOR THE BUY ONE GET ONE PRICING         13841000
139100*     RECORD.                                                     13842000
139200*----------------------------------------------------------       13843000
139300 3290-CREATE-BOGO-PRC.                                            13844000
139400                                                                  13845000
139600     MOVE PV-DB2-PRCG-AMT       TO PV-SALE-PRICE.                 13847000
139800                                                                  13849000
140000     IF PV-PROMO-QTY-NULL                                         13849200
140100        MOVE ZEROES             TO PV-BUY-QTY                     13849300
140200     ELSE                                                         13849400
140300        MOVE PV-DB2-PROMO-QTY   TO PV-QTY                         13849500
140400        MOVE PV-QTY             TO PV-BUY-QTY                     13849600
140500     END-IF.                                                      13849700
140600                                                                  13849800
141410***  WR#35484-B                                                   13920000
141420     MOVE PV-SALE-PRICE         TO EP216-INCTV-PRC-PNT-AMT.       13930000
141430     MOVE PC-BOGO-PRICING       TO PV-CINC-PROMO-SCHM.            13940000
141431     MOVE PV-CINC-CDE           TO EP216-PROMO-SCHEME-CDE.        13950000
141450     MOVE PV-BUY-QTY            TO EP216-INCTV-BUY-QTY.           13960000
141460     MOVE PC-NULL-VALUE         TO EP216-INCTV-PCT-OFF-NL         13970000
141470                                   EP216-INCTV-BUY-AMT-NL         13980000
141480                                   EP216-INCTV-BUY-TOL-AMT-NL     13990000
141490                                   EP216-INCTV-GET-QTY-NL         14000000
141491                                   EP216-INCTV-DOL-OFF-AMT-NL.    14010000
141492     MOVE PC-ZERO-VALUE         TO EP216-TIER-LVL-NBR.            14020000
141493     MOVE PC-SELN-TYP-CMB       TO EP216-SELN-TYP-CDE.            14030000
141494     MOVE PC-SIMPLE-PROMOTION   TO EP216-INCTV-TYP-CDE.           14040000
141495     MOVE PC-ZERO-VALUE         TO EP216-LMT-PER-TRN-QTY.         14050000
141496***  WR#35484-E                                                   14060000
141497                                                                  14070000
141500*3290-EXIT.                                                       14080000
141600 EJECT.                                                           14090000
141700                                                                  14100000
141800*----------------------------------------------------------       14110000
141900* 3300-CREATE-BOGO-PERCENT.                                       14120000
142000*     POPULATE THE FIELDS FOR THE BUY ONE GET ONE PRICING         14130000
142100*     RECORD --- PERCENT OFF                                      14140000
142200*----------------------------------------------------------       14141000
142300 3300-CREATE-BOGO-PERCENT.                                        14142000
142400                                                                  14143000
142900     IF PV-PROMO-QTY-NULL                                         14148000
143010        MOVE ZEROES             TO PV-BUY-QTY                     14149000
143100     ELSE                                                         14150000
143200        MOVE PV-DB2-PROMO-QTY   TO PV-QTY                         14160000
143310        MOVE PV-QTY             TO PV-BUY-QTY                     14170000
143400     END-IF.                                                      14180000
143500                                                                  14190000
144310***  WR#35484-B                                                   14280000
144320     MOVE PV-DB2-PRCG-AMT       TO EP216-INCTV-PCT-OFF.           14290000
144330     MOVE PC-BOGO-PERCENT       TO PV-CINC-PROMO-SCHM.            14300000
144331     MOVE PV-CINC-CDE           TO EP216-PROMO-SCHEME-CDE.        14310000
144350     MOVE PV-BUY-QTY            TO EP216-INCTV-BUY-QTY.           14320000
144360     MOVE PC-NULL-VALUE         TO EP216-INCTV-PRC-PNT-AMT-NL     14330000
144370                                   EP216-INCTV-BUY-AMT-NL         14340000
144380                                   EP216-INCTV-BUY-TOL-AMT-NL     14350000
144390                                   EP216-INCTV-GET-QTY-NL         14360000
144391                                   EP216-INCTV-DOL-OFF-AMT-NL.    14370000
144392     MOVE PC-ZERO-VALUE         TO EP216-TIER-LVL-NBR.            14380000
144393     MOVE PC-SELN-TYP-CMB       TO EP216-SELN-TYP-CDE.            14390000
144394     MOVE PC-SIMPLE-PROMOTION   TO EP216-INCTV-TYP-CDE.           14400000
144395     MOVE PC-ZERO-VALUE         TO EP216-LMT-PER-TRN-QTY.         14410000
144396***  WR#35484-E                                                   14420000
144397                                                                  14430000
144400*3300-EXIT.                                                       14431000
144500 EJECT.                                                           14432000
144600                                                                  14433000
144700*----------------------------------------------------------       14434000
144800* 3310-CREATE-BOGO-DOLLAR.                                        14435000
144900*     POPULATE THE FIELDS FOR THE BUY ONE GET ONE PRICING         14436000
145000*     RECORD --- DOLLAR OFF                                       14437000
145100*----------------------------------------------------------       14438000
145200 3310-CREATE-BOGO-DOLLAR.                                         14439000
145300                                                                  14439100
145500     MOVE PV-DB2-PRCG-AMT       TO PV-SALE-PRICE.                 14439300
145700                                                                  14439500
145900     IF PV-PROMO-QTY-NULL                                         14439700
146010        MOVE ZEROES             TO PV-BUY-QTY                     14439800
146100     ELSE                                                         14439900
146200        MOVE PV-DB2-PROMO-QTY   TO PV-QTY                         14440000
146310        MOVE PV-QTY             TO PV-BUY-QTY                     14450000
146400     END-IF.                                                      14460000
146500                                                                  14470000
147310***  WR#35484-B                                                   14560000
147320     MOVE PV-SALE-PRICE         TO EP216-INCTV-PRC-PNT-AMT.       14570000
147330     MOVE PC-BOGO-DOLLAR        TO PV-CINC-PROMO-SCHM.            14580000
147331     MOVE PV-CINC-CDE           TO EP216-PROMO-SCHEME-CDE.        14590000
147350     MOVE PV-BUY-QTY            TO EP216-INCTV-BUY-QTY.           14600000
147360     MOVE PC-NULL-VALUE         TO EP216-INCTV-PCT-OFF-NL         14610000
147370                                   EP216-INCTV-BUY-AMT-NL         14620000
147380                                   EP216-INCTV-BUY-TOL-AMT-NL     14630000
147390                                   EP216-INCTV-GET-QTY-NL         14640000
147391                                   EP216-INCTV-DOL-OFF-AMT-NL.    14650000
147392     MOVE PC-ZERO-VALUE         TO EP216-TIER-LVL-NBR.            14660000
147393     MOVE PC-SELN-TYP-CMB       TO EP216-SELN-TYP-CDE.            14670000
147394     MOVE PC-SIMPLE-PROMOTION   TO EP216-INCTV-TYP-CDE.           14680000
147395     MOVE PC-ZERO-VALUE         TO EP216-LMT-PER-TRN-QTY.         14690000
147396***  WR#35484-E                                                   14700000
147397                                                                  14710000
147400*3310-EXIT.                                                       14720000
147500 EJECT.                                                           14730000
147600                                                                  14731000
147601*----------------------------------------------------------       14732000
147602* 3315-CREATE-REBATE.                                             14733000
147603*     POPULATE THE FIELDS FOR THE REBATE RECORD.                  14734000
147604*----------------------------------------------------------       14735000
147605 3315-CREATE-REBATE.                                              14736000
147606                                                                  14737000
147628***  WR#35484-B                                                   14750000
147629     MOVE PV-DB2-PRCG-AMT       TO EP216-INCTV-PCT-OFF.           14760000
147630                                                                  14761000
147631     MOVE PC-REBATE-RECEIPT     TO PV-CINC-PROMO-SCHM.            14762000
147632     MOVE PV-CINC-CDE           TO EP216-PROMO-SCHEME-CDE.        14763000
147633     MOVE PC-NULL-VALUE         TO EP216-INCTV-BUY-QTY-NL         14764000
147634                                   EP216-INCTV-BUY-AMT-NL         14765000
147635                                   EP216-INCTV-BUY-TOL-AMT-NL     14766000
147636                                   EP216-INCTV-GET-QTY-NL         14767000
147637                                   EP216-INCTV-DOL-OFF-AMT-NL     14768000
147638                                   EP216-INCTV-PRC-PNT-AMT-NL.    14769000
147639     MOVE PC-ZERO-VALUE         TO EP216-TIER-LVL-NBR.            14770000
147640     MOVE PC-SELN-TYP-GET       TO EP216-SELN-TYP-CDE.            14770100
147641     MOVE PC-REBATE-CDE         TO EP216-INCTV-TYP-CDE.           14770200
147642     MOVE PC-LMT-PER-TRN-QTY    TO EP216-LMT-PER-TRN-QTY.         14770300
147643*----------------------------------------------------------       14770400
147644                                                                  14770500
147800* 4000-PROCESS-TIERED-PRC.                                        14770600
147900*     PROCESS TIERED PRICING RECORDS.                             14770700
148000*----------------------------------------------------------       14770800
148100 4000-PROCESS-TIERED-PRC.                                         14770900
148200                                                                  14771000
148300     INITIALIZE PC-CNT-TIER-CHECK.                                14771100
148310     INITIALIZE PV-PRIOR-INTFC-SUB-ID.                            14771200
148320     INITIALIZE PV-CURR-TIER-LVL-NUM.                             14771300
148400                                                                  14771400
148500     IF PS-SINGLE-REC                                             14771500
148600        PERFORM 4100-SELECT-TIERED-DATA                           14771600
148700        IF PS-NOT-SKIP-REC                                        14771700
148800           PERFORM 7300-SELECT-PROMO-DATA                         14771800
148900           IF EP072-RMS-STR-PRC                                   14771900
149000             PERFORM 7400-SELECT-RMS-DATA                         14772000
149100               UNTIL PS-RMS-EOF                                   14773000
149200           ELSE                                                   14774000
149300             PERFORM 7500-SELECT-ADHOC-DATA                       14775000
149400               UNTIL PS-ADHOC-EOF                                 14776000
149500           END-IF                                                 14777000
149600           PERFORM 4300-POPULATE-TIERED-RECS                      14778000
149800        END-IF                                                    14780000
149900     ELSE                                                         14790000
150000        PERFORM 4400-OPEN-TIERED-CURSOR                           14800000
150100        PERFORM 4500-FETCH-TIERED-CURSOR                          14810000
150200        IF PS-NOT-SKIP-REC                                        14820000
150300           PERFORM 7300-SELECT-PROMO-DATA                         14830000
150400           IF EP072-RMS-STR-PRC                                   14840000
150500             PERFORM 7400-SELECT-RMS-DATA                         14850000
150600               UNTIL PS-RMS-EOF                                   14860000
150700           ELSE                                                   14870000
150800             PERFORM 7500-SELECT-ADHOC-DATA                       14880000
150900               UNTIL PS-ADHOC-EOF                                 14890000
151000           END-IF                                                 14900000
151100           PERFORM 4200-CREATE-TIER-PRC-RECS                      14910000
151200                   UNTIL PS-END-OF-CURSOR                         14920000
151300        END-IF                                                    14930000
151400        PERFORM 4600-CLOSE-TIERED-CURSOR                          14940000
151600     END-IF.                                                      14960000
152200                                                                  15020000
152300*4000-EXIT.                                                       15030000
152400 EJECT.                                                           15040000
152500                                                                  15050000
152600*----------------------------------------------------------       15060000
152700* 4100-SELECT-TIERED-DATA.                                        15070000
152800*     SELECT THE DATA NEEDED FOR THE TIERED PRICING RECORD.       15080000
152900*----------------------------------------------------------       15090000
153000 4100-SELECT-TIERED-DATA.                                         15100000
153100                                                                  15110000
153200     PERFORM                                                      15120000
153300         WITH TEST AFTER                                          15130000
153400         VARYING PV-SQL-SUB                                       15140000
153500         FROM 1 BY 1                                              15150000
153600         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 15160000
153700                   OR  SQLCODE = 0                                15170000
153800                   OR  SQLCODE = +100)                            15180000
153900                                                                  15190000
154000         EXEC SQL                                                 15200000
154100             SELECT  A.PROMO_INTFC_SUB_ID                         15210000
154200                    ,A.THRS_QTY                                   15220000
154300                    ,A.THRS_AMT                                   15230000
154400                    ,A.DISC_AMT                                   15240000
154500                    ,A.DISC_PCT                                   15250000
154600                    ,B.PROMO_ITM_ID                               15260000
154700                    ,B.PROMO_ID                                   15270000
154800                    ,B.DEPT_NBR                                   15280000
154900                    ,B.MAJ_CL_NBR                                 15290000
155000                    ,B.SUB_CL_NBR                                 15300000
155100                    ,B.STYL_ID                                    15310000
155200                    ,B.SKU_NBR                                    15320000
155210                    ,B.MDSE_HIER_CDE                              15330000
155300                    ,B.TKT_CLOR_CDE                               15340000
155400                    ,B.RCPT_CMMT_TXT                              15350000
155500               INTO  :PV-DB2-INTFC-SUB-ID                         15360000
155600                    ,:PV-DB2-PROMO-QTY :PV-PROMO-QTY-IND          15370000
155700                    ,:PV-DB2-THRS-AMT :PV-THRS-AMT-IND            15380000
155800                    ,:PV-DB2-DISC-AMT :PV-DISC-AMT-IND            15390000
155900                    ,:PV-DB2-DISC-PCT :PV-DISC-PCT-IND            15400000
156000                    ,:PV-DB2-PROMO-ITM-ID :PV-PROMO-ITM-ID-IND    15410000
156100                    ,:PV-DB2-PROMO-ID                             15420000
156200                    ,:PV-DB2-DEPT-NBR :PV-DEPT-NBR-IND            15430000
156300                    ,:PV-DB2-MAJ-CL-NBR :PV-MAJ-CL-NBR-IND        15440000
156400                    ,:PV-DB2-SUB-CL-NBR :PV-SUB-CL-NBR-IND        15450000
156500                    ,:PV-DB2-STYL-ID :PV-STYL-ID-IND              15460000
156600                    ,:PV-DB2-SKU-NBR :PV-SKU-NBR-IND              15470000
156610                    ,:PV-DB2-MDSE-HIER-CDE                        15480000
156700                    ,:PV-DB2-TKT-CLOR-CDE :PV-TKT-CLOR-IND        15490000
156800                    ,:PV-DB2-RCPT-CMMT-TXT :PV-RCPT-CMMT-IND      15500000
156900               FROM  XST_TIER_PRICG A                             15510000
157000                    ,XST_MDSE_LNE_SELN B                          15520000
157100               WHERE A.PROMO_INTFC_ID = :PV-HOLD-PROMO-INTFC-ID   15530000
157200                 AND A.MDSE_LNE_ID    = :PV-HOLD-MDSE-LNE-ID      15540000
157300                 AND A.PROMO_INTFC_SUB_ID                         15550000
157400                                      = :PV-HOLD-INTFC-SUB-ID     15560000
157500                 AND A.PROMO_INTFC_ID = B.PROMO_INTFC_ID          15570000
157600                 AND A.MDSE_LNE_ID    = B.MDSE_LNE_ID             15580000
157700                 AND ((A.STAT_CDE     = :PV-SCHEDULED-STAT)       15590000
157800                  OR  (A.STAT_CDE     = :PV-CANCEL-STAT)          15600000
157900                  OR  (A.STAT_CDE     = :PV-DELETE-STAT))         15610000
158000               WITH UR                                            15620000
158100         END-EXEC                                                 15630000
158200                                                                  15640000
158300         EVALUATE TRUE                                            15650000
158400             WHEN SQLCODE = -904                                  15660000
158500             WHEN SQLCODE = -911                                  15670000
158600             WHEN SQLCODE = -913                                  15680000
158700                  CONTINUE                                        15690000
158800             WHEN SQLCODE = 0                                     15700000
158900                  CONTINUE                                        15710000
159000             WHEN SQLCODE = +100                                  15720000
159100                  SET PS-SKIP-REC TO TRUE                         15730000
159200             WHEN OTHER                                           15740000
159300                  DISPLAY 'SQLCODE: ' SQLCODE                     15750000
159400                  MOVE '4100-SELECT-TIERED-DATA'                  15760000
159500                                TO  PV-PARAGRAPH-NAME             15770000
159600                  MOVE 'SELECT TIERED PRICG DATA'                 15780000
159700                                TO  PV-DB2-OPERATION              15790000
159800                  PERFORM 9900-SQL-ABEND-ROUTINE                  15800000
159900         END-EVALUATE                                             15810000
160000     END-PERFORM.                                                 15820000
160100                                                                  15830000
160200     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         15840000
160300        DISPLAY 'SQLCODE: ' SQLCODE                               15850000
160400        MOVE '4100-SELECT-TIERED-DATA'                            15860000
160500                              TO  PV-PARAGRAPH-NAME               15870000
160600        MOVE 'SELECT RETRIES EXCEEDED'                            15880000
160700                              TO  PV-DB2-OPERATION                15890000
160800        PERFORM 9900-SQL-ABEND-ROUTINE                            15900000
160900     END-IF.                                                      15910000
161000                                                                  15920000
161100*4100-EXIT.                                                       15930000
161200 EJECT.                                                           15940000
161300                                                                  15950000
161400*----------------------------------------------------------       15960000
161500* 4200-CREATE-TIER-PRC-RECS.                                      15970000
161600*     POPULATE PROMO AND PMAP FIELDS SO THEY CAN BE WRITTEN       15980000
161700*     OUT TO THE CORRECT FILES.                                   15990000
161800*----------------------------------------------------------       16000000
161900 4200-CREATE-TIER-PRC-RECS.                                       16010000
162000                                                                  16020000
162100     PERFORM 4300-POPULATE-TIERED-RECS.                           16030000
162200     INITIALIZE PV-NULL-INDICATORS.                               16040000
162300     PERFORM 4500-FETCH-TIERED-CURSOR.                            16050000
162400                                                                  16060000
162500*4200-EXIT.                                                       16070000
162600 EJECT.                                                           16080000
162700                                                                  16090000
162800*----------------------------------------------------------       16100000
162900* 4300-POPULATE-TIERED-RECS.                                      16110000
163000*     POPULATE TIERED RECORDS.                                    16120000
163200*----------------------------------------------------------       16140000
163300 4300-POPULATE-TIERED-RECS.                                       16150000
163400                                                                  16160000
163500     IF PC-CNT-TIER-CHECK > 1                                     16170000
163600      AND (PS-ALL-RECS OR PS-JUST-PROMO-RECS)                     16180000
163700           CONTINUE                                                       
164100     ELSE                                                         16230000
164200        IF PS-ALL-RECS OR PS-JUST-PMAP-RECS                       16240000
164300           MOVE PV-DB2-INTFC-SUB-ID   TO PV-PROMO-CDE             16250000
164501           PERFORM 7200-PROCESS-MDSE-HIER                         16270000
164510           IF PS-NOT-SKIP-REC                                     16280000
164600             CONTINUE                                             16290000
164601           ELSE                                                   16300000
164602             SET PS-CINC-DO-NOT-CREATE TO TRUE                    16310000
164603             SET PS-NOT-SKIP-REC TO TRUE                          16320000
164610           END-IF                                                 16330000
164700        END-IF                                                    16340000
164800     END-IF.                                                      16350000
164900                                                                  16360000
165000     IF PS-ALL-RECS OR PS-JUST-PROMO-RECS                         16370000
165100       MOVE PV-DB2-INTFC-SUB-ID      TO PV-PROMO-CDE              16380000
165300       PERFORM 7110-POPULATES-ESL-TOPR-TYP                        16400000
165400                                                                          
167100       EVALUATE TRUE                                              16490000
167200           WHEN EP072-PRICG-TYP-CDE = 'TQP'                       16500000
167300                  PERFORM 4310-CREATE-TQP-REC                     16510000
167400           WHEN EP072-PRICG-TYP-CDE = 'TQA'                       16520000
167500                  PERFORM 4320-CREATE-TQA-REC                     16530000
167600           WHEN EP072-PRICG-TYP-CDE = 'TAP'                       16540000
167700                  PERFORM 4330-CREATE-TAP-REC                     16550000
167800           WHEN EP072-PRICG-TYP-CDE = 'TAA'                       16560000
167900                  PERFORM 4340-CREATE-TAA-REC                     16570000
168000       END-EVALUATE                                               16580000
168100     END-IF.                                                      16590000
168200                                                                  16600000
168201***  WR#35484-B                                                   16610000
168202     IF PS-CINC-CREATE                                            16620000
168210        PERFORM 4700-POPULATE-CINCTV-TIER-REC                     16630000
168211     END-IF.                                                      16640000
168212***  WR#35484-E                                                   16650000
168220                                                                  16660000
168300*4300-EXIT.                                                       16670000
168400 EJECT.                                                           16680000
168500                                                                  16690000
168600*----------------------------------------------------------       16700000
168700* 4310-CREATE-TQP-REC.                                            16710000
168800*     POPULATE THE TIERED BY QUANTITY GET PERCENT RECORD.         16720000
168900*----------------------------------------------------------       16730000
169000 4310-CREATE-TQP-REC.                                             16740000
169100                                                                  16750000
170000     IF PV-PROMO-QTY-NULL                                         16840000
170100        MOVE ZEROES               TO PV-BUY-QTY                   16850000
170200     ELSE                                                         16860000
170300        MOVE PV-DB2-PROMO-QTY     TO PV-QTY                       16870000
170400        MOVE PV-QTY               TO PV-BUY-QTY                   16880000
170500     END-IF.                                                      16890000
170600                                                                  16900000
171210***  WR#35484-B                                                   16970000
171220     MOVE PV-DB2-DISC-PCT       TO EP216-INCTV-PCT-OFF.           16980000
171230     MOVE PC-TIER-QTY-GET-PRCT  TO PV-CINC-PROMO-SCHM.            16990000
171233     MOVE PV-CINC-CDE           TO EP216-PROMO-SCHEME-CDE.        17000000
171240     MOVE PV-BUY-QTY            TO EP216-INCTV-BUY-QTY.           17010000
171260     MOVE PC-NULL-VALUE         TO EP216-INCTV-PRC-PNT-AMT-NL     17020000
171270                                   EP216-INCTV-BUY-AMT-NL         17030000
171280                                   EP216-INCTV-BUY-TOL-AMT-NL     17040000
171290                                   EP216-INCTV-GET-QTY-NL         17050000
171291                                   EP216-INCTV-DOL-OFF-AMT-NL.    17060000
171293     MOVE PC-SELN-TYP-CMB       TO EP216-SELN-TYP-CDE.            17070000
171294     MOVE PC-TIERED-PROMOTION   TO EP216-INCTV-TYP-CDE.           17080000
171295***  WR#35484-E                                                   17090000
171296                                                                  17100000
171300*4310-EXIT.                                                       17110000
171400 EJECT.                                                           17120000
171500                                                                  17121000
171600*----------------------------------------------------------       17122000
171700* 4320-CREATE-TQA-REC.                                            17123000
171800*     POPULATE THE TIERED BY QUANTITY GET DOLLAR RECORD.          17124000
171900*----------------------------------------------------------       17125000
172000 4320-CREATE-TQA-REC.                                             17126000
172100                                                                  17127000
172300     IF PV-DISC-AMT-NULL                                          17129000
172410        CONTINUE                                                          
172500     ELSE                                                         17129200
172600        MOVE PV-DB2-DISC-AMT      TO PV-DOLLARS-OFF               17129300
172800     END-IF.                                                      17129500
172900                                                                  17129600
173100     IF PV-PROMO-QTY-NULL                                         17129800
173200        MOVE ZEROES               TO PV-BUY-QTY                   17129900
173300     ELSE                                                         17130000
173400        MOVE PV-DB2-PROMO-QTY     TO PV-QTY                       17140000
173500        MOVE PV-QTY               TO PV-BUY-QTY                   17150000
173600     END-IF.                                                      17160000
173700                                                                  17170000
174310***  WR#35484-B                                                   17240000
174320     MOVE PV-DOLLARS-OFF        TO EP216-INCTV-DOL-OFF-AMT.       17250000
174330     MOVE PC-TIER-QTY-GET-DOL   TO PV-CINC-PROMO-SCHM.            17260000
174331     MOVE PV-CINC-CDE           TO EP216-PROMO-SCHEME-CDE.        17270000
174340     MOVE PV-BUY-QTY            TO EP216-INCTV-BUY-QTY.           17280000
174360     MOVE PC-NULL-VALUE         TO EP216-INCTV-PRC-PNT-AMT-NL     17290000
174370                                   EP216-INCTV-BUY-AMT-NL         17300000
174380                                   EP216-INCTV-BUY-TOL-AMT-NL     17310000
174390                                   EP216-INCTV-GET-QTY-NL         17320000
174391                                   EP216-INCTV-PCT-OFF-NL.        17330000
174392     MOVE PC-SELN-TYP-CMB       TO EP216-SELN-TYP-CDE.            17340000
174393     MOVE PC-TIERED-PROMOTION   TO EP216-INCTV-TYP-CDE.           17350000
174394***  WR#35484-E                                                   17360000
174395                                                                  17370000
174400*4320-EXIT.                                                       17380000
174500 EJECT.                                                           17390000
174600                                                                  17400000
174700*----------------------------------------------------------       17410000
174800* 4330-CREATE-TAP-REC.                                            17420000
174900*     POPULATE THE TIERED BY DOLLAR GET PERCENT RECORD.           17430000
175000*----------------------------------------------------------       17431000
175100 4330-CREATE-TAP-REC.                                             17432000
175200                                                                  17433000
176100     IF PV-THRS-AMT-NULL                                          17460000
176200        MOVE ZEROES               TO PV-BUY-AMT                   17470000
176300     ELSE                                                         17480000
176400        MOVE PV-DB2-THRS-AMT      TO PV-PRCG-AMT                  17490000
176500        MOVE PV-PRCG-AMT          TO PV-BUY-AMT                   17500000
176600     END-IF.                                                      17510000
176700                                                                  17520000
177310***  WR#35484-B                                                   17590000
177320     MOVE PV-DB2-DISC-PCT       TO EP216-INCTV-PCT-OFF.           17600000
177330     MOVE PC-TIER-DOLLAR-GET-PRCT TO PV-CINC-PROMO-SCHM.          17610000
177331     MOVE PV-CINC-CDE           TO EP216-PROMO-SCHEME-CDE.        17620000
177340     MOVE PV-BUY-AMT            TO EP216-INCTV-BUY-AMT.           17630000
177360     MOVE PC-NULL-VALUE         TO EP216-INCTV-PRC-PNT-AMT-NL     17640000
177370                                   EP216-INCTV-BUY-QTY-NL         17650000
177380                                   EP216-INCTV-BUY-TOL-AMT-NL     17660000
177390                                   EP216-INCTV-GET-QTY-NL         17670000
177391                                   EP216-INCTV-DOL-OFF-AMT-NL.    17680000
177392     MOVE PC-SELN-TYP-CMB       TO EP216-SELN-TYP-CDE.            17690000
177393     MOVE PC-TIERED-PROMOTION   TO EP216-INCTV-TYP-CDE.           17700000
177394***  WR#35484-E                                                   17710000
177395                                                                  17720000
177400*4330-EXIT.                                                       17730000
177500 EJECT.                                                           17731000
177600                                                                  17732000
177700*----------------------------------------------------------       17733000
177800* 4340-CREATE-TAA-REC.                                            17734000
177900*     POPULATE THE TIERED BY DOLLAR GET DOLLAR RECORD.            17735000
178000*----------------------------------------------------------       17736000
178100 4340-CREATE-TAA-REC.                                             17737000
178200                                                                  17738000
178400     IF PV-DISC-AMT-NULL                                          17739100
178410        CONTINUE                                                          
178600     ELSE                                                         17739300
178700        MOVE PV-DB2-DISC-AMT      TO PV-DOLLARS-OFF               17739400
178900     END-IF.                                                      17739600
179000                                                                  17739700
179200     IF PV-THRS-AMT-NULL                                          17739900
179300        MOVE ZEROES               TO PV-BUY-AMT                   17740000
179400     ELSE                                                         17750000
179500        MOVE PV-DB2-THRS-AMT      TO PV-PRCG-AMT                  17760000
179600        MOVE PV-PRCG-AMT          TO PV-BUY-AMT                   17770000
179700     END-IF.                                                      17780000
179800                                                                  17790000
180400                                                                  17850000
180410***  WR#35484-B                                                   17860000
180420     MOVE PV-DOLLARS-OFF        TO EP216-INCTV-DOL-OFF-AMT.       17870000
180431     MOVE PC-TIER-DOLLAR-GET-DOL  TO PV-CINC-PROMO-SCHM.          17880000
180432     MOVE PV-CINC-CDE           TO EP216-PROMO-SCHEME-CDE.        17890000
180450     MOVE PV-BUY-AMT            TO EP216-INCTV-BUY-AMT.           17900000
180460     MOVE PC-NULL-VALUE         TO EP216-INCTV-PRC-PNT-AMT-NL     17910000
180470                                   EP216-INCTV-BUY-QTY-NL         17920000
180480                                   EP216-INCTV-BUY-TOL-AMT-NL     17930000
180490                                   EP216-INCTV-GET-QTY-NL         17940000
180491                                   EP216-INCTV-PCT-OFF-NL.        17950000
180492     MOVE PC-SELN-TYP-CMB       TO EP216-SELN-TYP-CDE.            17960000
180493     MOVE PC-TIERED-PROMOTION   TO EP216-INCTV-TYP-CDE.           17970000
180494***  WR#35484-E                                                   17980000
180495                                                                  17990000
180500*4340-EXIT.                                                       18000000
180600 EJECT.                                                           18010000
180700                                                                  18020000
180800*----------------------------------------------------------       18030000
180900* 4400-OPEN-TIERED-CURSOR.                                        18040000
181000*     OPEN THE TIERED PROMO AND PMAP CURSOR.                      18041000
181100*----------------------------------------------------------       18042000
181200 4400-OPEN-TIERED-CURSOR.                                         18043000
181300                                                                  18044000
181400     PERFORM                                                      18045000
181500         WITH TEST AFTER                                          18046000
181600         VARYING PV-SQL-SUB                                       18047000
181700         FROM 1 BY 1                                              18048000
181800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 18049000
181900                   OR  SQLCODE = 0)                               18050000
182000                                                                  18060000
182100           EXEC SQL                                               18070000
182200              OPEN TIERED-CURSOR                                  18080000
182300           END-EXEC                                               18090000
182400                                                                  18100000
182500         EVALUATE TRUE                                            18110000
182600             WHEN SQLCODE = -904                                  18120000
182700             WHEN SQLCODE = -911                                  18130000
182800             WHEN SQLCODE = -913                                  18140000
182900                  CONTINUE                                        18150000
183000             WHEN SQLCODE = 0                                     18160000
183100                  SET PS-NOT-END-OF-CURSOR TO TRUE                18170000
183200             WHEN SQLWARN0 NOT EQUAL SPACE                        18180000
183300             WHEN SQLCODE NOT EQUAL ZERO                          18190000
183400                  MOVE '4400-OPEN-TIERED-CURSOR'                  18200000
183500                                     TO PV-PARAGRAPH-NAME         18210000
183600                  MOVE 'ERROR ON OPEN OF TIERED CURSOR'           18220000
183700                                     TO PV-DB2-OPERATION          18230000
183800                  PERFORM 9900-SQL-ABEND-ROUTINE                  18240000
183900         END-EVALUATE                                             18250000
184000     END-PERFORM.                                                 18260000
184100                                                                  18270000
184200     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         18280000
184300        MOVE '4400-OPEN-TIERED-CURSOR'                            18290000
184400                             TO  PV-PARAGRAPH-NAME                18300000
184500        MOVE 'OPEN RETRIES EXCEEDED'                              18310000
184600                              TO  PV-DB2-OPERATION                18320000
184700        PERFORM 9900-SQL-ABEND-ROUTINE                            18330000
184800     END-IF.                                                      18340000
184900                                                                  18350000
185000*4400-EXIT.                                                       18360000
185100 EJECT.                                                           18370000
185200                                                                  18380000
185300*----------------------------------------------------------       18390000
185400* 4500-FETCH-TIERED-CURSOR.                                       18400000
185500*     FETCH THE TIERED PROMO AND PMAP CURSOR.                     18410000
185600*----------------------------------------------------------       18420000
185700 4500-FETCH-TIERED-CURSOR.                                        18430000
185800                                                                  18440000
185900     PERFORM                                                      18450000
186000         WITH TEST AFTER                                          18460000
186100         VARYING PV-SQL-SUB                                       18470000
186200         FROM 1 BY 1                                              18480000
186300         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 18490000
186400                   OR  SQLCODE = 0                                18500000
186500                   OR  SQLCODE = +100)                            18510000
186600                                                                  18520000
186700           EXEC SQL                                               18530000
186800              FETCH TIERED-CURSOR                                 18540000
186900              INTO  :PV-DB2-PROMO-ITM-ID :PV-PROMO-ITM-ID-IND     18550000
187000                   ,:PV-DB2-PROMO-ID                              18560000
187100                   ,:PV-DB2-DEPT-NBR :PV-DEPT-NBR-IND             18570000
187200                   ,:PV-DB2-MAJ-CL-NBR :PV-MAJ-CL-NBR-IND         18580000
187300                   ,:PV-DB2-SUB-CL-NBR :PV-SUB-CL-NBR-IND         18590000
187400                   ,:PV-DB2-STYL-ID :PV-STYL-ID-IND               18600000
187500                   ,:PV-DB2-SKU-NBR :PV-SKU-NBR-IND               18610000
187510                   ,:PV-DB2-MDSE-HIER-CDE                         18620000
187600                   ,:PV-DB2-TKT-CLOR-CDE :PV-TKT-CLOR-IND         18630000
187700                   ,:PV-DB2-RCPT-CMMT-TXT :PV-RCPT-CMMT-IND       18640000
187800                   ,:PV-DB2-MDSE-ESL-TOPR :PV-MDSE-ESL-TOPR-IND   18650000
187900                   ,:PV-DB2-INTFC-SUB-ID                          18660000
188000                   ,:PV-DB2-PROMO-QTY :PV-PROMO-QTY-IND           18670000
188100                   ,:PV-DB2-THRS-AMT :PV-THRS-AMT-IND             18680000
188200                   ,:PV-DB2-DISC-AMT :PV-DISC-AMT-IND             18690000
188300                   ,:PV-DB2-DISC-PCT :PV-DISC-PCT-IND             18700000
188400           END-EXEC                                               18710000
188500                                                                  18720000
188600          EVALUATE TRUE                                           18730000
188700             WHEN SQLCODE = -904                                  18740000
188800             WHEN SQLCODE = -911                                  18750000
188900             WHEN SQLCODE = -913                                  18751000
189000                  CONTINUE                                        18752000
189100             WHEN SQLCODE = ZERO                                  18753000
189200                  ADD 1 TO PC-CNT-TIER-CHECK                      18754000
189300             WHEN SQLCODE = +100                                  18755000
189400                  SET PS-END-OF-CURSOR    TO TRUE                 18756000
189500                  IF PC-CNT-TIER-CHECK = 0                        18757000
189600                     SET PS-SKIP-REC TO TRUE                      18758000
189700                  END-IF                                          18759000
189800             WHEN SQLWARN0 NOT EQUAL SPACE                        18760000
189900             WHEN SQLCODE NOT EQUAL ZERO                          18770000
190000                  MOVE '4500-FETCH-TIERED-CURSOR'                 18780000
190100                                     TO PV-PARAGRAPH-NAME         18790000
190200                  MOVE 'ERROR ON FETCHING TIERED CURSOR'          18800000
190300                                     TO PV-DB2-OPERATION          18810000
190500                  PERFORM 9900-SQL-ABEND-ROUTINE                  18820000
190600          END-EVALUATE                                            18830000
190700     END-PERFORM.                                                 18840000
190800                                                                  18850000
190900     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        18860000
191000         MOVE '4500-FETCH-TIERED-CURSOR'                          18870000
191100                               TO  PV-PARAGRAPH-NAME              18880000
191200         MOVE 'FETCH RETRIES EXCEEDED'                            18890000
191300                               TO  PV-DB2-OPERATION               18900000
191400         PERFORM 9900-SQL-ABEND-ROUTINE                           18910000
191500     END-IF.                                                      18920000
191600                                                                  18930000
191700*4500-EXIT.                                                       18940000
191800 EJECT.                                                           18950000
191900                                                                  18960000
192000*-----------------------------------------------------------      18970000
192100* 4600-CLOSE-TIERED-CURSOR.                                       18980000
192200*     CLOSE THE TIERED PROMO AND PMAP CURSOR.                     18990000
192300*-----------------------------------------------------------      19000000
192400 4600-CLOSE-TIERED-CURSOR.                                        19010000
192500                                                                  19020000
192600     PERFORM                                                      19030000
192700         WITH TEST AFTER                                          19040000
192800         VARYING PV-SQL-SUB                                       19050000
192900         FROM 1 BY 1                                              19060000
193000         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 19070000
193100                   OR  SQLCODE = 0)                               19080000
193200                                                                  19090000
193300           EXEC SQL                                               19100000
193400              CLOSE TIERED-CURSOR                                 19110000
193500           END-EXEC                                               19120000
193600                                                                  19130000
193700          EVALUATE TRUE                                           19140000
193800             WHEN SQLCODE = -904                                  19150000
193900             WHEN SQLCODE = -911                                  19160000
194000             WHEN SQLCODE = -913                                  19170000
194100             WHEN SQLCODE = 0                                     19180000
194200                  CONTINUE                                        19190000
194300             WHEN SQLWARN0 NOT EQUAL SPACE                        19200000
194400             WHEN SQLCODE NOT EQUAL ZERO                          19210000
194500                  MOVE '4600-CLOSE-TIERED-CURSOR'                 19220000
194600                                      TO PV-PARAGRAPH-NAME        19230000
194700                  MOVE 'ERROR ON CLOSE OF TIERED CURSOR'          19240000
194800                                      TO PV-DB2-OPERATION         19250000
194900                  PERFORM 9900-SQL-ABEND-ROUTINE                  19260000
195000          END-EVALUATE                                            19270000
195100     END-PERFORM.                                                 19280000
195200                                                                  19290000
195300     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         19300000
195400        MOVE '4600-CLOSE-TIERED-CURSOR'                           19310000
195500                               TO  PV-PARAGRAPH-NAME              19320000
195600        MOVE 'CLOSE RETRIES EXCEEDED'                             19330000
195700                               TO  PV-DB2-OPERATION               19340000
195800        PERFORM 9900-SQL-ABEND-ROUTINE                            19350000
195900     END-IF.                                                      19360000
196000                                                                  19370000
196100*4600-EXIT.                                                       19380000
196200 EJECT.                                                           19390000
196300                                                                  19400000
196301*----------------------------------------------------------       19410000
196302* 4700-POPULATE-CINCTV-TIER-REC.        ** WR35484 **             19420000
196303*     THIS PARAGRAPH WILL BE PERFORMED ONLY FOR TIERED PROMOTIONS 19430000
196304*     IT WILL DETERMINE THE TIER LEVEL NUMBER BEFORE WRITING THE  19440000
196305*     DATA OUT.                                                   19450000
196307*----------------------------------------------------------       19460000
196308 4700-POPULATE-CINCTV-TIER-REC.                                   19470000
196309                                                                  19480000
196310     IF PS-SINGLE-REC                                             19490000
196311        MOVE 1 TO EP216-TIER-LVL-NBR                              19500000
196312        MOVE PV-DB2-INTFC-SUB-ID  TO EP216-SYS-REC-SUB-ID         19510000
196313     ELSE                                                         19520000
196314        EVALUATE TRUE                                             19530000
196315                                                                  19540000
196316            WHEN PV-CURR-TIER-LVL-NUM = 0                         19550000
196317             AND PV-PRIOR-INTFC-SUB-ID = 0                        19560000
196318             AND PV-DB2-INTFC-SUB-ID NOT = 0                      19570000
196319               ADD +1 TO PV-CURR-TIER-LVL-NUM                     19580000
196320               MOVE PV-CURR-TIER-LVL-NUM  TO EP216-TIER-LVL-NBR   19590000
196321               MOVE PV-DB2-INTFC-SUB-ID  TO EP216-SYS-REC-SUB-ID  19600000
196322                                                                  19610000
196323            WHEN PV-PRIOR-INTFC-SUB-ID = PV-DB2-INTFC-SUB-ID      19620000
196324               CONTINUE                                           19630000
196325                                                                  19631000
196326            WHEN PV-PRIOR-INTFC-SUB-ID NOT = PV-DB2-INTFC-SUB-ID  19631100
196327             AND PV-CURR-TIER-LVL-NUM > 0                         19631200
196328               ADD +1 TO PV-CURR-TIER-LVL-NUM                     19631300
196329               MOVE PV-CURR-TIER-LVL-NUM  TO EP216-TIER-LVL-NBR   19631400
196330               MOVE PV-DB2-INTFC-SUB-ID  TO EP216-SYS-REC-SUB-ID  19631500
196331                                                                  19631600
196332        END-EVALUATE                                              19631700
196333     END-IF.                                                      19631800
196334                                                                  19631900
196335     MOVE PV-DB2-INTFC-SUB-ID   TO PV-PRIOR-INTFC-SUB-ID.         19632000
196336     MOVE PC-LMT-PER-TRN-QTY    TO EP216-LMT-PER-TRN-QTY.         19632100
196337                                                                  19632200
196338     IF PV-RCPT-CMMT-NULL                                         19632300
196339        MOVE PC-NULL-VALUE      TO EP216-CUST-SHRT-DESC           19632400
196340     ELSE                                                         19632500
196341        MOVE PV-DB2-RCPT-CMMT-TXT TO EP216-CUST-SHRT-DESC         19632600
196342     END-IF.                                                      19632700
196343                                                                  19632800
196344     PERFORM 7600-POPULATE-CUST-INCTV-REC.                        19632900
196345     PERFORM 9300-WRITE-CUST-INCTV-REC.                           19633000
196346                                                                  19633100
196347*4700-EXIT.                                                       19633200
196348 EJECT.                                                           19633300
196350                                                                  19633400
196400*----------------------------------------------------------       19633500
196500* 6000-PROCESS-EXCL-CINC.                                         19633600
196600*     PROCESS EXCLUSION CINC-CUSTOMER INCENTIVE RECORDS.          19633700
196700*----------------------------------------------------------       19633800
196800 6000-PROCESS-EXCL-CINC.                                          19633900
196900                                                                  19634000
197101     INITIALIZE PV-NULL-INDICATORS.                                       
197102                                                                  19634300
197103*** WR#35484 - B                                                  19634400
197110     SET PS-MDSE-EXCLUDE  TO TRUE.                                19634500
197120*** WR#35484 - E                                                  19634600
197200                                                                  19634700
197300     IF PS-SINGLE-REC                                             19634800
197400        MOVE EP072-EXCL-MDSE-ID TO PV-HOLD-EXCL-MDSE-ID           19634900
197500        PERFORM 6100-SELECT-EXCL-DATA                             19635000
197600        IF PS-NOT-SKIP-REC                                        19636000
197910           PERFORM 7200-PROCESS-MDSE-HIER                         19639000
198510           IF PS-NOT-SKIP-REC                                     19700000
198601**** WR#35484 - B                                                 19720000
198602             PERFORM 6700-POPULATE-CINCTV-EXCL-REC                19730000
198603**** WR#35484 - E                                                 19740000
198606           ELSE                                                   19750000
198607             SET PS-NOT-SKIP-REC TO TRUE                          19760000
198610           END-IF                                                 19770000
198700        END-IF                                                    19780000
198800     ELSE                                                         19790000
198900        PERFORM 6400-OPEN-EXCLUDE-CURSOR                          19800000
199000        PERFORM 6500-FETCH-EXCLUDE-CURSOR                         19810000
199100        PERFORM 6200-POPULATE-EXCL-CINC-REC                       19820000
199200                UNTIL PS-END-OF-CURSOR                            19830000
199300        PERFORM 6600-CLOSE-EXCLUDE-CURSOR                         19840000
199400     END-IF.                                                      19850000
199500                                                                  19860000
199600*6000-EXIT.                                                       19860100
199700 EJECT.                                                           19860200
199800                                                                  19860300
199900*----------------------------------------------------------       19860400
200000* 6100-SELECT-EXCL-DATA.                                          19860500
200100*     SELECT THE DATA NEEDED FOR THE SIMPLE PRICING RECORD.       19860600
200200*----------------------------------------------------------       19860700
200300 6100-SELECT-EXCL-DATA.                                           19860800
200400                                                                  19860900
200500     PERFORM                                                      19861000
200600         WITH TEST AFTER                                          19862000
200700         VARYING PV-SQL-SUB                                       19863000
200800         FROM 1 BY 1                                              19864000
200900         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 19865000
201000                   OR  SQLCODE = 0                                19866000
201100                   OR  SQLCODE = +100)                            19867000
201200                                                                  19868000
201300         EXEC SQL                                                 19869000
201400             SELECT  A.DEPT_NBR                                   19870000
201500                    ,A.MAJ_CL_NBR                                 19880000
201600                    ,A.SUB_CL_NBR                                 19890000
201700                    ,A.STYL_ID                                    19900000
201800                    ,A.SKU_NBR                                    19910000
201810                    ,A.MDSE_HIER_CDE                              19920000
201900                    ,B.PROMO_ID                                   19930000
202000                    ,B.ESL_TOPR_TYP_CDE                           19940000
202100               INTO  :PV-DB2-DEPT-NBR :PV-DEPT-NBR-IND            19950000
202200                    ,:PV-DB2-MAJ-CL-NBR :PV-MAJ-CL-NBR-IND        19960000
202300                    ,:PV-DB2-SUB-CL-NBR :PV-SUB-CL-NBR-IND        19970000
202400                    ,:PV-DB2-STYL-ID :PV-STYL-ID-IND              19980000
202500                    ,:PV-DB2-SKU-NBR :PV-SKU-NBR-IND              19990000
202510                    ,:PV-DB2-MDSE-HIER-CDE                        20000000
202600                    ,:PV-DB2-PROMO-ID                             20010000
202700                    ,:PV-DB2-MDSE-ESL-TOPR :PV-MDSE-ESL-TOPR-IND  20020000
202800               FROM  XST_EXCL_MDSE A                              20030000
202900                    ,XST_MDSE_LNE_SELN B                          20040000
203000               WHERE A.PROMO_INTFC_ID = :PV-HOLD-PROMO-INTFC-ID   20050000
203100                 AND A.MDSE_LNE_ID    = :PV-HOLD-MDSE-LNE-ID      20060000
203200                 AND A.EXCL_MDSE_ID   = :PV-HOLD-EXCL-MDSE-ID     20070000
203300                 AND ((A.PROMO_INTFC_SUB_ID                       20080000
203400                                      = :PV-HOLD-INTFC-SUB-ID)    20090000
203500                  OR  (A.PROMO_INTFC_SUB_ID                       20100000
203600                                      = 0))                       20110000
203700                 AND A.PROMO_INTFC_ID = B.PROMO_INTFC_ID          20120000
203800                 AND A.MDSE_LNE_ID    = B.MDSE_LNE_ID             20130000
203900                 AND ((A.STAT_CDE     = :PV-SCHEDULED-STAT)       20140000
204000                  OR  (A.STAT_CDE     = :PV-CANCEL-STAT)          20150000
204100                  OR  (A.STAT_CDE     = :PV-DELETE-STAT))         20160000
204200               WITH UR                                            20170000
204300         END-EXEC                                                 20180000
204400                                                                  20190000
204500         EVALUATE TRUE                                            20200000
204600             WHEN SQLCODE = -904                                  20210000
204700             WHEN SQLCODE = -911                                  20220000
204800             WHEN SQLCODE = -913                                  20230000
204900                  CONTINUE                                        20240000
205000             WHEN SQLCODE = 0                                     20250000
205100                  CONTINUE                                        20260000
205200             WHEN SQLCODE = +100                                  20270000
205300                  SET PS-SKIP-REC TO TRUE                         20280000
205400             WHEN OTHER                                           20290000
205500                  DISPLAY 'SQLCODE: ' SQLCODE                     20300000
205600                  MOVE '6100-SELECT-EXCL-DATA'                    20310000
205700                                TO  PV-PARAGRAPH-NAME             20320000
205800                  MOVE 'SELECT EXCLUSION DATA'                    20330000
205900                                TO  PV-DB2-OPERATION              20340000
206000                  PERFORM 9900-SQL-ABEND-ROUTINE                  20350000
206100         END-EVALUATE                                             20360000
206200     END-PERFORM.                                                 20370000
206300                                                                  20380000
206400     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         20390000
206500        DISPLAY 'SQLCODE: ' SQLCODE                               20400000
206600        MOVE '6100-SELECT-EXCL-DATA'                              20410000
206700                              TO  PV-PARAGRAPH-NAME               20420000
206800        MOVE 'SELECT RETRIES EXCEEDED'                            20430000
206900                              TO  PV-DB2-OPERATION                20440000
207000        PERFORM 9900-SQL-ABEND-ROUTINE                            20450000
207100     END-IF.                                                      20460000
207200                                                                  20470000
207300*6100-EXIT.                                                       20480000
207400 EJECT.                                                           20490000
207500                                                                  20500000
207600*----------------------------------------------------------       20510000
207700* 6200-POPULATE-EXCL-CINC-REC.                                    20520000
207800*     POPULATE ANY EXCLUSION CINC RECORDS NEEDED.                 20530000
207900*----------------------------------------------------------       20540000
208000 6200-POPULATE-EXCL-CINC-REC.                                     20550000
208100                                                                  20560000
208610     PERFORM 7200-PROCESS-MDSE-HIER.                              20610000
208700                                                                  20620000
209410     IF PS-NOT-SKIP-REC                                           20700000
209501**** WR#35484 - B                                                 20720000
209502       PERFORM 6700-POPULATE-CINCTV-EXCL-REC                      20730000
209503**** WR#35484 - E                                                 20740000
209506     ELSE                                                         20750000
209507       SET PS-NOT-SKIP-REC TO TRUE                                20760000
209510     END-IF.                                                      20770000
209520                                                                  20780000
209600     INITIALIZE PV-NULL-INDICATORS.                               20790000
209700     PERFORM 6500-FETCH-EXCLUDE-CURSOR.                           20800000
209800                                                                  20810000
209900*6200-EXIT.                                                       20820000
210000 EJECT.                                                           20830000
210100                                                                  20840000
210200*----------------------------------------------------------       20850000
210300* 6300-POPULATE-PROMO-CDE.                                        20860000
210400*     POPULATES THE PROMO CODE ACCORDING TO WHAT TYPE OF          20870000
210500*     PROMOTION IT IS.                                            20880000
210600*----------------------------------------------------------       20890000
210700 6300-POPULATE-PROMO-CDE.                                         20900000
210800                                                                  20910000
210900     IF PV-SIMPLE-PRICING                                         20920000
211000        MOVE EP072-PROMO-INTFC-ID   TO PV-PROMO-CDE               20930000
211100     ELSE                                                         20940000
211200        IF PV-TIERED-PRICING                                      20950000
211300           IF PS-SINGLE-REC                                       20960000
211400              MOVE EP072-PROMO-INTFC-SUB-ID                       20970000
211500                                       TO PV-PROMO-CDE            20980000
211600           ELSE                                                   20990000
211700              MOVE PV-DB2-INTFC-SUB-ID TO PV-PROMO-CDE            21000000
211800           END-IF                                                 21010000
211900        END-IF                                                    21020000
212000     END-IF.                                                      21030000
212100                                                                  21040000
212200*6300-EXIT.                                                       21050000
212300 EJECT.                                                           21060000
212400                                                                  21070000
212500*----------------------------------------------------------       21080000
212600* 6400-OPEN-EXCLUDE-CURSOR.                                       21090000
212700*     OPEN THE EXCLUSION PMAP CURSOR.                             21100000
212800*----------------------------------------------------------       21110000
212900 6400-OPEN-EXCLUDE-CURSOR.                                        21120000
213000                                                                  21130000
213100     PERFORM                                                      21140000
213200         WITH TEST AFTER                                          21150000
213300         VARYING PV-SQL-SUB                                       21160000
213400         FROM 1 BY 1                                              21170000
213500         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 21180000
213600                   OR  SQLCODE = 0)                               21190000
213700                                                                  21200000
213800           EXEC SQL                                               21210000
213900              OPEN EXCLUDE-CURSOR                                 21220000
214000           END-EXEC                                               21230000
214100                                                                  21240000
214200         EVALUATE TRUE                                            21250000
214300             WHEN SQLCODE = -904                                  21260000
214400             WHEN SQLCODE = -911                                  21270000
214500             WHEN SQLCODE = -913                                  21280000
214600             WHEN SQLCODE = 0                                     21290000
214700                  SET PS-NOT-END-OF-CURSOR TO TRUE                21300000
214800             WHEN SQLWARN0 NOT EQUAL SPACE                        21310000
214900             WHEN SQLCODE NOT EQUAL ZERO                          21320000
215000                  MOVE '6400-OPEN-EXCLUDE-CURSOR'                 21330000
215100                                     TO PV-PARAGRAPH-NAME         21340000
215200                  MOVE 'ERROR ON OPEN OF EXCLUSION CURSOR'        21350000
215300                                     TO PV-DB2-OPERATION          21360000
215400                  PERFORM 9900-SQL-ABEND-ROUTINE                  21370000
215500         END-EVALUATE                                             21380000
215600     END-PERFORM.                                                 21390000
215700                                                                  21400000
215800     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         21410000
215900        MOVE '6400-OPEN-EXCLUDE-CURSOR'                           21420000
216000                             TO  PV-PARAGRAPH-NAME                21430000
216100        MOVE 'OPEN RETRIES EXCEEDED'                              21440000
216200                              TO  PV-DB2-OPERATION                21450000
216300        PERFORM 9900-SQL-ABEND-ROUTINE                            21460000
216400     END-IF.                                                      21470000
216500                                                                  21480000
216600*6400-EXIT.                                                       21490000
216700 EJECT.                                                           21500000
216800                                                                  21510000
216900*----------------------------------------------------------       21520000
217000* 6500-FETCH-EXCLUDE-CURSOR.                                      21530000
217100*     FETCH THE EXCLUSION PMAP CURSOR.                            21540000
217200*----------------------------------------------------------       21550000
217300 6500-FETCH-EXCLUDE-CURSOR.                                       21560000
217400                                                                  21570000
217500     PERFORM                                                      21580000
217600         WITH TEST AFTER                                          21590000
217700         VARYING PV-SQL-SUB                                       21600000
217800         FROM 1 BY 1                                              21610000
217900         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 21620000
218000                   OR  SQLCODE = 0                                21630000
218100                   OR  SQLCODE = +100)                            21640000
218200                                                                  21650000
218300           EXEC SQL                                               21660000
218400              FETCH EXCLUDE-CURSOR                                21670000
218500              INTO  :PV-DB2-PROMO-ID                              21680000
218600                   ,:PV-DB2-INTFC-SUB-ID                          21690000
218610                   ,:PV-DB2-EXCL-MDSE-ID                          21700000
218700                   ,:PV-DB2-DEPT-NBR :PV-DEPT-NBR-IND             21710000
218800                   ,:PV-DB2-MAJ-CL-NBR :PV-MAJ-CL-NBR-IND         21720000
218900                   ,:PV-DB2-SUB-CL-NBR :PV-SUB-CL-NBR-IND         21730000
219000                   ,:PV-DB2-STYL-ID :PV-STYL-ID-IND               21740000
219100                   ,:PV-DB2-SKU-NBR :PV-SKU-NBR-IND               21750000
219110                   ,:PV-DB2-MDSE-HIER-CDE                         21760000
219200           END-EXEC                                               21770000
219300                                                                  21780000
219400          EVALUATE TRUE                                           21790000
219500             WHEN SQLCODE = -904                                  21800000
219600             WHEN SQLCODE = -911                                  21810000
219700             WHEN SQLCODE = -913                                  21820000
219800                  CONTINUE                                        21830000
219900             WHEN SQLCODE = ZERO                                  21840000
220000                  ADD 1 TO PC-CNT-EXCL-CHECK                      21850000
220100             WHEN SQLCODE = +100                                  21860000
220200                  SET PS-END-OF-CURSOR    TO TRUE                 21870000
220300                  IF PC-CNT-EXCL-CHECK = 0                        21880000
220400                     SET PS-SKIP-REC TO TRUE                      21890000
220500                  END-IF                                          21910000
220600             WHEN SQLWARN0 NOT EQUAL SPACE                        21920000
220700             WHEN SQLCODE NOT EQUAL ZERO                          21930000
220800                  MOVE '6500-FETCH-EXCLUDE-CURSOR'                21940000
220900                                     TO PV-PARAGRAPH-NAME         21950000
221000                  MOVE 'ERROR ON FETCHING EXCLUSION CURSOR'       21960000
221100                                     TO PV-DB2-OPERATION          21970000
221200                  DISPLAY 'SQLCODE= ' SQLCODE                     21980000
221300                  PERFORM 9900-SQL-ABEND-ROUTINE                  21990000
221400          END-EVALUATE                                            22000000
221500     END-PERFORM.                                                 22010000
221600                                                                  22020000
221700     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        22030000
221800         MOVE '6500-FETCH-EXCLUDE-CURSOR'                         22040000
221900                               TO  PV-PARAGRAPH-NAME              22050000
222000         MOVE 'FETCH RETRIES EXCEEDED'                            22060000
222100                               TO  PV-DB2-OPERATION               22070000
222200         PERFORM 9900-SQL-ABEND-ROUTINE                           22080000
222300     END-IF.                                                      22090000
222400                                                                  22100000
222500*6500-EXIT.                                                       22110000
222600 EJECT.                                                           22120000
222700                                                                  22130000
222800*-----------------------------------------------------------      22140000
222900* 6600-CLOSE-EXCLUDE-CURSOR.                                      22150000
223000*     CLOSE THE EXCLUSION PMAP CURSOR.                            22160000
223100*-----------------------------------------------------------      22170000
223200 6600-CLOSE-EXCLUDE-CURSOR.                                       22180000
223300                                                                  22190000
223400     PERFORM                                                      22200000
223500         WITH TEST AFTER                                          22210000
223600         VARYING PV-SQL-SUB                                       22220000
223700         FROM 1 BY 1                                              22230000
223800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 22240000
223900                   OR  SQLCODE = 0)                               22250000
224000                                                                  22260000
224100           EXEC SQL                                               22270000
224200              CLOSE EXCLUDE-CURSOR                                22280000
224300           END-EXEC                                               22290000
224400                                                                  22300000
224500          EVALUATE TRUE                                           22310000
224600             WHEN SQLCODE = -904                                  22320000
224700             WHEN SQLCODE = -911                                  22330000
224800             WHEN SQLCODE = -913                                  22340000
224900             WHEN SQLCODE = 0                                     22350000
225000                  CONTINUE                                        22360000
225100             WHEN SQLWARN0 NOT EQUAL SPACE                        22370000
225200             WHEN SQLCODE NOT EQUAL ZERO                          22380000
225300                  MOVE '6600-CLOSE-EXCLUDE-CURSOR'                22390000
225400                                      TO PV-PARAGRAPH-NAME        22400000
225500                  MOVE 'ERROR ON CLOSE OF EXCLUSION CURSOR'       22410000
225600                                      TO PV-DB2-OPERATION         22420000
225700                  PERFORM 9900-SQL-ABEND-ROUTINE                  22430000
225800          END-EVALUATE                                            22440000
225900     END-PERFORM.                                                 22450000
226000                                                                  22460000
226100     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         22470000
226200        MOVE '6600-CLOSE-EXCLUDE-CURSOR'                          22480000
226300                               TO  PV-PARAGRAPH-NAME              22490000
226400        MOVE 'CLOSE RETRIES EXCEEDED'                             22500000
226500                               TO  PV-DB2-OPERATION               22510000
226600        PERFORM 9900-SQL-ABEND-ROUTINE                            22520000
226700     END-IF.                                                      22530000
226800                                                                  22540000
226900*6600-EXIT.                                                       22550000
227000 EJECT.                                                           22560000
227100                                                                  22570000
227110*----------------------------------------------------------       22580000
227120* 6700-POPULATE-CINCTV-EXCL-REC.         ** WR35484 **            22590000
227130*     THIS PARAGRAPH WILL BE PERFORMED ONLY FOR EXCLUDE           22600000
227140*     MERCHANDISE ROWS EXTRACTED, POINTS TO BE NOTED.             22610000
227150*   1) WHEN THE PS-SINGLE-REC IS SET , IT IMPLIES THE CHANGE      22620000
227151*      IS INITIATED BY CORRECTION PROCESS SO THE SUB-ID WILL      22630000
227152*      UPDATED FROM THE HOLD VARIABLE.                            22640000
227153*   2) FOR THE OTHER CASES THE DB2 VALUE IS MOVED                 22650000
227154*   FOR SIMPLE PROMOTIONS THE SUB-ID WILL BE MOVED IN 7600- PARA  22660000
227160*----------------------------------------------------------       22670000
227170 6700-POPULATE-CINCTV-EXCL-REC.                                   22680000
227180                                                                  22690000
227181     EVALUATE TRUE                                                22700000
227190         WHEN PS-SINGLE-REC                                       22710000
227191           MOVE PV-HOLD-EXCL-MDSE-ID  TO EP216-INCTV-MDSE-SET-ID  22711000
227193           IF PV-HOLD-INTFC-SUB-ID NOT = 0                        22712000
227196             MOVE PV-HOLD-INTFC-SUB-ID TO EP216-SYS-REC-SUB-ID    22713000
227197           END-IF                                                 22714000
227198         WHEN OTHER                                               22715000
227199           MOVE PV-DB2-EXCL-MDSE-ID   TO EP216-INCTV-MDSE-SET-ID  22715100
227201           IF PV-DB2-INTFC-SUB-ID NOT = 0                         22715200
227204             MOVE PV-DB2-INTFC-SUB-ID TO EP216-SYS-REC-SUB-ID     22715300
227205           END-IF                                                 22715400
227206     END-EVALUATE.                                                22715500
227207                                                                  22715600
227208     PERFORM 7600-POPULATE-CUST-INCTV-REC.                        22715700
227209                                                                  22715800
227210     PERFORM 9300-WRITE-CUST-INCTV-REC.                           22715900
227211                                                                  22716000
227212*6700-EXIT.                                                       22717000
227213 EJECT.                                                           22718000
227214                                                                  22719000
236700*----------------------------------------------------------       23400000
236800* 7110-POPULATES-ESL-TOPR-TYP.                                    23410000
236900*     POPULATES THE ESL TOPPER TYPE CODE.                         23420000
237000*----------------------------------------------------------       23430000
237100 7110-POPULATES-ESL-TOPR-TYP.                                     23440000
237200                                                                  23450000
237300     IF PV-MDSE-ESL-TOPR-NULL OR PV-DB2-MDSE-ESL-TOPR = SPACES    23460000
237400        SET PV-MDSE-ESL-TOPR-NULL TO TRUE                         23470000
237500        MOVE HIGH-VALUES          TO PV-MDSE-ESL-TOPR-TYP         23480000
237600     ELSE                                                         23490000
237700        MOVE PV-DB2-MDSE-ESL-TOPR TO PV-MDSE-ESL-TOPR-TYP         23500000
237800     END-IF.                                                      23510000
237900                                                                  23520000
238000     IF PV-PROMO-ESL-TOPR-NULL OR PV-DB2-PROMO-ESL-TOPR = SPACES  23530000
238100        SET PV-PROMO-ESL-TOPR-NULL TO TRUE                        23540000
238200        MOVE HIGH-VALUES           TO PV-PROMO-ESL-TOPR-TYP       23550000
238300     ELSE                                                         23560000
238400        MOVE PV-DB2-PROMO-ESL-TOPR TO PV-PROMO-ESL-TOPR-TYP       23570000
238500     END-IF.                                                      23580000
238600                                                                  23590000
238700     IF PV-RMS-ESL-TOPR-NULL OR PV-DB2-RMS-ESL-TOPR = SPACES      23600000
238800        SET PV-RMS-ESL-TOPR-NULL TO TRUE                          23610000
238900        MOVE HIGH-VALUES         TO PV-RMS-ESL-TOPR-TYP           23620000
239000     ELSE                                                         23630000
239100        MOVE PV-DB2-RMS-ESL-TOPR TO PV-RMS-ESL-TOPR-TYP           23640000
239200     END-IF.                                                      23650000
239300                                                                  23660000
239400     IF PV-ADHOC-ESL-TOPR-NULL OR PV-DB2-ADHOC-ESL-TOPR = SPACES  23670000
239500        SET PV-ADHOC-ESL-TOPR-NULL TO TRUE                        23680000
239600        MOVE HIGH-VALUES           TO PV-ADHOC-ESL-TOPR-TYP       23690000
239700     ELSE                                                         23700000
239800        MOVE PV-DB2-ADHOC-ESL-TOPR TO PV-ADHOC-ESL-TOPR-TYP       23710000
239900     END-IF.                                                      23720000
240000                                                                  23730000
240100     EVALUATE TRUE                                                23740000
240200       WHEN PV-MDSE-ESL-TOPR-NULL AND PV-PROMO-ESL-TOPR-NULL AND  23750000
240300            PV-ADHOC-ESL-TOPR-NULL AND PV-RMS-ESL-TOPR-NULL       23760000
240401            SET PV-PROMO-TYP-IND-NO-OUT TO TRUE                   23770000
240410            MOVE PC-NULL-VALUE TO PV-CINC-ESL-TOPR-CD             23780000
240500       WHEN PV-MDSE-ESL-TOPR-NULL AND PV-ADHOC-ESL-TOPR-NULL AND  23790000
240600            PV-RMS-ESL-TOPR-NULL                                  23800000
240710            SET PV-PROMO-TYP-IND-YES-OUT TO TRUE                  23810000
240800            MOVE PV-PROMO-ESL-TOPR-TYP  TO PV-PROMO-TYP-IND-1     23820000
240910            MOVE PV-PROMO-TYP-IND    TO PV-PROMO-TYP-IND-OUT      23830000
241000       WHEN PV-PROMO-ESL-TOPR-NULL AND PV-ADHOC-ESL-TOPR-NULL AND 23840000
241100            PV-RMS-ESL-TOPR-NULL                                  23850000
241210            SET PV-PROMO-TYP-IND-YES-OUT TO TRUE                  23860000
241300            MOVE PV-MDSE-ESL-TOPR-TYP   TO PV-PROMO-TYP-IND-1     23870000
241410            MOVE PV-PROMO-TYP-IND    TO PV-PROMO-TYP-IND-OUT      23880000
241500       WHEN PV-PROMO-ESL-TOPR-NULL AND PV-MDSE-ESL-TOPR-NULL AND  23890000
241600            PV-ADHOC-ESL-TOPR-NULL                                23900000
241710            SET PV-PROMO-TYP-IND-YES-OUT TO TRUE                  23910000
241800            MOVE PV-RMS-ESL-TOPR-TYP    TO PV-PROMO-TYP-IND-1     23920000
241910            MOVE PV-PROMO-TYP-IND      TO PV-PROMO-TYP-IND-OUT    23930000
242000       WHEN PV-PROMO-ESL-TOPR-NULL AND PV-MDSE-ESL-TOPR-NULL AND  23940000
242100            PV-RMS-ESL-TOPR-NULL                                  23950000
242210            SET PV-PROMO-TYP-IND-YES-OUT TO TRUE                  23960000
242300            MOVE PV-ADHOC-ESL-TOPR-TYP    TO PV-PROMO-TYP-IND-1   23970000
242410            MOVE PV-PROMO-TYP-IND     TO PV-PROMO-TYP-IND-OUT     23980000
242500       WHEN PV-PROMO-ESL-TOPR-TYP < PV-MDSE-ESL-TOPR-TYP AND      23990000
242600            PV-PROMO-ESL-TOPR-TYP < PV-RMS-ESL-TOPR-TYP AND       24000000
242700            PV-PROMO-ESL-TOPR-TYP < PV-ADHOC-ESL-TOPR-TYP         24010000
242810            SET PV-PROMO-TYP-IND-YES-OUT TO TRUE                  24020000
242900            MOVE PV-PROMO-ESL-TOPR-TYP  TO PV-PROMO-TYP-IND-1     24030000
243010            MOVE PV-PROMO-TYP-IND     TO PV-PROMO-TYP-IND-OUT     24040000
243100       WHEN PV-MDSE-ESL-TOPR-TYP <= PV-PROMO-ESL-TOPR-TYP AND     24050000
243200            PV-MDSE-ESL-TOPR-TYP <= PV-RMS-ESL-TOPR-TYP AND       24060000
243300            PV-MDSE-ESL-TOPR-TYP <= PV-ADHOC-ESL-TOPR-TYP         24070000
243410            SET PV-PROMO-TYP-IND-YES-OUT TO TRUE                  24080000
243500            MOVE PV-MDSE-ESL-TOPR-TYP   TO PV-PROMO-TYP-IND-1     24090000
243610            MOVE PV-PROMO-TYP-IND     TO PV-PROMO-TYP-IND-OUT     24040000
243700       WHEN PV-RMS-ESL-TOPR-TYP <= PV-PROMO-ESL-TOPR-TYP AND      24110000
243800            PV-RMS-ESL-TOPR-TYP <= PV-MDSE-ESL-TOPR-TYP AND       24120000
243900            PV-RMS-ESL-TOPR-TYP <= PV-ADHOC-ESL-TOPR-TYP          24130000
244010            SET PV-PROMO-TYP-IND-YES-OUT TO TRUE                  24140000
244100            MOVE PV-RMS-ESL-TOPR-TYP   TO PV-PROMO-TYP-IND-1      24150000
244210            MOVE PV-PROMO-TYP-IND     TO PV-PROMO-TYP-IND-OUT     24040000
244300       WHEN PV-ADHOC-ESL-TOPR-TYP <= PV-PROMO-ESL-TOPR-TYP AND    24170000
244400            PV-ADHOC-ESL-TOPR-TYP <= PV-MDSE-ESL-TOPR-TYP AND     24180000
244500            PV-ADHOC-ESL-TOPR-TYP <= PV-RMS-ESL-TOPR-TYP          24190000
244610            SET PV-PROMO-TYP-IND-YES-OUT TO TRUE                  24200000
244700            MOVE PV-ADHOC-ESL-TOPR-TYP   TO PV-PROMO-TYP-IND-1    24210000
244810            MOVE PV-PROMO-TYP-IND     TO PV-PROMO-TYP-IND-OUT     24040000
244900       WHEN OTHER                                                 24230000
245010            SET PV-PROMO-TYP-IND-NO-OUT TO TRUE                   24240000
245100     END-EVALUATE.                                                24250000
245200                                                                  24260000
245210     EVALUATE TRUE                                                24270000
245220         WHEN PV-CINC-ESL-TOPR-CD = PC-NULL-VALUE                 24280000
245230            CONTINUE                                              24290000
245250         WHEN PV-PROMO-TYP-IND-NO-OUT                             24300000
245251            MOVE PC-NULL-VALUE TO PV-CINC-ESL-TOPR-CD             24310000
245270         WHEN PV-PROMO-TYP-IND-YES-OUT                            24320000
245271            MOVE PV-PROMO-TYP-IND-1 TO PV-CINC-ESL-TOPR-CD        24330000
245280     END-EVALUATE.                                                24340000
245290                                                                  24350000
245300*7110-EXIT.                                                       24360000
245400 EJECT.                                                           24370000
245500                                                                  24380000
245600*----------------------------------------------------------       24390000
245700* 7200-PROCESS-MDSE-HIER.                                         24400000
245800*     PROCESS MDSE HIER INFORMATION.                              24410000
245900*----------------------------------------------------------       24420000
246000 7200-PROCESS-MDSE-HIER.                                          24430000
246100                                                                  24440000
246510     IF PV-DB2-MDSE-HIER-CDE = 'STY'                              24490000
246511       PERFORM 7210-LOOKUP-MDSE-HIER-INFO                         24500000
246520     END-IF.                                                      24510000
249500                                                                  24750000
249600*7200-EXIT.                                                       24760000
249700 EJECT.                                                           24770000
249800                                                                  24780000
249801*----------------------------------------------------------       24790000
249802* 7210-LOOKUP-MDSE-HIER-INFO                                      24800000
249804*     SELECT THE "PARENT" MERCHANDISE INFORMATION.                24810000
249806*----------------------------------------------------------       24820000
249810 7210-LOOKUP-MDSE-HIER-INFO.                                      24830000
249811                                                                  24840000
249812     PERFORM                                                      24850000
249813         WITH TEST AFTER                                          24860000
249814         VARYING PV-SQL-SUB                                       24870000
249815         FROM 1 BY 1                                              24880000
249821         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 24890000
249822                   OR  SQLCODE = +0                               24900000
249823                   OR  SQLCODE = +100)                            24910000
249824                                                                  24920000
249825         EXEC SQL                                                 24930000
249826             SELECT  DEPT_NBR                                     24940000
249827                    ,MAJ_CL_NBR                                   24950000
249828                    ,SUB_CL_NBR                                   24960000
249829               INTO :PV-DB2-DEPT-NBR                              24970000
249830                   ,:PV-DB2-MAJ-CL-NBR                            24980000
249831                   ,:PV-DB2-SUB-CL-NBR                            24981000
249832               FROM  XST_VND_STYL                                 24981100
249833               WHERE STYL_ID = :PV-DB2-STYL-ID                    24981200
249834               WITH UR                                            24981300
249835         END-EXEC                                                 24981400
249836                                                                  24981500
249837         EVALUATE TRUE                                            24981600
249838             WHEN SQLCODE = -904                                  24981700
249839             WHEN SQLCODE = -911                                  24981800
249840             WHEN SQLCODE = -913                                  24981900
249841                  CONTINUE                                        24982000
249842             WHEN SQLCODE = +0                                    24982100
249843                  CONTINUE                                        24982200
249844             WHEN SQLCODE = +100                                  24982300
249845                  SET PS-SKIP-REC TO TRUE                         24982400
249847                  DISPLAY 'STYLE ID: ' PV-DB2-STYL-ID             24982500
249850                  DISPLAY 'SQLCODE: ' SQLCODE                     24982600
249851                  MOVE '7210-LOOKUP-MDSE-HIER-INFO'               24982700
249853                                TO  PV-PARAGRAPH-NAME             24982800
249854                  MOVE 'SELECT MDSE HIER INFO FOR STYLE LVL REC'  24982900
249855                                TO  PV-DB2-OPERATION              24983000
249856             WHEN OTHER                                           24983100
249859                  DISPLAY 'STYLE ID: ' PV-DB2-STYL-ID             24983200
249860                  DISPLAY 'SQLCODE: ' SQLCODE                     24983300
249861                  MOVE '7210-LOOKUP-MDSE-HIER-INFO'               24983400
249862                                TO  PV-PARAGRAPH-NAME             24983500
249863                  MOVE 'SELECT MDSE HIER INFO FOR STYLE LVL REC'  24983600
249864                                TO  PV-DB2-OPERATION              24983700
249865                  PERFORM 9900-SQL-ABEND-ROUTINE                  24983800
249866         END-EVALUATE                                             24983900
249867     END-PERFORM.                                                 24984000
249868                                                                  24985000
249869     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         24986000
249870        DISPLAY 'SQLCODE: ' SQLCODE                               24986100
249871        MOVE '7210-LOOKUP-MDSE-HIER-INFO'                         24986200
249872                              TO  PV-PARAGRAPH-NAME               24986300
249873        MOVE 'SELECT RETRIES EXCEEDED'                            24986400
249874                              TO  PV-DB2-OPERATION                24986500
249875        PERFORM 9900-SQL-ABEND-ROUTINE                            24986600
249876     END-IF.                                                      24986700
249877                                                                  24986800
249878*7210-EXIT.                                                       24986900
249879 EJECT.                                                           24987000
249880                                                                  24987100
249900*----------------------------------------------------------       24987200
250000* 7300-SELECT-PROMO-DATA.                                         24987300
250100*     SELECT THE DATA NEEDED FOR THE SIMPLE PRICING RECORD.       24987400
250200*----------------------------------------------------------       24987500
250300 7300-SELECT-PROMO-DATA.                                          24987600
250400                                                                  24987700
250500     PERFORM                                                      24987800
250600         WITH TEST AFTER                                          24987900
250700         VARYING PV-SQL-SUB                                       24988000
250800         FROM 1 BY 1                                              24989000
250900         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 24990000
251000                   OR  SQLCODE = 0)                               25000000
251100                                                                  25010000
251200         EXEC SQL                                                 25020000
251300             SELECT  PROMO_TYP_CDE                                25030000
251400                    ,PROMO_NM                                     25040000
251500                    ,ESL_TOPR_TYP_CDE                             25050000
251600               INTO  :PV-DB2-PROMO-TYP-CDE                        25060000
251700                    ,:PV-DB2-PROMO-NAME :PV-PROMO-NM-IND          25070000
251800                    ,:PV-DB2-PROMO-ESL-TOPR :PV-PROMO-ESL-TOPR-IND25080000
251900               FROM  XST_PROMO                                    25090000
252000               WHERE PROMO_ID = :PV-DB2-PROMO-ID                  25100000
252100               WITH UR                                            25110000
252200         END-EXEC                                                 25120000
252300                                                                  25130000
252310                                                                  25140000
252400         EVALUATE TRUE                                            25150000
252500             WHEN SQLCODE = -904                                  25160000
252600             WHEN SQLCODE = -911                                  25170000
252700             WHEN SQLCODE = -913                                  25180000
252800                  CONTINUE                                        25190000
252900             WHEN SQLCODE = 0                                     25200000
253000                  CONTINUE                                        25210000
253100             WHEN OTHER                                           25220000
253200                  DISPLAY 'PROMO INTFC ID: '                      25230000
253300                                         PV-HOLD-PROMO-INTFC-ID   25231000
253400                  DISPLAY 'MDSE LNE ID: ' PV-HOLD-MDSE-LNE-ID     25232000
253500                  DISPLAY 'PROMO ID: ' PV-DB2-PROMO-ID            25233000
253600                  DISPLAY 'DB2 ERROR IN 7300-SELECT-PROMO-DATA'   25234000
253700                  DISPLAY 'SQLCODE: ' SQLCODE                     25235000
253800                  MOVE '7300-SELECT-PROMO-DATA'                   25236000
253900                                TO  PV-PARAGRAPH-NAME             25237000
254000                  MOVE 'SELECT PROMOTION DATA'                    25238000
254100                                TO  PV-DB2-OPERATION              25239000
254200                  PERFORM 9900-SQL-ABEND-ROUTINE                  25240000
254300         END-EVALUATE                                             25250000
254400     END-PERFORM.                                                 25260000
254500                                                                  25270000
254600     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         25280000
254700        DISPLAY 'SQLCODE: ' SQLCODE                               25290000
254800        MOVE '7300-SELECT-PROMO-DATA'                             25300000
254900                              TO  PV-PARAGRAPH-NAME               25310000
255000        MOVE 'SELECT RETRIES EXCEEDED'                            25320000
255100                              TO  PV-DB2-OPERATION                25330000
255200        PERFORM 9900-SQL-ABEND-ROUTINE                            25340000
255300     END-IF.                                                      25350000
255400                                                                  25360000
255500*7300-EXIT.                                                       25370000
255600 EJECT.                                                           25380000
255700                                                                  25390000
255800*----------------------------------------------------------       25400000
255900* 7400-SELECT-RMS-DATA.                                           25410000
256000*     SELECT THE DATA NEEDED FOR THE RMS STORE GROUP ESL-TOPPER.  25420000
256100*----------------------------------------------------------       25430000
256200 7400-SELECT-RMS-DATA.                                            25440000
256300                                                                  25450000
256400     PERFORM                                                      25460000
256500         WITH TEST AFTER                                          25470000
256600         VARYING PV-SQL-SUB                                       25480000
256700         FROM 1 BY 1                                              25490000
256800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 25500000
256900                   OR  SQLCODE = 0                                25510000
257000                   OR  SQLCODE = +100)                            25520000
257100                                                                  25530000
257200         EXEC SQL                                                 25540000
257300             SELECT  ESL_TOPR_TYP_CDE                             25550000
257400               INTO  :PV-DB2-RMS-ESL-TOPR :PV-RMS-ESL-TOPR-IND    25560000
257500               FROM  XST_PROMO_STR_GP                             25570000
257600               WHERE PROMO_INTFC_ID = :PV-HOLD-PROMO-INTFC-ID     25580000
257700                 AND MDSE_LNE_ID    = :PV-HOLD-MDSE-LNE-ID        25590000
257800                 AND STR_GP_TYP_CDE = :PV-SETUP-STR-GRP-TYP-CDE   25600000
257900                 AND STR_GP_ID      = :PV-SETUP-STR-GRP-ID        25610000
258000               WITH UR                                            25620000
258100         END-EXEC                                                 25630000
258200                                                                  25640000
258300         EVALUATE TRUE                                            25650000
258400             WHEN SQLCODE = -904                                  25660000
258500             WHEN SQLCODE = -911                                  25670000
258600             WHEN SQLCODE = -913                                  25680000
258700                  CONTINUE                                        25690000
258800             WHEN SQLCODE = 0                                     25700000
258900                  SET PS-RMS-EOF           TO TRUE                25710000
259000                  CONTINUE                                        25720000
259100             WHEN SQLCODE = 100                                   25730000
259200                  SET PV-RMS-ESL-TOPR-NULL TO TRUE                25740000
259300                  SET PS-RMS-EOF           TO TRUE                25750000
259400             WHEN OTHER                                           25760000
259500                  DISPLAY 'PROMO INTFC ID: '                      25770000
259600                                         PV-HOLD-PROMO-INTFC-ID   25780000
259700                  DISPLAY 'MDSE LNE ID: ' PV-HOLD-MDSE-LNE-ID     25790000
259800                  DISPLAY 'DB2 ERROR IN 7400-SELECT-RMS-DATA'     25800000
259900                  DISPLAY 'SQLCODE: ' SQLCODE                     25810000
260000                  MOVE '7400-SELECT-RMS-DATA'                     25820000
260100                                TO  PV-PARAGRAPH-NAME             25830000
260200                  MOVE 'SELECT RMS DATA'                          25840000
260300                                TO  PV-DB2-OPERATION              25850000
260400                  PERFORM 9900-SQL-ABEND-ROUTINE                  25860000
260500         END-EVALUATE                                             25870000
260600     END-PERFORM.                                                 25880000
260700                                                                  25890000
260800     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         25900000
260900        DISPLAY 'SQLCODE: ' SQLCODE                               25910000
261000        MOVE '7400-SELECT-RMS-DATA'                               25920000
261100                              TO  PV-PARAGRAPH-NAME               25930000
261200        MOVE 'SELECT RETRIES EXCEEDED'                            25940000
261300                              TO  PV-DB2-OPERATION                25950000
261400        PERFORM 9900-SQL-ABEND-ROUTINE                            25960000
261500     END-IF.                                                      25970000
261600                                                                  25980000
261700*7400-EXIT.                                                       25990000
261800 EJECT.                                                           26000000
261900                                                                  26010000
262000*----------------------------------------------------------       26020000
262100* 7500-SELECT-ADHOC-DATA.                                         26030000
262200*     SELECT THE DATA NEEDED FOR THE RMS STORE GROUP ESL-TOPPER.  26040000
262300*----------------------------------------------------------       26050000
262400 7500-SELECT-ADHOC-DATA.                                          26060000
262500                                                                  26070000
262600     PERFORM                                                      26080000
262700         WITH TEST AFTER                                          26090000
262800         VARYING PV-SQL-SUB                                       26100000
262900         FROM 1 BY 1                                              26110000
263000         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 26120000
263100                   OR  SQLCODE = 0                                26130000
263200                   OR  SQLCODE = +100)                            26140000
263300                                                                  26150000
263400         EXEC SQL                                                 26160000
263500             SELECT  ESL_TOPR_TYP_CDE                             26170000
263600               INTO  :PV-DB2-ADHOC-ESL-TOPR :PV-ADHOC-ESL-TOPR-IND26180000
263700               FROM  XST_PROMO_ADHC_RLT                           26190000
263800               WHERE PROMO_INTFC_ID = :PV-HOLD-PROMO-INTFC-ID     26200000
263900                 AND MDSE_LNE_ID    = :PV-HOLD-MDSE-LNE-ID        26210000
264000                 AND ADHC_STR_GP_ID = :PV-SETUP-STR-GRP-ID        26220000
264100               WITH UR                                            26230000
264200         END-EXEC                                                 26240000
264300                                                                  26250000
264400         EVALUATE TRUE                                            26260000
264500             WHEN SQLCODE = -904                                  26270000
264600             WHEN SQLCODE = -911                                  26280000
264700             WHEN SQLCODE = -913                                  26290000
264800                  CONTINUE                                        26300000
264900             WHEN SQLCODE = 0                                     26310000
265000                  SET PS-ADHOC-EOF           TO TRUE              26320000
265100                  CONTINUE                                        26330000
265200             WHEN SQLCODE = 100                                   26340000
265300                  SET PV-ADHOC-ESL-TOPR-NULL TO TRUE              26350000
265400                  SET PS-ADHOC-EOF           TO TRUE              26360000
265500             WHEN OTHER                                           26370000
265600                  DISPLAY 'PROMO INTFC ID: '                      26380000
265700                                         PV-HOLD-PROMO-INTFC-ID   26390000
265800                  DISPLAY 'MDSE LNE ID: ' PV-HOLD-MDSE-LNE-ID     26400000
265900                  DISPLAY 'DB2 ERROR IN 7500-SELECT-ADHOC-DATA'   26410000
266000                  DISPLAY 'SQLCODE: ' SQLCODE                     26420000
266100                  MOVE '7500-SELECT-ADHOC-DATA'                   26430000
266200                                TO  PV-PARAGRAPH-NAME             26440000
266300                  MOVE 'SELECT ADHOC DATA'                        26450000
266400                                TO  PV-DB2-OPERATION              26460000
266500                  PERFORM 9900-SQL-ABEND-ROUTINE                  26470000
266600         END-EVALUATE                                             26480000
266700     END-PERFORM.                                                 26490000
266800                                                                  26500000
266900     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         26510000
267000        DISPLAY 'SQLCODE: ' SQLCODE                               26520000
267100        MOVE '7500-SELECT-ADHOC-DATA'                             26530000
267200                              TO  PV-PARAGRAPH-NAME               26540000
267300        MOVE 'SELECT RETRIES EXCEEDED'                            26550000
267400                              TO  PV-DB2-OPERATION                26560000
267500        PERFORM 9900-SQL-ABEND-ROUTINE                            26570000
267600     END-IF.                                                      26580000
267700                                                                  26590000
267800*7500-EXIT.                                                       26600000
267900 EJECT.                                                           26610000
268000                                                                  26620000
268001*----------------------------------------------------------       26630000
268002* 7600-POPULATE-CUST-INCTV-REC.           ** WR35484 **           26640000
268003*     POPULATES THE CUSTOMER INCENTIVE RECORD                     26650000
268004*----------------------------------------------------------       26660000
268005 7600-POPULATE-CUST-INCTV-REC.                                    26670000
268006                                                                  26680000
268007     MOVE EP072-RECORD-ACTION       TO EP216-RECORD-ACTION.       26690000
268008     MOVE EP072-PROMO-INTFC-ID      TO EP216-SYS-OF-REC-ID.       26700000
268009     MOVE PC-SYS-IDENTIFIER         TO EP216-SYS-IDENTIFIER.      26710000
268010     MOVE PV-DB2-PROMO-NAME         TO EP216-INCTV-NM.            26720000
268011     MOVE PC-TRGR-TYP-CDE           TO EP216-INCTV-TRGR-TYP-CDE.  26730000
268012     MOVE PV-DB2-PROMO-ID           TO EP216-SYS-OF-REC-GP-ID.    26740000
268013                                                                  26750000
268014     MOVE PC-SECT-TYP-CDE           TO EP216-INCTV-SECT-TYP-CDE.  26760000
268015                                                                  26770000
268016     MOVE PV-PROMO-STRT-DTE         TO PV-CINCTV-DATE-B.          26780000
268017     MOVE PV-STRT-TM                TO PV-CINCTV-TIME-B.          26790000
268018     MOVE PV-CINCTV-EFF-BEG-TMST    TO EP216-INCTV-BEG-TMST.      26800000
268019                                                                  26800100
268020     MOVE PV-PROMO-END-DTE          TO PV-CINCTV-DATE-E.          26800200
268021     MOVE PV-END-TM                 TO PV-CINCTV-TIME-E.          26800300
268022     MOVE PV-CINCTV-EFF-END-TMST    TO EP216-INCTV-END-TMST.      26800400
268023                                                                  26800500
268024     MOVE PC-CNCTR-CDE-AND          TO EP216-BUY-CNCTR-CDE.       26800600
268025     MOVE PC-CNCTR-CDE-AND          TO EP216-GET-CNCTR-CDE.       26800700
268026                                                                  26800800
268027*  FOR SIMPLE PROMOTIONS THE INTERFACE ID WILL ALSO BE THE SUB-ID 26800900
268028*  AT THE CUSTOMER INCENTIVE SIDE.                                26801000
268029                                                                  26801100
268030     EVALUATE TRUE                                                26801200
268031         WHEN PV-SIMPLE-PRICING                                   26801300
268033            MOVE EP072-PROMO-INTFC-ID TO EP216-SYS-REC-SUB-ID     26801400
268034            IF PV-PRC-TYP-CDE = 'RBO'                             26801500
268035                MOVE PC-REBATE-CDE       TO EP216-INCTV-TYP-CDE   26801600
268036            ELSE                                                  26801700
268037                MOVE PC-SIMPLE-PROMOTION TO EP216-INCTV-TYP-CDE   26801800
268038            END-IF                                                26801900
268039         WHEN PV-TIERED-PRICING                                   26802000
268040            MOVE PC-TIERED-PROMOTION  TO EP216-INCTV-TYP-CDE      26802100
268041     END-EVALUATE.                                                26802200
268042                                                                  26802300
268043     IF PV-DB2-MDSE-HIER-CDE = 'STY'                              26802403
268044       PERFORM 7210-LOOKUP-MDSE-HIER-INFO                         26802503
268045     END-IF.                                                      26802603
268046                                                                  26802300
268047     PERFORM 7650-POPULATE-MDSE-DATA.                             26802400
268048                                                                  26802500
268049*7600-EXIT.                                                       26802600
268050 EJECT.                                                           26802700
268051                                                                  26802800
268052*----------------------------------------------------------       26802900
268053* 7650-POPULATE-MDSE-DATA.                 ** WR35484 **          26803000
268054*    THE PARAGRAPH PERFORMS THE FOLLOWING:                        26803100
268055* 1)  POPULATES THE MERCHANDISE FIELDS WITHIN EPRD216 COPYBOOK    26803200
268056* 2)  MAKES SURE THAT WHEN THE SKU-NBR OR STYLE-ID IS NOT ZERO    26803300
268057*     DO NOT SEND THE DEPT-NBR, MAJ-CL-NBR OR THE SUB-CL-NBR      26803400
268058* 3)  MAKE SURE THE IE-IND AND THE TKT-CLOR-CDE IS POPULATED      26803500
268059*     THE TKT_CLOR_CDE AND SHLF-TOPR-CDE WILL ALWAYS BE NULL      26803600
268060*     FOR THE EXCLUDED MERCHANDISE, ITS TAKEN CARE OVER HERE.     26803700
268061*----------------------------------------------------------       26803800
268062 7650-POPULATE-MDSE-DATA.                                         26803900
268063                                                                  26804000
268064     MOVE PV-DB2-MDSE-HIER-CDE    TO EP216-MDSE-HIER-CDE.         26804100
268065                                                                  26804200
268066     IF PS-MDSE-INCLUDE                                           26804300
268067        MOVE PV-HOLD-MDSE-LNE-ID     TO  EP216-INCTV-MDSE-SET-ID  26804400
268068        MOVE PC-MDSE-NOT-EXCLUDED    TO  EP216-MDSE-IE-IND        26804500
268069     ELSE                                                         26804600
268070        MOVE PC-MDSE-EXCLUDED        TO  EP216-MDSE-IE-IND        26804700
268071     END-IF.                                                      26804800
268072                                                                  26804900
268073     IF PV-DEPT-NBR-NULL                                          26805000
268074        MOVE ZEROES        TO EP216-DEPT-NBR                      26805100
268075     ELSE                                                         26805200
268076        MOVE PV-DB2-DEPT-NBR TO EP216-DEPT-NBR                    26805300
268077     END-IF.                                                      26805400
268078                                                                  26805500
268079     IF PV-MAJ-CL-NBR-NULL                                        26805600
268080        MOVE ZEROES        TO EP216-MAJ-CL-NBR                    26805700
268081     ELSE                                                         26805800
268082        MOVE PV-DB2-MAJ-CL-NBR TO EP216-MAJ-CL-NBR-NL             26805900
268083     END-IF.                                                      26806000
268084                                                                  26807000
268085     IF PV-SUB-CL-NBR-NULL                                        26807100
268086        MOVE ZEROES        TO EP216-SUB-CL-NBR                    26807200
268087     ELSE                                                         26807300
268088        MOVE PV-DB2-SUB-CL-NBR TO EP216-SUB-CL-NBR-NL             26807400
268089     END-IF.                                                      26807500
268091                                                                  26807600
268092     IF PV-STYL-ID-NULL                                           26807700
268093        MOVE ZEROES        TO EP216-STYLE-ID                      26807800
268094     ELSE                                                         26807900
268095        MOVE PV-DB2-STYL-ID TO EP216-STYLE-ID                     26808000
268096     END-IF.                                                      26808100
268097                                                                  26808200
268098     IF PV-SKU-NBR-NULL                                           26808300
268099        MOVE ZEROES        TO  EP216-SKU-NBR                      26808400
268100     ELSE                                                         26808500
268101        MOVE PV-DB2-SKU-NBR   TO EP216-SKU-NBR                    26808600
268102     END-IF.                                                      26808700
268103                                                                  26808800
268104     EVALUATE TRUE                                                26808900
268105         WHEN PV-DB2-PROMO-TYP-CDE = 'R'                          26809000
268108             MOVE 'WW' TO EP216-TKT-CLOR-CDE                      26809100
268109                                                                  26809200
268110         WHEN PV-DB2-PROMO-TYP-CDE = 'C'                          26809300
268111          AND PV-DB2-TKT-CLOR-CDE = 'A'                           26809400
268112             MOVE 'NW' TO EP216-TKT-CLOR-CDE                      26809500
268113                                                                  26809600
268114         WHEN PV-DB2-PROMO-TYP-CDE = 'C'                          26809700
268115          AND PV-DB2-TKT-CLOR-CDE = 'F'                           26809800
268116             MOVE 'YY' TO EP216-TKT-CLOR-CDE                      26809900
268117                                                                  26810000
268118         WHEN PV-DB2-PROMO-TYP-CDE = 'C'                          26810100
268119          AND PV-DB2-TKT-CLOR-CDE = 'C'                           26810200
268120             MOVE 'RR' TO EP216-TKT-CLOR-CDE                      26810300
268121         WHEN OTHER                                               26810400
268122             MOVE PC-NULL-VALUE TO EP216-TKT-CLOR-CDE             26810500
268123                                                                  26810600
268124     END-EVALUATE.                                                26810700
268126                                                                  26810800
268127     IF PV-PRC-TYP-CDE = 'RBO'                                    26810900
268128         MOVE 'WW'          TO EP216-TKT-CLOR-CDE                 26811000
268129     END-IF.                                                      26811100
268130                                                                  26811200
268131     IF PV-CINC-ESL-TOPR-CD = SPACES                              26811300
268132        MOVE PC-NULL-VALUE TO EP216-ELECT-SLF-TOPR-CD             26811400
268133     ELSE                                                         26811500
268134        MOVE PV-CINC-ESL-TOPR-CD TO EP216-ELECT-SLF-TOPR-CD       26811600
268135     END-IF.                                                      26811700
268136                                                                  26811800
268137*7650-EXIT.                                                       26811900
268138 EJECT.                                                           26812000
268139                                                                  26812100
268140*----------------------------------------------------------       26812200
268200* DATE ROUTINE TO SET UP THE PROCESS DATE IN                      26812300
268300* CCYYMMDD FORMAT.                                                26812400
268400*----------------------------------------------------------       26812500
268500 8000-DATE-ROUTINE.                                               26812600
268600                                                                  26812700
268700     INITIALIZE DPG51 DPG52 DPG53                                 26812800
268800                DPG54 DPG55 DPG56.                                26812900
268900                                                                  26813000
269000     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      26813100
269100     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      26813200
269200     MOVE EP111-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    26813300
269300                                                                  26813400
269400     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    26813500
269500                                             DPG54 DPG55 DPG56.   26813600
269600                                                                  26813700
269700     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  26813800
269800       DISPLAY '** ABEND **'                                      26813900
269900       DISPLAY '** PROGRAM = EPKUT111'                            26814000
270000       DISPLAY 'DATE = ' EP111-CC-CRNT-DTE                        26815000
270100       DISPLAY DPG54-ERROR-MESSAGE                                26816000
270200       MOVE 4019 TO ABEND-CODE                                    26817000
270300       CALL 'ILBOABN0' USING ABEND-CODE                           26818000
270400     END-IF.                                                      26819000
270500                                                                  26820000
270600     MOVE DPG55-DB2-ISO-DATE         TO PV-EP111-CC-ISO-DATE.     26830000
270700                                                                  26840000
270800*8000-EXIT.                                                       26850000
270900 EJECT.                                                           26860000
271000*----------------------------------------------------------       26870000
271100* 9000-READ-INPUT-FILE.                                           26880000
271200*     READ THE FILE INTO THE PROMO INTERFACE ID COPYBOOK.         26890000
271300*----------------------------------------------------------       26900000
271400 9000-READ-INPUT-FILE.                                            26910000
271500                                                                  26920000
271600     READ PROMO-INTFC-ID-FILE                                     26930000
271700         INTO EP072-PROMO-INTFC-RECORD                            26940000
271800         AT END                                                   26950000
271900             SET PS-END-OF-INPUT-FILE TO TRUE                     26960000
272000     END-READ.                                                    26970000
272100                                                                  26980000
272200     IF PS-NOT-END-OF-INPUT-FILE                                  26990000
272300        ADD 1 TO PC-CNT-READ-RECS                                 27000000
272400     END-IF.                                                      27010000
272500                                                                  27020000
272600*9000-EXIT.                                                       27030000
272700 EJECT.                                                           27040000
272800                                                                  27050000
275810*----------------------------------------------------------       27360000
275820* 9300-WRITE-CUST-INCTV-REC                                       27370000
275830*     WRITES THE CUSTOMER INCENTIVE RECORD.   WR#35484            27380000
275840*----------------------------------------------------------       27390000
275850 9300-WRITE-CUST-INCTV-REC.                                       27400000
275860                                                                  27410000
275870     WRITE CUST-INCTV-RECORD                                      27420000
275880       FROM EP216-CUST-INCTV-RECORD.                              27430000
275890                                                                  27588000
275891     ADD 1 TO PC-CNT-CUST-INCTV-RECS.                             27589000
275893                                                                  27590000
275894*9300-EXIT.                                                       27590100
275895 EJECT.                                                           27590200
275896                                                                  27590300
275900*----------------------------------------------------------       27590400
276000* 9800-ABEND.                                                     27590500
276100*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  27590600
276200*----------------------------------------------------------       27590700
276300 9800-ABEND.                                                      27590800
276400                                                                  27590900
276500     DISPLAY '** ABEND           **'.                             27591000
276600     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  27592000
276700     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        27593000
276800     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       27594000
276900     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       27595000
277000     CALL 'ILBOABN0' USING ABEND-CODE.                            27595100
277100                                                                  27595200
277200*9800-EXIT.                                                       27595300
277300 EJECT.                                                           27595400
277400                                                                  27595500
277500*----------------------------------------------------------       27595600
277600* 9900-SQL-ABEND-ROUTINE.                                         27595700
277700*     SQL ABEND ROUTINE.                                          27595800
277800*----------------------------------------------------------       27595900
277900 9900-SQL-ABEND-ROUTINE.                                          27596000
278000                                                                  27597000
278100     DISPLAY '** ABEND     **'.                                   27598000
278200     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        27599000
278300     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              27600000
278400     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               27610000
278500                                                                  27620000
278600     COPY DPPD004.                                                27630000
278700     SET ABEND-4013-DB2-ERROR TO TRUE.                            27640000
278800     CALL 'ILBOABN0' USING ABEND-CODE.                            27650000
278900                                                                  27660000
279000*9900-EXIT.                                                       27670000
279100 EJECT.                                                           27680000
279200                                                                  27690000
279300*----------------------------------------------------------       27700000
279400* 9999-WRAPUP.                                                    27710000
279500*     END OF PROGRAM ROUTINE.  CLOSES ALL FILES AND DISPLAYS      27720000
279600*     ANY DATA FROM THE PROGRAM.                                  27730000
279700*----------------------------------------------------------       27740000
279800 9999-WRAPUP.                                                     27750000
279900                                                                  27760000
280000     CLOSE PROMO-INTFC-ID-FILE                                    27770000
280100           CONTROL-CARD-CURR-PRICG-DTE                            27780000
280310           CUST-INCTV-FILE.                                       27810000
280400                                                                  27820000
280500     DISPLAY ' '.                                                 27830000
280600     DISPLAY '*********************************************'.     27840000
280700     DISPLAY 'PROGRAM NAME: ' PC-CURRENT-PROGRAM-NAME.            27850000
280800     DISPLAY '*********************************************'.     27860000
280900     DISPLAY 'NUMBER OF INPUT RECS READ: ' PC-CNT-READ-RECS.      27870000
281210     DISPLAY 'NUMBER OF CUST INCTV RECS WRITTEN:'                 27910000
281220                                       PC-CNT-CUST-INCTV-RECS.    27920000
281300     DISPLAY '*********************************************'.     27930000
281400                                                                  27940000
281500*9999-EXIT.                                                       27950000
281600 EJECT.                                                           27960000
281700                                                                  27970000
