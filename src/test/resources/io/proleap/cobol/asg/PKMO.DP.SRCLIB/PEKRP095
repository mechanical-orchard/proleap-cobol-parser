      ******************************************************************        
       IDENTIFICATION DIVISION.                                                 
      ******************************************************************        
                                                                                
       PROGRAM-ID.             PEKRP095.                                        
       AUTHOR.                 COGNIZANT.                                       
       INSTALLATION.           KOHLS DEPARTMENT STORES.                         
       DATE-WRITTEN.           05/01/2011.                                      
       DATE-COMPILED.                                                           
                                                                                
      ******************************************************************        
      * Remarks                                                        *        
      * -------                                                        *        
      *                                                                *        
      * Title        - Perm clearance report                                    
      *                                                                *        
      * Description  - This program  will generate the report in the            
      *                required format from the sorted output of PERM  *        
      *                data                                            *        
      *                                                                *        
      * Change history                                                *         
      ******************************************************************        
      * WR number     Programmer       Date                            *        
      * ---------------------------------------------------------------*        
      * WR34795       COGNIZANT        05/01/2011.                              
      * Original version                                               *        
      ******************************************************************        
C98147* CHG0098147    Linda Friess     11/11/2014                               
C98147*    EXPANDED PO NUMBER TO 8 DIGITS                                       
C98147******************************************************************        
                                                                                
      ******************************************************************        
       ENVIRONMENT DIVISION.                                                    
      ******************************************************************        
                                                                                
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT INPUT-FILE                                                    
               ASSIGN                       TO INP01                            
               FILE STATUS                  IS INPUT-FILE-PS.                   
                                                                                
           SELECT PERM-CLEARANCE-RPT                                            
               ASSIGN                       TO RPT01                            
               FILE STATUS                  IS REPORT-FILE-PS.                  
                                                                                
       DATA DIVISION.                                                           
                                                                                
       FILE SECTION.                                                            
                                                                                
       FD  INPUT-FILE                                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS                                             
           DATA RECORD IS IN-INPUT-RECORD                                       
           LABEL RECORDS ARE STANDARD.                                          
       01  IN-INPUT-RECORD               PIC  X(200).                           
                                                                                
       FD  PERM-CLEARANCE-RPT                                                   
           RECORDING MODE F                                                     
           BLOCK CONTAINS 0 RECORDS                                             
           DATA RECORD IS REPORT-LINE                                           
           LABEL RECORDS ARE OMITTED.                                           
       01  REPORT-LINE                   PIC  X(200).                           
                                                                                
       WORKING-STORAGE SECTION.                                                 
                                                                                
       01  ABEND-CODE                    PIC S9(04) COMP VALUE +0.              
           88  ABEND-4001-WRITE-ERROR                VALUE +4001.               
           88  ABEND-4002-READ-ERROR                 VALUE +4002.               
           88  ABEND-4003-CTRL-CARD-ERROR            VALUE +4003.               
           88  ABEND-4004-TABLE-ERROR                VALUE +4004.               
           88  ABEND-4005-OPEN-ERROR                 VALUE +4005.               
           88  ABEND-4006-CLOSE-ERROR                VALUE +4006.               
           88  ABEND-4007-SEQUENCE-ERROR             VALUE +4007.               
           88  ABEND-4008-DATA-ERROR                 VALUE +4008.               
           88  ABEND-4009-KEY-DATA-ERROR             VALUE +4009.               
           88  ABEND-4013-SQL-ERROR                  VALUE +4013.               
           88  ABEND-4014-ORACLE-LOGON-ERROR         VALUE +4014.               
           88  ABEND-4019-DATE-ROUTINE-ERROR         VALUE +4019.               
           88  ABEND-4444-FORCED-ABEND               VALUE +4444.               
                                                                                
       01  PA-PROGRAM-ACCUMULATORS.                                             
           03  PA-RECORDS-READ              PIC S9(10)   VALUE ZERO             
                                                         COMP-3.                
           03  PA-RECORDS-WROTE             PIC S9(10)   VALUE ZERO             
                                                         COMP-3.                
       01  PC-PROGRAM-CONSTANTS.                                                
           03  PC-CURRENT-PROGRAM-NAME      PIC  X(08)   VALUE                  
                                                         'PEKRP095'.            
           03  PC-MAX-LINE-CNT              PIC S9(04)   COMP                   
                                                         VALUE +80.             
           03  PC-SPACE                     PIC  X(01)   VALUE SPACES.          
                                                                                
       01  PV-PROGRAM-VARIABLES.                                                
           03  PV-PAGE-CNT                  PIC  9(05)   VALUE ZERO.            
           03  PV-ADVANCE-CNT               PIC S9(04)   VALUE ZERO             
                                                         COMP.                  
           03  PV-LINE-CNT                  PIC S9(04)   VALUE +0               
                                                         COMP.                  
           03  PV-ADVANCE-LINES             PIC S9(04)   VALUE +1               
                                                         COMP.                  
           03  PV-PARAGRAPH-NAME            PIC  X(30)   VALUE SPACES.          
           03  PV-OPERATION-MSG-1           PIC  X(40)   VALUE SPACES.          
           03  PV-OPERATION-MSG-2           PIC  X(40)   VALUE SPACES.          
           03  PV-DETAL-NULL-LINE           PIC  X(200)  VALUE SPACES.          
           03  PV-CURRENT-DATE              PIC  X(08)   VALUE SPACES.          
                                                                                
           03  PV-CURRENT-DATE-FMT.                                             
               05  PV-CURRENT-MONTH         PIC  9(02)   VALUE ZERO.            
               05  PV-FILLER                PIC  X(01)   VALUE "/".             
               05  PV-CURRENT-DAY           PIC  9(02)   VALUE ZERO.            
               05  PV-FILLER                PIC  X(01)   VALUE "/".             
               05  PV-CURRENT-YYYY          PIC  9(04)   VALUE ZERO.            
                                                                                
           03  PV-CURRENT-TIME.                                                 
               05  PV-CURRENT-HOUR          PIC  9(02)   VALUE ZERO.            
               05  PV-CURRENT-MINUTE        PIC  9(02)   VALUE ZERO.            
               05  FILLER                   PIC  9(04)   VALUE ZERO.            
                                                                                
           03  PV-HLD-RECORD.                                                   
               05  PV-HLD-BYR.                                                  
                   10  PV-HLD-BYR-NBR       PIC  9(03)  VALUE ZEROES.           
                   10  FILLER               PIC  X(01)  VALUE '-'.              
                   10  PV-HLD-BYR-NM        PIC  X(29)  VALUE SPACES.           
C98147         05  FILLER                   PIC  X(01)  VALUE SPACES.           
               05  PV-HLD-DEPT.                                                 
                   10  PV-HLD-DEPT-NBR      PIC  9(03)  VALUE ZEROES.           
                   10  FILLER               PIC  X(01)  VALUE '-'.              
                   10  PV-HLD-DEPT-NM       PIC  X(20)  VALUE SPACES.           
               05  FILLER                   PIC  X(02)  VALUE SPACES.           
               05  PV-HLD-SUB-CL-NBR        PIC  9(02)  VALUE ZEROES.           
               05  FILLER                   PIC  X(02)  VALUE SPACES.           
               05  PV-HLD-VS-NBR            PIC  X(20)  VALUE SPACES.           
               05  FILLER                   PIC  X(01)  VALUE SPACES.           
               05  PV-HLD-SKU-NBR           PIC  X(08)  VALUE SPACES.           
               05  FILLER                   PIC  X(01)  VALUE SPACES.           
               05  PV-HLD-SKU-STAT-CDE      PIC  X(02)  VALUE SPACES.           
               05  FILLER                   PIC  X(01)  VALUE SPACES.           
               05  PV-HLD-SKU-DESC          PIC  X(24)  VALUE SPACES.           
               05  FILLER                   PIC  X(01)  VALUE SPACES.           
               05  PV-HLD-CSTM-CLOR-DESC    PIC  X(10)  VALUE SPACES.           
               05  FILLER                   PIC  X(01)  VALUE SPACES.           
               05  PV-HLD-ONHAND-QTY        PIC  S9(07) VALUE ZEROES.           
               05  FILLER                   PIC  X(01)  VALUE SPACES.           
C98147         05  PV-HLD-PO-NBR            PIC  9(08)  VALUE ZEROES.           
               05  FILLER                   PIC  X(01)  VALUE SPACES.           
               05  PV-HLD-SHIP-BEF-DT       PIC  X(08)  VALUE SPACES.           
               05  FILLER                   PIC  X(01)  VALUE SPACES.           
               05  PV-HLD-LAST-RCVD-DT      PIC  X(08)  VALUE SPACES.           
               05  FILLER                   PIC  X(01)  VALUE SPACES.           
               05  PV-HLD-EXPT-DATE         PIC  X(08)  VALUE SPACES.      CL**1
               05  FILLER                   PIC  X(01)  VALUE SPACES.           
               05  PV-HLD-PRCHG-ID          PIC  9(06)  VALUE ZEROES.           
               05  FILLER                   PIC  X(01)  VALUE SPACES.           
               05  PV-HLD-EFF-DTE           PIC  X(08)  VALUE SPACES.           
               05  FILLER                   PIC  X(01)  VALUE SPACES.           
               05  PV-HLD-ALL-RMNG-IND      PIC  X(03)  VALUE SPACES.           
               05  FILLER                   PIC  X(01)  VALUE SPACES.           
               05  PV-HLD-REASON-CODE       PIC  X(03)  VALUE SPACES.           
                                                                                
           03  PV-REP-RECORD.                                                   
               05  PV-REP-BYR.                                                  
                   10  PV-REP-BYR-NBR       PIC  9(03)  VALUE ZEROES.           
                   10  FILLER               PIC  X(01)  VALUE '-'.              
                   10  PV-REP-BYR-NM        PIC  X(29)  VALUE SPACES.           
C98147         05  FILLER                   PIC  X(01)  VALUE SPACES.           
               05  PV-REP-DEPT.                                                 
                   10  PV-REP-DEPT-NBR      PIC  9(03)  VALUE ZEROES.           
                   10  FILLER               PIC  X(01)  VALUE '-'.              
                   10  PV-REP-DEPT-NM       PIC  X(20)  VALUE SPACES.           
               05  FILLER                   PIC  X(02)  VALUE SPACES.           
               05  PV-REP-SUB-CL-NBR        PIC  9(02)  VALUE ZEROES.           
               05  FILLER                   PIC  X(02)  VALUE SPACES.           
               05  PV-REP-VS-NBR            PIC  X(20)  VALUE SPACES.           
               05  FILLER                   PIC  X(01)  VALUE SPACES.           
               05  PV-REP-SKU-NBR           PIC  X(08)  VALUE SPACES.           
               05  FILLER                   PIC  X(01)  VALUE SPACES.           
               05  PV-REP-SKU-STAT-CDE      PIC  X(02)  VALUE SPACES.           
               05  FILLER                   PIC  X(01)  VALUE SPACES.           
               05  PV-REP-SKU-DESC          PIC  X(24)  VALUE SPACES.           
               05  FILLER                   PIC  X(01)  VALUE SPACES.           
               05  PV-REP-CSTM-CLOR-DESC    PIC  X(10)  VALUE SPACES.           
               05  FILLER                   PIC  X(01)  VALUE SPACES.           
               05  PV-REP-ONHAND-QTY        PIC  S9(07) VALUE ZEROES.           
               05  FILLER                   PIC  X(01)  VALUE SPACES.           
C98147         05  PV-REP-PO-NBR            PIC  9(08)  VALUE ZEROES.           
               05  FILLER                   PIC  X(01)  VALUE SPACES.           
               05  PV-REP-SHIP-BEF-DT       PIC  X(08)  VALUE SPACES.           
               05  FILLER                   PIC  X(01)  VALUE SPACES.           
               05  PV-REP-LAST-RCVD-DT      PIC  X(08)  VALUE SPACES.           
               05  FILLER                   PIC  X(01)  VALUE SPACES.           
               05  PV-REP-EXPT-DATE         PIC  X(08)  VALUE SPACES.      CL**1
               05  FILLER                   PIC  X(01)  VALUE SPACES.           
               05  PV-REP-PRCHG-ID          PIC  9(06)  VALUE ZEROES.           
               05  FILLER                   PIC  X(01)  VALUE SPACES.           
               05  PV-REP-EFF-DTE           PIC  X(08)  VALUE SPACES.           
               05  FILLER                   PIC  X(01)  VALUE SPACES.           
               05  PV-REP-ALL-RMNG-IND      PIC  X(03)  VALUE SPACES.           
               05  FILLER                   PIC  X(01)  VALUE SPACES.           
               05  PV-REP-REASON-CODE       PIC  X(03)  VALUE SPACES.           
                                                                                
       01  HEADER-LINE-1.                                                       
           03  FILLER                       PIC  X(81)   VALUE SPACES.          
           03  FILLER                       PIC  X(40)   VALUE                  
               ' BUSINESS RULE PRICING EXCEPTION REPORT '.                      
           03  FILLER                       PIC  X(79)  VALUE SPACES.           
                                                                                
       01  HEADER-LINE-2.                                                       
           03  FILLER                       PIC  X(84)   VALUE SPACES.          
           03  FILLER                       PIC  X(33)   VALUE                  
               ' PERM CLEARANCE EXCEPTION REPORT '.                             
           03  FILLER                       PIC  X(83)  VALUE SPACES.           
                                                                                
       01  HEADER-LINE-3.                                                       
           03  FILLER                       PIC  X(93)   VALUE SPACES.          
           03  FILLER                       PIC  X(07)   VALUE                  
                                            'DATE : '.                          
           03  HL3-DATE-VAL                 PIC  X(10).                         
           03  FILLER                       PIC  X(90)   VALUE SPACES.          
                                                                                
       01  BLANK-LINE.                                                          
           03  FILLER                       PIC  X(200)  VALUE SPACES.          
                                                                                
       01  DETAIL-HEAD1.                                                        
           03  FILLER                       PIC  X(15)   VALUE                  
               'BUYER NUMBER - '.                                               
C98147     03  FILLER                       PIC  X(19)   VALUE SPACES.          
           03  FILLER                       PIC  X(20)   VALUE                  
               'DEPARTMENT NUMBER - '.                                          
           03  FILLER                       PIC  X(05)   VALUE SPACES.          
           03  FILLER                       PIC  X(03)   VALUE 'S/C'.           
           03  FILLER                       PIC  X(01)   VALUE SPACES.          
           03  FILLER                       PIC  X(13)   VALUE                  
               'VENDOR STYLE '.                                                 
           03  FILLER                       PIC  X(10)   VALUE SPACES.          
           03  FILLER                       PIC  X(03)   VALUE                  
               'SKU'.                                                           
           03  FILLER                       PIC  X(04)   VALUE SPACES.          
           03  FILLER                       PIC  X(02)   VALUE  'ST'.           
           03  FILLER                       PIC  X(01)   VALUE SPACES.          
           03  FILLER                       PIC  X(15)   VALUE                  
               'SKU DESCRIPTION'.                                               
           03  FILLER                       PIC  X(10)   VALUE SPACES.          
           03  FILLER                       PIC  X(06)   VALUE                  
               'VENDOR'.                                                        
           03  FILLER                       PIC  X(06)   VALUE SPACES.          
           03  FILLER                       PIC  X(07)   VALUE                  
               'ON HAND'.                                                       
C98147     03  FILLER                       PIC  X(04)   VALUE SPACES.          
           03  FILLER                       PIC  X(02)   VALUE 'PO'.            
           03  FILLER                       PIC  X(04)   VALUE SPACES.          
           03  FILLER                       PIC  X(07)   VALUE                  
               'PO SHIP'.                                                       
           03  FILLER                       PIC  X(02)   VALUE SPACES.          
           03  FILLER                       PIC  X(04)   VALUE                  
               'LAST'.                                                          
           03  FILLER                       PIC  X(05)   VALUE SPACES.          
           03  FILLER                       PIC  X(08)   VALUE                  
               'EXPECTED'.                                                      
           03  FILLER                       PIC  X(01)   VALUE SPACES.          
           03  FILLER                       PIC  X(06)   VALUE                  
               'PC DOC'.                                                        
           03  FILLER                       PIC  X(01)   VALUE SPACES.          
           03  FILLER                       PIC  X(05)   VALUE                  
               'PRICE'.                                                         
           03  FILLER                       PIC  X(04)   VALUE SPACES.          
           03  FILLER                       PIC  X(03)   VALUE 'ALL'.           
           03  FILLER                       PIC  X(01)   VALUE SPACES.          
           03  FILLER                       PIC  X(03)   VALUE 'RSN'.           
                                                                                
       01  DETAIL-HEAD2.                                                        
           03  FILLER                       PIC  X(03)   VALUE SPACES.          
           03  FILLER                       PIC  X(05)   VALUE 'NAME'.          
C98147     03  FILLER                       PIC  X(35)   VALUE SPACES.          
           03  FILLER                       PIC  X(04)   VALUE 'NAME'.          
           03  FILLER                       PIC  X(18)   VALUE SPACES.          
           03  FILLER                       PIC  X(13)   VALUE                  
               'NUMBER'.                                                        
           03  FILLER                       PIC  X(08)   VALUE SPACES.          
           03  FILLER                       PIC  X(06)   VALUE                  
               'NUMBER'.                                                        
           03  FILLER                       PIC  X(29)   VALUE SPACES.          
           03  FILLER                       PIC  X(05)   VALUE 'COLOR'.         
           03  FILLER                       PIC  X(08)   VALUE SPACES.          
           03  FILLER                       PIC  X(05)   VALUE 'UNITS'.         
C98147     03  FILLER                       PIC  X(03)   VALUE SPACES.          
           03  FILLER                       PIC  X(06)   VALUE                  
               'NUMBER'.                                                        
           03  FILLER                       PIC  X(04)   VALUE SPACES.          
           03  FILLER                       PIC  X(04)   VALUE 'DATE'.          
           03  FILLER                       PIC  X(03)   VALUE SPACES.          
           03  FILLER                       PIC  X(07)   VALUE                  
               'RECEIPT'.                                                       
           03  FILLER                       PIC  X(02)   VALUE SPACES.          
           03  FILLER                       PIC  X(07)   VALUE                  
               'RECEIPT'.                                                       
           03  FILLER                       PIC  X(04)   VALUE SPACES.          
           03  FILLER                       PIC  X(03)   VALUE 'NBR'.           
           03  FILLER                       PIC  X(02)   VALUE SPACES.          
           03  FILLER                       PIC  X(06)   VALUE                  
               'CHANGE'.                                                        
           03  FILLER                       PIC  X(03)   VALUE SPACES.          
           03  FILLER                       PIC  X(03)   VALUE 'STR'.           
           03  FILLER                       PIC  X(01)   VALUE SPACES.          
           03  FILLER                       PIC  X(03)   VALUE 'CDE'.           
                                                                                
       01  DETAIL-HEAD3.                                                        
           03  FILLER                       PIC  X(159)  VALUE SPACES.          
           03  FILLER                       PIC  X(04)   VALUE 'DATE'.          
           03  FILLER                       PIC  X(05)   VALUE SPACES.          
           03  FILLER                       PIC  X(04)   VALUE 'DATE'.          
           03  FILLER                       PIC  X(12)   VALUE SPACES.          
           03  FILLER                       PIC  X(04)   VALUE 'DATE'.          
           03  FILLER                       PIC  X(05)   VALUE SPACES.          
           03  FILLER                       PIC  X(03)   VALUE 'IND'.           
           03  FILLER                       PIC  X(04)   VALUE SPACES.          
                                                                                
       01  DETAIL-HEAD4.                                                        
           03  FILLER                       PIC  X(193)  VALUE SPACES.          
           03  FILLER                       PIC  X(03)   VALUE 'Y/N'.           
           03  FILLER                       PIC  X(04)   VALUE SPACES.          
                                                                                
       01  DETAIL-LINE.                                                         
           03  PV-DET-BYR.                                                      
               05  PV-DET-BYR-NBR           PIC  9(03).                         
               05  PV-DET-BYR-FILLER        PIC  X(01)  VALUE SPACES.           
               05  PV-DET-BYR-NM            PIC  X(29)  VALUE SPACES.           
C98147     03  FILLER                       PIC  X(01)  VALUE SPACES.           
           03  PV-DET-DEPT.                                                     
               05  PV-DET-DEPT-NBR          PIC  Z(03).                         
               05  PV-DET-DEPT-FILLER       PIC  X(01)  VALUE SPACES.           
               05  PV-DET-DEPT-NM           PIC  X(20)  VALUE SPACES.           
           03  FILLER                       PIC  X(01)  VALUE SPACES.           
           03  PV-DET-SUB-CL-NBR            PIC  Z(02).                         
           03  FILLER                       PIC  X(02)  VALUE SPACES.           
           03  PV-DET-VS-NBR                PIC  X(20)  VALUE SPACES.           
           03  FILLER                       PIC  X(01)  VALUE SPACES.           
           03  PV-DET-SKU-NBR               PIC  X(08)  VALUE SPACES.           
           03  FILLER                       PIC  X(01)  VALUE SPACES.           
           03  PV-DET-SKU-STAT-CDE          PIC  X(02)  VALUE SPACES.           
           03  FILLER                       PIC  X(01)  VALUE SPACES.           
           03  PV-DET-SKU-DESC              PIC  X(24)  VALUE SPACES.           
           03  FILLER                       PIC  X(01)  VALUE SPACES.           
           03  PV-DET-CSTM-CLOR-DESC        PIC  X(10)  VALUE SPACES.           
           03  FILLER                       PIC  X(01)  VALUE SPACES.           
           03  PV-DET-ONHAND-QTY            PIC  ZZZZZZ9-.                      
           03  FILLER                       PIC  X(01)  VALUE SPACES.           
C98147     03  PV-DET-PO-NBR                PIC  Z(08).                         
           03  FILLER                       PIC  X(01)  VALUE SPACES.           
           03  PV-DET-SHIP-BEF-DT           PIC  X(08)  VALUE SPACES.           
           03  FILLER                       PIC  X(01)  VALUE SPACES.           
           03  PV-DET-LAST-RCVD-DT          PIC  X(08)  VALUE SPACES.           
           03  FILLER                       PIC  X(01)  VALUE SPACES.           
           03  PV-DET-EXPT-DATE             PIC  X(08)  VALUE SPACES.           
           03  FILLER                       PIC  X(01)  VALUE SPACES.           
           03  PV-DET-PRCHG-ID              PIC  Z(06).                         
           03  FILLER                       PIC  X(01)  VALUE SPACES.           
           03  PV-DET-EFF-DTE               PIC  X(08)  VALUE SPACES.           
           03  FILLER                       PIC  X(01)  VALUE SPACES.           
           03  PV-DET-ALL-RMNG-IND          PIC  X(03)  VALUE SPACES.           
           03  FILLER                       PIC  X(01)  VALUE SPACES.           
           03  PV-DET-REASON-CODE           PIC  X(03)  VALUE SPACES.           
                                                                                
       01  DETAIL-HEAD-DASH.                                                    
           03  FILLER                       PIC  X(33)   VALUE ALL '-'.         
C98147     03  FILLER                       PIC  X(01)   VALUE SPACES.          
           03  FILLER                       PIC  X(24)   VALUE ALL '-'.         
           03  FILLER                       PIC  X(01)   VALUE SPACES.          
           03  FILLER                       PIC  X(03)   VALUE ALL '-'.         
           03  FILLER                       PIC  X(01)   VALUE SPACES.          
           03  FILLER                       PIC  X(20)   VALUE ALL '-'.         
           03  FILLER                       PIC  X(01)   VALUE SPACES.          
           03  FILLER                       PIC  X(08)   VALUE ALL '-'.         
           03  FILLER                       PIC  X(01)   VALUE SPACES.          
           03  FILLER                       PIC  X(02)   VALUE ALL '-'.         
           03  FILLER                       PIC  X(01)   VALUE SPACES.          
           03  FILLER                       PIC  X(24)   VALUE ALL '-'.         
           03  FILLER                       PIC  X(01)   VALUE SPACES.          
           03  FILLER                       PIC  X(10)   VALUE ALL '-'.         
           03  FILLER                       PIC  X(01)   VALUE SPACES.          
           03  FILLER                       PIC  X(08)   VALUE ALL '-'.         
           03  FILLER                       PIC  X(01)   VALUE SPACES.          
C98147     03  FILLER                       PIC  X(08)   VALUE ALL '-'.         
           03  FILLER                       PIC  X(01)   VALUE SPACES.          
           03  FILLER                       PIC  X(08)   VALUE ALL '-'.         
           03  FILLER                       PIC  X(01)   VALUE SPACES.          
           03  FILLER                       PIC  X(08)   VALUE ALL '-'.         
           03  FILLER                       PIC  X(01)   VALUE SPACES.          
           03  FILLER                       PIC  X(08)   VALUE ALL '-'.         
           03  FILLER                       PIC  X(01)   VALUE SPACES.          
           03  FILLER                       PIC  X(06)   VALUE ALL '-'.         
           03  FILLER                       PIC  X(01)   VALUE SPACES.          
           03  FILLER                       PIC  X(08)   VALUE ALL '-'.         
           03  FILLER                       PIC  X(01)   VALUE SPACES.          
           03  FILLER                       PIC  X(03)   VALUE ALL '-'.         
           03  FILLER                       PIC  X(01)   VALUE SPACES.          
           03  FILLER                       PIC  X(03)   VALUE ALL '-'.         
                                                                                
       01  END-OF-REPORT-LINE.                                                  
           03  FILLER                       PIC  X(90)   VALUE SPACES.          
           03  FILLER                       PIC  X(20)   VALUE                  
               '** END OF REPORT ** '.                                          
           03  FILLER                       PIC  X(90)   VALUE SPACES.          
                                                                                
       01  DETAIL-NO-DATA.                                                      
           03  FILLER                       PIC  X(88)   VALUE SPACES.          
           03  FILLER                       PIC  X(24)   VALUE                  
               'NO DATA FOUND TO PROCESS'.                                      
           03  FILLER                       PIC  X(88)   VALUE SPACES.          
                                                                                
       01  PS-PROGRAM-SWITCHES.                                                 
           03  PS-FIRST-INPUT-SW            PIC  X(01)   VALUE 'Y'.             
               88  PS-NOT-FIRST-INPUT                    VALUE 'N'.             
               88  PS-FIRST-INPUT                        VALUE 'Y'.             
           03  PS-FILE-CHK-SW               PIC  X(01)   VALUE 'N'.             
               88  NOT-EOF-FILE                          VALUE 'N'.             
               88  EOF-FILE                              VALUE 'Y'.             
                                                                                
       01  OTHER-DATA-VARIABLES.                                                
           03  INPUT-FILE-PS                PIC  X(02)   VALUE SPACES.          
           03  REPORT-FILE-PS               PIC  X(02)   VALUE SPACES.          
                                                                                
      *****************************************************************         
      *  COPYBOOKS                                                    *         
      *****************************************************************         
                                                                                
      ** STANDARD HEADER LINE - KOHLS 200 COL                                   
           COPY DPWS200O.                                                       
                                                                                
       EJECT                                                                    
       PROCEDURE DIVISION.                                                      
      *****************************************************************         
      *        MAINLINE ROUTINE                                       *         
      *****************************************************************         
       A100-MAINLINE.                                                           
                                                                                
           PERFORM B100-INITIALIZE.                                             
                                                                                
           PERFORM C100-PROCESS-ROUTINE                                         
             UNTIL EOF-FILE.                                                    
                                                                                
           PERFORM D100-EXIT-RTN.                                               
                                                                                
           STOP RUN.                                                            
                                                                                
      *****************************************************************         
      *        INITIALIZE ROUTINE                                     *         
      *****************************************************************         
       B100-INITIALIZE.                                                         
                                                                                
           OPEN INPUT  INPUT-FILE.                                              
                                                                                
           IF  INPUT-FILE-PS NOT = '00'                                         
               MOVE 'PEKRP095'        TO PC-CURRENT-PROGRAM-NAME                
               MOVE 'ERROR WHILE OPENING INPUT-FILE'                            
                                           TO PV-OPERATION-MSG-1                
               STRING 'FILE STATUS = ' INPUT-FILE-PS                            
                   DELIMITED BY SIZE     INTO PV-OPERATION-MSG-2                
               END-STRING                                                       
               PERFORM Z100-ABEND                                               
           END-IF                                                               
                                                                                
           OPEN OUTPUT PERM-CLEARANCE-RPT.                                      
                                                                                
           IF  REPORT-FILE-PS NOT = '00'                                        
               MOVE 'PEKRP095'             TO PC-CURRENT-PROGRAM-NAME           
               MOVE 'ERROR WHILE OPENING REPORT-FILE-PS'                        
                                           TO PV-OPERATION-MSG-1                
               STRING 'FILE STATUS = '        REPORT-FILE-PS                    
                   DELIMITED BY SIZE     INTO PV-OPERATION-MSG-2                
               END-STRING                                                       
               PERFORM Z100-ABEND                                               
           END-IF                                                               
                                                                                
           ACCEPT PV-CURRENT-DATE         FROM DATE YYYYMMDD.                   
           MOVE PV-CURRENT-DATE(3:2)        TO DP200O-RUN-YEAR                  
           MOVE PV-CURRENT-DATE(1:4)        TO PV-CURRENT-YYYY.                 
           MOVE PV-CURRENT-DATE(5:2)        TO DP200O-RUN-MONTH                 
                                               PV-CURRENT-MONTH.                
           MOVE PV-CURRENT-DATE(7:2)        TO DP200O-RUN-DAY                   
                                               PV-CURRENT-DAY.                  
           ACCEPT PV-CURRENT-TIME         FROM TIME.                            
           MOVE PV-CURRENT-HOUR             TO DP200O-RUN-HOUR.                 
           MOVE PV-CURRENT-MINUTE           TO DP200O-RUN-MINUTE.               
           MOVE PC-CURRENT-PROGRAM-NAME     TO DP200O-PROGRAM-NAME.             
                                                                                
           DISPLAY ' '.                                                         
           DISPLAY ' ** ' PC-CURRENT-PROGRAM-NAME ' **'.                        
                                                                                
           MOVE  0                          TO PV-PAGE-CNT.                     
           MOVE +85                         TO PV-LINE-CNT.                     
                                                                                
           INITIALIZE                          PV-REP-RECORD.                   
           SET PS-FIRST-INPUT               TO TRUE                             
           PERFORM X100-READ-INPUT-RECORD.                                      
                                                                                
           INITIALIZE                          PV-HLD-RECORD.                   
           MOVE PV-REP-RECORD               TO PV-HLD-RECORD.                   
                                                                                
      *****************************************************************         
      * C100-PROCESS-ROUTINE                                          *         
      *****************************************************************         
       C100-PROCESS-ROUTINE.                                                    
                                                                                
           IF  PV-REP-BYR-NBR NOT = PV-HLD-BYR-NBR                              
              MOVE +85                      TO PV-LINE-CNT                      
           END-IF.                                                              
                                                                                
           INITIALIZE                          PV-HLD-RECORD.                   
           MOVE PV-REP-RECORD               TO PV-HLD-RECORD.                   
           PERFORM X400-LOAD-READ-RECORD.                                       
           PERFORM H300-PRINT-DETAIL-LINE.                                      
           INITIALIZE                          PV-REP-RECORD.                   
           PERFORM X100-READ-INPUT-RECORD.                                      
                                                                                
      *****************************************************************         
      *    CLOSE FILES AND DISPLAY COUNTS                             *         
      *****************************************************************         
       D100-EXIT-RTN.                                                           
                                                                                
           PERFORM W450-WRITE-END-OF-RPT-LINE.                                  
                                                                                
           CLOSE INPUT-FILE                                                     
                                                                                
           IF  INPUT-FILE-PS NOT = '00'                                         
               MOVE 'PEKRP095'        TO PC-CURRENT-PROGRAM-NAME                
               MOVE 'ERROR WHILE CLOSING INPUT-FILE'                            
                                           TO PV-OPERATION-MSG-1                
               STRING 'FILE STATUS = ' INPUT-FILE-PS                            
                   DELIMITED BY SIZE     INTO PV-OPERATION-MSG-2                
               END-STRING                                                       
               PERFORM Z100-ABEND                                               
           END-IF.                                                              
                                                                                
           CLOSE PERM-CLEARANCE-RPT                                             
                                                                                
           IF  REPORT-FILE-PS NOT = '00'                                        
               MOVE 'PEKRP095'             TO PC-CURRENT-PROGRAM-NAME           
               MOVE 'ERROR WHILE CLOSING REPORT-FILE-PS'                        
                                           TO PV-OPERATION-MSG-1                
               STRING 'FILE STATUS = '        REPORT-FILE-PS                    
                   DELIMITED BY SIZE     INTO PV-OPERATION-MSG-2                
               END-STRING                                                       
               PERFORM Z100-ABEND                                               
           END-IF                                                               
                                                                                
           DISPLAY ' '.                                                         
           DISPLAY ' RECORDS READ ..... ' PA-RECORDS-READ.                      
           DISPLAY ' RECORDS WRITTEN .. ' PA-RECORDS-WROTE.                     
           DISPLAY ' '.                                                         
                                                                                
      *****************************************************************         
      *   PROCESS REPORT PAGE HEADERS                                 *         
      *****************************************************************         
       H100-PROCESS-PAGE-HEADER.                                                
                                                                                
           MOVE ZERO                   TO PV-LINE-CNT.                          
           ADD  1                      TO PV-PAGE-CNT.                          
           MOVE PV-PAGE-CNT            TO DP200O-PAGE-NUMBER.                   
                                                                                
           MOVE 1                      TO DP200O-REPORT-NUMBER.                 
           MOVE DP200O-STANDRD-HEADER-200-COLS                                  
                                       TO REPORT-LINE.                          
                                                                                
           WRITE REPORT-LINE         FROM DP200O-STANDRD-HEADER-200-COLS        
                                    AFTER ADVANCING PAGE.                       
                                                                                
           WRITE REPORT-LINE         FROM HEADER-LINE-1                         
                                    AFTER ADVANCING 2.                          
                                                                                
           WRITE REPORT-LINE         FROM HEADER-LINE-2                         
                                    AFTER ADVANCING 2.                          
                                                                                
           MOVE PV-CURRENT-DATE-FMT    TO HL3-DATE-VAL.                         
           WRITE REPORT-LINE         FROM HEADER-LINE-3                         
                                    AFTER ADVANCING 2.                          
                                                                                
           WRITE REPORT-LINE         FROM PV-DETAL-NULL-LINE                    
                                    AFTER ADVANCING 1.                          
                                                                                
           WRITE REPORT-LINE         FROM DETAIL-HEAD1                          
                                    AFTER ADVANCING 2.                          
                                                                                
           WRITE REPORT-LINE         FROM DETAIL-HEAD2                          
                                    AFTER ADVANCING 1.                          
                                                                                
           WRITE REPORT-LINE         FROM DETAIL-HEAD3                          
                                    AFTER ADVANCING 1.                          
                                                                                
           WRITE REPORT-LINE         FROM DETAIL-HEAD4                          
                                    AFTER ADVANCING 1.                          
                                                                                
           WRITE REPORT-LINE         FROM DETAIL-HEAD-DASH                      
                                    AFTER ADVANCING 1.                          
                                                                                
           MOVE SPACES                 TO PV-DETAL-NULL-LINE                    
           WRITE REPORT-LINE         FROM PV-DETAL-NULL-LINE                    
                                    AFTER ADVANCING 1.                          
                                                                                
           ADD +15                     TO PV-LINE-CNT.                          
                                                                                
      *****************************************************************         
      *     PRINT OUT THE DETAIL LINE                                 *         
      *****************************************************************         
       H300-PRINT-DETAIL-LINE.                                                  
                                                                                
           PERFORM W300-WRITE-DETAIL-LINE.                                      
                                                                                
           ADD 1                       TO PA-RECORDS-WROTE.                     
           MOVE SPACES                 TO DETAIL-LINE.                          
                                                                                
      *****************************************************************         
      *     WRITE DETAIL LINE                                         *         
      *****************************************************************         
       W300-WRITE-DETAIL-LINE.                                                  
                                                                                
           IF (PV-LINE-CNT + 3) > PC-MAX-LINE-CNT                               
               PERFORM H100-PROCESS-PAGE-HEADER                                 
           END-IF.                                                              
                                                                                
           WRITE REPORT-LINE         FROM DETAIL-LINE                           
                                    AFTER 1.                                    
                                                                                
           ADD +1                      TO PV-LINE-CNT.                          
                                                                                
      *****************************************************************         
      *     WRITE END OF REPORT LINE                                  *         
      *****************************************************************         
       W450-WRITE-END-OF-RPT-LINE.                                              
                                                                                
           IF  PV-LINE-CNT >= 75                                                
               PERFORM H100-PROCESS-PAGE-HEADER                                 
               MOVE 3                  TO PV-ADVANCE-LINES                      
           ELSE                                                                 
               SUBTRACT 5            FROM PC-MAX-LINE-CNT                       
                                   GIVING PV-ADVANCE-CNT                        
               SUBTRACT PV-LINE-CNT  FROM PV-ADVANCE-CNT                        
                                   GIVING PV-ADVANCE-CNT                        
               MOVE PV-ADVANCE-CNT     TO PV-ADVANCE-LINES                      
                                                                                
           END-IF.                                                              
                                                                                
           WRITE REPORT-LINE         FROM END-OF-REPORT-LINE                    
                                    AFTER ADVANCING PV-ADVANCE-LINES.           
                                                                                
      *****************************************************************         
       X100-READ-INPUT-RECORD.                                                  
      *****************************************************************         
                                                                                
           READ INPUT-FILE             INTO PV-REP-RECORD                       
              AT END SET EOF-FILE        TO TRUE                                
           END-READ.                                                            
                                                                                
           EVALUATE INPUT-FILE-PS                                               
               WHEN '00'                                                        
               WHEN '10'                                                        
                    IF  EOF-FILE                                                
                        IF  PS-FIRST-INPUT                                      
                            DISPLAY '** NO INPUT RECORDS TO PROCESS **'         
                            PERFORM X200-PROCESS-NO-RECORDS                     
                        END-IF                                                  
                    ELSE                                                        
                       SET PS-NOT-FIRST-INPUT   TO TRUE                         
                       ADD 1              TO PA-RECORDS-READ                    
                    END-IF                                                      
               WHEN OTHER                                                       
                    MOVE 'PEKRP095'          TO PC-CURRENT-PROGRAM-NAME         
                    MOVE 'ERROR WHILE READING INPUT-FILE'                       
                                             TO PV-OPERATION-MSG-1              
                    STRING 'FILE STATUS = '     INPUT-FILE-PS                   
                        DELIMITED BY SIZE  INTO PV-OPERATION-MSG-2              
                    END-STRING                                                  
                    PERFORM Z100-ABEND                                          
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
       X200-PROCESS-NO-RECORDS.                                                 
      *****************************************************************         
                                                                                
           PERFORM  H100-PROCESS-PAGE-HEADER.                                   
           WRITE REPORT-LINE         FROM DETAIL-NO-DATA                        
                                    AFTER ADVANCING 2.                          
                                                                                
           ADD   +3                   TO PV-LINE-CNT.                           
                                                                                
      *****************************************************************         
       X400-LOAD-READ-RECORD.                                                   
      *****************************************************************         
           INITIALIZE                          PV-DET-BYR-NBR                   
                                               PV-DET-BYR-NM                    
                                               PV-DET-DEPT-NBR                  
                                               PV-DET-DEPT-NM                   
                                               PV-DET-SUB-CL-NBR                
                                               PV-DET-VS-NBR                    
                                               PV-DET-SKU-NBR                   
                                               PV-DET-SKU-STAT-CDE              
                                               PV-DET-SKU-DESC                  
                                               PV-DET-CSTM-CLOR-DESC            
                                               PV-DET-ONHAND-QTY                
                                               PV-DET-PO-NBR                    
                                               PV-DET-SHIP-BEF-DT               
                                               PV-DET-LAST-RCVD-DT              
                                               PV-DET-EXPT-DATE                 
                                               PV-DET-PRCHG-ID                  
                                               PV-DET-EFF-DTE                   
                                               PV-DET-ALL-RMNG-IND              
                                               PV-DET-REASON-CODE.              
           MOVE PV-HLD-BYR-NBR              TO PV-DET-BYR-NBR                   
           MOVE '-'                         TO PV-DET-BYR-FILLER                
           MOVE PV-HLD-BYR-NM               TO PV-DET-BYR-NM                    
           MOVE PV-HLD-DEPT-NBR             TO PV-DET-DEPT-NBR                  
           MOVE '-'                         TO PV-DET-DEPT-FILLER               
           MOVE PV-HLD-DEPT-NM              TO PV-DET-DEPT-NM                   
           MOVE PV-HLD-SUB-CL-NBR           TO PV-DET-SUB-CL-NBR                
           MOVE PV-HLD-VS-NBR               TO PV-DET-VS-NBR                    
           MOVE PV-HLD-SKU-NBR              TO PV-DET-SKU-NBR                   
           MOVE PV-HLD-SKU-STAT-CDE         TO PV-DET-SKU-STAT-CDE              
           MOVE PV-HLD-SKU-DESC             TO PV-DET-SKU-DESC                  
           MOVE PV-HLD-CSTM-CLOR-DESC       TO PV-DET-CSTM-CLOR-DESC            
           MOVE PV-HLD-ONHAND-QTY           TO PV-DET-ONHAND-QTY                
           MOVE PV-HLD-PO-NBR               TO PV-DET-PO-NBR                    
           MOVE PV-HLD-SHIP-BEF-DT          TO PV-DET-SHIP-BEF-DT               
           MOVE PV-HLD-LAST-RCVD-DT         TO PV-DET-LAST-RCVD-DT              
           MOVE PV-HLD-EXPT-DATE            TO PV-DET-EXPT-DATE                 
           MOVE PV-HLD-PRCHG-ID             TO PV-DET-PRCHG-ID                  
           MOVE PV-HLD-EFF-DTE              TO PV-DET-EFF-DTE                   
           MOVE PV-HLD-ALL-RMNG-IND         TO PV-DET-ALL-RMNG-IND              
           MOVE PV-HLD-REASON-CODE          TO PV-DET-REASON-CODE.              
                                                                                
      ************************************************************              
      * Z100-ABEND.                                                             
      *     PERFORMS A NON-SQL-ABEND.                                           
      ************************************************************              
       Z100-ABEND.                                                              
                                                                                
           DISPLAY '** ABEND           **'.                                     
           DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.          
           DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.                
           DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.               
           DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.               
                                                                                
           CALL 'ILBOABN0' USING ABEND-CODE.                                    
      ************************************************************              
