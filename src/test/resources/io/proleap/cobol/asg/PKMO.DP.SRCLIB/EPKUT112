000100 IDENTIFICATION DIVISION.                                         00010099
000200 PROGRAM-ID.      EPKUT112.                                       00020099
000300 AUTHOR.          JOSEPH MENYAH.                                  00030099
000400 DATE-WRITTEN.    DECEMBER 26, 2002.                              00040099
000500                                                                  00050099
000600*-----------------------------------------------------------      00060099
000700*              FULL FILE EXTRACT                                  00070099
000800*-----------------------------------------------------------      00080099
000900*-----------------------------------------------------------      00090099
001000* HISTORY LOG:                                                    00100099
001100*-----------------------------------------------------------      00110099
001200* DATE: 07/26/2004                                                00120099
001300* WR/IR#: IR#00675107                                             00130099
001400* PROGRAMMER: SCOTT BARTELT                                       00140099
001500* DESCRIPTION: THE ADHOC CURSOR IS NOT CHECKING TO SEE IF THE     00150099
001510*  STORE IS IN A 'SCHEDULED' STATUS WITHIN THE ADHOC STORE        00151099
001520*  GROUP I.D.                                                     00152099
001600*                                                                 00160099
CHG137* DATE: 09/16/2016                                                00161099
CHG137* WR/IR#: CHG0151377                                              00162099
CHG137* PROGRAMMER:  COGNIZANT                                          00163099
CHG137* DESCRIPTION: INCLUDED A CONDITION IN 3300-FORMAT-STORE-NBR      00164099
CHG137*  TO SELECT STR_GP_ID WITH NULL EFF_END_DTE.                     00165099
001700*----------------------------------------------------------       00170099
001800 ENVIRONMENT DIVISION.                                            00180099
001900*----------------------------------------------------------       00190099
002000 CONFIGURATION SECTION.                                           00200099
002100 SOURCE-COMPUTER.        IBM-3090.                                00210099
002200 OBJECT-COMPUTER.        IBM-3090.                                00220099
002210                                                                  00221099
002220 INPUT-OUTPUT SECTION.                                            00222099
002230                                                                  00223099
002240 FILE-CONTROL.                                                    00224099
002250                                                                  00225099
002251     SELECT CONTROL-CARD-FOR-RESTART                              00225199
002252       ASSIGN TO UPD01.                                           00225299
002253     SELECT CONTROL-CARD-CURR-BATCH-DTE                           00225399
002254       ASSIGN TO INP02.                                           00225499
002255     SELECT CONTROL-CARD-BATCH-FUTURE-DTE                         00225599
002256       ASSIGN TO INP03.                                           00225699
002257     SELECT DAYS-FILE                                             00225799
002258       ASSIGN TO INP04.                                           00225899
002259     SELECT PROMO-INTFC-FILE                                      00225999
002260       ASSIGN TO OUT01.                                           00226099
002270                                                                  00227099
002280 DATA DIVISION.                                                   00228099
002290 FILE SECTION.                                                    00229099
002300                                                                  00230099
002400 FD  CONTROL-CARD-FOR-RESTART                                     00240099
002500     RECORDING MODE F                                             00250099
002600     BLOCK CONTAINS 0 RECORDS                                     00260099
002700     LABEL RECORDS ARE OMITTED                                    00270099
002800     DATA RECORD IS CONTROL-CARD-FOR-RESTART-REC.                 00280099
002900 01  CONTROL-CARD-FOR-RESTART-REC              PIC  X(080).       00290099
003000                                                                  00300099
003001 FD  CONTROL-CARD-CURR-BATCH-DTE                                  00300199
003002     RECORDING MODE F                                             00300299
003003     BLOCK CONTAINS 0 RECORDS                                     00300399
003004     LABEL RECORDS ARE OMITTED                                    00300499
003005     DATA RECORD IS CNTRL-CARD-CURR-BATCH-DTE-REC.                00300599
003006 01  CNTRL-CARD-CURR-BATCH-DTE-REC             PIC  X(080).       00300699
003007                                                                  00300799
003008 FD  CONTROL-CARD-BATCH-FUTURE-DTE                                00300899
003009     RECORDING MODE F                                             00300999
003010     BLOCK CONTAINS 0 RECORDS                                     00301099
003020     LABEL RECORDS ARE OMITTED                                    00302099
003030     DATA RECORD IS CONTROL-CARD-BATCH-FUTURE-REC.                00303099
003040 01  CONTROL-CARD-BATCH-FUTURE-REC             PIC  X(080).       00304099
003050                                                                  00305099
003060 FD  PROMO-INTFC-FILE                                             00306099
003070     RECORDING MODE F                                             00307099
003080     BLOCK CONTAINS 0 RECORDS                                     00308099
003090     LABEL RECORDS ARE OMITTED                                    00309099
003100     DATA RECORD IS PROMO-INTFC-ID-RECORD.                        00310099
003200 01  PROMO-INTFC-RECORD                        PIC  X(200).       00320099
003300                                                                  00330099
003400 FD  DAYS-FILE                                                    00340099
003500     RECORDING MODE F                                             00350099
003600     BLOCK CONTAINS 0 RECORDS                                     00360099
003700     LABEL RECORDS ARE STANDARD.                                  00370099
003800                                                                  00380099
003900 01  DAYS-REC                                  PIC  X(080).       00390099
004000                                                                  00400099
004100 WORKING-STORAGE SECTION.                                         00410099
004200*-----------------------------------------------------------      00420099
004300* PS-PROGRAM SWITCHES                                             00430099
004400*-----------------------------------------------------------      00440099
004500 01  PS-PROGRAM-SWITCHES.                                         00450099
004600     05  PS-STOREGP-RMS-CSR-EOF-SW             PIC  X(001).       00460099
004700       88  PS-STOREGP-RMS-CSR-EOF                VALUE 'Y'.       00470099
004800       88  PS-STOREGP-RMS-CSR-NOT-EOF            VALUE 'N'.       00480099
004900     05  PS-STOREGP-ADHOC-CSR-EOF-SW           PIC  X(001).       00490099
005000       88  PS-STOREGP-ADHOC-CSR-EOF              VALUE 'Y'.       00500099
005100       88  PS-STOREGP-ADHOC-CSR-NOT-EOF          VALUE 'N'.       00510099
005800     05 PS-FILE-STATUS                         PIC  X(002).       00580099
005900       88  PS-SUCCESSFUL-COMPLETION              VALUE '00'.      00590099
006000       88  PS-END-OF-FILE                        VALUE '10'.      00600099
006100       88  PS-SUCCESSFUL-OPEN                    VALUE '97'.      00610099
006200     05  PS-END-OF-CNTL-CRD-SW                 PIC  X(001).       00620099
006300       88  PS-END-OF-CNTL-CRD-FILE               VALUE 'Y'.       00630099
006400       88  PS-NOT-END-OF-CNTL-CRD-FILE           VALUE 'N'.       00640099
006500     05  PS-END-OF-RESTART-CD-SW               PIC  X(001).       00650099
006600       88  PS-END-OF-RESTART-CARD                VALUE 'N'.       00660099
006700       88  PS-NOT-END-OF-RESTART-CARD            VALUE 'Y'.       00670099
006800                                                                  00680099
006900*-----------------------------------------------------------      00690099
007000* PROGRAM CONSTANTS                                               00700099
007100*-----------------------------------------------------------      00710099
007200 01  PC-PROGRAM-CONSTANTS.                                        00720099
007210     05  PC-CURRENT-PROGRAM-NAME               PIC  X(008)        00721099
007220       VALUE 'EPKUT112'.                                          00722099
007230     05  PC-STORE-NBR                          PIC  X(004).       00723099
007240     05  PC-STR-GRP-AD-IND                     PIC  X(001).       00724099
007250       88  PC-RMS-STR-GRP                        VALUE 'S'.       00725099
007260       88  PC-ADHOC-STR-GRP                      VALUE 'A'.       00726099
007270     05  PC-PRICING-BUS-EVENT                  PIC  X(003)        00727099
007280       VALUE '090'.                                               00728099
007290     05  PC-RMS-PRC-SETUP-IND                  PIC  X(001)        00729099
007300       VALUE 'R'.                                                 00730099
007400     05  PC-ADHOC-PRC-SETUP-IND                PIC  X(001)        00740099
007500       VALUE 'A'.                                                 00750099
007600     05  PC-ADHOC-STR-GRP-TYP-CDE              PIC  X(005)        00760099
007700       VALUE '99999'.                                             00770099
007800     05  PC-STORE-LEVEL-CDE                    PIC  X(004)        00780099
007900       VALUE '5000'.                                              00790099
008000     05  PC-FILE-ACT-TYPE                      PIC  X(003)        00800099
008100       VALUE 'FUL'.                                               00810099
008200     05  PC-APPLY-NIGHTLY                      PIC  X(001)        00820099
008300       VALUE 'N'.                                                 00830099
008400     05  PC-ADD-STAT-CDE                       PIC  X(001)        00840099
008500       VALUE 'A'.                                                 00850099
008600     05  PC-DELETE-STAT-CDE                    PIC  X(001)        00860099
008700       VALUE 'D'.                                                 00870099
008800     05  PC-MDSE-INCL-IND                      PIC  X(001)        00880099
008900       VALUE 'B'.                                                 00890099
009000                                                                  00900099
009100*-----------------------------------------------------------      00910099
009200* PV- PROGRAM VARIABLES                                           00920099
009300*-----------------------------------------------------------      00930099
009400 01  PV-PROGRAM-VARAIBLES.                                        00940099
009500     05  PV-SQL-SUB                            PIC S9(004)        00950099
009600                                                 VALUE +0         00960099
009700                                                 COMP.            00970099
009800     05  PV-STR-NBR                            PIC S9(004)        00980099
009900                                                 VALUE +0         00990099
010000                                                 COMP.            01000099
010100     05  PV-PROMO-INTFC-ID                     PIC S9(009)        01010099
010110                                                 COMP.            01011099
010120     05  PV-MDSE-LNE-ID                        PIC S9(009)        01012099
010121                                                 COMP.            01012199
010122     05  PV-STR-GRP-TYP-CDE                    PIC S9(004)        01012299
010123                                                 COMP.            01012399
010124     05  PV-STR-GRP-ID                         PIC S9(010)V       01012499
010125                                                 COMP-3.          01012599
010126     05  PV-PRICG-TYP-CDE                      PIC  X(003)        01012699
010127                                                 VALUE SPACES.    01012799
010128     05  PV-INCLUDE-QUERY                      PIC  X(001)        01012899
010129                                                 VALUE SPACES.    01012999
010130     05  PV-ACTL-STRT-TMST                     PIC  X(026)        01013099
010131                                                 VALUE SPACES.    01013199
010132     05  PV-ACTL-END-TMST                      PIC  X(026)        01013299
010133                                                 VALUE SPACES.    01013399
010134     05  PV-SOR-LAST-UPD-TMST                  PIC  X(026)        01013499
010135                                                 VALUE SPACES.    01013599
010136     05  PV-EFF-STRT-TMST                      PIC  X(026)        01013699
010137                                                 VALUE SPACES.    01013799
010138     05  PV-EFF-END-TMST                       PIC  X(026)        01013899
010139                                                 VALUE SPACES.    01013999
010140     05  PV-EFF-END-NULL                       PIC S9(004)        01014099
010141                                                 VALUE ZEROS      01014199
010142                                                 COMP.            01014299
010143     05  PV-ABEND-CODE                         PIC  9(004)        01014399
010144                                                 VALUE ZEROS      01014499
010145                                                 COMP.            01014599
010146     05  PV-FUL-FILE-STR                       PIC  9(005)        01014699
010147                                                 VALUE ZEROS.     01014799
010148     05  DATE-STORE-WILL-OPEN                  PIC X(010)         01014899
010149                                                 VALUE SPACES.    01014999
010150     05  EP107-CC-CRNT-DTE-MINUS1              PIC X(010)         01015099
010160                                                 VALUE SPACES.    01016099
010161     05  EP111-CC-DATE-PLUS1                   PIC X(010)         01016199
010162                                                 VALUE SPACES.    01016299
010163*----------------------------------------------------------       01016399
010164* ADVANCE DAYS INPUT FILE.                                        01016499
010165*----------------------------------------------------------       01016599
010166     COPY EPRD045.                                                01016699
010167                                                                  01016799
010168*----------------------------------------------------------       01016899
010169* FULL FILE EXTRACT OUTPUT FILE.                                  01016999
010170*----------------------------------------------------------       01017099
010180     COPY EPRD072.                                                01018099
010190                                                                  01019099
010200*----------------------------------------------------------       01020099
010300* EPCC106 CONTROL CARD LAYOUT - RESTART INFORMATION               01030099
010400*----------------------------------------------------------       01040099
010500     COPY EPRD106.                                                01050099
010600                                                                  01060099
010700*----------------------------------------------------------       01070099
010800* EPCC107 CONTROL CARD LAYOUT - CURRENT BATCH FUTURE DATE         01080099
010900*----------------------------------------------------------       01090099
011000     COPY EPRD107.                                                01100099
011100                                                                  01110099
011200*----------------------------------------------------------       01120099
011300* EPCC111 CONTROL CARD LAYOUT - CURRENT BATCH DATE                01130099
011400*----------------------------------------------------------       01140099
011500     COPY EPRD111.                                                01150099
011600                                                                  01160099
011700*----------------------------------------------------------       01170099
011800* DATE ROUTINE COPY MEMBERS                                       01180099
011900*----------------------------------------------------------       01190099
012000     COPY DPWS500.                                                01200099
012100                                                                  01210099
012200*-----------------------------------------------------------      01220099
012300* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         01230099
012400*-----------------------------------------------------------      01240099
012500     COPY DPWS004.                                                01250099
012600                                                                  01260099
012700*-----------------------------------------------------------      01270099
012800* DB2 ABEND COPYBOOK                                              01280099
012900*-----------------------------------------------------------      01290099
013000     COPY DPWS900.                                                01300099
013100                                                                  01310099
013200*-----------------------------------------------------------      01320099
013300* DB2 MESSAGE AREA                                                01330099
013400*-----------------------------------------------------------      01340099
013500     COPY SQLCA2.                                                 01350099
013600                                                                  01360099
013700*-----------------------------------------------------------      01370099
013800* PROGRAM COUNTERS                                                01380099
013900*-----------------------------------------------------------      01390099
014000 01  PC-PROGRAM-COUNTERS.                                         01400099
014100     05  PC-CNT-READ-RECS                      PIC  9(009)        01410099
014200                                                 VALUE 0.         01420099
014300     05  PC-CNT-PROMO-RECS                     PIC  9(009)        01430099
014400                                                 VALUE 0.         01440099
014500     05  PC-CNT-RESTRT-RECS                    PIC  9(009)        01450099
014600                                                 VALUE 0.         01460099
014700     05  PC-CNT-ERROR-RECS                     PIC  9(009)        01470099
014710                                                 VALUE 0.         01471099
014720     05  PC-CNT-ALL-RECS                       PIC  9(009)        01472099
014730                                                 VALUE 0.         01473099
014740     05  PC-CNT-SPACES                         PIC  9(009)        01474099
014750                                                 VALUE 0.         01475099
014760     05  PC-CNT-EXCL-CHECK                     PIC  9(009)        01476099
014770                                                 VALUE 0.         01477099
014780     05  PC-MAX-RETRIES                        PIC S9(004)        01478099
014790                                                 VALUE +5         01479099
014800                                                 COMP.            01480099
014900                                                                  01490099
015000*-----------------------------------------------------------      01500099
015100* ERROR HANDLING                                                  01510099
015200*-----------------------------------------------------------      01520099
015300 01  PV-MISC-ABEND-FIELDS.                                        01530099
015400     05  PV-PARAGRAPH-NAME                     PIC  X(030)        01540099
015500                                                 VALUE SPACE.     01550099
015600     05  PV-OPERATION-MSG-1                    PIC  X(040)        01560099
015700                                                 VALUE SPACE.     01570099
015800     05  PV-OPERATION-MSG-2                    PIC  X(040)        01580099
015900                                                 VALUE SPACE.     01590099
016000     05  PV-DB2-OPERATION                      PIC  X(030)        01600099
016100                                                 VALUE SPACE.     01610099
016200 01  ABEND-CODE                                PIC S9(004)        01620099
016210                                                 VALUE ZEROS      01621099
016220                                                 COMP             01622099
016230                                                 SYNC.            01623099
016240   88  ABEND-4003-CTRL-CARD-ERROR                VALUE +4003.     01624099
016250   88  ABEND-4013-DB2-ERROR                      VALUE +4013.     01625099
016260   88  ABEND-4019-CAL-SUB-ERROR                  VALUE +4019.     01626099
016270   88  ABEND-4020-MQ-ERROR                       VALUE +4020.     01627099
016280   88  ABEND-4444-FORCED-ABEND                   VALUE +4444.     01628099
016290   88  ABEND-4008                                VALUE +4008.     01629099
016300                                                                  01630099
016400*-----------------------------------------------------------      01640099
016500* DB2 COMMUNICATIONS AREA                                         01650099
016600*-----------------------------------------------------------      01660099
016700     EXEC SQL                                                     01670099
016800       INCLUDE SQLCA                                              01680099
016900     END-EXEC.                                                    01690099
017000                                                                  01700099
017100*-----------------------------------------------------------      01710099
017200* DB2 TABLE EPT00010(EPT_STR_FIL_RFRSH) STORE FILE REFRESH        01720099
017300*-----------------------------------------------------------      01730099
017400     EXEC SQL                                                     01740099
017500       INCLUDE EPT00010                                           01750099
017600     END-EXEC.                                                    01760099
017700                                                                  01770099
017800*-----------------------------------------------------------      01780099
017900* DB2 TABLE XST00001(XST_LOC) - LOCATION TABLE                    01790099
018000*-----------------------------------------------------------      01800099
018100     EXEC SQL                                                     01810099
018200       INCLUDE XST00001                                           01820099
018201     END-EXEC.                                                    01820199
018202                                                                  01820299
018203*-----------------------------------------------------------      01820399
018204* DB2 TABLE XST00023(XST_STR_GP_MBSHP) STORE GROUP MEMBERSHIP     01820499
018205*-----------------------------------------------------------      01820599
018206     EXEC SQL                                                     01820699
018207       INCLUDE XST00023                                           01820799
018208     END-EXEC.                                                    01820899
018209                                                                  01820999
018210*-----------------------------------------------------------      01821099
018220* DB2 TABLE XST00028(XST_MDSE_LNE_SELN) - MERCHANDISE TABLE       01822099
018230*-----------------------------------------------------------      01823099
018240     EXEC SQL                                                     01824099
018250       INCLUDE XST00028                                           01825099
018260     END-EXEC.                                                    01826099
018270                                                                  01827099
018280*-----------------------------------------------------------      01828099
018290* DB2 TABLE XST00029(XST_PROMO_STR_GP) - STORE ZONE PRICING       01829099
018300*                                               TABLE             01830099
018400*-----------------------------------------------------------      01840099
018500     EXEC SQL                                                     01850099
018600       INCLUDE XST00029                                           01860099
018700     END-EXEC.                                                    01870099
018800                                                                  01880099
018900*-----------------------------------------------------------      01890099
019000* DB2 TABLE XST00031(XST_PROMO_ADHC_RLT) ADHOC RELATION           01900099
019100*-----------------------------------------------------------      01910099
019200     EXEC SQL                                                     01920099
019300       INCLUDE XST00031                                           01930099
019400     END-EXEC.                                                    01940099
019500                                                                  01950099
019600*-----------------------------------------------------------      01960099
019700* DB2 TABLE XST00033(XST_PROMO_ADHC_STR) ADHOC STR RELATION       01970099
019800*-----------------------------------------------------------      01980099
019900     EXEC SQL                                                     01990099
020000       INCLUDE XST00033                                           02000099
020100     END-EXEC.                                                    02010099
020200                                                                  02020099
020300*-----------------------------------------------------------      02030099
020400* STORE GROUP INTERFACE ID INCLUDE CURSOR. (RMS)                  02040099
020500*-----------------------------------------------------------      02050099
020600     EXEC SQL                                                     02060099
020700       DECLARE STOREGP-ID-RMS CURSOR FOR                          02070099
020800         SELECT RFRSH.STR_NBR                                     02080099
020900               ,STRGP.PROMO_INTFC_ID                              02090099
021000               ,STRGP.MDSE_LNE_ID                                 02100099
021100               ,STRGP.STR_GP_TYP_CDE                              02110099
021200               ,STRGP.STR_GP_ID                                   02120099
021300               ,STRGP.STR_SELN_HIER_CDE                           02130099
021400               ,STRGP.ACTL_STRT_TMST                              02140099
021500               ,STRGP.ACTL_END_TMST                               02150099
021600               ,STRGP.SOR_LAST_UPD_TMST                           02160099
021700               ,MDSSEL.PRICG_TYP_CDE                              02170099
021710         FROM EPT_STR_FIL_RFRSH  RFRSH                            02171099
021720             ,XST_LOC            LOC                              02172099
021730             ,XST_STR_GP_MBSHP   STRMB                            02173099
021740             ,XST_PROMO_STR_GP   STRGP                            02174099
021750             ,XST_MDSE_LNE_SELN  MDSSEL                           02175099
021751         WHERE RFRSH.STR_NBR        = LOC.LOC_NBR                 02175199
021752           AND LOC.LOC_NBR          = STRMB.STR_NBR               02175299
021753           AND STRMB.STR_GP_TYP_CDE = STRGP.STR_GP_TYP_CDE        02175399
021754           AND STRMB.STR_GP_ID      = STRGP.STR_GP_ID             02175499
021755           AND STRGP.PROMO_INTFC_ID = MDSSEL.PROMO_INTFC_ID       02175599
021756           AND STRGP.MDSE_LNE_ID    = MDSSEL.MDSE_LNE_ID          02175699
021757           AND STRGP.STAT_CDE  IN ('S')                           02175799
021758           AND MDSSEL.STAT_CDE IN ('S')                           02175899
021759           AND RFRSH.RFRSH_TYP_CDE = 'PR'                         02175999
021760           AND RFRSH.STR_NBR >= :EPT00010-STR-NBR                 02176099
021761           AND (RFRSH.RFRSH_DTE = :EP111-CC-CRNT-DTE              02176199
021762           OR  RFRSH.RFRSH_DTE IS NULL)                           02176299
021763                                                                  02176399
021764           AND ((:EP111-CC-DATE-PLUS1                             02176499
021765               BETWEEN LOC.OPN_DTE AND LOC.CLO_DTE)               02176599
021766           OR  (:DATE-STORE-WILL-OPEN                             02176699
021767               BETWEEN LOC.OPN_DTE AND LOC.CLO_DTE))              02176799
021768                                                                  02176899
021769           AND ((DATE(STRGP.ACTL_STRT_TMST)                       02176999
021770               BETWEEN STRMB.EFF_BEG_DTE                          02177099
021771                   AND STRMB.EFF_END_DTE)                         02177199
021772           OR  (DATE(STRGP.ACTL_STRT_TMST) >= STRMB.EFF_BEG_DTE   02177299
021773           AND STRMB.EFF_END_DTE IS NULL)                         02177399
021774           OR  (LOC.OPN_DTE > DATE(STRGP.ACTL_STRT_TMST)))        02177499
021775                                                                  02177599
021776           AND ((:EP111-CC-CRNT-DTE                               02177699
021777               BETWEEN DATE(STRGP.ACTL_STRT_TMST)                 02177799
021778                   AND DATE(STRGP.ACTL_END_TMST))                 02177899
021779           OR  (DATE(STRGP.ACTL_STRT_TMST)                        02177999
021780               BETWEEN :EP111-CC-DATE-PLUS1                       02178099
021781                   AND :EP107-CC-CRNT-DTE-MINUS1))                02178199
021800           AND :EP111-CC-CRNT-DTE < DATE(STRGP.ACTL_END_TMST)     02180099
021801                                                                  02180199
021802         ORDER BY RFRSH.STR_NBR, STRGP.PROMO_INTFC_ID,            02180299
021803                  STRGP.MDSE_LNE_ID                               02180399
021804         FOR FETCH ONLY                                           02180499
021805         WITH UR                                                  02180599
021806     END-EXEC.                                                    02180699
021807                                                                  02180799
021808*-----------------------------------------------------------      02180899
021809* STORE GROUP INTERFACE ID ADHOC CURSOR.                          02180999
021810*-----------------------------------------------------------      02181099
021811     EXEC SQL                                                     02181199
021820       DECLARE STOREGP-ADHOC CURSOR FOR                           02182099
021830         SELECT RFRSH.STR_NBR                                     02183099
021840               ,ADHOC.PROMO_INTFC_ID                              02184099
021850               ,ADHOC.MDSE_LNE_ID                                 02185099
021860               ,ADHOC.ADHC_STR_GP_ID                              02186099
021870               ,ADHOC.STR_SELN_HIER_CDE                           02187099
021871               ,ADHOC.ACTL_STRT_TMST                              02187199
021872               ,ADHOC.ACTL_END_TMST                               02187299
021873               ,ADHOC.SOR_LAST_UPD_TMST                           02187399
021874               ,ADHCS.EFF_STRT_TMST                               02187499
021875               ,ADHCS.EFF_END_TMST                                02187599
021876               ,MDSSEL.PRICG_TYP_CDE                              02187699
021877               ,STRMB.STR_GP_ID                                   02187799
021878         FROM EPT_STR_FIL_RFRSH  RFRSH                            02187899
021879             ,XST_LOC            LOC                              02187999
021880             ,XST_PROMO_ADHC_RLT ADHOC                            02188099
021881             ,XST_PROMO_ADHC_STR ADHCS                            02188199
021882             ,XST_MDSE_LNE_SELN  MDSSEL                           02188299
021883             ,XST_STR_GP_MBSHP   STRMB                            02188399
021884         WHERE RFRSH.STR_NBR        = LOC.LOC_NBR                 02188499
021885           AND LOC.LOC_NBR          = STRMB.STR_NBR               02188599
021886           AND STRMB.STR_NBR        = ADHCS.STR_NBR               02188699
021887           AND ADHOC.ADHC_STR_GP_ID = ADHCS.ADHC_STR_GP_ID        02188799
021888           AND ADHOC.PROMO_INTFC_ID = MDSSEL.PROMO_INTFC_ID       02188899
021889           AND ADHOC.MDSE_LNE_ID    = MDSSEL.MDSE_LNE_ID          02188999
021890           AND ADHOC.STAT_CDE  IN ('S')                           02189099
021891           AND MDSSEL.STAT_CDE IN ('S')                           02189199
021892           AND ADHCS.STAT_CDE  IN ('S')                           02189299
021893           AND RFRSH.RFRSH_TYP_CDE = 'PR'                         02189399
021894           AND RFRSH.STR_NBR >= :EPT00010-STR-NBR                 02189499
021895           AND STRMB.STR_GP_TYP_CDE = 5000                        02189599
021896           AND (RFRSH.RFRSH_DTE = :EP111-CC-CRNT-DTE              02189699
021897           OR   RFRSH.RFRSH_DTE IS NULL)                          02189799
021898                                                                  02189899
021899           AND ((:EP111-CC-DATE-PLUS1                             02189999
021900               BETWEEN LOC.OPN_DTE AND LOC.CLO_DTE)               02190099
021901           OR  (:DATE-STORE-WILL-OPEN                             02190199
021902               BETWEEN LOC.OPN_DTE AND LOC.CLO_DTE))              02190299
021903                                                                  02190399
021904           AND ((DATE(ADHOC.ACTL_STRT_TMST)                       02190499
021905               BETWEEN DATE(ADHCS.EFF_STRT_TMST)                  02190599
021906                   AND DATE(ADHCS.EFF_END_TMST))                  02190699
021907           OR  (DATE(ADHOC.ACTL_STRT_TMST) >=                     02190799
021908               DATE(ADHCS.EFF_STRT_TMST)                          02190899
021909           AND DATE(ADHCS.EFF_END_TMST)IS NULL)                   02190999
021910           OR  (LOC.OPN_DTE > DATE(ADHOC.ACTL_STRT_TMST)))        02191099
021911                                                                  02191199
021912           AND ((:EP111-CC-CRNT-DTE                               02191299
021913               BETWEEN DATE(ADHOC.ACTL_STRT_TMST)                 02191399
021914                   AND DATE(ADHOC.ACTL_END_TMST))                 02191499
021915           OR  (DATE(ADHOC.ACTL_STRT_TMST)                        02191599
021920               BETWEEN :EP111-CC-DATE-PLUS1                       02192099
021921                   AND :EP107-CC-CRNT-DTE-MINUS1))                02192199
021922                                                                  02192299
021923         ORDER BY RFRSH.STR_NBR, ADHOC.PROMO_INTFC_ID,            02192399
021924                  ADHOC.MDSE_LNE_ID                               02192499
021925         FOR FETCH ONLY                                           02192599
021926         WITH UR                                                  02192699
021927     END-EXEC.                                                    02192799
021928                                                                  02192899
021929 LINKAGE SECTION.                                                 02192999
021930                                                                  02193099
021931*----------------------------------------------------------       02193199
021940 PROCEDURE DIVISION.                                              02194099
021950*----------------------------------------------------------       02195099
021951 0000-MAINLINE.                                                   02195199
021952                                                                  02195299
021953     PERFORM 1000-INITIALIZATION.                                 02195399
021954                                                                  02195499
021955     PERFORM 2000-PROCESS-STORES.                                 02195599
021956                                                                  02195699
021957     PERFORM 9999-WRAPUP.                                         02195799
021958                                                                  02195899
021959     GOBACK.                                                      02195999
021960                                                                  02196099
021970*0000-EXIT.                                                       02197099
021980 EJECT.                                                           02198099
021990                                                                  02199099
022000*----------------------------------------------------------       02200099
022100* 1000-INITIALIZATION.                                            02210099
022200*     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS      02220099
022300*     FILES, READS INPUT FILES, AND PROCESSES ANY INPUT FILE      02230099
022400*     PARAMETERS IT MAY NEED TO USE TO READ THE PROMO             02240099
022500*     INTERFACE ID FILE.                                          02250099
022600*----------------------------------------------------------       02260099
022700 1000-INITIALIZATION.                                             02270099
022800                                                                  02280099
022900     OPEN INPUT  CONTROL-CARD-FOR-RESTART                         02290099
023000                 CONTROL-CARD-CURR-BATCH-DTE                      02300099
023100                 CONTROL-CARD-BATCH-FUTURE-DTE                    02310099
023200                 DAYS-FILE.                                       02320099
023300     OPEN OUTPUT PROMO-INTFC-FILE.                                02330099
023400                                                                  02340099
023500     PERFORM 1010-READ-RESTART-CONTROL-CARD                       02350099
023600       UNTIL PS-END-OF-RESTART-CARD.                              02360099
023700     PERFORM 1020-READ-CURR-BATCH-DTE-CARD.                       02370099
023800     PERFORM 1030-READ-CURR-BTCH-FUTRE-CARD.                      02380099
023900     PERFORM 1040-READ-DAYS-FILE.                                 02390099
024000     PERFORM 6100-DATE-ROUTINE.                                   02400099
024100     CLOSE CONTROL-CARD-FOR-RESTART.                              02410099
024200     OPEN OUTPUT CONTROL-CARD-FOR-RESTART.                        02420099
024300                                                                  02430099
024400*1000-EXIT.                                                       02440099
024500 EJECT.                                                           02450099
024600                                                                  02460099
024700*----------------------------------------------------------       02470099
024800* 1010-READ-RESTART-CONTROL-CARD.                                 02480099
024900*     READ RESTART CONTROL CARD. THIS DETERMINES IF THIS IS       02490099
025000*     AN INITAL RUN OF THE PROGRAM OR A RESTART. IF A RESTART,    02500099
025100*     THIS CARD WILL CONTAIN THE LAST STORE NUMBER THAT WAS       02510099
025110*     PROCESSED, WHICH WILL BE USED AS THE BEGINING STORE.        02511099
025120*     AN INITAL RUN OF THE PROGRAM OR A RESTART. IF A RESTART     02512099
025130*     THIS CARD WILL CONTAIN THE ENDING STORE NUMBER.             02513099
025200*----------------------------------------------------------       02520099
025300 1010-READ-RESTART-CONTROL-CARD.                                  02530099
025400                                                                  02540099
025410     SET PS-NOT-END-OF-RESTART-CARD TO TRUE                       02541099
025420                                                                  02542099
025500     READ CONTROL-CARD-FOR-RESTART                                02550099
025600                               INTO EP106-PROMO-RESTART-REC       02560099
025700       AT END                                                     02570099
025800         SET PS-END-OF-RESTART-CARD TO TRUE                       02580099
025900     END-READ.                                                    02590099
026000                                                                  02600099
026100     IF PS-NOT-END-OF-RESTART-CARD                                02610099
026200       ADD 1 TO PC-CNT-READ-RECS                                  02620099
026300     END-IF.                                                      02630099
026310                                                                  02631099
026400     IF EP106-JOB-RUN-TYP-IND = SPACES AND                        02640099
026410        EP106-FULL-FILE-STR   = ZEROS AND                         02641099
026420        EP106-STR-GRP-AD-IND  = SPACES                            02642099
026500          DISPLAY ' '                                             02650099
026600          DISPLAY '** ABEND     **'                               02660099
026700          DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME   02670099
026800          DISPLAY '** PARAGRAPH **  = 1010-READ-PGM-LAST-RUN-CARD'02680099
026900          DISPLAY '** RESTART CNTRL FILE IS EMPTY  '              02690099
027000          DISPLAY ' '                                             02700099
027100          MOVE +4002 TO ABEND-CODE                                02710099
027200          CALL 'ILBOABN0' USING ABEND-CODE                        02720099
027300     END-IF.                                                      02730099
027800                                                                  02780099
027900*1010-EXIT.                                                       02790099
028000 EJECT.                                                           02800099
028100                                                                  02810099
028200*----------------------------------------------------------       02820099
028210* 1020-READ-CURR-BATCH-DTE-CARD.                                  02821099
028220*     READ CONTROL CARD.  THIS GETS THE PROMO INTERFACE           02822099
028230*     ID'S IT NEEDS TO PROCESS.                                   02823099
028240*----------------------------------------------------------       02824099
028250 1020-READ-CURR-BATCH-DTE-CARD.                                   02825099
028260                                                                  02826099
028270     READ CONTROL-CARD-CURR-BATCH-DTE                             02827099
028280                                  INTO EP111-CC-CONTROL-CARD      02828099
028290       AT END                                                     02829099
028300         SET PS-END-OF-CNTL-CRD-FILE TO TRUE                      02830099
028301     END-READ.                                                    02830199
028302                                                                  02830299
028303     IF PS-END-OF-CNTL-CRD-FILE                                   02830399
028304       DISPLAY ' '                                                02830499
028305       DISPLAY '** ABEND     **'                                  02830599
028306       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      02830699
028307       DISPLAY '** PARAGRAPH **  = 1020-READ-CURR-BATCH-DTE-CARD' 02830799
028308       DISPLAY '** CURR BATCH DATE CRD IS EMPTY  '                02830899
028309       DISPLAY ' '                                                02830999
028310       MOVE +4002 TO ABEND-CODE                                   02831099
028311       CALL 'ILBOABN0' USING ABEND-CODE                           02831199
028312     ELSE                                                         02831299
028313       DISPLAY '** CURRENT BTCH DTE CONTROL CARD  **'             02831399
028314       DISPLAY '** EPCC111   *  = ' EP111-CC-CRNT-DTE             02831499
028315       DISPLAY ' '                                                02831599
028316     END-IF.                                                      02831699
028317                                                                  02831799
028318*1020-EXIT.                                                       02831899
028319 EJECT.                                                           02831999
028320                                                                  02832099
028321*----------------------------------------------------------       02832199
028322* 1030-READ-CURR-BTCH-FUTRE-CARD.                                 02832299
028323*     READ CONTROL CARD.  THIS GETS THE PROMO INTERFACE           02832399
028324*     ID'S IT NEEDS TO PROCESS.                                   02832499
028325*----------------------------------------------------------       02832599
028326 1030-READ-CURR-BTCH-FUTRE-CARD.                                  02832699
028327                                                                  02832799
028328     READ CONTROL-CARD-BATCH-FUTURE-DTE                           02832899
028329                                  INTO EP107-CC-CONTROL-CARD      02832999
028330       AT END                                                     02833099
028331         SET PS-END-OF-CNTL-CRD-FILE TO TRUE                      02833199
028332     END-READ.                                                    02833299
028333                                                                  02833399
028334     IF PS-END-OF-CNTL-CRD-FILE                                   02833499
028335       DISPLAY ' '                                                02833599
028336       DISPLAY '** ABEND     **'                                  02833699
028337       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      02833799
028338       DISPLAY '** PARAGRAPH **  = 1030-READ-CURR-BTCH-FUTRE-CARD'02833899
028339       DISPLAY '** BTCH FUTURE DTE CRD IS EMPTY  '                02833999
028340       DISPLAY ' '                                                02834099
028341       MOVE +4002 TO ABEND-CODE                                   02834199
028342       CALL 'ILBOABN0' USING ABEND-CODE                           02834299
028343     ELSE                                                         02834399
028344       DISPLAY '** BATCH FUTURE DTE CONTROL CARD  **'             02834499
028345       DISPLAY '** EPCC107   *  = ' EP107-CC-CRNT-DTE             02834599
028346       DISPLAY ' '                                                02834699
028347     END-IF.                                                      02834799
028348                                                                  02834899
028349*1030-EXIT.                                                       02834999
028350 EJECT.                                                           02835099
028351                                                                  02835199
028352*----------------------------------------------------------       02835299
028353* 1040-READ-DAYS-FILE                                             02835399
028354*     READ DAYS FILE.                                             02835499
028355*----------------------------------------------------------       02835599
028356 1040-READ-DAYS-FILE.                                             02835699
028357                                                                  02835799
028358     READ DAYS-FILE INTO EP045-ADVDAYS-TO-SND-RECORD              02835899
028359       AT END                                                     02835999
028360         DISPLAY '** ABEND **'                                    02836099
028361         DISPLAY '** EPKUT112**'                                  02836199
028362         DISPLAY '** 1040-READ-DAYS-FILE **'                      02836299
028363         DISPLAY '** NUMBER OF DAYS RECORD IS MISSING **'         02836399
028364         SET ABEND-4008 TO TRUE                                   02836499
028365         CALL 'ILBOABN0' USING ABEND-CODE.                        02836599
028366                                                                  02836699
028367*1040-EXIT.                                                       02836799
028368 EJECT.                                                           02836899
028369                                                                  02836999
028370*----------------------------------------------------------       02837099
028371* 2000-PROCESS-STORES.                                            02837199
028372*     THIS MODULE DETERMINES IF THIS RUN OF THE PROGRAM IS AN     02837299
028373*     INITAL BATCH RUN OR A RESTART. THIS IS ACCOMPLISHED BY      02837399
028374*     CHECKING THE LAST RECORD IN THE EPCC106 CONTROL CARD.       02837499
028375*     ONCE THE RUN IS DETERMINED TWO QUERYS (RMS AND ADHOC) ARE   02837599
028376*     EXECUTED WHICH IDENTIFY WHICH STORES SHOULD RECIEVE A       02837699
028377*     FULL FILE.                                                  02837799
028378*----------------------------------------------------------       02837899
028379 2000-PROCESS-STORES.                                             02837999
028380                                                                  02838099
028381     EVALUATE TRUE                                                02838199
028382       WHEN EP106-FIRST-RUN                                       02838299
028383         DISPLAY 'THIS IS AN INITAL RUN OF EPKUT112'              02838399
028384         MOVE ZEROS TO EPT00010-STR-NBR                           02838499
028385         PERFORM 2100-PROCESS-RMS-CURSOR UNTIL                    02838599
028386           PS-STOREGP-RMS-CSR-EOF                                 02838699
028387         MOVE ZEROS TO EPT00010-STR-NBR                           02838799
028388         PERFORM 2200-PROCESS-ADHC-CURSOR UNTIL                   02838899
028389           PS-STOREGP-ADHOC-CSR-EOF                               02838999
028390       WHEN EP106-RESTART                                         02839099
028391         DISPLAY 'THIS IS A RESTART OF EPKUT112'                  02839199
028392         MOVE EP106-FULL-FILE-STR TO EPT00010-STR-NBR             02839299
028393         IF EP106-STR-GRP                                         02839399
028394           PERFORM 2100-PROCESS-RMS-CURSOR UNTIL                  02839499
028395             PS-STOREGP-RMS-CSR-EOF                               02839599
028396           MOVE ZEROS TO EPT00010-STR-NBR                         02839699
028397           PERFORM 2200-PROCESS-ADHC-CURSOR UNTIL                 02839799
028398             PS-STOREGP-ADHOC-CSR-EOF                             02839899
028399         END-IF                                                   02839999
028400         IF EP106-ADHOC-STR-GRP                                   02840099
028401           PERFORM 2200-PROCESS-ADHC-CURSOR UNTIL                 02840199
028402             PS-STOREGP-ADHOC-CSR-EOF                             02840299
028403         END-IF                                                   02840399
028404       WHEN OTHER                                                 02840499
028405         MOVE '2000-PROCESS-STORES'                               02840599
028406                                 TO PV-PARAGRAPH-NAME             02840699
028407         MOVE 'READ RESTART CONTROL CARD'                         02840799
028408                                 TO PV-OPERATION-MSG-1            02840899
028409         PERFORM 9800-ABEND                                       02840999
028410     END-EVALUATE.                                                02841099
028411                                                                  02841199
028412*2000-EXIT.                                                       02841299
028413 EJECT.                                                           02841399
028414                                                                  02841499
028415*----------------------------------------------------------       02841599
028416* 2100-PROCESS-RMS-CURSOR.                                        02841699
028417*     READS THE FOLLOWING TABLES: EPT_STR_FIL_RFRSH               02841799
028418*                                 XST_LOC                         02841899
028419*                                 XST_STR_GP_MBSHP                02841999
028420*                                 XST_PROMO_STR_GP                02842099
028430*                                 XST_MDSE_LNE_SELN               02843099
028440*     TO DETERMINE IF THE STORE NEEDS TO RECIEVE A FULL           02844099
028450*     FILE. IF SO, A RECORD IS CREATED TO BE SENT TO THE STORE.   02845099
028460*----------------------------------------------------------       02846099
028470 2100-PROCESS-RMS-CURSOR.                                         02847099
028480                                                                  02848099
028490     PERFORM 2110-OPEN-STOREGP-ID-RMS.                            02849099
028500     PERFORM 2120-FETCH-STOREGP-ID-RMS                            02850099
028600       UNTIL PS-STOREGP-RMS-CSR-EOF.                              02860099
028700     PERFORM 2130-CLOSE-STOREGP-ID-RMS.                           02870099
028800                                                                  02880099
028900*2100-EXIT.                                                       02890099
029000 EJECT.                                                           02900099
029100                                                                  02910099
029200*----------------------------------------------------------       02920099
029300* 2110-OPEN-STOREGP-ID-RMS.                                       02930099
029400*     OPEN THE FULL FILE PROMO AND PMAP CURSOR.                   02940099
029500*----------------------------------------------------------       02950099
029600 2110-OPEN-STOREGP-ID-RMS.                                        02960099
029700                                                                  02970099
029800     PERFORM                                                      02980099
029900         WITH TEST AFTER                                          02990099
030000         VARYING PV-SQL-SUB                                       03000099
030100         FROM 1 BY 1                                              03010099
030200         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 03020099
030300                   OR  SQLCODE = 0)                               03030099
030400                                                                  03040099
030500         EXEC SQL                                                 03050099
030600           OPEN STOREGP-ID-RMS                                    03060099
030700         END-EXEC                                                 03070099
030800                                                                  03080099
030900         EVALUATE TRUE                                            03090099
031000           WHEN SQLCODE = -904                                    03100099
031100           WHEN SQLCODE = -911                                    03110099
031200           WHEN SQLCODE = -913                                    03120099
031300             CONTINUE                                             03130099
031400           WHEN SQLCODE = 0                                       03140099
031500             SET PC-RMS-STR-GRP TO TRUE                           03150099
031600             SET PS-STOREGP-RMS-CSR-NOT-EOF TO TRUE               03160099
031700           WHEN SQLWARN0 NOT EQUAL SPACE                          03170099
031800           WHEN SQLCODE NOT EQUAL ZERO                            03180099
031900             MOVE '2110-OPEN-STOREGP-ID-RMS'                      03190099
032000                                     TO PV-PARAGRAPH-NAME         03200099
032100             MOVE 'ERROR ON OPEN OF STOREGP-ID-RMS CURSOR'        03210099
032200                                     TO PV-DB2-OPERATION          03220099
032300             PERFORM 9900-SQL-ABEND-ROUTINE                       03230099
032400         END-EVALUATE                                             03240099
032500     END-PERFORM.                                                 03250099
032600                                                                  03260099
032700     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         03270099
032800       MOVE '2110-OPEN-STOREGP-ID-RMS'                            03280099
032900                             TO  PV-PARAGRAPH-NAME                03290099
033000       MOVE 'OPEN RETRIES EXCEEDED'                               03300099
033100                              TO  PV-DB2-OPERATION                03310099
033200       PERFORM 9900-SQL-ABEND-ROUTINE                             03320099
033300     END-IF.                                                      03330099
033400                                                                  03340099
033500*2110-EXIT.                                                       03350099
033600 EJECT.                                                           03360099
033700                                                                  03370099
033800*----------------------------------------------------------       03380099
033900* 2120-FETCH-STOREGP-ID-RMS.                                      03390099
034000*     FETCH THE FULL FILE RMS STORE CURSOR.                       03400099
034100*----------------------------------------------------------       03410099
034200 2120-FETCH-STOREGP-ID-RMS.                                       03420099
034300                                                                  03430099
034400     PERFORM                                                      03440099
034500         WITH TEST AFTER                                          03450099
034600         VARYING PV-SQL-SUB                                       03460099
034700         FROM 1 BY 1                                              03470099
034800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 03480099
034900                   OR  SQLCODE = 0                                03490099
035000                   OR  SQLCODE = +100)                            03500099
035100                                                                  03510099
035200         EXEC SQL                                                 03520099
035300           FETCH STOREGP-ID-RMS                                   03530099
035400           INTO  :EPT00010-STR-NBR                                03540099
035500                ,:XST00029-PROMO-INTFC-ID                         03550099
035600                ,:XST00029-MDSE-LNE-ID                            03560099
035700                ,:XST00029-STR-GP-TYP-CDE                         03570099
035800                ,:XST00029-STR-GP-ID                              03580099
035900                ,:XST00029-STR-SELN-HIER-CDE                      03590099
036000                ,:XST00029-ACTL-STRT-TMST                         03600099
036100                ,:XST00029-ACTL-END-TMST                          03610099
036200                ,:XST00029-SOR-LAST-UPD-TMST                      03620099
036300                ,:XST00028-PRICG-TYP-CDE                          03630099
036400         END-EXEC                                                 03640099
036500                                                                  03650099
036600         EVALUATE TRUE                                            03660099
036700           WHEN SQLCODE = -904                                    03670099
036800           WHEN SQLCODE = -911                                    03680099
036900           WHEN SQLCODE = -913                                    03690099
037000             CONTINUE                                             03700099
037100           WHEN SQLCODE = ZERO                                    03710099
037200             PERFORM 3200-FORMAT-RESTART-RECORD                   03720099
037300             PERFORM 3000-FORMAT-RMS-OUTPUT                       03730099
037400           WHEN SQLCODE = +100                                    03740099
037500             SET PS-STOREGP-RMS-CSR-EOF TO TRUE                   03750099
037600           WHEN SQLWARN0 NOT EQUAL SPACE                          03760099
037700           WHEN SQLCODE NOT EQUAL ZERO                            03770099
037800             MOVE '2120-FETCH-STOREGP-ID-RMS'                     03780099
037900                                     TO PV-PARAGRAPH-NAME         03790099
038000             MOVE 'ERROR ON FETCHING RMS CURSOR'                  03800099
038100                                     TO PV-DB2-OPERATION          03810099
038200             PERFORM 9900-SQL-ABEND-ROUTINE                       03820099
038300         END-EVALUATE                                             03830099
038400     END-PERFORM.                                                 03840099
038500                                                                  03850099
038600     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         03860099
038700       MOVE '2120-FETCH-STOREGP-ID-RMS'                           03870099
038800                               TO  PV-PARAGRAPH-NAME              03880099
038900       MOVE 'FETCH RETRIES EXCEEDED'                              03890099
039000                               TO  PV-DB2-OPERATION               03900099
039100       PERFORM 9900-SQL-ABEND-ROUTINE                             03910099
039200     END-IF.                                                      03920099
039300                                                                  03930099
039400*2120-EXIT.                                                       03940099
039500 EJECT.                                                           03950099
039600                                                                  03960099
039700*-----------------------------------------------------------      03970099
039800* 2130-CLOSE-STOREGP-ID-RMS.                                      03980099
039900*-----------------------------------------------------------      03990099
040000 2130-CLOSE-STOREGP-ID-RMS.                                       04000099
040100                                                                  04010099
040200     MOVE ZEROS TO PV-FUL-FILE-STR.                               04020099
040300                                                                  04030099
040400     PERFORM                                                      04040099
040500         WITH TEST AFTER                                          04050099
040600         VARYING PV-SQL-SUB                                       04060099
040700         FROM 1 BY 1                                              04070099
040800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 04080099
040900                   OR  SQLCODE = 0)                               04090099
041000                                                                  04100099
041100         EXEC SQL                                                 04110099
041200           CLOSE STOREGP-ID-RMS                                   04120099
041300         END-EXEC                                                 04130099
041400                                                                  04140099
041500         EVALUATE TRUE                                            04150099
041600           WHEN SQLCODE = -904                                    04160099
041700           WHEN SQLCODE = -911                                    04170099
041800           WHEN SQLCODE = -913                                    04180099
041900           WHEN SQLCODE = 0                                       04190099
042000             CONTINUE                                             04200099
042100           WHEN SQLWARN0 NOT EQUAL SPACE                          04210099
042200           WHEN SQLCODE NOT EQUAL ZERO                            04220099
042300             MOVE '2130-CLOSE-STOREGP-ID-RMS'                     04230099
042400                                     TO PV-PARAGRAPH-NAME         04240099
042500             MOVE 'ERROR ON CLOSE OF STOREGP-ID-RMS'              04250099
042600                                     TO PV-DB2-OPERATION          04260099
042700             PERFORM 9900-SQL-ABEND-ROUTINE                       04270099
042800         END-EVALUATE                                             04280099
042900     END-PERFORM.                                                 04290099
043000                                                                  04300099
043100     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         04310099
043200       MOVE '2130-CLOSE-STOREGP-ID-RMS'                           04320099
043300                               TO  PV-PARAGRAPH-NAME              04330099
043400       MOVE 'CLOSE RETRIES EXCEEDED'                              04340099
043500                               TO  PV-DB2-OPERATION               04350099
043600       PERFORM 9900-SQL-ABEND-ROUTINE                             04360099
043700     END-IF.                                                      04370099
043800                                                                  04380099
043900*2130-EXIT.                                                       04390099
044000 EJECT.                                                           04400099
044100                                                                  04410099
044200*----------------------------------------------------------       04420099
044300* 2200-PROCESS-ADHC-CURSOR.                                       04430099
044400*     READS THE FOLLOWING TABLES: EPT_STR_FIL_RFRSH               04440099
044500*                                 XST_LOC                         04450099
044600*                                 XST_STR_GP_MBSHP                04460099
044700*                                 XST_PROMO_ADHC_RLT              04470099
044800*                                 XST_MDSE_LNE_SELN               04480099
045500*     TO DETERMINE IF THE STORE NEEDS TO RECIEVE A FULL           04550099
045600*     FILE. IF SO, A RECORD IS CREATED TO BE SENT TO THE STORE.   04560099
045700*----------------------------------------------------------       04570099
045800 2200-PROCESS-ADHC-CURSOR.                                        04580099
045900                                                                  04590099
046000     PERFORM 2210-OPEN-STOREGP-ADHOC.                             04600099
046100     PERFORM 2220-FETCH-STOREGP-ADHOC                             04610099
046200       UNTIL PS-STOREGP-ADHOC-CSR-EOF                             04620099
046300     PERFORM 2230-CLOSE-STOREGP-ADHOC.                            04630099
046400                                                                  04640099
046500*2200-EXIT.                                                       04650099
046600 EJECT.                                                           04660099
046700                                                                  04670099
046800*----------------------------------------------------------       04680099
046900* 2210-OPEN-STOREGP-ADHOC.                                        04690099
047000*     OPEN THE BWP BUY PROMO AND PMAP CURSOR.                     04700099
047100*----------------------------------------------------------       04710099
047200 2210-OPEN-STOREGP-ADHOC.                                         04720099
047300                                                                  04730099
047400     PERFORM                                                      04740099
047500         WITH TEST AFTER                                          04750099
047600         VARYING PV-SQL-SUB                                       04760099
047700         FROM 1 BY 1                                              04770099
047800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 04780099
047900                   OR  SQLCODE = 0)                               04790099
048000                                                                  04800099
048100         EXEC SQL                                                 04810099
048200           OPEN STOREGP-ADHOC                                     04820099
048300         END-EXEC                                                 04830099
048400                                                                  04840099
048500                                                                  04850099
048600         EVALUATE TRUE                                            04860099
048700           WHEN SQLCODE = -904                                    04870099
048800           WHEN SQLCODE = -911                                    04880099
048900           WHEN SQLCODE = -913                                    04890099
049000             CONTINUE                                             04900099
049100           WHEN SQLCODE = 0                                       04910099
049200             SET PC-ADHOC-STR-GRP TO TRUE                         04920099
049300             SET PS-STOREGP-ADHOC-CSR-NOT-EOF  TO TRUE            04930099
049400           WHEN SQLWARN0 NOT EQUAL SPACE                          04940099
049500           WHEN SQLCODE NOT EQUAL ZERO                            04950099
049600           MOVE '2210-OPEN-STOREGP-ADHOC'                         04960099
049700                                     TO PV-PARAGRAPH-NAME         04970099
049800           MOVE 'ERROR ON OPEN OF BWP BUY CURSOR'                 04980099
049900                                     TO PV-DB2-OPERATION          04990099
050000           PERFORM 9900-SQL-ABEND-ROUTINE                         05000099
050100         END-EVALUATE                                             05010099
050200     END-PERFORM.                                                 05020099
050300                                                                  05030099
050400     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         05040099
050500       MOVE '2210-OPEN-STOREGP-ADHOC'                             05050099
050600                             TO  PV-PARAGRAPH-NAME                05060099
050700       MOVE 'OPEN RETRIES EXCEEDED'                               05070099
050800                              TO  PV-DB2-OPERATION                05080099
050900       PERFORM 9900-SQL-ABEND-ROUTINE                             05090099
051000     END-IF.                                                      05100099
051100                                                                  05110099
051200*2210-EXIT.                                                       05120099
051300 EJECT.                                                           05130099
051400                                                                  05140099
051500*----------------------------------------------------------       05150099
051600* 2220-FETCH-STOREGP-ADHOC.                                       05160099
051700*     FETCH THE BWP BUY PROMO AND PMAP CURSOR.                    05170099
051800*----------------------------------------------------------       05180099
051810 2220-FETCH-STOREGP-ADHOC.                                        05181099
051820                                                                  05182099
051830     PERFORM                                                      05183099
051831         WITH TEST AFTER                                          05183199
051832         VARYING PV-SQL-SUB                                       05183299
051833         FROM 1 BY 1                                              05183399
051834         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 05183499
051835                   OR  SQLCODE = 0                                05183599
051836                   OR  SQLCODE = +100)                            05183699
051837                                                                  05183799
051838         EXEC SQL                                                 05183899
051839           FETCH STOREGP-ADHOC                                    05183999
051840           INTO  :EPT00010-STR-NBR                                05184099
051841                ,:XST00031-PROMO-INTFC-ID                         05184199
051842                ,:XST00031-MDSE-LNE-ID                            05184299
051843                ,:XST00031-ADHC-STR-GP-ID                         05184399
051844                ,:XST00031-STR-SELN-HIER-CDE                      05184499
051845                ,:XST00031-ACTL-STRT-TMST                         05184599
051846                ,:XST00031-ACTL-END-TMST                          05184699
051847                ,:XST00031-SOR-LAST-UPD-TMST                      05184799
051848                ,:XST00033-EFF-STRT-TMST                          05184899
051849                ,:XST00033-EFF-END-TMST:PV-EFF-END-NULL           05184999
051850                ,:XST00028-PRICG-TYP-CDE                          05185099
051860                ,:XST00023-STR-GP-ID                              05186099
051861         END-EXEC                                                 05186199
051862                                                                  05186299
051863         EVALUATE TRUE                                            05186399
051864           WHEN SQLCODE = -904                                    05186499
051865           WHEN SQLCODE = -911                                    05186599
051866           WHEN SQLCODE = -913                                    05186699
051867             CONTINUE                                             05186799
051868           WHEN SQLCODE = ZERO                                    05186899
051869             PERFORM 3200-FORMAT-RESTART-RECORD                   05186999
051870             PERFORM 3100-FORMAT-ADHOC-OUTPUT                     05187099
051871           WHEN SQLCODE = +100                                    05187199
051872             SET PS-STOREGP-ADHOC-CSR-EOF TO TRUE                 05187299
051873           WHEN SQLWARN0 NOT EQUAL SPACE                          05187399
051874           WHEN SQLCODE NOT EQUAL ZERO                            05187499
051875           MOVE '2220-FETCH-STOREGP-ADHOC'                        05187599
051876                                     TO PV-PARAGRAPH-NAME         05187699
051877           MOVE 'ERROR ON FETCHING BWP BUY CURSOR'                05187799
051878                                     TO PV-DB2-OPERATION          05187899
051879           DISPLAY 'SQLCODE= ' SQLCODE                            05187999
051880           PERFORM 9900-SQL-ABEND-ROUTINE                         05188099
051881         END-EVALUATE                                             05188199
051882     END-PERFORM.                                                 05188299
051883                                                                  05188399
051884     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         05188499
051885       MOVE '2220-FETCH-STOREGP-ADHOC'                            05188599
051886                               TO  PV-PARAGRAPH-NAME              05188699
051887       MOVE 'FETCH RETRIES EXCEEDED'                              05188799
051888                               TO  PV-DB2-OPERATION               05188899
051889       PERFORM 9900-SQL-ABEND-ROUTINE                             05188999
051890     END-IF.                                                      05189099
051891                                                                  05189199
051892*2220-EXIT.                                                       05189299
051893 EJECT.                                                           05189399
051894                                                                  05189499
051895*-----------------------------------------------------------      05189599
051896* 2230-CLOSE-STOREGP-ADHOC.                                       05189699
051897*     CLOSE THE BWP BUY PROMO AND PMAP CURSOR.                    05189799
051898*-----------------------------------------------------------      05189899
051899 2230-CLOSE-STOREGP-ADHOC.                                        05189999
051900                                                                  05190099
051901     PERFORM                                                      05190199
051902         WITH TEST AFTER                                          05190299
051903         VARYING PV-SQL-SUB                                       05190399
051904         FROM 1 BY 1                                              05190499
051905         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 05190599
051906                   OR  SQLCODE = 0)                               05190699
051907                                                                  05190799
051908         EXEC SQL                                                 05190899
051909           CLOSE STOREGP-ADHOC                                    05190999
051910         END-EXEC                                                 05191099
051911                                                                  05191199
051912         EVALUATE TRUE                                            05191299
051913           WHEN SQLCODE = -904                                    05191399
051914           WHEN SQLCODE = -911                                    05191499
051915           WHEN SQLCODE = -913                                    05191599
051916           WHEN SQLCODE = 0                                       05191699
051917             CONTINUE                                             05191799
051918           WHEN SQLWARN0 NOT EQUAL SPACE                          05191899
051919           WHEN SQLCODE NOT EQUAL ZERO                            05191999
051920             MOVE '2230-CLOSE-STOREGP-ADHOC'                      05192099
051921                                     TO PV-PARAGRAPH-NAME         05192199
051922             MOVE 'ERROR ON CLOSE OF STOREGP ADHOC'               05192299
051923                                     TO PV-DB2-OPERATION          05192399
051924             PERFORM 9900-SQL-ABEND-ROUTINE                       05192499
051925         END-EVALUATE                                             05192599
051926     END-PERFORM.                                                 05192699
051927                                                                  05192799
051928     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         05192899
051929       MOVE '2230-CLOSE-STOREGP-ADHOC'                            05192999
051930                               TO  PV-PARAGRAPH-NAME              05193099
051931       MOVE 'CLOSE RETRIES EXCEEDED'                              05193199
051932                               TO  PV-DB2-OPERATION               05193299
051933       PERFORM 9900-SQL-ABEND-ROUTINE                             05193399
051934     END-IF.                                                      05193499
051935                                                                  05193599
051936*2230-EXIT.                                                       05193699
051937 EJECT.                                                           05193799
051938                                                                  05193899
051939*-----------------------------------------------------------      05193999
051940* 3000-FORMAT-RMS-OUTPUT.                                         05194099
051941*     POPULATE COPYBOOK EPRD072.                                  05194199
051942*-----------------------------------------------------------      05194299
051943 3000-FORMAT-RMS-OUTPUT.                                          05194399
051944                                                                  05194499
051945     INITIALIZE EP072-PROMO-INTFC-RECORD.                         05194599
051946     MOVE PC-PRICING-BUS-EVENT   TO EP072-BUSINESS-EVENT-ID.      05194699
051947     MOVE PC-RMS-PRC-SETUP-IND   TO EP072-PRC-SETUP-IND.          05194799
051948     MOVE XST00029-STR-GP-TYP-CDE                                 05194899
051949                                 TO EP072-SETUP-STR-GRP-TYP-CDE.  05194999
051951     MOVE XST00029-STR-GP-ID     TO EP072-SETUP-STR-GRP-ID.       05195199
051952     MOVE PC-STORE-LEVEL-CDE     TO EP072-DIST-STR-GRP-TYP-CDE.   05195299
051953     MOVE XST00023-STR-GP-ID     TO EP072-DIST-STR-GRP-ID.        05195399
051954     MOVE XST00029-STR-SELN-HIER-CDE                              05195499
051955                                 TO EP072-STR-SELN-HIER-CDE.      05195599
051956     MOVE PC-FILE-ACT-TYPE       TO EP072-FILE-ACT-TYP.           05195699
051957     MOVE PC-APPLY-NIGHTLY       TO EP072-APPLY-IND.              05195799
051958     MOVE PC-ADD-STAT-CDE        TO EP072-RECORD-ACTION.          05195899
051959     MOVE XST00029-PROMO-INTFC-ID                                 05195999
051960                                 TO EP072-PROMO-INTFC-ID.         05196099
051980     MOVE XST00029-MDSE-LNE-ID   TO EP072-MERCH-LNE-ID.           05198099
051990     MOVE XST00028-PRICG-TYP-CDE                                  05199099
052000                                 TO EP072-PRICG-TYP-CDE.          05200099
052010     MOVE PC-MDSE-INCL-IND       TO EP072-MDSE-INC-EXC-IND.       05201099
052011     MOVE XST00029-ACTL-STRT-TMST                                 05201199
052012                                 TO EP072-STR-GRP-PROMO-STRT-TMST.05201299
052013     MOVE XST00029-ACTL-END-TMST                                  05201399
052014                                 TO EP072-STR-GRP-PROMO-END-TMST. 05201499
052015     MOVE XST00029-SOR-LAST-UPD-TMST                              05201599
052016                                 TO EP072-SOR-LAST-UPD-TMST.      05201699
052017                                                                  05201799
052018     PERFORM 4000-WRITE-FULL-FILE-RECORD.                         05201899
052019                                                                  05201999
052020*3000-EXIT.                                                       05202099
052030 EJECT.                                                           05203099
052040                                                                  05204099
052050*-----------------------------------------------------------      05205099
052060* 3100-FORMAT-ADHOC-OUTPUT.                                       05206099
052070*     POPULATE COPYBOOK EPRD072.                                  05207099
052080*-----------------------------------------------------------      05208099
052090 3100-FORMAT-ADHOC-OUTPUT.                                        05209099
052100                                                                  05210099
052200     INITIALIZE EP072-PROMO-INTFC-RECORD.                         05220099
052300     MOVE PC-PRICING-BUS-EVENT   TO EP072-BUSINESS-EVENT-ID.      05230099
052400     MOVE PC-ADHOC-PRC-SETUP-IND TO EP072-PRC-SETUP-IND.          05240099
052500     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                05250099
052600                                 TO EP072-SETUP-STR-GRP-TYP-CDE.  05260099
052610     MOVE XST00031-ADHC-STR-GP-ID                                 05261099
052620                                 TO EP072-SETUP-STR-GRP-ID.       05262099
052630     MOVE XST00023-STR-GP-ID     TO EP072-DIST-STR-GRP-ID.        05263099
052640     MOVE PC-STORE-LEVEL-CDE     TO EP072-DIST-STR-GRP-TYP-CDE.   05264099
052650     MOVE XST00031-STR-SELN-HIER-CDE                              05265099
052651                                 TO EP072-STR-SELN-HIER-CDE.      05265199
052652     MOVE PC-FILE-ACT-TYPE       TO EP072-FILE-ACT-TYP.           05265299
052653     MOVE PC-APPLY-NIGHTLY       TO EP072-APPLY-IND.              05265399
052654     MOVE PC-ADD-STAT-CDE        TO EP072-RECORD-ACTION.          05265499
052655     MOVE XST00031-PROMO-INTFC-ID                                 05265599
052656                                 TO EP072-PROMO-INTFC-ID.         05265699
052657     MOVE XST00031-MDSE-LNE-ID                                    05265799
052658                                 TO EP072-MERCH-LNE-ID.           05265899
052659     MOVE XST00028-PRICG-TYP-CDE                                  05265999
052660                                 TO EP072-PRICG-TYP-CDE.          05266099
052661     MOVE PC-MDSE-INCL-IND       TO EP072-MDSE-INC-EXC-IND.       05266199
052662     MOVE XST00031-ACTL-STRT-TMST                                 05266299
052663                                 TO EP072-STR-GRP-PROMO-STRT-TMST.05266399
052664     MOVE XST00031-ACTL-END-TMST                                  05266499
052665                                 TO EP072-STR-GRP-PROMO-END-TMST. 05266599
052666     MOVE XST00031-SOR-LAST-UPD-TMST                              05266699
052667                                 TO EP072-SOR-LAST-UPD-TMST.      05266799
052668                                                                  05266899
052669     PERFORM 4000-WRITE-FULL-FILE-RECORD.                         05266999
052670                                                                  05267099
052671*3100-EXIT.                                                       05267199
052672*-----------------------------------------------------------      05267299
052673* 3200-FORMAT-RESTART-RECORD.                                     05267399
052674*     FORMAT THE RESTART RECORD.                                  05267499
052675*-----------------------------------------------------------      05267599
052676 3200-FORMAT-RESTART-RECORD.                                      05267699
052677                                                                  05267799
052678     IF PV-FUL-FILE-STR NOT EQUAL   TO EPT00010-STR-NBR           05267899
052679       MOVE PC-RMS-PRC-SETUP-IND    TO EP106-JOB-RUN-TYP-IND      05267999
052680       MOVE EPT00010-STR-NBR        TO EP106-FULL-FILE-STR        05268099
052681                                       PC-STORE-NBR               05268199
052682         IF PC-RMS-STR-GRP                                        05268299
052683           SET EP106-STR-GRP        TO TRUE                       05268399
052684           DISPLAY 'PROCESSING RMS STORE NBR: ' PC-STORE-NBR      05268499
052685         ELSE                                                     05268599
052686          IF PC-ADHOC-STR-GRP                                     05268699
052687            SET EP106-ADHOC-STR-GRP TO TRUE                       05268799
052688            DISPLAY 'PROCESSING ADHOC CSR/ STR NBR: ' PC-STORE-NBR05268899
052689          END-IF                                                  05268999
052690         END-IF                                                   05269099
052700       PERFORM 3300-FORMAT-STORE-NBR                              05270099
052701       PERFORM 4100-WRITE-RESTART-RECORD                          05270199
052702       MOVE EPT00010-STR-NBR        TO PV-FUL-FILE-STR            05270299
052703     END-IF.                                                      05270399
052704                                                                  05270499
052705*3200-EXIT.                                                       05270599
052706 EJECT.                                                           05270699
052707                                                                  05270799
052708*-----------------------------------------------------------      05270899
052709* 3300-FORMAT-STORE-NBR.                                          05270999
052710*     FIND THE CORRECT STORE NUMBER FOR OUTPUT.                   05271099
052711*-----------------------------------------------------------      05271199
052712 3300-FORMAT-STORE-NBR.                                           05271299
052713                                                                  05271399
052714     PERFORM                                                      05271499
052715         WITH TEST AFTER                                          05271599
052716         VARYING PV-SQL-SUB                                       05271699
052717         FROM 1 BY 1                                              05271799
052718         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 05271899
052719                   OR  SQLCODE = 0)                               05271999
052720                                                                  05272099
052730           EXEC SQL                                               05273099
052731             SELECT STR_GP_ID                                     05273199
052732             INTO  :XST00023-STR-GP-ID                            05273299
052733             FROM XST_STR_GP_MBSHP                                05273399
052734            WHERE STR_NBR = :EPT00010-STR-NBR                     05273499
052735              AND STR_GP_TYP_CDE = 5000                           05273599
CHG137              AND EFF_END_DTE IS NULL                             05273699
052736           END-EXEC                                               05273799
052737                                                                  05273899
052738     END-PERFORM.                                                 05273999
052739                                                                  05274099
052740     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         05274199
052741       MOVE '3330-FORMAT-STORE-NBR'                               05274299
052742                               TO  PV-PARAGRAPH-NAME              05274399
052743       MOVE 'SELECT RETRIES EXCEEDED'                             05274499
052744                               TO  PV-DB2-OPERATION               05274599
052745       PERFORM 9900-SQL-ABEND-ROUTINE                             05274699
052746     END-IF.                                                      05274799
052747                                                                  05274899
052748*3300-EXIT.                                                       05274999
052749 EJECT.                                                           05275099
052750                                                                  05275199
052751*----------------------------------------------------------       05275299
052752* 4000-WRITE-FULL-FILE-RECORD                                     05275399
052753*     WRITES THE PROMO FULL FILE RECORD TO THE FULL FILE          05275499
052754*----------------------------------------------------------       05275599
052755 4000-WRITE-FULL-FILE-RECORD.                                     05275699
052756                                                                  05275799
052757     WRITE PROMO-INTFC-RECORD FROM EP072-PROMO-INTFC-RECORD.      05275899
052758                                                                  05275999
052759     ADD 1           TO PC-CNT-PROMO-RECS.                        05276099
052760                                                                  05276199
052761*4000-EXIT.                                                       05276299
052762 EJECT.                                                           05276399
052763                                                                  05276499
052764*----------------------------------------------------------       05276599
052765* 4100-WRITE-RESTART-RECORD                                       05276699
052766*     WRITES THE PROMO FULL FILE RECORD TO THE FULL FILE          05276799
052767*----------------------------------------------------------       05276899
052768 4100-WRITE-RESTART-RECORD.                                       05276999
052769                                                                  05277099
052770     WRITE CONTROL-CARD-FOR-RESTART-REC                           05277199
052771                              FROM EP106-PROMO-RESTART-REC.       05277299
052772                                                                  05277399
052773     ADD 1           TO PC-CNT-RESTRT-RECS.                       05277499
052774                                                                  05277599
052775*4100-EXIT.                                                       05277699
052776 EJECT.                                                           05277799
052777                                                                  05277899
052778****************************************************              05277999
052779* DATE ROUTINE TO SET UP THE PROCESS DATE IN       *              05278099
052780* CCYYMMDD FORMAT.                                 *              05278199
052790****************************************************              05279099
052791 6100-DATE-ROUTINE.                                               05279199
052792                                                                  05279299
052793     INITIALIZE DPG51 DPG52 DPG53                                 05279399
052794                DPG54 DPG55 DPG56.                                05279499
052795                                                                  05279599
052796     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      05279699
052797     SET DPG51-INCREMENT-DATE       TO TRUE.                      05279799
052798     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      05279899
052799     MOVE 1                         TO DPG51-INCR-DECR-DAYS-9.    05279999
052800     MOVE EP111-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    05280099
052801                                                                  05280199
052802     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    05280299
052803                                             DPG54 DPG55 DPG56.   05280399
052804                                                                  05280499
052805     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  05280599
052806       DISPLAY '** ABEND **'                                      05280699
052807       DISPLAY '** PROGRAM = EPKUT112'                            05280799
052808       DISPLAY 'DATE = ' EP111-CC-CRNT-DTE                        05280899
052809       DISPLAY DPG54-ERROR-MESSAGE                                05280999
052810       MOVE 4019 TO PV-ABEND-CODE                                 05281099
052811       CALL 'ILBOABN0' USING PV-ABEND-CODE                        05281199
052812     END-IF.                                                      05281299
052813                                                                  05281399
052814     MOVE DPG55-DB2-ISO-DATE-FMT     TO EP111-CC-DATE-PLUS1.      05281499
052815                                                                  05281599
052816                                                                  05281699
052817     INITIALIZE DPG51 DPG52 DPG53                                 05281799
052818                DPG54 DPG55 DPG56.                                05281899
052819                                                                  05281999
052820     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      05282099
052821     SET DPG51-INCREMENT-DATE       TO TRUE.                      05282199
052822     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      05282299
052823     MOVE EP045-DAYS-TILL-STORE-OPN TO DPG51-INCR-DECR-DAYS-9.    05282399
052824     MOVE EP111-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    05282499
052825                                                                  05282599
052826     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    05282699
052827                                             DPG54 DPG55 DPG56.   05282799
052828                                                                  05282899
052829     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  05282999
052830       DISPLAY '** ABEND **'                                      05283099
052831       DISPLAY '** PROGRAM = EPKUT112'                            05283199
052832       DISPLAY 'DATE = ' EP111-CC-CRNT-DTE                        05283299
052833       DISPLAY DPG54-ERROR-MESSAGE                                05283399
052834       MOVE 4019 TO PV-ABEND-CODE                                 05283499
052835       CALL 'ILBOABN0' USING PV-ABEND-CODE                        05283599
052836     END-IF.                                                      05283699
052837                                                                  05283799
052838     MOVE DPG55-DB2-ISO-DATE-FMT                                  05283899
052839                                 TO DATE-STORE-WILL-OPEN.         05283999
052840                                                                  05284099
052841                                                                  05284199
052842     INITIALIZE DPG51 DPG52 DPG53                                 05284299
052843                DPG54 DPG55 DPG56.                                05284399
052844                                                                  05284499
052845     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      05284599
052846     SET DPG51-DECREMENT-DATE       TO TRUE.                      05284699
052847     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      05284799
052848     MOVE 1                         TO DPG51-INCR-DECR-DAYS-9.    05284899
052849     MOVE EP107-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    05284999
052850                                                                  05285099
052851     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    05285199
052852                                             DPG54 DPG55 DPG56.   05285299
052853                                                                  05285399
052854     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  05285499
052855       DISPLAY '** ABEND **'                                      05285599
052856       DISPLAY '** PROGRAM = EPKUT112'                            05285699
052857       DISPLAY 'DATE = ' EP111-CC-CRNT-DTE                        05285799
052858       DISPLAY DPG54-ERROR-MESSAGE                                05285899
052859       MOVE 4019 TO PV-ABEND-CODE                                 05285999
052860       CALL 'ILBOABN0' USING PV-ABEND-CODE                        05286099
052861     END-IF.                                                      05286199
052862                                                                  05286299
052863     MOVE DPG55-DB2-ISO-DATE-FMT     TO EP107-CC-CRNT-DTE-MINUS1. 05286399
052864                                                                  05286499
052865*6100-EXIT.                                                       05286599
052866 EJECT.                                                           05286699
052867                                                                  05286799
052868*----------------------------------------------------------       05286899
052869* 9800-ABEND.                                                     05286999
052870*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  05287099
052880*----------------------------------------------------------       05288099
052890 9800-ABEND.                                                      05289099
052900                                                                  05290099
053000     DISPLAY '** ABEND           **'.                             05300099
053100     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  05310099
053200     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        05320099
053300     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       05330099
053400     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       05340099
053500     CALL 'ILBOABN0' USING ABEND-CODE.                            05350099
053600                                                                  05360099
053700*9800-EXIT.                                                       05370099
053800 EJECT.                                                           05380099
053900                                                                  05390099
054000*----------------------------------------------------------       05400099
054100* 9900-SQL-ABEND-ROUTINE.                                         05410099
054200*     SQL ABEND ROUTINE.                                          05420099
054300*----------------------------------------------------------       05430099
054400 9900-SQL-ABEND-ROUTINE.                                          05440099
054500                                                                  05450099
054600     DISPLAY '** ABEND     **'.                                   05460099
054700     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        05470099
054800     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              05480099
054900     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               05490099
055000                                                                  05500099
055100     COPY DPPD004.                                                05510099
055200     SET ABEND-4013-DB2-ERROR TO TRUE.                            05520099
055300     CALL 'ILBOABN0' USING ABEND-CODE.                            05530099
055400                                                                  05540099
055500*9900-EXIT.                                                       05550099
055600 EJECT.                                                           05560099
055700                                                                  05570099
055800*----------------------------------------------------------       05580099
055900* 9999-WRAPUP.                                                    05590099
056000*     END OF PROGRAM ROUTINE. CLOSES ALL FILES AND DISPLAYS       05600099
056100*     ANY DATA FROM THE PROGRAM.                                  05610099
056200*----------------------------------------------------------       05620099
056300 9999-WRAPUP.                                                     05630099
056400                                                                  05640099
056500     CLOSE CONTROL-CARD-FOR-RESTART                               05650099
056600           CONTROL-CARD-CURR-BATCH-DTE                            05660099
056700           CONTROL-CARD-BATCH-FUTURE-DTE                          05670099
056800           PROMO-INTFC-FILE.                                      05680099
056900                                                                  05690099
057000     DISPLAY ' '.                                                 05700099
057100     DISPLAY '*********************************************'.     05710099
057200     DISPLAY 'PROGRAM NAME: ' PC-CURRENT-PROGRAM-NAME.            05720099
057300     DISPLAY '*********************************************'.     05730099
057400     DISPLAY 'NUMBER OF RESTRT RECS READ: ' PC-CNT-READ-RECS.     05740099
057500     DISPLAY 'NUMBER OF PROMO RECS WRITTEN: ' PC-CNT-PROMO-RECS.  05750099
057600     DISPLAY 'NUMBER OF RESTRT RECS WRITTEN: ' PC-CNT-RESTRT-RECS.05760099
057700*    DISPLAY 'MUMBER OF ERROR RECS WRITTEN: ' PC-CNT-ERROR-RECS.  05770099
057800*    DISPLAY 'ALL RECS WRITTEN: ' PC-CNT-ALL-RECS.                05780099
057900     DISPLAY '*********************************************'.     05790099
058000                                                                  05800099
058100*9999-EXIT.                                                       05810099
058200 EJECT.                                                           05820099
058300                                                                  05830099
