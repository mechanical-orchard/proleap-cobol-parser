000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.         AUKUT005.                                    00020001
000300 AUTHOR.             BARB ERTL.                                   00030001
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040001
000500 DATE-WRITTEN.       FEBRUARY 2008.                               00050001
000600 DATE-COMPILED.                                                   00060001
000700                                                                  00070001
000800******************************************************************00080001
000900* THIS PROGRAM WILL VALIDATE THE BLACKHAWK RECONCILIATION FILE   *00090001
001000* AND OUTPUT A FILE FOR MATCHING TO THE EXTRACT.                 *00100001
001100*                                                                *00110001
001200******************************************************************00120001
001300                                                                  00130001
001400******************************************************************00140001
001500 ENVIRONMENT DIVISION.                                            00150001
001600******************************************************************00160001
001700                                                                  00170001
001800 CONFIGURATION SECTION.                                           00180001
001900                                                                  00190001
002000 SOURCE-COMPUTER.    IBM-3090.                                    00200001
002100 OBJECT-COMPUTER.    IBM-3090.                                    00210001
002200                                                                  00220001
002300 INPUT-OUTPUT SECTION.                                            00230001
002400                                                                  00240001
002500 FILE-CONTROL.                                                    00250001
002600                                                                  00260001
002700     SELECT RECONCILE-FILE       ASSIGN TO INP01.                 00270002
002800     SELECT DAILY-RECON-FILE     ASSIGN TO OUT01.                 00280001
002900                                                                  00290001
003000******************************************************************00300001
003100 DATA DIVISION.                                                   00310001
003200******************************************************************00320001
003300                                                                  00330001
003400 FILE SECTION.                                                    00340001
003500                                                                  00350001
003600 FD  RECONCILE-FILE                                               00360002
003700     RECORDING MODE IS F                                          00370001
003800     BLOCK CONTAINS 0 RECORDS                                     00380001
003900     LABEL RECORDS ARE OMITTED.                                   00390001
004000                                                                  00400001
004100 01  RECONCILE-RECORD             PIC  X(100).                    00410002
004200                                                                  00420001
004300 FD  DAILY-RECON-FILE                                             00430001
004400     RECORDING MODE IS F                                          00440001
004500     BLOCK CONTAINS 0 RECORDS                                     00450001
004600     LABEL RECORDS ARE OMITTED.                                   00460001
004700                                                                  00470001
004800 01  DAILY-RECON-RECORD           PIC  X(100).                    00480002
004900                                                                  00490001
005000 WORKING-STORAGE SECTION.                                         00500001
005100                                                                  00510001
005200******************************************************************00520001
005300*    PC-PROGRAM CONSTANTS                                        *00530001
005400******************************************************************00540001
005500 01  PC-PROGRAM-CONSTANTS.                                        00550001
005600     05  PC-PROGRAM-NAME         PIC X(08)      VALUE 'AUKUT005'. 00560001
005700     05  PC-SPACE                PIC  X(01)     VALUE SPACE.      00570009
005800                                                                  00580001
005900******************************************************************00590001
006000*    PV-PROGRAM VARIABLES                                        *00600001
006100******************************************************************00610001
006200 01  PV-PROGRAM-VARIABLES.                                        00620001
006300     05  PV-PARAGRAPH-NAME            PIC  X(30)     VALUE SPACES.00630001
006400     05  PV-OPERATION-MSG-1           PIC  X(30)     VALUE SPACES.00640001
006500     05  PV-TRANSACTION-DTE.                                      00650011
006600         10  PV-YEAR                  PIC  X(04).                 00660011
006700         10  PV-MM                    PIC  X(02).                 00670011
006800         10  PV-DD                    PIC  X(02).                 00680012
006900     05  PV-FILE-DATE.                                            00690011
007000         10  PV-FD-YEAR               PIC  X(04).                 00700011
007100         10  FILLER                   PIC  X(01)     VALUE '-'.   00710011
007200         10  PV-FD-MM                 PIC  X(02).                 00720011
007300         10  FILLER                   PIC  X(01)     VALUE '-'.   00730011
007400         10  PV-FD-DD                 PIC  X(02).                 00740011
007500     05  PV-TRAILING-SPACES           PIC S9(03)     VALUE ZERO   00750005
007600                                                           COMP-3.00760005
007700     05  PV-START-POSITION            PIC S9(03)     VALUE ZERO   00770005
007800                                                           COMP-3.00780005
007900     05  PV-CHAR-POSITION             PIC S9(03)     VALUE ZERO   00790005
008000                                                           COMP-3.00800005
008100     05  PV-CARD-NUMBER               PIC  X(19).                 00810005
008200     05  PV-CARD-NUMBER-ADJUST REDEFINES PV-CARD-NUMBER.          00820005
008300         10  PV-CARD-NUMBER-CHAR OCCURS 19 TIMES.                 00830005
008400             15  PV-CARD-NUMBER-C     PIC  X(01).                 00840005
008500                                                                  00850005
008600                                                                  00860001
008700******************************************************************00870001
008800*    PS-PROGRAM SWITCHES                                         *00880001
008900******************************************************************00890001
009000 01  PS-PROGRAM-SWITCHES.                                         00900001
009100     05  PS-END-OF-RECONCILE-FILE-SW PIC   X(01)     VALUE 'N'.   00910002
009200         88  PS-END-OF-RECONCILE-FILE                VALUE 'Y'.   00920002
009300                                                                  00930001
009400******************************************************************00940001
009500*    PA-PROGRAM ACCUMULATORS                                     *00950001
009600******************************************************************00960001
009700 01  PA-PROGRAM-ACCUMULATORS.                                     00970001
009800     05  PA-DETAIL-RECORDS-WRITTEN     PIC 9(08)  VALUE ZEROES.   00980001
009900                                                                  00990001
010000 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      01000001
010100                                                  COMP.           01010001
010200     88  AC-DATASET-DATA-ERROR                    VALUE +4008.    01020001
010300                                                                  01030001
010400******************************************************************01040001
010500*    BLACKHAWK RECONCILE FILE LAYOUT                             *01050002
010600******************************************************************01060001
010700     COPY AURD010.                                                01070002
010800                                                                  01080001
010900******************************************************************01090001
011000*    RECONCILIATION FILE LAYOUT                                  *01100001
011100******************************************************************01110001
011200     COPY AURD011.                                                01120002
011300                                                                  01130001
011400******************************************************************01140001
011500* PROCEDURE DIVISION                                             *01150001
011600******************************************************************01160001
011700 PROCEDURE DIVISION.                                              01170001
011800                                                                  01180001
011900 0000-MAINLINE-PROCESSING.                                        01190001
012000                                                                  01200001
012100     PERFORM 1000-INITIALIZE-PROGRAM.                             01210001
012200                                                                  01220001
012300     PERFORM 2000-PROCESS-RECONCILE-FILE                          01230002
012400       UNTIL PS-END-OF-RECONCILE-FILE.                            01240002
012500                                                                  01250001
012600     CLOSE RECONCILE-FILE                                         01260002
012700           DAILY-RECON-FILE.                                      01270001
012800                                                                  01280001
012900     GOBACK.                                                      01290001
013000                                                                  01300001
013100******************************************************************01310001
013200* 1000-INITIALIZE-PROGRAM : OPEN INPUT AND OUTPUT FILES AND      *01320001
013300* PERFORM AN INITIAL READ OF THE INPUT FILE AND VERIFY IF THE    *01330001
013400* FIRST RECORD IS A HEADER RECORD.                               *01340001
013500******************************************************************01350001
013600 1000-INITIALIZE-PROGRAM.                                         01360001
013700                                                                  01370001
013800     OPEN INPUT  RECONCILE-FILE                                   01380002
013900          OUTPUT DAILY-RECON-FILE.                                01390001
014000                                                                  01400001
014100     PERFORM 7000-READ-RECONCILE-FILE.                            01410002
014200                                                                  01420001
014300     IF PS-END-OF-RECONCILE-FILE                                  01430004
014400         DISPLAY 'NO RECORDS IN RECON FILE'                       01440004
014500     ELSE                                                         01450004
014600         IF AU010-FH-RCD-ID                                       01460004
014700             PERFORM 7000-READ-RECONCILE-FILE                     01470004
014800         ELSE                                                     01480004
014900             MOVE '1000-INITIALIZE-PROGRAM'  TO PV-PARAGRAPH-NAME 01490004
015000             MOVE 'NO HEADER RECORD FOUND'   TO PV-OPERATION-MSG-101500004
015100             PERFORM 9999-ABEND                                   01510004
015200         END-IF                                                   01520004
015300     END-IF.                                                      01530001
015400                                                                  01540001
015500******************************************************************01550001
015600* 2000-PROCESS-RECONCILE-FILE                                    *01560002
015700*    PROCESS THE INPUT FILE AND WRITE THE OUTPUT RECORDS         *01570001
015800******************************************************************01580001
015900 2000-PROCESS-RECONCILE-FILE.                                     01590002
016000                                                                  01600001
016100     IF AU010-DT-RCD-ID                                           01610002
016200         MOVE 0 TO PV-TRAILING-SPACES                             01620010
016300         INSPECT AU010-DT-GIFT-CARD-NBR                           01630005
016400              TALLYING PV-TRAILING-SPACES                         01640005
016500                 FOR ALL PC-SPACE                                 01650009
016600                                                                  01660005
016700         COMPUTE PV-START-POSITION = 19 - PV-TRAILING-SPACES      01670005
016800         MOVE +20 TO PV-CHAR-POSITION                             01680005
016900         MOVE AU010-DT-GIFT-CARD-NBR TO PV-CARD-NUMBER            01690005
017000                                                                  01700005
017100         PERFORM                                                  01710005
017200             VARYING PV-START-POSITION                            01720005
017300                FROM PV-START-POSITION BY -1                      01730005
017400               UNTIL PV-START-POSITION LESS THAN 1                01740005
017500                   SUBTRACT +1 FROM PV-CHAR-POSITION              01750005
017600                   MOVE PV-CARD-NUMBER-C(PV-START-POSITION) TO    01760005
017700                       PV-CARD-NUMBER-C(PV-CHAR-POSITION)         01770005
017800         END-PERFORM                                              01780005
017900                                                                  01790005
018000         SUBTRACT +1 FROM PV-CHAR-POSITION                        01800005
018100                                                                  01810005
018200         PERFORM                                                  01820005
018300             VARYING PV-CHAR-POSITION FROM PV-CHAR-POSITION BY -1 01830005
018400               UNTIL PV-CHAR-POSITION LESS THAN 1                 01840005
018500                   MOVE '0' TO                                    01850005
018600                       PV-CARD-NUMBER-C(PV-CHAR-POSITION)         01860005
018700         END-PERFORM                                              01870005
018800                                                                  01880005
018900         MOVE PV-CARD-NUMBER            TO AU011-GIFT-CARD-NBR    01890005
019000         MOVE AU010-DT-TRANSACTION-DATE TO PV-TRANSACTION-DTE     01900011
019100         MOVE PV-YEAR                   TO PV-FD-YEAR             01910011
019200         MOVE PV-MM                     TO PV-FD-MM               01920011
019300         MOVE PV-DD                     TO PV-FD-DD               01930011
019400         MOVE PV-FILE-DATE              TO AU011-TRANSACTION-DATE 01940011
019500         MOVE AU010-DT-TRANSACTION-TIME TO AU011-TRANSACTION-TIME 01950002
019600         MOVE AU010-DT-TRANSACTION-NBR  TO AU011-TRANSACTION-NBR  01960002
019700         MOVE AU010-DT-TRANSACTION-AMT  TO AU011-TRANSACTION-AMT  01970002
019800         MOVE AU010-DT-BLACKHAWK-IDENTIFIER TO                    01980002
019900                                        AU011-BLACKHAWK-IDENTIFIER01990002
020000         MOVE AU010-DT-APPROVAL-CODE    TO AU011-APPROVAL-CDE     02000003
020100         MOVE AU010-DT-PARTNER-NAME     TO AU011-PARTNER-NAME     02010002
020200         MOVE AU010-DT-RESPONSE-CODE    TO AU011-RESPONSE-CODE    02020002
020300         MOVE AU010-DT-TYPE-CODE        TO AU011-AUTH-TYPE-CODE   02030003
020400                                                                  02040002
020500         WRITE DAILY-RECON-RECORD FROM AU011-DETAIL-TRANS         02050002
020600         ADD +1 TO PA-DETAIL-RECORDS-WRITTEN                      02060002
020700     ELSE                                                         02070002
020800         IF AU010-FT-RCD-ID                                       02080002
020900             PERFORM 3000-PROCESS-TRAILER-RECORD                  02090002
021000         ELSE                                                     02100002
021100             MOVE '2000-PROCESS-RECONCILE-FILE' TO                02110002
021200                                               PV-PARAGRAPH-NAME  02120002
021300             MOVE 'NO TRAILER RECORD FOUND' TO PV-OPERATION-MSG-1 02130002
021400             PERFORM 9999-ABEND                                   02140002
021500         END-IF                                                   02150002
021600     END-IF.                                                      02160002
021700                                                                  02170002
021800     PERFORM 7000-READ-RECONCILE-FILE.                            02180002
021900                                                                  02190002
022000******************************************************************02200002
022100* 3000-PROCESS-TRAILER-RECORD                                    *02210002
022200*    VALIDATE THE NUMBER OF DETAIL RECORDS IN THE INPUT FILE TO  *02220002
022300*    THE NUMBER OF RECORDS STATED IN THE TRAILER RECORD.         *02230002
022400******************************************************************02240002
022500 3000-PROCESS-TRAILER-RECORD.                                     02250002
022600                                                                  02260002
022700     DISPLAY 'RECORD COUNT ' PA-DETAIL-RECORDS-WRITTEN.           02270002
022800     DISPLAY 'FILE COUNT '   AU010-FT-RECORD-COUNT.               02280002
022900                                                                  02290002
023000     IF PA-DETAIL-RECORDS-WRITTEN = AU010-FT-RECORD-COUNT         02300002
023100         CONTINUE                                                 02310002
023200     ELSE                                                         02320002
023300         MOVE '3000-PROCESS-TRAILER-RECORD' TO PV-PARAGRAPH-NAME  02330002
023400         MOVE 'INVALID DATA ON DATASET '    TO PV-OPERATION-MSG-1 02340002
023500         SET AC-DATASET-DATA-ERROR          TO TRUE               02350002
023600         PERFORM 9999-ABEND                                       02360002
023700     END-IF.                                                      02370002
023800                                                                  02380002
023900******************************************************************02390002
024000* 7000-READ-RECONCILE-FILE                                       *02400002
024100*    READ THE INPUT FILE AND SET THE END OF FILE SWITCH WHEN     *02410002
024200*    THERE IS NO MORE RECORDS TO READ.                           *02420002
024300******************************************************************02430002
024400 7000-READ-RECONCILE-FILE.                                        02440002
024500                                                                  02450002
024600     INITIALIZE AU010-RECONCILE-RECORD.                           02460002
024700                                                                  02470002
024800     READ RECONCILE-FILE INTO AU010-RECONCILE-RECORD              02480002
024900         AT END                                                   02490002
025000             SET PS-END-OF-RECONCILE-FILE TO TRUE.                02500002
025100                                                                  02510002
025200******************************************************************02520002
025300* 9999-ABEND - PERFORMS A NON-SQL-ABEND                           02530002
025400******************************************************************02540002
025500 9999-ABEND.                                                      02550001
025600     DISPLAY '** ABEND           **'.                             02560001
025700     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          02570001
025800     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        02580001
025900     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       02590001
026000     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         02600001
026100                                                                  02610001
