000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.   SUKUT172.                                          00050011
000600 AUTHOR.       AYAN SARKAR.                                       00060000
000700 INSTALLATION. KOHLS DEPARTMENT STORES.           ¦ ¦    ¦  ¦ ¦   00070000
000800 DATE-WRITTEN. SEPT, 2015.                      ¦¦¦¦¦   ¦¦¦¦ ¦¦¦¦ 00080006
000900 DATE-COMPILED.                                 ¦     ¦  ¦  ¦ ¦   00090000
001000                                               ¦       ¦ ¦¦¦¦ ¦¦¦¦00100000
001100******************************************************************00110000
001320*THIS PROGRAM READS DAILY MISDIRECT EXTRACT FILE (LAST 7 GENS.) IN00132014
001330*SURD008 FORMAT AND POPULATES SEVERAL OTHER FIELDS USING THAT DATA00133014
001340*TO CREATE A CUSTOMIZED REPORT TO BE USED BY THE BUSINESS.        00134014
001400******************************************************************00140000
001500 ENVIRONMENT DIVISION.                                            00150000
001800 CONFIGURATION SECTION.                                           00180000
001900                                                                  00190000
002000 SOURCE-COMPUTER.        IBM-3090.                                00200000
002100 OBJECT-COMPUTER.        IBM-3090.                                00210000
002110                                                                  00211000
002120 INPUT-OUTPUT SECTION.                                            00212000
002130 FILE-CONTROL.                                                    00213000
002140     SELECT INP-MISDIRECT-FILE             ASSIGN TO INP01.       00214000
002150     SELECT OUT-MISDIRECT-FILE             ASSIGN TO OUT01.       00215000
002200                                                                  00220000
002300******************************************************************00230000
002400 DATA DIVISION.                                                   00240000
002500******************************************************************00250000
002510 FILE SECTION.                                                    00251000
002520 FD  INP-MISDIRECT-FILE                                           00252000
002530     RECORDING MODE IS F                                          00253000
002540     LABEL RECORDS ARE STANDARD                                   00254000
002550     BLOCK CONTAINS 0 RECORDS.                                    00255000
002560 01  INP-MISDIRECT-RECORD          PIC  X(200).                   00256000
002600                                                                  00260000
002610 FD  OUT-MISDIRECT-FILE                                           00261000
002620     RECORDING MODE IS F                                          00262000
002630     LABEL RECORDS ARE STANDARD                                   00263000
002640     BLOCK CONTAINS 0 RECORDS.                                    00264000
002650 01  OUT-MISDIRECT-RECORD          PIC  X(223).                   00265010
002660                                                                  00266000
002700******************************************************************00270000
002800 WORKING-STORAGE SECTION.                                         00280000
002900******************************************************************00290000
002910 01  ABEND-CODE                    PIC S9(04)  VALUE +0           00291000
002920                                                   COMP SYNC.     00292000
002930 01  PS-PROGRAM-SWITCHES.                                         00293000
002940     05  PS-END-OF-MISDR-FILE-SW   PIC X(01)   VALUE 'N'.         00294000
002950         88  PS-END-OF-MISDR-FILE              VALUE 'Y'.         00295000
002960         88  PS-END-OF-MISDR-FILE-NO           VALUE 'N'.         00296000
002964     05  PS-SHIPT-ID-EXIST-SW      PIC X(01)   VALUE 'N'.         00296400
002965         88  PS-SHIPT-ID-EXIST                 VALUE 'Y'.         00296500
002966         88  PS-SHIPT-ID-EXIST-NO              VALUE 'N'.         00296600
002967     05  PS-NUMBER-SW              PIC X(01)   VALUE 'N'.         00296700
002968         88  PS-NUMBER-YES                     VALUE 'Y'.         00296800
002969         88  PS-NUMBER-NO                      VALUE 'N'.         00296900
002970     05  PS-SISTER-DC-SW           PIC X(01)   VALUE 'N'.         00297006
002971         88  PS-SISTER-DC-YES                  VALUE 'Y'.         00297106
002972         88  PS-SISTER-DC-NO                   VALUE 'N'.         00297206
002973     05  PS-SCAN-OPER-SW           PIC 9(04).                     00297308
002974         88  PS-DC810                          VALUE 810.         00297406
002975         88  PS-DC830                          VALUE 830.         00297506
002976         88  PS-DC840                          VALUE 840.         00297606
002977         88  PS-DC855                          VALUE 855.         00297706
002978         88  PS-DC860                          VALUE 860.         00297806
002979         88  PS-DC865                          VALUE 865.         00297906
002980         88  PS-DC875                          VALUE 875.         00298006
002981         88  PS-DC885                          VALUE 885.         00298106
002982         88  PS-DC890                          VALUE 890.         00298206
002983     05  PS-PKSL-OPER-SW           PIC 9(04).                     00298308
002984         88  PS-DC810-SISTER                   VALUE 870.         00298406
002985         88  PS-DC830-SISTER1                  VALUE 816.         00298506
002986         88  PS-DC830-SISTER2                  VALUE 858.         00298606
002987         88  PS-DC840-SISTER                   VALUE 878.         00298706
002988         88  PS-DC855-SISTER                   VALUE 806.         00298806
002989         88  PS-DC860-SISTER1                  VALUE 826.         00298906
002990         88  PS-DC860-SISTER2                  VALUE 888.         00299006
002992         88  PS-DC875-SISTER                   VALUE 868.         00299212
002995                                                                  00299506
002996 01  PC-PROGRAM-CONSTANTS.                                        00299606
002997     05  PC-PGM-NAME               PIC X(08)   VALUE 'SUKUT172'.  00299711
002998     05  PC-CAN-LEN                PIC 9(04)   VALUE 30.          00299806
002999                                                                  00299906
003000 01 PV-PROGRAM-VARIABLES.                                         00300006
003001     05  PV-ABEND-PARAGRAPH        PIC X(35)   VALUE SPACES.      00300106
003002     05  PV-DB2-OPN-ATTEMPTED      PIC X(35)   VALUE SPACES.      00300206
003003     05  PV-TOTAL-READ             PIC 9(09)   VALUE ZEROES.      00300306
003004     05  PV-TOTAL-WRITE            PIC 9(09)   VALUE ZEROES.      00300406
003005     05  PV-1                      PIC S9(1)   VALUE ZEROES COMP. 00300506
003006     05  PV-COUNTER                PIC 9(04)   VALUE ZEROES.      00300606
003007     05  PV-CAN-LEN                PIC 9(04)   VALUE ZEROES.      00300706
003008     05  PV-PO-PKGNG-CDE           PIC X(01)   VALUE SPACES.      00300806
003009     05  PV-MISDIRECT-DETAILS.                                    00300906
003010         10  PV-SCAC-ID            PIC X(04)   VALUE SPACES.      00301010
003020         10  FILLER                PIC X(01)   VALUE ','.         00302010
003030         10  PV-VEH-NBR            PIC X(11)   VALUE SPACES.      00303010
003040         10  FILLER                PIC X(01)   VALUE ','.         00304010
003041         10  PV-TRIP-ID            PIC 9(09)   VALUE ZEROES.      00304113
003042         10  FILLER                PIC X(01)   VALUE ','.         00304213
003050         10  PV-VEND-NAME          PIC X(30)   VALUE SPACES.      00305010
003051         10  FILLER                PIC X(01)   VALUE ','.         00305110
003054         10  PV-PO-NBR             PIC 9(09)   VALUE ZEROES.      00305410
003055         10  FILLER                PIC X(01)   VALUE ','.         00305510
003056         10  PV-REC-SEQ-NBR        PIC 9(09)   VALUE ZEROES.      00305610
003057         10  FILLER                PIC X(01)   VALUE ','.         00305710
003058         10  PV-PO-TYPE            PIC X(02)   VALUE SPACES.      00305810
003059         10  FILLER                PIC X(01)   VALUE ','.         00305910
003060         10  PV-PKGNG-CDE          PIC X(03)   VALUE SPACES.      00306010
003061         10  FILLER                PIC X(01)   VALUE ','.         00306110
003062         10  PV-SCAN-OPER-UNT-ID   PIC 9(04)   VALUE ZEROES.      00306210
003063         10  FILLER                PIC X(01)   VALUE ','.         00306310
003064         10  PV-PKSL-OPER-UNT-ID   PIC 9(04)   VALUE ZEROES.      00306410
003065         10  FILLER                PIC X(01)   VALUE ','.         00306510
003066         10  PV-PKSL-STR-NBR       PIC 9(04)   VALUE ZEROES.      00306610
003067         10  FILLER                PIC X(01)   VALUE ','.         00306710
003068         10  PV-DC-TO-STORE        PIC 9(04)   VALUE ZEROES.      00306810
003069         10  FILLER                PIC X(01)   VALUE ','.         00306910
003070         10  FILLER                PIC X(02)   VALUE '="'.        00307010
003071         10  PV-SSCC-CARTON-NBR    PIC X(18)   VALUE SPACES.      00307110
003072         10  FILLER                PIC X(01)   VALUE '"'.         00307210
003073         10  FILLER                PIC X(01)   VALUE ','.         00307310
003074         10  PV-MISDIR-TYPE        PIC X(01)   VALUE SPACES.      00307410
003075         10  FILLER                PIC X(01)   VALUE ','.         00307510
003076         10  PV-SCAN-DATE          PIC X(10)   VALUE SPACES.      00307610
003077         10  FILLER                PIC X(01)   VALUE ','.         00307710
003078         10  PV-SCAN-TIME          PIC X(08)   VALUE SPACES.      00307810
003079         10  FILLER                PIC X(01)   VALUE ','.         00307910
003080         10  FILLER                PIC X(02)   VALUE '="'.        00308010
003081         10  PV-CAN                PIC X(30)   VALUE SPACES.      00308110
003082         10  FILLER                PIC X(01)   VALUE '"'.         00308210
003083         10  FILLER                PIC X(01)   VALUE ','.         00308310
003084         10  FILLER                PIC X(02)   VALUE '="'.        00308410
003085         10  PV-SML                PIC X(18)   VALUE SPACES.      00308510
003086         10  FILLER                PIC X(01)   VALUE '"'.         00308610
003087         10  FILLER                PIC X(01)   VALUE ','.         00308710
003088         10  PV-LBL-PRNT-USR       PIC X(08)   VALUE SPACES.      00308810
003089         10  FILLER                PIC X(01)   VALUE ','.         00308910
003090         10  PV-LBL-CRE-SRC        PIC X(03)   VALUE SPACES.      00309010
003091         10  FILLER                PIC X(01)   VALUE ','.         00309110
003092         10  PV-LBL-PRNT-LOC       PIC 9(04)   VALUE ZEROES.      00309210
003093         10  FILLER                PIC X(01)   VALUE SPACES.      00309310
003094                                                                  00309406
003095     05  PV-OUTREC-HEADER.                                        00309506
003096         10  PV-HDR-1              PIC X(41)   VALUE              00309610
003097             'SCAC-ID,VEH-NBR,TRIP-ID,VEND-NAME,PO-NBR,'.         00309713
003098         10  PV-HDR-2              PIC X(47)   VALUE              00309810
003099             'REC-SEQ-NBR,PO-TYPE,PKGNG-CDE,SCAN-OPER-UNT-ID,'.   00309910
003100         10  PV-HDR-3              PIC X(49)   VALUE              00310010
003101             'PKSL-OPER-UNT-ID,PKSL-STR-NBR,ACTL-DC-TO-STR,SSCC'. 00310110
003102         10  PV-HDR-4              PIC X(43)   VALUE              00310210
003103             ',MISDIRECT-TYPE,SCAN-DATE,SCAN-TIME,CAN,SML'.       00310310
003104         10  PV-HDR-5              PIC X(43)   VALUE              00310410
003105             ',LBL-PRNT-USR,LBL-CRE-SRC,LBL-PRNT-LOC     '.       00310510
003106                                                                  00310606
003107******************************************************************00310706
003108*  INPUT FILE LAYOUT                       '                     *00310806
003109******************************************************************00310906
003110     COPY SURD008.                                                00311006
003111                                                                  00311106
003112******************************************************************00311200
003120*  COMMUNICATIONS AREA FOR DB2                                   *00312000
003200******************************************************************00320000
003300     EXEC SQL                                                     00330000
003400          INCLUDE SQLCA                                           00340000
003500     END-EXEC.                                                    00350000
003600                                                                  00360000
003700******************************************************************00370000
003800*  DB2 TABLE DECLARATION - TPKSLIP                               *00380000
003900******************************************************************00390000
004000     EXEC SQL                                                     00400000
004100          INCLUDE TPKSLIP                                         00410000
004200     END-EXEC.                                                    00420000
004300                                                                  00430000
004315******************************************************************00431500
004320*  DB2 TABLE DECLARATION - TSHIPMT                               *00432000
004330******************************************************************00433000
004340     EXEC SQL                                                     00434000
004350          INCLUDE TSHIPMT                                         00435000
004360     END-EXEC.                                                    00436000
004370                                                                  00437000
004400******************************************************************00440000
004500*  DB2 TABLE DECLARATION - TSHPUNT                               *00450000
004600******************************************************************00460000
004700     EXEC SQL                                                     00470000
004800          INCLUDE TSHPUNT                                         00480000
004900     END-EXEC.                                                    00490000
004910                                                                  00491000
004920******************************************************************00492000
004930*  DB2 TABLE DECLARATION - SUT_OTBND_CART                        *00493000
004940******************************************************************00494000
004950     EXEC SQL                                                     00495000
004960          INCLUDE SUT00024                                        00496000
004970     END-EXEC.                                                    00497000
005000                                                                  00500000
005100******************************************************************00510000
005200*  DB2 TABLE DECLARATION - XLT_DC_LOC_ASGMT                      *00520000
005300******************************************************************00530000
005400     EXEC SQL                                                     00540000
005500          INCLUDE XLT00014                                        00550000
005600     END-EXEC.                                                    00560000
005700                                                                  00570000
006730******************************************************************00673000
006800*  WORK AREA FOR SQL ERROR ROUTINE 'DSNTIAR'                     *00680000
006900******************************************************************00690000
007000     COPY DPWS004.                                                00700000
007100                                                                  00710000
009310                                                                  00931000
009400 LINKAGE SECTION.                                                 00940000
009500 PROCEDURE DIVISION.                                              00950000
009600******************************************************************00960000
009900 0000-PROGRAM-MAINLINE.                                           00990000
009910******************************************************************00991000
010000                                                                  01000000
010100     PERFORM 1000-INITIALIZE.                                     01010000
010200     PERFORM 2000-PROCESS-MISDIRECT-FILE                          01020000
010210       UNTIL PS-END-OF-MISDR-FILE.                                01021000
010300     PERFORM 8000-EOJ-ROUTINE.                                    01030000
010400                                                                  01040000
010500     STOP RUN.                                                    01050000
010600                                                                  01060000
010700******************************************************************01070000
011000 1000-INITIALIZE.                                                 01100000
011010******************************************************************01101000
011100                                                                  01110000
011200     DISPLAY 'START OF PROGRAM : ' PC-PGM-NAME.                   01120000
011300                                                                  01130000
011400     INITIALIZE DCLTPKSLIP.                                       01140000
011750                                                                  01175000
011800     SET PS-END-OF-MISDR-FILE-NO    TO TRUE.                      01180000
011810                                                                  01181000
011811     OPEN INPUT  INP-MISDIRECT-FILE                               01181100
011812          OUTPUT OUT-MISDIRECT-FILE.                              01181200
011820     PERFORM 1100-WRITE-OUT-HDR-REC.                              01182000
011830     PERFORM 2100-READ-MISDIR-FILE.                               01183000
011900*                                                                 01190000
011910******************************************************************01191000
012000 1100-WRITE-OUT-HDR-REC.                                          01200000
012001******************************************************************01200100
012010     WRITE OUT-MISDIRECT-RECORD FROM PV-OUTREC-HEADER.            01201000
012030*                                                                 01203000
012100******************************************************************01210000
012400 2000-PROCESS-MISDIRECT-FILE.                                     01240000
012410******************************************************************01241000
012500*                                                                 01250000
012800     PERFORM 2200-PROCESS-MISDIR-DATA.                            01280000
012900     PERFORM 2100-READ-MISDIR-FILE.                               01290000
013200*                                                                 01320000
013400******************************************************************01340000
013700 2100-READ-MISDIR-FILE.                                           01370000
013710******************************************************************01371000
013800*                                                                 01380000
013900     READ INP-MISDIRECT-FILE                                      01390000
014000          INTO SU008-EXTRACT-RECORD                               01400000
014100          AT END                                                  01410000
014110             SET PS-END-OF-MISDR-FILE TO TRUE.                    01411000
014111                                                                  01411100
014120     IF PS-END-OF-MISDR-FILE-NO THEN                              01412000
014130        ADD +1                        TO PV-TOTAL-READ            01413000
014140     END-IF.                                                      01414000
015300*                                                                 01530000
015400******************************************************************01540000
015700 2200-PROCESS-MISDIR-DATA.                                        01570000
015710******************************************************************01571000
015800*                                                                 01580000
015810     PERFORM 7000-CHECK-SHIPT-ID.                                 01581000
015820                                                                  01582000
015830     IF PS-SHIPT-ID-EXIST THEN                                    01583000
015840        PERFORM 2210-GET-CAN-INFO                                 01584000
015900        MOVE SU008-PO-NBR             TO PKSLIP-PO-NBR            01590000
016000        MOVE SU008-REC-SEQ-NBR        TO PKSLIP-REC-SEQ-NBR       01600000
016001        PERFORM 2220-FETCH-PKSL-DETAILS                           01600100
016002        PERFORM 2221-CHECK-SISTER-DC-LOC                          01600206
016003        IF PS-SISTER-DC-YES                                       01600306
016004           SET PS-SISTER-DC-NO        TO TRUE                     01600406
016005           CONTINUE                                               01600506
016006        ELSE                                                      01600606
016007           IF SQLCODE = 0 THEN                                    01600708
016008              MOVE PKSLIP-OPER-UNT-ID TO PV-PKSL-OPER-UNT-ID      01600808
016009              MOVE PKSLIP-STR-DEST-NBR                            01600908
016010                                      TO PV-PKSL-STR-NBR          01601008
016012           ELSE                                                   01601208
016013              IF SQLCODE = +100 THEN                              01601308
016014                 MOVE 0               TO PV-PKSL-OPER-UNT-ID      01601408
016015                                         PV-PKSL-STR-NBR          01601508
016016                                         PKSLIP-STR-DEST-NBR      01601608
016017              END-IF                                              01601708
016018           END-IF                                                 01601808
016019           PERFORM 2230-GET-PO-PKGNG-CDE                          01601906
016020           IF PV-PKGNG-CDE = 'PBS' THEN                           01602006
016021              PERFORM 2240-GET-OTBND-SHIPPING-INFO                01602106
016022           ELSE                                                   01602206
016023              MOVE SPACES             TO PV-LBL-CRE-SRC           01602306
016024                                         PV-LBL-PRNT-USR          01602400
016025                                         PV-SML                   01602500
016026              MOVE ZEROS              TO PV-LBL-PRNT-LOC          01602606
016027           END-IF                                                 01602706
016028           PERFORM 2250-GET-CORRECT-DC-TO-STORE                   01602806
016030           PERFORM 2300-WRITE-OUT-MISDR-REC                       01603006
016040        END-IF                                                    01604006
016041     END-IF.                                                      01604100
016105*                                                                 01610500
016106******************************************************************01610600
016107 2210-GET-CAN-INFO.                                               01610700
016108******************************************************************01610800
016109                                                                  01610900
016110     EXEC SQL                                                     01611000
016112          SELECT CARR_AUTH_ID                                     01611200
016114            INTO :SHIPMT-CARR-AUTH-ID                             01611400
016116            FROM TSHIPMT                                          01611600
016118           WHERE TRIP_ID      = :SU008-TRIP-ID                    01611800
016120             AND CARR_AUTH_ID > ' '                               01612000
016122          FETCH FIRST ROW ONLY                                    01612200
016123          WITH UR                                                 01612300
016124     END-EXEC.                                                    01612400
016125                                                                  01612500
016126     EVALUATE TRUE                                                01612600
016127         WHEN SQLCODE = 0                                         01612700
016128         WHEN SQLCODE = -811                                      01612800
016129             IF SHIPMT-CARR-AUTH-ID NOT EQUAL SPACES THEN         01612900
016130                SET PS-NUMBER-NO       TO TRUE                    01613000
016131                PERFORM 2211-REMOVE-ALPHA-FROM-CAN                01613100
016132             ELSE                                                 01613200
016133                MOVE SHIPMT-CARR-AUTH-ID                          01613300
016134                                       TO PV-CAN                  01613400
016135             END-IF                                               01613500
016136         WHEN SQLCODE = +100                                      01613600
016137             MOVE SPACES               TO PV-CAN                  01613700
016138         WHEN OTHER                                               01613800
016139             DISPLAY 'TRIP-ID ' SU008-TRIP-ID                     01613900
016140             MOVE '2210-GET-CAN-INFO'  TO PV-ABEND-PARAGRAPH      01614000
016141             MOVE 'FETCH TSHIPMT'      TO PV-DB2-OPN-ATTEMPTED    01614100
016142           PERFORM 9100-SQL-ABEND                                 01614200
016150     END-EVALUATE.                                                01615000
018400*                                                                 01840000
018500******************************************************************01850000
018600 2211-REMOVE-ALPHA-FROM-CAN.                                      01860000
018610******************************************************************01861000
018620*                                                                 01862000
018625     PERFORM                                                      01862500
018626       VARYING PV-COUNTER                                         01862600
018627       FROM 1 BY 1                                                01862700
018628       UNTIL PV-COUNTER = 30                                      01862800
018629          OR PS-NUMBER-YES                                        01862900
018630                                                                  01863000
018631           IF SHIPMT-CARR-AUTH-ID(PV-COUNTER:1) IS NUMERIC THEN   01863100
018636              COMPUTE PV-CAN-LEN  = (PC-CAN-LEN - PV-COUNTER) + 1 01863600
018637              MOVE SHIPMT-CARR-AUTH-ID(PV-COUNTER:PV-CAN-LEN)     01863700
018638                                       TO PV-CAN                  01863800
018639              SET PS-NUMBER-YES        TO TRUE                    01863900
018640           ELSE                                                   01864000
018641              IF PV-COUNTER = 30 THEN                             01864100
018642                 MOVE SPACES           TO PV-CAN                  01864200
018643              END-IF                                              01864300
018644           END-IF                                                 01864400
018645                                                                  01864500
018646     END-PERFORM.                                                 01864600
018647*                                                                 01864700
018648******************************************************************01864800
018649 2220-FETCH-PKSL-DETAILS.                                         01864900
018650******************************************************************01865000
018651                                                                  01865100
018652     EXEC SQL                                                     01865200
018653          SELECT A.OPER_UNT_ID                                    01865300
018654                ,A.STR_DEST_NBR                                   01865400
018660           INTO :PKSLIP-OPER-UNT-ID                               01866000
018670               ,:PKSLIP-STR-DEST-NBR                              01867000
018680            FROM TPKSLIP A                                        01868000
018690               , TINPKSU B                                        01869000
018691           WHERE B.SHIPT_UNT_ID = :SU008-SHIPT-UNT-ID             01869100
018692             AND B.PO_NBR       = A.PO_NBR                        01869200
018693             AND B.SEQ_NBR      = A.SEQ_NBR                       01869300
018694             AND A.VER_STAT_CDE = 'A'                             01869400
018695          WITH UR                                                 01869500
018696     END-EXEC.                                                    01869600
018697                                                                  01869700
018698     EVALUATE TRUE                                                01869800
018699         WHEN SQLCODE = 0                                         01869900
018700         WHEN SQLCODE = +100                                      01870007
018701             CONTINUE                                             01870106
018707         WHEN OTHER                                               01870700
018708             DISPLAY 'SSCC ' SU008-SHIPT-UNT-ID                   01870800
018709             MOVE '2220-FETCH-PKSL-DETAILS'                       01870900
018710                                       TO PV-ABEND-PARAGRAPH      01871000
018711             MOVE 'FETCH TPKSLIP'      TO PV-DB2-OPN-ATTEMPTED    01871100
018712           PERFORM 9100-SQL-ABEND                                 01871200
018713     END-EVALUATE.                                                01871300
018714*                                                                 01871400
018715******************************************************************01871500
018716 2221-CHECK-SISTER-DC-LOC.                                        01871606
018717******************************************************************01871700
018718*                                                                 01871806
018719     MOVE SU008-SCN-OPER-UNT-ID        TO PS-SCAN-OPER-SW         01871906
018720     MOVE PKSLIP-OPER-UNT-ID           TO PS-PKSL-OPER-SW         01872006
018721*                                                                 01872106
018722     EVALUATE TRUE                                                01872206
018723         WHEN PS-DC810                                            01872306
018724              EVALUATE TRUE                                       01872406
018725                  WHEN PS-DC810-SISTER                            01872506
018726                      SET PS-SISTER-DC-YES                        01872606
018727                                       TO TRUE                    01872706
018728                  WHEN OTHER                                      01872806
018729                      SET PS-SISTER-DC-NO                         01872906
018730                                       TO TRUE                    01873006
018731              END-EVALUATE                                        01873106
018732         WHEN PS-DC830                                            01873206
018733              EVALUATE TRUE                                       01873306
018734                  WHEN PS-DC830-SISTER1                           01873406
018735                  WHEN PS-DC830-SISTER2                           01873506
018736                      SET PS-SISTER-DC-YES                        01873606
018737                                       TO TRUE                    01873706
018738                  WHEN OTHER                                      01873806
018739                      SET PS-SISTER-DC-NO                         01873906
018740                                       TO TRUE                    01874006
018741              END-EVALUATE                                        01874106
018742         WHEN PS-DC840                                            01874206
018743              EVALUATE TRUE                                       01874306
018744                  WHEN PS-DC840-SISTER                            01874406
018746                      SET PS-SISTER-DC-YES                        01874606
018747                                       TO TRUE                    01874706
018748                  WHEN OTHER                                      01874806
018750                      SET PS-SISTER-DC-NO                         01875006
018751                                       TO TRUE                    01875106
018752              END-EVALUATE                                        01875206
018753         WHEN PS-DC855                                            01875306
018754              EVALUATE TRUE                                       01875406
018755                  WHEN PS-DC855-SISTER                            01875506
018757                      SET PS-SISTER-DC-YES                        01875706
018758                                       TO TRUE                    01875806
018759                  WHEN OTHER                                      01875906
018761                      SET PS-SISTER-DC-NO                         01876106
018762                                       TO TRUE                    01876206
018763              END-EVALUATE                                        01876306
018764         WHEN PS-DC860                                            01876406
018765              EVALUATE TRUE                                       01876506
018766                  WHEN PS-DC860-SISTER1                           01876606
018767                  WHEN PS-DC860-SISTER2                           01876706
018769                      SET PS-SISTER-DC-YES                        01876906
018770                                       TO TRUE                    01877006
018771                  WHEN OTHER                                      01877106
018773                      SET PS-SISTER-DC-NO                         01877306
018774                                       TO TRUE                    01877406
018775              END-EVALUATE                                        01877506
018776         WHEN PS-DC875                                            01877606
018777              EVALUATE TRUE                                       01877706
018778                  WHEN PS-DC875-SISTER                            01877806
018780                      SET PS-SISTER-DC-YES                        01878006
018781                                       TO TRUE                    01878106
018782                  WHEN OTHER                                      01878206
018784                      SET PS-SISTER-DC-NO                         01878406
018785                                       TO TRUE                    01878506
018786              END-EVALUATE                                        01878606
018787         WHEN PS-DC885                                            01878708
018788         WHEN PS-DC890                                            01878808
018789             SET PS-SISTER-DC-NO       TO TRUE                    01878908
018790     END-EVALUATE.                                                01879006
018791*                                                                 01879106
018792******************************************************************01879206
018793 2230-GET-PO-PKGNG-CDE.                                           01879306
018794******************************************************************01879406
018795                                                                  01879506
018796     EXEC SQL                                                     01879606
018797          SELECT PKGNG_CDE                                        01879706
018798            INTO :PV-PO-PKGNG-CDE                                 01879806
018799            FROM TPURCHS                                          01879906
018800           WHERE PO_NBR         = :SU008-PO-NBR                   01880006
018801             AND VER_STATUS_CDE = 'A'                             01880106
018802          WITH UR                                                 01880206
018803     END-EXEC.                                                    01880306
018804                                                                  01880406
018805     EVALUATE TRUE                                                01880506
018806         WHEN SQLCODE = 0                                         01880606
018807             IF PV-PO-PKGNG-CDE = SPACES                          01880706
018808                PERFORM 2231-CHECK-WHETHER-PBS                    01880806
018809             ELSE                                                 01880906
018810                MOVE PV-PO-PKGNG-CDE   TO PV-PKGNG-CDE            01881006
018811             END-IF                                               01881106
018812         WHEN SQLCODE = +100                                      01881206
018813             MOVE SPACES               TO PV-PKGNG-CDE            01881306
018814         WHEN OTHER                                               01881406
018815             DISPLAY 'PO ' SU008-PO-NBR                           01881506
018816             MOVE '2230-GET-PO-PKGNG-CDE'                         01881606
018817                                       TO PV-ABEND-PARAGRAPH      01881706
018818             MOVE 'FETCH TPURCHS'      TO PV-DB2-OPN-ATTEMPTED    01881806
018819           PERFORM 9100-SQL-ABEND                                 01881906
018820     END-EVALUATE.                                                01882006
018821*                                                                 01882106
018822******************************************************************01882206
018823 2231-CHECK-WHETHER-PBS.                                          01882306
018824******************************************************************01882406
018825*                                                                 01882506
018826     EXEC SQL                                                     01882606
018827          SELECT 1                                                01882706
018828            INTO :PV-1                                            01882806
018829            FROM TPOAGMT                                          01882906
018830           WHERE PO_NBR         = :SU008-PO-NBR                   01883006
018831             AND AGRMT_TYP_ID   = '4'                             01883106
018832             AND VER_STATUS_CDE = 'A'                             01883206
018833             AND TYP_CDE        = 4                               01883306
018834          WITH UR                                                 01883406
018835     END-EXEC.                                                    01883506
018836                                                                  01883606
018837     EVALUATE TRUE                                                01883706
018838         WHEN SQLCODE = 0                                         01883806
018839         WHEN SQLCODE = -811                                      01883906
018840             MOVE 'PBS'                TO PV-PKGNG-CDE            01884006
018841         WHEN SQLCODE = +100                                      01884106
018842             MOVE PV-PO-PKGNG-CDE      TO PV-PKGNG-CDE            01884206
018843         WHEN OTHER                                               01884306
018844             DISPLAY 'PO ' SU008-PO-NBR                           01884406
018845             MOVE '2231-CHECH-WHETHER-PBS'                        01884506
018846                                       TO PV-ABEND-PARAGRAPH      01884606
018847             MOVE 'FETCH TPOAGMT'      TO PV-DB2-OPN-ATTEMPTED    01884706
018848           PERFORM 9100-SQL-ABEND                                 01884806
018849     END-EVALUATE.                                                01884906
018850*                                                                 01885006
018851******************************************************************01885106
018852 2240-GET-OTBND-SHIPPING-INFO.                                    01885206
018853******************************************************************01885306
018854                                                                  01885406
018855     EXEC SQL                                                     01885506
018856          SELECT DISTINCT                                         01885606
018857                 B.SHIPT_UNT_ID                                   01885706
018858                ,B.ORGN_LOC_NBR                                   01885806
018859                ,B.CART_SRC_CDE                                   01885906
018860                ,B.CRE_USR_ID                                     01886006
018861            INTO :SUT00024-SHIPT-UNT-ID                           01886106
018862                ,:SUT00024-ORGN-LOC-NBR                           01886206
018863                ,:SUT00024-CART-SRC-CDE                           01886306
018864                ,:SUT00024-CRE-USR-ID                             01886406
018865            FROM SUT_OTBND_UPC  A                                 01886506
018866                ,SUT_OTBND_CART B                                 01886606
018867                ,TPKSLIP        C                                 01886706
018868                ,TINPKSU        D                                 01886806
018869                ,TSHPUNT        E                                 01886906
018870                ,TSHUUPC        F                                 01887006
018871           WHERE A.TRN_NBR          = :SU008-PO-NBR               01887106
018872             AND A.RCVR_SEQ_NBR     = :SU008-REC-SEQ-NBR          01887206
018873             AND A.SHIPT_UNT_ID     = B.SHIPT_UNT_ID              01887306
018874             AND B.DEST_LOC_NBR     = :PKSLIP-STR-DEST-NBR        01887406
018875             AND C.PO_NBR           = A.TRN_NBR                   01887506
018876             AND C.REC_SEQ_NBR      = A.RCVR_SEQ_NBR              01887606
018877             AND C.VER_STAT_CDE     = 'A'                         01887706
018878             AND C.PO_NBR           = D.PO_NBR                    01887806
018879             AND C.SEQ_NBR          = D.SEQ_NBR                   01887906
018880             AND D.SHIPT_UNT_ID     = E.SHIPT_UNT_ID              01888006
018881             AND E.DEST_OPER_UNT_ID = B.DEST_LOC_NBR              01888106
018882             AND E.SHIPT_UNT_ID     = F.SHIPT_UNT_ID              01888206
018883             AND E.SHIPT_UNT_ID     = :SU008-SHIPT-UNT-ID         01888306
018884        WITH UR                                                   01888406
018885     END-EXEC.                                                    01888506
018886     EVALUATE TRUE                                                01888606
018887         WHEN SQLCODE = 0                                         01888706
018888         WHEN SQLCODE = -811                                      01888806
018889            MOVE SUT00024-SHIPT-UNT-ID TO PV-SML                  01888906
018890            MOVE SUT00024-ORGN-LOC-NBR TO PV-LBL-PRNT-LOC         01889006
018891            MOVE SUT00024-CART-SRC-CDE TO PV-LBL-CRE-SRC          01889106
018892            MOVE SUT00024-CRE-USR-ID   TO PV-LBL-PRNT-USR         01889206
018893         WHEN SQLCODE = +100                                      01889306
018894            MOVE ZEROES                TO PV-LBL-PRNT-LOC         01889406
018895            MOVE SPACES                TO PV-LBL-CRE-SRC          01889506
018896                                          PV-LBL-PRNT-USR         01889606
018897                                          PV-SML                  01889706
018898         WHEN OTHER                                               01889806
018899             DISPLAY 'PO/RCVR ' SU008-PO-NBR '/' SU008-REC-SEQ-NBR01889906
018900             DISPLAY 'SSCC ' SU008-SHIPT-UNT-ID                   01890006
018901             MOVE '2240-GET-OTBND-SHIPPING-INFO'                  01890106
018902                                       TO PV-ABEND-PARAGRAPH      01890206
018903             MOVE 'SELECT OTBND SHIP'  TO PV-DB2-OPN-ATTEMPTED    01890306
018904           PERFORM 9100-SQL-ABEND                                 01890406
018905     END-EVALUATE.                                                01890506
018906*                                                                 01890606
018907******************************************************************01890706
018908 2250-GET-CORRECT-DC-TO-STORE.                                    01890806
018909******************************************************************01890906
018910                                                                  01891006
018911     EXEC SQL                                                     01891106
018912          SELECT A.DC_NBR                                         01891206
018913            INTO :XLT00014-DC-NBR                                 01891306
018914            FROM XLT_DC_LOC_ASGMT A                               01891406
018915           WHERE A.LOC_NBR     = :PKSLIP-STR-DEST-NBR             01891506
018916             AND A.DC_NBR     != 85                               01891606
018917             AND A.EFF_BEG_DTE = (SELECT MAX(B.EFF_BEG_DTE)       01891706
018918                                    FROM XLT_DC_LOC_ASGMT B       01891806
018919                                   WHERE B.LOC_NBR = A.LOC_NBR    01891906
018920                                 )                                01892006
018921           WITH UR                                                01892106
018922     END-EXEC.                                                    01892206
018923                                                                  01892306
018924     EVALUATE TRUE                                                01892406
018925         WHEN SQLCODE = 0                                         01892506
018926             MOVE XLT00014-DC-NBR      TO PV-DC-TO-STORE          01892606
018927         WHEN SQLCODE = +100                                      01892706
018928             MOVE ZEROES               TO PV-DC-TO-STORE          01892806
018929         WHEN OTHER                                               01892906
018930             DISPLAY 'STORE-NBR ' PKSLIP-STR-DEST-NBR             01893006
018931             MOVE '2250-GET-CORRECT-DC-TO-STORE'                  01893106
018932                                       TO PV-ABEND-PARAGRAPH      01893206
018933             MOVE 'FETCH DC FOR STORE' TO PV-DB2-OPN-ATTEMPTED    01893306
018934           PERFORM 9100-SQL-ABEND                                 01893406
018935     END-EVALUATE.                                                01893506
018936*                                                                 01893606
018937******************************************************************01893706
018938 2300-WRITE-OUT-MISDR-REC.                                        01893806
018939******************************************************************01893906
018940                                                                  01894006
019000     MOVE SU008-SCAC-CDE               TO PV-SCAC-ID.             01900000
019100     MOVE SU008-VEH-NBR                TO PV-VEH-NBR.             01910000
019200     MOVE SU008-VEND-NAME              TO PV-VEND-NAME.           01920000
019210     MOVE SU008-TRIP-ID                TO PV-TRIP-ID.             01921000
019300     MOVE SU008-PO-NBR                 TO PV-PO-NBR.              01930000
019400     MOVE SU008-REC-SEQ-NBR            TO PV-REC-SEQ-NBR.         01940000
019500     MOVE SU008-PO-TYP-CDE             TO PV-PO-TYPE.             01950000
019600     MOVE SU008-SCN-OPER-UNT-ID        TO PV-SCAN-OPER-UNT-ID.    01960000
019710     MOVE SU008-SHIPT-UNT-ID           TO PV-SSCC-CARTON-NBR.     01971000
019720     MOVE SU008-MISDIRECT-TYPE         TO PV-MISDIR-TYPE.         01972000
019730     MOVE SU008-SCN-DATE               TO PV-SCAN-DATE.           01973000
019740     MOVE SU008-SCN-TIME               TO PV-SCAN-TIME.           01974000
025260                                                                  02526000
025270     WRITE OUT-MISDIRECT-RECORD FROM PV-MISDIRECT-DETAILS.        02527000
025271     ADD +1                            TO PV-TOTAL-WRITE.         02527100
025272                                                                  02527200
025291*                                                                 02529100
025500******************************************************************02550000
025600 7000-CHECK-SHIPT-ID.                                             02560000
025610******************************************************************02561000
025700                                                                  02570000
025703     EXEC SQL                                                     02570300
025704         SELECT 1                                                 02570400
025705           INTO :PV-1                                             02570500
025706           FROM TSHPUNT                                           02570600
025707          WHERE SHIPT_UNT_ID = :SU008-SHIPT-UNT-ID                02570700
025708         WITH UR                                                  02570800
025709     END-EXEC.                                                    02570900
025710                                                                  02571000
025711     EVALUATE TRUE                                                02571100
025712         WHEN SQLCODE = 0                                         02571200
025713         WHEN SQLCODE = -811                                      02571300
025714             SET PS-SHIPT-ID-EXIST     TO TRUE                    02571400
025715         WHEN SQLCODE = +100                                      02571500
025716             SET PS-SHIPT-ID-EXIST-NO   TO TRUE                   02571600
025717         WHEN OTHER                                               02571700
025718             MOVE '7000-CHECK-SHIPT-ID'                           02571800
025719                                       TO PV-ABEND-PARAGRAPH      02571900
025720             MOVE 'SELECT TSHPUNT'     TO PV-DB2-OPN-ATTEMPTED    02572000
025721             PERFORM 9100-SQL-ABEND                               02572100
025722     END-EVALUATE.                                                02572200
025723                                                                  02572300
025730******************************************************************02573000
025740 8000-EOJ-ROUTINE.                                                02574000
025741******************************************************************02574100
025750                                                                  02575000
025800     DISPLAY 'TOTAL RECORDS READ  : ' PV-TOTAL-READ.              02580000
025900     DISPLAY 'TOTAL RECORDS WRITE : ' PV-TOTAL-WRITE.             02590000
026800     DISPLAY 'END OF PROGRAM   : ' PC-PGM-NAME.                   02680000
026900                                                                  02690000
027200******************************************************************02720000
027300* PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    *02730000
027400* ERROR OR WARNING CODE OCCURS.                                  *02740000
027500******************************************************************02750000
027600 9100-SQL-ABEND.                                                  02760000
027700                                                                  02770000
027800     DISPLAY '9100-SQL-ABEND'.                                    02780000
027900     DISPLAY '** ABEND     **'.                                   02790000
028000     DISPLAY '** PROGRAM   ** = ' PC-PGM-NAME.                    02800000
028100     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             02810000
028200     DISPLAY '** OPERATION ** = ' PV-DB2-OPN-ATTEMPTED.           02820000
028300     COPY DPPD004.                                                02830000
028400     MOVE +4013                      TO ABEND-CODE.               02840000
028500     CALL 'ILBOABN0' USING ABEND-CODE.                            02850000
028600                                                                  02860000
