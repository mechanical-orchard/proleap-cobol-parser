000100 IDENTIFICATION DIVISION.                                         00010004
000200 PROGRAM-ID.    DLKUT029.                                         00020006
000300 AUTHOR.        DENISE HAHN.                                      00030004
000400                                                                  00040004
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050004
000600 DATE-WRITTEN.  DECEMBER 2008.                                    00060004
000700 DATE-COMPILED.                                                   00070004
000800                                                                  00080004
000900 ENVIRONMENT DIVISION.                                            00090004
001000 CONFIGURATION SECTION.                                           00100004
001100 SOURCE-COMPUTER. IBM-3090.                                       00110004
001200 OBJECT-COMPUTER. IBM-3090.                                       00120004
001300                                                                  00130004
001400****************************************************************  00140004
001500*                                                              *  00150004
001600*  IF AN ASSOCIATE IS CURRENTLY ATTACHED TO 2 ACTIVE           *  00160004
001700*  ASSIGNMENTS, THIS PROGRAM IS CALLED  TO REMOVE THE          *  00170004
001800*  ASSOCIATE FROM THE ASSIGNMENTS.                             *  00180004
001900*                                                              *  00190004
002000*  THIS MODULE IS CALLED BY DLKCS410                           *  00200004
002010*                                                              *  00201004
002020*  DB2 ACCESS:                                                 *  00202004
002030*     DLT_TEM_ASGMT (DLT00003) TABLE                           *  00203004
002040*                SELECTS                                       *  00204004
002050*                                                              *  00205004
002060*     DLT_ASGMT (DLT00004) TABLE                               *  00206004
002070*                SELECTS                                       *  00207004
002080*                                                              *  00208004
002090*     TUPLDER (TUPLDER) - UPLOAD ERROR TABLE                   *  00209004
002100*                INSERTS                                       *  00210004
002200*                                                              *  00220004
002300****************************************************************  00230004
002400                                                                  00240004
002500 DATA DIVISION.                                                   00250004
002600 WORKING-STORAGE SECTION.                                         00260004
002700*                                                                 00270004
002800 01  DK-DB2-KEUS.                                                 00280004
002900     05  DK-USER-ID               PIC  X(08).                     00290004
003000*                                                                 00300004
003100 01  PV-PROGRAM-VARIABLES.                                        00310004
003200     05  PV-USR-TYP-CDE           PIC  X(01).                     00320004
003300         88  PV-USER-IS-KOHLS                VALUE 'K'.           00330004
003310         88  PV-USER-IS-TEMP                 VALUE 'T'.           00331004
003320     05  PV-DISPLAY-TEXT          PIC  XXXXX  VALUE ZEROS.        00332004
003330     05  PV-DISPLAY-SQLCODE       PIC  -999.                      00333004
003340     05  PV-DISPLAY-OPER          PIC  Z(04).                     00334004
003341     05  PV-HOLD-TIMESTAMP        PIC  X(26).                     00334104
003342     05  PV-LABOR-CURRENT-TMST    PIC  X(26).                     00334204
003343                                                                  00334304
003344     05  PV-RETRY-COUNTER         PIC S9(04) VALUE 0 COMP.        00334404
003345     05  PV-MODULE-FAIL-MSG.                                      00334504
003346         10  FILLER               PIC  X(05)  VALUE 'PARA:'.      00334604
003347         10  PV-MODULE-PARAGRPAH  PIC  X(30)  VALUE SPACE.        00334704
003348                                                                  00334804
003351     05  PV-MSG-AREA              PIC  X(80)  VALUE SPACE.        00335104
003352     05  PV-MSG-AREA2             PIC  X(100) VALUE SPACE.        00335204
003353     05  PV-MSG-HOLD.                                             00335304
003354         10  FILLER               PIC  X(01)  VALUE SPACE.        00335404
003355         10  PV-MSG-DATA          PIC  X(79)  VALUE SPACE.        00335504
003356     05  PV-COMMAREA-LENGTH       PIC S9(04)  COMP                00335604
003357                                              VALUE +0.           00335704
003358     05  PV-NULL-IND1             PIC S9(04)  VALUE ZEROS         00335804
003359                                              COMP SYNC.          00335904
003360     05  PV-NULL-IND2             PIC S9(04)  VALUE ZEROS         00336004
003370                                              COMP SYNC.          00337004
003380                                                                  00338004
003390 01  PS-SWITCHES.                                                 00339004
003400     05  PS-DISPLAY-PARA-SW           PIC X(01)  VALUE 'N'.       00340004
003500         88  PS-DISPLAY-PARA                     VALUE 'Y'.       00350004
003600         88  PS-DONT-DISPLAY-PARA                VALUE 'N'.       00360004
003700     05  PS-DISPLAY-DETAIL-SW         PIC X(01)  VALUE 'N'.       00370004
003800         88  PS-DISPLAY-DETAIL                   VALUE 'Y'.       00380004
003900         88  PS-DONT-DISPLAY-DETAIL              VALUE 'N'.       00390004
004000     05  PS-END-OF-CURSOR-SW          PIC X(01)  VALUE 'N'.       00400004
004100         88  PS-END-OF-CURSOR                    VALUE 'Y'.       00410004
004200         88  PS-END-OF-CURSOR-NO                 VALUE 'N'.       00420004
004300     05  PS-CALLED-MODULE-ERROR-SW    PIC X(01)  VALUE 'N'.       00430004
004400         88  PS-CALLED-MODULE-ERROR              VALUE 'Y'.       00440004
004500         88  PS-CALLED-MODULE-ERROR-NO           VALUE 'N'.       00450004
004600     05  PS-ERROR-SW                  PIC X(01)  VALUE 'N'.       00460004
004700         88  PS-ERROR                            VALUE 'Y'.       00470004
004800         88  PS-ERROR-NO                         VALUE 'N'.       00480004
004900                                                                  00490004
005000 01  PC-CONSTANTS.                                                00500004
005100     05  PC-MAX-RETRIES           PIC S9(04) VALUE +3 COMP.       00510004
005200     05  PC-ASTERISK-LINE         PIC X(40)  VALUE ALL '*'.       00520004
005300     05  PC-CURRENT-PROGRAM-NAME  PIC X(08)  VALUE 'DLKUT029'.    00530006
005400                                                                  00540004
005500*----------------------------------------------------------------*00550004
005600*    COMMAREA TO BE PASSED TO DLKUP025                            00560004
005700*----------------------------------------------------------------*00570004
005800     COPY DLWS021.                                                00580004
005900                                                                  00590004
006000*----------------------------------------------------------------*00600004
006100*    COMMAREA TO BE PASSED TO DKLUP046                            00610004
006200*----------------------------------------------------------------*00620004
006300     COPY XLWS091.                                                00630004
006400                                                                  00640004
006500*----------------------------------------------------------------*00650004
006600*  DLT_ASGMT - LABOR ASSIGNMENT HEADER                            00660004
006700*----------------------------------------------------------------*00670004
006800     EXEC SQL                                                     00680004
006900         INCLUDE DLT00004                                         00690004
007000     END-EXEC.                                                    00700004
007100                                                                  00710004
007200*----------------------------------------------------------------*00720004
007300*   DLT_TEM_ASGMT - ASSOCIATES THAT ARE ATTACHED TO ASSIGNMENT    00730004
007400*----------------------------------------------------------------*00740004
007500     EXEC SQL                                                     00750004
007600         INCLUDE DLT00003                                         00760004
007700     END-EXEC.                                                    00770004
007800                                                                  00780004
007900*----------------------------------------------------------------*00790004
008000*   TUPLDER - UPLOAD ERROR TABLE                                  00800004
008100*----------------------------------------------------------------*00810004
008200     EXEC SQL                                                     00820004
008210         INCLUDE TUPLDER                                          00821004
008220     END-EXEC.                                                    00822004
008230                                                                  00823004
008240*----------------------------------------------------------------*00824004
008250*                                                                 00825004
008260*----------------------------------------------------------------*00826004
008270     EXEC SQL                                                     00827004
008280          INCLUDE SQLCA                                           00828004
008290     END-EXEC.                                                    00829004
008300                                                                  00830004
008400*---------------------------------------------------------------* 00840004
008500*   CURSOR CONTAINING THE ACTIVE ASSIGNMENTS THAT THE ASSOCIATE * 00850004
008600*   IS ATTACHED TO                                              * 00860004
008610*---------------------------------------------------------------* 00861004
008620     EXEC SQL                                                     00862004
008630          DECLARE ACTIVE_ASGMT_CSR CURSOR WITH HOLD FOR           00863004
008640             SELECT A.ASGMT_STRT_DTE                              00864004
008650                   ,A.ASGMT_NBR_TXT                               00865004
008660                   ,A.ASGMT_NBR_SEQ_NBR                           00866004
008670                   ,A.TEM_ASGMT_SEQ_NBR                           00867004
008680                   ,A.KOHLS_USR_ID                                00868004
008690                   ,A.TMP_USR_ID                                  00869004
008700                   ,A.JN_TMST                                     00870004
008701                   ,A.CRE_BY_USR_ID                               00870104
008702                   ,B.ASGMT_STRT_TM                               00870204
008703                   ,B.WK_TYP_DESC                                 00870304
008704                   ,B.WK_AREA_DESC                                00870404
008705                   ,B.DC_NBR                                      00870504
008706              FROM  DLT_TEM_ASGMT   A                             00870604
008707                   ,DLT_ASGMT       B                             00870704
008708             WHERE (A.KOHLS_USR_ID      = :DK-USER-ID  OR         00870804
008709                    A.TMP_USR_ID        = :DK-USER-ID)            00870904
008710               AND  A.LVE_RSN_CDE       = 'N'                     00871004
008711               AND  B.ASGMT_STRT_DTE    =  A.ASGMT_STRT_DTE       00871104
008712               AND  B.ASGMT_NBR_TXT     =  A.ASGMT_NBR_TXT        00871204
008713               AND  B.ASGMT_NBR_SEQ_NBR =  A.ASGMT_NBR_SEQ_NBR    00871304
008714               AND  B.ASGMT_STP_RSN_CDE = 'N'                     00871404
008715           ORDER BY  A.JN_TMST                                    00871504
008716     END-EXEC.                                                    00871604
008717                                                                  00871704
008718 LINKAGE SECTION.                                                 00871804
008719     COPY DLWS025.                                                00871907
008720                                                                  00872004
008730                                                                  00873004
008740 PROCEDURE DIVISION USING DL025-ASGMT-COMMAREA.                   00874007
008750                                                                  00875004
008760     SET DL025-SUCCESSFUL                                         00876007
008770         PS-ERROR-NO       TO  TRUE.                              00877004
008780                                                                  00878004
008790     MOVE  DL025-KEY-USER-ID     TO  DK-USER-ID.                  00879007
008800     MOVE  DL025-USER-FOUND-CODE TO  PV-USR-TYP-CDE.              00880007
008900                                                                  00890004
009000     SET  PS-END-OF-CURSOR-NO TO  TRUE.                           00900004
009100                                                                  00910004
009200     PERFORM 4000-OPEN-CURSOR.                                    00920004
009300     PERFORM 4010-FETCH-CURSOR.                                   00930004
009400     IF  PS-END-OF-CURSOR-NO                                      00940004
009500         PERFORM 2000-PROCESS-CURSOR                              00950004
009600           UNTIL PS-END-OF-CURSOR                                 00960004
009700              OR PS-ERROR                                         00970004
009800     END-IF.                                                      00980004
009900     PERFORM 4020-CLOSE-CURSOR.                                   00990004
010000                                                                  01000004
010100     GOBACK.                                                      01010004
010200                                                                  01020004
010300                                                                  01030004
010400*--------------------------------------------------------------*  01040004
010500*                                                              *  01050004
010600*--------------------------------------------------------------*  01060004
010700 2000-PROCESS-CURSOR.                                             01070004
010800***  MOVE '2000-PROCESS-CURSOR '          TO PV-ABEND-PARAGRAPH.  01080004
010900***  DISPLAY 'NOW IN 2000-PROCESS-CURSOR '.                       01090004
011000                                                                  01100004
011100                                                                  01110004
011200     IF  SQLCODE = ZERO                                           01120004
011300         PERFORM 4500-INSERT-TUPLDER                              01130004
011400         PERFORM 3000-PROCESS-ASGMT                               01140004
011500         IF  PS-ERROR-NO                                          01150004
011600            PERFORM 3500-CREATE-S-MOVE                            01160004
011700         END-IF                                                   01170004
011800     END-IF.                                                      01180004
011900                                                                  01190004
012000     IF  PS-ERROR-NO                                              01200004
012100         PERFORM 4010-FETCH-CURSOR                                01210004
012200     END-IF.                                                      01220004
012300                                                                  01230004
012400                                                                  01240004
012500*--------------------------------------------------------------*  01250004
012600* THE FOLLOWING IS TO PROCESS THE CALL TO DLKUP025 TO          *  01260004
012700* END ASSOCIATE FROM AN ASSIGNMENT                             *  01270004
012800*--------------------------------------------------------------*  01280004
012810 3000-PROCESS-ASGMT.                                              01281004
012820                                                                  01282004
012821     INITIALIZE DL021-ASGMT-COMMAREA.                             01282104
012822                                                                  01282204
012823     MOVE DLT00003-ASGMT-STRT-DTE TO  DL021-KEY-START-DTE.        01282304
012824     MOVE DLT00003-ASGMT-NBR-TXT  TO  DL021-KEY-NBR-TXT.          01282404
012825     MOVE DLT00003-ASGMT-NBR-SEQ-NBR                              01282504
012826                                  TO  DL021-KEY-NBR-SEQ-NBR.      01282604
012827     MOVE DLT00003-TEM-ASGMT-SEQ-NBR                              01282704
012828                                  TO  DL021-KEY-TEM-ASGMT-SEQ-NBR.01282804
012829     MOVE DL025-KEY-USER-ID       TO  DL021-KEY-ADD-BY-USER-ID    01282907
012830                                      DL021-KEY-USER-ID.          01283004
012831     MOVE PV-USR-TYP-CDE          TO  DL021-KEY-USR-TYPE-CDE.     01283104
012832     MOVE PC-CURRENT-PROGRAM-NAME TO  DL021-KEY-LVE-PGM-NM        01283204
012833                                      DL021-ORIG-CALLING-PGM-NM.  01283304
012834                                                                  01283404
012835     SET DL021-BY-ASGMT-NBR                                       01283504
012836         DL021-END-FROM-ASGMT                                     01283604
012837         DL021-COMMIT-UPDATE                                      01283704
012838         DL021-KEY-LVE-RSN-SMOVE                                  01283804
012839         PS-CALLED-MODULE-ERROR-NO TO TRUE.                       01283904
012840                                                                  01284004
012841     MOVE ' END ' TO PV-DISPLAY-TEXT.                             01284104
012842                                                                  01284204
012843     PERFORM 6300-CALL-DLKUP025.                                  01284304
012844                                                                  01284404
012845     IF  PS-CALLED-MODULE-ERROR                                   01284504
012846         SET PS-ERROR           TO TRUE                           01284604
012847         MOVE 'DLKUP025'        TO DL025-CALL-MOD-FAIL-NM         01284707
012848         MOVE DL021-RETURN-CODE TO DL025-CALL-MOD-FAIL-ERR-CDE    01284807
012849         SET DL025-CALLED-MODULE-FAILURE TO TRUE                  01284907
012850         IF  DL021-SQL-ERROR                                      01285004
012851             MOVE DL021-ASGMT-SQLCODE TO                          01285104
012852                  DL025-CALL-MOD-FAIL-SQL-CDE                     01285207
012853             MOVE DL021-SQL-ERROR-PARA TO                         01285304
012854                  DL025-CALL-MOD-FAIL-SQL-PARA                    01285407
012855         END-IF                                                   01285504
012856     END-IF.                                                      01285604
012857                                                                  01285704
012858                                                                  01285804
012859 3220-GET-TIMESTAMP.                                              01285904
012860                                                                  01286004
012861     EXEC SQL                                                     01286104
012862          SET  :PV-LABOR-CURRENT-TMST =                           01286204
012863               (TIMESTAMP(:PV-HOLD-TIMESTAMP) - 1 SECOND)         01286304
012864     END-EXEC.                                                    01286404
012865                                                                  01286504
012866                                                                  01286604
012867*--------------------------------------------------------------*  01286704
012868* THE FOLLOWING IS TO PROCESS THE CALL TO DKLUP046 TO LOG AN   *  01286804
012869* INDIRECT CODE OF AN S (SYSTEM) MOVE FOR THE ASSOCIATE        *  01286904
012870*--------------------------------------------------------------*  01287004
012871 3500-CREATE-S-MOVE.                                              01287104
012872                                                                  01287204
012873     INITIALIZE XL091-EAI-EXPORT-COMMAREA.                        01287304
012874                                                                  01287404
012875     SET XL091-PC-APP-ID                                          01287504
012876         XL091-COMMIT-UPDATE TO TRUE.                             01287604
012877                                                                  01287704
012878     MOVE PC-CURRENT-PROGRAM-NAME TO XL091-CRE-PGM-NM.            01287804
012879                                                                  01287904
012880     MOVE ZEROES                  TO XL091-EVNT-KY-1-NBR          01288004
012881                                     XL091-EVNT-KY-2-NBR          01288104
012882                                     XL091-EVNT-KY-3-NBR          01288204
012883                                     XL091-EVNT-KY-4-NBR          01288304
012884                                     XL091-EVNT-KY-5-NBR.         01288404
012885                                                                  01288504
012886     MOVE SPACES                  TO XL091-EVNT-KY-1-TXT          01288604
012887                                     XL091-EVNT-KY-2-TXT          01288704
012888                                     XL091-EVNT-KY-3-TXT          01288804
012889                                     XL091-EVNT-KY-4-TXT          01288904
012890                                     XL091-EVNT-KY-5-TXT          01289004
012891                                     XL091-EVNT-KY-1-TMST         01289104
012892                                     XL091-EVNT-KY-2-TMST         01289204
012893                                     XL091-EVNT-KY-3-TMST         01289304
012894                                     XL091-EVNT-KY-4-TMST         01289404
012895                                     XL091-EVNT-KY-5-TMST.        01289504
012896                                                                  01289604
012897     MOVE 'DC LABOR'          TO XL091-EVNT-OBJ-TXT.              01289704
012898     MOVE 'INDIRECT LABOR'    TO XL091-EVNT-OBJ-ACTN-TXT.         01289804
012899     MOVE DL025-KEY-USER-ID   TO XL091-CRE-BY-USR-ID.             01289907
012900     MOVE DL025-KEY-DC-NBR    TO XL091-EVNT-KY-1-NBR.             01290007
012901**                                                                01290104
012902     IF  DLT00004-WK-TYP-DESC   = 'RECV'                          01290204
012903         MOVE 'SRMOVE'        TO XL091-EVNT-KY-1-TXT              01290304
012904     END-IF.                                                      01290404
012905     IF  DLT00004-WK-TYP-DESC   = 'SHIP'                          01290504
012906         MOVE 'SSMOVE'        TO XL091-EVNT-KY-1-TXT              01290604
012907     END-IF.                                                      01290704
012908     IF  DLT00004-WK-TYP-DESC   = 'P2L'                           01290804
012909         MOVE 'SPMOVE'        TO XL091-EVNT-KY-1-TXT              01290904
012910     END-IF.                                                      01291004
012911     IF  DLT00004-WK-TYP-DESC   = 'FLAT'                          01291104
012912         MOVE 'SFMOVE'        TO XL091-EVNT-KY-1-TXT              01291204
012913     END-IF.                                                      01291304
012914     IF  DLT00004-WK-TYP-DESC   = 'RLABL'                         01291404
012915         MOVE 'SLMOVE'        TO XL091-EVNT-KY-1-TXT              01291504
012916     END-IF.                                                      01291604
012917     IF  DLT00004-WK-TYP-DESC   = 'MASTCON'                       01291704
012918         MOVE 'SMMOVE'        TO XL091-EVNT-KY-1-TXT              01291804
012919     END-IF.                                                      01291904
012920                                                                  01292004
012921     MOVE DL021-ASSOC-TMST    TO PV-HOLD-TIMESTAMP.               01292104
012922     PERFORM 3220-GET-TIMESTAMP.                                  01292204
012923     MOVE PV-LABOR-CURRENT-TMST  TO  XL091-EVNT-KY-1-TMST.        01292304
012924                                                                  01292404
012925     SET XL091-COPYBOOK-NOT-USED TO TRUE.                         01292504
012926                                                                  01292604
012927     PERFORM 6500-CALL-DKLUP046.                                  01292704
012928                                                                  01292804
012929     IF  PS-CALLED-MODULE-ERROR                                   01292904
012930         SET PS-ERROR TO TRUE                                     01293004
012931         MOVE 'DKLUP046'        TO DL025-CALL-MOD-FAIL-NM         01293107
012932         MOVE XL091-RETURN-CODE TO DL025-CALL-MOD-FAIL-ERR-CDE    01293207
012933         SET DL025-CALLED-MODULE-FAILURE TO TRUE                  01293307
012934         IF  XL091-SQL-ERROR                                      01293404
012935             MOVE XL091-EAI-DB-SQLCODE TO                         01293504
012936                  DL025-CALL-MOD-FAIL-SQL-CDE                     01293607
012937             MOVE XL091-SQL-ERROR-PARA TO                         01293704
012938                  DL025-CALL-MOD-FAIL-SQL-PARA                    01293807
012939         END-IF                                                   01293904
012940     END-IF.                                                      01294004
012950                                                                  01295004
012951                                                                  01295104
012952*--------------------------------------------------------------*  01295204
012953*                                                              *  01295304
012954*--------------------------------------------------------------*  01295404
012955 4000-OPEN-CURSOR.                                                01295504
012956***  MOVE '4000-OPEN-CURSOR'             TO PV-ABEND-PARAGRAPH.   01295604
012957***  DISPLAY 'NOW IN 1000-OPEN-CURSOR '.                          01295704
012958                                                                  01295804
012959     PERFORM                                                      01295904
012960         WITH TEST AFTER                                          01296004
012961             VARYING PV-RETRY-COUNTER                             01296104
012962             FROM 1 BY 1                                          01296204
012963             UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES              01296304
012964                OR SQLCODE = ZERO                                 01296404
012965                                                                  01296504
012966         EXEC SQL                                                 01296604
012967              OPEN  ACTIVE_ASGMT_CSR                              01296704
012968         END-EXEC                                                 01296804
012969                                                                  01296904
012970         EVALUATE TRUE                                            01297004
012971             WHEN SQLCODE = ZERO                                  01297104
012972                  CONTINUE                                        01297204
012973                                                                  01297304
012974             WHEN SQLCODE = +100                                  01297404
012975             WHEN SQLCODE = -904                                  01297504
012976             WHEN SQLCODE = -913                                  01297604
012977             WHEN SQLCODE = -911                                  01297704
012978             WHEN SQLWARN0 NOT = SPACES                           01297804
012979             WHEN SQLCODE NOT = ZERO                              01297904
012980                  MOVE +4             TO PV-RETRY-COUNTER         01298004
012981         END-EVALUATE                                             01298104
012982     END-PERFORM.                                                 01298204
012983                                                                  01298304
012984                                                                  01298404
012985     IF  SQLCODE = ZERO                                           01298504
012986         CONTINUE                                                 01298604
012987     ELSE                                                         01298704
012988         IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                    01298804
012989             MOVE '4000-'         TO DL025-CALL-MOD-FAIL-SQL-PARA 01298907
012990             MOVE SQLCODE         TO DL025-ASGMT-SQLCODE          01299007
012991             SET DL025-SQL-ERROR  TO TRUE                         01299107
012992             MOVE SQLCA           TO DL025-SQLCA                  01299207
012993                                                                  01299304
012994             MOVE SPACES TO PV-MSG-AREA2                          01299404
012995             MOVE DL025-KEY-DC-NBR  TO  PV-DISPLAY-OPER           01299507
012996             STRING ' DLKUT029 -'                                 01299606
012997                    PV-DISPLAY-OPER  '-'                          01299704
012998                    DL025-KEY-WK-TYP '-'                          01299807
012999                    DL025-KEY-WK-AREA '-'                         01299907
013000                    DL025-KEY-USER-ID '-'                         01300007
013001                    DL025-USER-FOUND-CODE    DELIMITED BY SIZE    01300107
013002                                        INTO PV-MSG-AREA2         01300204
013003             MOVE LENGTH OF PV-MSG-AREA2                          01300304
013004               TO PV-COMMAREA-LENGTH                              01300404
013005             PERFORM 9200-WRITE-TO-LOG                            01300504
013006                                                                  01300604
013007             MOVE SPACES TO PV-MSG-AREA2                          01300704
013008             MOVE SQLCODE          TO  PV-DISPLAY-SQLCODE         01300804
013009             STRING ' DLKUT029 -'                                 01300906
013010                   ' PARA: 4000 - '                               01301004
013011                   ' SQLCODE: '        PV-DISPLAY-SQLCODE         01301104
013012                                       DELIMITED BY SIZE          01301204
013013                                  INTO PV-MSG-AREA2               01301304
013014             MOVE LENGTH OF PV-MSG-AREA2                          01301404
013015               TO PV-COMMAREA-LENGTH                              01301504
013016             PERFORM 9200-WRITE-TO-LOG                            01301604
013017        END-IF                                                    01301704
013018     END-IF.                                                      01301804
013019                                                                  01301904
013020                                                                  01302004
013021*--------------------------------------------------------------*  01302104
013022*                                                              *  01302204
013023*--------------------------------------------------------------*  01302304
013024 4010-FETCH-CURSOR.                                               01302404
013025***  MOVE '4010-PROCESS-CURSOR '          TO PV-ABEND-PARAGRAPH.  01302504
013026***  DISPLAY 'NOW IN 4010-PROCESS-CURSOR '.                       01302604
013027                                                                  01302704
013028     PERFORM                                                      01302804
013029         WITH TEST AFTER                                          01302904
013030         VARYING PV-RETRY-COUNTER                                 01303004
013031         FROM 1 BY 1                                              01303104
013032         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  01303204
013033            OR SQLCODE = ZERO                                     01303304
013034            OR SQLCODE = +100                                     01303404
013035                                                                  01303504
013036         EXEC SQL                                                 01303604
013037             FETCH  ACTIVE_ASGMT_CSR                              01303704
013038                                                                  01303804
013039              INTO :DLT00003-ASGMT-STRT-DTE                       01303904
013040                 , :DLT00003-ASGMT-NBR-TXT                        01304004
013041                 , :DLT00003-ASGMT-NBR-SEQ-NBR                    01304104
013042                 , :DLT00003-TEM-ASGMT-SEQ-NBR                    01304204
013043                 , :DLT00003-KOHLS-USR-ID  :PV-NULL-IND1          01304304
013044                 , :DLT00003-TMP-USR-ID    :PV-NULL-IND2          01304404
013045                 , :DLT00003-JN-TMST                              01304504
013046                 , :DLT00003-CRE-BY-USR-ID                        01304604
013047                 , :DLT00004-ASGMT-STRT-TM                        01304704
013048                 , :DLT00004-WK-TYP-DESC                          01304804
013049                 , :DLT00004-WK-AREA-DESC                         01304904
013050                 , :DLT00004-DC-NBR                               01305004
013051                                                                  01305104
013052         END-EXEC                                                 01305204
013053                                                                  01305304
013054         EVALUATE TRUE                                            01305404
013055             WHEN SQLCODE = ZERO                                  01305504
013056                  IF  PV-NULL-IND1  =  -1                         01305604
013057                      MOVE  SPACES  TO  DLT00003-KOHLS-USR-ID     01305704
013058                  END-IF                                          01305804
013059                  IF  PV-NULL-IND2  =  -1                         01305904
013060                      MOVE  SPACES  TO  DLT00003-TMP-USR-ID       01306004
013061                  END-IF                                          01306104
013062                                                                  01306204
013063             WHEN SQLCODE = +100                                  01306304
013064                  SET PS-END-OF-CURSOR TO TRUE                    01306404
013065                                                                  01306504
013066             WHEN SQLCODE = -904                                  01306604
013067             WHEN SQLCODE = -911                                  01306704
013068             WHEN SQLCODE = -913                                  01306804
013069             WHEN SQLWARN0 NOT = SPACES                           01306904
013070             WHEN SQLCODE NOT = ZERO                              01307004
013071                  MOVE +4             TO PV-RETRY-COUNTER         01307104
013072         END-EVALUATE                                             01307204
013073     END-PERFORM.                                                 01307304
013074                                                                  01307404
013075     IF SQLCODE = ZERO  OR                                        01307504
013076        SQLCODE = +100                                            01307604
013077        CONTINUE                                                  01307704
013078     ELSE                                                         01307804
013079        IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                     01307904
013080            MOVE '4010-'         TO DL025-CALL-MOD-FAIL-SQL-PARA  01308007
013081            MOVE SQLCODE         TO DL025-ASGMT-SQLCODE           01308107
013082            SET DL025-SQL-ERROR  TO TRUE                          01308207
013083            SET PS-ERROR         TO TRUE                          01308304
013084            MOVE SQLCA           TO DL025-SQLCA                   01308407
013085                                                                  01308504
013086             MOVE SPACES TO PV-MSG-AREA2                          01308604
013087             MOVE DL025-KEY-DC-NBR  TO  PV-DISPLAY-OPER           01308707
013088             STRING ' DLKUT029 -'                                 01308806
013089                    PV-DISPLAY-OPER  '-'                          01308904
013090                    DL025-KEY-WK-TYP '-'                          01309007
013091                    DL025-KEY-WK-AREA '-'                         01309107
013092                    DL025-KEY-USER-ID '-'                         01309207
013093                    DL025-USER-FOUND-CODE    DELIMITED BY SIZE    01309307
013094                                        INTO PV-MSG-AREA2         01309404
013095             MOVE LENGTH OF PV-MSG-AREA2                          01309504
013096               TO PV-COMMAREA-LENGTH                              01309604
013097             PERFORM 9200-WRITE-TO-LOG                            01309704
013098                                                                  01309804
013099             MOVE SPACES TO PV-MSG-AREA2                          01309904
013100             MOVE SQLCODE           TO  PV-DISPLAY-SQLCODE        01310004
013101             STRING ' DLKUT029 -'                                 01310106
013102                   ' PARA: 4010 - '                               01310204
013103                   ' SQLCODE: '        PV-DISPLAY-SQLCODE         01310304
013104                                       DELIMITED BY SIZE          01310404
013105                                  INTO PV-MSG-AREA2               01310504
013106             MOVE LENGTH OF PV-MSG-AREA2                          01310604
013107               TO PV-COMMAREA-LENGTH                              01310704
013108             PERFORM 9200-WRITE-TO-LOG                            01310804
013109        END-IF                                                    01310904
013110     END-IF.                                                      01311004
013111                                                                  01311104
013112                                                                  01311204
013113*--------------------------------------------------------------*  01311304
013114*                                                              *  01311404
013115*--------------------------------------------------------------*  01311504
013116 4020-CLOSE-CURSOR.                                               01311604
013117**** MOVE '3000-CLOSE-CURSOR'             TO PV-ABEND-PARAGRAPH.  01311704
013118***  DISPLAY 'NOW IN  3000-CLOSE-CURSOR'.                         01311804
013119                                                                  01311904
013120     PERFORM                                                      01312004
013121         WITH TEST AFTER                                          01312104
013122         VARYING PV-RETRY-COUNTER                                 01312204
013123         FROM 1 BY 1                                              01312304
013124         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  01312404
013125            OR SQLCODE = ZERO                                     01312504
013126                                                                  01312604
013127         EXEC SQL                                                 01312704
013128              CLOSE ACTIVE_ASGMT_CSR                              01312804
013129         END-EXEC                                                 01312904
013130                                                                  01313004
013131         EVALUATE TRUE                                            01313104
013132             WHEN SQLCODE = ZERO                                  01313204
013133                  CONTINUE                                        01313304
013134                                                                  01313404
013135             WHEN SQLCODE = -904                                  01313504
013136             WHEN SQLCODE = -913                                  01313604
013137             WHEN SQLCODE = -911                                  01313704
013138             WHEN SQLCODE = +100                                  01313804
013139             WHEN SQLWARN0 NOT = SPACES                           01313904
013140             WHEN SQLCODE NOT = ZERO                              01314004
013141                  MOVE +4             TO PV-RETRY-COUNTER         01314104
013142         END-EVALUATE                                             01314204
013143     END-PERFORM.                                                 01314304
013144                                                                  01314404
013145     IF SQLCODE = ZERO                                            01314504
013146        CONTINUE                                                  01314604
013147     ELSE                                                         01314704
013148        IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                     01314804
013149            MOVE '3000-'         TO DL025-CALL-MOD-FAIL-SQL-PARA  01314907
013150            MOVE SQLCODE         TO DL025-ASGMT-SQLCODE           01315007
013151            SET DL025-SQL-ERROR  TO TRUE                          01315107
013152            MOVE SQLCA           TO DL025-SQLCA                   01315207
013153                                                                  01315304
013154             MOVE SPACES TO PV-MSG-AREA2                          01315404
013155             MOVE DL025-KEY-DC-NBR  TO  PV-DISPLAY-OPER           01315507
013156             STRING ' DLKUT029 -'                                 01315606
013157                    PV-DISPLAY-OPER  '-'                          01315704
013158                    DL025-KEY-WK-TYP '-'                          01315807
013159                    DL025-KEY-WK-AREA '-'                         01315907
013160                    DL025-KEY-USER-ID '-'                         01316007
013161                    DL025-USER-FOUND-CODE    DELIMITED BY SIZE    01316107
013162                                        INTO PV-MSG-AREA2         01316204
013163             MOVE LENGTH OF PV-MSG-AREA2                          01316304
013164               TO PV-COMMAREA-LENGTH                              01316404
013165             PERFORM 9200-WRITE-TO-LOG                            01316504
013166                                                                  01316604
013167             MOVE SPACES TO PV-MSG-AREA2                          01316704
013168             MOVE SQLCODE           TO  PV-DISPLAY-SQLCODE        01316804
013169             STRING ' DLKUT029 -'                                 01316906
013170                   ' PARA: 4020 - '                               01317004
013171                   ' SQLCODE: '        PV-DISPLAY-SQLCODE         01317104
013172                                       DELIMITED BY SIZE          01317204
013173                                  INTO PV-MSG-AREA2               01317304
013174             MOVE LENGTH OF PV-MSG-AREA2                          01317404
013175               TO PV-COMMAREA-LENGTH                              01317504
013176             PERFORM 9200-WRITE-TO-LOG                            01317604
013177        END-IF                                                    01317704
013178     END-IF.                                                      01317804
013179                                                                  01317904
013180                                                                  01318004
013181 4500-INSERT-TUPLDER.                                             01318104
013182                                                                  01318204
013183     MOVE DLT00004-DC-NBR              TO UPLDER-OPER-UNT-ID.     01318304
013184     MOVE 'F'                          TO UPLDER-UPLD-TRN-CDE.    01318405
013185     MOVE '101'                        TO UPLDER-ERR-CDE.         01318504
013186     MOVE  0                           TO UPLDER-UPLD-SEQ-NBR.    01318604
013187                                                                  01318704
013188     INITIALIZE  UPLDER-PKT-TXT.                                  01318804
013189     MOVE DLT00004-DC-NBR  TO  PV-DISPLAY-OPER                    01318904
013190     STRING   PV-DISPLAY-OPER         ' '                         01319004
013191              DL025-KEY-USER-ID       ' '                         01319107
013192              DLT00004-WK-TYP-DESC    ' '                         01319204
013193              DLT00004-WK-AREA-DESC   ' '                         01319304
013194              DLT00003-ASGMT-STRT-DTE ' '                         01319404
013195              DLT00003-ASGMT-NBR-TXT  ' '                         01319504
013196              DLT00003-JN-TMST        DELIMITED BY SIZE           01319604
013197                                     INTO UPLDER-PKT-TXT.         01319704
013198                                                                  01319804
013199     EXEC SQL                                                     01319904
013200         INSERT                                                   01320004
013201           INTO TUPLDER                                           01320104
013202             ( OPER_UNT_ID                                        01320204
013203             , UPLD_TRN_CDE                                       01320304
013204             , ERR_CDE                                            01320404
013205             , PRC_TMST                                           01320504
013206             , UPLD_SEQ_NBR                                       01320604
013207             , PKT_TXT                                            01320704
013208             )                                                    01320804
013209             VALUES                                               01320904
013210             ( :UPLDER-OPER-UNT-ID                                01321004
013211             , :UPLDER-UPLD-TRN-CDE                               01321104
013212             , :UPLDER-ERR-CDE                                    01321204
013213             ,  CURRENT TIMESTAMP                                 01321304
013214             , :UPLDER-UPLD-SEQ-NBR                               01321404
013215             , :UPLDER-PKT-TXT                                    01321504
013216             )                                                    01321604
013217     END-EXEC.                                                    01321704
013218                                                                  01321804
013219     EVALUATE TRUE                                                01321904
013220         WHEN SQLCODE = ZERO                                      01322004
013221             CONTINUE                                             01322104
013222         WHEN SQLWARN0 NOT = SPACES                               01322204
013223         WHEN SQLCODE  NOT = ZERO                                 01322304
013224                                                                  01322404
013225            MOVE '4500-'         TO DL025-CALL-MOD-FAIL-SQL-PARA  01322507
013226            MOVE SQLCODE         TO DL025-ASGMT-SQLCODE           01322607
013227            SET DL025-SQL-ERROR  TO TRUE                          01322707
013228            MOVE SQLCA           TO DL025-SQLCA                   01322807
013229                                                                  01322904
013230             MOVE SPACES TO PV-MSG-AREA2                          01323004
013231             MOVE DL025-KEY-DC-NBR  TO  PV-DISPLAY-OPER           01323107
013232             STRING ' DLKUT029 -'                                 01323206
013233                    PV-DISPLAY-OPER  '-'                          01323304
013234                    DL025-KEY-WK-TYP '-'                          01323407
013235                    DL025-KEY-WK-AREA '-'                         01323507
013236                    DL025-KEY-USER-ID '-'                         01323607
013237                    DL025-USER-FOUND-CODE    DELIMITED BY SIZE    01323707
013238                                        INTO PV-MSG-AREA2         01323804
013239             MOVE LENGTH OF PV-MSG-AREA2                          01323904
013240               TO PV-COMMAREA-LENGTH                              01324004
013241             PERFORM 9200-WRITE-TO-LOG                            01324104
013242                                                                  01324204
013243             MOVE SPACES TO PV-MSG-AREA2                          01324304
013244             MOVE SQLCODE           TO  PV-DISPLAY-SQLCODE        01324404
013245             STRING ' DLKUT029 -'                                 01324506
013246                   ' PARA: 4500-INSERT-TUPLDER'                   01324604
013247                   ' SQLCODE: '        PV-DISPLAY-SQLCODE         01324704
013248                                       DELIMITED BY SIZE          01324804
013249                                  INTO PV-MSG-AREA2               01324904
013250             MOVE LENGTH OF PV-MSG-AREA2                          01325004
013251               TO PV-COMMAREA-LENGTH                              01325104
013252             PERFORM 9200-WRITE-TO-LOG                            01325204
013253                                                                  01325304
013254     END-EVALUATE.                                                01325404
013255                                                                  01325504
013256*-----------------------------------------------------------------01325604
013257*  CALL DLKUP025 TO EITHER END THE ASSOCIATE FORM AN ASSIGNMENT  *01325704
013258*  OR ADD THE ASSOCIATE TO AN ASSIGNMENT.                        *01325804
013259*-----------------------------------------------------------------01325904
013260 6300-CALL-DLKUP025.                                              01326004
013261                                                                  01326104
013262     CALL DL021-USER-PGM USING DL021-ASGMT-COMMAREA.              01326204
013265                                                                  01326504
013266     EVALUATE TRUE                                                01326604
013267         WHEN DL021-SUCCESSFUL                                    01326704
013268             CONTINUE                                             01326804
013269         WHEN OTHER                                               01326904
013270             SET PS-CALLED-MODULE-ERROR TO TRUE                   01327004
013271             MOVE SPACES TO PV-MSG-AREA2                          01327104
013272             STRING ' DLKUT029 - '           DELIMITED BY SIZE    01327206
013273                    'CALLED MODULE FAILED'   DELIMITED BY SIZE    01327304
013274                                           INTO PV-MSG-AREA2      01327404
013275             MOVE LENGTH OF PV-MSG-AREA2                          01327504
013276               TO PV-COMMAREA-LENGTH                              01327604
013277             PERFORM 9200-WRITE-TO-LOG                            01327704
013278                                                                  01327804
013279             MOVE SPACES TO PV-MSG-AREA2                          01327904
013280             MOVE '6300-CALL-DLKUP025' TO PV-MODULE-PARAGRPAH     01328004
013281             MOVE DL021-ASGMT-SQLCODE  TO PV-DISPLAY-SQLCODE      01328104
013282             STRING ' DLKUT029 - '        PV-MODULE-FAIL-MSG      01328206
013283                    ' TO '                PV-DISPLAY-TEXT         01328304
013284                    ' ASSIGNMENT'                                 01328404
013285                    ' RETURN CODE: '      DL021-RETURN-CODE       01328504
013286                    ' SQLCODE: '          PV-DISPLAY-SQLCODE      01328604
013287                                          DELIMITED BY SIZE       01328704
013288                                     INTO PV-MSG-AREA2            01328804
013289             MOVE LENGTH OF PV-MSG-AREA2                          01328904
013290               TO PV-COMMAREA-LENGTH                              01329004
013291             PERFORM 9200-WRITE-TO-LOG                            01329104
013292                                                                  01329204
013293             MOVE SPACES TO PV-MSG-AREA2                          01329304
013294             MOVE DL025-KEY-DC-NBR  TO  PV-DISPLAY-OPER           01329407
013295             STRING ' DLKUT029 -'                                 01329506
013296                    PV-DISPLAY-OPER  '-'                          01329604
013297                    DL025-KEY-WK-TYP '-'                          01329707
013298                    DL025-KEY-WK-AREA '-'                         01329807
013299                    DL025-KEY-USER-ID '-'                         01329907
013300                    DL025-USER-FOUND-CODE    DELIMITED BY SIZE    01330007
013301                                        INTO PV-MSG-AREA2         01330104
013302             MOVE LENGTH OF PV-MSG-AREA2                          01330204
013303               TO PV-COMMAREA-LENGTH                              01330304
013304             PERFORM 9200-WRITE-TO-LOG                            01330404
013305     END-EVALUATE.                                                01330504
013306                                                                  01330604
013307                                                                  01330704
013308*-----------------------------------------------------------------01330804
013309*  CALL DKLUP046 TO LOG AN INDIRECT SYSTEM MOVE TO THE EAI       *01330904
013310*  BUSINESS EVENT TABLES.                                        *01331004
013311*-----------------------------------------------------------------01331104
013312 6500-CALL-DKLUP046.                                              01331204
013313                                                                  01331304
013314     CALL XL091-USER-PGM USING XL091-EAI-EXPORT-COMMAREA.         01331404
013317                                                                  01331704
013318     EVALUATE TRUE                                                01331804
013319         WHEN XL091-SUCCESSFUL                                    01331904
013320             CONTINUE                                             01332004
013321         WHEN OTHER                                               01332104
013322             SET PS-CALLED-MODULE-ERROR TO TRUE                   01332204
013323             MOVE SPACES TO PV-MSG-AREA2                          01332304
013324             STRING ' DLKUT029 - '                                01332406
013325                    'CALLED MODULE FAILED'   DELIMITED BY SIZE    01332504
013326                                           INTO PV-MSG-AREA2      01332604
013327             MOVE LENGTH OF PV-MSG-AREA2                          01332704
013328               TO PV-COMMAREA-LENGTH                              01332804
013329             PERFORM 9200-WRITE-TO-LOG                            01332904
013330                                                                  01333004
013331             MOVE SPACES TO PV-MSG-AREA2                          01333104
013332             MOVE '6500-CALL-DKLUP046' TO PV-MODULE-PARAGRPAH     01333204
013333             MOVE XL091-EAI-DB-SQLCODE TO PV-DISPLAY-SQLCODE      01333304
013334             STRING ' DLKUT029 - '        PV-MODULE-FAIL-MSG      01333406
013335                    ' RETURN CODE: '      XL091-RETURN-CODE       01333504
013336                    ' SQLCODE: '          PV-DISPLAY-SQLCODE      01333604
013337                                          DELIMITED BY SIZE       01333704
013338                                     INTO PV-MSG-AREA2            01333804
013339             MOVE LENGTH OF PV-MSG-AREA2                          01333904
013340               TO PV-COMMAREA-LENGTH                              01334004
013341             PERFORM 9200-WRITE-TO-LOG                            01334104
013342                                                                  01334204
013343             MOVE SPACES TO PV-MSG-AREA2                          01334304
013344             MOVE DL025-KEY-DC-NBR  TO  PV-DISPLAY-OPER           01334407
013345             STRING ' DLKUT029 -'                                 01334506
013346                    PV-DISPLAY-OPER  '-'                          01334604
013347                    DL025-KEY-WK-TYP '-'                          01334707
013348                    DL025-KEY-WK-AREA '-'                         01334807
013349                    DL025-KEY-USER-ID '-'                         01334907
013350                    DL025-USER-FOUND-CODE    DELIMITED BY SIZE    01335007
013351                                        INTO PV-MSG-AREA2         01335104
013352             MOVE LENGTH OF PV-MSG-AREA2                          01335204
013353               TO PV-COMMAREA-LENGTH                              01335304
013354             PERFORM 9200-WRITE-TO-LOG                            01335404
013355     END-EVALUATE.                                                01335504
013356                                                                  01335604
013357                                                                  01335704
013358 9200-WRITE-TO-LOG.                                               01335804
013359                                                                  01335904
013360     DISPLAY PV-MSG-AREA2.                                        01336004
013367                                                                  01336704
