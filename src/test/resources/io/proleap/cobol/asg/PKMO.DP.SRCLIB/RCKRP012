000100***************************************************************** 00010024
000200 IDENTIFICATION DIVISION.                                         00020024
000300***************************************************************** 00030024
000400                                                                  00040024
000500 PROGRAM-ID.             RCKRP012.                                00050024
000600 AUTHOR.                 DENNIS STEFFEN - OMNI RESOURCES.         00060024
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070024
000800 DATE-WRITTEN            APRIL 1996.                              00080024
000900 DATE-COMPILED.                                                   00090024
001000                                                                  00100024
001100***************************************************************** 00110024
001200*                                                               * 00120024
001300*  THIS PROGRAM WILL CREATE THE WEEKLY VERIFIED POSTED RECEIPT  * 00130024
001400*  AUDIT REPORT FROM AN EXTRACT FILE.                           * 00140024
001500*                                                               * 00150024
001600***************************************************************** 00160024
001700*                                                               * 00170024
001800***************************************************************** 00180024
001900 ENVIRONMENT DIVISION.                                            00190024
002000***************************************************************** 00200024
002100                                                                  00210024
002200 CONFIGURATION SECTION.                                           00220024
002300                                                                  00230024
002400 SOURCE-COMPUTER.        IBM-3090.                                00240024
002500 OBJECT-COMPUTER.        IBM-3090.                                00250024
002600                                                                  00260024
002700 INPUT-OUTPUT SECTION.                                            00270024
002800                                                                  00280024
002900 FILE-CONTROL.                                                    00290024
003000                                                                  00300024
003100     SELECT CONDENSED-RC015-FILE                                  00310024
003200         ASSIGN TO IN01.                                          00320024
003300                                                                  00330024
003400     SELECT RECV-REPORT-FILE                                      00340024
003500         ASSIGN TO RPT01.                                         00350024
003600                                                                  00360024
003700                                                                  00370024
003800******************************************************************00380024
003900 DATA DIVISION.                                                   00390024
004000******************************************************************00400024
004100                                                                  00410024
004200 FILE SECTION.                                                    00420024
004300                                                                  00430024
004400 FD  CONDENSED-RC015-FILE                                         00440024
004500     RECORDING MODE IS F                                          00450024
004600     LABEL RECORDS ARE STANDARD                                   00460024
004700     BLOCK CONTAINS 0 RECORDS.                                    00470024
004800                                                                  00480024
004900 01  CONDENSED-RC015-RECORD      PIC X(135).                      00490024
005000                                                                  00500024
005100 FD  RECV-REPORT-FILE                                             00510024
005200     RECORDING MODE IS F                                          00520024
005300     BLOCK CONTAINS 0  RECORDS.                                   00530024
005400 01  RECV-REPORT-RECORD              PIC  X(132).                 00540024
005500                                                                  00550024
005600 WORKING-STORAGE SECTION.                                         00560024
005700                                                                  00570024
005800 01  FILLER.                                                      00580024
005900     05  FILLER                      PIC  X(36)    VALUE          00590024
006000         ' ***** WORKING STORAGE PGM=RCKRP012 '.                  00600024
006100     05  PGM-COMPILED                PIC  X(20)    VALUE SPACE.   00610024
006200     05  FILLER                      PIC  X(10)    VALUE          00620024
006300         ' LOCATION='.                                            00630024
006400     05  PGM-LOCATION                PIC  X(04)    VALUE SPACE.   00640024
006500     05  FILLER                      PIC  X(06)    VALUE          00650024
006600         ' *****'.                                                00660024
006700 EJECT                                                            00670024
006800 01  PROGRAM-SWITCHES.                                            00680024
006900     05  PS-NO-MORE-RECV-RECS-IND    PIC  X(01)    VALUE 'Y'.     00690024
007000         88  PS-MORE-RECV-RECS                     VALUE 'Y'.     00700024
007100         88  PS-NO-MORE-RECV-RECS                  VALUE 'N'.     00710024
007200     05  PS-END-OF-COMMENT-CSR-SW    PIC  X(01)    VALUE 'Y'.     00720040
007300         88  END-OF-COMMENT-CSR                    VALUE 'Y'.     00730040
007400         88  START-OF-COMMENT-CSR                  VALUE 'N'.     00740040
007500                                                                  00750024
007600 01  PC-CONSTANTS.                                                00760024
007700     05  PC-LINE-LIMIT               PIC S9(04)    VALUE +60.     00770042
007800     05  PC-2                        PIC S9(03)    VALUE +2       00780024
007900                                                   COMP-3.        00790024
008000     05  PC-4                        PIC S9(03)    VALUE +4       00800024
008100                                                   COMP-3.        00810024
008200     05  PC-60                       PIC S9(03)    VALUE +60      00820024
008300                                                   COMP-3.        00830024
008400     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00840024
008500                                                   'RCKRP012'.    00850024
008600     05  PC-REPORT-NBR-1             PIC  9(01)    VALUE 1.       00860024
008700 EJECT                                                            00870024
008800                                                                  00880024
008900 01  PV-ACCUMULATOR-FIELDS.                                       00890024
009000     05  PV-SUB                  PIC S9(04) COMP VALUE ZERO.      00900024
009100     05  PV-PAGE-CNT             PIC S9(04)    VALUE ZERO         00910024
009200                                                   COMP-3.        00920024
009300     05  PV-LINE-CNT             PIC S9(04)    VALUE ZERO         00930024
009400                                                   COMP SYNC.     00940024
009500     05  PV-TABLE-STORE-COUNT    PIC S9(05)  VALUE ZERO           00950024
009600                                                     COMP-3.      00960024
009700     05  PV-TOT-ITM-QTY          PIC S9(7)    VALUE ZERO          00970024
009800                                                     COMP-3.      00980024
009900     05  PV-TOT-RTL-AMT          PIC S9(7)V99 VALUE ZERO          00990024
010000                                                     COMP-3.      01000024
010100     05  PV-TOT-COST-AMT         PIC S9(7)V99  VALUE ZERO         01010024
010200                                                     COMP-3.      01020040
010300                                                                  01030024
010400 01  FT-ACCUMULATOR-FIELDS.                                       01040024
010500     05  FT-TOT-ITM-QTY          PIC S9(9)    VALUE ZERO          01050024
010600                                                     COMP-3.      01060024
010700     05  FT-TOT-RTL-AMT          PIC S9(9)V99 VALUE ZERO          01070024
010800                                                     COMP-3.      01080024
010900     05  FT-TOT-COST-AMT         PIC S9(9)V99  VALUE ZERO         01090024
011000                                                     COMP-3.      01100024
011100                                                                  01110040
011200 01  PV-SAVE-FIELDS.                                              01120024
011300     05  PV-SAVE-STR-NBR         PIC S9(4) COMP VALUE ZERO.       01130024
011400     05  PV-SAVE-REC-LOC-CODE    PIC X(04).                       01140045
011500     05  PV-SAVE-REC-LOC-CODE-N REDEFINES                         01150024
011600         PV-SAVE-REC-LOC-CODE    PIC 9(04).                       01160045
011700     05  PV-SAVE-ADJ-CYC-NBR     PIC S9(9) COMP VALUE ZERO.       01170024
011800     05  PV-SAVE-TIMESTAMP.                                       01180024
011900         10  PV-SAVE-YYYY        PIC 9(04).                       01190024
012000         10  FILLER              PIC X.                           01200024
012100         10  PV-SAVE-MM          PIC 9(02).                       01210024
012200         10  FILLER              PIC X.                           01220024
012300         10  PV-SAVE-DD          PIC 9(02).                       01230024
012400     05  PV-SAVE-PROCESS-AREA    PIC X(06) VALUE SPACES.          01240024
012500     05  PV-TEXT-EMPTY           PIC X(50) VALUE                  01250040
012600         '.                                                 '.    01260040
012700     05  PV-RETRY-COUNTER        PIC S9(04)  VALUE +0             01270040
012800                                             COMP SYNC.           01280040
012900     05  PV-SAVE-NOTIF-NBR       PIC S9(9) COMP VALUE ZERO.       01290040
013000     05  PV-FREEFORM-TEXT        PIC X(250).                      01300024
013100     05  PV-TEXT-50  REDEFINES  PV-FREEFORM-TEXT                  01310024
013200                     OCCURS 5    PIC X(50).                       01320024
013300 EJECT                                                            01330024
013400                                                                  01340024
013500 01  PV-CONTROL-KEYS.                                             01350024
013600     05  PV-CURR-KEY.                                             01360024
013700         10  PV-CURR-PO          PIC 9(08) VALUE ZERO.            01370024
013800         10  PV-CURR-RCVR        PIC 9(08) VALUE ZERO.            01380024
013900         10  PV-CURR-CYCLE-NBR   PIC S9(9) COMP VALUE ZERO.       01390024
014000     05  PV-PREV-KEY.                                             01400024
014100         10  PV-PREV-PO          PIC 9(08) VALUE ZERO.            01410024
014200         10  PV-PREV-RCVR        PIC 9(08) VALUE ZERO.            01420024
014300         10  PV-PREV-CYCLE-NBR   PIC S9(9) COMP VALUE ZERO.       01430024
014400                                                                  01440024
014500 01  PV-MISC-FIELDS.                                              01450024
014600     05  ABEND-CODE              PIC S9(04) VALUE ZERO            01460024
014700                                                   COMP SYNC.     01470024
014800     05  PV-ABEND-PARAGRAPH      PIC X(30) VALUE SPACES.          01480024
014900     05  PV-PARA                 PIC X(30) VALUE SPACES.          01490024
015000                                                                  01500024
015100     05  PV-PARAGRAPH-NAME       PIC X(30) VALUE SPACE.           01510024
015200     05  PV-DB2-OPERATION-ATTEMPTED                               01520024
015300                                 PIC X(30) VALUE SPACE.           01530024
015400     05  PV-OPER-UNT-ID          PIC S9(4) COMP.                  01540024
015500     05  PV-FCLTY-ID             PIC S9(4) COMP.                  01550024
015600                                                                  01560024
015700     05  PV-HOLD-UPD-TMST.                                        01570040
015800         10  PV-HOLD-UPD-TMST-CC     PIC X(02).                   01580040
015900         10  PV-HOLD-UPD-TMST-YY     PIC X(02).                   01590040
016000         10  FILLER                  PIC X(01).                   01600040
016100         10  PV-HOLD-UPD-TMST-MM     PIC X(02).                   01610040
016200         10  FILLER                  PIC X(01).                   01620040
016300         10  PV-HOLD-UPD-TMST-DD     PIC X(02).                   01630040
016400         10  FILLER                  PIC X(16).                   01640040
016500                                                                  01650040
016600     05  PV-HOLD-FORMAT-MMDDYY.                                   01660040
016700         10  PV-HOLD-FORMAT-MM       PIC X(02).                   01670040
016800         10  PV-HOLD-FORMAT-DD       PIC X(02).                   01680040
016900         10  PV-HOLD-FORMAT-YY       PIC X(02).                   01690040
017000                                                                  01700040
017100     05  PV-CURR-DATE-YYMMDD.                                     01710024
017200         10  PV-CURR-DATE-YY     PIC 9(02) VALUE ZERO.            01720024
017300         10  PV-CURR-DATE-MM     PIC 9(02) VALUE ZERO.            01730024
017400         10  PV-CURR-DATE-DD     PIC 9(02) VALUE ZERO.            01740024
017500                                                                  01750024
017600     05  PV-CURR-TIME.                                            01760024
017700         10  PV-CURR-TIME-HH     PIC 9(02)    VALUE ZERO.         01770024
017800         10  PV-CURR-TIME-MM     PIC 9(02)    VALUE ZERO.         01780024
017900         10  PV-CURR-TIME-SSHH   PIC 9(04)    VALUE ZERO.         01790024
018000                                                                  01800024
018100     05  PV-HOLD-CURR-DATE-MMDDYY    PIC  9(06)    VALUE ZERO.    01810024
018200     05  PV-HOLD-CURR-DATE-MMDDYY-X  REDEFINES                    01820024
018300         PV-HOLD-CURR-DATE-MMDDYY.                                01830024
018400         10  PV-HOLD-CURR-DATE-MM    PIC  9(02).                  01840024
018500         10  PV-HOLD-CURR-DATE-DD    PIC  9(02).                  01850024
018600         10  PV-HOLD-CURR-DATE-YY    PIC  9(02).                  01860024
019400*                                                                 01870043
018800 01  SD-SYSTEM-DATE.                                              01880024
018900     05  SD-SYSTEM-YEAR                  PIC  9(02)  VALUE ZEROS. 01890024
019000     05  SD-SYSTEM-MONTH                 PIC  9(02)  VALUE ZEROS. 01900024
019100     05  SD-SYSTEM-DAY                   PIC  9(02)  VALUE ZEROS. 01910024
019200                                                                  01920024
019300 EJECT                                                            01930024
019400*                                                                 01940024
019500*  WORK AREA FOR FISCAL CALENDAR ROUTINE.                         01950024
019600*                                                                 01960024
019700     COPY DPWS500.                                                01970040
019800 EJECT                                                            01980024
019900     COPY DPWS004.                                                01990024
020000******************************************************************02000024
020100*  WORK FIELDS FOR PRINTING A 132 CHARACTER REPORT.               02010024
020200******************************************************************02020024
020300     COPY DPWS132O.                                               02030024
020400                                                                  02040024
020500 01  HEADING-LINES.                                               02050024
020600     05  HEADING-LINE-0.                                          02060024
020700         10  FILLER                  PIC  X(36)    VALUE SPACES.  02070024
020800         10  FILLER                  PIC  X(44)    VALUE          02080024
020900             'WEEKLY AUDIT OF ADJUSTMENTS MADE TO VERIFIED'.      02090024
021000         10  FILLER                  PIC  X(16)    VALUE          02100024
021100             ' POSTED RECEIPTS'.                                  02110024
021200         10  FILLER                  PIC  X(36)    VALUE SPACES.  02120024
021300                                                                  02130024
021400     05  HEADING-LINE-1.                                          02140024
021500         10  FILLER                  PIC  X(16)    VALUE SPACES.  02150024
021600         10  FILLER                  PIC  X(44)    VALUE          02160024
021700             'REC   ADJUSTMENT   PROCESS    ADJ        ADJ'.      02170024
021800         10  FILLER                  PIC  X(16)    VALUE          02180024
021900             '             ADJ'.                                  02190024
022000         10  FILLER                  PIC  X(56)    VALUE SPACES.  02200024
022100                                                                  02210024
022200     05  HEADING-LINE-2.                                          02220024
022300         10  FILLER                  PIC  X(46)    VALUE          02230024
022400             'P.O. NUMBER     LOC       DATE      AREA      '.    02240024
022500         10  FILLER                  PIC  X(46)    VALUE          02250024
022600             'UNITS      RETAIL          COST      COMMENTS '.    02260024
022700         10  FILLER                  PIC  X(40)    VALUE SPACES.  02270024
022800                                                                  02280024
022900     05  HEADING-LINE-3.                                          02290024
023000         10  FILLER                  PIC  X(55)    VALUE SPACES.  02300024
023100         10  FILLER                  PIC  X(14)    VALUE          02310024
023200             'WEEK ENDING - '.                                    02320024
023300         10 HL3-WEEK-END-DATE        PIC  X(08)  VALUE SPACE.     02330024
023400         10  FILLER                  PIC  X(55)    VALUE SPACES.  02340024
023500                                                                  02350024
023600     05  DETAIL-LINE-1.                                           02360024
023700         10  DTL-PO                  PIC X(08)     VALUE SPACES.  02370024
023800         10  FILLER                  PIC X(01)     VALUE '-'.     02380024
023900         10  DTL-RCVR-SEQ            PIC 9(03)     VALUE ZERO.    02390024
024000         10  FILLER                  PIC X(02)     VALUE SPACES.  02400024
024100         10  DTL-REC-LOC             PIC X(05)     VALUE SPACES.  02410024
024200         10  FILLER                  PIC X(02)     VALUE SPACES.  02420024
024300         10  DTL-ADJ-DATE.                                        02430024
024400             15  DTL-ADJ-MM          PIC 9(02).                   02440024
024500             15  DTL-SLASH-1         PIC X(01).                   02450024
024600             15  DTL-ADJ-DD          PIC 9(02).                   02460024
024700             15  DTL-SLASH-2         PIC X(01).                   02470024
024800             15  DTL-ADJ-YYY         PIC 9(04).                   02480024
024900         10  FILLER                  PIC X(04)     VALUE SPACES.  02490024
025000         10  DTL-PROCESS-AREA        PIC X(06)     VALUE SPACES.  02500024
025100         10  FILLER                  PIC X(04)     VALUE SPACES.  02510024
025200         10  DTL-ADJ-UNITS           PIC ZZ,ZZ9-.                 02520024
025300         10  FILLER                  PIC X(02)     VALUE SPACES.  02530024
025400         10  DTL-ADJ-RETAIL          PIC ZZZ,ZZ9.99-.             02540024
025500         10  FILLER                  PIC X(02)     VALUE SPACES.  02550024
025600         10  DTL-ADJ-COST            PIC ZZZ,ZZ9.99-.             02560024
025700         10  FILLER                  PIC X(02)     VALUE SPACES.  02570024
025800         10  FILLER                  PIC X(09)     VALUE          02580024
025900             'REASON:  '.                                         02590024
026000         10  DTL-REASON-CODE         PIC 9(03).                   02600024
026100         10  FILLER                  PIC X(03)     VALUE ' - '.   02610024
026200         10  DTL-REASON-TEXT         PIC X(20)     VALUE SPACES.  02620024
026300         10  FILLER                  PIC X(18)     VALUE SPACES.  02630024
026400                                                                  02640040
026500     05  DETAIL-COMMENTS-LINE.                                    02650024
026600         10  FILLER                  PIC X(80)     VALUE SPACES.  02660024
026700         10  DTL-COMMENTS-1          PIC X(50)     VALUE SPACES.  02670024
026800                                                                  02680024
026900     05  DETAIL-REASON-LINE.                                      02690024
027000         10  FILLER                  PIC X(80)     VALUE SPACES.  02700024
027100                                                                  02710024
027200     05  FINAL-TOTAL-LINE-1.                                      02720024
027300         10  FILLER                  PIC X(31)     VALUE SPACES.  02730024
027400         10  FILLER                  PIC X(13)     VALUE          02740024
027500             'FINAL TOTAL  '.                                     02750024
027600         10  FL1-ADJ-UNITS           PIC ZZZ,ZZ9-.                02760024
027700         10  FILLER                  PIC X(01)     VALUE SPACES.  02770024
027800         10  FL1-ADJ-RETAIL          PIC ZZZZ,ZZ9.99-.            02780024
027900         10  FILLER                  PIC X(01)     VALUE SPACES.  02790024
028000         10  FL1-ADJ-COST            PIC ZZZZ,ZZ9.99-.            02800024
028100         10  FILLER                  PIC X(52)     VALUE SPACES.  02810024
028200                                                                  02820024
028300 01  MISCELLANEOUS-LINES.                                         02830024
028400     05  END-OF-REPORT-LINE.                                      02840024
028500         10  FILLER                  PIC  X(44)    VALUE SPACES.  02850024
028600         10  FILLER                  PIC  X(45)    VALUE          02860024
028700             '*******   E N D   O F   R E P O R T   *******'.     02870024
028800         10  FILLER                  PIC  X(43)    VALUE SPACES.  02880024
028900                                                                  02890024
029000     05  BLANK-LINE                  PIC X(132)    VALUE SPACES.  02900024
029100                                                                  02910024
029200******************************************************************02920024
029300*    RECDIS AUDIT EXTRACT FILE LAYOUT                             02930024
029400******************************************************************02940024
029500     COPY RCRD015.                                                02950024
029600******************************************************************02960024
029700*  DB2 COMMUNICATION AREA.                                        02970024
029800******************************************************************02980024
029900     EXEC SQL                                                     02990024
030000          INCLUDE SQLCA                                           03000024
030100     END-EXEC.                                                    03010024
030200     EJECT                                                        03020024
030300******************************************************************03030024
030400*  DB2 TABLE DB2PDBA.TTRBNTF                                      03040024
030500******************************************************************03050024
030600     EXEC SQL                                                     03060024
030700          INCLUDE TTRBNTF                                         03070024
030800     END-EXEC.                                                    03080024
030900 EJECT                                                            03090024
031000******************************************************************03100024
031100*  DB2 TABLE DB2PDBA.TTRBDTL                                      03110024
031200******************************************************************03120024
031300     EXEC SQL                                                     03130024
031400          INCLUDE TTRBDTL                                         03140024
031500     END-EXEC.                                                    03150024
031600                                                                  03160040
031700                                                                  03170040
031800                                                                  03180040
031900     EXEC SQL                                                     03190040
032000          DECLARE COMMENT-CSR CURSOR FOR                          03200040
032100          SELECT A.NOTIF_NBR                                      03210040
032200               , A.FREEFORM_TEXT                                  03220040
032300               , A.CRE_TMST                                       03230040
032400          FROM  TTRBDTL A                                         03240040
032500          WHERE A.NOTIF_NBR      =  :PV-SAVE-NOTIF-NBR            03250040
032600          ORDER BY                                                03260040
032700                A.CRE_TMST                                        03270040
032800     END-EXEC.                                                    03280040
032900 EJECT                                                            03290024
033000******************************************************************03300040
033100*  DB2 TABLE DB2PDBA.TTRBRSN                                      03310024
033200******************************************************************03320024
033300     EXEC SQL                                                     03330024
033400          INCLUDE TTRBRSN                                         03340024
033500     END-EXEC.                                                    03350024
033600 EJECT                                                            03360024
034300                                                                  03370024
034000     EXEC SQL                                                     03380045
034100          INCLUDE XLT00010                                        03390045
034200     END-EXEC.                                                    03400045
034300                                                                  03410045
034400     EXEC SQL                                                     03420024
034500         DECLARE STR-NBR-CSR  CURSOR FOR                          03430024
034600             SELECT LOC_NBR                                       03440045
034700                  , LOC_5_ABBR_NM                                 03450045
034800               FROM XLT_LOC                                       03460045
034900              WHERE                                               03470045
035000                   LOC_TYP_CDE IN ('DS', 'DC', 'CS', 'RV')        03480045
035100           ORDER BY LOC_NBR                                       03490045
035200     END-EXEC.                                                    03500024
035300                                                                  03510024
035400 EJECT                                                            03520024
035500 01  ST-STORE-TABLE.                                              03530024
035600     05  ST-STORE-ENTRY          OCCURS 1 TO 2000 TIMES           03540045
035700                                 DEPENDING ON                     03550024
035800                                 PV-TABLE-STORE-COUNT             03560024
035900                                 ASCENDING KEY IS                 03570024
036000                                 ST-STR-NBR                       03580024
036100                                 INDEXED BY ST-STR-IDX.           03590024
036200         10  ST-STR-NBR                  PIC S9(04) COMP.         03600046
036300         10  ST-CHAR5-ABBR-NAME          PIC X(5).                03610024
036400 EJECT                                                            03620040
036500***************************************************************** 03630024
036600* PROCEDURE DIVISION.                                           * 03640024
036700***************************************************************** 03650024
036800 PROCEDURE DIVISION.                                              03660024
036900                                                                  03670024
037000 0000-MAINLINE-PROCESSING.                                        03680024
037100                                                                  03690024
037200     PERFORM 1000-INITIALIZATION.                                 03700024
037300                                                                  03710024
037400     PERFORM 2000-PROCESS-RECV-RPT-RECS                           03720024
037500       UNTIL PS-NO-MORE-RECV-RECS.                                03730024
037600                                                                  03740024
037700     PERFORM 2200-PRINT-DTL-LINES                                 03750024
037800                                                                  03760024
037900     PERFORM 3000-PRINT-TOTAL-LINES.                              03770040
038000                                                                  03780024
038100     WRITE RECV-REPORT-RECORD                                     03790040
038200       FROM END-OF-REPORT-LINE                                    03800024
038300         AFTER ADVANCING 1 LINE.                                  03810040
038400                                                                  03820024
038500     CLOSE CONDENSED-RC015-FILE                                   03830024
038600           RECV-REPORT-FILE.                                      03840024
038700                                                                  03850024
038800     STOP RUN.                                                    03860024
038900                                                                  03870024
039000 EJECT                                                            03880024
039100******************************************************************03890024
039200** READ THE DB2 CONTROL TABLE AND READ THE FIRST ASN EXTRACT REC *03900024
039300******************************************************************03910024
039400 1000-INITIALIZATION.                                             03920024
039500                                                                  03930024
039600     OPEN INPUT CONDENSED-RC015-FILE                              03940024
039700          OUTPUT RECV-REPORT-FILE.                                03950024
039800                                                                  03960024
039900     ACCEPT PV-CURR-DATE-YYMMDD FROM DATE.                        03970024
040000     MOVE PV-CURR-DATE-YY TO PV-HOLD-CURR-DATE-YY                 03980024
040100                             SD-SYSTEM-YEAR                       03990024
040200     MOVE PV-CURR-DATE-MM TO PV-HOLD-CURR-DATE-MM                 04000024
040300                             SD-SYSTEM-MONTH                      04010024
040400     MOVE PV-CURR-DATE-DD TO PV-HOLD-CURR-DATE-DD                 04020024
040500                             SD-SYSTEM-DAY                        04030024
040600                                                                  04040024
040700     ACCEPT PV-CURR-TIME FROM TIME.                               04050024
040800                                                                  04060024
040900     INITIALIZE FT-TOT-ITM-QTY                                    04070024
041000                FT-TOT-RTL-AMT                                    04080024
041100                FT-TOT-COST-AMT.                                  04090024
041200                                                                  04100024
041300     MOVE PV-CURR-DATE-MM        TO DP132O-RUN-MONTH.             04110024
041400     MOVE PV-CURR-DATE-DD        TO DP132O-RUN-DAY.               04120024
041500     MOVE PV-CURR-DATE-YY        TO DP132O-RUN-YEAR.              04130024
041600                                                                  04140024
041700     MOVE PV-CURR-TIME-HH        TO DP132O-RUN-HOUR.              04150024
041800     MOVE PV-CURR-TIME-MM        TO DP132O-RUN-MINUTE.            04160024
041900     MOVE PC-CURRENT-PROGRAM-NAME                                 04170024
042000                                 TO DP132O-PROGRAM-NAME.          04180024
042100                                                                  04190024
042200     PERFORM 7100-READ-INPUT.                                     04200024
042300     MOVE PV-CURR-KEY            TO PV-PREV-KEY.                  04210024
042400                                                                  04220024
042500     IF  PS-NO-MORE-RECV-RECS                                     04230040
042600         PERFORM 1100-GET-WEEK-END-DATE                           04240040
042700     ELSE                                                         04250040
042800         PERFORM 1110-GET-WEEK-END-DATE.                          04260040
042900                                                                  04270024
043000     PERFORM 8000-PRINT-HEADINGS.                                 04280024
043100*  BUILD TABLE OF STORES                                          04290024
043200     PERFORM 7000-OPEN-STR-NBR-CSR.                               04300024
043300     PERFORM 7010-FETCH-STR-NBR-CSR.                              04310024
043400                                                                  04320024
043500     PERFORM 1200-LOAD-STR-NBR-TBL                                04330024
043600         VARYING ST-STR-IDX FROM 1 BY 1                           04340024
043700         UNTIL SQLCODE = +100                                     04350024
043800         OR ST-STR-IDX > 2000                                     04360047
043900     IF ST-STR-IDX > 2000                                         04370047
044000         PERFORM 7020-CLOSE-STR-NBR-CSR                           04380024
044100         MOVE '1200-LOAD-STR-NBR-TBL'                             04390024
044200                                 TO PV-PARAGRAPH-NAME             04400024
044300         MOVE 'WORKING STORAGE TABLE OVERFLOW'                    04410024
044400                                 TO PV-DB2-OPERATION-ATTEMPTED    04420024
044500         PERFORM 9100-SQL-ABEND                                   04430024
044600     END-IF.                                                      04440024
044700     PERFORM 7020-CLOSE-STR-NBR-CSR.                              04450024
044800                                                                  04460024
044900 EJECT                                                            04470024
045000******************************************************************04480024
045100* 1100-GET-WEEK-END-DATE  USES DPKUT500 TO DETERMINE THE WEEK END 04490042
045200*      DATE.  THIS PARAGRAPH WILL BE USED IF THE INPUT FILE HAS   04500024
045300*      NO DATA.                                                   04510040
045400******************************************************************04520024
045500 1100-GET-WEEK-END-DATE.                                          04530024
045600                                                                  04540024
045700     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              04550040
045800                                                                  04560024
045900     MOVE SD-SYSTEM-DATE            TO DPG51-SYSTEM-DATE          04570024
046000     MOVE PV-HOLD-CURR-DATE-MMDDYY  TO DPG52-LK-DATE-INPUT        04580024
046100                                                                  04590024
046200     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                      04600024
046300*                                                                 04610040
046400     SET DPG51-DECREMENT-DATE       TO TRUE.                      04620040
046500     SET DPG52-LK-DTE-GREG          TO TRUE.                      04630024
046600                                                                  04640040
046700     MOVE 7                         TO DPG51-INCR-DECR-DAYS-9.    04650040
046800                                                                  04660040
046900     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    04670040
047000                            DPG54 DPG55 DPG56.                    04680040
047100                                                                  04690024
047200     EVALUATE TRUE                                                04700024
047300* ************************************************************** *04710042
047400* *  THESE 3 CONDITIONS ARE MUTUALLY EXCLUSIVE BECAUSE THEY    * *04720042
047500* *  EACH DESCRIBE A POSSIBLE VALUE FOR THE SAME INDICATOR.    * *04730042
047600* ************************************************************** *04740042
047700         WHEN DPG54-NO-ERROR                                      04750042
047800             MOVE  DPG55-LAST-WKDY-GREG-FMT                       04760042
047900                                    TO HL3-WEEK-END-DATE          04770042
048000                                                                  04780042
048100         WHEN DPG54-WARNING-ERROR                                 04790042
048200             DISPLAY                                              04800042
048300            '** PROGRAM = RCKRP012 -- CALLED MODULE DPKUT500  **' 04810042
048400             DISPLAY                                              04820042
048500            '**                       RETURNED WARNING ERROR. **' 04830042
048600             DISPLAY                                              04840042
048700            '** PARAGRAPH = 1100-GET-WEEK-END-DATE            **' 04850042
048800             DISPLAY                                              04860042
048900            '** ERROR MESSAGE FROM CALLED MODULE ON NEXT LINE.**' 04870042
049000             DISPLAY                                              04880042
049100            '** ' DPG54-ERROR-MESSAGE                             04890042
049200             DISPLAY                                              04900042
049300            '** CALLING PARMLISTS DISPLAYED ON NEXT 2 LINES.  **' 04910042
049400             DISPLAY                                              04920042
049500            '** DPG51 : ' DPG51                                   04930042
049600             DISPLAY                                              04940042
049700            '** DPG52 : ' DPG52                                   04950042
049800             DISPLAY                                              04960042
049900            '** PLEASE INVESTIGATE FURTHER.                   **' 04970042
050000            '** '                                                 04980042
050100                                                                  04990042
050200         WHEN DPG54-SEVERE-ERROR                                  05000042
050300* ************************************************************** *05010042
050400* *      EXAMINE THE "SEVERE ERROR" RESPONSE FROM THE DATE RTN.* *05020042
050500* *      THESE CONDITIONS ARE *NOT* MUTUALLY EXCLUSIVE;        * *05030042
050600* *      EACH CONDITION IS DESCRIBED BY A SEPARATE INDICATOR.  * *05040042
050700* ****************************************************************05050042
050800             IF  DPG54-CALENDAR-TYPE-INVALID                      05060042
050900                 DISPLAY '** DPG54-CALENDAR-TYPE-INVALID'         05070042
051000             END-IF                                               05080042
051100                                                                  05090042
051200             IF  DPG54-DATE-INVALID                               05100042
051300                 DISPLAY '** DPG54-DATE-INVALID'                  05110042
051400             END-IF                                               05120042
051500                                                                  05130042
051600             IF  DPG54-INCR-DECR-INVALID                          05140042
051700                 DISPLAY '** DPG54-INCR-DECR-INVALID'             05150042
051800             END-IF                                               05160042
051900                                                                  05170042
052000*            *************************************************** *05180042
052100*            * FOR "SEVERE ERROR" OF ANY REASON, ABEND         * *05190042
052200*            *************************************************** *05200042
052300             DISPLAY '** ABEND **'                                05210042
052400             DISPLAY                                              05220042
052500            '** PROGRAM = RCKRP012 -- CALLED MODULE DPKUT500  **' 05230042
052600             DISPLAY                                              05240042
052700            '**                       RETURNED SEVERE ERROR.  **' 05250042
052800             DISPLAY                                              05260042
052900            '** PARAGRAPH = 1100-GET-WEEK-END-DATE            **' 05270042
053000             DISPLAY                                              05280042
053100            '** ERROR MESSAGE FROM CALLED MODULE ON NEXT LINE.**' 05290042
053200             DISPLAY                                              05300042
053300            '** ' DPG54-ERROR-MESSAGE                             05310042
053400             DISPLAY                                              05320042
053500            '** CALLING PARMLISTS DISPLAYED ON NEXT 2 LINES.  **' 05330042
053600             DISPLAY                                              05340042
053700            '** DPG51 : ' DPG51                                   05350042
053800             DISPLAY                                              05360042
053900            '** DPG52 : ' DPG52                                   05370042
054000             DISPLAY                                              05380042
054100            '** '                                                 05390042
054200             MOVE +4003 TO ABEND-CODE                             05400042
054300             CALL 'ILBOABN0' USING ABEND-CODE                     05410042
054400                                                                  05420042
054500     END-EVALUATE.                                                05430042
054600                                                                  05440042
054700                                                                  05450042
054800 EJECT                                                            05460042
054900******************************************************************05470042
055000* 1110-GET-WEEK-END-DATE  USES DPKUT500 TO DETERMINE THE WEEK END 05480042
055100*      DATE.  THIS PARAGRAPH WILL BE USED IF THE INPUT FILE HAS   05490042
055200*      DATA.                                                      05500042
055300******************************************************************05510042
055400 1110-GET-WEEK-END-DATE.                                          05520042
055500                                                                  05530042
055600     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              05540042
055700                                                                  05550042
055800     MOVE SD-SYSTEM-DATE            TO DPG51-SYSTEM-DATE.         05560042
055900     MOVE RC015-UPD-TMST            TO PV-HOLD-UPD-TMST.          05570042
056000     MOVE PV-HOLD-UPD-TMST-MM       TO PV-HOLD-FORMAT-MM.         05580042
056100     MOVE PV-HOLD-UPD-TMST-DD       TO PV-HOLD-FORMAT-DD.         05590042
056200     MOVE PV-HOLD-UPD-TMST-YY       TO PV-HOLD-FORMAT-YY.         05600042
056300     MOVE PV-HOLD-FORMAT-MMDDYY     TO DPG52-LK-DATE-INPUT        05610042
056400                                       DPG53-LK-CMPR-DATE-INPUT.  05620042
056500                                                                  05630042
056600     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                      05640042
056700     SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE.                     05650042
056800     SET DPG52-LK-DTE-GREG          TO TRUE.                      05660042
056900     SET DPG53-LK-CMPR-DTE-GREG     TO TRUE.                      05670042
057000                                                                  05680042
057100     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    05690042
057200                            DPG54 DPG55 DPG56.                    05700042
057300                                                                  05710042
057400     EVALUATE TRUE                                                05720042
057500* ************************************************************** *05730042
057600* *  THESE 3 CONDITIONS ARE MUTUALLY EXCLUSIVE BECAUSE THEY    * *05740042
057700* *  EACH DESCRIBE A POSSIBLE VALUE FOR THE SAME INDICATOR.    * *05750042
057800* ************************************************************** *05760042
057900         WHEN DPG54-NO-ERROR                                      05770042
058000             MOVE  DPG55-LAST-WKDY-GREG-FMT                       05780042
058100                                    TO HL3-WEEK-END-DATE          05790042
058200                                                                  05800042
058300         WHEN DPG54-WARNING-ERROR                                 05810042
058400             DISPLAY                                              05820042
058500            '** PROGRAM = RCKRP012 -- CALLED MODULE DPKUT500  **' 05830042
058600             DISPLAY                                              05840042
058700            '**                       RETURNED WARNING ERROR. **' 05850042
058800             DISPLAY                                              05860042
058900            '** PARAGRAPH = 1110-GET-WEEK-END-DATE            **' 05870042
059000             DISPLAY                                              05880042
059100            '** ERROR MESSAGE FROM CALLED MODULE ON NEXT LINE.**' 05890042
059200             DISPLAY                                              05900042
059300            '** ' DPG54-ERROR-MESSAGE                             05910042
059400             DISPLAY                                              05920042
059500            '** CALLING PARMLISTS DISPLAYED ON NEXT 2 LINES.  **' 05930042
059600             DISPLAY                                              05940042
059700            '** DPG51 : ' DPG51                                   05950042
059800             DISPLAY                                              05960042
059900            '** DPG52 : ' DPG52                                   05970042
060000             DISPLAY                                              05980042
060100            '** PLEASE INVESTIGATE FURTHER.                   **' 05990042
060200            '** '                                                 06000042
060300                                                                  06010042
060400         WHEN DPG54-SEVERE-ERROR                                  06020042
060500* ************************************************************** *06030042
060600* *      EXAMINE THE "SEVERE ERROR" RESPONSE FROM THE DATE RTN.* *06040042
060700* *      THESE CONDITIONS ARE *NOT* MUTUALLY EXCLUSIVE;        * *06050042
060800* *      EACH CONDITION IS DESCRIBED BY A SEPARATE INDICATOR.  * *06060042
060900* ****************************************************************06070042
061000             IF  DPG54-CALENDAR-TYPE-INVALID                      06080042
061100                 DISPLAY '** DPG54-CALENDAR-TYPE-INVALID'         06090042
061200             END-IF                                               06100042
061300                                                                  06110042
061400             IF  DPG54-DATE-INVALID                               06120042
061500                 DISPLAY '** DPG54-DATE-INVALID'                  06130042
061600             END-IF                                               06140042
061700                                                                  06150042
061800             IF  DPG54-INCR-DECR-INVALID                          06160042
061900                 DISPLAY '** DPG54-INCR-DECR-INVALID'             06170042
062000             END-IF                                               06180042
062100                                                                  06190042
062200*            *************************************************** *06200042
062300*            * FOR "SEVERE ERROR" OF ANY REASON, ABEND         * *06210042
062400*            *************************************************** *06220042
062500             DISPLAY '** ABEND **'                                06230042
062600             DISPLAY                                              06240042
062700            '** PROGRAM = RCKRP012 -- CALLED MODULE DPKUT500  **' 06250042
062800             DISPLAY                                              06260042
062900            '**                       RETURNED SEVERE ERROR.  **' 06270042
063000             DISPLAY                                              06280042
063100            '** PARAGRAPH = 1110-GET-WEEK-END-DATE            **' 06290042
063200             DISPLAY                                              06300042
063300            '** ERROR MESSAGE FROM CALLED MODULE ON NEXT LINE.**' 06310042
063400             DISPLAY                                              06320042
063500            '** ' DPG54-ERROR-MESSAGE                             06330042
063600             DISPLAY                                              06340042
063700            '** CALLING PARMLISTS DISPLAYED ON NEXT 2 LINES.  **' 06350042
063800             DISPLAY                                              06360042
063900            '** DPG51 : ' DPG51                                   06370042
064000             DISPLAY                                              06380042
064100            '** DPG52 : ' DPG52                                   06390042
064200             DISPLAY                                              06400042
064300            '** '                                                 06410042
064400             MOVE +4003 TO ABEND-CODE                             06420042
064500             CALL 'ILBOABN0' USING ABEND-CODE                     06430042
064600                                                                  06440042
064700     END-EVALUATE.                                                06450042
064800                                                                  06460042
064900 EJECT                                                            06470042
065000 1200-LOAD-STR-NBR-TBL.                                           06480042
065100                                                                  06490042
065200     MOVE XLT00010-LOC-NBR       TO ST-STR-NBR (ST-STR-IDX)       06500045
065300     MOVE XLT00010-LOC-5-ABBR-NM                                  06510045
065400                                 TO ST-CHAR5-ABBR-NAME            06520042
065500                                   (ST-STR-IDX)                   06530042
065600                                                                  06540042
065700     ADD +1                      TO PV-TABLE-STORE-COUNT          06550042
065800                                                                  06560042
065900     PERFORM 7010-FETCH-STR-NBR-CSR.                              06570042
066000     EJECT                                                        06580042
066100 2000-PROCESS-RECV-RPT-RECS.                                      06590042
066200                                                                  06600042
066300     IF PV-CURR-KEY = PV-PREV-KEY                                 06610042
066400         PERFORM 2100-ACCUM-FIELDS                                06620042
066500     ELSE                                                         06630042
066600         PERFORM 2200-PRINT-DTL-LINES                             06640042
066700         MOVE PV-CURR-KEY        TO PV-PREV-KEY                   06650042
066800         INITIALIZE PV-TOT-ITM-QTY                                06660042
066900                    PV-TOT-RTL-AMT                                06670042
067000                    PV-TOT-COST-AMT                               06680042
067100         PERFORM 2100-ACCUM-FIELDS                                06690042
067200     END-IF                                                       06700042
067300                                                                  06710042
067400     PERFORM 7100-READ-INPUT.                                     06720042
067500                                                                  06730042
067600 2100-ACCUM-FIELDS.                                               06740042
067700     ADD RC015-ADJ-ITM-QTY       TO PV-TOT-ITM-QTY                06750042
067800                                    FT-TOT-ITM-QTY.               06760042
067900     ADD RC015-ADJ-RTL-EXTN-AMT  TO PV-TOT-RTL-AMT                06770042
068000                                    FT-TOT-RTL-AMT.               06780042
068100     ADD RC015-ADJ-COST-EXTN-AMT TO PV-TOT-COST-AMT               06790042
068200                                    FT-TOT-COST-AMT.              06800042
068300                                                                  06810042
068400*    MOVE RC015-OPER-UNT-ID      TO PV-SAVE-STR-NBR               06820042
068500*    MOVE RC015-REC-LOC-CDE      TO PV-SAVE-REC-LOC-CODE          06830045
068500     MOVE RC015-REC-LOC-CDE-4CH  TO PV-SAVE-REC-LOC-CODE          06840045
068600     MOVE RC015-ADJ-CYC-NBR      TO PV-SAVE-ADJ-CYC-NBR.          06850042
068700     MOVE RC015-UPD-TMST         TO PV-SAVE-TIMESTAMP             06860042
068800                                                                  06870042
068900     MOVE RC015-PRC-FCLTY-AREA-ID                                 06880042
069000                                 TO PV-SAVE-PROCESS-AREA.         06890042
069100                                                                  06900042
069200 2200-PRINT-DTL-LINES.                                            06910042
069300******************************************************************06920042
069400*  THIS PARAGRAPH WILL PRINT THE DETAIL LINE FOR A DEPARTMENT    *06930042
069500******************************************************************06940042
069600                                                                  06950042
069700     IF  PV-LINE-CNT > PC-LINE-LIMIT                              06960042
069800         PERFORM 8000-PRINT-HEADINGS                              06970042
069900     END-IF.                                                      06980042
070000                                                                  06990042
070100     MOVE PV-PREV-PO             TO DTL-PO                        07000042
070200     MOVE PV-PREV-RCVR           TO DTL-RCVR-SEQ                  07010042
070300                                                                  07020042
070400     PERFORM 2210-LOCATION.                                       07030042
070500                                                                  07040042
070600     MOVE PV-SAVE-YYYY            TO DTL-ADJ-YYY                  07050042
070700     MOVE PV-SAVE-MM              TO DTL-ADJ-MM                   07060042
070800     MOVE PV-SAVE-DD              TO DTL-ADJ-DD                   07070042
070900     MOVE '/'                     TO DTL-SLASH-1                  07080042
071000                                     DTL-SLASH-2                  07090042
071100                                                                  07100042
071200     MOVE PV-SAVE-PROCESS-AREA   TO DTL-PROCESS-AREA              07110042
071300     MOVE PV-TOT-ITM-QTY         TO DTL-ADJ-UNITS                 07120042
071400     MOVE PV-TOT-RTL-AMT         TO DTL-ADJ-RETAIL                07130042
071500     MOVE PV-TOT-COST-AMT        TO DTL-ADJ-COST                  07140042
071600                                                                  07150042
071700     PERFORM 2220-TROUBLE.                                        07160042
071800                                                                  07170042
071900     MOVE TRBRSN-TRBL-RSN-CDE    TO DTL-REASON-CODE               07180042
072000     MOVE TRBRSN-TRBL-LONG-DESC  TO DTL-REASON-TEXT               07190042
072100                                                                  07200042
072200     WRITE RECV-REPORT-RECORD                                     07210042
072300       FROM DETAIL-LINE-1                                         07220042
072400         AFTER ADVANCING 1 LINE.                                  07230042
072500     ADD +1 TO PV-LINE-CNT.                                       07240042
072600                                                                  07250042
072700     PERFORM 2300-TROUBLE-COMMENTS.                               07260042
072800                                                                  07270042
072900     WRITE RECV-REPORT-RECORD                                     07280042
073000       FROM BLANK-LINE                                            07290042
073100         AFTER ADVANCING 1 LINE.                                  07300042
073200     ADD +1 TO PV-LINE-CNT.                                       07310024
073300                                                                  07320024
073400 2210-LOCATION.                                                   07330024
073500                                                                  07340024
073600     MOVE SPACES               TO DTL-REC-LOC                     07350024
073700                                                                  07360024
073800     IF PV-SAVE-REC-LOC-CODE = 'DS'                               07370024
073900         MOVE 'DS'             TO DTL-REC-LOC                     07380024
074000     ELSE                                                         07390024
074100     IF PV-SAVE-REC-LOC-CODE-N NUMERIC                            07400024
074200         SEARCH ALL ST-STORE-ENTRY                                07410024
074300         WHEN  ST-STR-NBR (ST-STR-IDX) = PV-SAVE-REC-LOC-CODE-N   07420024
074400             MOVE ST-CHAR5-ABBR-NAME (ST-STR-IDX)                 07430024
074500                               TO DTL-REC-LOC                     07440024
074600         END-SEARCH                                               07450024
074700     END-IF                                                       07460024
074800     END-IF.                                                      07470024
074900                                                                  07480024
075000                                                                  07490024
075100 2220-TROUBLE.                                                    07500024
075200     INITIALIZE DCLTTRBNTF                                        07510024
075300                DCLTTRBDTL                                        07520024
075400                DCLTTRBRSN                                        07530024
075500                PV-FREEFORM-TEXT                                  07540024
075600                                                                  07550024
075700     MOVE  PV-PREV-CYCLE-NBR   TO TRBNTF-NOTIF-NBR                07560024
075800                                  PV-SAVE-NOTIF-NBR.              07570040
075900                                                                  07580024
076000      EXEC SQL                                                    07590024
076100         SELECT  C.TRBL_LONG_DESC                                 07600024
076200               , C.TRBL_RSN_CDE                                   07610024
076300           INTO :TRBRSN-TRBL-LONG-DESC                            07620024
076400              , :TRBRSN-TRBL-RSN-CDE                              07630024
076500           FROM  TTRBNTF A                                        07640024
076600               , TTRBRSN C                                        07650024
076700          WHERE  A.NOTIF_NBR = :TRBNTF-NOTIF-NBR                  07660024
076800            AND  A.TRBL_RSN_CDE = C.TRBL_RSN_CDE                  07670024
076900      END-EXEC.                                                   07680024
077000                                                                  07690024
077100      EVALUATE TRUE                                               07700024
077200          WHEN SQLCODE = ZERO                                     07710024
077300          WHEN SQLCODE = +100                                     07720024
077400          WHEN SQLCODE = -904                                     07730024
077500          WHEN SQLCODE = -913                                     07740024
077600              CONTINUE                                            07750024
077700                                                                  07760024
077800          WHEN SQLWARN0 NOT = SPACES                              07770024
077900          WHEN SQLCODE < +0                                       07780024
078000          WHEN SQLCODE > +0                                       07790024
078100             MOVE '2220-TROUBLE         '                         07800024
078200                                 TO PV-PARAGRAPH-NAME             07810024
078300             MOVE 'ERROR ON SELECT TO TTRBNTF TABLE'              07820024
078400                                 TO PV-DB2-OPERATION-ATTEMPTED    07830024
078500             PERFORM 9100-SQL-ABEND                               07840024
078600      END-EVALUATE.                                               07850024
078700 EJECT                                                            07860024
078800                                                                  07870040
078900 2300-TROUBLE-COMMENTS.                                           07880040
079000                                                                  07890024
079100     SET START-OF-COMMENT-CSR TO TRUE.                            07900040
079200     PERFORM 2310-OPEN-DETAIL-CURSOR.                             07910040
079300     PERFORM 2320-FETCH-DETAIL-CURSOR.                            07920040
079400     PERFORM 2330-PROCESS-DETAIL-CURSOR                           07930040
079500         UNTIL END-OF-COMMENT-CSR.                                07940040
079600     PERFORM 2340-CLOSE-DETAIL-CURSOR.                            07950040
079700                                                                  07960040
079800 EJECT                                                            07970040
079900 2310-OPEN-DETAIL-CURSOR.                                         07980040
080000                                                                  07990040
080100     MOVE '2310-OPEN-DETAIL-CURSOR'                               08000040
080200                                 TO PV-ABEND-PARAGRAPH.           08010040
080300     MOVE 'ERROR ON OPEN OF TTRBDTL CURSOR '                      08020040
080400                                 TO PV-DB2-OPERATION-ATTEMPTED.   08030024
080500     EXEC SQL                                                     08040040
080600         OPEN COMMENT-CSR                                         08050040
080700     END-EXEC.                                                    08060040
080800     EVALUATE TRUE                                                08070040
080900       WHEN SQLCODE = ZEROS                                       08080040
081000         CONTINUE                                                 08090040
081100       WHEN OTHER                                                 08100040
081200         DISPLAY PV-ABEND-PARAGRAPH                               08110040
081300         PERFORM 9100-SQL-ABEND                                   08120040
081400     END-EVALUATE.                                                08130040
081500 EJECT                                                            08140040
081600 2320-FETCH-DETAIL-CURSOR.                                        08150040
081700                                                                  08160040
081800     MOVE '3200-FETCH-CURSOR   '                                  08170040
081900                                 TO PV-ABEND-PARAGRAPH.           08180040
082000     MOVE 'ERROR ON FETCH OF TTRBDTL CURSOR'                      08190040
082100                                 TO PV-DB2-OPERATION-ATTEMPTED.   08200024
082200     EXEC SQL                                                     08210040
082300          FETCH COMMENT-CSR                                       08220040
082400          INTO  :TRBDTL-NOTIF-NBR                                 08230040
082500               ,:PV-FREEFORM-TEXT                                 08240040
082600               ,:TRBDTL-CRE-TMST                                  08250040
082700     END-EXEC.                                                    08260040
082800                                                                  08270040
082900     EVALUATE TRUE                                                08280040
083000       WHEN SQLCODE = ZEROS                                       08290040
083100         CONTINUE                                                 08300040
083200       WHEN SQLCODE = +100                                        08310040
083300           SET END-OF-COMMENT-CSR TO TRUE                         08320040
083400       WHEN OTHER                                                 08330040
083500         DISPLAY PV-ABEND-PARAGRAPH                               08340040
083600         PERFORM 9100-SQL-ABEND                                   08350040
083700     END-EVALUATE.                                                08360040
083800 EJECT                                                            08370040
083900 2330-PROCESS-DETAIL-CURSOR.                                      08380040
084000                                                                  08390040
084100     IF PV-TEXT-50 (1) > SPACES AND                               08400024
084200        PV-TEXT-50 (1) NOT = PV-TEXT-EMPTY                        08410040
084300         MOVE PV-TEXT-50 (1)     TO DTL-COMMENTS-1                08420024
084400         WRITE RECV-REPORT-RECORD                                 08430040
084500               FROM DETAIL-COMMENTS-LINE                          08440040
084600               AFTER ADVANCING 1 LINE                             08450040
084700               ADD +1 TO PV-LINE-CNT                              08460040
084800     END-IF                                                       08470024
084900                                                                  08480024
085000     IF PV-TEXT-50 (1) > SPACES AND                               08490024
085100        PV-TEXT-50 (1) NOT = PV-TEXT-EMPTY                        08500040
085200         IF PV-TEXT-50 (2) > SPACES                               08510024
085300             MOVE PV-TEXT-50 (2) TO DTL-COMMENTS-1                08520024
085400             WRITE RECV-REPORT-RECORD                             08530024
085500                   FROM DETAIL-COMMENTS-LINE                      08540024
085600                   AFTER ADVANCING 1 LINE                         08550024
085700                   ADD +1 TO PV-LINE-CNT                          08560024
085800         END-IF                                                   08570024
085900         IF PV-TEXT-50 (3) > SPACES                               08580024
086000             MOVE PV-TEXT-50 (3) TO DTL-COMMENTS-1                08590024
086100             WRITE RECV-REPORT-RECORD                             08600024
086200                   FROM DETAIL-COMMENTS-LINE                      08610024
086300                   AFTER ADVANCING 1 LINE                         08620024
086400                   ADD +1 TO PV-LINE-CNT                          08630024
086500         END-IF                                                   08640024
086600         IF PV-TEXT-50 (4) > SPACES                               08650024
086700             MOVE PV-TEXT-50 (4) TO DTL-COMMENTS-1                08660024
086800             WRITE RECV-REPORT-RECORD                             08670024
086900                   FROM DETAIL-COMMENTS-LINE                      08680024
087000                   AFTER ADVANCING 1 LINE                         08690024
087100                   ADD +1 TO PV-LINE-CNT                          08700024
087200         END-IF                                                   08710024
087300         IF PV-TEXT-50 (5) > SPACES                               08720024
087400             MOVE PV-TEXT-50 (5) TO DTL-COMMENTS-1                08730024
087500             WRITE RECV-REPORT-RECORD                             08740024
087600                   FROM DETAIL-COMMENTS-LINE                      08750024
087700                   AFTER ADVANCING 1 LINE                         08760024
087800                   ADD +1 TO PV-LINE-CNT                          08770024
087900         END-IF                                                   08780024
088000     END-IF.                                                      08790024
088100                                                                  08800040
088200     PERFORM 2320-FETCH-DETAIL-CURSOR.                            08810040
088300 EJECT                                                            08820040
088400 2340-CLOSE-DETAIL-CURSOR.                                        08830040
088500                                                                  08840040
088600     MOVE '2340-CLOSE-DETAIL-CURSOR'                              08850040
088700                                 TO PV-ABEND-PARAGRAPH.           08860040
088800     MOVE 'ERROR ON CLOSE OF TTRBDTL CURSOR'                      08870040
088900                                 TO PV-DB2-OPERATION-ATTEMPTED.   08880040
089000     EXEC SQL                                                     08890040
089100         CLOSE COMMENT-CSR                                        08900040
089200     END-EXEC.                                                    08910040
089300     EVALUATE TRUE                                                08920040
089400       WHEN SQLCODE = ZEROS                                       08930040
089500         CONTINUE                                                 08940040
089600       WHEN OTHER                                                 08950040
089700         DISPLAY PV-ABEND-PARAGRAPH                               08960040
089800         PERFORM 9100-SQL-ABEND                                   08970040
089900     END-EVALUATE.                                                08980040
090000 EJECT                                                            08990040
090100 3000-PRINT-TOTAL-LINES.                                          09000040
090200                                                                  09010024
090300     MOVE FT-TOT-ITM-QTY TO                                       09020040
090400          FL1-ADJ-UNITS.                                          09030040
090500     MOVE FT-TOT-RTL-AMT TO                                       09040040
090600          FL1-ADJ-RETAIL.                                         09050040
090700     MOVE FT-TOT-COST-AMT TO                                      09060040
090800          FL1-ADJ-COST.                                           09070040
090900                                                                  09080024
091000     WRITE RECV-REPORT-RECORD                                     09090040
091100       FROM FINAL-TOTAL-LINE-1                                    09100040
091200         AFTER ADVANCING 1 LINE.                                  09110040
091300                                                                  09120040
091400     WRITE RECV-REPORT-RECORD                                     09130024
091500       FROM BLANK-LINE                                            09140024
091600         AFTER ADVANCING 1 LINE.                                  09150024
091700                                                                  09160040
091800 EJECT                                                            09170024
091900 7000-OPEN-STR-NBR-CSR.                                           09180024
092000     EXEC SQL                                                     09190024
092100         OPEN STR-NBR-CSR                                         09200024
092200     END-EXEC.                                                    09210024
092300                                                                  09220024
092400     EVALUATE TRUE                                                09230024
092500         WHEN SQLCODE = ZERO                                      09240024
092600             CONTINUE                                             09250024
092700         WHEN SQLWARN0 NOT = SPACE                                09260024
092800         WHEN SQLCODE < ZERO                                      09270024
092900         WHEN SQLCODE > ZERO                                      09280024
093000             MOVE '7000-OPEN-STR-NBR-CSR'                         09290024
093100                                 TO PV-PARAGRAPH-NAME             09300024
093200             MOVE 'ERROR ON OPEN OF STORE-CURSOR'                 09310024
093300                                 TO PV-DB2-OPERATION-ATTEMPTED    09320024
093400             PERFORM 9100-SQL-ABEND                               09330024
093500     END-EVALUATE.                                                09340024
093600*                                                                 09350024
093700     SKIP3                                                        09360024
093800 7010-FETCH-STR-NBR-CSR.                                          09370024
093900     INITIALIZE DCLXLT00010                                       09380045
094000                                                                  09390024
094100     EXEC SQL                                                     09400024
094200         FETCH  STR-NBR-CSR                                       09410024
094300          INTO  :XLT00010-LOC-NBR                                 09420045
094400             ,  :XLT00010-LOC-5-ABBR-NM                           09430045
094500     END-EXEC.                                                    09440024
094600                                                                  09450024
094700     EVALUATE TRUE                                                09460024
094800         WHEN SQLCODE = ZERO                                      09470024
094900         WHEN SQLCODE = +100                                      09480024
095000             CONTINUE                                             09490024
095100         WHEN SQLWARN0 NOT = SPACE                                09500024
095200         WHEN SQLCODE < ZERO                                      09510024
095300         WHEN SQLCODE > ZERO                                      09520024
095400             MOVE '7010-FETCH-STR-NBR-CSR'                        09530024
095500                 TO PV-PARAGRAPH-NAME                             09540024
095600             MOVE 'ATTEMPTING TO FETCH A ROW OF THE RESULTS TABLE 09550024
095700-                 'FROM THE STR-NBR-CSR'                          09560024
095800                              TO  PV-DB2-OPERATION-ATTEMPTED      09570024
095900             PERFORM 9100-SQL-ABEND                               09580024
096000     END-EVALUATE.                                                09590024
096100     SKIP3                                                        09600024
096200 7020-CLOSE-STR-NBR-CSR.                                          09610024
096300     EXEC SQL                                                     09620024
096400         CLOSE STR-NBR-CSR                                        09630024
096500     END-EXEC.                                                    09640024
096600                                                                  09650024
096700     EVALUATE TRUE                                                09660024
096800         WHEN SQLCODE = ZERO                                      09670024
096900             CONTINUE                                             09680024
097000         WHEN SQLWARN0 NOT = SPACE                                09690024
097100         WHEN SQLCODE < ZERO                                      09700024
097200         WHEN SQLCODE > ZERO                                      09710024
097300             MOVE '7020-CLOSE-STR-NBR-CSR'                        09720024
097400                                 TO PV-PARAGRAPH-NAME             09730024
097500             MOVE 'ATTEMPTING TO CLOSE STR-NBR-CSR'               09740024
097600                                 TO PV-DB2-OPERATION-ATTEMPTED    09750024
097700             PERFORM 9100-SQL-ABEND                               09760024
097800     END-EVALUATE.                                                09770024
097900 EJECT                                                            09780024
098000                                                                  09790024
098100******************************************************************09800024
098200*  READ THE AUDIT EXTRACT FILE.                                  *09810024
098300******************************************************************09820024
098400 7100-READ-INPUT.                                                 09830024
098500                                                                  09840024
098600     MOVE '7000'                  TO PGM-LOCATION.                09850024
098700     MOVE '7100-READ-INPUT           '                            09860024
098800                                  TO PV-ABEND-PARAGRAPH.          09870024
098900                                                                  09880024
099000     READ CONDENSED-RC015-FILE INTO RC015-TRECDIS-ADJ-RECORD      09890024
099100         AT END                                                   09900024
099200           SET PS-NO-MORE-RECV-RECS                               09910024
099300                                 TO TRUE                          09920024
099400         NOT AT END                                               09930024
099500           MOVE RC015-ORD-NBR    TO PV-CURR-PO                    09940024
099600           MOVE RC015-REC-SEQ-NBR                                 09950024
099700                                 TO PV-CURR-RCVR                  09960024
099800           MOVE RC015-ADJ-CYC-NBR                                 09970024
099900                                 TO PV-CURR-CYCLE-NBR             09980024
100000     END-READ.                                                    09990024
100100/                                                                 10000024
100200 8000-PRINT-HEADINGS.                                             10010024
100300     ADD 1                        TO PV-PAGE-CNT.                 10020024
100400                                                                  10030024
100500     MOVE PV-PAGE-CNT             TO DP132O-PAGE-NUMBER.          10040024
100600                                                                  10050024
100700     MOVE PC-REPORT-NBR-1        TO DP132O-REPORT-NUMBER.         10060024
100800                                                                  10070024
100900     WRITE RECV-REPORT-RECORD                                     10080024
101000       FROM DP132O-STANDRD-HEADER-132-COLS                        10090024
101100         AFTER ADVANCING PAGE.                                    10100024
101200                                                                  10110024
101300     WRITE RECV-REPORT-RECORD                                     10120024
101400       FROM HEADING-LINE-0                                        10130024
101500         AFTER ADVANCING 2 LINE.                                  10140024
101600     MOVE 2                       TO PV-LINE-CNT.                 10150024
101700                                                                  10160024
101800     WRITE RECV-REPORT-RECORD                                     10170024
101900       FROM HEADING-LINE-3                                        10180024
102000         AFTER ADVANCING 1 LINES.                                 10190024
102100     ADD +2                       TO PV-LINE-CNT.                 10200024
102200                                                                  10210024
102300     WRITE RECV-REPORT-RECORD                                     10220024
102400       FROM HEADING-LINE-1                                        10230024
102500         AFTER ADVANCING 2 LINES.                                 10240024
102600     ADD +2                       TO PV-LINE-CNT.                 10250024
102700                                                                  10260024
102800     WRITE RECV-REPORT-RECORD                                     10270024
102900       FROM HEADING-LINE-2                                        10280024
103000         AFTER ADVANCING 1 LINES.                                 10290024
103100     ADD +1                       TO PV-LINE-CNT.                 10300024
103200                                                                  10310024
103300     WRITE RECV-REPORT-RECORD                                     10320024
103400       FROM BLANK-LINE                                            10330024
103500         AFTER ADVANCING 1 LINE.                                  10340024
103600     ADD +1 TO PV-LINE-CNT.                                       10350024
103700/                                                                 10360024
103800******************************************************************10370024
103900* 9100-SQL-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      10380024
104000* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 10390024
104100******************************************************************10400024
104200 9100-SQL-ABEND.                                                  10410024
104300     DISPLAY '** ABEND     **'.                                   10420024
104400     DISPLAY '** PROGRAM   ** = RCKRP012'.                        10430024
104500     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              10440024
104600     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     10450024
104700                                                                  10460024
104800******************************************************************10470024
104900* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    10480024
105000* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         10490024
105100* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     10500024
105200* FORMAT.                                                         10510024
105300******************************************************************10520024
105400     COPY DPPD004.                                                10530040
105500                                                                  10540024
105600     MOVE +4013 TO ABEND-CODE.                                    10550024
105700     CALL 'ILBOABN0' USING ABEND-CODE.                            10560024
105800                                                                  10570024
