000100*-----------------------*                                         00010011
000200 IDENTIFICATION DIVISION.                                         00020011
000300*-----------------------*                                         00030011
000400 PROGRAM-ID.    APKUT077.                                         00040011
000500 AUTHOR.        MIKE BESKE.                                       00050011
000600 DATE-WRITTEN.  JULY 1998.                                        00060011
000700                                                                  00070011
000800*---------------------------------------------------------------* 00080011
000900*                        COBOL 2 WITH SQL                       * 00090011
001000*                                                               * 00100011
001100*         BUILD CONTROL CARDS TO EXTRACT GL ACCOUNTS            * 00110011
001200*                                                               * 00120011
001300*    THE PURPOSE OF THIS PROGRAM IS TO SELECT ALL OF THE ACCOUNT* 00130011
001400*    NUMBERS FROM THE TACCTYP TABLE THAT ARE TO BE INCLUDED IN  * 00140011
001500*    THE ACTIVITY AND BALANCE REPORT AND BUILD SORT CONTROL     * 00150011
001600*    CARDS FOR 2 DIFFERENT RECORD FORMATS.  THESE CONTROL CARDS * 00160011
001700*    WILL BE USED IN VARIOUS PLACES TO SELECT THE ACTIVITY      * 00170011
001800*    RECORDS FOR THOSE ACCOUNTS THAT ARE TO BE REPORTED ON.     * 00180011
001900*                                                               * 00190011
002000*---------------------------------------------------------------* 00200011
002100*                                                               * 00210011
002200* DB2 TABLES:                                                   * 00220011
002300*  1. AP ACCOUNT TYPE TABLE            (TACCTYP)                * 00230011
002400*                                                               * 00240011
002500* OUTPUT:                                                       * 00250011
002600*  1. APRD063-CONTROL-CARD-FILE                                 * 00260011
002700*  2. APRD045-CONTROL-CARD-FILE                                 * 00270011
002800*                                                               * 00280011
002900*---------------------------------------------------------------* 00290011
003000*  CHANGES:                                                     * 00300011
003100*                                                               * 00310011
003200*  JUNE 1999                                                    * 00320011
003300*       CHANGING THE WAY THE CONTROL CARD IS BEING              * 00330011
003400*       CREATED USING THE APRD045 COPYBOOK LAYOUT               * 00340011
003500*       INSTEAD OF APTRAN.                                      * 00350011
003600*  MADE BY: JILL JUEL                                           * 00360011
003700*                                                               * 00370011
003800*  08/08/2002                                                   * 00380015
003900*       ADDED SELECT DISTINCT TO ACCT_TYP_CSR TO CLEAN UP       * 00390011
004000*       SORT CARDS THAT ARE PRODUCED.                           * 00400011
004100*  MADE BY: KEVIN CATLIN                WR #: 23254             * 00410011
004200*---------------------------------------------------------------* 00420011
004300 EJECT                                                            00430011
004400                                                                  00440011
004500 ENVIRONMENT DIVISION.                                            00450011
004600 CONFIGURATION SECTION.                                           00460011
004700 SOURCE-COMPUTER. IBM-3090.                                       00470011
004800 OBJECT-COMPUTER. IBM-3090.                                       00480011
004900                                                                  00490011
005000*                                                                 00500011
005100 INPUT-OUTPUT SECTION.                                            00510011
005200 FILE-CONTROL.                                                    00520011
005300                                                                  00530011
005400*    SELECT APTRAN-CONTROL-CARD-FILE       ASSIGN TO UT-S-OUT01.  00540011
005500     SELECT APRD045-CONTROL-CARD-FILE      ASSIGN TO UT-S-OUT01.  00550011
005600     SELECT APRD063-CONTROL-CARD-FILE      ASSIGN TO UT-S-OUT02.  00560011
005700                                                                  00570011
005800 DATA DIVISION.                                                   00580011
005900 FILE SECTION.                                                    00590011
006000                                                                  00600011
006100*FD  APTRAN-CONTROL-CARD-FILE                                     00610011
006200 FD  APRD045-CONTROL-CARD-FILE                                    00620011
006300     RECORDING MODE IS F                                          00630011
006400     BLOCK CONTAINS 0 CHARACTERS                                  00640011
006500     LABEL RECORDS ARE STANDARD                                   00650011
006600*    DATA RECORD IS APTRAN-CONTROL-CARD-RECORD.                   00660011
006700     DATA RECORD IS APRD045-CONTROL-CARD-RECORD.                  00670011
006800                                                                  00680011
006900*01  APTRAN-CONTROL-CARD-RECORD   PIC X(80).                      00690011
007000 01  APRD045-CONTROL-CARD-RECORD  PIC X(80).                      00700011
007100                                                                  00710011
007200 FD  APRD063-CONTROL-CARD-FILE                                    00720011
007300     RECORDING MODE IS F                                          00730011
007400     BLOCK CONTAINS 0 CHARACTERS                                  00740011
007500     LABEL RECORDS ARE STANDARD                                   00750011
007600     DATA RECORD IS APRD063-CONTROL-CARD-RECORD.                  00760011
007700                                                                  00770011
007800 01  APRD063-CONTROL-CARD-RECORD  PIC X(80).                      00780011
007900                                                                  00790011
008000 EJECT                                                            00800011
008100 WORKING-STORAGE SECTION.                                         00810011
008200                                                                  00820011
008300 01  PC-PROGRAM-CONSTANTS.                                        00830011
008400     05  PC-WS-PROGRAM           PIC  X(40)  VALUE                00840011
008500         '**** WORKING STORAGE ** APKUT077 ****'.                 00850011
008600     05  PC-SINGLE-QUOTE         PIC  X(01)  VALUE QUOTE.         00860011
008700     05  PC-END-PARENTHESIS      PIC  X(01)  VALUE ')'.           00870011
008800     05  PC-APRD045-SORT-COPY    PIC  X(80)  VALUE                00880011
008900         '  SORT FIELDS=COPY'.                                    00890011
009000     05  PC-APRD045-SORT-INCLUDE-NE.                              00900011
009100         10  FILLER                PIC X(29)   VALUE              00910011
009200             '  INCLUDE COND=((39,9,CH,NE,C'.                     00920011
009300         10  FILLER              PIC X(01)   VALUE QUOTE.         00930011
009400         10  FILLER              PIC X(09)   VALUE SPACE.         00940011
009500         10  FILLER              PIC X(01)   VALUE QUOTE.         00950011
009600         10  FILLER              PIC X(17)   VALUE                00960011
009700             ',AND,39,9,CH,NE,C'.                                 00970011
009800         10  FILLER              PIC X(01)   VALUE QUOTE.         00980011
009900         10  FILLER              PIC X(09)   VALUE '000000000'.   00990011
010000         10  FILLER              PIC X(01)   VALUE QUOTE.         01000011
010100         10  FILLER              PIC X(02)   VALUE '),'.          01010011
010200     05  PC-APRD045-SORT-INCLUDE-NE2.                             01020011
010300         10  FILLER                PIC X(28)   VALUE              01030011
010400             '           AND,(38,1,CH,NE,C'.                      01040011
010500         10  FILLER              PIC X(01)   VALUE QUOTE.         01050011
010600         10  FILLER              PIC X(01)   VALUE '2'.           01060011
010700         10  FILLER              PIC X(01)   VALUE QUOTE.         01070011
010800         10  FILLER              PIC X(17)   VALUE                01080011
010900             ',AND,38,1,CH,NE,C'.                                 01090011
011000         10  FILLER              PIC X(01)   VALUE QUOTE.         01100011
011100         10  FILLER              PIC X(01)   VALUE '9'.           01110011
011200         10  FILLER              PIC X(01)   VALUE QUOTE.         01120011
011300         10  FILLER              PIC X(02)   VALUE '),'.          01130011
011400     05  PC-APRD063-SORT-FIELDS  PIC  X(80)  VALUE                01140011
011500         '  SORT FIELDS=(40,9,CH,A,95,7,CH,A,102,10,CH,A)'.       01150011
011600     05  PC-APRD063-SORT-SUM     PIC  X(80)  VALUE                01160011
011700         '  SUM FIELDS=(74,7,PD)'.                                01170011
011800                                                                  01180011
011900 01  PV-PROGRAM-VARIABLES.                                        01190011
012000     05  PV-CURRENT-PARAGRAPH    PIC  X(35).                      01200011
012100     05  PV-NULL-IND             PIC S9(4)     VALUE ZERO         01210011
012200                                               COMP SYNC.         01220011
012300     05  PV-ACCT-TYP-COUNT       PIC S9(9)     VALUE ZEROS        01230011
012400                                               COMP.              01240011
012500     05  PV-AP045-COUNT          PIC S9(9)     VALUE ZEROS        01250011
012600                                               COMP.              01260011
012700     05  PV-AP063-COUNT          PIC S9(9)     VALUE ZEROS        01270011
012800                                               COMP.              01280011
012900                                                                  01290011
013000     05  PV-APRD045-SORT-INCLUDE.                                 01300011
013100         10  FILLER                PIC X(28)   VALUE              01310011
013200             '           AND,(51,6,CH,EQ,C'.                      01320011
013300         10  FILLER                PIC X(01)   VALUE QUOTE.       01330011
013400         10  PV-APRD045-ACCT       PIC X(06)   VALUE SPACES.      01340011
013500         10  FILLER                PIC X(01)   VALUE QUOTE.       01350011
013600         10  FILLER                PIC X(01)   VALUE ','.         01360011
013700     05  PV-APRD045-SORT-INCLUDE-OR.                              01370011
013800         10  FILLER                PIC X(28)   VALUE              01380011
013900             '             OR,51,6,CH,EQ,C'.                      01390011
014000         10  FILLER                PIC X(01)   VALUE QUOTE.       01400011
014100         10  PV-APRD045-OR-ACCT    PIC X(06)   VALUE SPACES.      01410011
014200         10  FILLER                PIC X(01)   VALUE QUOTE.       01420011
014300         10  FILLER                PIC X(01)   VALUE ','.         01430011
014400     05  PV-APRD045-SORT-INCLUDE-OR-END.                          01440011
014500         10  FILLER                PIC X(28)   VALUE              01450011
014600             '             OR,51,6,CH,EQ,C'.                      01460011
014700         10  FILLER                PIC X(01)   VALUE QUOTE.       01470011
014800         10  PV-APRD045-OR-END-ACCT PIC X(06)  VALUE SPACES.      01480011
014900         10  FILLER                PIC X(01)   VALUE QUOTE.       01490011
015000         10  FILLER                PIC X(02)   VALUE '))'.        01500011
015100                                                                  01510011
015200     05  PV-APRD063-SORT-INCLUDE.                                 01520011
015300         10  FILLER                PIC X(28)   VALUE              01530011
015400             '  INCLUDE COND=(95,7,CH,EQ,C'.                      01540011
015500         10  FILLER                PIC X(01)   VALUE QUOTE.       01550011
015600         10  PV-APRD063-ACCT       PIC X(07)   VALUE SPACES.      01560011
015700         10  FILLER                PIC X(01)   VALUE QUOTE.       01570011
015800         10  FILLER                PIC X(01)   VALUE ','.         01580011
015900     05  PV-APRD063-SORT-INCLUDE-OR.                              01590011
016000         10  FILLER                PIC X(28)   VALUE              01600011
016100             '             OR,95,7,CH,EQ,C'.                      01610011
016200         10  FILLER                PIC X(01)   VALUE QUOTE.       01620011
016300         10  PV-APRD063-OR-ACCT    PIC X(07)   VALUE SPACES.      01630011
016400         10  FILLER                PIC X(01)   VALUE QUOTE.       01640011
016500         10  FILLER                PIC X(01)   VALUE ','.         01650011
016600     05  PV-APRD063-SORT-INCLUDE-OR-END.                          01660011
016700         10  FILLER                PIC X(28)   VALUE              01670011
016800             '             OR,95,7,CH,EQ,C'.                      01680011
016900         10  FILLER                PIC X(01)   VALUE QUOTE.       01690011
017000         10  PV-APRD063-OR-END-ACCT PIC X(07)   VALUE SPACES.     01700011
017100         10  FILLER                PIC X(01)   VALUE QUOTE.       01710011
017200         10  FILLER                PIC X(01)   VALUE ')'.         01720011
017300                                                                  01730011
017400 01  PS-PROGRAM-SWITCHES.                                         01740011
017500     05  PS-ACCT-TYP-SW            PIC X(01) VALUE ' '.           01750011
017600         88  PS-END-ACCT-TYP                 VALUE 'Y'.           01760011
017700         88  PS-MORE-ACCT-TYP                VALUE ' '.           01770011
017800     05  PS-FIRST-TIME-SW          PIC X(01) VALUE ' '.           01780011
017900         88  PS-FIRST-TIME                   VALUE 'Y'.           01790011
018000         88  PS-NOT-FIRST-TIME               VALUE ' '.           01800011
018100                                                                  01810011
018200 01  SAVE-FIELDS.                                                 01820011
018300     05 SV-ACCTYP-GL-ACCT-NBR      PIC X(7).                      01830011
018400                                                                  01840011
018500 01  RUN-TIME.                                                    01850011
018600     05  R-HR                    PIC 99.                          01860011
018700     05  R-MIN                   PIC 99.                          01870011
018800     05  R-SEC                   PIC 99.                          01880011
018900     05  R-TH                    PIC 99.                          01890011
019000                                                                  01900011
019100 01  DATE-IN.                                                     01910011
019200     05 DATE-IN-YY               PIC XX.                          01920011
019300     05 DATE-IN-MM               PIC XX.                          01930011
019400     05 DATE-IN-DD               PIC XX.                          01940011
019500                                                                  01950011
019600/                                                                 01960011
019700*                                                                 01970011
019800*    TACCTYP DCLGEN                                               01980011
019900*                                                                 01990011
020000     EXEC SQL                                                     02000011
020100         INCLUDE TACCTYP                                          02010011
020200     END-EXEC.                                                    02020011
020300/                                                                 02030011
020400*                                                                 02040011
020500*    SQL COMMUNICATIONS AREA DCLGEN                               02050011
020600*                                                                 02060011
020700     EXEC SQL                                                     02070011
020800         INCLUDE SQLCA                                            02080011
020900     END-EXEC.                                                    02090011
021000/                                                                 02100011
021100*---------------------------------------------------------------- 02110011
021200*    CURSOR DECLARATIONS                                          02120011
021300*---------------------------------------------------------------- 02130011
021400*---------------------------------------------------------------- 02140011
021500* ACCT_TYP_CSR RETRIEVES ALL ACCOUNT NUMBERS THAT ARE TO BE IN-   02150011
021600* CLUDED IN THE ACTIVITY AND BALANCE REPORT.                      02160011
021700*---------------------------------------------------------------- 02170011
021800     EXEC SQL                                                     02180011
021900       DECLARE ACCT_TYP_CSR CURSOR FOR                            02190011
022000         SELECT DISTINCT GL_ACCT_NBR                              02200013
022100           FROM TACCTYP                                           02210013
022200          WHERE GL_BAL_RPTG_IND = 'Y'                             02220013
022210            AND STAT_CDE = 'A'                                    02221013
022300     END-EXEC.                                                    02230011
022400/                                                                 02240011
022500*---------------------------------------------------------------- 02250011
022600*  ABEND DATA AREAS                                               02260011
022700*---------------------------------------------------------------- 02270011
022800 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          02280011
022900                                             COMP SYNC.           02290011
023000     88  AC-BAD-DATA                         VALUE +4003.         02300011
023100     88  AC-DB2-ERROR                        VALUE +4013.         02310011
023200                                                                  02320011
023300 01  ABEND-AREAS.                                                 02330011
023400     05  AA-ABEND-LIT            PIC  X(40)  VALUE                02340011
023500             '*****       ABEND'.                                 02350011
023600     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                02360011
023700             '*****   PROGRAM: APKUT077'.                         02370011
023800     05  AA-PARAGRAPH-LIT.                                        02380011
023900         10  FILLER              PIC  X(17)  VALUE                02390011
024000             '***** PARAGRAPH: '.                                 02400011
024100         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        02410011
024200     05  AA-MESSAGE-LINE.                                         02420011
024300         10  FILLER              PIC  X(06)  VALUE '*****'.       02430011
024400         10  AA-MESSAGE.                                          02440011
024500             15 AA-MESS-1        PIC  X(30)  VALUE SPACES.        02450011
024600             15 AA-MESS-2        PIC  X(97)  VALUE SPACES.        02460011
024700     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                02470011
024800             '*****    DB2 ERROR'.                                02480011
024900     05  AA-DB2-OPERATION-LIT.                                    02490011
025000         10  FILLER              PIC  X(17)  VALUE                02500011
025100             '***** OPERATION: '.                                 02510011
025200         10  AA-DB2-OPERATION.                                    02520011
025300             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        02530011
025400             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        02540011
025500     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        02550011
025600     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        02560011
025700     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        02570011
025800     05  AA-DB2-TABLE-4          PIC  X(08)  VALUE SPACES.        02580011
025900                                                                  02590011
026000/                                                                 02600011
026100*---------------------------------------------------------------- 02610011
026200*  SQLCA FORMATTED MESSAGE AREA                                   02620011
026300*---------------------------------------------------------------- 02630011
026400     COPY DPWS004.                                                02640011
026500*                                                                 02650011
026600/                                                                 02660011
026700 01  FILLER                      PIC  X(35)  VALUE                02670011
026800     '**** END OF W/S ** APKUT077 ****'.                          02680011
026900 EJECT                                                            02690011
027000 PROCEDURE DIVISION.                                              02700011
027100                                                                  02710011
027200     PERFORM A100-MAINLINE.                                       02720011
027300     GOBACK.                                                      02730011
027400                                                                  02740011
027500 EJECT                                                            02750011
027600 A100-MAINLINE.                                                   02760011
027700                                                                  02770011
027800     MOVE 'A100-MAINLINE' TO PV-CURRENT-PARAGRAPH.                02780011
027900                                                                  02790011
028000     PERFORM B100-INITIALIZE.                                     02800011
028100                                                                  02810011
028200     PERFORM B200-PROCESS-EXTRACT-FILE                            02820011
028300         UNTIL PS-END-ACCT-TYP.                                   02830011
028400                                                                  02840011
028500     PERFORM B300-END-OF-PROGRAM.                                 02850011
028600                                                                  02860011
028700 EJECT                                                            02870011
028800*---------------------------------------------------------------- 02880011
028900*    INITIALIZATION PROCESSING.                                   02890011
029000*---------------------------------------------------------------- 02900011
029100 B100-INITIALIZE.                                                 02910011
029200                                                                  02920011
029300     MOVE 'B100-INITIALIZE' TO PV-CURRENT-PARAGRAPH.              02930011
029400                                                                  02940011
029500     ACCEPT RUN-TIME FROM TIME.                                   02950011
029600     ACCEPT DATE-IN  FROM DATE.                                   02960011
029700                                                                  02970011
029800     DISPLAY ' RUN-DATE = ' DATE-IN '   RUN-TIME = ' RUN-TIME.    02980011
029900                                                                  02990011
030000     OPEN OUTPUT APRD063-CONTROL-CARD-FILE                        03000011
030100                 APRD045-CONTROL-CARD-FILE.                       03010011
030200                                                                  03020011
030300     INITIALIZE DCLTACCTYP.                                       03030011
030400                                                                  03040011
030500     SET PS-FIRST-TIME    TO TRUE.                                03050011
030600     SET PS-MORE-ACCT-TYP TO TRUE.                                03060011
030700                                                                  03070011
030800     PERFORM X100-OPEN-ACCOUNT-TYPE-CSR.                          03080011
030900                                                                  03090011
031000     PERFORM R200-FETCH-ACCT-TYP.                                 03100011
031100                                                                  03110011
031200     IF PS-END-ACCT-TYP                                           03120011
031300        MOVE 'B100-INITIALIZE'    TO AA-PARAGRAPH-NAME            03130011
031400        MOVE 'NO ACCOUNT NUMBERS FOR BUILDING CNTL CARDS'         03140011
031500                                  TO AA-MESSAGE                   03150011
031600        SET AC-BAD-DATA           TO TRUE                         03160011
031700        PERFORM Z999-ABEND                                        03170011
031800     END-IF.                                                      03180011
031900                                                                  03190011
032000 EJECT                                                            03200011
032100*---------------------------------------------------------------- 03210011
032200*    CONTROLS THE PROCESSING OF THE GL ACCOUNT NUMBERS THAT ARE   03220011
032300*    MARKED FOR REPORTING PURPOSES.  FOR EVERY ACCOUNT NUMBER     03230011
032400*    THAT IS FETCHED, TWO DIFFERENT SORT CONTROL CARDS ARE        03240011
032500*    FORMATTED.  ONE WILL BE USED FOR FILES IN THE APRD045 LAYOUT 03250011
032600*    AND THE OTHER WILL BE USED FOR FILES IN THE APRD063 LAYOUT.  03260011
032700*---------------------------------------------------------------- 03270011
032800 B200-PROCESS-EXTRACT-FILE.                                       03280011
032900                                                                  03290011
033000     MOVE 'B200-PROCESS-EXTRACT-FILE' TO                          03300011
033100                             PV-CURRENT-PARAGRAPH.                03310011
033200                                                                  03320011
033300     IF PS-FIRST-TIME                                             03330011
033400        SET PS-NOT-FIRST-TIME TO TRUE                             03340011
033500        PERFORM C100-CREATE-1ST-AP045-CARDS                       03350011
033600        PERFORM C200-CREATE-1ST-AP063-CARDS                       03360011
033700     ELSE                                                         03370011
033800        PERFORM C300-CREATE-ADDL-AP045-CARDS                      03380011
033900        PERFORM C400-CREATE-ADDL-AP063-CARDS                      03390011
034000     END-IF.                                                      03400011
034100                                                                  03410011
034200     PERFORM R200-FETCH-ACCT-TYP.                                 03420011
034300                                                                  03430011
034400 EJECT                                                            03440011
034500*---------------------------------------------------------------- 03450011
034600*    END OF PROGRAM.                                              03460011
034700*---------------------------------------------------------------- 03470011
034800 B300-END-OF-PROGRAM.                                             03480011
034900                                                                  03490011
035000     PERFORM C500-CREATE-END-AP045-CARD.                          03500011
035100     PERFORM C600-CREATE-END-AP063-CARD.                          03510011
035200                                                                  03520011
035300     DISPLAY '** COUNTS FOR APKUT077 **'.                         03530011
035400     DISPLAY 'NBR OF ACCOUNT NOS FETCHED    = ' PV-ACCT-TYP-COUNT.03540011
035500     DISPLAY 'NBR OF AP045 CARDS CREATED    = ' PV-AP045-COUNT.   03550011
035600     DISPLAY 'NBR OF AP063 CARDS CREATED    = ' PV-AP063-COUNT.   03560011
035700     DISPLAY '** PROGRAM APKUT077 ENDS NORMALLY **'.              03570011
035800                                                                  03580011
035900     PERFORM Y100-CLOSE-ACCT-TYP-CSR.                             03590011
036000                                                                  03600011
036100     CLOSE APRD063-CONTROL-CARD-FILE                              03610011
036200           APRD045-CONTROL-CARD-FILE.                             03620011
036300                                                                  03630011
036400 EJECT                                                            03640011
036500*---------------------------------------------------------------- 03650011
036600*   CREATES THE SORT COPY CARD AND THE FIRST SORT INCLUDE CARD    03660011
036700*   FOR THE APRD045 LAYOUT BASED SORT CONTROL CARDS.              03670011
036800*---------------------------------------------------------------- 03680011
036900 C100-CREATE-1ST-AP045-CARDS.                                     03690011
037000                                                                  03700011
037100     MOVE 'C100-CREATE-1ST-AP045-CARDS' TO PV-CURRENT-PARAGRAPH.  03710011
037200                                                                  03720011
037300     MOVE SPACES                  TO APRD045-CONTROL-CARD-RECORD. 03730011
037400     MOVE PC-APRD045-SORT-COPY    TO APRD045-CONTROL-CARD-RECORD. 03740011
037500     PERFORM W100-WRITE-AP045-CONTROL-CARD.                       03750011
037600     MOVE SPACES                  TO APRD045-CONTROL-CARD-RECORD. 03760011
037700     MOVE PC-APRD045-SORT-INCLUDE-NE                              03770011
037800                                  TO APRD045-CONTROL-CARD-RECORD. 03780011
037900     PERFORM W100-WRITE-AP045-CONTROL-CARD.                       03790011
038000     MOVE PC-APRD045-SORT-INCLUDE-NE2                             03800011
038100                                  TO APRD045-CONTROL-CARD-RECORD. 03810011
038200     PERFORM W100-WRITE-AP045-CONTROL-CARD.                       03820011
038300     MOVE SPACES                  TO APRD045-CONTROL-CARD-RECORD. 03830011
038400     MOVE SV-ACCTYP-GL-ACCT-NBR                                   03840011
038500                                  TO PV-APRD045-ACCT.             03850011
038600     MOVE PV-APRD045-SORT-INCLUDE TO APRD045-CONTROL-CARD-RECORD. 03860011
038700     PERFORM W100-WRITE-AP045-CONTROL-CARD.                       03870011
038800                                                                  03880011
038900 EJECT                                                            03890011
039000*---------------------------------------------------------------- 03900011
039100*   CREATES THE SORT FIELDS, SORT SUM AND THE FIRST SORT INCLUDE  03910011
039200*   CARD FOR THE APRD063 LAYOUT BASED SORT CONTROL CARDS.         03920011
039300*---------------------------------------------------------------- 03930011
039400 C200-CREATE-1ST-AP063-CARDS.                                     03940011
039500                                                                  03950011
039600     MOVE 'C200-CREATE-1ST-AP063-CARDS' TO PV-CURRENT-PARAGRAPH.  03960011
039700                                                                  03970011
039800     MOVE SPACES                   TO APRD063-CONTROL-CARD-RECORD.03980011
039900     MOVE PC-APRD063-SORT-FIELDS   TO APRD063-CONTROL-CARD-RECORD.03990011
040000     PERFORM W200-WRITE-AP063-CONTROL-CARD.                       04000011
040100     MOVE SPACES                   TO APRD063-CONTROL-CARD-RECORD.04010011
040200     MOVE PC-APRD063-SORT-SUM      TO APRD063-CONTROL-CARD-RECORD.04020011
040300     PERFORM W200-WRITE-AP063-CONTROL-CARD.                       04030011
040400     MOVE SPACES                   TO APRD063-CONTROL-CARD-RECORD.04040011
040500     MOVE SV-ACCTYP-GL-ACCT-NBR    TO PV-APRD063-ACCT.            04050011
040600     MOVE  PV-APRD063-SORT-INCLUDE TO APRD063-CONTROL-CARD-RECORD.04060011
040700     PERFORM W200-WRITE-AP063-CONTROL-CARD.                       04070011
040800                                                                  04080011
040900 EJECT                                                            04090011
041000*---------------------------------------------------------------- 04100011
041100*   CREATES ADDITIONAL SORT INCLUDE CARDS FOR THE APRD045 LAYOUT  04110011
041200*   BASED SORT CONTROL CARDS.                                     04120011
041300*---------------------------------------------------------------- 04130011
041400 C300-CREATE-ADDL-AP045-CARDS.                                    04140011
041500                                                                  04150011
041600     MOVE 'C300-CREATE-ADDL-AP045-CARDS' TO PV-CURRENT-PARAGRAPH. 04160011
041700                                                                  04170011
041800     MOVE SPACES                  TO APRD045-CONTROL-CARD-RECORD. 04180011
041900     MOVE SV-ACCTYP-GL-ACCT-NBR                                   04190011
042000                                  TO PV-APRD045-OR-ACCT.          04200011
042100     MOVE PV-APRD045-SORT-INCLUDE-OR                              04210011
042200                                  TO APRD045-CONTROL-CARD-RECORD. 04220011
042300     PERFORM W100-WRITE-AP045-CONTROL-CARD.                       04230011
042400                                                                  04240011
042500 EJECT                                                            04250011
042600*---------------------------------------------------------------- 04260011
042700*   CREATES ADDITIONAL SORT INCLUDE CARDS FOR THE APRD063 LAYOUT  04270011
042800*   BASED SORT CONTROL CARDS.                                     04280011
042900*---------------------------------------------------------------- 04290011
043000 C400-CREATE-ADDL-AP063-CARDS.                                    04300011
043100                                                                  04310011
043200     MOVE 'C400-CREATE-ADDL-AP063-CARDS' TO PV-CURRENT-PARAGRAPH. 04320011
043300                                                                  04330011
043400     MOVE SPACES                 TO APRD063-CONTROL-CARD-RECORD.  04340011
043500     MOVE SV-ACCTYP-GL-ACCT-NBR  TO PV-APRD063-OR-ACCT.           04350011
043600     MOVE PV-APRD063-SORT-INCLUDE-OR                              04360011
043700                                 TO APRD063-CONTROL-CARD-RECORD.  04370011
043800     PERFORM W200-WRITE-AP063-CONTROL-CARD.                       04380011
043900                                                                  04390011
044000 EJECT                                                            04400011
044100*---------------------------------------------------------------- 04410011
044200*   CREATES THE END SORT INCLUDE CARD FOR THE APRD045 LAYOUT      04420011
044300*   BASED SORT CONTROL CARDS.                                     04430011
044400*---------------------------------------------------------------- 04440011
044500 C500-CREATE-END-AP045-CARD.                                      04450011
044600                                                                  04460011
044700     MOVE 'C500-CREATE-END-AP045-CARD' TO PV-CURRENT-PARAGRAPH.   04470011
044800                                                                  04480011
044900     MOVE SPACES                  TO APRD045-CONTROL-CARD-RECORD. 04490011
045000     MOVE SV-ACCTYP-GL-ACCT-NBR                                   04500011
045100                                  TO PV-APRD045-OR-END-ACCT.      04510011
045200     MOVE PV-APRD045-SORT-INCLUDE-OR-END                          04520011
045300                                  TO APRD045-CONTROL-CARD-RECORD. 04530011
045400     PERFORM W100-WRITE-AP045-CONTROL-CARD.                       04540011
045500                                                                  04550011
045600 EJECT                                                            04560011
045700*---------------------------------------------------------------- 04570011
045800*   CREATES THE END SORT INCLUDE CARD FOR THE APRD063 LAYOUT      04580011
045900*   BASED SORT CONTROL CARDS.                                     04590011
046000*---------------------------------------------------------------- 04600011
046100 C600-CREATE-END-AP063-CARD.                                      04610011
046200                                                                  04620011
046300     MOVE 'C600-CREATE-END-AP063-CARD' TO PV-CURRENT-PARAGRAPH.   04630011
046400                                                                  04640011
046500     MOVE SPACES                 TO APRD063-CONTROL-CARD-RECORD.  04650011
046600     MOVE SV-ACCTYP-GL-ACCT-NBR  TO PV-APRD063-OR-END-ACCT.       04660011
046700     MOVE PV-APRD063-SORT-INCLUDE-OR-END                          04670011
046800                                 TO APRD063-CONTROL-CARD-RECORD.  04680011
046900     PERFORM W200-WRITE-AP063-CONTROL-CARD.                       04690011
047000                                                                  04700011
047100 EJECT                                                            04710011
047200*---------------------------------------------------------------- 04720011
047300*    RETRIEVES THE GL ACCOUNT NUMBER FROM THE ACCOUNT TYPE TABLE. 04730011
047400*---------------------------------------------------------------- 04740011
047500 R200-FETCH-ACCT-TYP.                                             04750011
047600                                                                  04760011
047700     MOVE 'R200-FETCH-ACCT-TYP' TO PV-CURRENT-PARAGRAPH.          04770011
047800                                                                  04780011
047900     EXEC SQL                                                     04790011
048000         FETCH ACCT_TYP_CSR                                       04800011
048100         INTO  :ACCTYP-GL-ACCT-NBR                                04810011
048200     END-EXEC.                                                    04820011
048300                                                                  04830011
048400     EVALUATE TRUE                                                04840011
048500         WHEN SQLCODE = ZERO                                      04850011
048600              ADD 1 TO PV-ACCT-TYP-COUNT                          04860011
048700              MOVE ACCTYP-GL-ACCT-NBR TO SV-ACCTYP-GL-ACCT-NBR    04870011
048800         WHEN SQLCODE = +100                                      04880011
048900              SET PS-END-ACCT-TYP TO TRUE                         04890011
049000         WHEN SQLWARN0 NOT = SPACES                               04900011
049100         WHEN SQLCODE  NOT = ZERO                                 04910011
049200             MOVE PV-CURRENT-PARAGRAPH                            04920011
049300                                 TO AA-PARAGRAPH-NAME             04930011
049400             MOVE                                                 04940011
049500               'UNSUCCESSFUL FETCH WITH ACCT_TYP_CSR'             04950011
049600                                 TO AA-DB2-OPERATION              04960011
049700             MOVE 'TACCTYP'      TO AA-DB2-TABLE-1                04970011
049800             MOVE SPACES         TO AA-DB2-TABLE-2                04980011
049900                                    AA-DB2-TABLE-3                04990011
050000             PERFORM Z998-DB2-ABEND                               05000011
050100     END-EVALUATE.                                                05010011
050200                                                                  05020011
050300 EJECT                                                            05030011
050400*---------------------------------------------------------------- 05040011
050500*    WRITES THE APRD045 SORT CONTROL CARD.                        05050011
050600*---------------------------------------------------------------- 05060011
050700 W100-WRITE-AP045-CONTROL-CARD.                                   05070011
050800                                                                  05080011
050900     MOVE 'W100-WRITE-AP045-CONTROL-CARD' TO                      05090011
051000           PV-CURRENT-PARAGRAPH.                                  05100011
051100                                                                  05110011
051200     WRITE APRD045-CONTROL-CARD-RECORD.                           05120011
051300     ADD +1 TO PV-AP045-COUNT.                                    05130011
051400                                                                  05140011
051500 EJECT                                                            05150011
051600*---------------------------------------------------------------- 05160011
051700*    WRITES THE AP063 SORT CONTROL CARD.                          05170011
051800*---------------------------------------------------------------- 05180011
051900 W200-WRITE-AP063-CONTROL-CARD.                                   05190011
052000                                                                  05200011
052100     MOVE 'W200-WRITE-AP063-CONTROL-CARD' TO                      05210011
052200           PV-CURRENT-PARAGRAPH.                                  05220011
052300                                                                  05230011
052400     WRITE APRD063-CONTROL-CARD-RECORD.                           05240011
052500     ADD +1 TO PV-AP063-COUNT.                                    05250011
052600                                                                  05260011
052700 EJECT                                                            05270011
052800*---------------------------------------------------------------- 05280011
052900*    OPENS THE ACCOUNT TYPE CURSOR.                               05290011
053000*---------------------------------------------------------------- 05300011
053100 X100-OPEN-ACCOUNT-TYPE-CSR.                                      05310011
053200                                                                  05320011
053300     MOVE 'X100-OPEN-ACCOUNT-TYPE-CSR' TO PV-CURRENT-PARAGRAPH.   05330011
053400                                                                  05340011
053500     EXEC SQL                                                     05350011
053600         OPEN ACCT_TYP_CSR                                        05360011
053700     END-EXEC.                                                    05370011
053800                                                                  05380011
053900     EVALUATE TRUE                                                05390011
054000         WHEN SQLCODE = ZERO                                      05400011
054100              CONTINUE                                            05410011
054200                                                                  05420011
054300         WHEN SQLWARN0 NOT = SPACES                               05430011
054400         WHEN SQLCODE  NOT = ZERO                                 05440011
054500             MOVE PV-CURRENT-PARAGRAPH                            05450011
054600                                 TO AA-PARAGRAPH-NAME             05460011
054700             MOVE 'UNSUCCESSFUL OPEN ON ACCT_TYP_CSR'             05470011
054800                                 TO AA-DB2-OPERATION              05480011
054900             MOVE 'TACCTYP'      TO AA-DB2-TABLE-1                05490011
055000             MOVE SPACES         TO AA-DB2-TABLE-2                05500011
055100                                    AA-DB2-TABLE-3                05510011
055200             PERFORM Z998-DB2-ABEND                               05520011
055300     END-EVALUATE.                                                05530011
055400                                                                  05540011
055500 EJECT                                                            05550011
055600*---------------------------------------------------------------- 05560011
055700*    CLOSES THE ACCOUNT TYPE CURSOR.                              05570011
055800*---------------------------------------------------------------- 05580011
055900 Y100-CLOSE-ACCT-TYP-CSR.                                         05590011
056000                                                                  05600011
056100     MOVE 'Y100-CLOSE-ACCOUNT-TYPE-CSR' TO PV-CURRENT-PARAGRAPH.  05610011
056200                                                                  05620011
056300     EXEC SQL                                                     05630011
056400         CLOSE ACCT_TYP_CSR                                       05640011
056500     END-EXEC.                                                    05650011
056600                                                                  05660011
056700     EVALUATE TRUE                                                05670011
056800         WHEN SQLCODE = ZERO                                      05680011
056900              CONTINUE                                            05690011
057000                                                                  05700011
057100         WHEN SQLWARN0 NOT = SPACES                               05710011
057200         WHEN SQLCODE  NOT = ZERO                                 05720011
057300             MOVE PV-CURRENT-PARAGRAPH                            05730011
057400                                 TO AA-PARAGRAPH-NAME             05740011
057500             MOVE 'UNSUCCESSFUL CLOSE ON ACCT_TYP_CSR'            05750011
057600                                 TO AA-DB2-OPERATION              05760011
057700             MOVE 'TACCTYP'      TO AA-DB2-TABLE-1                05770011
057800             MOVE SPACES         TO AA-DB2-TABLE-2                05780011
057900                                    AA-DB2-TABLE-3                05790011
058000             PERFORM Z998-DB2-ABEND                               05800011
058100     END-EVALUATE.                                                05810011
058200                                                                  05820011
058300 EJECT                                                            05830011
058400*---------------------------------------------------------------- 05840011
058500*    ABEND ROUTINE FOR DB2 ERRORS.                                05850011
058600*---------------------------------------------------------------- 05860011
058700 Z998-DB2-ABEND.                                                  05870011
058800                                                                  05880011
058900     CLOSE APRD063-CONTROL-CARD-FILE                              05890011
059000           APRD045-CONTROL-CARD-FILE.                             05900011
059100     DISPLAY AA-ABEND-LIT.                                        05910011
059200     DISPLAY AA-MESSAGE-LINE.                                     05920011
059300     DISPLAY AA-DB2-ERROR-LIT.                                    05930011
059400     DISPLAY AA-PROGRAM-LIT.                                      05940011
059500     DISPLAY AA-PARAGRAPH-LIT.                                    05950011
059600     DISPLAY AA-DB2-OPERATION-LIT.                                05960011
059700     DISPLAY AA-DB2-TABLE-1.                                      05970011
059800     DISPLAY AA-DB2-TABLE-2.                                      05980011
059900     DISPLAY AA-DB2-TABLE-3.                                      05990011
060000     SET AC-DB2-ERROR TO TRUE.                                    06000011
060100                                                                  06010011
060200     COPY DPPD004.                                                06020011
060300                                                                  06030011
060400     CALL 'ILBOABN0' USING ABEND-CODE.                            06040011
060500                                                                  06050011
060600 EJECT                                                            06060011
060700*----------------------------------------------------------------*06070011
060800*    ABEND ROUTINE.                                              *06080011
060900*----------------------------------------------------------------*06090011
061000 Z999-ABEND.                                                      06100011
061100                                                                  06110011
061200     CLOSE APRD063-CONTROL-CARD-FILE                              06120011
061300           APRD045-CONTROL-CARD-FILE.                             06130011
061400     DISPLAY AA-ABEND-LIT.                                        06140011
061500     DISPLAY AA-PROGRAM-LIT.                                      06150011
061600     DISPLAY AA-PARAGRAPH-LIT.                                    06160011
061700     DISPLAY AA-MESSAGE-LINE.                                     06170011
061800     CALL 'ILBOABN0' USING ABEND-CODE.                            06180011
