000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400 PROGRAM-ID.             SUKUT706.                                00040001
000500 AUTHOR.                 LARRY SCHLEICHER.                        00050001
000600 INSTALLATION.           KOHLS.                                   00060001
000700 DATE-WRITTEN            SEPTEMBER, 2003.                         00070001
000800 DATE-COMPILED.                                                   00080001
000900                                                                  00090001
001000******************************************************************00100001
001100* THIS PROGRAM WILL PROCESS ALL OF THE UNITS ASSOCIATED WITH      00110038
001200* A CARTON AS IT IS CHECKED-IN.  ALL OF THE ITEMS ASSOCIATED TO   00120003
001300* THE CARTON ARE IDENTIFIED AND A CALL IS MADE TO UPDATE THE      00130038
001400* UNIT QUANTITIES FOR THESE ITEMS.                                00140003
001500******************************************************************00150070
001600* THIS PROGRAM WILL BE CALLED BY PROGRAM PCKRF859 WHICH DOES      00160041
001700* THE UNUSED AND RECLAIM LABEL PROCESSING AS OF 7/2004.           00170041
001800******************************************************************00180001
001900 ENVIRONMENT DIVISION.                                            00190001
002000 DATA DIVISION.                                                   00200001
002100******************************************************************00210001
002200                                                                  00220001
002300 WORKING-STORAGE SECTION.                                         00230001
002400     COPY SUWS035.                                                00240001
002500                                                                  00250001
002600     COPY SUWS036.                                                00260003
002700                                                                  00270003
002800******************************************************************00280034
002900*  RANDOM NUMBER AREA.                                            00290034
003000******************************************************************00300034
003100     COPY DPWS902.                                                00310034
003200                                                                  00320034
003300******************************************************************00330080
003400*    PREPACK VERIFICATION                                         00340080
003500******************************************************************00350080
003600     COPY RCWS806.                                                00360080
003700*                                                                 00370001
003800 01  DK-DB2-KEYS.                                                 00380001
003900     05  DK-STR-NBR                      PIC S9(04) COMP SYNC.    00390002
004000     05  DK-STR-DEST-NBR                 PIC S9(4) COMP VALUE +0. 00400001
004100     05  DK-PACK-ID                      PIC S9(4) COMP VALUE +0. 00410001
004200     05  DK-AUDIT-CNTL-NBR               PIC S9(09) COMP.         00420001
004300     05  DK-SHIPT-UNT-ID                 PIC S9(18) COMP-3.       00430001
004400     05  DK-OTBND-SHIPT-UNT-ID           PIC S9(18) COMP-3.       00440019
004500     05  DK-OPER-UNT-ID                  PIC S9(04) COMP.         00450001
004600     05  DK-FCLTY-ID                     PIC S9(04) COMP.         00460001
004700     05  DK-PO-NBR                       PIC S9(09) COMP SYNC.    00470023
004800     05  DK-REC-SEQ-NBR                  PIC S9(09) COMP SYNC.    00480023
004900     05  DK-PO-LNE-NBR                   PIC S9(09) COMP SYNC.    00490023
005000     05  DK-PKSL-LNE-NBR                 PIC S9(09) COMP SYNC.    00500001
005100     05  DK-TRN-TYP-CDE                  PIC  X(02).              00510001
005200     05  DK-UPC-NBR                      PIC S9(15)V COMP-3.      00520001
005300     05  DK-STR-NBR-N                    PIC 9(4).                00530001
005400     05  DK-STR-NBR-X   REDEFINES     DK-STR-NBR-N.               00540001
005500         10  DK-STR-NBR-X1               PIC X(01).               00550001
005600         10  DK-STR-NBR-X2               PIC X(03).               00560001
005700     05  DK-STR-NBR-USE                  PIC X(03).               00570001
005800     05  DK-NULL                         PIC S9(04)  VALUE +0     00580001
005900                                              COMP SYNC.          00590001
006000     05  DK-UPDATE-TYPE-IND              PIC  X(01) VALUE SPACE.  00600041
006100     05  DK-LINE-SUCCESS                 PIC S9(04) VALUE ZEROS.  00610046
006200     05  DK-LINE-FAILED                  PIC S9(04) VALUE ZEROS.  00620046
006400     05  DK-ODD-UNT-IND                  PIC  X(01) VALUE SPACES. 00630046
006500     05  DK-ADJ-BEF-QTY                  PIC S9(04) COMP.         00640077
006600     05  DK-ADJ-AFT-QTY                  PIC S9(04) COMP.         00650078
006700                                                                  00660001
006800 01  DN-DB2-NULL-INDICATORS.                                      00670001
006900     05  DN-AUDIT-IND               PIC S9(04) COMP VALUE ZEROES. 00680001
007000     05  DN-SHIPT-IND               PIC S9(04) COMP VALUE ZEROES. 00690001
007100     05  DN-PROB-IND                PIC S9(04) COMP VALUE ZEROES. 00700001
007200     05  DN-ADJ-IND                 PIC S9(04) COMP VALUE ZEROES. 00710001
007300                                                                  00720001
007400 01  PC-PROGRAM-CONSTANTS.                                        00730001
007500     05  PC-SUKUT702               PIC X(08)  VALUE 'SUKUT702'.   00740011
007600     05  PC-RANDOM-NBR-GENERATOR   PIC X(08)  VALUE 'DPKUT902'.   00750042
007700     05  PC-RCKCS806               PIC X(08)  VALUE 'RCKCS806'.   00760081
007800                                                                  00770001
007900 01  PS-PROGRAM-SWITCHES.                                         00780001
008000     05  PS-MORE-OTBND-UPC-SW         PIC X(01)  VALUE 'N'.       00790023
008100         88  PS-MORE-OTBND-UPC-YES               VALUE 'Y'.       00800023
008200         88  PS-MORE-OTBND-UPC-NO                VALUE 'N'.       00810023
008300     05  PS-MORE-OTBND-UPC-2-SW       PIC X(01)  VALUE 'N'.       00820063
008400         88  PS-MORE-OTBND-UPC-YES-2             VALUE 'Y'.       00830063
008500         88  PS-MORE-OTBND-UPC-NO-2              VALUE 'N'.       00840063
008600     05  PS-LOG-MESSAGE-SW              PIC  X       VALUE 'N'.   00850001
008700         88  PS-LOG-MESSAGE                          VALUE 'Y'.   00860001
008800         88  PS-NO-LOG-MESSAGE                       VALUE 'N'.   00870001
008900     05  PS-OTBND-UPC-CSR-SW            PIC  X       VALUE 'N'.   00880080
009000         88  PS-OTBND-UPC-CSR                        VALUE 'Y'.   00890080
009100         88  PS-NOT-OTBND-UPC-CSR                    VALUE 'N'.   00900080
009200     05  PS-FINCL-ADJ-ID-EXISTS-SW      PIC  X(01)   VALUE 'N'.   00910034
009300         88  PS-FINCL-ADJ-ID-EXISTS                  VALUE 'Y'.   00920034
009400         88  PS-FINCL-ADJ-ID-NOT-EXISTS              VALUE 'N'.   00930034
009500     05  PS-PREPACK-SW                  PIC  X(01)   VALUE 'N'.   00940046
009600         88  PS-PREPACK-YES                          VALUE 'Y'.   00950046
009700         88  PS-PREPACK-NO                           VALUE 'N'.   00960046
009800                                                                  00970001
009900 01  PV-PROGRAM-VARIABLES.                                        00980001
010000     05  PV-SAVE-LINE-IDX                PIC  S9(4) COMP VALUE 0. 00990081
010100     05  PV-SAVE-LAST-IDX                PIC  S9(4) COMP VALUE 0. 01000081
010200     05  PV-SAVE-PREPK-ID                PIC  S9(4) COMP VALUE 0. 01010081
010300     05  PV-NUMBER-OF-LINES              PIC  S9(5) COMP-3.       01020081
010400     05  PV-BEFORE-QTY                   PIC  S9(9) COMP.         01030081
010500     05  PV-AFTER-QTY                    PIC  S9(9) COMP.         01040081
010600     05  PV-PACK-DIFF                    PIC  S9(9) COMP VALUE 0. 01050081
010700     05  PV-ODD-DIFF                     PIC  S9(9) COMP VALUE 0. 01060081
010800     05  PV-ADJ-MINUS-ODD                PIC  S9(9) COMP VALUE 0. 01070081
010900     05  PV-BRCDE-NBR                    PIC X(22).               01080019
011000     05  FILLER REDEFINES PV-BRCDE-NBR.                           01090019
011100         10  PV-BRCDE-NBR-FILLER-1       PIC  X(02).              01100019
011200         10  PV-BRCDE-NBR-N              PIC  9(18).              01110019
011300         10  PV-BRCDE-NBR-FILLER-2       PIC  X(02).              01120019
011400     05  PV-CICS-MSG-AREA                PIC  X(100) VALUE SPACE. 01130001
011500     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01140001
011600                                                COMP SYNC.        01150001
011700     05  PV-CICS-RESPONSE                PIC S9(04)  VALUE +0     01160001
011800                                                COMP SYNC.        01170001
011900     05  PV-DISPLAY-SQLCODE              PIC -9(05) VALUE ZEROES. 01180001
012000     05  PV-DISP-SHIPT-UNT-ID            PIC 9(18).               01190003
012100     05  PV-DISP-UPC-NBR                 PIC 9(15).               01200034
012200     05  PV-DISP-OPER-UNT-ID             PIC 9(04).               01210034
012300     05  PV-DISP-PO                      PIC 9(09).               01220003
012400     05  PV-DISP-RCVR-SEQ-NBR            PIC 9(04).               01230003
012500     05  PV-DISPLAY-CICS-RESP            PIC 999999999-           01240001
012600                                                 VALUE ZEROS.     01250001
012700     05  PV-DISP-FINCL-ADJ-ID            PIC 9(09) VALUE ZEROES.  01260034
012800     05  PV-FINCL-ADJ-ID                 PIC S9(9)   COMP SYNC.   01270034
012900                                                                  01280034
013000 01  TB-PACK-TABLE.                                               01290080
013100     05  TB-PACK-ITEM OCCURS 500 TIMES INDEXED BY LINE-IDX.       01300080
013200         10  PACK-IND                    PIC   X(01).             01310080
013300         10  PACK-PRPPK-ID               PIC  S9(4) COMP.         01320080
013400         10  PACK-PREPK-DRV-LNE-CDE      PIC   X(01).             01330080
013500         10  PACK-LINE                   PIC  S9(9) COMP.         01340080
013600         10  PACK-UPC                    PIC  S9(15) COMP-3.      01350080
013700         10  PACK-RATO                   PIC  S9(4) COMP.         01360080
013800         10  PACK-AUDIT-QTY              PIC  S9(09) COMP-3.      01370080
013900         10  PACK-CRTN-QTY               PIC  S9(09) COMP-3.      01380080
014000         10  PACK-CRTN-REC-TYPE          PIC   X(01).             01390080
014100         10  PACK-CRTN-INTR-UPC          PIC  S9(9)  COMP.        01400080
014200         10  PACK-CRTN-HOLD-UPC          PIC  S9(15)V COMP-3.     01410080
014300         10  PACK-AUD-REC-TYPE           PIC   X(02).             01420080
014400         10  PACK-AUD-INTR-UPC           PIC  S9(9)  COMP.        01430080
014500         10  PACK-AUD-HOLD-UPC           PIC  S9(15)V COMP-3.     01440080
014600         10  PACK-BEST-CASE-UNITS        PIC  S9(07) COMP-3.      01450080
014700         10  PACK-ODD-UNITS              PIC  S9(05) COMP-3.      01460080
014800         10  PACK-BACKOUT-IND            PIC   X(01).             01470080
014900         10  PACK-DEST-LOC               PIC  S9(9)  COMP.        01480080
015000                                                                  01490080
015100******************************************************************01500079
015200*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE ADJUSTMENTS        01510079
015300*  TABLE (SUT_FINCL_ADJ)                                          01520079
015400******************************************************************01530079
015500     EXEC SQL                                                     01540079
015600         INCLUDE SUT00030                                         01550079
015700     END-EXEC.                                                    01560079
015800                                                                  01570079
015900******************************************************************01580079
016000*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE OUTBOUND PACK      01590079
016100*  TABLE (SUT_OTBND_PK)                                           01600079
016200******************************************************************01610079
016300     EXEC SQL                                                     01620079
016400         INCLUDE SUT00041                                         01630079
016500     END-EXEC.                                                    01640079
016600                                                                  01650079
016700******************************************************************01660079
016800* DB2 AREA FOR THE SHIPMENT UNIT QUANTITY ADJUSTMENT TABLE        01670079
016900******************************************************************01680034
017000     EXEC SQL                                                     01690034
017100          INCLUDE TSUQADJ                                         01700034
017200     END-EXEC.                                                    01710034
017300                                                                  01720034
017400*----------------------------------------------------------------*01730002
017500*    DB2 OUTBOUND SHIP UNIT TABLE (SUT_OTBND_UPC)                 01740015
017600*----------------------------------------------------------------*01750002
017700     EXEC SQL                                                     01760002
017800          INCLUDE SUT00028                                        01770015
017900     END-EXEC.                                                    01780002
018000                                                                  01790023
018100*----------------------------------------------------------------*01800023
018200*  DCLGEN LAYOUT AND COBOL DECLARATION OTBND SHIPT CARTON         01810023
018300*   (SUT_OTBND_CART)                                             *01820023
018400*----------------------------------------------------------------*01830023
018500     EXEC SQL                                                     01840023
018600         INCLUDE SUT00024                                         01850023
018700     END-EXEC.                                                    01860023
018800                                                                  01870023
018900*----------------------------------------------------------------*01880033
019000*  DCLGEN LAYOUT AND COBOL DECLARATION RECEIVER ITEM TABLE        01890023
019100*   (TRECITM)                                                    *01900023
019200*----------------------------------------------------------------*01910023
019300     EXEC SQL                                                     01920023
019400         INCLUDE TRECITM                                          01930023
019500     END-EXEC.                                                    01940023
019600                                                                  01950023
019700*----------------------------------------------------------------*01960046
019800*  DCLGEN LAYOUT AND COBOL DECLARATION RECEIVER TABLE             01970046
019900*   (TRECEIV)                                                    *01980046
020000*----------------------------------------------------------------*01990046
020100     EXEC SQL                                                     02000046
020200         INCLUDE TRECEIV                                          02010046
020300     END-EXEC.                                                    02020046
020400                                                                  02030046
020500*----------------------------------------------------------------*02040046
020600*  DCLGEN LAYOUT AND COBOL DECLARATION PO PREPK TABLE             02050046
020700*   (TPOPRPK)                                                    *02060046
020800*----------------------------------------------------------------*02070046
020900     EXEC SQL                                                     02080046
021000         INCLUDE TPOPRPK                                          02090046
021100     END-EXEC.                                                    02100046
021200                                                                  02110046
021300******************************************************************02120004
021400*  SQL AND COBOL DECLARATIONS FOR THE KOHLS/RETEK PARMS (TKRPRPM) 02130004
021500******************************************************************02140004
021600     EXEC SQL                                                     02150004
021700          INCLUDE TKRPRPM                                         02160004
021800     END-EXEC.                                                    02170004
021900                                                                  02180005
022000*----------------------------------------------------------------*02190053
022100*    DB2 OUTBOUND VENDER TABLE (SUT_OTBND_VND)                    02200053
022200*----------------------------------------------------------------*02210053
022300     EXEC SQL                                                     02220053
022400          INCLUDE SUT00026                                        02230053
022500     END-EXEC.                                                    02240053
022600                                                                  02250053
022700*----------------------------------------------------------------*02260054
022800*    DB2 PACK SLIP  TABLE (TPKSLIP)                               02270054
022900*----------------------------------------------------------------*02280054
023000     EXEC SQL                                                     02290054
023100          INCLUDE TPKSLIP                                         02300054
023200     END-EXEC.                                                    02310054
023300                                                                  02320054
023400******************************************************************02330001
023500*  COMMUNICATIONS AREA FOR DB2                                    02340001
023600******************************************************************02350001
023700     EXEC SQL                                                     02360001
023800         INCLUDE SQLCA                                            02370001
023900     END-EXEC.                                                    02380001
024000                                                                  02390001
024100******************************************************************02400045
024200     EXEC SQL                                                     02410001
024300         DECLARE OTBND-UPC-CURSOR CURSOR FOR                      02420015
024400         SELECT A.TRN_NBR                                         02430023
024500              , A.RCVR_SEQ_NBR                                    02440023
024600              , A.TRN_LNE_NBR                                     02450023
024700              , A.UPC_NBR                                         02460023
024800              , A.SHPD_UNT_QTY                                    02470023
024900              , B.DEST_LOC_NBR                                    02480023
025000              , C.STATUS_CDE                                      02490033
025100              , C.PREPK_ID                                        02500046
025200              , C.PREPK_RATO_QTY                                  02510074
025300              , C.PREPK_DRV_LNE_CDE                               02520080
025400          FROM  SUT_OTBND_UPC A                                   02530023
025500            ,   SUT_OTBND_CART B                                  02540023
025600            ,   TRECITM C                                         02550033
025700          WHERE A.SHIPT_UNT_ID      = :DK-OTBND-SHIPT-UNT-ID      02560023
025800            AND A.SHIPT_UNT_ID      = B.SHIPT_UNT_ID              02570023
025900            AND A.TRN_NBR           = C.ORD_NBR                   02580033
026000            AND A.RCVR_SEQ_NBR      = C.REC_SEQ_NBR               02590033
026100            AND A.TRN_LNE_NBR       = C.ORD_LNE_NBR               02600033
026200            AND C.VER_STATUS_CDE    = 'A'                         02610033
026300       ORDER BY C.PREPK_ID                                        02620080
026400     END-EXEC.                                                    02630001
026500                                                                  02640046
026600******************************************************************02650053
026700* THIS CURSOR IS FOR ORDERS WHERE THE RECEIVER = ZERO ON          02660053
026800* SUT-OTBND-UPC.                                                  02670053
026900******************************************************************02680053
027000     EXEC SQL                                                     02690053
027100         DECLARE OTBND-UPC-CURSOR-2 CURSOR FOR                    02700053
027200          SELECT DISTINCT(A.TRN_NBR)                              02710053
027300               , A.TRN_LNE_NBR                                    02720053
027400               , A.UPC_NBR                                        02730053
027500               , A.SHPD_UNT_QTY                                   02740053
027600               , B.DEST_LOC_NBR                                   02750053
027700               , C.STATUS_CDE                                     02760053
027800               , C.PREPK_ID                                       02770053
027900               , E.REC_SEQ_NBR                                    02780080
028000               , C.PREPK_RATO_QTY                                 02790080
028100               , C.PREPK_DRV_LNE_CDE                              02800080
028200           FROM  SUT_OTBND_UPC A                                  02810055
028300             ,   SUT_OTBND_CART B                                 02820055
028400             ,   TRECITM C                                        02830055
028500             ,   SUT_OTBND_VND D                                  02840080
028600             ,   TPKSLIP  E                                       02850080
028700           WHERE  A.SHIPT_UNT_ID      = :DK-OTBND-SHIPT-UNT-ID    02860057
028800             AND  A.SHIPT_UNT_ID      = B.SHIPT_UNT_ID            02870053
028900             AND  A.TRN_NBR           = C.ORD_NBR                 02880053
029000             AND  A.TRN_LNE_NBR       = C.ORD_LNE_NBR             02890053
029100             AND  C.VER_STATUS_CDE    = 'A'                       02900053
029200             AND  A.SHIPT_UNT_ID      = D.SHIPT_UNT_ID            02910080
029300             AND  A.TRN_NBR           = D.PO_NBR                  02920080
029400             AND  D.PO_NBR            = E.PO_NBR                  02930080
029500             AND  D.PKSL_SEQ_NBR      = E.SEQ_NBR                 02940080
029600             AND  C.REC_SEQ_NBR       = E.REC_SEQ_NBR             02950080
029700             AND  E.VER_STAT_CDE      = 'A'                       02960080
029800       ORDER BY C.PREPK_ID                                        02970080
029900     END-EXEC.                                                    02980064
030000                                                                  02990064
030100******************************************************************03000064
030200 LINKAGE SECTION.                                                 03010053
030300 01  DFHCOMMAREA.                                                 03020001
030400     05  FILLER                         OCCURS  1 TO 4072 TIMES   03030001
030500                                      DEPENDING ON EIBCALEN.      03040001
030600         10  FILLER                   PIC X.                      03050001
030700******************************************************************03060001
030800                                                                  03070001
030900******************************************************************03080001
031000 PROCEDURE DIVISION.                                              03090001
031100******************************************************************03100001
031200 0000-PROGRAM-MAINLINE.                                           03110001
031300     INITIALIZE PV-PROGRAM-VARIABLES                              03120001
031400                PS-PROGRAM-SWITCHES                               03130001
031500                SU036-COMM-AREA.                                  03140021
031600     MOVE DFHCOMMAREA              TO  SU036-COMM-AREA.           03150021
031700     MOVE SU036-ORIG-OPER-UNT-ID   TO DK-OPER-UNT-ID.             03160052
031800     PERFORM 7100-CHECK-FOR-LOGGING.                              03170001
031900     IF PS-LOG-MESSAGE                                            03180001
032000         MOVE SU036-PO            TO PV-DISP-PO                   03190021
032100         MOVE SU036-REC-SEQ-NBR   TO PV-DISP-RCVR-SEQ-NBR         03200021
032200         MOVE SU036-SHIPT-UNT-ID  TO PV-DISP-SHIPT-UNT-ID         03210021
032300         STRING   ' SUKUT706 PROGRAM STARTED -'                   03220001
032400                  ' CALLED BY-'                                   03230001
032500                  SU036-PROGRAM-NAME                              03240021
032600                  ' PO='                                          03250001
032700                  PV-DISP-PO                                      03260001
032800                  ' RCVR='                                        03270001
032900                  PV-DISP-RCVR-SEQ-NBR                            03280001
033000                  ' SHPT UNT ='                                   03290003
033100                  PV-DISP-SHIPT-UNT-ID                            03300003
033200                  DELIMITED BY SIZE                               03310001
033300                                  INTO PV-CICS-MSG-AREA           03320001
033400         MOVE PV-CICS-MSG-AREA      TO SU036-CRA-RET-MSG          03330021
033500         PERFORM 9999-WRITE-TO-CSSL                               03340001
033600     END-IF.                                                      03350001
033700     PERFORM 1000-PROCESS-ADJUSTMENT.                             03360001
033800     IF PS-PREPACK-YES                                            03370046
033900         PERFORM 3000-PROCESS-PREPK-FAILURES                      03380046
034000     END-IF.                                                      03390046
034100                                                                  03400001
034200     MOVE DK-UPDATE-TYPE-IND TO SU036-UPDATE-TYPE-IND.            03410041
034300     MOVE SU036-COMM-AREA    TO DFHCOMMAREA.                      03420041
034400     GOBACK.                                                      03430001
034500                                                                  03440001
034600 1000-PROCESS-ADJUSTMENT.                                         03450001
034700                                                                  03460001
034800     MOVE SU036-SHIPT-UNT-ID TO DK-OTBND-SHIPT-UNT-ID.            03470033
034900     PERFORM 7200-SELECT-RECEIVER.                                03480080
035000     INITIALIZE DK-LINE-SUCCESS.                                  03490046
035100     INITIALIZE DK-LINE-FAILED.                                   03500046
035200     PERFORM 2000-OPEN-OTBND-UPC-CURSOR.                          03510062
035300     PERFORM 2200-FETCH-OTBND-UPC.                                03520062
035400     IF SQLCODE = +0                                              03530062
035500         SET PS-OTBND-UPC-CSR   TO TRUE                           03540080
035600         IF RECEIV-PKGNG-CDE = 'M' OR RECEIV-PKGNG-CDE = 'I'      03550080
035700             SET LINE-IDX    TO 1                                 03560081
035800             PERFORM 2500-PROCESS-PREPACK-TABLE                   03570080
035900                 UNTIL PS-MORE-OTBND-UPC-NO                       03580080
036000             PERFORM 2300-CLOSE-OTBND-UPC-CURSOR                  03590080
036100             MOVE 1 TO PV-SAVE-LINE-IDX                           03600080
036200             PERFORM 2510-PERFORM-BEST-CASE                       03610080
036300                 UNTIL PACK-IND (PV-SAVE-LINE-IDX) NOT = 'Y'      03620080
036400                    OR PV-SAVE-LINE-IDX > 500                     03630080
036500         ELSE                                                     03640080
036600             PERFORM 2100-GET-OTBND-UPC                           03650080
036700                 UNTIL PS-MORE-OTBND-UPC-NO                       03660080
036800             PERFORM 2300-CLOSE-OTBND-UPC-CURSOR                  03670080
036900         END-IF                                                   03680080
037000     ELSE                                                         03690054
037100         PERFORM 2300-CLOSE-OTBND-UPC-CURSOR                      03700080
037200         SET PS-NOT-OTBND-UPC-CSR   TO TRUE                       03710080
037300         PERFORM 2010-OPEN-OTBND-UPC-CURSOR-2                     03720080
037400         PERFORM 2210-FETCH-OTBND-UPC-2                           03730080
037500         IF RECEIV-PKGNG-CDE = 'M' OR RECEIV-PKGNG-CDE = 'I'      03740080
037600             SET LINE-IDX    TO 1                                 03750081
037700             PERFORM 2500-PROCESS-PREPACK-TABLE                   03760080
037800                 UNTIL PS-MORE-OTBND-UPC-NO-2                     03770080
037900             PERFORM 2310-CLOSE-OTBND-UPC-CURSOR-2                03780080
038000             MOVE 1 TO PV-SAVE-LINE-IDX                           03790080
038100             PERFORM 2510-PERFORM-BEST-CASE                       03800080
038200                 UNTIL PACK-IND (PV-SAVE-LINE-IDX) NOT = 'Y'      03810080
038300                    OR PV-SAVE-LINE-IDX > 500                     03820080
038400         ELSE                                                     03830080
038500             PERFORM 2110-GET-OTBND-UPC                           03840080
038600                 UNTIL PS-MORE-OTBND-UPC-NO-2                     03850080
038700             PERFORM 2310-CLOSE-OTBND-UPC-CURSOR-2                03860080
038800         END-IF                                                   03870080
038900     END-IF.                                                      03880080
039000                                                                  03890003
039100 2000-OPEN-OTBND-UPC-CURSOR.                                      03900023
039200                                                                  03910003
039300     EXEC SQL                                                     03920003
039400         OPEN OTBND-UPC-CURSOR                                    03930015
039500     END-EXEC.                                                    03940003
039600                                                                  03950003
039700     EVALUATE TRUE                                                03960003
039800       WHEN SQLCODE = ZERO                                        03970003
039900           SET PS-MORE-OTBND-UPC-YES TO TRUE                      03980023
040000       WHEN SQLWARN0 NOT = SPACES                                 03990003
040100       WHEN SQLCODE  NOT = ZERO                                   04000003
040200           MOVE DK-OTBND-SHIPT-UNT-ID                             04010019
040300                               TO PV-DISP-SHIPT-UNT-ID            04020003
040400           MOVE SQLCODE        TO PV-DISPLAY-SQLCODE              04030003
040500           STRING   ' SUKUT706-2000-'                             04040003
040600                      ' CALLED BY-'                               04050003
040700                      SU036-PROGRAM-NAME                          04060021
040800                      '  SQLCODE='                                04070003
040900                      PV-DISPLAY-SQLCODE                          04080003
041000                      ' SHIPT UNT= '                              04090003
041100                      PV-DISP-SHIPT-UNT-ID                        04100003
041200                      DELIMITED BY SIZE                           04110003
041300                                      INTO PV-CICS-MSG-AREA       04120003
041400           PERFORM 9999-WRITE-TO-CSSL                             04130003
041500           MOVE '2000-'                TO SU036-CRA-REQ-ID        04140021
041600           MOVE PV-CICS-MSG-AREA      TO SU036-CRA-RET-MSG        04150021
041700           PERFORM 9998-RETURN                                    04160003
041800     END-EVALUATE.                                                04170003
041900                                                                  04180003
042000 2010-OPEN-OTBND-UPC-CURSOR-2.                                    04190054
042100                                                                  04200054
042200     EXEC SQL                                                     04210054
042300         OPEN OTBND-UPC-CURSOR-2                                  04220054
042400     END-EXEC.                                                    04230054
042500                                                                  04240054
042600     EVALUATE TRUE                                                04250054
042700       WHEN SQLCODE = ZERO                                        04260054
042800           SET PS-MORE-OTBND-UPC-YES-2 TO TRUE                    04270063
042900       WHEN SQLWARN0 NOT = SPACES                                 04280054
043000       WHEN SQLCODE  NOT = ZERO                                   04290054
043100           MOVE DK-OTBND-SHIPT-UNT-ID                             04300054
043200                               TO PV-DISP-SHIPT-UNT-ID            04310054
043300           MOVE SQLCODE        TO PV-DISPLAY-SQLCODE              04320054
043400           STRING   ' SUKUT706-2010-'                             04330054
043500                      ' CALLED BY-'                               04340054
043600                      SU036-PROGRAM-NAME                          04350054
043700                      '  SQLCODE='                                04360054
043800                      PV-DISPLAY-SQLCODE                          04370054
043900                      ' SHIPT UNT= '                              04380054
044000                      PV-DISP-SHIPT-UNT-ID                        04390054
044100                      DELIMITED BY SIZE                           04400054
044200                                      INTO PV-CICS-MSG-AREA       04410054
044300           PERFORM 9999-WRITE-TO-CSSL                             04420054
044400           MOVE '2010-'                TO SU036-CRA-REQ-ID        04430054
044500           MOVE PV-CICS-MSG-AREA      TO SU036-CRA-RET-MSG        04440054
044600           PERFORM 9998-RETURN                                    04450054
044700     END-EVALUATE.                                                04460054
044800                                                                  04470054
044900 2100-GET-OTBND-UPC.                                              04480054
045000                                                                  04490003
045100     IF PS-MORE-OTBND-UPC-YES                                     04500023
045200        MOVE DK-OTBND-SHIPT-UNT-ID  TO SU035-SHIPT-UNT-ID         04510041
045300        MOVE SUT00028-TRN-NBR       TO SU035-PO                   04520041
045400                                       SU036-PO                   04530067
045500        IF SUT00028-RCVR-SEQ-NBR > 0                              04540054
045600            MOVE SUT00028-RCVR-SEQ-NBR  TO SU035-REC-SEQ-NBR      04550054
045700                                           SU036-REC-SEQ-NBR      04560067
045800                                           DK-REC-SEQ-NBR         04570060
045900        ELSE                                                      04580054
046000            MOVE PKSLIP-REC-SEQ-NBR     TO SU035-REC-SEQ-NBR      04590060
046100                                           SU036-REC-SEQ-NBR      04600067
046200                                           DK-REC-SEQ-NBR         04610060
046300        END-IF                                                    04620054
046400        MOVE SUT00028-TRN-LNE-NBR   TO SU035-PO-LNE-NBR           04630041
046500                                       SU036-PO-LNE-NBR           04640067
046600        MOVE SUT00028-UPC-NBR       TO SU035-UPC-NBR              04650041
046700        MOVE SU036-PRC-RSN-CDE      TO SU035-PRC-RSN-CDE          04660041
046800        MOVE SUT00028-SHPD-UNT-QTY  TO SU035-BEFORE-QTY           04670041
046900        COMPUTE SU035-ADJUST-QTY =                                04680041
047000                    SUT00028-SHPD-UNT-QTY * -1                    04690041
047100        MOVE 0                      TO SU035-AFTER-QTY            04700041
047200        MOVE SU036-ORIG-OPER-UNT-ID TO SU035-ORIG-OPER-UNT-ID     04710041
047300        MOVE SU036-CREATE-USER-ID   TO SU035-CREATE-USER-ID       04720041
047400        MOVE SU036-PROGRAM-NAME     TO SU035-PROGRAM-NAME         04730041
047500        MOVE SUT00024-DEST-LOC-NBR  TO SU035-DEST-LOC-NBR         04740041
047600                                       SU036-DEST-LOC-NBR         04750067
047700        IF SU036-PACK-BY-STORE-YES                                04760036
047800            SET SU035-PACK-BY-STORE-YES TO TRUE                   04770036
047900        END-IF                                                    04780036
048000        MOVE SU036-LOG-ONLY-IND     TO SU035-LOG-ONLY-IND         04790072
084600        SET SU035-PACK-NO           TO TRUE                       04800097
048100        PERFORM 2400-INSERT-TSUQADJ                               04810036
048200        MOVE PV-FINCL-ADJ-ID    TO SU035-FINCL-ADJ-ID             04820039
048300        SET SU035-UPDATE-DISTDT TO TRUE                           04830071
048400        SET SU035-ODD-UNIT-NO   TO TRUE                           04840075
048400        MOVE 'Y' TO SU035-UPDATE-UNTS-WORKED-IND                  04850090
048500        PERFORM 7000-LINK-SUKUT702                                04860036
048600        PERFORM 2200-FETCH-OTBND-UPC                              04870062
048700     END-IF.                                                      04880003
048800                                                                  04890003
048900 2110-GET-OTBND-UPC.                                              04900062
049000                                                                  04910062
049100     IF PS-MORE-OTBND-UPC-YES-2                                   04920063
049200        MOVE DK-OTBND-SHIPT-UNT-ID  TO SU035-SHIPT-UNT-ID         04930062
049300        MOVE SUT00028-TRN-NBR       TO SU035-PO                   04940062
049400                                       SU036-PO                   04950067
049500        IF SUT00028-RCVR-SEQ-NBR > 0                              04960067
049600            MOVE SUT00028-RCVR-SEQ-NBR  TO SU035-REC-SEQ-NBR      04970067
049700                                           SU036-REC-SEQ-NBR      04980067
049800                                           DK-REC-SEQ-NBR         04990067
049900        ELSE                                                      05000067
050000            MOVE PKSLIP-REC-SEQ-NBR     TO SU035-REC-SEQ-NBR      05010067
050100                                           SU036-REC-SEQ-NBR      05020067
050200                                           DK-REC-SEQ-NBR         05030067
050300        END-IF                                                    05040067
050400        MOVE SUT00028-TRN-LNE-NBR   TO SU035-PO-LNE-NBR           05050067
050500                                       SU036-PO-LNE-NBR           05060067
050600        MOVE SUT00028-UPC-NBR       TO SU035-UPC-NBR              05070067
050700        MOVE SU036-PRC-RSN-CDE      TO SU035-PRC-RSN-CDE          05080067
050800        MOVE SUT00028-SHPD-UNT-QTY  TO SU035-BEFORE-QTY           05090067
050900        COMPUTE SU035-ADJUST-QTY =                                05100067
051000                    SUT00028-SHPD-UNT-QTY * -1                    05110067
051100        MOVE 0                      TO SU035-AFTER-QTY            05120067
051200        MOVE SU036-ORIG-OPER-UNT-ID TO SU035-ORIG-OPER-UNT-ID     05130067
051300        MOVE SU036-CREATE-USER-ID   TO SU035-CREATE-USER-ID       05140067
051400        MOVE SU036-PROGRAM-NAME     TO SU035-PROGRAM-NAME         05150067
051500        MOVE SUT00024-DEST-LOC-NBR  TO SU035-DEST-LOC-NBR         05160067
051600                                       SU036-DEST-LOC-NBR         05170067
051700        IF SU036-PACK-BY-STORE-YES                                05180067
051800            SET SU035-PACK-BY-STORE-YES TO TRUE                   05190067
051900        END-IF                                                    05200067
052000        MOVE SU036-LOG-ONLY-IND     TO SU035-LOG-ONLY-IND         05210073
084600        SET SU035-PACK-NO           TO TRUE                       05220097
052100        PERFORM 2400-INSERT-TSUQADJ                               05230067
052200        MOVE PV-FINCL-ADJ-ID    TO SU035-FINCL-ADJ-ID             05240067
052300        SET SU035-UPDATE-DISTDT TO TRUE                           05250071
052400        SET SU035-ODD-UNIT-NO   TO TRUE                           05260075
048400        MOVE 'Y' TO SU035-UPDATE-UNTS-WORKED-IND                  05270090
052500        PERFORM 7000-LINK-SUKUT702                                05280067
052600        PERFORM 2210-FETCH-OTBND-UPC-2                            05290067
052700     END-IF.                                                      05300067
052800                                                                  05310067
052900 2200-FETCH-OTBND-UPC.                                            05320062
053000                                                                  05330003
053100     EXEC SQL                                                     05340003
053200         FETCH  OTBND-UPC-CURSOR                                  05350015
053300         INTO   :SUT00028-TRN-NBR                                 05360022
053400              , :SUT00028-RCVR-SEQ-NBR                            05370022
053500              , :SUT00028-TRN-LNE-NBR                             05380022
053600              , :SUT00028-UPC-NBR                                 05390015
053700              , :SUT00028-SHPD-UNT-QTY                            05400015
053800              , :SUT00024-DEST-LOC-NBR                            05410023
053900              , :RECITM-STATUS-CDE                                05420033
054000              , :RECITM-PREPK-ID                                  05430049
054100              , :RECITM-PREPK-RATO-QTY                            05440074
054200              , :RECITM-PREPK-DRV-LNE-CDE                         05450080
054300     END-EXEC.                                                    05460003
054400                                                                  05470003
054500     EVALUATE TRUE                                                05480003
054600       WHEN SQLCODE = ZERO                                        05490003
054700           IF RECEIV-PKGNG-CDE = 'M' OR RECEIV-PKGNG-CDE = 'I'    05500046
054800               SET PS-PREPACK-YES   TO TRUE                       05510046
054900           END-IF                                                 05520046
055000       WHEN SQLCODE = +100                                        05530003
055100           SET PS-MORE-OTBND-UPC-NO TO TRUE                       05540054
055200       WHEN SQLWARN0 NOT = SPACES                                 05550003
055300       WHEN SQLCODE  NOT = ZERO                                   05560003
055400           SET SU036-INVALID-SQL    TO TRUE                       05570048
055500           MOVE DK-OTBND-SHIPT-UNT-ID                             05580019
055600                               TO PV-DISP-SHIPT-UNT-ID            05590003
055700           MOVE SQLCODE        TO PV-DISPLAY-SQLCODE              05600003
055800           STRING   ' SUKUT706-2200-'                             05610003
055900                      ' CALLED BY-'                               05620003
056000                      SU036-PROGRAM-NAME                          05630021
056100                      '  SQLCODE='                                05640003
056200                      PV-DISPLAY-SQLCODE                          05650003
056300                      ' SHIPT UNT= '                              05660003
056400                      PV-DISP-SHIPT-UNT-ID                        05670003
056500                      DELIMITED BY SIZE                           05680003
056600                                      INTO PV-CICS-MSG-AREA       05690003
056700           PERFORM 9999-WRITE-TO-CSSL                             05700003
056800           MOVE '2200-'                TO SU036-CRA-REQ-ID        05710021
056900           MOVE PV-CICS-MSG-AREA      TO SU036-CRA-RET-MSG        05720021
057000           PERFORM 9998-RETURN                                    05730003
057100     END-EVALUATE.                                                05740003
057200                                                                  05750003
057300 2210-FETCH-OTBND-UPC-2.                                          05760054
057400                                                                  05770054
057500     EXEC SQL                                                     05780054
057600         FETCH  OTBND-UPC-CURSOR-2                                05790054
057700         INTO   :SUT00028-TRN-NBR                                 05800054
057800              , :SUT00028-TRN-LNE-NBR                             05810054
057900              , :SUT00028-UPC-NBR                                 05820054
058000              , :SUT00028-SHPD-UNT-QTY                            05830054
058100              , :SUT00024-DEST-LOC-NBR                            05840054
058200              , :RECITM-STATUS-CDE                                05850054
058300              , :RECITM-PREPK-ID                                  05860054
058400              , :PKSLIP-REC-SEQ-NBR                               05870060
058500              , :RECITM-PREPK-RATO-QTY                            05880080
058600              , :RECITM-PREPK-DRV-LNE-CDE                         05890080
058700     END-EXEC.                                                    05900054
058800                                                                  05910054
058900     EVALUATE TRUE                                                05920054
059000       WHEN SQLCODE = ZERO                                        05930054
059100           IF RECEIV-PKGNG-CDE = 'M' OR RECEIV-PKGNG-CDE = 'I'    05940054
059200               SET PS-PREPACK-YES   TO TRUE                       05950054
059300           END-IF                                                 05960054
059400       WHEN SQLCODE = +100                                        05970054
059500           SET PS-MORE-OTBND-UPC-NO-2 TO TRUE                     05980063
059600       WHEN SQLWARN0 NOT = SPACES                                 05990054
059700       WHEN SQLCODE  NOT = ZERO                                   06000054
059800           SET SU036-INVALID-SQL    TO TRUE                       06010054
059900           MOVE DK-OTBND-SHIPT-UNT-ID                             06020054
060000                               TO PV-DISP-SHIPT-UNT-ID            06030054
060100           MOVE SQLCODE        TO PV-DISPLAY-SQLCODE              06040054
060200           STRING   ' SUKUT706-2210-'                             06050054
060300                      ' CALLED BY-'                               06060054
060400                      SU036-PROGRAM-NAME                          06070054
060500                      '  SQLCODE='                                06080054
060600                      PV-DISPLAY-SQLCODE                          06090054
060700                      ' SHIPT UNT= '                              06100054
060800                      PV-DISP-SHIPT-UNT-ID                        06110054
060900                      DELIMITED BY SIZE                           06120054
061000                                      INTO PV-CICS-MSG-AREA       06130054
061100           PERFORM 9999-WRITE-TO-CSSL                             06140054
061200           MOVE '2210-'                TO SU036-CRA-REQ-ID        06150054
061300           MOVE PV-CICS-MSG-AREA      TO SU036-CRA-RET-MSG        06160054
061400           PERFORM 9998-RETURN                                    06170054
061500     END-EVALUATE.                                                06180054
061600                                                                  06190054
061700 2300-CLOSE-OTBND-UPC-CURSOR.                                     06200054
061800                                                                  06210003
061900     EXEC SQL                                                     06220003
062000         CLOSE OTBND-UPC-CURSOR                                   06230015
062100     END-EXEC.                                                    06240003
062200                                                                  06250003
062300     EVALUATE TRUE                                                06260003
062400       WHEN SQLCODE = ZERO                                        06270003
062500           CONTINUE                                               06280003
062600                                                                  06290003
062700       WHEN SQLWARN0 NOT = SPACES                                 06300003
062800       WHEN SQLCODE  NOT = ZERO                                   06310003
062900           SET SU036-INVALID-SQL      TO TRUE                     06320048
063000           MOVE DK-OTBND-SHIPT-UNT-ID TO PV-DISP-SHIPT-UNT-ID     06330048
063100           MOVE SQLCODE               TO PV-DISPLAY-SQLCODE       06340048
063200           STRING   ' SUKUT706-2300-'                             06350003
063300                      ' CALLED BY-'                               06360003
063400                      SU036-PROGRAM-NAME                          06370021
063500                      '  SQLCODE='                                06380003
063600                      PV-DISPLAY-SQLCODE                          06390003
063700                      ' SHIPT UNT= '                              06400003
063800                      PV-DISP-SHIPT-UNT-ID                        06410003
063900                      DELIMITED BY SIZE                           06420003
064000                                      INTO PV-CICS-MSG-AREA       06430003
064100           PERFORM 9999-WRITE-TO-CSSL                             06440003
064200           MOVE '2300-'                TO SU036-CRA-REQ-ID        06450021
064300           MOVE PV-CICS-MSG-AREA      TO SU036-CRA-RET-MSG        06460021
064400           PERFORM 9998-RETURN                                    06470003
064500     END-EVALUATE.                                                06480003
064600                                                                  06490003
064700 2310-CLOSE-OTBND-UPC-CURSOR-2.                                   06500054
064800                                                                  06510054
064900     EXEC SQL                                                     06520054
065000         CLOSE OTBND-UPC-CURSOR-2                                 06530054
065100     END-EXEC.                                                    06540054
065200                                                                  06550054
065300     EVALUATE TRUE                                                06560054
065400       WHEN SQLCODE = ZERO                                        06570054
065500           CONTINUE                                               06580054
065600       WHEN SQLWARN0 NOT = SPACES                                 06590054
065700       WHEN SQLCODE  NOT = ZERO                                   06600054
065800           SET SU036-INVALID-SQL      TO TRUE                     06610054
065900           MOVE DK-OTBND-SHIPT-UNT-ID TO PV-DISP-SHIPT-UNT-ID     06620054
066000           MOVE SQLCODE               TO PV-DISPLAY-SQLCODE       06630054
066100           STRING   ' SUKUT706-2310-'                             06640054
066200                      ' CALLED BY-'                               06650054
066300                      SU036-PROGRAM-NAME                          06660054
066400                      '  SQLCODE='                                06670054
066500                      PV-DISPLAY-SQLCODE                          06680054
066600                      ' SHIPT UNT= '                              06690054
066700                      PV-DISP-SHIPT-UNT-ID                        06700054
066800                      DELIMITED BY SIZE                           06710054
066900                                      INTO PV-CICS-MSG-AREA       06720054
067000           PERFORM 9999-WRITE-TO-CSSL                             06730054
067100           MOVE '2310-'                TO SU036-CRA-REQ-ID        06740054
067200           MOVE PV-CICS-MSG-AREA      TO SU036-CRA-RET-MSG        06750054
067300           PERFORM 9998-RETURN                                    06760054
067400     END-EVALUATE.                                                06770054
067500                                                                  06780054
067600 2400-INSERT-TSUQADJ.                                             06790054
067700                                                                  06800054
067800     SET PS-FINCL-ADJ-ID-EXISTS TO TRUE.                          06810054
067900                                                                  06820034
068000     PERFORM UNTIL PS-FINCL-ADJ-ID-NOT-EXISTS                     06830034
068100         PERFORM 2800-CREATE-RANDOM-NBR                           06840034
068200                                                                  06850034
068300         MOVE DP902-RANDOM-NUMBER TO PV-FINCL-ADJ-ID              06860034
068400         PERFORM 2900-SELECT-SUT-FINCL-ADJ                        06870034
068500     END-PERFORM.                                                 06880034
068600                                                                  06890034
068700     EXEC SQL                                                     06900034
068800         SET :SUQADJ-ADJ-TMST = CURRENT TIMESTAMP                 06910034
068900     END-EXEC.                                                    06920034
069000                                                                  06930034
069100     EXEC SQL                                                     06940034
069200         INSERT INTO TSUQADJ                                      06950034
069300         (                                                        06960034
069400          SHIPT_UNT_ID                                            06970034
069500         ,UPC_NBR                                                 06980034
069600         ,ADJ_TMST                                                06990034
069700         ,OPER_UNT_ID                                             07000034
069800         ,ADJ_FUNC_CDE                                            07010034
069900         ,ADJ_BEF_QTY                                             07020034
070000         ,ADJ_AFT_QTY                                             07030034
070100         ,PRC_RSN_CDE                                             07040034
070200         ,ADJ_USR_ID                                              07050034
070300         ,FINCL_ADJ_ID                                            07060034
070400         )                                                        07070034
070500         VALUES                                                   07080034
070600         (                                                        07090034
070700          :DK-OTBND-SHIPT-UNT-ID                                  07100034
070800         ,:SUT00028-UPC-NBR                                       07110034
070900         ,:SUQADJ-ADJ-TMST                                        07120034
071000         ,:SU036-ORIG-OPER-UNT-ID                                 07130037
071100         ,'U'                                                     07140034
071200         ,:SU035-BEFORE-QTY                                       07150034
071300         ,:SU035-AFTER-QTY                                        07160034
071400         ,:SU035-PRC-RSN-CDE                                      07170034
071500         ,:SU035-CREATE-USER-ID                                   07180034
071600         ,:PV-FINCL-ADJ-ID                                        07190034
071700         )                                                        07200034
071800     END-EXEC.                                                    07210034
071900     EVALUATE TRUE                                                07220034
072000         WHEN SQLCODE = +0                                        07230034
072100         WHEN SQLCODE = -904                                      07240034
072200         WHEN SQLCODE = -913                                      07250034
072300             CONTINUE                                             07260034
072400         WHEN SQLWARN0 NOT = SPACES                               07270034
072500         WHEN SQLCODE < +0                                        07280034
072600         WHEN SQLCODE > +0                                        07290034
072700             SET SU036-INVALID-SQL    TO TRUE                     07300035
072800             MOVE DK-OTBND-SHIPT-UNT-ID                           07310034
072900                               TO PV-DISP-SHIPT-UNT-ID            07320034
073000             MOVE SUT00028-UPC-NBR    TO PV-DISP-UPC-NBR          07330034
073100             MOVE SUT00024-DEST-LOC-NBR TO PV-DISP-OPER-UNT-ID    07340034
073200             MOVE  SQLCODE            TO PV-DISPLAY-SQLCODE       07350034
073300             STRING   ' SUKUT706-2400-'                           07360034
073400                      ' CALLED BY-'                               07370034
073500                      SU036-PROGRAM-NAME                          07380034
073600                      '  SQLCODE='                                07390034
073700                      PV-DISPLAY-SQLCODE                          07400034
073800                      ' '                                         07410034
073900                      PV-DISP-SHIPT-UNT-ID                        07420034
074000                      ' '                                         07430034
074100                      PV-DISP-UPC-NBR                             07440034
074200                      ' '                                         07450034
074300                      PV-DISP-OPER-UNT-ID                         07460034
074400                      DELIMITED BY SIZE                           07470034
074500                                        INTO PV-CICS-MSG-AREA     07480034
074600             PERFORM 9999-WRITE-TO-CSSL                           07490034
074700             MOVE '2400-'               TO SU036-CRA-REQ-ID       07500034
074800             MOVE PV-CICS-MSG-AREA      TO SU036-CRA-RET-MSG      07510034
074900             PERFORM 9998-RETURN                                  07520034
075000     END-EVALUATE.                                                07530034
075100                                                                  07540034
075200 2500-PROCESS-PREPACK-TABLE.                                      07550080
075300     IF (PS-OTBND-UPC-CSR AND                                     07560084
075400         PS-MORE-OTBND-UPC-YES)  OR                               07570084
075500        (PS-NOT-OTBND-UPC-CSR AND                                 07580084
075600         PS-MORE-OTBND-UPC-YES-2)                                 07590084
075700         MOVE SUT00028-TRN-LNE-NBR   TO PACK-LINE (LINE-IDX)      07600080
075800         MOVE RECITM-PREPK-RATO-QTY  TO PACK-RATO (LINE-IDX)      07610080
075900         MOVE 'Y'                    TO PACK-IND (LINE-IDX)       07620080
076000         MOVE SUT00028-UPC-NBR       TO PACK-UPC (LINE-IDX)       07630080
076100         MOVE RECITM-PREPK-ID    TO PACK-PRPPK-ID (LINE-IDX)      07640080
076200         MOVE RECITM-PREPK-DRV-LNE-CDE                            07650080
076300                      TO PACK-PREPK-DRV-LNE-CDE (LINE-IDX)        07660080
076400         MOVE SUT00028-SHPD-UNT-QTY  TO PACK-CRTN-QTY (LINE-IDX)  07670080
076500         MOVE 0                      TO PACK-AUDIT-QTY (LINE-IDX) 07680080
076600         SET PV-SAVE-LAST-IDX  TO LINE-IDX                        07690080
076700         MOVE SUT00024-DEST-LOC-NBR  TO PACK-DEST-LOC (LINE-IDX)  07700080
076800         IF PS-OTBND-UPC-CSR                                      07710080
076900             PERFORM 2200-FETCH-OTBND-UPC                         07720080
077000         ELSE                                                     07730080
077100             PERFORM 2210-FETCH-OTBND-UPC-2                       07740080
077200         END-IF                                                   07750080
077300         IF SQLCODE NOT = +100                                    07760081
077400             SET LINE-IDX    UP BY 1                              07770081
077500         END-IF                                                   07780081
077600     END-IF.                                                      07790080
077700                                                                  07800080
077800 2510-PERFORM-BEST-CASE.                                          07810080
077900                                                                  07820080
078000     MOVE PACK-PRPPK-ID (PV-SAVE-LINE-IDX)                        07830080
078100                                      TO PV-SAVE-PREPK-ID.        07840080
078200     INITIALIZE RC806-PRODUCT-PACK-VALIDATION.                    07850080
078300     SET RC806-VALIDATE-AND-CALC      TO TRUE.                    07860080
078400     MOVE 1                           TO RC806-INNER-PACK-QTY.    07870080
078500                                                                  07880080
078600     MOVE 0     TO PV-NUMBER-OF-LINES.                            07890080
078700     SET RC806-LINE-IDX TO 1.                                     07900080
078800     PERFORM VARYING LINE-IDX  FROM PV-SAVE-LINE-IDX BY 1         07910080
078900             UNTIL PACK-IND (LINE-IDX) NOT = 'Y'                  07920080
079000                OR PACK-PRPPK-ID (LINE-IDX) NOT = PV-SAVE-PREPK-ID07930080
079100                OR LINE-IDX > 500                                 07940080
079200         MOVE PACK-LINE (LINE-IDX) TO RC806-PKSL-LNE-NBR          07950080
079300                                       (RC806-LINE-IDX)           07960080
079400         MOVE PACK-RATO (LINE-IDX) TO RC806-PO-RATIO              07970080
079500                                       (RC806-LINE-IDX)           07980080
079600                                      RC806-RC-RATIO              07990080
079700                                       (RC806-LINE-IDX)           08000080
079800         MOVE PACK-CRTN-QTY (LINE-IDX)                            08010080
079900                                   TO RC806-UNIT-QTY              08020080
080000                                       (RC806-LINE-IDX)           08030080
080100                                      RC806-RCVG-QTY              08040080
080200                                       (RC806-LINE-IDX)           08050080
080300         SET RC806-LINE-IDX UP BY 1                               08060080
080400         ADD 1  TO PV-NUMBER-OF-LINES                             08070080
080500     END-PERFORM.                                                 08080080
080600     MOVE PV-NUMBER-OF-LINES  TO RC806-NBR-OF-LINES.              08090080
080700                                                                  08100080
080800     PERFORM 8300-VALIDATION-MODULE.                              08110080
080900                                                                  08120080
081000     SET LINE-IDX TO PV-SAVE-LINE-IDX.                            08130080
081100**   SET PS-NO-ODD-UNITS-IN-CARTON TO TRUE.                       08140081
081200     PERFORM 2520-PROCESS-LINES                                   08150080
081300         VARYING RC806-LINE-IDX                                   08160080
081400         FROM 1 BY 1                                              08170080
081500         UNTIL RC806-PKSL-LNE-NBR(RC806-LINE-IDX) = ZERO.         08180082
081600     COMPUTE PV-SAVE-LINE-IDX = PV-SAVE-LINE-IDX +                08190080
081700                                  PV-NUMBER-OF-LINES.             08200080
081800                                                                  08210080
081900                                                                  08220080
082000 2520-PROCESS-LINES.                                              08230080
082100     INITIALIZE SU035-COMM-AREA.                                  08240081
082200     MOVE 0                    TO PV-BEFORE-QTY                   08250080
082300                                  PV-AFTER-QTY                    08260080
082400                                  PV-PACK-DIFF                    08270080
082500                                  PV-ODD-DIFF                     08280080
082600                                  PV-ADJ-MINUS-ODD.               08290080
082700                                                                  08300080
082800                                                                  08310080
082900     MOVE DK-OTBND-SHIPT-UNT-ID    TO SU035-SHIPT-UNT-ID          08320080
083000     MOVE SU036-PO                 TO SU035-PO                    08330080
083100     MOVE SU036-REC-SEQ-NBR        TO SU035-REC-SEQ-NBR           08340080
083200     MOVE PACK-LINE (LINE-IDX)     TO SU035-PO-LNE-NBR            08350080
083300                                      SU036-PO-LNE-NBR            08360080
083400     MOVE PACK-UPC (LINE-IDX)      TO SU035-UPC-NBR               08370080
083400                                      SUT00028-UPC-NBR            08380096
083500     MOVE SU036-PRC-RSN-CDE        TO SU035-PRC-RSN-CDE           08390080
083600     MOVE PACK-CRTN-QTY (LINE-IDX) TO SU035-BEFORE-QTY            08400080
083700**   COMPUTE SU035-ADJUST-QTY =                                   08410080
083800**                   SU035-BEFORE-QTY * -1                        08420080
083900     MOVE 0                      TO SU035-AFTER-QTY               08430080
084000     MOVE SU036-ORIG-OPER-UNT-ID TO SU035-ORIG-OPER-UNT-ID        08440080
084100     MOVE SU036-CREATE-USER-ID   TO SU035-CREATE-USER-ID          08450080
084200     MOVE SU036-PROGRAM-NAME     TO SU035-PROGRAM-NAME            08460080
084300     MOVE PACK-DEST-LOC (LINE-IDX)                                08470080
084400                                 TO SU035-DEST-LOC-NBR            08480080
084500                                    SU036-DEST-LOC-NBR            08490080
084600     SET SU035-PACK-BY-STORE-YES TO TRUE                          08500080
084600     SET SU035-PACK-YES          TO TRUE                          08510091
084700     MOVE SU036-LOG-ONLY-IND     TO SU035-LOG-ONLY-IND            08520080
084800     PERFORM 2400-INSERT-TSUQADJ                                  08530080
084900     MOVE PV-FINCL-ADJ-ID    TO SU035-FINCL-ADJ-ID                08540080
085000     SET SU035-UPDATE-DISTDT TO TRUE                              08550080
085100     IF RC806-BEST-CASE-PACKS NOT = 0                             08560080
085200         COMPUTE PV-PACK-DIFF = -1 * RC806-BEST-CASE-PACKS        08570080
085100         MOVE PV-PACK-DIFF      TO SU035-PACK-ADJUST-QTY          08580092
085300         COMPUTE SU035-ADJUST-QTY =                               08590080
085400             (PV-PACK-DIFF * PACK-RATO (LINE-IDX))                08600080
085500         MOVE PACK-PRPPK-ID (LINE-IDX)                            08610080
085600                                     TO SU035-PACK-ID             08620080
085700         IF PACK-PREPK-DRV-LNE-CDE (LINE-IDX) = 'A'               08630080
085800             MOVE 'A'      TO SU035-VRFY-ADJ-DRIVE-LNE            08640080
085900         END-IF                                                   08650080
086000     END-IF                                                       08660080
086100     IF RC806-ODD-UNITS (RC806-LINE-IDX) NOT = 0                  08670080
086200         COMPUTE PV-ODD-DIFF =                                    08680080
086300              RC806-ODD-UNITS (RC806-LINE-IDX) * -1               08690080
086400         SET SU035-ODD-UNIT-YES TO TRUE                           08700080
086500         MOVE PACK-PRPPK-ID (LINE-IDX)                            08710080
086600                                     TO SU035-PACK-ID             08720080
086610         MOVE RC806-ODD-UNITS (RC806-LINE-IDX) TO                 08730086
086800                             SU035-BEFORE-ODD-UNT-QTY             08740080
086900         MOVE 0           TO SU035-AFTER-ODD-UNT-QTY              08750080
087000         COMPUTE SU035-ADJUST-QTY = SU035-ADJUST-QTY +            08760080
087100                                PV-ODD-DIFF                       08770080
087200         SET SU035-ODD-UNIT-YES  TO TRUE                          08780080
087300     ELSE                                                         08790080
087400         SET SU035-ODD-UNIT-NO   TO TRUE                          08800080
087500     END-IF.                                                      08810095
048400     MOVE 'Y'      TO SU035-UPDATE-UNTS-WORKED-IND                08820095
087600     PERFORM 7000-LINK-SUKUT702.                                  08830080
087700     SET LINE-IDX    UP BY 1.                                     08840083
087800                                                                  08850080
087900***                                                               08860080
088000***      IF PS-BACK-OUT-UPDATES                                   08870080
088100***          MOVE PACK-CRTN-QTY (LINE-IDX) TO                     08880080
088200***               PACK-AUDIT-QTY (LINE-IDX)                       08890080
088300***          MOVE PACK-PRPPK-ID (LINE-IDX) TO                     08900080
088400***               PV-SAVE-PRPPK-ID                                08910080
088500***          PERFORM 5980-UPDATE-PACK                             08920080
088600***               VARYING PV-UPDATE-LINE-IDX FROM 1 BY 1          08930080
088700***              UNTIL PACK-LINE (PV-UPDATE-LINE-IDX) = 0         08940080
088800***              OR PV-UPDATE-LINE-IDX > 500                      08950080
088900***      END-IF                                                   08960080
089000***      IF (PACK-ODD-UNITS (LINE-IDX) NOT =                      08970080
089100***               RC806-ODD-UNITS (RC806-LINE-IDX)) AND           08980080
089200***         PS-DONT-BACK-OUT-UPDATES                              08990080
089300***          IF PACK-ODD-UNITS (LINE-IDX) = 0                     09000080
089400***              SET PS-ODD-UNITS-IN-CARTON TO TRUE               09010080
089500***          END-IF                                               09020080
089600***      END-IF                                                   09030080
089700***      IF PV-SAVE-NBR-OF-PACKS NOT = RC806-BEST-CASE-PACKS      09040080
089800***         AND                                                   09050080
089900***         PACK-PREPK-DRV-LNE-CDE (LINE-IDX) = 'A' AND           09060080
090000***         PS-DONT-BACK-OUT-UPDATES                              09070080
090100***          MOVE PV-PACK-DIFF  TO PV-SAVE-PACK-DIFF              09080080
090200***          SET PS-UPDATE-NBR-PACKS   TO TRUE                    09090080
090300***          MOVE PV-PACK-ID    TO PV-SAVE-PACK-ID                09100080
090400***      END-IF                                                   09110080
090500                                                                  09120080
090600 2800-CREATE-RANDOM-NBR.                                          09130079
090700                                                                  09140079
090800     INITIALIZE DP902-RANDNBR-ROUTINE-FIELDS.                     09150079
090900     CALL PC-RANDOM-NBR-GENERATOR USING                           09160079
091000                            DFHEIBLK                              09170079
091100                            DFHCOMMAREA                           09180079
091200                            DP902-RANDNBR-ROUTINE-FIELDS.         09190079
091300                                                                  09200079
091400     IF DP902-SUCCESSFUL                                          09210079
091500         CONTINUE                                                 09220079
091600     ELSE                                                         09230079
091700         SET SU036-INVALID-SQL TO TRUE                            09240079
091800     END-IF.                                                      09250079
091900                                                                  09260079
092000                                                                  09270079
092100 2900-SELECT-SUT-FINCL-ADJ.                                       09280079
092200                                                                  09290079
092300     EXEC SQL                                                     09300079
092400         SELECT   FINCL_ADJ_ID                                    09310079
092500         INTO     :SUT00030-FINCL-ADJ-ID                          09320079
092600         FROM     SUT_FINCL_ADJ                                   09330079
092700         WHERE    FINCL_ADJ_ID = :PV-FINCL-ADJ-ID                 09340079
092800     END-EXEC.                                                    09350079
092900                                                                  09360079
093000     EVALUATE TRUE                                                09370079
093100         WHEN SQLCODE = +0                                        09380079
093200             SET PS-FINCL-ADJ-ID-EXISTS TO TRUE                   09390079
093300         WHEN SQLCODE = +100                                      09400079
093400             SET PS-FINCL-ADJ-ID-NOT-EXISTS TO TRUE               09410079
093500         WHEN SQLWARN0 NOT = SPACES                               09420079
093600         WHEN SQLCODE < +0                                        09430079
093700         WHEN SQLCODE > +0                                        09440079
093800             SET SU036-INVALID-SQL    TO TRUE                     09450079
093900             MOVE PV-FINCL-ADJ-ID     TO PV-DISP-FINCL-ADJ-ID     09460079
094000             MOVE  SQLCODE            TO PV-DISPLAY-SQLCODE       09470079
094100             STRING   ' SUKUT706-2900-'                           09480079
094200                      ' CALLED BY-'                               09490079
094300                      SU036-PROGRAM-NAME                          09500079
094400                      '  SQLCODE='                                09510079
094500                      PV-DISPLAY-SQLCODE                          09520079
094600                      ' '                                         09530079
094700                      PV-DISP-FINCL-ADJ-ID                        09540079
094800                      DELIMITED BY SIZE                           09550079
094900                                        INTO PV-CICS-MSG-AREA     09560079
095000             PERFORM 9999-WRITE-TO-CSSL                           09570079
095100             MOVE '2900-'               TO SU036-CRA-REQ-ID       09580079
095200             MOVE PV-CICS-MSG-AREA      TO SU036-CRA-RET-MSG      09590079
095300             PERFORM 9998-RETURN                                  09600079
095400     END-EVALUATE.                                                09610079
095500                                                                  09620079
095600*----------------------------------------------------------------*09630079
095700 3000-PROCESS-PREPK-FAILURES.                                     09640079
095800*----------------------------------------------------------------*09650079
095900     IF DK-LINE-SUCCESS > 0 AND DK-LINE-FAILED > 0                09660079
096000         MOVE 'Y' TO DK-ODD-UNT-IND                               09670079
096100         PERFORM 3100-GET-TPOPRPK                                 09680079
096200         PERFORM 3300-UPDATE-OTBND-CART                           09690079
096300     ELSE                                                         09700079
096400         IF DK-LINE-SUCCESS > 0 AND DK-LINE-FAILED = 0            09710079
096500             MOVE 'N' TO DK-ODD-UNT-IND                           09720079
096600             PERFORM 3100-GET-TPOPRPK                             09730079
096700             PERFORM 3300-UPDATE-OTBND-CART                       09740079
096800         END-IF                                                   09750079
096900     END-IF.                                                      09760079
097000                                                                  09770079
097100*-----------------------------------------------------------------09780079
097200 3100-GET-TPOPRPK.                                                09790079
097300*-----------------------------------------------------------------09800079
097400     EXEC SQL                                                     09810079
097500         SELECT PK_SKU_NBR                                        09820079
097600         INTO   :POPRPK-PK-SKU-NBR                                09830079
097700         FROM   TPOPRPK                                           09840079
097800         WHERE  PO_NBR         = :SUT00028-TRN-NBR                09850079
097900           AND  PO_PREPK_ID    = :RECITM-PREPK-ID                 09860079
098000           AND  PREPK_STAT_CDE = 'A'                              09870079
098100     END-EXEC.                                                    09880079
098200                                                                  09890079
098300     EVALUATE TRUE                                                09900079
098400         WHEN SQLCODE = +0                                        09910079
098500             PERFORM 3200-UPDATE-OTBND-PK                         09920079
098600         WHEN SQLCODE = +100                                      09930079
098700             CONTINUE                                             09940079
098800         WHEN SQLWARN0 NOT = SPACES                               09950079
098900         WHEN SQLCODE < +0                                        09960079
099000         WHEN SQLCODE > +0                                        09970079
099100             SET SU036-INVALID-SQL    TO TRUE                     09980079
099200             MOVE SUT00024-SHIPT-UNT-ID TO PV-DISP-SHIPT-UNT-ID   09990079
099300             MOVE  SQLCODE            TO PV-DISPLAY-SQLCODE       10000079
099400             STRING   ' SUKUT706-3100-'                           10010079
099500                      ' CALLED BY-'                               10020079
099600                      SU036-PROGRAM-NAME                          10030079
099700                      '  SQLCODE='                                10040079
099800                      PV-DISPLAY-SQLCODE                          10050079
099900                      ' '                                         10060079
100000                      PV-DISP-SHIPT-UNT-ID                        10070079
100100                      DELIMITED BY SIZE                           10080079
100200                                        INTO PV-CICS-MSG-AREA     10090079
100300             PERFORM 9999-WRITE-TO-CSSL                           10100079
100400             MOVE '3100-'               TO SU036-CRA-REQ-ID       10110079
100500             MOVE PV-CICS-MSG-AREA      TO SU036-CRA-RET-MSG      10120079
100600             PERFORM 9998-RETURN                                  10130046
100700     END-EVALUATE.                                                10140046
100800                                                                  10150046
100900*-----------------------------------------------------------------10160046
101000 3200-UPDATE-OTBND-PK.                                            10170046
101100*-----------------------------------------------------------------10180046
101200     EXEC SQL                                                     10190046
101300         UPDATE SUT_OTBND_PK                                      10200046
101400         SET                                                      10210046
101500            SHPD_PK_QTY  =  +0                                    10220046
101600         WHERE SHIPT_UNT_ID  = :DK-OTBND-SHIPT-UNT-ID             10230046
101700           AND TRN_NBR       = :SUT00028-TRN-NBR                  10240046
101800           AND RCVR_SEQ_NBR  = :DK-REC-SEQ-NBR                    10250060
101900           AND PK_SKU_NBR    = :POPRPK-PK-SKU-NBR                 10260046
102000     END-EXEC.                                                    10270046
102100                                                                  10280046
102200     EVALUATE TRUE                                                10290046
102300         WHEN SQLCODE = +0                                        10300046
102400             CONTINUE                                             10310046
102500         WHEN SQLCODE = +100                                      10320046
102600             PERFORM 3220-INSERT-OTBND-PACK                       10330046
102700         WHEN SQLWARN0 NOT = SPACES                               10340046
102800         WHEN SQLCODE < +0                                        10350046
102900         WHEN SQLCODE > +0                                        10360046
103000             SET SU036-INVALID-SQL    TO TRUE                     10370046
103100             MOVE SUT00024-SHIPT-UNT-ID TO PV-DISP-SHIPT-UNT-ID   10380046
103200             MOVE  SQLCODE            TO PV-DISPLAY-SQLCODE       10390046
103300             STRING   ' SUKUT706-3200-'                           10400046
103400                      ' CALLED BY-'                               10410046
103500                      SU036-PROGRAM-NAME                          10420046
103600                      '  SQLCODE='                                10430046
103700                      PV-DISPLAY-SQLCODE                          10440046
103800                      ' '                                         10450046
103900                      PV-DISP-SHIPT-UNT-ID                        10460046
104000                      DELIMITED BY SIZE                           10470046
104100                                        INTO PV-CICS-MSG-AREA     10480046
104200             PERFORM 9999-WRITE-TO-CSSL                           10490046
104300             MOVE '3200-'               TO SU036-CRA-REQ-ID       10500046
104400             MOVE PV-CICS-MSG-AREA      TO SU036-CRA-RET-MSG      10510046
104500             PERFORM 9998-RETURN                                  10520046
104600     END-EVALUATE.                                                10530046
104700                                                                  10540046
104800*-----------------------------------------------------------------10550046
104900 3220-INSERT-OTBND-PACK.                                          10560046
105000     EXEC SQL                                                     10570046
105100         INSERT INTO SUT_OTBND_PK                                 10580046
105200               ( SHIPT_UNT_ID                                     10590046
105300                ,TRN_NBR                                          10600046
105400                ,RCVR_SEQ_NBR                                     10610046
105500                ,TRN_TYP_CDE                                      10620046
105600                ,PK_SKU_NBR                                       10630046
105700                ,SHPD_PK_QTY )                                    10640046
105800         VALUES                                                   10650046
105900              (:DK-OTBND-SHIPT-UNT-ID                             10660047
106000             , :SUT00028-TRN-NBR                                  10670047
106100             , :DK-REC-SEQ-NBR                                    10680060
106200             , 'PO'                                               10690046
106300             , :POPRPK-PK-SKU-NBR                                 10700046
106400             , +0   )                                             10710046
106500     END-EXEC.                                                    10720046
106600                                                                  10730046
106700     EVALUATE TRUE                                                10740046
106800         WHEN SQLCODE = +0                                        10750046
106900             CONTINUE                                             10760046
107000         WHEN SQLWARN0 NOT = SPACES                               10770046
107100         WHEN SQLCODE < +0                                        10780046
107200         WHEN SQLCODE > +0                                        10790046
107300             SET SU036-INVALID-SQL    TO TRUE                     10800046
107400             MOVE SUT00024-SHIPT-UNT-ID TO PV-DISP-SHIPT-UNT-ID   10810046
107500             MOVE  SQLCODE            TO PV-DISPLAY-SQLCODE       10820046
107600             STRING   ' SUKUT706-3220-'                           10830046
107700                      ' CALLED BY-'                               10840046
107800                      SU036-PROGRAM-NAME                          10850046
107900                      '  SQLCODE='                                10860046
108000                      PV-DISPLAY-SQLCODE                          10870046
108100                      ' '                                         10880046
108200                      PV-DISP-SHIPT-UNT-ID                        10890046
108300                      DELIMITED BY SIZE                           10900046
108400                                        INTO PV-CICS-MSG-AREA     10910046
108500             PERFORM 9999-WRITE-TO-CSSL                           10920046
108600             MOVE '3220-'               TO SU036-CRA-REQ-ID       10930046
108700             MOVE PV-CICS-MSG-AREA      TO SU036-CRA-RET-MSG      10940046
108800             PERFORM 9998-RETURN                                  10950046
108900     END-EVALUATE.                                                10960046
109000                                                                  10970046
109100*-----------------------------------------------------------------10980046
109200 3300-UPDATE-OTBND-CART.                                          10990046
109300*-----------------------------------------------------------------11000046
109400     EXEC SQL                                                     11010046
109500         UPDATE SUT_OTBND_CART                                    11020046
109600         SET                                                      11030046
109700             ODD_UNT_IND     = :DK-ODD-UNT-IND                    11040046
109800         WHERE SHIPT_UNT_ID  = :DK-OTBND-SHIPT-UNT-ID             11050046
109900     END-EXEC.                                                    11060046
110000                                                                  11070046
110100     EVALUATE TRUE                                                11080046
110200         WHEN SQLCODE = +0                                        11090046
110300         WHEN SQLCODE = +100                                      11100046
110400             CONTINUE                                             11110046
110500         WHEN SQLWARN0 NOT = SPACES                               11120046
110600         WHEN SQLCODE < +0                                        11130046
110700         WHEN SQLCODE > +0                                        11140046
110800             SET SU036-INVALID-SQL    TO TRUE                     11150046
110900             MOVE SUT00024-SHIPT-UNT-ID TO PV-DISP-SHIPT-UNT-ID   11160046
111000             MOVE  SQLCODE            TO PV-DISPLAY-SQLCODE       11170046
111100             STRING   ' SUKUT706-3300-'                           11180046
111200                      ' CALLED BY-'                               11190046
111300                      SU036-PROGRAM-NAME                          11200046
111400                      '  SQLCODE='                                11210046
111500                      PV-DISPLAY-SQLCODE                          11220046
111600                      ' '                                         11230046
111700                      PV-DISP-SHIPT-UNT-ID                        11240046
111800                      DELIMITED BY SIZE                           11250046
111900                                        INTO PV-CICS-MSG-AREA     11260046
112000             PERFORM 9999-WRITE-TO-CSSL                           11270046
112100             MOVE '3300-'               TO SU036-CRA-REQ-ID       11280046
112200             MOVE PV-CICS-MSG-AREA      TO SU036-CRA-RET-MSG      11290046
112300             PERFORM 9998-RETURN                                  11300046
112400     END-EVALUATE.                                                11310046
112500                                                                  11320046
112600*----------------------------------------------------------------*11330046
112700*  LINK TO SUKUT702                                               11340046
112800*----------------------------------------------------------------*11350046
112900 7000-LINK-SUKUT702.                                              11360010
113000                                                                  11370010
113100     MOVE LENGTH OF SU035-COMM-AREA      TO PV-COMMAREA-LENGTH.   11380021
113200                                                                  11390010
113300     EXEC CICS                                                    11400010
113400         LINK PROGRAM  (PC-SUKUT702)                              11410010
113500              COMMAREA (SU035-COMM-AREA)                          11420021
113600              LENGTH   (PV-COMMAREA-LENGTH)                       11430010
113700              RESP     (PV-CICS-RESPONSE)                         11440010
113800     END-EXEC.                                                    11450010
113900                                                                  11460010
114000     EVALUATE TRUE                                                11470010
114100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 11480010
114200             IF  SU035-UPDATE-ERROR OR SU035-NO-CHANGE            11490041
114300                 MOVE SU035-UPDATE-TYPE-IND TO DK-UPDATE-TYPE-IND 11500078
114400                 ADD +1                 TO  DK-LINE-FAILED        11510077
114500                 MOVE SU035-BEFORE-QTY  TO  DK-ADJ-AFT-QTY        11520078
114600                 MOVE SU035-AFTER-QTY   TO  DK-ADJ-BEF-QTY        11530076
114700                 MOVE DK-ADJ-BEF-QTY    TO  SU035-BEFORE-QTY      11540076
114800                 MOVE DK-ADJ-AFT-QTY    TO  SU035-AFTER-QTY       11550076
114900                 MOVE 'SYS REVS'        TO  SU035-CREATE-USER-ID  11560076
115000                 PERFORM 2400-INSERT-TSUQADJ                      11570076
115100                 IF SU036-CREATE-USER-ID =   'UNUSED '            11580077
115200                     PERFORM 8000-UPDATE-OTBND-UPC                11590077
115300                 END-IF                                           11600077
115400             ELSE                                                 11610077
115500                 IF  SU035-INVALID-SQL     OR                     11620050
115600                     SU035-DATABASE-BUSY                          11630050
115700                       STRING ' SUKUT706 - '    DELIMITED BY SIZE 11640050
115800                          '7000-LINK-SUKUT702 ' DELIMITED BY SIZE 11650050
115900                          ' RETURN MESSAGE - '  DELIMITED BY SIZE 11660050
116000                          SU035-SUCCESS-IND     DELIMITED BY SIZE 11670050
116100                                         INTO SU036-CRA-RET-MSG   11680021
116200                     PERFORM 9999-WRITE-TO-CSSL                   11690050
116300                     MOVE '7000-'       TO SU036-CRA-REQ-ID       11700050
116400                     SET SU036-ERROR    TO TRUE                   11710050
116500                     PERFORM 9998-RETURN                          11720050
116600                 ELSE                                             11730050
116700                     MOVE  0   TO  SU035-AFTER-QTY                11740076
116800                     PERFORM 8000-UPDATE-OTBND-UPC                11750050
116900                     ADD +1  TO  DK-LINE-SUCCESS                  11760050
117000                 END-IF                                           11770050
117100             END-IF                                               11780050
117200         WHEN OTHER                                               11790010
117300             STRING ' SUKUT706 (OTHER) -' DELIMITED BY SIZE       11800010
117400                    '7000-LINK-SUKUT702 ' DELIMITED BY SIZE       11810010
117500                    ' RETURN MESSAGE - '  DELIMITED BY SIZE       11820010
117600                    SU035-SUCCESS-IND     DELIMITED BY SIZE       11830021
117700                                         INTO SU036-CRA-RET-MSG   11840021
117800             PERFORM 9999-WRITE-TO-CSSL                           11850010
117900             MOVE '7000-'                TO SU036-CRA-REQ-ID      11860021
118000             SET SU036-ERROR TO TRUE                              11870021
118100             PERFORM 9998-RETURN                                  11880010
118200                                                                  11890010
118300     END-EVALUATE.                                                11900010
118400                                                                  11910010
118500                                                                  11920011
118600 7100-CHECK-FOR-LOGGING.                                          11930011
118700                                                                  11940011
118800     EXEC SQL                                                     11950011
118900          SELECT FUNC_TXT                                         11960011
119000            INTO :KRPRPM-FUNC-TXT                                 11970011
119100            FROM TKRPRPM                                          11980011
119200           WHERE LOC_ID            = :DK-OPER-UNT-ID              11990052
119300             AND INTFC_SYS_CDE    = 'KHL'                         12000011
119400             AND SYS_PRC_FUNC_CDE = 'SU706D'                      12010052
119500             AND FUNC_PRC_STAT_CDE = 'AC'                         12020011
119600     END-EXEC.                                                    12030011
119700                                                                  12040011
119800     EVALUATE TRUE                                                12050011
119900         WHEN SQLCODE = ZERO                                      12060011
120000             IF KRPRPM-FUNC-TXT = 'Y'                             12070011
120100                 SET PS-LOG-MESSAGE  TO TRUE                      12080011
120200             ELSE                                                 12090011
120300                 SET PS-NO-LOG-MESSAGE  TO TRUE                   12100011
120400             END-IF                                               12110011
120500         WHEN SQLCODE = +100                                      12120011
120600             SET PS-NO-LOG-MESSAGE  TO TRUE                       12130011
120700         WHEN SQLWARN0 NOT = SPACES                               12140011
120800         WHEN SQLCODE NOT EQUAL ZERO                              12150011
120900             SET SU036-INVALID-SQL    TO TRUE                     12160021
121000             MOVE  SQLCODE            TO PV-DISPLAY-SQLCODE       12170011
121100             STRING   ' SUKUT706-7100-'                           12180034
121200                      ' CALLED BY-'                               12190011
121300                      SU036-PROGRAM-NAME                          12200021
121400                      '  SQLCODE='                                12210011
121500                      PV-DISPLAY-SQLCODE                          12220011
121600                      ' '                                         12230011
121700                      DELIMITED BY SIZE                           12240011
121800                                      INTO PV-CICS-MSG-AREA       12250011
121900             PERFORM 9999-WRITE-TO-CSSL                           12260011
122000             MOVE '7100-'               TO SU036-CRA-REQ-ID       12270044
122100             MOVE PV-CICS-MSG-AREA      TO SU036-CRA-RET-MSG      12280021
122200             PERFORM 9998-RETURN                                  12290011
122300     END-EVALUATE.                                                12300011
122400                                                                  12310011
122500 7200-SELECT-RECEIVER.                                            12320080
122600     MOVE SU036-PO            TO DK-PO-NBR.                       12330080
122700     MOVE SU036-REC-SEQ-NBR   TO DK-REC-SEQ-NBR.                  12340080
122800                                                                  12350080
122900     EXEC SQL                                                     12360080
123000        SELECT                                                    12370080
123100                PACK_BY_ST_IND                                    12380080
123200            ,   PKGNG_CDE                                         12390080
123300          INTO                                                    12400080
123400                :RECEIV-PACK-BY-ST-IND                            12410080
123500            ,   :RECEIV-PKGNG-CDE                                 12420080
123600          FROM  TRECEIV                                           12430080
123700          WHERE ORD_NBR           = :DK-PO-NBR                    12440080
123800            AND REC_SEQ_NBR       = :DK-REC-SEQ-NBR               12450080
123900     END-EXEC.                                                    12460080
124000                                                                  12470080
124100*-------------------------------------------------------------    12480041
124200 8000-UPDATE-OTBND-UPC.                                           12490041
124300*-------------------------------------------------------------    12500041
124400     EXEC SQL                                                     12510041
124500         UPDATE SUT_OTBND_UPC                                     12520041
124600         SET                                                      12530041
124700              SHPD_UNT_QTY    = :SU035-AFTER-QTY                  12540076
124800       WHERE SHIPT_UNT_ID     = :SU035-SHIPT-UNT-ID               12550041
124900         AND UPC_NBR          = :SU035-UPC-NBR                    12560041
125000         AND  TRN_NBR         = :SU035-PO                         12570041
125100         AND  RCVR_SEQ_NBR    = :SUT00028-RCVR-SEQ-NBR            12580061
125200         AND  TRN_LNE_NBR     = :SU035-PO-LNE-NBR                 12590041
125300     END-EXEC                                                     12600041
125400                                                                  12610041
125500     EVALUATE TRUE                                                12620041
125600         WHEN SQLCODE = +0                                        12630041
125700             CONTINUE                                             12640041
125800         WHEN SQLCODE = +100                                      12650070
125900         WHEN SQLWARN0 NOT = SPACES                               12660041
126000         WHEN SQLCODE NOT EQUAL ZERO                              12670041
126100             SET SU036-INVALID-SQL    TO TRUE                     12680041
126200             MOVE  SQLCODE            TO PV-DISPLAY-SQLCODE       12690041
126300             STRING   ' SUKUT706-8000-'                           12700041
126400                      ' CALLED BY-'                               12710041
126500                      SU036-PROGRAM-NAME                          12720041
126600                      '  SQLCODE='                                12730041
126700                      PV-DISPLAY-SQLCODE                          12740041
126800                      ' '                                         12750041
126900                      DELIMITED BY SIZE                           12760041
127000                                      INTO PV-CICS-MSG-AREA       12770041
127100             PERFORM 9999-WRITE-TO-CSSL                           12780041
127200             MOVE '8000-'                TO SU036-CRA-REQ-ID      12790041
127300             MOVE PV-CICS-MSG-AREA       TO SU036-CRA-RET-MSG     12800042
127400             PERFORM 9998-RETURN                                  12810041
127500     END-EVALUATE.                                                12820041
127600                                                                  12830041
127700                                                                  12840080
127800 8300-VALIDATION-MODULE.                                          12850080
127900                                                                  12860080
128000     EXEC CICS LINK                                               12870080
128100         PROGRAM  (PC-RCKCS806)                                   12880080
128200         COMMAREA (RC806-PRODUCT-PACK-VALIDATION)                 12890080
128300         RESP     (PV-CICS-RESPONSE)                              12900080
128400     END-EXEC.                                                    12910080
128500                                                                  12920080
128600     IF PV-CICS-RESPONSE = DFHRESP(NORMAL)                        12930080
128700         CONTINUE                                                 12940080
128800     ELSE                                                         12950080
128900         SET SU036-ERROR          TO TRUE                         12960080
129000         MOVE PV-CICS-RESPONSE TO PV-DISPLAY-CICS-RESP            12970081
129100         STRING ' SUKUT706 -' DELIMITED BY SIZE                   12980080
129200                '8300- ' DELIMITED BY SIZE                        12990080
129300                ' RESPONSE = '  DELIMITED BY SIZE                 13000080
129400                PV-DISPLAY-CICS-RESP  DELIMITED BY SIZE           13010081
129500                                     INTO PV-CICS-MSG-AREA        13020080
129600         PERFORM 9999-WRITE-TO-CSSL                               13030080
129700         MOVE '8300-'                TO SU036-CRA-REQ-ID          13040080
129800         MOVE PV-CICS-MSG-AREA       TO SU036-CRA-RET-MSG         13050080
129900         PERFORM 9998-RETURN                                      13060080
130000                                                                  13070080
130100     END-IF.                                                      13080080
130200                                                                  13090080
130300                                                                  13100001
130400*-----------------------------------------------------------------13110001
130500*  RETURN TO CALLING PROGRAM                                      13120001
130600*-----------------------------------------------------------------13130001
130700 9998-RETURN.                                                     13140001
130800                                                                  13150001
130900     MOVE SQLCA                         TO SU036-SQLCA            13160021
131000                                           PV-CICS-MSG-AREA.      13170001
131100     PERFORM 9999-WRITE-TO-CSSL.                                  13180001
131200     MOVE SU036-COMM-AREA               TO DFHCOMMAREA.           13190021
131300                                                                  13200001
131400     EXEC CICS                                                    13210001
131500          RETURN                                                  13220001
131600     END-EXEC.                                                    13230001
131700                                                                  13240001
131800*-----------------------------------------------------------------13250041
131900 9999-WRITE-TO-CSSL.                                              13260001
132000*-----------------------------------------------------------------13270041
132100     MOVE LENGTH OF PV-CICS-MSG-AREA  TO PV-COMMAREA-LENGTH.      13280001
132200                                                                  13290001
132300     EXEC CICS                                                    13300001
132400          WRITEQ TD                                               13310001
132500           QUEUE   ('CSSL')                                       13320001
132600            FROM   (PV-CICS-MSG-AREA)                             13330001
132700          LENGTH   (PV-COMMAREA-LENGTH)                           13340001
132800            RESP   (PV-CICS-RESPONSE)                             13350001
132900     END-EXEC.                                                    13360001
133000                                                                  13370001
