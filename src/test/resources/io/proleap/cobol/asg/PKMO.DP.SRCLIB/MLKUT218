       IDENTIFICATION DIVISION.                                         00010001
       PROGRAM-ID.    MLKUT218.                                         00020001
       AUTHOR.        B.GRAHAM - STRATAGEM.                             00030001
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040001
       DATE-WRITTEN.  06-12-08.                                         00050001
       DATE-COMPILED.                                                   00060001
      ******************************************************************00070001
      *                                                                 00080001
      * MLKUT218 - CREATE DEBIT CREDIT PURCHASE ADJUSTMENT              00090001
      *            TRANSACTIONS (MLRD015 LAYOUT)                        00100001
      *            FOR THE MONTHLY BRAND/VENDOR REALIGNMENT/            00110001
      *            INVENTORY MOVEMENT                                   00120001
      ******************** HISTORY OF CHANGES **************************00130001
      * CHG ID/                                                        *00140001
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES                    *00150001
      * -------  ----------  ----------------------------------------  *00160001
      * W34517   07-29-2008  B.GRAHAM - STRATAGEM                       00170007
      *                      INITIAL IMPLEMENTATION                     00180001
      * P34517   03-09-2009  SCOTT JACKSON                              00190009
      *                      FIX CODE TO NOT NEGATE '02' TRAN TYPES $$  00200009
      ******************************************************************00210001
      *                                                                 00220001
       ENVIRONMENT DIVISION.                                            00230001
      *                                                                 00240001
       CONFIGURATION SECTION.                                           00250001
      *                                                                 00260001
       SOURCE-COMPUTER.        IBM-3090.                                00270001
       OBJECT-COMPUTER.        IBM-3090.                                00280001
      *                                                                 00290001
       INPUT-OUTPUT SECTION.                                            00300001
       FILE-CONTROL.                                                    00310001
                                                                        00320001
           SELECT DATE-CONTROL-FILE                                     00330001
               ASSIGN TO INP01.                                         00340001
                                                                        00350001
           SELECT SKU-CURR-PREV-ATTR-FILE                               00360001
               ASSIGN TO INP02.                                         00370001
                                                                        00380001
           SELECT PADJ-TRANS-FILE                                       00390001
               ASSIGN TO OUT01.                                         00400001
                                                                        00410001
                                                                        00420001
      ******************************************************************00430001
       DATA DIVISION.                                                   00440001
      ******************************************************************00450001
                                                                        00460001
       FILE SECTION.                                                    00470001
                                                                        00480001
       FD  DATE-CONTROL-FILE                                            00490001
           LABEL RECORDS ARE STANDARD                                   00500001
           RECORDING MODE IS F                                          00510001
           BLOCK CONTAINS 0 RECORDS.                                    00520001
       01  DATE-CONTROL-REC            PIC X(80).                       00530001
                                                                        00540001
       FD  SKU-CURR-PREV-ATTR-FILE                                      00550001
           RECORDING MODE F                                             00560001
           LABEL RECORDS OMITTED                                        00570001
           BLOCK CONTAINS  0 RECORDS.                                   00580001
       01  SKU-CURR-PREV-ATTR-REC      PIC X(175).                      00590001
                                                                        00600001
       FD  PADJ-TRANS-FILE                                              00610001
           LABEL RECORDS ARE STANDARD                                   00620001
           RECORDING MODE IS F                                          00630001
           BLOCK CONTAINS 0 RECORDS.                                    00640001
       01  PADJ-TRANS-REC              PIC X(150).                      00650001
                                                                        00660001
                                                                        00670001
                                                                        00680001
                                                                        00690001
      ******************************************************************00700001
       WORKING-STORAGE SECTION.                                         00710001
      ******************************************************************00720001
                                                                        00730001
       EJECT                                                            00740001
       01  PA-PROGRAM-ACCUMULATORS.                                     00750001
           05  PA-SKU-RECS-IN-CNT      PIC 9(09)    VALUE ZERO.         00760001
           05  PA-PADJ-TRANS-OUT-CNT   PIC 9(09)    VALUE ZERO.         00770001
                                                                        00780001
       01  PC-PROGRAM-CONSTANTS.                                        00790001
                                                                        00800001
           05  PC-MLKUT218             PIC X(08)    VALUE 'MLKUT218'.   00810001
           05  PC-Z3                   PIC X(02)    VALUE 'Z3'.         00820003
           05  PC-Z4                   PIC X(02)    VALUE 'Z4'.         00830003
           05  PC-Z5                   PIC X(02)    VALUE 'Z5'.         00840003
           05  PC-Z6                   PIC X(02)    VALUE 'Z6'.         00850003
           05  PC-Z7                   PIC X(02)    VALUE 'Z7'.         00860003
           05  PC-Z8                   PIC X(02)    VALUE 'Z8'.         00870003
           05  PC-V                    PIC X(01)    VALUE 'V'.          00880003
           05  PC-Y                    PIC X(01)    VALUE 'Y'.          00890003
           05  PC-1                    PIC 9(01)    VALUE  1.           00900003
           05  PC-1-C                  PIC X(01)    VALUE '1'.          00910003
           05  PC-01-C                 PIC X(02)    VALUE '01'.         00920003
           05  PC-02-C                 PIC X(02)    VALUE '02'.         00930003
                                                                        00940001
                                                                        00950001
                                                                        00960001
       01  PV-PROGRAM-VARIABLES.                                        00970001
                                                                        00980001
           05  PV-DEPT-NBR-9           PIC 9(05)          VALUE ZERO.   00990005
           05  PV-SUB-CL-NBR-9         PIC 9(05)          VALUE ZERO.   01000005
           05  PV-INHOUSE-NBR-9        PIC 9(05)          VALUE ZERO.   01010002
                                                                        01020001
                                                                        01030001
                                                                        01040001
                                                                        01050001
       01  PS-PROGRAM-SWITCHES.                                         01060001
           05  PS-SKU-ATTR-FILE-AT-END-SW PIC X    VALUE 'N'.           01070001
               88  PS-SKU-ATTR-FILE-AT-END-YES     VALUE 'Y'.           01080001
               88  PS-SKU-ATTR-FILE-AT-END-NO      VALUE 'N'.           01090001
                                                                        01100005
      *** INPUT CONTROL RECORD                                          01110005
       01  PV-DATE-CONTROL-REC.                                         01120005
           05  PV-CURR-BOM-DATE        PIC X(10).                       01130005
           05  FILLER                  PIC X(01).                       01140005
           05  PV-PREV-BOM-DATE        PIC X(10).                       01150005
           05  FILLER                  PIC X(01).                       01160005
           05  PV-PREV-EOM-DATE        PIC X(10).                       01170005
           05  FILLER                  PIC X(01).                       01180005
           05  PV-CURR-FSCL-MN-NBR     PIC X(02).                       01190005
           05  FILLER                  PIC X(45).                       01200005
                                                                        01210005
      *** INPUT SKU-CURR-PREV-ATTR RECORD                               01220005
           COPY MLRD556.                                                01230005
                                                                        01240005
      *** OUTPUT PADJ TRANS RECORD                                      01250005
           COPY MLRD015.                                                01260005
                                                                        01270005
                                                                        01280005
                                                                        01290001
       EJECT                                                            01300001
                                                                        01310001
       01 ABEND-AREAS.                                                  01320001
           05 ABEND-CODE               PIC S9(04)  VALUE ZERO           01330001
                                                   COMP SYNC.           01340001
               88  AC-CONTROL-CARD                 VALUE +4001.         01350001
               88  AC-CONTROL-CARD                 VALUE +4002.         01360001
               88  AC-DB2-ERROR                    VALUE +4013.         01370001
           05  AA-ABEND-LIT            PIC X(40)   VALUE                01380001
                 '*****       ABEND'.                                   01390001
           05  AA-PROGRAM-LIT          PIC X(40)   VALUE                01400001
                   '*****   PROGRAM: MLKUT218'.                         01410001
           05  AA-PARAGRAPH-LIT.                                        01420001
               10  FILLER              PIC X(17)   VALUE                01430001
                   '***** PARAGRAPH: '.                                 01440001
               10  AA-PARAGRAPH-NAME   PIC X(35)   VALUE SPACES.        01450001
           05  AA-MESSAGE-LINE.                                         01460001
               10  FILLER              PIC X(06)   VALUE '*****'.       01470001
               10  AA-MESSAGE          PIC X(127)  VALUE SPACES.        01480001
           05  AA-DB2-ERROR-LIT        PIC X(40)   VALUE                01490001
                   '*****    DB2 ERROR'.                                01500001
           05  AA-DB2-OPERATION-LIT.                                    01510001
               10  FILLER              PIC X(17)   VALUE                01520001
                   '***** OPERATION: '.                                 01530001
               10  AA-DB2-OPERATION.                                    01540001
                   15  AA-DB2-OP-1     PIC X(25)   VALUE SPACES.        01550001
                   15  AA-DB2-OP-2     PIC X(25)   VALUE SPACES.        01560001
           05  AA-DB2-TABLE-1          PIC X(08)   VALUE SPACES.        01570001
           05  AA-DB2-TABLE-2          PIC X(08)   VALUE SPACES.        01580001
           05  AA-DB2-TABLE-3          PIC X(08)   VALUE SPACES.        01590001
           05  AA-DB2-TABLE-4          PIC X(08)   VALUE SPACES.        01600001
                                                                        01610001
                                                                        01620001
                                                                        01630001
       EJECT                                                            01640001
                                                                        01650001
                                                                        01660001
      ******************************************************************01670001
       PROCEDURE DIVISION.                                              01680001
      ******************************************************************01690001
                                                                        01700001
                                                                        01710001
      *************************PROGRAM PROCESS**************************01720001
      *  1. INITIALIZATION                                              01730001
      *     A. OPEN FILES                                               01740001
      *     B. GET CONTROL DATE CARD.                                   01750001
      *                                                                 01760001
      *                                                                 01770001
      *  2. READ SKU-CURR-PREV-ATTR FILE                                01780001
      *     A. CREATE CREDIT TRANS AND WRITE                            01790002
      *     B. CREATE DEBIT TRANS AND WRITE                             01800002
      *     C. REPEATE READ UNTIL END OF FILE                           01810002
      *                                                                 01820001
      *  3. CLOSE FILES AND DISPLAY COUNTS.                             01830002
      *                                                                 01840001
      *                                                                 01850001
      ******************************************************************01860001
       0000-MAINLINE-MLKUT218.                                          01870001
      ******************************************************************01880001
      *                                                                 01890001
           PERFORM 1000-INITIALIZATION.                                 01900001
                                                                        01910001
           PERFORM 2000-PROCESS-SKU-ATTR-FILE                           01920001
               UNTIL PS-SKU-ATTR-FILE-AT-END-YES.                       01930001
                                                                        01940001
           PERFORM 9000-EOJ.                                            01950001
                                                                        01960001
           STOP RUN.                                                    01970001
                                                                        01980001
       EJECT                                                            01990001
                                                                        02000001
      ******************************************************************02010001
       1000-INITIALIZATION.                                             02020001
      ******************************************************************02030001
      *                                                                 02040001
           OPEN INPUT  DATE-CONTROL-FILE                                02050001
                       SKU-CURR-PREV-ATTR-FILE                          02060001
                OUTPUT PADJ-TRANS-FILE.                                 02070002
                                                                        02080001
           PERFORM 1100-READ-CONTROL-FILE.                              02090001
                                                                        02100001
           DISPLAY ' '.                                                 02110001
           DISPLAY '*** CONTROL CARD VALUES FOR MLKUT218 FOLLOW ***'    02120001
           DISPLAY PV-DATE-CONTROL-REC.                                 02130001
                                                                        02140001
                                                                        02150001
       EJECT                                                            02160001
      ******************************************************************02170001
       1100-READ-CONTROL-FILE.                                          02180001
      ******************************************************************02190001
                                                                        02200001
           READ DATE-CONTROL-FILE                                       02210001
             INTO PV-DATE-CONTROL-REC                                   02220001
               AT END                                                   02230001
                   MOVE '1100-READ-CONTROL-FILE'                        02240001
                                       TO AA-PARAGRAPH-NAME             02250001
                   MOVE 'DATE CONTROL CARD IS MISSING'                  02260001
                                       TO AA-MESSAGE                    02270001
                   MOVE +4001          TO ABEND-CODE                    02280001
                   PERFORM 9900-COMMON-ABEND-ROUTINE                    02290001
           END-READ.                                                    02300001
                                                                        02310001
                                                                        02320001
       EJECT                                                            02330001
                                                                        02340001
      ******************************************************************02350001
       2000-PROCESS-SKU-ATTR-FILE.                                      02360001
      ******************************************************************02370001
      *     A. READ SKU-CURR-PREV-ATTR FILE                             02380002
      *     A. CREATE CREDIT TRANS AND WRITE                            02390002
      *     B. CREATE DEBIT TRANS AND WRITE    D_VND                    02400002
      *     C. REPEATE READ UNTIL END OF FILE                           02410002
      *                                                                 02420001
      ******************************************************************02430001
                                                                        02440001
           PERFORM 3000-READ-SKU-ATTR-FILE.                             02450001
                                                                        02460001
           IF PS-SKU-ATTR-FILE-AT-END-NO                                02470001
              PERFORM 4000-BUILD-PADJ-CREDIT                            02480002
              PERFORM 5000-BUILD-PADJ-DEBIT                             02490002
           END-IF.                                                      02500002
                                                                        02510001
      ******************************************************************02520001
       3000-READ-SKU-ATTR-FILE.                                         02530001
      ******************************************************************02540001
                                                                        02550001
           READ SKU-CURR-PREV-ATTR-FILE INTO                            02560001
                                    ML556-CURR-PREV-SKU-ATTR-REC        02570001
               AT END                                                   02580001
                  SET PS-SKU-ATTR-FILE-AT-END-YES TO TRUE.              02590001
                                                                        02600001
           IF PS-SKU-ATTR-FILE-AT-END-NO                                02610001
               ADD 1 TO PA-SKU-RECS-IN-CNT                              02620001
           END-IF.                                                      02630001
                                                                        02640001
      ******************************************************************02650001
       4000-BUILD-PADJ-CREDIT.                                          02660002
      ******************************************************************02670001
                                                                        02680001
           MOVE SPACES                   TO ML015-PURCHASE-RECORD.      02690002
                                                                        02700001
           MOVE PC-1-C                   TO ML015-PURCH-CDE.            02710002
           MOVE ML556-CURR-INHOUSE-NBR   TO PV-INHOUSE-NBR-9.           02720002
           MOVE PV-INHOUSE-NBR-9         TO                             02730002
                                         ML015-PURCH-VENDOR-INHSE-NMBR. 02740002
           MOVE ML556-CURR-DEPT-NBR      TO PV-DEPT-NBR-9.              02750002
           MOVE PV-DEPT-NBR-9 (3:3)      TO ML015-PURCH-DEPT-NBR.       02760002
           MOVE ML556-CURR-SUB-CL-NBR    TO PV-SUB-CL-NBR-9.            02770002
           MOVE PV-SUB-CL-NBR-9 (4:2)    TO ML015-PURCH-CLASS-NBR.      02780002
           MOVE PV-CURR-BOM-DATE (1:2)   TO ML015-PURCH-INV-DTE-CC.     02790002
           MOVE PV-CURR-BOM-DATE (3:2)   TO ML015-PURCH-INV-DTE-YY.     02800002
           MOVE PV-CURR-BOM-DATE (6:2)   TO ML015-PURCH-INV-DTE-MM.     02810002
           MOVE PV-CURR-BOM-DATE (9:2)   TO ML015-PURCH-INV-DTE-DD.     02820002
           MOVE ZEROS                    TO ML015-PURCH-PO-NBR-9.       02830002
                                                                        02840002
           MOVE PC-Y                     TO                             02850002
                                         ML015-PURCH-BATCH-NBR (1:1).   02860002
           MOVE PV-CURR-BOM-DATE (9:2)   TO                             02870002
                                         ML015-PURCH-BATCH-NBR (2:2).   02880002
                                                                        02890002
           MOVE PV-CURR-FSCL-MN-NBR      TO ML015-PURCH-KOHLS-MM.       02900002
                                                                        02910002
           IF ML556-LBL-SEQ-CHG-CDE = PC-1                              02920002
               IF ML556-ENT-ID-CHG-CDE = PC-1                           02930002
                   MOVE PC-Z8            TO ML015-PURCH-AP-TRANS-CDE    02940002
               ELSE                                                     02950002
                   MOVE PC-Z4            TO ML015-PURCH-AP-TRANS-CDE    02960002
               END-IF                                                   02970002
           ELSE                                                         02980002
               IF ML556-ENT-ID-CHG-CDE = PC-1                           02990002
                   MOVE PC-Z6            TO ML015-PURCH-AP-TRANS-CDE    03000002
               END-IF                                                   03010002
           END-IF.                                                      03020002
                                                                        03030002
           MOVE PV-CURR-BOM-DATE (1:2)   TO ML015-PURCH-DOC-DTE-CC.     03040002
           MOVE PV-CURR-BOM-DATE (3:2)   TO ML015-PURCH-DOC-DTE-YY.     03050002
           MOVE PV-CURR-BOM-DATE (6:2)   TO ML015-PURCH-DOC-DTE-MM.     03060002
           MOVE PV-CURR-BOM-DATE (9:2)   TO ML015-PURCH-DOC-DTE-DD.     03070002
           MOVE ALL '0'                  TO ML015-PURCH-DOC-5-NBR.      03080002
           MOVE ALL '0'                  TO ML015-PURCH-PO-TYP-CDE.     03090002
           MOVE ML556-LOC-NBR            TO ML015-PURCH-STORE-NBR-9.    03100002
           MOVE ML556-EXTD-COST-AMT      TO ML015-PURCH-MERCH-AMT.      03110002
           MOVE ZEROS                    TO ML015-PURCH-DISCT-AMT.      03120002
           MOVE ZEROS                    TO ML015-PURCH-FRGHT-AMT.      03130002
           MOVE ML556-EXTD-COST-AMT      TO ML015-PURCH-NET.            03140002
           MOVE ML556-EXTD-RTL-AMT       TO ML015-PURCH-RETAIL.         03150002
           MOVE PC-01-C                  TO ML015-PURCH-TRANS-CDE.      03160002
      *    ML015-PURCH-TRANS-CDE IS DEBIT/CREDIT INDICATOR              03170003
           MOVE ML556-SKU-NBR            TO ML015-PURCH-SKU-NBR.        03180003
           MOVE ML556-CURR-ENT-ID        TO ML015-PURCH-ENT-ID.         03190002
           MOVE ML556-CURR-VS-ID         TO ML015-PURCH-RMS-STYL-ID.    03200003
           MOVE ML556-CURR-LBL-SEQ-NBR   TO ML015-PURCH-LBL-SEQ-NBR.    03210002
                                                                        03220002
           PERFORM 6000-WRITE-PADJ-RD15.                                03230003
                                                                        03240003
                                                                        03250003
      ******************************************************************03260001
       5000-BUILD-PADJ-DEBIT.                                           03270002
      ******************************************************************03280001
      *  ONLY FIELDS DIFFERENT FROM THE CREDIT TRANSACTION WILL BE      03290003
      *  FORMATTED FRO THE DEBIT TRANSACTION                            03300003
      *  CURRENT DEPT AND CLASS WILL BE USED FOR THE DEBIT BECAUSE      03310003
      *  RECLASS TRANSACTIONS WERE ALLOWED TO BE PROCESSED DURING THE   03320003
      *  MONTH INSTEAD OF BEING HELD UNTIL THE END OF THE MONTH.        03330003
      ******************************************************************03340003
                                                                        03350002
                                                                        03360002
           MOVE ML556-PREV-INHOUSE-NBR   TO                             03370003
                                        ML015-PURCH-VENDOR-INHSE-NMBR.  03380002
           MOVE PC-V                     TO                             03390003
                                         ML015-PURCH-BATCH-NBR (1:1).   03400003
                                                                        03410003
           IF ML556-LBL-SEQ-CHG-CDE = PC-1                              03420003
               IF ML556-ENT-ID-CHG-CDE = PC-1                           03430003
                   MOVE PC-Z7            TO ML015-PURCH-AP-TRANS-CDE    03440003
               ELSE                                                     03450003
                   MOVE PC-Z3            TO ML015-PURCH-AP-TRANS-CDE    03460003
               END-IF                                                   03470003
           ELSE                                                         03480003
               IF ML556-ENT-ID-CHG-CDE = PC-1                           03490003
                   MOVE PC-Z5            TO ML015-PURCH-AP-TRANS-CDE    03500003
               END-IF                                                   03510003
           END-IF.                                                      03520003
                                                                        03530002
P34517******************************************************************03540009
  |   ** THIS MULTIPLICATION (-1) CREATES ISSUES WHEN USED WITH         03550009
  |   ** WHEN SETTING THE PURCH-TRANS-CDE (WHEN '02', MLKUP613 WILL     03560009
  |   ** ALSO MULTIPLY BY -1) CAUSING THE OPPOSITE OF INTENDED EFFECT   03570009
  |   ******************************************************************03580009
  |   *    COMPUTE ML015-PURCH-MERCH-AMT =                              03590009
  |   *           (ML015-PURCH-MERCH-AMT * -1).                         03600009
  |   *                                                                 03610009
  |   *    COMPUTE ML015-PURCH-NET =                                    03620009
  |   *           (ML015-PURCH-NET * -1).                               03630009
  |   *                                                                 03640009
  |   *    COMPUTE ML015-PURCH-RETAIL =                                 03650009
  |   *           (ML015-PURCH-RETAIL * -1).                            03660009
P34517                                                                  03670009
           MOVE PC-02-C                  TO ML015-PURCH-TRANS-CDE.      03680002
      *    ML015-PURCH-TRANS-CDE IS DEBIT/CREDIT INDICATOR              03690003
                                                                        03700003
           MOVE ML556-PREV-ENT-ID        TO ML015-PURCH-ENT-ID.         03710003
           MOVE ML556-PREV-VS-ID         TO ML015-PURCH-RMS-STYL-ID.    03720003
           MOVE ML556-PREV-LBL-SEQ-NBR   TO ML015-PURCH-LBL-SEQ-NBR.    03730003
                                                                        03740003
           PERFORM 6000-WRITE-PADJ-RD15.                                03750003
                                                                        03760001
                                                                        03770001
      ******************************************************************03780001
       6000-WRITE-PADJ-RD15.                                            03790003
      ******************************************************************03800001
                                                                        03810001
           WRITE PADJ-TRANS-REC FROM ML015-PURCHASE-RECORD.             03820003
                                                                        03830001
           ADD 1 TO PA-PADJ-TRANS-OUT-CNT.                              03840003
                                                                        03850001
                                                                        03860001
                                                                        03870001
      ******************************************************************03880001
       9000-EOJ.                                                        03890001
      ******************************************************************03900001
      *                                                                 03910001
                                                                        03920001
           DISPLAY ' '.                                                 03930001
           DISPLAY '  PROGRAM MLKUT218 PROCESSING SUMMARY'.             03940001
           DISPLAY '  -----------------------------------'.             03950001
           DISPLAY ' '.                                                 03960001
           DISPLAY ' PA-SKU-RECS-IN-CNT    ' PA-SKU-RECS-IN-CNT.        03970005
           DISPLAY ' PA-PADJ-TRANS-OUT-CNT ' PA-PADJ-TRANS-OUT-CNT.     03980005
                                                                        03990001
           CLOSE DATE-CONTROL-FILE                                      04000001
                 SKU-CURR-PREV-ATTR-FILE                                04010001
                 PADJ-TRANS-FILE.                                       04020002
                                                                        04030001
       EJECT                                                            04040001
                                                                        04050001
                                                                        04060001
                                                                        04070001
      ******************************************************************04080001
       9900-COMMON-ABEND-ROUTINE.                                       04090001
      ******************************************************************04100001
      *                                                                 04110001
           DISPLAY AA-ABEND-LIT.                                        04120001
           DISPLAY AA-PROGRAM-LIT.                                      04130001
           DISPLAY AA-PARAGRAPH-LIT.                                    04140001
           DISPLAY AA-MESSAGE-LINE.                                     04150001
           DISPLAY ABEND-CODE.                                          04160001
                                                                        04170001
           PERFORM 9999-ABEND.                                          04180001
                                                                        04190001
       EJECT                                                            04200001
                                                                        04210001
                                                                        04220001
       9999-ABEND.                                                      04230001
                                                                        04240001
           CALL 'ILBOABN0' USING ABEND-CODE.                            04250001
                                                                        04260001
