000100*----------------------------------------------------------       00000300
000200 IDENTIFICATION DIVISION.                                         00000400
000300*----------------------------------------------------------       00000500
000400 PROGRAM-ID.    XSKUT027.                                         00000609
000500 AUTHOR.        JOSEPH MENYAH.                                    00000700
000600 DATE-WRITTEN.  OCTOBER , 2002.                                   00000800
000700                                                                  00000900
000800*----------------------------------------------------------       00001000
000900*            ADHOC STORE GROUP EVENT EXTRACT                      00002000
001000*----------------------------------------------------------       00003000
001010* THIS PROGRAM WILL PERFORM THE NECESSARY BUSINESS EVENT          00004000
001020* EXTRACT FOR THE PRICE VERSION BUSINESS EVENT.                   00005000
001124*                                                                 00006000
001125*----------------------------------------------------------       00007000
001126* HISTORY LOG:                                                    00008000
001127*                                                                 00009000
001128*----------------------------------------------------------       00010000
001129* DATE:                                                           00020000
001130* WR/IR#:                                                         00030000
001131* PROGRAMMER:                                                     00040000
001140* DESCRIPTION:                                                    00050000
001150*                                                                 00060000
001160*----------------------------------------------------------       00070000
001170 ENVIRONMENT DIVISION.                                            00080000
001180*----------------------------------------------------------       00090000
001190 CONFIGURATION SECTION.                                           00100000
001200 SOURCE-COMPUTER. IBM-3090.                                       00110000
001300 OBJECT-COMPUTER. IBM-3090.                                       00120000
001400                                                                  00130000
001500 INPUT-OUTPUT SECTION.                                            00140000
001600                                                                  00150000
001700 FILE-CONTROL.                                                    00160000
001800                                                                  00170000
004900     SELECT DATE-RANGE-FILE                                       00180000
005000         ASSIGN TO INP01.                                         00190000
                                                                        00190100
004900     SELECT TMST-FILE                                             00190200
005000         ASSIGN TO INP02.                                         00190300
                                                                        00190400
004900     SELECT EXTRACT-FILE                                          00190500
005000         ASSIGN TO OUT01.                                         00190600
001900*----------------------------------------------------------       00190700
002000 DATA DIVISION.                                                   00190800
002100*----------------------------------------------------------       00190900
002200 FILE SECTION.                                                    00191000
002300                                                                  00192000
008000 FD  EXTRACT-FILE                                                 00193000
008100     RECORDING MODE IS F                                          00194000
008200     LABEL RECORDS ARE OMITTED                                    00195000
008300     RECORD CONTAINS 150 CHARACTERS                               00196000
008400     DATA RECORD IS ADHC-STORE-GRP-REC.                           00197000
008500 01  ADHC-STORE-GRP-REC    PIC X(150).                            00198000
008600                                                                  00199000
005800 FD  DATE-RANGE-FILE                                              00200000
005900     RECORDING MODE IS F                                          00210000
006000     LABEL RECORDS ARE OMITTED                                    00220000
006100     RECORD CONTAINS 80 CHARACTERS                                00230000
006200     BLOCK CONTAINS 0 RECORDS.                                    00240000
       01  DATE-RANGE-LINE             PIC  X(80).                      00250000
006500                                                                  00260000
005800 FD  TMST-FILE                                                    00270000
005900     RECORDING MODE IS F                                          00280000
006000     LABEL RECORDS ARE OMITTED                                    00290000
006100     RECORD CONTAINS 80 CHARACTERS                                00300000
006200     BLOCK CONTAINS 0 RECORDS.                                    00310000
       01  TMST-LINE                        PIC  X(80).                 00320000
006500                                                                  00330000
002500*---------------------------------------------------------        00340000
002600                                                                  00350000
002700 WORKING-STORAGE SECTION.                                         00360000
002800*---------------------------------------------------------        00370000
003500* PC- PROGRAM CONSTANTS                                           00380000
003600*----------------------------------------------------------       00390000
003700 01  PC-PROGRAM-CONSTANTS.                                        00400000
003800     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'XSKUT027'. 00410000
003900     05  PC-MAX-RETRIES               PIC S9(04) VALUE +5 COMP.   00420000
004000                                                                  00430000
004100*----------------------------------------------------------       00440000
004200* PS- PROGRAM SWITCHES                                            00450000
004300*----------------------------------------------------------       00460000
004400 01  PS-PROGRAM-SWITCHES.                                         00470000
004500     05  PS-EOF-EXTRACT-SW           PIC X(01)  VALUE SPACE.      00480000
004600         88  PS-EOF-EXTRACT                     VALUE 'Y'.        00490000
004600         88  PS-NOT-EOF-EXTRACT                 VALUE 'N'.        00500000
004500     05  PS-EOF-EXTRACT1-SW           PIC X(01) VALUE SPACE.      00501000
004600         88  PS-EOF-EXTRACT1                    VALUE 'Y'.        00502000
004600         88  PS-NOT-EOF-EXTRACT1                VALUE 'N'.        00503000
           05  PS-DATE-RANGE-FILE-SW        PIC  X(01) VALUE 'N'.       00504000
               88  PS-DATE-RANGE-FILE-END               VALUE 'Y'.      00505000
               88  PS-DATE-RANGE-FILE-START             VALUE 'N'.      00506000
           05  PS-TMST-FILE-SW              PIC  X(01)  VALUE 'N'.      00507000
               88  PS-TMST-FILE-END                     VALUE 'Y'.      00508000
               88  PS-TMST-FILE-START                   VALUE 'N'.      00509000
004900*----------------------------------------------------------       00510000
005000* PV- PROGRAM VARIABLES                                           00520000
005100*----------------------------------------------------------       00530000
       01  CC-DATE-RANGE-FILE.                                          00540000
           05  CC-START-DATE                PIC X(10).                  00550000
           05  FILLER                       PIC X(01).                  00560000
           05  CC-END-DATE                  PIC X(10).                  00570000
                                                                        00580000
       01  CC-TMST-FILE.                                                00590000
           05  CC-LAST-UPD-TMST             PIC X(19).                  00600000
005200 01 PV-PROGRAM-VARIABLES.                                         00610000
006000    05  PV-RECORD-COUNT               PIC 9(05) VALUE ZEROS.      00620000
013800    05  ABEND-CODE              PIC S9(4)  VALUE ZEROS COMP SYNC. 00630000
005500    05  PV-SQL-SUB                    PIC S9(4)  VALUE +0 COMP.   00631000
005600    05  PV-MAX-OFFSET-DTE             PIC 9(08)  VALUE 0.         00632000
008600    05  PV-LAST-UPD-TMST.                                         00633000
008700        10  PV-AD-EVNT-END-DTE.                                   00634000
008800            15  PV-LAST-UPD-CCYY          PIC X(04).              00635000
008900            15  FILLER                    PIC X(01) VALUE '-'.    00636000
009000            15  PV-AD-EVNT-DTE-TM2-MM     PIC X(02).              00637000
009100            15  FILLER                    PIC X(01) VALUE '-'.    00638000
009200            15  PV-AD-EVNT-DTE-TM2-DD     PIC X(02).              00639000
009100            15  PV-TIME-FILLER            PIC X(01) VALUE '.'.    00640000
009300        10  PV-AD-EVNT-END-TM             PIC X(15).              00650000
005710    05  PV-AD-EVNT-ID                 PIC S9(09) VALUE +0.        00660000
                                                                        00670000
007100    05  PV-STRT-PARM.                                             00680000
007200        10  PV-STRT-DTE-CC            PIC X(02).                  00690000
007200        10  PV-STRT-DTE-YY            PIC X(02).                  00691000
007400        10  PV-STRT-DTE-MM            PIC X(02).                  00692000
007600        10  PV-STRT-DTE-DD            PIC X(02).                  00693000
007400        10  FILLER                    PIC X.                      00694000
007400        10  PV-DECREMENT              PIC X(02).                  00695000
007400        10  FILLER                    PIC X(69).                  00696000
007700                                                                  00697000
007100    05  PV-EVNT-STRT-DTE              PIC X(10).                  00698000
                                                                        00699000
004310    05  PV-NULLS-INDICATORS.                                      00700000
004320        10  PV-RUSBL-STRT-IND         PIC S9(4) VALUE +0 COMP.    00710000
004320        10  PV-RUSBL-END-IND          PIC S9(4) VALUE +0 COMP.    00720000
008500                                                                  00730000
008600    05  PV-EVNT-END-DTE-TM.                                       00740000
008700        10  PV-EVNT-END-DTE.                                      00750000
008800            15  PV-EVNT-DTE-TM2-CCYY      PIC X(04).              00760000
008900            15  FILLER                    PIC X(01).              00770000
009000            15  PV-EVNT-DTE-TM2-MM        PIC X(02).              00780000
009100            15  FILLER                    PIC X(01).              00790000
009200            15  PV-EVNT-DTE-TM2-DD        PIC X(02).              00800000
009300        10  PV-EVNT-END-TM                PIC X(16).              00810000
009400                                                                  00820000
           05  PV-OPERATION-MSG             PIC  X(60)  VALUE SPACES.   00830000
           05  PV-OPERATION-MSG-1           PIC  X(40)  VALUE SPACES.   00840000
       01  PV-TOTAL-RECORD.                                             00850000
           05 PV-BUSINESS-EVNT-ID              PIC 9(03) VALUE ZERO.    00860000
           05 PV-ACTION-CDE                    PIC X(01) VALUE 'T'.     00870000
           05 PV-TOTAL-NBR-OF-RECS             PIC 9(11) VALUE ZERO.    00880000
010900*----------------------------------------------------------       00890000
011000* ADHOC STORE GROUP EVENT RECORD LAYOUT                           00900000
011100*----------------------------------------------------------       00910000
011200     COPY XSRD023.                                                00920000
011300                                                                  00921000
011400*----------------------------------------------------------       00922000
011500* DATE ROUTINE COPY MEMBERS                                       00923000
011600*----------------------------------------------------------       00924000
011700     COPY DPWS500.                                                00925000
011800                                                                  00926000
011900*----------------------------------------------------------       00927000
012000* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         00928000
012100*----------------------------------------------------------       00929000
012200     COPY DPWS004.                                                00930000
012300                                                                  00940000
030160*---------------------------------------------                    00950000
030170*  DB2 COMMUNICATION AREA.                                        00960000
030180*---------------------------------------------                    00970000
030190     EXEC SQL                                                     00980000
030191          INCLUDE SQLCA                                           00990000
030192     END-EXEC.                                                    01000000
030193                                                                  01010000
023000     COPY SQLCA2.                                                 01020000
030194*---------------------------------------------                    01030000
030195*  DB2 TABLE XST00036(XST_ADHC_STR_GP)                            01040000
030196*---------------------------------------------                    01050000
030197     EXEC SQL                                                     01060000
030198          INCLUDE XST00036                                        01070000
030199     END-EXEC.                                                    01080000
030200                                                                  01090000
030194*---------------------------------------------                    01170000
030195*  DB2 TABLE XST00031(XST_PROMO_ADHC_RLT)                         01180000
030196*---------------------------------------------                    01190000
030197     EXEC SQL                                                     01200000
030198          INCLUDE XST00031                                        01210000
030199     END-EXEC.                                                    01220000
030200                                                                  01230000
030194*---------------------------------------------                    01240000
023300*   EXTRACT CURSOR  DB2 SELECT                                    01250000
030194*---------------------------------------------                    01260000
023400     EXEC SQL                                                     01352307
023500       DECLARE EXTRACT CURSOR FOR                                 01352407
              SELECT DISTINCT                                           01352509
                     A.ADHC_STR_GP_ID,                                  01352609
                     A.ADHC_STR_GP_NM,                                  01352709
                     A.RUSBL_IND,                                       01352809
                     A.RUSBL_STRT_TMST,                                 01352909
                     A.RUSBL_END_TMST,                                  01353009
                     A.STAT_CDE,                                        01353109
                     A.SOR_LAST_UPD_TMST                                01353209
024100        FROM XST_ADHC_STR_GP A                                    01353309
024200        WHERE A.RUSBL_IND = 'N'                                   01353409
                AND A.SOR_LAST_UPD_TMST <= :CC-LAST-UPD-TMST            01353509
                AND EXISTS(SELECT 1                                     01353709
                           FROM XST_PROMO_ADHC_RLT B                    01353909
024200                     WHERE A.ADHC_STR_GP_ID = B.ADHC_STR_GP_ID    01354009
                             AND DATE(B.PROMO_END_TMST)  >=             01354109
                               :CC-START-DATE                           01354209
                             AND DATE(B.PROMO_STRT_TMST) <=             01354309
                               :CC-END-DATE                             01354409
                          )                                             01354509
               WITH UR                                                  01354607
024400     END-EXEC.                                                    01354707
030310                                                                  01354807
030194*---------------------------------------------                    01354907
023300*   EXTRACT1 CURSOR  DB2 SELECT                                   01355007
030194*---------------------------------------------                    01355107
023400     EXEC SQL                                                     01355207
023500       DECLARE EXTRACT1 CURSOR FOR                                01355307
              SELECT DISTINCT A.ADHC_STR_GP_ID,                         01355407
                     A.ADHC_STR_GP_NM,                                  01355507
                     A.RUSBL_IND,                                       01355607
                     A.RUSBL_STRT_TMST,                                 01355707
                     A.RUSBL_END_TMST,                                  01355807
                     A.STAT_CDE,                                        01356000
                     A.SOR_LAST_UPD_TMST                                01357000
024100        FROM XST_ADHC_STR_GP A                                    01358000
024200        WHERE  A.RUSBL_IND = 'Y'                                  01359100
              AND    DATE(A.RUSBL_END_TMST)                             01359200
                          >= :CC-START-DATE                             01359300
              AND    DATE(A.RUSBL_STRT_TMST)                            01359400
                          <= :CC-END-DATE                               01359500
               WITH UR                                                  01359600
024400     END-EXEC.                                                    01359700
                                                                        01359810
031400*----------------------------------------------------------       01359900
031500 PROCEDURE DIVISION.                                              01360000
032100*----------------------------------------------------------       01360100
032200 0000-MAINLINE.                                                   01360200
032300                                                                  01360300
032400     PERFORM 1000-INITIALIZATION.                                 01360400
032500                                                                  01360500
032600     PERFORM 2000-EXTRACT-DATA                                    01360600
032700             UNTIL PS-EOF-EXTRACT                                 01360700
032700             AND PS-EOF-EXTRACT1.                                 01360800
035000                                                                  01360900
035100     PERFORM 9990-WRITE-RECORD-CNT.                               01361000
                                                                        01361100
035100     PERFORM 9999-WRAPUP.                                         01362000
035200                                                                  01363000
035500     GOBACK.                                                      01364000
035700                                                                  01365000
035701*0000-EXIT.                                                       01366000
035702 EJECT.                                                           01367000
035703                                                                  01368000
035800*----------------------------------------------------------       01369000
035900* 1000-INITIALIZATION.                                            01370000
036000*     INTIALIZES OR MOVES ANY VARIABLES BEFORE IT WILL            01380000
036100*     UPDATE OR INSERT A RECORD.                                  01390000
036200*----------------------------------------------------------       01400000
036300 1000-INITIALIZATION.                                             01410000
                                                                        01420000
           SET PS-NOT-EOF-EXTRACT TO TRUE.                              01430000
           SET PS-NOT-EOF-EXTRACT1 TO TRUE.                             01440000
                                                                        01450000
026600     OPEN INPUT DATE-RANGE-FILE                                   01460000
026600                TMST-FILE                                         01470000
026600          OUTPUT EXTRACT-FILE.                                    01480000
                                                                        01490000
051100     PERFORM 2010-COMPUTE-STRT-DTE                                01500000
051200        THRU 2010-EXIT.                                           01510000
038000                                                                  01520000
027900     EXEC SQL                                                     01530000
028000         OPEN EXTRACT                                             01540000
028100     END-EXEC.                                                    01550000
                                                                        01560000
027900     EXEC SQL                                                     01570000
028000         OPEN EXTRACT1                                            01580000
028100     END-EXEC.                                                    01590000
                                                                        01600000
055500     IF SQLCODE < 0                                               01610000
055600         DISPLAY 'OPEN  UNSUCCESSFUL FOR TABLE XST_ADHC_STR_GP'   01620000
055700         PERFORM U9980-SQL-ERROR                                  01630000
055800            THRU U9980-EXIT.                                      01640000
055900                                                                  01650000
056000     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               01660000
056100           SQLWARN0 = 'W'                                         01670000
056200         DISPLAY 'FETCH WARNING FOR TABLE XST_ADHC_STR_GP'        01680000
056300         PERFORM U9990-SQL-WARNING                                01690000
056400            THRU U9990-EXIT.                                      01700000
056500                                                                  01710000
036400                                                                  01720000
                                                                        01730000
036410     INITIALIZE DCLXST00036.                                      01740000
036515                                                                  01750000
037240*1100-EXIT.                                                       01760000
037250 EJECT.                                                           01770000
037251                                                                  01780000
037260*----------------------------------------------------------       01790000
037300* 2000-EXTRACT-DATA.                                              01800000
037400*     THIS CHECKS THE ACTION TO SEE WHETHER THE RECORD            01810000
037500*     SHOULD BE INSERTED INTO THE AD EVENT TABLE OR UPDATED.      01820000
037600*     IF SOMETHING IS WRONG WITH THE ACTION CODE IT WILL          01830000
037700*     PROCESS AN ERROR AND EXIT THE PROGRAM.                      01840000
037800*----------------------------------------------------------       01850000
037900 2000-EXTRACT-DATA.                                               01860000
                                                                        01870000
                                                                        01880000
051100     PERFORM 2100-FETCH-EXTRACT                                   01890000
051200        THRU 2100-EXIT.                                           01900000
038000                                                                  01910000
           IF PS-NOT-EOF-EXTRACT                                        01920000
051100         PERFORM 2200-FORMAT-EXTRACT-FILE                         01930000
051200            THRU 2200-EXIT                                        01931000
                                                                        01932000
051100         PERFORM 3000-WRITE-ADHC-STR-GRP-EXTRCT                   01933000
051200            THRU 3000-EXIT                                        01934000
           END-IF.                                                      01935000
038000                                                                  01936000
051100     PERFORM 2110-FETCH-EXTRACT1                                  01937000
051200        THRU 2110-EXIT.                                           01938000
038000                                                                  01939000
           IF PS-NOT-EOF-EXTRACT1                                       01940000
051100         PERFORM 2200-FORMAT-EXTRACT-FILE                         01950000
051200            THRU 2200-EXIT                                        01960000
                                                                        01970000
051100         PERFORM 3000-WRITE-ADHC-STR-GRP-EXTRCT                   01980000
051200            THRU 3000-EXIT                                        01990000
           END-IF.                                                      02000000
038000                                                                  02010000
038110*2000-EXIT.                                                       02020000
038200 EJECT.                                                           02030000
030000 2010-COMPUTE-STRT-DTE.                                           02040000
           READ DATE-RANGE-FILE INTO CC-DATE-RANGE-FILE                 02041000
              AT END                                                    02042000
                 SET PS-DATE-RANGE-FILE-END TO TRUE                     02043000
           END-READ.                                                    02044000
                                                                        02045000
           IF PS-DATE-RANGE-FILE-END                                    02046000
               MOVE 'NO DATE RANGE FILE TO PROCESS'                     02047000
                                                 TO PV-OPERATION-MSG-1  02048000
      *        SET ABEND-4003-CTRL-CARD-ERROR    TO TRUE                02049000
               PERFORM Z910-ABEND                                       02050000
           ELSE                                                         02060000
               DISPLAY 'CC-START-DATE = ' CC-START-DATE                 02070000
               DISPLAY 'CC-END-DATE   = ' CC-END-DATE                   02080000
           END-IF.                                                      02090000
                                                                        02100000
           READ TMST-FILE INTO CC-TMST-FILE                             02101000
              AT END                                                    02102000
                 SET PS-TMST-FILE-END TO TRUE                           02103000
           END-READ.                                                    02104000
                                                                        02105000
           IF PS-TMST-FILE-END                                          02106000
               MOVE 'NO TMST FILE TO PROCESS'                           02107000
                                                 TO PV-OPERATION-MSG-1  02108000
               PERFORM Z910-ABEND                                       02109000
           ELSE                                                         02109100
               DISPLAY 'CC-LAST-UPD-TMST = ' CC-LAST-UPD-TMST           02109200
           END-IF.                                                      02109300
030100                                                                  02109400
 35100                                                                  02109500
038110 2010-EXIT.                                                       02109600
           EXIT.                                                        02109700
038200 EJECT.                                                           02109800
038300*------------------------------------------------------           02109900
038400* 2100-FETCH-EXTRACT                                              02110000
038500*     EXTRACTS THE AD EVENT RECORD.                               02110100
038600*------------------------------------------------------           02110200
038210                                                                  02110300
054400 2100-FETCH-EXTRACT.                                              02110400
054500                                                                  02110500
054600     EXEC SQL                                                     02110600
054700         FETCH EXTRACT                                            02110700
                   INTO :XST00036-ADHC-STR-GP-ID,                       02110800
                        :XST00036-ADHC-STR-GP-NM,                       02110900
                        :XST00036-RUSBL-IND,                            02111000
                        :XST00036-RUSBL-STRT-TMST:PV-RUSBL-STRT-IND,    02112000
                        :XST00036-RUSBL-END-TMST:PV-RUSBL-END-IND,      02113000
                        :XST00036-STAT-CDE,                             02114000
                        :XST00036-SOR-LAST-UPD-TMST                     02115000
055300     END-EXEC.                                                    02116000
055400                                                                  02117000
055500     IF SQLCODE < 0                                               02118000
055600         DISPLAY 'FETCH UNSUCCESSFUL FOR TABLE XST_ADHC_STR_GP'   02119000
055700         PERFORM U9980-SQL-ERROR                                  02120000
055800            THRU U9980-EXIT.                                      02130000
055900                                                                  02140000
056000     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               02150000
056100           SQLWARN0 = 'W'                                         02160000
056200         DISPLAY 'FETCH WARNING FOR TABLE XST_ADHC_STR_GP'        02170000
056300         PERFORM U9990-SQL-WARNING                                02180000
056400            THRU U9990-EXIT.                                      02190000
056500                                                                  02200000
056600     IF SQLCODE = +100                                            02210000
056700         MOVE 'Y' TO PS-EOF-EXTRACT-SW.                           02220000
056800                                                                  02230000
056900 2100-EXIT.                                                       02240000
057000     EXIT.                                                        02250000
038300*------------------------------------------------------           02260000
038400* 2110-FETCH-EXTRACT1                                             02270000
038500*     EXTRACTS THE AD EVENT RECORD.                               02280000
038600*------------------------------------------------------           02290000
038210                                                                  02300000
054400 2110-FETCH-EXTRACT1.                                             02310000
054500                                                                  02320000
054600     EXEC SQL                                                     02330000
054700         FETCH EXTRACT1                                           02340000
                   INTO :XST00036-ADHC-STR-GP-ID,                       02350000
                        :XST00036-ADHC-STR-GP-NM,                       02360000
                        :XST00036-RUSBL-IND,                            02370000
                        :XST00036-RUSBL-STRT-TMST:PV-RUSBL-STRT-IND,    02380000
                        :XST00036-RUSBL-END-TMST:PV-RUSBL-END-IND,      02390000
                        :XST00036-STAT-CDE,                             02400000
                        :XST00036-SOR-LAST-UPD-TMST                     02410000
055300     END-EXEC.                                                    02420000
055400                                                                  02430000
055500     IF SQLCODE < 0                                               02440000
055600         DISPLAY 'FETCH UNSUCCESSFUL FOR TABLE XST_ADHC_STR_GP'   02450000
055700         PERFORM U9980-SQL-ERROR                                  02460000
055800            THRU U9980-EXIT.                                      02470000
055900                                                                  02480000
056000     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               02490000
056100           SQLWARN0 = 'W'                                         02500000
056200         DISPLAY 'FETCH WARNING FOR TABLE XST_ADHC_STR_GP'        02510000
056300         PERFORM U9990-SQL-WARNING                                02520000
056400            THRU U9990-EXIT.                                      02530000
056500                                                                  02540000
056600     IF SQLCODE = +100                                            02550000
056700         MOVE 'Y' TO PS-EOF-EXTRACT1-SW.                          02560000
056800                                                                  02570000
056900 2110-EXIT.                                                       02571000
057000     EXIT.                                                        02572000
038300*------------------------------------------------------           02573000
038400* 2200-FORMAT-EXTRACT-FILE                                        02573100
038500*     FORMATS THE ADHOC STORE GROUP COPY BOOK.                    02573200
038600*------------------------------------------------------           02573300
038700 2200-FORMAT-EXTRACT-FILE.                                        02573400
           MOVE XST00036-ADHC-STR-GP-ID  TO XS023-ADHC-STR-GP-ID.       02573500
           MOVE XST00036-ADHC-STR-GP-NM  TO XS023-ADHC-STR-GP-NM.       02573600
           MOVE XST00036-RUSBL-IND       TO XS023-RUSBL-IND.            02573700
                                                                        02573800
           IF PV-RUSBL-STRT-IND = -1                                    02573900
              INITIALIZE XS023-RUSBL-STRT-TMST                          02574000
           ELSE                                                         02574100
              MOVE XST00036-RUSBL-STRT-TMST TO XS023-RUSBL-STRT-TMST    02574200
           END-IF                                                       02574300
                                                                        02574400
           IF PV-RUSBL-END-IND = -1                                     02574500
              INITIALIZE XS023-RUSBL-END-TMST                           02574600
           ELSE                                                         02574700
              MOVE XST00036-RUSBL-END-TMST  TO XS023-RUSBL-END-TMST     02574800
           END-IF                                                       02574900
           MOVE XST00036-STAT-CDE        TO XS023-STAT-CDE.             02575000
037200     MOVE XST00036-SOR-LAST-UPD-TMST   TO PV-LAST-UPD-TMST.       02575100
009100     MOVE '.'                          TO PV-TIME-FILLER.         02575200
037200     MOVE PV-LAST-UPD-TMST             TO XS023-LAST-UPD-TMST.    02575300
           MOVE 040                     TO XS023-BUSINESS-EVNT-ID.      02575400
           MOVE 'U'                     TO XS023-ACTION-CDE.            02575500
038800                                                                  02575600
043510 2200-EXIT.                                                       02575700
           EXIT.                                                        02575800
043600 EJECT.                                                           02575900
043610                                                                  02576000
043700*------------------------------------------------------           02576100
043800* 3000-WRITE-ADHC-STR-GRP-EXTRCT                                  02576200
043900*     WRITE EXTRACT FILE.                                         02576300
044000*------------------------------------------------------           02576400
044100 3000-WRITE-ADHC-STR-GRP-EXTRCT.                                  02576500
           ADD 1 TO PV-RECORD-COUNT.                                    02576600
                                                                        02576700
062300     WRITE ADHC-STORE-GRP-REC FROM XS023-ADHOC-STR-GP-RECORD.     02576800
                                                                        02576900
047710 3000-EXIT.                                                       02577000
           EXIT.                                                        02577100
047800 EJECT.                                                           02577200
047810                                                                  02577300
056020                                                                  02577400
059800*----------------------------------------------------------       02577500
073900 U9980-SQL-ERROR.                                                 02577600
059800*----------------------------------------------------------       02577700
074000                                                                  02577800
074100     MOVE SQLCODE    TO SQLCODE2.                                 02577900
074200     MOVE SQLERRD(3) TO SQLERRD3.                                 02578000
074300     DISPLAY '** ABEND **       ** = SQLWARNING'.                 02579000
074400     DISPLAY '** PROGRAM        ** = XSKUT027'.                   02580000
074500     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  02590000
074600     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  02600000
074700     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   02610000
074800     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  02620000
074900                                                                  02630000
075000     MOVE 4013 TO ABEND-CODE.                                     02640000
075100     CALL 'ILBOABN0' USING ABEND-CODE.                            02650000
075200                                                                  02660000
075300 U9980-EXIT.                                                      02670000
075400     EXIT.                                                        02680000
                                                                        02690000
059800*----------------------------------------------------------       02700000
075600 U9990-SQL-WARNING.                                               02710000
059800*----------------------------------------------------------       02720000
075700                                                                  02730000
075800     MOVE SQLCODE    TO SQLCODE2.                                 02740000
075900     MOVE SQLERRD(3) TO SQLERRD3.                                 02750000
076000     DISPLAY '** ABEND **       ** = SQLWARNING'.                 02760000
076100     DISPLAY '** PROGRAM        ** = XSKUT027'.                   02770000
077200                                                                  02780000
077300     MOVE 4013 TO ABEND-CODE.                                     02790000
077400     CALL 'ILBOABN0' USING ABEND-CODE.                            02800000
077500                                                                  02810000
077600 U9990-EXIT.                                                      02820000
077700     EXIT.                                                        02830000
                                                                        02840000
060100 9990-WRITE-RECORD-CNT.                                           02850000
           INITIALIZE XS023-ADHOC-STR-GP-RECORD.                        02860000
           MOVE 040 TO PV-BUSINESS-EVNT-ID.                             02870000
           MOVE PV-RECORD-COUNT TO PV-TOTAL-NBR-OF-RECS.                02880000
           MOVE 'T' TO PV-ACTION-CDE.                                   02890000
062300     WRITE ADHC-STORE-GRP-REC FROM PV-TOTAL-RECORD.               02900000
060710*9990-EXIT.                                                       02910000
                                                                        02920000
059800*----------------------------------------------------------       02930000
059900* 9999-WRAPUP.                                                    02940000
059910*     MOVES ALL ERROR CODES TO THE LINKAGE VARIABLES TO           02950000
059920*     BE PASSED BACK TO THE CALLING PROGRAM.  EXITS THE           02960000
059930*     PROGRAM.                                                    02970000
060000*----------------------------------------------------------       02980000
060100 9999-WRAPUP.                                                     02990000
           CLOSE DATE-RANGE-FILE                                        03000000
026600           TMST-FILE                                              03010000
                 EXTRACT-FILE.                                          03020000
                                                                        03030000
072200     EXEC SQL                                                     03040000
072300         CLOSE EXTRACT                                            03050000
072400     END-EXEC.                                                    03060000
060200                                                                  03070000
060500                                                                  03080000
060710*9999-EXIT.                                                       03090000
060800 EJECT.                                                           03100000
060900                                                                  03110000
      ******************************************************************03120000
      * Z910-ABEND - PERFORMS A NON-SQL-ABEND                          *03130000
      ******************************************************************03140000
       Z910-ABEND.                                                      03150000
                                                                        03160000
           DISPLAY '** ABEND           **'.                             03170000
           DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG.         03180000
           DISPLAY '**                 ** = ' PV-OPERATION-MSG-1.       03190000
                                                                        03200000
           CALL 'ILBOABN0' USING ABEND-CODE.                            03210000
