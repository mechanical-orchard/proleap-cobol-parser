000100 IDENTIFICATION DIVISION.                                         00010007
000200                                                                  00020007
000300 PROGRAM-ID.      SAKUT116.                                       00030007
000400 AUTHOR.          DAVID WELLER.                                   00040007
000500 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00050007
000600 DATE-WRITTEN.    09/01/13.                                       00060007
000700 DATE-COMPILED.                                                   00070007
000800                                                                  00080007
000900******************************************************************00090007
001000*            ***  BRICK & MORTAR TSAADSU LOADER ***               00100007
001000*  THIS IS AN ON-REQUEST VERSION OF THE TSAADSU LOADER THAT WILL  00110007
001000*  BE RUN AFTER A STORE RETRANSMITS THEIR CASH OFFICE TO          00120007
001000*  CORPORATE ON A MONDAY OR TUESDAY FOR A PREVIOUS WEEK, WHICH    00130007
001000*  WOULD OVERLAY THE SFS CASH OFFICE TOTALS LOADED BY SAKUT114    00140007
001000*  (SAK135) ON SUNDAY NIGHT.                                      00150007
001000*  THIS VERSION WILL HAVE CONTROL CARDS THAT CONTAIN THE STORE(S) 00160007
001000*  AND DATE(S) THAT NEED TO BE RELOADED.  IT WILL ONLY USE THE    00170007
001000*  DATE RANGE CONTROL CARD USED BY SAKUT114 TO VERIFY THE DATES   00180007
001000*  ENTERED ON THE NEW STORE DATE CONTROL CARD(S).                 00190007
001000*  THE STORE CURSOR IN SAKUT114 THAT PROVIDED THE LIST OF STORES  00200007
001000*  TO RUN THE SUM CURSOR FOR SHOULD BE REMOVED.                   00210007
001000*                                                                 00220007
001000*  TWO EDITS ARE REQUIRED AGAINST THE INPUT CTLCDS:               00230007
001000*  1) READ XST_LOC TO VERIFY THAT NO ECOM STORES ARE PROCESSED    00240007
001000*  2) MAKE SURE THE DATES ENTERED FALL WITHIN THE DATE RANGE      00250007
001000*     SUPPLID BY THE EXISTING CTLCD.                              00260007
001000*                                                                 00270007
001000*  THIS PROGRAM WILL BE RUN BY JOB SAK945 AND WILL UTILIZE THE    00280007
001000*  SAME SAKUT115 AND SAKUP041 PROGRAMS USED BY SAKUT114 / SAK135. 00290007
001100*=================================================================00300007
001200*                                                                 00310007
001300*  SHIP-FROM-STORE HAS NO CASH OFFICE, SO THE TSAADSU TABLE       00320007
001400*  WILL NOT BE GETTING LOADED FROM THAT SOURCE.  THIS PROGRAM     00330007
001500*  WILL COPY DATA FROM THE TSASUM TABLE INTO A EXTRACT FILE WHICH 00340007
001510*  WILL BE USED TO UPDATE THE TSAADSU TABLE FOR THE SHIP-FROM-    00350007
      *  STORE STORE.                                                   00360007
001700*                                                                 00370007
001800*  THIS PROGRAM WILL RUN ON ON-REQUEST AND REQUIRE THAT I.T.      00380007
001800*  ENTER THE REQUIRED STORE(S) AND DATE(S) IN THE CONTROL CARD.   00390007
002000*                                                                 00400007
002100*  INPUT: INP01 - CONTAINS POS DATE AND STORE NUMBER PAIRS USED   00410007
  2200*                 TO DETERMINE WHAT TO PROCESS.                   00420007
002300*                                                                 00430007
002100*  INPUT: INP02 - CONTAINS DATE RANGE OF PREVIOUS SUNDAY THRU     00431007
  2200*                 SATURDAY.                                       00432007
002300*                                                                 00433007
002400*========================== CHANGE LOG ===========================00434007
002500*  AUTH      BY       DATE                 DESCRIPTION            00435007
002600*=================================================================00436007
000000* CHG0062618 TKMA602  09-01-13   CREATE PROGRAM                   00437007
002800*                                                                 00438007
002900******************************************************************00439007
8446E * 8446E      TKMA555  02-20-14   ADD IN BPS                       00440007
8446E *                                                                 00450007
8446E ******************************************************************00460007
052914* CHG0082892 TKMAE97  05-29-14   INCREASE POC REGISTER RANGE TO   00470007
052914*                                70-89 AS WELL AS INCLUSION OF    00480007
052914*                                THE DBS (DEBIT) CATEGORY.        00490007
052914******************************************************************00491007
BOSS  * CHG0188487 TKMA555  01-25-18   ADD IN 'BOS', 'BSR', 'BPR'.      00492007
BOSS  ******************************************************************00493007
255393* CHG0255393 TKMAC09  03-19-21   ADDED LOGIC FOR SEPHORA.         00493108
255393*  ADD TSASUM CODES:  'SCS' - SEPHORA CHARGE SALES                00493208
255393*                     'SCR' - SEPHORA CHARGE SALES                00493308
255393*                     'SGS' - SEPHORA GIFT CARD SALES             00493408
255393*                     'SGT' - SEPHORA GIFT CARD TENDERS           00493508
255393*  ADD TSAADSU CODES: 'SCN' - SEPHORA CHARGE NET                  00493608
255393*                     'SGS' - SEPHORA GIFT CARD SALES             00493708
255393*                     'SGT' - SEPHORA GIFT CARD TENDERS           00493808
255393******************************************************************00493908
267791* CHG0267791 TKMAC09  03-11-22   REMOVING SEPHORA CATEGORIES      00494008
267791*                                ADDED PREV YEAR BECAUSE THEY WILL00494108
267791*                                NOT BE IN CASH OFFICE.           00494208
267791*                                KEPT CHANGE OF RGST_ID RANGE FROM00494309
267791*                                70 - 95 TO 90 - 95.              00494408
267791******************************************************************00494508
PAYVEN* CHG0289270 TKMAC09  06-01-23   ADD LOGIC FOR PAYPAL AND VENMO.  00494611
PAYVEN*  ADD TSASUM CODES:  'PPS' - PAYPAL CHARGE SALES                 00494710
PAYVEN*                     'PPR' - PAYPAL CHARGE RETURNS               00494810
PAYVEN*                     'VMS' - VENMO CHARGE SALES                  00494910
PAYVEN*                     'VMR' - VENMO CHARGE RETURNS                00495010
PAYVEN*  ADD TSAADSU CODES: 'PPN' - PAYPAL CHARGE NET                   00495110
PAYVEN*                     'VMN' - VENMO CHARGE NET                    00495210
PAYVEN******************************************************************00495310
003000                                                                  00495408
003100 ENVIRONMENT DIVISION.                                            00495507
003200 CONFIGURATION SECTION.                                           00496007
003300                                                                  00497007
003400 SOURCE-COMPUTER.        IBM-3090.                                00498007
003500 OBJECT-COMPUTER.        IBM-3090.                                00499007
003600                                                                  00500007
003700 INPUT-OUTPUT SECTION.                                            00510007
003800 FILE-CONTROL.                                                    00520007
003900                                                                  00530007
004000     SELECT POS-DATE-STORE-FILE ASSIGN TO INP01.                  00540007
004000     SELECT POS-DATE-RANGE-FILE ASSIGN TO INP02.                  00550007
004100     SELECT TSAADSU-FILE       ASSIGN TO OUT01.                   00560007
004200                                                                  00570007
004300 DATA DIVISION.                                                   00580007
004400 FILE SECTION.                                                    00590007
004500                                                                  00600007
004600 FD  POS-DATE-STORE-FILE                                          00610007
004700     RECORDING MODE IS F                                          00620007
004800     BLOCK CONTAINS 0 RECORDS                                     00630007
004900     LABEL RECORDS ARE STANDARD.                                  00640007
005000                                                                  00650007
005100 01  POS-DATE-STORE-RECORD            PIC  X(80).                 00660007
005200                                                                  00670007
004600 FD  POS-DATE-RANGE-FILE                                          00680007
004700     RECORDING MODE IS F                                          00690007
004800     BLOCK CONTAINS 0 RECORDS                                     00700007
004900     LABEL RECORDS ARE STANDARD.                                  00710007
005000                                                                  00720007
005100 01  POS-DATE-RANGE-RECORD            PIC  X(80).                 00721007
005200                                                                  00722007
005300 FD  TSAADSU-FILE                                                 00723007
005400     RECORDING MODE IS F                                          00724007
005500     BLOCK CONTAINS 0 RECORDS                                     00725007
005600     LABEL RECORDS ARE STANDARD.                                  00726007
005700                                                                  00727007
005800 01  TSAADSU-REC                      PIC  X(28).                 00728007
005900                                                                  00729007
006000                                                                  00730007
006100******************************************************************00740007
006200*                       WORKING STORAGE                           00750007
006300******************************************************************00760007
006400 WORKING-STORAGE SECTION.                                         00770007
006500                                                                  00780007
006600 01  W-START                          PIC  X(50)    VALUE         00790007
006700     ' *** WORKING STORAGE STARTS HERE FOR SAKUT116 *** '.        00800007
006800                                                                  00810007
006900******************************************************************00820007
007000*                          SWITCHES                               00830007
007100******************************************************************00840007
007200 01  PS-PROGRAM-SWITCHES.                                         00850007
007300                                                                  00860007
007600     05  PS-END-OF-SUM-CURSOR-SW      PIC  X(01)    VALUE 'N'.    00870007
007700         88  PS-END-OF-SUM-CURSOR                   VALUE 'Y'.    00880007
007800     05  PS-END-OF-CARD-FILE-SW       PIC  X(01)    VALUE 'N'.    00890007
007900         88  PS-END-OF-CARD-FILE                    VALUE 'Y'.    00900007
007800     05  PS-CARD-ACCEPTED-SW          PIC  X(01)    VALUE 'N'.    00910007
007900         88  PS-CARD-ACCEPTED                       VALUE 'Y'.    00920007
007900         88  PS-CARD-NOT-ACCEPTED                   VALUE 'N'.    00930007
007800     05  PS-END-OF-RANGE-FILE-SW      PIC  X(01)    VALUE 'N'.    00940007
007900         88  PS-END-OF-RANGE-FILE                   VALUE 'Y'.    00950007
008000                                                                  00960007
008100******************************************************************00970007
008200*                         CONSTANTS                               00980007
008300******************************************************************00990007
008400 01  PC-CONSTANTS.                                                01000007
008500                                                                  01010007
008600     05  PC-JOB-NAME                  PIC  X(08)    VALUE         01020007
008700                                                    'SAK945  '.   01030007
008800     05  PC-PGM-NAME                  PIC  X(08)    VALUE         01040007
008900                                                    'SAKUT116'.   01050007
009000                                                                  01060007
009100     05  PC-ROW-NOT-FOUND             PIC S9(04)    VALUE +100    01070007
009200                                                    COMP SYNC.    01080007
009300     05  PC-SUM-CTG-CDE               PIC  X(03).                 01090007
012000         88  PC-SUM-CTG-CDE-KMT                     VALUE 'KMT'.  01100007
012000         88  PC-SUM-CTG-CDE-POS                     VALUE 'POS'.  01110007
012000         88  PC-SUM-CTG-CDE-GTT                     VALUE 'GTT'.  01120007
012000         88  PC-SUM-CTG-CDE-GDT                     VALUE 'GDT'.  01130007
012000         88  PC-SUM-CTG-CDE-TAX                     VALUE 'TAX'.  01140007
012000         88  PC-SUM-CTG-CDE-GTS                     VALUE 'GTS'.  01150007
012000         88  PC-SUM-CTG-CDE-GDS                     VALUE 'GDS'.  01160007
012000         88  PC-SUM-CTG-CDE-CRI                     VALUE 'CRI'.  01170007
012000         88  PC-SUM-CTG-CDE-KMI                     VALUE 'KMI'.  01180007
012000         88  PC-SUM-CTG-CDE-POR                     VALUE 'POR'.  01190007
012000         88  PC-SUM-CTG-CDE-KCP                     VALUE 'KCP'.  01200007
012000         88  PC-SUM-CTG-CDE-NSF                     VALUE 'NSF'.  01210007
012000         88  PC-SUM-CTG-CDE-ECR                     VALUE 'ECR'.  01220007
012000         88  PC-SUM-CTG-CDE-BCS                     VALUE 'BCS'.  01230007
012000         88  PC-SUM-CTG-CDE-BCR                     VALUE 'BCR'.  01240007
012000         88  PC-SUM-CTG-CDE-NCS                     VALUE 'NCS'.  01250007
012000         88  PC-SUM-CTG-CDE-NCR                     VALUE 'NCR'.  01260007
012000         88  PC-SUM-CTG-CDE-AXS                     VALUE 'AXS'.  01270007
012000         88  PC-SUM-CTG-CDE-AXR                     VALUE 'AXR'.  01280007
012000         88  PC-SUM-CTG-CDE-KCS                     VALUE 'KCS'.  01290007
012000         88  PC-SUM-CTG-CDE-KCR                     VALUE 'KCR'.  01300007
012000         88  PC-SUM-CTG-CDE-RET                     VALUE 'RET'.  01310007
012000         88  PC-SUM-CTG-CDE-SAL                     VALUE 'SAL'.  01320007
012000         88  PC-SUM-CTG-CDE-SHS                     VALUE 'SHS'.  01330007
012000         88  PC-SUM-CTG-CDE-SHR                     VALUE 'SHR'.  01340007
012000         88  PC-SUM-CTG-CDE-GWS                     VALUE 'GWS'.  01350007
012000         88  PC-SUM-CTG-CDE-GWR                     VALUE 'GWR'.  01360007
012000         88  PC-SUM-CTG-CDE-SFS                     VALUE 'SFS'.  01370007
8446E          88  PC-SUM-CTG-CDE-BPS                     VALUE 'BPS'.  01380007
BOSS           88  PC-SUM-CTG-CDE-BPR                     VALUE 'BPR'.  01390007
BOSS           88  PC-SUM-CTG-CDE-BOS                     VALUE 'BOS'.  01390107
BOSS           88  PC-SUM-CTG-CDE-BSR                     VALUE 'BSR'.  01390207
052914         88  PC-SUM-CTG-CDE-DBS                     VALUE 'DBS'.  01390307
PAYVEN         88  PC-SUM-CTG-CDE-PPS                     VALUE 'PPS'.  01390410
PAYVEN         88  PC-SUM-CTG-CDE-PPR                     VALUE 'PPR'.  01390510
PAYVEN         88  PC-SUM-CTG-CDE-VMS                     VALUE 'VMS'.  01390610
PAYVEN         88  PC-SUM-CTG-CDE-VMR                     VALUE 'VMR'.  01390710
012100                                                                  01390807
012200******************************************************************01390907
012300*                      ACCUMULATORS                               01391007
012400******************************************************************01391107
012500 01  PA-ACCULATORS.                                               01391207
012600                                                                  01391307
012700     05  PA-CARDFILE-CNT              PIC  9(07)    VALUE ZEROS.  01391407
012800     05  PA-SUM-CURSOR-CNT            PIC  9(07)    VALUE ZEROS.  01392007
012900                                                                  01393007
013000     05  PA-TSAADSU-WRITTEN           PIC  9(07)    VALUE ZEROS.  01394007
013100                                                                  01395007
013100 01  DK-DB2-KEYS.                                                 01396007
013100     05  DK-POS-DATE-ISO         PIC X(10)    VALUE SPACES.       01397007
013100     05  DK-POS-BEGIN-DATE-ISO   PIC X(10)    VALUE SPACES.       01398007
013100     05  DK-POS-END-DATE-ISO     PIC X(10)    VALUE SPACES.       01399007
013100     05  DK-STR-NBR              PIC S9(04)   COMP.               01400007
013100                                                                  01410007
013200******************************************************************01420007
013300*                       VARIABLES                                 01430007
013400******************************************************************01440007
013500 01  PV-VARIABLES.                                                01450007
013600     05  PV-SQL                       PIC S9(04)    VALUE ZEROS.  01460007
013700     05  PV-PARAGRAPH-NAME            PIC  X(30)    VALUE SPACES. 01470007
013800     05  PV-DB2-TABLE-NAME            PIC  X(12)    VALUE SPACES. 01480007
013900     05  PV-DB2-OPERATION-MSG         PIC  X(60)    VALUE SPACES. 01490007
014000     05  PV-OPERATION-MSG-1           PIC  X(40)    VALUE SPACES. 01500007
014100     05  PV-OPERATION-MSG-2           PIC  X(40)    VALUE SPACES. 01510007
014200                                                                  01520007
014300     05  PV-ABEND-PARTN-NBR           PIC  9(04)    VALUE ZEROS.  01530007
014400     05  PV-ABEND-STR-NBR             PIC  9(04)    VALUE ZEROS.  01540007
014500     05  PV-ABEND-SUM-CTG-CDE         PIC  X(03)    VALUE SPACES. 01550007
           05  PV-DPG52-LK-DATE-INPUT       PIC  X(10)    VALUE SPACES. 01560007
014600                                                                  01570007
014700 01  PV-DB2-VARIABLES.                                            01580007
014800                                                                  01590007
015100     05  PV-DB2-SUM                   PIC S9(09)V99 COMP-3        01600007
015200                                                    VALUE ZERO.   01610007
015300                                                                  01620007
015400******************************************************************01630007
015500*                       WORK AREA                                 01640007
015600******************************************************************01650007
015700 01  PV-MISC-FIELDS.                                              01660007
015800                                                                  01670007
015900     05  PV-HOLD-SLSDTE               PIC X(10)     VALUE SPACES. 01680007
015900     05  PV-SLSDTE                    PIC X(10)     VALUE SPACES. 01690007
057500     05  PV-STM-TOTAL                 PIC S9(7)V99  VALUE ZERO.   01700007
057500     05  PV-SFS-TOTAL                 PIC S9(7)V99  VALUE ZERO.   01710007
8446E      05  PV-BPS-TOTAL                 PIC S9(7)V99  VALUE ZERO.   01720007
BOSS       05  PV-BPR-TOTAL                 PIC S9(7)V99  VALUE ZERO.   01730007
BOSS       05  PV-BOS-TOTAL                 PIC S9(7)V99  VALUE ZERO.   01740007
BOSS       05  PV-BSR-TOTAL                 PIC S9(7)V99  VALUE ZERO.   01750007
057500     05  PV-DISPLAY-STM-TOTAL         PIC ZZZZZZ9.99.             01760007
057500     05  PV-DISPLAY-SFS-TOTAL         PIC ZZZZZZ9.99.             01770007
8446E      05  PV-DISPLAY-BPS-TOTAL         PIC ZZZZZZ9.99.             01780007
BOSS       05  PV-DISPLAY-BPR-TOTAL         PIC ZZZZZZ9.99.             01790007
BOSS       05  PV-DISPLAY-BOS-TOTAL         PIC ZZZZZZ9.99.             01800007
BOSS       05  PV-DISPLAY-BSR-TOTAL         PIC ZZZZZZ9.99.             01810007
015900     05  PV-HOLD-BMSTORE              PIC S9(04)    COMP          01820007
016000                                                    VALUE ZERO.   01830007
016100                                                                  01840007
020600     05  PV-AEN-AMT                   PIC S9(09)V99 COMP-3        01850007
020700                                                    VALUE ZERO.   01860007
020600     05  PV-BCN-AMT                   PIC S9(09)V99 COMP-3        01870007
020700                                                    VALUE ZERO.   01880007
020600     05  PV-CRI-AMT                   PIC S9(09)V99 COMP-3        01890007
020700                                                    VALUE ZERO.   01900007
020600     05  PV-ECR-AMT                   PIC S9(09)V99 COMP-3        01910007
020700                                                    VALUE ZERO.   01920007
020600     05  PV-GDS-AMT                   PIC S9(09)V99 COMP-3        01930007
020700                                                    VALUE ZERO.   01940007
020600     05  PV-GDT-AMT                   PIC S9(09)V99 COMP-3        01950007
020700                                                    VALUE ZERO.   01960007
020600     05  PV-GTS-AMT                   PIC S9(09)V99 COMP-3        01961007
020700                                                    VALUE ZERO.   01962007
020600     05  PV-GTT-AMT                   PIC S9(09)V99 COMP-3        01963007
020700                                                    VALUE ZERO.   01964007
020600     05  PV-GWR-AMT                   PIC S9(09)V99 COMP-3        01965007
020700                                                    VALUE ZERO.   01966007
020600     05  PV-GWS-AMT                   PIC S9(09)V99 COMP-3        01967007
020700                                                    VALUE ZERO.   01968007
020600     05  PV-KCN-AMT                   PIC S9(09)V99 COMP-3        01969007
020700                                                    VALUE ZERO.   01970007
020600     05  PV-KCP-AMT                   PIC S9(09)V99 COMP-3        01980007
020700                                                    VALUE ZERO.   01981007
020600     05  PV-KMI-AMT                   PIC S9(09)V99 COMP-3        01982007
020700                                                    VALUE ZERO.   01983007
020600     05  PV-KMT-AMT                   PIC S9(09)V99 COMP-3        01984007
020700                                                    VALUE ZERO.   01985007
020600     05  PV-NCN-AMT                   PIC S9(09)V99 COMP-3        01986007
020700                                                    VALUE ZERO.   01987007
020600     05  PV-NSF-AMT                   PIC S9(09)V99 COMP-3        01988007
020700                                                    VALUE ZERO.   01989007
020600     05  PV-POR-AMT                   PIC S9(09)V99 COMP-3        01989107
020700                                                    VALUE ZERO.   01989207
020600     05  PV-POS-AMT                   PIC S9(09)V99 COMP-3        01989307
020700                                                    VALUE ZERO.   01989407
020600     05  PV-SFS-AMT                   PIC S9(09)V99 COMP-3        01989507
020700                                                    VALUE ZERO.   01989607
020600     05  PV-SHR-AMT                   PIC S9(09)V99 COMP-3        01989707
020700                                                    VALUE ZERO.   01989807
020600     05  PV-SHS-AMT                   PIC S9(09)V99 COMP-3        01989907
020700                                                    VALUE ZERO.   01990007
020600     05  PV-STM-AMT                   PIC S9(09)V99 COMP-3        01991007
020700                                                    VALUE ZERO.   01992007
020600     05  PV-TAX-AMT                   PIC S9(09)V99 COMP-3        01993007
020700                                                    VALUE ZERO.   01994007
020600     05  PV-TMR-AMT                   PIC S9(09)V99 COMP-3        01995007
020700                                                    VALUE ZERO.   01996007
8446E      05  PV-BPS-AMT                   PIC S9(09)V99 COMP-3        01997007
8446E                                                     VALUE ZERO.   01998007
BOSS       05  PV-BPR-AMT                   PIC S9(09)V99 COMP-3        01999007
BOSS                                                      VALUE ZERO.   02000007
BOSS       05  PV-BOS-AMT                   PIC S9(09)V99 COMP-3        02010007
BOSS                                                      VALUE ZERO.   02020007
BOSS       05  PV-BSR-AMT                   PIC S9(09)V99 COMP-3        02030007
BOSS                                                      VALUE ZERO.   02040007
052914     05  PV-DBS-AMT                   PIC S9(09)V99 COMP-3        02050007
052914                                                    VALUE ZERO.   02060007
PAYVEN     05  PV-PPN-AMT                   PIC S9(09)V99 COMP-3        02061010
PAYVEN                                                    VALUE ZERO.   02062010
PAYVEN     05  PV-VMN-AMT                   PIC S9(09)V99 COMP-3        02063010
PAYVEN                                                    VALUE ZERO.   02064010
020800                                                                  02070007
020900******************************************************************02080007
021000*                       DATE/TIME                                 02090007
021100******************************************************************02100007
021200 01  PV-DATE-AND-TIME-FIELDS.                                     02110007
021300                                                                  02120007
021400     05  PV-POS-CCYY-MM-DD            PIC  X(10)    VALUE SPACE.  02130007
021500     05  FILLER REDEFINES PV-POS-CCYY-MM-DD.                      02140007
021600         10  PV-POS-CCYY              PIC  X(04).                 02150007
021700         10  FILLER                   PIC  X(01).                 02160007
021800         10  PV-POS-MM                PIC  X(02).                 02170007
021900         10  FILLER                   PIC  X(01).                 02180007
022000         10  PV-POS-DD                PIC  X(02).                 02190007
022100                                                                  02200007
022200     05  PV-CURR-DATE-CCYYMMDD.                                   02210007
022300         10  PV-CURR-DATE-CCYY        PIC  9(04).                 02220007
022400         10  PV-CURR-DATE-MM          PIC  9(02).                 02230007
022500         10  PV-CURR-DATE-DD          PIC  9(02).                 02240007
022600                                                                  02250007
022700     05  PV-CURR-TIME.                                            02260007
022800         10  PV-CURR-TIME-HH          PIC  9(02)    VALUE ZERO.   02270007
022900         10  PV-CURR-TIME-MM          PIC  9(02)    VALUE ZERO.   02280007
023000         10  PV-CURR-TIME-SSHH        PIC  9(04)    VALUE ZERO.   02290007
023100                                                                  02300007
023200     05  PV-POS-DATE-FORMATTED        PIC  X(10)    VALUE SPACE.  02310007
023300     05  PV-SLS-DTE-MM-DD-CCYY.                                   02320007
023400         10  PV-SLS-DTE-MM            PIC  X(02)    VALUE SPACE.  02330007
023500         10  FILLER                   PIC  X(01)    VALUE '/'.    02340007
023600         10  PV-SLS-DTE-DD            PIC  X(02)    VALUE SPACE.  02350007
023700         10  FILLER                   PIC  X(01)    VALUE '/'.    02360007
023800         10  PV-SLS-DTE-CCYY          PIC  X(04)    VALUE SPACE.  02370007
023900                                                                  02380007
024000******************************************************************02390007
024100*               SYSTEM TIME AND DATE VARIABLES                    02400007
024200******************************************************************02410007
024300 01  SYS-DATE-TIME.                                               02420007
024400     05  SYS-DATE                     PIC  X(08)    VALUE SPACES. 02430007
024500     05  SYS-TIME                     PIC  X(08)    VALUE SPACES. 02440007
024600                                                                  02450007
024700 01  ST-BEG-TIME.                                                 02460007
024800     05  ST-BEG-HR                    PIC  9(02)    VALUE ZEROS.  02470007
024900     05  FILLER                       PIC  X(01)    VALUE ':'.    02480007
025000     05  ST-BEG-MN                    PIC  9(02)    VALUE ZEROS.  02490007
025100                                                                  02500007
025200 01  ST-END-TIME.                                                 02510007
025300     05  ST-END-HR                    PIC  9(02)    VALUE ZEROS.  02520007
025400     05  FILLER                       PIC  X(01)    VALUE ':'.    02530007
025500     05  ST-END-MN                    PIC  9(02)    VALUE ZEROS.  02540007
025600                                                                  02550007
025700 01  SD-EDIT-DATE.                                                02560007
025800     05  SD-MONTH                     PIC  9(02)    VALUE ZEROS.  02570007
025900     05  FILLER                       PIC  X(01)    VALUE '-'.    02580007
026000     05  SD-DAY                       PIC  9(02)    VALUE ZEROS.  02590007
026100     05  FILLER                       PIC  X(01)    VALUE '-'.    02600007
026200     05  SD-CENT                      PIC  9(02)    VALUE ZEROS.  02610007
026300     05  SD-YEAR                      PIC  9(02)    VALUE ZEROS.  02620007
026400                                                                  02630007
026500******************************************************************02640007
026600*                        ERROR HANDLING                           02650007
026700******************************************************************02660007
026800 01  ABEND-CODE                       PIC S9(04)    VALUE ZEROS   02670007
026900                                                    COMP SYNC.    02680007
027000     88  ABEND-4001-WRITE-ERROR                     VALUE +4001.  02690007
027100     88  ABEND-4002-READ-ERROR                      VALUE +4002.  02700007
027200     88  ABEND-4003-CTRL-CARD-ERROR                 VALUE +4003.  02710007
027300     88  ABEND-4004-TABLE-ERROR                     VALUE +4004.  02720007
027400     88  ABEND-4005-OPEN-ERROR                      VALUE +4005.  02730007
027500     88  ABEND-4006-CLOSE-ERROR                     VALUE +4006.  02740007
027600     88  ABEND-4007-SEQUENCE-ERROR                  VALUE +4007.  02750007
027700     88  ABEND-4008-DATA-ERROR                      VALUE +4008.  02760007
027800     88  ABEND-4009-KEY-DATA-ERROR                  VALUE +4009.  02770007
027900     88  ABEND-4013-DB2-ERROR                       VALUE +4013.  02780007
028000     88  ABEND-4019-CAL-SUB-ERROR                   VALUE +4019.  02790007
028100     88  ABEND-4444-FORCED-ABEND                    VALUE +4444.  02800007
028200                                                                  02810007
028300                                                                  02820007
028400******************************************************************02830007
028500* RECORD LAYOUT FOR INPUT DATE CARD (POS DATE)                    02840007
028600******************************************************************02850007
028700 01  CC-CONTROL-CARD.                                             02860007
028800                                                                  02870007
029500    05  CC-CONTROL-CARD-DISPLAY.                                  02880007
029500        10  CC-POS-DATE         PIC X(10)    VALUE SPACES.        02890007
029500        10  FILLER              PIC X        VALUE SPACE.         02900007
029500        10  CC-STR-NBR          PIC X(04)    VALUE SPACES.        02910007
              10  FILLER REDEFINES CC-STR-NBR.                          02920007
                  15  CC-STR-NBR-N    PIC 9(04).                        02930007
029500        10  FILLER              PIC X(65)    VALUE SPACE.         02940007
029600                                                                  02950007
028700 01  CC-RANGE-CARD.                                               02960007
028800                                                                  02970007
029500    05  CC-RANGE-CARD-DISPLAY.                                    02980007
029500        10  CC-BEGIN-DATE       PIC X(10)    VALUE SPACES.        02990007
029500        10  FILLER              PIC X        VALUE SPACE.         03000007
029500        10  CC-END-DATE         PIC X(10)    VALUE SPACES.        03010007
029500        10  FILLER              PIC X(59)    VALUE SPACE.         03020007
029600                                                                  03030007
029700******************************************************************03040007
029800*  TSAADSU - STORE TOTALS RECORD LAYOUT                           03050007
029900******************************************************************03060007
030000     COPY SARD007.                                                03070007
030100                                                                  03080007
030200******************************************************************03090007
030300*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)             03100007
030400******************************************************************03110007
030500     COPY DPWS500.                                                03120007
030600                                                                  03130007
030700******************************************************************03140007
030800*  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            03150007
030900******************************************************************03160007
031000     COPY DPWS004.                                                03170007
031100                                                                  03180007
031200******************************************************************03190007
031300*  DB2 MESSAGE AREA                                               03200007
031400******************************************************************03210007
031500     COPY SQLCA2.                                                 03220007
031600                                                                  03230007
031700******************************************************************03240007
031800*  DB2 COMMUNICATION AREA.                                        03250007
031900******************************************************************03260007
032000     EXEC SQL                                                     03270007
032100          INCLUDE SQLCA                                           03280007
032200     END-EXEC.                                                    03290007
032300                                                                  03300007
032400******************************************************************03310007
032500*  DB2 TABLE XST_LOC - STORE LOCATION TABLE                       03320007
032600******************************************************************03330007
032700     EXEC SQL                                                     03340007
032800          INCLUDE XST00001                                        03350007
032900     END-EXEC.                                                    03360007
033000                                                                  03370007
033100******************************************************************03380007
033200*  DB2 TABLE TSASUM - TOTALS BY STORE REGISTER TABLE              03390007
033300******************************************************************03400007
033400     EXEC SQL                                                     03410007
033500          INCLUDE TSASUM                                          03420007
033600     END-EXEC.                                                    03430007
033700                                                                  03440007
033800******************************************************************03450007
033900*  DB2 TABLE TEPPART - PARTITION TABLE                            03460007
034000******************************************************************03470007
034100     EXEC SQL                                                     03480007
034200          INCLUDE TEPPART                                         03490007
034300     END-EXEC.                                                    03500007
034400                                                                  03510007
036000                                                                  03520007
036100******************************************************************03530007
036200*  SUM-CURSOR -- CURSOR TO SUM CTG_AMT GROUPED BY THE VARIOUS     03540007
036300*  CATEGORY CODES.                                                03550007
036400******************************************************************03560007
036500     EXEC SQL                                                     03570007
036600       DECLARE SUM-CURSOR CURSOR FOR                              03580007
036700            SELECT  SLS_DTE                                       03590007
036700                   ,SUM(CTG_AMT) AS PV-DB2-SUM                    03600007
036800                   ,SUM_CTG_CDE                                   03610007
036900              FROM  TSASUM  A                                     03620007
036900                 ,  TEPPART B                                     03630007
                       ,  XST_LOC C                                     03640007
037000             WHERE  A.PARTN_NBR = B.PARTN_NBR                     03650007
037000               AND  B.SLS_DTE   = :DK-POS-DATE-ISO                03660007
037100               AND  A.STR_NBR   = :DK-STR-NBR                     03670007
                     AND  C.LOC_NBR   = A.STR_NBR                       03680007
                     AND  C.E_BUS_IND = 'N'                             03690007
                     AND  C.LOC_TYP_CDE = 'DS'                          03700007
037200               AND  SUM_TYP_CDE IN ('D', 'S')                     03710007
052914*              REGISTERS 70-89 ARE USED BY POC                    03720007
052914*              SHIP FROM STORE IS REGISTERS 90 TO 95              03730007
255393               AND  RGST_ID  BETWEEN 90 AND 95                    03740009
037400          GROUP BY  SLS_DTE, SUM_CTG_CDE                          03750007
037400          ORDER BY  SLS_DTE, SUM_CTG_CDE                          03760007
037500           WITH UR                                                03770007
037600     END-EXEC.                                                    03780007
037900                                                                  03790007
038000 PROCEDURE DIVISION.                                              03800007
038100******************************************************************03810007
038200* MAINLINE                                                        03820007
038300******************************************************************03830007
038400 0000-MAINLINE-PARAGRAPH.                                         03840007
038500                                                                  03850007
038600     PERFORM 1000-INITIALIZE-PROGRAM.                             03860007
038700                                                                  03870007
038800     PERFORM 2000-PROCESS-SUM-CTG-CDE                             03880007
038900       UNTIL PS-END-OF-CARD-FILE.                                 03890007
039000                                                                  03900007
039100     PERFORM 9900-END-PROC.                                       03910007
039200                                                                  03920007
039300     STOP RUN.                                                    03930007
039400                                                                  03940007
039500                                                                  03950007
039600******************************************************************03960007
039700* OPEN FILES, PROCESS CONTROL CARD, FORMAT REPORT HEADINGS,       03970007
039800* FIND PARTITION NUMBER, OPEN MASTER-CURSOR                       03980007
039900******************************************************************03990007
040000 1000-INITIALIZE-PROGRAM.                                         04000007
040100                                                                  04010007
040200     OPEN INPUT  POS-DATE-STORE-FILE.                             04020007
040200     OPEN INPUT  POS-DATE-RANGE-FILE.                             04030007
040300     OPEN OUTPUT TSAADSU-FILE.                                    04040007
040400                                                                  04050007
040500     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 04060007
040600                                                                  04070007
040700     MOVE SYS-TIME (1:2) TO ST-BEG-HR.                            04080007
040800     MOVE SYS-TIME (3:2) TO ST-BEG-MN.                            04090007
040900                                                                  04100007
041000     MOVE SYS-DATE (1:2) TO SD-CENT.                              04110007
041100     MOVE SYS-DATE (3:2) TO SD-YEAR.                              04120007
041200     MOVE SYS-DATE (5:2) TO SD-MONTH.                             04130007
041300     MOVE SYS-DATE (7:2) TO SD-DAY.                               04140007
041400                                                                  04150007
041500     PERFORM 1100-PROCESS-CONTROL-CARD.                           04160007
041600                                                                  04170007
042200******************************************************************04180007
042300* READ CONTROL CARD TO GET POS DATE IN MMDDYY FORMAT.  CALL       04190007
042400* DATE ROUTINE TO CONVERT DATE TO A CCYY-MM-DD PROCESS DATE.      04200007
042500******************************************************************04210007
042600 1100-PROCESS-CONTROL-CARD.                                       04220007
042700                                                                  04230007
042800     PERFORM 1120-READ-POS-DATE-RANGE-FILE.                       04240007
043100                                                                  04250007
043200     IF PS-END-OF-RANGE-FILE                                      04260007
043300         MOVE '1100-PROCESS-CONTROL-CARD'  TO PV-PARAGRAPH-NAME   04270007
043400         MOVE 'NO RANGE CARD TO PROCESS' TO PV-OPERATION-MSG-1    04280007
043600         SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                   04290007
043700         PERFORM 9200-ABEND                                       04300007
043800     END-IF.                                                      04310007
046900                                                                  04320007
047000     MOVE CC-BEGIN-DATE                TO PV-DPG52-LK-DATE-INPUT. 04330007
044400     PERFORM 1125-VALIDATE-INPUT-DATE.                            04340007
047000     MOVE CC-END-DATE                  TO PV-DPG52-LK-DATE-INPUT. 04350007
044400     PERFORM 1125-VALIDATE-INPUT-DATE.                            04360007
043900                                                                  04370007
042800     PERFORM 1110-READ-POS-DATE-STORE-FILE.                       04380007
043100                                                                  04390007
043200     IF PS-END-OF-CARD-FILE                                       04400007
043300         MOVE '1100-PROCESS-CONTROL-CARD'  TO PV-PARAGRAPH-NAME   04410007
043400         MOVE 'NO CONTROL CARD TO PROCESS' TO PV-OPERATION-MSG-1  04420007
043600         SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                   04430007
043700         PERFORM 9200-ABEND                                       04440007
043800     END-IF.                                                      04450007
042700                                                                  04460007
044000     DISPLAY '         '.                                         04470007
044100     DISPLAY PC-PGM-NAME.                                         04480007
044600                                                                  04490007
044700******************************************************************04500007
044800* READ DATE CONTROL CARD.                                         04510007
044900******************************************************************04520007
045000 1110-READ-POS-DATE-STORE-FILE.                                   04530007
045100                                                                  04540007
045200     READ POS-DATE-STORE-FILE INTO CC-CONTROL-CARD                04550007
045300       AT END                                                     04560007
045400           SET PS-END-OF-CARD-FILE TO TRUE                        04570007
             NOT AT END                                                 04580007
                 ADD 1 TO PA-CARDFILE-CNT                               04590007
                 IF CC-POS-DATE >= CC-BEGIN-DATE                        04600007
                     AND CC-POS-DATE <= CC-END-DATE                     04610007
047000             MOVE CC-POS-DATE          TO PV-DPG52-LK-DATE-INPUT  04620007
044400             PERFORM 1125-VALIDATE-INPUT-DATE                     04630007
045500             MOVE CC-POS-DATE          TO DK-POS-DATE-ISO         04640007
                                                PV-HOLD-SLSDTE          04650007
045500             MOVE CC-STR-NBR-N         TO DK-STR-NBR              04660007
                                                PV-HOLD-BMSTORE         04670007
044100             DISPLAY                                              04680007
044200            ' - ACCEPTED CONTROL CARD = ' CC-CONTROL-CARD-DISPLAY 04690007
                   SET PS-CARD-ACCEPTED TO TRUE                         04700007
                 ELSE                                                   04710007
                   DISPLAY                                              04720007
                  ' - REJECTED CONTROL CARD = ' CC-CONTROL-CARD-DISPLAY 04730007
                   DISPLAY '   DATE NOT WITHIN DATE RANGE'              04740007
                   SET PS-CARD-NOT-ACCEPTED TO TRUE                     04741007
                 END-IF.                                                04742007
044600                                                                  04743007
044700******************************************************************04744007
044800* READ DATE RANGE CARD.                                           04745007
044900******************************************************************04746007
045000 1120-READ-POS-DATE-RANGE-FILE.                                   04747007
045100                                                                  04748007
045200     READ POS-DATE-RANGE-FILE INTO CC-RANGE-CARD                  04749007
045300        AT END                                                    04750007
045400           SET PS-END-OF-RANGE-FILE TO TRUE.                      04751007
045500                                                                  04752007
045500     MOVE CC-BEGIN-DATE        TO DK-POS-BEGIN-DATE-ISO.          04753007
045500     MOVE CC-END-DATE          TO DK-POS-END-DATE-ISO.            04754007
044100     DISPLAY                                                      04755007
044200      ' - RANGE CARD =  ' CC-RANGE-CARD-DISPLAY.                  04756007
045600                                                                  04757007
045700******************************************************************04758007
045800* CALL KOHLS CALENDAR ROUTINE:                                    04759007
045900*     PASS: CONTROL CARD POS DATE (MMDDYY FORMAT).                04760007
046000*   RETURN: ACTUAL CALENDAR DB2 ISO DATE (CCYY-MM-DD FORMAT).     04770007
046100******************************************************************04780007
046200 1125-VALIDATE-INPUT-DATE.                                        04790007
046300                                                                  04800007
046400     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              04810007
046500                                                                  04820007
046600     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   04830007
046700     SET  DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                   04840007
046800     SET  DPG52-LK-DTE-ISO-FMT         TO TRUE.                   04850007
           MOVE PV-DPG52-LK-DATE-INPUT       TO DPG52-LK-DATE-INPUT.    04860007
047100                                                                  04870007
047200     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    04880007
047300                                             DPG54 DPG55 DPG56.   04890007
047400     EVALUATE TRUE                                                04900007
047500         WHEN DPG54-SEVERE-ERROR                                  04910007
047600         WHEN DPG54-DATE-INVALID                                  04920007
047700             MOVE '1125-VALIDATE-INPUT-DATE'                      04930007
047800                                       TO PV-PARAGRAPH-NAME       04940007
047900             MOVE 'ERROR VALIDATING INPUT CARD DATE'              04950007
048000                                       TO PV-OPERATION-MSG-1      04960007
048100             SET ABEND-4019-CAL-SUB-ERROR                         04970007
048200                                       TO TRUE                    04980007
048300             MOVE DPG54-ERROR-MESSAGE                             04990007
048400                                       TO PV-OPERATION-MSG-2      05000007
048500             PERFORM 9200-ABEND                                   05010007
048600     END-EVALUATE.                                                05020007
049100                                                                  05030007
055500******************************************************************05040007
055600* 2000-PROCESS-SUM-CTG-CDE                                        05050007
055700*     - FETCH BMSTORE-CURSOR                                      05060007
055800*     - OPEN, FETCH & CLOSE SUM-CURSOR                            05070007
055900*     - PROCESS AND COMMIT SUMS/CODES FOR BMSTORES                05080007
056000******************************************************************05090007
056100 2000-PROCESS-SUM-CTG-CDE.                                        05100007
056200                                                                  05110007
           IF PS-CARD-ACCEPTED                                          05120007
056900         PERFORM 3000-OPEN-SUM-CURSOR                             05130007
057000         PERFORM 3100-FETCH-SUM-CURSOR                            05140007
057100           UNTIL PS-END-OF-SUM-CURSOR                             05150007
057200         PERFORM 3200-CLOSE-SUM-CURSOR                            05160007
           END-IF.                                                      05170007
057300                                                                  05180007
057400     PERFORM 4000-MOVE-SUM-CTG-CDE-AMT                            05190007
060000                                                                  05200007
           PERFORM 1110-READ-POS-DATE-STORE-FILE.                       05210007
060100                                                                  05220007
063800                                                                  05230007
063900******************************************************************05240007
064000*  OPEN THE SUM-CURSOR                                            05250007
064100******************************************************************05260007
064200 3000-OPEN-SUM-CURSOR.                                            05270007
064300                                                                  05280007
064400     EXEC SQL                                                     05290007
064500          OPEN SUM-CURSOR                                         05300007
064600     END-EXEC.                                                    05310007
064700                                                                  05320007
064800     EVALUATE TRUE                                                05330007
064900         WHEN SQLCODE = ZERO                                      05340007
065000             CONTINUE                                             05350007
065100                                                                  05360007
065200         WHEN SQLWARN0 NOT EQUAL SPACE                            05370007
065300         WHEN SQLCODE NOT EQUAL ZERO                              05380007
065400             MOVE SQLCODE TO PV-SQL                               05390007
065500                                                                  05400007
065600             MOVE '3000-OPEN-SUM-CURSOR' TO PV-PARAGRAPH-NAME     05410007
065700             MOVE 'TSASUM'               TO PV-DB2-TABLE-NAME     05420007
065800                                                                  05430007
065900             STRING 'ERROR ON OPEN OF SUM-CURSOR - SQLCODE = '    05440007
066000                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG05450007
066100             END-STRING                                           05460007
066200                                                                  05470007
066300             SET ABEND-4005-OPEN-ERROR TO TRUE                    05480007
066400             PERFORM 9100-SQL-ABEND                               05490007
066500     END-EVALUATE.                                                05500007
066600                                                                  05510007
066700                                                                  05520007
066800******************************************************************05530007
066900*  FETCH THE SUM CURSOR.                                          05540007
067000******************************************************************05550007
067100 3100-FETCH-SUM-CURSOR.                                           05560007
067200                                                                  05570007
067300     EXEC SQL                                                     05580007
067400          FETCH SUM-CURSOR                                        05590007
067500           INTO :PV-SLSDTE                                        05600007
067500               ,:PV-DB2-SUM                                       05610007
067600               ,:SASUM-SUM-CTG-CDE                                05620007
067700     END-EXEC.                                                    05630007
067800                                                                  05640007
067900     EVALUATE TRUE                                                05650007
068000         WHEN SQLCODE = ZERO                                      05660007
068100             ADD 1 TO PA-SUM-CURSOR-CNT                           05670007
068200                                                                  05680007
068300         WHEN SQLCODE = PC-ROW-NOT-FOUND                          05690007
068400             SET PS-END-OF-SUM-CURSOR  TO TRUE                    05700007
068500                                                                  05710007
068600         WHEN SQLWARN0 NOT EQUAL SPACE                            05720007
068700         WHEN SQLCODE NOT EQUAL ZERO                              05730007
068800             MOVE SQLCODE TO PV-SQL                               05740007
068900                                                                  05750007
069100             MOVE PV-HOLD-BMSTORE   TO PV-ABEND-STR-NBR           05760007
069200             MOVE SASUM-SUM-CTG-CDE TO PV-ABEND-SUM-CTG-CDE       05770007
069300                                                                  05780007
069400             MOVE '3100-FETCH-SUM-CURSOR' TO PV-PARAGRAPH-NAME    05790007
069500             MOVE 'TSASUM'                TO PV-DB2-TABLE-NAME    05800007
069600                                                                  05810007
069700             STRING 'ERROR ON FETCH OF SUM-CURSOR - SQLCODE = '   05820007
069800                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG05830007
069900             END-STRING                                           05840007
070000                                                                  05850007
070100             SET ABEND-4002-READ-ERROR TO TRUE                    05860007
070200             PERFORM 9100-SQL-ABEND                               05870007
070300     END-EVALUATE.                                                05880007
070400                                                                  05890007
070500                                                                  05900007
070600     IF SQLCODE = ZERO                                            05910007
070600         IF PV-SLSDTE NOT EQUAL PV-HOLD-SLSDTE                    05920007
070600             PERFORM 4000-MOVE-SUM-CTG-CDE-AMT                    05930007
070700             MOVE PV-SLSDTE     TO PV-HOLD-SLSDTE                 05940007
070600         END-IF                                                   05950007
070800                                                                  05960007
070700         MOVE SASUM-SUM-CTG-CDE TO PC-SUM-CTG-CDE                 05970007
070900         PERFORM 3150-EVALUATE-SUM-CTG-CDE                        05980007
071000     END-IF.                                                      05990007
071100                                                                  06000007
071200                                                                  06010007
071300******************************************************************06020007
071400* EVALUATE THE DIFFERENT SUM-CTG-CDE AND PROCESS ACCORDINGLY      06030007
071500******************************************************************06040007
071600 3150-EVALUATE-SUM-CTG-CDE.                                       06050007
071700                                                                  06060007
071700     EVALUATE TRUE                                                06070007
071700         WHEN PC-SUM-CTG-CDE-BCS                                  06080007
071700         WHEN PC-SUM-CTG-CDE-BCR                                  06090007
071700             ADD PV-DB2-SUM            TO PV-BCN-AMT              06100007
071700                                                                  06110007
071700         WHEN PC-SUM-CTG-CDE-NCS                                  06120007
071700         WHEN PC-SUM-CTG-CDE-NCR                                  06130007
071700             ADD PV-DB2-SUM            TO PV-NCN-AMT              06140007
071700                                                                  06150007
071700         WHEN PC-SUM-CTG-CDE-AXS                                  06160007
071700         WHEN PC-SUM-CTG-CDE-AXR                                  06170007
071700             ADD PV-DB2-SUM            TO PV-AEN-AMT              06180007
071700                                                                  06190007
071700         WHEN PC-SUM-CTG-CDE-KCS                                  06200007
071700         WHEN PC-SUM-CTG-CDE-KCR                                  06210007
071700             ADD PV-DB2-SUM            TO PV-KCN-AMT              06220007
071700                                                                  06230007
071700         WHEN PC-SUM-CTG-CDE-SAL                                  06240007
071700             ADD PV-DB2-SUM            TO PV-STM-AMT              06250007
071700                                                                  06260007
071700         WHEN PC-SUM-CTG-CDE-TAX                                  06270007
071700             SUBTRACT PV-DB2-SUM     FROM PV-STM-AMT              06280007
071700             MOVE PV-DB2-SUM           TO PV-TAX-AMT              06290007
071700                                                                  06300007
071700         WHEN PC-SUM-CTG-CDE-GDS                                  06310007
071700             SUBTRACT PV-DB2-SUM     FROM PV-STM-AMT              06320007
071700             MOVE PV-DB2-SUM           TO PV-GDS-AMT              06330007
071700                                                                  06340007
071700         WHEN PC-SUM-CTG-CDE-GTS                                  06350007
071700             SUBTRACT PV-DB2-SUM     FROM PV-STM-AMT              06360007
071700             MOVE PV-DB2-SUM           TO PV-GTS-AMT              06370007
071700                                                                  06380007
071700         WHEN PC-SUM-CTG-CDE-KMT                                  06390007
071700             MOVE PV-DB2-SUM           TO PV-KMT-AMT              06400007
071700                                                                  06410007
071700         WHEN PC-SUM-CTG-CDE-POS                                  06420007
071700             MOVE PV-DB2-SUM           TO PV-POS-AMT              06430007
071700                                                                  06440007
071700         WHEN PC-SUM-CTG-CDE-GTT                                  06450007
071700             MOVE PV-DB2-SUM           TO PV-GTT-AMT              06460007
071700                                                                  06470007
071700         WHEN PC-SUM-CTG-CDE-GDT                                  06480007
071700             MOVE PV-DB2-SUM           TO PV-GDT-AMT              06490007
071700                                                                  06500007
071700         WHEN PC-SUM-CTG-CDE-CRI                                  06510007
071700             MOVE PV-DB2-SUM           TO PV-CRI-AMT              06520007
071700                                                                  06530007
071700         WHEN PC-SUM-CTG-CDE-KMI                                  06540007
071700             MOVE PV-DB2-SUM           TO PV-KMI-AMT              06550007
071700                                                                  06560007
071700         WHEN PC-SUM-CTG-CDE-POR                                  06570007
071700             MOVE PV-DB2-SUM           TO PV-POR-AMT              06580007
071700                                                                  06590007
071700         WHEN PC-SUM-CTG-CDE-KCP                                  06600007
071700             MOVE PV-DB2-SUM           TO PV-KCP-AMT              06610007
071700                                                                  06620007
071700         WHEN PC-SUM-CTG-CDE-NSF                                  06630007
071700             MOVE PV-DB2-SUM           TO PV-NSF-AMT              06640007
071700                                                                  06650007
071700         WHEN PC-SUM-CTG-CDE-ECR                                  06660007
071700             MOVE PV-DB2-SUM           TO PV-ECR-AMT              06670007
071700                                                                  06680007
071700         WHEN PC-SUM-CTG-CDE-RET                                  06690007
071700             MOVE PV-DB2-SUM           TO PV-TMR-AMT              06700007
071700                                                                  06710007
071700         WHEN PC-SUM-CTG-CDE-SHS                                  06720007
071700             MOVE PV-DB2-SUM           TO PV-SHS-AMT              06730007
071700                                                                  06740007
071700         WHEN PC-SUM-CTG-CDE-SHR                                  06750007
071700             MOVE PV-DB2-SUM           TO PV-SHR-AMT              06760007
071700                                                                  06770007
071700         WHEN PC-SUM-CTG-CDE-GWS                                  06780007
071700             MOVE PV-DB2-SUM           TO PV-GWS-AMT              06790007
071700                                                                  06800007
071700         WHEN PC-SUM-CTG-CDE-GWR                                  06810007
071700             MOVE PV-DB2-SUM           TO PV-GWR-AMT              06820007
071800                                                                  06830007
079200         WHEN PC-SUM-CTG-CDE-SFS                                  06840007
079300             MOVE PV-DB2-SUM           TO PV-SFS-AMT              06850007
8446E                                                                   06860007
8446E          WHEN PC-SUM-CTG-CDE-BPS                                  06870007
8446E              MOVE PV-DB2-SUM           TO PV-BPS-AMT              06880007
BOSS                                                                    06890007
BOSS           WHEN PC-SUM-CTG-CDE-BPR                                  06900007
BOSS               MOVE PV-DB2-SUM           TO PV-BOS-AMT              06910007
BOSS                                                                    06920007
BOSS           WHEN PC-SUM-CTG-CDE-BOS                                  06930007
BOSS               MOVE PV-DB2-SUM           TO PV-BOS-AMT              06940007
BOSS                                                                    06950007
BOSS           WHEN PC-SUM-CTG-CDE-BSR                                  06960007
BOSS               MOVE PV-DB2-SUM           TO PV-BOS-AMT              06970007
052914                                                                  06980007
052914         WHEN PC-SUM-CTG-CDE-DBS                                  06990007
052914             MOVE PV-DB2-SUM           TO PV-DBS-AMT              07000007
PAYVEN                                                                  07001010
PAYVEN         WHEN PC-SUM-CTG-CDE-PPS                                  07002010
PAYVEN         WHEN PC-SUM-CTG-CDE-PPR                                  07003010
PAYVEN             ADD PV-DB2-SUM            TO PV-PPN-AMT              07004010
PAYVEN                                                                  07005010
PAYVEN         WHEN PC-SUM-CTG-CDE-VMS                                  07006010
PAYVEN         WHEN PC-SUM-CTG-CDE-VMR                                  07007010
PAYVEN             ADD PV-DB2-SUM            TO PV-VMN-AMT              07008010
PAYVEN                                                                  07009010
079400     END-EVALUATE.                                                07010007
079500                                                                  07020007
079600                                                                  07030007
079700******************************************************************07040007
079800*  CLOSE THE SUM CURSOR.                                          07050007
079900******************************************************************07060007
080000 3200-CLOSE-SUM-CURSOR.                                           07070007
080100                                                                  07080007
080200     EXEC SQL                                                     07090007
080300          CLOSE SUM-CURSOR                                        07100007
080400     END-EXEC.                                                    07110007
080500                                                                  07120007
080600     EVALUATE TRUE                                                07130007
080700         WHEN SQLCODE = ZERO                                      07140007
080800              CONTINUE                                            07150007
080900                                                                  07160007
081000         WHEN SQLWARN0 NOT EQUAL SPACE                            07170007
081100         WHEN SQLCODE NOT EQUAL ZERO                              07180007
081200             MOVE SQLCODE TO PV-SQL                               07190007
081300                                                                  07200007
081400             MOVE '3200-CLOSE-SUM-CURSOR' TO PV-PARAGRAPH-NAME    07210007
081500             MOVE 'TSASUM'                TO PV-DB2-TABLE-NAME    07220007
081600                                                                  07230007
081700             STRING 'ERROR ON CLOSE OF SUM-CURSOR - SQLCODE = '   07240007
081800                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION-MSG07250007
081900             END-STRING                                           07260007
082000                                                                  07270007
082100             SET ABEND-4006-CLOSE-ERROR TO TRUE                   07280007
082200             PERFORM 9100-SQL-ABEND                               07290007
082300     END-EVALUATE.                                                07300007
082400                                                                  07310007
082500                                                                  07320007
082600******************************************************************07330007
082700*  MOVE AMOUNTS AND CATEGORIES IN PREPARATION FOR INSERTION       07340007
082800*  INTO TSAADSU TABLE.  ALL CATEGORIES WILL BE INSERTED INTO      07350007
082900*  THE TABLE, REGARDLESS IF THE TOTAL AMOUNT = ZERO.              07360007
083000******************************************************************07370007
083100 4000-MOVE-SUM-CTG-CDE-AMT.                                       07380007
083200                                                                  07390007
083300     MOVE PV-HOLD-SLSDTE               TO SA007-SLS-DTE.          07400007
083400     MOVE PV-HOLD-BMSTORE              TO SA007-STR-NBR.          07410007
083500     MOVE 'N'                          TO SA007-ADJ-IND.          07420007
083600                                                                  07430007
091700     IF PV-AEN-AMT NOT EQUAL 0                                    07440007
091900         MOVE PV-AEN-AMT               TO SA007-ORIG-AMT          07450007
091900                                          SA007-ADJ-AMT           07460007
091900         MOVE 'AEN'                    TO SA007-SUM-CTG-CDE       07470007
091900         PERFORM 4100-WRITE-TSAADSU                               07480007
091800     END-IF.                                                      07490007
091900                                                                  07500007
091700     IF PV-BCN-AMT NOT EQUAL 0                                    07510007
091900         MOVE PV-BCN-AMT               TO SA007-ORIG-AMT          07520007
091900                                          SA007-ADJ-AMT           07530007
091900         MOVE 'BCN'                    TO SA007-SUM-CTG-CDE       07540007
091900         PERFORM 4100-WRITE-TSAADSU                               07550007
091800     END-IF.                                                      07560007
091900                                                                  07570007
091700     IF PV-CRI-AMT NOT EQUAL 0                                    07580007
091900         MOVE PV-CRI-AMT               TO SA007-ORIG-AMT          07590007
091900                                          SA007-ADJ-AMT           07600007
091900         MOVE 'CRI'                    TO SA007-SUM-CTG-CDE       07610007
091900         PERFORM 4100-WRITE-TSAADSU                               07620007
091800     END-IF.                                                      07630007
091900                                                                  07640007
091700     IF PV-ECR-AMT NOT EQUAL 0                                    07650007
091900         MOVE PV-ECR-AMT               TO SA007-ORIG-AMT          07660007
091900                                          SA007-ADJ-AMT           07670007
091900         MOVE 'ECR'                    TO SA007-SUM-CTG-CDE       07680007
091900         PERFORM 4100-WRITE-TSAADSU                               07690007
091800     END-IF.                                                      07700007
091900                                                                  07710007
091700     IF PV-GDS-AMT NOT EQUAL 0                                    07711007
091800         MOVE PV-GDS-AMT               TO SA007-ORIG-AMT          07711107
091900                                          SA007-ADJ-AMT           07711207
092000         MOVE 'GDS'                    TO SA007-SUM-CTG-CDE       07711307
091700         PERFORM 4100-WRITE-TSAADSU                               07711407
091800     END-IF.                                                      07711507
091800                                                                  07711607
091700     IF PV-GDT-AMT NOT EQUAL 0                                    07711707
091800         MOVE PV-GDT-AMT               TO SA007-ORIG-AMT          07711807
091900                                          SA007-ADJ-AMT           07711907
092000         MOVE 'GDT'                    TO SA007-SUM-CTG-CDE       07712007
091700         PERFORM 4100-WRITE-TSAADSU                               07712107
091800     END-IF.                                                      07712207
091800                                                                  07712307
091700     IF PV-GTS-AMT NOT EQUAL 0                                    07712407
091900         MOVE PV-GTS-AMT               TO SA007-ORIG-AMT          07712507
092000                                          SA007-ADJ-AMT           07712607
091700         MOVE 'GTS'                    TO SA007-SUM-CTG-CDE       07712707
091800         PERFORM 4100-WRITE-TSAADSU                               07712807
091800     END-IF.                                                      07712907
091900                                                                  07713007
091700     IF PV-GTT-AMT NOT EQUAL 0                                    07713107
091900         MOVE PV-GTT-AMT               TO SA007-ORIG-AMT          07713207
091900                                          SA007-ADJ-AMT           07713307
091900         MOVE 'GTT'                    TO SA007-SUM-CTG-CDE       07713407
091900         PERFORM 4100-WRITE-TSAADSU                               07713507
091800     END-IF.                                                      07713607
091900                                                                  07713707
091700     IF PV-GWR-AMT NOT EQUAL 0                                    07713807
091900         MOVE PV-GWR-AMT               TO SA007-ORIG-AMT          07713907
091900                                          SA007-ADJ-AMT           07714007
091900         MOVE 'GWR'                    TO SA007-SUM-CTG-CDE       07714107
091900         PERFORM 4100-WRITE-TSAADSU                               07714207
091800     END-IF.                                                      07714307
091900                                                                  07714407
091700     IF PV-GWS-AMT NOT EQUAL 0                                    07714507
091900         MOVE PV-GWS-AMT               TO SA007-ORIG-AMT          07714607
091900                                          SA007-ADJ-AMT           07714707
091900         MOVE 'GWS'                    TO SA007-SUM-CTG-CDE       07714807
091900         PERFORM 4100-WRITE-TSAADSU                               07714907
091800     END-IF.                                                      07715007
091900                                                                  07715107
091700     IF PV-KCN-AMT NOT EQUAL 0                                    07715207
091900         MOVE PV-KCN-AMT               TO SA007-ORIG-AMT          07715307
091900                                          SA007-ADJ-AMT           07715407
091900         MOVE 'KCN'                    TO SA007-SUM-CTG-CDE       07715507
091900         PERFORM 4100-WRITE-TSAADSU                               07715607
091800     END-IF.                                                      07715707
091900                                                                  07715807
091700     IF PV-KCP-AMT NOT EQUAL 0                                    07715907
091900         MOVE PV-KCP-AMT               TO SA007-ORIG-AMT          07716007
091900                                          SA007-ADJ-AMT           07716107
091900         MOVE 'KCP'                    TO SA007-SUM-CTG-CDE       07716207
091900         PERFORM 4100-WRITE-TSAADSU                               07716307
091800     END-IF.                                                      07716407
091900                                                                  07716507
091700     IF PV-KMI-AMT NOT EQUAL 0                                    07716607
091900         MOVE PV-KMI-AMT               TO SA007-ORIG-AMT          07716707
091900                                          SA007-ADJ-AMT           07716807
091900         MOVE 'KMI'                    TO SA007-SUM-CTG-CDE       07716907
091900         PERFORM 4100-WRITE-TSAADSU                               07717007
091800     END-IF.                                                      07717107
091900                                                                  07717207
091700     IF PV-KMT-AMT NOT EQUAL 0                                    07717307
091900         MOVE PV-KMT-AMT               TO SA007-ORIG-AMT          07717407
091900                                          SA007-ADJ-AMT           07717507
091900         MOVE 'KMT'                    TO SA007-SUM-CTG-CDE       07717607
091900         PERFORM 4100-WRITE-TSAADSU                               07717707
091800     END-IF.                                                      07717807
091900                                                                  07717907
091700     IF PV-NCN-AMT NOT EQUAL 0                                    07718007
091900         MOVE PV-NCN-AMT               TO SA007-ORIG-AMT          07718107
091900                                          SA007-ADJ-AMT           07718207
091900         MOVE 'NCN'                    TO SA007-SUM-CTG-CDE       07718307
091900         PERFORM 4100-WRITE-TSAADSU                               07718407
091800     END-IF.                                                      07718507
091900                                                                  07718607
091700     IF PV-NSF-AMT NOT EQUAL 0                                    07718707
091900         MOVE PV-NSF-AMT               TO SA007-ORIG-AMT          07718807
091900                                          SA007-ADJ-AMT           07718907
091900         MOVE 'NSF'                    TO SA007-SUM-CTG-CDE       07719007
091900         PERFORM 4100-WRITE-TSAADSU                               07719107
091800     END-IF.                                                      07719207
091900                                                                  07719307
091700     IF PV-POR-AMT NOT EQUAL 0                                    07719407
091900         MOVE PV-POR-AMT               TO SA007-ORIG-AMT          07719507
091900                                          SA007-ADJ-AMT           07719607
091900         MOVE 'POR'                    TO SA007-SUM-CTG-CDE       07719707
091900         PERFORM 4100-WRITE-TSAADSU                               07719807
091800     END-IF.                                                      07719907
091900                                                                  07720007
091700     IF PV-POS-AMT NOT EQUAL 0                                    07720107
091900         MOVE PV-POS-AMT               TO SA007-ORIG-AMT          07720207
091900                                          SA007-ADJ-AMT           07720307
091900         MOVE 'POS'                    TO SA007-SUM-CTG-CDE       07720407
091900         PERFORM 4100-WRITE-TSAADSU                               07720507
091800     END-IF.                                                      07720607
091900                                                                  07720707
091700     IF PV-SFS-AMT NOT EQUAL 0                                    07720807
091700         MOVE PV-SFS-AMT               TO SA007-ORIG-AMT          07720907
091800                                          SA007-ADJ-AMT           07721007
091900         MOVE 'SFS'                    TO SA007-SUM-CTG-CDE       07721107
092000         PERFORM 4100-WRITE-TSAADSU                               07721207
057500         ADD PV-SFS-AMT                TO PV-SFS-TOTAL            07721307
091800     END-IF.                                                      07721407
091900                                                                  07721507
8446E      IF PV-BPS-AMT NOT EQUAL 0                                    07721607
8446E          MOVE PV-BPS-AMT               TO SA007-ORIG-AMT          07721707
8446E                                           SA007-ADJ-AMT           07721807
8446E          MOVE 'BPS'                    TO SA007-SUM-CTG-CDE       07721907
8446E          PERFORM 4100-WRITE-TSAADSU                               07722007
8446E          ADD PV-BPS-AMT                TO PV-BPS-TOTAL            07722107
8446E      END-IF.                                                      07722207
8446E                                                                   07722307
BOSS       IF PV-BPR-AMT NOT EQUAL 0                                    07722407
BOSS           MOVE PV-BPR-AMT               TO SA007-ORIG-AMT          07722507
BOSS                                            SA007-ADJ-AMT           07722607
BOSS           MOVE 'BPR'                    TO SA007-SUM-CTG-CDE       07722707
BOSS           PERFORM 4100-WRITE-TSAADSU                               07722807
BOSS           ADD PV-BPR-AMT                TO PV-BPR-TOTAL            07722907
BOSS       END-IF.                                                      07723007
BOSS                                                                    07723107
BOSS       IF PV-BOS-AMT NOT EQUAL 0                                    07723207
BOSS           MOVE PV-BOS-AMT               TO SA007-ORIG-AMT          07723307
BOSS                                            SA007-ADJ-AMT           07723407
BOSS           MOVE 'BOS'                    TO SA007-SUM-CTG-CDE       07723507
BOSS           PERFORM 4100-WRITE-TSAADSU                               07723607
BOSS           ADD PV-BOS-AMT                TO PV-BOS-TOTAL            07723707
BOSS       END-IF.                                                      07723807
BOSS                                                                    07723907
BOSS                                                                    07724007
BOSS       IF PV-BSR-AMT NOT EQUAL 0                                    07724107
BOSS           MOVE PV-BSR-AMT               TO SA007-ORIG-AMT          07724207
BOSS                                            SA007-ADJ-AMT           07724307
BOSS           MOVE 'BSR'                    TO SA007-SUM-CTG-CDE       07724407
BOSS           PERFORM 4100-WRITE-TSAADSU                               07724507
BOSS           ADD PV-BSR-AMT                TO PV-BSR-TOTAL            07724607
BOSS       END-IF.                                                      07724707
BOSS                                                                    07724807
052914     IF PV-DBS-AMT NOT EQUAL 0                                    07724907
052914         MOVE PV-DBS-AMT               TO SA007-ORIG-AMT          07725007
052914                                          SA007-ADJ-AMT           07725107
052914         MOVE 'DBS'                    TO SA007-SUM-CTG-CDE       07725207
052914         PERFORM 4100-WRITE-TSAADSU                               07725307
052914     END-IF.                                                      07725407
052914                                                                  07725507
091700     IF PV-SHR-AMT NOT EQUAL 0                                    07725607
091900         MOVE PV-SHR-AMT               TO SA007-ORIG-AMT          07725707
091900                                          SA007-ADJ-AMT           07725807
091900         MOVE 'SHR'                    TO SA007-SUM-CTG-CDE       07725907
091900         PERFORM 4100-WRITE-TSAADSU                               07726007
091800     END-IF.                                                      07726107
091900                                                                  07726207
091700     IF PV-SHS-AMT NOT EQUAL 0                                    07726307
091900         MOVE PV-SHS-AMT               TO SA007-ORIG-AMT          07726407
091900                                          SA007-ADJ-AMT           07726507
091900         MOVE 'SHS'                    TO SA007-SUM-CTG-CDE       07726607
091900         PERFORM 4100-WRITE-TSAADSU                               07726707
091800     END-IF.                                                      07726807
091900                                                                  07726907
091700     IF PV-STM-AMT NOT EQUAL 0                                    07727007
091900         MOVE PV-STM-AMT               TO SA007-ORIG-AMT          07727107
091900                                          SA007-ADJ-AMT           07727207
091900         MOVE 'STM'                    TO SA007-SUM-CTG-CDE       07727307
091900         PERFORM 4100-WRITE-TSAADSU                               07727407
057500         ADD PV-STM-AMT                TO PV-STM-TOTAL            07727507
091800     END-IF.                                                      07727607
091900                                                                  07727707
091700     IF PV-TAX-AMT NOT EQUAL 0                                    07727807
091700         MOVE PV-TAX-AMT               TO SA007-ORIG-AMT          07727907
091800                                          SA007-ADJ-AMT           07728007
091900         MOVE 'TAX'                    TO SA007-SUM-CTG-CDE       07729007
092000         PERFORM 4100-WRITE-TSAADSU                               07730007
091800     END-IF.                                                      07740007
083600                                                                  07750007
091700     IF PV-TMR-AMT NOT EQUAL 0                                    07760007
091900         MOVE PV-TMR-AMT               TO SA007-ORIG-AMT          07770007
091900                                          SA007-ADJ-AMT           07780007
091900         MOVE 'TMR'                    TO SA007-SUM-CTG-CDE       07790007
091900         PERFORM 4100-WRITE-TSAADSU                               07800007
091800     END-IF.                                                      07810007
PAYVEN                                                                  07821010
PAYVEN     IF PV-PPN-AMT NOT EQUAL 0                                    07822010
PAYVEN         MOVE PV-PPN-AMT               TO SA007-ORIG-AMT          07823010
PAYVEN                                          SA007-ADJ-AMT           07824010
PAYVEN         MOVE 'PPN'                    TO SA007-SUM-CTG-CDE       07825010
PAYVEN     PERFORM 4100-WRITE-TSAADSU.                                  07826010
PAYVEN                                                                  07827010
PAYVEN     IF PV-VMN-AMT NOT EQUAL 0                                    07828010
PAYVEN         MOVE PV-VMN-AMT               TO SA007-ORIG-AMT          07829010
PAYVEN                                          SA007-ADJ-AMT           07829110
PAYVEN         MOVE 'VMN'                    TO SA007-SUM-CTG-CDE       07829210
PAYVEN     PERFORM 4100-WRITE-TSAADSU.                                  07829310
PAYVEN                                                                  07829410
057500     INITIALIZE PV-AEN-AMT                                        07830007
057500                PV-BCN-AMT                                        07840007
057500                PV-CRI-AMT                                        07850007
057500                PV-ECR-AMT                                        07860007
057500                PV-GDS-AMT                                        07870007
057500                PV-GDT-AMT                                        07880007
057500                PV-GTS-AMT                                        07890007
057500                PV-GTT-AMT                                        07900007
057500                PV-GWR-AMT                                        07910007
057500                PV-GWS-AMT                                        07920007
057500                PV-KCN-AMT                                        07930007
057500                PV-KCP-AMT                                        07940007
057500                PV-KMI-AMT                                        07950007
057500                PV-KMT-AMT                                        07960007
057500                PV-NCN-AMT                                        07970007
057500                PV-NSF-AMT                                        07980007
057500                PV-POR-AMT                                        07990007
057500                PV-POS-AMT                                        08000007
059800                PV-SFS-AMT                                        08010007
052914                PV-DBS-AMT                                        08020007
8446E                 PV-BPS-AMT                                        08030007
BOSS                  PV-BPR-AMT                                        08040007
BOSS                  PV-BOS-AMT                                        08050007
BOSS                  PV-BSR-AMT                                        08060007
057500                PV-SHR-AMT                                        08070007
057500                PV-SHS-AMT                                        08080007
057500                PV-STM-AMT                                        08090007
057500                PV-TAX-AMT                                        08100007
057500                PV-TMR-AMT                                        08110010
PAYVEN                PV-PPN-AMT                                        08111010
PAYVEN                PV-VMN-AMT.                                       08112010
097400                                                                  08120007
097500******************************************************************08130007
097600* WRITE THE TSAADSU RECORDS                                       08140007
097700******************************************************************08150007
097800 4100-WRITE-TSAADSU.                                              08160007
097900                                                                  08170007
098000     WRITE TSAADSU-REC FROM SA007-TSAADSU-REC.                    08180007
098100                                                                  08190007
098200     ADD 1 TO PA-TSAADSU-WRITTEN.                                 08200007
098300                                                                  08210007
098400                                                                  08220007
098500******************************************************************08230007
098600* ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.    08240007
098700******************************************************************08250007
098800 9100-SQL-ABEND.                                                  08260007
098900                                                                  08270007
099000     MOVE SQLCODE    TO SQLCODE2.                                 08280007
099100     MOVE SQLERRD(3) TO SQLERRD3.                                 08290007
099200                                                                  08300007
099300     DISPLAY '** ABEND           ** = SQLABEND'.                  08310007
099400     DISPLAY '** PROGRAM         ** = ' PC-PGM-NAME.              08320007
099500     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        08330007
099600     DISPLAY '** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME.        08340007
099700     DISPLAY '** OPERATION       ** = ' PV-DB2-OPERATION-MSG.     08350007
099800     DISPLAY '** PARTN NBR       ** = ' PV-ABEND-PARTN-NBR.       08360007
099900     DISPLAY '** STORE NBR       ** = ' PV-ABEND-STR-NBR.         08370007
100000     DISPLAY '** CTG CODE        ** = ' PV-ABEND-SUM-CTG-CDE.     08380007
100100     DISPLAY '** SQLCODE         ** = ' SQLCODE2.                 08390007
100200     DISPLAY '** ROWS PROCESSED  ** = ' SQLERRD3.                 08400007
100300     DISPLAY '** SQLERRM         ** = ' SQLERRM.                  08410007
100400     DISPLAY '** SQLERRMC        ** = ' SQLERRMC.                 08420007
100500                                                                  08430007
100600******************************************************************08440007
100700*  THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   08450007
100800*  MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        08460007
100900* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     08470007
101000*  FORMAT.                                                        08480007
101100******************************************************************08490007
101200                                                                  08500007
101300     COPY DPPD004.                                                08510007
101400                                                                  08520007
101500     CALL 'ILBOABN0' USING ABEND-CODE.                            08530007
101600                                                                  08540007
101700                                                                  08550007
101800******************************************************************08560007
101900*  ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                     08570007
102000******************************************************************08580007
102100 9200-ABEND.                                                      08590007
102200                                                                  08600007
102300     PERFORM 9900-END-PROC.                                       08610007
102400                                                                  08620007
102500     DISPLAY '** ABEND           **'.                             08630007
102600     DISPLAY '** PROGRAM         ** = ' PC-PGM-NAME.              08640007
102700     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        08650007
102800     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       08660007
102900     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       08670007
103000                                                                  08680007
103100     CALL 'ILBOABN0' USING ABEND-CODE.                            08690007
103200                                                                  08700007
103300                                                                  08710007
103400******************************************************************08720007
103500* PREFORMS TASK TERMINATION PROCESSING                            08730007
103600******************************************************************08740007
103700 9900-END-PROC.                                                   08750007
                                                                        08760007
           CLOSE POS-DATE-STORE-FILE.                                   08770007
103800                                                                  08780007
           CLOSE POS-DATE-RANGE-FILE.                                   08790007
103800                                                                  08800007
103900     CLOSE TSAADSU-FILE.                                          08810007
104000                                                                  08820007
104300     PERFORM 9999-CONTROLS.                                       08830007
104400                                                                  08840007
107500******************************************************************08850007
107600* DISPLAY CONTROLS FROM THE PROGRAM                               08860007
107700******************************************************************08870007
107800 9999-CONTROLS.                                                   08880007
107900                                                                  08890007
108000     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 08900007
108100                                                                  08910007
108200     MOVE SYS-TIME (1:2) TO ST-END-HR.                            08920007
108300     MOVE SYS-TIME (3:2) TO ST-END-MN.                            08930007
108400                                                                  08940007
108500     DISPLAY '                    '.                              08950007
108600     DISPLAY '**********************'.                            08960007
108700     DISPLAY '   SAKUT116 CONTROLS  '.                            08970007
108800     DISPLAY '**********************'.                            08980007
108900     DISPLAY 'RUN DATE  = ' SD-EDIT-DATE.                         08990007
109000     DISPLAY 'BEG TIME  = ' ST-BEG-TIME.                          09000007
109100     DISPLAY 'END TIME  = ' ST-END-TIME.                          09010007
109200     DISPLAY '======================'.                            09020007
109300     DISPLAY 'POS DATE STORE ROWS FETCHED = '                     09030007
109400                                PA-CARDFILE-CNT.                  09040007
109500     DISPLAY 'SUM CURSOR ROWS FETCHED    = '                      09050007
109600                                PA-SUM-CURSOR-CNT.                09060007
109700     DISPLAY '                    '.                              09070007
109800     DISPLAY 'TSAADSU WRITTEN = ' PA-TSAADSU-WRITTEN.             09080007
109900     DISPLAY '                    '.                              09090007
110000                                                                  09100007
057500     MOVE PV-STM-TOTAL     TO PV-DISPLAY-STM-TOTAL.               09110007
057500     MOVE PV-SFS-TOTAL     TO PV-DISPLAY-SFS-TOTAL.               09120007
8446E      MOVE PV-BPS-TOTAL     TO PV-DISPLAY-BPS-TOTAL.               09130007
BOSS       MOVE PV-BPR-TOTAL     TO PV-DISPLAY-BPR-TOTAL.               09140007
BOSS       MOVE PV-BOS-TOTAL     TO PV-DISPLAY-BOS-TOTAL.               09150007
BOSS       MOVE PV-BSR-TOTAL     TO PV-DISPLAY-BSR-TOTAL.               09160007
057500     DISPLAY 'PV-STM-TOTAL = ' PV-DISPLAY-STM-TOTAL.              09170007
057500     DISPLAY 'PV-SFS-TOTAL = ' PV-DISPLAY-SFS-TOTAL.              09180007
8446E      DISPLAY 'PV-BPS-TOTAL = ' PV-DISPLAY-BPS-TOTAL.              09190007
BOSS       DISPLAY 'PV-BPR-TOTAL = ' PV-DISPLAY-BPR-TOTAL.              09200007
BOSS       DISPLAY 'PV-BOS-TOTAL = ' PV-DISPLAY-BOS-TOTAL.              09210007
BOSS       DISPLAY 'PV-BSR-TOTAL = ' PV-DISPLAY-BSR-TOTAL.              09220007
110100                                                                  09230007
