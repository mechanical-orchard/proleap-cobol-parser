000100 IDENTIFICATION DIVISION.                                         00010005
000200                                                                  00020005
000300 PROGRAM-ID.             TCKUT028.                                00030005
000400 AUTHOR.                 COGNIZANT.                               00040005
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050005
000600 DATE-WRITTEN.           04-21-2012.                              00060005
000700 DATE-COMPILED.                                                   00070005
000800                                                                  00080005
000900******************************************************************00090005
001000*  MODULE TYPE: COBOL2 BATCH                                      00100005
001100*                                                                 00110005
001200*  DESCRIPTION: THIS PROGRAM SPLITS THE DISCOVER CHARGEBACK FILE  00120005
001300*               BASED ON THE DISPUTE REASON CODE.                 00130005
001400*                                                                 00140005
001500*               PLEASE NOTE THAT THIS PROGRAM IS EXPECTING THE    00150005
001600*               CHARGE BACK FILE TO HAVE THE FOLLOWING REC FORMAT 00160007
001700*               1.FIRST RECORD SHOULD BE A HEADER                 00170007
001800*               2.THE SECOND RECORD SHOULD BE OF TYPE 02          00180010
001900*               3.THE TYPE 04 SHOULD HAVE A DISPUTE CODE OF T OR C00190007
002000*               4.THERE SHOULD BE ONE TRAILER RECORD IN THE FILE  00200007
002100*               5.THERE SHOULDN'T BE MORE THAN 1 TRAILER RECORD   00210007
002110*               6.A PARTICULAR TYPE SHOULDN'T HAVE MORE THAN 100  00211007
002120*                 DETAIL LINES                                    00212007
001900*               7.ANY DISPUTE CODE OTHER THAN T OR C WOULD BE     00190007
      *                 SKIPPED.                                                
002130*               IF ANY OF THE ABOVE CONDITION IS NOT SATISFIED THE00213007
002140*               PROGRAM MAY ABEND OR GIVE UN EXPECTED RESULTS.    00214007
002200*========================== CHANGE LOG ===========================00220005
002300*  AUTH     BY            DATE                 DESCRIPTION        00230005
002400*=================================================================00240005
002500* WRXXXXX   COGNIZANT   04-21-12   CREATE PROGRAM                 00250005
002600*                                                                 00260005
002700******************************************************************00270005
002400*=================================================================00240005
002500* PKE000000012450  SAUMITRA    02-13-2013                         00250005
002600* MADE A CHANGE TO CONSIDER THE CASE OF THE INPUT FILE HAS ONLY 2 00260005
002600* RECORDS A HEADER AND A FOOTER.                                  00260005
P10237******************************************************************00270005
P10237* CHG0104429       COGNIZANT   05-15-2015                         00250005
P10237* THIS PROGRAM IS A COPY OF SAKUT107 WHERE CHANGES ARE MADE TO            
P10237* TOKENIZE THE CARD NUMBER AS PART OF COSA DATA SECURITY PROJECT  00260005
P54997******************************************************************00270005
P54997* CHG0154997       COGNIZANT   10-26-2016                         00250005
P54997* REVERT COSA DATA SECURITY PROJECT CHANGES AS CARD NUMBER IS             
P54997* TOKENIZED ALREDAY.                                              00260005
P54997******************************************************************00270005
002800                                                                  00280005
002900 ENVIRONMENT DIVISION.                                            00290005
003000 CONFIGURATION SECTION.                                           00300005
003100                                                                  00310005
003200 SOURCE-COMPUTER.        IBM-3090.                                00320005
003300 OBJECT-COMPUTER.        IBM-3090.                                00330005
003400                                                                  00340005
003500 INPUT-OUTPUT SECTION.                                            00350005
003600 FILE-CONTROL.                                                    00360005
003700                                                                  00370005
003800     SELECT DISC-FILE           ASSIGN TO INP01.                  00380005
003900     SELECT DISC-TTYP-FILE      ASSIGN TO OUT01.                  00390005
004000     SELECT DISC-CTYPE-FILE     ASSIGN TO OUT02.                  00400005
004100                                                                  00410005
004200 DATA DIVISION.                                                   00420005
004300 FILE SECTION.                                                    00430005
004400                                                                  00440005
004500 FD  DISC-FILE                                                    00450005
004600     RECORDING MODE IS F                                          00460005
004700     BLOCK CONTAINS 0 RECORDS                                     00470005
004800     LABEL RECORDS ARE STANDARD.                                  00480005
004900 01  DISC-FILE-REC               PIC  X(80).                      00490005
005000                                                                  00500005
005100 FD  DISC-TTYP-FILE                                               00510005
005200     LABEL RECORDS ARE STANDARD                                   00520005
005300     RECORDING MODE IS F                                          00530005
005400     BLOCK CONTAINS 0 RECORDS.                                    00540005
005500 01  DISC-TTYP-FILE-REC          PIC  X(80).                      00550005
005600                                                                  00560005
005700 FD  DISC-CTYPE-FILE                                              00570005
005800     LABEL RECORDS ARE STANDARD                                   00580005
005900     RECORDING MODE IS F                                          00590005
006000     BLOCK CONTAINS 0 RECORDS.                                    00600005
006100                                                                  00610005
006200 01  DISC-CTYPE-FILE-REC         PIC  X(80).                      00620005
006300                                                                  00630005
006400******************************************************************00640005
006500*                    WORKING STORAGE                              00650005
006600******************************************************************00660005
006700 WORKING-STORAGE SECTION.                                         00670005
006800                                                                  00680005
006900 01  FILLER                      PIC  X(41)  VALUE                00690005
007000           'WORKING STORAGE STARTS HERE FOR TCKUT028'.            00700005
007100                                                                  00710005
007200******************************************************************00720005
007300*                         SWITCHES                                00730005
007400******************************************************************00740005
007500 01  PS-PROGRAM-SWITCHES.                                         00750005
007600     05  PS-DISC-FILE-SW         PIC  X(01)  VALUE 'N'.           00760005
007700         88  PS-DISC-FILE-EOF                VALUE 'Y'.           00770005
007600     05  PS-DISC-FILE-SW-EMPTY   PIC  X(01)  VALUE 'N'.           00760005
007700         88  PS-DISC-FILE-EMPTY              VALUE 'Y'.           00770005
007900                                                                  00790005
008000                                                                  00800005
008100******************************************************************00810005
008200*                       ACCUMULATORS                              00820005
008300******************************************************************00830005
008400 01  PA-PROGRAM-ACCUMS.                                           00840005
008500     05  PA-DISC-READ            PIC  9(5)   VALUE 0 COMP-3.      00850009
008600     05  PA-TTYPE-WRITTEN        PIC  9(5)   VALUE 0 COMP-3.      00860009
008610     05  PA-TTYPE-DISPUTES-READ  PIC  9(5)   VALUE 0 COMP-3.      00861009
008700     05  PA-CTYPE-WRITTEN        PIC  9(5)   VALUE 0 COMP-3.      00870009
008710     05  PA-CTYPE-DISPUTES-READ  PIC  9(5)   VALUE 0 COMP-3.      00871009
008710     05  PA-OTHER-DISPUTES-READ-TYPE4                                     
                                       PIC  9(5)   VALUE 0 COMP-3.              
008710     05  PA-OTHER-DISPUTES-READ                                           
                                       PIC  9(5)   VALUE 0 COMP-3.              
008710     05  PA-OTHER-DISPUTES-READ-COMP                                      
                                       PIC  9(5)   VALUE 0 COMP-3.              
008800     05  PA-TRAIL-REC-READ       PIC  9(5)   VALUE 0 COMP-3.      00880009
008810     05  PA-CTYPE-DISPUT-AMT     PIC S9(9)   VALUE 0 COMP-3.      00881009
008820     05  PA-TTYPE-DISPUT-AMT     PIC S9(9)   VALUE 0 COMP-3.      00882009
008900                                                                  00890005
009000******************************************************************00900005
009100*                       INPUT FILE REC                            00910005
009200******************************************************************00920005
009300 01  PR-DISC-IN-REC.                                              00930005
009400     05  PR-DISC-IN-REC-TYPE     PIC X(02).                       00940005
009500     05  PR-DISC-IN-REC-IND      PIC X(01).                       00950005
009600     05  PR-DISC-IN-REC-TXT      PIC X(77).                       00960005
009700                                                                  00970005
009800******************************************************************00980005
009900*                       OUTPUT FILE REC                           00990005
010000******************************************************************01000005
010100 01  PR-DISC-OUT-REC.                                             01010005
010200     05  PR-DISC-OUT-REC-TYPE    PIC X(02).                       01020005
010300     05  PR-DISC-OUT-REC-IND     PIC X(01).                       01030005
010400     05  PR-DISC-OUT-REC-TXT     PIC X(77).                       01040005
010500                                                                  01050005
010600******************************************************************01060005
010700*                       TRAILER RECORD                            01070005
010800******************************************************************01080005
010900 01  PR-TRAIL-REC.                                                01090005
011210     05  PR-TRAIL-OUT-REC-TYPE           PIC X(2).                01121009
011220     05  PR-TRAIL-PRC-DATE               PIC X(08).               01122009
011230     05  PR-TRAIL-CLT-PRFX               PIC X(02).               01123009
011240     05  PR-TRAIL-CLT-ID                 PIC X(3).                01124009
011250     05  PR-TRAIL-TOT-DISP-NOTICES       PIC 9(7).                01125009
011260     05  PR-TRAIL-TOT-DISP-AMT           PIC 9(11).               01126009
011270     05  PR-TRAIL-TOT-DISP-NOTICE-ROWS   PIC 9(7).                01127009
011280     05  PR-TRAIL-FILLER                 PIC X(32).               01128009
011290     05  PR-TRAIL-MAIL-BOX-ID            PIC X(08).               01129009
011300                                                                  01130005
011301******************************************************************01130109
011302*                       TYPE 04 RECORD                            01130209
011303******************************************************************01130309
011304 01  PR-TYPE04-REC.                                               01130409
011305     05  PR-TYPE04-REC-TYPE              PIC X(02).               01130509
011306     05  PR-TYPE04-DISP-NOTICE-TYPE      PIC X(01).               01130609
011307     05  PR-TYPE04-DISP-CASE-NBR         PIC X(10).               01130709
011308     05  PR-TYPE04-TRANS-DATE            PIC X(08).               01130809
011309     05  PR-TYPE04-TRANS-POS-DATE        PIC X(08).               01130909
011310     05  PR-TYPE04-RETRIEVAL-DUE-DATE    PIC X(08).               01131009
011311     05  PR-TYPE04-POST-TRANSACT-AMT     PIC S9(9).               01131109
011312     05  PR-TYPE04-POST-CORRECT-AMT      PIC S9(9).               01131209
011313     05  PR-TYPE04-POST-DISPUT-AMT       PIC S9(9).               01131309
011314     05  PR-TYPE04-DISPUTE-REASON-CD     PIC X(04).               01131409
011315     05  PR-TYPE04-MESSAGE-TYPE          PIC X(04).               01131509
011316     05  PR-TYPE04-FUNCTION-CD           PIC X(03).               01131609
011317     05  PR-TYPE04-FUNCTION-CD           PIC 9(03).               01131709
011318     05  PR-TYPE04-ACTION-CD             PIC 9(01).               01131809
011319     05  PR-TYPE04-FILLER                PIC X(01).               01131909
011320                                                                  01132009
011321******************************************************************01132105
011322*                       HEADER RECORD                             01132205
011330******************************************************************01133005
011340 01  PR-HEADR-REC.                                                01134005
011350     05  PR-HEADR-OUT-REC-TYPE   PIC X(02).                       01135005
011360     05  PR-HEADR-OUT-REC-IND    PIC X(01).                       01136005
011370     05  PR-HEADR-OUT-REC-TXT    PIC X(77).                       01137005
011380                                                                  01138005
011400******************************************************************01140005
011500*                        VARIABLES                                01150005
011600******************************************************************01160005
011700 01  PV-PROGRAM-VARIABLES.                                        01170005
011800     05  PV-PARAGRAPH-NAME       PIC  X(30)  VALUE SPACES.        01180005
011900     05  PV-OPERATION-MSG-1      PIC  X(50)  VALUE SPACES.        01190005
012000     05  PV-OPERATION-MSG-2      PIC  X(80)  VALUE SPACES.        01200005
012100     05  PV-DISC-IDX-TEMP        PIC  9(04)  VALUE ZERO.          01210005
012200     05  PV-TRAIL-REC-READ-PIC   PIC  9(09)  VALUE ZERO.          01220005
012210     05  PR-TYPE04-POST-DISPUT-AMT-CMP                            01221009
012220                                 PIC S9(09)  USAGE COMP-3 .       01222009
012300                                                                  01230005
012400******************************************************************01240005
012500*                        FLAGS                                    01250005
012600******************************************************************01260005
012700 01  PF-PROGRAM-FLAGS.                                            01270005
012800     05  PF-FIRST-REC            PIC  X(01)  VALUE 'N'.           01280005
012900     05  PF-TRAIL-REC            PIC  X(01)  VALUE 'N'.           01290005
013000     05  PF-TTYPE-REC            PIC  X(01)  VALUE 'N'.           01300005
013100     05  PF-CTYPE-REC            PIC  X(01)  VALUE 'N'.           01310005
013100     05  PF-OTHERTYPE-REC        PIC  X(01)  VALUE 'N'.           01310005
013200                                                                  01320005
013300******************************************************************01330005
013400*                        ABEND CODES                              01340005
013500******************************************************************01350005
013600 01  AC-ABEND-CODE               PIC S9(04)  VALUE ZERO COMP SYNC.01360005
013700     88  AC-INPUT-FILE-HDR-ERROR             VALUE +4003.         01370005
013800     88  AC-INPUT-FILE-TYPE-ERROR            VALUE +4004.         01380005
013900     88  AC-INPUT-FILE-TRAIL-ERROR           VALUE +4005.         01390005
014100     88  AC-ARRAY-FILE-DATA-OVERFLOW         VALUE +4008.         01410005
014200                                                                  01420005
014300******************************************************************01430005
014400*                        WS DISC ARRAY                            01440005
014500******************************************************************01450005
014600 01  WS-DISC-ARRAY.                                               01460005
014700     05  WS-DISC-ARRAY-REC OCCURS 100 TIMES                       01470005
014800                           INDEXED BY DISC-INDEX.                 01480005
014900         10  WS-DISC-REC-TYPE    PIC X(02).                       01490005
015000         10  WS-DISC-REC-IND     PIC X(01).                       01500005
015100         10  WS-DISC-REC-TXT     PIC X(77).                       01510005
015200                                                                  01520005
015300******************************************************************01530005
015400*                         CONSTANTS                               01540005
015500******************************************************************01550005
015600 01  PC-PROGRAM-CONSTANTS.                                        01560005
015700     05  PC-PGM-NAME             PIC X(08)  VALUE 'TCKUT028'.     01570008
015800     05  PC-STARS                PIC X(46)  VALUE ALL '*'.        01580008
015810     05  PC-PROGRAM-LIT          PIC X(46)  VALUE                 01581008
015820             '*****  PROGRAM: TCKUT028 - STARTED *****'.          01582008
015900                                                                  01590005
016000 PROCEDURE DIVISION.                                              01600005
016100******************************************************************01610005
016200* MAINLINE                                                        01620005
016300******************************************************************01630005
016400 0000-MAINLINE.                                                   01640005
016500                                                                  01650005
016600     PERFORM A1000-INITIALIZE.                                    01660005
016700                                                                  01670005
016800     PERFORM P1000-PROCESS-DISC-FILE                              01680005
016900            UNTIL PS-DISC-FILE-EOF.                               01690005
017000                                                                  01700005
017100     PERFORM P4000-END-PROC.                                      01710005
017200                                                                  01720005
017300     GOBACK.                                                      01730005
017400                                                                  01740005
017500                                                                  01750005
017600******************************************************************01760005
017700* PREFORMS TASK INITIATION PROCESSING                             01770005
017800******************************************************************01780005
017900 A1000-INITIALIZE.                                                01790005
018000                                                                  01800005
018010     DISPLAY PC-STARS.                                            01801008
018020     DISPLAY PC-PROGRAM-LIT.                                      01802008
018030     DISPLAY PC-STARS.                                            01803008
018100     OPEN INPUT  DISC-FILE                                        01810005
018200          OUTPUT DISC-TTYP-FILE                                   01820005
018300                 DISC-CTYPE-FILE.                                 01830005
018400                                                                  01840005
018500     MOVE 0                                 TO PV-DISC-IDX-TEMP.  01850005
018600                                                                  01860005
018700     SET DISC-INDEX                         TO  1.                01870005
018800                                                                  01880005
018900     MOVE 'N'                               TO PF-TTYPE-REC.      01890005
019000                                                                  01900005
019100     MOVE 'N'                               TO PF-CTYPE-REC.      01910005
018800                                                                  01880005
018900     MOVE 'N'                               TO PF-OTHERTYPE-REC.  01890005
019200                                                                  01920005
019300     INITIALIZE WS-DISC-ARRAY                                     01930005
019400                PR-DISC-IN-REC                                    01940005
019500                PR-DISC-OUT-REC.                                  01950005
019600                                                                  01960005
019700     PERFORM R1000-READ-DISC-FILE.                                01970005
019800                                                                  01980005
019900     IF PS-DISC-FILE-EOF                                          01990005
020000                                                                  02000005
020100         DISPLAY '**** THERE IS NO DATA IN THE FILE ****'         02010005
039700         SET PS-DISC-FILE-EMPTY        TO TRUE                    03970005
020200                                                                  02020005
020300     ELSE                                                         02030005
020400         IF PR-DISC-IN-REC-TYPE = '00'                            02040005
020500                                                                  02050005
020600            MOVE PR-DISC-IN-REC            TO PR-HEADR-REC        02060005
021100                                                                  02110005
021200            PERFORM R1000-READ-DISC-FILE                          02120005
                                                                                
P12450            IF PR-DISC-IN-REC-TYPE = '99'                         02040005
P12450                 DISPLAY '*** ONLY HEADER AND TRAILER IN FILE ***'01720005
P12450            ELSE                                                  01730005
                                                                                
021400              IF PR-DISC-IN-REC-TYPE NOT = '02'                   02140005
021500                                                                  02150005
021600                 MOVE 'A1000-INITIALIZE'    TO PV-PARAGRAPH-NAME  02160005
021700                                                                  02170005
021800                 MOVE '** FILE FORMAT IS INCORRECT **'            02180005
021900                                            TO PV-OPERATION-MSG-1 02190005
022000                 MOVE '** SECOND RECORD TYPE NOT 02 **'           02200005
022100                                            TO PV-OPERATION-MSG-2 02210005
022200                                                                  02220005
022300                 MOVE +4004                 TO AC-ABEND-CODE      02230005
022400                                                                  02240005
022500                 PERFORM Z9999-ABEND                              02250005
022600                                                                  02260005
022700              END-IF                                              02270005
P12450            END-IF                                                02280005
022900         ELSE                                                     02290005
023000                                                                  02300005
023100             MOVE 'A1000-INITIALIZE'        TO PV-PARAGRAPH-NAME  02310005
023200                                                                  02320005
023300             MOVE '** FILE FORMAT IS INCORRECT **'                02330005
023400                                            TO PV-OPERATION-MSG-1 02340005
023500             MOVE '** NO HEADER IN THE INPUT FILE **'             02350005
023600                                            TO PV-OPERATION-MSG-2 02360005
023700                 MOVE +4003                 TO AC-ABEND-CODE      02370005
023800                                                                  02380005
023900             PERFORM Z9999-ABEND                                  02390005
024000                                                                  02400005
024100         END-IF                                                   02410005
024200     END-IF.                                                      02420005
024300                                                                  02430005
031900******************************************************************03190005
032000* PROCESSES THE RECORDS                                           03200005
032100******************************************************************03210005
032200 P1000-PROCESS-DISC-FILE.                                         03220005
032300                                                                  03230005
032400     MOVE 'Y'                               TO PF-FIRST-REC.      03240005
032500                                                                  03250005
032600     PERFORM P1500-BUILD-ARRAY                                    03260013
032700            UNTIL (PR-DISC-IN-REC-TYPE = '02' AND                 03270005
032800                  PF-FIRST-REC     NOT = 'Y') OR                  03280005
032900                  PS-DISC-FILE-EOF.                               03290005
033000                                                                  03300005
033100     SET PV-DISC-IDX-TEMP                   TO  DISC-INDEX.       03310005
033200                                                                  03320005
033300     SET DISC-INDEX                         TO  1.                03330005
033400                                                                  03340005
033500     IF PF-TTYPE-REC = 'Y'                                        03350005
033600                                                                  03360005
033700         PERFORM P2000-SETUP-TTYPE-FILE-WRITE                     03370005
033800                UNTIL DISC-INDEX = PV-DISC-IDX-TEMP               03380005
033900                                                                  03390005
034000     ELSE                                                         03400005
034100         IF PF-CTYPE-REC = 'Y'                                    03410005
034200                                                                  03420005
034300             PERFORM P3000-SETUP-CTYPE-FILE-WRITE                 03430005
034400                    UNTIL DISC-INDEX = PV-DISC-IDX-TEMP           03440005
034500         ELSE                                                     03450005
034100             IF PF-OTHERTYPE-REC = 'Y'                            03410005
034200                                                                  03420005
034300                MOVE PV-DISC-IDX-TEMP TO                          03430005
034400                                   PA-OTHER-DISPUTES-READ-COMP    03440005
034400                COMPUTE PA-OTHER-DISPUTES-READ =                  03440005
                                   PA-OTHER-DISPUTES-READ +                     
                                             PA-OTHER-DISPUTES-READ-COMP        
034500             END-IF                                               03450005
034500         END-IF                                                   03450005
034600     END-IF.                                                      03460005
034700                                                                  03470005
034800     MOVE ZERO                              TO  PV-DISC-IDX-TEMP. 03480005
034900                                                                  03490005
035000     SET DISC-INDEX                         TO  1.                03500005
035100                                                                  03510005
035200     MOVE 'N'                               TO  PF-CTYPE-REC.     03520005
035300                                                                  03530005
035400     MOVE 'N'                               TO  PF-TTYPE-REC.     03540005
035500                                                                  03550005
035400     MOVE 'N'                               TO  PF-OTHERTYPE-REC. 03540005
035500                                                                  03550005
035600     INITIALIZE WS-DISC-ARRAY.                                    03560005
035700                                                                  03570005
035800     INITIALIZE WS-DISC-ARRAY                                     03580005
035900                PR-DISC-OUT-REC.                                  03590005
036000                                                                  03600005
036100     IF PS-DISC-FILE-SW = 'N' AND                                 03610005
036200        PR-DISC-IN-REC-TYPE NOT = '02'                            03620005
036300                                                                  03630005
036400         PERFORM R1000-READ-DISC-FILE                             03640005
036500                                                                  03650005
036600     END-IF.                                                      03660005
036700                                                                  03670005
036710******************************************************************03671013
036720* BUILDS THE ARRAY FOR TYPE VALIDATION AND FILTER                 03672013
036730******************************************************************03673013
036740 P1500-BUILD-ARRAY.                                               03674013
036750                                                                  03675013
036760     IF PR-DISC-IN-REC-TYPE = '04' AND                            03676013
036770        PR-DISC-IN-REC-IND  = 'T'                                 03677013
036780                                                                  03678013
036790         MOVE  'Y'                          TO PF-TTYPE-REC       03679013
036791                                                                  03679113
036792         MOVE  PR-DISC-IN-REC               TO PR-TYPE04-REC      03679213
036793                                                                  03679313
036794         MOVE  PR-TYPE04-POST-DISPUT-AMT    TO                    03679413
036795                                     PR-TYPE04-POST-DISPUT-AMT-CMP03679513
036796                                                                  03679613
036797         COMPUTE PA-TTYPE-DISPUT-AMT =                            03679713
036798               PA-TTYPE-DISPUT-AMT + PR-TYPE04-POST-DISPUT-AMT-CMP03679813
036799                                                                  03679913
036800         ADD 1                              TO                    03680013
036801                                            PA-TTYPE-DISPUTES-READ03680113
036802                                                                  03680213
036803     ELSE                                                         03680313
036804        IF PR-DISC-IN-REC-TYPE = '04' AND                         03680413
036805           PR-DISC-IN-REC-IND  = 'C'                              03680513
036806                                                                  03680613
036807            MOVE  'Y'                       TO PF-CTYPE-REC       03680713
036808                                                                  03680813
036809            MOVE  PR-DISC-IN-REC            TO PR-TYPE04-REC      03680913
036810                                                                  03681013
036811            MOVE  PR-TYPE04-POST-DISPUT-AMT TO                    03681113
036812                                     PR-TYPE04-POST-DISPUT-AMT-CMP03681213
036813                                                                  03681313
036814            COMPUTE PA-CTYPE-DISPUT-AMT =                         03681413
036815               PA-CTYPE-DISPUT-AMT + PR-TYPE04-POST-DISPUT-AMT-CMP03681513
036816                                                                  03681613
036817            ADD 1                           TO                    03681713
036818                                            PA-CTYPE-DISPUTES-READ03681813
036819                                                                  03681913
036820        ELSE                                                      03682013
036821           IF PR-DISC-IN-REC-TYPE = '04'    AND                   03682113
036822              PR-DISC-IN-REC-IND  NOT = 'C' AND                   03682213
036823              PR-DISC-IN-REC-IND  NOT = 'T'                       03682313
036806                                                                  03680613
036807            MOVE  'Y'                       TO PF-OTHERTYPE-REC   03680713
                                                                                
                  ADD 1                           TO                            
                                          PA-OTHER-DISPUTES-READ-TYPE4          
036819                                                                  03681913
036835           ELSE                                                   03683513
036836              IF PR-DISC-IN-REC-TYPE = '99'                       03683613
036837                                                                  03683713
036838                  MOVE 'Y'                  TO PF-TRAIL-REC       03683813
036839                  ADD   1                   TO PA-TRAIL-REC-READ  03683913
036840                                                                  03684013
036841              END-IF                                              03684113
036842           END-IF                                                 03684213
036843        END-IF                                                    03684313
036844     END-IF.                                                      03684413
036845                                                                  03684513
036846     IF PF-TRAIL-REC = 'N'                                        03684613
036847                                                                  03684713
036848         MOVE PR-DISC-IN-REC                TO                    03684813
036849                                    WS-DISC-ARRAY-REC(DISC-INDEX) 03684913
036850                                                                  03685013
036851         SET DISC-INDEX UP BY 1                                   03685113
036852                                                                  03685213
036853     ELSE                                                         03685313
036854        IF PF-TRAIL-REC = 'Y'                                     03685413
036855                                                                  03685513
036856           MOVE PR-DISC-IN-REC              TO PR-TRAIL-REC       03685613
036857                                                                  03685713
036858        END-IF                                                    03685813
036859     END-IF.                                                      03685913
036860                                                                  03686013
036861     IF  DISC-INDEX > 100                                         03686113
036862                                                                  03686213
036863             MOVE 'P1500-BUILD-ARRAY'       TO PV-PARAGRAPH-NAME  03686313
036864                                                                  03686413
036865             MOVE '** ARRAY OVER FLOW **'                         03686513
036866                                            TO PV-OPERATION-MSG-1 03686613
036867             MOVE '**A TYPE HAS MORE THAN 100 ROWS**'             03686713
036868                                            TO PV-OPERATION-MSG-2 03686813
036869             MOVE +4008                     TO  AC-ABEND-CODE     03686913
036870                                                                  03687013
036871             PERFORM Z9999-ABEND                                  03687113
036872                                                                  03687213
036873     END-IF.                                                      03687313
036874                                                                  03687413
036875     MOVE 'N'                               TO PF-FIRST-REC.      03687513
036876                                                                  03687613
036877     PERFORM R1000-READ-DISC-FILE.                                03687713
036878                                                                  03687813
036880******************************************************************03688005
036900* WRITES THE T TYPE FILE                                          03690005
037000******************************************************************03700005
037100 P2000-SETUP-TTYPE-FILE-WRITE.                                    03710005
037200                                                                  03720005
037300     MOVE WS-DISC-ARRAY-REC(DISC-INDEX)     TO PR-DISC-OUT-REC.   03730005
037400                                                                  03740005
037500     PERFORM W1000-WRITE-TTYPE-DISC-FILE.                         03750005
037600                                                                  03760005
037700     SET DISC-INDEX UP BY 1.                                      03770005
037800                                                                  03780005
037900******************************************************************03790005
038000* WRITES THE C TYPE FILE                                          03800005
038100******************************************************************03810005
038200 P3000-SETUP-CTYPE-FILE-WRITE.                                    03820005
038300                                                                  03830005
038400     MOVE WS-DISC-ARRAY-REC(DISC-INDEX)     TO PR-DISC-OUT-REC.   03840005
038500                                                                  03850005
038600     PERFORM W2000-WRITE-CTYPE-DISC-FILE.                         03860005
038700                                                                  03870005
038800     SET DISC-INDEX UP BY 1.                                      03880005
038900                                                                  03890005
042000******************************************************************04200005
042100* EOJ ROUTINE                                                     04210005
042200******************************************************************04220005
042300 P4000-END-PROC.                                                  04230005
042400                                                                  04240005
P12450     IF NOT PS-DISC-FILE-EMPTY                                    04250005
042500      IF PA-TRAIL-REC-READ = 1                                    04250005
042800                                                                  04280005
042810         IF PA-TTYPE-WRITTEN > 0                                  04281005
042820                                                                  04282005
042821             COMPUTE PR-TRAIL-TOT-DISP-NOTICE-ROWS                04282109
042822                                            = PA-TTYPE-WRITTEN + 104282209
042823                                                                  04282309
042824             MOVE PA-TTYPE-DISPUTES-READ    TO                    04282409
042825                                         PR-TRAIL-TOT-DISP-NOTICES04282509
042826                                                                  04282609
042827             MOVE PA-TTYPE-DISPUT-AMT       TO                    04282712
042828                                         PR-TRAIL-TOT-DISP-AMT    04282809
042829                                                                  04282909
042830             MOVE PR-TRAIL-REC              TO PR-DISC-OUT-REC    04283009
042840                                                                  04284009
042900             PERFORM W1000-WRITE-TTYPE-DISC-FILE                  04290005
042901                                                                  04290105
042910         END-IF                                                   04291005
043000                                                                  04300005
043010         IF PA-CTYPE-WRITTEN > 0                                  04301005
043020                                                                  04302005
043021             COMPUTE PR-TRAIL-TOT-DISP-NOTICE-ROWS                04302109
043022                                            = PA-CTYPE-WRITTEN + 104302209
043023                                                                  04302309
043024             MOVE PA-CTYPE-DISPUTES-READ    TO                    04302409
043025                                         PR-TRAIL-TOT-DISP-NOTICES04302509
043026                                                                  04302609
043027             MOVE PA-CTYPE-DISPUT-AMT       TO                    04302712
043028                                         PR-TRAIL-TOT-DISP-AMT    04302809
043029                                                                  04302909
043030             MOVE PR-TRAIL-REC              TO PR-DISC-OUT-REC    04303009
043040                                                                  04304009
043100             PERFORM W2000-WRITE-CTYPE-DISC-FILE                  04310005
043110                                                                  04311005
043120         END-IF                                                   04312005
043200      ELSE                                                        04320005
043300         MOVE 'P4000-END-PROC'              TO PV-PARAGRAPH-NAME  04330005
043400                                                                  04340005
043500         MOVE '** PROBLEM WITH TRAILOR REC **'                    04350005
043600                                            TO PV-OPERATION-MSG-1 04360005
043700         MOVE PA-TRAIL-REC-READ             TO                    04370005
043800                                          PV-TRAIL-REC-READ-PIC   04380005
043900                                                                  04390005
044000         MOVE '** TRAIL REC READ = '                              04400005
044100                                            TO                    04410005
044200                                          PV-OPERATION-MSG-2(1:20)04420005
044300         MOVE PV-TRAIL-REC-READ-PIC         TO                    04430005
044400                                          PV-OPERATION-MSG-2(21:9)04440005
044500         MOVE ' **'                         TO                    04450005
044600                                          PV-OPERATION-MSG-2(30:3)04460005
044700                                                                  04470005
044800         MOVE +4005                         TO AC-ABEND-CODE      04480005
044900                                                                  04490005
045000         PERFORM Z9999-ABEND                                      04500005
P12450      END-IF                                                      04510005
045200     END-IF.                                                      04520005
045300                                                                  04530005
045400     CLOSE  DISC-FILE                                             04540005
045500            DISC-TTYP-FILE                                        04550005
045600            DISC-CTYPE-FILE.                                      04560005
045700                                                                  04570005
045700* SUBTRACTING 2 HERE TO REMOVE THE COUNT OF HEADER AND TRAILER    04570005
045700* AS OTHER DISUPTE FILE IS NOT WRITTEN AND THEY ARE JUST SKIPPED. 04570005
           COMPUTE PA-OTHER-DISPUTES-READ = PA-OTHER-DISPUTES-READ -            
                                           PA-OTHER-DISPUTES-READ-TYPE4.        
045800     DISPLAY PC-STARS.                                            04580008
045900     DISPLAY 'NUMBER OF DISC PAGES READ          ='               04590005
046000                                      PA-DISC-READ.               04600005
046100     DISPLAY 'NUMBER OF DISC TTYPE PAGES WRITTEN ='               04610005
046200                                      PA-TTYPE-WRITTEN.           04620005
046300     DISPLAY 'NUMBER OF DISC CTYPE PAGES WRITTEN ='               04630005
046400                                      PA-CTYPE-WRITTEN.           04640005
046300     DISPLAY 'NUMBER OF DISC OTHER PAGES SKIPPED ='               04630005
046400                                      PA-OTHER-DISPUTES-READ.     04640005
046500     DISPLAY PC-STARS.                                            04650008
046600                                                                  04660005
039000******************************************************************03900005
039100*  READ THE DISCOVER CHARGE BACK FILE                             03910005
039200******************************************************************03920005
039300 R1000-READ-DISC-FILE.                                            03930005
039400                                                                  03940005
039500     READ DISC-FILE INTO PR-DISC-IN-REC                           03950005
039600        AT END                                                    03960005
039700              SET PS-DISC-FILE-EOF          TO TRUE               03970005
039800        NOT AT END                                                03980005
039900              ADD 1                         TO PA-DISC-READ       03990005
040000     END-READ.                                                    04000005
040100                                                                  04010005
040200******************************************************************04020005
040300*  WRITE THE DISCOVER TTYPE FILE                                  04030005
040400******************************************************************04040005
040500 W1000-WRITE-TTYPE-DISC-FILE.                                     04050005
040600                                                                  04060005
040610     IF PA-TTYPE-WRITTEN = 0                                      04061005
040620                                                                  04062005
040621         WRITE  DISC-TTYP-FILE-REC FROM PR-HEADR-REC              04062105
040622                                                                  04062205
040623         ADD    1                           TO PA-TTYPE-WRITTEN   04062305
040624                                                                  04062405
040625     END-IF.                                                      04062505
040630                                                                  04063005
040700     WRITE DISC-TTYP-FILE-REC FROM PR-DISC-OUT-REC.               04070005
040800                                                                  04080005
040900     ADD 1                                  TO PA-TTYPE-WRITTEN.  04090005
041000                                                                  04100005
041100******************************************************************04110005
041200*  WRITE THE DISCOVER CTYPE FILE                                  04120005
041300******************************************************************04130005
041400 W2000-WRITE-CTYPE-DISC-FILE.                                     04140005
041500                                                                  04150005
041510     IF PA-CTYPE-WRITTEN = 0                                      04151005
041520                                                                  04152005
041530         WRITE  DISC-CTYPE-FILE-REC FROM PR-HEADR-REC             04153006
041540                                                                  04154005
041550         ADD    1                           TO PA-CTYPE-WRITTEN   04155005
041560                                                                  04156005
041570     END-IF.                                                      04157005
041580                                                                  04158005
041600     WRITE DISC-CTYPE-FILE-REC FROM PR-DISC-OUT-REC.              04160005
041700                                                                  04170005
041800     ADD 1                                  TO PA-CTYPE-WRITTEN.  04180005
041900                                                                  04190005
046700******************************************************************04670005
046800*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  04680005
046900******************************************************************04690005
047000 Z9999-ABEND.                                                     04700005
047100     DISPLAY '** ABEND           **'.                             04710005
047200     DISPLAY '** PROGRAM         ** = ' PC-PGM-NAME.              04720005
047300     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        04730005
047400     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       04740005
047500     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-2.       04750005
047600     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         04760005
