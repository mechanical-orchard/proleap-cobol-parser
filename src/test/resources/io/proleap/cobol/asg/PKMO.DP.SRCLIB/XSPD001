000100*----------------------------------------------------------       00010002
000200* 2100-CHECK-TIERED.                                              00020002
000300*     THIS CHECKS THE TIERED DATA TO SEE IF THIS IS THE           00030002
000400*     FIRST RECORD IN THE BUNCH OR IF IT NEEDS TO BE              00040002
000500*     COMPARED WITH A PREVIOUS RECORD.                            00050002
000600*----------------------------------------------------------       00060002
000700 2100-CHECK-TIERED.                                               00070002
000800                                                                  00080002
000900     IF PV-TIERED-PROMO-ID = 0                                    00090002
001000        PERFORM 2120-POPULATE-INT-TIER                            00100002
001100     ELSE                                                         00110002
001200        PERFORM 2110-PRICE-DET-TIERED                             00120002
001300     END-IF.                                                      00130002
001400                                                                  00140002
001500*2100-EXIT.                                                       00150002
001600 EJECT.                                                           00160002
001700                                                                  00170002
001800*----------------------------------------------------------       00180002
001900* 2110-PRICE-DET-TIERED.                                          00190002
002000*     THIS COMPARES TWO TIERED RECORDS TO SEE WHICH               00200002
002100*     RECORD WINS OUT ACCORDING TO PRICE DETERMINATION            00210002
002200*     RULES.                                                      00220002
002300*----------------------------------------------------------       00230002
002400 2110-PRICE-DET-TIERED.                                           00240002
002500                                                                  00250002
002600     EVALUATE TRUE                                                00260002
002700         WHEN PV-TIERED-STRT-DTE < XS042-PROMO-STRT-DTE           00270002
002800              PERFORM 2120-POPULATE-INT-TIER                      00280002
002900         WHEN PV-TIERED-STRT-DTE = XS042-PROMO-STRT-DTE           00290002
003000              EVALUATE TRUE                                       00300002
003100                  WHEN PV-TIERED-END-DTE > XS042-PROMO-END-DTE    00310002
003200                       PERFORM 2120-POPULATE-INT-TIER             00320002
003300                  WHEN PV-TIERED-END-DTE = XS042-PROMO-END-DTE    00330002
003400                       IF XS042-INTFC-SUB-ID(PC-SUB-ONE) >        00340002
003500                         TBL-INTFC-SUB-ID(PC-SUB-ONE)             00350002
003600                          PERFORM 2120-POPULATE-INT-TIER          00360002
003700                       END-IF                                     00370002
003800              END-EVALUATE                                        00380002
003900     END-EVALUATE.                                                00390002
004000                                                                  00400002
004100*2110-EXIT.                                                       00410002
004200 EJECT.                                                           00420002
004300                                                                  00430002
004400*----------------------------------------------------------       00440002
004500* 2120-POPULATE-INT-TIER.                                         00450002
004600*     THIS POPULATES THE TIERED RECORD INTO A HOLDING             00460002
004700*     SPOT.  THE HOLDING AREA WILL BE USED LATER AS EITHER        00470002
004800*     THE WINNING RECORD OR IN COMPARISON TO ANOTHER              00480002
004900*     RECORD.                                                     00490002
005000*----------------------------------------------------------       00500002
005100 2120-POPULATE-INT-TIER.                                          00510002
005200                                                                  00520002
005300     INITIALIZE PV-TIERED-DATA.                                   00530002
005400                                                                  00540002
005500     INITIALIZE TBL-TIERED-TABLE                                  00550002
005600         REPLACING ALPHANUMERIC DATA BY ZEROES                    00560002
005700                   NUMERIC DATA BY ZEROS.                         00570002
005800                                                                  00580002
005900     MOVE XS042-ELIG-PROMO-ID       TO PV-TIERED-PROMO-ID.        00590002
006000     MOVE XS042-ELIG-PROMO-INTFC-ID TO                            00600002
006100                                      PV-TIERED-PROMO-INTFC-ID.   00610002
006200     MOVE XS042-ELIG-MDSE-LNE-ID TO                               00620000
006300                                      PV-TIERED-MDSE-LNE-ID.      00630000
006400     MOVE XS042-PROMO-STRT-DTE      TO PV-TIERED-STRT-DTE.        00640000
006500     MOVE XS042-PROMO-END-DTE       TO PV-TIERED-END-DTE.         00650000
006600     MOVE XS042-PRICG-TYP-CDE       TO PV-TIERED-PRICG-TYP-CDE.   00660000
006700     MOVE XS042-MRCH-HEIR-CDE       TO PV-TIERED-MRCH-HEIR-CDE.   00670000
006800                                                                  00680000
006900     PERFORM VARYING XS042-TIER-INDEX FROM 1 BY 1                 00690000
007000        UNTIL XS042-TIER-INDEX > 10                               00700000
007100           OR XS042-INTFC-SUB-ID(XS042-TIER-INDEX) = 0            00710000
007200              SET TBL-TIER-INDEX TO XS042-TIER-INDEX              00720000
007300              MOVE XS042-BUY-QTY(XS042-TIER-INDEX) TO             00730000
007400                          TBL-BUY-QTY(TBL-TIER-INDEX)             00740000
007500              MOVE XS042-BUY-DLR(XS042-TIER-INDEX) TO             00750000
007600                          TBL-BUY-DLR(TBL-TIER-INDEX)             00760000
007700              MOVE XS042-GET-PCT(XS042-TIER-INDEX) TO             00770000
007800                          TBL-GET-PCT(TBL-TIER-INDEX)             00780000
007900              MOVE XS042-GET-DLR(XS042-TIER-INDEX) TO             00790000
008000                         TBL-GET-DLR(TBL-TIER-INDEX)              00800000
008100              MOVE XS042-INTFC-SUB-ID(XS042-TIER-INDEX)           00810000
008200                       TO TBL-INTFC-SUB-ID(TBL-TIER-INDEX)        00820000
008300     END-PERFORM.                                                 00830000
008400                                                                  00840000
008500*2120-EXIT.                                                       00850000
008600 EJECT.                                                           00860000
008700                                                                  00870000
008800*----------------------------------------------------------       00880000
008900* 2200-CHECK-SMPL-PRICG.                                          00890000
009000*     CHECKS TO SEE IF THIS IS THE FIRST SIMPLE PRICING           00900000
009100*     RECORD THAT HAS COME THROUGH OR IF IT NEEDS TO BE           00910000
009200*     COMPARED TO ANOTHER SIMPLE PRICING RECORD.                  00920000
009300*----------------------------------------------------------       00930000
009400 2200-CHECK-SMPL-PRICG.                                           00940000
009500                                                                  00950000
009600     IF PC-CNT-SMPL = 0                                           00960000
009700        SET TBL-SMPL-INDEX TO +1                                  00970000
009800        PERFORM 2225-CALC-PRC-DET                                 00980000
009900        PERFORM 2230-POPULATE-INT-SMPL                            00990000
010000        ADD +1 TO PC-CNT-SMPL                                     01000000
010100     ELSE                                                         01010000
010200        PERFORM 2210-SEARCH-SMPL-PRICG                            01020000
010300     END-IF.                                                      01030000
010400                                                                  01040000
010500*2200-EXIT.                                                       01050000
010600 EJECT.                                                           01060000
010700                                                                  01070000
010800*----------------------------------------------------------       01080000
010900* 2210-SEARCH-SMPL-PRICG.                                         01090000
011000*     THIS SEARCHES ALL THE SIMPLE PRICING RECORDS TO             01100000
011100*     SEE IF THERE IS ANOTHER RECORD OUT THERE WITH THE           01110000
011200*     SAME PROMO ID.  IF THERE ISN'T A RECORD OUT THERE           01120000
011300*     WITH THE SAME PROMO ID, IT WILL JUST ADD THE                01130000
011400*     RECORD TO THE TABLE.  IF THERE IS ONE OUT THERE             01140000
011500*     WITH THE SAME PROMO ID, IT NEEDS TO COMPARE THE             01150000
011600*     TWO RECORDS ACCORDING TO PRICE DETERMINATION                01160000
011700*     RULES.                                                      01170000
011800*----------------------------------------------------------       01180000
011900 2210-SEARCH-SMPL-PRICG.                                          01190000
012000                                                                  01200000
012100     SET PS-PROMO-ID-NOT-FOUND TO TRUE.                           01210000
012200                                                                  01220000
012300     PERFORM 2215-SEARCH-FOR-PROMO                                01230000
012400        VARYING TBL-SMPL-INDEX FROM 1 BY 1                        01240000
012500        UNTIL PS-PROMO-ID-FOUND                                   01250000
012600              OR TBL-SMPL-INDEX > PC-CNT-SMPL.                    01260000
012700                                                                  01270000
012800     IF PS-PROMO-ID-FOUND                                         01280000
012900        SET TBL-SMPL-INDEX TO PC-HOLD-INDEX                       01290000
013000        PERFORM 2220-PRICE-DET-SMPL                               01300000
013100     ELSE                                                         01310000
013200        COMPUTE PC-CNT-NEW-INDX = PC-CNT-SMPL + 1                 01320000
013300        SET TBL-SMPL-INDEX TO PC-CNT-NEW-INDX                     01330000
013400        PERFORM 2225-CALC-PRC-DET                                 01340000
013500        PERFORM 2230-POPULATE-INT-SMPL                            01350000
013600        ADD +1 TO PC-CNT-SMPL                                     01360000
013700     END-IF.                                                      01370000
013800                                                                  01380000
013900*2210-EXIT.                                                       01390000
014000 EJECT.                                                           01400000
014100                                                                  01410000
014200*----------------------------------------------------------       01420000
014300* 2215-SEARCH-FOR-PROMO.                                          01430000
014400*     THIS PROCEDURE SETS A FLAG IF THE PROMO ID WAS              01440000
014500*     FOUND IN THE TABLE.                                         01450000
014600*----------------------------------------------------------       01460000
014700 2215-SEARCH-FOR-PROMO.                                           01470000
014800                                                                  01480000
014900     IF TBL-PROMO-ID (TBL-SMPL-INDEX) = PV-PROMO-ID               01490000
015000        SET PS-PROMO-ID-FOUND TO TRUE                             01500000
015100        SET PC-HOLD-INDEX TO TBL-SMPL-INDEX                       01510000
015200     END-IF.                                                      01520000
015300                                                                  01530000
015400*2215-EXIT.                                                       01540000
015500 EJECT.                                                           01550000
015600                                                                  01560000
015700*----------------------------------------------------------       01570000
015800* 2220-PRICE-DET-SMPL.                                            01580000
015900*     THIS COMPARES TWO SIMPLE PRICING RECORDS ACCORDING          01590000
016000*     TO THE PRICE DETERMINATION RULES.                           01600000
016100*----------------------------------------------------------       01610000
016200 2220-PRICE-DET-SMPL.                                             01620000
016300                                                                  01630000
016400     EVALUATE TRUE                                                01640000
016500       WHEN XS042-MRCH-HEIR-CDE =                                 01650000
016600                   TBL-MERCH-HEIR-CDE(TBL-SMPL-INDEX)             01660000
016700            PERFORM 2225-CALC-PRC-DET                             01670000
016800            EVALUATE TRUE                                         01680000
016900              WHEN PV-PRICE-DET-PRC <                             01690000
017000                        TBL-PRICE-DET-PRC(TBL-SMPL-INDEX)         01700000
017100                   PERFORM 2230-POPULATE-INT-SMPL                 01710000
017200              WHEN PV-PRICE-DET-PRC =                             01720000
017300                       TBL-PRICE-DET-PRC(TBL-SMPL-INDEX)          01730000
017400                   EVALUATE TRUE                                  01740000
017500                     WHEN XS042-PROMO-STRT-DTE                    01750000
017600                            > TBL-PROMO-STRT-DTE(TBL-SMPL-INDEX)  01760000
017700                          PERFORM 2230-POPULATE-INT-SMPL          01770000
017800                     WHEN XS042-PROMO-STRT-DTE                    01780000
017900                             = TBL-PROMO-STRT-DTE(TBL-SMPL-INDEX) 01790000
018000                          EVALUATE TRUE                           01800000
018100                            WHEN XS042-PROMO-END-DTE              01810000
018200                              < TBL-PROMO-END-DTE(TBL-SMPL-INDEX) 01820000
018300                                 PERFORM 2230-POPULATE-INT-SMPL   01830000
018400                            WHEN XS042-PROMO-END-DTE              01840000
018500                              = TBL-PROMO-END-DTE(TBL-SMPL-INDEX) 01850000
018600                                 IF XS042-ELIG-PROMO-INTFC-ID >   01860000
018700                                TBL-PROMO-INTFC-ID(TBL-SMPL-INDEX)01870000
018800                                    PERFORM 2230-POPULATE-INT-SMPL01880000
018900                                 END-IF                           01890000
019000                          END-EVALUATE                            01900000
019100                   END-EVALUATE                                   01910000
019200            END-EVALUATE                                          01920000
019300       WHEN (XS042-MRCH-HEIR-CDE = 'SKU')                         01930002
019310                                                                  01931002
019400         OR (XS042-MRCH-HEIR-CDE = 'STY'                          01940002
019410             AND TBL-MERCH-HEIR-CDE(TBL-SMPL-INDEX) NOT = 'SKU')  01941002
019420                                                                  01942002
019421         OR ((XS042-MRCH-HEIR-CDE = 'SCL')                        01942102
019422             AND ((TBL-MERCH-HEIR-CDE(TBL-SMPL-INDEX) = 'DPT')    01942202
019423               OR (TBL-MERCH-HEIR-CDE(TBL-SMPL-INDEX) = 'MCL')))  01942302
019430                                                                  01943002
019900         OR (XS042-MRCH-HEIR-CDE = 'MCL'                          01990002
020000             AND TBL-MERCH-HEIR-CDE(TBL-SMPL-INDEX) = 'DPT')      02000002
020010                                                                  02001002
020100            PERFORM 2225-CALC-PRC-DET                             02010000
020200            PERFORM 2230-POPULATE-INT-SMPL                        02020000
020300       WHEN OTHER                                                 02030000
020400            CONTINUE                                              02040000
020500     END-EVALUATE.                                                02050000
020600                                                                  02060000
020700*2220-EXIT.                                                       02070000
020800 EJECT.                                                           02080000
020900                                                                  02090000
021000*----------------------------------------------------------       02100000
021100* 2225-CALC-PRC-DET.                                              02110000
021200*     THIS CALCULATES THE PRICE DETERMINATION PRICE               02120000
021300*     ACCORDING TO WHAT TYPE OF SIMPLE PRICE IT IS.               02130000
021400*----------------------------------------------------------       02140000
021500 2225-CALC-PRC-DET.                                               02150000
021600                                                                  02160000
021700     EVALUATE TRUE                                                02170000
021800         WHEN PV-PRICG-TYP-CDE = 'SRP'                            02180000
021900              MOVE PV-RGLR-PRICE  TO PV-PRICE-DET-PRC             02190000
022000         WHEN PV-PRICG-TYP-CDE = 'SPP' OR 'CPP' OR 'MPP'          02200000
022100              MOVE XS042-DISC-GP-AMT TO PV-PRICE-DET-PRC          02210000
022200         WHEN PV-PRICG-TYP-CDE = 'SPO' OR 'CPO'                   02220000
022300              COMPUTE PV-PERCENT-VAL = XS042-DISC-GP-AMT /        02230000
022400                                       100.000                    02240000
022500              COMPUTE PV-PRICE-DET-PRC = PV-RGLR-PRICE *          02250000
022600                       (1 - PV-PERCENT-VAL)                       02260000
022700              END-COMPUTE                                         02270000
022800     END-EVALUATE.                                                02280000
022900                                                                  02290000
023000*2225-EXIT.                                                       02300000
023100 EJECT.                                                           02310000
023200                                                                  02320000
023300*----------------------------------------------------------       02330000
023400* 2230-POPULATE-INT-SMPL.                                         02340000
023500*     THIS POPULATES THE SIMPLE PRICING TABLE.                    02350000
023600*----------------------------------------------------------       02360000
023700 2230-POPULATE-INT-SMPL.                                          02370000
023800                                                                  02380000
023900     MOVE XS042-ELIG-PROMO-ID TO                                  02390000
024000                  TBL-PROMO-ID(TBL-SMPL-INDEX).                   02400000
024100     MOVE XS042-ELIG-PROMO-INTFC-ID TO                            02410000
024200                  TBL-PROMO-INTFC-ID(TBL-SMPL-INDEX).             02420000
024300     MOVE XS042-ELIG-MDSE-LNE-ID TO                               02430000
024400                  TBL-MDSE-LNE-ID(TBL-SMPL-INDEX).                02440000
024500     MOVE XS042-PROMO-STRT-DTE TO                                 02450000
024600                  TBL-PROMO-STRT-DTE(TBL-SMPL-INDEX).             02460000
024700     MOVE XS042-PROMO-END-DTE TO                                  02470000
024800                  TBL-PROMO-END-DTE(TBL-SMPL-INDEX).              02480000
024900     MOVE XS042-PRICG-TYP-CDE TO                                  02490000
025000                  TBL-PRICG-TYP-CDE(TBL-SMPL-INDEX).              02500000
025100     MOVE XS042-MRCH-HEIR-CDE TO                                  02510000
025200                  TBL-MERCH-HEIR-CDE(TBL-SMPL-INDEX).             02520000
025300     MOVE PV-PRICE-DET-PRC              TO                        02530000
025400                  TBL-PRICE-DET-PRC(TBL-SMPL-INDEX).              02540000
025500                                                                  02550000
025600*2230-EXIT.                                                       02560000
025700 EJECT.                                                           02570000
025800                                                                  02580000
025900*----------------------------------------------------------       02590000
026000* 2300-CHECK-GP-PRICG.                                            02600000
026100*     CHECKS TO SEE IF THIS IS THE FIRST GROUP PRICING            02610000
026200*     RECORD THAT HAS COME THROUGH OR IF IT NEEDS TO BE           02620000
026300*     COMPARED TO ANOTHER GROUP PRICING RECORD.                   02630000
026400*----------------------------------------------------------       02640000
026500 2300-CHECK-GP-PRICG.                                             02650000
026600                                                                  02660000
026700     IF PC-CNT-GP = 0                                             02670000
026800        SET TBL-GP-INDEX TO +1                                    02680000
026900        PERFORM 2330-POPULATE-INT-GP-PRICG                        02690000
027000        ADD +1 TO PC-CNT-GP                                       02700000
027100     ELSE                                                         02710000
027200        PERFORM 2310-SEARCH-GP-PRICG                              02720000
027300     END-IF.                                                      02730000
027400                                                                  02740000
027500*2300-EXIT.                                                       02750000
027600 EJECT.                                                           02760000
027700                                                                  02770000
027800*----------------------------------------------------------       02780000
027900* 2310-SEARCH-GP-PRICG.                                           02790000
028000*     THIS SEARCHES ALL THE GROUP PRICING RECORDS TO              02800000
028100*     SEE IF THERE IS ANOTHER RECORD OUT THERE WITH THE           02810000
028200*     SAME PROMO ID.  IF THERE ISN'T A RECORD OUT THERE           02820000
028300*     WITH THE SAME PROMO ID, IT WILL JUST ADD THE                02830000
028400*     RECORD TO THE TABLE.  IF THERE IS ONE OUT THERE             02840000
028500*     WITH THE SAME PROMO ID, IT NEEDS TO COMPARE THE             02850000
028600*     TWO RECORDS ACCORDING TO PRICE DETERMINATION                02860000
028700*     RULES.                                                      02870000
028800*----------------------------------------------------------       02880000
028900 2310-SEARCH-GP-PRICG.                                            02890000
029000                                                                  02900000
029100     SET PS-PROMO-ID-NOT-FOUND TO TRUE.                           02910000
029200                                                                  02920000
029300     PERFORM 2315-SEARCH-FOR-GP-PROMO                             02930000
029400        VARYING TBL-GP-INDEX FROM 1 BY 1                          02940000
029500        UNTIL PS-PROMO-ID-FOUND                                   02950000
029600              OR TBL-GP-INDEX > PC-CNT-GP.                        02960000
029700                                                                  02970000
029800     IF PS-PROMO-ID-FOUND                                         02980000
029900        SET TBL-GP-INDEX TO PC-HOLD-INDEX                         02990000
030000        PERFORM 2320-PRICE-DET-GP                                 03000000
030100     ELSE                                                         03010000
030200        COMPUTE PC-CNT-NEW-INDX = PC-CNT-GP + 1                   03020000
030300        SET TBL-GP-INDEX TO PC-CNT-NEW-INDX                       03030000
030400        PERFORM 2330-POPULATE-INT-GP-PRICG                        03040000
030500        ADD +1 TO PC-CNT-GP                                       03050000
030600     END-IF.                                                      03060000
030700                                                                  03070000
030800*2310-EXIT.                                                       03080000
030900 EJECT.                                                           03090000
031000                                                                  03100000
031100*----------------------------------------------------------       03110000
031200* 2315-SEARCH-FOR-GP-PROMO.                                       03120000
031300*     THIS PROCEDURE SETS A FLAG IF THE PROMO ID WAS              03130000
031400*     FOUND IN THE TABLE.                                         03140000
031500*----------------------------------------------------------       03150000
031600 2315-SEARCH-FOR-GP-PROMO.                                        03160000
031700                                                                  03170000
031800     IF TBL-GP-PROMO-ID(TBL-GP-INDEX) = PV-PROMO-ID               03180000
031900        SET PS-PROMO-ID-FOUND TO TRUE                             03190000
032000        SET PC-HOLD-INDEX TO TBL-GP-INDEX                         03200000
032100     END-IF.                                                      03210000
032200                                                                  03220000
032300*2315-EXIT.                                                       03230000
032400 EJECT.                                                           03240000
032500                                                                  03250000
032600*----------------------------------------------------------       03260000
032700* 2320-PRICE-DET-GP.                                              03270000
032800*     THIS COMPARES TWO GROUP PRICING RECORDS ACCORDING           03280000
032900*     TO THE PRICE DETERMINATION RULES.                           03290000
033000*----------------------------------------------------------       03300000
033100 2320-PRICE-DET-GP.                                               03310000
033200                                                                  03320000
033300*    EVALUATE TRUE                                                03330000
033400*      WHEN XS042-MRCH-HEIR-CDE = 'SKU'                           03340000
033500*           PERFORM 2330-POPULATE-INT-GP-PRICG                    03350000
033600*      WHEN OTHER                                                 03360000
033700*           CONTINUE                                              03370000
033800*    END-EVALUATE.                                                03380000
033900                                                                  03390000
034000     COMPUTE PV-GP-INDV-GP-PRC = XS042-DISC-GP-AMT /              03400000
034100                     XS042-DISC-GP-QTY.                           03410000
034200     EVALUATE TRUE                                                03420000
034300       WHEN XS042-MRCH-HEIR-CDE =                                 03430000
034400                   TBL-GP-MERCH-HEIR-CDE(TBL-GP-INDEX)            03440000
034500            EVALUATE TRUE                                         03450000
034600              WHEN PV-GP-INDV-GP-PRC <                            03460000
034700                        TBL-GP-INDV-GP-PRC(TBL-GP-INDEX)          03470000
034800                   PERFORM 2330-POPULATE-INT-GP-PRICG             03480000
034900              WHEN PV-GP-INDV-GP-PRC =                            03490000
035000                       TBL-GP-INDV-GP-PRC(TBL-GP-INDEX)           03500000
035100                   EVALUATE TRUE                                  03510000
035200                     WHEN XS042-PROMO-STRT-DTE                    03520000
035300                         > TBL-GP-PROMO-STRT-DTE(TBL-GP-INDEX)    03530000
035400                          PERFORM 2330-POPULATE-INT-GP-PRICG      03540000
035500                     WHEN XS042-PROMO-STRT-DTE                    03550000
035600                          = TBL-GP-PROMO-STRT-DTE(TBL-GP-INDEX)   03560000
035700                          EVALUATE TRUE                           03570000
035800                            WHEN XS042-PROMO-END-DTE              03580000
035900                              < TBL-GP-PROMO-END-DTE(TBL-GP-INDEX)03590000
036000                               PERFORM 2330-POPULATE-INT-GP-PRICG 03600000
036100                            WHEN XS042-PROMO-END-DTE              03610000
036200                              = TBL-GP-PROMO-END-DTE(TBL-GP-INDEX)03620000
036300                                 IF XS042-ELIG-PROMO-INTFC-ID >   03630000
036400                              TBL-GP-PROMO-INTFC-ID(TBL-GP-INDEX) 03640000
036500                               PERFORM 2330-POPULATE-INT-GP-PRICG 03650000
036600                                 END-IF                           03660000
036700                          END-EVALUATE                            03670000
036800                   END-EVALUATE                                   03680000
036900            END-EVALUATE                                          03690000
019300       WHEN (XS042-MRCH-HEIR-CDE = 'SKU')                         03761003
019310                                                                  03762003
019400         OR (XS042-MRCH-HEIR-CDE = 'STY'                          03763003
019410             AND TBL-GP-MERCH-HEIR-CDE(TBL-GP-INDEX) NOT = 'SKU') 03764003
019420                                                                  03765003
019421         OR ((XS042-MRCH-HEIR-CDE = 'SCL')                        03766003
019422             AND ((TBL-GP-MERCH-HEIR-CDE(TBL-GP-INDEX) = 'DPT')   03767003
019423               OR (TBL-GP-MERCH-HEIR-CDE(TBL-GP-INDEX) = 'MCL'))) 03768003
019430                                                                  03769003
019900         OR (XS042-MRCH-HEIR-CDE = 'MCL'                          03769103
020000             AND TBL-GP-MERCH-HEIR-CDE(TBL-GP-INDEX) = 'DPT')     03769203
037700            PERFORM 2330-POPULATE-INT-GP-PRICG                    03770000
037800       WHEN OTHER                                                 03780000
037900            CONTINUE                                              03790000
038000     END-EVALUATE.                                                03800000
038100                                                                  03810000
038200                                                                  03820000
038300*2320-EXIT.                                                       03830000
038400 EJECT.                                                           03840000
038500                                                                  03850000
038600*----------------------------------------------------------       03860000
038700* 2330-POPULATE-INT-GP-PRICG.                                     03870000
038800*     THIS POPULATES THE GROUP PRICING TABLE.                     03880000
038900*----------------------------------------------------------       03890000
039000 2330-POPULATE-INT-GP-PRICG.                                      03900000
039100                                                                  03910000
039200     MOVE XS042-ELIG-PROMO-ID  TO                                 03920000
039300                  TBL-GP-PROMO-ID(TBL-GP-INDEX).                  03930000
039400     MOVE XS042-ELIG-PROMO-INTFC-ID TO                            03940000
039500                  TBL-GP-PROMO-INTFC-ID(TBL-GP-INDEX).            03950000
039600     MOVE XS042-ELIG-MDSE-LNE-ID TO                               03960000
039700                  TBL-GP-MDSE-LNE-ID(TBL-GP-INDEX).               03970000
039800     MOVE XS042-PROMO-STRT-DTE TO                                 03980000
039900                  TBL-GP-PROMO-STRT-DTE(TBL-GP-INDEX).            03990000
040000     MOVE XS042-PROMO-END-DTE  TO                                 04000000
040100                  TBL-GP-PROMO-END-DTE(TBL-GP-INDEX).             04010000
040200     MOVE XS042-PRICG-TYP-CDE  TO                                 04020000
040300                  TBL-GP-PRICG-TYP-CDE(TBL-GP-INDEX).             04030000
040400     MOVE XS042-MRCH-HEIR-CDE  TO                                 04040000
040500                  TBL-GP-MERCH-HEIR-CDE(TBL-GP-INDEX).            04050000
040600     MOVE XS042-DISC-GP-QTY    TO                                 04060000
040700                  TBL-GP-GROUP-QTY(TBL-GP-INDEX).                 04070000
040800     MOVE XS042-DISC-GP-AMT    TO                                 04080000
040900                  TBL-GP-GROUP-PRC(TBL-GP-INDEX).                 04090000
041000     COMPUTE PV-GP-INDV-GP-PRC = XS042-DISC-GP-AMT /              04100000
041100                     XS042-DISC-GP-QTY.                           04110000
041200     MOVE PV-GP-INDV-GP-PRC            TO                         04120000
041300                     TBL-GP-INDV-GP-PRC(TBL-GP-INDEX).            04130000
041400                                                                  04140000
041500*2330-EXIT.                                                       04150000
041600 EJECT.                                                           04160000
041700                                                                  04170000
041800*----------------------------------------------------------       04180000
041900* 2400-CHECK-BOGO.                                                04190000
042000*     CHECKS TO SEE IF THIS IS THE FIRST BOGO                     04200000
042100*     RECORD THAT HAS COME THROUGH OR IF IT NEEDS TO BE           04210000
042200*     COMPARED TO ANOTHER BOGO RECORD.                            04220000
042300*----------------------------------------------------------       04230000
042400 2400-CHECK-BOGO.                                                 04240000
042500                                                                  04250000
042600     IF PC-CNT-BOGO = 0                                           04260000
042700        SET TBL-BOGO-INDEX TO +1                                  04270000
042800        PERFORM 2430-POPULATE-INT-BOGO-PRICG                      04280000
042900        ADD +1 TO PC-CNT-BOGO                                     04290000
043000     ELSE                                                         04300000
043100        PERFORM 2410-SEARCH-BOGO                                  04310000
043200     END-IF.                                                      04320000
043300                                                                  04330000
043400*2400-EXIT.                                                       04340000
043500 EJECT.                                                           04350000
043600                                                                  04360000
043700*----------------------------------------------------------       04370000
043800* 2410-SEARCH-BOGO.                                               04380000
043900*     THIS SEARCHES ALL THE BOGO RECORDS TO                       04390000
044000*     SEE IF THERE IS ANOTHER RECORD OUT THERE WITH THE           04400000
044100*     SAME PROMO ID.  IF THERE ISN'T A RECORD OUT THERE           04410000
044200*     WITH THE SAME PROMO ID, IT WILL JUST ADD THE                04420000
044300*     RECORD TO THE TABLE.  IF THERE IS ONE OUT THERE             04430000
044400*     WITH THE SAME PROMO ID, IT NEEDS TO COMPARE THE             04440000
044500*     TWO RECORDS ACCORDING TO PRICE DETERMINATION                04450000
044600*     RULES.                                                      04460000
044700*----------------------------------------------------------       04470000
044800 2410-SEARCH-BOGO.                                                04480000
044900                                                                  04490000
045000     SET PS-PROMO-ID-NOT-FOUND TO TRUE.                           04500000
045100                                                                  04510000
045200     PERFORM 2415-SEARCH-FOR-BOGO-PROMO                           04520000
045300        VARYING TBL-BOGO-INDEX FROM 1 BY 1                        04530000
045400        UNTIL PS-PROMO-ID-FOUND                                   04540000
045500              OR TBL-BOGO-INDEX > PC-CNT-BOGO.                    04550000
045600                                                                  04560000
045700     IF PS-PROMO-ID-FOUND                                         04570000
045800        SET TBL-BOGO-INDEX TO PC-HOLD-INDEX                       04580000
045900        PERFORM 2420-PRICE-DET-BOGO                               04590000
046000     ELSE                                                         04600000
046100        COMPUTE PC-CNT-NEW-INDX = PC-CNT-BOGO + 1                 04610000
046200        SET TBL-BOGO-INDEX TO PC-CNT-NEW-INDX                     04620000
046300        PERFORM 2430-POPULATE-INT-BOGO-PRICG                      04630000
046400        ADD +1 TO PC-CNT-BOGO                                     04640000
046500     END-IF.                                                      04650000
046600                                                                  04660000
046700*2410-EXIT.                                                       04670000
046800 EJECT.                                                           04680000
046900                                                                  04690000
047000*----------------------------------------------------------       04700000
047100* 2415-SEARCH-FOR-BOGO-PROMO.                                     04710000
047200*     THIS PROCEDURE SETS A FLAG IF THE PROMO ID WAS              04720000
047300*     FOUND IN THE BOGO TABLE.                                    04730000
047400*----------------------------------------------------------       04740000
047500 2415-SEARCH-FOR-BOGO-PROMO.                                      04750000
047600                                                                  04760000
047700     IF TBL-BOGO-PROMO-ID(TBL-BOGO-INDEX) = PV-PROMO-ID           04770000
047800        SET PS-PROMO-ID-FOUND TO TRUE                             04780000
047900        SET PC-HOLD-INDEX TO TBL-BOGO-INDEX                       04790000
048000     END-IF.                                                      04800000
048100                                                                  04810000
048200*2415-EXIT.                                                       04820000
048300 EJECT.                                                           04830000
048400                                                                  04840000
048500*----------------------------------------------------------       04850000
048600* 2420-PRICE-DET-BOGO.                                            04860000
048700*     THIS COMPARES TWO BOGO PRICING RECORDS ACCORDING            04870000
048800*     TO THE PRICE DETERMINATION RULES.                           04880000
048900*----------------------------------------------------------       04890000
049000 2420-PRICE-DET-BOGO.                                             04900000
049100                                                                  04910000
049200     EVALUATE TRUE                                                04920000
049300       WHEN XS042-MRCH-HEIR-CDE = 'SKU'                           04930000
049400            PERFORM 2430-POPULATE-INT-BOGO-PRICG                  04940000
049500       WHEN XS042-MRCH-HEIR-CDE = 'STY'                           04950000
049600            PERFORM 2430-POPULATE-INT-BOGO-PRICG                  04960000
049700       WHEN OTHER                                                 04970000
049800            CONTINUE                                              04980000
049900     END-EVALUATE.                                                04990000
050000                                                                  05000000
050100*2420-EXIT.                                                       05010000
050200 EJECT.                                                           05020000
050300                                                                  05030000
050400*----------------------------------------------------------       05040000
050500* 2430-POPULATE-INT-BOGO-PRICG.                                   05050000
050600*     THIS POPULATES THE BOGO PRICING TABLE.                      05060000
050700*----------------------------------------------------------       05070000
050800 2430-POPULATE-INT-BOGO-PRICG.                                    05080000
050900                                                                  05090000
051000     MOVE XS042-ELIG-PROMO-ID  TO                                 05100000
051100                  TBL-BOGO-PROMO-ID(TBL-BOGO-INDEX).              05110000
051200     MOVE XS042-ELIG-PROMO-INTFC-ID TO                            05120000
051300                  TBL-BOGO-PROMO-INTFC-ID(TBL-BOGO-INDEX).        05130000
051400     MOVE XS042-ELIG-MDSE-LNE-ID TO                               05140000
051500                  TBL-BOGO-MDSE-LNE-ID(TBL-BOGO-INDEX).           05150000
051600     MOVE XS042-PROMO-STRT-DTE TO                                 05160000
051700                  TBL-BOGO-PROMO-STRT-DTE(TBL-BOGO-INDEX).        05170000
051800     MOVE XS042-PROMO-END-DTE  TO                                 05180000
051900                  TBL-BOGO-PROMO-END-DTE(TBL-BOGO-INDEX).         05190000
052000     MOVE XS042-PRICG-TYP-CDE  TO                                 05200000
052100                  TBL-BOGO-PRICG-TYP-CDE(TBL-BOGO-INDEX).         05210000
052200     MOVE XS042-DISC-GP-QTY    TO                                 05220000
052300                  TBL-BOGO-DISC-QTY (TBL-BOGO-INDEX).             05230000
052400     MOVE XS042-DISC-GP-AMT    TO                                 05240000
052500                  TBL-BOGO-DISC-AMT (TBL-BOGO-INDEX).             05250000
052600                                                                  05260000
052700**   DISPLAY '**2430- LOADING BOGO TABLE **',                     05270000
052800**              '>> PROMO INTFC ID=',                             05280000
052900**                TBL-BOGO-PROMO-INTFC-ID(TBL-BOGO-INDEX),        05290000
053000**              '>> PROMO ID=',                                   05300000
053100**                TBL-BOGO-PROMO-ID(TBL-BOGO-INDEX),              05310000
053200**              '>> PRICG TYP=',                                  05320000
053300**                TBL-BOGO-PRICG-TYP-CDE(TBL-BOGO-INDEX),         05330000
053400**              '>> DISC QTY=',                                   05340000
053500**                TBL-BOGO-DISC-QTY (TBL-BOGO-INDEX),             05350000
053600**              '>> DISC AMT=',                                   05360000
053700**                TBL-BOGO-DISC-AMT (TBL-BOGO-INDEX), '**'.       05370000
053800*2430-EXIT.                                                       05380000
053900 EJECT.                                                           05390000
054000                                                                  05400000
054100*----------------------------------------------------------       05410000
054200* 3000-PROCESS-PRC-DET.                                           05420000
054300*     THIS GOES THROUGH THE SIMPLE PRICING TABLE AND              05430000
054400*     NARROWS DOWN THE WINNING SIMPLE PRICE PROMOTION             05440000
054500*     TO ONE RECORD.  IT THEN CHECKS WHAT TYPE OF                 05450000
054600*     SIMPLE PRICING PROMOTION IT IS AND DECIDES WHETHER          05460000
054700*     TO INCLUDE A TIERE PROMOTION AND TO PICK A WINNING          05470000
054800*     GROUP PRICING PROMOTION.  BASED ON THE OUTCOME IT           05480000
054900*     WILL FIND THE PRICE DETERMINED PRICE.                       05490000
055000*----------------------------------------------------------       05500000
055100 3000-PROCESS-PRC-DET.                                            05510000
055200                                                                  05520000
055300     INITIALIZE PC-CNT-INDX.                                      05530000
055400                                                                  05540000
055500     PERFORM VARYING TBL-SMPL-INDEX FROM 1 BY 1                   05550000
055600        UNTIL TBL-SMPL-INDEX > PC-CNT-SMPL                        05560000
055700            ADD +1 TO PC-CNT-INDX                                 05570000
055800            IF PC-CNT-INDX = +1                                   05580000
055900               PERFORM 3200-POPULATE-FINAL-SMPL                   05590000
056000            ELSE                                                  05600000
056100               PERFORM 3100-PRICE-DET-FINAL-SMPL                  05610000
056200            END-IF                                                05620000
056300     END-PERFORM.                                                 05630000
056400*** IF THERE ARE NO SIMPLE PRICING RECORDS, THE REGULAR           05640000
056500*** PRICE WILL BE THE PRICE DETERMINED PRICE                      05650000
056600     IF PC-CNT-SMPL > 0                                           05660000
056700        MOVE PV-SMPL-PRC-DET-PRICE TO PV-FINAL-PRC-DET-PRC        05670000
056800        MOVE PV-SMPL-PRC-PROMO-ID  TO PV-FINAL-DET-PROMO-ID       05680000
056900        MOVE PV-SMPL-INTFC-ID      TO PV-FINAL-DET-INTFC-ID       05690000
057000        MOVE PV-SMPL-MDSE-LNE-ID   TO PV-FINAL-DET-MDSE-LNE-ID    05700000
057100        MOVE PV-SMPL-PRC-TYP-CDE   TO PV-FINAL-PRC-TYP-CDE        05710000
057200        MOVE PV-SMPL-STRT-DTE      TO PV-FINAL-PD-STRT-DTE        05720000
057300        MOVE PV-SMPL-END-DTE       TO PV-FINAL-PD-END-DTE         05730000
057400     ELSE                                                         05740000
057500        MOVE PV-RGLR-PRICE         TO PV-FINAL-PRC-DET-PRC        05750000
057600        MOVE ZEROES                TO PV-FINAL-DET-PROMO-ID       05760000
057700                                      PV-FINAL-DET-INTFC-ID       05770000
057800                                      PV-FINAL-DET-MDSE-LNE-ID    05780000
057900        MOVE SPACES                TO PV-FINAL-PRC-TYP-CDE        05790000
058000                                      PV-FINAL-PD-STRT-DTE        05800000
058100                                      PV-FINAL-PD-END-DTE         05810000
058200     END-IF.                                                      05820000
058300                                                                  05830000
058400     INITIALIZE PC-CNT-INDX.                                      05840000
058500                                                                  05850000
058600     IF PV-SMPL-PRC-TYP-CDE = 'SRP'                               05860000
058700        INITIALIZE PV-TIERED-DATA                                 05870000
058800        MOVE PV-SMPL-PRC-TYP-CDE    TO PV-FINAL-PRC-TYP-CDE       05880000
058900        MOVE PV-SMPL-PRC-PROMO-ID   TO PV-FINAL-DET-PROMO-ID      05890000
059000        MOVE PV-SMPL-INTFC-ID       TO PV-FINAL-DET-INTFC-ID      05900000
059100        MOVE PV-SMPL-MDSE-LNE-ID    TO PV-FINAL-DET-MDSE-LNE-ID   05910000
059200        MOVE PV-SMPL-STRT-DTE       TO PV-FINAL-PD-STRT-DTE       05920000
059300        MOVE PV-SMPL-END-DTE        TO PV-FINAL-PD-END-DTE        05930000
059400     ELSE                                                         05940000
059500        PERFORM VARYING TBL-GP-INDEX FROM 1 BY 1                  05950000
059600           UNTIL TBL-GP-INDEX > PC-CNT-GP                         05960000
059700               ADD +1 TO PC-CNT-INDX                              05970000
059800               IF PC-CNT-INDX = +1                                05980000
059900                  PERFORM 3400-POPULATE-FINAL-GP                  05990000
060000               ELSE                                               06000000
060100                  PERFORM 3300-PRICE-DET-FINAL-GP                 06010000
060200               END-IF                                             06020000
060300        END-PERFORM                                               06030000
060400        IF PC-CNT-GP > 0                                          06040000
060500           IF PC-CNT-SMPL > 0                                     06050000
060600              IF PV-GP-PRC-PROMO-ID = PV-SMPL-PRC-PROMO-ID        06060000
060700                 IF PV-GP-PRC-HEIR-CDE = PV-SMPL-HEIR-CDE         06070000
060800                    MOVE PV-GP-PRC-PROMO-ID                       06080000
060900                                          TO PV-FINAL-GP-PROMO-ID 06090000
061000                    MOVE PV-GP-PRC-INTFC-ID                       06100000
061100                                          TO PV-FINAL-GP-INTFC-ID 06110000
061200                    MOVE PV-GP-PRC-MDSE-LNE-ID                    06120000
061300                                       TO PV-FINAL-GP-MDSE-LNE-ID 06130000
061400                    MOVE PV-GP-PRC-TYP-CDE TO PV-FINAL-GP-TYP-CDE 06140000
061500                    MOVE PV-GP-PRC-QTY     TO PV-FINAL-GP-QTY     06150000
061600                    MOVE PV-GP-PRC-DLR     TO PV-FINAL-GP-DLR     06160000
061700                    MOVE PV-GP-PRC-IDV-PRICE                      06170000
061800                                           TO PV-FINAL-GP-IDV-PRC 06180000
061900                    MOVE PV-GP-PRC-STRT-DTE                       06190000
062000                                      TO PV-FINAL-GP-STRT-DTE     06200000
062100                    MOVE PV-GP-PRC-END-DTE                        06210000
062200                                      TO PV-FINAL-GP-END-DTE      06220000
062300                 ELSE                                             06230000
062400                    IF (PV-GP-PRC-HEIR-CDE = 'SKU') OR            06240000
062500                       (PV-GP-PRC-HEIR-CDE = 'STY' AND            06250000
062600                        PV-SMPL-HEIR-CDE NOT = 'SKU')             06260000
062700                       SET PS-GP-PRC-WINS TO TRUE                 06270000
062800                       MOVE PV-RGLR-PRICE TO PV-FINAL-PRC-DET-PRC 06280000
062900                       MOVE PV-GP-PRC-PROMO-ID                    06290000
063000                                          TO PV-FINAL-GP-PROMO-ID 06300000
063100                       MOVE PV-GP-PRC-INTFC-ID                    06310000
063200                                          TO PV-FINAL-GP-INTFC-ID 06320000
063300                       MOVE PV-GP-PRC-MDSE-LNE-ID                 06330000
063400                                       TO PV-FINAL-GP-MDSE-LNE-ID 06340000
063500                       MOVE PV-GP-PRC-TYP-CDE                     06350000
063600                                          TO PV-FINAL-GP-TYP-CDE  06360000
063700                       MOVE PV-GP-PRC-QTY TO PV-FINAL-GP-QTY      06370000
063800                       MOVE PV-GP-PRC-DLR TO PV-FINAL-GP-DLR      06380000
063900                       MOVE PV-GP-PRC-IDV-PRICE                   06390000
064000                                          TO PV-FINAL-GP-IDV-PRC  06400000
064100                       MOVE PV-GP-PRC-STRT-DTE                    06410000
064200                                      TO PV-FINAL-GP-STRT-DTE     06420000
064300                       MOVE PV-GP-PRC-END-DTE                     06430000
064400                                      TO PV-FINAL-GP-END-DTE      06440000
064500                    END-IF                                        06450000
064600                 END-IF                                           06460000
064700              ELSE                                                06470000
064800                 MOVE PV-GP-PRC-PROMO-ID  TO PV-FINAL-GP-PROMO-ID 06480000
064900                 MOVE PV-GP-PRC-INTFC-ID  TO PV-FINAL-GP-INTFC-ID 06490000
065000                 MOVE PV-GP-PRC-MDSE-LNE-ID TO                    06500000
065100                                          PV-FINAL-GP-MDSE-LNE-ID 06510000
065200                 MOVE PV-GP-PRC-TYP-CDE   TO PV-FINAL-GP-TYP-CDE  06520000
065300                 MOVE PV-GP-PRC-QTY       TO PV-FINAL-GP-QTY      06530000
065400                 MOVE PV-GP-PRC-DLR       TO PV-FINAL-GP-DLR      06540000
065500                 MOVE PV-GP-PRC-IDV-PRICE TO PV-FINAL-GP-IDV-PRC  06550000
065600                 MOVE PV-GP-PRC-STRT-DTE  TO PV-FINAL-GP-STRT-DTE 06560000
065700                 MOVE PV-GP-PRC-END-DTE   TO PV-FINAL-GP-END-DTE  06570000
065800              END-IF                                              06580000
065900           ELSE                                                   06590000
066000              SET PS-GP-PRC-WINS          TO TRUE                 06600000
066100              MOVE PV-RGLR-PRICE          TO PV-FINAL-PRC-DET-PRC 06610000
066200              MOVE PV-GP-PRC-PROMO-ID     TO PV-FINAL-GP-PROMO-ID 06620000
066300              MOVE PV-GP-PRC-INTFC-ID     TO PV-FINAL-GP-INTFC-ID 06630000
066400              MOVE PV-GP-PRC-MDSE-LNE-ID  TO                      06640000
066500                                          PV-FINAL-GP-MDSE-LNE-ID 06650000
066600              MOVE PV-GP-PRC-TYP-CDE      TO PV-FINAL-GP-TYP-CDE  06660000
066700              MOVE PV-GP-PRC-QTY          TO PV-FINAL-GP-QTY      06670000
066800              MOVE PV-GP-PRC-DLR          TO PV-FINAL-GP-DLR      06680000
066900              MOVE PV-GP-PRC-IDV-PRICE    TO PV-FINAL-GP-IDV-PRC  06690000
067000              MOVE PV-GP-PRC-STRT-DTE     TO PV-FINAL-GP-STRT-DTE 06700000
067100              MOVE PV-GP-PRC-END-DTE      TO PV-FINAL-GP-END-DTE  06710000
067200           END-IF                                                 06720000
067300        ELSE                                                      06730000
067400           MOVE ZEROES                  TO PV-FINAL-GP-PROMO-ID   06740000
067500                                           PV-FINAL-GP-INTFC-ID   06750000
067600                                        PV-FINAL-GP-MDSE-LNE-ID   06760000
067700                                           PV-FINAL-GP-QTY        06770000
067800                                           PV-FINAL-GP-DLR        06780000
067900                                           PV-FINAL-GP-IDV-PRC    06790000
068000           MOVE SPACES                  TO PV-FINAL-GP-TYP-CDE    06800000
068100                                           PV-FINAL-GP-STRT-DTE   06810000
068200                                           PV-FINAL-GP-END-DTE    06820000
068300        END-IF                                                    06830000
068400     END-IF.                                                      06840000
068500                                                                  06850000
068600***                                                               06860000
068700*** EBOGO                                                         06870000
068800***                                                               06880000
068900     INITIALIZE PC-CNT-INDX.                                      06890000
069000     PERFORM VARYING TBL-BOGO-INDEX FROM 1 BY 1                   06900000
069100        UNTIL TBL-BOGO-INDEX > PC-CNT-BOGO                        06910000
069200            ADD +1 TO PC-CNT-INDX                                 06920000
069300            IF PC-CNT-INDX = +1                                   06930000
069400               PERFORM 3600-POPULATE-FINAL-BOGO                   06940000
069500            ELSE                                                  06950000
069600               PERFORM 3500-PRICE-DET-FINAL-BOGO                  06960000
069700            END-IF                                                06970000
069800     END-PERFORM.                                                 06980000
069900***                                                               06990000
070000*** WHEN PRICE DETERMINED PRICE IS MORE THAN THE REGULAR          07000000
070100*** PRICE, THE REGULAR PRICE WINS OUT.                            07010000
070200     IF PV-FINAL-PRC-DET-PRC > PV-RGLR-PRICE                      07020000
070300        MOVE PV-RGLR-PRICE TO PV-FINAL-PRC-DET-PRC                07030000
070400        MOVE SPACES        TO PV-FINAL-PRC-TYP-CDE                07040000
070500        MOVE ZEROES        TO PV-FINAL-DET-PROMO-ID               07050000
070600                              PV-FINAL-DET-INTFC-ID               07060000
070700                              PV-FINAL-DET-MDSE-LNE-ID            07070000
070800     END-IF.                                                      07080000
070900                                                                  07090000
071000*** WHEN THE INDIVIDUAL GROUP PRICE IS MORE THAN                  07100000
071100*** THE PRICE DETERMINED PRICE OR THE REGULAR PRICE,              07110000
071200*** GROUP PRICING WILL NOT APPLY TO THIS ITEM THEN                07120000
071300     IF PV-FINAL-GP-IDV-PRC > PV-FINAL-PRC-DET-PRC OR             07130000
071400        PV-FINAL-GP-IDV-PRC > PV-RGLR-PRICE                       07140000
071500        MOVE ZEROES        TO PV-FINAL-GP-QTY                     07150000
071600                              PV-FINAL-GP-DLR                     07160000
071700                              PV-FINAL-GP-PROMO-ID                07170000
071800                              PV-FINAL-GP-INTFC-ID                07180000
071900                              PV-FINAL-GP-MDSE-LNE-ID             07190000
072000        MOVE SPACES        TO PV-FINAL-GP-TYP-CDE                 07200000
072100                              PV-FINAL-GP-STRT-DTE                07210000
072200                              PV-FINAL-GP-END-DTE                 07220000
072300        IF PS-GP-PRC-WINS                                         07230000
072400           MOVE SPACES     TO PV-FINAL-PRC-TYP-CDE                07240000
072500           MOVE ZEROES     TO PV-FINAL-DET-PROMO-ID               07250000
072600                              PV-FINAL-DET-INTFC-ID               07260000
072700                              PV-FINAL-DET-MDSE-LNE-ID            07270000
072800        END-IF                                                    07280000
072900     END-IF.                                                      07290000
073000                                                                  07300000
073100*3000-EXIT.                                                       07310000
073200 EJECT.                                                           07320000
073300                                                                  07330000
073400*----------------------------------------------------------       07340000
073500* 3100-PRICE-DET-FINAL-SMPL.                                      07350000
073600*     PRICE DETERMINATION USED FOR SIMPLE PRICING.                07360000
073700*     IT NARROWS THE SIMPLE PROMOTIONS TO ONE PROMOTION           07370000
073800*     BY GOING THROUGH THE PRICE DETERMINATION RULES              07380000
073900*     ACROSS PROMOTIONS.                                          07390000
074000*----------------------------------------------------------       07400000
074100 3100-PRICE-DET-FINAL-SMPL.                                       07410000
074200                                                                  07420000
074300     EVALUATE TRUE                                                07430000
074400       WHEN TBL-PRICE-DET-PRC(TBL-SMPL-INDEX) <                   07440000
074500                   PV-SMPL-PRC-DET-PRICE                          07450000
074600            PERFORM 3200-POPULATE-FINAL-SMPL                      07460000
074700       WHEN TBL-PRICE-DET-PRC(TBL-SMPL-INDEX) =                   07470000
074800                   PV-SMPL-PRC-DET-PRICE                          07480000
074900            EVALUATE TRUE                                         07490000
075000              WHEN TBL-PROMO-STRT-DTE(TBL-SMPL-INDEX) >           07500000
075100                  PV-SMPL-STRT-DTE                                07510000
075200                   PERFORM 3200-POPULATE-FINAL-SMPL               07520000
075300              WHEN TBL-PROMO-STRT-DTE(TBL-SMPL-INDEX) =           07530000
075400                  PV-SMPL-STRT-DTE                                07540000
075500                   EVALUATE TRUE                                  07550000
075600                     WHEN TBL-PROMO-END-DTE(TBL-SMPL-INDEX) <     07560000
075700                       PV-SMPL-END-DTE                            07570000
075800                          PERFORM 3200-POPULATE-FINAL-SMPL        07580000
075900                     WHEN TBL-PROMO-END-DTE(TBL-SMPL-INDEX) =     07590000
076000                       PV-SMPL-END-DTE                            07600000
076100                          IF TBL-PROMO-INTFC-ID(TBL-SMPL-INDEX)   07610000
076200                           > PV-SMPL-INTFC-ID                     07620000
076300                             PERFORM 3200-POPULATE-FINAL-SMPL     07630000
076400                          END-IF                                  07640000
076500                   END-EVALUATE                                   07650000
076600            END-EVALUATE                                          07660000
076700     END-EVALUATE.                                                07670000
076800                                                                  07680000
076900*3100-EXIT.                                                       07690000
077000 EJECT.                                                           07700000
077100                                                                  07710000
077200*----------------------------------------------------------       07720000
077300* 3200-POPULATE-FINAL-SMPL.                                       07730000
077400*     THIS POPULATES THE WINNING SIMPLE PRICE PROMOTION.          07740000
077500*----------------------------------------------------------       07750000
077600 3200-POPULATE-FINAL-SMPL.                                        07760000
077700                                                                  07770000
077800     MOVE TBL-PROMO-ID(TBL-SMPL-INDEX)       TO                   07780000
077900                             PV-SMPL-PRC-PROMO-ID.                07790000
078000     MOVE TBL-PROMO-INTFC-ID(TBL-SMPL-INDEX) TO                   07800000
078100                             PV-SMPL-INTFC-ID.                    07810000
078200     MOVE TBL-MDSE-LNE-ID(TBL-SMPL-INDEX) TO                      07820000
078300                             PV-SMPL-MDSE-LNE-ID.                 07830000
078400     MOVE TBL-PROMO-STRT-DTE(TBL-SMPL-INDEX) TO                   07840000
078500                             PV-SMPL-STRT-DTE.                    07850000
078600     MOVE TBL-PROMO-END-DTE(TBL-SMPL-INDEX)  TO                   07860000
078700                             PV-SMPL-END-DTE.                     07870000
078800     MOVE TBL-PRICG-TYP-CDE(TBL-SMPL-INDEX)  TO                   07880000
078900                             PV-SMPL-PRC-TYP-CDE.                 07890000
079000     MOVE TBL-MERCH-HEIR-CDE(TBL-SMPL-INDEX) TO                   07900000
079100                           PV-SMPL-HEIR-CDE.                      07910000
079200     MOVE TBL-PRICE-DET-PRC(TBL-SMPL-INDEX)  TO                   07920000
079300                           PV-SMPL-PRC-DET-PRICE.                 07930000
079400                                                                  07940000
079500*3200-EXIT.                                                       07950000
079600 EJECT.                                                           07960000
079700                                                                  07970000
079800*----------------------------------------------------------       07980000
079900* 3300-PRICE-DET-FINAL-GP.                                        07990000
080000*     FINAL PRICE DETERMINATION USED FOR GROUP PRICING.           08000000
080100*     IT NARROWS THE SIMPLE PROMOTIONS TO ONE PROMOTION           08010000
080200*     BY GOING THROUGH THE PRICE DETERMINATION RULES              08020000
080300*     ACROSS PROMOTIONS.                                          08030000
080400*----------------------------------------------------------       08040000
080500 3300-PRICE-DET-FINAL-GP.                                         08050000
080600                                                                  08060000
080700     EVALUATE TRUE                                                08070000
080800       WHEN TBL-GP-INDV-GP-PRC(TBL-GP-INDEX) <                    08080000
080900                   PV-GP-PRC-IDV-PRICE                            08090000
081000            PERFORM 3400-POPULATE-FINAL-GP                        08100000
081100       WHEN TBL-GP-INDV-GP-PRC(TBL-GP-INDEX) =                    08110000
081200                   PV-GP-PRC-IDV-PRICE                            08120000
081300            EVALUATE TRUE                                         08130000
081400              WHEN TBL-GP-GROUP-QTY(TBL-GP-INDEX) <               08140000
081500                PV-GP-PRC-QTY                                     08150000
081600                   PERFORM 3400-POPULATE-FINAL-GP                 08160000
081700              WHEN TBL-GP-GROUP-QTY(TBL-GP-INDEX) =               08170000
081800                PV-GP-PRC-QTY                                     08180000
081900                   EVALUATE TRUE                                  08190000
082000                     WHEN TBL-GP-PROMO-STRT-DTE(TBL-GP-INDEX) >   08200000
082100                       PV-GP-PRC-STRT-DTE                         08210000
082200                          PERFORM 3400-POPULATE-FINAL-GP          08220000
082300                     WHEN TBL-GP-PROMO-STRT-DTE(TBL-GP-INDEX) =   08230000
082400                       PV-GP-PRC-STRT-DTE                         08240000
082500                          EVALUATE TRUE                           08250000
082600                            WHEN TBL-GP-PROMO-END-DTE             08260000
082700                             (TBL-GP-INDEX) < PV-GP-PRC-END-DTE   08270000
082800                                 PERFORM 3400-POPULATE-FINAL-GP   08280000
082900                            WHEN TBL-GP-PROMO-END-DTE             08290000
083000                             (TBL-GP-INDEX) = PV-GP-PRC-END-DTE   08300000
083100                                 IF TBL-GP-PROMO-INTFC-ID         08310000
083200                                  (TBL-GP-INDEX) >                08320000
083300                                  PV-GP-PRC-INTFC-ID              08330000
083400                                    PERFORM 3400-POPULATE-FINAL-GP08340000
083500                                 END-IF                           08350000
083600                          END-EVALUATE                            08360000
083700                   END-EVALUATE                                   08370000
083800            END-EVALUATE                                          08380000
083900     END-EVALUATE.                                                08390000
084000                                                                  08400000
084100*3300-EXIT.                                                       08410000
084200 EJECT.                                                           08420000
084300                                                                  08430000
084400*----------------------------------------------------------       08440000
084500* 3400-POPULATE-FINAL-GP.                                         08450000
084600*     THIS POPULATES THE WINNING GROUP PRICE PROMOTION.           08460000
084700*----------------------------------------------------------       08470000
084800 3400-POPULATE-FINAL-GP.                                          08480000
084900                                                                  08490000
085000     MOVE TBL-GP-PROMO-ID(TBL-GP-INDEX)       TO                  08500000
085100                             PV-GP-PRC-PROMO-ID.                  08510000
085200     MOVE TBL-GP-PROMO-INTFC-ID(TBL-GP-INDEX) TO                  08520000
085300                             PV-GP-PRC-INTFC-ID.                  08530000
085400     MOVE TBL-GP-MDSE-LNE-ID(TBL-GP-INDEX) TO                     08540000
085500                             PV-GP-PRC-MDSE-LNE-ID.               08550000
085600     MOVE TBL-GP-PROMO-STRT-DTE(TBL-GP-INDEX) TO                  08560000
085700                             PV-GP-PRC-STRT-DTE.                  08570000
085800     MOVE TBL-GP-PROMO-END-DTE(TBL-GP-INDEX)  TO                  08580000
085900                             PV-GP-PRC-END-DTE.                   08590000
086000     MOVE TBL-GP-PRICG-TYP-CDE(TBL-GP-INDEX)  TO                  08600000
086100                             PV-GP-PRC-TYP-CDE.                   08610000
086200     MOVE TBL-GP-MERCH-HEIR-CDE(TBL-GP-INDEX) TO                  08620000
086300                             PV-GP-PRC-HEIR-CDE.                  08630000
086400     MOVE TBL-GP-GROUP-QTY(TBL-GP-INDEX)      TO                  08640000
086500                             PV-GP-PRC-QTY.                       08650000
086600     MOVE TBL-GP-GROUP-PRC(TBL-GP-INDEX)      TO                  08660000
086700                             PV-GP-PRC-DLR.                       08670000
086800     MOVE TBL-GP-INDV-GP-PRC(TBL-GP-INDEX)    TO                  08680000
086900                             PV-GP-PRC-IDV-PRICE.                 08690000
087000                                                                  08700000
087100*3400-EXIT.                                                       08710000
087200 EJECT.                                                           08720000
087300                                                                  08730000
087400*----------------------------------------------------------       08740000
087500* 3500-PRICE-DET-FINAL-BOGO.                                      08750000
087600*     FINAL PRICE DETERMINATION USED FOR BOGO PRICING.            08760000
087700*     IT NARROWS THE BOGO PROMOTIONS TO ONE PROMOTION             08770000
087800*     BY GOING THROUGH THE PRICE DETERMINATION RULES              08780000
087900*     ACROSS PROMOTIONS.                                          08790000
088000*----------------------------------------------------------       08800000
088100 3500-PRICE-DET-FINAL-BOGO.                                       08810000
088200                                                                  08820000
088300     EVALUATE TRUE                                                08830000
088400          WHEN TBL-BOGO-PROMO-STRT-DTE(TBL-BOGO-INDEX) >          08840000
088500                PV-GP-PRC-STRT-DTE                                08850000
088600                   PERFORM 3600-POPULATE-FINAL-BOGO               08860000
088700          WHEN TBL-BOGO-PROMO-STRT-DTE(TBL-BOGO-INDEX) =          08870000
088800                PV-GP-PRC-STRT-DTE                                08880000
088900                   EVALUATE TRUE                                  08890000
089000                     WHEN TBL-BOGO-PROMO-END-DTE                  08900000
089100                      (TBL-BOGO-INDEX) < PV-GP-PRC-END-DTE        08910000
089200                          PERFORM 3600-POPULATE-FINAL-BOGO        08920000
089300                     WHEN TBL-BOGO-PROMO-END-DTE                  08930000
089400                      (TBL-BOGO-INDEX) = PV-GP-PRC-END-DTE        08940000
089500                          IF TBL-BOGO-PROMO-INTFC-ID              08950000
089600                           (TBL-BOGO-INDEX) >                     08960000
089700                           PV-GP-PRC-INTFC-ID                     08970000
089800                         PERFORM 3600-POPULATE-FINAL-BOGO         08980000
089900                          END-IF                                  08990000
090000                   END-EVALUATE                                   09000000
090100     END-EVALUATE.                                                09010000
090200                                                                  09020000
090300*3500-EXIT.                                                       09030000
090400 EJECT.                                                           09040000
090500                                                                  09050000
090600*----------------------------------------------------------       09060000
090700* 3600-POPULATE-FINAL-BOGO.                                       09070000
090800*     THIS POPULATES THE WINNING BOGO PRICE PROMOTION.            09080000
090900*----------------------------------------------------------       09090000
091000 3600-POPULATE-FINAL-BOGO.                                        09100000
091100                                                                  09110000
091200     MOVE TBL-BOGO-PROMO-ID(TBL-BOGO-INDEX)   TO                  09120000
091300                             PV-BOGO-PRC-PROMO-ID.                09130000
091400     MOVE TBL-BOGO-PROMO-INTFC-ID(TBL-BOGO-INDEX) TO              09140000
091500                             PV-BOGO-PRC-INTFC-ID.                09150000
091600     MOVE TBL-BOGO-MDSE-LNE-ID(TBL-BOGO-INDEX) TO                 09160000
091700                             PV-BOGO-PRC-MDSE-LNE-ID.             09170000
091800     MOVE TBL-BOGO-PROMO-STRT-DTE(TBL-BOGO-INDEX) TO              09180000
091900                             PV-BOGO-PRC-STRT-DTE.                09190000
092000     MOVE TBL-BOGO-PROMO-END-DTE(TBL-BOGO-INDEX) TO               09200000
092100                             PV-BOGO-PRC-END-DTE.                 09210000
092200     MOVE TBL-BOGO-PRICG-TYP-CDE(TBL-BOGO-INDEX) TO               09220000
092300                             PV-BOGO-PRC-TYP-CDE.                 09230000
092400     MOVE TBL-BOGO-DISC-QTY (TBL-BOGO-INDEX) TO                   09240000
092500                             PV-BOGO-DISC-QTY.                    09250000
092600     MOVE TBL-BOGO-DISC-AMT (TBL-BOGO-INDEX) TO                   09260000
092700                             PV-BOGO-DISC-AMT.                    09270000
092800**      DISPLAY '**3600- PICK FINAL BOGO    **',                  09280000
092900**              '>> BOGO TBL=', TBL-BOGO-INDEX,                   09290000
093000**              '>> PROMO ID=', PV-BOGO-PRC-PROMO-ID,             09300000
093100**              '>> PRICG TYP=', PV-BOGO-PRC-TYP-CDE,             09310000
093200**              '>> DISC QTY=', PV-BOGO-DISC-QTY,                 09320000
093300**              '>> DISC AMT=', PV-BOGO-DISC-AMT, '**'.           09330000
093400                                                                  09340000
093500*3600-EXIT.                                                       09350000
093600 EJECT.                                                           09360000
093700                                                                  09370000
