000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.         OFKUT013.                                    00020000
000300 AUTHOR.             BARB SCHULTZ.                                00030000
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040000
000500 DATE-WRITTEN.       MARCH  2017                                  00050000
000600******************************************************************00060000
000700*When compiling check 'MQSERIES PROGRAM(Y/N)' with 'Y' on second *00070022
000800*compile screen.                                                 *00080000
000900******************************************************************00090000
001000*        SEND INTRANSIT DATA TO OMS APPLICATION                   00100000
001100* This program will take in a file of Assumptively Received       00110000
001200* Cartons and Carton Detail and create XML to be sent to the OMS  00120000
001300* application.                                                    00130000
001400******************************************************************00140000
001500*  CHANGE LOG                                                     00150000
001600*  DATE       CHANGED BY      CHG                                 00160024
001700*  ---------- -------------   ----------                          00170024
173485*  07/20/2017 JIM ARENDT      CHG0173485                          00180024
173485*  ADDED CODE TO COMMENT OUT DISPLAYS OF XML CODE.                00190024
002000******************************************************************00200000
002100 ENVIRONMENT DIVISION.                                            00210000
002200 CONFIGURATION SECTION.                                           00220000
002300 SOURCE-COMPUTER.    IBM-3090.                                    00230000
002400 OBJECT-COMPUTER.    IBM-3090.                                    00240000
002500                                                                  00250000
002600 INPUT-OUTPUT SECTION.                                            00260000
002700 FILE-CONTROL.                                                    00270000
002800     SELECT INTRANSIT-FILE        ASSIGN TO IN01.                 00280000
002900                                                                  00290000
003000******************************************************************00300000
003100 DATA DIVISION.                                                   00310000
003200 FILE SECTION.                                                    00320000
003300                                                                  00330000
003400 FD  INTRANSIT-FILE                                               00340000
003500     RECORDING MODE IS F                                          00350000
003600     LABEL RECORDS ARE STANDARD                                   00360000
003700     BLOCK CONTAINS 0 RECORDS.                                    00370000
003800 01  INTRANSIT-RECORD            PIC X(200).                      00380000
003900                                                                  00390000
004000******************************************************************00400000
004100 WORKING-STORAGE SECTION.                                         00410000
004200******************************************************************00420000
004300 01  PS-PROGRAM-SWITCHES.                                         00430000
004400     05  PS-END-OF-INTRANSIT-REC     PIC X(01) VALUE 'N'.         00440000
004500         88  PS-END-OF-INTRANSIT-REC-Y         VALUE 'Y'.         00450000
004600         88  PS-END-OF-INTRANSIT-REC-N         VALUE 'N'.         00460000
004700     05  PS-END-OF-MQ-CSR            PIC X(01) VALUE 'N'.         00470000
004800         88  PS-END-OF-MQ-CSR-Y                VALUE 'Y'.         00480000
004900         88  PS-END-OF-MQ-CSR-N                VALUE 'N'.         00490000
005000     05  PS-MQPUT-SUCCESSFUL-IND     PIC X(01) VALUE SPACES.      00500000
005100         88  PS-MQPUT-SUCCESSFUL               VALUE 'Y'.         00510000
005200                                                                  00520000
005300 01  PA-PROGRAM-ACCUMULATORS.                                     00530000
005400     05  PA-TOTAL-MQ-MSGS-SENT       PIC S9(9) VALUE +0 COMP-3.   00540000
005500                                                                  00550000
005600 01  PV-PROGRAM-VARIABLES.                                        00560000
005700     05  PV-OTBND-TRIP-ID            PIC S9(09) VALUE 0 COMP.     00570012
005800     05  PV-SHIPT-UNT-ID             PIC 9(18)V VALUE 0 COMP.     00580000
005900     05  PV-COUNTER                  PIC 9(05) VALUE ZEROES.      00590000
006000     05  PV-INTRANSIT-SENT-TO-QUE    PIC 9(05) VALUE ZEROES.      00600000
006100     05  PV-MQ-CNT                   PIC 9(05) VALUE ZEROES.      00610000
006200     05  PV-MQ-TBL-CNT               PIC 9(05) VALUE ZEROES.      00620000
006300     05  PV-MQ-HANDLE-CNT            PIC 9(05) VALUE ZEROES.      00630000
006400     05  PV-CNT                      PIC 9(05) VALUE ZEROES.      00640000
006500     05  PV-RETRY-COUNTER            PIC S9(4) VALUE +0 COMP SYNC.00650000
006600     05  PV-HOLD-COMPLETION-CODE     PIC S9(9) BINARY.            00660000
006700     05  PV-HOLD-REASON              PIC S9(9) BINARY.            00670000
006800     05  PV-HOLD-PROCESS-TYPE        PIC X(16) VALUE SPACES.      00680000
006900     05  PV-XML-BANNER               PIC X(39) VALUE              00690000
007000         '<?xml version="1.0" encoding="UTF-8" ?>'.               00700000
007100     05  PV-ORDER-TYPE               PIC X(16) VALUE              00710000
007200         'TRAILER_MANIFEST'.                                      00720000
007300     05  PV-DOCUMENT-TYPE            PIC X(04) VALUE              00730000
007400         '0005'.                                                  00740000
007500     05  PV-BUYER-ORG-CODE           PIC X(09) VALUE              00750000
007600         'KOHLS.COM'.                                             00760000
007700     05  PV-PERSON-INFO-BILL-TO      PIC X(02) VALUE 'US'.        00770000
007800     05  PV-VALIDATE-ITEM            PIC X(01) VALUE 'N'.         00780000
007900     05  PV-PRODUCT-CLASS            PIC X(04) VALUE 'Good'.      00790000
008000     05  PV-UNIT-OF-MEASURE          PIC X(04) VALUE 'EACH'.      00800000
008100     05  PV-LNE-PRICE-ONLY           PIC X(01) VALUE 'Y'.         00810000
008200     05  PV-COMBINED-TRIP-SHIPT.                                  00820000
008300         10 PV-OTBND-TRIP-ID-CONC    PIC 9(09).                   00830000
008400         10 FILLER                   PIC X(01) VALUE '-'.         00840000
008500         10 PV-SHIPT-UNT-ID-CONC     PIC 9(18).                   00850000
008600     05  PV-ORDER-TRIP-SHIPT-STORE.                               00860022
008700         10 PV-ORDER-OTBND-TRIP-ID   PIC 9(09).                   00870022
008800         10 FILLER                   PIC X(01) VALUE '-'.         00880022
008900         10 PV-ORDER-SHIPT-UNT-ID    PIC 9(18).                   00890022
009000         10 FILLER                   PIC X(01) VALUE '-'.         00900022
009100         10 PV-ORDER-STORE           PIC 9(4).                    00910022
009200                                                                  00920000
009300 01  ABEND-CODE                      PIC S9(4) VALUE +0 COMP SYNC.00930000
009400 01  PV-HOLD-MSGBUFFER.                                           00940000
009500     05  PV-MSGBUFFER-CHAR OCCURS   500000 TIMES                  00950000
009600                                     PIC X(01).                   00960000
009700 01  PV-ABEND-VARIABLES.                                          00970000
009800     05  PV-SQLCODE                  PIC S9(9).                   00980000
009900     05  PV-DISPLAY-SQLCODE          PIC -------999.              00990000
010000     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'OFKUT013'.  01000000
010100     05  PV-ABEND-PARAGRAPH          PIC X(25) VALUE SPACES.      01010000
010200     05  PV-ABEND-OPERATION          PIC X(20) VALUE SPACES.      01020000
010300     05  PV-ABEND-STRUCTURE-1        PIC X(08) VALUE SPACES.      01030000
010400     05  PV-DB2-OPERATION-MESSAGE-1  PIC X(79) VALUE SPACES.      01040000
010500     05  PV-ABEND-CODE               PIC S9(4) VALUE +0 COMP SYNC.01050000
010600     05  PV-TMST-EXP.                                             01060002
010700         10  PV-PTE-DATE             PIC X(10) VALUE SPACES.      01070002
010800         10  FILLER                  PIC X(01) VALUE spaces.      01080021
010900         10  PV-PTE-TIME.                                         01090002
011000             15  PV-PTE-HH           PIC X(02) VALUE SPACES.      01100002
011100             15  FILLER              PIC X(01) VALUE SPACES.      01110002
011200             15  PV-PTE-MM           PIC X(02) VALUE SPACES.      01120002
011300             15  FILLER              PIC X(01) VALUE SPACES.      01130002
011400             15  PV-PTE-SS           PIC X(02) VALUE SPACES.      01140002
011500         10  FILLER                  PIC X(07) VALUE SPACES.      01150002
011600     05  PV-ORACLE-TMST.                                          01160002
011700         10  PV-POT-DATE             PIC X(10) VALUE SPACES.      01170002
011800         10  FILLER                  PIC X(01) VALUE 'T'.         01180002
011900         10  PV-POT-TIME.                                         01190002
012000             15  PV-POT-HH           PIC X(02) VALUE SPACES.      01200002
012100             15  FILLER              PIC X(01) VALUE ':'.         01210002
012200             15  PV-POT-MM           PIC X(02) VALUE SPACES.      01220002
012300             15  FILLER              PIC X(01) VALUE ':'.         01230002
012400             15  PV-POT-SS           PIC X(02) VALUE SPACES.      01240002
012500                                                                  01250000
012600     05  DK-PO-RCVR-NBR-N                 PIC 9(09) VALUE ZEROES. 01260000
012700     05  DK-PO-RCVR-NBR-X REDEFINES DK-PO-RCVR-NBR-N.             01270000
012800         10  FILLER                       PIC X(01).              01280000
012900         10  DK-RCVR-NBR-X                PIC X(08).              01290000
013000     05  DK-RCVR-NBR-9                    PIC 9(09) VALUE ZEROES. 01300000
013100     05  DK-PO-RCVR-NBR-9X REDEFINES DK-RCVR-NBR-9.               01310000
013200         10  FILLER                       PIC X(06).              01320000
013300         10  DK-RCVR-NBR-3                PIC X(03).              01330000
013400                                                                  01340000
013500***************************************************************** 01350000
013600*    SAVE AREA FOR DETAIL INFORMATION TO CREATE XML             * 01360000
013700***************************************************************** 01370000
013800 01  PD-ORD-LNE-NBR                  PIC S9(09) COMP.             01380000
013900 01  PD-COUNT                        PIC 9(05)  VALUE 0.          01390000
014000 01  PD-MAX                          PIC 9(08)  VALUE 0.          01400000
014100 01  PD-DETAIL-AREA.                                              01410000
014200     05  PD-DTL-ENTRIES OCCURS 999 TIMES.                         01420000
014300         10  PD-RECV-NODE            PIC S9(4) VALUE ZERO.        01430000
014400         10  PD-SHIP-NODE            PIC S9(4) VALUE ZERO.        01440000
014500         10  PD-QTY                  PIC S9(4) VALUE ZERO.        01450000
014600         10  PD-VAR1                 PIC 9(18)V VALUE 0 COMP.     01460000
014700         10  PD-VAR2                 PIC 9(09) VALUE ZERO.        01470000
014800         10  PD-VAL-ITEM             PIC X(01).                   01480000
014900         10  PD-TRN-NBR              PIC 9(08) VALUE ZERO.        01490000
015000         10  PD-RCVR-SEQ-NBR         PIC 9(03) VALUE ZERO.        01500000
015100         10  PD-ITEM-ID              PIC s9(8)V VALUE 0 COMP.     01510000
015200         10  PD-PROD-CLASS           PIC X(04).                   01520000
015300         10  PD-UNT-MEASUR           PIC X(04).                   01530000
015400         10  PD-LNE-PRICE-ONLY       PIC X(01).                   01540000
015500         10  PD-RETAIL-PRICE         PIC 9(08)V99 VALUE ZERO.     01550000
015600         10  PD-UNIT-PRICE           PIC 9(07)V99 VALUE ZERO.     01560000
015700                                                                  01570000
015800***************************************************************** 01580000
015900*    RECORD PURPOSE: INTRANSIT Extract (for XML conversion)       01590000
016000* The lines in the next 01 level need to start w/capitol and    * 01600000
016100* end with lower case for the XML to work.                        01610000
016200***************************************************************** 01620000
016300                                                                  01630000
016400 01  AssumptiveReceive.                                           01640000
016500      05  BaseDropStatus               PIC X(09)                  01650000
016600                                           VALUE '3900.0001'.     01660000
016700      05  ChangeForAllAvailableQty     PIC X(01) VALUE 'Y'.       01670000
016800      05  DocumentType                 PIC X(04) VALUE '0005'.    01680000
016900      05  EnterpriseCode               PIC X(03) VALUE SPACES.    01690000
017000      05  OrderNo                      PIC X(33) VALUE SPACES.    01700022
017100      05  TransactionId                PIC X(28)                  01710000
017200                         VALUE 'UPDATE_CARTON_SUPPLY.0005.ex'.    01720000
017300      05  OutboundTripId               PIC X(09) VALUE SPACES.    01730000
017400      05  Store                        PIC 9(18)V VALUE 0 COMP.   01740000
017500      05  CustomAttributes.                                       01750018
017600          10  Text1                    PIC X(12) value spaces.    01760018
017700          10  Text2                    PIC 9(09) value zeroes.    01770018
017800          10  Text3                    PIC X(20) value spaces.    01780018
017900          10  Text4                    PIC X(04) value spaces.    01790018
018000          10  Text5                    PIC X(03) value spaces.    01800018
018100          10  Text6                    PIC 9(18) value zeroes.    01810018
018200          10  Text7                    PIC X(26) value spaces.    01820018
018300          10  Text8                    PIC X(19) value spaces.    01830018
018400      05  OrderLines.                                             01840000
018500          10  OrderLine occurs 0 to 99999 times                   01850000
018600                       DEPENDING ON PD-COUNT.                     01860000
018700              15  OrderedQty           PIC S9(4) VALUE ZERO.      01870000
018800              15  ReceivingNode        PIC S9(4) VALUE ZERO.      01880000
018900              15  Item.                                           01890000
019000                  20  ItemID           PIC X(08) VALUE SPACES.    01900000
019100                  20  ProductClass     PIC X(04) VALUE 'Good'.    01910000
019200                  20  UnitOfMeasure    PIC X(04) VALUE 'Each'.    01920000
019300              15  LinePriceInfo.                                  01930000
019400                  20  UnitPrice        PIC 9(07)V999.             01940000
019500                  20  IsLinePriceForInformationOnly               01950000
019600                                       PIC X(01) VALUE 'Y'.       01960000
019700                  20  RetailPrice      PIC 9(08)v99.              01970000
019800              15  CustomerPONo         PIC X(09) VALUE SPACES.    01980000
019900              15  CustomerLinePONo     PIC X(03) VALUE SPACES.    01990000
020000                                                                  02000000
020100 01  PV-XML                      PIC X(500000)   VALUE SPACES.    02010000
020200 01  PV-DISPLAY                  PIC X(132)      VALUE SPACES.    02020000
020300 01  XML-LENGTH                  PIC 9(9)    COMP.                02030000
020400                                                                  02040000
020500     COPY ISWS007.                                                02050000
020600     COPY ISWS008.                                                02060000
020700     COPY ISWS009.                                                02070000
020800                                                                  02080000
020900***************************************************************** 02090000
021000* FILE OPEN STATUS'S ON THE CONTROL CARDS USED FOR GETTING        02100000
021100* MQ-SERIES QUEUE MANAGER AND QUEUE NAME.                         02110000
021200***************************************************************** 02120000
021300                                                                  02130000
021400 01  PE-MQ-ABEND-VARIABLES.                                       02140000
021500     05  PE-MQ-QMANAGER              PIC X(05) VALUE SPACES.      02150000
021600     05  PE-MQ-QMANAGER-REMOTE       PIC X(30) VALUE SPACES.      02160000
021700     05  PE-MQ-QNAME                 PIC X(48) VALUE SPACES.      02170000
021800     05  PE-MQ-COMPLETION-CODE       PIC 9(04) VALUE ZEROES.      02180000
021900     05  PE-MQ-REASON-CODE           PIC 9(04) VALUE ZEROES.      02190000
022000                                                                  02200000
022100******************************************************************02210000
022200*  DB2 FORMATTED MESSAGE AREA                                     02220000
022300******************************************************************02230000
022400     COPY DPWS004.                                                02240000
022500                                                                  02250000
022600******************************************************************02260000
022700*  INPUT FILE                                                     02270000
022800******************************************************************02280000
022900     COPY OFRD012.                                                02290003
023000                                                                  02300000
023100******************************************************************02310000
023200*  COMMUNICATIONS AREA FOR DB2                                    02320000
023300******************************************************************02330000
023400     EXEC SQL                                                     02340000
023500          INCLUDE SQLCA                                           02350000
023600     END-EXEC.                                                    02360000
023700                                                                  02370000
023800******************************************************************02380000
023900*  DB2 DECLARATION - WMOS - Provider Queue information (Put/Write)02390000
024000*      TABLE (WSV_PRVDR_QUE)                                      02400000
024100******************************************************************02410000
024200     EXEC SQL                                                     02420000
024300         INCLUDE WSV00005                                         02430000
024400     END-EXEC.                                                    02440000
024500                                                                  02450000
024600******************************************************************02460000
024700* COBOL CURSOR DELCARATION TO READ MQ INFORMATION                *02470000
024800******************************************************************02480000
024900     EXEC SQL                                                     02490000
025000        DECLARE MQ-CSR CURSOR WITH HOLD FOR                       02500000
025100        SELECT A.INTGRTN_TYP_DESC                                 02510000
025200             , A.LCL_QUE_MGR                                      02520000
025300             , A.RMT_QUE_MGR                                      02530000
025400             , A.QUE_NM                                           02540000
025500          FROM WSV_PRVDR_QUE A                                    02550000
025600         WHERE A.APPL_FUNC_DESC    = 'QUEUE'                      02560000
025700           AND A.INTGRTN_TYP_CDE   = 'OMSMFSTQ'                   02570000
025800     END-EXEC.                                                    02580000
025900                                                                  02590000
026000****************************************************************  02600000
026100**     MQ SERIES WORKING STORAGE                                  02610000
026200**         MQ COPYBOOKS                                           02620000
026300****************************************************************  02630000
026400 01  MQM-OBJECT-DESCRIPTOR.                                       02640000
026500     COPY CMQODV.                                                 02650000
026600                                                                  02660000
026700 01  MQM-MESSAGE-DESCRIPTOR.                                      02670000
026800     COPY CMQMDV.                                                 02680000
026900                                                                  02690000
027000 01  MQM-PUT-MESSAGE-OPTIONS.                                     02700000
027100     COPY CMQPMOV.                                                02710000
027200                                                                  02720000
027300 01  MQM-GET-MESSAGE-OPTIONS.                                     02730000
027400     COPY CMQGMOV.                                                02740000
027500                                                                  02750000
027600 01  MQM-CONSTANTS.                                               02760000
027700     COPY CMQV.                                                   02770000
027800                                                                  02780000
027900****************************************************************  02790000
028000** CONTROL CARDS FOR QUEUE MANAGER AND QUEUE NAME                 02800000
028100****************************************************************  02810000
028200 01  CC-CONTROL-CARD-1.                                           02820000
028300     05  CC-QMGR-NAME-REMOTE         PIC X(50).                   02830000
028400                                                                  02840000
028500 01  CC-CONTROL-CARD-2.                                           02850000
028600     05  CC-TRANS-QUEUE-NAME         PIC X(50).                   02860000
028700                                                                  02870000
028800 01  CC-CONTROL-CARD-4.                                           02880000
028900     05  CC-QMGR-NAME                PIC X(50).                   02890000
029000                                                                  02900000
029100****************************************************************  02910000
029200*  MQ SERIES CONSTANTS FOR CALLING MODULES SUCH AS GET AND    **  02920000
029300*  OPEN, CONNECT, DISCONNECT.                                     02930000
029400****************************************************************  02940000
029500 01  MQ-WORKING-STORAGE.                                          02950000
029600     05  PC-MQCONN                   PIC X(08) VALUE 'CSQBCONN'.  02960000
029700     05  PC-MQOPEN                   PIC X(08) VALUE 'CSQBOPEN'.  02970000
029800     05  PC-MQINQ                    PIC X(08) VALUE 'CSQBINQ'.   02980000
029900     05  PC-MQPUT                    PIC X(08) VALUE 'CSQBPUT'.   02990000
030000     05  PC-MQGET                    PIC X(08) VALUE 'CSQBGET'.   03000000
030100     05  PC-MQCMIT                   PIC X(08) VALUE 'CSQBCOMM'.  03010000
030200     05  PC-MQBACK                   PIC X(08) VALUE 'CSQBBACK'.  03020000
030300     05  PC-MQCLOSE                  PIC X(08) VALUE 'CSQBCLOS'.  03030000
030400     05  PC-MQDISC                   PIC X(08) VALUE 'CSQBDISC'.  03040000
030500     05  PC-TRANS-QNAME              PIC X(48) VALUE SPACES.      03050000
030600     05  PC-QMGR-NAME                PIC X(04) VALUE SPACES.      03060000
030700         88  PC-PROD-QMGR-NAME                 VALUE 'QKSP'.      03070000
030800         88  PC-ACCEPT-QMGR-NAME               VALUE 'QKSQ'.      03080000
030900         88  PC-TEST-QMGR-NAME                 VALUE 'QKST'.      03090000
031000                                                                  03100000
031100****************************************************************  03110000
031200** QUEUE MANAGER HANDLE                                           03120000
031300*  QUEUE HANDLE                                                   03130000
031400****************************************************************  03140000
031500 01 PV-MQ-PROGRAM-HANDLES.                                        03150000
031600     05  PV-QM-NAME                  PIC X(48).                   03160000
031700     05  PV-QM-NAME-REMOTE           PIC X(48).                   03170000
031800     05  PV-HCONN                    PIC S9(9) BINARY VALUE 0.    03180000
031900     05  PV-PQ-HANDLE                PIC S9(9) BINARY VALUE 0.    03190000
032000                                                                  03200000
032100****************************************************************  03210000
032200* ERROR PROCESSING VARIABLES                                      03220000
032300* CODES FROM CALLS ARE STORED HERE                                03230000
032400****************************************************************  03240000
032500 01 PV-MQ-PROGRAM-VARIABLES.                                      03250000
032600     05  PV-COMPLETION-CODE          PIC S9(9) BINARY.            03260000
032700     05  PV-REASON                   PIC S9(9) BINARY.            03270000
032800     05  PV-CON-REASON               PIC S9(9) BINARY.            03280000
032900     05  PV-MQCHECK                  PIC X(08) VALUE 'MQR2C'.     03290000
033000     05  PV-ERROR-MESSAGE            PIC X(48) VALUE SPACES.      03300000
033100     05  PV-OPEN-OPTIONS             PIC S9(9) BINARY.            03310000
033200     05  PV-MQ-REASON-TEXT           PIC X(30) VALUE SPACES.      03320000
033300     05  PV-SHIPPED-TMST-OUT         PIC X(19).                   03330000
033400     05  PV-SHIPPED-TMST-OUT-R       REDEFINES                    03340000
033500         PV-SHIPPED-TMST-OUT.                                     03350000
033600         10  PV-SHIPPED-DATE         PIC X(10).                   03360000
033700         10  PV-T                    PIC X(01).                   03370000
033800         10  PV-SHIPPED-TIME         PIC X(08).                   03380000
033900                                                                  03390000
034000     05  PV-SHIPPED-TMST             PIC X(26).                   03400000
034100     05  PV-SHIPPED-TMST-DATE-HHMM   REDEFINES                    03410000
034200         PV-SHIPPED-TMST.                                         03420000
034300         10  PV-SHIPPED-CCYY         PIC X(04).                   03430000
034400         10  FILLER                  PIC X(01).                   03440000
034500         10  PV-SHIPPED-MM           PIC X(02).                   03450000
034600         10  FILLER                  PIC X(01).                   03460000
034700         10  PV-SHIPPED-DD           PIC X(02).                   03470000
034800         10  FILLER                  PIC X(01).                   03480000
034900         10  PV-SHIPPED-HH           PIC X(02).                   03490000
035000         10  FILLER                  PIC X(01).                   03500000
035100         10  PV-SHIPPED-MN           PIC X(02).                   03510000
035200         10  FILLER                  PIC X(01).                   03520000
035300         10  PV-SHIPPED-SC           PIC X(02).                   03530000
035400         10  FILLER                  PIC X(07).                   03540000
035500     05  PV-RETRY-COUNTER            PIC S9(4) VALUE +0 COMP SYNC.03550000
035600     05  PV-PARAGRAPH                PIC X(48) VALUE SPACES.      03560000
035700     05  PV-MSG-LENGTH               PIC S9(9) BINARY.            03570000
035800     05  PV-DC-NBR                   PIC 9(04).                   03580000
035900     05  PV-MSG-LENGTH-DISPLAY       PIC S9(9).                   03590000
036000     05  PV-MSGBUFFER.                                            03600000
036100         10  PV-MSGBUFFER-banner     PIC X(39) VALUE SPACES.      03610000
036200         10  PV-MSGBUFFER-data       PIC X(999999) VALUE SPACES.  03620000
036300                                                                  03630000
036400 01  PC-PROGRAM-CONSTANTS.                                        03640000
036500     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'OFKUT013'.  03650000
036600     05  PC-MAX-RETRIES              PIC S9(3) VALUE +5 COMP-3.   03660000
036700     05  PC-READY                    PIC X(06) VALUE 'READY '.    03670000
036800     05  PC-ERROR                    PIC X(06) VALUE 'ERROR '.    03680000
036900     05  PC-WAIT-15-SECS             PIC S9(9) VALUE 1500.        03690000
037000     05  PC-MQPUT-RETRY-COUNTER      PIC 9(3)  VALUE ZERO.        03700000
037100     05  PC-DELAY-INTERVAL.                                       03710000
037200         10  FILLER                  PIC X(2)  VALUE SPACES.      03720000
037300         10  PC-DELAY-TIME           PIC 9(8)  VALUE 3000.        03730000
037400****************************************************************  03740000
037500* RETURN CODES ARE EVALUATED AND THIS SWITCH IS USED TO           03750000
037600* INDICATE ANY ERRORS (THIS SWITCH MAY NOT BE USED SINCE THE      03760000
037700* PROGRAM ABENDS BEFORE IT IS USED ANYWHERE)                      03770000
037800****************************************************************  03780000
037900 01 PV-MQ-PROGRAM-SWITCHES.                                       03790000
038000     05  PS-MQ-ERROR-SW              PIC X(01) VALUE 'N'.         03800000
038100         88  PS-NO-MQ-ERROR                    VALUE 'N'.         03810000
038200         88  PS-MQ-ERROR                       VALUE 'Y'.         03820000
038300 01  PV-MQ-INFO-FOR-DIFF-DCS.                                     03830000
038400     05  MQ-INFO OCCURS 1 TO 20 TIMES                             03840000
038500                      DEPENDING ON PV-MQ-CNT.                     03850000
038600        10 MQ-INTGRTN-TYP-DESC        PIC X(50).                  03860000
038700        10 MQ-QMGR-NAME               PIC X(50).                  03870000
038800        10 MQ-QMGR-NAME-REMOTE        PIC X(50).                  03880000
038900        10 MQ-TRANS-QUEUE-NAME        PIC X(50).                  03890000
039000 01  PV-MQ-HANDLE-FOR-DIFF-DCS.                                   03900000
039100     05  PV-MQ-HANDLE-INFO OCCURS 1 TO 20 TIMES                   03910000
039200                      DEPENDING ON PV-MQ-HANDLE-CNT.              03920000
039300        10 PV-MQ-HANDLE-HOLD  PIC S9(9) BINARY VALUE 0.           03930000
039400                                                                  03940000
039500****************************************************************  03950000
039600 PROCEDURE DIVISION.                                              03960000
039700*                                                                 03970000
039800 0000-MAINLINE.                                                   03980000
039900     DISPLAY '************ START OF OFKUT013 ***************'     03990000
040000                                                                  04000000
040100     PERFORM 1000-INITIALIZE.                                     04010000
040200                                                                  04020000
040300     MOVE ZEROES TO PV-COUNTER                                    04030000
040400                    PV-INTRANSIT-SENT-TO-QUE                      04040000
040500                    PV-MQ-CNT.                                    04050000
040600                                                                  04060000
040700     SET PS-END-OF-INTRANSIT-REC-N                                04070000
040800         PS-END-OF-MQ-CSR-N TO TRUE.                              04080000
040900                                                                  04090000
041000     READ INTRANSIT-FILE INTO OF012-EXTRACT-RECORD                04100001
041100          AT END SET PS-END-OF-INTRANSIT-REC-Y TO TRUE.           04110000
041200                                                                  04120000
041300     PERFORM 1100-SET-FIRST-TRIP.                                 04130000
041400                                                                  04140000
041500     PERFORM 2000-PROCESS-INTRANSIT-RECORDS                       04150000
041600       UNTIL PS-END-OF-INTRANSIT-REC-Y.                           04160000
041700                                                                  04170000
041800*CLOSE THE MULTIPLE OPEN QUEUES.                                  04180000
041900     PERFORM 1500-MQ-QUEUE-CLOSE.                                 04190000
042000                                                                  04200000
042100*DISCONNECT FROM THE QMGR.                                        04210000
042200     PERFORM 1600-DISCONNECT-QMGR.                                04220000
042300                                                                  04230000
042400* END OF JOB ROUTINE.                                             04240000
042500     PERFORM 9000-EOJ-ROUTINE.                                    04250000
042600                                                                  04260000
042700     DISPLAY '************  END OF OFKUT013  ***************'     04270000
042800     STOP RUN.                                                    04280000
042900                                                                  04290000
043000******************************************************************04300000
043100*           INITIALIZATION                                        04310000
043200******************************************************************04320000
043300 1000-INITIALIZE.                                                 04330000
043400                                                                  04340000
043500*READ MQ CONTROL CARDS.                                           04350000
043600                                                                  04360000
043700     PERFORM 1200-GET-MQ-QUEUE-INFO.                              04370000
043800     MOVE WSV00005-INTGRTN-TYP-DESC                               04380000
043900            TO MQ-INTGRTN-TYP-DESC(PV-MQ-CNT).                    04390000
044000     MOVE CC-QMGR-NAME                                            04400000
044100            TO MQ-QMGR-NAME(PV-MQ-CNT).                           04410000
044200     MOVE CC-QMGR-NAME-REMOTE                                     04420000
044300            TO MQ-QMGR-NAME-REMOTE(PV-MQ-CNT).                    04430000
044400     MOVE CC-TRANS-QUEUE-NAME                                     04440000
044500            TO MQ-TRANS-QUEUE-NAME(PV-MQ-CNT).                    04450000
044600                                                                  04460000
044700*CONNECT TO QUEUE MANAGER ONLY ONCE.                              04470000
044800                                                                  04480000
044900     PERFORM 1300-MQ-CONNECT-TO-QMGR.                             04490000
045000                                                                  04500000
045100*OPEN THE MULTIPLE QUEUES FOR PUTS                                04510000
045200                                                                  04520000
045300     PERFORM 1400-MQ-QUEUE-OPEN.                                  04530000
045400                                                                  04540000
045500     OPEN  INPUT INTRANSIT-FILE.                                  04550000
045600                                                                  04560000
045700 1100-SET-FIRST-TRIP.                                             04570000
045800                                                                  04580000
045900     MOVE OF012-OTBND-TRIP-ID TO PV-OTBND-TRIP-ID.                04590005
046000     MOVE OF012-SHIPT-UNT-ID  TO PV-SHIPT-UNT-ID.                 04600005
046100     PERFORM 2050-MOVE-HEADER.                                    04610000
046200                                                                  04620000
046300     MOVE 0 TO PD-COUNT.                                          04630000
046400     MOVE 0 TO PD-ORD-LNE-NBR.                                    04640000
046500                                                                  04650000
046600****************************************************************  04660000
046700* GET MQ INFORMATION FROM DB2 TABLES.                             04670000
046800****************************************************************  04680000
046900 1200-GET-MQ-QUEUE-INFO.                                          04690000
047000                                                                  04700000
047100     PERFORM 1210-OPEN-MQ-CSR.                                    04710000
047200                                                                  04720000
047300     PERFORM 1220-FETCH-MQ-CURSOR UNTIL                           04730000
047400           PS-END-OF-MQ-CSR-Y.                                    04740000
047500                                                                  04750000
047600     PERFORM 1225-CLOSE-MQ-CURSOR.                                04760000
047700                                                                  04770000
047800****************************************************************  04780000
047900* OPEN MQ CURSOR.                                                 04790000
048000****************************************************************  04800000
048100 1210-OPEN-MQ-CSR.                                                04810000
048200                                                                  04820000
048300     EXEC SQL                                                     04830000
048400         OPEN MQ-CSR                                              04840000
048500     END-EXEC.                                                    04850000
048600                                                                  04860000
048700     EVALUATE TRUE                                                04870000
048800       WHEN SQLCODE = ZERO                                        04880000
048900           SET PS-END-OF-MQ-CSR-N TO TRUE                         04890000
049000                                                                  04900000
049100       WHEN OTHER                                                 04910000
049200           MOVE '1210-OPEN-MQ-CURSOR' TO PV-ABEND-PARAGRAPH       04920000
049300           MOVE 'OPEN MQ-CSR'         TO PV-ABEND-OPERATION       04930000
049400           PERFORM 9900-DB2-ABEND                                 04940000
049500     END-EVALUATE.                                                04950000
049600                                                                  04960000
049700****************************************************************  04970000
049800* FETCH MQ INFORMATION FOR PUTS.                                  04980000
049900****************************************************************  04990000
050000 1220-FETCH-MQ-CURSOR.                                            05000000
050100                                                                  05010000
050200     EXEC SQL                                                     05020000
050300         FETCH MQ-CSR                                             05030000
050400          INTO                                                    05040000
050500              :WSV00005-INTGRTN-TYP-DESC                          05050000
050600             ,:CC-QMGR-NAME                                       05060000
050700             ,:CC-QMGR-NAME-REMOTE                                05070000
050800             ,:CC-TRANS-QUEUE-NAME                                05080000
050900     END-EXEC.                                                    05090000
051000                                                                  05100000
051100     EVALUATE TRUE                                                05110000
051200       WHEN SQLCODE = ZERO                                        05120000
051300                                                                  05130000
051400           DISPLAY 'QMGR-NAME-REMOTE:' CC-QMGR-NAME-REMOTE        05140000
051500           DISPLAY 'TRANS-QUEUE-NAME:' CC-TRANS-QUEUE-NAME        05150000
051600                                                                  05160000
051700           ADD 1 TO PV-MQ-CNT                                     05170000
051800                                                                  05180000
051900                                                                  05190000
052000           MOVE WSV00005-INTGRTN-TYP-DESC                         05200000
052100                  TO MQ-INTGRTN-TYP-DESC(PV-MQ-CNT)               05210000
052200           MOVE CC-QMGR-NAME                                      05220000
052300                  TO MQ-QMGR-NAME(PV-MQ-CNT)                      05230000
052400           MOVE CC-QMGR-NAME-REMOTE                               05240000
052500                  TO MQ-QMGR-NAME-REMOTE(PV-MQ-CNT)               05250000
052600           MOVE CC-TRANS-QUEUE-NAME                               05260000
052700                  TO MQ-TRANS-QUEUE-NAME(PV-MQ-CNT)               05270000
052800                                                                  05280000
052900       WHEN SQLCODE = +100                                        05290000
053000           SET PS-END-OF-MQ-CSR-Y TO TRUE                         05300000
053100                                                                  05310000
053200       WHEN OTHER                                                 05320000
053300           MOVE '1220-FETCH-MQ-CURSOR' TO PV-ABEND-PARAGRAPH      05330000
053400           MOVE 'FETCH MQ-CSR'         TO PV-ABEND-OPERATION      05340000
053500           PERFORM 9900-DB2-ABEND                                 05350000
053600     END-EVALUATE.                                                05360000
053700                                                                  05370000
053800******************************************************************05380000
053900 1225-CLOSE-MQ-CURSOR.                                            05390000
054000                                                                  05400000
054100     EXEC SQL                                                     05410000
054200         CLOSE MQ-CSR                                             05420000
054300     END-EXEC.                                                    05430000
054400                                                                  05440000
054500     EVALUATE TRUE                                                05450000
054600       WHEN SQLCODE = ZERO                                        05460000
054700       DISPLAY ' TOTAL MQ PUTS:' PV-MQ-CNT                        05470000
054800           CONTINUE                                               05480000
054900                                                                  05490000
055000       WHEN OTHER                                                 05500000
055100           MOVE '1225-CLOSE-MQ-CURSOR' TO PV-ABEND-PARAGRAPH      05510000
055200           MOVE 'CLOSE MQ-CSR'         TO PV-ABEND-OPERATION      05520000
055300           PERFORM 9900-DB2-ABEND                                 05530000
055400     END-EVALUATE.                                                05540000
055500                                                                  05550000
055600****************************************************************  05560000
055700** CONNECT TO THE MULTIPLE QUEUE MANAGERS.                        05570000
055800** GET THE HANDLE TO THE QUEUE MANAGER - PV-HCONN                 05580000
055900****************************************************************  05590000
056000 1300-MQ-CONNECT-TO-QMGR.                                         05600000
056100                                                                  05610000
056200     MOVE '1300-MQ-CONNECT-TO-QMGR' TO PV-PARAGRAPH.              05620000
056300     MOVE 1 TO PV-MQ-TBL-CNT.                                     05630000
056400                                                                  05640000
056500     MOVE MQ-QMGR-NAME(PV-MQ-TBL-CNT) TO PV-QM-NAME.              05650000
056600                                                                  05660000
056700     CALL PC-MQCONN USING PV-QM-NAME                              05670000
056800                          PV-HCONN                                05680000
056900                          PV-COMPLETION-CODE                      05690000
057000                          PV-REASON.                              05700000
057100                                                                  05710000
057200     MOVE PV-REASON TO PV-CON-REASON.                             05720000
057300     IF PV-COMPLETION-CODE = MQCC-OK                              05730000
057400        ADD 1 TO PV-MQ-TBL-CNT                                    05740000
057500        DISPLAY 'CONNECTED TO QM -' MQ-QMGR-NAME(PV-MQ-TBL-CNT)   05750000
057600         CONTINUE                                                 05760000
057700     ELSE                                                         05770000
057800         CALL PV-MQCHECK USING PV-REASON                          05780000
057900                               PV-MQ-REASON-TEXT                  05790000
058000         MOVE PV-QM-NAME           TO PE-MQ-QMANAGER              05800000
058100         MOVE PV-COMPLETION-CODE   TO PE-MQ-COMPLETION-CODE       05810000
058200         MOVE PV-REASON            TO PE-MQ-REASON-CODE           05820000
058300         MOVE '1300-MQ-CONNECT-TO-QMGR'                           05830000
058400                                   TO PV-ERROR-MESSAGE            05840000
058500         PERFORM 9200-MQ-ABEND                                    05850000
058600     END-IF.                                                      05860000
058700                                                                  05870000
058800****************************************************************  05880000
058900** OPEN MULTIPLE QUEUES FOR 'PUT'                                 05890000
059000****************************************************************  05900000
059100 1400-MQ-QUEUE-OPEN.                                              05910000
059200                                                                  05920000
059300     MOVE 1 TO PV-MQ-TBL-CNT.                                     05930000
059400     PERFORM 1410-MULTI-MQ-OPEN PV-MQ-CNT TIMES.                  05940000
059500                                                                  05950000
059600****************************************************************  05960000
059700** OPEN MULTIPLE QUEUES FOR 'PUT'                                 05970000
059800****************************************************************  05980000
059900 1410-MULTI-MQ-OPEN.                                              05990000
060000                                                                  06000000
060100     MOVE '1410-MUTI-MQ-OPEN' TO PV-PARAGRAPH.                    06010000
060200                                                                  06020000
060300* CONTROL CARD 2 - QUEUE NAME                                     06030000
060400     MOVE MQ-TRANS-QUEUE-NAME(PV-MQ-TBL-CNT)  TO PC-TRANS-QNAME.  06040000
060500     COMPUTE PV-OPEN-OPTIONS = MQOO-OUTPUT                        06050000
060600                             + MQOO-SET-IDENTITY-CONTEXT          06060000
060700                             + MQOO-FAIL-IF-QUIESCING.            06070000
060800     MOVE PC-TRANS-QNAME       TO MQOD-OBJECTNAME.                06080000
060900                                                                  06090000
061000     DISPLAY 'PC-TRANS-QNAME:' PC-TRANS-QNAME                     06100000
061100     DISPLAY 'MQOD-OBJECTNAME:' MQOD-OBJECTNAME                   06110000
061200                                                                  06120000
061300* CONTROL CARD 3 - REMOTE QMGR NAME                               06130000
061400     MOVE MQ-QMGR-NAME-REMOTE(PV-MQ-TBL-CNT)                      06140000
061500                          TO MQOD-OBJECTQMGRNAME.                 06150000
061600                                                                  06160000
061700******************************************************************06170000
061800*REPLACE REMOTE QMGR NAME WITH LOCAL QMGR NAME TO WRITE TO LOCAL Q06180000
061900******************************************************************06190000
062000                                                                  06200000
062100     DISPLAY 'MQOD-OBJECTQMGRNAME:' MQOD-OBJECTQMGRNAME           06210000
062200     DISPLAY 'MQOD-OBJECTNAME    :' MQOD-OBJECTNAME               06220000
062300     DISPLAY 'PV-HCONN:' PV-HCONN                                 06230000
062400     DISPLAY 'MQM-OBJECT-DESCRIPTOR:' MQM-OBJECT-DESCRIPTOR       06240000
062500     DISPLAY 'PV-OPEN-OPTIONS:' PV-OPEN-OPTIONS                   06250000
062600     DISPLAY 'PV-PQ-HANDLE:' PV-PQ-HANDLE                         06260000
062700                                                                  06270000
062800     CALL PC-MQOPEN USING PV-HCONN                                06280000
062900                          MQM-OBJECT-DESCRIPTOR                   06290000
063000                          PV-OPEN-OPTIONS                         06300000
063100                          PV-PQ-HANDLE                            06310000
063200                          PV-COMPLETION-CODE                      06320000
063300                          PV-REASON.                              06330000
063400                                                                  06340000
063500     IF PV-COMPLETION-CODE = MQCC-OK THEN                         06350000
063600         ADD 1 TO PV-MQ-TBL-CNT                                   06360000
063700                  PV-MQ-HANDLE-CNT                                06370000
063800         MOVE  PV-PQ-HANDLE TO PV-MQ-HANDLE-HOLD(PV-MQ-HANDLE-CNT)06380000
063900         DISPLAY 'OPEN COMPLETE'                                  06390000
064000         CONTINUE                                                 06400000
064100     ELSE                                                         06410000
064200         CALL PV-MQCHECK USING PV-REASON                          06420000
064300                               PV-MQ-REASON-TEXT                  06430000
064400         MOVE PV-QM-NAME-REMOTE    TO PE-MQ-QMANAGER-REMOTE       06440000
064500         MOVE PC-TRANS-QNAME       TO PE-MQ-QNAME                 06450000
064600         MOVE PV-COMPLETION-CODE   TO PE-MQ-COMPLETION-CODE       06460000
064700         MOVE PV-REASON            TO PE-MQ-REASON-CODE           06470000
064800         MOVE '1410-MULTI-MQ-OPEN' TO PV-ERROR-MESSAGE            06480000
064900         PERFORM 9200-MQ-ABEND                                    06490000
065000     END-IF.                                                      06500000
065100                                                                  06510000
065200****************************************************************  06520000
065300** CLOSES THE MQ QUEUE.                                           06530000
065400****************************************************************  06540000
065500 1500-MQ-QUEUE-CLOSE.                                             06550000
065600                                                                  06560000
065700     MOVE 1 TO PV-MQ-HANDLE-CNT.                                  06570000
065800     PERFORM 1510-MQ-MULTI-QUEUE-CLOSE PV-MQ-CNT TIMES.           06580000
065900                                                                  06590000
066000 1510-MQ-MULTI-QUEUE-CLOSE.                                       06600000
066100                                                                  06610000
066200     MOVE '1510-MQ-MULTI-QUEUE-CLOSE' TO PV-PARAGRAPH.            06620000
066300                                                                  06630000
066400     CALL PC-MQCLOSE USING PV-HCONN                               06640000
066500                           PV-MQ-HANDLE-HOLD(PV-MQ-HANDLE-CNT)    06650000
066600                           MQCO-NONE                              06660000
066700                           PV-COMPLETION-CODE                     06670000
066800                           PV-REASON.                             06680000
066900                                                                  06690000
067000     IF PV-COMPLETION-CODE = MQCC-OK                              06700000
067100         CONTINUE                                                 06710000
067200     ELSE                                                         06720000
067300         CALL PV-MQCHECK USING PV-REASON                          06730000
067400                               PV-MQ-REASON-TEXT                  06740000
067500         MOVE PV-QM-NAME           TO PE-MQ-QMANAGER              06750000
067600         MOVE PC-TRANS-QNAME       TO PE-MQ-QNAME                 06760000
067700         MOVE PV-COMPLETION-CODE   TO PE-MQ-COMPLETION-CODE       06770000
067800         MOVE PV-REASON            TO PE-MQ-REASON-CODE           06780000
067900         MOVE 'MQ-CLOSE'           TO PV-ERROR-MESSAGE            06790000
068000         PERFORM 9200-MQ-ABEND                                    06800000
068100     END-IF.                                                      06810000
068200                                                                  06820000
068300****************************************************************  06830000
068400** DISCONNECT FROM THE QUEUE MANAGER                              06840000
068500****************************************************************  06850000
068600 1600-DISCONNECT-QMGR.                                            06860000
068700     MOVE '1600-DISCONNECT-QMGR' TO PV-PARAGRAPH.                 06870000
068800                                                                  06880000
068900     CALL PC-MQDISC USING PV-HCONN                                06890000
069000                          PV-COMPLETION-CODE                      06900000
069100                          PV-REASON                               06910000
069200                                                                  06920000
069300     IF PV-COMPLETION-CODE = MQCC-OK                              06930000
069400        CONTINUE                                                  06940000
069500     ELSE                                                         06950000
069600        CALL PV-MQCHECK USING PV-REASON                           06960000
069700                              PV-MQ-REASON-TEXT                   06970000
069800        MOVE PV-QM-NAME             TO PE-MQ-QMANAGER             06980000
069900        MOVE PC-TRANS-QNAME         TO PE-MQ-QNAME                06990000
070000        MOVE PV-COMPLETION-CODE     TO PE-MQ-COMPLETION-CODE      07000000
070100        MOVE PV-REASON              TO PE-MQ-REASON-CODE          07010000
070200        MOVE '1600-DISCONNECT-QMGR' TO PV-ERROR-MESSAGE           07020000
070300        PERFORM 9200-MQ-ABEND                                     07030000
070400     END-IF.                                                      07040000
070500                                                                  07050000
070600******************************************************************07060000
070700*     PROCESS RDC INVENTORY ADJUSTMENTS                           07070000
070800******************************************************************07080000
070900 2000-PROCESS-INTRANSIT-RECORDS.                                  07090000
071000                                                                  07100000
071100     PERFORM 2020-FORMAT-OUTPUT.                                  07110000
071200                                                                  07120000
071300     READ INTRANSIT-FILE INTO OF012-EXTRACT-RECORD                07130005
071400          AT END SET PS-END-OF-INTRANSIT-REC-Y TO TRUE.           07140000
071500     ADD +1 TO PV-COUNTER.                                        07150000
071600     IF PS-END-OF-INTRANSIT-REC-Y                                 07160000
071700*        LAST TRIP                                                07170000
071800         MOVE PD-COUNT TO PD-MAX                                  07180000
071900         MOVE 0 TO PD-ORD-LNE-NBR                                 07190000
072000                   PD-COUNT                                       07200000
072100         PERFORM 3100-MOVE-DETAIL VARYING PD-ORD-LNE-NBR          07210000
072200                         FROM 1 BY 1 UNTIL PD-ORD-LNE-NBR >       07220000
072300                                           PD-MAX                 07230000
072400         PERFORM 4000-CREATE-MSGS                                 07240000
072500     END-IF.                                                      07250000
072600                                                                  07260000
072700******************************************************************07270000
072800* BUILD MQ OUTPUT                                                 07280000
072900******************************************************************07290000
073000 2020-FORMAT-OUTPUT.                                              07300000
073100                                                                  07310000
073200                                                                  07320000
073300     IF OF012-OTBND-TRIP-ID = PV-OTBND-TRIP-ID                    07330005
073400        IF OF012-SHIPT-UNT-ID  = PV-SHIPT-UNT-ID                  07340005
073500            PERFORM 3000-BUILD-WS-DETAIL                          07350000
073600        ELSE                                                      07360000
073700*           NEW CARTON                                            07370000
073800            MOVE PD-COUNT TO PD-MAX                               07380000
073900            MOVE 0 TO PD-ORD-LNE-NBR                              07390000
074000                      PD-COUNT                                    07400000
074100            PERFORM 3100-MOVE-DETAIL VARYING PD-ORD-LNE-NBR       07410000
074200                            FROM 1 BY 1 UNTIL PD-ORD-LNE-NBR >    07420000
074300                                              PD-MAX              07430000
074400            PERFORM 4000-CREATE-MSGS                              07440000
074500            MOVE OF012-OTBND-TRIP-ID TO PV-OTBND-TRIP-ID          07450005
074600            MOVE OF012-SHIPT-UNT-ID  TO PV-SHIPT-UNT-ID           07460005
074700            PERFORM 2050-MOVE-HEADER                              07470000
074800            MOVE 0 TO PD-COUNT                                    07480000
074900                      PD-MAX                                      07490000
075000                      PD-ORD-LNE-NBR                              07500000
075100            PERFORM 3000-BUILD-WS-DETAIL                          07510000
075200        END-IF                                                    07520000
075300     ELSE                                                         07530000
075400*        NEW TRIP                                                 07540000
075500         MOVE PD-COUNT TO PD-MAX                                  07550000
075600         MOVE 0 TO PD-ORD-LNE-NBR                                 07560000
075700                   PD-COUNT                                       07570000
075800         PERFORM 3100-MOVE-DETAIL VARYING PD-ORD-LNE-NBR          07580000
075900                         FROM 1 BY 1 UNTIL PD-ORD-LNE-NBR >       07590000
076000                                           PD-MAX                 07600000
076100         PERFORM 4000-CREATE-MSGS                                 07610000
076200         MOVE OF012-OTBND-TRIP-ID TO PV-OTBND-TRIP-ID             07620005
076300         MOVE OF012-SHIPT-UNT-ID  TO PV-SHIPT-UNT-ID              07630005
076400         PERFORM 2050-MOVE-HEADER                                 07640000
076500         MOVE 0 TO PD-COUNT                                       07650000
076600                   PD-MAX                                         07660000
076700                   PD-ORD-LNE-NBR                                 07670000
076800         PERFORM 3000-BUILD-WS-DETAIL                             07680000
076900     END-IF.                                                      07690000
077000                                                                  07700000
077100                                                                  07710000
077200******************************************************************07720000
077300* BUILD HEADER                                                    07730000
077400******************************************************************07740000
077500 2050-MOVE-HEADER.                                                07750000
077600                                                                  07760000
077700     MOVE SPACES                  TO EnterpriseCode.              07770015
077800     MOVE OF012-DEST-LOC-NBR      TO Store.                       07780006
077900     MOVE OF012-OTBND-TRIP-ID     TO OutboundTripId.              07790005
078000     IF OF012-SCN-TYP-CDE  =  'SSAR'                              07800022
078100         MOVE OF012-OTBND-TRIP-ID       TO PV-OTBND-TRIP-ID-CONC  07810022
078200         MOVE OF012-SHIPT-UNT-ID        TO PV-SHIPT-UNT-ID-CONC   07820022
078300         MOVE PV-COMBINED-TRIP-SHIPT    TO OrderNo                07830022
078400     ELSE                                                         07840022
078500         MOVE OF012-OTBND-TRIP-ID       TO PV-ORDER-OTBND-TRIP-ID 07850022
078600         MOVE OF012-SHIPT-UNT-ID        TO PV-ORDER-SHIPT-UNT-ID  07860022
078700         MOVE OF012-DEST-LOC-NBR        TO PV-ORDER-STORE         07870022
078800         MOVE PV-ORDER-TRIP-SHIPT-STORE TO OrderNo                07880022
078900     END-IF.                                                      07890022
079000                                                                  07900000
079100     MOVE OF012-TRLR-ID           TO Text1.                       07910005
079200     MOVE OF012-TRLR-SRL-NBR      TO Text2.                       07920015
079300     MOVE OF012-TRLR-SEAL-ID      TO Text3.                       07930015
079400     MOVE OF012-SHIP-SCAC-CDE     TO Text4.                       07940015
079500     MOVE OF012-SML-TYPE          TO Text5.                       07950015
079600     MOVE OF012-MSTR-UNT-ID       TO Text6.                       07960015
079700                                                                  07970002
079800     MOVE OF012-TMST-ON-TRLR      TO PV-TMST-EXP.                 07980005
079900     MOVE PV-PTE-DATE             TO PV-POT-DATE.                 07990002
080000     MOVE PV-PTE-HH               TO PV-POT-HH.                   08000002
080100     MOVE PV-PTE-MM               TO PV-POT-MM.                   08010002
080200     MOVE PV-PTE-SS               TO PV-POT-SS.                   08020002
080300     MOVE PV-ORACLE-TMST          TO Text7.                       08030002
080400                                                                  08040002
080500     MOVE OF012-TM-AT-DC          TO PV-PTE-TIME.                 08050005
080600     MOVE PV-PTE-HH               TO PV-POT-HH.                   08060002
080700     MOVE PV-PTE-MM               TO PV-POT-MM.                   08070002
080800     MOVE PV-PTE-SS               TO PV-POT-SS.                   08080002
080900     MOVE OF012-DTE-AT-DC         TO PV-POT-DATE.                 08090005
081000     MOVE PV-ORACLE-TMST          TO Text8.                       08100002
081100                                                                  08110000
081200                                                                  08120000
081300 3000-BUILD-WS-DETAIL.                                            08130000
081400     ADD 1 TO PD-ORD-LNE-NBR                                      08140000
081500              PD-COUNT.                                           08150000
081600     MOVE OF012-DEST-LOC-NBR     TO PD-RECV-NODE(PD-ORD-LNE-NBR). 08160005
081700     MOVE OF012-ORGN-OPER-UNT-ID TO PD-SHIP-NODE(PD-ORD-LNE-NBR). 08170005
081800     MOVE OF012-SHPD-UNT-QTY     TO PD-QTY(PD-ORD-LNE-NBR).       08180005
081900     MOVE OF012-SHIPT-UNT-ID     TO PD-VAR1(PD-ORD-LNE-NBR).      08190005
082000     MOVE OF012-OTBND-TRIP-ID    TO PD-VAR2(PD-ORD-LNE-NBR).      08200005
082100     MOVE PV-VALIDATE-ITEM       TO PD-VAL-ITEM(PD-ORD-LNE-NBR).  08210000
082200     MOVE OF012-TRN-NBR          TO DK-PO-RCVR-NBR-N.             08220005
082300     MOVE DK-RCVR-NBR-X          TO PD-TRN-NBR(PD-ORD-LNE-NBR).   08230000
082400     MOVE OF012-RCVR-SEQ-NBR     TO DK-RCVR-NBR-9.                08240005
082500     MOVE DK-RCVR-NBR-3        TO PD-RCVR-SEQ-NBR(PD-ORD-LNE-NBR).08250000
082600     MOVE OF012-SKU-NBR          TO PD-ITEM-ID(PD-ORD-LNE-NBR).   08260005
082700     MOVE PV-PRODUCT-CLASS       TO PD-PROD-CLASS(PD-ORD-LNE-NBR).08270000
082800     MOVE PV-UNIT-OF-MEASURE     TO PD-UNT-MEASUR(PD-ORD-LNE-NBR).08280000
082900     MOVE PV-LNE-PRICE-ONLY      TO                               08290000
083000                         PD-LNE-PRICE-ONLY(PD-ORD-LNE-NBR).       08300000
083100     MOVE OF012-UNIT-RETAIL      TO                               08310005
083200                         PD-RETAIL-PRICE(PD-ORD-LNE-NBR).         08320000
083300     MOVE OF012-COST-AMT         TO                               08330005
083400                         PD-UNIT-PRICE(PD-ORD-LNE-NBR).           08340000
083500                                                                  08350000
083600 3100-MOVE-DETAIL.                                                08360000
083700     ADD 1 TO PD-COUNT.                                           08370000
083800                                                                  08380000
083900     MOVE PD-RECV-NODE(PD-ORD-LNE-NBR)        TO                  08390000
084000          ReceivingNode(PD-COUNT).                                08400000
084100     MOVE PD-QTY(PD-ORD-LNE-NBR)              TO                  08410000
084200          OrderedQty(PD-COUNT).                                   08420000
084300     MOVE PD-TRN-NBR(PD-ORD-LNE-NBR)         TO                   08430000
084400          CustomerPONo(PD-COUNT).                                 08440000
084500     MOVE PD-RCVR-SEQ-NBR(PD-ORD-LNE-NBR)     TO                  08450000
084600          CustomerLinePONo(PD-COUNT).                             08460000
084700     MOVE PD-ITEM-ID(PD-ORD-LNE-NBR)          TO                  08470000
084800          ItemID(PD-COUNT).                                       08480000
084900     MOVE PD-PROD-CLASS(PD-ORD-LNE-NBR)       TO                  08490000
085000          ProductClass(PD-COUNT).                                 08500000
085100     MOVE PD-UNT-MEASUR(PD-ORD-LNE-NBR)       TO                  08510000
085200          UnitofMeasure(PD-COUNT).                                08520000
085300     MOVE PD-LNE-PRICE-ONLY(PD-ORD-LNE-NBR)   TO                  08530000
085400          IsLinePriceForInformationOnly(PD-COUNT).                08540000
085500     MOVE PD-RETAIL-PRICE(PD-ORD-LNE-NBR)     TO                  08550000
085600          RetailPrice(PD-COUNT).                                  08560000
085700     MOVE PD-UNIT-PRICE(PD-ORD-LNE-NBR)       TO                  08570000
085800          UnitPrice(PD-COUNT).                                    08580000
085900                                                                  08590000
086000****************************************************************  08600000
086100* CREATE XML FOR RDC AND OUTPUT TO MQ                             08610000
086200****************************************************************  08620000
086300 4000-CREATE-MSGS.                                                08630000
086400                                                                  08640000
086500     PERFORM 4100-GENERATE-XML.                                   08650000
086600     ADD +1 TO PV-INTRANSIT-SENT-TO-QUE.                          08660000
086700                                                                  08670000
086800     MOVE PV-XML-BANNER              TO PV-MSGBUFFER-banner.      08680000
086900     MOVE PV-XML(1:XML-LENGTH)       TO PV-MSGBUFFER-data.        08690000
087000****DELETE THIS LINE AND SPACE OUT "" BELOW                       08700002
173485**   DISPLAY pv-msgbuffer-banner.                                 08710024
173485**   DISPLAY pv-msgbuffer-data                                    08720026
173485**   DISPLAY 'XML-LENGTH'  XML-LENGTH.                            08730024
087400     COMPUTE PV-MSG-LENGTH = XML-LENGTH                           08740000
087500                           + LENGTH OF PV-XML-BANNER.             08750000
173485**   DISPLAY ' PV-MSG-LENGTH = ' PV-MSG-LENGTH.                   08760024
087700     MOVE PV-MSG-LENGTH TO PV-MSG-LENGTH-DISPLAY.                 08770000
087800     INITIALIZE PS-MQPUT-SUCCESSFUL-IND                           08780000
087900                PC-MQPUT-RETRY-COUNTER.                           08790000
088000                                                                  08800000
088100     PERFORM 5000-MQ-PUT-TO-QUEUE                                 08810000
088200       UNTIL PS-MQPUT-SUCCESSFUL.                                 08820000
088300                                                                  08830000
088400     IF PV-INTRANSIT-SENT-TO-QUE = 5000                           08840000
088500         PERFORM 5100-MQ-COMMIT                                   08850000
088600         MOVE ZEROS TO PV-INTRANSIT-SENT-TO-QUE                   08860000
088700     END-IF.                                                      08870000
088800                                                                  08880000
088900                                                                  08890000
089000                                                                  08900000
089100***********************AssumptiveReceive***********************   08910007
089200 4100-GENERATE-XML.                                               08920000
089300                                                                  08930000
089400     MOVE SPACES TO PV-XML.                                       08940000
089500     XML GENERATE PV-XML                                          08950000
089600         FROM AssumptiveReceive                                   08960007
089700         COUNT IN XML-LENGTH                                      08970000
089800         WITH ATTRIBUTES                                          08980000
089900         ON EXCEPTION                                             08990000
090000             DISPLAY AssumptiveReceive ' PV=' PV-XML              09000007
090100             PERFORM 4110-XML-ERROR                               09010000
090200         NOT ON EXCEPTION                                         09020000
090300             CONTINUE                                             09030000
090400     END-XML.                                                     09040000
090500                                                                  09050000
090600***************************************************************   09060000
090700 4110-XML-ERROR.                                                  09070000
090800                                                                  09080000
090900     PERFORM 9000-EXPLAIN-XML-RESPONSE                            09090000
091000     PERFORM  VARYING XML-LINE-IDX FROM 1 BY 1                    09100000
091100                UNTIL XML-LINE-IDX > XML-RESPONSE-LINES           09110000
091200     END-PERFORM.                                                 09120000
091300     MOVE +4018         TO ABEND-CODE.                            09130000
091400     CALL 'ILBOABN0' USING ABEND-CODE.                            09140000
091500                                                                  09150000
091600     COPY ISPD007.                                                09160000
091700     COPY ISPD008.                                                09170000
091800     COPY ISPD009.                                                09180000
091900                                                                  09190000
092000******************************************************************09200000
092100*      PUT MQ MESSAGE                                             09210000
092200******************************************************************09220000
092300 5000-MQ-PUT-TO-QUEUE.                                            09230000
092400                                                                  09240000
092500     MOVE ZEROES TO PV-CNT.                                       09250000
092600     PERFORM 5100-MQ-MULTI-PUTS PV-MQ-HANDLE-CNT TIMES.           09260000
092700                                                                  09270000
092800 5100-MQ-MULTI-PUTS.                                              09280000
092900                                                                  09290000
093000     ADD 1 TO PV-CNT.                                             09300000
093100     MOVE MQMI-NONE    TO MQMD-MSGID.                             09310000
093200     MOVE MQCI-NONE    TO MQMD-CORRELID.                          09320000
093300     MOVE MQFMT-STRING TO MQMD-FORMAT.                            09330000
093400                                                                  09340000
093500     COMPUTE MQPMO-OPTIONS  = MQPMO-SYNCPOINT                     09350000
093600                            + MQPMO-SET-IDENTITY-CONTEXT.         09360000
093700     PERFORM 5010-LOW-VALUES.                                     09370000
093800                                                                  09380000
093900     CALL PC-MQPUT USING PV-HCONN                                 09390000
094000                         PV-MQ-HANDLE-HOLD(PV-CNT)                09400000
094100                         MQM-MESSAGE-DESCRIPTOR                   09410000
094200                         MQM-PUT-MESSAGE-OPTIONS                  09420000
094300                         PV-MSG-LENGTH                            09430000
094400                         PV-MSGBUFFER                             09440000
094500                         PV-COMPLETION-CODE                       09450000
094600                         PV-REASON.                               09460000
094700                                                                  09470000
094800*IF PUT FAILED THEN DISPLAY ERROR MESSAGE                         09480000
094900     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        09490000
095000         IF (PV-REASON NOT = MQRC-PAGESET-FULL                    09500000
095100           AND PV-REASON NOT = MQRC-Q-FULL                        09510000
095200           AND PV-REASON NOT = MQRC-Q-SPACE-NOT-AVAILABLE )       09520000
095300             CALL PV-MQCHECK USING PV-REASON                      09530000
095400                                   PV-MQ-REASON-TEXT              09540000
095500             DISPLAY 'MQ MESSAGE = ' PV-MSGBUFFER                 09550000
095600             MOVE '5000-MQ-PUT-TO-QUEUE'  TO PV-PARAGRAPH         09560000
095700             MOVE 'MQPUT FAILED'          TO PV-ERROR-MESSAGE     09570000
095800             MOVE PV-COMPLETION-CODE  TO PV-HOLD-COMPLETION-CODE  09580000
095900                                         PE-MQ-COMPLETION-CODE    09590000
096000             MOVE PV-REASON               TO PV-HOLD-REASON       09600000
096100                                             PE-MQ-REASON-CODE    09610000
096200             PERFORM 5200-BACK-OUT-MQ                             09620000
096300             MOVE PV-HOLD-COMPLETION-CODE TO PV-COMPLETION-CODE   09630000
096400             MOVE PV-HOLD-REASON          TO PV-REASON            09640000
096500             PERFORM 9200-MQ-ABEND                                09650000
096600         ELSE                                                     09660000
096700             ADD 1 TO PC-MQPUT-RETRY-COUNTER                      09670000
096800             IF PC-MQPUT-RETRY-COUNTER >= 60                      09680000
096900                 CALL PV-MQCHECK USING PV-REASON                  09690000
097000                                       PV-MQ-REASON-TEXT          09700000
097100                 DISPLAY 'MQ MESSAGE = ' PV-MSGBUFFER             09710000
097200                 MOVE '5000-MQ-PUT-TO-QUEUE' TO PV-PARAGRAPH      09720000
097300                 MOVE 'MQPUT ERROR- RETRY > 60 '                  09730000
097400                      TO PV-ERROR-MESSAGE                         09740000
097500                 MOVE PV-COMPLETION-CODE                          09750000
097600                      TO PV-HOLD-COMPLETION-CODE                  09760000
097700                         PE-MQ-COMPLETION-CODE                    09770000
097800                 MOVE PV-REASON TO PV-HOLD-REASON                 09780000
097900                                   PE-MQ-REASON-CODE              09790000
098000                 PERFORM 5200-BACK-OUT-MQ                         09800000
098100                 MOVE PV-HOLD-COMPLETION-CODE                     09810000
098200                      TO PV-COMPLETION-CODE                       09820000
098300                 MOVE PV-HOLD-REASON TO PV-REASON                 09830000
098400                 PERFORM 9200-MQ-ABEND                            09840000
098500             ELSE                                                 09850000
098600*WAIT FOR 30 SECONDS AND TRY AGAIN                                09860000
098700                 CALL 'SYSWAIT' USING PC-DELAY-INTERVAL           09870000
098800             END-IF                                               09880000
098900         END-IF                                                   09890000
099000     ELSE                                                         09900000
099100         ADD 1 TO PA-TOTAL-MQ-MSGS-SENT                           09910000
099200         SET PS-MQPUT-SUCCESSFUL TO TRUE                          09920000
099300     END-IF.                                                      09930000
099400                                                                  09940000
099500******************************************************************09950000
099600 5010-LOW-VALUES.                                                 09960000
099700                                                                  09970000
099800     MOVE PV-MSGBUFFER TO PV-HOLD-MSGBUFFER.                      09980000
099900     MOVE PV-HOLD-MSGBUFFER TO PV-MSGBUFFER.                      09990000
100000                                                                  10000000
100100******************************************************************10010000
100200*  COMMIT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT        10020000
100300******************************************************************10030000
100400 5100-MQ-COMMIT.                                                  10040000
100500                                                                  10050000
100600     CALL PC-MQCMIT USING PV-HCONN                                10060000
100700                          PV-COMPLETION-CODE                      10070000
100800                          PV-REASON.                              10080000
100900                                                                  10090000
101000     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        10100000
101100        CALL PV-MQCHECK USING PV-REASON                           10110000
101200                              PV-MQ-REASON-TEXT                   10120000
101300        MOVE '5100-COMMIT-MQ'   TO PV-PARAGRAPH                   10130000
101400        MOVE 'MQCMIT ERROR'     TO PV-ERROR-MESSAGE               10140000
101500        MOVE PV-COMPLETION-CODE TO PV-HOLD-COMPLETION-CODE        10150000
101600                                   PE-MQ-COMPLETION-CODE          10160000
101700        MOVE PV-REASON          TO PV-HOLD-REASON                 10170000
101800                                   PE-MQ-REASON-CODE              10180000
101900        PERFORM 5200-BACK-OUT-MQ                                  10190000
102000        MOVE PV-HOLD-COMPLETION-CODE TO PV-COMPLETION-CODE        10200000
102100        MOVE PV-HOLD-REASON          TO PV-REASON                 10210000
102200        PERFORM 9200-MQ-ABEND                                     10220000
102300     END-IF.                                                      10230000
102400                                                                  10240000
102500******************************************************************10250000
102600* BACK OUT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT       10260000
102700******************************************************************10270000
102800 5200-BACK-OUT-MQ.                                                10280000
102900                                                                  10290000
103000     CALL PC-MQBACK USING PV-HCONN                                10300000
103100                          PV-COMPLETION-CODE                      10310000
103200                          PV-REASON.                              10320000
103300                                                                  10330000
103400     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        10340000
103500        CALL PV-MQCHECK USING PV-REASON                           10350000
103600                              PV-MQ-REASON-TEXT                   10360000
103700        MOVE '5200-BACK-OUT-MQ'  TO PV-PARAGRAPH                  10370000
103800        MOVE 'MQBACK ERROR'    TO PV-ERROR-MESSAGE                10380000
103900        PERFORM 9200-MQ-ABEND                                     10390000
104000     END-IF.                                                      10400000
104100                                                                  10410000
104200******************************************************************10420000
104300* DISPLAY STATISTICS FOR THE PROGRAM                              10430000
104400******************************************************************10440000
104500 9000-EOJ-ROUTINE.                                                10450000
104600                                                                  10460000
104700     CLOSE INTRANSIT-FILE.                                        10470000
104800                                                                  10480000
104900     DISPLAY ' '                                                  10490000
105000     DISPLAY ' ********************************************'      10500000
105100     DISPLAY '     * OFKUT013 SUMMARY STATISTICS *         '      10510000
105200     DISPLAY '       ---------------------------           '      10520000
105300     DISPLAY '          EXPECT   EXTRACT VIA MQ            '      10530000
105400     DISPLAY '       ---------------------------           '      10540000
105500     DISPLAY '   TOTAL EXPECT   RECORDS READ:   '                 10550000
105600                                    PV-COUNTER                    10560000
105700     DISPLAY '   TOTAL MQ MESSAGES SENT:   '                      10570000
105800                                    PA-TOTAL-MQ-MSGS-SENT         10580000
105900     DISPLAY ' ********************************************'.     10590000
106000                                                                  10600000
106100****************************************************************  10610000
106200** PERFORM MQ-SERIES ABEND PROCESSING                             10620000
106300****************************************************************  10630000
106400 9200-MQ-ABEND.                                                   10640000
106500                                                                  10650000
106600     DISPLAY '****************** A B E N D ******************'.   10660000
106700     DISPLAY '** MQSERIES ERROR **'.                              10670000
106800     DISPLAY '** PROGRAM:    ', PC-CURRENT-PROGRAM-NAME.          10680000
106900     DISPLAY '** ABEND CODE: ', PV-ABEND-CODE.                    10690000
107000     DISPLAY '** PARAGRAPH:  ', PV-PARAGRAPH.                     10700000
107100     DISPLAY '** MESSAGE:    ', PV-ERROR-MESSAGE.                 10710000
107200     DISPLAY '** COMP CODE:  ', PE-MQ-COMPLETION-CODE.            10720000
107300     DISPLAY '** RSN CODE:   ', PE-MQ-REASON-CODE.                10730000
107400     DISPLAY '** RSN TEXT:   ', PV-MQ-REASON-TEXT.                10740000
107500     DISPLAY '***********************************************'.   10750000
107600     DISPLAY '   TOTAL MQ MESSAGES SENT:   '                      10760000
107700                                    PA-TOTAL-MQ-MSGS-SENT         10770000
107800     MOVE +4013 TO ABEND-CODE.                                    10780000
107900     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         10790000
108000                                                                  10800000
108100******************************************************************10810000
108200* 9900-DB2-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      10820000
108300* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 10830000
108400******************************************************************10840000
108500 9900-DB2-ABEND.                                                  10850000
108600                                                                  10860000
108700     MOVE SQLCODE    TO PV-SQLCODE.                               10870000
108800     MOVE PV-SQLCODE TO PV-DISPLAY-SQLCODE.                       10880000
108900     DISPLAY '*** DB2 ERROR ***'.                                 10890000
109000     DISPLAY '*** SQLCODE   = ' PV-DISPLAY-SQLCODE.               10900000
109100     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 10910000
109200     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               10920000
109300     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               10930000
109400     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       10940000
109500     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             10950000
109600     DISPLAY '   TOTAL MQ MESSAGES SENT:   '                      10960000
109700                                    PA-TOTAL-MQ-MSGS-SENT         10970000
109800                                                                  10980000
109900******************************************************************10990000
110000* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    11000000
110100* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         11010000
110200* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     11020000
110300* FORMAT.                                                         11030000
110400******************************************************************11040000
110500     COPY DPPD004.                                                11050000
110600                                                                  11060000
110700     IF SQLCODE NOT = -911                                        11070000
110800         EXEC SQL                                                 11080000
110900             ROLLBACK                                             11090000
111000         END-EXEC                                                 11100000
111100     END-IF.                                                      11110000
111200                                                                  11120000
111300     MOVE +4013         TO PV-ABEND-CODE.                         11130000
111400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         11140000
111500******************************************************************11150000
