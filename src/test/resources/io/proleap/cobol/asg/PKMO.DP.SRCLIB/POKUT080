000100*************************                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*************************                                         00030000
000400 PROGRAM-ID.      POKUT080.                                       00040000
000500 AUTHOR.          RYAN STAUFFACHER                                00050000
000600 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00060000
000700 DATE-WRITTEN.    05/21/01.                                       00070000
000800*DATE-COMPILED.                                                   00080000
000900******************************************************************00090000
001000* PLANNED RECEIPTS PROGRAM                                        00100000
001100* THIS PROGRAM TAKES AN INPUT FILE AND CREATES A FLAT FILE WHICH  00110000
001200* WILL EVENTUALL BE TURNED INTO THE MONTHLY PLANNED RECEIPTS VSAM 00120000
001300* FILE.                                                           00130000
001400******************************************************************00140000
      *  CHANGED PROGRAM TO NOT ABEND ON ROWS NOT FOUND IN TMDSEAR      00150009
      *  UNLESS PLANNED RECEIPT AMOUNT IS NOT ZERO.                     00160009
      *  MADE BY: R. STAUFFACHER          PITS #: 4314189               00170009
      ******************************************************************00180009
      ******************************************************************00190016
      *  INCREASED THE PC-MAX-GMA-RECORDS LIMIT TO 80                   00200016
      *  MADE BY: COGNIZANT               CRQ  #: 23514                 00210016
      ******************************************************************00220016
001500 ENVIRONMENT DIVISION.                                            00230000
001600*                                                                 00240000
001700*                                                                 00250000
001800 CONFIGURATION SECTION.                                           00260000
001900 SOURCE-COMPUTER. IBM-3090.                                       00270000
002000 OBJECT-COMPUTER. IBM-3090.                                       00280000
002100*                                                                 00290000
002200*                                                                 00300000
002300 INPUT-OUTPUT SECTION.                                            00310000
002400 FILE-CONTROL.                                                    00320000
002500                                                                  00330000
002600     SELECT BASIC-RECEIPTS-FILE                                   00340000
002700         ASSIGN                       TO INP01.                   00350000
002800                                                                  00360000
002900                                                                  00370000
003000     SELECT DETAILED-RECEIPTS-FILE                                00380000
003100         ASSIGN                       TO OUT01.                   00390000
003200                                                                  00400000
003300     EJECT                                                        00410000
003400*                                                                 00420000
003500*                                                                 00430000
003600***************                                                   00440000
003700 DATA DIVISION.                                                   00450000
003800***************                                                   00460000
003900*                                                                 00470000
004000*                                                                 00480000
004100*                                                                 00490000
004200 FILE SECTION.                                                    00500000
004300                                                                  00510000
004400 FD  BASIC-RECEIPTS-FILE                                          00520000
004500     RECORDING MODE F                                             00530000
004600     LABEL RECORDS ARE STANDARD                                   00540000
004700     RECORD CONTAINS 600 CHARACTERS                               00550000
004800     BLOCK CONTAINS 0 RECORDS                                     00560000
004900     DATA RECORD IS BASIC-REC.                                    00570000
005000 01  BASIC-REC                        PIC X(600).                 00580000
005100                                                                  00590000
005200 FD  DETAILED-RECEIPTS-FILE                                       00600000
005300     RECORDING MODE F                                             00610000
005400     LABEL RECORDS ARE STANDARD                                   00620000
005500     RECORD CONTAINS 22 CHARACTERS                                00630000
005600     BLOCK CONTAINS 0 RECORDS                                     00640000
005700     DATA RECORD IS DETAILED-REC.                                 00650000
005800 01  DETAILED-REC                     PIC X(22).                  00660000
005900                                                                  00670000
006000     EJECT                                                        00680000
006100*                                                                 00690000
006200 WORKING-STORAGE SECTION.                                         00700000
006300 01  BASIC-RECORD.                                                00710000
006400    05  BR-DEPT-CLASS.                                            00720000
006500      10 BR-CLASS-RECORD.                                         00730000
006600        15 FILLER                    PIC X(01).                   00740000
006700        15 BR-CR-DEPT-NBR            PIC X(03).                   00750000
006800        15 FILLER                    PIC X(01).                   00760000
006900        15 BR-CR-CLASS-NBR           PIC X(02).                   00770000
007000        15 FILLER                    PIC X(11).                   00780000
007100      10 BR-DEPT-RECORD REDEFINES BR-CLASS-RECORD.                00790000
007200        15 BR-DEPT-REC-IND           PIC X(03).                   00800000
007300        15 BR-DR-DEPT-NBR            PIC X(03).                   00810000
007400        15 FILLER                    PIC X(12).                   00820000
007500   05  BR-SEASON-MONTH.                                           00830000
007600      10 BR-SEASON                   PIC X(01).                   00840000
007700      10 BR-CC                       PIC 9(02).                   00850000
007800      10 BR-YY                       PIC 9(02).                   00860000
007900      10 FILLER                      PIC X(01).                   00870000
008000      10 BR-MM                       PIC 9(02).                   00880000
008100   05  FILLER                        PIC X(64).                   00890000
008200   05  BR-PLANNED-RECEIPTS           PIC X(15).                   00900000
008300   05  FILLER                        PIC X(493).                  00910000
008400*                                                                 00920000
008500 01 PV-PROGRAM-VARIABLES.                                         00930000
008600     05 PC-DECIMAL-PLACES            PIC S9(01)      VALUE +4.    00940000
008601     05 PC-MAX-DMA-RECORDS           PIC 9(03)       VALUE 216.   00950000
008602     05 PC-MAX-GMA-RECORDS           PIC 9(03)       VALUE 181.   00960018
008603     05 PC-MAX-CO-RECORDS            PIC 9(02)       VALUE 24.    00970000
008610*                                                                 00980000
008620 01 PV-PROGRAM-VARIABLES.                                         00990000
008630     05 PV-ABEND-PARAGRAPH           PIC X(30)      VALUE SPACES. 01000000
008700     05 PV-PLANNED-RECEIPTS-N        PIC S9(10)V9(04)             01010000
008800                                         COMP-3 VALUE ZERO.       01020000
009100     05 PV-CLASS-NBR                 PIC X(02).                   01030000
009200     05 PV-DEPT-NBR                  PIC X(03).                   01040000
009900     05 PV-PR-CHAR-POS               PIC 9(02)       VALUE ZERO.  01050000
010000     05 PV-PR-CHAR-DECIMAL-POS       PIC 9(02)       VALUE ZERO.  01060000
010200     05 PV-PR-POS-LEFT-OF-DECIMAL    PIC S9(02)      VALUE ZERO.  01070000
010300     05 PV-PR-CHAR                   PIC X(01).                   01080000
010400     05 PV-PR-NBR-LEFT-OF-DECIMAL    PIC 9(7) COMP-3.             01090000
010500     05 PV-PR-NBR-RIGHT-OF-DECIMAL   PIC 9(4) COMP-3.             01100000
010600     05 PV-PR-NBR                    PIC S9(7)V9(4).              01110000
010700     05 PV-HOLD-DEPT                 PIC X(03) VALUE SPACES.      01120000
010800     05 PV-HOLD-CLASS                PIC X(02) VALUE SPACES.      01130000
010900*                                                                 01140000
011000 01  DMA-TOTALS-TABLE.                                            01150000
011100    05  DMA-TOTALS OCCURS 216 TIMES                               01160000
011110         INDEXED BY PV-DMA-TABLE-COUNTER.                         01170000
011200         10  DMA-NO                  PIC X(3)  VALUE SPACES.      01180000
011300            88  EMPTY-DMA-TABLE-SLOT           VALUE SPACE.       01190000
011400         10  DMA-SEASON-MONTH.                                    01200000
011500             15 DMA-SEASON                  PIC X(01).            01210000
011600             15 DMA-SEASON-CC               PIC 9(02).            01220000
011700             15 DMA-SEASON-YY               PIC 9(02).            01230000
011800             15 FILLER                      PIC X(01).            01240000
011900             15 DMA-SEASON-MM               PIC 9(02).            01250000
012000         10  DMA-GMM-NO              PIC X(2)  VALUE SPACES.      01260000
012100         10  DMA-RECEIPT-TOTALS      PIC S9(10)V9(4)              01270000
012200                                         COMP-3 VALUE ZERO.       01280000
012300 01  GMA-TOTALS-TABLE.                                            01290000
012400    05  GMA-TOTALS OCCURS 181 TIMES                               01300017
012410         INDEXED BY PV-GMA-TABLE-COUNTER.                         01310000
012500         10  GMA-NO                  PIC X(3)  VALUE SPACES.      01320000
012600            88  EMPTY-GMA-TABLE-SLOT           VALUE SPACE.       01330000
012700         10  GMA-SEASON-MONTH.                                    01340000
012800             15 GMA-SEASON                  PIC X(01).            01350000
012900             15 GMA-SEASON-CC               PIC 9(02).            01360000
013000             15 GMA-SEASON-YY               PIC 9(02).            01370000
013100             15 FILLER                      PIC X(01).            01380000
013200             15 GMA-SEASON-MM               PIC 9(02).            01390000
013300         10  GMA-RECEIPT-TOTALS      PIC S9(10)V9(4)              01400000
013400                                         COMP-3 VALUE ZERO.       01410000
013500 01  CO-TOTALS-TABLE.                                             01420000
013600    05  CO-TOTALS OCCURS 24 TIMES                                 01430000
013610         INDEXED BY PV-CO-TABLE-COUNTER.                          01440000
013700         10  CO-SEASON-MONTH.                                     01450000
013800             15 CO-SEASON                  PIC X(01) VALUE SPACE. 01460000
013900               88 EMPTY-CO-TABLE-SLOT         VALUE SPACE.        01470000
014000             15 CO-SEASON-CC               PIC 9(02).             01480000
014100             15 CO-SEASON-YY               PIC 9(02).             01490000
014200             15 FILLER                     PIC X(01).             01500000
014300             15 CO-SEASON-MM               PIC 9(02).             01510000
014400         10  CO-RECEIPT-TOTALS      PIC S9(10)V9(4)               01520000
014500                                    COMP-3 VALUE ZERO.            01530000
014600*                                                                 01540000
014700 01  PS-PROGRAM-SWITCHES.                                         01550000
014800     05  PS-BASIC-RECS-EOF-SW            PIC X(01)   VALUE 'N'.   01560000
014900         88  PS-BASIC-RECS-EOF                       VALUE 'Y'.   01570000
015000     05  PS-DMA-FOUND-SW                 PIC X(01)   VALUE 'N'.   01580000
015100         88  PS-DMA-NOT-FOUND                        VALUE 'N'.   01590000
015200         88  PS-DMA-FOUND                            VALUE 'Y'.   01600000
015300     05  PS-GMA-FOUND-SW                 PIC X(01)   VALUE 'N'.   01610000
015400         88  PS-GMA-NOT-FOUND                        VALUE 'N'.   01620000
015500         88  PS-GMA-FOUND                            VALUE 'Y'.   01630000
015600     05  PS-CO-FOUND-SW                  PIC X(01)   VALUE 'N'.   01640000
015700         88  PS-CO-NOT-FOUND                         VALUE 'N'.   01650000
015800         88  PS-CO-FOUND                             VALUE 'Y'.   01660000
015900     05  PS-SP-FOUND-SW                  PIC X(01)   VALUE 'N'.   01670000
016000         88  PS-SP-NOT-FOUND                         VALUE 'N'.   01680000
016100         88  PS-SP-FOUND                             VALUE 'Y'.   01690000
016200     05  PS-PR-NEGATIVE-SW               PIC X(01)   VALUE 'N'.   01700000
016300         88  PS-PR-NOT-NEGATIVE                      VALUE 'N'.   01710000
016400         88  PS-PR-NEGATIVE                          VALUE 'Y'.   01720000
016200     05  PS-CLASS-RECS-IN-FILE-SW        PIC X(01)   VALUE 'N'.   01730000
016300         88  PS-NO-CLASS-RECS-IN-FILE                VALUE 'N'.   01740000
016400         88  PS-CLASS-RECS-IN-FILE                   VALUE 'Y'.   01750000
           05  PS-TMDSEAR-ERROR-SW             PIC X(01)   VALUE 'N'.   01760005
               88  PS-NO-TMDSEAR-ERROR                     VALUE 'N'.   01770005
               88  PS-TMDSEAR-ERROR                        VALUE 'Y'.   01780005
016500*                                                                 01790000
016600 01 PV-ABEND-CODE                   PIC S9(04)     VALUE +0       01800000
016700                                                      COMP SYNC.  01810000
016800     88 ABEND-4001-WRITE-ERROR                     VALUE +4001.   01820000
016900     88 ABEND-4002-READ-ERROR                      VALUE +4002.   01830000
017000     88 ABEND-4003-CTRL-CARD-ERROR                 VALUE +4003.   01840000
017100     88 ABEND-4004-TABLE-ERROR                     VALUE +4004.   01850000
017200     88 ABEND-4005-OPEN-ERROR                      VALUE +4005.   01860000
017300     88 ABEND-4006-CLOSE-ERROR                     VALUE +4006.   01870000
017400     88 ABEND-4007-SEQUENCE-ERROR                  VALUE +4007.   01880000
017500     88 ABEND-4008-DATA-ERROR                      VALUE +4008.   01890000
017600     88 ABEND-4009-KEY-DATA-ERROR                  VALUE +4009.   01900000
017900     88 ABEND-4013-DB2-ERROR                       VALUE +4013.   01910000
018000                                                                  01920000
018100*                                                                 01930000
018200******************************************************************01940000
018300*  MERCHANDISE PLANNING FILE LAYOUT.                              01950000
018400******************************************************************01960000
018500     COPY PORD031.                                                01970013
018600                                                                  01980000
018700* MERCHANDISE AREA TABLE.                                         01990000
018800     EXEC SQL                                                     02000000
018900         INCLUDE TMDSEAR                                          02010000
019000     END-EXEC.                                                    02020000
019100 EJECT                                                            02030000
019200*                                                                 02040000
019300* DB2 COMMUNICATION AREA                                          02050000
019400*                                                                 02060000
019500     EXEC SQL                                                     02070000
019600         INCLUDE SQLCA                                            02080000
019700     END-EXEC.                                                    02090000
019800 EJECT                                                            02100000
019900* DB2 COMMUNICATION AREA2                                         02110000
020000*                                                                 02120000
020100     COPY SQLCA2.                                                 02130000
020200 EJECT                                                            02140000
020300*                                                                 02150000
020400*                                                                 02160000
020500******************************************************************02170000
020600* MAIN BODY OF PROGRAM                                           *02180000
020700******************************************************************02190000
020800 PROCEDURE DIVISION.                                              02200000
020900                                                                  02210000
021000 0000-MAINLINE.                                                   02220000
021100     PERFORM 1000-INITIALIZE.                                     02230000
021200                                                                  02240000
021300     IF PS-BASIC-RECS-EOF                                         02250000
021400        DISPLAY 'NO RECORDS IN INPUT FILE'                        02260000
021500        DISPLAY '** POKUT081 ABEND - INPUT FILE EMPTY **'         02270000
021600        MOVE +4008                  TO PV-ABEND-CODE              02280000
021700        CALL 'ILBOABN0'             USING PV-ABEND-CODE           02290000
021800     ELSE                                                         02300000
021900       PERFORM 2000-PROCESS-INPUT                                 02310000
022000         UNTIL PS-BASIC-RECS-EOF                                  02320000
022100     END-IF.                                                      02330000
                                                                        02340000
           IF PS-NO-CLASS-RECS-IN-FILE                                  02350000
              DISPLAY 'NO CLASS RECORDS IN INPUT FILE'                  02360000
              DISPLAY '** POKUT081 ABEND - INPUT FILE ERROR **'         02370000
              MOVE +4008                  TO PV-ABEND-CODE              02380000
              CALL 'ILBOABN0'             USING PV-ABEND-CODE           02390000
           END-IF                                                       02400000
022200                                                                  02410000
022300     PERFORM 9200-WRITE-DMA-RECORDS.                              02420000
022400     PERFORM 9300-WRITE-GMA-RECORDS.                              02430000
022500     PERFORM 9400-WRITE-CO-RECORDS.                               02440000
022600                                                                  02450000
022700     CLOSE BASIC-RECEIPTS-FILE                                    02460000
022800           DETAILED-RECEIPTS-FILE.                                02470000
022900     GOBACK.                                                      02480000
023000*                                                                 02490000
023100******************************************************************02500000
023200*     PERFORM INITIALIZATIONS                                    *02510000
023300******************************************************************02520000
023400                                                                  02530000
023500 1000-INITIALIZE.                                                 02540000
023600     OPEN INPUT  BASIC-RECEIPTS-FILE.                             02550000
023700     OPEN OUTPUT DETAILED-RECEIPTS-FILE.                          02560000
023800     PERFORM 9000-READ-BASIC-RECEIPTS.                            02570000
023900*                                                                 02580000
024000*                                                                 02590000
024100******************************************************************02600000
024200*     PROCESS INPUT RECORDS                                      *02610000
024300******************************************************************02620000
024400                                                                  02630000
024500 2000-PROCESS-INPUT.                                              02640000
024600     PERFORM 2100-REFORMAT-PLANNED-RECEIPTS.                      02650000
024700     IF (BR-DEPT-REC-IND EQUAL 'DPT')                             02660000
024800       PERFORM 3000-PROCESS-DEPT-REC                              02670000
024900     ELSE                                                         02680000
             SET PS-CLASS-RECS-IN-FILE TO TRUE                          02690000
025000       MOVE BR-CR-CLASS-NBR TO PV-CLASS-NBR                       02700000
025100       MOVE BR-CR-DEPT-NBR TO PV-DEPT-NBR                         02710000
025200       IF ((PV-DEPT-NBR NOT EQUAL PV-HOLD-DEPT) OR                02720000
025300           (PV-CLASS-NBR NOT EQUAL PV-HOLD-CLASS))                02730000
025400         PERFORM 4000-GET-MDSEAR-INFO                             02740000
025500       END-IF                                                     02750000
025600     END-IF.                                                      02760000
      * IF THE MDSEAR ROW WAS FOUND FOR THE DEPT AND CLASS, WRITE THE   02770010
      * OUTPUT RECORD.  IF THE ROW WAS NOT FOUND AND AND THE PLANNED    02780011
      * RECEIPT AMOUNT IS ZERO, DO NOT WRITE AN OUTPUT RECORD, AND LET  02790010
      * THE PROGRAM READ IN THE NEXT RECORD FROM THE INPUT FILE.  IF THE02800010
      * TMDSEAR ROW WAS NOT FOUND AND THE PLANNED RECEIPT AMOUNT IS NOT 02810012
      * ZERO, THE PROGRAM WILL ABEND.                                   02820012
           IF PS-NO-TMDSEAR-ERROR                                       02830004
025700       PERFORM 9100-WRITE-DEPT-CLASS-RECS                         02840004
           ELSE                                                         02850006
             IF PV-PLANNED-RECEIPTS-N NOT EQUAL ZERO                    02860006
               DISPLAY 'A RECORD WITHOUT A CORRESPONDING TMDSEAR ROW'   02870008
               DISPLAY 'HAS PLANNED RECEIPTS NOT EQUAL TO ZERO.'        02880008
               DISPLAY 'SEASON AND MONTH: ' BR-SEASON-MONTH             02890007
               DISPLAY 'PLANNED RECEIPT AMOUNT: 'BR-PLANNED-RECEIPTS    02900007
               DISPLAY PV-ABEND-PARAGRAPH                               02910006
               PERFORM 9999-SQL-ERROR                                   02920006
             END-IF                                                     02930006
           END-IF.                                                      02940004
025800     MOVE PV-DEPT-NBR TO PV-HOLD-DEPT.                            02950000
025900     MOVE PV-CLASS-NBR TO PV-HOLD-CLASS.                          02960000
026000     PERFORM 9000-READ-BASIC-RECEIPTS.                            02970000
026100*                                                                 02980000
026200******************************************************************02990000
026300*     PROCESS DEPARTMENT RECORD                                  *03000000
026400******************************************************************03010000
026500                                                                  03020000
026600 2100-REFORMAT-PLANNED-RECEIPTS.                                  03030000
026700     SET PS-SP-NOT-FOUND TO TRUE.                                 03040000
026800     SET PS-PR-NOT-NEGATIVE TO TRUE.                              03050000
026900     MOVE ZERO TO PV-PR-CHAR-DECIMAL-POS.                         03060000
027000     MOVE ZERO TO  PV-PR-POS-LEFT-OF-DECIMAL.                     03070000
027100                                                                  03080000
027200     IF (BR-PLANNED-RECEIPTS(1:1) EQUAL '-')                      03090000
027300       MOVE 1 TO PV-PR-CHAR-POS                                   03100000
027400       SET PS-PR-NEGATIVE TO TRUE                                 03110000
027500     ELSE                                                         03120000
027600       MOVE 0 TO PV-PR-CHAR-POS                                   03130000
027700     END-IF.                                                      03140000
027800                                                                  03150000
027900     PERFORM UNTIL (PS-SP-FOUND)                                  03160000
028000       ADD 1 TO PV-PR-CHAR-POS                                    03170000
028100       MOVE BR-PLANNED-RECEIPTS(PV-PR-CHAR-POS:1)                 03180000
028200                            TO PV-PR-CHAR                         03190000
028300       IF (PV-PR-CHAR EQUAL  ' ')                                 03200000
028400         SET PS-SP-FOUND TO TRUE                                  03210000
028500       ELSE                                                       03220000
028600         IF (PV-PR-CHAR EQUAL  '.')                               03230000
028700           MOVE PV-PR-CHAR-POS TO PV-PR-CHAR-DECIMAL-POS          03240000
028800         END-IF                                                   03250000
028900       END-IF                                                     03260000
029000       IF ((PV-PR-CHAR-DECIMAL-POS EQUAL ZERO) AND                03270000
029100            (PV-PR-CHAR NOT EQUAL  ' '))                          03280000
029200         ADD 1 TO PV-PR-POS-LEFT-OF-DECIMAL                       03290000
029300       END-IF                                                     03300000
029400     END-PERFORM.                                                 03310000
029500                                                                  03320000
029600     SUBTRACT 1 FROM PV-PR-CHAR-POS                               03330000
029700                                                                  03340000
029800     IF (PS-PR-NOT-NEGATIVE)                                      03350000
029900       MOVE BR-PLANNED-RECEIPTS(1:PV-PR-POS-LEFT-OF-DECIMAL)      03360000
030000         TO PV-PR-NBR-LEFT-OF-DECIMAL                             03370000
030100     ELSE                                                         03380000
030200       MOVE BR-PLANNED-RECEIPTS(2:PV-PR-POS-LEFT-OF-DECIMAL)      03390000
030300         TO PV-PR-NBR-LEFT-OF-DECIMAL                             03400000
030400     END-IF.                                                      03410000
030500                                                                  03420000
030600     IF (((PV-PR-CHAR-DECIMAL-POS NOT EQUAL ZERO) AND             03430000
030610         ((PV-PR-CHAR-POS - PV-PR-CHAR-DECIMAL-POS) EQUAL         03440000
030611          PC-DECIMAL-PLACES))                                     03450000
030620     OR (PV-PR-CHAR-DECIMAL-POS EQUAL ZERO))                      03460000
030650       IF (PV-PR-CHAR-DECIMAL-POS NOT EQUAL ZERO)                 03470000
030700         MOVE BR-PLANNED-RECEIPTS((PV-PR-CHAR-DECIMAL-POS + 1):   03480000
030800                        (PV-PR-CHAR-POS - PV-PR-CHAR-DECIMAL-POS))03490000
030900           TO PV-PR-NBR-RIGHT-OF-DECIMAL                          03500000
030910       ELSE                                                       03510000
030920         MOVE ZERO TO PV-PR-NBR-RIGHT-OF-DECIMAL                  03520000
030930       END-IF                                                     03530000
031000     ELSE                                                         03540000
031010         DISPLAY '*** ABEND ***'                                  03550000
031020         DISPLAY '*** THERE IS AN INVALID NUMBER FORMAT ***'      03560000
031021         DISPLAY 'PLANNED RECEIPT AMOUNT = ' BR-PLANNED-RECEIPTS  03570000
031030         SET ABEND-4008-DATA-ERROR TO TRUE                        03580000
031040         CALL 'ILBOABN0' USING PV-ABEND-CODE                      03590000
031200     END-IF.                                                      03600000
031300                                                                  03610000
031400     IF PS-PR-NEGATIVE                                            03620000
031500       COMPUTE PV-PLANNED-RECEIPTS-N =                            03630000
031600          ((PV-PR-NBR-LEFT-OF-DECIMAL +                           03640000
031700           (PV-PR-NBR-RIGHT-OF-DECIMAL / 10000)) * -1)            03650000
031800     ELSE                                                         03660000
031900       COMPUTE PV-PLANNED-RECEIPTS-N =                            03670000
032000          (PV-PR-NBR-LEFT-OF-DECIMAL +                            03680000
032100           (PV-PR-NBR-RIGHT-OF-DECIMAL / 10000))                  03690000
032200     END-IF.                                                      03700000
032400*                                                                 03710000
032500******************************************************************03720000
032600*     PROCESS DEPARTMENT RECORD                                  *03730000
032700******************************************************************03740000
032800                                                                  03750000
032900 3000-PROCESS-DEPT-REC.                                           03760000
033000       MOVE '00' TO PV-CLASS-NBR                                  03770000
033100       MOVE BR-DR-DEPT-NBR TO PV-DEPT-NBR                         03780000
033200       IF ((PV-DEPT-NBR NOT EQUAL PV-HOLD-DEPT) OR                03790000
033300           (PV-CLASS-NBR NOT EQUAL PV-HOLD-CLASS))                03800000
033400         PERFORM 4000-GET-MDSEAR-INFO                             03810000
033500       END-IF.                                                    03820000
             IF PS-NO-TMDSEAR-ERROR                                     03830004
033600         PERFORM 3100-ADD-TO-DMA-TOTALS                           03840004
033700         PERFORM 3200-ADD-TO-GMA-TOTALS                           03850004
033800         PERFORM 3300-ADD-TO-CO-TOTALS                            03860004
             END-IF.                                                    03870004
033900*                                                                 03880000
034000******************************************************************03890000
034100*     ADD DEPARTMENT TOTALS TO PROPER DMA TOTALS                 *03900000
034200******************************************************************03910000
034300                                                                  03920000
034400 3100-ADD-TO-DMA-TOTALS.                                          03930000
034500     SET PS-DMA-NOT-FOUND TO TRUE.                                03940000
034600     PERFORM VARYING PV-DMA-TABLE-COUNTER                         03950000
034700                 FROM 1 BY 1                                      03960000
034800                 UNTIL (PV-DMA-TABLE-COUNTER >                    03970000
034900                        PC-MAX-DMA-RECORDS                        03980000
035000                        OR PS-DMA-FOUND)                          03990000
035100       IF EMPTY-DMA-TABLE-SLOT(PV-DMA-TABLE-COUNTER)              04000000
035200       THEN                                                       04010000
035300         MOVE MDSEAR-DMA-NBR  TO                                  04020000
035400              DMA-NO(PV-DMA-TABLE-COUNTER)                        04030000
035500         MOVE BR-SEASON-MONTH TO                                  04040000
035600              DMA-SEASON-MONTH(PV-DMA-TABLE-COUNTER)              04050000
035700         ADD PV-PLANNED-RECEIPTS-N TO                             04060000
035800             DMA-RECEIPT-TOTALS(PV-DMA-TABLE-COUNTER)             04070000
035900         MOVE MDSEAR-GMA-NBR TO DMA-GMM-NO(PV-DMA-TABLE-COUNTER)  04080000
036000         SET PS-DMA-FOUND TO TRUE                                 04090000
036100       ELSE                                                       04100000
036200         IF (MDSEAR-DMA-NBR = DMA-NO(PV-DMA-TABLE-COUNTER) AND    04110000
036300             BR-SEASON-MONTH =                                    04120000
036400                          DMA-SEASON-MONTH(PV-DMA-TABLE-COUNTER)) 04130000
036500           ADD PV-PLANNED-RECEIPTS-N TO                           04140000
036600               DMA-RECEIPT-TOTALS(PV-DMA-TABLE-COUNTER)           04150000
036700           SET PS-DMA-FOUND TO TRUE                               04160000
036800         END-IF                                                   04170000
036900       END-IF                                                     04180000
037000     END-PERFORM.                                                 04190000
037100                                                                  04200000
037200     IF (PV-DMA-TABLE-COUNTER > PC-MAX-DMA-RECORDS)               04210000
037300         DISPLAY '*** ABEND ***'                                  04220000
037400         DISPLAY '*** THERE ARE MORE THAN 216 DMA RECORDS ***'    04230000
037500         SET ABEND-4008-DATA-ERROR TO TRUE                        04240000
037600         CALL 'ILBOABN0' USING PV-ABEND-CODE                      04250000
037700     END-IF.                                                      04260000
037800*                                                                 04270000
037900******************************************************************04280000
038000*     ADD DEPARTMENT TOTALS TO PROPER GMA TOTALS                 *04290000
038100******************************************************************04300000
038200                                                                  04310000
038300 3200-ADD-TO-GMA-TOTALS.                                          04320000
038400     SET PS-GMA-NOT-FOUND TO TRUE.                                04330000
038500     PERFORM VARYING PV-GMA-TABLE-COUNTER                         04340000
038600                 FROM 1 BY 1                                      04350000
038700                 UNTIL (PV-GMA-TABLE-COUNTER >                    04360000
038800                        PC-MAX-GMA-RECORDS                        04370000
038900                        OR PS-GMA-FOUND)                          04380000
039000       IF EMPTY-GMA-TABLE-SLOT(PV-GMA-TABLE-COUNTER)              04390000
039100       THEN                                                       04400000
039200         MOVE MDSEAR-GMA-NBR  TO                                  04410000
039300              GMA-NO(PV-GMA-TABLE-COUNTER)                        04420000
039400         MOVE BR-SEASON-MONTH TO                                  04430000
039500              GMA-SEASON-MONTH(PV-GMA-TABLE-COUNTER)              04440000
039600         ADD PV-PLANNED-RECEIPTS-N TO                             04450000
039700             GMA-RECEIPT-TOTALS(PV-GMA-TABLE-COUNTER)             04460000
039800         SET PS-GMA-FOUND TO TRUE                                 04470000
039900       ELSE                                                       04480000
040000         IF (MDSEAR-GMA-NBR = GMA-NO(PV-GMA-TABLE-COUNTER) AND    04490000
040100             BR-SEASON-MONTH =                                    04500000
040200                          GMA-SEASON-MONTH(PV-GMA-TABLE-COUNTER)) 04510000
040300           ADD PV-PLANNED-RECEIPTS-N TO                           04520000
040400               GMA-RECEIPT-TOTALS(PV-GMA-TABLE-COUNTER)           04530000
040500           SET PS-GMA-FOUND TO TRUE                               04540000
040600         END-IF                                                   04550000
040700       END-IF                                                     04560000
040800     END-PERFORM.                                                 04570000
040900                                                                  04580000
041000     IF (PV-GMA-TABLE-COUNTER > PC-MAX-GMA-RECORDS)               04590000
041100         DISPLAY '*** ABEND ***'                                  04600000
041200         DISPLAY '*** THERE ARE MORE THAN 181 GMA RECORDS ***'    04610017
041300         SET ABEND-4008-DATA-ERROR TO TRUE                        04620000
041400         CALL 'ILBOABN0' USING PV-ABEND-CODE                      04630000
041500     END-IF.                                                      04640000
041600*                                                                 04650000
041700******************************************************************04660000
041800*     ADD DEPARTMENT TOTALS TO PROPER COMPANY TOTALS             *04670000
041900******************************************************************04680000
042000                                                                  04690000
042100 3300-ADD-TO-CO-TOTALS.                                           04700000
042200     SET PS-CO-NOT-FOUND TO TRUE.                                 04710000
042300     PERFORM VARYING PV-CO-TABLE-COUNTER                          04720000
042400                 FROM 1 BY 1                                      04730000
042500                 UNTIL (PV-CO-TABLE-COUNTER >                     04740000
042600                        PC-MAX-CO-RECORDS                         04750000
042700                        OR PS-CO-FOUND)                           04760000
042800       IF EMPTY-CO-TABLE-SLOT(PV-CO-TABLE-COUNTER)                04770000
042900       THEN                                                       04780000
043000         MOVE BR-SEASON-MONTH TO                                  04790000
043100              CO-SEASON-MONTH(PV-CO-TABLE-COUNTER)                04800000
043200         ADD PV-PLANNED-RECEIPTS-N TO                             04810000
043300             CO-RECEIPT-TOTALS(PV-CO-TABLE-COUNTER)               04820000
043400         SET PS-CO-FOUND TO TRUE                                  04830000
043500       ELSE                                                       04840000
043600         IF (BR-SEASON-MONTH =                                    04850000
043700                          CO-SEASON-MONTH(PV-CO-TABLE-COUNTER))   04860000
043800           ADD PV-PLANNED-RECEIPTS-N TO                           04870000
043900               CO-RECEIPT-TOTALS(PV-CO-TABLE-COUNTER)             04880000
044000           SET PS-CO-FOUND TO TRUE                                04890000
044100         END-IF                                                   04900000
044200       END-IF                                                     04910000
044300     END-PERFORM.                                                 04920000
044400                                                                  04930000
044500     IF (PV-CO-TABLE-COUNTER > PC-MAX-CO-RECORDS)                 04940000
044600         DISPLAY '*** ABEND ***'                                  04950000
044700         DISPLAY '*** THERE ARE MORE THAN 24 CO RECORDS ***'      04960000
044800         SET ABEND-4008-DATA-ERROR TO TRUE                        04970000
044900         CALL 'ILBOABN0' USING PV-ABEND-CODE                      04980000
045000     END-IF.                                                      04990000
045100*                                                                 05000000
045200******************************************************************05010000
045300*     GET GMM, DMA, AND BUYER INFORMATION FROM TMDSEAR TABLE     *05020000
045400******************************************************************05030000
045500                                                                  05040000
045600 4000-GET-MDSEAR-INFO.                                            05050000
           SET PS-NO-TMDSEAR-ERROR TO TRUE                              05060004
045700     MOVE '4000-GET-MDSEAR-INFO'                                  05070000
045800                                 TO PV-ABEND-PARAGRAPH.           05080000
045900                                                                  05090000
046000     EXEC SQL                                                     05100000
046100          SELECT O.GMA_NBR                                        05110000
046200                ,O.DMA_NBR                                        05120000
046300                ,O.BYR_NBR                                        05130000
046400            INTO :MDSEAR-GMA-NBR                                  05140000
046500                ,:MDSEAR-DMA-NBR                                  05150000
046600                ,:MDSEAR-BYR-NBR                                  05160000
046700          FROM TMDSEAR O                                          05170000
046800          WHERE O.DEPT_NBR = :PV-DEPT-NBR                         05180000
046900            AND O.MAJ_CL_NBR = :PV-CLASS-NBR                      05190000
047000            AND O.SUB_CL_NBR = '000'                              05200000
047100            AND O.END_DTE =                                       05210000
047200                (SELECT MAX(I.END_DTE)                            05220000
047300                 FROM TMDSEAR I                                   05230000
047400                 WHERE O.DEPT_NBR   = I.DEPT_NBR                  05240000
047500                 AND   O.MAJ_CL_NBR = I.MAJ_CL_NBR                05250000
047600                 AND I.SUB_CL_NBR   ='000')                       05260000
047700     END-EXEC.                                                    05270000
047800                                                                  05280000
047900     EVALUATE TRUE                                                05290000
048000       WHEN SQLCODE = ZEROS                                       05300000
048100         CONTINUE                                                 05310001
             WHEN SQLCODE = +100                                        05320006
               DISPLAY ' DEPT: ' PV-DEPT-NBR                            05330006
                      ,' MAJOR CLASS: 'PV-CLASS-NBR                     05340006
               SET PS-TMDSEAR-ERROR TO TRUE                             05350006
048400       WHEN OTHER                                                 05360000
               DISPLAY ' DEPT: ' PV-DEPT-NBR                            05370003
                      ,' MAJOR CLASS: 'PV-CLASS-NBR                     05380003
               SET PS-TMDSEAR-ERROR TO TRUE                             05390004
048500         DISPLAY PV-ABEND-PARAGRAPH                               05400006
048600         PERFORM 9999-SQL-ERROR                                   05410006
048700     END-EVALUATE.                                                05420000
048800*                                                                 05430000
048900******************************************************************05440000
049000*     READ INPUT RECORDS                                         *05450000
049100******************************************************************05460000
049200                                                                  05470000
049300 9000-READ-BASIC-RECEIPTS.                                        05480000
049400     READ BASIC-RECEIPTS-FILE                                     05490000
049500         INTO BASIC-RECORD                                        05500000
049600         AT END                                                   05510000
049700              SET PS-BASIC-RECS-EOF TO TRUE.                      05520000
049800*                                                                 05530000
049900******************************************************************05540000
050000*     WRITE DETAILED CLASS OR DEPARTMENT RECORD                  *05550000
050100******************************************************************05560000
050200                                                                  05570000
050300 9100-WRITE-DEPT-CLASS-RECS.                                      05580000
050400     MOVE MDSEAR-GMA-NBR TO PO031-GMM-NO.                         05590000
050500     MOVE MDSEAR-DMA-NBR TO PO031-DIV-NO.                         05600000
050600     MOVE PV-DEPT-NBR    TO PO031-DEPT-NO.                        05610000
050700     MOVE PV-CLASS-NBR   TO PO031-CLASS-NO.                       05620000
050800     MOVE BR-YY          TO PO031-YEAR-NO.                        05630000
050900     MOVE BR-MM          TO PO031-MONTH-NO.                       05640000
051000     MOVE MDSEAR-BYR-NBR TO PO031-BUYER-NMBR.                     05650000
051100     MOVE PV-PLANNED-RECEIPTS-N TO PO031-PLAN-RCPTS.              05660000
051400     WRITE DETAILED-REC FROM PO031-MERCH-PLAN-REC.                05670000
051500*                                                                 05680000
051600******************************************************************05690000
051700*     WRITE DMA RECORDS                                          *05700000
051800******************************************************************05710000
051900                                                                  05720000
052000 9200-WRITE-DMA-RECORDS.                                          05730000
052100     PERFORM VARYING PV-DMA-TABLE-COUNTER                         05740000
052200                 FROM 1 BY 1                                      05750000
052300                 UNTIL (EMPTY-DMA-TABLE-SLOT(PV-DMA-TABLE-COUNTER)05760000
052400                   OR  (PV-DMA-TABLE-COUNTER >                    05770000
052500                         PC-MAX-DMA-RECORDS))                     05780000
052600                                                                  05790000
052700       MOVE DMA-GMM-NO(PV-DMA-TABLE-COUNTER)     TO PO031-GMM-NO  05800000
052800       MOVE DMA-NO(PV-DMA-TABLE-COUNTER)         TO PO031-DIV-NO  05810000
052900       MOVE '000'        TO PO031-DEPT-NO                         05820000
053000       MOVE '00'         TO PO031-CLASS-NO                        05830000
053100       MOVE DMA-SEASON-YY(PV-DMA-TABLE-COUNTER)  TO PO031-YEAR-NO 05840000
053200       MOVE DMA-SEASON-MM(PV-DMA-TABLE-COUNTER)  TO PO031-MONTH-NO05850000
053300       MOVE '000'        TO PO031-BUYER-NMBR                      05860000
053400       MOVE DMA-RECEIPT-TOTALS(PV-DMA-TABLE-COUNTER)              05870000
053500                         TO PO031-PLAN-RCPTS                      05880000
053600                                                                  05890000
053700       WRITE DETAILED-REC FROM PO031-MERCH-PLAN-REC               05900000
054300     END-PERFORM.                                                 05910000
054400******************************************************************05920000
054500*     WRITE GMA RECORDS                                          *05930000
054600******************************************************************05940000
054700                                                                  05950000
054800 9300-WRITE-GMA-RECORDS.                                          05960000
054900     PERFORM VARYING PV-GMA-TABLE-COUNTER                         05970000
055000                 FROM 1 BY 1                                      05980000
055100                 UNTIL (EMPTY-GMA-TABLE-SLOT(PV-GMA-TABLE-COUNTER)05990000
055200                    OR  (PV-GMA-TABLE-COUNTER >                   06000000
055300                         PC-MAX-GMA-RECORDS))                     06010000
055400                                                                  06020000
055500       MOVE GMA-NO(PV-GMA-TABLE-COUNTER)     TO PO031-GMM-NO      06030000
055600       MOVE '00'                             TO PO031-DIV-NO      06040000
055700       MOVE '000'        TO PO031-DEPT-NO                         06050000
055800       MOVE '00'         TO PO031-CLASS-NO                        06060000
055900       MOVE GMA-SEASON-YY(PV-GMA-TABLE-COUNTER)  TO PO031-YEAR-NO 06070000
056000       MOVE GMA-SEASON-MM(PV-GMA-TABLE-COUNTER)  TO PO031-MONTH-NO06080000
056100       MOVE '000'        TO PO031-BUYER-NMBR                      06090000
056200       MOVE GMA-RECEIPT-TOTALS(PV-GMA-TABLE-COUNTER)              06100000
056300                         TO PO031-PLAN-RCPTS                      06110000
056400                                                                  06120000
056500       WRITE DETAILED-REC FROM PO031-MERCH-PLAN-REC               06130000
057100     END-PERFORM.                                                 06140000
057200******************************************************************06150000
057300*     WRITE COMPANY RECORDS                                      *06160000
057400******************************************************************06170000
057500                                                                  06180000
057600 9400-WRITE-CO-RECORDS.                                           06190000
057700     PERFORM VARYING PV-CO-TABLE-COUNTER                          06200000
057800                 FROM 1 BY 1                                      06210000
057900                 UNTIL (EMPTY-CO-TABLE-SLOT(PV-CO-TABLE-COUNTER)  06220000
058000                   OR  (PV-CO-TABLE-COUNTER >                     06230000
058100                         PC-MAX-CO-RECORDS))                      06240000
058200                                                                  06250000
058300       MOVE '00'         TO PO031-GMM-NO                          06260000
058400       MOVE '00'         TO PO031-DIV-NO                          06270000
058500       MOVE '000'        TO PO031-DEPT-NO                         06280000
058600       MOVE '00'         TO PO031-CLASS-NO                        06290000
058700       MOVE CO-SEASON-YY(PV-CO-TABLE-COUNTER)  TO PO031-YEAR-NO   06300000
058800       MOVE CO-SEASON-MM(PV-CO-TABLE-COUNTER)  TO PO031-MONTH-NO  06310000
058900       MOVE '000'        TO PO031-BUYER-NMBR                      06320000
059000       MOVE CO-RECEIPT-TOTALS(PV-CO-TABLE-COUNTER)                06330000
059100                         TO PO031-PLAN-RCPTS                      06340000
059200                                                                  06350000
059300       WRITE DETAILED-REC FROM PO031-MERCH-PLAN-REC               06360000
059900     END-PERFORM.                                                 06370000
060000******************************************************************06380000
060100*     SQL WARNING OR ERROR PROCESSING                            *06390000
060200******************************************************************06400000
060300                                                                  06410000
060400 9999-SQL-ERROR.                                                  06420000
060500*--------                                                         06430000
060600                                                                  06440000
060700     MOVE SQLCODE    TO SQLCODE2.                                 06450000
060800     MOVE SQLERRD(3) TO SQLERRD3.                                 06460000
060900     DISPLAY '** ABEND **       ** = SQLERROR'.                   06470000
061000     DISPLAY '** PROGRAM        ** = POKUT080'.                   06480000
061100     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  06490000
061200     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  06500000
061300     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   06510000
061400     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  06520000
061500     MOVE +4013 TO PV-ABEND-CODE.                                 06530000
061600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         06540000
061700*                                                                 06550000
061800******************************************************************06560000
