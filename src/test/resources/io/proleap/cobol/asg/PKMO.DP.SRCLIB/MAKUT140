       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.      MAKUT140.                                       00020000
       AUTHOR.          L. GRIESBACH.                                   00030000
       INSTALLATION.    KOHLS DEPARTMENT STORES.                        00040000
      ***************************************************************** 00060000
      *  THE PURPOSE OF THIS PROGRAM IS TO GET MESSAGES FROM THE      * 00070000
      *  RMS HUB.                                                     * 00080002
      *                                                               * 00100000
      *  THIS PROGRAM RETRIEVES RECORDS FROM MQ SERIES QUEUE          * 00180000
      *  MA.MERCHANDISE.HIERARCHY.Q.  THE WAY THIS QUEUE IS SET UP    * 00190003
      *  IS THAT ONCE A MQGET IS DONE, A RECORD WILL BE MARKED AS     * 00200000
      *  "READ".  ONCE A MQCMIT IS DONE, A RECORD WILL ACTUALLY BE    * 00210000
      *  DELETED FROM THE QUEUE.  WHEN A MQBACK IS DONE, ALL RECORDS  * 00220000
      *  MARKED AS "READ" WILL BE CHANGED BACK TO "UNREAD" SO THAT    * 00221000
      *  THE PROGRAM CAN BE RESTARTED.                                * 00222000
      *                                                               * 00223000
      *  IN THIS PROGRAM, THE MQ WAIT INTERVAL DEFAULT TIME OF 0 WILL * 00224000
      *  BE USED.  IF THE TIME WAS SET TO 1 MINUTE (60000), MQ SERIES * 00225000
      *  WOULD KEEP WAITING FOR NEW MESSAGES FOR ANOTHER MINUTE.  IN  * 00226000
      *  THE EVENT THAT MESSAGES KEPT TRICKLING IN, THE JOB STEP      * 00227000
      *  THAT CONTAINS THIS PROGRAM COULD BE KEPT ACTIVE FOR AN       * 00228000
      *  EXTENDED PERIOD OF TIME.  SO, IT'S BEST TO KEEP THE WAIT     * 00229000
      *  INTERVAL AT 0 SO THAT THE EXECUTION OF THIS PROGRAM ENDS     * 00229100
      *  WITHIN A REASONABLE PERIOD OF TIME.                          * 00229200
      *                                                               * 00229300
      ***************************************************************** 00229400
      *    WR/PITS#     DATE        DESCRIPTION                       * 00229500
      *    --------   --------   -----------------------------------  * 00229600
      ***************************************************************** 00229700
                                                                        00229800
       ENVIRONMENT DIVISION.                                            00229900
       CONFIGURATION SECTION.                                           00230000
                                                                        00240000
       SOURCE-COMPUTER.       IBM-3090.                                 00250000
       OBJECT-COMPUTER.       IBM-3090.                                 00260000
                                                                        00270000
       INPUT-OUTPUT SECTION.                                            00280000
                                                                        00290000
       FILE-CONTROL.                                                    00300000
           SELECT CONTROL-CARD-1   ASSIGN TO INP01.                     00310000
           SELECT CONTROL-CARD-2   ASSIGN TO INP02.                     00320000
           SELECT MERCH-FILE       ASSIGN TO OUT01.                     00330001
                                                                        00340000
       DATA DIVISION.                                                   00350000
       FILE SECTION.                                                    00360000
                                                                        00370000
       FD  CONTROL-CARD-1                                               00380000
           RECORDING MODE F                                             00390000
           BLOCK CONTAINS 0 RECORDS                                     00400000
           LABEL RECORDS ARE OMITTED.                                   00410000
       01  CONTROL-CARD-1-RECORD        PIC X(80).                      00420000
                                                                        00430000
       FD  CONTROL-CARD-2                                               00440000
           RECORDING MODE F                                             00450000
           BLOCK CONTAINS 0 RECORDS                                     00460000
           LABEL RECORDS ARE OMITTED.                                   00470000
       01  CONTROL-CARD-2-RECORD        PIC X(80).                      00480000
                                                                        00490000
       FD  MERCH-FILE                                                   00500001
           RECORDING MODE F                                             00510000
           LABEL RECORDS OMITTED                                        00520000
           BLOCK CONTAINS  0 RECORDS.                                   00530000
       01  MERCH-RECORD                 PIC X(500).                     00540006
                                                                        00550000
       WORKING-STORAGE SECTION.                                         00560000
       01  WS-CONSTANTS.                                                00570000
           05  WS-MQCONN                PIC X(8)  VALUE 'CSQBCONN'.     00580000
           05  WS-MQOPEN                PIC X(8)  VALUE 'CSQBOPEN'.     00590000
           05  WS-MQGET                 PIC X(8)  VALUE 'CSQBGET'.      00600000
           05  WS-MQBACK                PIC X(8)  VALUE 'CSQBBACK'.     00610000
           05  WS-MQCMIT                PIC X(8)  VALUE 'CSQBCOMM'.     00620000
           05  WS-MQCLOSE               PIC X(8)  VALUE 'CSQBCLOS'.     00630000
           05  WS-MQDISC                PIC X(8)  VALUE 'CSQBDISC'.     00640000
                                                                        00650000
      ********************************************************          00660000
      *    API CONTROL BLOCKS                                *          00670000
      ********************************************************          00680000
       01  MQM-OBJECT-DESCRIPTOR.                                       00690000
           COPY CMQODV.                                                 00700000
       01  MQM-MESSAGE-DESCRIPTOR.                                      00710000
           COPY CMQMDV.                                                 00720000
       01  MQM-GET-MESSAGE-OPTIONS.                                     00730000
           COPY CMQGMOV.                                                00740000
                                                                        00750000
       01  MQM-CONSTANTS.                                               00760000
           COPY CMQV.                                                   00770000
                                                                        00780000
       01  WS-SWITCHES.                                                 00790000
           05  WS-CONTROL-CARD-1-SW     PIC X(01) VALUE 'N'.            00800000
               88  CONTROL-CARD-1-EOF             VALUE 'Y'.            00810000
               88  CONTROL-CARD-1-NOT-EOF         VALUE 'N'.            00820000
           05  WS-CONTROL-CARD-2-SW     PIC X(01) VALUE 'N'.            00830000
               88  CONTROL-CARD-2-EOF             VALUE 'Y'.            00840000
               88  CONTROL-CARD-2-NOT-EOF         VALUE 'N'.            00850000
           05  WS-MQGET-MSG-SW          PIC X(01) VALUE 'Y'.            00860000
               88  MQGET-MORE-MSG                 VALUE 'Y'.            00870000
               88  MQGET-NO-MORE-MSG              VALUE 'N'.            00880000
                                                                        00890000
       01  WS-VARIABLES.                                                00900000
           05  WS-RCDS-WRITTEN          PIC S9(9) VALUE 0.              00910000
           05  WS-RCDS-WRITTEN1         PIC ZZZ,ZZZ,ZZ9.                00920000
           05  WS-QM-NAME               PIC X(48) VALUE SPACES.         00930000
           05  WS-PARAGRAPH             PIC X(30) VALUE SPACES.         00940000
           05  WS-MSGBUFFER             PIC X(500)                      00950006
                                                  VALUE SPACES.         00960000
           05  WS-MSGLENGTH             PIC S9(9) BINARY VALUE +500.    00970006
           05  WS-DATA-LENGTH           PIC S9(9) BINARY.               00980000
           05  WS-HCONN                 PIC S9(9) BINARY VALUE 0.       00990000
           05  WS-OBJECT-HANDLE         PIC S9(9) BINARY VALUE 0.       01000000
           05  WS-OPEN-OPTIONS          PIC S9(9) BINARY.               01010000
           05  WS-COMPLETION-CODE       PIC S9(9) BINARY VALUE 0.       01020000
           05  WS-COMP-CODE1            PIC S9(9) COMP-3.               01030000
           05  WS-COMP-CODE2            PIC S9(9).                      01040000
           05  WS-COMP-CODE3            PIC ZZZZZZZZ9.                  01050000
           05  WS-REASON-CODE           PIC S9(9) BINARY VALUE 0.       01060000
           05  WS-REASON-CODE1          PIC S9(9) COMP-3.               01070000
           05  WS-REASON-CODE2          PIC S9(9).                      01080000
           05  WS-REASON-CODE3          PIC ZZZZZZZZ9.                  01090000
           05  WS-ABEND-CODE            PIC S9(4) VALUE ZEROS           01100000
                                                  COMP SYNC.            01110000
               88  CONTROL-CARD-MISSING           VALUE +4001.          01120000
               88  MQ-ERROR                       VALUE +4020.          01130000
                                                                        01140000
       01  WS-CONTROL-CARD-1.                                           01150000
           05  WS-QMGR-NAME             PIC X(48).                      01160000
           05  FILLER                   PIC X(32).                      01170000
                                                                        01180000
       01  WS-CONTROL-CARD-2.                                           01190000
           05  WS-QUEUE-NAME            PIC X(48).                      01200000
           05  FILLER                   PIC X(32).                      01210000
                                                                        01220000
      ********************************************************          01230000
      *  RMS TO MAINFRAME MERCHANDISE STRUCTURE COPYBOOK     *          01240001
      ********************************************************          01250000
           COPY HMRD001.                                                01260001
                                                                        01270000
                                                                        01280000
       PROCEDURE DIVISION.                                              01290000
       M0000-MAINLINE.                                                  01300000
                                                                        01310000
           PERFORM A1000-INITIALIZE                                     01320000
              THRU A1000-EXIT.                                          01330000
                                                                        01340000
           PERFORM B1000-PROCESS-MESSAGES                               01350000
              THRU B1000-EXIT                                           01360000
             UNTIL MQGET-NO-MORE-MSG.                                   01370000
                                                                        01380000
           PERFORM C1000-EOJ-PROCESSING                                 01390000
              THRU C1000-EXIT.                                          01400000
                                                                        01410000
           STOP RUN.                                                    01420000
                                                                        01430000
                                                                        01440000
       A1000-INITIALIZE.                                                01450000
                                                                        01460000
           OPEN INPUT  CONTROL-CARD-1                                   01470000
                       CONTROL-CARD-2                                   01480000
                OUTPUT MERCH-FILE.                                      01490001
                                                                        01500000
           PERFORM A1100-READ-CONTROL-CARD-1                            01510000
              THRU A1100-EXIT.                                          01520000
                                                                        01530000
           PERFORM A1200-READ-CONTROL-CARD-2                            01540000
              THRU A1200-EXIT.                                          01550000
                                                                        01560000
           CLOSE CONTROL-CARD-1                                         01570000
                 CONTROL-CARD-2.                                        01580000
                                                                        01590000
           PERFORM A1300-MQCONN                                         01600000
              THRU A1300-EXIT.                                          01610000
                                                                        01620000
           PERFORM A1400-MQOPEN                                         01630000
              THRU A1400-EXIT.                                          01640000
                                                                        01650000
       A1000-EXIT.                                                      01660000
           EXIT.                                                        01670000
                                                                        01680000
                                                                        01690000
       A1100-READ-CONTROL-CARD-1.                                       01700000
                                                                        01710000
      *  OBTAIN THE QUEUE MGR NAME                                      01720000
                                                                        01730000
           READ CONTROL-CARD-1                                          01740000
               INTO WS-CONTROL-CARD-1                                   01750000
                   AT END                                               01760000
                       SET CONTROL-CARD-1-EOF TO TRUE.                  01770000
                                                                        01780000
           IF CONTROL-CARD-1-EOF                                        01790000
               DISPLAY '***********************************'            01800000
               DISPLAY '***  ABEND MAKUT140                '            01810001
               DISPLAY '***  A1100-READ-CONTROL-CARD-1     '            01820000
               DISPLAY '***********************************'            01830000
               SET CONTROL-CARD-MISSING       TO TRUE                   01840000
               CALL 'ILBOABN0' USING WS-ABEND-CODE                      01841000
           END-IF.                                                      01842000
                                                                        01843000
       A1100-EXIT.                                                      01844000
           EXIT.                                                        01845000
                                                                        01846000
                                                                        01847000
       A1200-READ-CONTROL-CARD-2.                                       01848000
                                                                        01849000
      *  OBTAIN THE INPUT QUEUE NAME                                    01850000
                                                                        01860000
           READ CONTROL-CARD-2                                          01870000
               INTO WS-CONTROL-CARD-2                                   01880000
                   AT END                                               01890000
                       SET CONTROL-CARD-2-EOF TO TRUE.                  01900000
                                                                        01910000
           IF CONTROL-CARD-2-EOF                                        01920000
               DISPLAY '***********************************'            01930000
               DISPLAY '***  ABEND MAKUT140                '            01940001
               DISPLAY '***  A1200-READ-CONTROL-CARD-2     '            01950000
               DISPLAY '***********************************'            01960000
               SET CONTROL-CARD-MISSING       TO TRUE                   01970000
               CALL 'ILBOABN0' USING WS-ABEND-CODE                      01980000
           END-IF.                                                      01990000
                                                                        02000000
       A1200-EXIT.                                                      02010000
           EXIT.                                                        02020000
                                                                        02030000
                                                                        02040000
       A1300-MQCONN.                                                    02050000
                                                                        02060000
           MOVE WS-QMGR-NAME TO WS-QM-NAME.                             02070000
           CALL WS-MQCONN USING WS-QM-NAME                              02080000
                                WS-HCONN                                02090000
                                WS-COMPLETION-CODE                      02100000
                                WS-REASON-CODE.                         02110000
                                                                        02120000
           IF WS-COMPLETION-CODE = MQCC-OK                              02130000
               NEXT SENTENCE                                            02140000
           ELSE                                                         02150000
               MOVE WS-COMPLETION-CODE  TO WS-COMP-CODE1                02160000
               MOVE WS-COMP-CODE1       TO WS-COMP-CODE2                02170000
               MOVE WS-COMP-CODE2       TO WS-COMP-CODE3                02180000
               MOVE WS-REASON-CODE      TO WS-REASON-CODE1              02190000
               MOVE WS-REASON-CODE1     TO WS-REASON-CODE2              02200000
               MOVE WS-REASON-CODE2     TO WS-REASON-CODE3              02210000
               DISPLAY '***********************************'            02220000
               DISPLAY '***  ABEND MAKUT140 - A1300-MQCONN '            02230001
               DISPLAY '***  MQ COMPLETION CODE: ' WS-COMP-CODE3        02240000
               DISPLAY '***  MQ REASON CODE:     ' WS-REASON-CODE3      02250000
               DISPLAY '***********************************'            02260000
               SET MQ-ERROR             TO TRUE                         02270000
               CALL 'ILBOABN0' USING WS-ABEND-CODE                      02280000
           END-IF.                                                      02290000
                                                                        02300000
       A1300-EXIT.                                                      02310000
           EXIT.                                                        02320000
                                                                        02330000
                                                                        02340000
       A1400-MQOPEN.                                                    02350000
                                                                        02360000
           MOVE WS-QMGR-NAME             TO MQOD-OBJECTQMGRNAME.        02370000
           MOVE WS-QUEUE-NAME            TO MQOD-OBJECTNAME.            02380000
           COMPUTE WS-OPEN-OPTIONS = MQOO-INPUT-SHARED +                02390000
                                     MQOO-FAIL-IF-QUIESCING.            02400000
                                                                        02410000
           CALL WS-MQOPEN USING WS-HCONN                                02420000
                                MQM-OBJECT-DESCRIPTOR                   02430000
                                WS-OPEN-OPTIONS                         02440000
                                WS-OBJECT-HANDLE                        02450000
                                WS-COMPLETION-CODE                      02460000
                                WS-REASON-CODE.                         02470000
                                                                        02480000
           IF WS-COMPLETION-CODE = MQCC-OK                              02490000
               NEXT SENTENCE                                            02500000
           ELSE                                                         02510000
               MOVE WS-COMPLETION-CODE  TO WS-COMP-CODE1                02520000
               MOVE WS-COMP-CODE1       TO WS-COMP-CODE2                02530000
               MOVE WS-COMP-CODE2       TO WS-COMP-CODE3                02540000
               MOVE WS-REASON-CODE      TO WS-REASON-CODE1              02540100
               MOVE WS-REASON-CODE1     TO WS-REASON-CODE2              02540200
               MOVE WS-REASON-CODE2     TO WS-REASON-CODE3              02540300
               DISPLAY '***********************************'            02540400
               DISPLAY '***  ABEND MAKUT140 - A1400-MQOPEN '            02540501
               DISPLAY '***  MQ COMPLETION CODE: ' WS-COMP-CODE3        02540600
               DISPLAY '***  MQ REASON CODE:     ' WS-REASON-CODE3      02540700
               DISPLAY '***********************************'            02540800
               PERFORM U9000-MQDISC                                     02540900
                  THRU U9000-EXIT                                       02541000
               SET MQ-ERROR        TO TRUE                              02542000
               CALL 'ILBOABN0' USING WS-ABEND-CODE                      02543000
           END-IF.                                                      02544000
                                                                        02545000
       A1400-EXIT.                                                      02546000
           EXIT.                                                        02547000
                                                                        02548000
                                                                        02549000
       B1000-PROCESS-MESSAGES.                                          02550000
                                                                        02560000
           PERFORM B1100-MQGET                                          02570000
              THRU B1100-EXIT.                                          02580000
                                                                        02590000
           IF MQGET-MORE-MSG                                            02600000
               PERFORM B1200-WRITE-MERCH-RECORD                         02610002
                  THRU B1200-EXIT                                       02620000
           ELSE                                                         02630000
      *  TO REREAD MESSAGES IN A TEST SITUATION, UNCOMMENT U9200        02640000
      *  AND COMMENT OUT B1300                                          02650000
      *        PERFORM U9200-MQBACK                                     02660007
      *           THRU U9200-EXIT                                       02670007
               PERFORM B1300-MQCMIT                                     02680007
                  THRU B1300-EXIT                                       02690007
           END-IF.                                                      02700000
                                                                        02710000
       B1000-EXIT.                                                      02720000
           EXIT.                                                        02730000
                                                                        02740000
                                                                        02750000
       B1100-MQGET.                                                     02760000
                                                                        02770000
      *  MQGET LEAVES THE RECORD IN THE QUEUE BUT MARKS IT              02780000
      *  AS HAVING BEEN "READ"                                          02790000
                                                                        02800000
           INITIALIZE WS-MSGBUFFER.                                     02810000
           MOVE WS-QUEUE-NAME            TO MQOD-OBJECTNAME.            02820000
           MOVE MQMI-NONE                TO MQMD-MSGID.                 02830000
           MOVE MQCI-NONE                TO MQMD-CORRELID.              02840000
      *    MOVE 60000                    TO MQGMO-WAITINTERVAL.         02850000
           COMPUTE MQGMO-OPTIONS  = MQGMO-SYNCPOINT +                   02860000
                                    MQGMO-CONVERT +                     02870000
                                    MQGMO-WAIT.                         02880000
                                                                        02890000
           CALL WS-MQGET USING WS-HCONN                                 02900000
                               WS-OBJECT-HANDLE                         02910000
                               MQM-MESSAGE-DESCRIPTOR                   02920000
                               MQM-GET-MESSAGE-OPTIONS                  02930000
                               WS-MSGLENGTH                             02940000
                               WS-MSGBUFFER                             02950000
                               WS-DATA-LENGTH                           02960000
                               WS-COMPLETION-CODE                       02970000
                               WS-REASON-CODE.                          02980000
                                                                        02990000
           IF WS-COMPLETION-CODE = MQCC-OK                              03000000
               MOVE WS-MSGBUFFER TO HMRD001-RECORD                      03010001
           ELSE                                                         03020000
               IF WS-REASON-CODE = MQRC-NO-MSG-AVAILABLE                03030000
                   SET MQGET-NO-MORE-MSG TO TRUE                        03040000
               ELSE                                                     03050000
                   MOVE WS-COMPLETION-CODE  TO WS-COMP-CODE1            03060000
                   MOVE WS-COMP-CODE1       TO WS-COMP-CODE2            03070000
                   MOVE WS-COMP-CODE2       TO WS-COMP-CODE3            03080000
                   MOVE WS-REASON-CODE      TO WS-REASON-CODE1          03090000
                   MOVE WS-REASON-CODE1     TO WS-REASON-CODE2          03100000
                   MOVE WS-REASON-CODE2     TO WS-REASON-CODE3          03110000
                   DISPLAY '***********************************'        03110100
                   DISPLAY '***  ABEND MAKUT140 - B1100-MQGET  '        03110201
                   DISPLAY '***  MQ COMPLETION CODE: ' WS-COMP-CODE3    03110300
                   DISPLAY '***  MQ REASON CODE:     ' WS-REASON-CODE3  03110400
                   DISPLAY '***********************************'        03110500
                   PERFORM U9200-MQBACK                                 03110600
                      THRU U9200-EXIT                                   03110700
                   PERFORM U9100-MQCLOSE                                03110800
                      THRU U9100-EXIT                                   03110900
                   PERFORM U9000-MQDISC                                 03111000
                      THRU U9000-EXIT                                   03112000
                   SET MQ-ERROR             TO TRUE                     03113000
                   CALL 'ILBOABN0' USING WS-ABEND-CODE                  03114000
               END-IF                                                   03115000
           END-IF.                                                      03116000
                                                                        03117000
       B1100-EXIT.                                                      03118000
           EXIT.                                                        03119000
                                                                        03120000
                                                                        03130000
       B1200-WRITE-MERCH-RECORD.                                        03140002
                                                                        03150000
           WRITE MERCH-RECORD FROM HMRD001-RECORD.                      03160002
                                                                        03170000
           ADD 1 TO WS-RCDS-WRITTEN.                                    03180000
                                                                        03190000
       B1200-EXIT.                                                      03200000
           EXIT.                                                        03210000
                                                                        03220000
                                                                        03230000
       B1300-MQCMIT.                                                    03240000
                                                                        03250000
      *  MQCMIT DELETES THE RECORD FROM THE QUEUE - IT CANNOT           03260000
      *  BE REREAD AFTER THIS                                           03270000
                                                                        03280000
           CALL WS-MQCMIT USING WS-HCONN                                03290000
                                WS-COMPLETION-CODE                      03300000
                                WS-REASON-CODE.                         03310000
                                                                        03320000
           IF WS-COMPLETION-CODE = MQCC-OK                              03330000
               NEXT SENTENCE                                            03340000
           ELSE                                                         03350000
               MOVE WS-COMPLETION-CODE  TO WS-COMP-CODE1                03360000
               MOVE WS-COMP-CODE1       TO WS-COMP-CODE2                03370000
               MOVE WS-COMP-CODE2       TO WS-COMP-CODE3                03380000
               MOVE WS-REASON-CODE      TO WS-REASON-CODE1              03390000
               MOVE WS-REASON-CODE1     TO WS-REASON-CODE2              03400000
               MOVE WS-REASON-CODE2     TO WS-REASON-CODE3              03410000
               DISPLAY '***********************************'            03420000
               DISPLAY '***  ABEND MAKUT140 - B1300-MQCMIT '            03430001
               DISPLAY '***  MQ COMPLETION CODE: ' WS-COMP-CODE3        03440000
               DISPLAY '***  MQ REASON CODE:     ' WS-REASON-CODE3      03450000
               DISPLAY '***********************************'            03460000
               PERFORM U9200-MQBACK                                     03470000
                  THRU U9200-EXIT                                       03480000
               SET MQ-ERROR             TO TRUE                         03490000
               CALL 'ILBOABN0' USING WS-ABEND-CODE                      03500000
           END-IF.                                                      03510000
                                                                        03520000
       B1300-EXIT.                                                      03530000
           EXIT.                                                        03540000
                                                                        03550000
                                                                        03560000
       C1000-EOJ-PROCESSING.                                            03570000
                                                                        03580000
           CLOSE MERCH-FILE.                                            03590002
                                                                        03600000
           PERFORM U9100-MQCLOSE                                        03610000
              THRU U9100-EXIT.                                          03620000
           PERFORM U9000-MQDISC                                         03630000
              THRU U9000-EXIT.                                          03640000
                                                                        03650000
           MOVE WS-RCDS-WRITTEN TO WS-RCDS-WRITTEN1.                    03660000
           DISPLAY '**************************************************'.03670000
           DISPLAY 'SUCCESSFUL END OF MAKUT140'.                        03680001
           DISPLAY 'RECORDS WRITTEN:' WS-RCDS-WRITTEN1.                 03690000
           DISPLAY '**************************************************'.03700000
                                                                        03710000
       C1000-EXIT.                                                      03720000
           EXIT.                                                        03730000
                                                                        03740000
                                                                        03750000
       U9000-MQDISC.                                                    03760000
                                                                        03770000
           CALL WS-MQDISC USING WS-HCONN                                03780000
                                WS-COMPLETION-CODE                      03790000
                                WS-REASON-CODE.                         03800000
                                                                        03810000
           IF WS-COMPLETION-CODE = MQCC-OK                              03820000
               NEXT SENTENCE                                            03830000
           ELSE                                                         03840000
               MOVE WS-COMPLETION-CODE  TO WS-COMP-CODE1                03850000
               MOVE WS-COMP-CODE1       TO WS-COMP-CODE2                03860000
               MOVE WS-COMP-CODE2       TO WS-COMP-CODE3                03870000
               MOVE WS-REASON-CODE      TO WS-REASON-CODE1              03880000
               MOVE WS-REASON-CODE1     TO WS-REASON-CODE2              03890000
               MOVE WS-REASON-CODE2     TO WS-REASON-CODE3              03900000
               DISPLAY '***********************************'            03910000
               DISPLAY '***  ABEND MAKUT140 - U9000-MQDISC '            03920001
               DISPLAY '***  MQ COMPLETION CODE: ' WS-COMP-CODE3        03930000
               DISPLAY '***  MQ REASON CODE:     ' WS-REASON-CODE3      03940000
               DISPLAY '***********************************'            03950000
               SET MQ-ERROR             TO TRUE                         03960000
               CALL 'ILBOABN0' USING WS-ABEND-CODE                      03970000
           END-IF.                                                      03980000
                                                                        03990000
       U9000-EXIT.                                                      04000000
           EXIT.                                                        04010000
                                                                        04020000
                                                                        04030000
       U9100-MQCLOSE.                                                   04040000
                                                                        04050000
           CALL WS-MQCLOSE USING WS-HCONN                               04060000
                                 WS-OBJECT-HANDLE                       04070000
                                 MQCO-NONE                              04080000
                                 WS-COMPLETION-CODE                     04090000
                                 WS-REASON-CODE.                        04100000
                                                                        04110000
           IF WS-COMPLETION-CODE = MQCC-OK                              04120000
               NEXT SENTENCE                                            04130000
           ELSE                                                         04140000
               MOVE WS-COMPLETION-CODE  TO WS-COMP-CODE1                04150000
               MOVE WS-COMP-CODE1       TO WS-COMP-CODE2                04160000
               MOVE WS-COMP-CODE2       TO WS-COMP-CODE3                04170000
               MOVE WS-REASON-CODE      TO WS-REASON-CODE1              04180000
               MOVE WS-REASON-CODE1     TO WS-REASON-CODE2              04190000
               MOVE WS-REASON-CODE2     TO WS-REASON-CODE3              04200000
               DISPLAY '***********************************'            04210000
               DISPLAY '***  ABEND MAKUT140 - U9100-MQCLOSE'            04220001
               DISPLAY '***  MQ COMPLETION CODE: ' WS-COMP-CODE3        04221000
               DISPLAY '***  MQ REASON CODE:     ' WS-REASON-CODE3      04222000
               DISPLAY '***********************************'            04223000
               SET MQ-ERROR             TO TRUE                         04224000
               CALL 'ILBOABN0' USING WS-ABEND-CODE                      04225000
           END-IF.                                                      04226000
                                                                        04227000
       U9100-EXIT.                                                      04228000
           EXIT.                                                        04229000
                                                                        04230000
                                                                        04240000
       U9200-MQBACK.                                                    04250000
                                                                        04260000
      *  WHEN MQBACK IS DONE, ALL RECORDS MARKED AS "READ" WILL         04270000
      *  BE CHANGED BACK TO "UNREAD" SO THE PROGRAM CAN BE RESTARTED.   04280000
                                                                        04290000
           CALL WS-MQBACK USING WS-HCONN                                04300000
                                WS-COMPLETION-CODE                      04310000
                                WS-REASON-CODE.                         04320000
                                                                        04330000
           IF WS-COMPLETION-CODE = MQCC-OK                              04340000
               NEXT SENTENCE                                            04350000
           ELSE                                                         04360000
               MOVE WS-COMPLETION-CODE  TO WS-COMP-CODE1                04370000
               MOVE WS-COMP-CODE1       TO WS-COMP-CODE2                04380000
               MOVE WS-COMP-CODE2       TO WS-COMP-CODE3                04390000
               MOVE WS-REASON-CODE      TO WS-REASON-CODE1              04400000
               MOVE WS-REASON-CODE1     TO WS-REASON-CODE2              04410000
               MOVE WS-REASON-CODE2     TO WS-REASON-CODE3              04411000
               DISPLAY '***********************************'            04412000
               DISPLAY '***  ABEND MAKUT140 - U9200-MQBACK '            04413001
               DISPLAY '***  MQ COMPLETION CODE: ' WS-COMP-CODE3        04414000
               DISPLAY '***  MQ REASON CODE:     ' WS-REASON-CODE3      04415000
               DISPLAY '***********************************'            04416000
               SET MQ-ERROR        TO TRUE                              04417000
               CALL 'ILBOABN0' USING WS-ABEND-CODE                      04418000
           END-IF.                                                      04419000
                                                                        04420000
       U9200-EXIT.                                                      04430000
           EXIT.                                                        04440000
