/* REXX */                                                                      
/* SEKRX005 -                                                         */        
/*                                                                    */        
/**********************************************************************/        
/* Set values for constants.                                          */        
/**********************************************************************/        
CURRPGM = 'SEKRX005 - '                                                         
LDAP_FILE_END_OF_FILE = 'Y'                                                     
LDAP_FILE_NOT_END_OF_FILE = 'N'                                                 
                                                                                
/**********************************************************************/        
/* Initialize local variables.                                        */        
/**********************************************************************/        
LDAP_FILE_EOF = LDAP_FILE_NOT_END_OF_FILE                                       
INACTIVE_DEFAULT_GROUP = 'INACTIVE'                                             
DELUSER_DEFAULT_GROUP_OWNER = 'DELUSER '                                        
HARD_DELETE = 'DEL'                                                             
                                                                                
/**********************************************************************/        
/* Program mainline.                                                  */        
/**********************************************************************/        
SAY CURRPGM                                                                     
CALL READ_LDAP_RECORD                                                           
DO WHILE (LDAP_FILE_EOF = LDAP_FILE_NOT_END_OF_FILE)                            
    PARSE PULL INP01_RECORD                                                     
    LDAP_USERID = STRIP(SUBSTR(INP01_RECORD,24,7))                              
    UPPER LDAP_USERID                                                           
    LDAP_OBJECTCLASS = STRIP(SUBSTR(INP01_RECORD,1,16))                         
    UPPER LDAP_OBJECTCLASS                                                      
    LDAP_EMPLOYEE_ID = SUBSTR(INP01_RECORD,17,7)                                
    IF ((LDAP_OBJECTCLASS = 'KOHLS_EMPLOYEE') |,                                
            (LDAP_OBJECTCLASS = 'KOHLS_STORE_EMPL') |,                          
            (LDAP_OBJECTCLASS = 'KOHLS_CONTRACTOR') |,                          
            (LDAP_OBJECTCLASS = 'KOHLS_DC_CONTRAC')) THEN DO                    
        INTERNAL_USER_RECORD = LEFT(LDAP_USERID,8) ||,                          
                  LDAP_EMPLOYEE_ID ||,                                          
                  LDAP_OBJECTCLASS                                              
        IF WORDPOS(STRIP(LDAP_USERID),USERID_EXCEPTION_LIST) = 0 THEN DO        
            CALL WRITE_INTERNAL_USER_RECORD                                     
        END                                                                     
    END                                                                         
    CALL READ_LDAP_RECORD                                                       
END                                                                             
                                                                                
"EXECIO 0 DISKR INP01 (FINIS"                                                   
"EXECIO 0 DISKR OUT01 (FINIS"                                                   
EXIT 0                                                                          
/* ----------------------------------------------------------------- */         
/* Subroutines                                                       */         
/* ----------------------------------------------------------------- */         
/* ----------------------------------------------------------------- */         
/* READ_LDAP_RECORD                                                  */         
/*                                                                   */         
/* Read a LDAP extract record.                                       */         
/* ----------------------------------------------------------------- */         
READ_LDAP_RECORD:                                                               
    "EXECIO 1 DISKR INP01"              /* read one record           */         
    IF RC = 2 THEN                                                              
        LDAP_FILE_EOF = LDAP_FILE_END_OF_FILE                                   
    RETURN                                                                      
/* ----------------------------------------------------------------- */         
/* WRITE_INTERNAL_USER_RECORD                                        */         
/*                                                                   */         
/* Write an internal user LDAP extract record.                       */         
/* ----------------------------------------------------------------- */         
WRITE_INTERNAL_USER_RECORD:                                                     
    OUT01_RECORD = LEFT(INTERNAL_USER_RECORD,31)                                
    PUSH OUT01_RECORD                                                           
    "EXECIO 1 DISKW OUT01"                                                      
    RETURN                                                                      
