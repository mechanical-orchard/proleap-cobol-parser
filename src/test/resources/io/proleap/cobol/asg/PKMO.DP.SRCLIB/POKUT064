000700*************************                                         00010058
000800 IDENTIFICATION DIVISION.                                         00020058
000900*************************                                         00030058
001000 PROGRAM-ID.      POKUT064.                                       00040058
001100 AUTHOR.          KAREN SCHOLEY\CAROL PIKULIK                     00050058
001200 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00060058
001300 DATE-WRITTEN.    06/02/00.                                       00070058
001400 DATE-COMPILED.                                                   00080058
001500****************************************************************  00090058
001600* TMESTDS DATA READ IN FROM FLAT FILE.                         *  00100058
001700****************************************************************  00110058
001800*                                                                 00120058
001900*---------------------------------------------------------------* 00130058
002000* DATE  12/01/2000, B. TYRIVER                                    00140058
002100*   WR21702 TOOK OUT LOGIC ON HOW THE ON ORDER ON CANCELED PO   * 00150058
002200*   WAS BEING MANIPULATED.                                        00160058
002300*---------------------------------------------------------------* 00170058
002400* DATE  01/10/2002, S. BARTELT        PITS# 442552              * 00180058
002500*   COMBINED SQL FOR GET REC'D UNITS (C200) AND RECVD CALC      * 00190058
002600*   (C210) INTO ONE SQL (C200) AND GET INPROCESS UNITS (C300)   * 00200058
002700*   AND INPROCESS CALC (C310) INTO ONE SQL (C300) TO REDUCE     * 00210058
002800*   CALLS TO TRECDIS TABLE HOPING TO REDUCE RUN TIME OF PROGRAM.* 00220058
002900*---------------------------------------------------------------* 00230058
003000* DATE  05/07/2003, LAXMAN BOLINENI, IGSI   WR# 24803           * 00240058
003100*   XLT DOMAIN TABLES WERE ADDED IN THE SQL STATEMENT OF        * 00250058
003200*   PARAGRAPH B033-GET-TPURITM FOR NI-SKU CONVERSION CHANGES.   * 00260058
003300*---------------------------------------------------------------* 00270058
P46216*---------------------------------------------------------------* 00280058
P46216* DATE  06/20/2014, COGNIZANT- MODIFED THE CODE TO PICKUP       * 00290058
P46216*   RECLASSIFIED DEPT_NBR AND MAJ_CLS FROM ITM_RECLS TO         * 00300058
P46216*   AVOID POK963A FAILURES DUE TO RECLASSIFICATION ISSUES.      * 00310058
P46216*---------------------------------------------------------------* 00320058
002900*---------------------------------------------------------------* 00330059
C98147* DATE  11/04/2014, LINDA FRIESS            CHG0098147            00340061
C98147*   RECOMPILED TO BRING IN PORD004 COPYBOOK WITH EXPANDED PO NBR  00350060
C98147*---------------------------------------------------------------* 00360060
003400 ENVIRONMENT DIVISION.                                            00370058
003500*                                                                 00380058
003600*                                                                 00390058
003700 CONFIGURATION SECTION.                                           00400058
003800 SOURCE-COMPUTER. IBM-3090.                                       00410058
003900 OBJECT-COMPUTER. IBM-3090.                                       00420058
004000*                                                                 00430058
004100*                                                                 00440058
004200 INPUT-OUTPUT SECTION.                                            00450058
004300 FILE-CONTROL.                                                    00460058
004400                                                                  00470058
004500     SELECT PO-FILE                                               00480058
004600         ASSIGN                       TO INP01.                   00490058
004700                                                                  00500058
004800     SELECT PO-ONORDER-STORE-FILE                                 00510058
004900         ASSIGN                       TO OUT01.                   00520058
005000                                                                  00530058
005100     EJECT                                                        00540058
005200*                                                                 00550058
005300*                                                                 00560058
005400***************                                                   00570058
005500 DATA DIVISION.                                                   00580058
005600***************                                                   00590058
005700*                                                                 00600058
005800*                                                                 00610058
005900*                                                                 00620058
006000 FILE SECTION.                                                    00630058
006100                                                                  00640058
006200 FD  PO-FILE                                                      00650058
006300     RECORDING MODE F                                             00660058
006400     LABEL RECORDS ARE STANDARD                                   00670058
006500     RECORD CONTAINS 49 CHARACTERS                                00680058
006600     BLOCK CONTAINS 0 RECORDS                                     00690058
006700     DATA RECORD IS PO-REC.                                       00700058
006800 01  PO-REC                           PIC X(49).                  00710058
006900                                                                  00720058
007000 FD  PO-ONORDER-STORE-FILE                                        00730058
007100     RECORDING MODE F                                             00740058
007200     LABEL RECORDS ARE STANDARD                                   00750058
007300     RECORD CONTAINS 280 CHARACTERS                               00760058
007400     BLOCK CONTAINS 0 RECORDS                                     00770058
007500     DATA RECORD IS PO-ONORDER-REC.                               00780058
007600 01  PO-ONORDER-REC                   PIC X(280).                 00790058
007700                                                                  00800058
007800     EJECT                                                        00810058
007900*                                                                 00820058
008000 WORKING-STORAGE SECTION.                                         00830058
008100*                                                                 00840058
008200 01 WS-PO-REC.                                                    00850058
008300     05  WS-PO-NBR                    PIC S9(9) COMP.             00860058
008400     05  WS-STR-NBR                   PIC S9(4) COMP.             00870058
008500     05  WS-PO-LNE-NBR                PIC S9(9) COMP.             00880058
008600     05  WS-STR-DISTRO-QTY            PIC S9(9) COMP.             00890058
008700     05  WS-CHAR5-ABBR-NAME           PIC X(5).                   00900058
008800     05  WS-SHIP-DATE                 PIC X(10).                  00910058
008900     05  WS-CANCEL-DATE               PIC X(10).                  00920058
008900     05  WS-EXTEND-DATE               PIC X(10).                  00930058
009000*                                                                 00940058
009100*                                                                 00950058
009200******************************************************************00960058
009300*    LAYOUT OF THE OUTPUT NEW STORE PO DATA FILE.                 00970058
009400******************************************************************00980058
009500                                                                  00990058
009600     COPY PORD004.                                                01000058
009700                                                                  01010058
009800*                                                                 01020058
009900 01 PV-PROGRAM-VARIABLES.                                         01030058
010000     05  PV-ABEND-PARAGRAPH           PIC X(30)      VALUE SPACES.01040058
010100     05  PV-SUM-RETL-ONORDER                    PIC S9(16)V9(2)   01050058
010200                                                       COMP-3.    01060058
010300     05  PV-SUM-RTL-VERFD                       PIC S9(16)V9(2)   01070058
010400                                                       COMP-3.    01080058
010500     05  PV-SUM-RTL-INP                         PIC S9(16)V9(2)   01090058
010600                                                       COMP-3.    01100058
010700     05  PV-ACCUM-RTL-ONORDER                   PIC S9(16)V9(2)   01110058
010800                                                VALUE +0          01120058
010900                                                       COMP-3.    01130058
011000     05  PV-ACCUM-RTL-VERFD                     PIC S9(16)V9(2)   01140058
011100                                                VALUE +0          01150058
011200                                                       COMP-3.    01160058
011300     05  PV-ACCUM-RTL-INP                       PIC S9(16)V9(2)   01170058
011400                                                VALUE +0          01180058
011500                                                       COMP-3.    01190058
011600     05  PV-SUM-DISTRO-QTY-VE                   PIC S9(9) COMP    01200058
011700                                                VALUE +0.         01210058
011800     05  PV-SUM-DISTRO-QTY-IP                   PIC S9(9) COMP    01220058
011900                                                VALUE +0.         01230058
011800     05  PV-SUM-DISTRO-QTY-IP2                  PIC S9(9) COMP    01240058
011900                                                VALUE +0.         01250058
011800     05  PV-SUM-DISTRO-QTY-ER                   PIC S9(9) COMP    01260058
011900                                                VALUE +0.         01270058
012000     05  PV-ACCUM-DISTRO-QTY-VE                 PIC S9(9) COMP    01280058
012100                                                VALUE +0.         01290058
012200     05  PV-ACCUM-DISTRO-QTY-IP                 PIC S9(9) COMP    01300058
012300                                                VALUE +0.         01310058
012200     05  PV-ACCUM-DISTRO-QTY-IP2                PIC S9(9) COMP    01320058
012300                                                VALUE +0.         01330058
012200     05  PV-ACCUM-DISTRO-QTY-ER                 PIC S9(9) COMP    01340058
012300                                                VALUE +0.         01350058
012400     05  PV-ACCUM-DISTRO-ONORDER                PIC S9(9) COMP    01360058
012500                                                VALUE +0.         01370058
012600     05  PV-ONORDER                             PIC S9(9)V99      01380058
012700                                                       COMP-3.    01390058
012800     05 IND-NOTES                                  PIC S9(4)      01400058
012900                                                       COMP.      01410058
013000     05 IND-NOTES2                                 PIC S9(4)      01420058
013100                                                       COMP.      01430058
013200     05  PV-PERCENT-WORK-FIELD        PIC 9(7).                   01440058
013300     05 PV-DEFAULT-REC-TMST           PIC X(26)                   01450058
013400                              VALUE '9999-09-09-09.09.09.999999'. 01460058
013500     05 PV-TRECEIV-REC-TMST                     PIC X(26).        01470058
013600     05 PV-REDF-REC-TMST REDEFINES PV-TRECEIV-REC-TMST.           01480058
013700          10  PV-DATE-CCYY                          PIC 9(4).     01490058
013800          10  FILLER                                PIC X(1).     01500058
013900          10  PV-DATE-MO                            PIC 9(2).     01510058
014000          10  FILLER                                PIC X(1).     01520058
014100          10  PV-DATE-DY                            PIC 9(2).     01530058
014200          10  FILLER                                PIC X(16).    01540058
014300                                                                  01550058
014400     05 PV-SHIP-DATE.                                             01560058
014500        10  PV-SHIP-CCYY                            PIC X(4).     01570058
014600        10  FILLER                                  PIC X(1).     01580058
014700        10  PV-SHIP-MM                              PIC X(2).     01590058
014800        10  FILLER                                  PIC X(1).     01600058
014900        10  PV-SHIP-DD                              PIC X(2).     01610058
015000*                                                                 01620058
015100     05 PV-CANCEL-DATE.                                           01630058
015200        10  PV-CANCEL-CCYY                          PIC X(4).     01640058
015300        10  FILLER                                  PIC X(1).     01650058
015400        10  PV-CANCEL-MM                            PIC X(2).     01660058
015500        10  FILLER                                  PIC X(1).     01670058
015600        10  PV-CANCEL-DD                            PIC X(2).     01680058
015700*                                                                 01690058
015100     05 PV-EXTEND-DATE.                                           01700058
015200        10  PV-EXTEND-CCYY                          PIC X(4).     01710058
015300        10  FILLER                                  PIC X(1).     01720058
015400        10  PV-EXTEND-MM                            PIC X(2).     01730058
015500        10  FILLER                                  PIC X(1).     01740058
015600        10  PV-EXTEND-DD                            PIC X(2).     01750058
015700*                                                                 01760058
015800     05 PV-ITEM-CLASS                               PIC 9(2).     01770058
015900     05 PV-REDF-ITEM-CLASS REDEFINES PV-ITEM-CLASS  PIC X(2).     01780058
016000*                                                                 01790058
016100     05  TEMP-COUNT                             PIC S9(07)        01800058
016200                                                VALUE +0.         01810058
016300     05  PV-TOTAL-READ                PIC S9(9) COMP VALUE ZERO.  01820058
016400     05  PV-TOTAL-WRITTEN             PIC S9(9) COMP VALUE ZERO.  01830058
016500     05  PV-DISP-NUMBER               PIC ZZZ,ZZZ,ZZ9.            01840058
016600*                                                                 01850058
016700 01  PV-ABEND-CODE                    PIC S9(04)     VALUE +0     01860058
016800                                                     COMP SYNC.   01870058
016900     88  ABEND-4001-WRITE-ERROR                      VALUE +4001. 01880058
017000     88  ABEND-4002-READ-ERROR                       VALUE +4002. 01890058
017100     88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003. 01900058
017200     88  ABEND-4004-TABLE-ERROR                      VALUE +4004. 01910058
017300     88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 01920058
017400     88  ABEND-4006-CLOSE-ERROR                      VALUE +4006. 01930058
017500     88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 01940058
017600     88  ABEND-4008-DATA-ERROR                       VALUE +4008. 01950058
017700     88  ABEND-4009-KEY-DATA-ERROR                   VALUE +4009. 01960058
018000     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 01970058
018100*                                                                 01980058
018200 01  PC-PROGRAM-CONSTANTS.                                        01990058
018300     05  PC-P                         PIC X(01)      VALUE 'P'.   02000058
018400     05  PC-Y                         PIC X(01)      VALUE 'Y'.   02010058
018500     05  PC-N                         PIC X(01)      VALUE 'N'.   02020058
018600     05  PC-D                         PIC X(01)      VALUE 'D'.   02030058
018700     05  PC-H                         PIC X(01)      VALUE 'H'.   02040058
018800     05  PC-I                         PIC X(01)      VALUE 'I'.   02050058
018900     05  PC-L                         PIC X(01)      VALUE 'L'.   02060058
019000     05  PC-U                         PIC X(01)      VALUE 'U'.   02070058
019100     05  PC-DPT                       PIC X(03)      VALUE 'DPT'. 02080058
019200     05  PO-OK                        PIC X(01)      VALUE 'N'.   02090058
019300     05  PC-MAX-LINES                 PIC S9(3)      VALUE +52    02100058
019400                                                     COMP-3.      02110058
019500     05  PC-PGM-DPKUT500              PIC X(08)      VALUE        02120058
019600                                                     'DPKUT500'.  02130058
019700     05  PC-ROW-NOT-FOUND             PIC S9(04)     VALUE +100   02140058
019800                                                     COMP SYNC.   02150058
019900     05  PC-DUPLICATE-ROW             PIC S9(04)     VALUE -811   02160058
020000                                                     COMP SYNC.   02170058
020100     05  NBR-INPUT-RECORDS            PIC 9(09)     VALUE 0       02180058
020200                                                     COMP SYNC.   02190058
020300     05  HOLD-PO-NBR                  PIC S9(9) COMP VALUE 0.     02200058
020400     05  HOLD-STR-NBR                 PIC S9(4) COMP VALUE 0.     02210058
020500*                                                                 02220058
020600 01  PS-PROGRAM-SWITCHES.                                         02230058
020700     05  PS-END-OF-PO-REC             PIC X(01)      VALUE 'N'.   02240058
020800         88  END-OF-PO-REC                           VALUE 'Y'.   02250058
020900     05  PS-FIRST-RECORD-SW           PIC X(01)      VALUE 'Y'.   02260058
021000         88  FIRST-RECORD                            VALUE 'Y'.   02270058
021100         88  NOT-FIRST-RECORD                        VALUE 'N'.   02280058
021200                                                                  02290058
021300*                                                                 02300058
021400*                                                                 02310058
021500*                                                                 02320058
021600* RECEIVING TABLE                                                 02330058
021700     EXEC SQL                                                     02340058
021800         INCLUDE TRECEIV                                          02350058
021900     END-EXEC.                                                    02360058
022000*                                                                 02370058
022100* RECEIVING TABLE                                                 02380058
022200     EXEC SQL                                                     02390058
022300         INCLUDE TRECITM                                          02400058
022400     END-EXEC.                                                    02410058
022500*                                                                 02420058
022600* RECEIVING TABLE                                                 02430058
022700     EXEC SQL                                                     02440058
022800         INCLUDE TRECDIS                                          02450058
022900     END-EXEC.                                                    02460058
023000*                                                                 02470058
023100* PURCHASE NUMBER TABLE.                                          02480058
023200     EXEC SQL                                                     02490058
023300         INCLUDE TPURCHS                                          02500058
023400     END-EXEC.                                                    02510058
023500*                                                                 02520058
023600* PURCHASE ORDER ITEM TABLE.                                      02530058
023700     EXEC SQL                                                     02540058
023800         INCLUDE TPURITM                                          02550058
023900     END-EXEC.                                                    02560058
024000*                                                                 02570058
024100* RESPONSIBILITY TABLE.                                           02580058
024200     EXEC SQL                                                     02590058
024300         INCLUDE TRSPBAR                                          02600058
024400     END-EXEC.                                                    02610058
024500*                                                                 02620058
024600* MERCHANDISE BUSINESS TABLE.                                     02630058
024700     EXEC SQL                                                     02640058
024800         INCLUDE TMDSEAR                                          02650058
024900     END-EXEC.                                                    02660058
025000*                                                                 02670058
025100* VENDOR NAME TABLE.                                              02680058
025200     EXEC SQL                                                     02690058
025300         INCLUDE TENTNME                                          02700058
025400     END-EXEC.                                                    02710058
025500 EJECT                                                            02720058
025600*                                                                 02730058
025700* SKU TABLE.                                                      02740058
025800     EXEC SQL                                                     02750058
025900         INCLUDE XLT00003                                         02760058
026000     END-EXEC.                                                    02770058
026100*                                                                 02780058
026200* VENDOR STYLE TABLE.                                             02790058
026300     EXEC SQL                                                     02800058
026400         INCLUDE XLT00004                                         02810058
026500     END-EXEC.                                                    02820058
026600*                                                                 02830058
026700* DB2 COMMUNICATION AREA                                          02840058
026800*                                                                 02850058
026900     EXEC SQL                                                     02860058
027000         INCLUDE SQLCA                                            02870058
027100     END-EXEC.                                                    02880058
027200 EJECT                                                            02890058
027300* DB2 COMMUNICATION AREA2                                         02900058
027400*                                                                 02910058
027500     COPY SQLCA2.                                                 02920058
027600 EJECT                                                            02930058
027700*                                                                 02940058
027800*                                                                 02950058
027900****************************************************************  02960058
028000 PROCEDURE DIVISION.                                              02970058
028100****************************************************************  02980058
028200                                                                  02990058
028300****************************************************************  03000058
028400* A000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE  *  03010058
028500* PROGRAM.                                                     *  03020058
028600****************************************************************  03030058
028700*                                                                 03040058
028800 A000-PROGRAM-MAINLINE.                                           03050058
028900                                                                  03060058
029000     PERFORM A100-INITIALIZATION.                                 03070058
029100                                                                  03080058
029200     PERFORM B000-PROCESS-INPUT                                   03090058
029300      UNTIL END-OF-PO-REC.                                        03100058
029400                                                                  03110058
029500     PERFORM Z100-END-ROUTINE.                                    03120058
029600                                                                  03130058
029700     GOBACK.                                                      03140058
029800                                                                  03150058
029900     EJECT                                                        03160058
030000*                                                                 03170058
030100****************************************************************  03180058
030200* A100-INITIALIZATION OPENS ALL FILES                             03190058
030300****************************************************************  03200058
030400 A100-INITIALIZATION.                                             03210058
030500                                                                  03220058
030600     OPEN INPUT  PO-FILE                                          03230058
030700          OUTPUT PO-ONORDER-STORE-FILE.                           03240058
030800                                                                  03250058
030900     PERFORM Z900-READ-INPUT-FILE                                 03260058
031000     IF END-OF-PO-REC                                             03270058
031100        DISPLAY 'NO RECORDS IN INPUT FILE'.                       03280058
031200****************************************************************  03290058
031300* B000-PROCESS.INPUT.                                             03300058
031400****************************************************************  03310058
031500 B000-PROCESS-INPUT.                                              03320058
031600                                                                  03330058
031700     MOVE PO-REC    TO WS-PO-REC                                  03340058
031800     IF WS-PO-NBR = HOLD-PO-NBR                                   03350058
031900       IF WS-STR-NBR = HOLD-STR-NBR                               03360058
032000******************************************************************03370058
032100******THE NEW RECORD IS THE SAME PO /STORE AS THE PREVIOUS.      *03380058
032200****** DO COMMON ROUTINE ONLY.  DO NOT GET MBS/PO INFO, MOVE     *03390058
032300****** ACCUMES OR WRITE RECORD OUT YET.                          *03400058
032400******************************************************************03410058
032500         PERFORM C000-COMMON-RECORD-CALCS                         03420058
032600       ELSE                                                       03430058
032700******************************************************************03440058
032800******A NEW STORE HAS BEEN READ, PROCESS PREV STORE ACCUMES AND  *03450058
032900****** WRITE RECORD OUT.  THE PO NUMBER HAS NOT CHANGED SO B030   03460058
033000****** PARA DOES NOT HAVE TO BE PERFORMED                         03470058
033100******************************************************************03480058
033200         MOVE WS-STR-NBR TO HOLD-STR-NBR                          03490058
033300         PERFORM C400-PROCESS-ACCUMULATORS                        03500058
033400         WRITE PO-ONORDER-REC FROM PO004-RECORD                   03510058
033500         ADD 1      TO PV-TOTAL-WRITTEN                           03520058
033600         PERFORM C000-COMMON-RECORD-CALCS                         03530058
033700       END-IF                                                     03540058
033800     ELSE                                                         03550058
033900         MOVE WS-PO-NBR TO HOLD-PO-NBR                            03560058
034000         MOVE WS-STR-NBR TO HOLD-STR-NBR                          03570058
034100******************************************************************03580058
034200******A CHECK FOR FIRST RECORD IS NEEDED SO THAT THE PROGRAM     *03590058
034300****** KNOWS THAT IT DOES NOT NEED TO TOTAL ANY PREVIOUS PO OR   *03600058
034400****** STORE ACCUMES BEFORE BEGINNING PROCESSING FOR THIS NEW PO *03610058
034500******************************************************************03620058
034600         IF FIRST-RECORD                                          03630058
034700           SET NOT-FIRST-RECORD  TO TRUE                          03640058
034800           PERFORM B030-BUILD-PO-DATA                             03650058
034900           PERFORM C000-COMMON-RECORD-CALCS                       03660058
035000         ELSE                                                     03670058
035100           PERFORM C400-PROCESS-ACCUMULATORS                      03680058
035200           WRITE PO-ONORDER-REC FROM PO004-RECORD                 03690058
035300           ADD 1      TO PV-TOTAL-WRITTEN                         03700058
035400           PERFORM B030-BUILD-PO-DATA                             03710058
035500           PERFORM C000-COMMON-RECORD-CALCS                       03720058
035600         END-IF                                                   03730058
035700     END-IF.                                                      03740058
035800                                                                  03750058
035900     PERFORM Z900-READ-INPUT-FILE.                                03760058
036000                                                                  03770058
036100                                                                  03780058
036200***************************************************************** 03790058
036300* B030-BUILD-PO-DATA                                            * 03800058
036400***************************************************************** 03810058
036500*                                                                 03820058
036600 B030-BUILD-PO-DATA.                                              03830058
036700     MOVE WS-PO-NBR TO PO004-PO-NUMBER-N.                         03840058
036800     MOVE WS-SHIP-DATE TO PV-SHIP-DATE.                           03850058
036900     MOVE PV-SHIP-CCYY TO PO004-SHIP-CCYY.                        03860058
037000     MOVE PV-SHIP-MM TO PO004-SHIP-MO.                            03870058
037100     MOVE PV-SHIP-DD TO PO004-SHIP-DY.                            03880058
037200     MOVE WS-CANCEL-DATE TO PV-CANCEL-DATE.                       03890058
037300     MOVE PV-CANCEL-CCYY TO PO004-CANCEL-CCYY.                    03900058
037400     MOVE PV-CANCEL-MM TO PO004-CANCEL-MO.                        03910058
037500     MOVE PV-CANCEL-DD TO PO004-CANCEL-DY.                        03920058
037200     MOVE WS-EXTEND-DATE TO PV-EXTEND-DATE.                       03930058
037300     MOVE PV-EXTEND-CCYY TO PO004-EXTEND-CCYY.                    03940058
037400     MOVE PV-EXTEND-MM   TO PO004-EXTEND-MO.                      03950058
037500     MOVE PV-EXTEND-DD   TO PO004-EXTEND-DY.                      03960058
037600     PERFORM B031-GET-MBS-DATA.                                   03970058
037700     PERFORM B032-GET-MBS-NAMES.                                  03980058
037800     PERFORM B033-GET-TPURITM.                                    03990058
037900     PERFORM B034-GET-MAJCLAS.                                    04000058
038000     PERFORM B035-GET-VENDOR.                                     04010058
038200***************************************************************** 04020058
038300* B031-GET-MBS-DATA                                             * 04030058
038400***************************************************************** 04040058
038500*                                                                 04050058
038600 B031-GET-MBS-DATA.                                               04060058
038700     MOVE 'B031-GET-MBS-DATA'                                     04070058
038800                                 TO PV-ABEND-PARAGRAPH.           04080058
038900     EXEC SQL                                                     04090058
039000     SELECT A.ENT_ID                                              04100058
039100           ,A.DEPT_NBR                                            04110058
039200           ,A.STATUS_CDE                                          04120058
039300           ,B.GMA_NBR                                             04130058
039400           ,B.DMA_NBR                                             04140058
039500           ,B.BYR_NBR                                             04150058
039600           ,B.DEPT_NBR                                            04160058
039700           ,B.MDSEAR_DESC                                         04170058
039800           ,B.MDSEAR_DKEY                                         04180058
039900     INTO  :PURCHS-ENT-ID                                         04190058
040000          ,:PURCHS-DEPT-NBR                                       04200058
040100          ,:PURCHS-STATUS-CDE                                     04210058
040200          ,:MDSEAR-GMA-NBR                                        04220058
040300          ,:MDSEAR-DMA-NBR                                        04230058
040400          ,:MDSEAR-BYR-NBR                                        04240058
040500          ,:MDSEAR-DEPT-NBR                                       04250058
040600          ,:MDSEAR-DESC                                           04260058
040700          ,:MDSEAR-DKEY                                           04270058
040800     FROM TPURCHS A                                               04280058
040900         ,TMDSEAR B                                               04290058
041000     WHERE A.PO_NBR         = :WS-PO-NBR                          04300058
041100       AND A.VER_STATUS_CDE = 'A'                                 04310058
041200       AND A.DEPT_NBR       = B.DEPT_NBR                          04320058
041300       AND B.OPERCO_NBR     = '03'                                04330058
041400       AND B.MDSELV_CDE     = 'DPT'                               04340058
041500       AND CURRENT DATE     BETWEEN B.STRT_DTE AND B.END_DTE      04350058
041600     END-EXEC.                                                    04360058
041700*                                                                 04370058
041800     EVALUATE TRUE                                                04380058
041900       WHEN SQLCODE = ZEROS                                       04390058
042000         CONTINUE                                                 04400058
042100       WHEN OTHER                                                 04410058
042200         DISPLAY PV-ABEND-PARAGRAPH                               04420058
042300         PERFORM Z999-SQL-ERROR                                   04430058
042400     END-EVALUATE.                                                04440058
042500                                                                  04450058
042600     MOVE MDSEAR-GMA-NBR  TO PO004-GMM-NO.                        04460058
042700     MOVE MDSEAR-DMA-NBR  TO PO004-DMM-NO.                        04470058
042800     MOVE MDSEAR-BYR-NBR  TO PO004-BUYER-NO.                      04480058
042900     MOVE MDSEAR-DEPT-NBR TO PO004-DEPT-NO.                       04490058
043000     MOVE MDSEAR-DESC     TO PO004-DEPT-DES.                      04500058
043100     MOVE PURCHS-STATUS-CDE TO PO004-PO-STATUS-CDE.               04510058
043200***************************************************************** 04520058
043300* B032-GET-MBS-NAMES.                                          *  04530058
043400***************************************************************** 04540058
043500*                                                                 04550058
043600 B032-GET-MBS-NAMES.                                              04560058
043700                                                                  04570058
043800     MOVE 'B032-GET-MBS-NAMES   '                                 04580058
043900                                 TO PV-ABEND-PARAGRAPH.           04590058
044000                                                                  04600058
044100                                                                  04610058
044200     EXEC SQL                                                     04620058
044300          SELECT DISTINCT(B.WORKER_LAST_NAME)                     04630058
044400                ,B.WORKER_FIR_NAME                                04640058
044500            INTO :RSPBAR-WORKER-LAST-NAME                         04650058
044600                ,:RSPBAR-WORKER-FIR-NAME                          04660058
044700          FROM TRSPBAR B                                          04670058
044800          WHERE MDSEAR_DKEY = :MDSEAR-DKEY                        04680058
044900            AND B.RSPLVL_CDE  = 'BYR'                             04690058
045000            AND WORKER_STRT_DTE <= CURRENT DATE                   04700058
045100            AND WORKER_END_DTE >= CURRENT DATE                    04710058
045200     END-EXEC.                                                    04720058
045300                                                                  04730058
045400     EVALUATE TRUE                                                04740058
045500       WHEN SQLCODE = ZEROS                                       04750058
045600         STRING RSPBAR-WORKER-FIR-NAME DELIMITED BY ' '           04760058
045700              ' '                      DELIMITED BY SIZE          04770058
045800              RSPBAR-WORKER-LAST-NAME  DELIMITED BY SIZE          04780058
045900                                      INTO  PO004-BUYER-NAME      04790058
046000       WHEN OTHER                                                 04800058
046100         DISPLAY PV-ABEND-PARAGRAPH                               04810058
046200         PERFORM Z999-SQL-ERROR                                   04820058
046300     END-EVALUATE.                                                04830058
046400                                                                  04840058
046500                                                                  04850058
046600*                                                                 04860058
046700     EXEC SQL                                                     04870058
046800          SELECT DISTINCT(B.WORKER_LAST_NAME)                     04880058
046900                ,B.WORKER_FIR_NAME                                04890058
047000            INTO :RSPBAR-WORKER-LAST-NAME                         04900058
047100                ,:RSPBAR-WORKER-FIR-NAME                          04910058
047200          FROM TMDSEAR A,                                         04920058
047300               TRSPBAR B                                          04930058
047400          WHERE A.OPERCO_NBR = '03'                               04940058
047500            AND A.GMA_NBR   = :MDSEAR-GMA-NBR                     04950058
047600            AND A.DMA_NBR   = :MDSEAR-DMA-NBR                     04960058
047700            AND MDSELV_CDE    = 'DMA'                             04970058
047800            AND A.MDSEAR_DKEY = B.MDSEAR_DKEY                     04980058
047900            AND B.RSPLVL_CDE  = 'DMM'                             04990058
048000            AND WORKER_STRT_DTE <= CURRENT DATE                   05000058
048100            AND WORKER_END_DTE >= CURRENT DATE                    05010058
048200     END-EXEC.                                                    05020058
048300*                                                                 05030058
048400     EVALUATE TRUE                                                05040058
048500       WHEN SQLCODE = ZEROS                                       05050058
048600         STRING RSPBAR-WORKER-FIR-NAME DELIMITED BY ' '           05060058
048700              ' '                      DELIMITED BY SIZE          05070058
048800              RSPBAR-WORKER-LAST-NAME  DELIMITED BY SIZE          05080058
048900                                      INTO  PO004-DMM-NAME        05090058
049000       WHEN OTHER                                                 05100058
049100         DISPLAY PV-ABEND-PARAGRAPH                               05110058
049200         PERFORM Z999-SQL-ERROR                                   05120058
049300     END-EVALUATE.                                                05130058
049400                                                                  05140058
049500     EXEC SQL                                                     05150058
049600          SELECT DISTINCT(B.WORKER_LAST_NAME)                     05160058
049700                ,B.WORKER_FIR_NAME                                05170058
049800          INTO   :RSPBAR-WORKER-LAST-NAME                         05180058
049900                ,:RSPBAR-WORKER-FIR-NAME                          05190058
050000          FROM TMDSEAR A,                                         05200058
050100               TRSPBAR B                                          05210058
050200          WHERE A.OPERCO_NBR = '03'                               05220058
050300            AND A.GMA_NBR   = :MDSEAR-GMA-NBR                     05230058
050400            AND A.MDSEAR_DKEY = B.MDSEAR_DKEY                     05240058
050500            AND B.RSPLVL_CDE  = 'GMM'                             05250058
050600            AND WORKER_STRT_DTE <= CURRENT DATE                   05260058
050700            AND WORKER_END_DTE >= CURRENT DATE                    05270058
050800     END-EXEC.                                                    05280058
050900                                                                  05290058
051000     EVALUATE TRUE                                                05300058
051100       WHEN SQLCODE = ZEROS                                       05310058
051200         STRING RSPBAR-WORKER-FIR-NAME DELIMITED BY ' '           05320058
051300              ' '                      DELIMITED BY SIZE          05330058
051400              RSPBAR-WORKER-LAST-NAME  DELIMITED BY SIZE          05340058
051500                                      INTO  PO004-GMM-NAME        05350058
051600       WHEN OTHER                                                 05360058
051700         DISPLAY PV-ABEND-PARAGRAPH                               05370058
051800         PERFORM Z999-SQL-ERROR                                   05380058
051900     END-EVALUATE.                                                05390058
052000                                                                  05400058
052100*                                                                 05410058
052200***************************************************************** 05420058
052300* B033-GET-TPURITM                                              * 05430058
052400***************************************************************** 05440058
052500*                                                                 05450058
052600 B033-GET-TPURITM.                                                05460058
052700     MOVE 'B033-GET-TPURITM'                                      05470058
052800                                 TO PV-ABEND-PARAGRAPH.           05480058
052900     MOVE WS-PO-NBR     TO PURITM-PO-NBR                          05490058
053000     EXEC SQL                                                     05500058
053100          SELECT MIN(COALESCE(C.MAJ_CL_NBR,                       05510058
053200                 DECIMAL(SUBSTR(A.CL_NBR,1,1)|| '0')))            05520058
053300     INTO  :XLT00004-MAJ-CL-NBR                                   05530058
053400     FROM TPURITM  A                                              05540058
053500          LEFT OUTER JOIN                                         05550058
053600          XLT_SKU B ON A.ITM_NBR = B.ITM_NBR                      05560058
053700          LEFT OUTER JOIN                                         05570058
053800          XLT_VND_STYL C ON B.STYL_ID = C.STYL_ID                 05580058
053900     WHERE                                                        05590058
054000           A.PO_NBR         = :PURITM-PO-NBR                      05600058
054100       AND A.VER_STATUS_CDE = 'A'                                 05610058
054300     END-EXEC.                                                    05620058
054400*                                                                 05630058
054500     EVALUATE TRUE                                                05640058
054600       WHEN SQLCODE = ZEROS                                       05650058
054700            MOVE XLT00004-MAJ-CL-NBR  TO PV-ITEM-CLASS            05660058
054800            MOVE PV-REDF-ITEM-CLASS   TO PO004-MAJOR-CLASS-NO     05670058
054900       WHEN OTHER                                                 05680058
055000         DISPLAY PV-ABEND-PARAGRAPH                               05690058
               DISPLAY 'PURCHASE ORDER: ' WS-PO-NBR                     05700058
055100         PERFORM Z999-SQL-ERROR                                   05710058
055200     END-EVALUATE.                                                05720058
055300                                                                  05730058
055400     EJECT.                                                       05740058
055500                                                                  05750058
055600***************************************************************** 05760058
055700* B034-GET-MAJCLAS                                              * 05770058
055800***************************************************************** 05780058
055900*                                                                 05790058
056000 B034-GET-MAJCLAS.                                                05800058
056100     MOVE 'B034-GET-MAJCLAS'                                      05810058
056200                                 TO PV-ABEND-PARAGRAPH.           05820058
056300     EXEC SQL                                                     05830058
056400     SELECT B.MDSEAR_DESC                                         05840058
056500           ,B.MDSEAR_DKEY                                         05850058
056600           ,B.MAJ_CL_NBR                                          05860058
056700     INTO  :MDSEAR-DESC                                           05870058
056800          ,:MDSEAR-DKEY                                           05880058
056900          ,:MDSEAR-MAJ-CL-NBR                                     05890058
057000     FROM TMDSEAR B                                               05900058
057100     WHERE B.DEPT_NBR       = :PURCHS-DEPT-NBR                    05910058
057200       AND B.MAJ_CL_NBR     = :PV-REDF-ITEM-CLASS                 05920058
057300       AND B.OPERCO_NBR     = '03'                                05930058
057400       AND B.MDSELV_CDE     = 'MCL'                               05940058
057500       AND CURRENT DATE     BETWEEN B.STRT_DTE AND B.END_DTE      05950058
057600     END-EXEC.                                                    05960058
057700*                                                                 05970058
057800     EVALUATE TRUE                                                05980058
057900       WHEN SQLCODE = ZEROS                                       05990058
058000            MOVE MDSEAR-DESC TO PO004-MAJOR-CLASS-DES             06000058
P46216       WHEN SQLCODE = 100                                         06010058
P46216         DISPLAY '*****************************'                  06020058
P46216         DISPLAY 'RE-CLASSIFIED PO: ' WS-PO-NBR                   06030058
P46216         DISPLAY 'OLD DEPT NO: ' PURCHS-DEPT-NBR                  06040058
P46216         DISPLAY 'OLD MAJ CLS: ' PV-REDF-ITEM-CLASS               06050058
P46216         PERFORM B036-ALT-DATA                                    06060058
P46216         DISPLAY 'NEW DEPT NO: ' PURCHS-DEPT-NBR                  06070058
P46216         DISPLAY 'NEW MAJ CLS: ' PV-REDF-ITEM-CLASS               06080058
P46216         DISPLAY '*****************************'                  06090058
P46216         PERFORM B034-GET-MAJCLAS                                 06100058
058100       WHEN OTHER                                                 06110058
058200         DISPLAY PV-ABEND-PARAGRAPH                               06120058
058300         PERFORM Z999-SQL-ERROR                                   06130058
058400     END-EVALUATE.                                                06140058
058500                                                                  06150058
058600     EJECT.                                                       06160058
058700                                                                  06170058
P46216***************************************************************** 06180058
P46216* B036-ALT-DATA                                                   06190058
P46216* THIS IS THE STEP TO FETCH THE RECLASSIFIED DEPARTMENT AND CLASS 06200058
P46216* FOR THE PO INCASE OF A INVALID DEPT AND CLASS COMBINATION IN    06210058
P46216* B034-GET-MAJCLAS                                                06220058
P46216***************************************************************** 06230058
P46216 B036-ALT-DATA.                                                   06240058
P46216     MOVE 'B036-ALT-DATA'                                         06250058
P46216                                 TO PV-ABEND-PARAGRAPH.           06260058
P46216     EXEC SQL                                                     06270058
P46216     SELECT C.NW_DEPT_NBR                                         06280058
P46216           ,C.NW_MAJ_CL_NBR                                       06290058
P46216     INTO  :PURCHS-DEPT-NBR                                       06300058
P46216          ,:PV-REDF-ITEM-CLASS                                    06310058
P46216     FROM IMT_RECLS C                                             06320058
P46216     WHERE C.SKU_NBR IN                                           06330058
P46216          (SELECT A.RMS_PO_SKU_NBR                                06340058
P46216           FROM TPURITM A                                         06350058
P46216               ,IMT_RECLS B                                       06360058
P46216           WHERE                                                  06370058
P46216           B.SKU_NBR     =  A.RMS_PO_SKU_NBR                      06380058
P46216           AND A.PO_NBR  = :PURITM-PO-NBR                         06390058
P46216           FETCH FIRST ROW ONLY)                                  06400058
P46216     ORDER BY C.RECLS_TMST DESC                                   06410058
P46216     FETCH FIRST ROW ONLY                                         06420058
P46216     END-EXEC.                                                    06430058
P46216*                                                                 06440058
P46216     EVALUATE TRUE                                                06450058
P46216       WHEN SQLCODE = ZEROS                                       06460058
P46216         CONTINUE                                                 06470058
P46216       WHEN OTHER                                                 06480058
P46216         DISPLAY PV-ABEND-PARAGRAPH                               06490058
P46216         PERFORM Z999-SQL-ERROR                                   06500058
P46216     END-EVALUATE.                                                06510058
P46216*                                                                 06520058
058800***************************************************************** 06530058
058900* B035-GET-VENDOR                                               * 06540058
059000***************************************************************** 06550058
059100*                                                                 06560058
059200 B035-GET-VENDOR.                                                 06570058
059300     MOVE 'B035-GET-VENDOR'                                       06580058
059400                                 TO PV-ABEND-PARAGRAPH.           06590058
059500     EXEC SQL                                                     06600058
059600          SELECT ENT_NAME_DESC                                    06610058
059700            INTO :ENTNME-ENT-NAME-DESC                            06620058
059800            FROM TENTNME                                          06630058
059900           WHERE ENT_ID   = :PURCHS-ENT-ID                        06640058
060000             AND TYPE_CDE = '01'                                  06650058
060100     END-EXEC                                                     06660058
060200                                                                  06670058
060300     EVALUATE TRUE                                                06680058
060400       WHEN SQLCODE = ZEROS                                       06690058
060500         MOVE ENTNME-ENT-NAME-DESC TO PO004-VENDOR-NAME           06700058
060600       WHEN OTHER                                                 06710058
060700         DISPLAY PV-ABEND-PARAGRAPH                               06720058
060800         PERFORM Z999-SQL-ERROR                                   06730058
060900     END-EVALUATE.                                                06740058
064800*                                                                 06750058
064900*                                                                 06760058
065000***************************************************************** 06770058
065100* C000-COMMON-RECORD-CALCS.                                     * 06780058
065200***************************************************************** 06790058
065300*                                                               * 06800058
065400 C000-COMMON-RECORD-CALCS.                                        06810058
065500                                                                  06820058
065600     MOVE WS-STR-NBR TO PO004-STORE-NBR.                          06830058
065700     MOVE WS-CHAR5-ABBR-NAME TO PO004-STORE-NAME.                 06840058
065800                                                                  06850058
065900     MOVE ZEROES  TO PV-SUM-RETL-ONORDER                          06860058
066000                     PV-SUM-DISTRO-QTY-VE                         06870058
066100                     PV-SUM-RTL-VERFD                             06880058
066200                     PV-SUM-DISTRO-QTY-IP                         06890058
066300                     PV-SUM-RTL-INP.                              06900058
066400                                                                  06910058
066500     PERFORM C100-ONORDER-CALC.                                   06920058
066600                                                                  06930058
066700     PERFORM C200-GET-RECVD-UNITS.                                06940058
066800                                                                  06950058
066900     PERFORM C300-GET-INPROCESS-UNITS.                            06960058
           PERFORM C310-GET-IP-UNTS.                                    06970058
           PERFORM C320-GET-ER-UNTS.                                    06980058
067000                                                                  06990058
067100     ADD WS-STR-DISTRO-QTY     TO PV-ACCUM-DISTRO-ONORDER.        07000058
067200     ADD PV-SUM-RETL-ONORDER   TO PV-ACCUM-RTL-ONORDER.           07010058
067300     ADD PV-SUM-DISTRO-QTY-VE  TO PV-ACCUM-DISTRO-QTY-VE.         07020058
067400     ADD PV-SUM-RTL-VERFD      TO PV-ACCUM-RTL-VERFD.             07030058
067500     ADD PV-SUM-DISTRO-QTY-IP  TO PV-ACCUM-DISTRO-QTY-IP.         07040058
067500     ADD PV-SUM-DISTRO-QTY-IP2 TO PV-ACCUM-DISTRO-QTY-IP2.        07050058
067500     ADD PV-SUM-DISTRO-QTY-ER  TO PV-ACCUM-DISTRO-QTY-ER.         07060058
067600     ADD PV-SUM-RTL-INP        TO PV-ACCUM-RTL-INP.               07070058
067700*                                                                 07080058
067800*                                                                 07090058
067900***************************************************************** 07100058
068000* C100-ONORDER-CALC.                                            * 07110058
068100***************************************************************** 07120058
068200*                                                               * 07130058
068300 C100-ONORDER-CALC.                                               07140058
068400                                                                  07150058
068500     EXEC SQL                                                     07160058
068600         SELECT SUM                                               07170058
068700         (CASE                                                    07180058
068800           WHEN A.GP_QTY <= 1                                     07190058
068900             THEN                                                 07200058
069000                 (:WS-STR-DISTRO-QTY * UNT_RTL_PR_AMT)            07210058
069100           WHEN A.GP_QTY > 1                                      07220058
069200             THEN                                                 07230058
069300                 (:WS-STR-DISTRO-QTY * (A.GP_RTL_AMT / A.GP_QTY)) 07240058
069400          END)                                                    07250058
069500                                                                  07260058
069600         , A.APP_PO_LNE_NBR                                       07270058
069700         , A.VER_NBR                                              07280058
069800                                                                  07290058
069900         INTO                                                     07300058
070000              :PV-SUM-RETL-ONORDER:IND-NOTES                      07310058
070100         ,    :PURITM-APP-PO-LNE-NBR                              07320058
070200         ,    :PURITM-VER-NBR                                     07330058
070300                                                                  07340058
070400         FROM TPURITM A                                           07350058
070500                                                                  07360058
070600         WHERE A.PO_NBR         = :WS-PO-NBR                      07370058
070700           AND A.PO_LNE_NBR     = :WS-PO-LNE-NBR                  07380058
070800           AND A.VER_STATUS_CDE = 'A'                             07390058
070900           AND A.STATUS_CDE IN                                    07400058
071000                 ('AC' , 'AP' , 'CM' , 'CB' , 'RV')               07410058
071100                                                                  07420058
071200         GROUP BY                                                 07430058
071300           A.APP_PO_LNE_NBR                                       07440058
071400         , A.VER_NBR                                              07450058
071500     END-EXEC.                                                    07460058
071600                                                                  07470058
071700                                                                  07480058
071800     EVALUATE TRUE                                                07490058
071900       WHEN SQLCODE = ZEROS                                       07500058
072000         IF IND-NOTES = -1                                        07510058
072100            MOVE ZEROES TO PV-SUM-RETL-ONORDER                    07520058
072200         END-IF                                                   07530058
072300       WHEN SQLCODE = PC-ROW-NOT-FOUND                            07540058
072400         CONTINUE                                                 07550058
072500       WHEN OTHER                                                 07560058
072600         DISPLAY PV-ABEND-PARAGRAPH                               07570058
072700         PERFORM Z999-SQL-ERROR                                   07580058
072800     END-EVALUATE.                                                07590058
072900*                                                                 07600058
073000*                                                               * 07610058
073100***************************************************************** 07620058
073200* C200-GET-RECVD-UNITS.                                         * 07630058
073300***************************************************************** 07640058
073400*                                                               * 07650058
073500 C200-GET-RECVD-UNITS.                                            07660058
073600* COMBINE C200 AND C300 CALLS                                     07670058
073700                                                                  07680058
073800                                                                  07690058
073900     MOVE 'C200-GET-RECVD-UNITS'                                  07700058
074000                                 TO PV-ABEND-PARAGRAPH.           07710058
074100     EXEC SQL                                                     07720058
074200         SELECT SUM                                               07730058
074300             (RDIS.AP_VERIFY_ITM_QTY)                             07740058
074400         , SUM                                                    07750058
074500         (CASE                                                    07760058
074600           WHEN PITM.GP_QTY <= 1                                  07770058
074700             THEN                                                 07780058
074800                (RDIS.AP_VERIFY_ITM_QTY * PITM.UNT_RTL_PR_AMT)    07790058
074900           WHEN PITM.GP_QTY > 1                                   07800058
075000             THEN                                                 07810058
075100                (RDIS.AP_VERIFY_ITM_QTY *                         07820058
075100                (PITM.GP_RTL_AMT / PITM.GP_QTY))                  07830058
075200         END)                                                     07840058
075300                                                                  07850058
075400         INTO                                                     07860058
075500              :PV-SUM-DISTRO-QTY-VE:IND-NOTES                     07870058
075600         ,    :PV-SUM-RTL-VERFD:IND-NOTES2                        07880058
075700                                                                  07890058
075800         FROM TRECDIS RDIS                                        07900058
075900          ,   TRECITM RITM                                        07910058
076000          ,   TPURITM PITM                                        07920058
076100                                                                  07930058
076200         WHERE                                                    07940058
076300             PITM.PO_NBR      = :WS-PO-NBR                        07950058
076400         AND PITM.PO_LNE_NBR  = :WS-PO-LNE-NBR                    07960058
076500                                                                  07970058
076600         AND RITM.ORD_NBR     = PITM.PO_NBR                       07980058
076700         AND RITM.ORD_LNE_NBR = :PURITM-APP-PO-LNE-NBR            07990058
076800*        AND RITM.PO_VER_NBR  = PITM.VER_NBR                      08000058
076900         AND PITM.VER_NBR     = :PURITM-VER-NBR                   08010058
077000         AND RITM.STATUS_CDE  = 'VE'                              08020058
077100         AND RITM.VER_STATUS_CDE = 'A'                            08030058
077200                                                                  08040058
077300         AND RDIS.ORD_NBR     = RITM.ORD_NBR                      08050058
077400         AND RDIS.ORD_LNE_NBR = RITM.ORD_LNE_NBR                  08060058
077500         AND RDIS.REC_SEQ_NBR = RITM.REC_SEQ_NBR                  08070058
077600         AND RDIS.OPER_UNT_ID = RITM.OPER_UNT_ID                  08080058
077700         AND RDIS.FCLTY_ID    = RITM.FCLTY_ID                     08090058
077800         AND RDIS.STR_NBR     = :WS-STR-NBR                       08100058
077900         AND RDIS.VER_STATUS_CDE = 'A'                            08110058
078000         AND RDIS.ORD_LNE_NBR = :PURITM-APP-PO-LNE-NBR            08120058
078100     END-EXEC.                                                    08130058
078200                                                                  08140058
078300     EVALUATE TRUE                                                08150058
078400       WHEN SQLCODE = ZEROS                                       08160058
078500        IF IND-NOTES = -1                                         08170058
078600          MOVE ZEROS TO PV-SUM-DISTRO-QTY-VE                      08180058
078700        END-IF                                                    08190058
078800        IF IND-NOTES2 = -1                                        08200058
078900          MOVE ZEROS TO PV-SUM-RTL-VERFD                          08210058
079000        END-IF                                                    08220058
079100       WHEN SQLCODE = PC-ROW-NOT-FOUND                            08230058
079200         CONTINUE                                                 08240058
079300       WHEN OTHER                                                 08250058
079400         DISPLAY PV-ABEND-PARAGRAPH                               08260058
079500         PERFORM Z999-SQL-ERROR                                   08270058
079600     END-EVALUATE.                                                08280058
079700*                                                               * 08290058
      *                                                               * 08300058
      ***************************************************************** 08310058
      * C300-GET-INPROCESS-UNITS.                                     * 08320058
      * THESE ARE THE IN PROCESS UNITS THAT ARE USED BY POKRP021      * 08330058
      ***************************************************************** 08340058
079800 C300-GET-INPROCESS-UNITS.                                        08350058
079900                                                                  08360058
080000     MOVE 'C300-GET-INPROCESS-UNITS'                              08370058
080100                                 TO PV-ABEND-PARAGRAPH.           08380058
080200                                                                  08390058
080300     EXEC SQL                                                     08400058
080400         SELECT SUM                                               08410058
080500             (RDIS.VERIFY_ITM_QTY)                                08420058
080600                                                                  08430058
080700         ,  SUM                                                   08440058
080800         (CASE                                                    08450058
080900           WHEN PITM.GP_QTY <= 1                                  08460058
081000             THEN                                                 08470058
081100                (RDIS.VERIFY_ITM_QTY * PITM.UNT_RTL_PR_AMT)       08480058
081200           WHEN PITM.GP_QTY > 1                                   08490058
081300             THEN                                                 08500058
081400                (RDIS.VERIFY_ITM_QTY *                            08510058
081400                (PITM.GP_RTL_AMT / PITM.GP_QTY))                  08520058
081500         END )                                                    08530058
081600         INTO                                                     08540058
081700              :PV-SUM-DISTRO-QTY-IP:IND-NOTES                     08550058
081800         ,    :PV-SUM-RTL-INP:IND-NOTES2                          08560058
081900         FROM TRECDIS RDIS                                        08570058
082000           ,  TRECITM RITM                                        08580058
082100           ,  TPURITM PITM                                        08590058
082200                                                                  08600058
082300         WHERE                                                    08610058
082400             PITM.PO_NBR      = :WS-PO-NBR                        08620058
082500         AND PITM.PO_LNE_NBR  = :WS-PO-LNE-NBR                    08630058
082600                                                                  08640058
082700         AND RITM.ORD_NBR     = PITM.PO_NBR                       08650058
082800         AND RITM.ORD_LNE_NBR = :PURITM-APP-PO-LNE-NBR            08660058
082900         AND PITM.VER_NBR     = :PURITM-VER-NBR                   08670058
083000         AND RITM.STATUS_CDE  <> 'VE'                             08680058
083100         AND RITM.VER_STATUS_CDE = 'A'                            08690058
083200                                                                  08700058
083300         AND RDIS.ORD_NBR     = RITM.ORD_NBR                      08710058
083400         AND RDIS.ORD_LNE_NBR = RITM.ORD_LNE_NBR                  08720058
083500         AND RDIS.REC_SEQ_NBR = RITM.REC_SEQ_NBR                  08730058
083600         AND RDIS.OPER_UNT_ID = RITM.OPER_UNT_ID                  08740058
083700         AND RDIS.FCLTY_ID    = RITM.FCLTY_ID                     08750058
083800         AND RDIS.STR_NBR     = :WS-STR-NBR                       08760058
083900         AND RDIS.VER_STATUS_CDE = 'A'                            08770058
084000         AND RDIS.ORD_LNE_NBR = :PURITM-APP-PO-LNE-NBR            08780058
084100     END-EXEC.                                                    08790058
084200                                                                  08800058
084300     EVALUATE TRUE                                                08810058
084400       WHEN SQLCODE = ZEROS                                       08820058
084500        IF IND-NOTES = -1                                         08830058
084600          MOVE ZEROS TO PV-SUM-DISTRO-QTY-IP                      08840058
084700        END-IF                                                    08850058
084800        IF IND-NOTES2 = -1                                        08860058
084900          MOVE ZEROES TO PV-SUM-RTL-INP                           08870058
085000        END-IF                                                    08880058
085100       WHEN SQLCODE = PC-ROW-NOT-FOUND                            08890058
085200         CONTINUE                                                 08900058
085300       WHEN OTHER                                                 08910058
085400         DISPLAY PV-ABEND-PARAGRAPH                               08920058
085500         PERFORM Z999-SQL-ERROR                                   08930058
085600     END-EVALUATE.                                                08940058
079700*                                                               * 08950058
      ***************************************************************** 08960058
      * C310-GET-IP-UNTS.                                             * 08970058
      * THESE ARE THE IN PROCESS UNITS THAT ARE USED BY POKRP020      * 08980058
      ***************************************************************** 08990058
079800 C310-GET-IP-UNTS.                                                09000058
079900                                                                  09010058
080000     MOVE 'C310-GET-IP-UNTS'                                      09020058
080100                                 TO PV-ABEND-PARAGRAPH.           09030058
080200                                                                  09040058
080300     EXEC SQL                                                     09050058
080400         SELECT SUM                                               09060058
080500             (RDIS.VERIFY_ITM_QTY)                                09070058
081600         INTO                                                     09080058
081700              :PV-SUM-DISTRO-QTY-IP2:IND-NOTES                    09090058
081900         FROM TRECDIS RDIS                                        09100058
082000           ,  TRECITM RITM                                        09110058
082100           ,  TPURITM PITM                                        09120058
082100           ,  TRECEIV RECV                                        09130058
082200                                                                  09140058
082300         WHERE                                                    09150058
082400             PITM.PO_NBR      = :WS-PO-NBR                        09160058
082500         AND PITM.PO_LNE_NBR  = :WS-PO-LNE-NBR                    09170058
082600                                                                  09180058
083200         AND RECV.REC_TMST      <> '9999-09-09-09.09.09.999999'   09190058
               AND RECV.ORD_NBR        = PITM.PO_NBR                    09200058
               AND RECV.VER_STATUS_CDE = 'A'                            09210058
082600                                                                  09220058
082700         AND RITM.ORD_NBR     = RECV.ORD_NBR                      09230058
082700         AND RITM.REC_SEQ_NBR = RECV.REC_SEQ_NBR                  09240058
082800         AND RITM.ORD_LNE_NBR = :PURITM-APP-PO-LNE-NBR            09250058
082900         AND PITM.VER_NBR     = :PURITM-VER-NBR                   09260058
083000         AND RITM.STATUS_CDE  = 'IP'                              09270058
083100         AND RITM.VER_STATUS_CDE = 'A'                            09280058
083200                                                                  09290058
083300         AND RDIS.ORD_NBR     = RITM.ORD_NBR                      09300058
083400         AND RDIS.ORD_LNE_NBR = RITM.ORD_LNE_NBR                  09310058
083500         AND RDIS.REC_SEQ_NBR = RITM.REC_SEQ_NBR                  09320058
083600         AND RDIS.OPER_UNT_ID = RITM.OPER_UNT_ID                  09330058
083700         AND RDIS.FCLTY_ID    = RITM.FCLTY_ID                     09340058
083800         AND RDIS.STR_NBR     = :WS-STR-NBR                       09350058
083900         AND RDIS.VER_STATUS_CDE = 'A'                            09360058
084000         AND RDIS.ORD_LNE_NBR = :PURITM-APP-PO-LNE-NBR            09370058
084100     END-EXEC.                                                    09380058
084200                                                                  09390058
084300     EVALUATE TRUE                                                09400058
084400       WHEN SQLCODE = ZEROS                                       09410058
084500        IF IND-NOTES = -1                                         09420058
084600          MOVE ZEROS TO PV-SUM-DISTRO-QTY-IP2                     09430058
084700        END-IF                                                    09440058
085100       WHEN SQLCODE = PC-ROW-NOT-FOUND                            09450058
085200         CONTINUE                                                 09460058
085300       WHEN OTHER                                                 09470058
085400         DISPLAY PV-ABEND-PARAGRAPH                               09480058
085500         PERFORM Z999-SQL-ERROR                                   09490058
085600     END-EVALUATE.                                                09500058
079700*                                                               * 09510058
      ***************************************************************** 09520058
      * C320-GET-ER-UNTS.                                             * 09530058
      * THESE ARE THE EN ROUTE UNITS THAT ARE USED BY POKRP020        * 09540058
      ***************************************************************** 09550058
079800 C320-GET-ER-UNTS.                                                09560058
079900                                                                  09570058
080000     MOVE 'C320-GET-ER-UNTS'                                      09580058
080100                                 TO PV-ABEND-PARAGRAPH.           09590058
080200                                                                  09600058
080300     EXEC SQL                                                     09610058
080400         SELECT SUM                                               09620058
080500             (RDIS.VERIFY_ITM_QTY)                                09630058
081600         INTO                                                     09640058
081700              :PV-SUM-DISTRO-QTY-ER:IND-NOTES                     09650058
081900         FROM TRECDIS RDIS                                        09660058
082000           ,  TRECITM RITM                                        09670058
082100           ,  TPURITM PITM                                        09680058
082100           ,  TRECEIV RECV                                        09690058
082200                                                                  09700058
082300         WHERE                                                    09710058
082400             PITM.PO_NBR      = :WS-PO-NBR                        09720058
082500         AND PITM.PO_LNE_NBR  = :WS-PO-LNE-NBR                    09730058
082600                                                                  09740058
083200         AND RECV.REC_TMST       = '9999-09-09-09.09.09.999999'   09750058
               AND RECV.ORD_NBR        = PITM.PO_NBR                    09760058
               AND RECV.VER_STATUS_CDE = 'A'                            09770058
082600                                                                  09780058
082700         AND RITM.ORD_NBR     = RECV.ORD_NBR                      09790058
082700         AND RITM.REC_SEQ_NBR = RECV.REC_SEQ_NBR                  09800058
082800         AND RITM.ORD_LNE_NBR = :PURITM-APP-PO-LNE-NBR            09810058
082900         AND PITM.VER_NBR     = :PURITM-VER-NBR                   09820058
083000         AND RITM.STATUS_CDE  = 'IP'                              09830058
083100         AND RITM.VER_STATUS_CDE = 'A'                            09840058
083200                                                                  09850058
083300         AND RDIS.ORD_NBR     = RITM.ORD_NBR                      09860058
083400         AND RDIS.ORD_LNE_NBR = RITM.ORD_LNE_NBR                  09870058
083500         AND RDIS.REC_SEQ_NBR = RITM.REC_SEQ_NBR                  09880058
083600         AND RDIS.OPER_UNT_ID = RITM.OPER_UNT_ID                  09890058
083700         AND RDIS.FCLTY_ID    = RITM.FCLTY_ID                     09900058
083800         AND RDIS.STR_NBR     = :WS-STR-NBR                       09910058
083900         AND RDIS.VER_STATUS_CDE = 'A'                            09920058
084000         AND RDIS.ORD_LNE_NBR = :PURITM-APP-PO-LNE-NBR            09930058
084100     END-EXEC.                                                    09940058
084200                                                                  09950058
084300     EVALUATE TRUE                                                09960058
084400       WHEN SQLCODE = ZEROS                                       09970058
084500        IF IND-NOTES = -1                                         09980058
084600          MOVE ZEROS TO PV-SUM-DISTRO-QTY-ER                      09990058
084700        END-IF                                                    10000058
085100       WHEN SQLCODE = PC-ROW-NOT-FOUND                            10010058
085200         CONTINUE                                                 10020058
085300       WHEN OTHER                                                 10030058
085400         DISPLAY PV-ABEND-PARAGRAPH                               10040058
085500         PERFORM Z999-SQL-ERROR                                   10050058
085600     END-EVALUATE.                                                10060058
085700*                                                               * 10070058
085800*                                                               * 10080058
085900***************************************************************** 10090058
086000* C400-PROCESS-ACCUMULATORS.                                    * 10100058
086100***************************************************************** 10110058
086200*                                                               * 10120058
086300 C400-PROCESS-ACCUMULATORS.                                       10130058
086400                                                                  10140058
086500     MOVE 'C400-PROCESS-ACCUMULATORS '                            10150058
086600                                 TO PV-ABEND-PARAGRAPH.           10160058
086700                                                                  10170058
086800     MOVE PV-ACCUM-RTL-ONORDER TO PO004-ORDERED-RETAIL.           10180058
086900     MOVE PV-ACCUM-DISTRO-ONORDER TO PO004-ORDERED-UNITS.         10190058
087000     MOVE PV-ACCUM-RTL-VERFD TO PO004-VERIFIED-RETAIL.            10200058
087100     MOVE PV-ACCUM-DISTRO-QTY-VE TO PO004-VERIFIED-UNITS.         10210058
087200     MOVE PV-ACCUM-RTL-INP TO PO004-INPROCESS-RETAIL.             10220058
087300     MOVE PV-ACCUM-DISTRO-QTY-IP  TO PO004-INPROCESS-UNITS.       10230058
087300     MOVE PV-ACCUM-DISTRO-QTY-IP2 TO PO004-INPROCESS-UNITS2.      10240058
           MOVE PV-ACCUM-DISTRO-QTY-ER  TO PO004-ENROUTE-UNITS.         10250058
087400                                                                  10260058
087500     IF PV-ACCUM-DISTRO-ONORDER > 0 AND                           10270058
087600        PV-ACCUM-DISTRO-QTY-VE > 0                                10280058
087700        COMPUTE PV-PERCENT-WORK-FIELD ROUNDED =                   10290058
087800        ((PV-ACCUM-DISTRO-QTY-VE * 100)                           10300058
087900         / PV-ACCUM-DISTRO-ONORDER)                               10310058
088000        MOVE PV-PERCENT-WORK-FIELD TO PO004-VERIFIED-PCT          10320058
088100     ELSE                                                         10330058
088200        MOVE ZERO TO PO004-VERIFIED-PCT                           10340058
088300     END-IF.                                                      10350058
088400                                                                  10360058
088500     IF PV-ACCUM-DISTRO-ONORDER > 0 AND                           10370058
088600        PV-ACCUM-DISTRO-QTY-IP > 0                                10380058
088700        COMPUTE PV-PERCENT-WORK-FIELD ROUNDED =                   10390058
088800        ((PV-ACCUM-DISTRO-QTY-IP * 100)                           10400058
088900         / PV-ACCUM-DISTRO-ONORDER)                               10410058
089000        MOVE PV-PERCENT-WORK-FIELD TO PO004-INPROCESS-PCT         10420058
089100     ELSE                                                         10430058
089200        MOVE ZERO TO PO004-INPROCESS-PCT                          10440058
089300     END-IF.                                                      10450058
089400                                                                  10460058
089500     MOVE ZEROS TO PV-ACCUM-RTL-ONORDER                           10470058
089600                   PV-ACCUM-RTL-INP                               10480058
089700                   PV-ACCUM-RTL-VERFD                             10490058
089800                   PV-ACCUM-DISTRO-QTY-VE                         10500058
089900                   PV-ACCUM-DISTRO-QTY-IP                         10510058
089900                   PV-ACCUM-DISTRO-QTY-IP2                        10520058
089900                   PV-ACCUM-DISTRO-QTY-ER                         10530058
090000                   PV-ACCUM-DISTRO-ONORDER.                       10540058
090100                                                                  10550058
090200***************************************************************** 10560058
090300* Z100-END-ROUTINE                                              * 10570058
090400*                                                               * 10580058
090500*                                                               * 10590058
090600***************************************************************** 10600058
090700                                                                  10610058
090800 Z100-END-ROUTINE.                                                10620058
090900     PERFORM C400-PROCESS-ACCUMULATORS.                           10630058
091000     WRITE PO-ONORDER-REC FROM PO004-RECORD.                      10640058
091100     ADD 1      TO PV-TOTAL-WRITTEN                               10650058
091200     CLOSE PO-FILE                                                10660058
091300           PO-ONORDER-STORE-FILE.                                 10670058
091400     DISPLAY SPACES                                               10680058
091500     DISPLAY '*****************   POKUT064  **************'       10690058
091600     MOVE PV-TOTAL-READ TO PV-DISP-NUMBER                         10700058
091700     DISPLAY 'RECS READ    = ' PV-DISP-NUMBER                     10710058
091800     MOVE PV-TOTAL-WRITTEN TO PV-DISP-NUMBER                      10720058
091900     DISPLAY 'RECS WRITTEN = ' PV-DISP-NUMBER                     10730058
092000     DISPLAY SPACES.                                              10740058
092100     DISPLAY '*****************   POKUT064  **************'       10750058
092200     DISPLAY SPACES.                                              10760058
092300*                                                                 10770058
092400****************************************************************  10780058
092500* Z900-READ-INPUT-FILE                                            10790058
092600****************************************************************  10800058
092700 Z900-READ-INPUT-FILE.                                            10810058
092800                                                                  10820058
092900     READ PO-FILE                                                 10830058
093000       AT END                                                     10840058
093100        MOVE PC-Y          TO  PS-END-OF-PO-REC                   10850058
093200     NOT AT END                                                   10860058
093300         ADD 1             TO PV-TOTAL-READ                       10870058
093400     END-READ.                                                    10880058
093500                                                                  10890058
093600                                                                  10900058
093700******************************************************************10910058
093800*     SQL WARNING OR ERROR PROCESSING                            *10920058
093900*                                                                *10930058
094000******************************************************************10940058
094100                                                                  10950058
094200 Z999-SQL-ERROR.                                                  10960058
094300*---------------                                                  10970058
094400                                                                  10980058
094500     MOVE SQLCODE    TO SQLCODE2.                                 10990058
094600     MOVE SQLERRD(3) TO SQLERRD3.                                 11000058
094700     DISPLAY '** ABEND **       ** = SQLERROR'.                   11010058
094800     DISPLAY '** PROGRAM        ** = POKUT064'.                   11020058
094900     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  11030058
095000     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  11040058
095100     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   11050058
095200     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  11060058
095300     MOVE +4013 TO PV-ABEND-CODE.                                 11070058
095400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         11080058
095500*                                                                 11090058
095600******************************************************************11100058
