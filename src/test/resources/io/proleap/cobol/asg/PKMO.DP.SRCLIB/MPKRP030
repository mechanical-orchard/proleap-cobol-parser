000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.             MPKRP030.                                00020000
000300 AUTHOR.                 VIRGENE LENNEMAN.                        00030000
000400 DATE-WRITTEN            9/8/1998.                                00040000
000500******************************************************************00050077
000600** THIS PROGRAM CREATES A REPORT EXCLUSIVELY FOR THE DC'S         00060077
000700**       - A "CENTRAL STOCK" RECEIPTS REPORT.                     00070077
000800** THIS PROGRAM WILL CREATE A WORKING STORAGE TABLE OF CS STORE   00080077
000900** NUMBERS. THE INPUT FILE IS SORTED PRIOR TO COMING INTO THIS    00090077
001000** PROGRAM. THE SORT SEQUENCE IS:                                 00100077
001100**      DATE VERIFIED, DIVISION, DEPARTMENT, REGION,              00110077
001200**      PO NBR, REC. SEQ. NBR, REC. SRC CDE, CLASS, STYLE,        00120077
001210**      LOWEST RETAIL AND STORE                                   00130077
001220** ONLY THOSE STORE NUMBERS THAT ARE CENTRAL STOCK LOCATIONS ARE  00140077
001230** PROCESSED; ALL OTHER RECORDS ARE BYPASSED.                     00150077
001240******************************************************************00160077
001250                                                                  00170077
001260 ENVIRONMENT DIVISION.                                            00180077
001270 CONFIGURATION SECTION.                                           00190077
001280 OBJECT-COMPUTER.            IBM-370.                             00200077
001290 SOURCE-COMPUTER.            IBM-370.                             00210077
001300 INPUT-OUTPUT SECTION.                                            00220077
001400 FILE-CONTROL.                                                    00230077
001500                                                                  00240077
001600     SELECT STORE-EXTRACT      ASSIGN TO UT-S-INP01.              00250077
001700     SELECT DAILY-RECEIPTS     ASSIGN TO UT-S-RPT01.              00260077
001800                                                                  00270077
001900 DATA DIVISION.                                                   00280077
002000 FILE SECTION.                                                    00290077
002100                                                                  00300077
002200 FD  STORE-EXTRACT                                                00310077
002300     RECORDING MODE IS F                                          00320077
002400     RECORD CONTAINS 300 CHARACTERS                               00330077
002500     BLOCK CONTAINS  0 RECORDS                                    00340077
002600     LABEL RECORDS ARE STANDARD.                                  00350077
002700                                                                  00360077
002800 01  STORE-EXTRACT-REC           PIC X(300).                      00370077
002900                                                                  00380077
003000 FD  DAILY-RECEIPTS                                               00390077
003100     RECORDING MODE IS F                                          00400077
003200     RECORD CONTAINS 133 CHARACTERS                               00410077
003300     BLOCK CONTAINS  0 RECORDS                                    00420077
003400     LABEL RECORDS ARE STANDARD.                                  00430077
003500                                                                  00440077
003600 01  DAILY-RECEIPTS-RPT          PIC X(133).                      00450077
003700                                                                  00460077
003800 WORKING-STORAGE SECTION.                                         00470077
003900 01  FILLER     PIC X(40) VALUE 'WORKING STORAGE STARTS HERE'.    00480077
004000*                                                                 00490077
004100********************** HOLD AREAS/SWITCHES ***********************00500077
004200*                                                                 00510077
004300 01  PS-PROGRAM-SWITCHES.                                         00520077
004400     05  PS-EOF-EXTRACT-FILE-IND    PIC X(01)        VALUE 'N'.   00530077
004500         88  PS-END-OF-EXTRACT-FILE                  VALUE 'Y'.   00540077
004600         88  PS-NOT-END-OF-EXTRACT-FILE              VALUE 'N'.   00550077
004700     05  PS-LOC-CSR-SW              PIC X(01)        VALUE 'N'.   00560077
004800         88  PS-EOF-LOC-CSR                          VALUE 'Y'.   00570077
004900     05  PS-DC-RECORD-SW            PIC X(01)        VALUE 'N'.   00580077
005000         88  PS-IS-A-DC-RECORD                       VALUE 'Y'.   00590077
005100         88  PS-IS-NOT-A-DC-RECORD                   VALUE 'N'.   00600077
005200     05  PS-FIRST-TIME-IND          PIC X(01)        VALUE 'Y'.   00610077
005300         88  PS-FIRST-TIME                           VALUE 'Y'.   00620077
005400         88  PS-NOT-FIRST-TIME                       VALUE 'N'.   00630077
005500     05  PS-DISCREPANCY-SW          PIC X(01)        VALUE 'N'.   00640077
005600         88  PS-DISCREPANCY-FOUND                    VALUE 'Y'.   00650077
005700                                                                  00660077
005800 01  PV-VARIABLES.                                                00670077
005900*----------------------------------------------------------------*00680077
006000* ADDED PROGRAM VARIABLES                             WR # 21361 *00690077
006100* PV-TEMP-KEY-SKU, PV-TEMP-GP-QTY & PV-TEMP-UNT-RTL-AMT.      *   00700077
006200*----------------------------------------------------------------*00710077
006300*    05  PV-TEMP-KEY-SKU             PIC 9(8).                    00720077
006400*    05  PV-TEMP-GP-QTY              PIC 9(9).                    00730077
006500*    05  PV-TEMP-UNT-RTL-AMT         PIC 9(7)V9(2).               00740077
006600*----------------------------------------------------------------*00750077
006700* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *00760077
006800*----------------------------------------------------------------*00770077
006900************************ SUBSCRIPTS ******************************00780077
007000     05  PV-STORE-SUB               PIC S9(4) COMP   VALUE +0.    00790077
007100     05  PV-SUB                     PIC S9(4) COMP   VALUE +0.    00800077
007200     05  PV-SUB1                    PIC S9(4) COMP   VALUE +0.    00810077
007300********************** REPORT COUNTERS ***************************00820077
007400*** PV-HOLD-STYLE IS REPLACED WITH PV-HOLD-SKU      WR # 21361 ***00830077
007500     05  PV-LINE-CNT                PIC S9(3) COMP-3 VALUE +56.   00840077
007600     05  PV-PAGE-CNT                PIC S9(5) COMP-3 VALUE +0.    00850077
007700     05  PV-HOLD-STORE              PIC S9(04) COMP VALUE 0.      00860077
007800     05  PV-HOLD-STORE2             PIC S9(04) COMP VALUE 0.      00870077
007900                                                                  00880077
008000     05  PV-CC                      PIC 9    VALUE 1.             00890077
008100     05  PV-DATE                             VALUE LOW-VALUES.    00900077
008200         10  PV-MM                  PIC XX.                       00910077
008300         10  PV-DD                  PIC XX.                       00920077
008400         10  PV-YY                  PIC XX.                       00930077
008500     05  PV-TIME.                                                 00940077
008600         10  PV-TIME-HH             PIC 99   VALUE ZEROS.         00950077
008700         10  PV-TIME-MM             PIC 99   VALUE ZEROS.         00960077
008800         10  FILLER                 PIC 9(4) VALUE ZEROS.         00970077
008900     05  PV-CURRENT-DATE.                                         00980077
009000         10  PV-CURR-YY             PIC 9(2)    VALUE ZEROS.      00990077
009100         10  PV-CURR-MM             PIC 9(2)    VALUE ZEROS.      01000077
009200         10  PV-CURR-DD             PIC 9(2)    VALUE ZEROS.      01010077
009300     05  PV-COMPARE-DATE.                                         01020077
009400         10  PV-CD-DT-CC            PIC 9(2)    VALUE ZEROS.      01030077
009500         10  PV-CD-DT-YY            PIC 9(2)    VALUE ZEROS.      01040077
009600         10  PV-CD-DT-MM            PIC 9(2)    VALUE ZEROS.      01050077
009700         10  PV-CD-DT-DD            PIC 9(2)    VALUE ZEROS.      01060077
009800     05  PV-DATE-VERIFIED.                                        01070077
009900         10  PV-DV-DT-CC            PIC 9(2)    VALUE ZEROS.      01080077
010000         10  PV-DV-DT-YY            PIC 9(2)    VALUE ZEROS.      01090077
010100         10  PV-DV-DT-MM            PIC 9(2)    VALUE ZEROS.      01100077
010200         10  PV-DV-DT-DD            PIC 9(2)    VALUE ZEROS.      01110077
010300     05  PV-HOLD-CLASS.                                           01120077
010400         10  PV-CLASS               PIC X(03)   VALUE SPACES.     01130077
010500     05  PV-HOLD-CLASS-RDF REDEFINES PV-HOLD-CLASS.               01140077
010600         10  PV-CLASS-RDF           PIC X(02).                    01150077
010700         10  FILLER                 PIC X(01).                    01160077
010800     05  PV-HOLD-SKU                PIC X(08)   VALUE SPACES.     01170077
010900     05  PV-HOLD-DEPT               PIC X(03)   VALUE SPACES.     01180077
011000     05  PV-HOLD-REC-SRC-CDE        PIC X(01)   VALUE SPACES.     01190077
011100     05  PV-HOLD-SEQ-NBR            PIC 9(09)   VALUE ZEROS.      01200077
011200*    05  PV-RTL-AMT                 PIC S9(7)V99 VALUE +0 COMP-3. 01210077
011300*    05  PV-SKU-RTL-AMT             PIC S9(7)V99 VALUE +0 COMP-3. 01220077
011400     05  PV-HOLD-UNIT-RETAIL        PIC S9(6)V99 VALUE +0.        01230077
011500     05  PV-HOLD-UNIT-OPEN-TOTAL    PIC S9(6)V99 VALUE +0.        01240077
011600     05  PV-HOLD-UNIT-MARKED-TOTAL  PIC S9(6)V99 VALUE +0.        01250077
011700     05  PV-WORK-RECSEQ-NBR.                                      01260077
011800         10  PV-WORK-FILLER         PIC X(05)  VALUE SPACES.      01270077
011900         10  PV-WORK-REC-SEQ-NBR    PIC X(04)  VALUE SPACES.      01280077
012000     05  PV-SELECT-COUNTER          PIC S9(04) VALUE +0 COMP SYNC.01290077
012100     05  PV-MAX-RETRIES             PIC S9(04) VALUE +3 COMP SYNC.01300077
012200     05  PV-OPEN-FORMAT.                                          01310077
012300         10  PV-DTL-FORMAT-OPEN     PIC ZZZZ,ZZ9-.                01320077
012400     05  PV-ADJ-OPEN-FORMAT.                                      01330077
012500         10  PV-ADJ-FORMAT-OPEN     PIC ZZZZ,ZZZ-.                01340077
012600     05  PV-PARAGRAPH-NAME          PIC  X(30)   VALUE SPACE.     01350077
012700     05  PV-DB2-OPER-ATTEMPTED      PIC  X(30)   VALUE SPACE.     01360077
012800     05  PV-SQLCODE                 PIC  Z(08)9- VALUE ZEROS.     01370077
012900     05  PV-DB2-TABLE-NAME          PIC  X(12)   VALUE SPACE.     01380077
013000*                                                                 01390077
013100 01  ABEND-CODE                  PIC S9(04) VALUE +0 COMP SYNC.   01400077
013200     88  ABEND-4013-DB2-ERROR                   VALUE +4013.      01410077
013300*                                                                 01420077
013400*********************** STORE TOTALS TABLE ***********************01430077
013500*                                                                 01440077
013600 01  ST-STORE-TOTALS-TABLE.                                       01450077
013700     05  ST-STORE-TOTALS    OCCURS 5000 TIMES.                    01460077
013800         10  ST-STORE            PIC S9(04) COMP.                 01470077
013900         10  ST-STORE-OPEN-QTY   PIC S9(8).                       01480077
014000         10  ST-STORE-MARKED-QTY PIC S9(8).                       01490077
014100         10  ST-STORE-RECVD-QTY  PIC S9(8).                       01500077
014200         10  ST-STORE-ORDER-QTY  PIC S9(8).                       01510077
014300                                                                  01520077
014400 01  DC-TABLE-STRUCTURE.                                          01530077
014500     05  DC-TABLE        OCCURS 50 TIMES                          01540078
014600                         INDEXED BY DC-IDX.                       01550077
014700         10 STR-NMBR                  PIC  S9(04) COMP.           01560077
014800*                                                                 01570077
014900****************** STORE EXTRACT WORK RECORD *********************01580077
015000*                                                                 01590077
015100     COPY STOREEXT.                                               01600077
015200*                                                                 01610077
015300** COPYBOOK FOR LOGISTICS DOMAIN ITEM ACCESS MODULE  WR # 21361 **01620077
015400*                                                                 01630077
015500*    COPY XLWS001.                                                01640077
015600*                                                                 01650077
015700************************ HEADER/DETIAL LINES *********************01660077
015800*                                                                 01670077
015900 01  WS-HEADER1.                                                  01680077
016000     05  FILLER              PIC X(44)       VALUE SPACES.        01690077
016100     05  FILLER              PIC X(44)       VALUE                01700077
016200     'K O H L S  D E P A R T M E N T  S T O R E S'.               01710077
016300     05  FILLER              PIC X(25)       VALUE SPACES.        01720077
016400     05  FILLER              PIC X(19)       VALUE                01730077
016500     'REPORT: MPKRP030-01'.                                       01740077
016600                                                                  01750077
016700 01  WS-HEADER2.                                                  01760077
016800     05  FILLER              PIC X(10)       VALUE                01770077
016900         ' DIVISION-'.                                            01780077
017000     05  WS-HDR2-DIVISION    PIC XXX         VALUE SPACES.        01790077
017100     05  FILLER              PIC X(20)       VALUE SPACES.        01800077
017200     05  FILLER              PIC X(45)       VALUE                01810077
017300     'M E R C H A N D I S E     P R O C E S S I N G'.             01820077
017400     05  FILLER              PIC X(16)       VALUE                01830077
017500     '     S Y S T E M'.                                          01840077
017600     05  FILLER              PIC X(24)       VALUE SPACES.        01850077
017700     05  FILLER              PIC X(8)        VALUE                01860077
017800     'PAGE    '.                                                  01870077
017900     05  WS-HDR2-PAGE        PIC ZZ,ZZ9      VALUE ZEROS.         01880077
018000                                                                  01890077
018100 01  WS-HEADER3.                                                  01900077
018200     05  FILLER              PIC X(98)       VALUE SPACES.        01910077
018300     05  FILLER              PIC X(16)       VALUE                01920077
018400     'RUN DATE/TIME   '.                                          01930077
018500     05  WS-HDR3-RUN-DATE-MM PIC 99          VALUE ZEROS.         01940077
018600     05  FILLER              PIC X           VALUE '/'.           01950077
018700     05  WS-HDR3-RUN-DATE-DD PIC 99          VALUE ZEROS.         01960077
018800     05  FILLER              PIC X           VALUE '/'.           01970077
018900     05  WS-HDR3-RUN-DATE-YY PIC 99          VALUE ZEROS.         01980077
019000     05  FILLER              PIC X(5)        VALUE SPACES.        01990077
019100     05  WS-HDR3-RUN-TIME-HH PIC 99          VALUE ZEROS.         02000077
019200     05  FILLER              PIC X           VALUE ':'.           02010077
019300     05  WS-HDR3-RUN-TIME-MM PIC 99          VALUE ZEROS.         02020077
019400                                                                  02030077
019500 01  WS-HEADER4.                                                  02040077
019600     05  FILLER              PIC X(12)       VALUE                02050077
019700     ' DEPARTMENT-'.                                              02060077
019800     05  WS-HDR4-DEPARTMENT  PIC XXX         VALUE SPACES.        02070077
019900     05  FILLER              PIC X(40)       VALUE SPACES.        02080077
020000     05  FILLER              PIC X(82)       VALUE                02090077
020100     'CENTRAL STOCK RECEIPTS REPORT '.                            02100077
020200                                                                  02110077
020300 01  WS-HEADER5.                                                  02120077
020400     05  FILLER              PIC X(57)       VALUE SPACES.        02130077
020500     05  FILLER              PIC X(75)       VALUE                02140077
020600     '(VERIFIED COUNT)'.                                          02150077
020700                                                                  02160077
020800 01  WS-HEADER6.                                                  02170077
020900     05  FILLER              PIC X(8)        VALUE                02180077
021000     ' REGION-'.                                                  02190077
021100     05  WS-HDR6-REGION      PIC XX          VALUE SPACES.        02200077
021200     05  FILLER              PIC X(51)       VALUE SPACES.        02210077
021300     05  WS-HDR6-MM          PIC XX          VALUE SPACES.        02220077
021400     05  FILLER              PIC X           VALUE '/'.           02230077
021500     05  WS-HDR6-DD          PIC XX          VALUE SPACES.        02240077
021600     05  FILLER              PIC X           VALUE '/'.           02250077
021700     05  WS-HDR6-YY          PIC XX          VALUE SPACES.        02260077
021800     05  FILLER              PIC X(63)       VALUE SPACES.        02270077
021900                                                                  02280077
022000 01  WS-HEADER7.                                                  02290077
022100     05  FILLER              PIC X(35)       VALUE                02300077
022200     'DPT CL SKU NUMBER        '.                                 02310077
022300     05  FILLER              PIC X(25)       VALUE                02320077
022400     'ST      RETAIL QTY.'.                                       02330077
022500     05  FILLER              PIC X(25)       VALUE                02340077
022600     'ST      RETAIL QTY.'.                                       02350077
022700     05  FILLER              PIC X(25)       VALUE                02360077
022800     'ST      RETAIL QTY.'.                                       02370077
022900     05  FILLER              PIC X(23)       VALUE                02380077
023000     'ST      RETAIL QTY.'.                                       02390077
023100                                                                  02400077
023200 01  WS-HEADER8.                                                  02410077
023300     05  FILLER              PIC X(24)       VALUE SPACES.        02420077
023400     05  FILLER              PIC X(18)       VALUE                02430077
023500     'RETAIL'.                                                    02440077
023600     05  FILLER              PIC X(25)       VALUE                02450077
023700     'OPEN   MARKED'.                                             02460077
023800     05  FILLER              PIC X(25)       VALUE                02470077
023900     'OPEN   MARKED'.                                             02480077
024000     05  FILLER              PIC X(25)       VALUE                02490077
024100     'OPEN   MARKED'.                                             02500077
024200     05  FILLER              PIC X(17)       VALUE                02510077
024300     'OPEN   MARKED'.                                             02520077
024400                                                                  02530077
024500 01  WS-HEADER9.                                                  02540077
024600     05  FILLER              PIC X(12)       VALUE                02550077
024700     ' PO-SEQ# - '.                                               02560077
024800     05  WS-HDR9-PO-NO       PIC X(8)        VALUE SPACES.        02570077
024900     05  FILLER              PIC X(03)       VALUE                02580077
025000     ' - '.                                                       02590077
025100     05  WS-HDR9-RECSEQ-NBR  PIC X(04)       VALUE SPACES.        02600077
025200     05  FILLER              PIC X(11)       VALUE                02610077
025300     ' VENDOR# - '.                                               02620077
025400     05  WS-HDR9-VENDOR-NO   PIC XXX         VALUE SPACES.        02630077
025500     05  FILLER              PIC X(15)       VALUE                02640077
025600     ' VENDOR NAME - '.                                           02650077
025700     05  WS-HDR9-VENDOR-NAME PIC X(25)       VALUE SPACES.        02660077
025800     05  FILLER              PIC X(22)       VALUE                02670077
025900     ' RECEIVING LOCATION - '.                                    02680077
026000     05  WS-HDR9-REC-LOC     PIC X(30)       VALUE SPACES.        02690077
026100                                                                  02700077
026200 01  WS-HEADER9-ADJ.                                              02710077
026300     05  FILLER              PIC X(27)       VALUE                02720077
026400     ' ******* ADJUSTMENT *******'.                               02730077
026500                                                                  02740077
026600 01  WS-HEADER10.                                                 02750077
026700     05  FILLER              PIC X(3)        VALUE SPACES.        02760077
026800     05  WS-HDR10-FILLER     PIC X(14)       VALUE SPACES.        02770077
026900     05  FILLER              PIC X           VALUE SPACES.        02780077
027000     05  WS-HDR10-TOTAL      PIC ZZZ,ZZ9-    VALUE ZEROS.         02790077
027100     05  FILLER              PIC X(101)      VALUE SPACES.        02800077
027200                                                                  02810077
027300*** WS-DTL-STYLE IS REPLACED WITH WS-DTL-SKU        WR # 21361 ***02820077
027400 01  WS-DETAIL.                                                   02830077
027500     05  WS-DTL-DEPT         PIC XXX         VALUE SPACES.        02840077
027600     05  WS-DTL-SPACE1       PIC X           VALUE SPACES.        02850077
027700     05  WS-DTL-CLASS        PIC XX          VALUE SPACES.        02860077
027800     05  WS-DTL-SPACE2       PIC X           VALUE SPACES.        02870077
027900     05  WS-DTL-SKU          PIC X(8)        VALUE SPACES.        02880077
028000     05  FILLER              PIC XX          VALUE SPACES.        02890077
028100     05  WS-DTL-UNIT-RETAIL  PIC ZZZZ,ZZZ.99- VALUE ZEROS.        02900077
028200     05  WS-DTL-STORE-TOTALS     OCCURS 4 TIMES.                  02910077
028300         10  FILLER          PIC X(4).                            02920077
028400         10  WS-DTL-STORE    PIC 9(4).                            02930077
028500         10  WS-DTL-RETAIL-OPEN                                   02940077
028600                             PIC X(9).                            02950077
028700         10  WS-DTL-RETAIL-MARKED                                 02960077
028800                             PIC ZZZZ,ZZ9-.                       02970077
028900     05  FILLER              PIC X(4).                            02980077
029000                                                                  02990077
029100*01  PV-RETAIL-DISCREP.                                           03000077
029200*    05  FILLER              PIC X(43)       VALUE                03010077
029300*        '**  **  **  VERIFIED RETAIL DOES NOT MATCH'.            03020077
029400*    05  FILLER              PIC X(34)       VALUE                03030077
029500*        'CURRENT RETAIL FOR SKU  **  **  **'.                    03040077
029600*    05  FILLER              PIC X(6)        VALUE SPACES.        03050077
029700*    05  FILLER              PIC X(18)       VALUE                03060077
029800*        'RETAIL FOR SKU IS '.                                    03070077
029900*    05  PV-SKU-RETAIL       PIC ZZZZ,ZZ9.99-.                    03080077
030000                                                                  03090077
030100 01  PR-PRINT-FINAL.                                              03100077
030200     05  FILLER                      PIC X(53)  VALUE SPACES.     03110077
030300     05  FILLER                      PIC X(21)  VALUE             03120077
030400         '*** END OF REPORT ***'.                                 03130077
030500                                                                  03140077
030600 01  PR-PRINT-NO-INPUT.                                           03150077
030700     05  FILLER                      PIC X(35)  VALUE SPACES.     03160077
030800     05  FILLER                      PIC X(40)  VALUE             03170077
030900         '*** NO INPUT RECORDS TO BE PROCESSED ***'.              03180077
031000*                                                                 03190077
031100***********  WORKAREA FOR DPKUT500  ******************************03200077
031200*                                                                 03210077
031300     COPY DPWS500.                                                03220077
031400                                                                  03230077
031500*    DOMAIN LOCATION MODULE                                       03240077
031600     COPY XLWS071.                                                03250077
031700*                                                                 03260077
031800*                                                                 03270077
031900*    DOMAIN LOCATION TABLE                                        03280077
032000*                                                                 03290077
032100     EXEC SQL                                                     03300077
032200         INCLUDE XLT00010                                         03310077
032300     END-EXEC.                                                    03320077
032400*                                                                 03330077
032500*                                                                 03340077
032600*  DCLGEN FOR THE DB2 FACILITY TABLE                              03350077
032700*                                                                 03360077
032800*  COMMUNICATION AREAS FOR DB2                                    03370077
032900*                                                                 03380077
033000     EXEC SQL                                                     03390077
033100         INCLUDE SQLCA                                            03400077
033200     END-EXEC.                                                    03410077
033300                                                                  03420077
033400******************************************************************03430077
033500*  LOCATION MASTER CURSOR                                         03440077
033600******************************************************************03450077
033700     EXEC SQL                                                     03460077
033800          DECLARE LOC-CSR CURSOR FOR                              03470077
033900           SELECT LOC_NBR                                         03480077
034000           FROM   XLT_LOC                                         03490077
034100          WHERE LOC_TYP_CDE = 'CS'                                03500077
034200     END-EXEC.                                                    03510077
034300*                                                                 03520077
034400*  DB2 COMMUNICATION AREA 2                                       03530077
034500*                                                                 03540077
034600     COPY SQLCA2.                                                 03550077
034700                                                                  03560077
034800*                                                                 03570077
034900*  DB2 SQL ERROR ROUTINE                                          03580077
035000*                                                                 03590077
035100     COPY DPWS004.                                                03600077
035200                                                                  03610077
035300                                                                  03620077
035400 PROCEDURE DIVISION.                                              03630077
035500 0000-MAINLINE.                                                   03640077
035600     PERFORM 0100-INITIALIZATION.                                 03650077
035700     PERFORM 0150-GET-DATA                                        03660077
035800            UNTIL PS-END-OF-EXTRACT-FILE.                         03670077
035900                                                                  03680077
036000     PERFORM 0500-PRINT-FINAL                                     03690077
036100                                                                  03700077
036200     CLOSE DAILY-RECEIPTS                                         03710077
036300           STORE-EXTRACT.                                         03720077
036400     STOP RUN.                                                    03730077
036500                                                                  03740077
036600 0100-INITIALIZATION.                                             03750077
036700     OPEN INPUT STORE-EXTRACT                                     03760077
036800          OUTPUT DAILY-RECEIPTS.                                  03770077
036900     ACCEPT PV-CURRENT-DATE FROM DATE.                            03780077
037000     MOVE PV-CURR-MM TO WS-HDR3-RUN-DATE-MM.                      03790077
037100     MOVE PV-CURR-DD TO WS-HDR3-RUN-DATE-DD.                      03800077
037200     MOVE PV-CURR-YY TO WS-HDR3-RUN-DATE-YY.                      03810077
037300     ACCEPT PV-TIME         FROM TIME.                            03820077
037400     MOVE PV-TIME-HH TO WS-HDR3-RUN-TIME-HH.                      03830077
037500     MOVE PV-TIME-MM TO WS-HDR3-RUN-TIME-MM.                      03840077
037600     INITIALIZE ST-STORE-TOTALS-TABLE                             03850077
037700                DC-TABLE-STRUCTURE.                               03860077
037800     PERFORM 1000-CREATE-DC-TABLE.                                03870077
037900                                                                  03880077
038000 0150-GET-DATA.                                                   03890077
038100     READ STORE-EXTRACT                                           03900077
038200         INTO STORE-EXTRACT-LINE                                  03910077
038300             AT END SET PS-END-OF-EXTRACT-FILE TO TRUE.           03920077
038400                                                                  03930077
038500     IF PS-FIRST-TIME AND                                         03940077
038600         PS-END-OF-EXTRACT-FILE                                   03950077
038700         PERFORM 0550-PRINT-NO-INPUT                              03960077
038800     ELSE                                                         03970077
038900         IF PS-NOT-END-OF-EXTRACT-FILE                            03980077
039000             IF SE-LOC-NBR = PV-HOLD-STORE                        03990077
039100                 CONTINUE                                         04000077
039200             ELSE                                                 04010077
039300                 MOVE SE-LOC-NBR TO PV-HOLD-STORE                 04020077
039400                 SET DC-IDX TO +1                                 04030077
039500                 PERFORM 3000-SEARCH-STORE-TABLE                  04040077
039600             END-IF                                               04050077
039700             IF PS-IS-A-DC-RECORD                                 04060077
039800                 PERFORM 0200-PROCESS-DATA                        04070077
039900             END-IF                                               04080077
040000         ELSE                                                     04090077
040100             PERFORM 0300-PRT-DETAIL-LINE THRU                    04100077
040200                     0300-EXIT-PRT-DETAIL-LINE                    04110077
040300         END-IF                                                   04120077
040400     END-IF.                                                      04130077
040500                                                                  04140077
040600 0200-PROCESS-DATA.                                               04150077
040700     IF PS-FIRST-TIME                                             04160077
040800         SET PS-NOT-FIRST-TIME TO TRUE                            04170077
040900         PERFORM 0210-BASIC-INFO                                  04180077
041000     END-IF                                                       04190077
041100                                                                  04200077
041200** PV-DATE-VERIFIED CONTAINS REFORMATTED SE-DATE-VERIFIED-COUNT   04210077
041300**      WITH CENTURY ADDED                                        04220077
041400** PV-COMPARE-DATE CONTAINS THE PREVIOUS REFORMATED               04230077
041500**      SE-DATE-VERIFIED-COUNT WITH CENTURY ADDED                 04240077
041600     IF PV-DATE-VERIFIED NOT = PV-COMPARE-DATE                    04250077
041700         PERFORM 0300-PRT-DETAIL-LINE THRU                        04260077
041800                 0300-EXIT-PRT-DETAIL-LINE                        04270077
041900         MOVE +0 TO PV-PAGE-CNT                                   04280077
042000         PERFORM 0210-BASIC-INFO                                  04290077
042100     END-IF.                                                      04300077
042200                                                                  04310077
042300     IF SE-DIVISION-SEQNO NOT = WS-HDR2-DIVISION OR               04320077
042400        SE-DEPT NOT = PV-HOLD-DEPT OR                             04330077
042500        SE-REGION NOT = WS-HDR6-REGION OR                         04340077
042600        SE-PO NOT = WS-HDR9-PO-NO OR                              04350077
042700        SE-REC-SEQ-NBR NOT = PV-HOLD-SEQ-NBR OR                   04360077
042800        SE-REC-SRC-CDE NOT = PV-HOLD-REC-SRC-CDE                  04370077
042900         PERFORM 0300-PRT-DETAIL-LINE THRU                        04380077
043000                 0300-EXIT-PRT-DETAIL-LINE                        04390077
043100         PERFORM 0350-SET-UP-HEADINGS                             04400077
043200         PERFORM 0400-PRINT-HEADINGS                              04410077
043300     END-IF.                                                      04420077
043400                                                                  04430077
043500     IF SE-CLASS NOT = PV-HOLD-CLASS OR                           04440077
043600        SE-SKU-NBR NOT = PV-HOLD-SKU   OR                         04450077
043700        SE-LOWEST-RETAIL NOT = PV-HOLD-UNIT-RETAIL                04460077
043800         PERFORM 0300-PRT-DETAIL-LINE THRU                        04470077
043900                 0300-EXIT-PRT-DETAIL-LINE                        04480077
044000     END-IF.                                                      04490077
044100                                                                  04500077
044200     IF SE-LOC-NBR NOT = PV-HOLD-STORE2                           04510077
044300         IF PV-STORE-SUB NOT = 0                                  04520077
044400             COMPUTE ST-STORE-OPEN-QTY (PV-STORE-SUB) =           04530077
044500               +  ST-STORE-ORDER-QTY (PV-STORE-SUB)               04540077
044600               -  ST-STORE-RECVD-QTY (PV-STORE-SUB)               04550077
044700               +  ST-STORE-MARKED-QTY (PV-STORE-SUB)              04560077
044800             ADD +1 TO PV-STORE-SUB                               04570077
044900             MOVE SE-LOC-NBR TO PV-HOLD-STORE2,                   04580077
045000                              ST-STORE (PV-STORE-SUB)             04590077
045100             MOVE SE-RETAIL-UNITS-ORDER TO ST-STORE-ORDER-QTY     04600077
045200                                             (PV-STORE-SUB)       04610077
045300             MOVE SE-RETAIL-UNITS-RECVD TO ST-STORE-RECVD-QTY     04620077
045400                                             (PV-STORE-SUB)       04630077
045500         ELSE                                                     04640077
045600             ADD +1 TO PV-STORE-SUB                               04650077
045700             MOVE SE-LOC-NBR TO PV-HOLD-STORE2,                   04660077
045800                              ST-STORE (PV-STORE-SUB)             04670077
045900             MOVE SE-RETAIL-UNITS-ORDER TO ST-STORE-ORDER-QTY     04680077
046000                                             (PV-STORE-SUB)       04690077
046100             MOVE SE-RETAIL-UNITS-RECVD TO ST-STORE-RECVD-QTY     04700077
046200                                             (PV-STORE-SUB)       04710077
046300     END-IF.                                                      04720077
046400     COMPUTE ST-STORE-MARKED-QTY (PV-STORE-SUB) =                 04730077
046500          ST-STORE-MARKED-QTY (PV-STORE-SUB)                      04740077
046600       +  SE-RETAIL-UNITS-MARK.                                   04750077
046700                                                                  04760077
046800 0210-BASIC-INFO.                                                 04770077
046900         INITIALIZE PV-DATE-VERIFIED                              04780077
047000         MOVE SE-DATE-VERIFIED-COUNT TO PV-DATE                   04790077
047100         MOVE PV-MM TO WS-HDR6-MM                                 04800077
047200                       PV-DV-DT-MM                                04810077
047300         MOVE PV-DD TO WS-HDR6-DD                                 04820077
047400                       PV-DV-DT-DD                                04830077
047500         MOVE PV-YY TO WS-HDR6-YY                                 04840077
047600                       PV-DV-DT-YY                                04850077
047700         PERFORM 0220-GET-CENTURY                                 04860077
047800         MOVE SE-CLASS TO PV-HOLD-CLASS                           04870077
047900         MOVE SE-SKU-NBR TO PV-HOLD-SKU                           04880077
048000         MOVE SE-REC-SRC-CDE TO PV-HOLD-REC-SRC-CDE               04890077
048100         MOVE SE-REC-SEQ-NBR TO PV-HOLD-SEQ-NBR                   04900077
048200         MOVE SE-LOWEST-RETAIL TO PV-HOLD-UNIT-RETAIL             04910077
048300******    WR # 27201 - START                                      04920077
048400*                                 PV-RTL-AMT                      04930077
048500******    WR # 27201 - END                                        04940077
048600         MOVE ZEROS TO PV-HOLD-UNIT-OPEN-TOTAL                    04950077
048700                       PV-HOLD-UNIT-MARKED-TOTAL                  04960077
048800         PERFORM 0350-SET-UP-HEADINGS                             04970077
048900         PERFORM 0400-PRINT-HEADINGS.                             04980077
049000                                                                  04990077
049100 0220-GET-CENTURY.                                                05000077
049200     INITIALIZE                                                   05010077
049300         DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.                05020077
049400     SET DPG51-ACTUAL-CALENDAR-ONLY                               05030077
049500         DPG51-DO-NOT-INCR-DECR-DATE                              05040077
049600         DPG52-LK-DTE-GREG           TO TRUE.                     05050077
049700     MOVE SE-DATE-VERIFIED-COUNT TO DPG52-LK-DATE-INPUT.          05060077
049800     CALL DP500-KOHLS-CALENDAR-ROUTINE USING                      05070077
049900         DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.                05080077
050000     IF DPG54-NO-ERROR                                            05090077
050100         MOVE DPG55-DB2-ISO-DATE TO PV-DATE-VERIFIED              05100077
050200     END-IF.                                                      05110077
050300                                                                  05120077
050400     INITIALIZE                                                   05130077
050500         DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.                05140077
050600     SET DPG51-ACTUAL-CALENDAR-ONLY                               05150077
050700         DPG51-DO-NOT-INCR-DECR-DATE                              05160077
050800         DPG52-LK-DTE-GREG           TO TRUE.                     05170077
050900     MOVE PV-DATE                TO DPG52-LK-DATE-INPUT.          05180077
051000     CALL DP500-KOHLS-CALENDAR-ROUTINE USING                      05190077
051100         DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.                05200077
051200     IF DPG54-NO-ERROR                                            05210077
051300         MOVE DPG55-DB2-ISO-DATE TO PV-COMPARE-DATE               05220077
051400     END-IF.                                                      05230077
051500                                                                  05240077
051600 0300-PRT-DETAIL-LINE.                                            05250077
051700     COMPUTE ST-STORE-OPEN-QTY (PV-STORE-SUB) =                   05260077
051800       +  ST-STORE-ORDER-QTY (PV-STORE-SUB)                       05270077
051900       -  ST-STORE-RECVD-QTY (PV-STORE-SUB)                       05280077
052000       +  ST-STORE-MARKED-QTY (PV-STORE-SUB).                     05290077
052100     MOVE PV-HOLD-DEPT TO WS-DTL-DEPT.                            05300077
052200     MOVE PV-HOLD-CLASS TO WS-DTL-CLASS.                          05310077
052300     MOVE PV-HOLD-SKU   TO WS-DTL-SKU.                            05320077
052400     IF WS-HDR6-REGION = '03'                                     05330077
052500     MOVE PV-HOLD-UNIT-RETAIL TO WS-DTL-UNIT-RETAIL.              05340077
052600     MOVE 2 TO PV-CC.                                             05350077
052700     MOVE +1 TO PV-SUB, PV-SUB1.                                  05360077
052800                                                                  05370077
052900 0300-MOVE-STORE-TABLE.                                           05380077
053000     MOVE ST-STORE (PV-SUB) TO WS-DTL-STORE (PV-SUB1).            05390077
053100     IF  PV-HOLD-REC-SRC-CDE = 'A'                                05400077
053200         MOVE ZERO TO PV-ADJ-FORMAT-OPEN                          05410077
053300         MOVE PV-ADJ-OPEN-FORMAT TO WS-DTL-RETAIL-OPEN (PV-SUB1)  05420077
053400     ELSE                                                         05430077
053500         MOVE ST-STORE-OPEN-QTY (PV-SUB) TO PV-DTL-FORMAT-OPEN    05440077
053600         MOVE PV-OPEN-FORMAT TO WS-DTL-RETAIL-OPEN (PV-SUB1)      05450077
053700     END-IF.                                                      05460077
053800     MOVE ST-STORE-MARKED-QTY (PV-SUB) TO                         05470077
053900                                WS-DTL-RETAIL-MARKED (PV-SUB1).   05480077
054000     ADD ST-STORE-OPEN-QTY (PV-SUB) TO PV-HOLD-UNIT-OPEN-TOTAL.   05490077
054100     ADD ST-STORE-MARKED-QTY (PV-SUB) TO                          05500077
054200                                PV-HOLD-UNIT-MARKED-TOTAL.        05510077
054300     IF PV-LINE-CNT > 55                                          05520077
054400         PERFORM 0400-PRINT-HEADINGS                              05530077
054500     END-IF.                                                      05540077
054600                                                                  05550077
054700     IF PV-SUB1 = 4 OR                                            05560077
054800        PV-SUB = PV-STORE-SUB                                     05570077
054900         WRITE DAILY-RECEIPTS-RPT FROM WS-DETAIL AFTER PV-CC      05580077
055000         ADD PV-CC TO PV-LINE-CNT                                 05590077
055100         MOVE 1 TO PV-CC                                          05600077
055200         MOVE +0 TO PV-SUB1                                       05610077
055300         MOVE SPACES TO WS-DETAIL                                 05620077
055400     END-IF.                                                      05630077
055500                                                                  05640077
055600     IF PV-SUB = PV-STORE-SUB                                     05650077
055700         PERFORM 0320-PRINT-TOTAL-UNITS                           05660077
055800     ELSE                                                         05670077
055900         ADD +1 TO PV-SUB, PV-SUB1                                05680077
056000         GO TO 0300-MOVE-STORE-TABLE                              05690077
056100     END-IF.                                                      05700077
056200                                                                  05710077
056300     MOVE +0 TO PV-STORE-SUB.                                     05720077
056400     MOVE ZEROS TO PV-HOLD-UNIT-OPEN-TOTAL                        05730077
056500                   PV-HOLD-UNIT-MARKED-TOTAL.                     05740077
056600     MOVE SE-CLASS TO PV-HOLD-CLASS.                              05750077
056700     MOVE SE-SKU-NBR TO PV-HOLD-SKU.                              05760077
056800     MOVE SE-LOWEST-RETAIL TO PV-HOLD-UNIT-RETAIL                 05770077
056900******    WR # 27201 - START                                      05780077
057000*                             PV-RTL-AMT.                         05790077
057100******    WR # 27201 - END                                        05800077
057200     MOVE ZEROS TO ST-STORE-TOTALS-TABLE.                         05810077
057300     MOVE 100 TO PV-HOLD-STORE2.                                  05820077
057400 0300-EXIT-PRT-DETAIL-LINE.                                       05830077
057500     EXIT.                                                        05840077
057600                                                                  05850077
057700 0320-PRINT-TOTAL-UNITS.                                          05860077
057800      IF PV-STORE-SUB = 1                                         05870077
057900          CONTINUE                                                05880077
058000      ELSE                                                        05890077
058100          IF PV-HOLD-REC-SRC-CDE = 'A'                            05900077
058200              MOVE 'TOTAL ADJUST :' TO WS-HDR10-FILLER            05910077
058300              MOVE PV-HOLD-UNIT-MARKED-TOTAL TO WS-HDR10-TOTAL    05920077
058400              WRITE DAILY-RECEIPTS-RPT FROM WS-HEADER10           05930077
058500          ELSE                                                    05940077
058600              MOVE '  TOTAL OPEN :' TO WS-HDR10-FILLER            05950077
058700              MOVE PV-HOLD-UNIT-OPEN-TOTAL TO WS-HDR10-TOTAL      05960077
058800              WRITE DAILY-RECEIPTS-RPT FROM WS-HEADER10           05970077
058900              MOVE 'TOTAL MARKED :' TO WS-HDR10-FILLER            05980077
059000              MOVE PV-HOLD-UNIT-MARKED-TOTAL TO WS-HDR10-TOTAL    05990077
059100              WRITE DAILY-RECEIPTS-RPT FROM WS-HEADER10           06000077
059200          END-IF                                                  06010077
059300          MOVE SPACES TO DAILY-RECEIPTS-RPT                       06020077
059400          WRITE DAILY-RECEIPTS-RPT AFTER 2                        06030077
059500          ADD 4 TO PV-LINE-CNT                                    06040077
059600******    WR # 27201 - START                                      06050077
059700*         PERFORM 0600-CALL-XLKUT-DOMAIN-PGM                      06060077
059800*         IF PS-DISCREPANCY-FOUND                                 06070077
059900*             WRITE DAILY-RECEIPTS-RPT FROM PV-RETAIL-DISCREP     06080077
060000*                             AFTER 2                             06090077
060100*             MOVE SPACES TO DAILY-RECEIPTS-RPT                   06100077
060200*             WRITE DAILY-RECEIPTS-RPT AFTER 2                    06110077
060300*             ADD 4 TO PV-LINE-CNT                                06120077
060400*         END-IF                                                  06130077
060500******    WR # 27201 - END                                        06140077
060600      END-IF.                                                     06150077
060700                                                                  06160077
060800 0350-SET-UP-HEADINGS.                                            06170077
060900     MOVE SE-DIVISION-SEQNO TO WS-HDR2-DIVISION.                  06180077
061000     MOVE SE-DEPT TO PV-HOLD-DEPT                                 06190077
061100                     WS-HDR4-DEPARTMENT.                          06200077
061200     MOVE SE-REGION TO WS-HDR6-REGION.                            06210077
061300     MOVE SE-PO TO WS-HDR9-PO-NO.                                 06220077
061400     MOVE SE-REC-SEQ-NBR TO PV-WORK-RECSEQ-NBR.                   06230077
061500     MOVE PV-WORK-REC-SEQ-NBR TO WS-HDR9-RECSEQ-NBR.              06240077
061600     MOVE SE-VENDOR-NO-INHOUSE TO WS-HDR9-VENDOR-NO.              06250077
061700     MOVE SE-VENDOR-NAME-INHOUSE TO WS-HDR9-VENDOR-NAME.          06260077
061800                                                                  06270077
061900     EVALUATE TRUE                                                06280077
062000         WHEN SE-RECEIVING-LOCATION = 'DS'                        06290077
062100             MOVE 'DIRECT SHIP       '   TO WS-HDR9-REC-LOC       06300077
062200         WHEN OTHER                                               06310077
062300             INITIALIZE XL071-COMMAREA-REC                        06320077
062400             MOVE SE-OPER-UNT-ID         TO XL071-LOCATION-NUMBER 06330077
062500             PERFORM 0375-GET-OPER-UNIT                           06340077
062600             MOVE XL071-LOC-NM           TO WS-HDR9-REC-LOC       06350077
062700     END-EVALUATE.                                                06360077
062800                                                                  06370077
062900     MOVE SE-REC-SRC-CDE             TO PV-HOLD-REC-SRC-CDE.      06380077
063000     MOVE SE-REC-SEQ-NBR TO PV-HOLD-SEQ-NBR.                      06390077
063100                                                                  06400077
063200******************************************************************06410077
063300*  GET THE DC DESCRIPTION.                                        06420077
063400******************************************************************06430077
063500 0375-GET-OPER-UNIT.                                              06440077
063600                                                                  06450077
063700                                                                  06460077
063800     CALL XL071-LOCATION-MODULE USING XL071-COMMAREA-REC.         06470077
063900                                                                  06480077
064000     EVALUATE TRUE                                                06490077
064100         WHEN XL071-NO-ERRORS                                     06500077
064200         WHEN XL071-LOC-NOT-FOUND                                 06510077
064300         WHEN XL071-DC-ASGMT-NOT-FND                              06520077
064400             CONTINUE                                             06530077
064500         WHEN XL071-BAD-DB2-RETURN                                06540077
064600             MOVE '0375-GET-OPER-UNIT'    TO PV-PARAGRAPH-NAME    06550077
064700             MOVE 'CALL LOCATION MOD '    TO PV-DB2-OPER-ATTEMPTED06560077
064800             MOVE 'XLT00010'              TO PV-DB2-TABLE-NAME    06570077
064900             MOVE XL071-SQLCA             TO SQLCA                06580077
065000             MOVE SQLCODE                 TO PV-SQLCODE           06590077
065100             PERFORM 9800-SQL-ABEND                               06600077
065200     END-EVALUATE.                                                06610077
065300                                                                  06620077
065400 0400-PRINT-HEADINGS.                                             06630077
065500     WRITE DAILY-RECEIPTS-RPT FROM WS-HEADER1 AFTER PAGE.         06640077
065600     ADD +1 TO PV-PAGE-CNT.                                       06650077
065700     MOVE PV-PAGE-CNT TO WS-HDR2-PAGE.                            06660077
065800     WRITE DAILY-RECEIPTS-RPT FROM WS-HEADER2 AFTER 1.            06670077
065900     WRITE DAILY-RECEIPTS-RPT FROM WS-HEADER3 AFTER 1.            06680077
066000     WRITE DAILY-RECEIPTS-RPT FROM WS-HEADER4 AFTER 1.            06690077
066100     WRITE DAILY-RECEIPTS-RPT FROM WS-HEADER5 AFTER 1.            06700077
066200     WRITE DAILY-RECEIPTS-RPT FROM WS-HEADER6 AFTER 1.            06710077
066300     WRITE DAILY-RECEIPTS-RPT FROM WS-HEADER7 AFTER 2.            06720077
066400     WRITE DAILY-RECEIPTS-RPT FROM WS-HEADER8 AFTER 1.            06730077
066500     WRITE DAILY-RECEIPTS-RPT FROM WS-HEADER9 AFTER 2.            06740077
066600     IF SE-ADJUSTMENT                                             06750077
066700         WRITE DAILY-RECEIPTS-RPT FROM WS-HEADER9-ADJ             06760077
066800             AFTER 1                                              06770077
066900         MOVE +11 TO PV-LINE-CNT                                  06780077
067000     ELSE                                                         06790077
067100         MOVE +10 TO PV-LINE-CNT                                  06800077
067200     END-IF.                                                      06810077
067300                                                                  06820077
067400 0500-PRINT-FINAL.                                                06830077
067500     WRITE DAILY-RECEIPTS-RPT                                     06840077
067600       FROM PR-PRINT-FINAL AFTER ADVANCING 2 LINES.               06850077
067700     ADD 2                      TO PV-LINE-CNT.                   06860077
067800                                                                  06870077
067900 0550-PRINT-NO-INPUT.                                             06880077
068000     WRITE DAILY-RECEIPTS-RPT FROM WS-HEADER1 AFTER PAGE.         06890077
068100     ADD +1 TO PV-PAGE-CNT.                                       06900077
068200     MOVE PV-PAGE-CNT TO WS-HDR2-PAGE.                            06910077
068300     WRITE DAILY-RECEIPTS-RPT FROM WS-HEADER2 AFTER 1.            06920077
068400     WRITE DAILY-RECEIPTS-RPT FROM WS-HEADER3 AFTER 1.            06930077
068500     WRITE DAILY-RECEIPTS-RPT FROM WS-HEADER4 AFTER 1.            06940077
068600     WRITE DAILY-RECEIPTS-RPT FROM PR-PRINT-NO-INPUT AFTER 4.     06950077
068700     MOVE +8                    TO PV-LINE-CNT.                   06960077
068800                                                                  06970077
068900*----------------------------------------------------------------*06980077
069000* CODE FOR ACCESSING LOGISTICS DOMAIN ITEM ACCESS MODULE.        *06990077
069100* ADDED CODE TO GET THE DATA FROM VIEWS.          WR # 21361     *07000077
069200*----------------------------------------------------------------*07010077
069300 0600-CALL-XLKUT-DOMAIN-PGM.                                      07020077
069400*    INITIALIZE XL001-ITEM-COMMAREA                               07030077
069500*               PV-SKU-RETAIL.                                    07040077
069600                                                                  07050077
069700*    MOVE 'N' TO PS-DISCREPANCY-SW.                               07060077
069800*    MOVE SE-SKU-NBR              TO PV-TEMP-KEY-SKU.             07070077
069900*    MOVE PV-TEMP-KEY-SKU         TO XL001-KEY-SKU.               07080077
070000                                                                  07090077
070100*    SET  XL001-BY-NUMERIC-SKU                                    07100077
070200*         XL001-SELECT-SKU                                        07110077
070300*         XL001-SELECT-SKU-STR    TO TRUE.                        07120077
070400                                                                  07130077
070500*    CALL XL001-VSM-PGM USING  XL001-ITEM-COMMAREA.               07140077
070600                                                                  07150077
070700*    EVALUATE TRUE                                                07160077
070800                                                                  07170077
070900*     WHEN XL001-SKU-SQLCODE = +0                                 07180077
071000*       PERFORM 0700-READ-SKU-STR-VIEW                            07190077
071100                                                                  07200077
071200*     WHEN XL001-SKU-SQLCODE = +100                               07210077
071300*       CONTINUE                                                  07220077
071400                                                                  07230077
071500*     WHEN XL001-SKU-CONTENTION                                   07240077
071600*       MOVE '7010-SELECT-SKU-BY-SKU'                             07250077
071700*                            TO PV-PARAGRAPH-NAME                 07260077
071800*       MOVE 'SKU CONTENTION'                                     07270077
071900*                            TO PV-DB2-OPER-ATTEMPTED             07280077
072000*       MOVE 'SKU-VIEW'      TO PV-DB2-TABLE-NAME                 07290077
072100*       MOVE XL001-SQLCA     TO SQLCA                             07300077
072200*       PERFORM 9800-SQL-ABEND                                    07310077
072300                                                                  07320077
072400*     WHEN OTHER                                                  07330077
072500*       MOVE '7010-SELECT-SKU-BY-SKU'                             07340077
072600*                            TO PV-PARAGRAPH-NAME                 07350077
072700*       MOVE 'INVALID RETURN'                                     07360077
072800*                            TO PV-DB2-OPER-ATTEMPTED             07370077
072900*       MOVE 'SKU-VIEW'      TO PV-DB2-TABLE-NAME                 07380077
073000*       MOVE XL001-SQLCA     TO SQLCA                             07390077
073100*       PERFORM 9800-SQL-ABEND                                    07400077
073200*    END-EVALUATE.                                                07410077
073300                                                                  07420077
073400*0700-READ-SKU-STR-VIEW.                                          07430077
073500                                                                  07440077
073600*    EVALUATE TRUE                                                07450077
073700                                                                  07460077
073800*     WHEN XL001-SKU-STR-SQLCODE = +0                             07470077
073900*       MOVE XL001-GP-QTY          TO PV-TEMP-GP-QTY              07480077
074000*       MOVE XL001-UNT-RTL-AMT     TO PV-TEMP-UNT-RTL-AMT         07490077
074100*             IF PV-TEMP-GP-QTY = 0                               07500077
074200*                MOVE ZEROES TO PV-SKU-RTL-AMT                    07510077
074300*             ELSE                                                07520077
074400*                COMPUTE PV-SKU-RTL-AMT =                         07530077
074500*                        PV-TEMP-UNT-RTL-AMT / PV-TEMP-GP-QTY     07540077
074600*             END-IF                                              07550077
074700*             IF PV-SKU-RTL-AMT = PV-RTL-AMT                      07560077
074800*                 CONTINUE                                        07570077
074900*             ELSE                                                07580077
075000*                 SET PS-DISCREPANCY-FOUND TO TRUE                07590077
075100*                 MOVE PV-SKU-RTL-AMT TO PV-SKU-RETAIL            07600077
075200*             END-IF                                              07610077
075300                                                                  07620077
075400*     WHEN XL001-SKU-STR-SQLCODE = +100                           07630077
075500*       INITIALIZE PV-TEMP-GP-QTY                                 07640077
075600*                  PV-TEMP-UNT-RTL-AMT                            07650077
075700                                                                  07660077
075800*     WHEN XL001-SKU-STR-CONTENTION                               07670077
075900*       MOVE '7010-SELECT-SKU-BY-SKU'                             07680077
076000*                            TO PV-PARAGRAPH-NAME                 07690077
076100*       MOVE 'SKU STR CONTENTION'                                 07700077
076200*                            TO PV-DB2-OPER-ATTEMPTED             07710077
076300*       MOVE 'SKU-STR-VIEW'  TO PV-DB2-TABLE-NAME                 07720077
076400*       MOVE XL001-SQLCA     TO SQLCA                             07730077
076500*       PERFORM 9800-SQL-ABEND                                    07740077
076600                                                                  07750077
076700*     WHEN OTHER                                                  07760077
076800*       MOVE '7010-SELECT-SKU-BY-SKU'                             07770077
076900*                            TO PV-PARAGRAPH-NAME                 07780077
077000*       MOVE 'INVALID RETURN'                                     07790077
077100*                            TO PV-DB2-OPER-ATTEMPTED             07800077
077200*       MOVE 'SKU-STR-VIEW'  TO PV-DB2-TABLE-NAME                 07810077
077300*       MOVE XL001-SQLCA     TO SQLCA                             07820077
077400*       PERFORM 9800-SQL-ABEND                                    07830077
077500*    END-EVALUATE.                                                07840077
077600/                                                                 07850077
077700*----------------------------------------------------------------*07860077
077800* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *07870077
077900*----------------------------------------------------------------*07880077
078000                                                                  07890077
078100 1000-CREATE-DC-TABLE.                                            07900077
078200     PERFORM 2000-OPEN-LOC-CSR.                                   07910077
078300     PERFORM 2100-FETCH-LOC-CSR.                                  07920077
078400     SET DC-IDX TO +1.                                            07930077
078500     PERFORM 1100-PROCESS-STR-TABLE                               07940077
078600         UNTIL PS-EOF-LOC-CSR                                     07950077
078700         OR    DC-IDX > 50.                                       07960078
078800     PERFORM 2200-CLOSE-LOC-CSR.                                  07970077
078900                                                                  07980077
079000 1100-PROCESS-STR-TABLE.                                          07990077
079100     MOVE XLT00010-LOC-NBR TO STR-NMBR (DC-IDX).                  08000077
079200     PERFORM 2100-FETCH-LOC-CSR.                                  08010077
079300     SET DC-IDX UP BY +1.                                         08020077
079400                                                                  08030077
079500 2000-OPEN-LOC-CSR.                                               08040077
079600     EXEC SQL                                                     08050077
079700         OPEN LOC-CSR                                             08060077
079800     END-EXEC.                                                    08070077
079900                                                                  08080077
080000     EVALUATE TRUE                                                08090077
080100         WHEN SQLCODE = +0                                        08100077
080200              CONTINUE                                            08110077
080300         WHEN SQLWARN0 NOT = SPACE                                08120077
080400         WHEN SQLCODE  NOT = +0                                   08130077
080500              MOVE '2000-OPEN-LOC-CURSOR' TO     PV-PARAGRAPH-NAME08140077
080600              MOVE 'OPEN LOC CURSOR' TO PV-DB2-OPER-ATTEMPTED     08150077
080700              MOVE 'XLT_LOC             '                         08160077
080800                             TO PV-DB2-TABLE-NAME                 08170077
080900              PERFORM 9800-SQL-ABEND                              08180077
081000     END-EVALUATE.                                                08190077
081100                                                                  08200077
081200 2100-FETCH-LOC-CSR.                                              08210077
081300     PERFORM                                                      08220077
081400         WITH TEST AFTER                                          08230077
081500             VARYING PV-SELECT-COUNTER                            08240077
081600             FROM 1 BY 1                                          08250077
081700             UNTIL (PV-SELECT-COUNTER > PV-MAX-RETRIES            08260077
081800                OR  SQLCODE = 0                                   08270077
081900                OR  SQLCODE = +100)                               08280077
082000         EXEC SQL                                                 08290077
082100              FETCH LOC-CSR                                       08300077
082200               INTO :XLT00010-LOC-NBR                             08310077
082300         END-EXEC                                                 08320077
082400                                                                  08330077
082500         EVALUATE TRUE                                            08340077
082600             WHEN SQLCODE = +0                                    08350077
082700             WHEN SQLCODE = -904                                  08360077
082800             WHEN SQLCODE = +911                                  08370077
082900                  CONTINUE                                        08380077
083000             WHEN SQLCODE = +100                                  08390077
083100                  SET PS-EOF-LOC-CSR TO TRUE                      08400077
083200             WHEN SQLWARN0 NOT = SPACE                            08410077
083300             WHEN SQLCODE NOT = +0                                08420077
083400                 MOVE '2100-FETCH-LOC-CSR'                        08430077
083500                                TO PV-PARAGRAPH-NAME              08440077
083600                 MOVE 'FETCH LOC CURSOR'                          08450077
083700                                TO PV-DB2-OPER-ATTEMPTED          08460077
083800                 MOVE 'XLT_LOC             '                      08470077
083900                                TO PV-DB2-TABLE-NAME              08480077
084000              PERFORM 9800-SQL-ABEND                              08490077
084100         END-EVALUATE                                             08500077
084200     END-PERFORM.                                                 08510077
084300                                                                  08520077
084400     IF PV-SELECT-COUNTER > PV-MAX-RETRIES                        08530077
084500         MOVE '2100-FETCH-LOC-CSR' TO PV-PARAGRAPH-NAME           08540077
084600         MOVE 'MAXIMUM RETRIES EXCEEDED' TO PV-DB2-OPER-ATTEMPTED 08550077
084700         MOVE 'XLT_LOC             ' TO PV-DB2-TABLE-NAME         08560077
084800         PERFORM 9800-SQL-ABEND                                   08570077
084900     END-IF.                                                      08580077
085000                                                                  08590077
085100 2200-CLOSE-LOC-CSR.                                              08600077
085200     EXEC SQL                                                     08610077
085300         CLOSE LOC-CSR                                            08620077
085400     END-EXEC.                                                    08630077
085500                                                                  08640077
085600     EVALUATE TRUE                                                08650077
085700         WHEN SQLCODE = 0                                         08660077
085800             CONTINUE                                             08670077
085900         WHEN SQLCODE = -911                                      08680077
086000         WHEN SQLCODE = -904                                      08690077
086100             CONTINUE                                             08700077
086200         WHEN SQLCODE  NOT = +0                                   08710077
086300              MOVE '2200-CLOSE-LOC-CSR' TO PV-PARAGRAPH-NAME      08720077
086400              MOVE 'CLOSE LOC CURSOR' TO     PV-DB2-OPER-ATTEMPTED08730077
086500              MOVE 'XLT_LOC             ' TO PV-DB2-TABLE-NAME    08740077
086600              PERFORM 9800-SQL-ABEND                              08750077
086700     END-EVALUATE.                                                08760077
086800                                                                  08770077
086900 3000-SEARCH-STORE-TABLE.                                         08780077
087000     SEARCH DC-TABLE                                              08790077
087100       VARYING DC-IDX                                             08800077
087200         AT END                                                   08810077
087300             SET PS-IS-NOT-A-DC-RECORD TO TRUE                    08820077
087400         WHEN STR-NMBR (DC-IDX) = PV-HOLD-STORE                   08830077
087500             SET PS-IS-A-DC-RECORD    TO TRUE                     08840077
087600     END-SEARCH.                                                  08850077
087700                                                                  08860077
087800******************************************************************08870077
087900* 9800-SQL-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      08880077
088000* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 08890077
088100******************************************************************08900077
088200 9800-SQL-ABEND.                                                  08910077
088300     MOVE SQLCODE TO PV-SQLCODE.                                  08920077
088400     DISPLAY '** ABEND          **'.                              08930077
088500     DISPLAY '** PROGRAM        ** = MPKRP030'.                   08940077
088600     DISPLAY '** PARAGRAPH      ** = ' PV-PARAGRAPH-NAME.         08950077
088700     DISPLAY '** OPERATION      ** = ' PV-DB2-OPER-ATTEMPTED.     08960077
088800     DISPLAY '** TABLE AFFECTED ** = ' PV-DB2-TABLE-NAME.         08970077
088900     DISPLAY '** SQLCODE        ** = ' PV-SQLCODE.                08980077
089000                                                                  08990077
089100******************************************************************09000077
089200* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    09010077
089300* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         09020077
089400* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     09030077
089500* FORMAT.                                                         09040077
089600******************************************************************09050077
089700     COPY DPPD004.                                                09060077
089800                                                                  09070077
089900     MOVE +4013 TO ABEND-CODE.                                    09080077
090000     CALL 'ILBOABN0' USING ABEND-CODE.                            09090077
090100                                                                  09100077
