000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     APKUP250.                                        00020000
000300 AUTHOR.         MARY KING.                                       00030000
000400 DATE-WRITTEN.   06/20/1994.                                      00040000
000500 DATE-COMPILED.                                                   00050000
000600*************************************************************     00060000
000700*    COBOL 2 WITH SQL                                       *     00070000
000800*                                                           *     00080000
000900*    BATCH MATCH                                            *     00090000
001000*                                                           *     00100000
001100*    THIS PROGRAM DETERMINES IF THE SUM OF THE MERCHANDISE  *     00110000
001200*    COST FOR A PURCHASE ORDER IS EQUAL TO OR WITHIN        *     00120000
001300*    TOLERANCE OF THE SUM OF THE RECEIVED EXTENDED COST FOR *     00130000
001400*    THE SAME PURCHASE ORDER.  THE MATCHING OF COST IS DONE *     00140000
001500*    EITHER AT A STORE LEVEL OR IN BULK, DEPENDING ON HOW   *     00150000
001600*    THE VENDOR IS INVOICING.  (BULK IS IMPLIED WHEN THE    *     00160000
001700*    STORE NUMBER ON THE INVOICE IS ZERO.)                  *     00170000
001800*                                                           *     00180000
001900* INPUT:                                                    *     00190000
002000*  1. INVOICE-FILE                     (APRD060)            *     00200000
002100*  2. RECEIVER-PO-STR-FILE             (APRD020)            *     00210000
002200*  3. AP CONTROL TABLE                 (TAPCNTL)            *     00220013
002300*  4. INVOICE CHARGES/ALLOWANCES TABLE (TALCHRG)            *     00230013
002400*  5. AP VENDOR SPECIFICATIONS TABLE   (TAPVNDS)            *     00240013
002500*  6. PURCHASE ORDER TABLE             (TPURCHS)            *     00250013
002510*  7. CONTROL CARD WITH RELEASE LIMITS.                     *     00251027
002600*                                                           *     00260000
002700* OUTPUT:                                                   *     00270000
002800*  1. RELEASED PO/STORES               (TPOSTRR)            *     00280000
002900*  2. INVOICE TABLE                    (TINVOIC)            *     00290000
003100*  4. DETAIL ENTRY REPORT TABLE        (TOUTAP6) (APRD271)  *     00310000
003200*                                                           *     00320000
003300*************************************************************     00330000
003400*-----------------------------------------------------------------00340000
003500* CHANGE LOG:                                                     00350000
003600* NOTE: REMOVED ALL LOG ENTRIES PRIOR TO THIS ONE - PROGRAM       00360000
003700*       UNDERWENT MAJOR CHANGES AT THIS TIME.                     00370000
003800*                                                                 00380000
003900* 05/06/96 MKK  DUE DATE CALCULATION CHANGES:                     00390000
004000*              -REMOVED DUE DATE AND RECON CUTOFF DATE LOGIC.     00400000
004100*               THIS IS NOW BEING DONE IN APKUT022 AND APKUT023.  00410000
004200*              -REMOVED LOGIC CONCERNING INVOICE AND RECEIVING    00420000
004300*               CURSORS SINCE THIS INFORMATION WILL NOW BE INPUT  00430000
004400*               ON FLAT FILES.                                    00440000
004500*              -REMOVED SEPARATE PROCESSING FOR BULK POS.  THE    00450000
004600*               INPUT RECEIVING FILE WILL CONTAIN ZEROS IN THE    00460000
004700*               STORE NUMBER FOR BULK POS SO SPECIAL HANDLING IS  00470000
004800*               NO LONGER NEEDED.                                 00480000
004900*              -REMOVED LOGIC UPDATING TRECEIV AND TRECDIS SINCE  00490000
005000*               THIS WILL NOW BE DONE IN APKUP025.                00500000
005100*              -ADDED FIELDS CALC_DUE_DTE AND DUE_DTE_SRC_CDE     00510000
005200*               TO UPDATE OF TINVOIC.                             00520000
005300*              -CHANGED ALL OUTPUT FROM FLAT FILES TO DB2 TABLES. 00530000
005400*              -ADDED CHECKPOINT RESTART LOGIC.                   00540000
005500*              -REMOVED DB2 RETRY LOGIC.                          00550000
005600*              -COPYBOOK APRD260 HAS CHANGED AND CORRESPONDING    00560000
005700*               PROGRAM CHANGES WERE MADE.                        00570000
005800*              -CHANGED THE INTERNAL INVOICE ARRAY TO USE APWS008.00580000
005900*              -REMOVED LOGIC PERTAINING TO THE MATCHED INVOICES  00590000
006000*               FOR RECONCILIATION REPORT SINCE THIS REPORT IS NO 00600000
006100*               LONGER NEEDED.                                    00610000
006200*              -CHANGED MATCHED FOR PAYMENT REPORT RECORD LOGIC   00620000
006300*               SINCE THE RECEIVING DATA WILL NOW BE RETRIEVED    00630000
006400*               FROM THE RECEIVING SUMMED BY SEQUENCE NBR FILE.   00640000
006500*              -LOGIC FOR THE BATCH MATCH EXCEPTION REPORT HAS    00650000
006600*               CHANGED.  ONLY REMAINDER INVOICE EXCEPTIONS       00660000
006700*               WILL BE WRITTEN OUT NOW.  THE OTHER EXCEPTION     00670000
006800*               CONDITIONS ARE BEING HANDLED IN OTHER PROGRAMS.   00680000
006900*              -THE DETAIL ENTRY REPORT NO LONGER CREATES         00690000
007000*               RECEIVING TYPE RECORDS.                           00700000
007100*              -REMOVED HOLD AND DNP INDICATOR LOGIC.             00710000
007200*                                                                 00720000
007300*  11/12/96 PDV   AUTOMATIC WRITE-OFF             WR/IR #: 3803   00730000
007400*              -CHANGE SO THAT THE WRITE-OFF'S DO NOT GO TO       00740000
007500*               AUTO RECON.  SET FLAG IN E100-LOAD-INVOICE,       00750000
007600*               THEN IN D500-DETERMINE-RECON CHECK FOR WRITE-OFF  00760000
007700*               INVOICES AND BYPASS.                              00770000
007800*                                                                 00780000
007900*  10/23/97 ECB RECOMPILED DUE TO CHANGE IN COPYBOOK   WR# 4164   00790000
008000*                                                                 00800000
008100*  11/17/97 MAB   COLBY PHASE 1A                  WR/IR #: 4164   00810000
008200*              -MODIFIED THE IF STATEMENT THAT DECIDES WHETHER TO 00820000
008300*               EXECUTE D400-MATCH-PROCESSING.  THE PURPOSE OF THE00830000
008400*               CHANGE IS TO RELEASE ALL IMPORT POS WHERE THE INVO00840000
008500*               STATUS HAS BEEN SET TO 'BM' REGARDLESS OF THE SIZE00850000
008600*               OF THE TOLERANCE DIFFERENCE.                      00860000
008700*                                                                 00870000
008800*  01/16/98     RECOMPILED DUE TO ADDITIONAL FIELD IN COPYBOOKS   00880000
008900*               APRD060 AND APWS008.                              00890000
009000*               BY:  MARK BURNSIDE                     WR# 4164   00900000
009100*                                                                 00910000
009200*  05/18/2000   ADDED LOGIC TO CHECK IF ITS A WEDNESDAY DATE.     00920000
009300*               IF IT IS, WE WILL NOT MATCH RECORDS THAT ARE      00930000
009400*               NOT READY TO BE PAID.                             00940000
009500*               BY:  JILL JUEL                         WR# 20704  00950000
009600*                                                                 00960000
009700*  08/29/2000   ADDED AN ADDITIONAL WHERE COND TO THE DISCOUNT_   00970000
009800*               CSR.  IT WILL NOT FETCH ANY ROWS WHERE THE ALW_   00980000
009900*               CHRG_CDE = 'ADV' FOR ADVERTISING DISCOUNT.        00990000
010000*               BY:  MIKE BESKE                        WR# 20224  01000000
010100*                                                                 01010000
010200*  09/18/00 MAB NEW IMPORT PO TYP CODES           WR/IR #: 20704  01020000
010300*              -REPLACED PROGRAM VARIABLE PC-IMPORT-TYP-CDE IN    01030000
010400*               PARAGRAPH C100- WITH A STRAIGHT COMPARE OF        01040000
010500*               PV-SAVED-PO-TYP-CDE TO THE IMPORT PO TYPE CODES   01050000
010600*               OF 'IM', 'IE' AND 'IM'.                           01060000
010700*                                                                 01070000
010800*  03/07/01     MODIFIED THE SQL MELECTING VALUES FROM TAPCNTL TO 01080003
010900*               CHANGE NUMBER OF DAYS USED TO CALCULATE THE       01090000
011000*               PV-PAY-THRU-DATE FROM 2 DAYS TO 14 DAYS.  THIS    01100000
011100*               CHANGE WILL ALLOW MORE INVOICES TO BE PROCESSED   01110000
011200*               ON PAY CYCLE NIGHT.                               01120000
011300*               BY:  NANCY EILBES                 WR#: 20704      01130000
011400*                                                                 01140000
011500*  03/29/01     MODIFIED THE SQL SELECTING VALUES FROM TAPCNTL TO 01150000
011600*               ADD MORE DATE CALCULATIONS TO ALLOW FLEXIBILITY   01160000
011700*               IN PROCESSING DEFERRED RELEASES.  ALSO ADDED LOGIC01170000
011800*               TO ALLOW DEFERRED RELEASES ON WEEK DAYS OTHER THAN01180000
011900*               WEDNESDAY NIGHTS.  EACH DEFER DAY CAN USE ITS OWN 01190000
012000*               NUMBER OF DEFER DAYS.                             01200000
012100*               BY:  NANCY EILBES                 WR#: 20704      01210000
012200*                                                                 01220000
012300*  04/03/01     CHANGED THE DEFER DAYS FOR THURSDAY AND FRIDAY    01230000
012400*               FROM 21 AND 28 TO 29 AND 30, RESPECTIVELY.        01240000
012500*               BY:  NANCY EILBES                 WR#: 20704      01250000
012600*                                                                 01260000
012700*  05/25/01     ADDED LOGIC TO THE TOLERANCE CHECKING TO ALSO     01270000
012800*               CHECK THE CALCULATED DIFFERENCE TO THE TOLERANCE  01280000
012900*               DOLLAR AMOUNT.  IF THE DIFFERENCE EXCEEDS THE     01290000
013000*               TOLERANCE AMOUNT, THE INVOICES WILL NOT BE        01300000
013100*               RELEASED FOR PAYMENT AND WILL GO INTO THE LOGIC   01310000
013200*               THAT CHECKS FOR RECONCILE.                        01320000
013300*               BY:  NANCY EILBES                 WR#: 22286      01330000
013400*                                                                 01340000
013500*  08/22/01     CHANGED THE DEFER DAYS FOR THURSDAY FROM 29 TO 28.01350000
013600*               ADDED A COUNT OF INVOICES DEFERRED.               01360000
013700*               BY:  NANCY EILBES                 WR#: 20704      01370000
013800*                                                                 01380000
013900*  08/28/01     CHANGED THE DEFER DAYS FOR THURSDAY FROM 28 TO 27.01390000
014000*               BY:  NANCY EILBES                 WR#: 20704      01400000
014100*                                                                 01410000
014200*  11/30/01     CHANGED THE DEFER DAYS FOR THURSDAY FROM 27 TO 26.01420000
014300*               BY:  NANCY EILBES               PITS#: 435120     01430000
014400*                                                                 01440000
014500*  03/11/02     ADDED DEFER LOGIC FOR MONDAY 3/11/02 TO DEFER 28  01450000
014600*               DAYS AND FOR TUESDAY, 3/12/02 TO DEFER 32 DAYS.   01460000
014700*               THIS IS SPECIAL LOGIC JUST TO ALLOW US TO CATCH UP01470000
014800*               AFTER SUSPENDING THE BATCH MATCH SINCE THURSDAY.  01480000
014900*               BY:  NANCY EILBES                 WR#: 22902      01490000
015000*                                                                 01500000
015100*  03/12/02     CHANGED THE DEFER DAYS FOR TUESDAY, 3/12 TO 27.   01510000
015200*               CHANGED THE DEFER DAYS FOR FRIDAYS FROM 30 TO 29. 01520000
015300*               BY:  NANCY EILBES                 WR#: 22902      01530000
015400*                                                                 01540000
015500*  03/14/02     ADDED SPECIAL DEFER FOR THURSDAY, 3/14 OF 21 DAYS.01550000
015600*               REMOVED DEFER LOGIC FOR MONDAY AND TUESDAY.       01560000
015700*               BY:  NANCY EILBES                 WR#: 22902      01570000
015800*                                                                 01580000
015900*  03/16/02     RESTORED LOGIC SETTING TODAY-IS-NOT-RELEASE ON    01590000
016000*               DAYS OTHER THAN WED, THURS, FRI.  ACCIDENTLY      01600000
016100*               REMOVED WITH LAST CHANGE.                         01610000
016200*               BY:  NANCY EILBES                 WR#: 22902      01620000
016300*                                                                 01630000
016400*  03/26/02     CHANGED DEFER DAYS FOR WEDNESDAY FROM 14 TO 17.   01640000
016500*               CHANGED DEFER DAYS FOR THURSDAYS FROM 26 TO 25.   01650000
016600*               BY:  NANCY EILBES                 WR#: 22902      01660000
016700*                                                                 01670000
016800*  05/20/02     ADDED LOGIC TO MAINTAIN A RELEASE LIMIT, AND STOP 01680000
016900*               RELEASING INVOICES ONCE THE LIMIT IS REACHED.  TWO01690000
017000*               LIMIT LEVELS ARE SET UP: WEEKDAY AND WEEKEND, AND 01700000
017100*               WHICH IS USED IS CONTROLLED BY DAY OF WEEK.  WHEN 01710000
017200*               RELEASE COUNTER EXCEEDS THE LIMIT, THE PAY THRU   01720000
017300*               DATE IS SET TO 01/01/0001 AND THE DEFER FLAG IS   01730000
017400*               SET SO THAT ALL RELEASES WILL BE DEFERRED FROM    01740000
017500*               THAT POINT ON.                                    01750000
017600*               ADDED PROGRAM COUNTERS TO THE CHECKPOINT INFO.    01760000
017700*               ADDED INVOICE ID TO THE WHERE CONDITION ON TINVOIC01770000
017800*               UPDATE STATEMENTS.                                01780000
017900*               BY:  NANCY EILBES                 WR#: 22902      01790000
018000*                                                                 01800000
018100*  06/17/2002                                                     01810000
018200*     ARK PO PROJECT PHASE 1.  RECOMPILE FROM PRODUCTION.         01820000
018300*  MADE BY: KEVIN CATLIN                    WR# 23500             01830000
018400*                                                                 01840000
018500*  06/18/2002                                                     01850000
018600*     ARK PO PROJECT PHASE 1.  REMOVED TABLE TPAYREQ AND ITS      01860000
018700*     REFERENCED COLUMNS FROM PROGRAM.  CHANGED UPDATES TO        01870000
018800*     TINVOIC TABLE USING NEW KEYS OF PO_NBR AND INVC_ID.         01880000
018900*  MADE BY: KEVIN CATLIN                WR#: 23500                01890000
019000*                                                                 01900000
019100*  06/25/02 RECOMPILE FROM PRODUCTION TO PICK UP CHANGES TO       01910000
019200*           COPYBOOKS APPD052 AND APWS052.                        01920000
019300*           BY:  KEVIN CATLIN                 WR#: 23839          01930000
019400*                                                                 01940000
019500*  08/05/2002 COLBY HANGER EXPENSE PROCESSING.  RECOMPILE FROM    01950000
019600*             PRODUCTION TO INCORPORATE COPYBOOK CHANGES.         01960000
019700*         BY: KEVIN CATLIN                   WR#: 23254           01970000
019800*                                                                 01980000
019900*  09/09/2002 ARK PO PROJECT PHASE 2.  REPLACE REFERENCES TO      01990000
020000*             PAYT_REQ_SEQ_NBR WITH THE NEW INDEX OF PO_NBR AND   02000000
020100*             INVC_ID.  REMOVED COPYBOOK APWS900.  CURSOR         02010000
020200*             CHANGED IS DISCOUNT_CSR.  PARAGRAPHS MODIFIED ARE   02020000
020300*             E200, E400, AND U200.                               02030000
020400*         BY: KEVIN CATLIN                   WR#: 23500           02040000
020500*                                                                 02050000
020600* 11/04/2002 MODIFIED ALL OF THE AMOUNT FIELDS FROM 9(7)V99       02060000
020700*           TO S9(9)V99 COMP-3 IN COPYBOOK APWS052.THIS WAS DONE  02070000
020800*           TO CORRECT A DISCOUNT BALANCING ISSUE.                02080000
020900*        BY: MIKE BESKE                     WR#: 23750            02090000
021000*                                                                 02100000
021100* 02/05/2003                                                      02110000
021200*    CHANGE MADE: ARKPO PHASE3 PROJECT.                           02120000
021300*    UPDATED THE PROGRAM TITLE TO MATCH THE SPEC TITLE.           02130000
021400*    UPDATED THE INPUT FILENAMES IN THE PROGRAM COMMENT BLOCK.    02140000
021500*    UPDATED AP260-PURCHASE-ORDER TO BE AP260-PO-NBR.             02150000
021600* MADE BY:  MIKE BESKE                          WR#: 23500        02160000
021700*                                                                 02170000
021800* 03/12/2003                                                      02180000
021900*    CHANGE MADE: PEOPLESOFT VERSION 8 UPGRADE - MODIFICATIONS TO 02190000
022000*    DEFER LOGIC TO PROCESS MORE INVOICE VOLUME PRIOR TO UPGRADE  02200000
022100*    SO THERE WILL BE LESS CATCHING UP TO DO AFTER.               02210000
022200* MADE BY:  NANCY EILBES                        WR#: 23417        02220000
022300*                                                                 02230000
022400* 03/25/2003                                                      02240000
022500*    CHANGE MADE: PEOPLESOFT VERSION 8 - POST IMPLEMENTATION.     02250000
022600*    MODIFIED DEFER LOGIC TO PROCESS MORE INVOICE VOLUME ON       02260000
022700*    TUESDAY (100,000) AND WEDNESDAY (25 DAYS) TO CATCH UP ON THE 02270000
022800*    VOLUME THAT WAS NOT PROCESSED DURING THE UPGRADE DOWN TIME.  02280000
022900* MADE BY:  NANCY EILBES                        WR#: 23417        02290000
023000*                                                                 02300000
023100* 04/01/2003                                                      02310000
023200*    CHANGE MADE: PEOPLESOFT VERSION 8 - POST IMPLEMENTATION.     02320000
023300*    CATCH-UP COMPLETED.  CHANGED TUESDAY BACK TO 40000 AND       02330000
023400*    WEDNESDAY BACK TO 21 DAYS.                                   02340000
023500* MADE BY:  NANCY EILBES                        WR#: 23417        02350000
023600*                                                                 02360000
023700* DATE  01/30/2004                                                02370000
023800*     CHANGE MADE: RECOMPILE FROM PRODUCTION TO PICK UP CHANGE    02380000
023900*     TO COPYBOOKS APWS052 AND APPD052. THIS INVOLVES THE VENDOR  02390000
024000*     INSURANCE EXCEPTION OF NOT CHARGING BACK THE VENDOR FOR     02400000
024100*     INSURANCE CHARGE CODES: 'INS' AND '445'.  THE VENDORS ARE   02410000
024200*     ANDEL JEWELRY '117498121' AND CITIZEN WATCH '078822863'.    02420000
024300*     MADE BY: MIKE BESKE              WR/IR #: P000628860        02430000
024400*                                                                 02440000
024500* DATE  11/11/2004                                                02450000
024600*     CHANGE MADE: MODIFIED DEFER LOGIC AS FOLLOWS: CHANGED DEFER 02460000
024700*     DAYS ON WEDNESDAY FROM 21 TO 14.  CHANGED WEEKDAY LIMIT FROM02470000
024800*     40000 TO 50000.  SEPARATED FRIDAY AND SATURDAY LIMITS FROM  02480000
024900*     WEEKEND LIMIT.  FRIDAY LIMIT IS 100000, SATURDAY IS NOW     02490000
025000*     200000.                                                     02500000
025100*     MADE BY: NANCY EILBES            WR/IR #: P000709998        02510000
025200*                                                                 02520000
025300* DATE  02/16/05                                                  02530000
025400*     CHANGE MADE: RECOMPILED DUE TO CHANGE TO COPYBOOK APRD021.  02540011
025500*     MADE BY:  NANCY EILBES           WR# WR28327                02550000
025600*                                                                 02560000
025700* DATE  04/13/2005                                                02570000
025800*     CHANGE MADE: ADDED 'COP' TO THE WHERE CLAUSE OF DISCOUNT_CSR02580000
025900*     IN ORDER TO EXCLUDE OFF-INVOICE CO-OP ADVERTISING PERCENT   02590000
026000*     FROM THE WEIGHTED DISCOUNT PERCENT.                         02600000
026100*     MADE BY: MIKE BESKE              WR/IR #: WR28651           02610000
026200*                                                                 02620000
026300* DATE  11/21/2005                                                02630000
026400*     CHANGE MADE: INCREASED WEEKDAY LIMIT FROM 50000 TO 70000.   02640000
026500*     VOLUMES AT THIS TIME OF YEAR ARE CAUSING SATURDAY TO ALSO   02650000
026600*     DEFER MATCHING, SO WE NEED TO SPREAD THE VOLUMES ACROSS MORE02660000
026700*     DAYS TO ENSURE THAT ON THE LAST SATURDAY OF THE MONTH THERE 02670000
026800*     WILL BE NO VOLUME DEFERRALS.                                02680000
026900*     MADE BY: NANCY EILBES            WR/IR #: P000824911        02690000
027000*                                                                 02700000
027100* DATE  11/25/2005                                                02710000
027200*     CHANGE MADE: INCREASED FRIDAY LIMIT FROM 100000 TO 160000.  02720000
027300*     PLUS ALSO INCREASED SATURDAY LIMIT FROM 200000 TO 250000.   02730000
027400*     VOLUMES AT THIS TIME OF YEAR ARE CAUSING SATURDAY TO ALSO   02740000
027500*     DEFER MATCHING, SO WE NEED TO SPREAD THE VOLUMES ACROSS MORE02750000
027600*     DAYS TO ENSURE THAT ON THE LAST SATURDAY OF THE MONTH THERE 02760000
027700*     WILL BE NO VOLUME DEFERRALS.  THE THURS 11-24 DEFERRED TOTAL02770000
027800*     REACHED 169950, THE HIGHEST AMOUNT IN THE PREV 3 WEEKS OF   02780000
027900*     TRACKING THESE TOTALS.                                      02790000
028000*     MADE BY: MIKE BESKE              WR/IR #: P000824911        02800000
028100*                                                                 02810000
028200* DATE  01/26/2006                                                02820000
028300*     CHANGE MADE: CHANGED WEEKDAY LIMIT 30000.  THIS WAS AN      02830000
028400*     EMERGENCY MEASURE DUE TO HAVING TO RUN A SECOND PAY CYCLE   02840000
028500*     ON THURSDAY NIGHT.                                          02850000
028600*     MADE BY: NANCY EILBES            WR/IR #: WR30042           02860000
028700*                                                                 02870000
028800* DATE  02/09/2006                                                02880000
028900*     CHANGE MADE: CHANGED WEEKDAY LIMIT BACK TO 70000.           02890000
029000*     MADE BY: NANCY EILBES            WR/IR #: WR30042           02900000
029100*                                                                 02910000
029200* DATE  03/13/2006                                                02920000
029300*     CHANGE MADE: REMOVE DISCOUNT CURSOR, PARAGRAPH F100 FOR     02930000
029400*     CURSOR FETCH AND THE REMOVAL OF APWS052, APPD052            02940000
029500*     MADE BY: GREG WISIALOWSKI        WR/IR #: WR30028           02950000
029600*                                                                 02960000
029700* DATE  07/21/2006                                                02970001
029800*     CHANGE MADE: CHANGED PARAGRAPH C100- TO ALLOW WRITE OFFS    02980001
029900*     WHERE THE TOTAL GROSS AMOUNT IS LESS THAN THE               02990001
030000*     PV-INVC-RCV-VAR-AMT FOR INVOICES WITH AN INVOICE-TYPE OF    03000001
030100*     'WO'.                                                       03010001
030200*     MADE BY: ROLF NOHE               WR/IR #: WR30825           03020001
030300*                                                                 03030001
030400* DATE  07/27/2006                                                03040001
030500*     CHANGE MADE: MATCH BY DC -- REMOVED ALL LOGIC RELATING TO   03050000
030600*     THE DUE DATE EXCEPTION REPORT RECORDS AND THE AUTOMATIC     03060000
030700*     MATCH REPORT RECORDS.  THIS INCLUDED THE                    03070000
030800*     DDX-DUE-DATE-EXCEPTIONS RECORD DEFINITION; THE TOUTAP7,     03080000
030900*     TOUTAP8, AND TOUTAP9 TABLE DEFINITIONS; THE APRD260 AND     03090000
031000*     APRD022 COPYBOOK DEFINITIONS; AND THE FOLLOWING PARAGRAPHS: 03100000
031100*     A) E500-PREPARE-MATCHED-VENDOR                              03110000
031200*     B) E600-PREPARE-MATCHED-INVOICE                             03120000
031300*     C) E700-PREPARE-MATCHED-RECEIVER                            03130000
031400*     D) E900-PREPARE-RI-EXCEPTION                                03140000
031500*     E) F200-PREPARE-DUE-DATE-X                                  03150000
031600*     F) R700-SELECT-DEPT                                         03160000
031700*     G) U700-INSERT-MATCHED-FOR-PAYT                             03170000
031800*     H) U800-INSERT-DUE-DATE-EXCEPTION                           03180000
031900*     I) U900-INSERT-RI-EXCEPTION                                 03190000
032000*     LOGIC WAS ADDED TO PARAGRAPH D500-DETERMINE-RECON TO ALLOW  03200000
032100*     FOR REMAINDER INVOICES TO BE AUTO RECONCILED.               03210000
032200*     MADE BY: KRYSTEN LEARY           WR/IR #: WR21578           03220000
032300*                                                                 03230006
032400* DATE  11/13/2006                                                03240009
032500*     CHANGE MADE: DECREASED FRIDAY LIMIT FROM 160000 TO 90000 TO 03250009
032600*     STOP APK045C FROM ABENDING ON FRIDAYS WITH DISTRIB LINE     03260009
032700*     COUNTS OVER 100000.                                         03270009
032800*     THIS IS A TEMP FIX FOR THE APK045C ABEND.  A PERM FIX IS    03280009
032900*     BEING WORKED ON INVOLVING PEOPLESOFT APPLICATION ENGINE SQL.03290009
033000*     ALSO RESTORED SOME LOST CODE CHANGES BETWEEN 7-21-06 AND    03300009
033100*     07-27-06.                                                   03310009
033200*     MADE BY: MIKE BESKE              WR/IR #: P000950560        03320009
033300*                                                                 03330009
033400* DATE  11/14/2006                                                03340009
033500*     CHANGE MADE: MATCH BY DC PROJECT                            03350006
033600*     CHANGED ALL REFERENCES OF AP060-STR-NBR TO AP060-MTCH-LOC-  03360006
033700*     NBR.  THIS WILL INSURE THAT THE DC NUMBER WILL BE MOVED TO  03370006
033800*     THE TPOSTRR TABLE IN THE STORE FIELD FOR AN INVOICE MATCHED 03380006
033900*     AT DC LEVEL.  ADDED TO THE INSERT OF THE TPOSTRR TABLE, IN  03390006
034000*     PARAGRAPHS U300- AND U400-, MTCH-LVL-CDE POPULATED FROM     03400007
034100*     AP060-MTCH-LVL-CDE VIA PV-SAVED-MTCH-LVL-CDE.  IN D200-     03410010
034200*     THE CALC OF THE UPPER TOLERANCE PERCENT AMOUNT WAS          03420010
034300*     CHANGED TO BE EQUAL TO THE TOTAL RECEIPTS AMOUNT INSTEAD    03430010
034400*     OF THE TOT-RECD-AMT + TOLERANCE-PCT-AMT.                    03440010
034500*     MADE BY: MIKE BESKE              WR/IR #: WR21578           03450006
034600*                                                                 03460006
034700* DATE  01/02/2007                                                03470014
034800*     CHANGE MADE: MATCH BY DC PROJECT                            03480014
034900*     REMOVED ALL CODE AND REFERENCES TO THE APRD021 COPYBOOK AND 03490014
035000*     THE INPUT RECEIVER-SEQ-FILE.                                03500014
035100*     MADE BY: MIKE BESKE              WR/IR #: WR21578           03510014
035200*                                                                 03520014
035210* DATE  01/30/2007                                                03521015
035220*     CHANGE MADE: MATCH BY DC PROJECT                            03522015
035230*     REMOVED ALL REFERENCES TO TAUDINC, PARAGRAPHS E400 AND U400.03523015
035250*     MADE BY: NANCY EILBES            WR/IR #: WR21578           03525015
035260*                                                                 03526015
035270* DATE  03/19/2012                                                03527017
035280*     CHANGE MADE: PEOPLESOFT UPGRADE TO V9.1                     03528017
035290*     COMMENTED OUT INITIALIZATION LOGIC THAT SET THE DEFER-RLSE  03529017
035291*     INDICATOR BASED ON THE DAY OF THE WEEK.  TODAY-IS-NOT-DEFER-03529117
035292*     RLSE WILL ALWAYS BE SET, REGARDLESS OF DAY OF WEEK. PAY     03529217
035293*     RELEASE LIMITS BY WEEK DAY OR WEEKEND REMAIN IN PLACE.      03529317
035294*     MADE BY: NANCY EILBES            WR/IR #: CRQ000000022280   03529417
035295*                                                                 03529517
035296* DATE  11/12/2013                                                03529620
035297*     CHANGE MADE: DIRECT SHIP ISSUES - MODIFIED RECONCILIATION   03529720
035298*     LOGIC IN D500-DETERMINE-RECON TO ALWAYS PUT POS OF TYPE     03529820
035299*     CONSUMER DIRECT TO RECONCILIATION RATHER THAN WAITING       03529920
035300*     FOR THE RECON CUTOFF DATE TO BE REACHED.  CONSUMER DIRECT   03530020
035301*     POS SHOULD MATCH AS SOON AS BOTH THE INVOICES AND RECEIPTS  03530120
035302*     ARE AVAILABLE, SO IF THEY DON'T THERE IS NO ADVANTAGE TO    03530220
035303*     WAITING TO PERFORM THE RECONCILIATION.                      03530320
035304*     MADE BY: NANCY EILBES            WR/IR #: CHG0068241        03530420
035305*                                                                 03530520
035306* DATE  11/14/2014                                                03530622
035307*      RECOMPILED THE  PROGRAM. CHANGES WERE MADE TO APRD271      03530722
035308*      COPYBOOK.                                                  03530822
035309*      MADE BY: COGNIZANT              WR/IR: CHG0094517          03530922
035310*                                                               * 03531023
035311* DATE 12/17/2015                                               * 03531123
035312*     CHANGE MADE: RECOMPILED TO INCLUDE CHANGES TO APWS008     * 03531223
035313*     TO INCREASE THE INVOICE ARRAY TO 8000 ENTRIES.            * 03531323
035314*     MADE BY: NANCY EILBES            WR/IR #: CHG0130416      * 03531423
035315*                                                               * 03531524
035316* DATE 12/01/2016                                               * 03531624
035317*     CHANGE MADE: RECOMPILED TO INCLUDE CHANGES TO APWS008     * 03531724
035318*     TO INCREASE THE INVOICE ARRAY TO 50000 ENTRIES.           * 03531824
035319*     MADE BY: NANCY EILBES            WR/IR #: CHG0157916      * 03531924
035320*                                                               * 03532025
035321* DATE 12/01/2016                                               * 03532125
035322*     CHANGE MADE: RECOMPILED TO INCLUDE CHANGES TO APWS008     * 03532225
035323*     TO INCREASE THE INVOICE ARRAY TO 50000 ENTRIES.           * 03532325
035324*     MADE BY: NANCY EILBES            WR/IR #: CHG0157916      * 03532425
035325*                                                               * 03532525
035326* DATE 06/07/2019                                               * 03532625
035327*     CHANGE MADE: ERP PROJECT.  MODIFIED THE WEEKDAY-LIMIT     * 03532725
035328*     FROM 70K TO 125K AND THE FRIDAY-LIMIT FROM 90K TO 175K.   * 03532825
035330*     MADE BY: NANCY EILBES            WR/IR #: CHG0225145      * 03533025
035331*                                                               * 03533128
035332* DATE 05/11/2021                                               * 03533228
035333*     CHANGE MADE: RECOMPILE FOR UPDATED APWS008 COPYBOOK       * 03533328
035335*     MADE BY: JEAN KURK               WR/IR #: CHG0256545      * 03533528
035336*                                                               * 03533629
035337* DATE 05/18/2021                                               * 03533729
035338*     CHANGE MADE: COMMENTED OUT LOGIC IN D500-DETERMINE-RECON  * 03533829
035339*     THAT PUSHED CD TYPE POS TO AUTO RECONCILIATION IF THEY    * 03533929
035340*     DID NOT BATCH MATCH. THIS CHANGE WILL GIVE THE INVENTORY  * 03534029
035341*     CONTROL TEAM MORE TIME TO MAKE CORRECTIONS ON CD POS      * 03534129
035342*     WHERE THE RECEIPTS WERE POSTED INCORRECTLY.               * 03534229
035343*     MADE BY: NANCY EILBES            WR/IR #: CHG0256918      * 03534330
035350*---------------------------------------------------------------* 03535029
035400   EJECT                                                          03540006
035500 ENVIRONMENT DIVISION.                                            03550006
035600 CONFIGURATION SECTION.                                           03560006
035700 SOURCE-COMPUTER.    IBM-3090.                                    03570006
035800 OBJECT-COMPUTER.    IBM-3090.                                    03580006
035900                                                                  03590006
036000 INPUT-OUTPUT SECTION.                                            03600006
036100 FILE-CONTROL.                                                    03610006
036200     SELECT INVOICE-FILE         ASSIGN TO UT-S-INP01.            03620006
036300     SELECT RECEIVER-PO-STR-FILE ASSIGN TO UT-S-INP02.            03630006
036400 EJECT                                                            03640006
036500 DATA DIVISION.                                                   03650006
036600 FILE SECTION.                                                    03660006
036700                                                                  03670006
036800 FD  INVOICE-FILE                                                 03680006
036900     RECORDING MODE IS F                                          03690006
037000     LABEL RECORDS ARE STANDARD                                   03700006
037100     BLOCK CONTAINS 0 RECORDS                                     03710006
037200     DATA RECORD IS INVOICE-DATA-REC.                             03720006
037300 01  INVOICE-DATA-REC.                                            03730006
037400     05  FILLER                       PIC  X(175).                03740006
037500                                                                  03750006
037600 FD  RECEIVER-PO-STR-FILE                                         03760006
037700     RECORDING MODE IS F                                          03770006
037800     LABEL RECORDS ARE STANDARD                                   03780006
037900     BLOCK CONTAINS 0 RECORDS                                     03790006
038000     DATA RECORD IS RECEIVER-PO-STR-REC.                          03800006
038100 01  RECEIVER-PO-STR-REC              PIC  X(35).                 03810006
038200                                                                  03820006
038300 EJECT                                                            03830006
038400 WORKING-STORAGE SECTION.                                         03840006
038500                                                                  03850006
038600 01  PV-PROGRAM-VARIABLES.                                        03860006
038700     05  FILLER                  PIC  X(30)  VALUE                03870006
038800         '** BEGINING OF APKUP250 W/S **'.                        03880006
038900     05  PV-PROGRAM-NAME         PIC  X(08)  VALUE 'APKUP250'.    03890006
039000     05  PV-BTCH-TMST            PIC  X(26)  VALUE SPACES.        03900006
039100                                                                  03910006
039200     05  PV-SAVED-PO-NBR         PIC S9(09)  VALUE ZEROS          03920006
039300                                             COMP.                03930006
039400     05  PV-SAVED-STR-NBR        PIC S9(04)  VALUE ZEROS          03940006
039500                                             COMP.                03950006
039600     05  PV-SAVED-VENDOR-NAME    PIC  X(30)  VALUE SPACES.        03960006
039700     05  PV-SAVED-VENDOR-NBR     PIC  X(09)  VALUE SPACES.        03970006
039800     05  PV-SAVED-PO-TYP-CDE     PIC  X(02)  VALUE SPACES.        03980006
039810     05  PV-SAVED-INVC-TYP-CDE   PIC  X(02)  VALUE SPACES.        03981016
039900     05  PV-SAVED-INVC-STATUS    PIC  X(02)  VALUE SPACES.        03990006
040000     05  PV-SAVED-MTCH-LVL-CDE   PIC  X(01)  VALUE SPACES.        04000006
040100                                                                  04010006
040200     05  PV-INVC-ID              PIC X(22)   VALUE SPACES.        04020006
040300     05  PV-PAYT-REQ-SEQ-NBR     PIC S9(09)  VALUE ZEROS          04030006
040400                                             COMP.                04040006
040500     05  PV-DUE-DATE.                                             04050006
040600         10  PV-DUE-CENT         PIC  9(02)  VALUE 19.            04060006
040700         10  PV-DUE-YEAR         PIC  9(02)  VALUE ZEROS.         04070006
040800         10  FILLER              PIC  X(01)  VALUE '-'.           04080006
040900         10  PV-DUE-MONTH        PIC  9(02)  VALUE ZEROS.         04090006
041000         10  FILLER              PIC  X(01)  VALUE '-'.           04100006
041100         10  PV-DUE-DAY          PIC  9(02)  VALUE ZEROS.         04110006
041200     05  PV-DUE-DATE-HOST REDEFINES PV-DUE-DATE                   04120006
041300                                 PIC  X(10).                      04130006
041400     05  PV-DUE-DATE-SOURCE      PIC  X(01)  VALUE ' '.           04140006
041500                                                                  04150006
041600     05  PV-GRO-COST-X.                                           04160006
041700         10  PV-GRO-COST         PIC -Z(08).99 VALUE ZEROS.       04170006
041800     05  PV-AUD-TAB-AMT REDEFINES PV-GRO-COST-X                   04180006
041900                                 PIC  X(12).                      04190006
042000     05  PV-INVC-RCV-VAR-PCT     PIC S9(03)V99 VALUE ZEROS        04200006
042100                                               COMP-3.            04210006
042200     05  PV-INVC-RCV-VAR-AMT     PIC S9(04)V99 VALUE ZEROS        04220006
042300                                               COMP-3.            04230006
042400     05  PV-DECIMAL8              PIC S9(08)V9(08) VALUE ZEROS.   04240006
042500                                                                  04250006
042600     05  PV-PAY-THRU-DATE            PIC  X(10).                  04260006
042700     05  PV-PAY-THRU-DATE-NBR.                                    04270006
042800         10  PV-PAY-THRU-DATE-YEAR   PIC  9(04).                  04280006
042900         10  PV-PAY-THRU-DATE-MM     PIC  9(02).                  04290006
043000         10  PV-PAY-THRU-DATE-DD     PIC  9(02).                  04300006
043100     05  PV-DATE-PLUS-14             PIC  X(10).                  04310006
043200     05  PV-DATE-PLUS-17             PIC  X(10).                  04320006
043300     05  PV-DATE-PLUS-21             PIC  X(10).                  04330006
043400     05  PV-DATE-PLUS-25             PIC  X(10).                  04340006
043500     05  PV-DATE-PLUS-26             PIC  X(10).                  04350006
043600     05  PV-DATE-PLUS-27             PIC  X(10).                  04360006
043700     05  PV-DATE-PLUS-28             PIC  X(10).                  04370006
043800     05  PV-DATE-PLUS-29             PIC  X(10).                  04380006
043900     05  PV-DATE-PLUS-30             PIC  X(10).                  04390006
044000     05  PV-DATE-PLUS-32             PIC  X(10).                  04400006
044100                                                                  04410006
044200 01  CR-CHECKPOINT-RESTART-AREA.                                  04420006
044300     05  CR-CKPT-STAT-CODE        PIC  X(01)   VALUE SPACE.       04430006
044400         88  NORMAL-RUN                        VALUE '0'.         04440006
044500         88  RESTART-RUN                       VALUE '9'.         04450006
044600     05  CR-CKPT-RESTART-INFO.                                    04460006
044700         10  CR-PO-NBR            PIC  9(09)   VALUE ZEROS.       04470006
044800         10  CR-STR-NBR           PIC  9(04)   VALUE ZEROS.       04480006
044900         10  CR-INVCS-RL-COUNT    PIC  9(09)   VALUE ZEROS.       04490006
045000         10  CR-INVCS-RC-COUNT    PIC  9(09)   VALUE ZEROS.       04500006
045100         10  CR-INVCS-DF-COUNT    PIC  9(09)   VALUE ZEROS.       04510006
045200         10  CR-MATCH-COUNT       PIC  9(09)   VALUE ZEROS.       04520006
045300         10  CR-AUTO-RECON-COUNT  PIC  9(09)   VALUE ZEROS.       04530006
045400     05  CR-NEXT-TMST             PIC  X(26)   VALUE SPACES.      04540006
045500     05  CR-CURR-TMST             PIC  X(26)   VALUE SPACES.      04550006
045600                                                                  04560006
045610 01  CONTROL-PARAMETERS.                                          04561026
045620     05  CC-WEEKDAY-LABEL         PIC  X(17).                     04562026
045630     05  CC-WEEKDAY-LIMIT         PIC  9(06).                     04563026
045631     05  FILLER                   PIC  X.                         04563126
045640     05  CC-FRIDAY-LABEL          PIC  X(17).                     04564026
045650     05  CC-FRIDAY-LIMIT          PIC  9(06).                     04565026
045651     05  FILLER                   PIC  X.                         04565126
045652     05  CC-SATURDAY-LABEL        PIC  X(17).                     04565226
045653     05  CC-SATURDAY-LIMIT        PIC  9(06).                     04565326
045660     05  FILLER                   PIC  X(8).                      04566026
045700                                                                  04570006
045800 01  PS-PROGRAM-SWITCHES.                                         04580006
045900     05  PS-COMMITS-TAKEN-SW         PIC X(01) VALUE 'N'.         04590006
046000         88  COMMITS-TAKEN                     VALUE 'T'.         04600006
046100         88  NO-COMMITS-TAKEN                  VALUE 'N'.         04610006
046200                                                                  04620006
046300     05  PS-OUT-OF-INVOICES-SW       PIC X(01) VALUE 'M'.         04630006
046400         88  OUT-OF-INVOICES                   VALUE 'O'.         04640006
046500         88  MORE-INVOICES                     VALUE 'M'.         04650006
046600     05  PS-OUT-OF-RCVR-PO-STR-SW    PIC X(01) VALUE 'M'.         04660006
046700         88  OUT-OF-RCVR-PO-STR                VALUE 'O'.         04670006
046800         88  MORE-RCVR-PO-STR                  VALUE 'M'.         04680006
046900     05  PS-OUT-OF-RCVR-SEQ-SW       PIC X(01) VALUE 'M'.         04690006
047000         88  OUT-OF-RCVR-SEQ                   VALUE 'O'.         04700006
047100         88  MORE-RCVR-SEQ                     VALUE 'M'.         04710006
047200     05  PS-OUT-OF-DISCOUNTS-SW      PIC X(01) VALUE 'M'.         04720006
047300         88  OUT-OF-DISCOUNTS                  VALUE 'O'.         04730006
047400         88  MORE-DISCOUNTS                    VALUE 'M'.         04740006
047500                                                                  04750006
047600     05  PS-ALLOW-EXIST-SW           PIC X(01) VALUE 'N'.         04760006
047700         88  NO-ALLOW-EXIST                    VALUE 'N'.         04770006
047800         88  ALLOW-EXIST                       VALUE 'Y'.         04780006
047900     05  PS-MERCH-INVOICE-EXISTS-SW  PIC X(01) VALUE 'N'.         04790006
048000         88  MERCH-INVOICE-EXIST               VALUE 'Y'.         04800006
048100         88  NO-MERCH-INVOICE-EXIST            VALUE 'N'.         04810006
048200     05  PS-REMAIN-INVOICE-EXISTS-SW PIC X(01) VALUE 'N'.         04820006
048300         88  REMAIN-INVOICE-EXIST              VALUE 'Y'.         04830006
048400         88  NO-REMAIN-INVOICE-EXIST           VALUE 'N'.         04840006
048500     05  PS-WRITE-OFF-INV-EXISTS-SW  PIC X(01) VALUE 'N'.         04850006
048600         88  WRITE-OFF-INV-EXIST               VALUE 'Y'.         04860006
048700         88  NO-WRITE-OFF-INV-EXIST            VALUE 'N'.         04870006
048800                                                                  04880006
048900     05  PS-PAYMENT-DUE-SW           PIC X(01) VALUE 'N'.         04890006
049000         88  PAYMENT-DUE                       VALUE 'Y'.         04900006
049100         88  PAYMENT-NOT-DUE                   VALUE 'N'.         04910006
049200     05  PS-MANUAL-EDI-PO-SW         PIC X(01) VALUE 'E'.         04920006
049300         88  MANUAL-PO                         VALUE 'M'.         04930006
049400         88  EDI-PO                            VALUE 'E'.         04940006
049500     05  PS-TOLERANCE-VALUE-SW       PIC X(01) VALUE 'D'.         04950006
049600         88  USE-DEFAULT-TOLERANCE             VALUE 'D'.         04960006
049700         88  USE-SPECIFIED-TOLERANCE           VALUE 'S'.         04970006
049800                                                                  04980006
049900     05  PS-DETAIL-ENTERED-SW        PIC X(01) VALUE 'Y'.         04990006
050000         88  DETAIL-ENTERED                    VALUE 'Y'.         05000006
050100         88  NO-DETAIL-ENTERED                 VALUE 'N'.         05010006
050200     05  PS-DETAIL-HEADER-SW         PIC X(01) VALUE 'Y'.         05020006
050300         88  WRITE-DETAIL-HEADER               VALUE 'Y'.         05030006
050400         88  DO-NO-WRITE-DETAIL-HEADER         VALUE 'N'.         05040006
050500                                                                  05050006
050600     05  PS-DEFER-RLSE-DAY-IND       PIC X(01) VALUE 'Y'.         05060006
050700         88  TODAY-IS-DEFER-RLSE               VALUE 'Y'.         05070006
050800         88  TODAY-IS-NOT-DEFER-RLSE           VALUE 'N'.         05080006
050900                                                                  05090006
051000     05  PS-DEFER-RELEASE-IND        PIC X(01) VALUE 'N'.         05100006
051100         88  DEFER-RELEASE                     VALUE 'N'.         05110006
051200         88  RELEASE-OK                        VALUE 'Y'.         05120006
051300 EJECT                                                            05130006
051400 01  PA-PROGRAM-AMOUNTS.                                          05140006
051500     05  PA-TOT-GROSS-AMT         PIC S9(09)V99 VALUE ZEROS.      05150006
051600     05  PA-TOT-RECD-AMT          PIC S9(09)V99 VALUE ZEROS.      05160006
051700     05  PA-DIFFERENCE-AMT        PIC S9(09)V99 VALUE ZEROS.      05170006
051800                                                                  05180006
051900     05  PA-TOLERANCE-PCT-AMT     PIC S9(10)V99 VALUE ZEROS.      05190006
052000     05  PA-LOWER-TOL-PCT-AMT     PIC S9(11)V99 VALUE ZEROS.      05200006
052100     05  PA-UPPER-TOL-PCT-AMT     PIC S9(11)V99 VALUE ZEROS.      05210006
052200                                                                  05220006
052300     05  PA-TOTAL-DISCOUNT-AMT    PIC S9(08)V99 VALUE ZEROS.      05230006
052400     05  PA-WEIGHTED-DISCOUNT-PCT PIC SV9(04)   VALUE ZEROS.      05240006
052500                                                                  05250006
052600     05  PA-INVOICE-COUNT         PIC  9(09)    VALUE ZEROS.      05260006
052700     05  PA-RCVR-PO-STR-COUNT     PIC  9(09)    VALUE ZEROS.      05270006
052800     05  PA-INVCS-RL-COUNT        PIC  9(09)    VALUE ZEROS.      05280006
052900     05  PA-INVCS-RC-COUNT        PIC  9(09)    VALUE ZEROS.      05290006
053000     05  PA-INVCS-DF-COUNT        PIC  9(09)    VALUE ZEROS.      05300006
053100     05  PA-MATCH-COUNT           PIC  9(09)    VALUE ZEROS.      05310006
053200     05  PA-AUTO-RECON-COUNT      PIC  9(09)    VALUE ZEROS.      05320006
053300     05  PA-MISC-COUNT            PIC S9(09) COMP-3 VALUE 0.      05330006
053400     05  RELEASE-LIMIT            PIC  9(09)    VALUE ZEROS.      05340006
053500 EJECT                                                            05350006
053600*---------------------------------------------------------------  05360006
053700*  INTERNAL INVOICE ARRAY                                         05370006
053800*---------------------------------------------------------------  05380006
053900     COPY APWS008.                                                05390006
054000 EJECT                                                            05400006
054100 01  PC-PROGRAM-CONSTANTS.                                        05410006
054200     05  PC-CREDIT-PURCHASE      PIC  X(02)  VALUE 'CP'.          05420006
054300     05  PC-DEBIT-PURCHASE       PIC  X(02)  VALUE 'DP'.          05430006
054400                                                                  05440006
054500     05  PC-EXACT-MATCH          PIC  X(02)  VALUE '01'.          05450006
054600     05  PC-UNDER-TOL-MATCH      PIC  X(02)  VALUE '02'.          05460006
054700     05  PC-OVER-TOL-MATCH       PIC  X(02)  VALUE '03'.          05470006
054800                                                                  05480006
054900     05  PC-MANUAL-ENTRY         PIC  X(01)  VALUE 'M'.           05490006
055000     05  PC-EDI-ENTRY            PIC  X(01)  VALUE 'E'.           05500006
055100                                                                  05510006
055200     05  PC-VENDOR-RECORD        PIC  X(01)  VALUE 'A'.           05520006
055300     05  PC-INVOICE-RECORD       PIC  X(01)  VALUE 'B'.           05530006
055400     05  PC-RECEIVER-RECORD      PIC  X(01)  VALUE 'C'.           05540006
055500                                                                  05550006
055600     05  PC-INVC-RL-STATUS       PIC  X(02)  VALUE 'RL'.          05560006
055700     05  PC-INVC-RC-STATUS       PIC  X(02)  VALUE 'RC'.          05570006
055800                                                                  05580006
055900     05  PC-IN-PROCESS-CODE      PIC  X(01)  VALUE '9'.           05590006
056000     05  PC-RUN-COMPLETE-CODE    PIC  X(01)  VALUE '0'.           05600006
056100                                                                  05610006
056200     05  PC-IMPORT-TYP-CDE       PIC  X(02)  VALUE 'IM'.          05620006
056300     05  DEFER-ALL-DATE          PIC  9(08)  VALUE 00010101.      05630006
056400     05  WEEKDAY-LIMIT           PIC  9(09)  VALUE ZERO.          05640026
056600     05  FRIDAY-LIMIT            PIC  9(09)  VALUE ZERO.          05660026
056700     05  SATURDAY-LIMIT          PIC  9(09)  VALUE ZERO.          05670026
056800 EJECT                                                            05680006
056900                                                                  05690006
057000*--------------------------------------------------------------*  05700006
057100* WORKING STORAGE FOR CALENDAR ROUTINE                         *  05710006
057200*--------------------------------------------------------------*  05720006
057300     COPY DPWS500.                                                05730006
057400 EJECT                                                            05740006
057500                                                                  05750006
057600*---------------------------------------------------------------  05760006
057700*  COMMUNICATIONS AREA2 FOR DB2                                   05770006
057800*---------------------------------------------------------------  05780006
057900     COPY SQLCA2.                                                 05790006
058000                                                                  05800006
058100     EXEC SQL                                                     05810006
058200          INCLUDE SQLCA                                           05820006
058300     END-EXEC.                                                    05830006
058400 EJECT                                                            05840006
058500*---------------------------------------------------------------  05850006
058600*  ACCOUNTS PAYABLE CONTROL TABLE                                 05860006
058700*---------------------------------------------------------------  05870006
058800     EXEC SQL                                                     05880006
058900          INCLUDE TAPCNTL                                         05890006
059000     END-EXEC.                                                    05900006
059100 EJECT                                                            05910006
059200*---------------------------------------------------------------  05920006
059300*  ACCOUNTS PAYABLE VENDOR SPECIFICATIONS TABLE                   05930006
059400*---------------------------------------------------------------  05940006
059500     EXEC SQL                                                     05950006
059600          INCLUDE TAPVNDS                                         05960006
059700     END-EXEC.                                                    05970006
059800 EJECT                                                            05980006
059900*---------------------------------------------------------------  05990006
060000*  PURCHASE ORDER TABLE                                           06000006
060100*---------------------------------------------------------------  06010006
060200     EXEC SQL                                                     06020006
060300          INCLUDE TPURCHS                                         06030006
060400     END-EXEC.                                                    06040006
060500 EJECT                                                            06050006
060600*---------------------------------------------------------------  06060006
060700*  INVOICE TABLE                                                  06070006
060800*---------------------------------------------------------------  06080006
060900     EXEC SQL                                                     06090006
061000          INCLUDE TINVOIC                                         06100006
061100     END-EXEC.                                                    06110006
061200 EJECT                                                            06120006
061300*---------------------------------------------------------------  06130006
061400*  INVOICE CHARGES/ALLOWANCES TABLE                               06140006
061500*---------------------------------------------------------------  06150006
061600     EXEC SQL                                                     06160006
061700          INCLUDE TALCHRG                                         06170006
061800     END-EXEC.                                                    06180006
061900 EJECT                                                            06190006
062000*---------------------------------------------------------------  06200006
062100*  RELEASED PO/STORES                                             06210006
062200*---------------------------------------------------------------  06220006
062300     EXEC SQL                                                     06230006
062400          INCLUDE TPOSTRR                                         06240006
062500     END-EXEC.                                                    06250006
062600 EJECT                                                            06260006
063400*---------------------------------------------------------------  06340006
063500*  DETAIL ENTRY REPORT OUTPUT TABLE                               06350006
063600*---------------------------------------------------------------  06360006
063700     EXEC SQL                                                     06370006
063800          INCLUDE TOUTAP6                                         06380006
063900     END-EXEC.                                                    06390006
064000 EJECT                                                            06400006
064100*---------------------------------------------------------------  06410006
064200*  CHECKPOINT/RESTART CONTROL TABLE                               06420006
064300*---------------------------------------------------------------  06430006
064400     EXEC SQL                                                     06440006
064500         INCLUDE TCKRSTCN                                         06450006
064600     END-EXEC.                                                    06460006
064700 EJECT                                                            06470006
064800*---------------------------------------------------------------  06480006
064900*  CHECKPOINT/RESTART DATA TABLE                                  06490006
065000*---------------------------------------------------------------  06500006
065100     EXEC SQL                                                     06510006
065200         INCLUDE TCKRSTIN                                         06520006
065300     END-EXEC.                                                    06530006
065400 EJECT                                                            06540006
065500*---------------------------------------------------------------  06550006
065600*  INVOICE EXTRACT LAYOUT                                         06560006
065700*---------------------------------------------------------------  06570006
065800     COPY APRD060.                                                06580006
065900 EJECT                                                            06590006
066000*---------------------------------------------------------------  06600006
066100*  RECEIVING SUMMED BY PO/STR LAYOUT                              06610006
066200*---------------------------------------------------------------  06620006
066300     COPY APRD020.                                                06630006
066400 EJECT                                                            06640006
066500*---------------------------------------------------------------  06650006
066600*  INVOICES REQUIRING DETAIL ENTRY LAYOUT                         06660006
066700*---------------------------------------------------------------  06670006
066800     COPY APRD271.                                                06680006
066900 EJECT                                                            06690006
067000*---------------------------------------------------------------  06700006
067100*  ABEND DATA AREAS                                               06710006
067200*---------------------------------------------------------------  06720006
067300 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          06730006
067400                                             COMP SYNC.           06740006
067500     88  AC-CC-ERROR                         VALUE +4004.         06750026
067510     88  AC-INVALID-DATA                     VALUE +4008.         06751026
067600     88  AC-TABLE-OVERFLOW                   VALUE +4004.         06760006
067700     88  AC-DB2-ERROR                        VALUE +4013.         06770006
067800     88  AC-DATE-ERROR                       VALUE +4019.         06780006
067900                                                                  06790006
068000                                                                  06800006
068100 01  ABEND-AREAS.                                                 06810006
068200     05  AA-ABEND-LIT            PIC  X(40)  VALUE                06820006
068300             '*****       ABEND'.                                 06830006
068400     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                06840006
068500             '*****   PROGRAM: APKUP250'.                         06850006
068600     05  AA-PARAGRAPH-LIT.                                        06860006
068700         10  FILLER              PIC  X(17)  VALUE                06870006
068800             '***** PARAGRAPH: '.                                 06880006
068900         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        06890006
069000     05  AA-MESSAGE-LINE.                                         06900006
069100         10  FILLER              PIC  X(06)  VALUE '*****'.       06910006
069200         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        06920006
069300         10  FILLER REDEFINES AA-MESSAGE.                         06930006
069400             15 AA-MESSAGE-1     PIC  X(45).                      06940006
069500             15 AA-MESSAGE-2     PIC  X(45).                      06950006
069600             15 AA-MESSAGE-3     PIC  X(37).                      06960006
069700     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                06970006
069800             '*****    DB2 ERROR'.                                06980006
069900     05  AA-DB2-OPERATION-LIT.                                    06990006
070000         10  FILLER              PIC  X(17)  VALUE                07000006
070100             '***** OPERATION: '.                                 07010006
070200         10  AA-DB2-OPERATION.                                    07020006
070300             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        07030006
070400             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        07040006
070500     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        07050006
070600     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        07060006
070700     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        07070006
070800                                                                  07080006
070900                                                                  07090006
071000     COPY DPWS004.                                                07100006
071100 01  FILLER                      PIC  X(25)  VALUE                07110006
071200     '** END OF APKUP250 W/S **'.                                 07120006
071300 EJECT                                                            07130006
071400 PROCEDURE DIVISION.                                              07140006
071500 A100-MAIN.                                                       07150006
071600                                                                  07160006
071700     PERFORM B100-INITIALIZE.                                     07170006
071800                                                                  07180006
071900     PERFORM B200-PROCESS-PO-STRS                                 07190006
072000         UNTIL OUT-OF-INVOICES.                                   07200006
072100                                                                  07210006
072200     PERFORM B300-END-PROGRAM.                                    07220006
072300                                                                  07230006
072400     GOBACK.                                                      07240006
072500 EJECT                                                            07250006
072600*---------------------------------------------------------------  07260006
072700*    INITIALIZATION PROCESSING                                    07270006
072800*---------------------------------------------------------------  07280006
072900 B100-INITIALIZE.                                                 07290006
073000                                                                  07300006
073100     OPEN INPUT  INVOICE-FILE                                     07310006
073200                 RECEIVER-PO-STR-FILE.                            07320013
073300                                                                  07330006
073400     INITIALIZE DCLTAPCNTL                                        07340006
073500                DCLTAPVNDS                                        07350006
073600                DCLTPURCHS                                        07360006
073700                DCLTINVOIC                                        07370006
073800                DCLTALCHRG                                        07380006
073900                DCLTCKRSTCNTL                                     07390006
074000                DCLTCKRSTINF                                      07400006
074100                IA-INVOICE-ARRAY.                                 07410006
074200                                                                  07420006
074300     PERFORM R400-SELECT-CONTROL-DATA.                            07430006
074400     MOVE APCNTL-BTCH-PRC-DTE       TO PV-BTCH-TMST(1:10).        07440006
074500     MOVE '-09.09.09.999999'        TO PV-BTCH-TMST(11:16).       07450006
074600                                                                  07460006
074610     ACCEPT CONTROL-PARAMETERS.                                   07461026
074620     DISPLAY 'CONTROL CARD LIMITS = ' CONTROL-PARAMETERS.         07462026
074621                                                                  07462126
074622     IF  CC-WEEKDAY-LIMIT NUMERIC                                 07462226
074623     AND CC-FRIDAY-LIMIT NUMERIC                                  07462326
074624     AND CC-SATURDAY-LIMIT NUMERIC                                07462426
074625         MOVE CC-WEEKDAY-LIMIT  TO WEEKDAY-LIMIT                  07462526
074626         MOVE CC-FRIDAY-LIMIT   TO FRIDAY-LIMIT                   07462626
074627         MOVE CC-SATURDAY-LIMIT TO SATURDAY-LIMIT                 07462726
074628         DISPLAY 'WEEKDAY LIMIT = ' WEEKDAY-LIMIT                 07462826
074629         DISPLAY 'FRIDAY LIMIT = '  FRIDAY-LIMIT                  07462926
074630         DISPLAY 'SATURDAY LIMIT = ' SATURDAY-LIMIT               07463026
074631     ELSE                                                         07463126
074632         SET AC-CC-ERROR TO TRUE                                  07463226
074633         MOVE 'B100-INITIALIZATION' TO AA-PARAGRAPH-NAME          07463326
074634         MOVE 'INVALID CONTROL CARD' TO AA-MESSAGE-1              07463426
074635         PERFORM Z999-ABEND                                       07463526
074636     END-IF.                                                      07463626
074640                                                                  07464026
074700** CALENDAR ROUTINE CALL FINDS THE DAY OF THE WEEK USING          07470006
074800** BATCH CONTROL DATE TO DETERMINE IF IT IS A DEFER RELEASE DAY   07480006
074900     INITIALIZE DPG51                                             07490006
075000                DPG52                                             07500006
075100                DPG53                                             07510006
075200                DPG54                                             07520006
075300                DPG55                                             07530006
075400                DPG56.                                            07540006
075500                                                                  07550006
075600     SET  DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                     07560006
075700     SET  DPG52-LK-DTE-ISO-FMT       TO TRUE.                     07570006
075800     MOVE APCNTL-BTCH-PRC-DTE        TO DPG52-LK-DATE-INPUT.      07580006
075900     DISPLAY 'CURRENT DATE  ' DPG52-LK-DATE-INPUT                 07590006
076000                                                                  07600006
076100     PERFORM Z900-CALENDAR-ROUTINE.                               07610006
076200     DISPLAY 'WEEK DAY  ' DPG55-ALPHA-WEEK-DAY.                   07620006
076300                                                                  07630006
076400*    IF  DPG55-ALPHA-WEEK-DAY-WEDNESDAY                           07640017
076500*        SET TODAY-IS-DEFER-RLSE TO TRUE                          07650017
076600*        MOVE PV-DATE-PLUS-14  TO PV-PAY-THRU-DATE                07660017
076700*    ELSE                                                         07670017
076810*        IF  DPG55-ALPHA-WEEK-DAY-THURSDAY                        07681017
076900*            SET TODAY-IS-DEFER-RLSE TO TRUE                      07690006
077000*            MOVE PV-DATE-PLUS-25  TO PV-PAY-THRU-DATE            07700006
077100*        ELSE                                                     07710006
077200*            IF  DPG55-ALPHA-WEEK-DAY-FRIDAY                      07720017
077300*                SET TODAY-IS-DEFER-RLSE TO TRUE                  07730017
077400*                MOVE PV-DATE-PLUS-29  TO PV-PAY-THRU-DATE        07740017
077500*            ELSE                                                 07750017
077600*                SET TODAY-IS-NOT-DEFER-RLSE TO TRUE              07760017
077700*            END-IF                                               07770017
077800*        END-IF                                                   07780006
077900*    END-IF.                                                      07790017
078000                                                                  07800006
078010     SET TODAY-IS-NOT-DEFER-RLSE TO TRUE.                         07801017
078020                                                                  07802017
078100     IF  TODAY-IS-DEFER-RLSE                                      07810006
078200         DISPLAY 'DEFERRING RELEASES UNLESS DUE ON OR BEFORE '    07820006
078300                  PV-PAY-THRU-DATE                                07830006
078400     ELSE                                                         07840006
078500         DISPLAY 'NOT DEFERRING RELEASES TODAY'                   07850006
078600     END-IF.                                                      07860006
078700                                                                  07870006
078800     MOVE PV-PAY-THRU-DATE(1:4)     TO PV-PAY-THRU-DATE-YEAR.     07880006
078900     MOVE PV-PAY-THRU-DATE(6:2)     TO PV-PAY-THRU-DATE-MM.       07890006
079000     MOVE PV-PAY-THRU-DATE(9:2)     TO PV-PAY-THRU-DATE-DD.       07900006
079100                                                                  07910006
079200     IF  DPG55-ALPHA-WEEK-DAY-MONDAY                              07920006
079300     OR  DPG55-ALPHA-WEEK-DAY-TUESDAY                             07930006
079400     OR  DPG55-ALPHA-WEEK-DAY-WEDNESDAY                           07940006
079500     OR  DPG55-ALPHA-WEEK-DAY-THURSDAY                            07950006
079600         MOVE WEEKDAY-LIMIT  TO RELEASE-LIMIT                     07960006
079700     ELSE                                                         07970006
079800         IF  DPG55-ALPHA-WEEK-DAY-FRIDAY                          07980006
079900             MOVE FRIDAY-LIMIT  TO RELEASE-LIMIT                  07990006
080000         ELSE                                                     08000006
080100             MOVE SATURDAY-LIMIT  TO RELEASE-LIMIT                08010006
080200         END-IF                                                   08020006
080300     END-IF.                                                      08030006
080400                                                                  08040006
080500     DISPLAY 'RELEASE LIMIT FOR THIS RUN IS ' RELEASE-LIMIT.      08050006
080600                                                                  08060006
080700     PERFORM R900-SET-CURRENT-TMST.                               08070006
080800                                                                  08080006
080900     PERFORM R980-SELECT-CHECKPOINT-CNTL.                         08090006
081000     IF RESTART-RUN                                               08100006
081100         PERFORM R990-SELECT-CHECKPOINT-INFO                      08110006
081200         MOVE TCKRSTINF-WORK-STRG-DESC-TEXT                       08120006
081300                                    TO CR-CKPT-RESTART-INFO       08130006
081400                                                                  08140006
081500         DISPLAY '** APKUP250 CHECKPOINT RESTART **'              08150006
081600         DISPLAY '** PO NUMBER ON RESTART = '  CR-PO-NBR          08160006
081700         DISPLAY '** STR NUMBER ON RESTART= '  CR-STR-NBR         08170006
081800         DISPLAY '***********************************************'08180006
081900                                                                  08190006
082000         PERFORM R100-READ-INVOICES                               08200006
082100             UNTIL (AP060-PO-NBR          > CR-PO-NBR)            08210006
082200                OR (AP060-PO-NBR          = CR-PO-NBR             08220006
082300                   AND AP060-MTCH-LOC-NBR > CR-STR-NBR)           08230006
082400                OR OUT-OF-INVOICES                                08240006
082500                                                                  08250006
082600         MOVE CR-INVCS-RL-COUNT    TO PA-INVCS-RL-COUNT           08260006
082700         MOVE CR-INVCS-RC-COUNT    TO PA-INVCS-RC-COUNT           08270006
082800         MOVE CR-INVCS-DF-COUNT    TO PA-INVCS-DF-COUNT           08280006
082900         MOVE CR-MATCH-COUNT       TO PA-MATCH-COUNT              08290006
083000         MOVE CR-AUTO-RECON-COUNT  TO PA-AUTO-RECON-COUNT         08300006
083100                                                                  08310006
083200         IF  PA-INVCS-RL-COUNT > RELEASE-LIMIT                    08320006
083300             SET TODAY-IS-DEFER-RLSE TO TRUE                      08330006
083400             MOVE DEFER-ALL-DATE TO PV-PAY-THRU-DATE-NBR          08340006
083500             DISPLAY 'DEFERRING ALL INVOICES FROM THIS POINT - '  08350006
083600                     'LIMIT OF ' RELEASE-LIMIT ' WAS EXCEEDED.'   08360006
083700         END-IF                                                   08370006
083800     ELSE                                                         08380006
083900                                                                  08390006
084000         PERFORM R100-READ-INVOICES                               08400006
084100*---------------------------------------------------------------  08410006
084200* THE FIRST READ SHOULD ALWAYS RETURN A RECORD.  IT WOULD HAVE    08420006
084300* TO BE AN EXCEPTIONAL SITUATION IF NO INVOICES WERE SELECTED     08430006
084400* THAT MEET BATCH MATCH OR AUTO RECON REQUIREMENTS.               08440006
084500*---------------------------------------------------------------  08450006
084600         IF OUT-OF-INVOICES                                       08460006
084700             MOVE 'B100-INITIALIZE'    TO AA-PARAGRAPH-NAME       08470006
084800             MOVE 'EMPTY INVOICE FILE' TO AA-MESSAGE              08480006
084900             PERFORM Z999-ABEND                                   08490006
085000         END-IF                                                   08500006
085100     END-IF.                                                      08510006
085200                                                                  08520006
085300     IF MORE-INVOICES                                             08530006
085400         PERFORM R200-READ-RCVR-PO-STR                            08540006
085500           UNTIL (AP020-PO-NBR      = AP060-PO-NBR                08550006
085600                  AND AP020-STR-NBR = AP060-MTCH-LOC-NBR)         08560006
085700              OR (AP020-PO-NBR      > AP060-PO-NBR)               08570006
085800              OR (AP020-PO-NBR      = AP060-PO-NBR                08580006
085900                  AND AP020-STR-NBR > AP060-MTCH-LOC-NBR)         08590006
086000              OR OUT-OF-RCVR-PO-STR                               08600006
086100     END-IF.                                                      08610006
086200 EJECT                                                            08620006
086300*---------------------------------------------------------------  08630006
086400*    CONTROLS THE PROCESSING OF EACH PO/STORE COMBINATION.        08640006
086500*                                                                 08650006
086600*    FOR A PO/STORE COMBINATION, THERE WILL BE ONE OR MANY        08660006
086700*    INVOICE RECORDS AND THERE MAY BE ZERO OR ONE MATCHING        08670006
086800*    RECEIVER PO/STORE RECORD.                                    08680006
086900*                                                                 08690006
087000*    IF THE PO AND STORE MATCH ON THE INVOICE AND THE RECEIVER    08700006
087100*    AND THE RECEIVER TOTAL AMOUNT IS GREATER THAN ZERO, SEE IF   08710006
087200*    THE INVOICE AND RECEIVER BATCH MATCH OR IF THEY ARE A        08720006
087300*    CANDIDATE FOR AUTO RECON.                                    08730006
087400*                                                                 08740006
087500*    IF THE PO AND STORE MATCH ON THE INVOICE AND THE RECEIVER    08750006
087600*    BUT THE RECEIVER TOTAL IS ZERO, SKIP TO THE NEXT INVOICE.    08760006
087700*                                                                 08770006
087800*    IF THE PO AND STORE DO NOT MATCH BETWEEN THE INVOICE AND     08780006
087900*    THE RECEIVER, THIS MEANS THAT PO/STORE COMBINATION HAS NO    08790006
088000*    RECEIVING SO SKIP TO THE NEXT INVOICE.                       08800006
088100*---------------------------------------------------------------  08810006
088200 B200-PROCESS-PO-STRS.                                            08820006
088300                                                                  08830006
088400     IF (AP060-PO-NBR           = AP020-PO-NBR                    08840006
088500         AND AP060-MTCH-LOC-NBR = AP020-STR-NBR)                  08850006
088600         IF AP020-RECV-TOT-COST-AMT > 0                           08860006
088700             PERFORM C100-COMPARE-PO-STR                          08870006
088800         ELSE                                                     08880006
088900             PERFORM R100-READ-INVOICES                           08890006
089000         END-IF                                                   08900006
089100     ELSE                                                         08910006
089200         PERFORM R100-READ-INVOICES                               08920006
089300     END-IF.                                                      08930006
089400                                                                  08940006
089500     IF MORE-INVOICES                                             08950006
089600         PERFORM R200-READ-RCVR-PO-STR                            08960006
089700           UNTIL (AP020-PO-NBR      = AP060-PO-NBR                08970006
089800                  AND AP020-STR-NBR = AP060-MTCH-LOC-NBR)         08980006
089900              OR (AP020-PO-NBR      > AP060-PO-NBR)               08990006
090000              OR (AP020-PO-NBR      = AP060-PO-NBR                09000006
090100                  AND AP020-STR-NBR > AP060-MTCH-LOC-NBR)         09010006
090200              OR OUT-OF-RCVR-PO-STR                               09020006
090300     END-IF.                                                      09030006
090400 EJECT                                                            09040006
090500*---------------------------------------------------------------  09050006
090600*    ENDING PROCESSING: DISPLAYS COUNT OF POS AND CLOSES FILES.   09060006
090700*---------------------------------------------------------------  09070006
090800 B300-END-PROGRAM.                                                09080006
090900                                                                  09090006
091000     DISPLAY '---------------------------------------------'.     09100006
091100     DISPLAY 'INVOICES READ          = ' PA-INVOICE-COUNT.        09110006
091200     DISPLAY 'RECEIVER PO/STRS READ  = ' PA-RCVR-PO-STR-COUNT.    09120006
091300     DISPLAY '                                             '.     09130006
091400     DISPLAY 'INVOICES RELEASED      = ' PA-INVCS-RL-COUNT.       09140006
091500     DISPLAY 'INVOICES DEFERRED      = ' PA-INVCS-DF-COUNT.       09150006
091600     DISPLAY 'INVOICES UPDATED TO RC = ' PA-INVCS-RC-COUNT.       09160006
091700     DISPLAY '                                             '.     09170006
091800     DISPLAY 'PO/STRS MATCHED        = ' PA-MATCH-COUNT.          09180006
091900     DISPLAY 'PO/STRS FOR AUTO RECON = ' PA-AUTO-RECON-COUNT.     09190006
092000     DISPLAY '---------------------------------------------'.     09200006
092100                                                                  09210006
092200     CLOSE  INVOICE-FILE                                          09220006
092300            RECEIVER-PO-STR-FILE.                                 09230013
092400                                                                  09240006
092500     MOVE PC-RUN-COMPLETE-CODE TO CR-CKPT-STAT-CODE.              09250006
092600     PERFORM U500-UPDATE-CHECKPOINT-CNTL.                         09260006
092700                                                                  09270006
092800     INITIALIZE CR-CKPT-RESTART-INFO.                             09280006
092900     MOVE CR-CKPT-RESTART-INFO TO TCKRSTINF-WORK-STRG-DESC-TEXT.  09290006
093000     MOVE 4022                 TO TCKRSTINF-WORK-STRG-DESC-LEN.   09300006
093100     PERFORM U510-UPDATE-CHECKPOINT-INFO.                         09310006
093200                                                                  09320006
093300     PERFORM Z100-COMMIT.                                         09330006
093400 EJECT                                                            09340006
093500*---------------------------------------------------------------  09350006
093600*    CONTROLS THE COMPARISON OF THE TOTAL INVOICE AND RECEIPT     09360006
093700*    GROSS COSTS FOR A PO/STORE AND DETERMINES THE ACTION TO      09370006
093800*    BE TAKEN BASED ON THE COMPARISON.                            09380006
093900*    AT THE END OF PROCESSING EACH PO/STORE, SWITCHES ARE         09390006
094000*    RESET AND WS FIELDS ARE INITIALIZED.                         09400006
094100*---------------------------------------------------------------  09410006
094200 C100-COMPARE-PO-STR.                                             09420006
094300                                                                  09430006
094400     IF  AP060-PO-NBR  = PV-SAVED-PO-NBR                          09440006
094500         CONTINUE                                                 09450006
094600     ELSE                                                         09460006
094700         SET WRITE-DETAIL-HEADER  TO TRUE                         09470006
094800         MOVE AP060-PO-NBR        TO PV-SAVED-PO-NBR              09480006
094900                                                                  09490006
095000         PERFORM R500-SELECT-VENDOR-TOLERANCE                     09500006
095100         IF USE-SPECIFIED-TOLERANCE                               09510006
095200             MOVE APVNDS-INVC-RCV-VAR-PCT TO PV-INVC-RCV-VAR-PCT  09520006
095300             MOVE APVNDS-INVC-RCV-VAR-AMT TO PV-INVC-RCV-VAR-AMT  09530006
095400         ELSE                                                     09540006
095500             MOVE APCNTL-INVC-RCV-VAR-PCT TO PV-INVC-RCV-VAR-PCT  09550006
095600             MOVE APCNTL-INVC-RCV-VAR-AMT TO PV-INVC-RCV-VAR-AMT  09560006
095700         END-IF                                                   09570006
095800     END-IF.                                                      09580006
095900                                                                  09590006
096000     MOVE AP060-MTCH-LOC-NBR      TO PV-SAVED-STR-NBR.            09600006
096100     MOVE AP060-VENDOR-NUMBER     TO PV-SAVED-VENDOR-NBR.         09610006
096200     MOVE AP060-VENDOR-NAME       TO PV-SAVED-VENDOR-NAME.        09620006
096300     MOVE AP060-INVOICE-STATUS    TO PV-SAVED-INVC-STATUS.        09630006
096400     MOVE AP060-PO-TYP-CDE        TO PV-SAVED-PO-TYP-CDE.         09640006
096500     MOVE AP060-MTCH-LVL-CDE      TO PV-SAVED-MTCH-LVL-CDE.       09650006
096510     MOVE AP060-INVOICE-TYPE      TO PV-SAVED-INVC-TYP-CDE.       09651016
096600                                                                  09660006
096700     PERFORM D100-GET-ALL-INVOICES                                09670006
096800         UNTIL (AP060-PO-NBR           > PV-SAVED-PO-NBR)         09680006
096900            OR (AP060-PO-NBR           = PV-SAVED-PO-NBR          09690006
097000                AND AP060-MTCH-LOC-NBR > PV-SAVED-STR-NBR)        09700006
097100            OR OUT-OF-INVOICES.                                   09710006
097200                                                                  09720006
097300     MOVE AP020-RECV-TOT-COST-AMT TO PA-TOT-RECD-AMT.             09730006
097400     PERFORM D200-CALC-TOLERANCE.                                 09740006
097500                                                                  09750006
097600     PERFORM D300-CALC-DIFFERENCE.                                09760006
097700                                                                  09770006
097800*---------------------------------------------------------------  09780006
097900*  - IF THE INVOICE TOTAL COSTS AND THE RECEIPT TOTAL COSTS ARE   09790006
098000*    EQUAL OR WITHIN TOLERANCE PERCENTS AND BELOW THE TOLERANCE   09800006
098100*    DOLLAR LEVEL, OR IF THE PO IS AN IMPORT AND THE STATUS IS    09810006
098200*    BM (BATCH MATCH IMPORT), AND THIS PO IS NOT ELIGIBLE FOR     09820006
098300*    DEFERRED RELEASE BASED ON DUE DATES, IT IS CONSIDERED MATCHED09830006
098400*    AND THE MATCHED PROCESSING TAKES PLACE.                      09840006
098500*                                                                 09850006
098600*  - IF THE INVOICE TOTAL COSTS ARE BEYOND THE UPPER OR LOWER     09860006
098700*    TOLERANCE LIMITS, IT IS CONSIDERED NOT MATCHED.  IT IS       09870006
098800*    NECESSARY TO DETERMINE WHETHER RECONCILIATION IS REQUIRED.   09880006
098900*---------------------------------------------------------------  09890006
099000     IF PA-TOT-GROSS-AMT = PA-TOT-RECD-AMT                        09900006
099100        OR (PA-TOT-GROSS-AMT <= PA-UPPER-TOL-PCT-AMT              09910006
099200            AND PA-TOT-GROSS-AMT >= PA-LOWER-TOL-PCT-AMT          09920006
099300            AND PA-DIFFERENCE-AMT < PV-INVC-RCV-VAR-AMT)          09930006
099400        OR ((PV-SAVED-PO-TYP-CDE = 'IM' OR 'IE' OR 'IF')          09940006
099500            AND PV-SAVED-INVC-STATUS = 'BM')                      09950006
099600        OR (PV-SAVED-INVC-TYP-CDE = 'WO'                          09960016
099700            AND PA-DIFFERENCE-AMT < PV-INVC-RCV-VAR-AMT)          09970008
099800                                                                  09980006
099900         IF TODAY-IS-DEFER-RLSE AND DEFER-RELEASE                 09990006
100000             MOVE IA-SUB-MAX    TO PA-MISC-COUNT                  10000006
100100             ADD PA-MISC-COUNT  TO PA-INVCS-DF-COUNT              10010006
100200         ELSE                                                     10020006
100300             PERFORM D400-MATCH-PROCESSING                        10030006
100400         END-IF                                                   10040006
100500     ELSE                                                         10050006
100600         IF PA-TOT-GROSS-AMT > PA-UPPER-TOL-PCT-AMT               10060006
100700         OR PA-TOT-GROSS-AMT < PA-LOWER-TOL-PCT-AMT               10070006
100800         OR PA-DIFFERENCE-AMT > PV-INVC-RCV-VAR-AMT               10080006
100900             PERFORM D500-DETERMINE-RECON                         10090006
101000         END-IF                                                   10100006
101100                                                                  10110006
101200     END-IF.                                                      10120006
101300                                                                  10130006
101400     PERFORM R900-SET-CURRENT-TMST.                               10140006
101500     IF CR-CURR-TMST > CR-NEXT-TMST                               10150006
101600         IF NO-COMMITS-TAKEN                                      10160006
101700             MOVE PC-IN-PROCESS-CODE  TO CR-CKPT-STAT-CODE        10170006
101800             PERFORM U500-UPDATE-CHECKPOINT-CNTL                  10180006
101900             SET COMMITS-TAKEN        TO TRUE                     10190006
102000         END-IF                                                   10200006
102100         PERFORM D600-CHECKPOINT-COMMIT                           10210006
102200     END-IF.                                                      10220006
102300                                                                  10230006
102400     IF  PV-PAY-THRU-DATE-NBR = DEFER-ALL-DATE                    10240006
102500         CONTINUE                                                 10250006
102600     ELSE                                                         10260006
102700         IF  PA-INVCS-RL-COUNT > RELEASE-LIMIT                    10270006
102800             SET TODAY-IS-DEFER-RLSE TO TRUE                      10280006
102900             MOVE DEFER-ALL-DATE TO PV-PAY-THRU-DATE-NBR          10290006
103000             DISPLAY 'DEFERRING ALL INVOICES FROM THIS POINT - '  10300006
103100                     'LIMIT OF ' RELEASE-LIMIT ' WAS EXCEEDED.'   10310006
103200         END-IF                                                   10320006
103300     END-IF.                                                      10330006
103400                                                                  10340006
103500     SET EDI-PO                                                   10350006
103600         PAYMENT-NOT-DUE                                          10360006
103700         DETAIL-ENTERED                                           10370006
103800         DEFER-RELEASE                                            10380006
103900         NO-MERCH-INVOICE-EXIST                                   10390006
104000         NO-REMAIN-INVOICE-EXIST                                  10400006
104100         NO-WRITE-OFF-INV-EXIST   TO TRUE.                        10410006
104200                                                                  10420006
104300     PERFORM                                                      10430006
104400         VARYING IA-SUB FROM 1 BY 1                               10440006
104500           UNTIL IA-SUB > IA-SUB-MAX                              10450006
104600         INITIALIZE IA-INVOICES (IA-SUB)                          10460006
104700     END-PERFORM.                                                 10470006
104800                                                                  10480006
104900     MOVE ZEROS TO IA-SUB                                         10490006
105000                   IA-SUB-MAX                                     10500006
105100                   PA-TOT-GROSS-AMT                               10510006
105200                   PA-TOT-RECD-AMT                                10520006
105300                   PA-DIFFERENCE-AMT                              10530006
105400                   PA-TOLERANCE-PCT-AMT                           10540006
105500                   PA-LOWER-TOL-PCT-AMT                           10550006
105600                   PA-UPPER-TOL-PCT-AMT                           10560006
105700                   PA-TOTAL-DISCOUNT-AMT                          10570006
105800                   PA-WEIGHTED-DISCOUNT-PCT.                      10580006
105900 EJECT                                                            10590006
106000*---------------------------------------------------------------  10600006
106100*    FOR EACH INVOICE REOUTINES ARE CALLED TO LOAD THE INTERNAL   10610006
106200*    INVOICE ARRAY AND ACCUMULATE THE GROSS INVOICE COST AND THE  10620006
106300*    DISCOUNT AMOUNTS.                                            10630006
106400*---------------------------------------------------------------  10640006
106500 D100-GET-ALL-INVOICES.                                           10650006
106600                                                                  10660006
106700     PERFORM E100-LOAD-INVOICE-ARRAY.                             10670006
106800                                                                  10680006
106900     PERFORM E200-TOTAL-INVOICE-COST.                             10690006
107000                                                                  10700006
107100     IF MORE-INVOICES                                             10710006
107200         PERFORM R100-READ-INVOICES                               10720006
107300     END-IF.                                                      10730006
107400 EJECT                                                            10740006
107500*---------------------------------------------------------------  10750006
107600*    CALCULATES THE UPPER AND LOWER BOUNDARIES FOR TOLERANCE      10760006
107700*    BASED ON THE TOTAL COST OF THE RECEIPTS.                     10770006
107800*---------------------------------------------------------------  10780006
107900 D200-CALC-TOLERANCE.                                             10790006
108000                                                                  10800006
108100     IF WRITE-OFF-INV-EXIST                                       10810006
108200         MOVE ZERO   TO PA-TOLERANCE-PCT-AMT                      10820006
108300     ELSE                                                         10830006
108400         COMPUTE PV-DECIMAL8                                      10840006
108500            =    PV-INVC-RCV-VAR-PCT                              10850006
108600            /    100                                              10860006
108700         COMPUTE PA-TOLERANCE-PCT-AMT ROUNDED =                   10870006
108800              PA-TOT-RECD-AMT * PV-DECIMAL8                       10880006
108900     END-IF.                                                      10890006
109000                                                                  10900006
109100                                                                  10910006
109200** WR#21578 NOTE: UPPER TOLERANCE PERCENT AMOUNT WILL NOW BE EQUAL10920010
109300**                TO THE TOTAL RECEIPTS AMOUNT.                   10930010
109400**                                                                10940010
109500*    COMPUTE PA-UPPER-TOL-PCT-AMT =                               10950010
109600*        PA-TOT-RECD-AMT + PA-TOLERANCE-PCT-AMT.                  10960010
109700     MOVE PA-TOT-RECD-AMT TO PA-UPPER-TOL-PCT-AMT.                10970010
109800                                                                  10980010
109900     COMPUTE PA-LOWER-TOL-PCT-AMT =                               10990010
110000         PA-TOT-RECD-AMT - PA-TOLERANCE-PCT-AMT.                  11000010
110100 EJECT                                                            11010010
110200*---------------------------------------------------------------  11020010
110300*    CALCULATES THE DIFFERENCE BETWEEN THE TOTAL COST OF THE      11030010
110400*    INVOICES AND THE TOTAL COST OF THE RECEIPTS.                 11040010
110500*---------------------------------------------------------------  11050010
110600 D300-CALC-DIFFERENCE.                                            11060010
110700                                                                  11070010
110800     EVALUATE TRUE                                                11080010
110900                                                                  11090010
111000         WHEN PA-TOT-GROSS-AMT = PA-TOT-RECD-AMT                  11100010
111100             MOVE ZEROS  TO PA-DIFFERENCE-AMT                     11110010
111200                                                                  11120010
111300         WHEN PA-TOT-GROSS-AMT > PA-TOT-RECD-AMT                  11130010
111400             SUBTRACT PA-TOT-RECD-AMT FROM PA-TOT-GROSS-AMT       11140010
111500               GIVING PA-DIFFERENCE-AMT                           11150010
111600                                                                  11160010
111700         WHEN PA-TOT-GROSS-AMT < PA-TOT-RECD-AMT                  11170010
111800             SUBTRACT PA-TOT-GROSS-AMT FROM PA-TOT-RECD-AMT       11180010
111900               GIVING PA-DIFFERENCE-AMT                           11190010
112000                                                                  11200010
112100     END-EVALUATE.                                                11210010
112200 EJECT                                                            11220010
112300*---------------------------------------------------------------  11230010
112400*    MATCH PROCESSING CONSISTS OF THE FOLLOWING:                  11240010
112500*                                                                 11250010
112600*    - ADD AN ENTRY TO THE PO/STORE TABLE FOR RELEASED PO/STORE   11260010
112700*    - UPDATE THE STATUS CODE ON TINVOIC TO 'RL' (RELEASED)       11270010
112800*      FOR EACH INVOICE FOR THE RELEASED PO/STORE                 11280010
112900*    - INSERT A ROW TO THE AUDIT TABLE FOR EACH INVOICE UPDATED   11290010
113000*    - WRITE RECORDS TO THE MATCHED INVOICE FILE (A SINGLE        11300010
113100*      VENDOR RECORD, A RECORD FOR EACH INVOICE, AND A RECORD     11310010
113200*      FOR EACH RECEIVER SEQUENCE NUMBER)                         11320010
113300*---------------------------------------------------------------  11330010
113400 D400-MATCH-PROCESSING.                                           11340010
113500                                                                  11350010
113600     INITIALIZE DCLTPOSTRR.                                       11360010
113700                                                                  11370010
113800     EVALUATE TRUE                                                11380010
113900                                                                  11390010
114000         WHEN PA-TOT-GROSS-AMT = PA-TOT-RECD-AMT                  11400010
114100             MOVE ZEROS              TO POSTRR-TOLR-ADJ-AMT       11410010
114200             MOVE SPACES             TO POSTRR-TOLR-ADJ-CDE       11420010
114300                                                                  11430010
114400         WHEN PA-TOT-GROSS-AMT > PA-TOT-RECD-AMT                  11440010
114500             MOVE PA-DIFFERENCE-AMT  TO POSTRR-TOLR-ADJ-AMT       11450010
114600             MOVE PC-CREDIT-PURCHASE TO POSTRR-TOLR-ADJ-CDE       11460010
114700                                                                  11470010
114800         WHEN PA-TOT-GROSS-AMT < PA-TOT-RECD-AMT                  11480010
114900             MOVE PA-DIFFERENCE-AMT  TO POSTRR-TOLR-ADJ-AMT       11490010
115000             MOVE PC-DEBIT-PURCHASE  TO POSTRR-TOLR-ADJ-CDE       11500010
115100                                                                  11510010
115200     END-EVALUATE.                                                11520010
115300                                                                  11530010
115400     IF PA-TOT-GROSS-AMT = 0                                      11540010
115500        MOVE 0 TO PA-WEIGHTED-DISCOUNT-PCT                        11550010
115600     ELSE                                                         11560010
115700        DIVIDE PA-TOTAL-DISCOUNT-AMT BY PA-TOT-GROSS-AMT          11570010
115800            GIVING PA-WEIGHTED-DISCOUNT-PCT ROUNDED.              11580010
115900                                                                  11590010
116000     MOVE PA-WEIGHTED-DISCOUNT-PCT   TO POSTRR-WEIGHTED-DISC-PCT  11600010
116100     MOVE PA-TOTAL-DISCOUNT-AMT      TO POSTRR-TOTAL-DISC-AMT.    11610010
116200                                                                  11620010
116300     PERFORM U300-INSERT-POSTRR-MATCH.                            11630010
116400                                                                  11640010
116500     PERFORM E300-UPDT-INVC-RL-STATUS                             11650010
116600         VARYING IA-SUB FROM 1 BY 1                               11660010
116700         UNTIL IA-SUB > IA-SUB-MAX.                               11670010
116800                                                                  11680010
117400 EJECT                                                            11740010
117500*---------------------------------------------------------------  11750010
117600*   THIS PARAGRAPH IS CALLED WHEN THE TOTAL GROSS INVOICE COST    11760010
117700*   AND THE TOTAL RECEIVING COST DO NOT MATCH EXACTLY OR WITHIN   11770010
117800*   TOLERANCE.                                                    11780010
117900*                                                                 11790010
118000*   --   THE FOLLOWING CONDITION WAS REMOVED WITH WR21578  --     11800010
118100*     DETERMINE IF THE ONLY INVOICE THAT EXISTS IS A REMAINDER.   11810010
118200*     IF SO, THE PO/STORE NEEDS TO BE INCLUDED ON THE REMAINDER   11820010
118300*     INVOICE EXCEPTION REPORT AND NO OTHER PROCESSING IS DONE.   11830010
118400*   ------------------------------------------------------------- 11840010
118500*                                                                 11850010
118600*   DETERMINE WHETHER THE PO/STORE IS A CANDIDATE FOR AUTO RECON. 11860010
118700*   ONE OF THE FOLLOWING CONDITIONS MUST BE FULFILLED:            11870010
118800*    1. PAYMENT IS DUE, INVOICE DETAILS EXIST, AND AT LEAST ONE   11880010
118900*       OF THE INVOICE IS A MERCHANDISE INVOICE                   11890010
119000*       --- OR ---                                                11900010
119100*    2. THE INVOICE IS A REMAINDER INVOICE (WR21578)              11910010
119110*       --- OR ---                                                11911018
119111* NOTE THAT OPTION 3 HAS BEEN COMMENTED OUT, TO GIVE INVENTORY    11911129
119112* ADDITIONAL TIME TO CORRECT ISSUES WITH RECEIPTS FOR CD POS.     11911229
119113* THIS MAY BE REINSTATED AT A LATER TIME.                         11911329
119120*    3. THE PO IS A CONSUMER DIRECT PO                            11912018
119200*                                                                 11920010
119300*   OTHERWISE, IF PAYMENT IS DUE, A MANUAL RECONCILIATION IS      11930010
119400*   REQUIRED SO DO THE NO MATCH PROCESSING.                       11940010
119500*---------------------------------------------------------------  11950010
119600 D500-DETERMINE-RECON.                                            11960010
119700                                                                  11970010
119800*   WRITE OFF INVOICES                                            11980010
119900     IF WRITE-OFF-INV-EXIST                                       11990010
120000        CONTINUE                                                  12000010
120100     ELSE                                                         12010010
120200                                                                  12020010
120300*   AUTO RECON                                                    12030010
120400        IF  (PAYMENT-DUE AND DETAIL-ENTERED AND                   12040018
120500             MERCH-INVOICE-EXIST)                                 12050018
120700        OR  (NO-MERCH-INVOICE-EXIST AND REMAIN-INVOICE-EXIST)     12070018
120810***     OR  (PV-SAVED-PO-TYP-CDE = 'CD')                          12081029
120900            PERFORM U400-INSERT-POSTRR-RECON                      12090018
121000            PERFORM E800-NOMATCH-PROCESSING                       12100018
121100        ELSE                                                      12110010
121200                                                                  12120010
121300*   MANUAL RECON REQUIRED                                         12130010
121400           IF PAYMENT-DUE                                         12140010
121500              PERFORM E800-NOMATCH-PROCESSING                     12150010
121600           END-IF                                                 12160010
121700        END-IF                                                    12170010
121800     END-IF.                                                      12180010
121900 EJECT                                                            12190010
122000*---------------------------------------------------------------  12200010
122100*    UPDATE THE CHECKPOINT/RESTART TABLES AND THEN COMMIT         12210010
122200*---------------------------------------------------------------  12220010
122300 D600-CHECKPOINT-COMMIT.                                          12230010
122400                                                                  12240010
122500     MOVE PV-SAVED-PO-NBR      TO CR-PO-NBR.                      12250010
122600     MOVE PV-SAVED-STR-NBR     TO CR-STR-NBR.                     12260010
122700     MOVE PA-INVCS-RL-COUNT    TO CR-INVCS-RL-COUNT.              12270010
122800     MOVE PA-INVCS-RC-COUNT    TO CR-INVCS-RC-COUNT.              12280010
122900     MOVE PA-INVCS-DF-COUNT    TO CR-INVCS-DF-COUNT.              12290010
123000     MOVE PA-MATCH-COUNT       TO CR-MATCH-COUNT.                 12300010
123100     MOVE PA-AUTO-RECON-COUNT  TO CR-AUTO-RECON-COUNT.            12310010
123200     MOVE CR-CKPT-RESTART-INFO TO TCKRSTINF-WORK-STRG-DESC-TEXT.  12320010
123300     MOVE 4022                 TO TCKRSTINF-WORK-STRG-DESC-LEN.   12330010
123400     PERFORM U510-UPDATE-CHECKPOINT-INFO.                         12340010
123500                                                                  12350010
123600     PERFORM Z100-COMMIT.                                         12360010
123700                                                                  12370010
123800     PERFORM R910-SET-NEXT-CKPT-TMST.                             12380010
123900 EJECT                                                            12390010
124000*---------------------------------------------------------------  12400010
124100*    LOADS THE INTERNAL INVOICE ARRAY.                            12410010
124200*---------------------------------------------------------------  12420010
124300 E100-LOAD-INVOICE-ARRAY.                                         12430010
124400                                                                  12440010
124500     ADD 1 TO IA-SUB                                              12450010
124600              IA-SUB-MAX.                                         12460010
124700                                                                  12470010
124800     IF IA-SUB-MAX > IA-SUB-LIMIT                                 12480010
124900         SET AC-TABLE-OVERFLOW           TO TRUE                  12490010
125000         DISPLAY 'PO    = ' PV-SAVED-PO-NBR                       12500010
125100         DISPLAY 'STORE = ' PV-SAVED-STR-NBR                      12510010
125200         MOVE 'E100-LOAD-INVOICE-ARRAY'  TO AA-PARAGRAPH-NAME     12520010
125300         MOVE 'INVOICE ARRAY EXCEEDS LIMIT'                       12530010
125400                                         TO AA-MESSAGE            12540010
125500         PERFORM Z999-ABEND                                       12550010
125600     END-IF.                                                      12560010
125700                                                                  12570010
125800     MOVE AP060-MTCH-LOC-NBR     TO IA-STR-NBR           (IA-SUB).12580010
125900     MOVE AP060-INVOICE-NUMBER   TO IA-INVOICE-ID        (IA-SUB).12590010
126000                                                                  12600010
126100     MOVE AP060-INVOICE-TYPE     TO IA-INVOICE-TYPE      (IA-SUB).12610010
126200     EVALUATE TRUE                                                12620010
126300         WHEN AP060-MERCHANDISE-INVOICE                           12630010
126400             SET MERCH-INVOICE-EXIST     TO TRUE                  12640010
126500         WHEN AP060-REMAINDER-INVOICE                             12650010
126600             SET REMAIN-INVOICE-EXIST    TO TRUE                  12660010
126700         WHEN AP060-WRITEOFF-INVOICE                              12670010
126800             SET WRITE-OFF-INV-EXIST     TO TRUE                  12680010
126900     END-EVALUATE.                                                12690010
127000                                                                  12700010
127100     MOVE AP060-INVOICE-STATUS   TO IA-INVOICE-STATUS    (IA-SUB).12710010
127200     MOVE AP060-INVOICE-DATE     TO IA-INVOICE-DATE      (IA-SUB).12720010
127300                                                                  12730010
127400     MOVE AP060-ENTRY-METHOD     TO IA-ENTRY-METHOD      (IA-SUB).12740010
127500     IF AP060-MANUAL-ENTRY                                        12750010
127600         SET MANUAL-PO           TO TRUE                          12760010
127700     END-IF.                                                      12770010
127800                                                                  12780010
127900     MOVE AP060-GROSS-COST-AMT   TO IA-GROSS-COST-AMT    (IA-SUB).12790010
128000     MOVE AP060-TOT-INVOICE-QTY  TO IA-TOT-INVOICE-QTY   (IA-SUB).12800010
128100                                                                  12810010
128200     MOVE AP060-PAYT-REQ-SEQ-NBR TO IA-PAYT-REQ-SEQ-NBR  (IA-SUB).12820010
128300     MOVE AP060-ENTRY-DATE       TO IA-ENTRY-DATE        (IA-SUB).12830010
128400                                                                  12840010
128500     MOVE AP060-DTL-ENTR-IND     TO IA-DTL-ENTR-IND      (IA-SUB).12850010
128600     IF AP060-DTL-ENTR-IND = 'N'                                  12860010
128700        SET NO-DETAIL-ENTERED    TO TRUE                          12870010
128800     END-IF.                                                      12880010
128900                                                                  12890010
129000     MOVE AP060-DUE-DATE         TO IA-DUE-DATE          (IA-SUB).12900010
129100     MOVE AP060-CUTOFF-DATE      TO IA-CUTOFF-DATE       (IA-SUB).12910010
129200                                                                  12920010
129300     MOVE AP060-TERMS-SEL-CDE    TO IA-TERMS-SEL-CDE     (IA-SUB).12930010
129400     MOVE AP060-TERMS-DISC-PCT   TO IA-TERMS-DISC-PCT    (IA-SUB).12940010
129500     MOVE AP060-TERMS-DUE-DAY-QTY                                 12950010
129600                                 TO IA-TERMS-DUE-DAY-QTY (IA-SUB).12960010
129700     MOVE AP060-TERMS-EXT-DAY-QTY                                 12970010
129800                                 TO IA-TERMS-EXT-DAY-QTY (IA-SUB).12980010
129900     MOVE AP060-EOM-INDICATOR    TO IA-EOM-INDICATOR     (IA-SUB).12990010
130000                                                                  13000010
130100     MOVE AP060-PAYMENT-DUE-SW   TO IA-PAYMENT-DUE-SW    (IA-SUB).13010010
130200     IF AP060-PAYMENT-DUE                                         13020010
130300         SET PAYMENT-DUE         TO TRUE                          13030010
130400     END-IF.                                                      13040010
130500                                                                  13050010
130600     IF  TODAY-IS-DEFER-RLSE                                      13060010
130700     AND (AP060-DUE-DATE <= PV-PAY-THRU-DATE-NBR)                 13070010
130800         SET RELEASE-OK TO TRUE                                   13080010
130900     END-IF.                                                      13090010
131000                                                                  13100010
131100     MOVE AP060-DUE-DTE-SRC-CDE  TO IA-DUE-DTE-SRC-CDE   (IA-SUB).13110010
131200     MOVE SPACES                 TO IA-STATUS-CHG-DATE   (IA-SUB) 13120010
131300                                    IA-ENTER-USERID      (IA-SUB) 13130010
131400                                    IA-INVOICE-INCL-SW   (IA-SUB) 13140010
131500                                    IA-HOLD-IND          (IA-SUB).13150010
131600 EJECT                                                            13160010
131700*---------------------------------------------------------------  13170010
131800*    SUMS THE TOTAL GROSS COST AND CALCULATES THE DISCOUNT        13180010
131900*    AMOUNT FOR EACH INVOICE FOR THE CURRENT PO/STORE.            13190010
132000*---------------------------------------------------------------  13200010
132100 E200-TOTAL-INVOICE-COST.                                         13210010
132200                                                                  13220010
132300     ADD IA-GROSS-COST-AMT (IA-SUB)    TO PA-TOT-GROSS-AMT.       13230010
132400                                                                  13240010
132500     COMPUTE PV-DECIMAL8                                          13250010
132600        =  IA-GROSS-COST-AMT (IA-SUB)                             13260010
132700           * IA-TERMS-DISC-PCT (IA-SUB).                          13270010
132800     COMPUTE PA-TOTAL-DISCOUNT-AMT ROUNDED                        13280010
132900         = PA-TOTAL-DISCOUNT-AMT                                  13290010
133000           + PV-DECIMAL8.                                         13300010
133100                                                                  13310010
133200     MOVE PV-SAVED-PO-NBR          TO ALCHRG-PO-NBR.              13320010
133300     MOVE IA-INVOICE-ID  (IA-SUB)  TO ALCHRG-INVC-ID.             13330010
133400                                                                  13340010
133500 EJECT                                                            13350010
133600*---------------------------------------------------------------  13360010
133700*    CONTROLS UPDATING OF THE INVOICE STATUS CODE TO 'RL'         13370010
133800*    (RELEASED) FOR EACH INVOICE IN A MATCH SITUATION.            13380010
133900*---------------------------------------------------------------  13390010
134000 E300-UPDT-INVC-RL-STATUS.                                        13400010
134100                                                                  13410010
134200     MOVE IA-PAYT-REQ-SEQ-NBR (IA-SUB) TO PV-PAYT-REQ-SEQ-NBR.    13420010
134300     MOVE IA-INVOICE-ID       (IA-SUB) TO PV-INVC-ID.             13430010
134400     MOVE IA-DUE-CENT         (IA-SUB) TO PV-DUE-CENT.            13440010
134500     MOVE IA-DUE-YEAR         (IA-SUB) TO PV-DUE-YEAR.            13450010
134600     MOVE IA-DUE-MONTH        (IA-SUB) TO PV-DUE-MONTH.           13460010
134700     MOVE IA-DUE-DAY          (IA-SUB) TO PV-DUE-DAY.             13470010
134800     MOVE IA-DUE-DTE-SRC-CDE  (IA-SUB) TO PV-DUE-DATE-SOURCE.     13480010
134900                                                                  13490010
135000     PERFORM U100-UPDATE-INVOICE-STATUS-RL.                       13500010
135100                                                                  13510010
135200                                                                  13520010
135300                                                                  13530010
136800 EJECT                                                            13680010
136900*-----------------------------------------------------------------13690010
137000*    NON-MATCH PROCESSING CONSISTS OF THE FOLLOWING:              13700010
137100*    - DETERMINE IF DETAILS HAVE BEEN ENTERED AND IF NOT, WRITE   13710010
137200*      RECORDS FOR THE INVOICES REQUIRING DETAIL REPORT           13720010
137300*    - UPDATE THE STATUS CODE ON TINVOIC TO 'RC' FOR EACH INVOICE 13730010
137400*-----------------------------------------------------------------13740010
137500 E800-NOMATCH-PROCESSING.                                         13750010
137600                                                                  13760010
137700     IF NO-DETAIL-ENTERED                                         13770010
137800                                                                  13780010
137900        PERFORM F300-PREPARE-NO-DETAILS                           13790010
138000          VARYING IA-SUB FROM 1 BY 1                              13800010
138100            UNTIL IA-SUB > IA-SUB-MAX                             13810010
138200                                                                  13820010
138300        IF WRITE-DETAIL-HEADER                                    13830010
138400            PERFORM F400-PREPARE-NO-DETAILS-HEADER                13840010
138500        END-IF                                                    13850010
138600                                                                  13860010
138700     END-IF.                                                      13870010
138800                                                                  13880010
138900     PERFORM F500-UPDT-INVC-RC-STATUS                             13890010
139000         VARYING IA-SUB FROM 1 BY 1                               13900010
139100           UNTIL IA-SUB > IA-SUB-MAX.                             13910010
139200 EJECT                                                            13920010
139300*---------------------------------------------------------------  13930010
139400*    FORMATS THE INVOICE RECORD FOR THE INVOICES REQUIRING        13940010
139500*    DETAIL ENTRY REPORT.                                         13950010
139600*---------------------------------------------------------------  13960010
139700 F300-PREPARE-NO-DETAILS.                                         13970010
139800                                                                  13980010
139900     INITIALIZE                       AP271-SORT-AREA             13990010
140000                                      AP271-INVOICE-DATA.         14000010
140100                                                                  14010010
140200     MOVE PV-SAVED-VENDOR-NAME     TO AP271-VENDOR-NAME.          14020010
140300     MOVE PV-SAVED-PO-NBR          TO AP271-PURCHASE-ORDER.       14030010
140400     MOVE PV-SAVED-STR-NBR         TO AP271-STORE-NUMBER.         14040010
140500                                                                  14050010
140600     SET INVOICE-REC               TO TRUE.                       14060010
140700                                                                  14070010
140800     MOVE IA-ENTRY-CENT   (IA-SUB) TO AP271-ENTRY-CENT.           14080010
140900     MOVE IA-ENTRY-YEAR   (IA-SUB) TO AP271-ENTRY-YEAR.           14090010
141000     MOVE IA-ENTRY-MONTH  (IA-SUB) TO AP271-ENTRY-MONTH.          14100010
141100     MOVE IA-ENTRY-DAY    (IA-SUB) TO AP271-ENTRY-DAY.            14110010
141200                                                                  14120010
141300     MOVE IA-INVOICE-ID   (IA-SUB) TO AP271-INVOICE-NUMBER.       14130010
141400                                                                  14140010
141500     MOVE IA-DTL-ENTR-IND (IA-SUB) TO AP271-DETAIL-ENTERED-IND.   14150010
141600     MOVE ZEROS                    TO AP271-APP-PO-LINE-NBR.      14160010
141700                                                                  14170010
141800     MOVE IA-ENTRY-METHOD (IA-SUB) TO AP271-INVOICE-ENTRY-METHOD. 14180010
141900     MOVE IA-GROSS-COST-AMT (IA-SUB)                              14190010
142000                                   TO AP271-GROSS-INVOICE-AMT.    14200010
142100                                                                  14210010
142200     MOVE SPACES                   TO AP271-ALLW-CHRG-CDE.        14220010
142300     MOVE IA-TERMS-DISC-PCT (IA-SUB)                              14230010
142400                                   TO AP271-ALLW-CHRG-PCT.        14240010
142500     MOVE ZEROS                    TO AP271-ALLW-CHRG-AMT.        14250010
142600                                                                  14260010
142700     IF IA-INVOICE-STATUS (IA-SUB) = PC-INVC-RC-STATUS            14270010
142800         MOVE 'N'                  TO AP271-FIRST-TIME-RC         14280010
142900     ELSE                                                         14290010
143000         MOVE 'Y'                  TO AP271-FIRST-TIME-RC         14300010
143100     END-IF.                                                      14310010
143200                                                                  14320010
143300     MOVE IA-PAYT-REQ-SEQ-NBR (IA-SUB)                            14330010
143400                                   TO AP271-PAYT-REQ-SEQ-NBR.     14340010
143500                                                                  14350010
143600     MOVE PS-ALLOW-EXIST-SW        TO AP271-ADDIT-ALLOW-IND.      14360010
143700                                                                  14370010
143800     MOVE AP271-RECORD             TO OUTAP6-DTL-ENTR-RPT-ODR.    14380010
143900     PERFORM U600-INSERT-DETAIL-ENTRY.                            14390010
144000                                                                  14400010
144100     MOVE SPACES TO AP271-SORT-AREA                               14410010
144200                    AP271-DATA-AREA.                              14420010
144300 EJECT                                                            14430010
144400*---------------------------------------------------------------  14440010
144500*    FORMATS THE HEADER FOR THE INVOICES REQUIRING DETAIL         14450010
144600*    ENTRY REPORT.  ONLY ONE HEADER IS PRODUCED PER PO NUMBER.    14460010
144700*---------------------------------------------------------------  14470010
144800 F400-PREPARE-NO-DETAILS-HEADER.                                  14480010
144900                                                                  14490010
145000     MOVE SPACES                 TO   AP271-RECORD.               14500010
145100     INITIALIZE                       AP271-SORT-AREA.            14510010
145200                                                                  14520010
145300     MOVE PV-SAVED-VENDOR-NAME   TO   AP271-VENDOR-NAME.          14530010
145400     MOVE PV-SAVED-VENDOR-NBR    TO   AP271-VENDOR-NUMBER.        14540010
145500     MOVE PV-SAVED-PO-NBR        TO   AP271-PURCHASE-ORDER.       14550010
145600                                                                  14560010
145700     SET HEADER-REC              TO   TRUE.                       14570010
145800                                                                  14580010
145900     MOVE AP271-RECORD            TO OUTAP6-DTL-ENTR-RPT-ODR.     14590010
146000     PERFORM U600-INSERT-DETAIL-ENTRY.                            14600010
146100                                                                  14610010
146200     SET DO-NO-WRITE-DETAIL-HEADER  TO TRUE.                      14620010
146300 EJECT                                                            14630010
146400*---------------------------------------------------------------  14640010
146500*    CONTROLS UPDATING OF THE INVOICE STATUS CODE TO 'RC'         14650010
146600*    (IN RECONCILIATION) FOR EACH INVOICE IN A NON-MATCH          14660010
146700*    SITUATION.  IF AN INVOICE ALREADY HAD A STATUS OF 'RC'       14670010
146800*    WE DO NOT WANT TO UPDATE THE STATUS_CHG_TMST.                14680010
146900*---------------------------------------------------------------  14690010
147000 F500-UPDT-INVC-RC-STATUS.                                        14700010
147100                                                                  14710010
147200     MOVE IA-DUE-CENT         (IA-SUB) TO PV-DUE-CENT.            14720010
147300     MOVE IA-DUE-YEAR         (IA-SUB) TO PV-DUE-YEAR.            14730010
147400     MOVE IA-DUE-MONTH        (IA-SUB) TO PV-DUE-MONTH.           14740010
147500     MOVE IA-DUE-DAY          (IA-SUB) TO PV-DUE-DAY.             14750010
147600     MOVE IA-DUE-DTE-SRC-CDE  (IA-SUB) TO PV-DUE-DATE-SOURCE.     14760010
147700     MOVE IA-PAYT-REQ-SEQ-NBR (IA-SUB) TO PV-PAYT-REQ-SEQ-NBR.    14770010
147800     MOVE IA-INVOICE-ID       (IA-SUB) TO PV-INVC-ID.             14780010
147900                                                                  14790010
148000     IF IA-INVOICE-STATUS (IA-SUB) = PC-INVC-RC-STATUS            14800010
148100         PERFORM U150-UPDATE-INVOICE-STAT-OLDRC                   14810010
148200     ELSE                                                         14820010
148300         PERFORM U175-UPDATE-INVOICE-STAT-NEWRC                   14830010
148400     END-IF.                                                      14840010
148500 EJECT                                                            14850010
148600*---------------------------------------------------------------  14860010
148700*    READS THE INVOICE FILE.                                      14870010
148800*---------------------------------------------------------------  14880010
148900 R100-READ-INVOICES.                                              14890010
149000                                                                  14900010
149100     READ INVOICE-FILE                                            14910010
149200         INTO AP060-INVOICE-EXTRACT                               14920010
149300         AT END SET OUT-OF-INVOICES TO TRUE.                      14930010
149400                                                                  14940010
149500     IF MORE-INVOICES                                             14950010
149600         ADD 1 TO PA-INVOICE-COUNT                                14960010
149700     END-IF.                                                      14970010
149800                                                                  14980010
149900*---------------------------------------------------------------  14990010
150000*    READS THE RECIEVER PO/STORE TOTAL FILE.                      15000010
150100*---------------------------------------------------------------  15010010
150200 R200-READ-RCVR-PO-STR.                                           15020010
150300                                                                  15030010
150400     READ RECEIVER-PO-STR-FILE                                    15040010
150500         INTO AP020-RECORD                                        15050010
150600         AT END SET OUT-OF-RCVR-PO-STR TO TRUE.                   15060010
150700                                                                  15070010
150800     IF MORE-RCVR-PO-STR                                          15080010
150900         ADD 1 TO PA-RCVR-PO-STR-COUNT                            15090010
151000     END-IF.                                                      15100010
151100                                                                  15110010
151200*---------------------------------------------------------------  15120010
151300*    RETRIEVES INVOICE/RECEIVER ALLOWABLE VARIANCE PERCENT,       15130010
151400*    INVOICE/RECEIVER ALLOWABLE VARIANCE AMOUNT, AND PROCESS      15140010
151500*    DATE FROM THE AP PAYMENT CONTROL TABLE.                      15150010
151600*    NOTE:  A NOT FOUND CONDITION IN THIS INSTANCE PREVENTS THE   15160010
151700*           CALCULATION OF WITHIN TOLERANCE AMOUNTS AND PAYMENT   15170010
151800*           DUE AND CUTOFF DATES SO PROCESSING CANNOT PROCEED     15180010
151900*           AND THE PROGRAM MUST ABEND.                           15190010
152000*---------------------------------------------------------------  15200010
152100 R400-SELECT-CONTROL-DATA.                                        15210010
152200                                                                  15220010
152300     EXEC SQL                                                     15230010
152400         SELECT                                                   15240010
152500             INVC_RCV_VAR_PCT                                     15250010
152600            ,INVC_RCV_VAR_AMT                                     15260010
152700            ,BTCH_PRC_DTE                                         15270010
152800            ,BTCH_PRC_DTE + 14 DAYS                               15280010
152900            ,BTCH_PRC_DTE + 17 DAYS                               15290010
153000            ,BTCH_PRC_DTE + 21 DAYS                               15300010
153100            ,BTCH_PRC_DTE + 25 DAYS                               15310010
153200            ,BTCH_PRC_DTE + 26 DAYS                               15320010
153300            ,BTCH_PRC_DTE + 27 DAYS                               15330010
153400            ,BTCH_PRC_DTE + 28 DAYS                               15340010
153500            ,BTCH_PRC_DTE + 29 DAYS                               15350010
153600            ,BTCH_PRC_DTE + 30 DAYS                               15360010
153700            ,BTCH_PRC_DTE + 32 DAYS                               15370010
153800         INTO                                                     15380010
153900             :APCNTL-INVC-RCV-VAR-PCT                             15390010
154000            ,:APCNTL-INVC-RCV-VAR-AMT                             15400010
154100            ,:APCNTL-BTCH-PRC-DTE                                 15410010
154200            ,:PV-DATE-PLUS-14                                     15420010
154300            ,:PV-DATE-PLUS-17                                     15430010
154400            ,:PV-DATE-PLUS-21                                     15440010
154500            ,:PV-DATE-PLUS-25                                     15450010
154600            ,:PV-DATE-PLUS-26                                     15460010
154700            ,:PV-DATE-PLUS-27                                     15470010
154800            ,:PV-DATE-PLUS-28                                     15480010
154900            ,:PV-DATE-PLUS-29                                     15490010
155000            ,:PV-DATE-PLUS-30                                     15500010
155100            ,:PV-DATE-PLUS-32                                     15510010
155200         FROM TAPCNTL                                             15520010
155300     END-EXEC.                                                    15530010
155400                                                                  15540010
155500     EVALUATE TRUE                                                15550010
155600         WHEN SQLCODE = ZEROS                                     15560010
155700              CONTINUE                                            15570010
155800         WHEN OTHER                                               15580010
155900             MOVE 'R400-SELECT-CONTROL-DATA'                      15590010
156000                                 TO AA-PARAGRAPH-NAME             15600010
156100             MOVE 'UNSUCCESSFUL SELECT'                           15610010
156200                                 TO AA-DB2-OPERATION              15620010
156300             MOVE 'TAPCNTL'      TO AA-DB2-TABLE-1                15630010
156400             MOVE SPACES         TO AA-DB2-TABLE-2                15640010
156500                                    AA-DB2-TABLE-3                15650010
156600             PERFORM Z998-DB2-ABEND                               15660010
156700     END-EVALUATE.                                                15670010
156800 EJECT                                                            15680010
156900*---------------------------------------------------------------  15690010
157000*    RETRIEVES VENDOR SPECIFIC VARIANCE PERCENT AND AMOUNT        15700010
157100*    FROM THE AP VENDOR SPECIFICATIONS TABLE.                     15710010
157200*    NOTE:  A NOT FOUND CONDITION IN THIS INSTANCE MEANS THERE    15720010
157300*           IS NO VENDOR SPECIFIC TOLERANCES AND THE DEFAULT      15730010
157400*           AMOUNT FROM TAPCNTL IS TO BE USED.                    15740010
157500*---------------------------------------------------------------  15750010
157600 R500-SELECT-VENDOR-TOLERANCE.                                    15760010
157700                                                                  15770010
157800     EXEC SQL                                                     15780010
157900         SELECT                                                   15790010
158000             INVC_RCV_VAR_PCT                                     15800010
158100            ,INVC_RCV_VAR_AMT                                     15810010
158200         INTO                                                     15820010
158300             :APVNDS-INVC-RCV-VAR-PCT                             15830010
158400            ,:APVNDS-INVC-RCV-VAR-AMT                             15840010
158500         FROM TAPVNDS AV                                          15850010
158600             ,TPURCHS PU                                          15860010
158700         WHERE PU.PO_NBR = :PV-SAVED-PO-NBR                       15870010
158800           AND PU.ENT_ID = AV.ENT_ID                              15880010
158900           AND AV.INVC_RCV_VAR_IND = 'S'                          15890010
159000           AND PU.VER_STATUS_CDE   = 'A'                          15900010
159100     END-EXEC.                                                    15910010
159200                                                                  15920010
159300     EVALUATE TRUE                                                15930010
159400         WHEN SQLCODE = ZEROS                                     15940010
159500              SET USE-SPECIFIED-TOLERANCE TO TRUE                 15950010
159600         WHEN SQLCODE = +100                                      15960010
159700              SET USE-DEFAULT-TOLERANCE   TO TRUE                 15970010
159800         WHEN OTHER                                               15980010
159900             MOVE 'R500-SELECT-VENDOR-TOLERANCE'                  15990010
160000                                 TO AA-PARAGRAPH-NAME             16000010
160100             MOVE 'UNSUCCESSFUL SELECT'                           16010010
160200                                 TO AA-DB2-OPERATION              16020010
160300             MOVE 'TAPVNDS'      TO AA-DB2-TABLE-1                16030010
160400             MOVE 'TPURCHS'      TO AA-DB2-TABLE-2                16040010
160500             MOVE SPACES         TO AA-DB2-TABLE-3                16050010
160600             PERFORM Z998-DB2-ABEND                               16060010
160700     END-EVALUATE.                                                16070010
160800 EJECT                                                            16080010
160900*---------------------------------------------------------------  16090010
161000*    GETS THE CURRENT TIMESTAMP FROM DB2.                         16100010
161100*---------------------------------------------------------------  16110010
161200 R900-SET-CURRENT-TMST.                                           16120010
161300                                                                  16130010
161400     EXEC SQL                                                     16140010
161500       SET :CR-CURR-TMST = CURRENT TIMESTAMP                      16150010
161600     END-EXEC.                                                    16160010
161700                                                                  16170010
161800     EVALUATE TRUE                                                16180010
161900         WHEN SQLCODE = ZERO                                      16190010
162000              CONTINUE                                            16200010
162100                                                                  16210010
162200         WHEN SQLWARN0 NOT = SPACES                               16220010
162300         WHEN SQLCODE  NOT = ZERO                                 16230010
162400             MOVE 'R900-SET-CURRENT-TMST'                         16240010
162500                                     TO AA-PARAGRAPH-NAME         16250010
162600             MOVE 'UNSUCCESSFUL SET TMST'                         16260010
162700                                     TO AA-DB2-OPERATION          16270010
162800             MOVE SPACES             TO AA-DB2-TABLE-1            16280010
162900                                        AA-DB2-TABLE-2            16290010
163000                                        AA-DB2-TABLE-3            16300010
163100             PERFORM Z998-DB2-ABEND                               16310010
163200     END-EVALUATE.                                                16320010
163300 EJECT                                                            16330010
163400*---------------------------------------------------------------  16340010
163500*    SETS THE TIME THE NEXT CHECKPOINT NEEDS TO BE TAKEN.         16350010
163600*---------------------------------------------------------------  16360010
163700 R910-SET-NEXT-CKPT-TMST.                                         16370010
163800                                                                  16380010
163900     EXEC SQL                                                     16390010
164000      SELECT (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)        16400010
164100       INTO :CR-NEXT-TMST                                         16410010
164200       FROM TCKRSTCNTL                                            16420010
164300       WHERE PLAN_NAME = :PV-PROGRAM-NAME                         16430010
164400     END-EXEC.                                                    16440010
164500                                                                  16450010
164600     EVALUATE TRUE                                                16460010
164700         WHEN SQLCODE = ZERO                                      16470010
164800              CONTINUE                                            16480010
164900                                                                  16490010
165000         WHEN SQLWARN0 NOT = SPACES                               16500010
165100         WHEN SQLCODE  NOT = ZERO                                 16510010
165200             MOVE 'R910-SET-NEXT-CKPT-TMST'                       16520010
165300                                     TO AA-PARAGRAPH-NAME         16530010
165400             MOVE 'UNSUCCESSFUL SELECT NEXT TMST'                 16540010
165500                                     TO AA-DB2-OPERATION          16550010
165600             MOVE 'TCKRSTCNTL'       TO AA-DB2-TABLE-1            16560010
165700             MOVE SPACES             TO AA-DB2-TABLE-2            16570010
165800                                        AA-DB2-TABLE-3            16580010
165900             PERFORM Z998-DB2-ABEND                               16590010
166000     END-EVALUATE.                                                16600010
166100 EJECT                                                            16610010
166200*---------------------------------------------------------------  16620010
166300*    GETS THE RESTART STATUS CODE FROM THE CHECKPOINT/RESTART     16630010
166400*    CONTROL TABLE.                                               16640010
166500*---------------------------------------------------------------  16650010
166600 R980-SELECT-CHECKPOINT-CNTL.                                     16660010
166700                                                                  16670010
166800     EXEC SQL                                                     16680010
166900      SELECT CKPT_STAT_CODE                                       16690010
167000       INTO :CR-CKPT-STAT-CODE                                    16700010
167100       FROM TCKRSTCNTL                                            16710010
167200       WHERE PLAN_NAME = :PV-PROGRAM-NAME                         16720010
167300     END-EXEC.                                                    16730010
167400                                                                  16740010
167500     EVALUATE TRUE                                                16750010
167600         WHEN SQLCODE = ZERO                                      16760010
167700              CONTINUE                                            16770010
167800                                                                  16780010
167900         WHEN SQLWARN0 NOT = SPACES                               16790010
168000         WHEN SQLCODE  NOT = ZERO                                 16800010
168100             MOVE 'R980-SELECT-CHECKPOINT-CNTL'                   16810010
168200                                     TO AA-PARAGRAPH-NAME         16820010
168300             MOVE 'UNSUCCESSFUL SELECT TCKRSTCNTL'                16830010
168400                                     TO AA-DB2-OPERATION          16840010
168500             MOVE 'TCKRSTCNTL'       TO AA-DB2-TABLE-1            16850010
168600             MOVE SPACES             TO AA-DB2-TABLE-2            16860010
168700                                        AA-DB2-TABLE-3            16870010
168800             PERFORM Z998-DB2-ABEND                               16880010
168900     END-EVALUATE.                                                16890010
169000 EJECT                                                            16900010
169100*---------------------------------------------------------------  16910010
169200*    GETS THE WS DESCRIPTION INFO FROM THE CHECKPOINT/RESTART     16920010
169300*    INFORMATION TABLE.                                           16930010
169400*---------------------------------------------------------------  16940010
169500 R990-SELECT-CHECKPOINT-INFO.                                     16950010
169600                                                                  16960010
169700     EXEC SQL                                                     16970010
169800      SELECT WORK_STRG_DESC                                       16980010
169900       INTO :TCKRSTINF-WORK-STRG-DESC                             16990010
170000       FROM TCKRSTINF                                             17000010
170100       WHERE PLAN_NAME = :PV-PROGRAM-NAME                         17010010
170200     END-EXEC.                                                    17020010
170300                                                                  17030010
170400     EVALUATE TRUE                                                17040010
170500         WHEN SQLCODE = ZERO                                      17050010
170600              CONTINUE                                            17060010
170700                                                                  17070010
170800         WHEN SQLWARN0 NOT = SPACES                               17080010
170900         WHEN SQLCODE  NOT = ZERO                                 17090010
171000             MOVE 'R990-SELECT-CHECKPOINT-INFO'                   17100010
171100                                     TO AA-PARAGRAPH-NAME         17110010
171200             MOVE 'UNSUCCESSFUL SELECT TCKRSTINF'                 17120010
171300                                     TO AA-DB2-OPERATION          17130010
171400             MOVE 'TCKRSTINF'        TO AA-DB2-TABLE-1            17140010
171500             MOVE SPACES             TO AA-DB2-TABLE-2            17150010
171600                                        AA-DB2-TABLE-3            17160010
171700             PERFORM Z998-DB2-ABEND                               17170010
171800     END-EVALUATE.                                                17180010
171900 EJECT                                                            17190010
172000*---------------------------------------------------------------  17200010
172100*    UPDATES THE INVOICE TABLE WITH A STATUS CODE OF 'RL'         17210010
172200*    (RELEASED) AND A RELEASE TIMESTAMP OF CURRENT TIMESTAMP      17220010
172300*    WHEN AN INVOICED HAS BEEN DETERMINED TO BE MATCHED.          17230010
172400*    NOTE:  A NOT FOUND CONDITION IN THIS INSTANCE SHOULD NEVER   17240010
172500*           OCCUR SINCE THE PAYMENT REQUEST SEQUENCE NUMBER WAS   17250010
172600*           RETRIEVED WITH THE INITIAL CALL.  IF A NOT FOUND      17260010
172700*           CONDITION DOES OCCUR, IT SIGNALS A PROBLEM AND THE    17270010
172800*           PROGRAM WILL ABEND.                                   17280010
172900*---------------------------------------------------------------  17290010
173000 U100-UPDATE-INVOICE-STATUS-RL.                                   17300010
173100                                                                  17310010
173200     EXEC SQL                                                     17320010
173300         UPDATE TINVOIC                                           17330010
173400         SET STATUS_CDE         = 'RL'                            17340010
173500           , PAYT_RLSE_TMST     = :CR-CURR-TMST                   17350010
173600           , STATUS_CHG_TMST    = :CR-CURR-TMST                   17360010
173700           , CALC_DUE_DTE       = :PV-DUE-DATE-HOST               17370010
173800           , DUE_DTE_SRC_CDE    = :PV-DUE-DATE-SOURCE             17380010
173900         WHERE PO_NBR           = :PV-SAVED-PO-NBR                17390010
174000           AND INVC_ID          = :PV-INVC-ID                     17400010
174100     END-EXEC.                                                    17410010
174200                                                                  17420010
174300     EVALUATE TRUE                                                17430010
174400         WHEN SQLCODE = ZEROS                                     17440010
174500              ADD 1 TO PA-INVCS-RL-COUNT                          17450010
174600                                                                  17460010
174700         WHEN OTHER                                               17470010
174800             DISPLAY 'PAYT_RLSE_TMST  = ' CR-CURR-TMST            17480010
174900             DISPLAY 'STATUS_CHG_TMST = ' CR-CURR-TMST            17490010
175000             DISPLAY 'CALC_DUE_DTE    = ' PV-DUE-DATE-HOST        17500010
175100             DISPLAY 'INVOICE ID      = ' PV-INVC-ID              17510010
175200             MOVE 'U100-UPDATE-INVOICE-STATUS-RL'                 17520010
175300                                 TO AA-PARAGRAPH-NAME             17530010
175400             MOVE 'UNSUCCESSFUL UPDATE'                           17540010
175500                                 TO AA-DB2-OPERATION              17550010
175600             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                17560010
175700             MOVE SPACES         TO AA-DB2-TABLE-2                17570010
175800                                    AA-DB2-TABLE-3                17580010
175900             PERFORM Z998-DB2-ABEND                               17590010
176000     END-EVALUATE.                                                17600010
176100 EJECT                                                            17610010
176200*---------------------------------------------------------------  17620010
176300*    UPDATES TINVOIC WITH A STATUS CODE OF 'RC' (IN RECONCILIA-   17630010
176400*    TION) WHEN AN INVOICE IS DETERMINED TO BE NOT MATCHED FOR    17640010
176500*    INVOICES THAT ALREADY HAVE AN 'RC' STATUS.  (STATUS_CHG_     17650010
176600*    TMST IS NOT UPDATED.)                                        17660010
176700*    NOTE:  A NOT FOUND CONDITION IN THIS INSTANCE SHOULD NEVER   17670010
176800*           OCCUR SINCE THE PAYMENT REQUEST SEQUENCE NUMBER WAS   17680010
176900*           RETRIEVED WITH THE INITIAL CALL.  IF A NOT FOUND      17690010
177000*           CONDITION DOES OCCUR, IT SIGNALS A PROBLEM AND THE    17700010
177100*           PROGRAM WILL ABEND.                                   17710010
177200*---------------------------------------------------------------  17720010
177300 U150-UPDATE-INVOICE-STAT-OLDRC.                                  17730010
177400                                                                  17740010
177500     EXEC SQL                                                     17750010
177600         UPDATE TINVOIC                                           17760010
177700         SET STATUS_CDE         = 'RC'                            17770010
177800           , CALC_DUE_DTE       = :PV-DUE-DATE-HOST               17780010
177900           , DUE_DTE_SRC_CDE    = :PV-DUE-DATE-SOURCE             17790010
178000         WHERE PO_NBR           = :PV-SAVED-PO-NBR                17800010
178100           AND INVC_ID          = :PV-INVC-ID                     17810010
178200     END-EXEC.                                                    17820010
178300                                                                  17830010
178400     EVALUATE TRUE                                                17840010
178500         WHEN SQLCODE = ZEROS                                     17850010
178600              ADD 1 TO PA-INVCS-RC-COUNT                          17860010
178700         WHEN OTHER                                               17870010
178800             MOVE 'U150-UPDATE-INVOICE-STAT-OLDRC'                17880010
178900                                 TO AA-PARAGRAPH-NAME             17890010
179000             MOVE 'UNSUCCESSFUL UPDATE'                           17900010
179100                                 TO AA-DB2-OPERATION              17910010
179200             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                17920010
179300             MOVE SPACES         TO AA-DB2-TABLE-2                17930010
179400                                    AA-DB2-TABLE-3                17940010
179500             PERFORM Z998-DB2-ABEND                               17950010
179600     END-EVALUATE.                                                17960010
179700 EJECT                                                            17970010
179800*---------------------------------------------------------------  17980010
179900*    UPDATES TINVOIC WITH A STATUS CODE OF 'RC' (IN RECONCILIA-   17990010
180000*    TION) WHEN AN INVOICE IS DETERMINED TO BE NOT MATCHED FOR    18000010
180100*    INVOICES THAT PREVIOUSLY DID NOT HAVE AN 'RC' STATUS.        18010010
180200*    NOTE:  A NOT FOUND CONDITION IN THIS INSTANCE SHOULD NEVER   18020010
180300*           OCCUR SINCE THE PAYMENT REQUEST SEQUENCE NUMBER WAS   18030010
180400*           RETRIEVED WITH THE INITIAL CALL.  IF A NOT FOUND      18040010
180500*           CONDITION DOES OCCUR, IT SIGNALS A PROBLEM AND THE    18050010
180600*           PROGRAM WILL ABEND.                                   18060010
180700*---------------------------------------------------------------  18070010
180800 U175-UPDATE-INVOICE-STAT-NEWRC.                                  18080010
180900                                                                  18090010
181000     EXEC SQL                                                     18100010
181100         UPDATE TINVOIC                                           18110010
181200         SET STATUS_CDE         = 'RC'                            18120010
181300           , STATUS_CHG_TMST    = :PV-BTCH-TMST                   18130010
181400           , CALC_DUE_DTE       = :PV-DUE-DATE-HOST               18140010
181500           , DUE_DTE_SRC_CDE    = :PV-DUE-DATE-SOURCE             18150010
181600         WHERE PO_NBR           = :PV-SAVED-PO-NBR                18160010
181700           AND INVC_ID          = :PV-INVC-ID                     18170010
181800     END-EXEC.                                                    18180010
181900                                                                  18190010
182000     EVALUATE TRUE                                                18200010
182100         WHEN SQLCODE = ZEROS                                     18210010
182200              ADD 1 TO PA-INVCS-RC-COUNT                          18220010
182300         WHEN OTHER                                               18230010
182400             MOVE 'U175-UPDATE-INVOICE-STAT-NEWRC'                18240010
182500                                 TO AA-PARAGRAPH-NAME             18250010
182600             MOVE 'UNSUCCESSFUL UPDATE'                           18260010
182700                                 TO AA-DB2-OPERATION              18270010
182800             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                18280010
182900             MOVE SPACES         TO AA-DB2-TABLE-2                18290010
183000                                    AA-DB2-TABLE-3                18300010
183100             PERFORM Z998-DB2-ABEND                               18310010
183200     END-EVALUATE.                                                18320010
183300 EJECT                                                            18330010
188000*---------------------------------------------------------------  18800010
188100*    INSERTS A ROW ON THE RELEASED PO/STORES TABLE FOR A MATCHED  18810010
188200*    PO/STORE.                                                    18820010
188300*---------------------------------------------------------------  18830010
188400 U300-INSERT-POSTRR-MATCH.                                        18840010
188500                                                                  18850010
188600     EXEC SQL                                                     18860010
188700         INSERT INTO TPOSTRR                                      18870010
188800             (PO_NBR                                              18880010
188900             ,STR_NBR                                             18890010
189000             ,PAYT_RLSE_TMST                                      18900010
189100             ,CRE_PRC_CDE                                         18910010
189200             ,STATUS_CDE                                          18920010
189300             ,PAYT_RLSE_USR_ID                                    18930010
189400             ,TOLR_ADJ_CDE                                        18940010
189500             ,TOLR_ADJ_AMT                                        18950010
189600             ,WEIGHTED_DISC_PCT                                   18960010
189700             ,TOTAL_DISC_AMT                                      18970010
189800             ,MTCH_LVL_CDE)                                       18980010
189900         VALUES                                                   18990010
190000             (:PV-SAVED-PO-NBR                                    19000010
190100             ,:PV-SAVED-STR-NBR                                   19010010
190200             ,:CR-CURR-TMST                                       19020010
190300             ,'B'                                                 19030010
190400             ,' '                                                 19040010
190500             ,' '                                                 19050010
190600             ,:POSTRR-TOLR-ADJ-CDE                                19060010
190700             ,:POSTRR-TOLR-ADJ-AMT                                19070010
190800             ,:POSTRR-WEIGHTED-DISC-PCT                           19080010
190900             ,:POSTRR-TOTAL-DISC-AMT                              19090010
191000             ,:PV-SAVED-MTCH-LVL-CDE)                             19100010
191100     END-EXEC.                                                    19110010
191200                                                                  19120010
191300     EVALUATE TRUE                                                19130010
191400         WHEN SQLCODE = ZEROS                                     19140010
191500              ADD 1 TO PA-MATCH-COUNT                             19150010
191600                                                                  19160010
191700         WHEN OTHER                                               19170010
191800             MOVE 'U300-INSERT-POSTRR-MATCH'                      19180010
191900                                 TO AA-PARAGRAPH-NAME             19190010
192000             MOVE 'UNSUCCESSFUL INSERT'                           19200010
192100                                 TO AA-DB2-OPERATION              19210010
192200             MOVE 'TPOSTRR'      TO AA-DB2-TABLE-1                19220010
192300             MOVE SPACES         TO AA-DB2-TABLE-2                19230010
192400                                    AA-DB2-TABLE-3                19240010
192500             PERFORM Z998-DB2-ABEND                               19250010
192600     END-EVALUATE.                                                19260010
192700 EJECT                                                            19270010
192800*---------------------------------------------------------------  19280010
192900*    INSERTS A ROW ON THE RELEASED PO/STORES TABLE AS A           19290010
193000*    CANDIDATE FOR AUTOMATIC RECONCILIATION.                      19300010
193100*---------------------------------------------------------------  19310010
193200 U400-INSERT-POSTRR-RECON.                                        19320010
193300                                                                  19330010
193400     MOVE SPACES     TO POSTRR-PAYT-RLSE-USR-ID                   19340010
193500                        POSTRR-TOLR-ADJ-CDE.                      19350010
193600                                                                  19360010
193700     MOVE ZEROS      TO POSTRR-TOLR-ADJ-AMT                       19370010
193800                        POSTRR-WEIGHTED-DISC-PCT                  19380010
193900                        POSTRR-TOTAL-DISC-AMT.                    19390010
194000                                                                  19400010
194100     EXEC SQL                                                     19410010
194200         INSERT INTO TPOSTRR                                      19420010
194300             (PO_NBR                                              19430010
194400             ,STR_NBR                                             19440010
194500             ,PAYT_RLSE_TMST                                      19450010
194600             ,CRE_PRC_CDE                                         19460010
194700             ,STATUS_CDE                                          19470010
194800             ,PAYT_RLSE_USR_ID                                    19480010
194900             ,TOLR_ADJ_CDE                                        19490010
195000             ,TOLR_ADJ_AMT                                        19500010
195100             ,WEIGHTED_DISC_PCT                                   19510010
195200             ,TOTAL_DISC_AMT                                      19520010
195300             ,MTCH_LVL_CDE)                                       19530010
195400         VALUES                                                   19540010
195500             (:PV-SAVED-PO-NBR                                    19550010
195600             ,:PV-SAVED-STR-NBR                                   19560010
195700             ,:CR-CURR-TMST                                       19570010
195800             ,'A'                                                 19580010
195900             ,'A'                                                 19590010
196000             ,:POSTRR-PAYT-RLSE-USR-ID                            19600010
196100             ,:POSTRR-TOLR-ADJ-CDE                                19610010
196200             ,:POSTRR-TOLR-ADJ-AMT                                19620010
196300             ,:POSTRR-WEIGHTED-DISC-PCT                           19630010
196400             ,:POSTRR-TOTAL-DISC-AMT                              19640010
196500             ,:PV-SAVED-MTCH-LVL-CDE)                             19650010
196600     END-EXEC.                                                    19660010
196700                                                                  19670010
196800     EVALUATE TRUE                                                19680010
196900         WHEN SQLCODE = ZEROS                                     19690010
197000              ADD 1 TO PA-AUTO-RECON-COUNT                        19700010
197100                                                                  19710010
197200         WHEN OTHER                                               19720010
197300             MOVE 'U400-INSERT-POSTRR-RECON'                      19730010
197400                                 TO AA-PARAGRAPH-NAME             19740010
197500             MOVE 'UNSUCCESSFUL INSERT'                           19750010
197600                                 TO AA-DB2-OPERATION              19760010
197700             MOVE 'TPOSTRR'      TO AA-DB2-TABLE-1                19770010
197800             MOVE SPACES         TO AA-DB2-TABLE-2                19780010
197900                                    AA-DB2-TABLE-3                19790010
198000             PERFORM Z998-DB2-ABEND                               19800010
198100     END-EVALUATE.                                                19810010
198200 EJECT                                                            19820010
198300*---------------------------------------------------------------  19830010
198400*    UPDATES THE CHECKPOINT RESTART CONTROL TABLE.  THE STATUS    19840010
198500*    CODE IS SET TO '9' (RUN IN PROGRESS) OR '0' (RUN COMPLETE).  19850010
198600*---------------------------------------------------------------  19860010
198700 U500-UPDATE-CHECKPOINT-CNTL.                                     19870010
198800                                                                  19880010
198900     EXEC SQL                                                     19890010
199000         UPDATE TCKRSTCNTL                                        19900010
199100         SET CKPT_STAT_CODE = :CR-CKPT-STAT-CODE                  19910010
199200         WHERE PLAN_NAME    = :PV-PROGRAM-NAME                    19920010
199300     END-EXEC.                                                    19930010
199400                                                                  19940010
199500     EVALUATE TRUE                                                19950010
199600         WHEN SQLCODE = ZEROS                                     19960010
199700              CONTINUE                                            19970010
199800                                                                  19980010
199900         WHEN OTHER                                               19990010
200000             MOVE 'U500-UPDATE-CHECKPOINT-CNTL'                   20000010
200100                                 TO AA-PARAGRAPH-NAME             20010010
200200             MOVE 'UNSUCCESSFUL UPDATE'                           20020010
200300                                 TO AA-DB2-OPERATION              20030010
200400             MOVE 'TCKRSTCNTL'   TO AA-DB2-TABLE-1                20040010
200500             MOVE SPACES         TO AA-DB2-TABLE-2                20050010
200600                                    AA-DB2-TABLE-3                20060010
200700             PERFORM Z998-DB2-ABEND                               20070010
200800     END-EVALUATE.                                                20080010
200900 EJECT                                                            20090010
201000*---------------------------------------------------------------  20100010
201100*    UPDATES THE CHECKPOINT RESTART INFO TABLE.  THE WORKING      20110010
201200*    STORAGE DESCRIPTION FIELD IS UPDATED WITH THE LAST COMMITED  20120010
201300*    PO STORE NUMBER COMBINATION.                                 20130010
201400*---------------------------------------------------------------  20140010
201500 U510-UPDATE-CHECKPOINT-INFO.                                     20150010
201600                                                                  20160010
201700     EXEC SQL                                                     20170010
201800         UPDATE TCKRSTINF                                         20180010
201900         SET WORK_STRG_DESC   = :TCKRSTINF-WORK-STRG-DESC         20190010
202000         WHERE PLAN_NAME      = :PV-PROGRAM-NAME                  20200010
202100     END-EXEC.                                                    20210010
202200                                                                  20220010
202300     EVALUATE TRUE                                                20230010
202400         WHEN SQLCODE = ZEROS                                     20240010
202500              CONTINUE                                            20250010
202600                                                                  20260010
202700         WHEN OTHER                                               20270010
202800             MOVE 'U510-UPDATE-CHECKPOINT-INFO'                   20280010
202900                                 TO AA-PARAGRAPH-NAME             20290010
203000             MOVE 'UNSUCCESSFUL UPDATE'                           20300010
203100                                 TO AA-DB2-OPERATION              20310010
203200             MOVE 'TCKRSTINF'    TO AA-DB2-TABLE-1                20320010
203300             MOVE SPACES         TO AA-DB2-TABLE-2                20330010
203400                                    AA-DB2-TABLE-3                20340010
203500             PERFORM Z998-DB2-ABEND                               20350010
203600     END-EVALUATE.                                                20360010
203700 EJECT                                                            20370010
203800*---------------------------------------------------------------  20380010
203900*    INSERTS A ROW ON THE DETAIL ENTRY REPORT OUTPUT TABLE.       20390010
204000*---------------------------------------------------------------  20400010
204100 U600-INSERT-DETAIL-ENTRY.                                        20410010
204200                                                                  20420010
204300     EXEC SQL                                                     20430010
204400         INSERT INTO TOUTAP6                                      20440010
204500             (DTL_ENTR_RPT_ODR)                                   20450010
204600         VALUES                                                   20460010
204700             (:OUTAP6-DTL-ENTR-RPT-ODR)                           20470010
204800     END-EXEC.                                                    20480010
204900                                                                  20490010
205000     EVALUATE TRUE                                                20500010
205100         WHEN SQLCODE = ZEROS                                     20510010
205200              CONTINUE                                            20520010
205300                                                                  20530010
205400         WHEN OTHER                                               20540010
205500             MOVE 'U600-INSERT-DETAIL-ENTRY'                      20550010
205600                                 TO AA-PARAGRAPH-NAME             20560010
205700             MOVE 'UNSUCCESSFUL INSERT'                           20570010
205800                                 TO AA-DB2-OPERATION              20580010
205900             MOVE 'TOUTAP6'      TO AA-DB2-TABLE-1                20590010
206000             MOVE SPACES         TO AA-DB2-TABLE-2                20600010
206100                                    AA-DB2-TABLE-3                20610010
206200             PERFORM Z998-DB2-ABEND                               20620010
206300     END-EVALUATE.                                                20630010
206400 EJECT                                                            20640010
206500*---------------------------------------------------------------  20650010
206600*    COMMITS ALL DB2 UPDATES PERFORMED.                           20660010
206700*---------------------------------------------------------------  20670010
206800 Z100-COMMIT.                                                     20680010
206900                                                                  20690010
207000     EXEC SQL                                                     20700010
207100         COMMIT                                                   20710010
207200     END-EXEC.                                                    20720010
207300                                                                  20730010
207400     EVALUATE TRUE                                                20740010
207500         WHEN SQLCODE = ZERO                                      20750010
207600              CONTINUE                                            20760010
207700                                                                  20770010
207800         WHEN SQLWARN0 NOT = SPACES                               20780010
207900         WHEN SQLCODE  NOT = ZERO                                 20790010
208000             MOVE 'Z100-COMMIT'  TO AA-PARAGRAPH-NAME             20800010
208100             MOVE 'UNSUCCESSFUL COMMIT'                           20810010
208200                                 TO AA-DB2-OPERATION              20820010
208300             MOVE SPACES         TO AA-DB2-TABLE-1                20830010
208400                                    AA-DB2-TABLE-2                20840010
208500                                    AA-DB2-TABLE-3                20850010
208600             PERFORM Z998-DB2-ABEND                               20860010
208700     END-EVALUATE.                                                20870010
208800 EJECT                                                            20880010
208900                                                                  20890010
209000*------------------------------------------------------------*    20900010
209100*  CALLS THE CALENDAR ROUTINE                                *    20910010
209200*------------------------------------------------------------*    20920010
209300 Z900-CALENDAR-ROUTINE.                                           20930010
209400                                                                  20940010
209500     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    20950010
209600                                             DPG54 DPG55 DPG56.   20960010
209700                                                                  20970010
209800     IF DPG54-SEVERE-ERROR OR DPG54-WARNING-ERROR                 20980010
209900         MOVE 'Z900-CALENDAR-ROUTINE'  TO AA-PARAGRAPH-NAME       20990010
210000         MOVE DPG54-ERROR-MESSAGE      TO AA-MESSAGE-1            21000010
210100         MOVE DPG52-DB2-ISO-DATE-FMT   TO AA-MESSAGE-2            21010010
210200         SET AC-DATE-ERROR             TO TRUE                    21020010
210300         PERFORM Z998-DB2-ABEND                                   21030010
210400     END-IF.                                                      21040010
210500                                                                  21050010
210600 EJECT                                                            21060010
210700*------------------------------------------------------------*    21070010
210800*  ABEND ROUTINE                                             *    21080010
210900*------------------------------------------------------------*    21090010
211000 Z998-DB2-ABEND.                                                  21100010
211100                                                                  21110010
211200     CLOSE  INVOICE-FILE                                          21120010
211300            RECEIVER-PO-STR-FILE.                                 21130013
211400                                                                  21140010
211500     DISPLAY AA-ABEND-LIT.                                        21150010
211600     DISPLAY AA-DB2-ERROR-LIT.                                    21160010
211700     DISPLAY AA-PROGRAM-LIT.                                      21170010
211800     DISPLAY AA-PARAGRAPH-LIT.                                    21180010
211900     DISPLAY AA-DB2-OPERATION-LIT.                                21190010
212000     DISPLAY AA-DB2-TABLE-1.                                      21200010
212100     DISPLAY AA-DB2-TABLE-2.                                      21210010
212200     DISPLAY AA-DB2-TABLE-3.                                      21220010
212300     DISPLAY '*****                PO = ' PV-SAVED-PO-NBR.        21230010
212400     DISPLAY '*****       SAVED STORE = ' PV-SAVED-STR-NBR.       21240010
212500     SET AC-DB2-ERROR TO TRUE.                                    21250010
212600                                                                  21260010
212700     COPY DPPD004.                                                21270010
212800                                                                  21280010
212900     CALL 'ILBOABN0' USING ABEND-CODE.                            21290010
213000 EJECT                                                            21300010
213100*---------------------------------------------------------------  21310010
213200*    ABEND ROUTINE                                                21320010
213300*---------------------------------------------------------------  21330010
213400 Z999-ABEND.                                                      21340010
213500                                                                  21350010
213600     CLOSE  INVOICE-FILE                                          21360010
213700            RECEIVER-PO-STR-FILE.                                 21370013
213800                                                                  21380010
213900     DISPLAY AA-ABEND-LIT.                                        21390010
214000     DISPLAY AA-PROGRAM-LIT.                                      21400010
214100     DISPLAY AA-PARAGRAPH-LIT.                                    21410010
214200     DISPLAY AA-MESSAGE-LINE.                                     21420010
214300     CALL 'ILBOABN0' USING ABEND-CODE.                            21430010
