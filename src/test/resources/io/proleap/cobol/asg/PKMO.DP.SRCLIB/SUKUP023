000400***************************************************************** 00040001
000500 IDENTIFICATION DIVISION.                                         00050001
000600***************************************************************** 00060001
000700 PROGRAM-ID.             SUKUP023.                                00070001
000800 AUTHOR.                 PATRICK BURKE.                           00080001
000900 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00090001
001000 DATE-WRITTEN.           JUNE 2006.                               00100001
001100 DATE-COMPILED.                                                   00110001
001200*                                                                 00120001
001300***************************************************************** 00130001
001400* THIS PROGRAM WILL BE USED TO DELETE ELIGIBLE ROWS AT PO/REC     00140001
001500* LEVEL IN TABLE SUT_PRC_MSG_CNTL.                                00150001
001600***************************************************************** 00160001
001700 ENVIRONMENT DIVISION.                                            00170001
001800***************************************************************** 00180001
001900 CONFIGURATION SECTION.                                           00190001
002000 SOURCE-COMPUTER.                        IBM-3090.                00200001
002100 OBJECT-COMPUTER.                        IBM-3090.                00210001
002200 INPUT-OUTPUT SECTION.                                            00220001
002300 FILE-CONTROL.                                                    00230001
002400                                                                  00240001
002500     SELECT EXTRACT-FILE                                          00250001
002600         ASSIGN TO INP01.                                         00260001
002700/                                                                 00270001
002800***************************************************************** 00280001
002900 DATA DIVISION.                                                   00290001
003000***************************************************************** 00300001
003100 FILE SECTION.                                                    00310001
003200                                                                  00320001
003300 FD  EXTRACT-FILE                                                 00330001
003400     RECORDING MODE IS F                                          00340001
003500     LABEL RECORDS ARE STANDARD                                   00350001
003600     BLOCK CONTAINS 0 RECORDS.                                    00360001
003700 01  EXTRACT-RECORD                   PIC X(50).                  00370003
003800/                                                                 00380001
003900***************************************************************** 00390001
004000 WORKING-STORAGE SECTION.                                         00400001
004100***************************************************************** 00410001
004200                                                                  00420001
004300 01  PS-SWITCHES.                                                 00430001
004400     05  PS-END-OF-INPUT-FILE-SW      PIC X(01) VALUE 'N'.        00440001
004500         88  PS-END-OF-INPUT                    VALUE 'Y'.        00450001
004600         88  PS-NOT-END-OF-INPUT                VALUE 'N'.        00460001
004700                                                                  00470001
004800 01  PV-VARIABLES.                                                00480001
004900     05  PV-READ-COUNT                PIC S9(7) COMP-3            00490001
005000                                                VALUE ZERO.       00500001
005100     05  PV-REC-READ-QTY              PIC S9(7) COMP-3            00510001
005200                                                VALUE ZERO.       00520001
005300     05  PV-WRITE-COUNT               PIC S9(7) COMP-3            00530001
005400                                                VALUE ZERO.       00540001
005500     05  PV-PAGE-COUNT                PIC S9(3) COMP-3            00550001
005600                                                VALUE ZERO.       00560001
005700     05  PV-LINE-COUNT                PIC S9(04) VALUE ZERO       00570001
005800                                                 COMP SYNC.       00580001
005900     05  PV-DB2-FUNCTION              PIC X(30) VALUE SPACES.     00590001
006000     05  PV-PARAGRAPH                 PIC X(30) VALUE SPACES.     00600001
006100     05  PV-DISP-NUMBER               PIC Z,ZZZ,ZZ9.              00610001
006200                                                                  00620001
006300     05  PV-RUN-DATE                  PIC X(10) VALUE SPACES.     00630001
006400     05  PV-SAVE-START-DATE           PIC X(10) VALUE SPACES.     00640001
006500     05  PV-ERROR-MESSAGE-1           PIC X(60)  VALUE SPACES.    00650001
006600     05  PV-ERROR-MESSAGE-2           PIC X(60)  VALUE SPACES.    00660001
006700     05  PV-DB2-YEAR                  PIC S9(08) COMP             00670001
006800                                          VALUE ZERO.             00680001
006900     05  PV-DB2-MONTH                 PIC S9(08) COMP             00690001
007000                                          VALUE ZERO.             00700001
007100     05  PV-DB2-DAY                   PIC S9(08) COMP             00710001
007200                                          VALUE ZERO.             00720001
007300     05  PV-DB2-HOUR                  PIC S9(08) COMP             00730001
007400                                          VALUE ZERO.             00740001
007500     05  PV-DB2-MINUTE                PIC S9(08) COMP             00750001
007600                                          VALUE ZERO.             00760001
007700     05  PV-DB2-SECOND                PIC S9(08) COMP             00770001
007800                                          VALUE ZERO.             00780001
007900                                                                  00790001
008000     05  PV-DISPLAY-COUNT             PIC ZZZ,ZZZ,ZZ9.            00800001
008100     05  PV-COMMIT-COUNT              PIC S9(09)    VALUE +0      00810001
008200                                                   COMP SYNC.     00820001
008300     05  PV-COMMIT-COUNTER            PIC 9(09)   VALUE ZERO.     00830003
008310     05  PV-DELETE-COUNTER            PIC 9(09)   VALUE ZERO.     00831003
008400                                                                  00840001
008410     05  PV-DISP-NBR                  PIC ZZZ,ZZZ,ZZZ,ZZ9.        00841003
008420                                                                  00842003
008500     05  PV-DELETE-SUT00094           PIC S9(09)    VALUE ZERO    00850002
008600                                                   COMP SYNC.     00860001
008700     05  PV-NOT-FOUND-SUT00094        PIC S9(09)    VALUE +0      00870002
008800                                                   COMP SYNC.     00880001
008900     05  PV-TRIP-STAT-CDE-SU          PIC S9(09)    VALUE ZERO    00890001
009000                                                   COMP SYNC.     00900001
009100     05  PV-TRIP-STAT-CDE-AR          PIC S9(09)    VALUE ZERO    00910001
009200                                                   COMP SYNC.     00920001
009300     05  PV-TRIP-STAT-CDE-DR          PIC S9(09)    VALUE ZERO    00930001
009400                                                   COMP SYNC.     00940001
009500     05  PV-CURR-TMST                 PIC X(26) VALUE SPACES.     00950001
009600     05  PV-CURR-FUNC-TMST            PIC X(26) VALUE SPACES.     00960001
009700     05  PV-FUNC-QTY                  PIC S9(09) COMP.            00970001
009800                                                                  00980001
009900                                                                  00990001
010000******************************************************************01000001
010100 01  PV-ABEND-FIELDS.                                             01010001
010200     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         01020001
010300                                                 COMP SYNC.       01030001
010400     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'SUKUP023'.01040001
010500     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01050001
010600     05  PV-ABEND-OPERATION           PIC  X(51) VALUE SPACES.    01060001
010700     05  PV-ABEND-STRUCTURE-1         PIC X(8)   VALUE SPACES.    01070001
010800     05  PV-ABEND-STRUCTURE-2         PIC X(8)   VALUE SPACES.    01080001
010900     05  PV-ABEND-STRUCTURE-3         PIC X(8)   VALUE SPACES.    01090001
011000     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01100001
011100     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01110001
011200     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01120001
011300/                                                                 01130001
011400 01  PC-CONSTANTS.                                                01140001
011500     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'SUKUP023'. 01150001
011600     05  PC-ROW-NOT-FOUND             PIC S9(04)    VALUE +100    01160001
011700                                                   COMP SYNC.     01170001
011800     05  PC-COMMIT-HOLD               PIC 9(3)      VALUE 200.    01180001
011900/                                                                 01190001
012000******************************************************************01200001
012100*  COPYBOOK FOR UPLOAD TRANSACTION CODES AND ERROR CODES.         01210001
012200******************************************************************01220001
012300     COPY PCWS208.                                                01230001
012400*                                                                 01240001
012500******************************************************************01250001
012600*  COPYBOOK USED FOR INPUT FILE                                   01260003
012700******************************************************************01270001
012800     COPY SURD073.                                                01280003
012900*                                                                 01290001
013000******************************************************************01300001
013100*  COPYBOOK USED BY MBS SYSTEM                                    01310001
013200******************************************************************01320001
013300     COPY DPWS003.                                                01330001
013400*                                                                 01340001
013500******************************************************************01350001
013600*  WORKING STORAGE AREA FOR NAME REFORMAT DPPD024                 01360001
013700******************************************************************01370001
013800     COPY DPWS024.                                                01380001
013900/                                                                 01390001
014000******************************************************************01400001
014100*  DB2 FORMATTED MESSAGE AREA                                     01410001
014200******************************************************************01420001
014300     COPY DPWS004.                                                01430001
014400/                                                                 01440001
014500******************************************************************01450001
014600* CORPORATE DATE ROUTINES                                         01460001
014700******************************************************************01470001
014800     COPY DPWS500.                                                01480001
014900/                                                                 01490001
015000******************************************************************01500001
015100*   DB2 SQL COMMUNICATION AREA                                    01510001
015200******************************************************************01520001
015300     EXEC SQL                                                     01530001
015400         INCLUDE SQLCA                                            01540001
015500     END-EXEC.                                                    01550001
015600*                                                                 01560001
015700     COPY SQLCA2.                                                 01570001
015800*                                                                 01580001
015900******************************************************************01590001
016000*   SUT_PRC_MSG_CNTL                                              01600001
016100******************************************************************01610001
016200*                                                                 01620001
016300     EXEC SQL                                                     01630001
016400         INCLUDE SUT00094                                         01640001
016500     END-EXEC.                                                    01650001
016600*                                                                 01660001
016700******************************************************************01670001
016800 PROCEDURE DIVISION.                                              01680001
016900******************************************************************01690001
017000 0000-MAINLINE.                                                   01700001
017100                                                                  01710001
017200     PERFORM 1000-INITIALIZE.                                     01720001
017300                                                                  01730001
017400     PERFORM 2000-PROCESS-EXTRACT                                 01740001
017500         UNTIL PS-END-OF-INPUT.                                   01750001
017600                                                                  01760001
017700     PERFORM 9000-EOJ.                                            01770001
017800                                                                  01780001
017900      GOBACK.                                                     01790001
018000                                                                  01800001
018100******************************************************************01810001
018200*  INITIALIZATION TASKS.                                          01820001
018300*    -- OPEN INPUT FILE                                           01830001
018400*    -- READ FILE                                                 01840001
018500******************************************************************01850001
018600 1000-INITIALIZE.                                                 01860001
018700                                                                  01870001
018800     OPEN INPUT  EXTRACT-FILE.                                    01880001
018900                                                                  01890001
019000     PERFORM 2100-READ-EXTRACT.                                   01900001
019400/                                                                 01940001
019500******************************************************************01950001
019600 2000-PROCESS-EXTRACT.                                            01960001
019700******************************************************************01970001
019800*                                                                 01980001
019900     PERFORM 8100-DELETE.                                         01990002
020000                                                                  02000001
020100     PERFORM 2200-COMMIT-DELETE                                   02010001
020200                                                                  02020001
020300     PERFORM 2100-READ-EXTRACT.                                   02030001
020400*                                                                 02040001
020500******************************************************************02050001
020600*  READ NEXT INPUT FILE RECORD.                                   02060001
020700******************************************************************02070001
020800 2100-READ-EXTRACT.                                               02080001
020900                                                                  02090001
021000     READ EXTRACT-FILE INTO SU073-EXTRACT-RECORD                  02100003
021100        AT END                                                    02110001
021200           SET PS-END-OF-INPUT TO TRUE                            02120001
021300        NOT AT END                                                02130001
021400           ADD +1                   TO PV-READ-COUNT              02140001
021500     END-READ.                                                    02150001
021600*                                                                 02160001
021700******************************************************************02170001
021800* COMMIT THE DELETE FROM ERROR TABLE                              02180001
021900******************************************************************02190001
022000 2200-COMMIT-DELETE.                                              02200001
022100                                                                  02210001
022200      EXEC SQL                                                    02220001
022300         COMMIT                                                   02230001
022400      END-EXEC                                                    02240001
022500                                                                  02250001
022600      ADD +1                          TO PV-COMMIT-COUNT          02260001
022700      MOVE +0 TO PV-COMMIT-COUNTER.                               02270001
022800                                                                  02280001
022900*                                                                 02290001
023000******************************************************************02300001
023100* DELETE THE ROWS FROM THE SUT_PRC_MSG_CNTL TABLE                 02310003
023200******************************************************************02320001
023300 8100-DELETE.                                                     02330003
023400                                                                  02340001
023500     MOVE SU073-PO-NBR             TO SUT00094-PO-NBR.            02350003
023510     MOVE SU073-REC-SEQ-NBR        TO SUT00094-RCVR-SEQ-NBR.      02351003
023600                                                                  02360001
023700     EXEC SQL                                                     02370001
023800         DELETE                                                   02380001
023900             FROM  SUT_PRC_MSG_CNTL                               02390003
024000             WHERE PO_NBR          = :SUT00094-PO-NBR             02400003
024010               AND RCVR_SEQ_NBR    = :SUT00094-RCVR-SEQ-NBR       02401003
024100     END-EXEC.                                                    02410001
024200                                                                  02420001
024300     EVALUATE TRUE                                                02430001
024400         WHEN SQLCODE = 0                                         02440001
024600             ADD +1           TO PV-DELETE-SUT00094               02460003
024610             ADD SQLERRD(3)   TO PV-DELETE-COUNTER                02461003
024700         WHEN SQLCODE = +100                                      02470001
024800             ADD +1           TO PV-NOT-FOUND-SUT00094            02480003
024900         WHEN SQLCODE < 0                                         02490001
025000         WHEN SQLCODE > 0                                         02500001
025100         WHEN SQLWARN0 = 'W'                                      02510001
025200             MOVE '8100-DELETE'                                   02520003
025300                         TO PV-PARAGRAPH                          02530001
025400             MOVE 'DELETE OF SUT00094'                            02540003
025500                         TO PV-DB2-FUNCTION                       02550001
025600             PERFORM 9200-SQL-ABEND                               02560001
025700     END-EVALUATE.                                                02570001
025800/                                                                 02580001
027600******************************************************************02760001
027700*CLOSE INPUT FILE.                                                02770001
027800******************************************************************02780001
027900 9000-EOJ.                                                        02790001
028000*                                                                 02800001
028100     CLOSE EXTRACT-FILE.                                          02810001
028200                                                                  02820001
028201     MOVE PV-DELETE-COUNTER           TO PV-DISP-NBR              02820103
028202     DISPLAY 'SUT_PRC_MSG_CNTL DELETES   = '  PV-DISP-NBR.        02820203
028210                                                                  02821003
028300     MOVE PV-DELETE-SUT00094  TO PV-DISPLAY-COUNT.                02830003
028400     DISPLAY 'SUT_PRC_MSG_CNTL PO/RCVR DELETED ' PV-DISPLAY-COUNT.02840003
028500     MOVE PV-NOT-FOUND-SUT00094 TO PV-DISPLAY-COUNT.              02850003
028600     DISPLAY 'SUT_PRC_MSG_CNTL PO/RCVR NOTFOUND' PV-DISPLAY-COUNT.02860003
028700                                                                  02870001
029900     MOVE PV-COMMIT-COUNT  TO PV-DISPLAY-COUNT.                   02990001
030000     DISPLAY 'TOTAL COMMITS TAKEN        ' PV-DISPLAY-COUNT.      03000001
030100/                                                                 03010001
030200******************************************************************03020001
030300 9200-SQL-ABEND.                                                  03030001
030400******************************************************************03040001
030500                                                                  03050001
030600     MOVE SQLCODE                     TO SQLCODE2.                03060001
030700     MOVE SQLERRD(3)                  TO SQLERRD3.                03070001
030800                                                                  03080001
030900     DISPLAY '** ABEND **         ** = SQLERROR'.                 03090001
031000     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        03100001
031100     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH.                   03110001
031200     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                03120001
031300     DISPLAY '*** MESSAGE     = ' PV-DB2-OPERATION-MESSAGE-1.     03130001
031400     DISPLAY '***             = ' PV-DB2-OPERATION-MESSAGE-2.     03140001
031500     DISPLAY '***             = ' PV-DB2-OPERATION-MESSAGE-3.     03150001
031600                                                                  03160001
031700     DISPLAY '** SQLCODE          ** = ' SQLCODE2.                03170001
031800     DISPLAY '** ROWS PROCESSED   ** = ' SQLERRD3.                03180001
031900     DISPLAY '** SQLERRM          ** = ' SQLERRM.                 03190001
032000     DISPLAY '** SQLERRMC         ** = ' SQLERRMC.                03200001
032100                                                                  03210001
032200                                                                  03220001
032300     MOVE +4013                       TO PV-ABEND-CODE.           03230001
032400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         03240001
032500                                                                  03250001
