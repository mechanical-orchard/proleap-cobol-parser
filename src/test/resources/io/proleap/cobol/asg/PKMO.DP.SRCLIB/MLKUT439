       IDENTIFICATION DIVISION.                                         00010047
       PROGRAM-ID.    MLKUT439.                                         00020047
       AUTHOR.        SCOTT JACKSON.                                    00030047
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040047
       DATE-WRITTEN.  07-06-99.                                         00050047
       DATE-COMPILED.                                                   00060047
      ******************************************************************00070047
      * MLKUT439 - DESCRIPTION.............                             00080047
      *                                                                 00090047
      * THIS PROGRAM WILL OBTAIN THE TOP 40 DEPARTMENTS WITH THE HIGHEST00100047
      * SALES FOR THE CURRENT MONTH. THE PROGRAM WILL THEN OBTAIN THE   00110047
      * TOP SELLING SUB-CLASS WITHIN EACH OF THE TOP TEN DEPARTMENTS.   00120047
      *                                                                 00130047
      * THESE DEPARTMENT/SUBCLASS COMBINATIONS WILL THEN BE WRITTEN TO  00140047
      * AN OUTPUT FILE WHICH WILL BE USED TO CONTROL DOLLAR REVERSALS.  00150047
      *                                                                 00160047
      *CHANGE HISTORY:                                                  00162050
      * WR/PROJ DATE       PGMR        DESCRIPTION OF CHANGES           00163050
      * ------- ---------- ----------- -------------------------------- 00164050
      ******************************************************************00170047
      * CHANGES : 2/03/2000  SCOTT JACKSON     CHG ID : TOP40           00180047
      *                                                                 00190047
      * USERS HAVE REQUESTED THAT DEPT 099-10 DOLLARS SHOULD BE REVERSED00200047
      * AND RE-ALLOCATED TO TOP 40 DEPARTMENTS (VS. TOP 10).            00210047
      *                                                                 00220047
      ******************************************************************00230050
      * CHANGES : 6/06/2002  RONNA BUTZ        CHG ID : RB0606          00240048
      *                                                                 00250048
      * COMMENTED OUT CODE THAT DOES A SELECT ON TMNSCL AND REPLACED IT 00260048
      * WITH A CURSOR.  THIS WAS DONE BECAUSE OF A FLUKE AND THE SELECT 00270048
      * STATEMENT BROUGHT BACK TWO ROWS. IT JUST HAPPENED THAT CLASS    00280048
      * 055, HAD TWO SUBCLASSES THAT CONTAINED THE SAME TOTAL SALES     00290048
      * RETAIL AMOUNT.  THE SOLUTION IS TO USE A CURSOR AND JUST USE THE00300048
      * FIRST RECORD FROM THE CURSOR.                                   00310048
      *                                                                 00310150
W26603* W26603  03-08-2004 ROD JANSSEN MERCH LEDGER STORE EXPANSION     00311050
      ******************************************************************00340048
      *                                                                 00350047
      *                                                                 00360047
       ENVIRONMENT DIVISION.                                            00370047
      *                                                                 00380047
       CONFIGURATION SECTION.                                           00390047
      *                                                                 00400047
       SOURCE-COMPUTER.        IBM-3090.                                00410047
       OBJECT-COMPUTER.        IBM-3090.                                00420047
      *                                                                 00430047
       INPUT-OUTPUT SECTION.                                            00440047
       FILE-CONTROL.                                                    00450047
                                                                        00460047
           SELECT REVERSAL-CONTROL-CARD                                 00470047
               ASSIGN TO OUT01.                                         00480047
                                                                        00490047
      ******************************************************************00500047
       DATA DIVISION.                                                   00510047
      ******************************************************************00520047
                                                                        00530047
       FILE SECTION.                                                    00540047
                                                                        00550047
       FD  REVERSAL-CONTROL-CARD                                        00560047
           RECORDING MODE IS F                                          00570047
           LABEL RECORDS ARE STANDARD                                   00580047
           BLOCK CONTAINS 0 RECORDS.                                    00590047
      *                                                                 00600047
       01  REVERSAL-ENTRIES            PIC X(80).                       00610047
                                                                        00620047
      ******************************************************************00640047
       WORKING-STORAGE SECTION.                                         00650047
      ******************************************************************00660047
                                                                        00680047
       01  PC-PROGRAM-CONSTANTS.                                        00690047
           05  PC-JOB-NAME             PIC  X(07)    VALUE 'MLK490C'.   00700047
           05  PC-PROGRAM-NAME         PIC  X(08)    VALUE 'MLKUT439'.  00710047
                                                                        00720047
       01  ABEND-CODE                  PIC S9(04)  VALUE ZERO COMP SYNC.00730047
                                                                        00740047
       01  PA-PROGRAM-ACCUMULATORS.                                     00750047
           05  PA-DEPT-COUNT                   PIC  9(02) VALUE ZEROES. 00760047
                                                                        00770047
       01  PS-PROGRAM-SWITCHES.                                         00780047
           05  PS-LOAD-CONTROL-TABLE-SW        PIC X     VALUE 'N'.     00790047
               88  PS-TABLE-FILLED                       VALUE 'Y'.     00800047
      *                                                                 00810047
       01  PROGRAM-VARIABLES.                                           00820047
           05  PV-SUB                          PIC  9(02) VALUE ZEROES. 00830047
           05  PV-SUB2                         PIC  9(02) VALUE ZEROES. 00840047
           05  PV-HOLD-DEPT                    PIC  X(03) VALUE SPACES. 00850047
           05  PV-PARAGRAPH-NAME               PIC  X(30) VALUE SPACES. 00860047
           05  PV-ABEND-MESSAGE                PIC  X(75) VALUE SPACES. 00870047
           05  PV-OPERATION-ATTEMPTED          PIC  X(30) VALUE SPACES. 00880047
W26603     05  PV-DEPT-DOLLARS       PIC Z,ZZZ,ZZZ,ZZZ.ZZ- VALUE ZEROES.00890050
W26603     05  PV-SCL-DOLLARS        PIC Z,ZZZ,ZZZ,ZZZ.ZZ- VALUE ZEROES.00900050
      *                                                                 00910047
       01  PROGRAM-CONSTANTS.                                           00920047
TOP40      05  PC-MAX-COUNT            PIC S9(2)   VALUE +40.           00930047
      *                                                                 00940047
      *                                                                 00950047
       01  PE-PROGRAM-ERROR-MESSAGES.                                   00960047
           05  PE-MSG-01                       PIC X(30) VALUE          00970047
                'SELECT CONTROL TABLE DATES   '.                        00980047
           05  PE-MSG-02                       PIC X(30) VALUE          00990047
                'SELECT MNSCL ROW ON MAX SALES'.                        01000047
           05  PE-MSG-03                       PIC X(30) VALUE          01010047
                'ATTEMPTING TO OPEN DB2 CURSOR'.                        01020047
           05  PE-MSG-04                       PIC X(30) VALUE          01030047
                'ATTEMPT TO FETCH CURSOR ROW  '.                        01040047
           05  PE-MSG-05                       PIC X(30) VALUE          01050047
                'ATTEMPT TO CLOSE DB2 CURSOR  '.                        01060047
      *                                                                 01070047
      *                                                                 01080047
       01  DEPT-TABLE.                                                  01090047
TOP40      05  DT-CONTROL-ENTRIES OCCURS 40 TIMES.                      01100047
               10  DT-DEPT-NBR             PIC  X(03)      VALUE SPACES.01110047
W26603         10  DT-DEPT-SLS-RTL-AMT     PIC S9(13)V9(2) VALUE ZEROES.01120050
               10  DT-SCL-NBR              PIC  X(02)      VALUE SPACES.01130047
W26603         10  DT-SCL-SLS-RTL-AMT      PIC S9(13)V9(2) VALUE ZEROES.01140050
                                                                        01150047
       01  CONTROL-CARD-RECORDS.                                        01160047
           05  CC-DEPT-NBR                 PIC  X(03)      VALUE SPACES.01170047
           05  FILLER                      PIC  X(01)      VALUE '-'.   01180047
           05  CC-SCL-NBR                  PIC  X(02)      VALUE SPACES.01190047
           05  FILLER                      PIC  X(74)      VALUE SPACES.01200047
                                                                        01210047
      ****************************************************              01220047
      *  COMMUNICATION AREAS FOR DB2                     *              01230047
      ****************************************************              01240047
           EXEC SQL                                                     01250047
               INCLUDE SQLCA                                            01260047
           END-EXEC.                                                    01270047
      ****************************************************              01280047
      *  M/L MONTH-TO-DATE DEPARTMENT TABLE              *              01290047
      ****************************************************              01300047
           EXEC SQL                                                     01310047
               INCLUDE TMNDPT                                           01320047
           END-EXEC.                                                    01330047
      ****************************************************              01340047
      *  M/L MONTH-TO-DATE SUB-CLASS  TABLE              *              01350047
      ****************************************************              01360047
           EXEC SQL                                                     01370047
               INCLUDE TMNSCL                                           01380047
           END-EXEC.                                                    01390047
      ****************************************************              01400047
      * M/L CURRENT OPEN FISCAL DATE INFO                *              01410047
      ****************************************************              01420047
           EXEC SQL                                                     01430047
               INCLUDE TMLCNTL                                          01440047
           END-EXEC.                                                    01450047
                                                                        01460047
TOP40 *** THIS CURSOR USED TO LOAD INTERNAL TBL WITH 40 BEST SELLERS ***01470047
           EXEC SQL                                                     01480047
               DECLARE DEPT_CSR CURSOR FOR                              01490047
                  SELECT  DEPT_NBR                                      01500047
                         ,SLS_RTL_AMT                                   01510047
                    FROM TMNDPT                                         01520047
                   WHERE FSCL_MN_END_DTE = :MLCNTL-OPN-FSCL-MN-DTE      01530047
                   ORDER BY SLS_RTL_AMT DESC                            01540047
TOP40              OPTIMIZE FOR 40 ROWS                                 01550047
                  FOR FETCH ONLY                                        01560047
           END-EXEC.                                                    01570047
      *                                                                 01580047
RB0606*** MNSCLS CURSOR ADDED BECAUSE OF A -811                         01590048
RB0606     EXEC SQL                                                     01600048
RB0606         DECLARE MNSCL_CSR CURSOR FOR                             01610048
RB0606             SELECT  SUB_CL_NBR                                   01620048
RB0606                    ,SLS_RTL_AMT                                  01630048
RB0606*            INTO    :MNSCL-SUB-CL-NBR                            01640048
RB0606*                   ,:MNSCL-SLS-RTL-AMT                           01650048
RB0606               FROM TMNSCL                                        01660048
RB0606              WHERE SLS_RTL_AMT =                                 01670048
RB0606               ( SELECT MAX(SLS_RTL_AMT) AS SCL                   01680048
RB0606                   FROM TMNSCL                                    01690048
RB0606                  WHERE DEPT_NBR =        :PV-HOLD-DEPT           01700048
RB0606                    AND FSCL_MN_END_DTE = :MLCNTL-OPN-FSCL-MN-DTE)01710048
RB0606            FOR FETCH ONLY                                        01720048
RB0606     END-EXEC                                                     01730048
      *                                                                 01740047
           EJECT                                                        01750047
      *                                                                 01760047
      ****************************************************              01770047
      *  ERROR MESSAGE AREA FOR DB2                      *              01780047
      ****************************************************              01790047
           COPY DPWS004.                                                01800047
      *                                                                 01810047
      *                                                                 01820047
      *-------------------*                                             01830047
       PROCEDURE DIVISION.                                              01840047
      *-------------------*                                             01850047
                                                                        01860047
       0000-MAIN-MODULE.                                                01870047
                                                                        01880047
           PERFORM 1000-INITIALIZATION.                                 01890047
                                                                        01900047
           PERFORM 7100-PROCESS-DEPT-CURSOR.                            01910047
                                                                        01920047
           PERFORM 7200-PROCESS-SCL-ROWS                                01930047
               UNTIL PV-SUB2 = PC-MAX-COUNT.                            01940047
                                                                        01950047
           PERFORM 4000-WRITE-CONTROL-FILE.                             01960047
                                                                        01970047
           STOP RUN.                                                    01980047
                                                                        01990047
                                                                        02000047
      ******************************************************************02010047
      * RETRIEVE OPEN MONTH TO DETERMINE                                02020047
      * DETERMINE IF THIS IS A 'RESTART' (TCKRSTINF-CKPT-STAT-CODE = 9) 02030047
      ******************************************************************02040047
       1000-INITIALIZATION.                                             02050047
      *                                                                 02060047
           OPEN OUTPUT REVERSAL-CONTROL-CARD.                           02070047
                                                                        02080047
           DISPLAY PC-PROGRAM-NAME.                                     02090047
                                                                        02100047
           PERFORM 7000-READ-CONTROL-TABLE.                             02110047
      *                                                                 02120047
           INITIALIZE DEPT-TABLE                                        02130047
                      PROGRAM-VARIABLES.                                02140047
      *                                                                 02150047
      *                                                                 02160047
      ******************************************************************02170047
      * WRITE THE CONTROL FILE WITH TOP TEN DEPT / SCL COMBINATIONS     02180047
      ******************************************************************02190047
      *                                                                 02200047
       4000-WRITE-CONTROL-FILE.                                         02210047
      *                                                                 02220047
           MOVE 1                       TO PV-SUB.                      02230047
      *                                                                 02240047
           DISPLAY '**** TOP 40 ************************* TOP SCL ***', 02250047
                   '************* CONTROL CARD *****'.                  02260047
      *                                                                 02270047
           PERFORM UNTIL PV-SUB > PC-MAX-COUNT                          02280047
                                                                        02290047
               MOVE DT-DEPT-NBR(PV-SUB) TO CC-DEPT-NBR                  02300047
               MOVE DT-SCL-NBR(PV-SUB)  TO CC-SCL-NBR                   02310047
                                                                        02320047
               MOVE DT-DEPT-SLS-RTL-AMT(PV-SUB) TO PV-DEPT-DOLLARS      02330047
               MOVE DT-SCL-SLS-RTL-AMT(PV-SUB)  TO PV-SCL-DOLLARS       02340047
                                                                        02350047
               DISPLAY PV-SUB, ') ',                                    02360047
                  'DEPT ', CC-DEPT-NBR, '  SALES $', PV-DEPT-DOLLARS,   02370047
                  '   SCL ', CC-SCL-NBR, ' $', PV-SCL-DOLLARS,          02380047
                  '   CC : ' DT-DEPT-NBR(PV-SUB),                       02390047
                  '-', DT-SCL-NBR(PV-SUB)                               02400047
      *                                                                 02410047
               WRITE REVERSAL-ENTRIES FROM CONTROL-CARD-RECORDS         02420047
      *                                                                 02430047
               ADD +1 TO PV-SUB                                         02440047
      *                                                                 02450047
           END-PERFORM.                                                 02460047
      *                                                                 02470047
      *                                                                 02480047
      ******************************************************************02490047
      * READ THE DB2 CONTROL TABLE CONTAINING OPEN FISCAL DATE INFO     02500047
      ******************************************************************02510047
       7000-READ-CONTROL-TABLE.                                         02520047
                                                                        02530047
            EXEC SQL                                                    02540047
                SELECT OPN_FSCL_MN_DTE                                  02550047
                 INTO  :MLCNTL-OPN-FSCL-MN-DTE                          02560047
                 FROM  TMLCNTL                                          02570047
            END-EXEC.                                                   02580047
                                                                        02590047
           EVALUATE SQLCODE                                             02600047
               WHEN 0                                                   02610047
                   DISPLAY 'CONTROL DATES (TMLCNTL)'                    02620047
                   DISPLAY 'FISCAL OPEN MONTH  : ',                     02630047
                                                 MLCNTL-OPN-FSCL-MN-DTE 02640047
               WHEN OTHER                                               02650047
                  MOVE '7000-READ-CONTROL-TABLE' TO PV-PARAGRAPH-NAME   02660047
                  MOVE PE-MSG-01 TO PV-OPERATION-ATTEMPTED              02670047
                  PERFORM 9999-SQL-ABEND                                02680047
           END-EVALUATE.                                                02690047
      *                                                                 02700047
      *                                                                 02710047
      ***************************************************************** 02720047
      * PARAGRAPH CONTROL PROCESSING OF DEPT CURSOR OF TOP 10 SELLERS   02730047
      ***************************************************************** 02740047
       7100-PROCESS-DEPT-CURSOR.                                        02750047
      *                                                                 02760047
           PERFORM 7125-OPEN-DEPT-CURSOR.                               02770047
           PERFORM 7150-PROCESS-DEPT-CURSOR                             02780047
             UNTIL PC-MAX-COUNT = PV-SUB.                               02790047
           PERFORM 7900-CLOSE-DEPT-CURSOR.                              02800047
      *                                                                 02810047
           MOVE ZEROES TO PV-SUB.                                       02820047
      *                                                                 02830047
      *                                                                 02840047
      ***************************************************************** 02850047
      * OPEN CURSOR 'DEPT_CURSOR' FOR PROCESSING                        02860047
      ***************************************************************** 02870047
       7125-OPEN-DEPT-CURSOR.                                           02880047
      *                                                                 02890047
           EXEC SQL                                                     02900047
               OPEN DEPT_CSR                                            02910047
           END-EXEC                                                     02920047
                                                                        02930047
           EVALUATE SQLCODE                                             02940047
               WHEN 0                                                   02950047
                    CONTINUE                                            02960047
               WHEN OTHER                                               02970047
                  MOVE '7125-OPEN-DEPT-CSR' TO PV-PARAGRAPH-NAME        02980047
                  MOVE PE-MSG-03 TO PV-OPERATION-ATTEMPTED              02990047
                  PERFORM 9999-SQL-ABEND                                03000047
           END-EVALUATE.                                                03010047
      *                                                                 03020047
      *                                                                 03030047
      ***************************************************************** 03040047
      * FETCH A DEPT NUMBER TO PROCESS                                  03050047
      ***************************************************************** 03060047
       7150-PROCESS-DEPT-CURSOR.                                        03070047
      *                                                                 03080047
           EXEC SQL                                                     03090047
                  FETCH DEPT_CSR                                        03100047
                   INTO :MNDPT-DEPT-NBR                                 03110047
                       ,:MNDPT-SLS-RTL-AMT                              03120047
           END-EXEC                                                     03130047
      *                                                                 03140047
           EVALUATE SQLCODE                                             03150047
               WHEN 0                                                   03160047
                   PERFORM 7175-LOAD-DEPT-TABLE                         03170047
               WHEN OTHER                                               03180047
                   MOVE '7150-PROCESS-DEPT-C'  TO PV-PARAGRAPH-NAME     03190047
                   MOVE PE-MSG-04              TO PV-OPERATION-ATTEMPTED03200047
                   PERFORM 9999-SQL-ABEND                               03210047
             END-EVALUATE.                                              03220047
      *                                                                 03230047
      *                                                                 03240047
      ***************************************************************** 03250047
      * POPULATE INTERNAL TABLE DEPT NBR AND ASSOCIATED SALES AMT       03260047
      ***************************************************************** 03270047
       7175-LOAD-DEPT-TABLE.                                            03280047
                                                                        03290047
           ADD 1                        TO PV-SUB.                      03300047
                                                                        03310047
           MOVE MNDPT-DEPT-NBR          TO DT-DEPT-NBR(PV-SUB).         03320047
           MOVE MNDPT-SLS-RTL-AMT       TO DT-DEPT-SLS-RTL-AMT(PV-SUB). 03330047
      *                                                                 03340047
      *                                                                 03350047
      ***************************************************************** 03360047
      *                                                                 03370047
      ***************************************************************** 03380047
       7200-PROCESS-SCL-ROWS.                                           03390047
      *                                                                 03400047
           ADD +1                       TO PV-SUB                       03410047
                                           PV-SUB2.                     03420047
      *                                                                 03430047
           MOVE DT-DEPT-NBR(PV-SUB)     TO PV-HOLD-DEPT.                03440047
      *                                                                 03450047
      *                                                                 03460047
RB0606*                                                                 03470048
RB0606*    OPEN CURSOR                                                  03480048
RB0606     PERFORM 7325-OPEN-MNSCL-CURSOR.                              03490048
RB0606*    ONLY FETCH FIRST RECORD OF THE CURSOR                        03500048
RB0606     PERFORM 7350-PROCESS-MNSCL-CURSOR.                           03510048
RB0606*    CLOSE THE CURSOR                                             03520048
RB0606     PERFORM 7399-CLOSE-MNCLS-CURSOR.                             03530048
      *                                                                 03540047
RB0606*                                                                 03550048
RB0606*    EXEC SQL                                                     03560048
RB0606*        SELECT  SUB_CL_NBR                                       03570048
RB0606*               ,SLS_RTL_AMT                                      03580048
RB0606*        INTO    :MNSCL-SUB-CL-NBR                                03590048
RB0606*               ,:MNSCL-SLS-RTL-AMT                               03600048
RB0606*          FROM TMNSCL                                            03610048
RB0606*         WHERE SLS_RTL_AMT =                                     03620048
RB0606*              ( SELECT MAX(SLS_RTL_AMT) AS SCL                   03630048
RB0606*                  FROM TMNSCL                                    03640048
RB0606*                 WHERE DEPT_NBR =        :PV-HOLD-DEPT           03650048
RB0606*                   AND FSCL_MN_END_DTE = :MLCNTL-OPN-FSCL-MN-DTE)03660048
RB0606*    END-EXEC                                                     03670048
RB0606*                                                                 03680048
RB0606*    EVALUATE SQLCODE                                             03690048
RB0606*        WHEN 0                                                   03700048
RB0606*            PERFORM 7250-LOAD-SCL-TABLE                          03710048
RB0606*        WHEN OTHER                                               03720048
RB0606*           DISPLAY 'PV-HOLD-DEPT: ', PV-HOLD-DEPT                03730048
RB0606*           MOVE '7200-PROCESS-SCL-ROWS'   TO PV-PARAGRAPH-NAME   03740048
RB0606*           MOVE PE-MSG-02 TO PV-OPERATION-ATTEMPTED              03750048
RB0606*           PERFORM 9999-SQL-ABEND                                03760048
RB0606*    END-EVALUATE.                                                03770048
      *                                                                 03780047
      ***************************************************************** 03790048
      * POPULATE INTERNAL TABLE SCL NBR WITH ASSOCIATED SALES AMT       03800048
      ***************************************************************** 03810048
       7250-LOAD-SCL-TABLE.                                             03820048
                                                                        03830048
           MOVE MNSCL-SUB-CL-NBR        TO DT-SCL-NBR(PV-SUB).          03840048
           MOVE MNSCL-SLS-RTL-AMT       TO DT-SCL-SLS-RTL-AMT(PV-SUB).  03850048
      *                                                                 03860047
RB0606***************************************************************** 03870048
RB0606* OPEN CURSOR 'DEPT_CURSOR' FOR PROCESSING                        03880048
RB0606***************************************************************** 03890048
RB0606 7325-OPEN-MNSCL-CURSOR.                                          03900048
RB0606                                                                  03910048
RB0606     EXEC SQL                                                     03920048
RB0606         OPEN MNSCL_CSR                                           03930048
RB0606     END-EXEC                                                     03940048
RB0606                                                                  03950048
RB0606     EVALUATE SQLCODE                                             03960048
RB0606         WHEN 0                                                   03970048
RB0606              CONTINUE                                            03980048
RB0606         WHEN OTHER                                               03990048
RB0606            MOVE '7325-OPEN-MNSCL-CSR' TO PV-PARAGRAPH-NAME       04000048
RB0606            MOVE PE-MSG-03 TO PV-OPERATION-ATTEMPTED              04010048
RB0606            PERFORM 9999-SQL-ABEND                                04020048
RB0606     END-EVALUATE.                                                04030048
RB0606                                                                  04040048
RB0606*                                                                 04050048
RB0606***************************************************************** 04060048
RB0606* FETCH A DEPT NUMBER TO PROCESS                                  04070048
RB0606***************************************************************** 04080048
RB0606 7350-PROCESS-MNSCL-CURSOR.                                       04090048
RB0606                                                                  04100048
RB0606     EXEC SQL                                                     04110048
RB0606            FETCH MNSCL_CSR                                       04120048
RB0606             INTO :MNSCL-SUB-CL-NBR                               04130048
RB0606                 ,:MNSCL-SLS-RTL-AMT                              04140048
RB0606     END-EXEC                                                     04150048
RB0606                                                                  04160048
RB0606     EVALUATE SQLCODE                                             04170048
RB0606         WHEN 0                                                   04180048
RB0606             PERFORM 7250-LOAD-SCL-TABLE                          04190048
RB0606         WHEN OTHER                                               04200048
RB0606             MOVE '7350-PROCESS-MNSCL'   TO PV-PARAGRAPH-NAME     04210048
RB0606             MOVE PE-MSG-04              TO PV-OPERATION-ATTEMPTED04220048
RB0606             PERFORM 9999-SQL-ABEND                               04230048
RB0606       END-EVALUATE.                                              04240048
RB0606                                                                  04250048
RB0606*                                                                 04260048
RB0606******************************************************************04270048
RB0606*                                                                 04280048
RB0606******************************************************************04290048
RB0606 7399-CLOSE-MNCLS-CURSOR.                                         04300048
RB0606     EXEC SQL                                                     04310048
RB0606         CLOSE MNSCL_CSR                                          04320049
RB0606     END-EXEC.                                                    04330048
RB0606*                                                                 04340048
RB0606     EVALUATE SQLCODE                                             04350048
RB0606         WHEN 0                                                   04360048
RB0606             CONTINUE                                             04370048
RB0606         WHEN OTHER                                               04380048
RB0606             MOVE PE-MSG-05            TO PV-OPERATION-ATTEMPTED  04390048
RB0606             MOVE  '7399-CLOSE-MNCLS-CURSOR' TO PV-PARAGRAPH-NAME 04400048
RB0606             PERFORM 9999-SQL-ABEND                               04410048
RB0606     END-EVALUATE.                                                04420048
RB0606*                                                                 04430048
RB0606*                                                                 04440048
RB0606*                                                                 04450048
      ******************************************************************04460047
      *                                                                 04470047
      ******************************************************************04480047
       7900-CLOSE-DEPT-CURSOR.                                          04490047
           EXEC SQL                                                     04500047
               CLOSE DEPT_CSR                                           04510047
           END-EXEC.                                                    04520047
      *                                                                 04530047
           EVALUATE SQLCODE                                             04540047
               WHEN 0                                                   04550047
                   CONTINUE                                             04560047
               WHEN OTHER                                               04570047
                   MOVE PE-MSG-05            TO PV-OPERATION-ATTEMPTED  04580047
                   MOVE  '7900-CLOSE-DEPT-CURSOR' TO PV-PARAGRAPH-NAME  04590047
                   PERFORM 9999-SQL-ABEND                               04600047
           END-EVALUATE.                                                04610047
      *                                                                 04620047
      *                                                                 04630047
      *                                                                 04640047
      ******************************************************************04650047
      *  STANDARD DB2 ERROR ABEND ROUTINE                               04660047
      *  THIS ROUTINE FORCES AN ABEND DUE TO A DB2 PROBLEM.             04670047
      ******************************************************************04680047
       9999-SQL-ABEND.                                                  04690047
                                                                        04700047
           MOVE +4013                 TO ABEND-CODE.                    04710047
           DISPLAY '**  ABEND     **'.                                  04720047
           DISPLAY '**  PROGRAM   ** => ' PC-PROGRAM-NAME.              04730047
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            04740047
           DISPLAY '**  OPERATION **  = ' PV-OPERATION-ATTEMPTED.       04750047
                                                                        04760047
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         04770047
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        04780047
                                                                        04790047
           COPY DPPD004.                                                04800047
           CALL 'ILBOABN0'  USING ABEND-CODE.                           04810047
      *                                                                 04820047
