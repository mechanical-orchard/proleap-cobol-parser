000100*-----------------------*                                         00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300*-----------------------*                                         00030099
000400 PROGRAM-ID.    TRKCS193.                                         00040099
000500 AUTHOR.        MARGARET MORRISON.                                00050099
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060099
000700 DATE-WRITTEN.  03/01.                                            00070099
000800 DATE-COMPILED.                                                   00080099
000900                                                                  00090099
001000*---------------------------------------------------------------* 00100099
001100*    Y193 - PO DECONSOLIDATION RELEASE INQUIRY PROGRAM          * 00110099
001200*                                                               * 00120099
001300*    THIS PROGRAM GENERATES A LIST OF CONTAINER LEVEL SPLITS    * 00130099
001400*    AND SPLITS AT THE PO ORDERED LEVEL.                        * 00140099
001500*                                                               * 00150099
001600*---------------------------------------------------------------* 00160099
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697                 
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263697* MAKING THE CALL DYNAMIC VS STATIC.                                      
263697*---------------------------------------------------------------*         
CICS  * CHANGED  1/16/2023    BY JIM HUNTER      WR: CHG0278495                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
001700                                                                  00170099
001800 ENVIRONMENT DIVISION.                                            00180099
001900                                                                  00190099
002000 DATA DIVISION.                                                   00200099
002100                                                                  00210099
002200 WORKING-STORAGE SECTION.                                         00220099
002300                                                                  00230099
002400 01  DK-DB2-KEYS.                                                 00240099
002502     15  DK-PO-NBR                      PIC S9(09)  COMP.                 
002510     15  DK-DEPT-NBR                    PIC X(03)   VALUE SPACES.         
002520     15  DK-VENDOR-NAME                 PIC X(30)   VALUE SPACES.         
002530     15  DK-STATUS                      PIC X(20)   VALUE SPACES.         
002600                                                                  00260099
002700 01  PC-PROGRAM-CONSTANTS.                                        00270099
002800     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00280099
002900                                                    'TR193A  '.   00290099
003000     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00300099
003100                                                    'TRKM193 '.   00310099
003200     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00320099
003300                                                    'TRKCS193'.   00330099
003400     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00340099
003500     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00350099
003600     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +11     00360099
003700                                                    COMP SYNC.    00370099
003800     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00380099
003900                                                    COMP SYNC.    00390099
004000     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00400099
004100                                                    +1000000      00410099
004200                                                    COMP-3.       00420099
004300     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00430099
004400                                                    COMP SYNC.    00440099
004500     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00450099
004600                                                    COMP-3.       00460099
004610     05  PC-A                           PIC  X(01)  VALUE 'A'.            
004611     05  PC-C                           PIC  X(01)  VALUE 'C'.            
004612     05  PC-D                           PIC  X(01)  VALUE 'D'.            
004620     05  PC-N                           PIC  X(01)  VALUE 'N'.            
004630     05  PC-R                           PIC  X(01)  VALUE 'R'.            
004640     05  PC-S                           PIC  X(01)  VALUE 'S'.            
004650     05  PC-Y                           PIC  X(01)  VALUE 'Y'.            
004700     05  PC-INIT-DATE-IMCNRL            PIC  X(10)  VALUE         00470099
004800                                                    '9999-09-09'. 00480099
004801     05  PC-INIT-TIME-IMCNRL            PIC  X(08)  VALUE         00470099
004802                                                    '09.09.09'.   00480099
004810     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.          
005600                                                                          
005601     05  PC-NOT-TRANSMITTED             PIC X(12)   VALUE                 
005602             'NOT TRANS   '.                                              
005603     05  PC-TRANSMITTED                 PIC X(12)   VALUE                 
005605             'TRANS       '.                                              
005606     05  PC-SCHEDULED                   PIC X(12)   VALUE                 
005607             'SCHEDULED'.                                                 
005609     05  PC-SENT-WO-SPLITS              PIC X(12)   VALUE                 
005611             'SNT W/O SPLT'.                                              
005612     05  PC-RETRANSMITTED               PIC X(12)   VALUE                 
005613             'RETRANS     '.                                              
005615                                                                          
005616     05  PC-TSYMSG-NUMBERS.                                               
005617         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.          
005618         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.          
005621         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.          
005622         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.          
005623         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.          
005624         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.          
005625         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.          
005627         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.          
005628         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.          
005629         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.          
005630         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.          
005631         10  PC-TSYMSG-02716            PIC  9(05)  VALUE 02716.          
005640                                                                          
005700 01  PS-PROGRAM-SWITCHES.                                         00570099
005800     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00580099
005900         88  PS-NO-ERROR                            VALUE 'Y'.    00590099
006000         88  PS-ERROR                               VALUE 'N'.    00600099
006100     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00610099
006200         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00620099
006300         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00630099
006331     05  PS-DCONSLR-N-SW                PIC  X(01)  VALUE 'N'.            
006332         88  PS-DCONSLR-N                           VALUE 'Y'.            
006333         88  PS-DCONSLR-N-NO                        VALUE 'N'.            
006334     05  PS-FIRST-N-SW                  PIC  X(01)  VALUE 'N'.            
006335         88  PS-FIRST-N                             VALUE 'Y'.            
006336         88  PS-FIRST-N-NO                          VALUE 'N'.            
006337     05  PS-DCONSLR-SCAC-FOUND-SW       PIC  X(01)  VALUE 'N'.            
006338         88  PS-DCONSLR-SCAC-FOUND                  VALUE 'Y'.            
006339         88  PS-DCONSLR-SCAC-FOUND-NO               VALUE 'N'.            
006400                                                                          
006500 01  PV-PROGRAM-VARIABLES.                                        00650099
006600     05  PV-DEPT-NBR              PIC  X(04).                             
006700     05  PV-DEPT-NBR-N REDEFINES                                          
006701         PV-DEPT-NBR              PIC  9(04).                             
006702     05  PV-SUB                         PIC S9(04)  VALUE +0      00660099
006703                                                    COMP SYNC.    00670099
006800     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00680099
006900                                                    COMP SYNC.    00690099
007000     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00700099
007100                                                    COMP-3.       00710099
007110     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0              
007120                                                    COMP-3.               
007200     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00720099
007300                                                    COMP-3.       00730099
007400     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      00740099
007500                                                    COMP-3.       00750099
007600     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      00760099
007700                                                    COMP-3.       00770099
007800     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      00780099
007900                                                    COMP SYNC.    00790099
008000     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      00800099
008100                                                    COMP SYNC.    00810099
008200     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      00820099
008300                                                    COMP SYNC.    00830099
008400     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      00840099
008500                                                    COMP SYNC.    00850099
011113     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0              
011114                                                    COMP-3.               
011125     05  PV-ITEM                        PIC S9(04)  VALUE +0              
011126                                                    COMP SYNC.            
011127     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0              
011128                                                    COMP SYNC.            
011129     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0              
011130                                                    COMP SYNC.            
011135     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0              
011136                                                    COMP SYNC.            
011137     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0              
011138                                                    COMP SYNC.            
011139     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0              
011140                                                    COMP SYNC.            
011141     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0              
011142                                                    COMP SYNC.            
011143     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0              
011144                                                    COMP SYNC.            
011145     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0              
011146                                                    COMP SYNC.            
011147     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0              
011148                                                    COMP SYNC.            
011149     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0              
011150                                                    COMP SYNC.            
011151     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0              
011152                                                    COMP SYNC.            
011173     05  PV-CONTNR-ID                   PIC  X(12)  VALUE SPACES.         
011174     05  PV-CONTNR-ID-PREV              PIC  X(12)  VALUE SPACES.         
011175     05  PV-CONTNR-SEQ-NBR              PIC S9(04)  VALUE +0              
011176                                                    COMP.                 
011177     05  PV-CONTNR-SEQ-NBR-PREV         PIC S9(04)  VALUE +0              
011178                                                    COMP.                 
011179     05  PV-PO-NBR                      PIC S9(09)  VALUE +0              
011180                                                    COMP.                 
011181     05  PV-IMCNRL-PO-NBR               PIC S9(09)  VALUE +0              
011182                                                    COMP.                 
011183     05  PV-DCONSLR-RLSE-CDE            PIC  X(01)  VALUE SPACES.         
011184     05  PV-DCONSLR-RLSE-CDE-PREV       PIC  X(01)  VALUE SPACES.         
011185     05  PV-DCONSLR-RLSE-NUM            PIC  X(01)  VALUE SPACES.         
011186     05  PV-DCONSLR-ACTL-DTE            PIC  X(10)  VALUE SPACES.         
011187     05  PV-DCONSLR-ACTL-DTE-PREV       PIC  X(10)  VALUE SPACES.         
011188     05  PV-DCONSLR-ACTL-TM             PIC  X(08)  VALUE SPACES.         
011189     05  PV-DCONSLR-ACTL-TM-PREV        PIC  X(08)  VALUE SPACES.         
011190     05  PV-POE-CDE                     PIC  X(04)  VALUE SPACES.         
011191     05  PV-LAST-UPD-TMST               PIC  X(26)  VALUE SPACES.         
011192     05  PV-LAST-UPD-BY-UID             PIC  X(08)  VALUE SPACES.         
011193     05  PV-ETA-TMST                    PIC  X(26)  VALUE SPACES.         
011194     05  PV-FOB-CDE                     PIC  X(05)  VALUE SPACES.         
011195     05  PV-PO-CART-CNT                 PIC S9(04)  VALUE +0              
011196                                                    COMP.                 
011197     05  PV-DCONSLR-ENT-ID              PIC S9(09)  VALUE +0              
011198                                                    COMP.                 
011199     05  PV-DCONSLR-SCAC                PIC  X(04)  VALUE SPACES.         
011200     05  PV-PO-CONTNR-TYP               PIC  X(01)  VALUE SPACES.         
011201     05  PV-PO-CONTNR-TYP-PREV          PIC  X(01)  VALUE SPACES.         
011205                                                                          
011206*----------------------------------------------------------------*        
011207*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.    *        
011208*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE            *        
011209*   APPLICATION-SPECIFIC COMMAREA.                               *        
011210*----------------------------------------------------------------*        
011211 01  LQW-LIST-QUEUE-WORK-AREA.                                            
011212     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.          
011213     05  LQW-ITEM-ENTRIES               OCCURS 11   TIMES                 
011214                                        INDEXED BY  LQW-IDX.              
011215         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.               
011216         10  LQW-TEMP-SELECTED-SW       PIC  X(01).                       
011217         10  LQW-SELECTED-SW            PIC  X(01).                       
011218             88  LQW-SELECT                         VALUE 'S'.            
011219             88  LQW-DESELECT                       VALUE ' '.            
011220         10  LQW-ACTION                 PIC  X(03).                       
011221         10  LQW-CONTNR                 PIC  X(12).                       
011222         10  LQW-CART-CNT               PIC S9(04)  COMP.                 
011223         10  LQW-POE-CDE                PIC  X(02).                       
011224         10  LQW-ETA                    PIC  X(05).                       
011225         10  LQW-RELEASE-STATUS         PIC  X(12).                       
011227         10  LQW-DCONSLR-SCAC           PIC  X(04).                       
011228         10  LQW-RELEASE-DT             PIC  X(05).                       
011229         10  LQW-RELEASE-TM             PIC  X(05).                       
011230         10  LQW-PO-CONTNR              PIC  X(01).                       
011234                                                                          
011235 EJECT                                                                    
011236*---------------------------------------------------------------*         
011237*  RECORD LAYOUT FOR THE SELECTION TEMP STORAGE QUEUE.                    
011238*---------------------------------------------------------------*         
011239                                                                          
011242     COPY TRWS120.                                                        
011243                                                                          
011244 EJECT                                                                    
011250*---------------------------------------------------------------* 01120099
011300*    MAP LAYOUT                                                 * 01130099
011400*---------------------------------------------------------------* 01140099
011500                                                                  01150099
011600     COPY TRKM193.                                                01160099
011700                                                                  01170099
011800 01  MR-OCCURS-LAYOUT                    REDEFINES  TR193AO.      01180099
011900     05  FILLER                          PIC X(125).              01190099
012000                                                                  01200099
012100     05  MR-SCROLL-AREA                  OCCURS 11 TIMES.         01210099
012200         10  MR-SELECTL                  PIC S9(04) COMP.         01220099
012300         10  MR-SELECTA                  PIC  X(01).              01230099
012400         10  MR-SELECTC                  PIC  X(01).              01240099
012500         10  MR-SELECTH                  PIC  X(01).              01250099
012600         10  MR-SELECTI                  PIC  X(01).              01260099
012700                                                                  01270099
012800         10  MR-ACTIONL                  PIC S9(04) COMP.         01280099
012900         10  MR-ACTIONA                  PIC  X(01).              01290099
013000         10  MR-ACTIONC                  PIC  X(01).              01300099
013100         10  MR-ACTIONH                  PIC  X(01).              01310099
013200         10  MR-ACTION                   PIC  X(03).              01320099
013300                                                                  01330099
013400         10  MR-CONTNRL                  PIC S9(04) COMP.         01340099
013500         10  MR-CONTNRA                  PIC  X(01).              01350099
013600         10  MR-CONTNRC                  PIC  X(01).              01360099
013700         10  MR-CONTNRH                  PIC  X(01).              01370099
013800         10  MR-CONTNR                   PIC  X(12).              01380099
013900                                                                  01390099
014000         10  MR-CART-CNT-CDEL            PIC S9(04) COMP.         01400099
014100         10  MR-CART-CNT-CDEA            PIC  X(01).              01410099
014200         10  MR-CART-CNT-CDEC            PIC  X(01).              01420099
014300         10  MR-CART-CNT-CDEH            PIC  X(01).              01430099
014400         10  MR-CART-CNT                 PIC  ZZZZ9.              01440099
014410         10  MR-CART-CNT-X REDEFINES                                      
014411             MR-CART-CNT                 PIC  X(05).                      
014500                                                                  01450099
014510         10  MR-POE-CDEL                 PIC S9(04) COMP.         01400099
014520         10  MR-POE-CDEA                 PIC  X(01).              01410099
014530         10  MR-POE-CDEC                 PIC  X(01).              01420099
014540         10  MR-POE-CDEH                 PIC  X(01).              01430099
014550         10  MR-POE-CDE                  PIC  X(02).              01440099
014560                                                                  01450099
014600         10  MR-ETAL                     PIC S9(04) COMP.         01460099
014700         10  MR-ETAA                     PIC  X(01).              01470099
014800         10  MR-ETAC                     PIC  X(01).              01480099
014900         10  MR-ETAH                     PIC  X(01).              01490099
015000         10  MR-ETA                      PIC  X(05).              01500099
015100                                                                  01510099
015200         10  MR-RELEASE-STATUSL          PIC S9(04) COMP.         01520099
015300         10  MR-RELEASE-STATUSA          PIC  X(01).              01530099
015400         10  MR-RELEASE-STATUSC          PIC  X(01).              01540099
015500         10  MR-RELEASE-STATUSH          PIC  X(01).              01550099
015600         10  MR-RELEASE-STATUS           PIC  X(12).              01560099
015700                                                                  01570099
016310         10  MR-DCONSLR-SCACL            PIC S9(04) COMP.         01850099
016320         10  MR-DCONSLR-SCACA            PIC  X(01).              01860099
016330         10  MR-DCONSLR-SCACC            PIC  X(01).              01870099
016340         10  MR-DCONSLR-SCACH            PIC  X(01).              01880099
016350         10  MR-DCONSLR-SCAC             PIC  X(04).              01890099
016360                                                                          
016400         10  MR-RELEASE-DTL              PIC S9(04) COMP.         01640099
016500         10  MR-RELEASE-DTA              PIC  X(01).              01650099
016600         10  MR-RELEASE-DTC              PIC  X(01).              01660099
016700         10  MR-RELEASE-DTH              PIC  X(01).              01670099
016800         10  MR-RELEASE-DT               PIC  X(05).              01680099
017000                                                                  01700099
017100         10  MR-RELEASE-TML              PIC S9(04) COMP.         01640099
017200         10  MR-RELEASE-TMA              PIC  X(01).              01650099
017300         10  MR-RELEASE-TMC              PIC  X(01).              01660099
017400         10  MR-RELEASE-TMH              PIC  X(01).              01670099
017500         10  MR-RELEASE-TM               PIC  X(05).              01680099
017600                                                                  01700099
018500         10  MR-PO-CONTL                 PIC S9(04) COMP.         01850099
018600         10  MR-PO-CONTA                 PIC  X(01).              01860099
018700         10  MR-PO-CONTC                 PIC  X(01).              01870099
018800         10  MR-PO-CONTH                 PIC  X(01).              01880099
018900         10  MR-PO-CONT                  PIC  X(01).              01890099
019600                                                                  01960099
019840                                                                  01960099
019900 EJECT                                                            01990099
020000*---------------------------------------------------------------* 02000099
020100*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02010099
020200*---------------------------------------------------------------* 02020099
020300                                                                  02030099
020400     COPY DPWS015.                                                02040099
020500                                                                  02050099
020600 EJECT                                                            02060099
020700*---------------------------------------------------------------* 02070099
020800*    FUNCTION KEYS COPYBOOK.                                    * 02080099
020900*---------------------------------------------------------------* 02090099
021000                                                                  02100099
021100     COPY DPWS016.                                                02110099
021200                                                                  02120099
021300 EJECT                                                            02130099
021400*---------------------------------------------------------------* 02140099
021500*    NUMERIC EDIT LAYOUT.                                       * 02150099
021600*---------------------------------------------------------------* 02160099
021700                                                                  02170099
021800     COPY DPWS010I.                                               02180099
021900                                                                  02190099
022000 EJECT                                                            02200099
022100*---------------------------------------------------------------* 02210099
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02220099
022300*---------------------------------------------------------------* 02230099
022400                                                                  02240099
022500     COPY DPWS030.                                                02240099
CICS       COPY DPWS930.                                                02250099
022600                                                                  02260099
022700 EJECT                                                            02270099
022800*---------------------------------------------------------------* 02280099
022900*    STANDARD COMMAREA.                                         * 02290099
023000*---------------------------------------------------------------* 02300099
023100                                                                  02310099
023200     COPY DPWS020.                                                02320099
023300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02330099
023400                                                                  02340099
023500*---------------------------------------------------------------* 02350099
023600* INTER-APPLICATION COMMAREA.                                   * 02360099
023700*   TRWS119 - IS THE INPUT LAYOUT WHEN COMING FROM THE IMPORT   * 02370099
023800*             RELEASE INQUIRY SCREEN (POKCS082).                * 02380099
023801*   TRWS102 - IS THE OUTPUT LAYOUT WHEN GOING TO THE PO         *         
023810*             CONTAINER LIST SCREEN (TRKCS162).                 *         
023900*---------------------------------------------------------------* 02390099
024000                                                                  02400099
024100         10  INTER-APPL-COMM-AREA       PIC X(200).               02410099
024200     COPY TRWS119.                                                02420099
024210     COPY TRWS102.                                                02420099
024220     COPY TRWS105.                                                02420099
024300                                                                  02430099
024400*---------------------------------------------------------------* 02440099
024500*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02450099
024600*---------------------------------------------------------------* 02460099
024700         10  ASC-SPECIFIC-COMMAREA.                               02470099
024800             15  ASC-LIST-KEYS.                                   02480099
025002                 20  ASC-KEY-PO-NBR-KEY.                                  
025004                     25  ASC-KEY-PO-NBR             PIC 9(09).            
025010                 20  ASC-KEY-DEPT-NBR               PIC S9(04).   02490099
025020                 20  ASC-KEY-VENDOR-NAME            PIC X(30).    02490099
025021                 20  ASC-KEY-STATUS                 PIC X(20).    02490099
025100             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02510099
025200                 20  ASC-BLOCK-MODIFIED-SW          PIC  X(01).   02520099
025300                     88  ASC-BLOCK-NOT-MODIFIED     VALUE 'N'.    02530099
025400                     88  ASC-BLOCK-MODIFIED         VALUE 'Y'.    02540099
025500                                                                  02550099
025600                 20  ASC-ITEM-ARRAY.                              02560099
025700                     25  ASC-ITEM-ENTRIES OCCURS 11 TIMES.        02570099
025800                         30  ASC-LIST-ITEM-NUMBER                 02580099
025900                                                    PIC S9(09)    02590099
026000                                                    COMP-3.       02600099
026100                         30  ASC-TEMP-SELECTED-SW   PIC  X(01).   02610099
026200                             88  ASC-VALID-SELECT   VALUE ' '     02620099
026300                                                          'S'     02630099
026400                                                          'B'     02640099
026500                                                          'E'.    02650099
026600                             88  ASC-TEMP-NO-SELECT VALUE ' '.    02660099
026700                             88  ASC-TEMP-SELECT    VALUE 'S'.    02670099
026800                             88  ASC-TEMP-BEGIN     VALUE 'B'.    02680099
026900                             88  ASC-TEMP-END       VALUE 'E'.    02690099
027000                         30  ASC-SELECTED-SW        PIC  X(01).   02700099
027100                             88  ASC-NO-SELECT      VALUE ' '.    02710099
027200                             88  ASC-SELECT         VALUE 'S'.    02720099
027300                             88  ASC-BEGIN          VALUE 'B'.    02730099
027400                             88  ASC-END            VALUE 'E'.    02740099
027500                         30  ASC-ACTION             PIC  X(03).   02750099
027610                         30  ASC-CONTNR             PIC  X(12).   02760099
027700                         30  ASC-CART-CNT           PIC S9(04)    02770099
027701                                                         COMP.            
027710                         30  ASC-POE-CDE            PIC  X(02).   02770099
027800                         30  ASC-ETA                PIC  X(05).   02780099
027900                         30  ASC-RELEASE-STATUS     PIC  X(12).   02790099
028001                         30  ASC-DCONSLR-SCAC       PIC  X(04).           
028010                         30  ASC-DCONSLR-RELEASE-DT PIC  X(05).   02790099
028011                         30  ASC-DCONSLR-RELEASE-TM PIC  X(05).   02790099
028020                         30  ASC-PO-CONTNR-TYP      PIC  X(01).   02790099
028900                                                                  02890099
029000             15  ASC-BLK-SUB                         PIC S9(04)   02900099
029100                                                          COMP    02910099
029200                                                          SYNC.   02920099
029300             15  ASC-ITEM-SUB                        PIC S9(04)   02930099
029400                                                          COMP    02940099
029500                                                          SYNC.   02950099
029600             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   02960099
029700                                                          COMP-3. 02970099
029800             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   02980099
029900                                                          COMP-3. 02990099
030000             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03000099
030100                                                          COMP-3. 03010099
030200             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03020099
030300                                                          COMP-3. 03030099
030400             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03040099
030500                                                          COMP-3. 03050099
030600             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03060099
030700                                                          COMP    03070099
030800                                                          SYNC.   03080099
030900             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03090099
031000                                                          COMP-3. 03100099
031100             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03110099
031200                                                          COMP-3. 03120099
031300             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03130099
031400                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03140099
031500                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03150099
031600             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03160099
031700                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03170099
031800                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03180099
031900             15  ASC-LIST-QUEUE-NAME.                             03190099
032000                 20  ASC-LIST-TERM-ID                PIC  X(04).  03200099
032100                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03210099
032200                                                          COMP-3. 03220099
032300                 20  ASC-LIST-SEQ                    PIC  9(01).  03230099
032400             15  ASC-SEL-QUEUE-NAME.                              03240099
032500                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03250099
032600                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03260099
032700                                                          COMP-3. 03270099
032800                 20  ASC-SEL-SEQ                     PIC  9(01).  03280099
032900             15  ASC-START-ITEM-REQUEST.                          03290099
033000                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03300099
033100                                                                  03310099
033200 EJECT                                                            03320099
033300*---------------------------------------------------------------* 03330099
033400*    ABEND PROCESSING COPYBOOK.                                 * 03340099
033500*---------------------------------------------------------------* 03350099
033600                                                                  03360099
033700     COPY DPWS013.                                                03370099
033800                                                                  03380099
033900 EJECT                                                            03390099
034600*---------------------------------------------------------------* 03460099
034700*    DB2 AREA FOR TPLNSHP                                       * 03470099
034800*---------------------------------------------------------------* 03480099
034900     EXEC SQL                                                     03490099
035000          INCLUDE TPLNSHP                                         03500099
035100     END-EXEC.                                                    03510099
035110*---------------------------------------------------------------* 03460099
035120*    DB2 AREA FOR TSHIPMT                                       * 03470099
035130*---------------------------------------------------------------* 03480099
035140     EXEC SQL                                                     03490099
035150          INCLUDE TSHIPMT                                         03500099
035160     END-EXEC.                                                    03510099
035161*---------------------------------------------------------------* 03460099
035162*    DB2 AREA FOR TVHTRIP                                       * 03470099
035163*---------------------------------------------------------------* 03480099
035164     EXEC SQL                                                     03490099
035165          INCLUDE TVHTRIP                                         03500099
035166     END-EXEC.                                                    03510099
035167*---------------------------------------------------------------* 03460099
035168*    DB2 AREA FOR TVEHICL                                       * 03470099
035169*---------------------------------------------------------------* 03480099
035170     EXEC SQL                                                     03490099
035171          INCLUDE TVEHICL                                         03500099
035172     END-EXEC.                                                    03510099
035179*---------------------------------------------------------------* 03460099
035180*    DB2 AREA FOR TSHPTPO                                       * 03470099
035181*---------------------------------------------------------------* 03480099
035182     EXEC SQL                                                     03490099
035183          INCLUDE TSHPTPO                                         03500099
035190     END-EXEC.                                                    03510099
036400*---------------------------------------------------------------* 03640099
036500*    DB2 AREA FOR TIMCNTK                                       * 03650099
036600*---------------------------------------------------------------* 03660099
036700     EXEC SQL                                                     03670099
036800          INCLUDE TIMCNTK                                         03680099
036900     END-EXEC.                                                    03690099
037000*---------------------------------------------------------------* 03700099
037100*    DB2 AREA FOR TIMCNPO                                       * 03710099
037200*---------------------------------------------------------------* 03720099
037300     EXEC SQL                                                     03730099
037400          INCLUDE TIMCNPO                                         03740099
037500     END-EXEC.                                                    03750099
037510*---------------------------------------------------------------* 03700099
037520*    DB2 AREA FOR TIMCNRL                                       * 03710099
037530*---------------------------------------------------------------* 03720099
037540     EXEC SQL                                                     03730099
037550          INCLUDE TIMCNRL                                         03740099
037560     END-EXEC.                                                    03750099
037561*---------------------------------------------------------------* 03700099
037562*    DB2 AREA FOR TAUCNRL                                       * 03710099
037563*---------------------------------------------------------------* 03720099
037564     EXEC SQL                                                     03730099
037565          INCLUDE TAUCNRL                                         03740099
037566     END-EXEC.                                                    03750099
037570*---------------------------------------------------------------* 03700099
037580*    DB2 AREA FOR TIMPORL                                       * 03710099
037590*---------------------------------------------------------------* 03720099
037591     EXEC SQL                                                     03730099
037592          INCLUDE TIMPORL                                         03740099
037593     END-EXEC.                                                    03750099
037594*---------------------------------------------------------------* 03700099
037595*    DB2 AREA FOR TIMPOE                                        * 03710099
037596*---------------------------------------------------------------* 03720099
037597     EXEC SQL                                                     03730099
037598          INCLUDE TIMPOE                                          03740099
037599     END-EXEC.                                                    03750099
037600*---------------------------------------------------------------* 03700099
037700*    DB2 AREA FOR TEXTENT                                       * 03710099
037800*---------------------------------------------------------------* 03720099
037900     EXEC SQL                                                     03730099
038000          INCLUDE TEXTENT                                         03740099
038100     END-EXEC.                                                    03750099
038200*---------------------------------------------------------------* 03820099
038300*    DB2 AREA FOR COMMUNICATIONS                                * 03830099
038400*---------------------------------------------------------------* 03840099
038500     EXEC SQL                                                     03850099
038600          INCLUDE SQLCA                                           03860099
038700     END-EXEC.                                                    03870099
038800*---------------------------------------------------------------* 03880099
038900*    CURSOR FOR CONTAINER PO RELEASE LIST.                      * 03890099
039000*---------------------------------------------------------------* 03900099
039100                                                                  03910099
039101     EXEC SQL                                                     03920099
039102       DECLARE CONTNR-CSR CURSOR                                          
039103         FOR SELECT DISTINCT                                              
039120               A.CONTNR_ID                                                
039121             , A.CONTNR_SEQ_NBR AS CONTNR_SEQ                             
039130             , A.PO_NBR                                                   
039140             , A.DCONSLR_RLSE_CDE                                         
039141             , (CASE A.DCONSLR_RLSE_CDE                                   
039142                    WHEN 'D'                                              
039143                     THEN '4'                                             
039144                    WHEN 'N'                                              
039145                     THEN '5'                                             
039146                    WHEN 'R'                                              
039147                     THEN '2'                                             
039148                    WHEN 'S'                                              
039149                     THEN '3'                                             
039150                    WHEN 'Y'                                              
039151                     THEN '1'                                             
039152                       END) AS DCONSLR_RLSE_NUM                           
039154             , A.DCONSLR_ACTL_DTE AS RELEASE_DTE                          
039160             , A.DCONSLR_ACTL_TM  AS RELEASE_TM                           
039161             , A.DCONSLR_ENT_ID   AS DCONSLR_ENTID                        
039162             , A.LAST_UPD_TMST                                            
039163             , A.LAST_UPD_BY_UID                                          
039170             , B.MOM_DEST_POE_CDE                                         
039180             , B.MOM_POE_DELY_TMST                                        
039191             , B.MOM_FOB_CDE                                              
039192             , C.PO_CART_CNT                                              
039193             , 'C' AS CMN_CON_TYP                                         
039216                FROM TIMCNRL A                                            
039217                   , TIMCNTK B                                            
039218                   , TIMCNPO C                                            
039220                WHERE A.PO_NBR    = :DK-PO-NBR                            
039221                  AND A.PO_NBR    = C.PO_NBR                              
039222                  AND A.CONTNR_ID = C.CONTNR_ID                           
039223                  AND B.CONTNR_ID = C.CONTNR_ID                           
039224                  AND A.CONTNR_SEQ_NBR = B.CONTNR_SEQ_NBR                 
039225                  AND B.CONTNR_SEQ_NBR = C.CONTNR_SEQ_NBR                 
039226                  AND A.DCONSLR_RLSE_CDE IN ('Y','R','S','D','N')         
039227                                                                          
039228                                                                          
039239          UNION ALL                                                       
039240                                                                          
039241           SELECT DISTINCT                                                
039242               A.CONTNR_ID                                                
039243             , A.CONTNR_SEQ_NBR AS CONTNR_SEQ                             
039244             , A.PO_NBR                                                   
039245             , A.DCONSLR_RLSE_CDE                                         
039246             , (CASE A.DCONSLR_RLSE_CDE                                   
039247                    WHEN 'D'                                              
039248                     THEN '4'                                             
039249                    WHEN 'N'                                              
039250                     THEN '5'                                             
039251                    WHEN 'R'                                              
039252                     THEN '2'                                             
039253                    WHEN 'S'                                              
039254                     THEN '3'                                             
039255                    WHEN 'Y'                                              
039256                     THEN '1'                                             
039257                       END) AS DCONSLR_RLSE_NUM                           
039259             , A.DCONSLR_ACTL_DTE AS RELEASE_DTE                          
039260             , A.DCONSLR_ACTL_TM  AS RELEASE_TM                           
039261             , A.DCONSLR_ENT_ID   AS DCONSLR_ENTID                        
039262             , A.LAST_UPD_TMST                                            
039263             , A.LAST_UPD_BY_UID                                          
039264             , B.MOM_DEST_POE_CDE                                         
039265             , B.MOM_POE_DELY_TMST                                        
039266             , B.MOM_FOB_CDE                                              
039267             , C.PO_CART_CNT                                              
039268             , 'C' AS CMN_CON_TYP                                         
039269                FROM TAUCNRL A                                            
039270                   , TIMCNTK B                                            
039271                   , TIMCNPO C                                            
039272                WHERE A.PO_NBR    = :DK-PO-NBR                            
039273                  AND A.PO_NBR    = C.PO_NBR                              
039274                  AND A.CONTNR_ID = C.CONTNR_ID                           
039275                  AND B.CONTNR_ID = C.CONTNR_ID                           
039276                  AND A.CONTNR_SEQ_NBR = B.CONTNR_SEQ_NBR                 
039277                  AND B.CONTNR_SEQ_NBR = C.CONTNR_SEQ_NBR                 
039278                  AND A.DCONSLR_RLSE_CDE IN ('Y','R','S','D','N')         
039279                                                                          
039287                                                                          
039288          UNION ALL                                                       
039289                                                                          
039290           SELECT DISTINCT                                                
039291               B.PRO_NBR AS CONTNR_ID                                     
039292             , 0 AS CONTNR_SEQ                                            
039293             , A.PO_NBR                                                   
039294             , A.DCONSLR_RLSE_CDE                                         
039295             , (CASE A.DCONSLR_RLSE_CDE                                   
039296                    WHEN 'D'                                              
039297                     THEN '4'                                             
039298                    WHEN 'N'                                              
039299                     THEN '5'                                             
039300                    WHEN 'R'                                              
039301                     THEN '2'                                             
039302                    WHEN 'S'                                              
039303                     THEN '3'                                             
039304                    WHEN 'Y'                                              
039305                     THEN '1'                                             
039306                       END) AS DCONSLR_RLSE_NUM                           
039308             , A.DCONSLR_ACTL_DTE AS RELEASE_DTE                          
039309             , A.DCONSLR_ACTL_TM AS RELEASE_TM                            
039310             , A.DCONSLR_ENT_ID  AS DCONSLR_ENTID                         
039311             , A.LAST_UPD_TMST                                            
039312             , A.LAST_UPD_BY_UID                                          
039313             , C.POE_CDE                                                  
039314             , D.EST_AR_TMST                                              
039315             , C.FOB_CDE                                                  
039316             , E.EXPTED_CART_CNT                                          
039317             , 'P' AS CMN_CON_TYP                                         
039318                FROM TIMPORL A                                            
039319                   , TSHIPMT B                                            
039320                   , TPLNSHP C                                            
039321                   , TVHTRIP D                                            
039322                   , TSHPTPO E                                            
039323                   , TVEHICL F                                            
039324                WHERE E.PO_NBR    = C.PO_NBR                              
039325                  AND E.PO_NBR    = A.PO_NBR                              
039326                  AND E.PO_NBR    = :DK-PO-NBR                            
039327                  AND E.SHIPT_ID  = B.SHIPT_ID                            
039328                  AND B.TRIP_ID   = D.TRIP_ID                             
039329                  AND B.TRIP_ID   = F.CURR_TRIP_ID                        
039330                  AND C.VER_STATUS_CDE = 'A'                              
039331                  AND A.DCONSLR_RLSE_CDE IN ('Y','R','S','D','N')         
039332                  AND F.VEH_TYP_CDE IN ('AV', 'VS')                       
039333                                                                          
039334                                                                          
039343        ORDER BY   CONTNR_ID                                              
039345                 , CONTNR_SEQ                                             
039346                 , DCONSLR_RLSE_NUM                                       
039347                 , LAST_UPD_TMST                                          
039350                 , RELEASE_DTE                                            
039400                 , RELEASE_TM                                             
040900     END-EXEC.                                                    04090099
041000                                                                  04100099
041100 EJECT                                                            04110099
041200*---------------------------------------------------------------*         
041300*    CURSOR DECLARATION FOR SELECTING POE CODE                  *         
041400*---------------------------------------------------------------*         
041500                                                                          
041600     EXEC SQL                                                             
041700          DECLARE  POE-CSR CURSOR                                         
041800              FOR  SELECT DISTINCT                                        
041900                   A.POE_CDE                                              
042000             FROM  TIMPOE  A                                              
042100            WHERE  A.POE_STD_EDI_CDE  = :PV-POE-CDE                       
042200              AND  A.STAT_CDE         = 'A'                               
042300         ORDER BY  POE_CDE                                                
042400     END-EXEC.                                                            
042500                                                                          
042600 EJECT                                                                    
043000*----------------------------------------------------------------*04300099
043100 LINKAGE SECTION.                                                 04310099
043200                                                                  04320099
043300 01  DFHCOMMAREA.                                                 04330099
043400     05  FILLER                         OCCURS  1 TO 4072 TIMES   04340099
043500                                        DEPENDING ON EIBCALEN.    04350099
043600         10  FILLER                     PIC X.                    04360099
043700                                                                  04370099
043800 EJECT                                                            04380099
043900*----------------------------------------------------------------*04390099
044000 PROCEDURE DIVISION.                                              04400099
044100*----------------------------------------------------------------*04410099
044200*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.  *04420099
044300*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM   *04430099
044400*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.  *04440099
044500*----------------------------------------------------------------*04450099
044600 0000-MAIN-MODULE.                                                04460099
044700                                                                  04470099
044800     INITIALIZE DP030-CICS-API-FIELDS.                            04480099
044900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04490099
045000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04500099
045100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04510099
045200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04520099
045300     MOVE LENGTH OF TR193AI        TO DP030-MAP-LENGTH (1).       04530099
045400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04540099
045500     PERFORM 0001-CALL-CICS-ARCH-API.                             04550099
045600*                                                                 04560099
045700     PERFORM 1000-CONTROL-PROCESSING                              04570099
045800*                                                                 04580099
045900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04590099
046000     PERFORM 0001-CALL-CICS-ARCH-API.                             04600099
046100                                                                  04610099
046200*----------------------------------------------------------------*04620099
046300*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *04630099
046400*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *04640099
046500*----------------------------------------------------------------*04650099
046600 0001-CALL-CICS-ARCH-API.                                         04660099
046700                                                                  04670099
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04680099
046900                                    DFHCOMMAREA                           
047000                                    DP030-CICS-API-FIELDS                 
047100                                    DP020-STANDARD-COMMAREA               
047200                                    TR193AI.                              
047300*                                                                 04730099
047400     IF  DP030-RC-CALL-SUCCESSFUL                                 04740099
047500         CONTINUE                                                 04750099
047600     ELSE                                                         04760099
047700         SET DP013-NO-ROLLBACK                                    04770099
047800             DP013-XCTL-DISPLAY-RESTART                           04780099
047900             DP013-CICS-ABEND      TO TRUE                        04790099
048000         MOVE '0001-CALL-CICS-ARCH-API'                           04800099
048100                                   TO DP013-PARAGRAPH             04810099
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04820099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04830099
048400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04840099
048500         PERFORM DP013-0000-PROCESS-ABEND                         04850099
048600     END-IF.                                                      04860099
048700                                                                  04870099
048800 EJECT                                                            04880099
048900*----------------------------------------------------------------*04890099
049000* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04900099
049100* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04910099
049200*                                                                *04920099
049300* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04930099
049400*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04940099
049500*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04950099
049600*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04960099
049700*----------------------------------------------------------------*04970099
049800 1000-CONTROL-PROCESSING.                                         04980099
049900                                                                  04990099
050000     EVALUATE TRUE                                                05000099
050100         WHEN DP020-NEXT-ACT-INITIAL                              05010099
050200             INITIALIZE ASC-SPECIFIC-COMMAREA                     05020099
050300             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05030099
050400                                      ASC-SEL-TERM-ID             05040099
050500             MOVE DP020-SRC-TASK-NUMBER                           05050099
050600                                   TO ASC-LIST-TASK-NUMBER        05060099
050700                                      ASC-SEL-TASK-NUMBER         05070099
050800             MOVE PC-LIST-QUEUE-SEQ                               05080099
050900                                   TO ASC-LIST-SEQ                05090099
051000             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05100099
051100             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05110099
051200*-------$TEMPLATE NOTE$------------------------------------------*05120099
051300* IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,* 05130099
051400* SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO *  05140099
051500* TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.* 05150099
051600*----------------------------------------------------------------*05160099
051700             IF  PS-COMMAREA-NOT-VALID                            05170099
051800                 SET DP020-NEXT-ACT-APPL-ERROR                    05180099
051900                                   TO TRUE                        05190099
052000             ELSE                                                 05200099
052100                 PERFORM 4000-BUILD-INITIAL-PANEL                 05210099
052200             END-IF                                               05220099
052300                                                                  05230099
052400         WHEN DP020-NEXT-ACT-READ-MAP                             05240099
052500             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05250099
052600                                   TO PV-TOP-ITEM                 05260099
052700             PERFORM 2000-PROCESS-PANEL                           05270099
052800                                                                  05280099
052900         WHEN DP020-NEXT-ACT-RETURN                               05290099
053000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05300099
053100                                   TO PV-TOP-ITEM                 05310099
053200             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05320099
053210             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                         
053300             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   05330099
053400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05340099
053500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05350099
053600                                                                  05360099
053700         WHEN OTHER                                               05370099
053800             SET DP013-LOGIC-ABEND TO TRUE                        05380099
053900             SET DP013-NO-ROLLBACK TO TRUE                        05390099
054000             MOVE '1000-CONTROL-PROCESSING'                       05400099
054100                                   TO DP013-PARAGRAPH             05410099
054200             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05420099
054300                                   TO DP013-MESSAGE-TEXT(1)       05430099
054400             PERFORM DP013-0000-PROCESS-ABEND                     05440099
054500     END-EVALUATE.                                                05450099
054600                                                                  05460099
054700 EJECT                                                            05470099
054800*----------------------------------------------------------------*05480099
054900* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05490099
055000* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05500099
055100*----------------------------------------------------------------*05510099
055200 1100-PROCESS-INTER-APPL-COMM.                                    05520099
055300                                                                  05530099
055400     SET PS-COMMAREA-VALID         TO TRUE.                       05540099
055500     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05550099
055600                                                                  05560099
055700     IF  DP020-NAV-KEY-DATA > SPACE                               05570099
055800         MOVE DP020-NAV-KEY-DATA   TO ASC-KEY-PO-NBR-KEY          05580099
055900         MOVE ASC-KEY-PO-NBR       TO DK-PO-NBR                   05590099
056000     ELSE                                                         05600099
056100         MOVE TR119-PO-NBR         TO ASC-KEY-PO-NBR              05610099
056200                                      DK-PO-NBR                   05620099
056210         MOVE TR119-VENDOR-NAME    TO ASC-KEY-VENDOR-NAME                 
056220         MOVE TR119-DEPT-NBR       TO PV-DEPT-NBR-N                       
056221         MOVE PV-DEPT-NBR-N        TO ASC-KEY-DEPT-NBR                    
056230         MOVE TR119-STATUS         TO ASC-KEY-STATUS                      
056300     END-IF.                                                      05630099
056400                                                                  05640099
056500 EJECT                                                            05650099
056600*----------------------------------------------------------------*05660099
056700* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05670099
056800* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05680099
056900* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05690099
057000* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05700099
057100* FUNCTION KEYS CAN GET THIS FAR.                                *05710099
057200*----------------------------------------------------------------*05720099
057300 2000-PROCESS-PANEL.                                              05730099
057400                                                                  05740099
057500     EVALUATE TRUE                                                05750099
057600         WHEN DP020-SRC-AID = DP016-CLEAR                         05760099
057700             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05770099
057800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05780099
057900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05790099
058000                                                                  05800099
058100         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05810099
058200             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   05820099
058300             PERFORM 2050-DELETE-LIST-QUEUE                       05830099
058400             PERFORM 4000-BUILD-INITIAL-PANEL                     05840099
058500                                                                  05850099
058600         WHEN OTHER                                               05860099
058700             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05870099
058800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05880099
058900             IF  PS-NO-ERROR                                      05890099
059000                 SET DP030-CONTINUE-GO                            05900099
059100                                 TO TRUE                          05910099
059200                 PERFORM 2100-CHECK-FUNCTION-KEY                  05920099
059300             ELSE                                                 05930099
059400                 SET DP030-OVERRIDE-GO                            05940099
059500                                 TO TRUE                          05950099
059600             END-IF                                               05960099
059700     END-EVALUATE.                                                05970099
059800                                                                  05980099
059900 EJECT                                                            05990099
060000*----------------------------------------------------------------*06000099
060100*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06010099
060200*----------------------------------------------------------------*06020099
060300 2050-DELETE-LIST-QUEUE.                                          06030099
060400                                                                  06040099
060500     EXEC CICS                                                    06050099
060600         DELETEQ TS                                               06060099
060700             QUEUE (ASC-LIST-QUEUE-NAME)                          06070099
060800             RESP  (PV-CICS-RESP)                                 06080099
060900     END-EXEC.                                                    06090099
061000                                                                  06100099
061100     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06110099
061200        (PV-CICS-RESP = DFHRESP(QIDERR))                          06120099
061300         CONTINUE                                                 06130099
061400     ELSE                                                         06140099
061500         SET DP013-CICS-ABEND      TO TRUE                        06150099
061600         SET DP013-NO-ROLLBACK     TO TRUE                        06160099
061700                                                                  06170099
061800         MOVE '2050-DELETE-LIST-QUEUE'                            06180099
061900                                   TO DP013-PARAGRAPH             06190099
062000         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06200099
062100                                   TO DP013-MESSAGE-TEXT (1)      06210099
062200         PERFORM DP013-0000-PROCESS-ABEND                         06220099
062300     END-IF.                                                      06230099
062400                                                                  06240099
062500     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  06250099
062600                                                                  06260099
062700 EJECT                                                            06270099
062800*----------------------------------------------------------------*06280099
062900* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06290099
063000* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06300099
063100* CICS ARCHITECTURE API.                                         *06310099
063200*----------------------------------------------------------------*06320099
063300 2100-CHECK-FUNCTION-KEY.                                         06330099
063400                                                                  06340099
063500     EVALUATE TRUE                                                06350099
063600                                                                  06360099
063603         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                      
063604**           INITIALIZE TR105-INTER-APPL-COMMAREA                         
063605             MOVE LOW-VALUES TO TR105-INTER-APPL-COMMAREA                 
063606             MOVE ASC-KEY-PO-NBR      TO TR105-PO-NBR                     
063650                                                                          
063700         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  06370099
063800             MOVE +1               TO PV-TOP-ITEM                 06380099
063900             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   06390099
064000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06400099
064100             PERFORM 3200-RESET-ATTRIBUTES                        06410099
064200                                                                  06420099
064300         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   06430099
064400             PERFORM 2110-BROWSE-BACKWARD                         06440099
064500             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   06450099
064600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06460099
064700             PERFORM 3200-RESET-ATTRIBUTES                        06470099
064800                                                                  06480099
064900         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   06490099
065000             PERFORM 2120-BROWSE-FORWARD                          06500099
065100             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   06510099
065200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06520099
065300                                                                  06530099
065400         WHEN DP020-SRC-AID = DP016-ENTER                         06540099
065500             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   06550099
065600             IF  PS-ERROR                                         06560099
065700                 CONTINUE                                         06570099
065800             ELSE                                                 06580099
065900                 MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR               06590099
066000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06600099
066100                 PERFORM 3200-RESET-ATTRIBUTES                    06610099
066200             END-IF                                               06620099
066300                                                                  06630099
066400         WHEN OTHER                                               06640099
066500             SET DP013-NO-ROLLBACK                                06650099
066600                 DP013-XCTL-DISPLAY-RESTART                       06660099
066700                 DP013-CICS-ABEND  TO TRUE                        06670099
066800             MOVE '2100-CHECK-FUNCTION-KEY'                       06680099
066900                                   TO DP013-PARAGRAPH             06690099
067000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06700099
067100                                   TO DP013-MESSAGE-TEXT (1)      06710099
067200             PERFORM DP013-0000-PROCESS-ABEND                     06720099
067300     END-EVALUATE.                                                06730099
067400                                                                  06740099
067500 EJECT                                                            06750099
067600*----------------------------------------------------------------*06760099
067700*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *06770099
067800*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *06780099
067900*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *06790099
068000*    MESSAGE.                                                    *06800099
068100*----------------------------------------------------------------*06810099
068200 2110-BROWSE-BACKWARD.                                            06820099
068300                                                                  06830099
068400     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    06840099
068500         GIVING PV-TOP-ITEM.                                      06850099
068600*                                                                 06860099
068700     IF  ((PV-TOP-ITEM < +1)                                      06870099
068800       OR (PV-TOP-ITEM = +1))                                     06880099
068900         MOVE +1                   TO PV-TOP-ITEM                 06890099
069000*------- TOP OF LIST --------                                     06900099
069100         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06910099
069200         SET DP020-MSG-INFORMATIONAL TO TRUE                      06920099
069300     END-IF.                                                      06930099
069400                                                                  06940099
069500 EJECT                                                            06950099
069600*----------------------------------------------------------------*06960099
069700*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *06970099
069800*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *06980099
069900*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *06990099
070000*----------------------------------------------------------------*07000099
070100 2120-BROWSE-FORWARD.                                             07010099
070200                                                                  07020099
070300     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07030099
070400         GIVING PV-TOP-ITEM.                                      07040099
070500     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07050099
070600         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07060099
070700                                   TO PV-TOP-ITEM                 07070099
070800*------- BOTTOM OF LIST -----------                               07080099
070900         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07090099
071000         SET DP020-MSG-INFORMATIONAL                              07100099
071100                                   TO TRUE                        07110099
071200     ELSE                                                         07120099
071300         COMPUTE PV-BOTTOM-ITEM =                                 07130099
071400             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07140099
071500         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07150099
071600*------------BOTTOM OF LIST ---------                             07160099
071700             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07170099
071800             SET DP020-MSG-INFORMATIONAL                          07180099
071900                                   TO TRUE                        07190099
072000         END-IF                                                   07200099
072100     END-IF.                                                      07210099
072200                                                                  07220099
072300 EJECT                                                            07230099
072400*----------------------------------------------------------------*07240099
072500*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07250099
072600*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07260099
072700*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *07270099
072800*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *07280099
072900*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *07290099
073000*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *07300099
073100*----------------------------------------------------------------*07310099
073200 2130-CHECK-FOR-JUMP-BROWSE.                                      07320099
073300                                                                  07330099
073400     SET PS-NO-ERROR               TO TRUE.                       07340099
073500     IF (ASC-START-ITEM-REQUEST = SPACE)                          07350099
073600         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07360099
073700                                   TO PV-TOP-ITEM                 07370099
073800     ELSE                                                         07380099
073900         MOVE ASC-START-ITEM-REQUEST                              07390099
074000                                   TO DP010I-UNEDITED-FIELD       07400099
074100         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       07410099
074200         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     07420099
074300         SET DP010I-NEGATIVE-NOT-ALLOWED                          07430099
074400                                   TO TRUE                        07440099
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263697              USING DP010I-NUMERIC-EDIT-AREA                              
074600                                                                  07460099
074700         IF  NOT DP010I-ERROR-DETECTED                            07470099
074800             MOVE DP010I-NUMERIC-FIELD                            07480099
074900                                   TO  ASC-START-ITEM-REQUEST-N   07490099
075000             IF  ASC-START-ITEM-REQUEST-N > ZERO                  07500099
075100                 IF  ASC-START-ITEM-REQUEST-N >                   07510099
075200                                          ASC-NUMBER-OF-ITEMS-READ07520099
075300                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07530099
075400                     COMPUTE PV-TOP-ITEM =                        07540099
075500                             ASC-NUMBER-OF-ITEMS-READ             07550099
075600                             - PC-ITEMS-PER-PANEL + 1             07560099
075700                     IF  PV-TOP-ITEM < +1                         07570099
075800                         MOVE +1   TO PV-TOP-ITEM                 07580099
075900                         MOVE PC-TSYMSG-00070                     07590099
076000                                   TO DP020-MSG-NUMBER            07600099
076100                         SET DP020-MSG-INFORMATIONAL              07610099
076200                                   TO TRUE                        07620099
076300                     END-IF                                       07630099
076400                 ELSE                                             07640099
076500                     MOVE ASC-START-ITEM-REQUEST-N                07650099
076600                                   TO PV-TOP-ITEM                 07660099
076700                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      07670099
076800                     COMPUTE PV-BOTTOM-ITEM =                     07680099
076900                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     07690099
077000                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ07700099
077100*----------------------- BOTTOM OF LIST --------------            07710099
077200                         MOVE PC-TSYMSG-00070                     07720099
077300                                   TO DP020-MSG-NUMBER            07730099
077400                         SET DP020-MSG-INFORMATIONAL              07740099
077500                                   TO TRUE                        07750099
077600                     END-IF                                       07760099
077700                 END-IF                                           07770099
077800             ELSE                                                 07780099
077900*--------------- VALUE OUT OF RANGE ------------------            07790099
078000                 MOVE PC-TSYMSG-00101                             07800099
078100                                   TO DP020-MSG-NUMBER            07810099
078200                 MOVE -1           TO ASTRTITL                    07820099
078300                 SET DP030-SET-CURSOR-APPL-1                      07830099
078400                                   TO TRUE                        07840099
078500                 MOVE DP015-REVERSE                               07850099
078600                                   TO ASTRTITH                    07860099
078700                 MOVE DP015-RED    TO ASTRTITC                    07870099
078800                 MOVE DP015-UNP-NUM-BRT-MDT                       07880099
078900                                   TO ASTRTITA                    07890099
079000                 SET DP020-MSG-FATAL                              07900099
079100                                   TO TRUE                        07910099
079200                 SET PS-ERROR      TO TRUE                        07920099
079300             END-IF                                               07930099
079400                                                                  07940099
079500         ELSE                                                     07950099
079600             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07960099
079700             MOVE -1               TO ASTRTITL                    07970099
079800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07980099
079900             MOVE DP015-REVERSE    TO ASTRTITH                    07990099
080000             MOVE DP015-RED        TO ASTRTITC                    08000099
080100             MOVE DP015-UNP-NUM-BRT-MDT                           08010099
080200                                   TO ASTRTITA                    08020099
080300             SET DP020-MSG-FATAL   TO TRUE                        08030099
080400             SET PS-ERROR          TO TRUE                        08040099
080500         END-IF                                                   08050099
080600     END-IF.                                                      08060099
080700                                                                  08070099
080800 EJECT                                                            08080099
080801*----------------------------------------------------------------*        
080802*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *        
080803*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *        
080804*----------------------------------------------------------------*        
080805 2140-DESELECT-ALL-ITEMS.                                                 
080806                                                                          
080807     MOVE +1                       TO ASC-BLK-SUB.                        
080808                                                                          
080809     PERFORM 2141-CLEAR-SELECTED-INDS                                     
080810         VARYING ASC-ITEM-SUB                                             
080811         FROM 1 BY 1                                                      
080812         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                         
080813                                                                          
080814     ADD +1                        TO ASC-BLK-SUB.                        
080815                                                                          
080816     PERFORM 2141-CLEAR-SELECTED-INDS                                     
080817         VARYING ASC-ITEM-SUB                                             
080818         FROM 1 BY 1                                                      
080819         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                         
080820                                                                          
080821     MOVE ASC-LIST-ITEM-NUMBER(1 1)                                       
080822                                   TO PV-LIST-ITEM-NUMBER.                
080823                                                                          
080824     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                                    
080825         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).            
080826                                                                          
080827     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                             
080828        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)              
080829         MOVE +1                   TO ASC-BLK-SUB                         
080830                                                                          
080831         PERFORM 5100-WRITE-TEMP-STORAGE                                  
080832                                                                          
080833         MOVE +1                   TO PV-BLOCK-NUMBER                     
080834                                                                          
080835         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                                 
080836             PV-FIRST-BLOCK-IN-ARRAY - 1                                  
080837                                                                          
080838         PERFORM                                                          
080839             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY               
080840                                                                          
080841             PERFORM 4410-READ-TEMP-STORAGE                               
080842                                                                          
080843             PERFORM 2141-CLEAR-SELECTED-INDS                             
080844                 VARYING ASC-ITEM-SUB FROM 1 BY 1                         
080845                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  
080846                                                                          
080847             PERFORM 5100-WRITE-TEMP-STORAGE                              
080848                                                                          
080849             ADD +1                TO PV-BLOCK-NUMBER                     
080850                                                                          
080851         END-PERFORM                                                      
080852                                                                          
080853         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                                 
080854             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY             
080855                                                                          
080856         PERFORM                                                          
080857             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                               
080858                   ASC-HIGHEST-BLOCK-WRITTEN                              
080859                                                                          
080860             MOVE PV-NEXT-BLOCK-IN-ARRAY                                  
080861                                   TO PV-BLOCK-NUMBER                     
080862                                                                          
080863             PERFORM 4410-READ-TEMP-STORAGE                               
080864                                                                          
080865             PERFORM 2141-CLEAR-SELECTED-INDS                             
080866                 VARYING ASC-ITEM-SUB                                     
080867                 FROM 1 BY 1                                              
080868                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  
080869                                                                          
080870             PERFORM 5100-WRITE-TEMP-STORAGE                              
080871                                                                          
080872             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY              
080873                                                                          
080874         END-PERFORM                                                      
080875                                                                          
080876         MOVE PV-FIRST-BLOCK-IN-ARRAY                                     
080877                                   TO PV-BLOCK-NUMBER                     
080878                                                                          
080879         PERFORM 4410-READ-TEMP-STORAGE                                   
080880     END-IF.                                                              
080881                                                                          
080882     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS        
080883                                      ASC-START-OF-SELECTED-RANGE         
080884                                      ASC-END-OF-SELECTED-RANGE.          
080885                                                                          
080886     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                                
080887                                                                          
080888 EJECT                                                                    
080889*----------------------------------------------------------------*        
080890*    MARK EACH ITEM AS BEING NOT SELECTED.                       *        
080891*----------------------------------------------------------------*        
080892 2141-CLEAR-SELECTED-INDS.                                                
080893                                                                          
080894     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)                   
080895             NOT EQUAL ZERO                                               
080896         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                  
080897             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                  
080898                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            
080899                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                          
080900                                   TO TRUE                                
080901         END-IF                                                           
080902     END-IF.                                                              
080903                                                                          
080904 EJECT                                                                    
080905*----------------------------------------------------------------*        
080906*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *        
080907*  FOR ALL ITEMS.                                                *        
080908*----------------------------------------------------------------*        
080909 2150-SELECT-ALL-ITEMS.                                                   
080910                                                                          
080911     MOVE +1                       TO ASC-BLK-SUB.                        
080912                                                                          
080913     PERFORM 2151-SET-SELECTED-INDS                                       
080914         VARYING ASC-ITEM-SUB                                             
080915         FROM 1 BY 1                                                      
080916         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                         
080917                                                                          
080918     ADD +1                        TO ASC-BLK-SUB.                        
080919                                                                          
080920     PERFORM 2151-SET-SELECTED-INDS                                       
080921         VARYING ASC-ITEM-SUB                                             
080922         FROM 1 BY 1                                                      
080923         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                         
080924                                                                          
080925     MOVE ASC-LIST-ITEM-NUMBER(1 1)                                       
080926                                   TO PV-LIST-ITEM-NUMBER.                
080927                                                                          
080928     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                                    
080929         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).            
080930                                                                          
080931     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                             
080932        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)            
080933         MOVE +1                   TO ASC-BLK-SUB                         
080934                                                                          
080935         PERFORM 5100-WRITE-TEMP-STORAGE                                  
080936                                                                          
080937         MOVE +1                   TO PV-BLOCK-NUMBER                     
080938                                                                          
080939         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                                 
080940             PV-FIRST-BLOCK-IN-ARRAY - 1                                  
080941                                                                          
080942         PERFORM                                                          
080943             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY               
080944                                                                          
080945             PERFORM 4410-READ-TEMP-STORAGE                               
080946                                                                          
080947             PERFORM 2151-SET-SELECTED-INDS                               
080948                 VARYING ASC-ITEM-SUB                                     
080949                 FROM 1 BY 1                                              
080950                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  
080951                                                                          
080952             PERFORM 5100-WRITE-TEMP-STORAGE                              
080953                                                                          
080954             ADD +1                TO PV-BLOCK-NUMBER                     
080955                                                                          
080956         END-PERFORM                                                      
080957                                                                          
080958         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                                 
080959             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY             
080960                                                                          
080961         PERFORM                                                          
080962             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                               
080963                   ASC-HIGHEST-BLOCK-WRITTEN                              
080964                                                                          
080965             MOVE PV-NEXT-BLOCK-IN-ARRAY                                  
080966                                   TO PV-BLOCK-NUMBER                     
080967                                                                          
080968             PERFORM 4410-READ-TEMP-STORAGE                               
080969                                                                          
080970             PERFORM 2151-SET-SELECTED-INDS                               
080971                 VARYING ASC-ITEM-SUB                                     
080972                 FROM 1 BY 1                                              
080973                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  
080974                                                                          
080975             PERFORM 5100-WRITE-TEMP-STORAGE                              
080976                                                                          
080977             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY              
080978                                                                          
080979         END-PERFORM                                                      
080980                                                                          
080981         MOVE PV-FIRST-BLOCK-IN-ARRAY                                     
080982                                   TO PV-BLOCK-NUMBER                     
080983                                                                          
080984         PERFORM 4410-READ-TEMP-STORAGE                                   
080985     END-IF.                                                              
080986                                                                          
080987     MOVE ASC-NUMBER-OF-ITEMS-READ TO                                     
080988                       ASC-NUMBER-OF-SELECTED-ITEMS.                      
080989                                                                          
080990     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                                
080991                                                                          
080992 EJECT                                                                    
080993*----------------------------------------------------------------*        
080994*    MARK EACH ITEM AS BEING SELECTED.                           *        
080995*----------------------------------------------------------------*        
080996 2151-SET-SELECTED-INDS.                                                  
080997                                                                          
080998     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)                   
080999             NOT EQUAL ZERO                                               
081000         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                     
081001             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                     
081002                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                
081003                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                          
081004                               TO  TRUE                                   
081005         END-IF                                                           
081006     END-IF.                                                              
081007                                                                          
081008 EJECT                                                                    
081043                                                                          
081044*----------------------------------------------------------------*08090099
081050*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *08100099
081100*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *08110099
081200*----------------------------------------------------------------*08120099
081300 2200-MOVE-SCREEN-TO-COMMAREA.                                    08130099
081400                                                                  08140099
081500     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             08150099
081600     MOVE +1                       TO PV-SUB.                     08160099
081700*                                                                 08170099
081800     PERFORM 3100-SET-SUBSCRIPTS.                                 08180099
081900     IF  ASTRTITL > ZERO                                          08190099
082000         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          08200099
082100     ELSE                                                         08210099
082200         IF  ASTRTITF = DP015-ERASE-EOF                           08220099
082300             INITIALIZE ASC-START-ITEM-REQUEST                    08230099
082400         END-IF                                                   08240099
082500     END-IF.                                                      08250099
082600                                                                  08260099
082601     PERFORM 2210-MOVE-LINES-TO-COMMAREA                                  
082602         VARYING PV-SUB                                                   
082603         FROM 1 BY 1                                                      
082604         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                              
082610                                                                          
082700 EJECT                                                            08270099
082701*----------------------------------------------------------------*        
082702*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *        
082703*----------------------------------------------------------------*        
082704 2210-MOVE-LINES-TO-COMMAREA.                                             
082705                                                                          
082706     IF  MR-SELECTL (PV-SUB) > ZERO                                       
082707         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE                     
082708         MOVE MR-SELECTI (PV-SUB)                                         
082709                                   TO ASC-TEMP-SELECTED-SW                
082710                                 (ASC-BLK-SUB, ASC-ITEM-SUB)              
082711     ELSE                                                                 
082712         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                        
082713                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             
082714                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW                
082715                                 (ASC-BLK-SUB, ASC-ITEM-SUB)              
082716         END-IF                                                           
082717     END-IF.                                                              
082718     ADD +1                        TO ASC-ITEM-SUB.                       
082719     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                                
082720         ADD  +1                   TO ASC-BLK-SUB                         
082721         MOVE +1                   TO ASC-ITEM-SUB                        
082722     END-IF.                                                              
082723                                                                          
082730 EJECT                                                                    
082800*----------------------------------------------------------------*08280099
082900*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *08290099
083000*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *08300099
083100*----------------------------------------------------------------*08310099
083200 3000-EDIT-DATA-IN-COMMAREA.                                      08320099
083300                                                                  08330099
083400     SET PS-NO-ERROR               TO TRUE.                       08340099
083500     PERFORM 3200-RESET-ATTRIBUTES.                               08350099
083600     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     08360099
083700*----------------------------------------------------------------*08370099
083800* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED. *            08380099
083900* EDITTING IS DONE FROM THE BOTTOM UP. *                          08390099
084000*----------------------------------------------------------------*08400099
084100     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       08410099
084200         ASC-ITEMS-DISPLAYED - 1.                                 08420099
084300     PERFORM 3100-SET-SUBSCRIPTS.                                 08430099
084301     PERFORM 3300-EDIT-SELECTIONS                                         
084302         VARYING PV-SUB                                                   
084303         FROM PV-SUB BY -1                                                
084304         UNTIL PV-SUB < +1.                                               
084310*                                                                         
084312     IF  PS-NO-ERROR                                                      
084313         PERFORM 3400-CHECK-RANGE-SEQUENCE                                
084314     END-IF.                                                              
084315*                                                                         
084316     IF  ((PS-NO-ERROR)                                                   
084317       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                           
084318       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                            
084319             PERFORM 3500-MARK-RANGE-AS-SELECTED                          
084320     END-IF.                                                              
084321                                                                          
084500 EJECT                                                            08450099
084600*----------------------------------------------------------------*08460099
084700*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *08470099
084800*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*08480099
084900*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *08490099
085000*                                                                *08500099
085100*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *08510099
085200*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *08520099
085300*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *08530099
085400*    US IN THE 2ND BLOCK OF THE ARRAY.                           *08540099
085500*----------------------------------------------------------------*08550099
085600 3100-SET-SUBSCRIPTS.                                             08560099
085700                                                                  08570099
085800     COMPUTE ASC-ITEM-SUB =                                       08580099
085900         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        08590099
086000                                                                  08600099
086100     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         08610099
086200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            08620099
086300                                                                  08630099
086400         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               08640099
086500     ELSE                                                         08650099
086600         MOVE +1                     TO ASC-BLK-SUB               08660099
086700     END-IF.                                                      08670099
086800                                                                  08680099
086900 EJECT                                                            08690099
087000*----------------------------------------------------------------*08700099
087100*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *08710099
087200*----------------------------------------------------------------*08720099
087300 3200-RESET-ATTRIBUTES.                                           08730099
087400                                                                  08740099
087500     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   08750099
087600     MOVE DP015-GREEN              TO ASTRTITC.                   08760099
087700     MOVE DP015-UNDERLINE          TO ASTRTITH.                   08770099
087800*                                                                 08780099
087900     PERFORM                                                      08790099
088000         VARYING PV-SUB                                           08800099
088100         FROM 1 BY 1                                              08810099
088200         UNTIL PV-SUB > (PC-ITEMS-PER-PANEL  OR                   08820099
088300                         ASC-ITEMS-DISPLAYED)                     08830099
088400         MOVE DP015-UNP-ALP-NOR-OFF                               08840099
088500                                   TO MR-SELECTA (PV-SUB)         08850099
088600         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         08860099
088700         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         08870099
088800                                                                  08880099
089200     END-PERFORM.                                                 08920099
089300                                                                  08930099
089400 EJECT                                                            08940099
089401*----------------------------------------------------------------*        
089402*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *        
089403*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *        
089404*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *        
089405*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *        
089406*----------------------------------------------------------------*        
089407 3300-EDIT-SELECTIONS.                                                    
089408                                                                          
089409     EVALUATE TRUE                                                        
089410         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)             
089411             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)                 
089412                 CONTINUE                                                 
089413         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)                 
089414             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                
089415                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS           
089416                 MOVE ASC-TEMP-SELECTED-SW                                
089417                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
089418                                TO ASC-SELECTED-SW                        
089419                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
089420             END-IF                                                       
089421         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)             
089422                                = SPACE                                   
089423             EVALUATE TRUE                                                
089424                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)               
089425                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS        
089426                     MOVE SPACE TO ASC-SELECTED-SW                        
089427                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
089428                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                
089429                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE            
089430                     MOVE SPACE TO ASC-SELECTED-SW                        
089431                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
089432                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)                  
089433                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE              
089434                     MOVE SPACE TO ASC-SELECTED-SW                        
089435                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
089436             END-EVALUATE                                                 
089437         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                   
089438             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                    
089439                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS            
089440             END-IF                                                       
089441             PERFORM 3310-EDIT-RANGE                                      
089442         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)                     
089443             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                    
089444                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS            
089445             END-IF                                                       
089446             PERFORM 3310-EDIT-RANGE                                      
089447         WHEN OTHER                                                       
089448             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER                   
089449             SET DP020-MSG-FATAL    TO TRUE                               
089450             MOVE -1                TO MR-SELECTL (PV-SUB)                
089451             SET DP030-SET-CURSOR-APPL-1                                  
089452                                    TO TRUE                               
089453             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)                
089454             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)                
089455             SET PS-ERROR TO TRUE                                         
089456             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                    
089457                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS             
089458                 MOVE SPACE         TO ASC-SELECTED-SW                    
089459                                        (ASC-BLK-SUB ASC-ITEM-SUB)        
089460             END-IF                                                       
089461     END-EVALUATE.                                                        
089462                                                                          
089463     SUBTRACT +1             FROM PV-ITEM-IN-USE.                         
089464     SUBTRACT +1 FROM ASC-ITEM-SUB.                                       
089465     IF  ASC-ITEM-SUB < 1                                                 
089466         SUBTRACT +1 FROM ASC-BLK-SUB                                     
089467         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                        
089468     END-IF.                                                              
089469                                                                          
089470 EJECT                                                                    
089471*----------------------------------------------------------------*        
089472*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *        
089473*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *        
089474*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *        
089475*  THE ENDING.                                                   *        
089476*----------------------------------------------------------------*        
089477 3310-EDIT-RANGE.                                                         
089478                                                                          
089479     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                        
089480         IF  ASC-START-OF-SELECTED-RANGE = ZERO                           
089481             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)        
089482                                   TO ASC-SELECTED-SW                     
089483                                        (ASC-BLK-SUB ASC-ITEM-SUB)        
089484             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE         
089485         ELSE                                                             
089486             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE             
089487                 CONTINUE                                                 
089488             ELSE                                                         
089489*--------------- ONLY ONE BEGINNING-OF-RANGE-ALLOWED ---                  
089490                 MOVE PC-TSYMSG-00054                                     
089491                                   TO DP020-MSG-NUMBER                    
089492                 SET DP020-MSG-FATAL                                      
089493                                   TO TRUE                                
089494                 MOVE -1           TO MR-SELECTL (PV-SUB)                 
089495                 SET DP030-SET-CURSOR-APPL-1                              
089496                                   TO TRUE                                
089497                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)                 
089498                 MOVE DP015-UNDERLINE                                     
089499                                   TO MR-SELECTH (PV-SUB)                 
089500                 SET PS-ERROR      TO TRUE                                
089501             END-IF                                                       
089502         END-IF                                                           
089503     ELSE                                                                 
089504         IF  ASC-END-OF-SELECTED-RANGE = ZERO                             
089505             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         
089506                                   TO ASC-SELECTED-SW                     
089507                                     (ASC-BLK-SUB ASC-ITEM-SUB)           
089508             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE           
089509         ELSE                                                             
089510             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE               
089511                 CONTINUE                                                 
089512             ELSE                                                         
089513*--------------- ONLY ONE END-OF-RANGE ALLOWED -------                    
089514                 MOVE PC-TSYMSG-00055                                     
089515                                   TO DP020-MSG-NUMBER                    
089516                 SET DP020-MSG-FATAL                                      
089517                                   TO TRUE                                
089518                 MOVE -1           TO MR-SELECTL (PV-SUB)                 
089519                 SET DP030-SET-CURSOR-APPL-1                              
089520                                   TO TRUE                                
089521                 SET PS-ERROR      TO TRUE                                
089522             END-IF                                                       
089523         END-IF                                                           
089524     END-IF.                                                              
089525                                                                          
089526 EJECT                                                                    
089527*----------------------------------------------------------------*        
089528*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *        
089529*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *        
089530*----------------------------------------------------------------*        
089531 3400-CHECK-RANGE-SEQUENCE.                                               
089532                                                                          
089533     IF  ASC-START-OF-SELECTED-RANGE > ZERO                               
089534       AND  ASC-END-OF-SELECTED-RANGE > ZERO                              
089535       AND  ASC-START-OF-SELECTED-RANGE >                                 
089536                                         ASC-END-OF-SELECTED-RANGE        
089537*------- END-OF-RANGE BEFORE BEGINNING-OF-RANGE --                        
089538         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                         
089539         SET DP020-MSG-FATAL TO TRUE                                      
089540         SET PS-ERROR TO TRUE                                             
089541         PERFORM 3410-POSITION-AT-ERROR                                   
089542     END-IF.                                                              
089543                                                                          
089544 EJECT                                                                    
089545*----------------------------------------------------------------*        
089546*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *        
089547*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *        
089548*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *        
089549*----------------------------------------------------------------*        
089550 3410-POSITION-AT-ERROR.                                                  
089551                                                                          
089552     SET DP030-SET-CURSOR-APPL-1                                          
089553                                   TO TRUE.                               
089554     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                         
089555                    - PV-TOP-ITEM + 1.                                    
089556     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                              
089557         CONTINUE                                                         
089558     ELSE                                                                 
089559         MOVE -1                   TO MR-SELECTL (PV-SUB)                 
089560         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)                 
089561         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)                 
089562     END-IF.                                                              
089563*                                                                         
089564     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                           
089565                    - PV-TOP-ITEM + 1.                                    
089566     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                              
089567         CONTINUE                                                         
089568     ELSE                                                                 
089569         MOVE -1                   TO MR-SELECTL (PV-SUB)                 
089570         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)                 
089571         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)                 
089572     END-IF.                                                              
089573                                                                          
089574 EJECT                                                                    
089575*----------------------------------------------------------------*        
089576*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *        
089577*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *        
089578*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *        
089579*----------------------------------------------------------------*        
089580 3500-MARK-RANGE-AS-SELECTED.                                             
089581                                                                          
089582     MOVE +1                       TO  ASC-BLK-SUB.                       
089583     PERFORM 3510-MARK-SELECTED-INDS                                      
089584         VARYING ASC-ITEM-SUB                                             
089585         FROM 1 BY 1                                                      
089586         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                         
089587                                                                          
089588     ADD +1                        TO ASC-BLK-SUB.                        
089589     PERFORM 3510-MARK-SELECTED-INDS                                      
089590         VARYING ASC-ITEM-SUB                                             
089591         FROM 1 BY 1                                                      
089592         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                         
089593                                                                          
089594     MOVE ASC-LIST-ITEM-NUMBER(1 1)                                       
089595                                   TO  PV-LIST-ITEM-NUMBER.               
089596     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                                    
089597         1 + ((PV-LIST-ITEM-NUMBER - 1) /                                 
089598               PC-ITEMS-PER-PANEL).                                       
089599                                                                          
089600     MOVE ASC-START-OF-SELECTED-RANGE                                     
089601                                   TO PV-START-OF-SELECTED-RANGE.         
089602     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                                    
089603         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                          
089604               PC-ITEMS-PER-PANEL).                                       
089605                                                                          
089606     MOVE ASC-END-OF-SELECTED-RANGE                                       
089607                                   TO  PV-END-OF-SELECTED-RANGE.          
089608     COMPUTE PV-LAST-BLOCK-IN-RANGE =                                     
089609         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                            
089610               PC-ITEMS-PER-PANEL).                                       
089611     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                                     
089612         PV-FIRST-BLOCK-IN-ARRAY + 1.                                     
089613                                                                          
089614     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR            
089615        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)                
089616         MOVE +1                   TO ASC-BLK-SUB                         
089617         PERFORM 5100-WRITE-TEMP-STORAGE                                  
089618         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                                 
089619             PV-FIRST-BLOCK-IN-ARRAY - 1                                  
089620                                                                          
089621         PERFORM                                                          
089622             UNTIL PV-FIRST-BLOCK-IN-RANGE >                              
089623                   PV-PREV-BLOCK-IN-ARRAY                                 
089624             MOVE PV-FIRST-BLOCK-IN-RANGE                                 
089625                                   TO PV-BLOCK-NUMBER                     
089626             PERFORM 4410-READ-TEMP-STORAGE                               
089627             PERFORM 3510-MARK-SELECTED-INDS                              
089628                 VARYING ASC-ITEM-SUB                                     
089629                 FROM 1 BY 1                                              
089630                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  
089631             PERFORM 5100-WRITE-TEMP-STORAGE                              
089632             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE             
089633         END-PERFORM                                                      
089634                                                                          
089635         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                                 
089636             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY             
089637         PERFORM                                                          
089638             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                               
089639                   PV-LAST-BLOCK-IN-RANGE                                 
089640             MOVE PV-NEXT-BLOCK-IN-ARRAY                                  
089641                                   TO PV-BLOCK-NUMBER                     
089642             PERFORM 4410-READ-TEMP-STORAGE                               
089643             PERFORM 3510-MARK-SELECTED-INDS                              
089644                 VARYING ASC-ITEM-SUB                                     
089645                 FROM 1 BY 1                                              
089646                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  
089647             PERFORM 5100-WRITE-TEMP-STORAGE                              
089648             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY              
089649         END-PERFORM                                                      
089650                                                                          
089651         MOVE PV-FIRST-BLOCK-IN-ARRAY                                     
089652                                   TO PV-BLOCK-NUMBER                     
089653         PERFORM 4410-READ-TEMP-STORAGE                                   
089654     END-IF.                                                              
089655                                                                          
089656     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE         
089657                                      ASC-END-OF-SELECTED-RANGE.          
089658                                                                          
089659 EJECT                                                                    
089660*----------------------------------------------------------------*        
089661* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *        
089662*----------------------------------------------------------------*        
089663 3510-MARK-SELECTED-INDS.                                                 
089664                                                                          
089665     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                                 
089666                                ASC-ITEM-SUB) >                           
089667         ASC-START-OF-SELECTED-RANGE)                                     
089668     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                                 
089669                                ASC-ITEM-SUB) =                           
089670         ASC-START-OF-SELECTED-RANGE)                                     
089671                                                                          
089672         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                             
089673                                    ASC-ITEM-SUB) <                       
089674             ASC-END-OF-SELECTED-RANGE)                                   
089675         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                             
089676                                    ASC-ITEM-SUB) =                       
089677             ASC-END-OF-SELECTED-RANGE)                                   
089678                                                                          
089679             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                  
089680                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)           
089681                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)           
089682                               TO TRUE                                    
089683                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      
089684                               TO TRUE                                    
089685                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS            
089686             END-IF                                                       
089687         END-IF                                                           
089688     END-IF.                                                              
089689                                                                          
089690 EJECT                                                                    
089691*----------------------------------------------------------------*08950099
089692*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *08960099
089700*    INITIALIZE ALL COUNTERS AND FLAGS.                          *08970099
089800*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *08980099
089900*    DISPLAY THE PANEL TO USER.                                  *08990099
090000*----------------------------------------------------------------*09000099
090100 4000-BUILD-INITIAL-PANEL.                                        09010099
090200                                                                  09020099
090300     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             09030099
090400                                ASC-BLOCK-ENTRIES (2)             09040099
090500     MOVE +1                 TO ASC-BLK-SUB.                      09050099
090510     SET DP030-SET-CURSOR-TRAILER TO TRUE.                                
090600     SET ASC-ITEMS-LEFT-ON-DB                                     09060099
090700                             TO TRUE.                             09070099
090800                                                                  09080099
090900     MOVE +0                 TO ASC-ITEM-SUB                      09090099
091000                                ASC-NUMBER-OF-ITEMS-READ          09100099
091100                                ASC-NUMBER-OF-SELECTED-ITEMS      09110099
091200                                ASC-HIGHEST-BLOCK-WRITTEN         09120099
091300                                ASC-START-OF-SELECTED-RANGE       09130099
091400                                ASC-END-OF-SELECTED-RANGE         09140099
091500                                ASC-ITEM-AT-TOP-OF-PANEL.         09150099
091600     PERFORM 4010-OPEN-CURSOR.                                    09160099
091700                                                                  09170099
091800     PERFORM 4300-READ-ITEMS-FROM-DB.                             09180099
091900                                                                  09190099
092000     PERFORM 4020-CLOSE-CURSOR.                                   09200099
092100                                                                          
092200     MOVE +1           TO PV-TOP-ITEM.                                    
092930     MOVE -1           TO MR-SELECTL (1).                                 
092940     SET DP030-SET-CURSOR-APPL-1 TO TRUE.                                 
092950     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                                
093001                                                                          
093200 EJECT                                                            09320099
093300*----------------------------------------------------------------*09330099
093400*   OPEN THE CONTAINER CURSOR.                                   *09340099
093500*----------------------------------------------------------------*09350099
093600 4010-OPEN-CURSOR.                                                09360099
093700                                                                  09370099
093800     PERFORM                                                      09380099
093900         WITH TEST AFTER                                          09390099
094000         VARYING PV-RETRY-COUNTER                                 09400099
094100         FROM 1 BY 1                                              09410099
094200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09420099
094300                   OR (SQLCODE = ZERO))                           09430099
094400                                                                  09440099
094500         MOVE 'CURSOR:  CONTNR-CSR'  TO DP013-MESSAGE-TEXT (2)    09450099
094600                                                                  09460099
094700         EXEC SQL                                                 09470099
094800              OPEN CONTNR-CSR                                     09480099
094900         END-EXEC                                                 09490099
095000*                                                                 09500099
095100         EVALUATE TRUE                                            09510099
095200             WHEN SQLCODE = ZERO                                  09520099
095300             WHEN SQLCODE = -904                                  09530099
095400             WHEN SQLCODE = -913                                  09540099
095500                 CONTINUE                                         09550099
095600             WHEN SQLWARN0 NOT = SPACES                           09560099
095700             WHEN SQLCODE < ZERO                                  09570099
095800             WHEN SQLCODE > ZERO                                  09580099
095900                 MOVE '4010-OPEN-CURSOR'                          09590099
096000                                   TO DP013-PARAGRAPH             09600099
096100                 MOVE 'OPEN CONTNR CURSOR -  '                    09610099
096200                                   TO DP013-MESSAGE-TEXT (1)      09620099
096300                 MOVE SQLCA        TO DP013-SQLCA                 09630099
096400                 MOVE 'TIMCNRL '   TO DP013-DB2-TABLE-NAME (1)    09640099
096500                 SET DP013-DB2-ABEND                              09650099
096600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09660099
096700                 PERFORM DP013-0000-PROCESS-ABEND                 09670099
096800         END-EVALUATE                                             09680099
096900     END-PERFORM.                                                 09690099
097000*                                                                 09700099
097100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09710099
097200         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             09720099
097300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   09730099
097400                                   TO DP013-MESSAGE-TEXT (1)      09740099
097500         MOVE SQLCA                TO DP013-SQLCA                 09750099
097600         MOVE 'TIMCNRL '           TO DP013-DB2-TABLE-NAME (1)    09760099
097700         SET DP013-DB2-ABEND                                      09770099
097800             DP013-XCTL-DISPLAY-RESTART                           09780099
097900                                   TO TRUE                        09790099
098000         PERFORM DP013-0000-PROCESS-ABEND                         09800099
098100     END-IF.                                                      09810099
098200                                                                  09820099
098300 EJECT                                                            09830099
098400*----------------------------------------------------------------*09840099
098500*   CLOSE THE CONTAINER CURSOR                                   *09850099
098600*----------------------------------------------------------------*09860099
098700 4020-CLOSE-CURSOR.                                               09870099
098800                                                                  09880099
098900     EXEC SQL                                                     09890099
099000          CLOSE CONTNR-CSR                                        09900099
099100     END-EXEC.                                                    09910099
099200*                                                                 09920099
099300     EVALUATE TRUE                                                09930099
099400         WHEN SQLCODE = ZERO                                      09940099
099500             CONTINUE                                             09950099
099600         WHEN SQLWARN0 NOT = SPACES                               09960099
099700         WHEN SQLCODE < ZERO                                      09970099
099800         WHEN SQLCODE > ZERO                                      09980099
099900             MOVE '4020-CLOSE-CURSOR'                             09990099
100000                               TO DP013-PARAGRAPH                 10000099
100100             MOVE 'CLOSE CONTNR CURSOR '                          10010099
100200                               TO DP013-MESSAGE-TEXT (1)          10020099
100300             MOVE SQLCA        TO DP013-SQLCA                     10030099
100400             MOVE 'TIMCNRL '   TO DP013-DB2-TABLE-NAME (1)        10040099
100500             SET DP013-DB2-ABEND                                  10050099
100600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               10060099
100700             PERFORM DP013-0000-PROCESS-ABEND                     10070099
100800     END-EVALUATE.                                                10080099
100900                                                                  10090099
101000 EJECT                                                            10100099
101100*----------------------------------------------------------------*10110099
101200*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *10120099
101300*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *10130099
101400*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *10140099
101500*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *10150099
101600*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *10160099
101700*                                                                *10170099
101800*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *10180099
101900*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *10190099
102000*    UPON INITIALIZATION.                                        *10200099
102100*----------------------------------------------------------------*10210099
102200 4300-READ-ITEMS-FROM-DB.                                         10220099
102300                                                                  10230099
102310     SET PS-DCONSLR-N-NO TO TRUE.                                         
102320                                                                  10230099
102400     PERFORM                                                      10240099
102500         VARYING PV-READ-COUNT                                    10250099
102600         FROM 1 BY 1                                              10260099
102700         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    10270099
102800            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         10280099
102900                                                                  10290099
103000         PERFORM 4310-FETCH                                       10300099
103100                                                                  10310099
103200         IF  ASC-ITEMS-LEFT-ON-DB                                 10320099
103202           IF (PV-CONTNR-ID NOT EQUAL PV-CONTNR-ID-PREV) OR               
103203              (PV-PO-CONTNR-TYP NOT EQUAL                                 
103204                                PV-PO-CONTNR-TYP-PREV)   OR               
103205              (PV-CONTNR-ID EQUAL PV-CONTNR-ID-PREV AND                   
103206               PV-CONTNR-SEQ-NBR NOT EQUAL                                
103207                                 PV-CONTNR-SEQ-NBR-PREV)                  
103208*             IF PV-DCONSLR-RLSE-CDE = PC-N OR PC-D                       
103209*                 PERFORM 4305-READ-ITEMS-FROM-DB-CONT                    
103210*                 PERFORM 4325-MOVE-TO-PREV-FIELDS                        
103220*                 SET PS-DCONSLR-N TO TRUE                                
103221              IF PV-DCONSLR-RLSE-CDE = PC-N OR                            
103222                 (PV-DCONSLR-RLSE-CDE = PC-D AND                          
103223                  PV-LAST-UPD-BY-UID NOT = 'TRKCS322')                    
103224                   PERFORM 4305-READ-ITEMS-FROM-DB-CONT                   
103225                   PERFORM 4325-MOVE-TO-PREV-FIELDS                       
103226                   SET PS-DCONSLR-N TO TRUE                               
103230              ELSE                                                        
103231                  PERFORM 4305-READ-ITEMS-FROM-DB-CONT                    
103232                  PERFORM 4325-MOVE-TO-PREV-FIELDS                        
103260                  SET PS-DCONSLR-N-NO TO TRUE                             
103354              END-IF                                                      
103355           ELSE                                                           
103356               IF ((PV-CONTNR-ID = PV-CONTNR-ID-PREV) AND                 
103357                   (PV-DCONSLR-RLSE-CDE = PC-R OR PC-S OR PC-Y)           
103358                       AND                                                
103359                   (PS-DCONSLR-N-NO))                                     
103363                    IF (PV-DCONSLR-ACTL-DTE NOT EQUAL                     
103364                              PV-DCONSLR-ACTL-DTE-PREV)  OR               
103365                       (PV-DCONSLR-ACTL-TM NOT EQUAL                      
103366                              PV-DCONSLR-ACTL-TM-PREV)                    
103376                    PERFORM 4305-READ-ITEMS-FROM-DB-CONT                  
103377                    PERFORM 4325-MOVE-TO-PREV-FIELDS                      
103378                    SET PS-DCONSLR-N-NO TO TRUE                           
103379                    END-IF                                                
103380               ELSE                                                       
103381                   IF ((PV-CONTNR-ID = PV-CONTNR-ID-PREV) AND             
103382                       (PV-DCONSLR-RLSE-CDE = PC-D AND                    
103383                        PV-LAST-UPD-BY-UID = 'TRKCS322') AND              
103385                       (PS-DCONSLR-N-NO))                                 
103386                        IF (PV-DCONSLR-ACTL-DTE NOT EQUAL                 
103387                            PV-DCONSLR-ACTL-DTE-PREV)  OR                 
103388                           (PV-DCONSLR-ACTL-TM NOT EQUAL                  
103389                            PV-DCONSLR-ACTL-TM-PREV)                      
103390                           PERFORM 4305-READ-ITEMS-FROM-DB-CONT           
103391                           PERFORM 4325-MOVE-TO-PREV-FIELDS               
103392                           SET PS-DCONSLR-N-NO TO TRUE                    
103393                        END-IF                                            
103394                   END-IF                                                 
103397               END-IF                                                     
103400           END-IF                                                         
111400         END-IF                                                   11140099
111500     END-PERFORM.                                                 11150099
111600                                                                  11160099
111700     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          11170099
111800         MOVE +1               TO ASC-BLK-SUB                     11180099
111900         PERFORM 5100-WRITE-TEMP-STORAGE                          11190099
112000         ADD +1                TO ASC-BLK-SUB                     11200099
112100         PERFORM 5100-WRITE-TEMP-STORAGE                          11210099
112200                                                                  11220099
112300         MOVE 1                TO ASC-BLK-SUB                     11230099
112400                                  PV-BLOCK-NUMBER                 11240099
112500         PERFORM 4410-READ-TEMP-STORAGE                           11250099
112600         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             11260099
112700             MOVE 2            TO ASC-BLK-SUB                     11270099
112800                                  PV-BLOCK-NUMBER                 11280099
112900             PERFORM 4410-READ-TEMP-STORAGE                       11290099
113000         END-IF                                                   11300099
113100     END-IF.                                                      11310099
113200                                                                  11320099
113300 EJECT                                                            11330099
113310*----------------------------------------------------------------*10110099
113320*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *10120099
113330*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *10130099
113340*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *10140099
113350*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *10150099
113360*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *10160099
113370*                                                                *10170099
113380*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *10180099
113390*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *10190099
113391*    UPON INITIALIZATION.                                        *10200099
113392*----------------------------------------------------------------*10210099
113393 4305-READ-ITEMS-FROM-DB-CONT.                                            
113394                                                                          
113395     IF ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                                 
113396         ADD +1            TO ASC-ITEM-SUB                                
113397     ELSE                                                                 
113398         ADD +1            TO ASC-BLK-SUB                                 
113399         MOVE +1           TO ASC-ITEM-SUB                                
113400                                                                          
113401         IF ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                          
113402             MOVE +1       TO ASC-BLK-SUB                                 
113403             SET ASC-BLOCK-MODIFIED (1)                                   
113404                           TO TRUE                                        
113405             PERFORM 5100-WRITE-TEMP-STORAGE                              
113406             MOVE ASC-BLOCK-ENTRIES                                       
113407                          (PC-MAX-BLOCKS-IN-ARRAY)                        
113408                           TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)              
113409             ADD +1        TO ASC-BLK-SUB                                 
113410             INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)                   
113411             SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      
113412                           TO  TRUE                                       
113413         END-IF                                                           
113414     END-IF.                                                              
113415                                                                          
113416     ADD +1                TO  ASC-NUMBER-OF-ITEMS-READ.                  
113417     MOVE ASC-NUMBER-OF-ITEMS-READ                                        
113418                           TO  ASC-LIST-ITEM-NUMBER                       
113419                              (ASC-BLK-SUB ASC-ITEM-SUB).                 
113420     MOVE PV-CONTNR-ID     TO  ASC-CONTNR                                 
113421                              (ASC-BLK-SUB ASC-ITEM-SUB).                 
113429     MOVE PV-PO-CART-CNT   TO  ASC-CART-CNT                               
113430                              (ASC-BLK-SUB ASC-ITEM-SUB).                 
113431     MOVE PV-PO-CONTNR-TYP TO  ASC-PO-CONTNR-TYP                          
113432                              (ASC-BLK-SUB ASC-ITEM-SUB).                 
113437                                                                          
113442     IF PV-POE-CDE NUMERIC                                                
113444         PERFORM 4315-OPEN-POE-CURSOR                                     
113445         PERFORM 4317-FETCH-POE-CURSOR                                    
113446         PERFORM 4316-CLOSE-POE-CURSOR                                    
113448         MOVE IMPOE-POE-CDE  TO ASC-POE-CDE                               
113449                               (ASC-BLK-SUB ASC-ITEM-SUB)                 
113450     ELSE                                                                 
113451         MOVE PV-POE-CDE     TO ASC-POE-CDE                               
113452                               (ASC-BLK-SUB ASC-ITEM-SUB)                 
113453     END-IF.                                                              
113454                                                                          
113455     EVALUATE PV-DCONSLR-RLSE-CDE                                         
113456         WHEN 'N'                                                         
113457             MOVE PC-NOT-TRANSMITTED TO                                   
113458                                ASC-RELEASE-STATUS                        
113459                               (ASC-BLK-SUB ASC-ITEM-SUB)                 
113460         WHEN 'D'                                                         
113461             IF PV-DCONSLR-ACTL-DTE = PC-INIT-DATE-IMCNRL                 
113462                 MOVE PC-NOT-TRANSMITTED TO                               
113463                                ASC-RELEASE-STATUS                        
113464                               (ASC-BLK-SUB ASC-ITEM-SUB)                 
113465                                                                          
113466               IF PV-LAST-UPD-BY-UID = 'TRKCS322'                         
113467                   MOVE PV-LAST-UPD-TMST (1:10) TO                        
113468                         PV-DCONSLR-ACTL-DTE                              
113469                   MOVE PV-LAST-UPD-TMST (12:8)  TO                       
113470                         PV-DCONSLR-ACTL-TM                               
113471                   MOVE PC-SCHEDULED TO                                   
113472                         ASC-RELEASE-STATUS                               
113473                        (ASC-BLK-SUB ASC-ITEM-SUB)                        
113474               END-IF                                                     
113475             ELSE                                                         
113476                 MOVE PC-SENT-WO-SPLITS TO                                
113477                                ASC-RELEASE-STATUS                        
113478                               (ASC-BLK-SUB ASC-ITEM-SUB)                 
113479             END-IF                                                       
113480         WHEN 'Y'                                                         
113481             MOVE PC-TRANSMITTED TO                                       
113482                                ASC-RELEASE-STATUS                        
113483                               (ASC-BLK-SUB ASC-ITEM-SUB)                 
113484         WHEN 'S'                                                         
113485             MOVE PC-SENT-WO-SPLITS TO                                    
113486                                ASC-RELEASE-STATUS                        
113487                               (ASC-BLK-SUB ASC-ITEM-SUB)                 
113488         WHEN 'R'                                                         
113489             MOVE PC-RETRANSMITTED TO                                     
113490                                ASC-RELEASE-STATUS                        
113491                               (ASC-BLK-SUB ASC-ITEM-SUB)                 
113492     END-EVALUATE.                                                        
113493                                                                          
113494                                                                          
113495     IF PV-ETA-TMST (1:10)  = SPACES OR PC-INIT-DATE-IMCNRL               
113496         MOVE SPACES  TO  ASC-ETA                                         
113497                         (ASC-BLK-SUB ASC-ITEM-SUB)                       
113498     ELSE                                                                 
113499         STRING PV-ETA-TMST (6:2) '/'                                     
113500                PV-ETA-TMST (9:2)                                         
113501                 DELIMITED BY SIZE                                        
113502                          INTO ASC-ETA                                    
113503                              (ASC-BLK-SUB ASC-ITEM-SUB)                  
113504     END-IF.                                                              
113505                                                                          
113506     IF PV-DCONSLR-ACTL-DTE (1:10) = SPACES OR                            
113507                                     PC-INIT-DATE-IMCNRL                  
113508         MOVE SPACES TO ASC-DCONSLR-RELEASE-DT                            
113509                       (ASC-BLK-SUB ASC-ITEM-SUB)                         
113510     ELSE                                                                 
113511         STRING PV-DCONSLR-ACTL-DTE (6:2) '/'                             
113512                PV-DCONSLR-ACTL-DTE (9:2)                                 
113513                  DELIMITED BY SIZE                                       
113514                      INTO ASC-DCONSLR-RELEASE-DT                         
113515                          (ASC-BLK-SUB ASC-ITEM-SUB)                      
113516     END-IF.                                                              
113517                                                                          
113518     IF PV-DCONSLR-ACTL-TM (1:8) = SPACES OR                              
113519                                   PC-INIT-TIME-IMCNRL                    
113520         MOVE SPACES TO ASC-DCONSLR-RELEASE-TM                            
113521                       (ASC-BLK-SUB ASC-ITEM-SUB)                         
113522     ELSE                                                                 
113523         STRING PV-DCONSLR-ACTL-TM (1:2) ':'                              
113524                PV-DCONSLR-ACTL-TM (4:2)                                  
113525                  DELIMITED BY SIZE                                       
113526                      INTO ASC-DCONSLR-RELEASE-TM                         
113527                          (ASC-BLK-SUB ASC-ITEM-SUB)                      
113528     END-IF.                                                              
113529                                                                          
113530     IF PV-DCONSLR-ENT-ID = ZEROES                                        
113531         MOVE SPACES TO ASC-DCONSLR-SCAC                                  
113532                      (ASC-BLK-SUB ASC-ITEM-SUB)                          
113540     ELSE                                                                 
113541         SET PS-DCONSLR-SCAC-FOUND-NO TO TRUE                             
113542         PERFORM 4330-SELECT-TEXTENT                                      
113543         IF PS-DCONSLR-SCAC-FOUND                                         
113544             MOVE PV-DCONSLR-SCAC TO ASC-DCONSLR-SCAC                     
113545                               (ASC-BLK-SUB ASC-ITEM-SUB)                 
113546         ELSE                                                             
113547             MOVE SPACES TO ASC-DCONSLR-SCAC                              
113548                               (ASC-BLK-SUB ASC-ITEM-SUB)                 
113549         END-IF                                                           
113550     END-IF.                                                              
113551                                                                          
113552 EJECT                                                                    
113553*----------------------------------------------------------------*        
113560*    FETCH THE CONTAINER CURSOR.                                 *11350099
113600*----------------------------------------------------------------*11360099
113700 4310-FETCH.                                                      11370099
113800                                                                  11380099
113900     EXEC SQL                                                     11390099
114000          FETCH CONTNR-CSR                                        11400099
114001          INTO  :PV-CONTNR-ID                                     11410099
114002              , :PV-CONTNR-SEQ-NBR                                        
114020              , :PV-PO-NBR                                                
114030              , :PV-DCONSLR-RLSE-CDE                                      
114031              , :PV-DCONSLR-RLSE-NUM                                      
114040              , :PV-DCONSLR-ACTL-DTE                                      
114050              , :PV-DCONSLR-ACTL-TM                                       
114051              , :PV-DCONSLR-ENT-ID                                        
114052              , :PV-LAST-UPD-TMST                                         
114053              , :PV-LAST-UPD-BY-UID                                       
114060              , :PV-POE-CDE                                               
114070              , :PV-ETA-TMST                                              
114081              , :PV-FOB-CDE                                               
114090              , :PV-PO-CART-CNT                                           
114091              , :PV-PO-CONTNR-TYP                                         
115200     END-EXEC.                                                    11520099
115300                                                                  11530099
115400     EVALUATE TRUE                                                11540099
115500         WHEN SQLCODE = ZERO                                      11550099
115600         WHEN SQLCODE = +100                                      11560099
115610         WHEN SQLCODE = -305                                      11560099
115700              CONTINUE                                            11570099
115800         WHEN SQLWARN0 NOT = SPACE                                11580099
115900         WHEN SQLCODE NOT = ZERO                                  11590099
116000              MOVE '4310-FETCH-CURSOR'                            11600099
116100                               TO DP013-PARAGRAPH                 11610099
116200              MOVE 'FETCH CONTNR CURSOR'                          11620099
116300                               TO DP013-MESSAGE-TEXT (1)          11630099
116400              MOVE SQLCA       TO DP013-SQLCA                     11640099
116500              SET DP013-DB2-ABEND                                 11650099
116600                               TO TRUE                            11660099
116700              PERFORM DP013-0000-PROCESS-ABEND                    11670099
116800     END-EVALUATE.                                                11680099
116900                                                                  11690099
117000     IF  SQLCODE EQUAL +100                                       11700099
117100         SET ASC-NO-ITEMS-LEFT-ON-DB                              11710099
117200                                   TO TRUE                        11720099
117300     END-IF.                                                      11730099
117400                                                                  11740099
117500 EJECT                                                            11750099
117630******************************************************************        
117631*   OPEN THE POE CODE CURSOR                                     *        
117632******************************************************************        
117633 4315-OPEN-POE-CURSOR.                                                    
117634                                                                          
117635     PERFORM                                                              
117636         WITH TEST AFTER                                                  
117637         VARYING PV-RETRY-COUNTER                                         
117638         FROM 1 BY 1                                                      
117639         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
117640                   OR (SQLCODE = ZERO))                                   
117641                                                                          
117642         EXEC SQL                                                         
117643              OPEN POE-CSR                                                
117644         END-EXEC                                                         
117645                                                                          
117646         EVALUATE TRUE                                            09510099
117647             WHEN SQLCODE = ZERO                                  09520099
117648             WHEN SQLCODE = -904                                  09530099
117649             WHEN SQLCODE = -913                                  09540099
117650                 CONTINUE                                         09550099
117651             WHEN SQLWARN0 NOT = SPACES                           09560099
117652             WHEN SQLCODE < ZERO                                  09570099
117653             WHEN SQLCODE > ZERO                                  09580099
117654                 MOVE '4315-OPEN-POE-CURSOR'                      09590099
117655                                   TO DP013-PARAGRAPH             09600099
117656                 MOVE 'OPEN POE CURSOR -  '                       09610099
117657                                   TO DP013-MESSAGE-TEXT (1)      09620099
117658                 MOVE SQLCA        TO DP013-SQLCA                 09630099
117659                 MOVE 'TIMPOE  '   TO DP013-DB2-TABLE-NAME (1)    09640099
117660                 SET DP013-DB2-ABEND                              09650099
117661                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09660099
117662                 PERFORM DP013-0000-PROCESS-ABEND                 09670099
117663         END-EVALUATE                                             09680099
117664     END-PERFORM.                                                 09690099
117665*                                                                 09700099
117666     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09710099
117667         MOVE '4315-OPEN-POE-CURSOR' TO DP013-PARAGRAPH           09720099
117668         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   09730099
117669                                   TO DP013-MESSAGE-TEXT (1)      09740099
117670         MOVE SQLCA                TO DP013-SQLCA                 09750099
117671         MOVE 'TIMPOE  '           TO DP013-DB2-TABLE-NAME (1)    09760099
117672         SET DP013-DB2-ABEND                                      09770099
117673             DP013-XCTL-DISPLAY-RESTART                           09780099
117674                                   TO TRUE                        09790099
117675         PERFORM DP013-0000-PROCESS-ABEND                         09800099
117676     END-IF.                                                      09810099
117677                                                                  09820099
117678 EJECT                                                            13960099
117704******************************************************************        
117705*   CLOSE THE POE CODE CURSOR                                    *        
117706******************************************************************        
117707 4316-CLOSE-POE-CURSOR.                                                   
117708                                                                          
117716     EXEC SQL                                                             
117717         CLOSE POE-CSR                                                    
117718     END-EXEC.                                                            
117719                                                                          
117720     EVALUATE TRUE                                                        
117721         WHEN SQLCODE = ZERO                                              
117722             CONTINUE                                                     
117723         WHEN SQLWARN0 NOT = SPACES                                       
117724         WHEN SQLCODE < ZERO                                              
117725         WHEN SQLCODE > ZERO                                              
117726             MOVE '4316-CLOSE-POE-CURSOR'                                 
117727                               TO DP013-PARAGRAPH                         
117728             MOVE 'CLOSE POE CURSOR '                                     
117729                               TO DP013-MESSAGE-TEXT (1)                  
117730             MOVE SQLCA        TO DP013-SQLCA                             
117731             MOVE 'TIMPOE  '   TO DP013-DB2-TABLE-NAME (1)                
117732             SET DP013-DB2-ABEND                                          
117733                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
117734             PERFORM DP013-0000-PROCESS-ABEND                             
117735     END-EVALUATE.                                                        
117736                                                                          
117737 EJECT                                                                    
117764******************************************************************        
117765*    FETCH THE POE CODE CURSOR                                   *        
117766******************************************************************        
117767 4317-FETCH-POE-CURSOR.                                                   
117768                                                                          
117769     EXEC SQL                                                             
117770          FETCH POE-CSR                                                   
117771          INTO  :IMPOE-POE-CDE                                            
117772     END-EXEC.                                                            
117773                                                                          
117774     EVALUATE TRUE                                                11540099
117775         WHEN SQLCODE = ZERO                                      11550099
117777         WHEN SQLCODE = -305                                      11560099
117778              CONTINUE                                            11570099
117779         WHEN SQLCODE = +100                                      11560099
117780              MOVE SPACES TO IMPOE-POE-CDE                                
117781         WHEN SQLWARN0 NOT = SPACE                                11580099
117782         WHEN SQLCODE NOT = ZERO                                  11590099
117783              MOVE '4317-FETCH-POE-CURSOR'                        11600099
117784                               TO DP013-PARAGRAPH                 11610099
117785              MOVE 'FETCH POE CURSOR'                             11620099
117786                               TO DP013-MESSAGE-TEXT (1)          11630099
117787              MOVE SQLCA       TO DP013-SQLCA                     11640099
117788              SET DP013-DB2-ABEND                                 11650099
117789                               TO TRUE                            11660099
117790              PERFORM DP013-0000-PROCESS-ABEND                    11670099
117791     END-EVALUATE.                                                11680099
117800                                                                  11690099
117830 EJECT                                                                    
117831*----------------------------------------------------------------*11340099
117832*    SELECT A ROW FROM TIMCNRL.                                  *11350099
117833*----------------------------------------------------------------*11360099
117834 4320-SELECT-TIMCNRL.                                             11370099
117835                                                                  11380099
117836     PERFORM                                                      13210099
117837         WITH TEST AFTER                                          13220099
117838         VARYING PV-RETRY-COUNTER                                 13230099
117840         FROM 1 BY 1                                              13240099
117900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13250099
118000            OR  (SQLCODE = ZERO)                                  13260099
118100            OR  (SQLCODE = +100))                                 13270099
118200                                                                  13280099
118300         EXEC SQL                                                 13290099
118400              SELECT A.PO_NBR                                     13300099
118500               INTO :PV-IMCNRL-PO-NBR                             13410099
118600                FROM TIMCNRL A                                    13520099
118730                   , TIMCNPO B                                            
118740                WHERE A.PO_NBR    = :DK-PO-NBR                            
118750                  AND A.PO_NBR    = B.PO_NBR                              
118760                  AND A.CONTNR_ID = B.CONTNR_ID                           
118810                  AND A.DCONSLR_RLSE_CDE = :PC-N                          
118900         END-EXEC                                                 13610099
119000                                                                  13620099
119100         EVALUATE TRUE                                            13630099
119200             WHEN SQLCODE = ZERO                                  13640099
119300             WHEN SQLCODE = -811                                  13650099
119400                 SET PS-FIRST-N TO TRUE                           13680099
119500             WHEN SQLCODE = +100                                  13650099
119600                 SET PS-FIRST-N-NO TO TRUE                                
119700             WHEN SQLWARN0 NOT = SPACES                           13690099
119800             WHEN SQLCODE < ZERO                                  13700099
119900             WHEN SQLCODE > ZERO                                  13710099
120000                 MOVE '4320-SELECT-TIMCNRL'                       13720099
120100                                   TO DP013-PARAGRAPH             13730099
120200                 MOVE 'SQL ERROR SELECTING TIMCNRL'               13740099
120300                                   TO DP013-MESSAGE-TEXT (1)      13750099
120400                 MOVE SQLCA        TO DP013-SQLCA                 13760099
120500                 MOVE 'TIMCNRL '   TO DP013-DB2-TABLE-NAME (1)    13770099
120600                 SET DP013-DB2-ABEND                              13780099
120700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           13790099
120800                 PERFORM DP013-0000-PROCESS-ABEND                 13800099
120900         END-EVALUATE                                             13810099
121000     END-PERFORM.                                                 13820099
121100                                                                  13830099
121200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13840099
121300         MOVE '4320-SELECT-TIMCNRL'       TO DP013-PARAGRAPH      13850099
121400         MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO SELECT TIMCNRL' 13860099
121500                                   TO DP013-MESSAGE-TEXT (1)      13870099
121600         MOVE SQLCA                TO DP013-SQLCA                 13880099
121700         MOVE 'TIMCNRL '           TO DP013-DB2-TABLE-NAME (1)    13890099
121800         SET DP013-DB2-ABEND                                      13900099
121900             DP013-XCTL-DISPLAY-RESTART                           13910099
122000                                   TO TRUE                        13920099
122100         PERFORM DP013-0000-PROCESS-ABEND                         13930099
122200     END-IF.                                                      13940099
122300                                                                  13950099
122400 EJECT                                                            13960099
122500*----------------------------------------------------------------*11340099
122600*    MOVE CURRENT FIELDS TO PREVIOUS FIELDS.                     *11350099
122700*----------------------------------------------------------------*11360099
122800 4325-MOVE-TO-PREV-FIELDS.                                        11370099
122900                                                                  11380099
123000     MOVE PV-CONTNR-ID        TO PV-CONTNR-ID-PREV.                       
123100     MOVE PV-PO-CONTNR-TYP    TO PV-PO-CONTNR-TYP-PREV.                   
123300     MOVE PV-CONTNR-SEQ-NBR   TO PV-CONTNR-SEQ-NBR-PREV.                  
123310     MOVE PV-DCONSLR-RLSE-CDE TO PV-DCONSLR-RLSE-CDE-PREV.                
123320     MOVE PV-DCONSLR-ACTL-DTE TO PV-DCONSLR-ACTL-DTE-PREV.                
123330     MOVE PV-DCONSLR-ACTL-TM  TO PV-DCONSLR-ACTL-TM-PREV.                 
123400                                                                          
123500*----------------------------------------------------------------*11340099
123600*    SELECT THE DECONSOLIDATOR SCAC FROM TEXTENT.                *11350099
123700*----------------------------------------------------------------*11360099
123800 4330-SELECT-TEXTENT.                                             11370099
123900                                                                  11380099
124000     PERFORM                                                      13210099
124100         WITH TEST AFTER                                          13220099
124200         VARYING PV-RETRY-COUNTER                                 13230099
124300         FROM 1 BY 1                                              13240099
124400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13250099
124500            OR  (SQLCODE = ZERO)                                  13260099
124600            OR  (SQLCODE = +100))                                 13270099
124700                                                                  13280099
124800         EXEC SQL                                                 13290099
124900              SELECT A.SCAC_CDE                                   13300099
124910               INTO :PV-DCONSLR-SCAC                              13410099
124911                FROM TEXTENT A                                    13520099
124913                WHERE A.ENT_ID    = :PV-DCONSLR-ENT-ID                    
124917         END-EXEC                                                 13610099
124918                                                                  13620099
124919         EVALUATE TRUE                                            13630099
124920             WHEN SQLCODE = ZERO                                  13640099
124921             WHEN SQLCODE = -811                                  13650099
124922                 SET PS-DCONSLR-SCAC-FOUND TO TRUE                13680099
124923             WHEN SQLCODE = +100                                  13650099
124924                 SET PS-DCONSLR-SCAC-FOUND-NO TO TRUE                     
124925             WHEN SQLWARN0 NOT = SPACES                           13690099
124926             WHEN SQLCODE < ZERO                                  13700099
124927             WHEN SQLCODE > ZERO                                  13710099
124928                 MOVE '4330-SELECT-TEXTENT'                       13720099
124929                                   TO DP013-PARAGRAPH             13730099
124930                 MOVE 'SQL ERROR SELECTING TEXTENT'               13740099
124931                                   TO DP013-MESSAGE-TEXT (1)      13750099
124932                 MOVE SQLCA        TO DP013-SQLCA                 13760099
124933                 MOVE 'TEXTENT '   TO DP013-DB2-TABLE-NAME (1)    13770099
124934                 SET DP013-DB2-ABEND                              13780099
124935                     DP013-XCTL-DISPLAY-RESTART TO TRUE           13790099
124936                 PERFORM DP013-0000-PROCESS-ABEND                 13800099
124937         END-EVALUATE                                             13810099
124938     END-PERFORM.                                                 13820099
124939                                                                  13830099
124940     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13840099
124941         MOVE '4330-SELECT-TEXTENT'       TO DP013-PARAGRAPH      13850099
124942         MOVE 'MAX RETRIES EXCEEDED ATTEMPTING TO SELECT TEXTENT' 13860099
124943                                   TO DP013-MESSAGE-TEXT (1)      13870099
124944         MOVE SQLCA                TO DP013-SQLCA                 13880099
124945         MOVE 'TEXTENT '           TO DP013-DB2-TABLE-NAME (1)    13890099
124946         SET DP013-DB2-ABEND                                      13900099
124947             DP013-XCTL-DISPLAY-RESTART                           13910099
124948                                   TO TRUE                        13920099
124949         PERFORM DP013-0000-PROCESS-ABEND                         13930099
124950     END-IF.                                                      13940099
124951                                                                  13950099
124952 EJECT                                                            13960099
124953*----------------------------------------------------------------*12480099
124960* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *12490099
125000*----------------------------------------------------------------*12500099
125100 4400-MOVE-COMMAREA-TO-SCREEN.                                    12510099
125200                                                                  12520099
125300     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             12530099
125400         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          12540099
125500         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          12550099
125600             MOVE +1    TO ASC-BLK-SUB                            12560099
125700             PERFORM 5100-WRITE-TEMP-STORAGE                      12570099
125800             ADD +1     TO ASC-BLK-SUB                            12580099
125900             PERFORM 5100-WRITE-TEMP-STORAGE                      12590099
126000             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             12600099
126100                 GIVING PV-BLOCK-NUMBER                           12610099
126200                 REMAINDER PV-REMAINDER                           12620099
126300             IF  PV-REMAINDER > ZERO                              12630099
126400                 ADD +1 TO PV-BLOCK-NUMBER                        12640099
126500             END-IF                                               12650099
126600             MOVE +1    TO ASC-BLK-SUB                            12660099
126700             PERFORM 4410-READ-TEMP-STORAGE                       12670099
126800             ADD +1     TO ASC-BLK-SUB                            12680099
126900                           PV-BLOCK-NUMBER                        12690099
127000             PERFORM 4410-READ-TEMP-STORAGE                       12700099
127100     END-IF.                                                      12710099
127200     MOVE +1            TO ASC-BLK-SUB.                           12720099
127300     COMPUTE ASC-ITEM-SUB =                                       12730099
127400         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              12740099
127500         + PC-ITEMS-PER-PANEL).                                   12750099
127600*                                                                 12760099
127700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12770099
127800         ADD +1         TO ASC-BLK-SUB                            12780099
127900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            12790099
128000     END-IF.                                                      12800099
128100*                                                                 12810099
128200     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           12820099
128300         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                12830099
128310     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                                
128400     PERFORM 4420-FORMAT-LIST-LINES                               12840099
128500         VARYING PV-SUB                                           12850099
128600         FROM PC-ITEMS-PER-PANEL BY -1                            12860099
128700         UNTIL PV-SUB < +1.                                       12870099
128800*                                                                 12880099
128900     COMPUTE ASC-ITEMS-DISPLAYED =                                12890099
129000         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          12900099
129100*                                                                 12910099
129800     PERFORM 4407-MOVE-DETAILS-TO-SCR.                            12980099
129900*                                                                 12990099
130000     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    13000099
130100                                      ASTRTITO.                   13010099
130200     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    13020099
130300     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    13030099
130400     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            13040099
130500                                   TO ASELITO.                    13050099
130600*                                                                 13060099
130700     IF  DP020-MSG-NUMBER-X = SPACE                               13070099
130800         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  13080099
130900*----------- MORE ITEMS TO DISPLAY ----                           13090099
131000             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            13100099
131100             SET DP020-MSG-INFORMATIONAL TO TRUE                  13110099
131200         END-IF                                                   13120099
131300     END-IF.                                                      13130099
131400                                                                  13140099
131500 EJECT                                                            13150099
165000*----------------------------------------------------------------*16500099
165100*    MOVE PO DETAILS TO SCREEN.                                  *16510099
165200*----------------------------------------------------------------*16520099
165300 4407-MOVE-DETAILS-TO-SCR.                                        16530099
165400                                                                  16540099
165500     MOVE ASC-KEY-PO-NBR            TO APONBRO.                   16550099
165600     MOVE ASC-KEY-DEPT-NBR          TO ADEPTO.                    16560099
165700     MOVE ASC-KEY-VENDOR-NAME       TO AVNDNMEO.                          
165800     MOVE ASC-KEY-STATUS            TO ASTATUSO.                          
170500                                                                  17050099
170600 EJECT                                                            17060099
170700*----------------------------------------------------------------*17070099
170800*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *17080099
170900*----------------------------------------------------------------*17090099
171000 4410-READ-TEMP-STORAGE.                                          17100099
171100                                                                  17110099
171200     EXEC CICS                                                    17120099
171300         READQ TS                                                 17130099
171400             QUEUE (ASC-LIST-QUEUE-NAME)                          17140099
171500             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               17150099
171600             ITEM  (PV-BLOCK-NUMBER)                              17160099
171700             RESP  (PV-CICS-RESP)                                 17170099
171800     END-EXEC.                                                    17180099
171900                                                                  17190099
172000     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       17200099
172100       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     17210099
172200         CONTINUE                                                 17220099
172300     ELSE                                                         17230099
172400         SET DP013-CICS-ABEND     TO TRUE                         17240099
172500         SET DP013-NO-ROLLBACK    TO TRUE                         17250099
172600         MOVE '4410-READ-TEMP-STORAGE'                            17260099
172700                                  TO DP013-PARAGRAPH              17270099
172800         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      17280099
172900                                  TO DP013-MESSAGE-TEXT(1)        17290099
173000         PERFORM DP013-0000-PROCESS-ABEND                         17300099
173100     END-IF.                                                      17310099
173200                                                                  17320099
173300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             17330099
173400*                                                                 17340099
173500     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         17350099
173600         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               17360099
173700     END-IF.                                                      17370099
173800                                                                  17380099
173900 EJECT                                                            17390099
174000*----------------------------------------------------------------*17400099
174100*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *17410099
174200*----------------------------------------------------------------*17420099
174300 4420-FORMAT-LIST-LINES.                                          17430099
174400                                                                  17440099
174500     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      17450099
174600         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                        
174700         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA        (PV-SUB)            
174800         MOVE DP015-HL-OFF       TO MR-SELECTH        (PV-SUB)            
174900         MOVE SPACES             TO MR-SELECTI        (PV-SUB)            
175000                                    MR-ACTION         (PV-SUB)            
175100                                    MR-CONTNR         (PV-SUB)            
175200                                    MR-CART-CNT-X     (PV-SUB)            
175210                                    MR-POE-CDE        (PV-SUB)            
175300                                    MR-ETA            (PV-SUB)            
175400                                    MR-RELEASE-STATUS (PV-SUB)            
175510                                    MR-DCONSLR-SCAC   (PV-SUB)            
175600                                    MR-RELEASE-DT     (PV-SUB)            
175610                                    MR-RELEASE-TM     (PV-SUB)            
175700                                    MR-PO-CONT        (PV-SUB)            
176000                                                                          
176200     ELSE                                                                 
176300         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      17630099
176400                                                   > SPACE        17640099
176500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 17650099
176600                                 TO MR-SELECTI (PV-SUB)           17660099
176700         ELSE                                                     17670099
176800             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      17680099
176900                                 TO MR-SELECTI (PV-SUB)           17690099
177000         END-IF                                                   17700099
177010                                                                          
177020         IF DP030-SET-CURSOR-TRAILER                                      
177030            IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         
177040                > SPACE)                                                  
177050              OR (PV-SUB = 1))                                            
177060               SET DP030-SET-CURSOR-APPL-1 TO TRUE                        
177070               MOVE -1        TO MR-SELECTL (PV-SUB)                      
177080            END-IF                                                        
177090         END-IF                                                           
177100*                                                                 17710099
177200         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           17720099
177300             MOVE ASC-ACTION   (ASC-BLK-SUB ASC-ITEM-SUB)         17730099
177400                               TO MR-ACTION (PV-SUB)              17740099
177805                                                                          
177806             MOVE ASC-CONTNR   (ASC-BLK-SUB ASC-ITEM-SUB)                 
177807                               TO MR-CONTNR (PV-SUB)                      
177810             MOVE ASC-CART-CNT (ASC-BLK-SUB ASC-ITEM-SUB)                 
177820                               TO MR-CART-CNT (PV-SUB)                    
177900             MOVE ASC-POE-CDE  (ASC-BLK-SUB ASC-ITEM-SUB)                 
178000                               TO MR-POE-CDE (PV-SUB)                     
178100             MOVE ASC-ETA      (ASC-BLK-SUB ASC-ITEM-SUB)                 
178200                               TO MR-ETA (PV-SUB)                         
178300             MOVE ASC-RELEASE-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)           
178400                               TO MR-RELEASE-STATUS (PV-SUB)              
178701             MOVE ASC-DCONSLR-SCAC (ASC-BLK-SUB ASC-ITEM-SUB)             
178702                               TO MR-DCONSLR-SCAC (PV-SUB)                
178710             MOVE ASC-DCONSLR-RELEASE-DT                                  
178720                                  (ASC-BLK-SUB ASC-ITEM-SUB)              
178800                               TO MR-RELEASE-DT (PV-SUB)                  
178810             MOVE ASC-DCONSLR-RELEASE-TM                                  
178811                                  (ASC-BLK-SUB ASC-ITEM-SUB)              
178820                               TO MR-RELEASE-TM (PV-SUB)                  
178900             MOVE ASC-PO-CONTNR-TYP (ASC-BLK-SUB ASC-ITEM-SUB)            
179000                               TO MR-PO-CONT (PV-SUB)                     
179500         END-IF                                                   17950099
179600     END-IF.                                                      17960099
179700     SUBTRACT +1 FROM ASC-ITEM-SUB.                               17970099
179800     IF  ASC-ITEM-SUB < + 1                                       17980099
179900         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  17990099
180000         MOVE +1                 TO ASC-BLK-SUB                   18000099
180100     END-IF.                                                      18010099
180200                                                                  18020099
180300 EJECT                                                            18030099
180301*----------------------------------------------------------------*        
180302*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *        
180303*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *        
180304*  ISSUE A WARNING.                                              *        
180305*----------------------------------------------------------------*        
180306 4430-CHECK-FOR-BEGIN-AND-END.                                            
180307                                                                          
180308     IF  ASC-START-OF-SELECTED-RANGE > ZERO                               
180309         IF  ASC-END-OF-SELECTED-RANGE = ZERO                             
180310*----------- NO END-OF-RANGE SPECFIED ---                                 
180311             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER                    
180312             SET DP020-MSG-WARNING TO TRUE                                
180313             PERFORM 4431-POSITION-AT-WARNING                             
180314         END-IF                                                           
180315     ELSE                                                                 
180316         IF  ASC-END-OF-SELECTED-RANGE > ZERO                             
180317*----------- NO BEGINNING-OF-RANGE SPECFIED ---                           
180318             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER                    
180319             SET DP020-MSG-WARNING TO TRUE                                
180320             PERFORM 4431-POSITION-AT-WARNING                             
180321         END-IF                                                           
180322     END-IF.                                                              
180323                                                                          
180324 EJECT                                                                    
180325*----------------------------------------------------------------*        
180326*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *        
180327*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *        
180328*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *        
180329*  POSITION THE CURSOR THERE.                                    *        
180330*----------------------------------------------------------------*        
180331 4431-POSITION-AT-WARNING.                                                
180332                                                                          
180333     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                         
180334                    - PV-TOP-ITEM + 1.                                    
180335     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                              
180336         CONTINUE                                                         
180337     ELSE                                                                 
180338         SET DP030-SET-CURSOR-APPL-1                                      
180339                                   TO TRUE                                
180340         MOVE -1                   TO MR-SELECTL (PV-SUB)                 
180341         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)                 
180342         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)                 
180343     END-IF.                                                              
180344*                                                                         
180345     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                           
180346                    - PV-TOP-ITEM + 1.                                    
180347     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                              
180348         CONTINUE                                                         
180349     ELSE                                                                 
180350         SET DP030-SET-CURSOR-APPL-1                                      
180351                                   TO TRUE                                
180352         MOVE -1                   TO MR-SELECTL (PV-SUB)                 
180353         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)                 
180354         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)                 
180355     END-IF.                                                              
180356                                                                          
180357 EJECT                                                                    
180359*----------------------------------------------------------------*        
180360* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *        
180361* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *        
180362* FOR THE SELECTED ITEMS QUEUE.                                  *        
180363*                                                                *        
180364* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *        
180365* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *        
180366* THE ARRAY IS FULL.                                             *        
180367*----------------------------------------------------------------*        
180368 5000-PREPARE-SEL-QUEUE.                                                  
180369                                                                          
180370     MOVE +1                   TO  ASC-BLK-SUB.                           
180371     PERFORM 5100-WRITE-TEMP-STORAGE.                                     
180372     ADD +1                    TO  ASC-BLK-SUB.                           
180373     PERFORM 5100-WRITE-TEMP-STORAGE.                                     
180374     MOVE ASC-SEL-QUEUE-NAME   TO  TR102-SEL-QUEUE-NAME.                  
180375     PERFORM 6010-DELETE-SEL-QUEUE.                                       
180376                                                                          
180377     SET ASC-UPDATE-TSQ        TO  TRUE.                                  
180378                                                                          
180379     SET TR120-IDX             TO  1.                                     
180380     MOVE ZERO                 TO TR102-NUMBER-OF-TS-ITEMS.               
180381     INITIALIZE TR120-SELECTED-ITEM-ARRAY.                                
180382                                                                          
180383     PERFORM 5200-FILL-SEL-QUEUE-RECORD                                   
180384             VARYING PV-ITEM                                              
180385             FROM 1 BY 1                                                  
180386             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.             
180387                                                                          
180388     IF  TR120-IDX > 1                                                    
180389         PERFORM 5205-WRITE-SEL-QUEUE                                     
180390         ADD +1                    TO TR102-NUMBER-OF-TS-ITEMS            
180391     END-IF.                                                              
180392                                                                          
180393 5001-PREPARE-SEL-QUEUE.                                                  
180394                                                                          
180395     MOVE +1                   TO  ASC-BLK-SUB.                           
180396     PERFORM 5100-WRITE-TEMP-STORAGE.                                     
180397     ADD +1                    TO  ASC-BLK-SUB.                           
180398     PERFORM 5100-WRITE-TEMP-STORAGE.                                     
180399     MOVE ASC-SEL-QUEUE-NAME   TO  TR102-SEL-QUEUE-NAME.                  
180400     PERFORM 6010-DELETE-SEL-QUEUE.                                       
180401                                                                          
180402     SET ASC-UPDATE-TSQ        TO  TRUE.                                  
180403                                                                          
180404     SET TR120-IDX             TO  1.                                     
180405     MOVE ZERO                 TO TR102-NUMBER-OF-TS-ITEMS.               
180406     INITIALIZE TR120-SELECTED-ITEM-ARRAY.                                
180407                                                                          
180408     PERFORM 5200-FILL-SEL-QUEUE-RECORD                                   
180409             VARYING PV-ITEM                                              
180410             FROM 1 BY 1                                                  
180411             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.             
180412                                                                          
180413     IF  TR120-IDX > 1                                                    
180414         PERFORM 5205-WRITE-SEL-QUEUE                                     
180415         ADD +1                    TO TR102-NUMBER-OF-TS-ITEMS            
180416     END-IF.                                                              
180417                                                                          
180418 EJECT                                                                    
180420*----------------------------------------------------------------*18040099
180500*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *18050099
180600*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *18060099
180700*----------------------------------------------------------------*18070099
180800 5100-WRITE-TEMP-STORAGE.                                         18080099
180900                                                                  18090099
181000     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     18100099
181100                                   TO PV-LIST-ITEM-NUMBER.        18110099
181200     COMPUTE PV-BLOCK-NUMBER =                                    18120099
181300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    18130099
181400                                                                  18140099
181500     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             18150099
181600     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             18160099
181700         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      18170099
181800             PERFORM 5105-REWRITE-ASC-LISTQ                       18180099
181900         END-IF                                                   18190099
182000     ELSE                                                         18200099
182100         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       18210099
182200         ASC-HIGHEST-BLOCK-WRITTEN + 1                            18220099
182300         PERFORM 5110-WRITE-ASC-LISTQ                             18230099
182400         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   18240099
182500     END-IF.                                                      18250099
182600                                                                  18260099
182700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             18270099
182800                                                                  18280099
182900 EJECT                                                            18290099
183000*----------------------------------------------------------------*18300099
183100*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *18310099
183200*  SPECIFIC COMMAREA.                                            *18320099
183300*----------------------------------------------------------------*18330099
183400 5105-REWRITE-ASC-LISTQ.                                          18340099
183500                                                                  18350099
183600     EXEC CICS                                                    18360099
183700         WRITEQ TS                                                18370099
183800             QUEUE (ASC-LIST-QUEUE-NAME)                          18380099
183900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               18390099
184000             ITEM  (PV-BLOCK-NUMBER)                              18400099
184100             REWRITE                                              18410099
184200             RESP  (PV-CICS-RESP)                                 18420099
184300     END-EXEC.                                                    18430099
184400                                                                  18440099
184500     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           18450099
184600         CONTINUE                                                 18460099
184700     ELSE                                                         18470099
184800         SET DP013-CICS-ABEND            TO TRUE                  18480099
184900         SET DP013-NO-ROLLBACK           TO TRUE                  18490099
185000         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       18500099
185100         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     18510099
185200                                         TO DP013-MESSAGE-TEXT(1) 18520099
185300         PERFORM DP013-0000-PROCESS-ABEND                         18530099
185400     END-IF.                                                      18540099
185500                                                                  18550099
185600 EJECT                                                            18560099
185700*----------------------------------------------------------------*18570099
185800*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *18580099
185900*  SPECIFIC COMMAREA.                                            *18590099
186000*----------------------------------------------------------------*18600099
186100 5110-WRITE-ASC-LISTQ.                                            18610099
186200                                                                  18620099
186300     EXEC CICS                                                    18630099
186400         WRITEQ TS                                                18640099
186500             QUEUE (ASC-LIST-QUEUE-NAME)                          18650099
186600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               18660099
186700             ITEM  (PV-BLOCK-NUMBER)                              18670099
186800             RESP  (PV-CICS-RESP)                                 18680099
186900     END-EXEC.                                                    18690099
187000                                                                  18700099
187100     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      18710099
187200         SET DP013-CICS-ABEND      TO TRUE                        18720099
187300         SET DP013-NO-ROLLBACK     TO TRUE                        18730099
187400         MOVE '5110-WRITE-ASC-LISTQ'                              18740099
187500                                   TO DP013-PARAGRAPH             18750099
187600         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           18760099
187700                                   TO DP013-MESSAGE-TEXT(1)       18770099
187800         PERFORM DP013-0000-PROCESS-ABEND                         18780099
187900     END-IF.                                                      18790099
188000                                                                  18800099
188100 EJECT                                                            18810099
188101*----------------------------------------------------------------*        
188102* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *        
188103* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *        
188104*----------------------------------------------------------------*        
188105 5200-FILL-SEL-QUEUE-RECORD.                                              
188106                                                                          
188107     PERFORM 6112-READ-LIST-QUEUE.                                        
188108                                                                          
188109     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                               
188110         PERFORM                                                          
188111         VARYING LQW-IDX                                                  
188112         FROM 1 BY 1                                                      
188113         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL                    
188114           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO                  
188115                                                                          
188116             IF  LQW-SELECT (LQW-IDX)                                     
188117                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)                      
188118                                     TO TR120-ITEM (TR120-IDX)            
188123                 MOVE LQW-CONTNR (LQW-IDX)  TO                            
188124                                 TR120-CONTNR (TR120-IDX)                 
188126                 MOVE LQW-CART-CNT (LQW-IDX)  TO                          
188127                                 TR120-CART-CNT (TR120-IDX)               
188128                 MOVE LQW-POE-CDE (LQW-IDX)  TO                           
188129                                 TR120-POE-CDE (TR120-IDX)                
188130                 MOVE LQW-ETA (LQW-IDX)  TO                               
188131                                 TR120-ETA (TR120-IDX)                    
188132                 MOVE LQW-RELEASE-STATUS (LQW-IDX)  TO                    
188133                               TR120-RELEASE-STATUS (TR120-IDX)           
188136                 MOVE LQW-DCONSLR-SCAC (LQW-IDX)  TO                      
188137                               TR120-DCONSLR-SCAC (TR120-IDX)             
188138                 MOVE LQW-RELEASE-DT (LQW-IDX)  TO                        
188139                               TR120-RELEASE-DT (TR120-IDX)               
188140                 MOVE LQW-RELEASE-TM (LQW-IDX)  TO                        
188141                               TR120-RELEASE-TM (TR120-IDX)               
188142                 MOVE LQW-PO-CONTNR (LQW-IDX)  TO                         
188143                               TR120-PO-CONTNR (TR120-IDX)                
188144                                                                          
188145                 MOVE 'I'           TO TR120-ACTION-SW (TR120-IDX)        
188146                 SET TR120-IDX UP BY 1                                    
188147                 IF  TR120-IDX > TR120-MAX-ITEMS                          
188148                     PERFORM 5205-WRITE-SEL-QUEUE                         
188149                     ADD +1        TO TR102-NUMBER-OF-TS-ITEMS            
188150                     INITIALIZE TR120-SELECTED-ITEM-ARRAY                 
188151                     SET TR120-IDX TO  1                                  
188152                 END-IF                                                   
188153             END-IF                                                       
188154         END-PERFORM                                                      
188155     END-IF.                                                              
188156                                                                          
188157 EJECT                                                                    
188158*----------------------------------------------------------------*        
188159*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *        
188160*----------------------------------------------------------------*        
188161 5205-WRITE-SEL-QUEUE.                                                    
188162                                                                          
188163     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                                    
188164                                   TO TR120-SELECTED-ITEMS.               
188165                                                                          
188166     EXEC CICS                                                            
188167          WRITEQ TS                                                       
188168             QUEUE (ASC-SEL-QUEUE-NAME)                                   
188169             FROM  (TR120-PO-SELECT-RECORD)                               
188170             ITEM  (PV-SEL-QUEUE-ITEM)                                    
188171             RESP  (PV-CICS-RESP)                                         
188172     END-EXEC.                                                            
188173                                                                          
188174     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
188175         CONTINUE                                                         
188176     ELSE                                                                 
188177         SET DP013-CICS-ABEND      TO TRUE                                
188178         SET DP013-NO-ROLLBACK     TO TRUE                                
188179         MOVE '5205-WRITE-SEL-QUEUE'                                      
188180                                   TO DP013-PARAGRAPH                     
188181         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'                  
188182                                   TO DP013-MESSAGE-TEXT(1)               
188183         PERFORM DP013-0000-PROCESS-ABEND                                 
188184     END-IF.                                                              
188185                                                                          
188186 EJECT                                                                    
188187*----------------------------------------------------------------*        
188188*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *        
188189*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *        
188190*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *        
188191*  THE USER.                                                     *        
188192*----------------------------------------------------------------*        
188193 6000-REFRESH-PANEL-FROM-TEMP.                                            
188194                                                                          
188195     IF  ASC-UPDATE-TSQ                                                   
188196         SET ASC-NO-TSQ-UPDATE TO TRUE                                    
188197         MOVE ZERO                 TO PV-SAVE-ITEM                        
188198                                      PV-SEL-QUEUE-ITEM                   
188199         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                                
188200                                   TO PV-HOLD-SELECTED-ITEMS              
188201         MOVE +1                   TO PV-ITEMS-PROCESSED                  
188202         PERFORM 6100-UPDATE-TSQ                                          
188203             UNTIL PV-ITEMS-PROCESSED >                                   
188204                                     PV-HOLD-SELECTED-ITEMS               
188205         PERFORM 6010-DELETE-SEL-QUEUE                                    
188206         INITIALIZE ASC-BLOCK-ENTRIES (1)                                 
188207                    ASC-BLOCK-ENTRIES (2)                                 
188208     END-IF.                                                              
188209                                                                          
188210 EJECT                                                                    
188211*----------------------------------------------------------------*        
188212*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *        
188213*----------------------------------------------------------------*        
188214 6010-DELETE-SEL-QUEUE.                                                   
188215                                                                          
188216     EXEC CICS                                                            
188217         DELETEQ TS                                                       
188218             QUEUE (ASC-SEL-QUEUE-NAME)                                   
188219             RESP  (PV-CICS-RESP)                                         
188220     END-EXEC.                                                            
188221*                                                                         
188222     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                              
188223        (PV-CICS-RESP = DFHRESP(QIDERR)))                                 
188224         CONTINUE                                                         
188225     ELSE                                                                 
188226         SET DP013-CICS-ABEND TO TRUE                                     
188227         SET DP013-NO-ROLLBACK TO TRUE                                    
188228         MOVE '6010-DELETE-SEL-QUEUE'                                     
188229                        TO DP013-PARAGRAPH                                
188230         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'                 
188231                        TO DP013-MESSAGE-TEXT (1)                         
188232         PERFORM DP013-0000-PROCESS-ABEND                                 
188233     END-IF.                                                              
188234                                                                          
188235 EJECT                                                                    
188236*----------------------------------------------------------------*        
188237*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *        
188238*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *        
188239*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *        
188240*    THE TEMP QUEUE.                                             *        
188241*----------------------------------------------------------------*        
188242 6100-UPDATE-TSQ.                                                         
188243                                                                          
188244     ADD 1                     TO  PV-SEL-QUEUE-ITEM.                     
188245     PERFORM 6105-READ-SEL-QUEUE.                                         
188246     PERFORM                                                              
188247         VARYING TR120-IDX                                                
188248         FROM 1 BY 1                                                      
188249         UNTIL ((PV-ITEMS-PROCESSED >                                     
188250                              PV-HOLD-SELECTED-ITEMS)                     
188251         OR (TR120-IDX GREATER THAN TR120-MAX-ITEMS))                     
188252         IF  TR120-ACTION-SW (TR120-IDX) > SPACE                          
188253             PERFORM 6110-PROCESS-ITEMS                                   
188254         END-IF                                                           
188255         ADD +1                TO PV-ITEMS-PROCESSED                      
188256     END-PERFORM.                                                         
188257     PERFORM 6111-WRITE-LIST-QUEUE.                                       
188258                                                                          
188259 EJECT                                                                    
188260*----------------------------------------------------------------*        
188261*    READ THE LIST QUEUE RECORD.                                 *        
188262*----------------------------------------------------------------*        
188263 6105-READ-SEL-QUEUE.                                                     
188264                                                                          
188265     EXEC CICS                                                            
188266          READQ TS                                                        
188267             QUEUE (ASC-SEL-QUEUE-NAME)                                   
188268             INTO  (TR120-PO-SELECT-RECORD)                               
188269             ITEM  (PV-SEL-QUEUE-ITEM)                                    
188270             RESP  (PV-CICS-RESP)                                         
188271     END-EXEC.                                                            
188272*                                                                         
188273     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
188274         CONTINUE                                                         
188275     ELSE                                                                 
188276         SET DP013-CICS-ABEND      TO  TRUE                               
188277         SET DP013-NO-ROLLBACK     TO  TRUE                               
188278         MOVE '6105-READ-SEL-QUEUE'                                       
188279                                   TO  DP013-PARAGRAPH                    
188280         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'                   
188281                                   TO  DP013-MESSAGE-TEXT(1)              
188282         PERFORM DP013-0000-PROCESS-ABEND                                 
188283     END-IF.                                                              
188284                                                                          
188285 EJECT                                                                    
188286*----------------------------------------------------------------*        
188287*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*        
188288*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*        
188289*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *        
188290*----------------------------------------------------------------*        
188291 6110-PROCESS-ITEMS.                                                      
188292                                                                          
188293     COMPUTE PV-ITEM = 1 + ((TR120-ITEM (TR120-IDX) - 1)                  
188294                     / PC-ITEMS-PER-PANEL).                               
188295                                                                          
188296     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                                   
188297         IF  PV-SAVE-ITEM NOT EQUAL ZERO                                  
188298             PERFORM 6111-WRITE-LIST-QUEUE                                
188299         END-IF                                                           
188300         MOVE PV-ITEM          TO PV-SAVE-ITEM                            
188301                                                                          
188302         PERFORM 6112-READ-LIST-QUEUE                                     
188303         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                       
188304             CONTINUE                                                     
188305         END-IF                                                           
188306     END-IF.                                                              
188307                                                                          
188308     COMPUTE PV-SUB = (TR120-ITEM (TR120-IDX)                             
188309                    - LQW-LIST-ITEM-NUMBER (1)) + 1.                      
188310     SET LQW-DESELECT (PV-SUB) TO    TRUE.                                
188311     MOVE LQW-SELECTED-SW (PV-SUB)                                        
188312                               TO LQW-TEMP-SELECTED-SW (PV-SUB).          
188313                                                                          
188314     IF TR120-INQ (TR120-IDX)                                             
188315        MOVE PC-INQ            TO LQW-ACTION (PV-SUB)                     
188316     END-IF.                                                              
188317                                                                          
188318     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                        
188319                                                                          
188320 EJECT                                                                    
188321*----------------------------------------------------------------*        
188322*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *        
188323*----------------------------------------------------------------*        
188324 6111-WRITE-LIST-QUEUE.                                                   
188325                                                                          
188326     EXEC CICS                                                            
188327         WRITEQ TS                                                        
188328             QUEUE (ASC-LIST-QUEUE-NAME)                                  
188329             FROM  (LQW-LIST-QUEUE-WORK-AREA)                             
188330             ITEM  (PV-SAVE-ITEM)                                         
188331             REWRITE                                                      
188332             RESP  (PV-CICS-RESP)                                         
188333     END-EXEC.                                                            
188334*                                                                         
188335     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
188336         CONTINUE                                                         
188337     ELSE                                                                 
188338         SET DP013-CICS-ABEND  TO  TRUE                                   
188339         SET DP013-NO-ROLLBACK TO  TRUE                                   
188340         MOVE '6111-WRITE-LIST-QUEUE'                                     
188341                               TO  DP013-PARAGRAPH                        
188342         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                          
188343                               TO  DP013-MESSAGE-TEXT(1)                  
188344         PERFORM DP013-0000-PROCESS-ABEND                                 
188345     END-IF.                                                              
188346                                                                          
188347 EJECT                                                                    
188348*----------------------------------------------------------------*        
188349*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*        
188350*----------------------------------------------------------------*        
188351 6112-READ-LIST-QUEUE.                                                    
188352                                                                          
188353     EXEC CICS                                                            
188354         READQ TS                                                         
188355             QUEUE (ASC-LIST-QUEUE-NAME)                                  
188356             INTO  (LQW-LIST-QUEUE-WORK-AREA)                             
188357             ITEM  (PV-ITEM)                                              
188358             RESP  (PV-CICS-RESP)                                         
188359     END-EXEC.                                                            
188360*                                                                         
188361     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
188362         CONTINUE                                                         
188363     ELSE                                                                 
188364         SET DP013-CICS-ABEND        TO TRUE                              
188365         SET DP013-NO-ROLLBACK       TO TRUE                              
188366         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH                   
188367         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                            
188368                                     TO DP013-MESSAGE-TEXT(1)             
188369         PERFORM DP013-0000-PROCESS-ABEND                                 
188370     END-IF.                                                              
188371                                                                          
188372 EJECT                                                                    
188373*----------------------------------------------------------------*18820099
188380*    ABEND PROCESSOR MODULE                                      *18830099
188400*----------------------------------------------------------------*18840099
188500                                                                  18850099
188600     COPY DPPD013.                                                18860099
