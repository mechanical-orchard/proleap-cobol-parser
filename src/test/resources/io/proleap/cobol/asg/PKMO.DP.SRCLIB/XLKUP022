000010 TITLE 'UPDATE TPOPRPK BASED ON PACK ITEM MESSAGES'.                      
000020 IDENTIFICATION DIVISION.                                         00002003
000030 PROGRAM-ID.    XLKUP022.                                         00003003
000040 AUTHOR.        DEANNA BRANTNER.                                  00004005
000050 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00005003
000060 DATE-WRITTEN.  APRIL 2003.                                       00006003
000070 DATE-COMPILED.                                                   00007003
000100***************************************************************** 00010003
001000* THIS PGM IS PART OF THE INTERFACING BETWEEN RMS PO & LEGACY PO. 00100003
001100***************************************************************** 00110003
001200* THIS DB2 PROGRAM IS CALLED TO PROCESS CERTAIN TYPES OF PO DATA  00120003
001300* PASSED FROM RMS. THE PROGRAM UPDATES ROWS ON THE LEGACY TPOPRPK         
001400* TABLE. THIS PROGRAM IS DIFFERENT FROM XLKUP011 BECAUSE IT DEALS         
001400* WITH RMS PACK INFO.                                                     
001500***************************************************************** 00150003
001600 ENVIRONMENT DIVISION.                                            00160003
001700 CONFIGURATION SECTION.                                           00170003
001800 SOURCE-COMPUTER.  IBM-3090.                                      00180003
001900 OBJECT-COMPUTER.  IBM-3090.                                      00190003
002000 DATA DIVISION.                                                   00200003
002100                                                                  00210003
002200 WORKING-STORAGE SECTION.                                         00220003
002300                                                                  00230003
002300 01  PS-PROGRAM-STUFF.                                            00231006
002400     05  PS-EXISTENCE-PO              PIC S9 COMP-3 VALUE ZERO.   00232006
002500         88  PS-SKU-EXISTS-YES                      VALUE 1.      00233006
002600         88  PS-SKU-EXISTS-NO                       VALUE ZERO.   00234006
011500     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00234107
011600         88  PS-NO-ERROR                            VALUE 'Y'.    00234207
011700         88  PS-ERROR                               VALUE 'N'.    00234307
011500     05  PS-CHECK-SW                    PIC  X(01)  VALUE 'Y'.    00234410
011600         88  PS-NO-CHECK                            VALUE 'N'.    00234510
002200         88  PS-CHECK                               VALUE 'Y'.    00234610
022000     05  PS-NULL-IND                   PIC S9(04)  VALUE +0 COMP. 00234716
011500     05  PS-CURRENT-TMST                PIC  X(26)  VALUE SPACES. 00234410
002300                                                                  00235006
002400**** PO AGREEMENTS                                                00240008
002500     EXEC SQL                                                     00250003
002600         INCLUDE TPOPRPK                                          00260004
002700     END-EXEC.                                                    00270003
002800                                                                  00280003
002400**** XLT_PK_UPC TABLE                                             00289712
002500     EXEC SQL                                                     00289812
002600         INCLUDE XLT00009                                         00289912
002700     END-EXEC.                                                    00290012
002800                                                                  00290112
002900     EXEC SQL                                                     00291012
003000          INCLUDE SQLCA                                           00300003
003100     END-EXEC.                                                    00310003
003200                                                                  00320003
003300     COPY SQLCA2.                                                 00330003
003400                                                                  00340003
003300     COPY IMRD075.                                                00330003
003400                                                                  00340003
007200 LINKAGE SECTION.                                                         
007300*****************************************************************         
007400**LINKAGE VARIABLES                                                       
007500*****************************************************************         
007600 01  LV-LINKAGE-VARIABLES.                                                
007700     05  LV-IMRD075-RECORD               PIC X(137).                      
007800     05  LV-RETURN-CODE                  PIC X(04).                       
007900                                                                          
008000 PROCEDURE DIVISION USING LV-LINKAGE-VARIABLES.                           
008100*****************************************************************         
003900                                                                  00750006
003900     INITIALIZE DCLTPOPRPK.                                               
003900     INITIALIZE IMRD075-RECORD.                                   00750006
004200     MOVE LV-IMRD075-RECORD  TO IMRD075-RECORD.                           
003900                                                                  00750006
004000     PERFORM 1000-INITIALIZATION.                                 00400003
004100                                                                  00410003
004200     IF PS-SKU-EXISTS-YES                                                 
004200         PERFORM 3000-UPDATE-TPOPRPK                                      
004200     END-IF.                                                              
004300                                                                  00430003
004600     GOBACK.                                                      00460003
004700                                                                  00470003
005300***************************************************************** 00471005
004800 1000-INITIALIZATION.                                             00480003
004900                                                                  00490003
004200     PERFORM 2000-CHECK-UPC.                                              
005200                                                                  00520003
005300***************************************************************** 00521010
025200 2000-CHECK-UPC.                                                          
033800     MOVE IM075-UPC-PK-SKU-NBR      TO XLT00009-PK-SKU-NBR.       00523012
033900     MOVE ZERO                      TO PS-EXISTENCE-PO.                   
034000                                                                  00525010
034100     EXEC SQL                                                     00526010
034200         SELECT 1                                                         
034300         INTO  :PS-EXISTENCE-PO                                   00528012
034500         FROM  XLT_PK_UPC                                         00529112
034700         WHERE PK_SKU_NBR             = :XLT00009-PK-SKU-NBR      00529312
034900         AND EDI_ORD_IND              = 'Y'                       00529510
034900           FETCH FIRST 1 ROWS ONLY                                        
035100     END-EXEC.                                                    00529610
035200                                                                  00529710
035400     EVALUATE TRUE                                                00529910
035500         WHEN SQLCODE = ZERO                                      00530010
036100             MOVE '0000' TO LV-RETURN-CODE                                
      *AHP                                                                      
      *    DO NOT ERROR OUT IF ORD IND = N                                      
      *    AN ITEM MESSAGE RECORD FOR ORD IND = Y WILL FOLLOW SOON              
      *AHP                                                                      
036300         WHEN OTHER                                               00530910
036100             MOVE '0000' TO LV-RETURN-CODE                                
036600     END-EVALUATE.                                                00531310
036700                                                                  00531410
      ***************************************************************** 00537010
       3000-UPDATE-TPOPRPK.                                                     
                                                                                
           MOVE IM075-UPC-PK-SKU-NBR       TO POPRPK-PK-SKU-NBR.                
           MOVE IM075-UPC-UPC-NBR          TO POPRPK-PREPK-UPC-NBR.             
                                                                                
           EXEC SQL                                                             
               UPDATE TPOPRPK                                                   
                 SET                                                            
                    PREPK_UPC_NBR    = :POPRPK-PREPK-UPC-NBR                    
                   ,PK_DTL_CHG_TMST  = CURRENT TIMESTAMP                        
              WHERE PK_SKU_NBR       = :POPRPK-PK-SKU-NBR                       
          END-EXEC                                                              
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
               WHEN SQLCODE = +100                                              
               WHEN SQLCODE = -803                                              
                   MOVE '0000' TO LV-RETURN-CODE                                
               WHEN OTHER                                                       
                   MOVE '0023' TO LV-RETURN-CODE                                
           END-EVALUATE.                                                        
                                                                                
