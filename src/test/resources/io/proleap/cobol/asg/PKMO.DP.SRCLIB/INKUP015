      *                                                                 00010000
      *                                                                 00020000
      *                                                                 00030000
       IDENTIFICATION DIVISION.                                         00040000
       PROGRAM-ID.    INKUP015.                                         00050000
       AUTHOR.        KIMBERLY WRIGHT.                                  00060000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00070000
       DATE-WRITTEN.  02/01/95.                                         00080000
       DATE-COMPILED.                                                   00090000
      ******************************************************************00100000
      *    INKUP015 - INSERT NEW SHRINK RECORD                          00110000
      *                                                                 00120000
      *    UPDATE THE DEPARTMENT/SHRINK DB2 TABLE TO REFLECT NEW 1995   00130000
      *    SHRINK PERCENTAGES.  HARDCODING JANUARY, 1994 DATA THROUGHOUT00140000
      *    THE 1995 PERCENTAGES.                                        00150000
      *                                                                 00160000
      ******************************************************************00170000
      *                                                                 00180000
      ******************************************************************00190000
      *    06/13/95 - D.HOPPA - WR 3324                                *00200000
      *                                                                *00210000
      *    ADD CONTROL CARD PROCESSING TO REQUEST WHICH FISCAL YEAR    *00220000
      *    SHOULD BE USED WHEN FORMATTING SHRINK PERCENT SEGMENTS ON   *00230000
      *    THE DEPT/SHRINK DB2 TABLE (TDPTSHK).  ELIMINATING DATE      *00240000
      *    HARDCODING.                                                 *00250000
      *                                                                *00260000
      ******************************************************************00270000
      *                                                                 00280000
      ******************************************************************00290000
      *    06/18/99 - J.SEIDLER - WR                                   *00300000
      *    08/09/99 - J.SEIDLER - WR                                   *00310000
      *                                                                *00320000
      *    REMOVED REFERENCE TO DPG51-SYSTEM-DATE WHICH IS NO  LONGER  *00330000
      *    SUPPORTED BY THE CALENDAR ROUTINE.                          *00340000
      *                                                                *00350000
      ******************************************************************00360000
C14666* CRQ000000014666   07-10-2012     THERESE RAMSEYER              *00370002
C14666*                                                                *00380000
C14666*    MODIFY DECLARE TDPTSHK-CURSOR:                              *00390000
C14666*     TO ALSO SELECT THE FOLLOWING COLUMNS FROM TDPTSHK:         *00400000
C14666*              ,E_BUS_IND                                        *00410000
C14666*              ,SHNK_PCT_CHG_DTE                                 *00420000
C14666*              ,LAST_UPD_BY_USR                                  *00430000
C14666*                                                                *00440000
C14666*     ADD LOGIC TO USE THESE COLUMNS IN Z300-FETCH-DEPT AND      *00450000
C14666*     B200-UPDATE-TDPTSHK.                                       *00460000
C14666*                                                                *00470000
C14666******************************************************************00480000
      *                                                                 00490000
      *                                                                 00500000
       ENVIRONMENT DIVISION.                                            00510000
      *                                                                 00520000
      *                                                                 00530000
       CONFIGURATION SECTION.                                           00540000
                                                                        00550000
       SOURCE-COMPUTER. IBM-3090.                                       00560000
       OBJECT-COMPUTER. IBM-3090.                                       00570000
      *                                                                 00580000
      *                                                                 00590000
       INPUT-OUTPUT SECTION.                                            00600000
                                                                        00610000
       FILE-CONTROL.                                                    00620000
      *                                                                 00630000
           SELECT CONTROL-CARD-FILE       ASSIGN TO INP01.              00640000
      *                                                                 00650000
       DATA DIVISION.                                                   00660000
      *                                                                 00670000
      *                                                                 00680000
       FILE SECTION.                                                    00690000
      *                                                                 00700000
       FD  CONTROL-CARD-FILE                                            00710000
           RECORDING MODE IS F                                          00720000
           LABEL RECORDS STANDARD                                       00730000
           BLOCK CONTAINS 0 RECORDS.                                    00740000
                                                                        00750000
       01  CONTROL-CARD-REC               PIC X(80).                    00760000
      *                                                                 00770000
       EJECT                                                            00780000
      *                                                                 00790000
      *                                                                 00800000
       WORKING-STORAGE SECTION.                                         00810000
                                                                        00820000
      ******************************************************************00830000
      *    FIELDS NECESSARY TO CALL THE SQLCA MESSAGE MODULE.           00840000
      ******************************************************************00850000
                                                                        00860000
           COPY DPWS004.                                                00870000
                                                                        00880000
       01  PC-PROGRAM-CONSTANTS.                                        00890000
           05  PC-CALENDAR-ROUTINE             PIC X(08)                00900000
                                               VALUE 'DPKUT500'.        00910000
           05  PC-CENT-20                      PIC 9(02)   VALUE 20.    00920000
           05  PC-CENT-19                      PIC 9(02)   VALUE 19.    00930000
Y2K        05  PC-YEAR-CUTOFF                  PIC 9(02)   VALUE 80.    00940000
                                                                        00950000
       01  PV-PROGRAM-VARIABLES.                                        00960000
           05  PV-NBR-INSERTS                  PIC 9(09)   VALUE ZEROS. 00970000
           05  PV-NBR-INSERTS-DUPL             PIC 9(09)   VALUE ZEROS. 00980000
           05  PV-PARAGRAPH-NAME               PIC X(30)   VALUE SPACES.00990000
C14666     05  PV-DISP-SHK                     PIC -.9999.              00992000
           05  PV-DB2-OPER-ATTEMPTED           PIC X(30)   VALUE SPACES.01000000
           05  PV-PROGRAM-ID                   PIC X(08)                01010000
                                               VALUE 'INKUP015'.        01020000
           05  PV-PREV-FIS-YEAR-X              PIC X(04)   VALUE ZEROS. 01030000
           05  PV-PREV-FIS-YEAR REDEFINES PV-PREV-FIS-YEAR-X.           01040000
               10  PV-PREV-FIS-CC              PIC 9(02).               01050000
               10  PV-PREV-FIS-YY              PIC 9(02).               01060000
           05  PV-PREV-FIS-YEAR-N REDEFINES PV-PREV-FIS-YEAR-X          01070000
                                               PIC 9(04).               01080000
           05  PV-FIS-YEAR-X                   PIC X(04)   VALUE ZEROS. 01090000
           05  PV-FIS-YEAR REDEFINES PV-FIS-YEAR-X.                     01100000
               10  PV-FIS-CC                   PIC 9(02).               01110000
               10  PV-FIS-YY                   PIC 9(02).               01120000
           05  PV-FIS-YEAR-N REDEFINES PV-FIS-YEAR-X                    01130000
                                               PIC 9(04).               01140000
                                                                        01150000
       01  PS-PROGRAM-SWITCHES.                                         01160000
           05 PS-TABLE-MATCH                   PIC X(01)   VALUE 'N'.   01170000
              88 PS-MATCH                                  VALUE 'Y'.   01180000
              88 PS-NO-MATCH                               VALUE 'N'.   01190000
                                                                        01200000
       01  ABEND-CODE                          PIC S9(04)  VALUE +0     01210000
                                                           COMP SYNC.   01220000
       EJECT                                                            01230000
                                                                        01240000
       01  CC-CONTROL-CARD.                                             01250000
           05  CC-FIS-DATE.                                             01260000
               10  CC-FIS-CCYY.                                         01270000
                   15  CC-FIS-CC               PIC 9(02)   VALUE ZEROS. 01280000
                   15  CC-FIS-YY               PIC 9(02)   VALUE ZEROS. 01290000
               10  CC-FIS-CCYY-N REDEFINES CC-FIS-CCYY                  01300000
                                               PIC 9(04).               01310000
               10  FILLER                      PIC X(01)   VALUE SPACE. 01320000
               10  CC-FIS-MM                   PIC 9(02)   VALUE ZEROS. 01330000
               10  FILLER                      PIC X(01)   VALUE SPACE. 01340000
               10  CC-FIS-DD                   PIC 9(02)   VALUE ZEROS. 01350000
       EJECT                                                            01360000
      ******************************************************************01370000
      *                                                                *01380000
      *   COPY BOOK FOR CALENDAR SUBROUTINE (DPKUT500)                 *01390000
      *                                                                *01400000
      ******************************************************************01410000
                                                                        01420000
           COPY DPWS500.                                                01430000
       EJECT                                                            01440000
      ******************************************************************01450000
      *    APPLICATION AVAILABILITY TABLE                               01460000
      ******************************************************************01470000
                                                                        01480000
           EXEC SQL                                                     01490000
               INCLUDE TAPLAVL                                          01500000
           END-EXEC.                                                    01510000
                                                                        01520000
      ******************************************************************01530000
      *    MERCHANDISE AREA TABLE                                       01540000
      ******************************************************************01550000
                                                                        01560000
           EXEC SQL                                                     01570000
               INCLUDE TMDSEAR                                          01580000
           END-EXEC.                                                    01590000
                                                                        01600000
      ******************************************************************01610000
      *    DEPARTMENT SHRINK TABLE                                      01620000
      ******************************************************************01630000
                                                                        01640000
           EXEC SQL                                                     01650000
               INCLUDE TDPTSHK                                          01660000
           END-EXEC.                                                    01670000
                                                                        01680000
      ******************************************************************01690000
      *    SQL COMMUNICATION AREA                                       01700000
      ******************************************************************01710000
                                                                        01720000
           EXEC SQL                                                     01730000
               INCLUDE SQLCA                                            01740000
           END-EXEC.                                                    01750000
                                                                        01760000
      ***************************************************************** 01770000
      *    SELECT SHRINK DATA FOR ALL AVAILABLE DEPARTMENTS             01780000
      ***************************************************************** 01790000
                                                                        01800000
            EXEC SQL                                                    01810000
                                                                        01820000
               DECLARE TDPTSHK-CURSOR  CURSOR FOR                       01830000
                                                                        01840000
               SELECT  A.MDSEAR_DKEY,                                   01850000
                       A.JAN_SHRINK_PCT                                 01860001
C14666                ,A.E_BUS_IND                                      01870000
C14666                ,A.SHNK_PCT_CHG_DTE                               01880000
C14666                ,A.LAST_UPD_BY_USR                                01890000
               FROM    TDPTSHK A,                                       01900000
                       TMDSEAR B,                                       01910000
                       TAPLAVL C                                        01920000
               WHERE   A.MDSEAR_DKEY      = B.MDSEAR_DKEY               01930000
                   AND B.MDSEAR_DKEY      = C.MDSEAR_DKEY               01940000
                   AND B.MDSELV_CDE       = 'DPT'                       01950000
                   AND B.STRT_DTE        <= CURRENT DATE                01960000
                   AND B.END_DTE         >  CURRENT DATE                01970000
                   AND C.MDSEAR_STRT_DTE <= CURRENT DATE                01980000
                   AND C.MDSEAR_END_DTE  >  CURRENT DATE                01990000
                   AND C.APLSYS_CDE       = 'ML'                        02000000
                   AND A.SHRINK_YR_NBR    = :PV-PREV-FIS-YEAR-X         02010000
               ORDER BY A.MDSEAR_DKEY                                   02020000
                                                                        02030000
            END-EXEC.                                                   02040000
                                                                        02050000
           COPY SQLCA2.                                                 02060000
       EJECT                                                            02070000
      *                                                                 02080000
      *                                                                 02090000
       LINKAGE SECTION.                                                 02100000
                                                                        02110000
      *                                                                 02120000
      *                                                                 02130000
      *                                                                 02140000
       PROCEDURE DIVISION.                                              02150000
                                                                        02160000
                                                                        02170000
       A100-MAIN-MODULE.                                                02180000
      ******************************************************************02190000
      *  INITIALIZATION                                                 02200000
      *  OPEN CURSOR                                                    02210000
      *  FETCH THE FIRST DEPARTMENT                                     02220000
      *  PROCESS ALL DEPARTMENTS                                        02230000
      *  CLOSE CURSOR.                                                  02240000
      *  END-OF-JOB PROCESS                                             02250000
      ******************************************************************02260000
                                                                        02270000
           PERFORM B100-INITIALIZATION.                                 02280000
                                                                        02290000
           PERFORM Z100-OPEN-CURSOR.                                    02300000
                                                                        02310000
           PERFORM Z300-FETCH-DEPT.                                     02320000
                                                                        02330000
           PERFORM B200-UPDATE-TDPTSHK                                  02340000
               UNTIL SQLCODE = +100.                                    02350000
                                                                        02360000
           PERFORM Z200-CLOSE-CURSOR.                                   02370000
                                                                        02380000
           PERFORM Z400-END-OF-JOB-PROCESS.                             02390000
                                                                        02400000
           STOP RUN.                                                    02410000
       EJECT                                                            02420000
       B100-INITIALIZATION.                                             02430000
      ******************************************************************02440000
      *                                                                 02450000
      *   OPEN CONTROL CARD FILE                                        02460000
      *   PROCESS CONTROL CARD RECORD                                   02470000
      *                                                                 02480000
      ******************************************************************02490000
      *     DISPLAY 'B100-INITIALIZATION'.                              02500000
                                                                        02510000
            DISPLAY '*** PROGRAM ' PV-PROGRAM-ID ' BEGIN PROCESSING'    02520000
                ' ***'.                                                 02530000
                                                                        02540000
            PERFORM C110-OPEN-FILES.                                    02550000
                                                                        02560000
            PERFORM C120-PROCESS-CONTROL-CARD.                          02570000
                                                                        02580000
       EJECT                                                            02590000
       B200-UPDATE-TDPTSHK.                                             02600000
      ******************************************************************02610000
      *                                                                 02620000
      *                                                                 02630000
      ******************************************************************02640000
      *     DISPLAY 'B200-UPDATE-TDPTSHK'.                              02650000
                                                                        02660000
            EXEC SQL                                                    02670000
                INSERT INTO TDPTSHK                                     02680000
                    (MDSEAR_DKEY,                                       02690000
                     SHRINK_YR_NBR,                                     02700000
                     CHG_TMST,                                          02710000
                     JAN_SHRINK_PCT,                                    02720000
                     FEB_SHRINK_PCT,                                    02730000
                     MAR_SHRINK_PCT,                                    02740000
                     APR_SHRINK_PCT,                                    02750000
                     MAY_SHRINK_PCT,                                    02760000
                     JUN_SHRINK_PCT,                                    02770000
                     JUL_SHRINK_PCT,                                    02780000
                     AUG_SHRINK_PCT,                                    02790000
                     SEP_SHRINK_PCT,                                    02800000
                     OCT_SHRINK_PCT,                                    02810000
                     NOV_SHRINK_PCT,                                    02820000
C14666               DEC_SHRINK_PCT                                     02830000
C14666              ,E_BUS_IND                                          02840000
C14666              ,SHNK_PCT_CHG_DTE                                   02850000
C14666              ,LAST_UPD_BY_USR)                                   02860000
                VALUES                                                  02870000
                                                                        02880000
                    (:DPTSHK-MDSEAR-DKEY,                               02890000
                     :PV-FIS-YEAR-X,                                    02900000
                     CURRENT TIMESTAMP,                                 02910000
                     :DPTSHK-JAN-SHRINK-PCT,                            02920000
                     :DPTSHK-JAN-SHRINK-PCT,                            02930000
                     :DPTSHK-JAN-SHRINK-PCT,                            02940000
                     :DPTSHK-JAN-SHRINK-PCT,                            02950000
                     :DPTSHK-JAN-SHRINK-PCT,                            02960000
                     :DPTSHK-JAN-SHRINK-PCT,                            02970000
                     :DPTSHK-JAN-SHRINK-PCT,                            02980000
                     :DPTSHK-JAN-SHRINK-PCT,                            02990000
                     :DPTSHK-JAN-SHRINK-PCT,                            03000000
                     :DPTSHK-JAN-SHRINK-PCT,                            03010000
                     :DPTSHK-JAN-SHRINK-PCT,                            03020000
C14666               :DPTSHK-JAN-SHRINK-PCT                             03030000
C14666              ,:DPTSHK-E-BUS-IND                                  03040000
C14666              ,:DPTSHK-SHNK-PCT-CHG-DTE                           03050000
C14666              ,:DPTSHK-LAST-UPD-BY-USR)                           03060000
            END-EXEC.                                                   03070000
                                                                        03080000
            EVALUATE TRUE                                               03090000
                WHEN SQLCODE = +000                                     03100000
C14666              MOVE DPTSHK-JAN-SHRINK-PCT TO PV-DISP-SHK           03100100
C14666              IF DPTSHK-E-BUS-IND = 'N'                           03101000
C14666                    DISPLAY 'B/M  MDSEAR_DKEY: '                  03102600
C14666                                         DPTSHK-MDSEAR-DKEY       03102700
C14666                            '  JAN_SHRINK_PCT: ' PV-DISP-SHK      03102800
C14666              ELSE                                                03120100
C14666                    DISPLAY 'ECOM MDSEAR_DKEY: '                  03120700
C14666                                         DPTSHK-MDSEAR-DKEY       03120800
C14666                            '  JAN_SHRINK_PCT: ' PV-DISP-SHK      03120900
C14666              END-IF                                              03123000
                    ADD 1 TO PV-NBR-INSERTS                             03130000
                WHEN SQLCODE = -803                                     03140000
                    DISPLAY 'MDSEAR_DKEY: ' DPTSHK-MDSEAR-DKEY          03150000
                            '  *** ALREADY EXISTS ***'                  03160000
                    ADD 1 TO PV-NBR-INSERTS-DUPL                        03170000
                WHEN SQLWARN NOT = SPACES                               03180000
                WHEN SQLCODE NOT = ZERO                                 03190000
                    MOVE 'B200-UPDATE-TDPTSHK' TO                       03200000
                         PV-PARAGRAPH-NAME                              03210000
                    MOVE 'INSERT TDPTSHK'      TO                       03220000
                         PV-DB2-OPER-ATTEMPTED                          03230000
                    PERFORM Z999-SQL-ABEND                              03240000
                                                                        03250000
            END-EVALUATE.                                               03260000
                                                                        03270000
           PERFORM Z300-FETCH-DEPT.                                     03280000
                                                                        03290000
       EJECT                                                            03300000
       C110-OPEN-FILES.                                                 03310000
      ******************************************************************03320000
      *                                                                 03330000
      *   OPEN CONTROL CARD FILE                                        03340000
      *                                                                 03350000
      ******************************************************************03360000
      *     DISPLAY 'C110-OPEN-FILES'.                                  03370000
                                                                        03380000
            OPEN INPUT CONTROL-CARD-FILE.                               03390000
                                                                        03400000
       EJECT                                                            03410000
       C120-PROCESS-CONTROL-CARD.                                       03420000
      ******************************************************************03430000
      *                                                                 03440000
      *   PROCESS CONTROL CARD RECORD                                   03450000
      *                                                                 03460000
      ******************************************************************03470000
      *     DISPLAY 'C120-PROCESS-CONTROL-CARD'.                        03480000
                                                                        03490000
            READ CONTROL-CARD-FILE INTO CC-CONTROL-CARD                 03500000
                AT END                                                  03510000
                    DISPLAY PV-PROGRAM-ID ' - CONTROL CARD EMPTY'       03520000
                    MOVE +4003 TO ABEND-CODE                            03530000
                    MOVE 'C120-PROCESS-CONTROL-CARD' TO                 03540000
                         PV-PARAGRAPH-NAME                              03550000
                    PERFORM Z999-ABEND.                                 03560000
                                                                        03570000
            DISPLAY PV-PROGRAM-ID ' CONTROL CARD: ' CC-CONTROL-CARD.    03580000
                                                                        03590000
            SET DPG51-FISCAL-454-CALENDAR   TO TRUE.                    03600000
            SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE.                    03610000
            MOVE ZERO                       TO DPG51-INCR-DECR-DAYS-9   03620000
                                            DPG51-INCR-DECR-BUS-DAYS-9. 03630000
            MOVE CC-FIS-DATE                TO DPG52-LK-DATE-INPUT.     03640000
            SET DPG52-LK-DTE-ISO-FMT        TO TRUE.                    03650000
                                                                        03660000
            PERFORM S100-CALL-CALENDAR-ROUTINE.                         03670000
                                                                        03680000
            MOVE DPG56-FISCAL-YEAR-NBR TO PV-FIS-YY.                    03690000
            IF PV-FIS-YY GREATER PC-YEAR-CUTOFF                         03700000
                MOVE PC-CENT-19 TO PV-FIS-CC                            03710000
            ELSE                                                        03720000
                MOVE PC-CENT-20 TO PV-FIS-CC                            03730000
            END-IF.                                                     03740000
            SUBTRACT 1 FROM PV-FIS-YEAR-N GIVING PV-PREV-FIS-YEAR-N.    03750000
                                                                        03760000
            DISPLAY 'UPDATING DEPT/SHRINK TABLE FOR NEXT FISCAL YEAR = '03770000
                PV-FIS-YEAR-X.                                          03780000
            DISPLAY '    WITH PERIOD 12 SHRINK % FROM FISCAL YEAR = '   03790000
                PV-PREV-FIS-YEAR-X.                                     03800000
            DISPLAY SPACE.                                              03810000
                                                                        03820000
       EJECT                                                            03830000
       S100-CALL-CALENDAR-ROUTINE.                                      03840000
      ******************************************************************03850000
      *                                                                 03860000
      *   CALL THE CALENDAR DATE ROUTINE AND CHECK THE RETURN CODE.     03870000
      *                                                                 03880000
      ******************************************************************03890000
      *     DISPLAY 'S100-CALL-CALENDAR-ROUTINE'.                       03900000
                                                                        03910000
            CALL PC-CALENDAR-ROUTINE USING DPG51                        03920000
                                           DPG52                        03930000
                                           DPG53                        03940000
                                           DPG54                        03950000
                                           DPG55                        03960000
                                           DPG56.                       03970000
                                                                        03980000
            EVALUATE TRUE                                               03990000
                WHEN (DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID)         04000000
                    DISPLAY PV-PROGRAM-ID ' - INVALID CALL TO CALENDAR' 04010000
                        ' ROUTINE'                                      04020000
                    DISPLAY '           ERROR MESSAGE       = '         04030000
                        DPG54-ERROR-MESSAGE                             04040000
                    DISPLAY '           DPG52-LK-DATE-INPUT = '         04050000
                        DPG52-LK-DATE-INPUT                             04060000
                    MOVE +4019 TO ABEND-CODE                            04070000
                    MOVE 'S100-CALL-CALENDAR-ROUTINE' TO                04080000
                         PV-PARAGRAPH-NAME                              04090000
                    PERFORM Z999-ABEND                                  04100000
            END-EVALUATE.                                               04110000
                                                                        04120000
       EJECT                                                            04130000
       Z100-OPEN-CURSOR.                                                04140000
      ******************************************************************04150000
      *                                                                 04160000
      *    OPEN THE DEPARTMENT/SHRINK CURSOR                            04170000
      *                                                                 04180000
      ******************************************************************04190000
      *     DISPLAY 'Z100-OPEN-CURSOR'.                                 04200000
                                                                        04210000
           EXEC SQL                                                     04220000
               OPEN TDPTSHK-CURSOR                                      04230000
           END-EXEC.                                                    04240000
                                                                        04250000
           EVALUATE TRUE                                                04260000
                                                                        04270000
               WHEN SQLCODE = +0                                        04280000
                   CONTINUE                                             04290000
                                                                        04300000
               WHEN OTHER                                               04310000
                   MOVE 'Z100-OPEN-CURSOR'     TO                       04320000
                        PV-PARAGRAPH-NAME                               04330000
                   MOVE 'OPENING TDPTSHK CURSOR' TO                     04340000
                        PV-DB2-OPER-ATTEMPTED                           04350000
                                                                        04360000
                   PERFORM Z999-SQL-ABEND                               04370000
                                                                        04380000
           END-EVALUATE.                                                04390000
       EJECT                                                            04400000
       Z200-CLOSE-CURSOR.                                               04410000
      ******************************************************************04420000
      *                                                                 04430000
      *    CLOSE THE DEPT/SHRINK CURSOR                                 04440000
      *                                                                 04450000
      ******************************************************************04460000
      *     DISPLAY 'Z200-CLOSE-CURSOR'.                                04470000
                                                                        04480000
           EXEC SQL                                                     04490000
               CLOSE TDPTSHK-CURSOR                                     04500000
           END-EXEC.                                                    04510000
                                                                        04520000
           EVALUATE TRUE                                                04530000
                                                                        04540000
               WHEN SQLCODE = +0                                        04550000
                   CONTINUE                                             04560000
                                                                        04570000
               WHEN OTHER                                               04580000
                   MOVE 'Z200-CLOSE-CURSOR'    TO                       04590000
                        PV-PARAGRAPH-NAME                               04600000
                   MOVE 'CLOSING STORE CURSOR' TO                       04610000
                        PV-DB2-OPER-ATTEMPTED                           04620000
                                                                        04630000
                   PERFORM Z999-SQL-ABEND                               04640000
                                                                        04650000
           END-EVALUATE.                                                04660000
       EJECT                                                            04670000
       Z300-FETCH-DEPT.                                                 04680000
      ******************************************************************04690000
      *                                                                 04700000
      *    FETCH A RECORD FROM THE SHRINK/MERCHANDISE AREA/APPL         04710000
      *    AVAILABILITY TABLE.                                          04720000
      *                                                                 04730000
      ******************************************************************04740000
      *     DISPLAY 'Z300-FETCH-DEPT'.                                  04750000
                                                                        04760000
           EXEC SQL                                                     04770000
               FETCH TDPTSHK-CURSOR                                     04780000
               INTO :DPTSHK-MDSEAR-DKEY,                                04790000
                    :DPTSHK-JAN-SHRINK-PCT                              04800000
C14666             ,:DPTSHK-E-BUS-IND                                   04810000
C14666             ,:DPTSHK-SHNK-PCT-CHG-DTE                            04820000
C14666             ,:DPTSHK-LAST-UPD-BY-USR                             04830000
           END-EXEC.                                                    04840000
                                                                        04850000
           EVALUATE TRUE                                                04860000
                                                                        04870000
               WHEN SQLCODE = +0                                        04880000
               WHEN SQLCODE = +100                                      04890000
                   CONTINUE                                             04900000
                                                                        04910000
               WHEN OTHER                                               04920000
                   MOVE 'Z300-FETCH-DEPT' TO                            04930000
                        PV-PARAGRAPH-NAME                               04940000
                   MOVE 'FETCHING A ROW'   TO                           04950000
                        PV-DB2-OPER-ATTEMPTED                           04960000
                                                                        04970000
                   PERFORM Z999-SQL-ABEND                               04980000
                                                                        04990000
           END-EVALUATE.                                                05000000
       EJECT                                                            05010000
                                                                        05020000
       Z400-END-OF-JOB-PROCESS.                                         05030000
      ******************************************************************05040000
      *                                                                 05050000
      *    PERFORM END-OF-JOB PROCESSING - CLOSE ANY OPEN FILES         05060000
      *                                                                 05070000
      ******************************************************************05080000
      *     DISPLAY 'Z400-END-OF-JOB-PROCESS'.                          05090000
                                                                        05100000
            CLOSE CONTROL-CARD-FILE.                                    05110000
                                                                        05120000
            DISPLAY SPACE.                                              05130000
            DISPLAY 'NBR OF SEGMENTS INSERTED           = '             05140000
                PV-NBR-INSERTS.                                         05150000
            DISPLAY 'NBR OF SEGMENTS THAT ALREADY EXIST = '             05160000
                PV-NBR-INSERTS-DUPL.                                    05170000
                                                                        05180000
            DISPLAY '*** PROGRAM ' PV-PROGRAM-ID ' PROCESSING '         05190000
                'COMPLETE ***'.                                         05200000
            DISPLAY SPACE.                                              05210000
                                                                        05220000
       EJECT                                                            05230000
                                                                        05240000
       Z999-ABEND.                                                      05250000
      ******************************************************************05260000
      *                                                                 05270000
      *    ABEND ON A PROGRAM ERROR.                                    05280000
      *                                                                 05290000
      ******************************************************************05300000
                                                                        05310000
           DISPLAY '** ABEND ** IN ' PV-PROGRAM-ID.                     05320000
           DISPLAY 'PARAGRAPH ' PV-PARAGRAPH-NAME.                      05330000
      *    DISPLAY 'OPERATION ' PV-DB2-OPER-ATTEMPTED.                  05340000
                                                                        05350000
           CALL 'ILBOABN0' USING ABEND-CODE.                            05360000
                                                                        05370000
       EJECT                                                            05380000
       Z999-SQL-ABEND.                                                  05390000
      ******************************************************************05400000
      *                                                                 05410000
      *    ABEND ON AN SQL ERROR.                                       05420000
      *                                                                 05430000
      ******************************************************************05440000
                                                                        05450000
           DISPLAY '** ABEND ** IN ' PV-PROGRAM-ID.                     05460000
           DISPLAY 'PARAGRAPH ' PV-PARAGRAPH-NAME.                      05470000
           DISPLAY 'OPERATION ' PV-DB2-OPER-ATTEMPTED.                  05480000
       EJECT                                                            05490000
           COPY DPPD004.                                                05500000
                                                                        05510000
           EXEC SQL                                                     05520000
               COMMIT                                                   05530000
           END-EXEC.                                                    05540000
                                                                        05550000
       EJECT                                                            05560000
