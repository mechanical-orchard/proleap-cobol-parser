000100 IDENTIFICATION DIVISION.                                         00010012
000200                                                                  00020013
000300 PROGRAM-ID.    ETKCS338.                                         00030013
000400 AUTHOR.        TESS BESTE.                                       00040013
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050013
000600 DATE-WRITTEN.  02-09-94.                                         00060013
000700 DATE-COMPILED.                                                   00070013
000800                                                                  00080013
000900*-----------------------------------------------------------------00090013
001000*          E338 - UPC CATALOG VENDOR ID LIST PROGRAM              00100013
001100*                                                                 00110013
001200* THIS PROGRAM GENERATES A LIST OF UPC CATALOG VENDORS. FOR EACH  00120013
001300* VENDOR, IT LISTS THE PRIMARY VENDOR NAME, VENDOR ID, NETWORK ID,00130013
001400* AND PREFERRED NETWORK INDICATOR. THE LIST IS IN VENDOR NAME     00140013
001500* SEQUENCE. THE UPDATE OR DELETE FUNCTION CAN BE INVOKED BY       00150013
001600* SELECTING ONE OR MORE ITEMS AND PRESSING THE UPDATE OR DELETE   00160013
001700* FUNCTION KEY.                                                   00170013
001800*-----------------------------------------------------------------00180013
001900* APRIL 1996 ..ADDED NRF COMPLIANT INDICATOR TO SCREEN. UPDATE    00190013
001910* ALLOWED AS WELL.                                                00191013
001920*-----------------------------------------------------------------00192013
001921* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00192114
001922*            - CHANGE CALL OF DPKUT100 TO                       * 00192214
001923*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00192314
001924*              MAKING THE CALL DYNAMIC VS STATIC                * 00192414
001925*                                                               * 00192514
001926*---------------------------------------------------------------* 00192614
CICS  *  CHANGED 10/28/2022    BY BARB SCHULTZ    WR: CHG0277210      * 00192715
CICS  *                                                               * 00192815
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00192915
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00193015
CICS  *---------------------------------------------------------------* 00193215
001930                                                                  00193315
001940                                                                  00194013
001950 ENVIRONMENT DIVISION.                                            00195013
001960                                                                  00196013
001970 DATA DIVISION.                                                   00197013
001980                                                                  00198013
001990 WORKING-STORAGE SECTION.                                         00199013
002000                                                                  00200013
002100 01  PC-PROGRAM-CONSTANTS.                                        00210013
002200     05  PC-CURRENT-MAP-NAME          PIC  X(08)    VALUE         00220013
002300                                                         'ET338A'.00230013
002400     05  PC-CURRENT-MAPSET-NAME       PIC  X(08)    VALUE         00240013
002500                                                        'ETKM338'.00250013
002600     05  PC-CURRENT-PROGRAM-NAME      PIC  X(08)    VALUE         00260013
002700                                                       'ETKCS338'.00270013
002800     05  PC-LIST-QUEUE-SEQ            PIC  9        VALUE 1.      00280013
002900     05  PC-SEL-QUEUE-SEQ             PIC  9        VALUE 2.      00290013
003000     05  PC-ITEMS-PER-PANEL           PIC S9(4)     COMP SYNC     00300013
003100                                                    VALUE +12.    00310013
003200     05  PC-MAX-BLOCKS-IN-ARRAY       PIC S9(4)     COMP SYNC     00320013
003300                                                    VALUE +2.     00330013
003400     05  PC-MAX-ITEMS                 PIC S9(9)     COMP-3        00340013
003500                                                    VALUE         00350013
003600                                                         +1000000.00360013
003700     05  PC-ITEM-NUMBER-LENGTH        PIC S9(4)     COMP SYNC     00370013
003800                                                    VALUE +7.     00380013
003900     05  PC-INQ                       PIC  X(3)     VALUE 'INQ'.  00390013
004000     05  PC-UPD                       PIC  X(3)     VALUE 'UPD'.  00400013
004100     05  PC-DEL                       PIC  X(3)     VALUE 'DEL'.  00410013
004200                                                                  00420013
004300     05  PC-TSYMSG-NUMBERS.                                       00430013
004400         10  PC-TSYMSG-00005          PIC  9(5)     VALUE 00005.  00440013
004500         10  PC-TSYMSG-00008          PIC  9(5)     VALUE 00008.  00450013
004600         10  PC-TSYMSG-00050          PIC  9(5)     VALUE 00050.  00460013
004700         10  PC-TSYMSG-00051          PIC  9(5)     VALUE 00051.  00470013
004800         10  PC-TSYMSG-00052          PIC  9(5)     VALUE 00052.  00480013
004900         10  PC-TSYMSG-00053          PIC  9(5)     VALUE 00053.  00490013
005000         10  PC-TSYMSG-00054          PIC  9(5)     VALUE 00054.  00500013
005100         10  PC-TSYMSG-00055          PIC  9(5)     VALUE 00055.  00510013
005200         10  PC-TSYMSG-00057          PIC  9(5)     VALUE 00057.  00520013
005300         10  PC-TSYMSG-00069          PIC  9(5)     VALUE 00069.  00530013
005400         10  PC-TSYMSG-00070          PIC  9(5)     VALUE 00070.  00540013
005500         10  PC-TSYMSG-00101          PIC  9(5)     VALUE 00101.  00550013
005600         10  PC-TSYMSG-00279          PIC  9(5)     VALUE 00279.  00560013
005700         10  PC-TSYMSG-00551          PIC  9(5)     VALUE 00551.  00570013
005800     05  PC-TYPE-CDE-PRIMARY          PIC  X(2)     VALUE '01'.   00580013
005900                                                                  00590013
006000 01  PS-PROGRAM-SWITCHES.                                         00600013
006100     05  PS-ERROR-SW                  PIC  X        VALUE 'Y'.    00610013
006200         88  PS-NO-ERROR                            VALUE 'Y'.    00620013
006300         88  PS-ERROR                               VALUE 'N'.    00630013
006400     05  PS-START-ITEM-ERROR-SW       PIC  X        VALUE 'Y'.    00640013
006500         88  PS-NO-START-ITEM-ERROR                 VALUE 'Y'.    00650013
006600         88  PS-START-ITEM-ERROR                    VALUE 'N'.    00660013
006700                                                                  00670013
006800 01  PV-PROGRAM-VARIABLES.                                        00680013
006900     05  PV-SUB                       PIC S9(4)     COMP SYNC     00690013
007000                                                    VALUE +0.     00700013
007100     05  PV-REMAINDER                 PIC S9(4)     COMP SYNC     00710013
007200                                                    VALUE +0.     00720013
007300     05  PV-READ-COUNT                PIC S9(9)     COMP-3        00730013
007400                                                    VALUE +0.     00740013
007500     05  PV-ITEMS-PROCESSED           PIC S9(9)     COMP-3        00750013
007600                                                    VALUE +0.     00760013
007700     05  PV-HOLD-SELECTED-ITEMS       PIC S9(9)     COMP-3        00770013
007800                                                    VALUE +0.     00780013
007900     05  PV-ITEM-IN-USE               PIC S9(9)     COMP-3        00790013
008000                                                    VALUE +0.     00800013
008100     05  PV-TOP-ITEM                  PIC S9(9)     COMP-3        00810013
008200                                                    VALUE +0.     00820013
008300     05  PV-BOTTOM-ITEM               PIC S9(9)     COMP-3        00830013
008400                                                    VALUE +0.     00840013
008500     05  PV-TEMP-BLOCK-NUMBER         PIC S9(9)     COMP-3        00850013
008600                                                    VALUE +0.     00860013
008700     05  PV-BLOCK-NUMBER              PIC S9(4)     COMP SYNC     00870013
008800                                                    VALUE +0.     00880013
008900     05  PV-CICS-RESP                 PIC S9(4)     COMP SYNC     00890013
009000                                                    VALUE +0.     00900013
009100     05  PV-ITEM                      PIC S9(4)     COMP SYNC     00910013
009200                                                    VALUE +0.     00920013
009300     05  PV-SEL-QUEUE-ITEM            PIC S9(4)     COMP SYNC     00930013
009400                                                    VALUE +0.     00940013
009500     05  PV-SAVE-ITEM                 PIC S9(4)     COMP SYNC     00950013
009600                                                    VALUE +0.     00960013
009700     05  PV-HIGHEST-BLOCK-WRITTEN     PIC S9(4)     COMP SYNC     00970013
009800                                                    VALUE +0.     00980013
009900     05  PV-LIST-ITEM-NUMBER          PIC S9(4)     COMP SYNC     00990013
010000                                                    VALUE +0.     01000013
010100     05  PV-FIRST-BLOCK-IN-ARRAY      PIC S9(4)     COMP SYNC     01010013
010200                                                    VALUE +0.     01020013
010300     05  PV-NEXT-BLOCK-IN-ARRAY       PIC S9(4)     COMP SYNC     01030013
010400                                                    VALUE +0.     01040013
010500     05  PV-PREV-BLOCK-IN-ARRAY       PIC S9(4)     COMP SYNC     01050013
010600                                                    VALUE +0.     01060013
010700     05  PV-FIRST-BLOCK-IN-RANGE      PIC S9(4)     COMP SYNC     01070013
010800                                                    VALUE +0.     01080013
010900     05  PV-LAST-BLOCK-IN-RANGE       PIC S9(4)     COMP SYNC     01090013
011000                                                    VALUE +0.     01100013
011100     05  PV-START-OF-SELECTED-RANGE   PIC S9(4)     COMP SYNC     01110013
011200                                                    VALUE +0.     01120013
011300     05  PV-END-OF-SELECTED-RANGE     PIC S9(4)     COMP SYNC     01130013
011400                                                    VALUE +0.     01140013
011500                                                                  01150013
011600*-----------------------------------------------------------------01160013
011700* THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE. THERE 01170013
011800* MUST BE A BLOCK IN THE APPLICATION SPECIFIC COMMAREA WITH AN    01180013
011900* IDENTICAL LAYOUT.                                               01190013
012000*-----------------------------------------------------------------01200013
012100 01  LQW-LIST-QUEUE-WORK-AREA.                                    01210013
012200     05  LQW-BLOCK-MODIFIED           PIC  X(01)    VALUE SPACE.  01220013
012300     05  LQW-ITEM-ENTRIES             OCCURS 12 TIMES             01230013
012400                                      INDEXED BY LQW-IDX.         01240013
012500         10  LQW-LIST-ITEM-NUMBER     PIC S9(9)     COMP-3.       01250013
012600         10  LQW-TEMP-SELECTED-SW     PIC  X.                     01260013
012700         10  LQW-SELECTED-SW          PIC  X.                     01270013
012800             88  LQW-SELECT                         VALUE 'S'.    01280013
012900             88  LQW-DESELECT                       VALUE SPACE.  01290013
013000         10  LQW-ACTION               PIC  X(3).                  01300013
013100         10  LQW-NETWORK-ID           PIC  X.                     01310013
013200         10  LQW-ENT-ID               PIC  S9(09)   COMP.         01320013
013300         10  LQW-VENDOR-ID            PIC  X(15).                 01330013
013400         10  LQW-PREFERRED-IND        PIC  X.                     01340013
013500         10  LQW-NRFCOMP-IND          PIC  X.                     01350013
013600         10  LQW-VENDOR-NAME          PIC  X(30).                 01360013
013700         10  LQW-NETWORK-NAME         PIC  X(15).                 01370013
013800                                                                  01380013
013900*---------------------------------------------------------------* 01390013
014000*  RECORD LAYOUT FOR THE SELECTED ITEMS TEMP STORAGE QUEUE.     * 01400013
014100*---------------------------------------------------------------* 01410013
014200     COPY ETWS301.                                                01420013
014300                                                                  01430013
014400*---------------------------------------------------------------* 01440013
014500*    MAP LAYOUT                                                 * 01450013
014600*---------------------------------------------------------------* 01460013
014700     COPY ETKM338.                                                01470013
014800                                                                  01480013
014900 01  MR-MAP-REDEFINITION              REDEFINES ET338AO.          01490013
015000     05  FILLER                       PIC X(48).                  01500013
015100     05  MR-SCROLL-AREA               OCCURS 12 TIMES.            01510013
015200         10  MR-SELECTL               PIC S9(04)    COMP.         01520013
015300         10  MR-SELECTA               PIC  X.                     01530013
015400         10  MR-SELECTC               PIC  X.                     01540013
015500         10  MR-SELECTH               PIC  X.                     01550013
015600         10  MR-SELECTI               PIC  X.                     01560013
015700                                                                  01570013
015800         10  MR-ACTIONL               PIC S9(04)    COMP.         01580013
015900         10  MR-ACTIONA               PIC  X.                     01590013
016000         10  MR-ACTIONC               PIC  X.                     01600013
016100         10  MR-ACTIONH               PIC  X.                     01610013
016200         10  MR-ACTION                PIC  X(3).                  01620013
016300                                                                  01630013
016400         10  MR-VENDOR-NAMEL          PIC S9(04)    COMP.         01640013
016500         10  MR-VENDOR-NAMEA          PIC  X.                     01650013
016600         10  MR-VENDOR-NAMEC          PIC  X.                     01660013
016700         10  MR-VENDOR-NAMEH          PIC  X.                     01670013
016800         10  MR-VENDOR-NAME           PIC  X(26).                 01680013
016900                                                                  01690013
017000         10  MR-VENDOR-IDL            PIC S9(04)    COMP.         01700013
017100         10  MR-VENDOR-IDA            PIC  X.                     01710013
017200         10  MR-VENDOR-IDC            PIC  X.                     01720013
017300         10  MR-VENDOR-IDH            PIC  X.                     01730013
017400         10  MR-VENDOR-ID             PIC  X(15).                 01740013
017500                                                                  01750013
017600         10  MR-NETWORK-NAMEL         PIC S9(04)    COMP.         01760013
017700         10  MR-NETWORK-NAMEA         PIC  X.                     01770013
017800         10  MR-NETWORK-NAMEC         PIC  X.                     01780013
017900         10  MR-NETWORK-NAMEH         PIC  X.                     01790013
018000         10  MR-NETWORK-NAME          PIC  X(15).                 01800013
018100                                                                  01810013
018200         10  MR-PREFERRED-INDL        PIC S9(04)    COMP.         01820013
018300         10  MR-PREFERRED-INDA        PIC  X.                     01830013
018400         10  MR-PREFERRED-INDC        PIC  X.                     01840013
018500         10  MR-PREFERRED-INDH        PIC  X.                     01850013
018600         10  MR-PREFERRED-IND         PIC  X.                     01860013
018700                                                                  01870013
018800         10  MR-NRFCOMP-INDL          PIC S9(04)    COMP.         01880013
018900         10  MR-NRFCOMP-INDA          PIC  X.                     01890013
019000         10  MR-NRFCOMP-INDC          PIC  X.                     01900013
019100         10  MR-NRFCOMP-INDH          PIC  X.                     01910013
019200         10  MR-NRFCOMP-IND           PIC  X.                     01920013
019300                                                                  01930013
019400*---------------------------------------------------------------* 01940013
019500*    ATTRIBUTE SETTINGS COPYBOOK.                               * 01950013
019600*---------------------------------------------------------------* 01960013
019700     COPY DPWS015.                                                01970013
019800                                                                  01980013
019900*---------------------------------------------------------------* 01990013
020000*    FUNCTION KEYS COPYBOOK.                                    * 02000013
020100*---------------------------------------------------------------* 02010013
020200     COPY DPWS016.                                                02020013
020300                                                                  02030013
020400*---------------------------------------------------------------* 02040013
020500*    NUMERIC EDIT LAYOUT.                                       * 02050013
020600*---------------------------------------------------------------* 02060013
020700     COPY DPWS010I.                                               02070013
020800                                                                  02080013
020900*---------------------------------------------------------------* 02090013
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02100015
021100*---------------------------------------------------------------* 02110013
021200     COPY DPWS030.                                                02120013
CICS       COPY DPWS930.                                                02121015
021300                                                                  02130013
021400*---------------------------------------------------------------* 02140013
021500*    STANDARD COMMAREA.                                         * 02150013
021600*---------------------------------------------------------------* 02160013
021700     COPY DPWS020.                                                02170013
021800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02180013
021900                                                                  02190013
022000*---------------------------------------------------------------* 02200013
022100*  INTER-APPLICATION COMMAREA FOR THE NETWORK SCREENS.            02210013
022200*---------------------------------------------------------------* 02220013
022300         10  INTER-APPL-COMM-AREA       PIC X(200).               02230013
022400     COPY ETWS300.                                                02240013
022500                                                                  02250013
022600*---------------------------------------------------------------* 02260013
022700*  APPLICATION-SPECIFIC COMMAREA.                                 02270013
022800*---------------------------------------------------------------* 02280013
022900         10  ASC-SPECIFIC-COMMAREA.                               02290013
023000             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02300013
023100                 20  ASC-BLOCK-MODIFIED-SW                        02310013
023200                                      PIC  X.                     02320013
023300                     88  ASC-BLOCK-NOT-MODIFIED     VALUE 'N'.    02330013
023400                     88  ASC-BLOCK-MODIFIED         VALUE 'Y'.    02340013
023500                                                                  02350013
023600                 20  ASC-ITEM-ARRAY.                              02360013
023700                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        02370013
023800                         30  ASC-LIST-ITEM-NUMBER                 02380013
023900                                      PIC S9(9)     COMP-3.       02390013
024000                         30  ASC-TEMP-SELECTED-SW                 02400013
024100                                      PIC X.                      02410013
024200                             88  ASC-VALID-SELECT   VALUE SPACE   02420013
024300                                                          'S'     02430013
024400                                                          'B'     02440013
024500                                                          'E'.    02450013
024600                             88  ASC-TEMP-NO-SELECT VALUE SPACE.  02460013
024700                             88  ASC-TEMP-SELECT    VALUE 'S'.    02470013
024800                             88  ASC-TEMP-BEGIN     VALUE 'B'.    02480013
024900                             88  ASC-TEMP-END       VALUE 'E'.    02490013
025000                         30  ASC-SELECTED-SW                      02500013
025100                                      PIC X.                      02510013
025200                             88  ASC-NO-SELECT      VALUE SPACE.  02520013
025300                             88  ASC-SELECT         VALUE 'S'.    02530013
025400                             88  ASC-BEGIN          VALUE 'B'.    02540013
025500                             88  ASC-END            VALUE 'E'.    02550013
025600                         30  ASC-ACTION                           02560013
025700                                      PIC  X(3).                  02570013
025800                         30  ASC-NETWORK-ID                       02580013
025900                                      PIC  X.                     02590013
026000                         30  ASC-ENT-ID                           02600013
026100                                      PIC  S9(09)   COMP.         02610013
026200                         30  ASC-VENDOR-ID                        02620013
026300                                      PIC  X(15).                 02630013
026400                         30  ASC-PREFERRED-IND                    02640013
026500                                      PIC X.                      02650013
026600                         30  ASC-NRFCOMP-IND                      02660013
026700                                      PIC X.                      02670013
026800                         30  ASC-VENDOR-NAME                      02680013
026900                                      PIC  X(30).                 02690013
027000                         30  ASC-NETWORK-NAME                     02700013
027100                                      PIC  X(15).                 02710013
027200             15  ASC-BLK-SUB          PIC S9(4)     COMP SYNC.    02720013
027300             15  ASC-ITEM-SUB         PIC S9(4)     COMP SYNC.    02730013
027400             15  ASC-NUMBER-OF-ITEMS-READ                         02740013
027500                                      PIC S9(9)     COMP-3.       02750013
027600             15  ASC-NUMBER-OF-SELECTED-ITEMS                     02760013
027700                                      PIC S9(9)     COMP-3.       02770013
027800             15  ASC-ITEMS-DISPLAYED  PIC S9(3)     COMP-3.       02780013
027900             15  ASC-ITEM-AT-TOP-OF-PANEL                         02790013
028000                                      PIC S9(9)     COMP-3.       02800013
028100             15  ASC-ITEM-AT-BOT-OF-PANEL                         02810013
028200                                      PIC S9(9)     COMP-3.       02820013
028300             15  ASC-HIGHEST-BLOCK-WRITTEN                        02830013
028400                                      PIC S9(4)     COMP SYNC.    02840013
028500             15  ASC-START-OF-SELECTED-RANGE                      02850013
028600                                      PIC S9(9)     COMP-3.       02860013
028700             15  ASC-END-OF-SELECTED-RANGE                        02870013
028800                                      PIC S9(9)     COMP-3.       02880013
028900             15  ASC-ITEMS-LEFT-INDICATOR                         02890013
029000                                      PIC X.                      02900013
029100                 88  ASC-ITEMS-LEFT-ON-DB           VALUE 'Y'.    02910013
029200                 88  ASC-NO-ITEMS-LEFT-ON-DB        VALUE 'N'.    02920013
029300             15  ASC-TEMP-QUEUE-UPDATE-SW                         02930013
029400                                      PIC X.                      02940013
029500                 88  ASC-UPDATE-TSQ                 VALUE 'Y'.    02950013
029600                 88  ASC-NO-TSQ-UPDATE              VALUE SPACE.  02960013
029700             15  ASC-LIST-QUEUE-NAME.                             02970013
029800                 20  ASC-LIST-TERM-ID PIC  X(4).                  02980013
029900                 20  ASC-LIST-TASK-NUMBER                         02990013
030000                                      PIC S9(5)     COMP-3.       03000013
030100                 20  ASC-LIST-SEQ     PIC  9.                     03010013
030200             15  ASC-SEL-QUEUE-NAME.                              03020013
030300                 20  ASC-SEL-TERM-ID  PIC  X(4).                  03030013
030400                 20  ASC-SEL-TASK-NUMBER                          03040013
030500                                      PIC S9(5)     COMP-3.       03050013
030600                 20  ASC-SEL-SEQ      PIC  9.                     03060013
030700             15  ASC-START-ITEM-REQUEST.                          03070013
030800                 20  ASC-START-ITEM-REQUEST-N                     03080013
030900                                      PIC  9(7).                  03090013
031000         10  FILLER                   PIC  X(951).                03100013
031100                                                                  03110013
031200*---------------------------------------------------------------* 03120013
031300*    ABEND PROCESSING COPYBOOK.                                 * 03130013
031400*---------------------------------------------------------------* 03140013
031500     COPY DPWS013.                                                03150013
031600                                                                  03160013
031700*---------------------------------------------------------------* 03170013
031800*    DB2 AREA FOR NETWORK VENDOR TABLE                            03180013
031900*---------------------------------------------------------------* 03190013
032000     EXEC SQL                                                     03200013
032100          INCLUDE TNETVND                                         03210013
032200     END-EXEC.                                                    03220013
032300                                                                  03230013
032400*---------------------------------------------------------------* 03240013
032500*    DB2 AREA FOR NETWORK TABLE                                   03250013
032600*---------------------------------------------------------------* 03260013
032700     EXEC SQL                                                     03270013
032800          INCLUDE TNETWRK                                         03280013
032900     END-EXEC.                                                    03290013
033000                                                                  03300013
033100*---------------------------------------------------------------* 03310013
033200*    DB2 AREA FOR ENT NAME TABLE                                  03320013
033300*---------------------------------------------------------------* 03330013
033400     EXEC SQL                                                     03340013
033500          INCLUDE TENTNME                                         03350013
033600     END-EXEC.                                                    03360013
033700                                                                  03370013
033800*---------------------------------------------------------------* 03380013
033900*    DB2 AREA FOR COMMUNICATIONS                                * 03390013
034000*---------------------------------------------------------------* 03400013
034100     EXEC SQL                                                     03410013
034200          INCLUDE SQLCA                                           03420013
034300     END-EXEC.                                                    03430013
034400                                                                  03440013
034500*---------------------------------------------------------------* 03450013
034600*    NETWORK VENDOR CURSOR. SELECT ALL VENDORS, JOINING WITH    * 03460013
034700*    TENTNME TO GET THE PRIMARY VENDOR NAME AND TNETWRK TO GET  * 03470013
034800*    THE NETWORK NAME. ORDER BY VENDOR NAME.                    * 03480013
034900*---------------------------------------------------------------* 03490013
035000     EXEC SQL                                                     03500013
035100         DECLARE  TNETVND-CSR CURSOR FOR                          03510013
035200         SELECT   A.NETWK_ID                                      03520013
035300                , A.ENT_ID                                        03530013
035400                , A.UPC_CAT_VEND_ID                               03540013
035500                , A.PREF_NETWK_SW_IND                             03550013
035600                , A.NRF_CMPLIT_IND                                03560013
035700                , B.ENT_NAME_DESC                                 03570013
035800                , C.NETWK_NME                                     03580013
035900         FROM     TNETVND A                                       03590013
036000                , TENTNME B                                       03600013
036100                , TNETWRK C                                       03610013
036200         WHERE A.ENT_ID = B.ENT_ID                                03620013
036300           AND B.TYPE_CDE = :PC-TYPE-CDE-PRIMARY                  03630013
036400           AND A.NETWK_ID = C.NETWK_ID                            03640013
036500         ORDER BY B.ENT_NAME_DESC                                 03650013
036600     END-EXEC.                                                    03660013
036700                                                                  03670013
036800                                                                  03680013
036900 LINKAGE SECTION.                                                 03690013
037000                                                                  03700013
037100 01  DFHCOMMAREA.                                                 03710013
037200     05  FILLER                         OCCURS  1 TO 4072 TIMES   03720013
037300                                        DEPENDING ON EIBCALEN.    03730013
037400         10  FILLER                     PIC X.                    03740013
037500 EJECT                                                            03750013
037600 PROCEDURE DIVISION.                                              03760013
037700                                                                  03770013
037800*-----------------------------------------------------------------03780013
037900* THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.     03790013
038000* CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM PROCESSING, 03800013
038100* AND CALL THE CICS ARCHITECTURE API TO EXIT.                     03810013
038200*-----------------------------------------------------------------03820013
038300 0000-MAIN-MODULE.                                                03830013
038400                                                                  03840013
038500     INITIALIZE DP030-CICS-API-FIELDS.                            03850013
038600     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03860013
038700     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03870013
038800     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03880013
038900     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03890013
039000     MOVE LENGTH OF ET338AI        TO DP030-MAP-LENGTH (1).       03900013
039100     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03910013
039200     PERFORM 0001-CALL-CICS-ARCH-API.                             03920013
039300                                                                  03930013
039400     PERFORM 1000-CONTROL-PROCESSING                              03940013
039500                                                                  03950013
039600     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03960013
039700     PERFORM 0001-CALL-CICS-ARCH-API.                             03970013
039800                                                                  03980013
039900                                                                  03990013
040000*-----------------------------------------------------------------04000013
040100* THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE. IT   04010013
040200* WILL ABEND IF ANY ERRORS OCCUR IN THAT CALL.                    04020013
040300*-----------------------------------------------------------------04030013
040400 0001-CALL-CICS-ARCH-API.                                         04040013
040500                                                                  04050013
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04060015
040700                                    DFHCOMMAREA                   04070015
040800                                    DP030-CICS-API-FIELDS         04080015
040900                                    DP020-STANDARD-COMMAREA       04090015
041000                                    ET338AI.                      04100015
041100                                                                  04110013
041200     IF  DP030-RC-CALL-SUCCESSFUL                                 04120013
041300         CONTINUE                                                 04130013
041400     ELSE                                                         04140013
041500         SET DP013-NO-ROLLBACK                                    04150013
041600             DP013-XCTL-DISPLAY-RESTART                           04160013
041700             DP013-CICS-ABEND      TO TRUE                        04170013
041800         MOVE '0001-CALL-CICS-ARCH-API'                           04180013
041900                                   TO DP013-PARAGRAPH             04190013
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04200015
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04210015
042200         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04220013
042300         PERFORM DP013-0000-PROCESS-ABEND                         04230013
042400     END-IF.                                                      04240013
042500                                                                  04250013
042600*-----------------------------------------------------------------04260013
042700* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04270013
042800* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04280013
042900*                                                                *04290013
043000* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04300013
043100*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04310013
043200*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04320013
043300*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04330013
043400*-----------------------------------------------------------------04340013
043500 1000-CONTROL-PROCESSING.                                         04350013
043600                                                                  04360013
043700     EVALUATE TRUE                                                04370013
043800         WHEN DP020-NEXT-ACT-INITIAL                              04380013
043900             INITIALIZE ASC-SPECIFIC-COMMAREA                     04390013
044000             MOVE EIBTRMID              TO ASC-LIST-TERM-ID       04400013
044100                                           ASC-SEL-TERM-ID        04410013
044200             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   04420013
044300                                           ASC-SEL-TASK-NUMBER    04430013
044400             MOVE PC-LIST-QUEUE-SEQ     TO ASC-LIST-SEQ           04440013
044500             MOVE PC-SEL-QUEUE-SEQ      TO ASC-SEL-SEQ            04450013
044600             MOVE SPACE                 TO ASC-START-ITEM-REQUEST 04460013
044700             PERFORM 4000-BUILD-INITIAL-PANEL                     04470013
044800                                                                  04480013
044900         WHEN DP020-NEXT-ACT-READ-MAP                             04490013
045000             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         04500013
045100             PERFORM 2000-PROCESS-PANEL                           04510013
045200                                                                  04520013
045300         WHEN DP020-NEXT-ACT-RETURN                               04530013
045400             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04540013
045500                                   TO PV-TOP-ITEM                 04550013
045600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    04560013
045700             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 04570013
045800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04580013
045900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04590013
046000                                                                  04600013
046100         WHEN OTHER                                               04610013
046200             SET DP013-LOGIC-ABEND                                04620013
046300                 DP013-NO-ROLLBACK TO TRUE                        04630013
046400             MOVE '1000-CONTROL-PROCESSING'                       04640013
046500                                   TO DP013-PARAGRAPH             04650013
046600             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    04660013
046700                                   TO DP013-MESSAGE-TEXT(1)       04670013
046800             PERFORM DP013-0000-PROCESS-ABEND                     04680013
046900     END-EVALUATE.                                                04690013
047000                                                                  04700013
047100                                                                  04710013
047200*-----------------------------------------------------------------04720013
047300* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04730013
047400* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04740013
047500* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04750013
047600* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *04760013
047700* FUNCTION KEYS CAN GET THIS FAR.                                *04770013
047800*-----------------------------------------------------------------04780013
047900 2000-PROCESS-PANEL.                                              04790013
048000                                                                  04800013
048100     EVALUATE TRUE                                                04810013
048200         WHEN DP020-SRC-AID = DP016-CLEAR                         04820013
048300             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    04830013
048400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04840013
048500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04850013
048600                                                                  04860013
048700         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    04870013
048800             PERFORM 2050-DELETE-LIST-QUEUE                       04880013
048900             PERFORM 4000-BUILD-INITIAL-PANEL                     04890013
049000                                                                  04900013
049100         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    04910013
049200             PERFORM 2140-DESELECT-ALL-ITEMS                      04920013
049300             PERFORM 3200-RESET-ATTRIBUTES                        04930013
049400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04940013
049500                                                                  04950013
049600         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  04960013
049700             PERFORM 2150-SELECT-ALL-ITEMS                        04970013
049800             PERFORM 3200-RESET-ATTRIBUTES                        04980013
049900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04990013
050000                                                                  05000013
050100         WHEN DP020-FK-GO-TO-TRAN (DP020-SRC-AID)                 05010013
050200             CONTINUE                                             05020013
050300                                                                  05030013
050400         WHEN OTHER                                               05040013
050500             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05050013
050600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05060013
050700             IF  PS-NO-ERROR                                      05070013
050800                 SET DP030-CONTINUE-GO TO TRUE                    05080013
050900                 PERFORM 2100-CHECK-FUNCTION-KEY                  05090013
051000             ELSE                                                 05100013
051100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05110013
051200                 SET DP030-OVERRIDE-GO TO TRUE                    05120013
051300             END-IF                                               05130013
051400     END-EVALUATE.                                                05140013
051500                                                                  05150013
051600                                                                  05160013
051700*-----------------------------------------------------------------05170013
051800*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *05180013
051900*-----------------------------------------------------------------05190013
052000 2050-DELETE-LIST-QUEUE.                                          05200013
052100                                                                  05210013
052200     EXEC CICS                                                    05220013
052300         DELETEQ TS                                               05230013
052400             QUEUE (ASC-LIST-QUEUE-NAME)                          05240013
052500             RESP  (PV-CICS-RESP)                                 05250013
052600     END-EXEC.                                                    05260013
052700                                                                  05270013
052800     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       05280013
052900        (PV-CICS-RESP = DFHRESP(QIDERR))                          05290013
053000         CONTINUE                                                 05300013
053100     ELSE                                                         05310013
053200         SET DP013-CICS-ABEND                                     05320013
053300             DP013-NO-ROLLBACK     TO TRUE                        05330013
053400                                                                  05340013
053500         MOVE '2050-DELETE-LIST-QUEUE'                            05350013
053600                                   TO DP013-PARAGRAPH             05360013
053700         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    05370013
053800                                   TO DP013-MESSAGE-TEXT (1)      05380013
053900         PERFORM DP013-0000-PROCESS-ABEND                         05390013
054000     END-IF.                                                      05400013
054100                                                                  05410013
054200     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  05420013
054300                                                                  05430013
054400                                                                  05440013
054500*-----------------------------------------------------------------05450013
054600* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*05460013
054700* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *05470013
054800* CICS ARCHITECTURE API.                                         *05480013
054900*-----------------------------------------------------------------05490013
055000 2100-CHECK-FUNCTION-KEY.                                         05500013
055100                                                                  05510013
055200     EVALUATE TRUE                                                05520013
055300         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 05530013
055400             IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO               05540013
055500                 INITIALIZE ET300-NUMBER-OF-TS-ITEMS              05550013
055600                            ET300-SEL-QUEUE-NAME                  05560013
055700                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                05570013
055800                                TO ET300-NBR-SELECTED-ITEMS       05580013
055900                 PERFORM 5000-PREPARE-SEL-QUEUE                   05590013
056000             ELSE                                                 05600013
056100                 SET DP030-OVERRIDE-GO TO TRUE                    05610013
056200*                ---- A LIST ITEM MUST BE SELECTED ----           05620013
056300                 MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER        05630013
056400                 SET DP020-MSG-WARNING TO TRUE                    05640013
056500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05650013
056600             END-IF                                               05660013
056700                                                                  05670013
056800         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  05680013
056900             MOVE +1               TO PV-TOP-ITEM                 05690013
057000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05700013
057100                                                                  05710013
057200         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   05720013
057300             PERFORM 2110-BROWSE-BACKWARD                         05730013
057400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05740013
057500                                                                  05750013
057600         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   05760013
057700             PERFORM 2120-BROWSE-FORWARD                          05770013
057800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05780013
057900                                                                  05790013
058000         WHEN DP020-SRC-AID = DP016-ENTER                         05800013
058100             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   05810013
058200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05820013
058300                                                                  05830013
058400         WHEN OTHER                                               05840013
058500             SET DP013-NO-ROLLBACK                                05850013
058600                 DP013-XCTL-DISPLAY-RESTART                       05860013
058700                 DP013-CICS-ABEND  TO TRUE                        05870013
058800             MOVE '2100-CHECK-FUNCTION-KEY'                       05880013
058900                                   TO DP013-PARAGRAPH             05890013
059000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05900013
059100                                   TO DP013-MESSAGE-TEXT (1)      05910013
059200             PERFORM DP013-0000-PROCESS-ABEND                     05920013
059300     END-EVALUATE.                                                05930013
059400                                                                  05940013
059500                                                                  05950013
059600*----------------------------------------------------------------*05960013
059700* IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP ITEM    05970013
059800* NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP, SET THE TOP   05980013
059900* ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST MESSAGE.          05990013
060000*----------------------------------------------------------------*06000013
060100 2110-BROWSE-BACKWARD.                                            06010013
060200                                                                  06020013
060300     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    06030013
060400         GIVING PV-TOP-ITEM.                                      06040013
060500                                                                  06050013
060600     IF  ((PV-TOP-ITEM < +1)                                      06060013
060700       OR (PV-TOP-ITEM = +1))                                     06070013
060800         MOVE +1                   TO PV-TOP-ITEM                 06080013
060900*        -- TOP OF LIST --                                        06090013
061000         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06100013
061100         SET DP020-MSG-INFORMATIONAL TO TRUE                      06110013
061200     END-IF.                                                      06120013
061300                                                                  06130013
061400                                                                  06140013
061500*----------------------------------------------------------------*06150013
061600* IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP ITEM     06160013
061700* NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO PAST THE   06170013
061800* END, ISSUE THE BOTTOM OF LIST MESSAGE.                          06180013
061900*----------------------------------------------------------------*06190013
062000 2120-BROWSE-FORWARD.                                             06200013
062100                                                                  06210013
062200     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              06220013
062300         GIVING PV-TOP-ITEM.                                      06230013
062400     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   06240013
062500         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06250013
062600                                   TO PV-TOP-ITEM                 06260013
062700*        -- BOTTOM OF LIST --                                     06270013
062800         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06280013
062900         SET DP020-MSG-INFORMATIONAL                              06290013
063000                                   TO TRUE                        06300013
063100     ELSE                                                         06310013
063200         COMPUTE PV-BOTTOM-ITEM =                                 06320013
063300             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 06330013
063400         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            06340013
063500*            -- BOTTOM OF LIST --                                 06350013
063600             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            06360013
063700             SET DP020-MSG-INFORMATIONAL                          06370013
063800                                   TO TRUE                        06380013
063900         END-IF                                                   06390013
064000     END-IF.                                                      06400013
064100                                                                  06410013
064200                                                                  06420013
064300*----------------------------------------------------------------*06430013
064400* THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO THAT   06440013
064500* THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST. THIS IS A  06450013
064600* FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST RATHER THAN    06460013
064700* HITTING NEXT-PAGE TO GET TO THAT POINT. THE NEW LIST NUMBER     06470013
064800* ENTERED IS EDITED TO MAKE SURE THAT IT IS NUMERIC AND FALLS     06480013
064900* WITHIN A SPECIFIED RANGE.                                       06490013
065000*----------------------------------------------------------------*06500013
065100 2130-CHECK-FOR-JUMP-BROWSE.                                      06510013
065200                                                                  06520013
065300     IF ASC-START-ITEM-REQUEST = SPACE                            06530013
065400         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             06540013
065500     ELSE                                                         06550013
065600         MOVE ASC-START-ITEM-REQUEST  TO DP010I-UNEDITED-FIELD    06560013
065700         MOVE PC-ITEM-NUMBER-LENGTH   TO DP010I-MAXIMUM-DIGITS    06570013
065800         MOVE +0                      TO DP010I-MAXIMUM-DECIMALS  06580013
065900         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  06590013
066010         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06601013
066020                         USING DP010I-NUMERIC-EDIT-AREA           06602013
066100                                                                  06610013
066200         IF  NOT DP010I-ERROR-DETECTED                            06620013
066300             MOVE DP010I-NUMERIC-FIELD                            06630013
066400                                   TO  ASC-START-ITEM-REQUEST-N   06640013
066500             IF  ASC-START-ITEM-REQUEST-N > ZERO                  06650013
066600             AND ASC-START-ITEM-REQUEST-N < 1000000               06660013
066700                 IF  ASC-START-ITEM-REQUEST-N >                   06670013
066800                                          ASC-NUMBER-OF-ITEMS-READ06680013
066900                     MOVE SPACE TO ASC-START-ITEM-REQUEST         06690013
067000                     COMPUTE PV-TOP-ITEM =                        06700013
067100                             ASC-NUMBER-OF-ITEMS-READ             06710013
067200                             - PC-ITEMS-PER-PANEL + 1             06720013
067300                     IF  PV-TOP-ITEM < +1                         06730013
067400                         MOVE +1   TO PV-TOP-ITEM                 06740013
067500*                        ---- BOTTOM OF LIST ----                 06750013
067600                         MOVE PC-TSYMSG-00070                     06760013
067700                                   TO DP020-MSG-NUMBER            06770013
067800                         SET DP020-MSG-INFORMATIONAL TO TRUE      06780013
067900                     END-IF                                       06790013
068000                 ELSE                                             06800013
068100                     MOVE ASC-START-ITEM-REQUEST-N TO PV-TOP-ITEM 06810013
068200                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      06820013
068300                     COMPUTE PV-BOTTOM-ITEM =                     06830013
068400                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     06840013
068500                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ06850013
068600*                        -- BOTTOM OF LIST --                     06860013
068700                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 06870013
068800                         SET DP020-MSG-INFORMATIONAL TO TRUE      06880013
068900                     END-IF                                       06890013
069000                 END-IF                                           06900013
069100             ELSE                                                 06910013
069200*                --- VALUE OUT OF RANGE ----                      06920013
069300                 MOVE PC-TSYMSG-00101        TO DP020-MSG-NUMBER  06930013
069400                 MOVE -1                     TO ASTRTITL          06940013
069500                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              06950013
069600                 MOVE DP015-REVERSE          TO ASTRTITH          06960013
069700                 MOVE DP015-RED              TO ASTRTITC          06970013
069800                 MOVE DP015-UNP-NUM-BRT-OFF  TO ASTRTITA          06980013
069900                 SET DP020-MSG-FATAL                              06990013
070000                     PS-START-ITEM-ERROR     TO TRUE              07000013
070100             END-IF                                               07010013
070200         ELSE                                                     07020013
070300*            ---- MUST BE NUMERIC ----                            07030013
070400             MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER      07040013
070500             MOVE -1                     TO ASTRTITL              07050013
070600             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07060013
070700             MOVE DP015-REVERSE          TO ASTRTITH              07070013
070800             MOVE DP015-RED              TO ASTRTITC              07080013
070900             MOVE DP015-UNP-NUM-BRT-OFF  TO ASTRTITA              07090013
071000             SET DP020-MSG-FATAL         TO TRUE                  07100013
071100             SET PS-START-ITEM-ERROR     TO TRUE                  07110013
071200         END-IF                                                   07120013
071300     END-IF.                                                      07130013
071400                                                                  07140013
071500                                                                  07150013
071600*----------------------------------------------------------------*07160013
071700* IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION SWITCH   07170013
071800* FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.                    07180013
071900*----------------------------------------------------------------*07190013
072000 2140-DESELECT-ALL-ITEMS.                                         07200013
072100                                                                  07210013
072200     MOVE +1                       TO ASC-BLK-SUB.                07220013
072300                                                                  07230013
072400     PERFORM 2141-CLEAR-SELECTED-INDS                             07240013
072500         VARYING ASC-ITEM-SUB                                     07250013
072600         FROM 1 BY 1                                              07260013
072700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 07270013
072800                                                                  07280013
072900     ADD +1                        TO ASC-BLK-SUB.                07290013
073000                                                                  07300013
073100     PERFORM 2141-CLEAR-SELECTED-INDS                             07310013
073200         VARYING ASC-ITEM-SUB                                     07320013
073300         FROM 1 BY 1                                              07330013
073400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 07340013
073500                                                                  07350013
073600     MOVE ASC-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER.       07360013
073700                                                                  07370013
073800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            07380013
073900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    07390013
074000                                                                  07400013
074100     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     07410013
074200        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      07420013
074300         MOVE +1                   TO ASC-BLK-SUB                 07430013
074400                                                                  07440013
074500         PERFORM 5100-WRITE-TEMP-STORAGE                          07450013
074600                                                                  07460013
074700         MOVE +1                   TO PV-BLOCK-NUMBER             07470013
074800                                                                  07480013
074900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         07490013
075000             PV-FIRST-BLOCK-IN-ARRAY - 1                          07500013
075100                                                                  07510013
075200         PERFORM                                                  07520013
075300             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       07530013
075400                                                                  07540013
075500             PERFORM 4410-READ-TEMP-STORAGE                       07550013
075600                                                                  07560013
075700             PERFORM 2141-CLEAR-SELECTED-INDS                     07570013
075800                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 07580013
075900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          07590013
076000                                                                  07600013
076100             PERFORM 5100-WRITE-TEMP-STORAGE                      07610013
076200                                                                  07620013
076300             ADD +1                TO PV-BLOCK-NUMBER             07630013
076400         END-PERFORM                                              07640013
076500                                                                  07650013
076600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         07660013
076700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     07670013
076800                                                                  07680013
076900         PERFORM                                                  07690013
077000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       07700013
077100                   ASC-HIGHEST-BLOCK-WRITTEN                      07710013
077200                                                                  07720013
077300             MOVE PV-NEXT-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER       07730013
077400                                                                  07740013
077500             PERFORM 4410-READ-TEMP-STORAGE                       07750013
077600                                                                  07760013
077700             PERFORM 2141-CLEAR-SELECTED-INDS                     07770013
077800                 VARYING ASC-ITEM-SUB                             07780013
077900                 FROM 1 BY 1                                      07790013
078000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          07800013
078100                                                                  07810013
078200             PERFORM 5100-WRITE-TEMP-STORAGE                      07820013
078300                                                                  07830013
078400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      07840013
078500         END-PERFORM                                              07850013
078600                                                                  07860013
078700         MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER          07870013
078800                                                                  07880013
078900         PERFORM 4410-READ-TEMP-STORAGE                           07890013
079000     END-IF.                                                      07900013
079100                                                                  07910013
079200     MOVE +0  TO ASC-NUMBER-OF-SELECTED-ITEMS                     07920013
079300                 ASC-START-OF-SELECTED-RANGE                      07930013
079400                 ASC-END-OF-SELECTED-RANGE.                       07940013
079500                                                                  07950013
079600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        07960013
079700                                                                  07970013
079800                                                                  07980013
079900*----------------------------------------------------------------*07990013
080000* MARK EACH ITEM AS BEING NOT SELECTED.                           08000013
080100*----------------------------------------------------------------*08010013
080200 2141-CLEAR-SELECTED-INDS.                                        08020013
080300                                                                  08030013
080400     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) NOT = ZERO08040013
080500         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          08050013
080600             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          08060013
080700                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    08070013
080800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  08080013
080900                                   TO TRUE                        08090013
081000         END-IF                                                   08100013
081100     END-IF.                                                      08110013
081200                                                                  08120013
081300                                                                  08130013
081400*----------------------------------------------------------------*08140013
081500*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *08150013
081600*  FOR ALL ITEMS.                                                *08160013
081700*----------------------------------------------------------------*08170013
081800 2150-SELECT-ALL-ITEMS.                                           08180013
081900                                                                  08190013
082000     MOVE +1                       TO ASC-BLK-SUB.                08200013
082100                                                                  08210013
082200     PERFORM 2151-SET-SELECTED-INDS                               08220013
082300         VARYING ASC-ITEM-SUB                                     08230013
082400         FROM 1 BY 1                                              08240013
082500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08250013
082600                                                                  08260013
082700     ADD +1                        TO ASC-BLK-SUB.                08270013
082800                                                                  08280013
082900     PERFORM 2151-SET-SELECTED-INDS                               08290013
083000         VARYING ASC-ITEM-SUB                                     08300013
083100         FROM 1 BY 1                                              08310013
083200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08320013
083300                                                                  08330013
083400     MOVE ASC-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER.       08340013
083500                                                                  08350013
083600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            08360013
083700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    08370013
083800                                                                  08380013
083900     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     08390013
084000        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    08400013
084100         MOVE +1                   TO ASC-BLK-SUB                 08410013
084200                                                                  08420013
084300         PERFORM 5100-WRITE-TEMP-STORAGE                          08430013
084400                                                                  08440013
084500         MOVE +1                   TO PV-BLOCK-NUMBER             08450013
084600                                                                  08460013
084700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         08470013
084800             PV-FIRST-BLOCK-IN-ARRAY - 1                          08480013
084900                                                                  08490013
085000         PERFORM                                                  08500013
085100             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       08510013
085200                                                                  08520013
085300             PERFORM 4410-READ-TEMP-STORAGE                       08530013
085400                                                                  08540013
085500             PERFORM 2151-SET-SELECTED-INDS                       08550013
085600                 VARYING ASC-ITEM-SUB                             08560013
085700                 FROM 1 BY 1                                      08570013
085800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08580013
085900                                                                  08590013
086000             PERFORM 5100-WRITE-TEMP-STORAGE                      08600013
086100                                                                  08610013
086200             ADD +1                TO PV-BLOCK-NUMBER             08620013
086300         END-PERFORM                                              08630013
086400                                                                  08640013
086500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         08650013
086600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     08660013
086700                                                                  08670013
086800         PERFORM                                                  08680013
086900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       08690013
087000                   ASC-HIGHEST-BLOCK-WRITTEN                      08700013
087100                                                                  08710013
087200             MOVE PV-NEXT-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER       08720013
087300                                                                  08730013
087400             PERFORM 4410-READ-TEMP-STORAGE                       08740013
087500                                                                  08750013
087600             PERFORM 2151-SET-SELECTED-INDS                       08760013
087700                 VARYING ASC-ITEM-SUB                             08770013
087800                 FROM 1 BY 1                                      08780013
087900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08790013
088000                                                                  08800013
088100             PERFORM 5100-WRITE-TEMP-STORAGE                      08810013
088200                                                                  08820013
088300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      08830013
088400         END-PERFORM                                              08840013
088500                                                                  08850013
088600         MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER          08860013
088700                                                                  08870013
088800         PERFORM 4410-READ-TEMP-STORAGE                           08880013
088900     END-IF.                                                      08890013
089000                                                                  08900013
089100     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             08910013
089200                       ASC-NUMBER-OF-SELECTED-ITEMS.              08920013
089300                                                                  08930013
089400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        08940013
089500                                                                  08950013
089600                                                                  08960013
089700*----------------------------------------------------------------*08970013
089800* MARK EACH ITEM AS BEING SELECTED.                               08980013
089900*----------------------------------------------------------------*08990013
090000 2151-SET-SELECTED-INDS.                                          09000013
090100                                                                  09010013
090200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) NOT = ZERO09020013
090300         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             09030013
090400             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             09040013
090500                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        09050013
090600                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  09060013
090700                               TO  TRUE                           09070013
090800         END-IF                                                   09080013
090900     END-IF.                                                      09090013
091000                                                                  09100013
091100                                                                  09110013
091200*----------------------------------------------------------------*09120013
091300* MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE       09130013
091400* SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.    09140013
091500*----------------------------------------------------------------*09150013
091600 2200-MOVE-SCREEN-TO-COMMAREA.                                    09160013
091700                                                                  09170013
091800     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             09180013
091900     MOVE +1                       TO PV-SUB.                     09190013
092000                                                                  09200013
092100     PERFORM 3100-SET-SUBSCRIPTS.                                 09210013
092200     IF  ASTRTITL > ZERO                                          09220013
092300         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          09230013
092400     ELSE                                                         09240013
092500         IF ASTRTITF = DP015-ERASE-EOF                            09250013
092600             MOVE SPACE TO ASC-START-ITEM-REQUEST                 09260013
092700         END-IF.                                                  09270013
092800                                                                  09280013
092900     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          09290013
093000         VARYING PV-SUB                                           09300013
093100         FROM 1 BY 1                                              09310013
093200         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      09320013
093300                                                                  09330013
093400                                                                  09340013
093500*----------------------------------------------------------------*09350013
093600* MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA.  09360013
093700*----------------------------------------------------------------*09370013
093800 2210-MOVE-LINES-TO-COMMAREA.                                     09380013
093900                                                                  09390013
094000     IF  MR-SELECTL (PV-SUB) > ZERO                               09400013
094100         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             09410013
094200         MOVE MR-SELECTI (PV-SUB)  TO ASC-TEMP-SELECTED-SW        09420013
094300                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      09430013
094400     ELSE                                                         09440013
094500         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                09450013
094600                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     09460013
094700                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        09470013
094800                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      09480013
094900         END-IF                                                   09490013
095000     END-IF.                                                      09500013
095100                                                                  09510013
095200     ADD +1                        TO ASC-ITEM-SUB.               09520013
095300                                                                  09530013
095400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        09540013
095500         ADD +1                    TO ASC-BLK-SUB                 09550013
095600         MOVE +1                   TO ASC-ITEM-SUB                09560013
095700     END-IF.                                                      09570013
095800                                                                  09580013
095900                                                                  09590013
096000*----------------------------------------------------------------*09600013
096100* EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE         09610013
096200* COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).    09620013
096300*----------------------------------------------------------------*09630013
096400 3000-EDIT-DATA-IN-COMMAREA.                                      09640013
096500                                                                  09650013
096600     SET PS-NO-ERROR               TO TRUE.                       09660013
096700     PERFORM 3200-RESET-ATTRIBUTES.                               09670013
096800     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     09680013
096900                                                                  09690013
097000*    *------------------------------------------------------------09700013
097100*    * CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.         09710013
097200*    * EDITTING IS DONE FROM THE BOTTOM UP.                       09720013
097300*    *------------------------------------------------------------09730013
097400     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       09740013
097500         ASC-ITEMS-DISPLAYED - 1.                                 09750013
097600     PERFORM 3100-SET-SUBSCRIPTS.                                 09760013
097700     PERFORM 3300-EDIT-SELECTIONS                                 09770013
097800         VARYING PV-SUB                                           09780013
097900         FROM PV-SUB BY -1                                        09790013
098000         UNTIL PV-SUB < +1                                        09800013
098100                                                                  09810013
098200     IF  PS-NO-ERROR                                              09820013
098300         PERFORM 3400-CHECK-RANGE-SEQUENCE                        09830013
098400     END-IF.                                                      09840013
098500                                                                  09850013
098600     IF  ((PS-NO-ERROR)                                           09860013
098700       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   09870013
098800       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    09880013
098900             PERFORM 3500-MARK-RANGE-AS-SELECTED                  09890013
099000     END-IF.                                                      09900013
099100                                                                  09910013
099200                                                                  09920013
099300*----------------------------------------------------------------*09930013
099400* DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM     09940013
099500* CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY. THIS WILL     09950013
099600* POSITION US IN THE 1ST BLOCK OF THE ARRAY.                      09960013
099700*                                                                 09970013
099800* IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS IN A  09980013
099900* BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT THE MAXIMUM 09990013
100000* NUMBER OF ITEMS. THIS WILL CORRECTLY POSITION US IN THE 2ND     10000013
100100* BLOCK OF THE ARRAY.                                             10010013
100200*----------------------------------------------------------------*10020013
100300 3100-SET-SUBSCRIPTS.                                             10030013
100400                                                                  10040013
100500     COMPUTE ASC-ITEM-SUB =                                       10050013
100600         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        10060013
100700                                                                  10070013
100800     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         10080013
100900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            10090013
101000         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               10100013
101100     ELSE                                                         10110013
101200         MOVE +1                     TO ASC-BLK-SUB               10120013
101300     END-IF.                                                      10130013
101400                                                                  10140013
101500                                                                  10150013
101600*----------------------------------------------------------------*10160013
101700* RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.        10170013
101800*----------------------------------------------------------------*10180013
101900 3200-RESET-ATTRIBUTES.                                           10190013
102000                                                                  10200013
102100     MOVE DP015-UNP-NUM-NOR-OFF    TO ASTRTITA.                   10210013
102200     MOVE DP015-GREEN              TO ASTRTITC.                   10220013
102300     MOVE DP015-UNDERLINE          TO ASTRTITH.                   10230013
102400                                                                  10240013
102500     PERFORM                                                      10250013
102600         VARYING PV-SUB                                           10260013
102700         FROM 1 BY 1                                              10270013
102800         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        10280013
102900         MOVE DP015-UNP-ALP-NOR-OFF                               10290013
103000                                   TO MR-SELECTA (PV-SUB)         10300013
103100         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         10310013
103200         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         10320013
103300     END-PERFORM.                                                 10330013
103400                                                                  10340013
103500                                                                  10350013
103600*----------------------------------------------------------------*10360013
103700* EDIT THE SELECTIONS MADE. NOTE THAT THE 'SELECTED-SW' IS WHAT   10370013
103800* WAS PREVIOUSLY CHECKED AND CORRECT. 'TEMP-SELECTED-SW' IS WHAT  10380013
103900* HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR WAS ENTERED   10390013
104000* EARLIER, BUT DID NOT PASS THE EDITS.                            10400013
104100*----------------------------------------------------------------*10410013
104200 3300-EDIT-SELECTIONS.                                            10420013
104300                                                                  10430013
104400     EVALUATE TRUE                                                10440013
104500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     10450013
104600             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         10460013
104700                 CONTINUE                                         10470013
104800         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         10480013
104900             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        10490013
105000                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   10500013
105100                 MOVE ASC-TEMP-SELECTED-SW                        10510013
105200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10520013
105300                                TO ASC-SELECTED-SW                10530013
105400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10540013
105500             END-IF                                               10550013
105600         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     10560013
105700                 = SPACE                                          10570013
105800             EVALUATE TRUE                                        10580013
105900                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       10590013
106000                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS10600013
106100                     MOVE SPACE TO ASC-SELECTED-SW                10610013
106200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10620013
106300                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        10630013
106400                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    10640013
106500                     MOVE SPACE TO ASC-SELECTED-SW                10650013
106600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10660013
106700                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          10670013
106800                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      10680013
106900                     MOVE SPACE TO ASC-SELECTED-SW                10690013
107000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10700013
107100             END-EVALUATE                                         10710013
107200         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           10720013
107300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            10730013
107400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    10740013
107500             END-IF                                               10750013
107600             PERFORM 3310-EDIT-RANGE                              10760013
107700         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             10770013
107800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            10780013
107900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    10790013
108000             END-IF                                               10800013
108100             PERFORM 3310-EDIT-RANGE                              10810013
108200         WHEN OTHER                                               10820013
108300*            ---- INVALID VALUE ----                              10830013
108400             MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER      10840013
108500             SET DP020-MSG-FATAL         TO TRUE                  10850013
108600             MOVE -1                     TO MR-SELECTL (PV-SUB)   10860013
108700             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  10870013
108800             MOVE DP015-RED              TO MR-SELECTC (PV-SUB)   10880013
108900             MOVE DP015-REVERSE          TO MR-SELECTH (PV-SUB)   10890013
109000             SET PS-ERROR                TO TRUE                  10900013
109100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            10910013
109200                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     10920013
109300                 MOVE SPACE         TO ASC-SELECTED-SW            10930013
109400                                        (ASC-BLK-SUB ASC-ITEM-SUB)10940013
109500             END-IF                                               10950013
109600     END-EVALUATE.                                                10960013
109700                                                                  10970013
109800     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 10980013
109900     SUBTRACT +1 FROM ASC-ITEM-SUB.                               10990013
110000     IF  ASC-ITEM-SUB < 1                                         11000013
110100         SUBTRACT +1 FROM ASC-BLK-SUB                             11010013
110200         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                11020013
110300     END-IF.                                                      11030013
110400                                                                  11040013
110500                                                                  11050013
110600*-----------------------------------------------------------------11060013
110700* IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A RANGE OF11070013
110800* LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1 ENDING AND MAKE11080013
110900* SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE ENDING.       11090013
111000*-----------------------------------------------------------------11100013
111100 3310-EDIT-RANGE.                                                 11110013
111200                                                                  11120013
111300     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                11130013
111400         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   11140013
111500             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)11150013
111600                                   TO ASC-SELECTED-SW             11160013
111700                                        (ASC-BLK-SUB ASC-ITEM-SUB)11170013
111800             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 11180013
111900         ELSE                                                     11190013
112000             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     11200013
112100                 CONTINUE                                         11210013
112200             ELSE                                                 11220013
112300*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        11230013
112400                 MOVE PC-TSYMSG-00054 TO DP020-MSG-NUMBER         11240013
112500                 SET DP020-MSG-FATAL  TO TRUE                     11250013
112600                 MOVE -1              TO MR-SELECTL (PV-SUB)      11260013
112700                 SET DP030-SET-CURSOR-APPL-1                      11270013
112800                                      TO TRUE                     11280013
112900                 MOVE DP015-RED       TO MR-SELECTC (PV-SUB)      11290013
113000                 MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)      11300013
113100                 SET PS-ERROR         TO TRUE                     11310013
113200             END-IF                                               11320013
113300         END-IF                                                   11330013
113400     ELSE                                                         11340013
113500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     11350013
113600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 11360013
113700                                   TO ASC-SELECTED-SW             11370013
113800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   11380013
113900             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   11390013
114000         ELSE                                                     11400013
114100             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       11410013
114200                 CONTINUE                                         11420013
114300             ELSE                                                 11430013
114400*                -- ONLY ONE END-OF-RANGE ALLOWED --              11440013
114500                 MOVE PC-TSYMSG-00055 TO DP020-MSG-NUMBER         11450013
114600                 SET DP020-MSG-FATAL  TO TRUE                     11460013
114700                 MOVE -1              TO MR-SELECTL (PV-SUB)      11470013
114800                 SET DP030-SET-CURSOR-APPL-1                      11480013
114900                     PS-ERROR         TO TRUE                     11490013
115000             END-IF                                               11500013
115100         END-IF                                                   11510013
115200     END-IF.                                                      11520013
115300                                                                  11530013
115400                                                                  11540013
115500******************************************************************11550013
115600* IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED, MAKE  11560013
115700* SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.          11570013
115800******************************************************************11580013
115900 3400-CHECK-RANGE-SEQUENCE.                                       11590013
116000                                                                  11600013
116100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       11610013
116200       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      11620013
116300       AND  ASC-START-OF-SELECTED-RANGE >                         11630013
116400                                         ASC-END-OF-SELECTED-RANGE11640013
116500*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                11650013
116600         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 11660013
116700         SET DP020-MSG-FATAL                                      11670013
116800             PS-ERROR        TO TRUE                              11680013
116900         PERFORM 3410-POSITION-AT-ERROR                           11690013
117000     ELSE                                                         11700013
117100         MOVE -1 TO MR-SELECTL (1)                                11710013
117200     END-IF.                                                      11720013
117300     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       11730013
117400                                                                  11740013
117500                                                                  11750013
117600******************************************************************11760013
117700* BECAUSE RANGES CAN SPAN MULTIPLE PAGES, A SEPARATE PARAGRAPH    11770013
117800* (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR SHOULD BE    11780013
117900* POSITIONED ON A RANGE ERROR.                                    11790013
118000******************************************************************11800013
118100 3410-POSITION-AT-ERROR.                                          11810013
118200                                                                  11820013
118300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 11830013
118400                    - PV-TOP-ITEM + 1.                            11840013
118500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      11850013
118600         CONTINUE                                                 11860013
118700     ELSE                                                         11870013
118800         MOVE -1                   TO MR-SELECTL (PV-SUB)         11880013
118900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         11890013
119000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         11900013
119100     END-IF.                                                      11910013
119200                                                                  11920013
119300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   11930013
119400                    - PV-TOP-ITEM + 1.                            11940013
119500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      11950013
119600         CONTINUE                                                 11960013
119700     ELSE                                                         11970013
119800         MOVE -1                   TO MR-SELECTL (PV-SUB)         11980013
119900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         11990013
120000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         12000013
120100     END-IF.                                                      12010013
120200                                                                  12020013
120300                                                                  12030013
120400*----------------------------------------------------------------*12040013
120500*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *12050013
120600*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *12060013
120700*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *12070013
120800*----------------------------------------------------------------*12080013
120900 3500-MARK-RANGE-AS-SELECTED.                                     12090013
121000                                                                  12100013
121100     MOVE +1                       TO  ASC-BLK-SUB.               12110013
121200     PERFORM 3510-MARK-SELECTED-INDS                              12120013
121300         VARYING ASC-ITEM-SUB                                     12130013
121400         FROM 1 BY 1                                              12140013
121500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12150013
121600                                                                  12160013
121700     ADD +1                        TO ASC-BLK-SUB.                12170013
121800     PERFORM 3510-MARK-SELECTED-INDS                              12180013
121900         VARYING ASC-ITEM-SUB                                     12190013
122000         FROM 1 BY 1                                              12200013
122100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12210013
122200                                                                  12220013
122300     MOVE ASC-LIST-ITEM-NUMBER(1 1) TO  PV-LIST-ITEM-NUMBER.      12230013
122400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            12240013
122500         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         12250013
122600               PC-ITEMS-PER-PANEL).                               12260013
122700                                                                  12270013
122800     MOVE ASC-START-OF-SELECTED-RANGE                             12280013
122900                                    TO PV-START-OF-SELECTED-RANGE.12290013
123000     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            12300013
123100         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  12310013
123200               PC-ITEMS-PER-PANEL).                               12320013
123300                                                                  12330013
123400     MOVE ASC-END-OF-SELECTED-RANGE TO  PV-END-OF-SELECTED-RANGE. 12340013
123500     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             12350013
123600         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    12360013
123700               PC-ITEMS-PER-PANEL).                               12370013
123800     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             12380013
123900         PV-FIRST-BLOCK-IN-ARRAY + 1.                             12390013
124000                                                                  12400013
124100     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    12410013
124200        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        12420013
124300         MOVE +1                   TO ASC-BLK-SUB                 12430013
124400         PERFORM 5100-WRITE-TEMP-STORAGE                          12440013
124500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12450013
124600             PV-FIRST-BLOCK-IN-ARRAY - 1                          12460013
124700                                                                  12470013
124800         PERFORM                                                  12480013
124900             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      12490013
125000                   PV-PREV-BLOCK-IN-ARRAY                         12500013
125100             MOVE PV-FIRST-BLOCK-IN-RANGE TO PV-BLOCK-NUMBER      12510013
125200             PERFORM 4410-READ-TEMP-STORAGE                       12520013
125300             PERFORM 3510-MARK-SELECTED-INDS                      12530013
125400                 VARYING ASC-ITEM-SUB                             12540013
125500                 FROM 1 BY 1                                      12550013
125600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12560013
125700             PERFORM 5100-WRITE-TEMP-STORAGE                      12570013
125800             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     12580013
125900         END-PERFORM                                              12590013
126000                                                                  12600013
126100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12610013
126200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12620013
126300         PERFORM                                                  12630013
126400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12640013
126500                   PV-LAST-BLOCK-IN-RANGE                         12650013
126600             MOVE PV-NEXT-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER       12660013
126700             PERFORM 4410-READ-TEMP-STORAGE                       12670013
126800             PERFORM 3510-MARK-SELECTED-INDS                      12680013
126900                 VARYING ASC-ITEM-SUB                             12690013
127000                 FROM 1 BY 1                                      12700013
127100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12710013
127200             PERFORM 5100-WRITE-TEMP-STORAGE                      12720013
127300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12730013
127400         END-PERFORM                                              12740013
127500                                                                  12750013
127600         MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER          12760013
127700         PERFORM 4410-READ-TEMP-STORAGE                           12770013
127800     END-IF.                                                      12780013
127900                                                                  12790013
128000     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 12800013
128100                                      ASC-END-OF-SELECTED-RANGE.  12810013
128200                                                                  12820013
128300                                                                  12830013
128400*----------------------------------------------------------------*12840013
128500* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *12850013
128600*----------------------------------------------------------------*12860013
128700 3510-MARK-SELECTED-INDS.                                         12870013
128800                                                                  12880013
128900     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) >         12890013
129000         ASC-START-OF-SELECTED-RANGE)                             12900013
129100     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =         12910013
129200         ASC-START-OF-SELECTED-RANGE)                             12920013
129300         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) <     12930013
129400             ASC-END-OF-SELECTED-RANGE)                           12940013
129500         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =     12950013
129600             ASC-END-OF-SELECTED-RANGE)                           12960013
129700             IF NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)         12970013
129800                 SET ASC-SELECT        (ASC-BLK-SUB  ASC-ITEM-SUB)12980013
129900                     ASC-TEMP-SELECT   (ASC-BLK-SUB  ASC-ITEM-SUB)12990013
130000                     ASC-BLOCK-MODIFIED (ASC-BLK-SUB)             13000013
130100                               TO TRUE                            13010013
130200                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    13020013
130300             END-IF                                               13030013
130400         END-IF                                                   13040013
130500     END-IF.                                                      13050013
130600                                                                  13060013
130700                                                                  13070013
130800*----------------------------------------------------------------*13080013
130900* INITIALIZE BOTH BLOCKS IN THE ARRAY AND ALL COUNTERS AND FLAGS. 13090013
131000* READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.      13100013
131100* DISPLAY THE PANEL TO USER.                                      13110013
131200*----------------------------------------------------------------*13120013
131300 4000-BUILD-INITIAL-PANEL.                                        13130013
131400                                                                  13140013
131500     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            13150013
131600                                 ASC-BLOCK-ENTRIES (2).           13160013
131700     MOVE +1                  TO ASC-BLK-SUB.                     13170013
131800     SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                            13180013
131900     MOVE +0                  TO ASC-ITEM-SUB                     13190013
132000                                 ASC-NUMBER-OF-ITEMS-READ         13200013
132100                                 ASC-NUMBER-OF-SELECTED-ITEMS     13210013
132200                                 ASC-HIGHEST-BLOCK-WRITTEN        13220013
132300                                 ASC-START-OF-SELECTED-RANGE      13230013
132400                                 ASC-END-OF-SELECTED-RANGE        13240013
132500                                 ASC-ITEM-AT-TOP-OF-PANEL.        13250013
132600                                                                  13260013
132700     PERFORM 4010-OPEN-CURSOR.                                    13270013
132800                                                                  13280013
132900     IF SQLCODE = ZERO                                            13290013
133000         PERFORM 4300-READ-ITEMS-FROM-DB                          13300013
133100         PERFORM 4020-CLOSE-CURSOR                                13310013
133200         MOVE +1 TO  PV-TOP-ITEM                                  13320013
133300         IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                      13330013
133400             SET DP020-NEXT-ACT-APPL-ERROR                        13340013
133500                 DP020-MSG-FATAL TO TRUE                          13350013
133600*            ---- NO LIST ITEMS FOUND FOR CRITERIA ----           13360013
133700             MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER           13370013
133800         ELSE                                                     13380013
133900             MOVE -1               TO MR-SELECTL (1)              13390013
134000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  13400013
134100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13410013
134200         END-IF                                                   13420013
134300     ELSE                                                         13430013
134400         SET  DP020-NEXT-ACT-APPL-ERROR                           13440013
134500              DP020-MSG-WARNING         TO TRUE                   13450013
134600*        ---- WAIT 15 SECONDS, THEN RETRY ----                    13460013
134700         MOVE PC-TSYMSG-00551  TO  DP020-MSG-NUMBER               13470013
134800     END-IF.                                                      13480013
134900                                                                  13490013
135000                                                                  13500013
135100 4010-OPEN-CURSOR.                                                13510013
135200                                                                  13520013
135300     EXEC SQL                                                     13530013
135400          OPEN TNETVND-CSR                                        13540013
135500     END-EXEC.                                                    13550013
135600                                                                  13560013
135700     EVALUATE TRUE                                                13570013
135800         WHEN SQLCODE = ZERO                                      13580013
135900         WHEN SQLCODE = -904                                      13590013
136000         WHEN SQLCODE = -913                                      13600013
136100             CONTINUE                                             13610013
136200         WHEN SQLWARN0 NOT = SPACES                               13620013
136300         WHEN SQLCODE  NOT = ZERO                                 13630013
136400             MOVE '4010-OPEN-CURSOR'                              13640013
136500                                     TO DP013-PARAGRAPH           13650013
136600             MOVE 'OPEN TNETVND-CSR' TO DP013-MESSAGE-TEXT (1)    13660013
136700             MOVE 'TNETVND '         TO DP013-DB2-TABLE-NAME (1)  13670013
136800             MOVE 'TENTNME '         TO DP013-DB2-TABLE-NAME (2)  13680013
136900             MOVE 'TNETWRK '         TO DP013-DB2-TABLE-NAME (3)  13690013
137000             MOVE SQLCA              TO DP013-SQLCA               13700013
137100             SET DP013-DB2-ABEND                                  13710013
137200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               13720013
137300             PERFORM DP013-0000-PROCESS-ABEND                     13730013
137400     END-EVALUATE.                                                13740013
137500                                                                  13750013
137600                                                                  13760013
137700 4020-CLOSE-CURSOR.                                               13770013
137800                                                                  13780013
137900     EXEC SQL                                                     13790013
138000         CLOSE TNETVND-CSR                                        13800013
138100     END-EXEC.                                                    13810013
138200                                                                  13820013
138300     EVALUATE TRUE                                                13830013
138400         WHEN SQLCODE = ZERO                                      13840013
138500             CONTINUE                                             13850013
138600         WHEN SQLWARN0 NOT = SPACES                               13860013
138700         WHEN SQLCODE  NOT = ZERO                                 13870013
138800             MOVE '4020-CLOSE-CURSOR'                             13880013
138900                                      TO DP013-PARAGRAPH          13890013
139000             MOVE 'CLOSE TNETVND-CSR' TO DP013-MESSAGE-TEXT (1)   13900013
139100             MOVE 'TNETVND'           TO DP013-DB2-TABLE-NAME (1) 13910013
139200             MOVE 'TENTNME '          TO DP013-DB2-TABLE-NAME (2) 13920013
139300             MOVE 'TNETWRK '          TO DP013-DB2-TABLE-NAME (3) 13930013
139400             MOVE SQLCA               TO DP013-SQLCA              13940013
139500             SET DP013-DB2-ABEND                                  13950013
139600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               13960013
139700             PERFORM DP013-0000-PROCESS-ABEND                     13970013
139800     END-EVALUATE.                                                13980013
139900                                                                  13990013
140000                                                                  14000013
140100*----------------------------------------------------------------*14010013
140200* READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE BLOCKS 14020013
140300* IN THE ARRAY. WHENEVER BOTH BLOCKS BECOME FULL, WRITE OUT THE   14030013
140400* 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND BLOCK IN THE ARRAY 14040013
140500* TO THE 1ST BLOCK, AND INITIALIZE THE 2ND BLOCK, MAKING IT       14050013
140600* AVAILABLE TO BE USED.                                           14060013
140700*                                                                 14070013
140800* DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE ROWS   14080013
140900* ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM UPON      14090013
141000* INITIALIZATION.                                                 14100013
141100*----------------------------------------------------------------*14110013
141200 4300-READ-ITEMS-FROM-DB.                                         14120013
141300                                                                  14130013
141400     PERFORM                                                      14140013
141500         VARYING PV-READ-COUNT                                    14150013
141600         FROM 1 BY 1                                              14160013
141700         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    14170013
141800            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         14180013
141900                                                                  14190013
142000         PERFORM 4310-FETCH                                       14200013
142100                                                                  14210013
142200         IF  ASC-ITEMS-LEFT-ON-DB                                 14220013
142300             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                14230013
142400                 ADD +1            TO ASC-ITEM-SUB                14240013
142500             ELSE                                                 14250013
142600                 ADD +1            TO ASC-BLK-SUB                 14260013
142700                 MOVE +1           TO ASC-ITEM-SUB                14270013
142800                                                                  14280013
142900                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         14290013
143000                     MOVE +1       TO ASC-BLK-SUB                 14300013
143100                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           14310013
143200                     PERFORM 5100-WRITE-TEMP-STORAGE              14320013
143300                     MOVE ASC-BLOCK-ENTRIES                       14330013
143400                                          (PC-MAX-BLOCKS-IN-ARRAY)14340013
143500                                 TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)14350013
143600                     ADD +1        TO ASC-BLK-SUB                 14360013
143700                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   14370013
143800                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      14380013
143900                                                           TO TRUE14390013
144000                 END-IF                                           14400013
144100             END-IF                                               14410013
144200             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    14420013
144300             MOVE ASC-NUMBER-OF-ITEMS-READ                        14430013
144400                TO ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)14440013
144500             MOVE NETVND-NETWK-ID                                 14450013
144600                TO ASC-NETWORK-ID       (ASC-BLK-SUB ASC-ITEM-SUB)14460013
144700             MOVE NETVND-ENT-ID                                   14470013
144800                TO ASC-ENT-ID           (ASC-BLK-SUB ASC-ITEM-SUB)14480013
144900             MOVE NETVND-UPC-CAT-VEND-ID                          14490013
145000                TO ASC-VENDOR-ID        (ASC-BLK-SUB ASC-ITEM-SUB)14500013
145100             MOVE NETVND-PREF-NETWK-SW-IND                        14510013
145200                TO ASC-PREFERRED-IND  (ASC-BLK-SUB ASC-ITEM-SUB)  14520013
145300             MOVE NETVND-NRF-CMPLIT-IND                           14530013
145400                TO ASC-NRFCOMP-IND    (ASC-BLK-SUB ASC-ITEM-SUB)  14540013
145500             MOVE ENTNME-ENT-NAME-DESC                            14550013
145600                TO ASC-VENDOR-NAME    (ASC-BLK-SUB ASC-ITEM-SUB)  14560013
145700             MOVE NETWRK-NETWK-NME                                14570013
145800                TO ASC-NETWORK-NAME   (ASC-BLK-SUB ASC-ITEM-SUB)  14580013
145900         END-IF                                                   14590013
146000     END-PERFORM.                                                 14600013
146100                                                                  14610013
146200     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          14620013
146300         MOVE +1               TO ASC-BLK-SUB                     14630013
146400         PERFORM 5100-WRITE-TEMP-STORAGE                          14640013
146500         ADD +1                TO ASC-BLK-SUB                     14650013
146600         PERFORM 5100-WRITE-TEMP-STORAGE                          14660013
146700                                                                  14670013
146800         MOVE 1                TO ASC-BLK-SUB                     14680013
146900                                  PV-BLOCK-NUMBER                 14690013
147000         PERFORM 4410-READ-TEMP-STORAGE                           14700013
147100         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             14710013
147200             MOVE 2            TO ASC-BLK-SUB                     14720013
147300                                  PV-BLOCK-NUMBER                 14730013
147400             PERFORM 4410-READ-TEMP-STORAGE                       14740013
147500         END-IF                                                   14750013
147600     END-IF.                                                      14760013
147700                                                                  14770013
147800                                                                  14780013
147900 4310-FETCH.                                                      14790013
148000                                                                  14800013
148100      EXEC SQL                                                    14810013
148200           FETCH TNETVND-CSR                                      14820013
148300           INTO  :NETVND-NETWK-ID                                 14830013
148400               , :NETVND-ENT-ID                                   14840013
148500               , :NETVND-UPC-CAT-VEND-ID                          14850013
148600               , :NETVND-PREF-NETWK-SW-IND                        14860013
148700               , :NETVND-NRF-CMPLIT-IND                           14870013
148800               , :ENTNME-ENT-NAME-DESC                            14880013
148900               , :NETWRK-NETWK-NME                                14890013
149000      END-EXEC.                                                   14900013
149100                                                                  14910013
149200     EVALUATE TRUE                                                14920013
149300         WHEN SQLCODE = ZERO                                      14930013
149400         WHEN SQLCODE = +100                                      14940013
149500              CONTINUE                                            14950013
149600         WHEN SQLWARN0 NOT = SPACE                                14960013
149700         WHEN SQLCODE  NOT = ZERO                                 14970013
149800              MOVE '4310-FETCH-CURSOR' TO DP013-PARAGRAPH         14980013
149900              MOVE 'FETCH TNETVND-CSR' TO DP013-MESSAGE-TEXT (1)  14990013
150000              MOVE 'TNETVND '          TO DP013-DB2-TABLE-NAME (1)15000013
150100              MOVE 'TENTNME '          TO DP013-DB2-TABLE-NAME (2)15010013
150200              MOVE 'TNETWRK '          TO DP013-DB2-TABLE-NAME (3)15020013
150300              MOVE SQLCA               TO DP013-SQLCA             15030013
150400              SET DP013-DB2-ABEND      TO TRUE                    15040013
150500              PERFORM DP013-0000-PROCESS-ABEND                    15050013
150600     END-EVALUATE.                                                15060013
150700                                                                  15070013
150800     IF  SQLCODE = +100                                           15080013
150900         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                      15090013
151000     END-IF.                                                      15100013
151100                                                                  15110013
151200                                                                  15120013
151300*----------------------------------------------------------------*15130013
151400* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *15140013
151500*----------------------------------------------------------------*15150013
151600 4400-MOVE-COMMAREA-TO-SCREEN.                                    15160013
151700                                                                  15170013
151800     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             15180013
151900         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          15190013
152000         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          15200013
152100             MOVE +1    TO ASC-BLK-SUB                            15210013
152200             PERFORM 5100-WRITE-TEMP-STORAGE                      15220013
152300             ADD +1     TO ASC-BLK-SUB                            15230013
152400             PERFORM 5100-WRITE-TEMP-STORAGE                      15240013
152500             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             15250013
152600                 GIVING PV-BLOCK-NUMBER                           15260013
152700                 REMAINDER PV-REMAINDER                           15270013
152800             IF  PV-REMAINDER > ZERO                              15280013
152900                 ADD +1 TO PV-BLOCK-NUMBER                        15290013
153000             END-IF                                               15300013
153100             MOVE +1    TO ASC-BLK-SUB                            15310013
153200             PERFORM 4410-READ-TEMP-STORAGE                       15320013
153300             ADD +1     TO ASC-BLK-SUB                            15330013
153400                           PV-BLOCK-NUMBER                        15340013
153500             PERFORM 4410-READ-TEMP-STORAGE                       15350013
153600     END-IF.                                                      15360013
153700                                                                  15370013
153800     MOVE +1            TO ASC-BLK-SUB.                           15380013
153900                                                                  15390013
154000     COMPUTE ASC-ITEM-SUB =                                       15400013
154100         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              15410013
154200         + PC-ITEMS-PER-PANEL).                                   15420013
154300                                                                  15430013
154400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        15440013
154500         ADD +1         TO ASC-BLK-SUB                            15450013
154600         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            15460013
154700     END-IF.                                                      15470013
154800                                                                  15480013
154900     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           15490013
155000         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                15500013
155100                                                                  15510013
155200     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        15520013
155300     PERFORM 4420-FORMAT-LIST-LINES                               15530013
155400         VARYING PV-SUB                                           15540013
155500         FROM PC-ITEMS-PER-PANEL BY -1                            15550013
155600         UNTIL PV-SUB < +1.                                       15560013
155700                                                                  15570013
155800     COMPUTE ASC-ITEMS-DISPLAYED =                                15580013
155900         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          15590013
156000                                                                  15600013
156100     IF PS-NO-START-ITEM-ERROR                                    15610013
156200         MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL15620013
156300                                          ASTRTITO                15630013
156400         MOVE SPACE                    TO ASC-START-ITEM-REQUEST  15640013
156500     ELSE                                                         15650013
156600         MOVE ASC-START-ITEM-REQUEST   TO ASTRTITO                15660013
156700     END-IF.                                                      15670013
156800                                                                  15680013
156900     MOVE ASC-ITEM-AT-BOT-OF-PANEL     TO AENDITO.                15690013
157000     MOVE ASC-NUMBER-OF-ITEMS-READ     TO ATOTITO.                15700013
157100     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO ASELITO.                15710013
157200                                                                  15720013
157300     IF  DP020-MSG-NUMBER-X = SPACE                               15730013
157400         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  15740013
157500*            --- MORE ITEMS TO DISPLAY ----                       15750013
157600             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            15760013
157700             SET DP020-MSG-INFORMATIONAL TO TRUE                  15770013
157800         END-IF                                                   15780013
157900     END-IF.                                                      15790013
158000                                                                  15800013
158100                                                                  15810013
158200*----------------------------------------------------------------*15820013
158300*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *15830013
158400*----------------------------------------------------------------*15840013
158500 4410-READ-TEMP-STORAGE.                                          15850013
158600                                                                  15860013
158700     EXEC CICS                                                    15870013
158800         READQ TS                                                 15880013
158900             QUEUE (ASC-LIST-QUEUE-NAME)                          15890013
159000             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               15900013
159100             ITEM  (PV-BLOCK-NUMBER)                              15910013
159200             RESP  (PV-CICS-RESP)                                 15920013
159300     END-EXEC.                                                    15930013
159400                                                                  15940013
159500     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       15950013
159600       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     15960013
159700         CONTINUE                                                 15970013
159800     ELSE                                                         15980013
159900         SET DP013-CICS-ABEND                                     15990013
160000             DP013-NO-ROLLBACK    TO TRUE                         16000013
160100         MOVE '4410-READ-TEMP-STORAGE' TO DP013-PARAGRAPH         16010013
160200         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      16020013
160300                                       TO DP013-MESSAGE-TEXT(1)   16030013
160400         PERFORM DP013-0000-PROCESS-ABEND                         16040013
160500     END-IF.                                                      16050013
160600                                                                  16060013
160700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             16070013
160800                                                                  16080013
160900     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         16090013
161000         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               16100013
161100     END-IF.                                                      16110013
161200                                                                  16120013
161300                                                                  16130013
161400*----------------------------------------------------------------*16140013
161500* PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.        16150013
161600*----------------------------------------------------------------*16160013
161700 4420-FORMAT-LIST-LINES.                                          16170013
161800                                                                  16180013
161900     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      16190013
162000         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                16200013
162100         MOVE DP015-ASK-DRK-OFF TO MR-SELECTA             (PV-SUB)16210013
162200         MOVE SPACE             TO MR-SELECTI             (PV-SUB)16220013
162300                                   MR-ACTION              (PV-SUB)16230013
162400                                   MR-VENDOR-NAME         (PV-SUB)16240013
162500                                   MR-VENDOR-ID           (PV-SUB)16250013
162600                                   MR-NETWORK-NAME        (PV-SUB)16260013
162700                                   MR-PREFERRED-IND       (PV-SUB)16270013
162800                                   MR-NRFCOMP-IND         (PV-SUB)16280013
162900     ELSE                                                         16290013
163000         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      16300013
163100                                                   > SPACE        16310013
163200             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 16320013
163300                                 TO MR-SELECTI (PV-SUB)           16330013
163400         ELSE                                                     16340013
163500             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      16350013
163600                                 TO MR-SELECTI (PV-SUB)           16360013
163700         END-IF                                                   16370013
163800                                                                  16380013
163900         IF  DP030-SET-CURSOR-TRAILER                             16390013
164000             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)16400013
164100                 > SPACE)                                         16410013
164200             OR (PV-SUB = 1))                                     16420013
164300                SET DP030-SET-CURSOR-APPL-1 TO TRUE               16430013
164400                MOVE -1          TO MR-SELECTL (PV-SUB)           16440013
164500             END-IF                                               16450013
164600         END-IF                                                   16460013
164700                                                                  16470013
164800         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           16480013
164900             MOVE ASC-ACTION        (ASC-BLK-SUB ASC-ITEM-SUB)    16490013
165000                  TO MR-ACTION              (PV-SUB)              16500013
165100             MOVE ASC-VENDOR-NAME   (ASC-BLK-SUB ASC-ITEM-SUB)    16510013
165200                  TO MR-VENDOR-NAME         (PV-SUB)              16520013
165300             MOVE ASC-VENDOR-ID     (ASC-BLK-SUB ASC-ITEM-SUB)    16530013
165400                  TO MR-VENDOR-ID           (PV-SUB)              16540013
165500             MOVE ASC-NETWORK-NAME  (ASC-BLK-SUB ASC-ITEM-SUB)    16550013
165600                  TO MR-NETWORK-NAME        (PV-SUB)              16560013
165700             MOVE ASC-PREFERRED-IND (ASC-BLK-SUB ASC-ITEM-SUB)    16570013
165800                  TO MR-PREFERRED-IND       (PV-SUB)              16580013
165900             MOVE ASC-NRFCOMP-IND   (ASC-BLK-SUB ASC-ITEM-SUB)    16590013
166000                  TO MR-NRFCOMP-IND         (PV-SUB)              16600013
166100         END-IF                                                   16610013
166200     END-IF.                                                      16620013
166300                                                                  16630013
166400     SUBTRACT +1 FROM ASC-ITEM-SUB                                16640013
166500     IF  ASC-ITEM-SUB < + 1                                       16650013
166600         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  16660013
166700         MOVE +1                 TO ASC-BLK-SUB                   16670013
166800     END-IF.                                                      16680013
166900                                                                  16690013
167000                                                                  16700013
167100*-----------------------------------------------------------------16710013
167200* IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF RANGE16720013
167300* WAS SPECIFIED AND VICE-VERSA. IF ONE IS MISSING, ISSUE A        16730013
167400* WARNING.                                                        16740013
167500*-----------------------------------------------------------------16750013
167600 4430-CHECK-FOR-BEGIN-AND-END.                                    16760013
167700                                                                  16770013
167800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       16780013
167900         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     16790013
168000*            -- NO END-OF-RANGE SPECFIED ---                      16800013
168100             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            16810013
168200             SET DP020-MSG-WARNING TO TRUE                        16820013
168300             PERFORM 4431-POSITION-AT-WARNING                     16830013
168400         END-IF                                                   16840013
168500     ELSE                                                         16850013
168600         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     16860013
168700*            -- NO BEGINNING-OF-RANGE SPECFIED ---                16870013
168800             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            16880013
168900             SET DP020-MSG-WARNING TO TRUE                        16890013
169000             PERFORM 4431-POSITION-AT-WARNING                     16900013
169100         END-IF                                                   16910013
169200     END-IF.                                                      16920013
169300                                                                  16930013
169400                                                                  16940013
169500*-----------------------------------------------------------------16950013
169600* ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,     16960013
169700* DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE IS ON16970013
169800* THE CURRENT SCREEN. IF IT IS, HIGHLIGHT IT AND POSITION THE     16980013
169900* CURSOR THERE.                                                   16990013
170000*-----------------------------------------------------------------17000013
170100 4431-POSITION-AT-WARNING.                                        17010013
170200                                                                  17020013
170300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 17030013
170400                    - PV-TOP-ITEM + 1.                            17040013
170500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      17050013
170600         CONTINUE                                                 17060013
170700     ELSE                                                         17070013
170800         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      17080013
170900         MOVE -1                     TO MR-SELECTL (PV-SUB)       17090013
171000         MOVE DP015-REVERSE          TO MR-SELECTH (PV-SUB)       17100013
171100         MOVE DP015-YELLOW           TO MR-SELECTC (PV-SUB)       17110013
171200     END-IF.                                                      17120013
171300                                                                  17130013
171400     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   17140013
171500                    - PV-TOP-ITEM + 1.                            17150013
171600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      17160013
171700         CONTINUE                                                 17170013
171800     ELSE                                                         17180013
171900         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      17190013
172000         MOVE -1                     TO MR-SELECTL (PV-SUB)       17200013
172100         MOVE DP015-REVERSE          TO MR-SELECTH (PV-SUB)       17210013
172200         MOVE DP015-YELLOW           TO MR-SELECTC (PV-SUB)       17220013
172300     END-IF.                                                      17230013
172400                                                                  17240013
172500                                                                  17250013
172600*----------------------------------------------------------------*17260013
172700* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *17270013
172800* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *17280013
172900* FOR THE SELECTED ITEMS QUEUE.                                  *17290013
173000*                                                                *17300013
173100* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *17310013
173200* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *17320013
173300* THE ARRAY IS FULL.                                             *17330013
173400*----------------------------------------------------------------*17340013
173500 5000-PREPARE-SEL-QUEUE.                                          17350013
173600                                                                  17360013
173700     MOVE +1                   TO  ASC-BLK-SUB.                   17370013
173800     PERFORM 5100-WRITE-TEMP-STORAGE.                             17380013
173900     ADD +1                    TO  ASC-BLK-SUB.                   17390013
174000     PERFORM 5100-WRITE-TEMP-STORAGE.                             17400013
174100                                                                  17410013
174200     MOVE ASC-SEL-QUEUE-NAME   TO  ET300-SEL-QUEUE-NAME.          17420013
174300     PERFORM 6010-DELETE-SEL-QUEUE.                               17430013
174400                                                                  17440013
174500     SET ASC-UPDATE-TSQ        TO  TRUE.                          17450013
174600     SET ET301-IDX             TO  1.                             17460013
174700     MOVE ZERO                 TO ET300-NUMBER-OF-TS-ITEMS.       17470013
174800     INITIALIZE ET301-SELECTED-ITEM-ARRAY.                        17480013
174900                                                                  17490013
175000     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           17500013
175100             VARYING PV-ITEM                                      17510013
175200             FROM 1 BY 1                                          17520013
175300             UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN.           17530013
175400                                                                  17540013
175500     IF  ET301-IDX > 1                                            17550013
175600         PERFORM 5205-WRITE-SEL-QUEUE                             17560013
175700         ADD +1                TO ET300-NUMBER-OF-TS-ITEMS        17570013
175800     END-IF.                                                      17580013
175900                                                                  17590013
176000                                                                  17600013
176100*----------------------------------------------------------------*17610013
176200* WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE. REWRITE  17620013
176300* AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.                17630013
176400*----------------------------------------------------------------*17640013
176500 5100-WRITE-TEMP-STORAGE.                                         17650013
176600                                                                  17660013
176700     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     17670013
176800                                   TO PV-LIST-ITEM-NUMBER.        17680013
176900     COMPUTE PV-BLOCK-NUMBER =                                    17690013
177000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    17700013
177100                                                                  17710013
177200     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             17720013
177300     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             17730013
177400         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      17740013
177500             PERFORM 5105-REWRITE-ASC-LISTQ                       17750013
177600         END-IF                                                   17760013
177700     ELSE                                                         17770013
177800         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       17780013
177900         ASC-HIGHEST-BLOCK-WRITTEN + 1                            17790013
178000         PERFORM 5110-WRITE-ASC-LISTQ                             17800013
178100         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   17810013
178200     END-IF.                                                      17820013
178300                                                                  17830013
178400     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             17840013
178500                                                                  17850013
178600                                                                  17860013
178700******************************************************************17870013
178800* REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       17880013
178900* SPECIFIC COMMAREA.                                              17890013
179000******************************************************************17900013
179100 5105-REWRITE-ASC-LISTQ.                                          17910013
179200                                                                  17920013
179300     EXEC CICS                                                    17930013
179400         WRITEQ TS                                                17940013
179500             QUEUE (ASC-LIST-QUEUE-NAME)                          17950013
179600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               17960013
179700             ITEM  (PV-BLOCK-NUMBER)                              17970013
179800             REWRITE                                              17980013
179900             RESP  (PV-CICS-RESP)                                 17990013
180000     END-EXEC.                                                    18000013
180100                                                                  18010013
180200     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           18020013
180300         CONTINUE                                                 18030013
180400     ELSE                                                         18040013
180500         SET DP013-CICS-ABEND            TO TRUE                  18050013
180600         SET DP013-NO-ROLLBACK           TO TRUE                  18060013
180700         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       18070013
180800         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     18080013
180900                                         TO DP013-MESSAGE-TEXT(1) 18090013
181000         PERFORM DP013-0000-PROCESS-ABEND                         18100013
181100     END-IF.                                                      18110013
181200                                                                  18120013
181300                                                                  18130013
181400*-----------------------------------------------------------------18140013
181500* WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-SPECIFIC 18150013
181600* COMMAREA.                                                       18160013
181700*-----------------------------------------------------------------18170013
181800 5110-WRITE-ASC-LISTQ.                                            18180013
181900                                                                  18190013
182000     EXEC CICS                                                    18200013
182100         WRITEQ TS                                                18210013
182200             QUEUE (ASC-LIST-QUEUE-NAME)                          18220013
182300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               18230013
182400             ITEM  (PV-BLOCK-NUMBER)                              18240013
182500             RESP  (PV-CICS-RESP)                                 18250013
182600     END-EXEC.                                                    18260013
182700                                                                  18270013
182800     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      18280013
182900         SET DP013-CICS-ABEND      TO TRUE                        18290013
183000         SET DP013-NO-ROLLBACK     TO TRUE                        18300013
183100         MOVE '5110-WRITE-ASC-LISTQ'                              18310013
183200                                   TO DP013-PARAGRAPH             18320013
183300         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           18330013
183400                                   TO DP013-MESSAGE-TEXT(1)       18340013
183500         PERFORM DP013-0000-PROCESS-ABEND                         18350013
183600     END-IF.                                                      18360013
183700                                                                  18370013
183800                                                                  18380013
183900*----------------------------------------------------------------*18390013
184000* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *18400013
184100* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *18410013
184200*----------------------------------------------------------------*18420013
184300 5200-FILL-SEL-QUEUE-RECORD.                                      18430013
184400                                                                  18440013
184500     PERFORM 6112-READ-LIST-QUEUE.                                18450013
184600                                                                  18460013
184700     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       18470013
184800         PERFORM                                                  18480013
184900         VARYING LQW-IDX                                          18490013
185000         FROM 1 BY 1                                              18500013
185100         UNTIL LQW-IDX > PC-ITEMS-PER-PANEL                       18510013
185200           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO              18520013
185300                                                                  18530013
185400             IF  LQW-SELECT (LQW-IDX)                             18540013
185500                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              18550013
185600                                TO ET301-ITEM         (ET301-IDX) 18560013
185700                 MOVE LQW-NETWORK-ID (LQW-IDX)                    18570013
185800                                TO ET301-NETWK-ID     (ET301-IDX) 18580013
185900                 MOVE LQW-NRFCOMP-IND (LQW-IDX)                   18590013
186000                                TO ET301-NRFC-ID      (ET301-IDX) 18600013
186100                 MOVE LQW-ENT-ID     (LQW-IDX)                    18610013
186200                                TO ET301-ENT-ID       (ET301-IDX) 18620013
186300                 MOVE LQW-VENDOR-NAME (LQW-IDX)                   18630013
186400                                TO ET301-VENDOR-NAME  (ET301-IDX) 18640013
186500                 MOVE SPACE     TO ET301-ACTION-SW    (ET301-IDX) 18650013
186600                 SET ET301-IDX UP BY 1                            18660013
186700                 IF  ET301-IDX > ET301-MAX-ITEMS                  18670013
186800                     PERFORM 5205-WRITE-SEL-QUEUE                 18680013
186900                     ADD +1        TO ET300-NUMBER-OF-TS-ITEMS    18690013
187000                     INITIALIZE ET301-SELECTED-ITEM-ARRAY         18700013
187100                     SET ET301-IDX TO  1                          18710013
187200                 END-IF                                           18720013
187300             END-IF                                               18730013
187400         END-PERFORM                                              18740013
187500     END-IF.                                                      18750013
187600                                                                  18760013
187700                                                                  18770013
187800*----------------------------------------------------------------*18780013
187900*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *18790013
188000*----------------------------------------------------------------*18800013
188100 5205-WRITE-SEL-QUEUE.                                            18810013
188200                                                                  18820013
188300     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO ET301-SELECTED-ITEMS.   18830013
188400                                                                  18840013
188500     EXEC CICS                                                    18850013
188600          WRITEQ TS                                               18860013
188700              QUEUE (ASC-SEL-QUEUE-NAME)                          18870013
188800              FROM  (ET301-SELECTED-VNDRS)                        18880013
188900              ITEM  (PV-SEL-QUEUE-ITEM)                           18890013
189000              RESP  (PV-CICS-RESP)                                18900013
189100     END-EXEC.                                                    18910013
189200                                                                  18920013
189300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          18930013
189400         CONTINUE                                                 18940013
189500     ELSE                                                         18950013
189600         SET DP013-CICS-ABEND                                     18960013
189700             DP013-NO-ROLLBACK     TO TRUE                        18970013
189800         MOVE '5205-WRITE-SEL-QUEUE'                              18980013
189900                                   TO DP013-PARAGRAPH             18990013
190000         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          19000013
190100                                   TO DP013-MESSAGE-TEXT(1)       19010013
190200         PERFORM DP013-0000-PROCESS-ABEND                         19020013
190300     END-IF.                                                      19030013
190400                                                                  19040013
190500                                                                  19050013
190600*-----------------------------------------------------------------19060013
190700* WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,    19070013
190800* SET UP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY. EDIT THE19080013
190900* SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO THE USER. 19090013
191000******************************************************************19100013
191100 6000-REFRESH-PANEL-FROM-TEMP.                                    19110013
191200                                                                  19120013
191300     IF  ASC-UPDATE-TSQ                                           19130013
191400         SET ASC-NO-TSQ-UPDATE TO TRUE                            19140013
191500         MOVE ZERO             TO PV-SAVE-ITEM                    19150013
191600                                  PV-SEL-QUEUE-ITEM               19160013
191700         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        19170013
191800                                   TO PV-HOLD-SELECTED-ITEMS      19180013
191900         PERFORM 6100-UPDATE-TSQ                                  19190013
192000             UNTIL PV-ITEMS-PROCESSED >                           19200013
192100                                     ASC-NUMBER-OF-SELECTED-ITEMS 19210013
192200         PERFORM 6010-DELETE-SEL-QUEUE                            19220013
192300         INITIALIZE ASC-BLOCK-ENTRIES (1)                         19230013
192400                    ASC-BLOCK-ENTRIES (2)                         19240013
192500                                                                  19250013
192600         DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 19260013
192700                GIVING PV-BLOCK-NUMBER                            19270013
192800                REMAINDER PV-REMAINDER                            19280013
192900         IF  PV-REMAINDER > ZERO                                  19290013
193000             ADD +1     TO PV-BLOCK-NUMBER                        19300013
193100         END-IF                                                   19310013
193200         MOVE +1        TO ASC-BLK-SUB                            19320013
193300         PERFORM 4410-READ-TEMP-STORAGE                           19330013
193400         ADD +1         TO ASC-BLK-SUB                            19340013
193500                           PV-BLOCK-NUMBER                        19350013
193600         PERFORM 4410-READ-TEMP-STORAGE                           19360013
193700     END-IF.                                                      19370013
193800                                                                  19380013
193900                                                                  19390013
194000*----------------------------------------------------------------*19400013
194100*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *19410013
194200*----------------------------------------------------------------*19420013
194300 6010-DELETE-SEL-QUEUE.                                           19430013
194400                                                                  19440013
194500     EXEC CICS                                                    19450013
194600         DELETEQ TS                                               19460013
194700             QUEUE (ASC-SEL-QUEUE-NAME)                           19470013
194800             RESP  (PV-CICS-RESP)                                 19480013
194900     END-EXEC.                                                    19490013
195000                                                                  19500013
195100     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      19510013
195200        (PV-CICS-RESP = DFHRESP(QIDERR)))                         19520013
195300         CONTINUE                                                 19530013
195400     ELSE                                                         19540013
195500         SET DP013-CICS-ABEND                                     19550013
195600             DP013-NO-ROLLBACK TO TRUE                            19560013
195700         MOVE '6010-DELETE-SEL-QUEUE'                             19570013
195800                        TO DP013-PARAGRAPH                        19580013
195900         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         19590013
196000                        TO DP013-MESSAGE-TEXT (1)                 19600013
196100         PERFORM DP013-0000-PROCESS-ABEND                         19610013
196200     END-IF.                                                      19620013
196300                                                                  19630013
196400                                                                  19640013
196500*----------------------------------------------------------------*19650013
196600* INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE. LOOP     19660013
196700* THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER TO BE USED19670013
196800* TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN THE TEMP QUEUE.   19680013
196900*----------------------------------------------------------------*19690013
197000 6100-UPDATE-TSQ.                                                 19700013
197100                                                                  19710013
197200     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             19720013
197300     PERFORM 6105-READ-SEL-QUEUE.                                 19730013
197400     PERFORM                                                      19740013
197500         VARYING ET301-IDX                                        19750013
197600         FROM 1 BY 1                                              19760013
197700         UNTIL ((PV-ITEMS-PROCESSED >                             19770013
197800                              PV-HOLD-SELECTED-ITEMS)             19780013
197900         OR (ET301-IDX > ET301-MAX-ITEMS))                        19790013
198000         IF  ET301-ACTION-SW (ET301-IDX) > SPACE                  19800013
198100             PERFORM 6110-PROCESS-ITEMS                           19810013
198200         END-IF                                                   19820013
198300         ADD +1                TO PV-ITEMS-PROCESSED              19830013
198400     END-PERFORM.                                                 19840013
198500                                                                  19850013
198600     PERFORM 6111-WRITE-LIST-QUEUE.                               19860013
198700                                                                  19870013
198800                                                                  19880013
198900*----------------------------------------------------------------*19890013
199000* READ THE LIST QUEUE RECORD.                                     19900013
199100*----------------------------------------------------------------*19910013
199200 6105-READ-SEL-QUEUE.                                             19920013
199300                                                                  19930013
199400     EXEC CICS                                                    19940013
199500          READQ TS                                                19950013
199600              QUEUE (ASC-SEL-QUEUE-NAME)                          19960013
199700              INTO  (ET301-SELECTED-VNDRS)                        19970013
199800              ITEM  (PV-SEL-QUEUE-ITEM)                           19980013
199900              RESP  (PV-CICS-RESP)                                19990013
200000     END-EXEC.                                                    20000013
200100                                                                  20010013
200200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          20020013
200300         CONTINUE                                                 20030013
200400     ELSE                                                         20040013
200500         SET DP013-CICS-ABEND                                     20050013
200600             DP013-NO-ROLLBACK     TO  TRUE                       20060013
200700         MOVE '6105-READ-SEL-QUEUE'                               20070013
200800                                   TO  DP013-PARAGRAPH            20080013
200900         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           20090013
201000                                   TO  DP013-MESSAGE-TEXT(1)      20100013
201100         PERFORM DP013-0000-PROCESS-ABEND                         20110013
201200     END-IF.                                                      20120013
201300                                                                  20130013
201400                                                                  20140013
201500*----------------------------------------------------------------*20150013
201600* CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.    20160013
201700* REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE THE20170013
201800* LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.                   20180013
201900*----------------------------------------------------------------*20190013
202000 6110-PROCESS-ITEMS.                                              20200013
202100                                                                  20210013
202200     COMPUTE PV-ITEM = 1 + ((ET301-ITEM (ET301-IDX) - 1)          20220013
202300                     / PC-ITEMS-PER-PANEL).                       20230013
202400                                                                  20240013
202500     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           20250013
202600         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          20260013
202700             PERFORM 6111-WRITE-LIST-QUEUE                        20270013
202800         END-IF                                                   20280013
202900         MOVE PV-ITEM          TO PV-SAVE-ITEM                    20290013
203000                                                                  20300013
203100         PERFORM 6112-READ-LIST-QUEUE                             20310013
203200         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               20320013
203300             CONTINUE                                             20330013
203400         END-IF                                                   20340013
203500     END-IF.                                                      20350013
203600                                                                  20360013
203700     COMPUTE PV-SUB = (ET301-ITEM (ET301-IDX)                     20370013
203800                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              20380013
203900     SET LQW-DESELECT (PV-SUB) TO    TRUE                         20390013
204000     MOVE LQW-SELECTED-SW (PV-SUB)                                20400013
204100                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  20410013
204200     EVALUATE TRUE                                                20420013
204300                                                                  20430013
204400         WHEN ET301-INQ (ET301-IDX)                               20440013
204500              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             20450013
204600                                                                  20460013
204700         WHEN ET301-UPD (ET301-IDX)                               20470013
204800              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             20480013
204900                                                                  20490013
205000         WHEN ET301-DEL (ET301-IDX)                               20500013
205100              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             20510013
205200                                                                  20520013
205300     END-EVALUATE.                                                20530013
205400                                                                  20540013
205500     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                20550013
205600                                                                  20560013
205700                                                                  20570013
205800*----------------------------------------------------------------*20580013
205900*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *20590013
206000*----------------------------------------------------------------*20600013
206100 6111-WRITE-LIST-QUEUE.                                           20610013
206200                                                                  20620013
206300     EXEC CICS                                                    20630013
206400         WRITEQ TS                                                20640013
206500             QUEUE (ASC-LIST-QUEUE-NAME)                          20650013
206600             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     20660013
206700             ITEM  (PV-SAVE-ITEM)                                 20670013
206800             REWRITE                                              20680013
206900             RESP  (PV-CICS-RESP)                                 20690013
207000     END-EXEC.                                                    20700013
207100                                                                  20710013
207200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          20720013
207300         CONTINUE                                                 20730013
207400     ELSE                                                         20740013
207500         SET DP013-CICS-ABEND  TO  TRUE                           20750013
207600         SET DP013-NO-ROLLBACK TO  TRUE                           20760013
207700         MOVE '6111-WRITE-LIST-QUEUE'                             20770013
207800                               TO  DP013-PARAGRAPH                20780013
207900         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  20790013
208000                               TO  DP013-MESSAGE-TEXT(1)          20800013
208100         PERFORM DP013-0000-PROCESS-ABEND                         20810013
208200     END-IF.                                                      20820013
208300                                                                  20830013
208400                                                                  20840013
208500*----------------------------------------------------------------*20850013
208600*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*20860013
208700*----------------------------------------------------------------*20870013
208800 6112-READ-LIST-QUEUE.                                            20880013
208900                                                                  20890013
209000     EXEC CICS                                                    20900013
209100         READQ TS                                                 20910013
209200             QUEUE (ASC-LIST-QUEUE-NAME)                          20920013
209300             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     20930013
209400             ITEM  (PV-ITEM)                                      20940013
209500             RESP  (PV-CICS-RESP)                                 20950013
209600     END-EXEC.                                                    20960013
209700                                                                  20970013
209800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          20980013
209900         CONTINUE                                                 20990013
210000     ELSE                                                         21000013
210100         SET DP013-CICS-ABEND                                     21010013
210200             DP013-NO-ROLLBACK       TO TRUE                      21020013
210300         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           21030013
210400         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    21040013
210500                                     TO DP013-MESSAGE-TEXT(1)     21050013
210600         PERFORM DP013-0000-PROCESS-ABEND                         21060013
210700     END-IF.                                                      21070013
210800                                                                  21080013
210900                                                                  21090013
211000*----------------------------------------------------------------*21100013
211100*    ABEND PROCESSOR MODULE                                      *21110013
211200*----------------------------------------------------------------*21120013
211300                                                                  21130013
211400     COPY DPPD013.                                                21140013
