000100 IDENTIFICATION DIVISION.                                         00010005
000200 TITLE 'MANIFESTING - CONVEYOR CUTOFF CRIT-SPEC SCREEN'.          00020005
000300                                                                  00030005
000400 PROGRAM-ID.             PCKRF872.                                00040005
000500 AUTHOR.                 DENNIS STEFFEN.                          00050005
000600 INSTALLATION.           KOHLS.                                   00060005
000700 DATE-WRITTEN.           MAY, 2001.                               00070005
000800 DATE-COMPILED.                                                   00080005
000900                                                                  00090005
001000* THIS PROGRAM IDENTIFIES THE CONVEYOR LINE THAT IS TO BE         00100005
001100* MARKED WITH A BEGINNING OR ENDING CARTON ID                     00110005
001200                                                                  00120005
001300 ENVIRONMENT DIVISION.                                            00130005
001400 DATA DIVISION.                                                   00140005
001500                                                                  00150005
001600 WORKING-STORAGE SECTION.                                         00160005
001700                                                                  00170005
001710 01  DK-DB2-KEYS.                                                 00171008
001720     05  DK-OPER-UNT-ID               PIC S9(04) VALUE 0 COMP.    00172008
001800 01  PC-PROGRAM-CONSTANTS.                                        00180005
001900     05  PC-TRANID                    PIC X(04) VALUE 'E872'.     00190005
002000     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'PCKRF872'. 00200005
002100     05  PC-TRLR-STATUS-PGM           PIC X(08) VALUE 'PCKCS896'. 00210005
002200     05  PC-RAND-PGM                  PIC X(08) VALUE 'DPKUT902'. 00220005
002300     05  PC-DUMMY-TIMESTAMP           PIC X(26) VALUE             00230005
002400            '9999-09-09-09.09.09.999999'.                         00240005
002500                                                                  00250005
002600                                                                  00260005
002700* ERROR MESSAGES                                                 *00270005
002800     05  PC-UNRECOGNIZED-PF-KEY-MSG   PIC X(19) VALUE             00280005
002900                                           'UNRECOGNIZED PF KEY'. 00290005
003000     05  PC-ENTER-THROUGH-MENU-MSG    PIC X(19) VALUE             00300005
003100                                           'ENTER THROUGH MENU '. 00310005
003200     05  PC-TRANS-UNAVAILABLE-MSG     PIC X(19) VALUE             00320005
003300                                           'TRANS NOT AVAILABLE'. 00330005
003400     05  PC-WRONG-FACILITY            PIC X(19) VALUE             00340005
003500                                           'WRG FCLTY - F2 CONF'. 00350005
003600                                                                  00360005
003700 01  PS-PROGRAM-SWITCHES.                                         00370005
003800     05  PS-ERROR-SW                  PIC X(01)  VALUE 'N'.       00380005
003900         88  PS-ERRORS-YES                        VALUE 'Y'.      00390005
004000         88  PS-ERRORS-NO                         VALUE 'N'.      00400005
004100     05  PS-XCTL-SW                   PIC X(04)   VALUE SPACES.   00410005
004200         88  PS-XCTL-E871                       VALUE 'E871'.     00420005
004300         88  PS-XCTL-E873                       VALUE 'E873'.     00430005
004400         88  PS-XCTL-E874                       VALUE 'E874'.     00440005
004500     05  PS-VALID-INPUT-SW            PIC X(01) VALUE 'N'.        00450005
004600         88  PS-VALID-INPUT                       VALUE 'Y'.      00460005
004700         88  PS-INVALID-INPUT                     VALUE 'N'.      00470005
004800     05  PS-TCNTRID-SW                PIC X(01) VALUE 'N'.        00480005
004900         88  PS-TCNTRID-YES                       VALUE 'Y'.      00490005
005000         88  PS-TCNTRID-NO                        VALUE 'N'.      00500005
005100     05  PS-TCNDCDR-SW                PIC X(01) VALUE 'N'.        00510005
005200         88  PS-TCNDCDR-YES                       VALUE 'Y'.      00520005
005300         88  PS-TCNDCDR-NO                        VALUE 'N'.      00530005
005400     05  PS-TRLR-OPEN-SW              PIC X(04) VALUE SPACES.     00540005
005500         88  PS-TRLR-OPEN-THIS-DOOR             VALUE 'THIS'.     00550005
005600         88  PS-TRLR-OPEN-DIFF-DOOR             VALUE 'DIFF'.     00560005
005700     05  PS-STORE-DOOR-SW             PIC X(01) VALUE SPACES.     00570005
005800         88  PS-NO-DOORS-THIS-STORE             VALUE 'N'.        00580005
005900         88  PS-ONE-DOOR-THIS-STORE             VALUE 'O'.        00590005
006000         88  PS-MLT-DOORS-THIS-STORE            VALUE 'M'.        00600005
006100     05  PC-STORE-DOOR-CSR-SW         PIC X(01) VALUE 'N'.        00610005
006200         88  PS-END-STORE-DOOR-CSR              VALUE 'Y'.        00620005
006300         88  PS-NOT-END-STORE-DOOR-CSR          VALUE 'N'.        00630005
006400     05  PS-DOOR-DEST-EDIT-SW         PIC X(01) VALUE 'Y'.        00640005
006500         88  PS-SKIP-DOOR-DEST-EDITS            VALUE 'N'.        00650005
006600         88  PS-DO-DOOR-DEST-EDITS              VALUE 'Y'.        00660005
006700     05  PS-SERIAL-SW                 PIC X(01) VALUE 'N'.        00670005
006800         88  PS-SERIAL-NO                       VALUE 'N'.        00680005
006900         88  PS-SERIAL-YES                      VALUE 'Y'.        00690005
007000     05  PS-ACTIVE-TRIP-SW            PIC X(01) VALUE 'N'.        00700005
007100         88  PS-ACTIVE-TRIP-EXISTS              VALUE 'Y'.        00710005
007200         88  PS-NO-ACTIVE-TRIP-EXISTS           VALUE 'N'.        00720005
007210     05  PS-MULT-DOORS-ALLOWED-SW     PIC X(01) VALUE 'N'.        00721007
007220         88  PS-MULT-DOORS-ALLOWED              VALUE 'Y'.        00722007
007230         88  PS-NO-MULT-DOORS                   VALUE 'N'.        00723007
007300                                                                  00730005
007400 01  PV-PROGRAM-VARIABLES.                                        00740005
007500     05  PV-DOOR-COUNT                PIC S9(03) COMP-3.          00750005
007600     05  PV-DB2-COUNT                 PIC S9(07) COMP-3.          00760010
007700     05  PV-COMMAREA-LENGTH           PIC S9(04)  VALUE +0        00770005
007800                                                     COMP SYNC.   00780005
007900     05  PV-MESSAGE-AREA              PIC  X(19)  VALUE SPACE.    00790005
008000     05  PV-CICS-RESPONSE             PIC S9(09)  VALUE ZEROS     00800005
008100                                                     COMP SYNC.   00810005
008200     05  PV-TRANSFER-PROGRAM          PIC  X(08)  VALUE SPACE.    00820005
008300                                                                  00830005
008400 01  PV-LOG-MSG.                                                  00840005
008500     05  FILLER                       PIC X(12) VALUE             00850005
008600         ' E872 ERROR '.                                          00860005
008700     05  FILLER                       PIC X(06) VALUE             00870005
008800         'USER= '.                                                00880005
008900     05  PV-USER-ID                   PIC X(08) VALUE SPACES.     00890005
009000     05  FILLER                       PIC X(10) VALUE             00900005
009100         ' SQLCODE= '.                                            00910005
009200     05  PV-SQLCODE                   PIC -9(03).                 00920005
009300     05  FILLER                       PIC X(06) VALUE             00930005
009400         ' ERR= '.                                                00940005
009500     05  PV-ERROR-NBR                 PIC 9(03) VALUE ZERO.       00950005
009600     05  FILLER                       PIC X(07) VALUE             00960005
009700         ' DOOR= '.                                               00970005
009800     05  PV-DISPLAY-DOOR              PIC X(04) VALUE ZEROES.     00980005
009900/                                                                 00990005
010000 01  PV-EDITING-FIELDS.                                           01000005
010100     05  PV-SCREEN-DOOR               PIC X(04).                  01010005
010200     05  PV-SCREEN-DEST               PIC X(04).                  01020005
010300     05  PV-SCREEN-SERIAL-NBR         PIC X(09).                  01030005
010410                                                                  01041009
010420     05  PV-DISPLAY-DOOR-ID           PIC  X(04)  VALUE SPACE.    01042009
010430     05  PV-DISPLAY-OPER              PIC  9(04)  VALUE ZEROES.   01043009
010440     05  PV-DISPLAY-DEST              PIC  9(04)  VALUE ZEROES.   01044009
010450     05  PV-DISPLAY-SRL-NBR           PIC  9(09)  VALUE ZEROES.   01045009
010460     05  PV-DISPLAY-SCAC              PIC  X(04)  VALUE SPACES.   01046009
010470     05  PV-DISPLAY-TRLR-ID           PIC  X(12)  VALUE ZEROES.   01047009
010480     05  PV-DISPLAY-TRIP              PIC  9(09)  VALUE ZEROES.   01048009
010490                                                                  01049009
010500/                                                                 01050005
010600 01  CA-COMMAREA.                                                 01060005
010700     COPY PCWS233.                                                01070005
010800     05  CA-PRIVATE-COMMAREA          PIC X(100).                 01080005
010900     05  CA-REDEFINED-COMMAREA REDEFINES CA-PRIVATE-COMMAREA.     01090005
011000         10  CA-CURR-DOOR             PIC X(04).                  01100005
011100         10  CA-CURR-DEST             PIC 9(04).                  01110005
011200         10  CA-CURR-SERIAL-NBR       PIC 9(09).                  01120005
011300/                                                                 01130005
011400*  MAP LAYOUT                                                     01140005
011500     COPY PCKM872.                                                01150005
011600                                                                  01160005
011700*  TRAILER STATUS COPYBOOK                                        01170005
011800     COPY PCWS048.                                                01180005
011900                                                                  01190005
012000* HELP SCREEN COMMAREA                                            01200005
012100     COPY PCWS192.                                                01210005
012200* HELP SCREEN WORK AREA                                           01220005
012300     COPY PCWS188.                                                01230005
012400/                                                                 01240005
012500     COPY DPWS010I.                                               01250005
012600*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   01260005
012700     COPY DPWS015.                                                01270005
012800                                                                  01280005
012900*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      01290005
013000     COPY DFHAID.                                                 01300005
013100                                                                  01310005
013200*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               01320005
013300     COPY DPWS013.                                                01330005
013400                                                                  01340005
013500*  RANDOM NUMBER ROUTINE                                          01350005
013600     COPY DPWS902.                                                01360005
013700                                                                  01370005
013800/                                                                 01380005
013900*    DC DOOR MASTER                                               01390005
014000     EXEC SQL                                                     01400005
014100         INCLUDE TCNDCDR                                          01410005
014200     END-EXEC.                                                    01420005
014300                                                                  01430005
014400*    DC DOOR TYPES                                                01440005
014500     EXEC SQL                                                     01450005
014600         INCLUDE TCNDRTY                                          01460005
014700     END-EXEC.                                                    01470005
014800                                                                  01480005
014900*    DC DOOR/STORE CONNECTION                                     01490005
015000     EXEC SQL                                                     01500005
015100         INCLUDE TCNDRST                                          01510005
015200     END-EXEC.                                                    01520005
015300                                                                  01530005
015400*    TRAILER ID MASTER                                            01540005
015500     EXEC SQL                                                     01550005
015600         INCLUDE TCNTRID                                          01560005
015700     END-EXEC.                                                    01570005
015800                                                                  01580005
015900*    OUTBOUND TRAILER TRIP                                        01590005
016000     EXEC SQL                                                     01600005
016100         INCLUDE TSUOBTR                                          01610005
016200     END-EXEC.                                                    01620005
016300                                                                  01630005
016400*    OUTBOUND TRAILER TRIP STATUS                                 01640005
016500     EXEC SQL                                                     01650005
016600         INCLUDE TSUOBTS                                          01660005
016700     END-EXEC.                                                    01670005
016800                                                                  01680005
016900*  CARTON DIVERT TO OUTBOUND TRIP ASSOCIATION                     01690005
017000     EXEC SQL                                                     01700005
017100         INCLUDE TSUCDOT                                          01710005
017200     END-EXEC.                                                    01720005
017300                                                                  01730005
017400*  CARTON DIVERT MASTER                                           01740005
017500     EXEC SQL                                                     01750005
017600         INCLUDE TSUCRDV                                          01760005
017700     END-EXEC.                                                    01770005
017800                                                                  01780007
017810*  PARAMETER DATABASE                                             01781007
017820     EXEC SQL                                                     01782007
017830         INCLUDE TKRPRPM                                          01783007
017840     END-EXEC.                                                    01784007
017850                                                                  01785007
017860                                                                  01786007
017900*    LIST ALL DOORS THAT SERVICE A STORE.  A STORE SHOULD ONLY    01790005
018000*    BE ASSIGNED TO ONE DOOR BUT A DOOR CAN SERVE MULTIPLE STORES 01800005
018100*    ALTHOUGH IT USUALLY SERVES ONLY ONE.                         01810005
018200                                                                  01820005
018300     EXEC SQL                                                     01830005
018400         DECLARE STORE-DOOR-CSR CURSOR FOR                        01840005
018500         SELECT                                                   01850005
018600             DRST.DOOR_ID                                         01860005
018700         FROM TCNDRST DRST                                        01870005
018800         ,    TCNDCDR DCDR                                        01880005
018900         ,    TCNDRTY DRTY                                        01890005
019000         WHERE                                                    01900005
019100             DRST.OPER_UNT_ID         = :PC233-OPER-UNT-ID        01910005
019200         AND DRST.STR_NBR             = :PC233-STR-NBR            01920005
019300         AND DCDR.DOOR_ID             = DRST.DOOR_ID              01930005
019400         AND DRST.OPER_UNT_ID         = DCDR.OPER_UNT_ID          01940005
019500         AND DCDR.DOOR_TYP_CDE IN ('SH', 'DS')                    01950005
019600         AND CURRENT TIMESTAMP BETWEEN                            01960005
019700              DRST.STRT_TMST AND DRST.END_TMST                    01970005
019800         AND DCDR.DOOR_TYP_CDE        = DRTY.DOOR_TYP_CDE         01980005
019900         AND DRTY.DIVERT_TYP_CDE      = 'D'                       01990005
020000         FOR FETCH ONLY                                           02000005
020100     END-EXEC.                                                    02010005
020200                                                                  02020005
020300                                                                  02030005
020400     EXEC SQL                                                     02040005
020500         INCLUDE SQLCA                                            02050005
020600     END-EXEC.                                                    02060005
020700                                                                  02070005
020800 LINKAGE SECTION.                                                 02080005
020900 01  DFHCOMMAREA.                                                 02090005
021000     05  FILLER                         OCCURS  1 TO 4072 TIMES   02100005
021100                                      DEPENDING ON EIBCALEN.      02110005
021200         10  FILLER                   PIC X.                      02120005
021300/                                                                 02130005
021400 PROCEDURE DIVISION.                                              02140005
021500 0000-PROGRAM-MAINLINE.                                           02150005
021600                                                                  02160005
021700     INITIALIZE CA-COMMAREA                                       02170005
021800     MOVE DFHCOMMAREA                 TO CA-COMMAREA              02180005
021900                                                                  02190005
022000     EVALUATE TRUE                                                02200005
022100         WHEN EIBCALEN = ZERO                                     02210005
022200             MOVE PC-ENTER-THROUGH-MENU-MSG                       02220005
022300                                      TO PV-MESSAGE-AREA          02230005
022400             PERFORM 8110-RETURN                                  02240005
022500                                                                  02250005
022600         WHEN EIBTRNID = 'Z278'                                   02260005
022700*            RETURNING FROM F1 HELP INFO SCREEN                   02270005
022800             MOVE DFHCOMMAREA         TO PC192-COMMAREA           02280005
022900             MOVE PC192-HOST-SAVE-AREA                            02290005
023000                                      TO CA-COMMAREA              02300005
023100             SET PC233-PROCESS-SCREEN TO TRUE                     02310005
023200             MOVE PC192-HOST-SAVE-MAP TO PC872AO                  02320005
023300             MOVE -1                  TO ADOORL                   02330005
023400             PERFORM 8000-SEND-MAP                                02340005
023500             PERFORM 8100-RETURN-TRANID                           02350005
023600                                                                  02360005
023700         WHEN PC233-INITIALIZE-SCREEN                             02370005
023800         WHEN EIBAID = DFHCLEAR                                   02380005
023900             SET PC233-PROCESS-SCREEN TO TRUE                     02390005
024000             PERFORM 1000-INITIALIZE                              02400005
024100             PERFORM 8000-SEND-MAP                                02410005
024200             PERFORM 8100-RETURN-TRANID                           02420005
024300                                                                  02430005
024400         WHEN EIBAID = DFHPF3                                     02440005
024500             MOVE PC233-MENU-PROGRAM  TO PV-TRANSFER-PROGRAM      02450005
024600             PERFORM 8200-XCTL                                    02460005
024700                                                                  02470005
024800         WHEN EIBAID = DFHPF4                                     02480005
024900*            UPDATE DATABASE                                      02490005
025000             PERFORM 8020-RECEIVE-MAP                             02500005
025100             PERFORM 2100-EDIT-INPUT                              02510005
025200                                                                  02520005
025300*            THIS PROGRAM DOESN'T DO ANY PROCESSING.  THE         02530005
025400*            ACTUAL CUTOFF IS DONE BY PCKRF874                    02540005
025500                                                                  02550005
025600             IF PS-ERRORS-NO                                      02560005
025700                 IF PS-XCTL-E873                                  02570005
025800                     MOVE 'PCKRF873'  TO PV-TRANSFER-PROGRAM      02580005
025900                     MOVE 'PCKRF869'  TO PC233-MENU-PROGRAM       02590005
026000                     MOVE 'PCKRF869'  TO PC233-NEXT-PROGRAM       02600005
026100                     MOVE 'PCKRF872'  TO PC233-ROOT-PROGRAM       02610005
026200                     PERFORM 8200-XCTL                            02620005
026300                 ELSE                                             02630005
026400                     MOVE 'PCKRF874'  TO PV-TRANSFER-PROGRAM      02640005
026500                     MOVE 'PCKRF869'  TO PC233-MENU-PROGRAM       02650005
026600                     MOVE 'PCKRF872'  TO PC233-ROOT-PROGRAM       02660005
026700                     PERFORM 8200-XCTL                            02670005
026800                 END-IF                                           02680005
026900             ELSE                                                 02690005
027000                 IF PS-XCTL-E871                                  02700005
027100                     PERFORM 8210-XCTL-ERROR-SCREEN               02710005
027200                 ELSE                                             02720005
027300                     PERFORM 8010-SEND-DATA-ONLY                  02730005
027400                     PERFORM 8100-RETURN-TRANID                   02740005
027500                 END-IF                                           02750005
027600             END-IF                                               02760005
027700                                                                  02770005
027800         WHEN EIBAID = DFHPF8                                     02780005
027900             MOVE 'PCKRF880'          TO PV-TRANSFER-PROGRAM      02790005
028000             PERFORM 8200-XCTL                                    02800005
028100                                                                  02810005
028200         WHEN EIBAID = DFHPF9                                     02820005
028300             MOVE 'PCKRF743'          TO PV-TRANSFER-PROGRAM      02830005
028400             PERFORM 8200-XCTL                                    02840005
028500                                                                  02850005
028600         WHEN EIBAID = DFHENTER                                   02860005
028700*            EDIT ONLY                                            02870005
028800             PERFORM 8020-RECEIVE-MAP                             02880005
028900             PERFORM 2100-EDIT-INPUT                              02890005
029000                                                                  02900005
029100             IF PS-ERRORS-YES                                     02910005
029200                 IF PS-XCTL-E871                                  02920005
029300                     PERFORM 8210-XCTL-ERROR-SCREEN               02930005
029400                 ELSE                                             02940005
029500*                    MOVE -1              TO ADOORL               02950005
029600                     PERFORM 8010-SEND-DATA-ONLY                  02960005
029700                     PERFORM 8100-RETURN-TRANID                   02970005
029800                 END-IF                                           02980005
029900             ELSE                                                 02990005
030000                 MOVE -1                  TO ADOORL               03000005
030100                 PERFORM 8010-SEND-DATA-ONLY                      03010005
030200                 PERFORM 8100-RETURN-TRANID                       03020005
030300             END-IF                                               03030005
030400                                                                  03040005
030500         WHEN EIBAID = DFHPF1                                     03050005
030600             PERFORM 8020-RECEIVE-MAP                             03060005
030700             MOVE PC872AO             TO PC192-HOST-SAVE-MAP      03070005
030800             PERFORM 1200-HELP-SCREEN                             03080005
030900                                                                  03090005
031000         WHEN OTHER                                               03100005
031100             PERFORM 8020-RECEIVE-MAP                             03110005
031200             MOVE -1                  TO ADOORL                   03120005
031300             MOVE PC-UNRECOGNIZED-PF-KEY-MSG                      03130005
031400                                      TO AMSGLNO                  03140005
031500             PERFORM 8000-SEND-MAP                                03150005
031600             PERFORM 8100-RETURN-TRANID                           03160005
031700     END-EVALUATE.                                                03170005
031800                                                                  03180005
031900     GOBACK.                                                      03190005
032000                                                                  03200005
032100 1000-INITIALIZE.                                                 03210005
032200                                                                  03220005
032300     MOVE SPACES                      TO AMSGLNO                  03230005
032400     MOVE -1                          TO ADOORL                   03240005
032500                                                                  03250005
032600     INITIALIZE CA-REDEFINED-COMMAREA                             03260005
032700                PC233-DOOR-ID                                     03270005
032800                PC233-DIVERT-NBR                                  03280005
032900                PC233-DIVERT-LOC-ID                               03290005
033000                PC233-TRIP-ID                                     03300005
033100                PC233-SERIAL-NBR                                  03310005
033200                PC233-STR-NBR                                     03320005
033300                PC233-OWNER-SCAC-ID                               03330005
033400                PC233-CARTON                                      03340005
033500                PC233-TRAILER                                     03350005
033600                PC233-ERROR-FIELDS                                03360005
033700                                                                  03370005
033800     SET PC233-CONVEYOR-CUTOFF        TO TRUE                     03380005
033900     MOVE PC-TRANID                   TO PC233-TRAN-ID            03390005
034000                                                                  03400005
034100     MOVE PC233-USER-ID               TO PV-USER-ID.              03410005
034200                                                                  03420005
034300 1200-HELP-SCREEN.                                                03430005
034400     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      03440005
034500     MOVE PC-CURRENT-PROGRAM-NAME     TO PC192-PROGRAM-NAME       03450005
034600     COPY PCPD188.                                                03460005
034700     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      03470005
034800     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA     03480005
034900     PERFORM 8220-XCTL-TO-HELP.                                   03490005
035000                                                                  03500005
035100/                                                                 03510005
035200 2100-EDIT-INPUT.                                                 03520005
035300                                                                  03530005
035400     SET PS-ERRORS-NO                 TO TRUE                     03540005
035500     MOVE SPACES                      TO AMSGLNO                  03550005
035600                                                                  03560005
035700     IF ADOORA = DP015-ERASE-EOF                                  03570005
035800         MOVE SPACES                  TO PV-SCREEN-DOOR           03580005
035900     ELSE                                                         03590005
036000         MOVE ADOORI                  TO PV-SCREEN-DOOR           03600005
036100     END-IF                                                       03610005
036200                                                                  03620005
036300     IF ADESTA = DP015-ERASE-EOF                                  03630005
036400         MOVE ZEROES                  TO PV-SCREEN-DEST           03640005
036500     ELSE                                                         03650005
036600         MOVE ADESTI                  TO PV-SCREEN-DEST           03660005
036700     END-IF                                                       03670005
036800                                                                  03680005
036900     IF ASERIALA = DP015-ERASE-EOF                                03690005
037000         MOVE ZEROES                  TO PV-SCREEN-SERIAL-NBR     03700005
037100     ELSE                                                         03710005
037200         MOVE ASERIALI                TO PV-SCREEN-SERIAL-NBR     03720005
037300     END-IF                                                       03730005
037400                                                                  03740005
037500     PERFORM 2110-PRE-EDITS                                       03750005
037600*    (VALIDATE NUMERIC FIELDS AND LOAD CA-CURR FIELDS)            03760005
037700                                                                  03770005
037800     IF PS-ERRORS-NO                                              03780005
037900         IF CA-CURR-SERIAL-NBR > ZERO                             03790005
038000             PERFORM 2120-EDIT-SERIAL-NBR                         03800005
038100         ELSE                                                     03810005
038200             SET PS-SERIAL-NO         TO TRUE                     03820005
038300         END-IF                                                   03830005
038400                                                                  03840005
038500         IF CA-CURR-DOOR > SPACES                                 03850005
038600             MOVE CA-CURR-DOOR        TO PC233-DOOR-ID            03860005
038700             PERFORM 2130-EDIT-DOOR                               03870005
038800         END-IF                                                   03880005
038900     END-IF.                                                      03890005
039000                                                                  03900005
039100* POPULATE DOOR AND STORE DEPENDING ON WHAT WAS SCANNED           03910005
039200                                                                  03920005
039300     IF PS-ERRORS-NO                                              03930005
039400                                                                  03940005
039500     EVALUATE TRUE                                                03950005
039600         WHEN CA-CURR-DEST > ZERO AND CA-CURR-DOOR > SPACES       03960005
039700*            (BOTH WERE ENTERED)                                  03970005
039800             CONTINUE                                             03980005
039900                                                                  03990005
040000         WHEN CA-CURR-DOOR > SPACES                               04000005
040100*            (ENTERED DOOR BUT NOT DEST)                          04010005
040200                                                                  04020005
040300             PERFORM 7060-SELECT-TCNDRST                          04030005
040400*              IS THERE ONLY ONE STORE FOR THIS DOOR?             04040005
040500                                                                  04050005
040600             IF SQLCODE = ZERO                                    04060005
040700*              YES THERE IS ONLY ONE STORE FOR THIS DOOR          04070005
040800                 MOVE CNDRST-STR-NBR  TO ADESTO                   04080005
040900                                         PC233-STR-NBR            04090005
041000                 MOVE DP015-ASK-NOR-MDT                           04100005
041100                                      TO ADESTA                   04110005
041200                                                                  04120005
041300                 PERFORM 7070-CHECK-OPEN-TRAILERS                 04130005
041400*              IS THERE AN OPEN TRAILER ASSIGNED TO THIS DOOR?    04140005
041500                                                                  04150005
041600                 IF SQLCODE = ZERO                                04160005
041700*              YES THERE IS AN OPEN TRAILER ASSIGNED TO THIS DOOR 04170005
041800                     MOVE SUOBTR-TRLR-SRL-NBR                     04180005
041900                                      TO ASERIALO                 04190005
042000                                         PC233-SERIAL-NBR         04200005
042100                     PERFORM 7000-SELECT-TCNTRID                  04210005
042200                     IF PS-TCNTRID-YES                            04220005
042300                         MOVE CNTRID-SCAC-CDE                     04230005
042400                                      TO ASCACO                   04240005
042500                                         PC233-OWNER-SCAC-ID      04250005
042600                     END-IF                                       04260005
042700                                                                  04270005
042800                                                                  04280005
042900*                ELSE                                             04290005
043000*                    SET PS-ERRORS-YES                            04300005
043100*                                     TO TRUE                     04310005
043200*                    MOVE -1          TO ADESTL                   04320005
043300*                    MOVE '   DEST REQUIRED   '                   04330005
043400*                                     TO AMSGLNO                  04340005
043500                 END-IF                                           04350005
043600             END-IF                                               04360005
043700                                                                  04370005
043800         WHEN CA-CURR-DEST > ZERO                                 04380005
043900*            (ENTERED DEST BUT NOT DOOR)                          04390005
044000                                                                  04400005
044100             PERFORM 7080-SELECT-TCNDRST                          04410005
044200*            IS STORE ALSO AT ANOTHER DOOR?                       04420005
044300                                                                  04430005
044400             IF SQLCODE = ZERO                                    04440005
044500                 MOVE CNDRST-DOOR-ID  TO PC233-DOOR-ID            04450005
044600                                         ADOORO                   04460005
044700                 MOVE CNDCDR-DIVERT-NBR                           04470005
044800                                      TO PC233-DIVERT-NBR         04480005
044900                 MOVE CNDCDR-DIVERT-LOC-ID                        04490005
045000                                      TO PC233-DIVERT-LOC-ID      04500005
045100*            THE STORE IS ASSIGNED TO ONLY ONE DOOR               04510005
045200                                                                  04520005
045300                 PERFORM 7090-SELECT-TCNDRST                      04530005
045400*            IS THERE ONLY ONE TRAILER ASSIGNED TO THIS STORE?    04540005
045500                                                                  04550005
045600                 EVALUATE SQLCODE                                 04560005
045700                                                                  04570005
045800                 WHEN ZERO                                        04580005
045900                     CONTINUE                                     04590005
046000*                 THERE IS ONLY ONE TRAILER ASSIGNED TO THIS STORE04600005
046100                     MOVE SUOBTR-TRLR-SRL-NBR                     04610005
046200                                      TO ASERIALO                 04620005
046300                                         PC233-SERIAL-NBR         04630005
046400                     MOVE SUOBTR-OTBND-TRIP-ID                    04640005
046500                                      TO ATRIPO                   04650005
046600                                         PC233-TRIP-ID            04660005
046700                     PERFORM 7000-SELECT-TCNTRID                  04670005
046800                     IF PS-TCNTRID-YES                            04680005
046900                         MOVE CNTRID-SCAC-CDE                     04690005
047000                                      TO ASCACO                   04700005
047100                                         PC233-OWNER-SCAC-ID      04710005
047200                     END-IF                                       04720005
047300                     MOVE -1          TO ADOORL                   04730005
047400                                                                  04740005
047500                                                                  04750005
047600                 WHEN -811                                        04760005
047700*               THERE ARE MULTIPLE TRAILERS ASSIGNED TO THIS STORE04770005
047800                         MOVE SUOBTS-DOOR-ID                      04780005
047900                                      TO ADOORO                   04790005
048000                                         PC233-DOOR-ID            04800005
048100                 WHEN OTHER                                       04810005
048200*                UNABLE TO PRE-LOAD DOOR.  USER MUST ENTER VALUE  04820005
048300                     SET PS-ERRORS-YES                            04830005
048400                                      TO TRUE                     04840005
048500*                    MOVE -1          TO ADOORL                   04850005
048600*                    MOVE '   DOOR REQUIRED   '                   04860005
048700*                                     TO AMSGLNO                  04870005
048800                 END-EVALUATE                                     04880005
048900             END-IF                                               04890005
049000         WHEN OTHER                                               04900005
049100*            (NEITHER DEST NOR DOOR WAS ENTERED)                  04910005
049200             IF PC233-SERIAL-NBR > ZERO                           04920005
049300                 PERFORM 7100-GET-STR-DOOR-FROM-TRAILER           04930005
049400                 IF SQLCODE = ZERO                                04940005
049500                     MOVE SUOBTS-DOOR-ID                          04950005
049600                                      TO ADOORO                   04960005
049700                                         PC233-DOOR-ID            04970005
049800                     MOVE SUOBTR-DEST-OPER-UNT-ID                 04980005
049900                                      TO ADESTO                   04990005
050000                                         PC233-STR-NBR            05000005
050100                     PERFORM 7010-SELECT-TCNDCDR                  05010005
050200                     IF PS-TCNDCDR-YES                            05020005
050300                         MOVE CNDCDR-DIVERT-NBR                   05030005
050400                                      TO PC233-DIVERT-NBR         05040005
050500                         MOVE CNDCDR-DIVERT-LOC-ID                05050005
050600                                      TO PC233-DIVERT-LOC-ID      05060005
050700                     END-IF                                       05070005
050800                 END-IF                                           05080005
050900             ELSE                                                 05090005
051000                 SET PS-ERRORS-YES                                05100005
051100                                      TO TRUE                     05110005
051200                 MOVE -1              TO ADOORL                   05120005
051300                 MOVE 'DOOR/DEST REQUIRED '                       05130005
051400                                      TO AMSGLNO                  05140005
051500             END-IF                                               05150005
051600         END-EVALUATE                                             05160005
051700                                                                  05170005
051800     END-IF.                                                      05180005
051900                                                                  05190005
052000     IF PS-ERRORS-NO                                              05200005
052100         IF PC233-DOOR-ID > SPACES AND PC233-STR-NBR > ZERO       05210005
052200                  AND PC233-SERIAL-NBR > ZERO                     05220005
052300             CONTINUE                                             05230005
052400         ELSE                                                     05240005
052500             SET PS-ERRORS-YES        TO TRUE                     05250005
052600             IF PC233-SERIAL-NBR = ZERO                           05260005
052700                 MOVE -1              TO ASERIALL                 05270005
052800                 MOVE '  SER NBR REQUIRED '                       05280005
052900                                      TO AMSGLNO                  05290005
053000             END-IF                                               05300005
053100             IF PC233-STR-NBR = ZERO                              05310005
053200                         MOVE -1      TO ADESTL                   05320005
053300                         MOVE '   DEST REQUIRED   '               05330005
053400                                      TO AMSGLNO                  05340005
053500             END-IF                                               05350005
053600             IF PC233-DOOR-ID = SPACES                            05360005
053700                 MOVE -1              TO ADOORL                   05370005
053800                 MOVE '   DOOR REQUIRED   '                       05380005
053900                                      TO AMSGLNO                  05390005
054000             END-IF                                               05400005
054100         END-IF                                                   05410005
054200     END-IF                                                       05420005
054300                                                                  05430005
054400     IF PS-ERRORS-NO                                              05440005
054500         PERFORM 2200-CONSISTENCY-EDITS                           05450005
054600     END-IF.                                                      05460005
054700                                                                  05470005
054800 2110-PRE-EDITS.                                                  05480005
054900     MOVE PV-SCREEN-SERIAL-NBR        TO DP010I-UNEDITED-FIELD    05490005
055000     MOVE LENGTH OF PV-SCREEN-SERIAL-NBR                          05500005
055100                                      TO DP010I-MAXIMUM-DIGITS    05510005
055200     MOVE ZERO                        TO DP010I-MAXIMUM-DECIMALS  05520005
055300     SET DP010I-NEGATIVE-NOT-ALLOWED  TO TRUE                     05530005
055410     CALL DP010I-NUMERIC-EDIT-ROUTINE                             05541014
055420                         USING DP010I-NUMERIC-EDIT-AREA           05542014
055500     IF DP010I-ERROR-DETECTED                                     05550005
055600         SET PS-ERRORS-YES            TO TRUE                     05560005
055700         MOVE -1                      TO ASERIALL                 05570005
055800                                                                  05580005
055900         MOVE 'SER NBR NOT NUMERIC '                              05590005
056000                                      TO AMSGLNO                  05600005
056100     ELSE                                                         05610005
056200         MOVE DP010I-NUMERIC-FIELD    TO CA-CURR-SERIAL-NBR       05620005
056300                                         PC233-SERIAL-NBR         05630005
056400     END-IF.                                                      05640005
056500                                                                  05650005
056600     MOVE PV-SCREEN-DEST              TO DP010I-UNEDITED-FIELD    05660005
056700     MOVE LENGTH OF PV-SCREEN-DEST    TO DP010I-MAXIMUM-DIGITS    05670005
056800     MOVE ZERO                        TO DP010I-MAXIMUM-DECIMALS  05680005
056900     SET DP010I-NEGATIVE-NOT-ALLOWED  TO TRUE                     05690005
057010     CALL DP010I-NUMERIC-EDIT-ROUTINE                             05701014
057020                         USING DP010I-NUMERIC-EDIT-AREA           05702014
057100     IF DP010I-ERROR-DETECTED                                     05710005
057200         SET PS-ERRORS-YES            TO TRUE                     05720005
057300         MOVE -1                      TO ADESTL                   05730005
057400                                                                  05740005
057500         MOVE ' DEST NOT NUMERIC  '   TO AMSGLNO                  05750005
057600     ELSE                                                         05760005
057700         MOVE DP010I-NUMERIC-FIELD    TO CA-CURR-DEST             05770005
057800                                         PC233-STR-NBR            05780005
057900     END-IF.                                                      05790005
058000                                                                  05800005
058100     MOVE PV-SCREEN-DOOR              TO CA-CURR-DOOR.            05810005
058200/                                                                 05820005
058300* THE FOLLOWING EDITS CHECK THE VALIDITY OF ENTITIES IN           05830005
058400* THEMSELVES NOT HOW THEY MIGHT RELATE TO OTHER FIELDS ON         05840005
058500* THE SCREEN.                                                     05850005
058600                                                                  05860005
058700 2120-EDIT-SERIAL-NBR.                                            05870005
058800* IS THIS SERIAL NBR CONNECTED TO A SCAC/TRAILER AT ALL?          05880005
058900     PERFORM 7000-SELECT-TCNTRID                                  05890005
059000     IF PS-TCNTRID-NO                                             05900005
059100         SET PS-SERIAL-NO             TO TRUE                     05910005
059200         MOVE -1                      TO ASERIALL                 05920005
059300                                                                  05930005
059400         MOVE ' TRAILER NOT FOUND '   TO AMSGLNO                  05940005
059500     ELSE                                                         05950005
059600         SET PS-SERIAL-YES            TO TRUE                     05960005
059700         MOVE CNTRID-SCAC-CDE         TO ASCACO                   05970005
059800                                         PC233-OWNER-SCAC-ID      05980005
059900     END-IF.                                                      05990005
060000                                                                  06000005
060100 2130-EDIT-DOOR.                                                  06010005
060200* IS THIS A SHIPPING OR SHUTTLE DOOR IN THE CURRENT LOCATION?     06020005
060300     PERFORM 7010-SELECT-TCNDCDR                                  06030005
060400                                                                  06040005
060401     IF PS-TCNDCDR-YES                                            06040105
060402         IF CA-CURR-DEST = ZERO                                   06040200
066510             PERFORM 7011-SELECT-TCNDRST                          06651005
066520         END-IF                                                   06652005
066530         MOVE CNDCDR-DIVERT-NBR       TO PC233-DIVERT-NBR         06653005
066540         MOVE CNDCDR-DIVERT-LOC-ID    TO PC233-DIVERT-LOC-ID      06654005
066550         SET PS-DO-DOOR-DEST-EDITS    TO TRUE                     06655005
066560         IF CNDCDR-DOOR-TYP-CDE = 'SH' OR 'DS'                    06656005
066570             SET PS-DO-DOOR-DEST-EDITS                            06657005
066580                                      TO TRUE                     06658005
066590         END-IF                                                   06659005
066710         IF (CNDCDR-DIVERT-NBR = ZERO OR                          06671012
066720             CNDCDR-DIVERT-LOC-ID = SPACES)                       06672006
066800             SET PS-SKIP-DOOR-DEST-EDITS                          06680005
066900                                      TO TRUE                     06690005
066901         ELSE                                                     06690112
066910         IF  CNDCDR-DOOR-TYP-CDE  =  'ST'                         06691012
066920             SET PS-DO-DOOR-DEST-EDITS                            06692012
066930                                      TO TRUE                     06693012
067000         END-IF                                                   06700005
067010         END-IF                                                   06701012
067100     ELSE                                                         06710005
067200         SET PS-ERRORS-YES            TO TRUE                     06720005
067300         MOVE -1                      TO ADOORL                   06730005
067400         MOVE ' DOOR NOT DEFINED  '   TO AMSGLNO                  06740005
067500     END-IF.                                                      06750005
067600                                                                  06760005
067700     IF PS-SKIP-DOOR-DEST-EDITS                                   06770005
067800         IF PC233-DIVERT-NBR = ZERO OR                            06780005
067900                  PC233-DIVERT-LOC-ID = SPACES                    06790005
068000             SET PS-ERRORS-YES        TO TRUE                     06800005
068100             MOVE 'NO CONVEYOR AT DOOR'                           06810005
068200                                      TO AMSGLNO                  06820005
068300             MOVE -1                  TO ADOORL                   06830005
068400         END-IF                                                   06840005
068500     END-IF.                                                      06850005
068600                                                                  06860005
068700 2200-CONSISTENCY-EDITS.                                          06870005
068800*  CHECK THE RELATIONSHIPS BETWEEN THE FIELDS.                    06880005
068900                                                                  06890005
069000     PERFORM 2205-GET-TRAILER-INFO.                               06900005
069100                                                                  06910005
069200     IF PS-ERRORS-NO                                              06920005
069300         PERFORM 2210-TRLR-AT-ANOTHER-DOOR                        06930005
069400     END-IF                                                       06940005
069500                                                                  06950005
069600     IF PS-ERRORS-NO                                              06960005
069700         PERFORM 2220-DIFF-TRLR-AT-THIS-DOOR                      06970005
069800     END-IF                                                       06980005
069900                                                                  06990005
069910     IF  CNDCDR-DOOR-TYP-CDE  =  'ST'                             06991012
069920         CONTINUE                                                 06992012
069930     ELSE                                                         06993012
070000         IF PS-ERRORS-NO AND PS-DO-DOOR-DEST-EDITS                07000012
070100             PERFORM 2230-CHECK-STORES-THIS-DOOR                  07010012
070200         END-IF                                                   07020012
070201     END-IF                                                       07020112
070210                                                                  07021011
070300** COMMENT OUT CHECK FOR DIVERTED CARTONS AS PV-DB2-COUNT WILL    07030011
070310** ALWAYS BE > 0                                                  07031011
070320** GB 3/3/03                                                      07032011
070400**   IF PS-ERRORS-NO AND PS-DO-DOOR-DEST-EDITS                    07040011
070500**       PERFORM 2235-CHK-FOR-CTNS-ON-DIVERT                      07050011
070600**   END-IF                                                       07060011
070700                                                                  07070005
070800     IF PS-ERRORS-NO AND PS-DO-DOOR-DEST-EDITS                    07080005
070900         PERFORM 2240-CHECK-FOR-START-RANGE                       07090005
071000     END-IF.                                                      07100005
071100                                                                  07110005
071200                                                                  07120005
071300 2205-GET-TRAILER-INFO.                                           07130005
071400     INITIALIZE PC048-COMMAREA-REC                                07140005
071500     MOVE PC233-SERIAL-NBR            TO PC048-TRLR-SRL-NBR       07150005
071600                                         PC233-ERROR-SRL-NBR      07160005
071700     PERFORM 8300-LINK-TRLR-STATUS.                               07170005
071800     MOVE PC048-SCAC-CDE              TO PC233-OWNER-SCAC-ID      07180005
071900                                         PC233-ERROR-SCAC-ID      07190005
072000     MOVE PC048-TRLR-ID               TO PC233-ERROR-TRLR-ID      07200005
072100                                         PC233-TRAILER            07210005
072200                                         ATRLRO                   07220005
072300     MOVE PC048-OTBND-TRIP-ID         TO PC233-TRIP-ID            07230005
072400                                         PC233-ERROR-TRIP-ID      07240005
072500                                         ATRIPO.                  07250005
072600     MOVE PC048-TRIP-STAT-SHRT-DESC   TO PC233-ERROR-TRLR-STATUS  07260005
072700     IF PC048-OPEN-AT-DC                                          07270005
072800         CONTINUE                                                 07280005
072900     ELSE                                                         07290005
073000         SET PS-ERRORS-YES                                        07300005
073100             PS-XCTL-E871             TO TRUE                     07310005
073200         MOVE 12                      TO PC233-PGM-MSG-NBR        07320005
073300     END-IF.                                                      07330005
073400                                                                  07340005
073500                                                                  07350005
073600 2210-TRLR-AT-ANOTHER-DOOR.                                       07360005
073700     PERFORM 7020-FIND-OTHER-DOOR.                                07370005
073800                                                                  07380005
073900 2220-DIFF-TRLR-AT-THIS-DOOR.                                     07390005
074000     PERFORM 7030-FIND-OTHER-TRLR.                                07400005
074100                                                                  07410005
074200 2230-CHECK-STORES-THIS-DOOR.                                     07420005
074300*    OPEN A CURSOR THAT IS A LIST OF ALL DOORS ASSIGNED FOR THE   07430005
074400*    GIVEN STORE.  THERE SHOULD ONLY BE ONE DOOR FOR ANY STORE.   07440005
074500                                                                  07450005
074600     MOVE ZERO                        TO PV-DOOR-COUNT            07460005
074610                                                                  07461007
074620     PERFORM 7043-CK-MULT-STOR-DOOR.                              07462007
074700                                                                  07470005
074800     PERFORM 7040-OPEN-STORE-DOOR-CSR.                            07480005
074900     PERFORM 7041-FETCH-STORE-DOOR-CSR UNTIL                      07490005
075000             PS-END-STORE-DOOR-CSR                                07500005
075100     PERFORM 7042-CLOSE-STORE-DOOR-CSR.                           07510005
075200                                                                  07520005
075300     EVALUATE TRUE                                                07530005
075400     WHEN PS-ONE-DOOR-THIS-STORE                                  07540005
075500         CONTINUE                                                 07550005
075600     WHEN PS-MLT-DOORS-THIS-STORE                                 07560005
075700         MOVE 6                       TO PC233-PGM-MSG-NBR        07570005
075800         MOVE PC233-STR-NBR           TO PC233-ERROR-STR-NBR      07580005
075900*        MOVE 'MULT'                  TO PC233-ERROR-DOOR-NBR     07590005
076000             SET PS-XCTL-E871                                     07600005
076100                 PS-ERRORS-YES        TO TRUE                     07610005
076200     WHEN PS-NO-DOORS-THIS-STORE                                  07620005
076300         MOVE 6                       TO PC233-PGM-MSG-NBR        07630005
076400         MOVE PC233-STR-NBR           TO PC233-ERROR-STR-NBR      07640005
076500         MOVE 'NONE'                  TO PC233-ERROR-DOOR-NBR     07650005
076600             SET PS-XCTL-E871                                     07660005
076700                 PS-ERRORS-YES        TO TRUE                     07670005
076800     END-EVALUATE.                                                07680005
076900/                                                                 07690005
077000 2235-CHK-FOR-CTNS-ON-DIVERT.                                     07700005
077100     PERFORM 7200-SELECT-TSUCRDV.                                 07710005
077200     IF PV-DB2-COUNT = ZERO                                       07720005
077300         MOVE 10                      TO PC233-PGM-MSG-NBR        07730005
077400         MOVE 'PCKRF874'              TO PC233-NEXT-PROGRAM       07740005
077500         SET PS-ERRORS-YES                                        07750005
077600             PS-XCTL-E871             TO TRUE                     07760005
077700     END-IF.                                                      07770005
077800                                                                  07780005
077900 2240-CHECK-FOR-START-RANGE.                                      07790005
078000     PERFORM 7150-SELECT-TSUCDOT.                                 07800005
078100     IF PS-ERRORS-NO                                              07810005
078200         EVALUATE TRUE                                            07820005
078300         WHEN SUCDOT-END-DIVERT-TMST = PC-DUMMY-TIMESTAMP         07830005
078400*            (HAS A STARTING CARTON BUT NO ENDING CARTON)         07840005
078500             SET PS-XCTL-E873         TO TRUE                     07850005
078600         WHEN SQLCODE = +100                                      07860005
078700*            (DOESN'T HAVE ANY START OR END)                      07870005
078800             SET PS-XCTL-E874         TO TRUE                     07880005
078900         WHEN OTHER                                               07890005
079000*            (HAS AN ENDING CARTON BUT NEEDS ANOTHER START)       07900005
079100             SET PS-XCTL-E874         TO TRUE                     07910005
079200         END-EVALUATE                                             07920005
079300     END-IF.                                                      07930005
079400/                                                                 07940005
079500 7000-SELECT-TCNTRID.                                             07950005
079600                                                                  07960005
079700     EXEC SQL                                                     07970005
079800         SELECT                                                   07980005
079900             TRID.SCAC_CDE                                        07990005
080000         ,   TRID.TRLR_ID                                         08000005
080100         INTO                                                     08010005
080200           :CNTRID-SCAC-CDE                                       08020005
080300         , :CNTRID-TRLR-ID                                        08030005
080400         FROM                                                     08040005
080500            TCNTRID TRID                                          08050005
080600         WHERE TRID.TRLR_SRL_NBR     = :PC233-SERIAL-NBR          08060005
080700     END-EXEC.                                                    08070005
080800                                                                  08080005
080900     EVALUATE TRUE                                                08090005
081000         WHEN SQLCODE = ZERO                                      08100005
081100         WHEN SQLCODE = -811                                      08110005
081200             SET PS-TCNTRID-YES       TO TRUE                     08120005
081300         WHEN SQLCODE = +100                                      08130005
081400             SET PS-TCNTRID-NO        TO TRUE                     08140005
081500             SET PS-ERRORS-YES        TO TRUE                     08150005
081600         WHEN SQLCODE = -904                                      08160005
081700         WHEN SQLCODE = -913                                      08170005
081800         WHEN SQLCODE = -911                                      08180005
081900             MOVE 1                   TO PV-ERROR-NBR             08190005
082000             PERFORM 9903-WRITE-CICS-LOG                          08200005
082100             PERFORM 9000-SOFT-ABORT                              08210005
082200         WHEN SQLWARN0 NOT = SPACES                               08220005
082300         WHEN SQLCODE NOT EQUAL ZERO                              08230005
082400             MOVE 2                   TO PV-ERROR-NBR             08240005
082500                                         PC233-ERROR-NBR          08250005
082600             PERFORM 9903-WRITE-CICS-LOG                          08260005
082700             MOVE '7000-SELECT-TCNTRID'                           08270005
082800                                      TO PC233-PARAGRAPH          08280005
082900             MOVE 'PCKRF872 - CHECK TRAILER EXISTENCE'            08290005
083000                                      TO PC233-MESSAGE-TEXT(1)    08300005
083100             MOVE SQLCA               TO PC233-SQLCA              08310005
083200             MOVE 'TCNTRID'           TO PC233-DB2-TABLE-NAME(1)  08320005
083300             SET PC233-ABEND          TO TRUE                     08330005
083400             MOVE 99                  TO PC233-PGM-MSG-NBR        08340005
083500             PERFORM 8210-XCTL-ERROR-SCREEN                       08350005
083600     END-EVALUATE.                                                08360005
083700/                                                                 08370005
083800 7010-SELECT-TCNDCDR.                                             08380005
083900                                                                  08390005
084000     EXEC SQL                                                     08400005
084100         SELECT                                                   08410005
084200             DCDR.DOOR_TYP_CDE                                    08420005
084300         ,   DCDR.DIVERT_NBR                                      08430005
084400         ,   DCDR.DIVERT_LOC_ID                                   08440005
084500         INTO                                                     08450005
084600             :CNDCDR-DOOR-TYP-CDE                                 08460005
084700         ,   :CNDCDR-DIVERT-NBR                                   08470005
084800         ,   :CNDCDR-DIVERT-LOC-ID                                08480005
084900         FROM TCNDCDR DCDR                                        08490005
085000         ,    TCNDRTY DRTY                                        08500005
085100         WHERE                                                    08510005
085200             DCDR.OPER_UNT_ID         = :PC233-OPER-UNT-ID        08520005
085300             AND DCDR.DOOR_ID         = :PC233-DOOR-ID            08530005
085400             AND DCDR.DOOR_TYP_CDE    = DRTY.DOOR_TYP_CDE         08540005
085500             AND DRTY.DIVERT_TYP_CDE  = 'D'                       08550005
085600     END-EXEC.                                                    08560005
085700                                                                  08570005
085800     EVALUATE TRUE                                                08580005
085900         WHEN SQLCODE = ZERO                                      08590005
086000             SET PS-TCNDCDR-YES       TO TRUE                     08600005
086100         WHEN SQLCODE = +100                                      08610005
086200             SET PS-TCNDCDR-NO        TO TRUE                     08620005
086300         WHEN SQLCODE = -904                                      08630005
086400         WHEN SQLCODE = -913                                      08640005
086500         WHEN SQLCODE = -911                                      08650005
086600             MOVE 3                   TO PV-ERROR-NBR             08660005
086700             PERFORM 9903-WRITE-CICS-LOG                          08670005
086800             PERFORM 9000-SOFT-ABORT                              08680005
086900         WHEN SQLWARN0 NOT = SPACES                               08690005
087000         WHEN SQLCODE NOT EQUAL ZERO                              08700005
087100             MOVE 4                   TO PV-ERROR-NBR             08710005
087200                                         PC233-ERROR-NBR          08720005
087300             PERFORM 9903-WRITE-CICS-LOG                          08730005
087400             MOVE '7010-SELECT-TCNDCDR'                           08740005
087500                                      TO PC233-PARAGRAPH          08750005
087600             MOVE 'PCKRF872 - CHECK DOOR ID'                      08760005
087700                                      TO PC233-MESSAGE-TEXT(1)    08770005
087800             MOVE SQLCA               TO PC233-SQLCA              08780005
087900             MOVE 'TCNDCDR'           TO PC233-DB2-TABLE-NAME(1)  08790005
088000             SET PC233-ABEND          TO TRUE                     08800005
088100             MOVE 99                  TO PC233-PGM-MSG-NBR        08810005
088200             PERFORM 8210-XCTL-ERROR-SCREEN                       08820005
088300     END-EVALUATE.                                                08830005
095400                                                                  09540000
095410 7011-SELECT-TCNDRST.                                             09541005
095420                                                                  09542005
095430     EXEC SQL                                                     09543005
095440         SELECT                                                   09544005
095450             DRST.STR_NBR                                         09545005
095480         INTO                                                     09548005
095490             :CNDRST-STR-NBR                                      09549005
095493         FROM TCNDRST DRST                                        09549305
095495         WHERE                                                    09549505
095496             DRST.OPER_UNT_ID         = :PC233-OPER-UNT-ID        09549605
095497             AND DRST.DOOR_ID         = :PC233-DOOR-ID            09549705
095498             AND CURRENT TIMESTAMP BETWEEN                        09549805
095499                  DRST.STRT_TMST AND DRST.END_TMST                09549905
095501     END-EXEC.                                                    09550105
095502                                                                  09550205
095503     EVALUATE TRUE                                                09550305
095504         WHEN SQLCODE = ZERO                                      09550405
095505             MOVE CNDRST-STR-NBR      TO PC233-STR-NBR            09550505
095506                                         ADESTO                   09550605
095509         WHEN SQLCODE = +100                                      09550905
095510         WHEN SQLCODE = -811                                      09551005
095511             MOVE ZEROES              TO PC233-STR-NBR            09551105
095512                                         ADESTO                   09551205
095513         WHEN SQLCODE = -904                                      09551305
095514         WHEN SQLCODE = -913                                      09551405
095515         WHEN SQLCODE = -911                                      09551505
095516             MOVE 5                   TO PV-ERROR-NBR             09551605
095517             PERFORM 9903-WRITE-CICS-LOG                          09551705
095518             PERFORM 9000-SOFT-ABORT                              09551805
095519         WHEN SQLWARN0 NOT = SPACES                               09551905
095520         WHEN SQLCODE NOT EQUAL ZERO                              09552005
095543             MOVE 6                   TO PV-ERROR-NBR             09554305
095544                                         PC233-ERROR-NBR          09554405
095545             PERFORM 9903-WRITE-CICS-LOG                          09554505
095546             MOVE '7011-SELECT-TCNDRST'                           09554605
095547                                      TO PC233-PARAGRAPH          09554705
095548             MOVE 'PCKRF872 - CHECK DOOR ID'                      09554805
095549                                      TO PC233-MESSAGE-TEXT(1)    09554905
095550             MOVE SQLCA               TO PC233-SQLCA              09555005
095551             MOVE 'TCNDRST'           TO PC233-DB2-TABLE-NAME(1)  09555105
095552             SET PC233-ABEND          TO TRUE                     09555205
095553             MOVE 99                  TO PC233-PGM-MSG-NBR        09555305
095554             PERFORM 8210-XCTL-ERROR-SCREEN                       09555405
095555     END-EVALUATE.                                                09555505
095556                                                                  09555605
095557 7020-FIND-OTHER-DOOR.                                            09555705
095558                                                                  09555805
095559     EXEC SQL                                                     09555905
095560         SELECT                                                   09556005
095570             OBTS.DOOR_ID                                         09557005
095580         ,   OBTS.OTBND_TRIP_ID                                   09558005
095590         INTO                                                     09559005
095600             :SUOBTS-DOOR-ID                                      09560005
095700         ,   :SUOBTS-OTBND-TRIP-ID                                09570005
095800         FROM                                                     09580005
095900             TSUOBTR OBTR                                         09590005
096000       ,     TSUOBTS OBTS                                         09600005
096100       WHERE                                                      09610005
096200           OBTR.TRLR_SRL_NBR                = :PC233-SERIAL-NBR   09620005
096300           AND OBTR.TRIP_ACTV_CDE           = 'A'                 09630005
096400           AND OBTR.OTBND_TRIP_ID           = OBTS.OTBND_TRIP_ID  09640005
096500           AND OBTS.TRIP_STAT_CDE           = 'DO'                09650005
096600           AND OBTS.DOOR_ID                <> :PC233-DOOR-ID      09660005
096700           AND OBTS.OTBND_STAT_TMST =                             09670005
096800                                                                  09680005
096900        ( SELECT MAX (OBTS1.OTBND_STAT_TMST )                     09690005
097000            FROM                                                  09700005
097100              TSUOBTS OBTS1                                       09710005
097200            WHERE                                                 09720005
097300              OBTS.OTBND_TRIP_ID        = OBTS1.OTBND_TRIP_ID)    09730005
097400     END-EXEC.                                                    09740005
097500                                                                  09750005
097600     EVALUATE TRUE                                                09760005
097700         WHEN SQLCODE = ZERO                                      09770005
097800*           (THE TRAILER IS OPEN AT ONE OTHER DOOR)               09780005
097900             MOVE SUOBTS-DOOR-ID      TO PC233-ERROR-DOOR-NBR     09790005
098000             MOVE SUOBTS-OTBND-TRIP-ID                            09800005
098100                                      TO PC233-ERROR-TRIP-ID      09810005
098200             MOVE 4                   TO PC233-PGM-MSG-NBR        09820005
098300             SET PS-TRLR-OPEN-DIFF-DOOR                           09830005
098400                 PS-XCTL-E871                                     09840005
098500                 PS-ERRORS-YES        TO TRUE                     09850005
098600         WHEN SQLCODE = -811                                      09860005
098700*           (THE TRAILER IS AT MULTIPLE DOORS                     09870005
098800*                     OTHER THAN THE CURRENT ONE)                 09880005
098900             MOVE 4                   TO PC233-PGM-MSG-NBR        09890005
099000             MOVE 'MULT'              TO PC233-ERROR-DOOR-NBR     09900005
099100             MOVE SUOBTS-OTBND-TRIP-ID                            09910005
099200                                      TO PC233-ERROR-TRIP-ID      09920005
099300             SET PS-TRLR-OPEN-DIFF-DOOR                           09930005
099400                 PS-XCTL-E871                                     09940005
099500                 PS-ERRORS-YES        TO TRUE                     09950005
099600         WHEN SQLCODE = +100                                      09960005
099700*           (THE TRAILER IS ONLY AT THE CURRENT DOOR)             09970005
099800             SET PS-TRLR-OPEN-THIS-DOOR                           09980005
099900                                      TO TRUE                     09990005
100000         WHEN SQLCODE = -904                                      10000005
100100         WHEN SQLCODE = -913                                      10010005
100200         WHEN SQLCODE = -911                                      10020005
100300             MOVE 7                   TO PV-ERROR-NBR             10030005
100400             PERFORM 9903-WRITE-CICS-LOG                          10040005
100500             PERFORM 9000-SOFT-ABORT                              10050005
100600         WHEN SQLWARN0 NOT = SPACES                               10060005
100700         WHEN SQLCODE NOT EQUAL ZERO                              10070005
100800             MOVE 8                   TO PV-ERROR-NBR             10080005
100900                                         PC233-ERROR-NBR          10090005
101000             PERFORM 9903-WRITE-CICS-LOG                          10100005
101100             MOVE '7020-FIND-OTHER-DOOR'                          10110005
101200                                      TO PC233-PARAGRAPH          10120005
101300             MOVE 'PCKRF872 - CHECK DOOR ID'                      10130005
101400                                      TO PC233-MESSAGE-TEXT(1)    10140005
101500             MOVE SQLCA               TO PC233-SQLCA              10150005
101600             MOVE 'TSUOBTS'           TO PC233-DB2-TABLE-NAME(1)  10160005
101700             MOVE 'TSUOBTR'           TO PC233-DB2-TABLE-NAME(2)  10170005
101800             SET PC233-ABEND          TO TRUE                     10180005
101900             MOVE 99                  TO PC233-PGM-MSG-NBR        10190005
102000             PERFORM 8210-XCTL-ERROR-SCREEN                       10200005
102100     END-EVALUATE.                                                10210005
102200/                                                                 10220005
102300 7030-FIND-OTHER-TRLR.                                            10230005
102400                                                                  10240005
102500     EXEC SQL                                                     10250005
102600         SELECT                                                   10260005
102700             TRID.SCAC_CDE                                        10270005
102800         ,   TRID.TRLR_ID                                         10280005
102900         ,   OBTS.OTBND_TRIP_ID                                   10290005
103000         INTO                                                     10300005
103100             :CNTRID-SCAC-CDE                                     10310005
103200         ,   :CNTRID-TRLR-ID                                      10320005
103300         ,   :SUOBTS-OTBND-TRIP-ID                                10330005
103400         FROM TSUOBTS OBTS                                        10340005
103500         ,    TSUOBTR OBTR                                        10350005
103600         ,    TCNTRID TRID                                        10360005
103700         WHERE                                                    10370005
103800             OBTS.OTBND_TRIP_ID       = OBTR.OTBND_TRIP_ID        10380005
103900         AND OBTR.TRLR_SRL_NBR        <> :PC233-SERIAL-NBR        10390005
104000         AND OBTR.TRLR_SRL_NBR        = TRID.TRLR_SRL_NBR         10400005
104100         AND OBTR.TRIP_ACTV_CDE       = 'A'                       10410005
104200         AND OBTS.STAT_OPER_UNT_ID    = :PC233-OPER-UNT-ID        10420005
104300         AND OBTS.DOOR_ID             =  :PC233-DOOR-ID           10430005
104400         AND OBTS.TRIP_STAT_CDE       = 'DO'                      10440005
104500                                                                  10450005
104600         AND OBTS.OTBND_STAT_TMST =                               10460005
104700                                                                  10470005
104800        ( SELECT MAX (OBTS1.OTBND_STAT_TMST )                     10480005
104900            FROM                                                  10490005
105000              TSUOBTS OBTS1                                       10500005
105100            WHERE                                                 10510005
105200              OBTS.OTBND_TRIP_ID        = OBTS1.OTBND_TRIP_ID)    10520005
105300     END-EXEC.                                                    10530005
105400                                                                  10540005
105500     EVALUATE TRUE                                                10550005
105600         WHEN SQLCODE = ZERO                                      10560005
105700             MOVE CNTRID-SCAC-CDE     TO PC233-ERROR-SCAC-ID      10570005
105800             MOVE CNTRID-TRLR-ID      TO PC233-ERROR-TRLR-ID      10580005
105900                                         ATRLRO                   10590005
106000                                         PC233-TRAILER            10600005
106100             MOVE SUOBTS-OTBND-TRIP-ID                            10610005
106200                                      TO PC233-ERROR-TRIP-ID      10620005
106300             MOVE 5                   TO PC233-PGM-MSG-NBR        10630005
106400             SET PS-TRLR-OPEN-DIFF-DOOR                           10640005
106500                 PS-XCTL-E871                                     10650005
106600                 PS-ERRORS-YES        TO TRUE                     10660005
106700         WHEN SQLCODE = +100                                      10670005
106800             CONTINUE                                             10680005
106900         WHEN SQLCODE = -904                                      10690005
107000         WHEN SQLCODE = -913                                      10700005
107100         WHEN SQLCODE = -911                                      10710005
107200             MOVE 9                   TO PV-ERROR-NBR             10720005
107300             PERFORM 9903-WRITE-CICS-LOG                          10730005
107400             PERFORM 9000-SOFT-ABORT                              10740005
107500         WHEN SQLWARN0 NOT = SPACES                               10750005
107600         WHEN SQLCODE NOT EQUAL ZERO                              10760005
107700             MOVE 10                  TO PV-ERROR-NBR             10770005
107800                                         PC233-ERROR-NBR          10780005
107900             PERFORM 9903-WRITE-CICS-LOG                          10790005
108000             MOVE '7030-FIND-OTHER-TRLR'                          10800005
108100                                      TO PC233-PARAGRAPH          10810005
108200             MOVE 'PCKRF872 - CHECK TRLR AT ANOTHER DOOR'         10820005
108300                                      TO PC233-MESSAGE-TEXT(1)    10830005
108400             MOVE SQLCA               TO PC233-SQLCA              10840005
108500             MOVE 'TSUOBTS'           TO PC233-DB2-TABLE-NAME(1)  10850005
108600             MOVE 'TSUOBTR'           TO PC233-DB2-TABLE-NAME(2)  10860005
108700             MOVE 'TCNTRID'           TO PC233-DB2-TABLE-NAME(3)  10870005
108800             SET PC233-ABEND          TO TRUE                     10880005
108900             MOVE 99                  TO PC233-PGM-MSG-NBR        10890005
109000             PERFORM 8210-XCTL-ERROR-SCREEN                       10900005
109100     END-EVALUATE.                                                10910005
109200/                                                                 10920005
109300 7040-OPEN-STORE-DOOR-CSR.                                        10930005
109400     EXEC SQL                                                     10940005
109500         OPEN STORE-DOOR-CSR                                      10950005
109600     END-EXEC.                                                    10960005
109700                                                                  10970005
109800     EVALUATE TRUE                                                10980005
109900         WHEN SQLCODE = ZERO                                      10990005
110000             SET PS-NOT-END-STORE-DOOR-CSR                        11000005
110100                                      TO TRUE                     11010005
110200         WHEN SQLCODE = -904                                      11020005
110300         WHEN SQLCODE = -913                                      11030005
110400         WHEN SQLCODE = -911                                      11040005
110500             MOVE 11                  TO PV-ERROR-NBR             11050005
110600             PERFORM 9903-WRITE-CICS-LOG                          11060005
110700             PERFORM 9000-SOFT-ABORT                              11070005
110800         WHEN SQLWARN0 NOT = SPACES                               11080005
110900         WHEN SQLCODE NOT EQUAL ZERO                              11090005
111000             MOVE 12                  TO PV-ERROR-NBR             11100005
111100                                         PC233-ERROR-NBR          11110005
111200             PERFORM 9903-WRITE-CICS-LOG                          11120005
111300             MOVE '7040-OPEN-STORE-DOOR-CSR'                      11130005
111400                                      TO PC233-PARAGRAPH          11140005
111500             MOVE 'PCKRF872 - FETCH STORES FOR A DOOR'            11150005
111600                                      TO PC233-MESSAGE-TEXT(1)    11160005
111700             MOVE SQLCA               TO PC233-SQLCA              11170005
111800             MOVE 'TCNDRST'           TO PC233-DB2-TABLE-NAME(1)  11180005
111900             MOVE 'TCNDCDR'           TO PC233-DB2-TABLE-NAME(2)  11190005
112000             SET PC233-ABEND          TO TRUE                     11200005
112100             MOVE 99                  TO PC233-PGM-MSG-NBR        11210005
112200             PERFORM 8210-XCTL-ERROR-SCREEN                       11220005
112300     END-EVALUATE.                                                11230005
112400                                                                  11240005
112500                                                                  11250005
112600 7041-FETCH-STORE-DOOR-CSR.                                       11260005
112700                                                                  11270005
112800     EXEC SQL                                                     11280005
112900         FETCH STORE-DOOR-CSR                                     11290005
113000         INTO                                                     11300005
113100             :CNDRST-DOOR-ID                                      11310005
113200     END-EXEC.                                                    11320005
113300                                                                  11330005
113400     EVALUATE TRUE                                                11340005
113500         WHEN SQLCODE = ZERO                                      11350005
113600             ADD 1                    TO PV-DOOR-COUNT            11360005
113700             IF CNDRST-DOOR-ID = PC233-DOOR-ID                    11370005
113800                 SET PS-ONE-DOOR-THIS-STORE                       11380005
113900                                      TO TRUE                     11390005
114000             ELSE                                                 11400005
114010                 IF  PS-MULT-DOORS-ALLOWED  AND                   11401007
114020                     PS-ONE-DOOR-THIS-STORE                       11402007
114030                     CONTINUE                                     11403007
114040                 ELSE                                             11404007
114100                     MOVE CNDRST-DOOR-ID                          11410007
114110                                      TO PC233-ERROR-DOOR-NBR     11411007
114200                     SET PS-MLT-DOORS-THIS-STORE                  11420007
114300                                      TO TRUE                     11430005
114400                 END-IF                                           11440007
114410             END-IF                                               11441007
114500         WHEN SQLCODE = +100                                      11450005
114600             SET PS-END-STORE-DOOR-CSR                            11460005
114700                                      TO TRUE                     11470005
114800             IF PV-DOOR-COUNT = ZERO                              11480005
114900                 SET PS-NO-DOORS-THIS-STORE                       11490005
115000                                      TO TRUE                     11500005
115100             END-IF                                               11510005
115200         WHEN SQLCODE = -904                                      11520005
115300         WHEN SQLCODE = -913                                      11530005
115400         WHEN SQLCODE = -911                                      11540005
115500             MOVE 13                  TO PV-ERROR-NBR             11550005
115600             PERFORM 9903-WRITE-CICS-LOG                          11560005
115700             PERFORM 9000-SOFT-ABORT                              11570005
115800         WHEN SQLWARN0 NOT = SPACES                               11580005
115900         WHEN SQLCODE NOT EQUAL ZERO                              11590005
116000             MOVE 14                  TO PV-ERROR-NBR             11600005
116100                                         PC233-ERROR-NBR          11610005
116200             PERFORM 9903-WRITE-CICS-LOG                          11620005
116300             MOVE '7041-FETCH-STORE-DOOR-CSR'                     11630005
116400                                      TO PC233-PARAGRAPH          11640005
116500             MOVE 'PCKRF872 - FETCH STORES FOR A DOOR'            11650005
116600                                      TO PC233-MESSAGE-TEXT(1)    11660005
116700             MOVE SQLCA               TO PC233-SQLCA              11670005
116800             MOVE 'TCNDRST'           TO PC233-DB2-TABLE-NAME(1)  11680005
116900             MOVE 'TCNDCDR'           TO PC233-DB2-TABLE-NAME(2)  11690005
117000             SET PC233-ABEND          TO TRUE                     11700005
117100             MOVE 99                  TO PC233-PGM-MSG-NBR        11710005
117200             PERFORM 8210-XCTL-ERROR-SCREEN                       11720005
117300     END-EVALUATE.                                                11730005
117400                                                                  11740005
117500                                                                  11750005
117600                                                                  11760005
117700 7042-CLOSE-STORE-DOOR-CSR.                                       11770005
117800     EXEC SQL                                                     11780005
117900         CLOSE STORE-DOOR-CSR                                     11790005
118000     END-EXEC.                                                    11800005
118100                                                                  11810005
118200     EVALUATE TRUE                                                11820005
118300         WHEN SQLCODE = ZERO                                      11830005
118400             CONTINUE                                             11840005
118500         WHEN SQLWARN0 NOT = SPACES                               11850005
118600         WHEN SQLCODE NOT EQUAL ZERO                              11860005
118700             MOVE 15                  TO PV-ERROR-NBR             11870005
118800                                         PC233-ERROR-NBR          11880005
118900             PERFORM 9903-WRITE-CICS-LOG                          11890005
119000             MOVE '7040-OPEN-STORE-DOOR-CSR'                      11900005
119100                                      TO PC233-PARAGRAPH          11910005
119200             MOVE 'PCKRF872 - FETCH STORES FOR A DOOR'            11920005
119300                                      TO PC233-MESSAGE-TEXT(1)    11930005
119400             MOVE SQLCA               TO PC233-SQLCA              11940005
119500             MOVE 'TCNDRST'           TO PC233-DB2-TABLE-NAME(1)  11950005
119600             MOVE 'TCNDCDR'           TO PC233-DB2-TABLE-NAME(2)  11960005
119700             SET PC233-ABEND          TO TRUE                     11970005
119800             MOVE 99                  TO PC233-PGM-MSG-NBR        11980005
119900             PERFORM 8210-XCTL-ERROR-SCREEN                       11990005
120000     END-EVALUATE.                                                12000005
120001                                                                  12000107
120002                                                                  12000207
120010 7043-CK-MULT-STOR-DOOR.                                          12001007
120020                                                                  12002007
120030     MOVE PC233-OPER-UNT-ID  TO  DK-OPER-UNT-ID.                  12003007
120040                                                                  12004007
120050     EXEC SQL                                                     12005007
120060         SELECT FUNC_TXT                                          12006007
120070         INTO  :KRPRPM-FUNC-TXT                                   12007007
120080         FROM  TKRPRPM                                            12008007
120090         WHERE LOC_ID            = :DK-OPER-UNT-ID                12009007
120091           AND SYS_PRC_FUNC_CDE  = 'MLTDOR'                       12009107
120092           AND INTFC_SYS_CDE     = 'KHL'                          12009207
120093           AND FUNC_PRC_STAT_CDE = 'AC'                           12009307
120094           AND FUNC_TXT          = 'Y'                            12009407
120095     END-EXEC.                                                    12009507
120096                                                                  12009607
120097     EVALUATE TRUE                                                12009707
120098         WHEN SQLCODE = ZERO                                      12009807
120099             SET PS-MULT-DOORS-ALLOWED  TO TRUE                   12009907
120100         WHEN SQLCODE = +100                                      12010007
120101             SET PS-NO-MULT-DOORS       TO TRUE                   12010107
120102         WHEN SQLCODE = -904                                      12010207
120103         WHEN SQLCODE = -913                                      12010307
120104         WHEN SQLCODE = -911                                      12010407
120105             MOVE 2                   TO PV-ERROR-NBR             12010507
120106             PERFORM 9903-WRITE-CICS-LOG                          12010607
120107             PERFORM 9000-SOFT-ABORT                              12010707
120108         WHEN SQLWARN0 NOT = SPACES                               12010807
120109         WHEN SQLCODE NOT EQUAL ZERO                              12010907
120110              MOVE PC233-OPER-UNT-ID      TO PV-DISPLAY-OPER      12011007
120111              MOVE PC233-DOOR-ID          TO PV-DISPLAY-DOOR-ID   12011107
120112              MOVE PC233-STR-NBR          TO PV-DISPLAY-DEST      12011207
120113              MOVE PC233-SERIAL-NBR       TO PV-DISPLAY-SRL-NBR   12011307
120114              MOVE PC233-OWNER-SCAC-ID    TO PV-DISPLAY-SCAC      12011407
120115              MOVE PC233-TRIP-ID          TO PV-DISPLAY-TRIP      12011507
120116              STRING  ' OPER-'               DELIMITED BY SIZE    12011607
120117                      PV-DISPLAY-OPER        DELIMITED BY SIZE    12011707
120118                      '  DOOR-'              DELIMITED BY SIZE    12011807
120119                      PV-DISPLAY-DOOR-ID     DELIMITED BY SIZE    12011907
120120                      '  DEST-'              DELIMITED BY SIZE    12012007
120121                      PV-DISPLAY-DEST        DELIMITED BY SIZE    12012107
120122                                        INTO                      12012207
120123                                        PC233-MESSAGE-TEXT(2)     12012307
120124             STRING   ' TRLR SRL#-'          DELIMITED BY SIZE    12012407
120125                      PV-DISPLAY-SRL-NBR     DELIMITED BY SIZE    12012507
120126                      '   SCAC-'             DELIMITED BY SIZE    12012607
120127                      PV-DISPLAY-SCAC        DELIMITED BY SIZE    12012707
120128                      '   TRIP-'             DELIMITED BY SIZE    12012807
120129                      PV-DISPLAY-TRIP        DELIMITED BY SIZE    12012907
120130                                        INTO                      12013007
120131                                        PC233-MESSAGE-TEXT(3)     12013107
120132                                                                  12013207
120133             MOVE 3                   TO PV-ERROR-NBR             12013307
120134                                         PC233-ERROR-NBR          12013407
120135             PERFORM 9903-WRITE-CICS-LOG                          12013507
120136             MOVE '7043-CK-MULT-STOR-DOOR'                        12013607
120137                                      TO PC233-PARAGRAPH          12013707
120138             MOVE 'PCKRF872 - CHECK MULT DOOR ALLOW FOR STORE'    12013807
120139                                      TO PC233-MESSAGE-TEXT(1)    12013907
120140             MOVE SQLCA               TO PC233-SQLCA              12014007
120141             MOVE 'TKRPRPM'           TO PC233-DB2-TABLE-NAME(1)  12014107
120142             SET PC233-ABEND          TO TRUE                     12014207
120143             MOVE 99                  TO PC233-PGM-MSG-NBR        12014307
120144             PERFORM 8210-XCTL-ERROR-SCREEN                       12014407
120145     END-EVALUATE.                                                12014507
120146                                                                  12014607
120147                                                                  12014707
120148                                                                  12014807
120150                                                                  12015007
120200 7060-SELECT-TCNDRST.                                             12020005
120300                                                                  12030005
120400     EXEC SQL                                                     12040005
120500         SELECT  ST.STR_NBR                                       12050005
120600         INTO  :CNDRST-STR-NBR                                    12060005
120700         FROM TCNDRST ST                                          12070005
120800         WHERE ST.OPER_UNT_ID = :PC233-OPER-UNT-ID                12080005
120900           AND ST.DOOR_ID     = :PC233-DOOR-ID                    12090005
120910           AND ST.END_TMST    = '9999-09-09-09.09.09.999999'      12091013
121000     END-EXEC                                                     12100005
121100                                                                  12110005
121200     EVALUATE TRUE                                                12120005
121300         WHEN SQLCODE = ZERO                                      12130005
121400         WHEN SQLCODE = +100                                      12140005
121500         WHEN SQLCODE = -811                                      12150005
121600             CONTINUE                                             12160005
121700         WHEN SQLCODE = -904                                      12170005
121800         WHEN SQLCODE = -913                                      12180005
121900         WHEN SQLCODE = -911                                      12190005
122000             MOVE 16                  TO PV-ERROR-NBR             12200005
122100             PERFORM 9903-WRITE-CICS-LOG                          12210005
122200             PERFORM 9000-SOFT-ABORT                              12220005
122300         WHEN SQLWARN0 NOT = SPACES                               12230005
122400         WHEN SQLCODE NOT EQUAL ZERO                              12240005
122500             MOVE 17                  TO PV-ERROR-NBR             12250005
122600                                         PC233-ERROR-NBR          12260005
122700             PERFORM 9903-WRITE-CICS-LOG                          12270005
122800             MOVE '7060-SELECT-TSUOBTS'                           12280005
122900                                      TO PC233-PARAGRAPH          12290005
123000             MOVE 'PCKRF872 - CHECK TRLR AT ANOTHER DOOR'         12300005
123100                                      TO PC233-MESSAGE-TEXT(1)    12310005
123200             MOVE SQLCA               TO PC233-SQLCA              12320005
123300             MOVE 'TCNDRST'           TO PC233-DB2-TABLE-NAME(1)  12330005
123400             SET PC233-ABEND          TO TRUE                     12340005
123500             MOVE 99                  TO PC233-PGM-MSG-NBR        12350005
123600             PERFORM 8210-XCTL-ERROR-SCREEN                       12360005
123700     END-EVALUATE.                                                12370005
123800/                                                                 12380005
123900 7070-CHECK-OPEN-TRAILERS.                                        12390005
124000                                                                  12400005
124100     EXEC SQL                                                     12410005
124200         SELECT OBTS.OTBND_TRIP_ID                                12420005
124300         ,      OBTR.TRLR_SRL_NBR                                 12430005
124400         INTO :SUOBTS-OTBND-TRIP-ID                               12440005
124500         ,    :SUOBTR-TRLR-SRL-NBR                                12450005
124600         FROM TSUOBTS OBTS                                        12460005
124700         ,    TSUOBTR OBTR                                        12470005
124800         WHERE OBTS.TRIP_STAT_CDE     = 'DO'                      12480005
124900         AND OBTS.DOOR_ID             = :PC233-DOOR-ID            12490005
125000         AND OBTR.ORGN_OPER_UNT_ID    = :PC233-OPER-UNT-ID        12500005
125100         AND OBTR.OTBND_TRIP_ID       = OBTS.OTBND_TRIP_ID        12510005
125200         AND OBTS.OTBND_STAT_TMST     =                           12520005
125300         (                                                        12530005
125400          SELECT                                                  12540005
125500            MAX(OBTS1.OTBND_STAT_TMST)                            12550005
125600            FROM TSUOBTS OBTS1                                    12560005
125700            WHERE OBTS.OTBND_TRIP_ID = OBTS1.OTBND_TRIP_ID        12570005
125800         )                                                        12580005
125900     END-EXEC.                                                    12590005
126000                                                                  12600005
126100     EVALUATE TRUE                                                12610005
126200         WHEN SQLCODE = ZERO                                      12620005
126300         WHEN SQLCODE = +100                                      12630005
126400         WHEN SQLCODE = -811                                      12640005
126500             CONTINUE                                             12650005
126600         WHEN SQLCODE = -904                                      12660005
126700         WHEN SQLCODE = -913                                      12670005
126800         WHEN SQLCODE = -911                                      12680005
126900             MOVE 18                  TO PV-ERROR-NBR             12690005
127000             PERFORM 9903-WRITE-CICS-LOG                          12700005
127100             PERFORM 9000-SOFT-ABORT                              12710005
127200         WHEN SQLWARN0 NOT = SPACES                               12720005
127300         WHEN SQLCODE NOT EQUAL ZERO                              12730005
127400             MOVE 19                  TO PV-ERROR-NBR             12740005
127500                                         PC233-ERROR-NBR          12750005
127600             PERFORM 9903-WRITE-CICS-LOG                          12760005
127700             MOVE '7070-CHECK-OPEN-TRAILERS'                      12770005
127800                                      TO PC233-PARAGRAPH          12780005
127900             MOVE 'PCKRF872 - CHECK OPEN TRAILERS AT DOOR'        12790005
128000                                      TO PC233-MESSAGE-TEXT(1)    12800005
128100             MOVE SQLCA               TO PC233-SQLCA              12810005
128200             MOVE 'TSUOBTS'           TO PC233-DB2-TABLE-NAME(1)  12820005
128300             MOVE 'TSUOBTR'           TO PC233-DB2-TABLE-NAME(2)  12830005
128400             SET PC233-ABEND          TO TRUE                     12840005
128500             MOVE 99                  TO PC233-PGM-MSG-NBR        12850005
128600             PERFORM 8210-XCTL-ERROR-SCREEN                       12860005
128700     END-EVALUATE.                                                12870005
128800/                                                                 12880005
128900 7080-SELECT-TCNDRST.                                             12890005
129000     EXEC SQL                                                     12900005
129100         SELECT                                                   12910005
129200             DRST.DOOR_ID                                         12920005
129300         ,   DCDR.DIVERT_NBR                                      12930005
129400         ,   DCDR.DIVERT_LOC_ID                                   12940005
129500         INTO                                                     12950005
129600             :CNDRST-DOOR-ID                                      12960005
129700         ,   :CNDCDR-DIVERT-NBR                                   12970005
129800         ,   :CNDCDR-DIVERT-LOC-ID                                12980005
129900         FROM TCNDRST DRST                                        12990005
130000         ,    TCNDCDR DCDR                                        13000005
130100         ,    TCNDRTY DRTY                                        13010005
130200         WHERE                                                    13020005
130300             DRST.OPER_UNT_ID         = :PC233-OPER-UNT-ID        13030005
130400         AND DRST.STR_NBR             = :PC233-STR-NBR            13040005
130500         AND DRST.OPER_UNT_ID         = DCDR.OPER_UNT_ID          13050005
130600         AND DRST.DOOR_ID             = DCDR.DOOR_ID              13060005
130700         AND CURRENT TIMESTAMP BETWEEN                            13070005
130800              DRST.STRT_TMST AND DRST.END_TMST                    13080005
130900         AND DCDR.DOOR_TYP_CDE        = DRTY.DOOR_TYP_CDE         13090005
131000         AND DRTY.DIVERT_TYP_CDE      = 'D'                       13100005
131100     END-EXEC.                                                    13110005
131200                                                                  13120005
131300     EVALUATE TRUE                                                13130005
131400         WHEN SQLCODE = ZERO                                      13140005
131500         WHEN SQLCODE = +100                                      13150005
131600         WHEN SQLCODE = -811                                      13160005
131700             CONTINUE                                             13170005
131800         WHEN SQLCODE = -904                                      13180005
131900         WHEN SQLCODE = -913                                      13190005
132000         WHEN SQLCODE = -911                                      13200005
132100             MOVE 20                  TO PV-ERROR-NBR             13210005
132200             PERFORM 9903-WRITE-CICS-LOG                          13220005
132300             PERFORM 9000-SOFT-ABORT                              13230005
132400         WHEN SQLWARN0 NOT = SPACES                               13240005
132500         WHEN SQLCODE NOT EQUAL ZERO                              13250005
132600             MOVE 21                  TO PV-ERROR-NBR             13260005
132700                                         PC233-ERROR-NBR          13270005
132800             PERFORM 9903-WRITE-CICS-LOG                          13280005
132900             MOVE '7080-SELECT-TCNDRST'                           13290005
133000                                      TO PC233-PARAGRAPH          13300005
133100             MOVE 'PCKRF872 - CHECK OPEN TRAILERS AT DOOR'        13310005
133200                                      TO PC233-MESSAGE-TEXT(1)    13320005
133300             MOVE SQLCA               TO PC233-SQLCA              13330005
133400             MOVE 'TCNTRST'           TO PC233-DB2-TABLE-NAME(1)  13340005
133500             SET PC233-ABEND          TO TRUE                     13350005
133600             MOVE 99                  TO PC233-PGM-MSG-NBR        13360005
133700             PERFORM 8210-XCTL-ERROR-SCREEN                       13370005
133800     END-EVALUATE.                                                13380005
133900/                                                                 13390005
134000 7090-SELECT-TCNDRST.                                             13400005
134100     EXEC SQL                                                     13410005
134200         SELECT OBTS.DOOR_ID                                      13420005
134300            ,   OBTR.TRLR_SRL_NBR                                 13430005
134400            ,   OBTR.OTBND_TRIP_ID                                13440005
134500         INTO :SUOBTS-DOOR-ID                                     13450005
134600            , :SUOBTR-TRLR-SRL-NBR                                13460005
134700            , :SUOBTR-OTBND-TRIP-ID                               13470005
134800         FROM TSUOBTR OBTR                                        13480005
134900         ,    TSUOBTS OBTS                                        13490005
135000         WHERE                                                    13500005
135100             OBTR.DEST_OPER_UNT_ID = :PC233-STR-NBR               13510005
135200             AND OBTR.TRIP_ACTV_CDE = 'A'                         13520005
135300             AND OBTS.OTBND_TRIP_ID = OBTR.OTBND_TRIP_ID          13530005
135400         AND OBTS.OTBND_STAT_TMST =                               13540005
135500         (                                                        13550005
135600          SELECT                                                  13560005
135700            MAX(OBTS1.OTBND_STAT_TMST)                            13570005
135800            FROM TSUOBTS OBTS1                                    13580005
135900            WHERE OBTS.OTBND_TRIP_ID = OBTS1.OTBND_TRIP_ID        13590005
136000         )                                                        13600005
136100     END-EXEC                                                     13610005
136200                                                                  13620005
136300     EVALUATE TRUE                                                13630005
136400         WHEN SQLCODE = ZERO                                      13640005
136500         WHEN SQLCODE = +100                                      13650005
136600         WHEN SQLCODE = -811                                      13660005
136700             CONTINUE                                             13670005
136800         WHEN SQLCODE = -904                                      13680005
136900         WHEN SQLCODE = -913                                      13690005
137000         WHEN SQLCODE = -911                                      13700005
137100             MOVE 22                  TO PV-ERROR-NBR             13710005
137200             PERFORM 9903-WRITE-CICS-LOG                          13720005
137300             PERFORM 9000-SOFT-ABORT                              13730005
137400         WHEN SQLWARN0 NOT = SPACES                               13740005
137500         WHEN SQLCODE NOT EQUAL ZERO                              13750005
137600             MOVE 23                  TO PV-ERROR-NBR             13760005
137700                                         PC233-ERROR-NBR          13770005
137800             PERFORM 9903-WRITE-CICS-LOG                          13780005
137900             MOVE '7090-SELECT-TCNDRST'                           13790005
138000                                      TO PC233-PARAGRAPH          13800005
138100             MOVE 'PCKRF872 - CHECK OPEN TRAILERS AT DOOR'        13810005
138200                                      TO PC233-MESSAGE-TEXT(1)    13820005
138300             MOVE SQLCA               TO PC233-SQLCA              13830005
138400             MOVE 'TCNTRST'           TO PC233-DB2-TABLE-NAME(1)  13840005
138500             SET PC233-ABEND          TO TRUE                     13850005
138600             MOVE 99                  TO PC233-PGM-MSG-NBR        13860005
138700             PERFORM 8210-XCTL-ERROR-SCREEN                       13870005
138800     END-EVALUATE.                                                13880005
138900/                                                                 13890005
139000 7100-GET-STR-DOOR-FROM-TRAILER.                                  13900005
139100                                                                  13910005
139200     EXEC SQL                                                     13920005
139300         SELECT OBTS.DOOR_ID                                      13930005
139400         ,      OBTR.DEST_OPER_UNT_ID                             13940005
139500         INTO :SUOBTS-DOOR-ID                                     13950005
139600         ,    :SUOBTR-DEST-OPER-UNT-ID                            13960005
139700         FROM TSUOBTR OBTR                                        13970005
139800         ,    TSUOBTS OBTS                                        13980005
139900         WHERE                                                    13990005
140000             OBTR.TRLR_SRL_NBR      = :PC233-SERIAL-NBR           14000005
140100             AND OBTR.TRIP_ACTV_CDE = 'A'                         14010005
140200             AND OBTS.TRIP_STAT_CDE IN ('DO', 'DC')               14020005
140300             AND OBTS.OTBND_TRIP_ID = OBTR.OTBND_TRIP_ID          14030005
140400         AND OBTS.OTBND_STAT_TMST =                               14040005
140500         (                                                        14050005
140600          SELECT                                                  14060005
140700            MAX(OBTS1.OTBND_STAT_TMST)                            14070005
140800            FROM TSUOBTS OBTS1                                    14080005
140900            WHERE OBTS.OTBND_TRIP_ID = OBTS1.OTBND_TRIP_ID        14090005
141000         )                                                        14100005
141100     END-EXEC                                                     14110005
141200                                                                  14120005
141300     EVALUATE TRUE                                                14130005
141400         WHEN SQLCODE = ZERO                                      14140005
141500         WHEN SQLCODE = +100                                      14150005
141600         WHEN SQLCODE = -811                                      14160005
141700             CONTINUE                                             14170005
141800         WHEN SQLCODE = -904                                      14180005
141900         WHEN SQLCODE = -913                                      14190005
142000         WHEN SQLCODE = -911                                      14200005
142100             MOVE 24                  TO PV-ERROR-NBR             14210005
142200             PERFORM 9903-WRITE-CICS-LOG                          14220005
142300             PERFORM 9000-SOFT-ABORT                              14230005
142400         WHEN SQLWARN0 NOT = SPACES                               14240005
142500         WHEN SQLCODE NOT EQUAL ZERO                              14250005
142600             MOVE 25                  TO PV-ERROR-NBR             14260005
142700                                         PC233-ERROR-NBR          14270005
142800             PERFORM 9903-WRITE-CICS-LOG                          14280005
142900             MOVE '7100-GET-STR-DOOR-FROM-TRAILER'                14290005
143000                                      TO PC233-PARAGRAPH          14300005
143100             MOVE 'PCKRF872 - GET STORE/DOOR INFO FROM TRLR'      14310005
143200                                      TO PC233-MESSAGE-TEXT(1)    14320005
143300             MOVE SQLCA               TO PC233-SQLCA              14330005
143400             MOVE 'TSUOBTS'           TO PC233-DB2-TABLE-NAME(1)  14340005
143500             MOVE 'TSUOBTR'           TO PC233-DB2-TABLE-NAME(2)  14350005
143600             SET PC233-ABEND          TO TRUE                     14360005
143700             MOVE 99                  TO PC233-PGM-MSG-NBR        14370005
143800             PERFORM 8210-XCTL-ERROR-SCREEN                       14380005
143900     END-EVALUATE.                                                14390005
144000                                                                  14400005
144100 7150-SELECT-TSUCDOT.                                             14410005
144200                                                                  14420005
144300     EXEC SQL                                                     14430005
144400         SELECT END_DIVERT_TMST                                   14440005
144500         INTO :SUCDOT-END-DIVERT-TMST                             14450005
144600         FROM TSUCDOT CDOT                                        14460005
144700     WHERE CDOT.OTBND_TRIP_ID = :PC233-TRIP-ID                    14470005
144800       AND CDOT.OPER_UNT_ID   = :PC233-OPER-UNT-ID                14480005
144900       AND CDOT.DOOR_ID       = :PC233-DOOR-ID                    14490005
145000       AND CDOT.STRT_DIVERT_TMST =                                14500005
145100       (                                                          14510005
145200        SELECT MAX(CDOT1.STRT_DIVERT_TMST)                        14520005
145300        FROM                                                      14530005
145400        TSUCDOT CDOT1                                             14540005
145500        WHERE                                                     14550005
145600        CDOT1.OTBND_TRIP_ID = CDOT.OTBND_TRIP_ID                  14560005
145700        AND                                                       14570005
145800        CDOT1.OPER_UNT_ID   = CDOT.OPER_UNT_ID                    14580005
145900        AND                                                       14590005
146000        CDOT1.DOOR_ID       = CDOT.DOOR_ID                        14600005
146100        )                                                         14610005
146200     END-EXEC.                                                    14620005
146300                                                                  14630005
146400     EVALUATE TRUE                                                14640005
146500         WHEN SQLCODE = ZERO                                      14650005
146600         WHEN SQLCODE = +100                                      14660005
146700         WHEN SQLCODE = -811                                      14670005
146800             CONTINUE                                             14680005
146900         WHEN SQLCODE = -904                                      14690005
147000         WHEN SQLCODE = -913                                      14700005
147100         WHEN SQLCODE = -911                                      14710005
147200             MOVE 26                  TO PV-ERROR-NBR             14720005
147300             PERFORM 9903-WRITE-CICS-LOG                          14730005
147400             PERFORM 9000-SOFT-ABORT                              14740005
147500         WHEN SQLWARN0 NOT = SPACES                               14750005
147600         WHEN SQLCODE NOT EQUAL ZERO                              14760005
147700             MOVE 27                  TO PV-ERROR-NBR             14770005
147800                                         PC233-ERROR-NBR          14780005
147900             PERFORM 9903-WRITE-CICS-LOG                          14790005
148000             MOVE '7150-SELECT-TSUCDOT'                           14800005
148100                                      TO PC233-PARAGRAPH          14810005
148200             MOVE 'PCKRF872 - GET STORE/DOOR INFO FROM TRLR'      14820005
148300                                      TO PC233-MESSAGE-TEXT(1)    14830005
148400             MOVE SQLCA               TO PC233-SQLCA              14840005
148500             MOVE 'TSUCDOT'           TO PC233-DB2-TABLE-NAME(1)  14850005
148600             SET PC233-ABEND          TO TRUE                     14860005
148700             MOVE 99                  TO PC233-PGM-MSG-NBR        14870005
148800             PERFORM 8210-XCTL-ERROR-SCREEN                       14880005
148900     END-EVALUATE.                                                14890005
149000                                                                  14900005
149100 7200-SELECT-TSUCRDV.                                             14910005
149200                                                                  14920005
149300     MOVE ZERO                        TO PV-DB2-COUNT             14930005
149400     EXEC SQL                                                     14940005
149500         SELECT COUNT(*)                                          14950005
149600         INTO :PV-DB2-COUNT                                       14960005
149700       FROM TSUCRDV CRDV                                          14970005
149800       WHERE                                                      14980005
149900             CRDV.OPER_UNT_ID   = :PC233-OPER-UNT-ID              14990005
150000         AND CRDV.DIVERT_NBR    = :PC233-DIVERT-NBR               15000005
150100         AND CRDV.DIVERT_LOC_ID = :PC233-DIVERT-LOC-ID            15010005
150200         AND CRDV.ACTV_CDE      = 'A'                             15020005
150300     END-EXEC.                                                    15030005
150400                                                                  15040005
150500     EVALUATE TRUE                                                15050005
150600         WHEN SQLCODE = ZERO                                      15060005
150700         WHEN SQLCODE = +100                                      15070005
150800         WHEN SQLCODE = -305                                      15080005
150900             CONTINUE                                             15090005
151000         WHEN SQLCODE = -904                                      15100005
151100         WHEN SQLCODE = -913                                      15110005
151200         WHEN SQLCODE = -911                                      15120005
151300             MOVE 28                  TO PV-ERROR-NBR             15130005
151400             PERFORM 9903-WRITE-CICS-LOG                          15140005
151500             PERFORM 9000-SOFT-ABORT                              15150005
151600         WHEN SQLWARN0 NOT = SPACES                               15160005
151700         WHEN SQLCODE NOT EQUAL ZERO                              15170005
151800             MOVE 29                  TO PV-ERROR-NBR             15180005
151900                                         PC233-ERROR-NBR          15190005
152000             PERFORM 9903-WRITE-CICS-LOG                          15200005
152100             MOVE '7200-SELECT-TSUCNDR'                           15210005
152200                                      TO PC233-PARAGRAPH          15220005
152300             MOVE 'PCKRF872 - COUNT CARTON ON A DIVERTER'         15230005
152400                                      TO PC233-MESSAGE-TEXT(1)    15240005
152500             MOVE SQLCA               TO PC233-SQLCA              15250005
152600             MOVE 'TSUCRDV'           TO PC233-DB2-TABLE-NAME(1)  15260005
152700             SET PC233-ABEND          TO TRUE                     15270005
152800             MOVE 99                  TO PC233-PGM-MSG-NBR        15280005
152900             PERFORM 8210-XCTL-ERROR-SCREEN                       15290005
153000     END-EVALUATE.                                                15300005
153100                                                                  15310005
153200/                                                                 15320005
153300 8000-SEND-MAP.                                                   15330005
153400                                                                  15340005
153500     EXEC CICS                                                    15350005
153600         SEND MAP       ('PC872A')                                15360005
153700              MAPSET    ('PCKM872')                               15370005
153800              ERASE                                               15380005
153900              CURSOR                                              15390005
154000              RESP      (PV-CICS-RESPONSE)                        15400005
154100     END-EXEC.                                                    15410005
154200                                                                  15420005
154300     EVALUATE TRUE                                                15430005
154400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 15440005
154500             CONTINUE                                             15450005
154600         WHEN OTHER                                               15460005
154700             MOVE '8000-SEND-MAP'     TO DP013-PARAGRAPH          15470005
154800             MOVE 'PCKRF872 - UNABLE TO SEND MAP'                 15480005
154900                                      TO DP013-MESSAGE-TEXT (1)   15490005
155000             SET DP013-CICS-ABEND                                 15500005
155100                 DP013-ROLLBACK       TO TRUE                     15510005
155200             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               15520005
155300     END-EVALUATE.                                                15530005
155400                                                                  15540005
155500 8010-SEND-DATA-ONLY.                                             15550005
155600                                                                  15560005
155700     EXEC CICS                                                    15570005
155800         SEND MAP       ('PC872A')                                15580005
155900              MAPSET    ('PCKM872')                               15590005
156000              CURSOR                                              15600005
156100              DATAONLY                                            15610005
156200              RESP      (PV-CICS-RESPONSE)                        15620005
156300     END-EXEC.                                                    15630005
156400                                                                  15640005
156500     EVALUATE TRUE                                                15650005
156600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 15660005
156700             CONTINUE                                             15670005
156800         WHEN OTHER                                               15680005
156900             MOVE '8010-SEND-DATA-ONLY'                           15690005
157000                                      TO DP013-PARAGRAPH          15700005
157100             MOVE 'PCKRF872 - UNABLE TO SEND DATA'                15710005
157200                                      TO DP013-MESSAGE-TEXT (1)   15720005
157300             SET DP013-CICS-ABEND                                 15730005
157400                 DP013-ROLLBACK       TO TRUE                     15740005
157500             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               15750005
157600     END-EVALUATE.                                                15760005
157700                                                                  15770005
157800 8020-RECEIVE-MAP.                                                15780005
157900                                                                  15790005
158000     EXEC CICS                                                    15800005
158100         RECEIVE MAP    ('PC872A')                                15810005
158200                 MAPSET ('PCKM872')                               15820005
158300                 RESP   (PV-CICS-RESPONSE)                        15830005
158400     END-EXEC.                                                    15840005
158500                                                                  15850005
158600     EVALUATE TRUE                                                15860005
158700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 15870005
158800             CONTINUE                                             15880005
158900         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                15890005
159000             CONTINUE                                             15900005
159100         WHEN OTHER                                               15910005
159200            MOVE '8020-RECEIVE-MAP'   TO DP013-PARAGRAPH          15920005
159300            MOVE 'PCKRF872 - UNABLE TO RECEIVE MAP'               15930005
159400                                      TO DP013-MESSAGE-TEXT (1)   15940005
159500            SET DP013-LOGIC-ABEND     TO TRUE                     15950005
159600            SET DP013-ROLLBACK        TO TRUE                     15960005
159700            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                15970005
159800     END-EVALUATE.                                                15980005
159900                                                                  15990005
160000 8100-RETURN-TRANID.                                              16000005
160100                                                                  16010005
160200     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       16020005
160300     EXEC CICS                                                    16030005
160400         RETURN TRANSID  (PC-TRANID)                              16040005
160500                COMMAREA (CA-COMMAREA)                            16050005
160600                LENGTH   (PV-COMMAREA-LENGTH)                     16060005
160700                RESP     (PV-CICS-RESPONSE)                       16070005
160800     END-EXEC.                                                    16080005
160900                                                                  16090005
161000     EVALUATE TRUE                                                16100005
161100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 16110005
161200             CONTINUE                                             16120005
161300         WHEN OTHER                                               16130005
161400             MOVE '8100-RETURN-TRANIND'                           16140005
161500                                      TO DP013-PARAGRAPH          16150005
161600             MOVE 'PCKRF872 - UNABLE TO RETURN TO TRANID'         16160005
161700                 TO DP013-MESSAGE-TEXT (1)                        16170005
161800             SET DP013-CICS-ABEND     TO TRUE                     16180005
161900             SET DP013-ROLLBACK       TO TRUE                     16190005
162000             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               16200005
162100     END-EVALUATE.                                                16210005
162200                                                                  16220005
162300 8110-RETURN.                                                     16230005
162400                                                                  16240005
162500     EXEC CICS                                                    16250005
162600         SEND FROM (PV-MESSAGE-AREA)                              16260005
162700              LENGTH (19)                                         16270005
162800              ERASE                                               16280005
162900     END-EXEC.                                                    16290005
163000                                                                  16300005
163100     EXEC CICS                                                    16310005
163200         RETURN                                                   16320005
163300     END-EXEC.                                                    16330005
163400                                                                  16340005
163500 8200-XCTL.                                                       16350005
163600     SET PC233-INITIALIZE-SCREEN      TO TRUE.                    16360005
163700     MOVE PC-CURRENT-PROGRAM-NAME     TO PC233-LAST-PROGRAM.      16370005
163800     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       16380005
163900                                                                  16390005
164000     EXEC CICS                                                    16400005
164100         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    16410005
164200               COMMAREA  (CA-COMMAREA)                            16420005
164300               LENGTH    (PV-COMMAREA-LENGTH)                     16430005
164400               RESP      (PV-CICS-RESPONSE)                       16440005
164500     END-EXEC.                                                    16450005
164600                                                                  16460005
164700     EVALUATE TRUE                                                16470005
164800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 16480005
164900             CONTINUE                                             16490005
165000         WHEN OTHER                                               16500005
165100             MOVE '8200-XCTL'                                     16510005
165200                                      TO DP013-PARAGRAPH          16520005
165300             MOVE 'PCKRF872 - UNABLE TO XCTL TO PROGRAM: '        16530005
165400                                      TO DP013-MESSAGE-TEXT (1)   16540005
165500             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   16550005
165600             SET DP013-CICS-ABEND                                 16560005
165700                 DP013-ROLLBACK       TO TRUE                     16570005
165800             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               16580005
165900             MOVE PC-TRANS-UNAVAILABLE-MSG                        16590005
166000                                      TO AMSGLNO                  16600005
166100             SET PC233-PROCESS-SCREEN TO TRUE                     16610005
166200             MOVE -1                  TO ADOORL                   16620005
166300             PERFORM 8000-SEND-MAP                                16630005
166400             PERFORM 8100-RETURN-TRANID                           16640005
166500     END-EVALUATE.                                                16650005
166600                                                                  16660005
166700 8210-XCTL-ERROR-SCREEN.                                          16670005
166800     IF NOT PC233-ABEND                                           16680005
166900         SET PC233-INITIALIZE-SCREEN  TO TRUE                     16690005
167000     END-IF                                                       16700005
167100     IF PC233-PGM-MSG-NBR = ZERO                                  16710005
167200         MOVE 2                       TO PC233-PGM-MSG-NBR        16720005
167300     END-IF                                                       16730005
167400                                                                  16740005
167500     MOVE DFHEIBLK                    TO PC233-DFHEIBLK.          16750005
167600     MOVE PC-CURRENT-PROGRAM-NAME     TO PC233-LAST-PROGRAM.      16760005
167700     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       16770005
167800     MOVE 'PCKRF871'                  TO PV-TRANSFER-PROGRAM      16780005
167900                                                                  16790005
168000     EXEC CICS                                                    16800005
168100         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    16810005
168200               COMMAREA  (CA-COMMAREA)                            16820005
168300               LENGTH    (PV-COMMAREA-LENGTH)                     16830005
168400               RESP      (PV-CICS-RESPONSE)                       16840005
168500     END-EXEC.                                                    16850005
168600                                                                  16860005
168700     EVALUATE TRUE                                                16870005
168800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 16880005
168900             CONTINUE                                             16890005
169000         WHEN OTHER                                               16900005
169100             MOVE '8200-XCTL'                                     16910005
169200                                      TO DP013-PARAGRAPH          16920005
169300             MOVE 'PCKRF872 - UNABLE TO XCTL TO PROGRAM: '        16930005
169400                                      TO DP013-MESSAGE-TEXT (1)   16940005
169500             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   16950005
169600             SET DP013-CICS-ABEND                                 16960005
169700                 DP013-ROLLBACK       TO TRUE                     16970005
169800             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               16980005
169900             MOVE PC-TRANS-UNAVAILABLE-MSG                        16990005
170000                                      TO AMSGLNO                  17000005
170100             SET PC233-PROCESS-SCREEN TO TRUE                     17010005
170200             MOVE -1                  TO ADOORL                   17020005
170300             PERFORM 8000-SEND-MAP                                17030005
170400             PERFORM 8100-RETURN-TRANID                           17040005
170500     END-EVALUATE.                                                17050005
170600                                                                  17060005
170700*                                                                 17070005
170800 8220-XCTL-TO-HELP.                                               17080005
170900                                                                  17090005
171000     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH       17100005
171100                                                                  17110005
171200     EXEC CICS                                                    17120005
171300         XCTL                                                     17130005
171400             PROGRAM   (PV-TRANSFER-PROGRAM)                      17140005
171500             COMMAREA  (PC192-COMMAREA)                           17150005
171600             LENGTH    (PV-COMMAREA-LENGTH)                       17160005
171700             RESP      (PV-CICS-RESPONSE)                         17170005
171800     END-EXEC.                                                    17180005
171900                                                                  17190005
172000     EVALUATE TRUE                                                17200005
172100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 17210005
172200              CONTINUE                                            17220005
172300         WHEN OTHER                                               17230005
172400             MOVE '8220-XCTL-TO-HELP' TO DP013-PARAGRAPH          17240005
172500             MOVE 'PCKRF872 - UNABLE TO XCTL TO PROGRAM: '        17250005
172600                                      TO DP013-MESSAGE-TEXT (1)   17260005
172700             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   17270005
172800             SET DP013-CICS-ABEND                                 17280005
172900                 DP013-ROLLBACK       TO TRUE                     17290005
173000             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               17300005
173100             MOVE PC-TRANS-UNAVAILABLE-MSG                        17310005
173200                                      TO AMSGLNO                  17320005
173300             SET PC233-PROCESS-SCREEN TO TRUE                     17330005
173400             MOVE -1                  TO ADOORL                   17340005
173500             PERFORM 8000-SEND-MAP                                17350005
173600             PERFORM 8100-RETURN-TRANID                           17360005
173700     END-EVALUATE.                                                17370005
173800/                                                                 17380005
173900 8300-LINK-TRLR-STATUS.                                           17390005
174000     MOVE LENGTH OF PC048-COMMAREA-REC TO PV-COMMAREA-LENGTH      17400005
174100     EXEC CICS                                                    17410005
174200         LINK                                                     17420005
174300             PROGRAM   (PC-TRLR-STATUS-PGM)                       17430005
174400             COMMAREA  (PC048-COMMAREA-REC)                       17440005
174500             LENGTH    (PV-COMMAREA-LENGTH)                       17450005
174600     END-EXEC.                                                    17460005
174700                                                                  17470005
174800     EVALUATE TRUE                                                17480005
174900         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 17490005
175000              CONTINUE                                            17500005
175100         WHEN OTHER                                               17510005
175200             MOVE '8300-LINK-TRLR-STATUS'                         17520005
175300                                      TO DP013-PARAGRAPH          17530005
175400             MOVE 'PCKRF872 - UNABLE TO LINK TO PROGRAM: '        17540005
175500                                      TO DP013-MESSAGE-TEXT (1)   17550005
175600             MOVE PC-TRLR-STATUS-PGM  TO DP013-MESSAGE-TEXT (2)   17560005
175700             SET DP013-CICS-ABEND                                 17570005
175800                 DP013-ROLLBACK       TO TRUE                     17580005
175900             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               17590005
176000             MOVE PC-TRANS-UNAVAILABLE-MSG                        17600005
176100                                      TO AMSGLNO                  17610005
176200             SET PC233-PROCESS-SCREEN TO TRUE                     17620005
176300             MOVE -1                  TO ADOORL                   17630005
176400             PERFORM 8000-SEND-MAP                                17640005
176500             PERFORM 8100-RETURN-TRANID                           17650005
176600     END-EVALUATE.                                                17660005
176700/                                                                 17670005
176800/                                                                 17680005
176900 9000-SOFT-ABORT.                                                 17690005
177000                                                                  17700005
177100     EXEC CICS                                                    17710005
177200         SYNCPOINT ROLLBACK                                       17720005
177300     END-EXEC                                                     17730005
177400                                                                  17740005
177500     MOVE 1                           TO PC233-PGM-MSG-NBR        17750005
177600     MOVE SQLCODE                     TO PC233-SQLCODE            17760005
177700     PERFORM 8210-XCTL-ERROR-SCREEN.                              17770005
177800                                                                  17780005
177900                                                                  17790005
178000 9903-WRITE-CICS-LOG.                                             17800005
178100                                                                  17810005
178200     MOVE SQLCODE                     TO PV-SQLCODE               17820005
178300     MOVE PC233-DOOR-ID               TO PV-DISPLAY-DOOR          17830005
178400     MOVE PC233-USER-ID               TO PV-USER-ID               17840005
178500                                                                  17850005
178600     EXEC CICS                                                    17860005
178700         WRITEQ TD                                                17870005
178800             QUEUE  ('CSSL')                                      17880005
178900             FROM   (PV-LOG-MSG)                                  17890005
179000             RESP   (PV-CICS-RESPONSE)                            17900005
179100     END-EXEC.                                                    17910005
179200                                                                  17920005
179300 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  17930005
179400                                                                  17940005
179500     MOVE PC-CURRENT-PROGRAM-NAME     TO DP013-PROGRAM.           17950005
179600     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          17960005
179700     INITIALIZE DP013-SRC-TASK-NUMBER                             17970005
179800                DP013-STACK.                                      17980005
179900     SET DP013-LINK-RETURN            TO TRUE.                    17990005
180000                                                                  18000005
180100     EXEC CICS                                                    18010005
180200         LINK                                                     18020005
180300             PROGRAM   (DP013-NAME)                               18030005
180400             COMMAREA  (DP013-PARAMETERS)                         18040005
180500             LENGTH    (DP013-LENGTH)                             18050005
180600     END-EXEC.                                                    18060005
